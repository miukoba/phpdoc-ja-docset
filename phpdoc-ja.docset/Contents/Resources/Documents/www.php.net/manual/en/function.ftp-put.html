<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
 <head>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <title>FTP サーバーにファイルをアップロードする</title>
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <link media="all" rel="stylesheet" type="text/css" href="style.css"/>
 </head>
 <body class="docs"><div class="manualnavbar" style="text-align: center;">
 <div class="prev" style="text-align: left; float: left;"><a href="function.ftp-pasv.html">ftp_pasv</a></div>
 <div class="next" style="text-align: right; float: right;"><a href="function.ftp-pwd.html">ftp_pwd</a></div>
 <div class="up"><a href="ref.ftp.html">FTP 関数</a></div>
 <div class="home"><a href="index.html">PHP Manual</a></div>
</div><hr /><div id="function.ftp-put" class="refentry">
 <div class="refnamediv">
  <h1 class="refname">ftp_put</h1>
  <p class="verinfo">(PHP 4, PHP 5)</p><p class="refpurpose"><span class="refname">ftp_put</span> &mdash; <span class="dc-title">FTP サーバーにファイルをアップロードする</span></p>

 </div>
 <div class="refsect1 description" id="refsect1-function.ftp-put-description">
  <h3 class="title">説明</h3>
  <div class="methodsynopsis dc-description">
   <span class="type">bool</span> <span class="methodname"><strong>ftp_put</strong></span>
    ( <span class="methodparam"><span class="type">resource</span> <code class="parameter">$ftp_stream</code></span>
   , <span class="methodparam"><span class="type">string</span> <code class="parameter">$remote_file</code></span>
   , <span class="methodparam"><span class="type">string</span> <code class="parameter">$local_file</code></span>
   , <span class="methodparam"><span class="type">int</span> <code class="parameter">$mode</code></span>
   [, <span class="methodparam"><span class="type">int</span> <code class="parameter">$startpos</code><span class="initializer"> = 0</span></span>
  ] )</div>

  <p class="para rdfs-comment">
    <span class="function"><strong>ftp_put()</strong></span> ローカルファイルを FTP サーバーに保存します。
  </p>
 </div>

 <div class="refsect1 parameters" id="refsect1-function.ftp-put-parameters">
  <h3 class="title">パラメータ</h3>
  <p class="para">
   <dl>

    <dt>

     <span class="term"><em><code class="parameter">ftp_stream</code></em></span>
     <dd>

      <p class="para">
       FTP 接続のリンク ID 。
      </p>
     </dd>

    </dt>

    <dt>

     <span class="term"><em><code class="parameter">remote_file</code></em></span>
     <dd>

      <p class="para">
       リモートファイルのパス。
      </p>
     </dd>

    </dt>

    <dt>

     <span class="term"><em><code class="parameter">local_file</code></em></span>
     <dd>

      <p class="para">
       ローカルファイルのパス。
      </p>
     </dd>

    </dt>

    <dt>

     <span class="term"><em><code class="parameter">mode</code></em></span>
     <dd>

      <p class="para">
       転送モード。<strong><code>FTP_ASCII</code></strong> または
       <strong><code>FTP_BINARY</code></strong> のどちらかを指定する必要があります。
      </p>
     </dd>

    </dt>

    <dt>

     <span class="term"><em><code class="parameter">startpos</code></em></span>
     <dd>

      <p class="para">リモートファイル内での、アップロード開始位置。</p>
     </dd>

    </dt>

   </dl>

  </p>
 </div>

 <div class="refsect1 returnvalues" id="refsect1-function.ftp-put-returnvalues">
  <h3 class="title">返り値</h3>
  <p class="para">
   成功した場合に <strong><code>TRUE</code></strong> を、失敗した場合に <strong><code>FALSE</code></strong> を返します。
  </p>
 </div>

 <div class="refsect1 examples" id="refsect1-function.ftp-put-examples">
  <h3 class="title">例</h3>
  <p class="para">
   <div class="example" id="example-4278">
    <p><strong>例1  <span class="function"><strong>ftp_put()</strong></span> の例</strong></p>
    <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br />$file&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #DD0000">'somefile.txt'</span><span style="color: #007700">;<br /></span><span style="color: #0000BB">$remote_file&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #DD0000">'readme.txt'</span><span style="color: #007700">;<br /><br /></span><span style="color: #FF8000">//&nbsp;接続を確立する<br /></span><span style="color: #0000BB">$conn_id&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">ftp_connect</span><span style="color: #007700">(</span><span style="color: #0000BB">$ftp_server</span><span style="color: #007700">);<br /><br /></span><span style="color: #FF8000">//&nbsp;ユーザー名とパスワードでログインする<br /></span><span style="color: #0000BB">$login_result&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">ftp_login</span><span style="color: #007700">(</span><span style="color: #0000BB">$conn_id</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$ftp_user_name</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$ftp_user_pass</span><span style="color: #007700">);<br /><br /></span><span style="color: #FF8000">//&nbsp;ファイルをアップロードする<br /></span><span style="color: #007700">if&nbsp;(</span><span style="color: #0000BB">ftp_put</span><span style="color: #007700">(</span><span style="color: #0000BB">$conn_id</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$remote_file</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$file</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">FTP_ASCII</span><span style="color: #007700">))&nbsp;{<br />&nbsp;echo&nbsp;</span><span style="color: #DD0000">"successfully&nbsp;uploaded&nbsp;</span><span style="color: #0000BB">$file</span><span style="color: #DD0000">\n"</span><span style="color: #007700">;<br />}&nbsp;else&nbsp;{<br />&nbsp;echo&nbsp;</span><span style="color: #DD0000">"There&nbsp;was&nbsp;a&nbsp;problem&nbsp;while&nbsp;uploading&nbsp;</span><span style="color: #0000BB">$file</span><span style="color: #DD0000">\n"</span><span style="color: #007700">;<br />}<br /><br /></span><span style="color: #FF8000">//&nbsp;接続を閉じる<br /></span><span style="color: #0000BB">ftp_close</span><span style="color: #007700">(</span><span style="color: #0000BB">$conn_id</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
    </div>

   </div>
  </p>
 </div>

 <div class="refsect1 changelog" id="refsect1-function.ftp-put-changelog">
  <h3 class="title">変更履歴</h3>
  <p class="para">
   <table class="doctable informaltable">
    
     <thead>
      <tr>
       <th>バージョン</th>
       <th>説明</th>
      </tr>

     </thead>

     <tbody class="tbody">
      <tr>
       <td>4.3.0</td>
       <td>
        <em><code class="parameter">startpos</code></em> が追加されました。
       </td>
      </tr>

     </tbody>
    
   </table>

  </p>
 </div>

 <div class="refsect1 seealso" id="refsect1-function.ftp-put-seealso">
  <h3 class="title">参考</h3>
  <p class="para">
   <ul class="simplelist">
    <li class="member"> <span class="function"><a href="function.ftp-pasv.html" class="function" rel="rdfs-seeAlso">ftp_pasv()</a> - パッシブモードをオンまたはオフにする</span></li>
    <li class="member"> <span class="function"><a href="function.ftp-fput.html" class="function" rel="rdfs-seeAlso">ftp_fput()</a> - オープン中のファイルを FTP サーバーにアップロードする</span></li>
    <li class="member"> <span class="function"><a href="function.ftp-nb-fput.html" class="function" rel="rdfs-seeAlso">ftp_nb_fput()</a> - オープン中のファイルを FTP サーバーに保存する（非ブロッキング）</span></li>
    <li class="member"> <span class="function"><a href="function.ftp-nb-put.html" class="function" rel="rdfs-seeAlso">ftp_nb_put()</a> - FTP サーバーにファイルを保存する（非ブロッキング）</span></li>
   </ul>
  </p>
 </div>

</div><div id="usernotes">
 <div class="head">
  <h3 class="title">User Contributed Notes</h3>
 </div>
<div id="allnotes">  <a name="113226""></a>
  <div class="note">
   <strong class="user">donjajo at 2netlodge dot com</strong>
   <a href="#113226" class="date">15-Sep-2013 06:08</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
&lt;!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "<a href="http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd" rel="nofollow" target="_blank">http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd</a>"&gt;<br />
&lt;html xmlns="<a href="http://www.w3.org/1999/xhtml" rel="nofollow" target="_blank">http://www.w3.org/1999/xhtml</a>"&gt;<br />
&lt;head&gt;<br />
&lt;meta http-equiv="Content-Type" content="text/html; charset=utf-8" /&gt;<br />
&lt;title&gt;Simple FTP Upload Script using PHP by 2netlodge&lt;/title&gt;<br />
&lt;/head&gt;<br />
<br />
&lt;body&gt;<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">if(isset(</span><span class="default">$_POST</span><span class="keyword">[</span><span class="string">'ftp'</span><span class="keyword">]))<br />
&nbsp;&nbsp; &nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$ftp </span><span class="keyword">= </span><span class="default">$_POST</span><span class="keyword">[</span><span class="string">'ftp'</span><span class="keyword">];<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$username </span><span class="keyword">= </span><span class="default">$_POST</span><span class="keyword">[</span><span class="string">'username'</span><span class="keyword">];<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$pwd </span><span class="keyword">= </span><span class="default">$_POST</span><span class="keyword">[</span><span class="string">'pwd'</span><span class="keyword">];<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$filename </span><span class="keyword">= </span><span class="default">$_FILES</span><span class="keyword">[</span><span class="string">'file'</span><span class="keyword">][</span><span class="string">'name'</span><span class="keyword">];<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$tmp </span><span class="keyword">= </span><span class="default">$_FILES</span><span class="keyword">[</span><span class="string">'file'</span><span class="keyword">][</span><span class="string">'tmp_name'</span><span class="keyword">];<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$d </span><span class="keyword">= </span><span class="default">$_POST</span><span class="keyword">[</span><span class="string">'des'</span><span class="keyword">];<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$connect </span><span class="keyword">= </span><span class="default">ftp_connect</span><span class="keyword">(</span><span class="default">$ftp</span><span class="keyword">)or die(</span><span class="string">"Unable to connect to host"</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">ftp_login</span><span class="keyword">(</span><span class="default">$connect</span><span class="keyword">,</span><span class="default">$username</span><span class="keyword">,</span><span class="default">$pwd</span><span class="keyword">)or die(</span><span class="string">"Authorization Failed"</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; echo </span><span class="string">"Connected!&lt;br/&gt;"</span><span class="keyword">;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if(!</span><span class="default">$filename</span><span class="keyword">)<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; echo</span><span class="string">"Please select a file"</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; else<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">ftp_put</span><span class="keyword">(</span><span class="default">$connect</span><span class="keyword">,</span><span class="default">$d</span><span class="keyword">.</span><span class="string">'/'</span><span class="keyword">.</span><span class="default">$filename</span><span class="keyword">,</span><span class="default">$tmp</span><span class="keyword">,</span><span class="default">FTP_ASCII</span><span class="keyword">)or die(</span><span class="string">"Unable to upload"</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; echo</span><span class="string">"File successfully uploaded to FTP"</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <br />
</span><span class="default">?&gt;<br />
</span>&lt;form action="" method="post" enctype="multipart/form-data"&gt;<br />
&lt;input type="text" name="ftp" placeholder="FTP link"/&gt;&lt;br/&gt;<br />
&lt;input type="text" name="username" placeholder="Username"/&gt;&lt;br/&gt;<br />
&lt;input type="password" name="pwd" placeholder="Password"/&gt;&lt;br/&gt;<br />
&lt;input type="file" name="file" /&gt;&lt;br/&gt;<br />
&lt;input type="text" name="des" placeholder="Destination"&nbsp; /&gt;&lt;br/&gt;<br />
&lt;br/&gt;&lt;input type="submit" value="Upload"/&gt;&lt;/form&gt;<br />
<br />
&lt;/body&gt;<br />
&lt;/html&gt;</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="109824""></a>
  <div class="note">
   <strong class="user">Anonymous</strong>
   <a href="#109824" class="date">24-Aug-2012 09:59</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If you are getting the very helpful warnings...<br />
"Opening BINARY mode data connection" or<br />
"Opening ASCII mode data connection"<br />
<br />
... and have tried ftp_pasv, ftp_alloc, switching between FTP_ASCII or FTP_BINARY and blaming the FTP provider (like I did), try using ftp_close then ftp_connect to reset your FTP connection. Worked for me!</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="107887""></a>
  <div class="note">
   <strong class="user">Anonymous</strong>
   <a href="#107887" class="date">13-Mar-2012 07:28</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Hi !<br />
<br />
If you get this error when trying to send data to server :<br />
Warning: ftp_put() [function.ftp-put]: Unable to build data connection: Connection timed out...<br />
<br />
Two solutions :<br />
&nbsp;- Add the program httpd.exe in your exception list for external connexions of your firewall. Indeed, the FTP protocol open a new socket for data transfer. And this socket is opened from the server to the client (your computer). This program is located (for WAMP) in C:\wamp\bin\apache\Apache[version]\bin\<br />
&nbsp;- Use the ftp_pasv() function to activate the passive mode. In this mode, it is the client who open the new socket to the server.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="98289""></a>
  <div class="note">
   <strong class="user">lourspolair at banquiz dot net</strong>
   <a href="#98289" class="date">07-Jun-2010 12:05</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Hi,<br />
<br />
I try to upload one text file represente CSV with tab separator thru FTP connection.<br />
<br />
i'm using :<br />
ftp_put($connect_id, $fileFullName, $localFile, FTP_ASCII);<br />
<br />
everything goes fine, but txt file in destination server get white line between dataline...<br />
<br />
i try :<br />
ftp_put($connect_id, $fileFullName, $localFile, FTP_BINARY);<br />
and everything goes fine.<br />
<br />
so, lets do it in binary mode.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="98288""></a>
  <div class="note">
   <strong class="user">lousrpolair at banquiz dot net</strong>
   <a href="#98288" class="date">07-Jun-2010 12:05</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Hi,<br />
<br />
I try to upload one text file represente CSV with tab separator thru FTP connection.<br />
<br />
i'm using :<br />
ftp_put($connect_id, $fileFullName, $localFile, FTP_ASCII);<br />
<br />
everything goes fine, but txt file in destination server get white line between dataline...<br />
<br />
i try :<br />
ftp_put($connect_id, $fileFullName, $localFile, FTP_BINARY);<br />
and everything goes fine.<br />
<br />
so, lets do it in binary mode.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="96726""></a>
  <div class="note">
   <strong class="user">JDD</strong>
   <a href="#96726" class="date">13-Mar-2010 03:22</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
In case you aren't aware...&nbsp; Some web hosting services do NOT allow outbound ftp unless you have a dedicated server account.&nbsp; A "shared" hosting account often doesn't have this capability.&nbsp; &nbsp; <br />
<br />
So if you can't get your ftp, curl, or ssh remote file transfer functions to work, check with the host service and ask.&nbsp; You may have to upgrade your account.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="96477""></a>
  <div class="note">
   <strong class="user">Svinto</strong>
   <a href="#96477" class="date">01-Mar-2010 01:58</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I [had an error for which] ftp_pasv didnt solve the problem. Here's why:<br />
<br />
FTP uses 2 connections on different ports, one for connection/handshake and another for data transfer.<br />
The problem was that the ftp-server (that php was connecting to) also used different IP-addresses for the different connections (say what!?).<br />
Normally the firewall (csf) detects ftp-connections and allows them through but because of the different IP-adresses this didn't work.<br />
<br />
Solution:<br />
1 angry mail to the ftp server owner.<br />
Allowing the second IP in the firewall.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="91933""></a>
  <div class="note">
   <strong class="user">bintjes at gmail dot com</strong>
   <a href="#91933" class="date">02-Jul-2009 10:51</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I've seen two notes about a "ftp_copy" function but i think&nbsp;&nbsp; there's a misinterpretation about what an "ftp_copy" function should do. For me , it should be something like an ftp_rename that would keep the orginal file and clone it somewhere else on the same ftp server, as for them they consider its purpose is to copy a local file to a distant ftp ..well .. as in FTP protocol there's no such thing as an FTP COPY&nbsp; command anyway, i think you're free to interpret it as you want. <br />
So here's my solution using ftp_put and ftp_get ..<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="comment">// bool ftp_copy&nbsp; ( resource $ftp_stream&nbsp; , string $initialpath, string $newpath, string $imagename )<br />
</span><span class="keyword">function </span><span class="default">ftp_copy</span><span class="keyword">(</span><span class="default">$conn_distant </span><span class="keyword">, </span><span class="default">$pathftp </span><span class="keyword">, </span><span class="default">$pathftpimg </span><span class="keyword">,</span><span class="default">$img</span><span class="keyword">){<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// on recupere l'image puis on la repose dans le nouveau folder<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">if(</span><span class="default">ftp_get</span><span class="keyword">(</span><span class="default">$conn_distant</span><span class="keyword">, </span><span class="default">TEMPFOLDER</span><span class="keyword">.</span><span class="default">$img</span><span class="keyword">, </span><span class="default">$pathftp</span><span class="keyword">.</span><span class="string">'/'</span><span class="keyword">.</span><span class="default">$img </span><span class="keyword">,</span><span class="default">FTP_BINARY</span><span class="keyword">)){<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if(</span><span class="default">ftp_put</span><span class="keyword">(</span><span class="default">$conn_distant</span><span class="keyword">, </span><span class="default">$pathftpimg</span><span class="keyword">.</span><span class="string">'/'</span><span class="keyword">.</span><span class="default">$img </span><span class="keyword">,</span><span class="default">TEMPFOLDER</span><span class="keyword">.</span><span class="default">$img </span><span class="keyword">, </span><span class="default">FTP_BINARY</span><span class="keyword">)){<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">unlink</span><span class="keyword">(</span><span class="default">TEMPFOLDER</span><span class="keyword">.</span><span class="default">$img</span><span class="keyword">) ;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; } else{&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">false</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }else{<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">false </span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; } <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">true </span><span class="keyword">; <br />
}<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="90518""></a>
  <div class="note">
   <strong class="user">Anonymous</strong>
   <a href="#90518" class="date">26-Apr-2009 04:51</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If when using ftp_put you get the one of the following errors:<br />
<br />
Warning: ftp_put() [function.ftp-put]: Opening ASCII mode data connection<br />
<br />
Warning: ftp_put() [function.ftp-put]: Opening BINARY mode data connection<br />
<br />
and it creates the file in the correct location but is a 0kb file and all FTP commands thereafter fail. It is likely that the client is behind a firewall. To rectify this use:<br />
<br />
<span class="default">&lt;?php<br />
ftp_pasv</span><span class="keyword">(</span><span class="default">$resource</span><span class="keyword">, </span><span class="default">true</span><span class="keyword">);<br />
</span><span class="default">?&gt;<br />
</span><br />
Before executing any put commands. Took me so long to figure this out I actually cheered when I did :D</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="89986""></a>
  <div class="note">
   <strong class="user">Kev</strong>
   <a href="#89986" class="date">01-Apr-2009 05:36</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Got this cryptic error<br />
<br />
Warning:&nbsp; ftp_put() [function.ftp-put]: 'STOR' not understood in <br />
C:\wamp\www\kevtest\ftp_todays.php on line 48<br />
<br />
Found the prob, you can't put a path to the destination file<br />
(even though I can do that in the dos ftp client...?)<br />
<br />
e.g. - this doesn't work<br />
ftp_put($conn, '/www/site/file.html','c:/wamp/www/site/file.html',FTP_BINARY);<br />
<br />
you have to put<br />
<br />
<span class="default">&lt;?php<br />
ftp_chdir</span><span class="keyword">(</span><span class="default">$conn</span><span class="keyword">, </span><span class="string">'/www/site/'</span><span class="keyword">);<br />
</span><span class="default">ftp_put</span><span class="keyword">(</span><span class="default">$conn</span><span class="keyword">,</span><span class="string">'file.html'</span><span class="keyword">, </span><span class="string">'c:/wamp/www/site/file.html'</span><span class="keyword">, </span><span class="default">FTP_BINARY </span><span class="keyword">);<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="83308""></a>
  <div class="note">
   <strong class="user">emailfire at gmail dot com</strong>
   <a href="#83308" class="date">20-May-2008 12:45</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Took me forever to work out but this will work if you get the paths right!<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">function </span><span class="default">ftp_copy</span><span class="keyword">(</span><span class="default">$file</span><span class="keyword">) {<br />
global </span><span class="default">$conn_id</span><span class="keyword">;<br />
</span><span class="default">$ftp_root </span><span class="keyword">= </span><span class="string">'/public_html/'</span><span class="keyword">;<br />
</span><span class="default">$site_root </span><span class="keyword">= </span><span class="string">'/home/usr/public_html/'</span><span class="keyword">;<br />
return </span><span class="default">ftp_put</span><span class="keyword">(</span><span class="default">$conn_id</span><span class="keyword">, </span><span class="default">$ftp_root </span><span class="keyword">. </span><span class="default">$file</span><span class="keyword">, </span><span class="default">$site_root </span><span class="keyword">. </span><span class="default">$file</span><span class="keyword">, </span><span class="default">FTP_BINARY</span><span class="keyword">);<br />
}<br />
</span><span class="default">?&gt;<br />
</span><br />
Login to your site using an FTP client to retrieve the $ftp_root<br />
<br />
Use something like getcwd() to get the $site root</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="83260""></a>
  <div class="note">
   <strong class="user">florian dot ember at gmail dot com</strong>
   <a href="#83260" class="date">17-May-2008 05:08</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Currently, there is no function that lets you specifiy the file's contents as a string. However, there is ftp_fput(), which operates on an open file. Using this function in conjunction with tmpfile() lets you emulate this kind of function. (You could also use php://memory, but this breaks BC).<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">function </span><span class="default">ftp_fputs</span><span class="keyword">(</span><span class="default">$ftp_stream</span><span class="keyword">, </span><span class="default">$remote_file</span><span class="keyword">, </span><span class="default">$contents</span><span class="keyword">, </span><span class="default">$mode</span><span class="keyword">, </span><span class="default">$startpos </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">)<br />
{<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$tmp </span><span class="keyword">= </span><span class="default">tmpfile</span><span class="keyword">();<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">fwrite</span><span class="keyword">(</span><span class="default">$tmp</span><span class="keyword">, </span><span class="default">$contents</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">rewind</span><span class="keyword">(</span><span class="default">$tmp</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$result </span><span class="keyword">= </span><span class="default">ftp_fput</span><span class="keyword">(</span><span class="default">$ftp_stream</span><span class="keyword">, </span><span class="default">$remote_file</span><span class="keyword">, </span><span class="default">$tmp</span><span class="keyword">, </span><span class="default">$mode</span><span class="keyword">, </span><span class="default">$startpos</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">fclose</span><span class="keyword">(</span><span class="default">$tmp</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; return </span><span class="default">$result</span><span class="keyword">;<br />
}<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="82059""></a>
  <div class="note">
   <strong class="user">Aditya P Bhatt (adityabhai at gmail dot com)</strong>
   <a href="#82059" class="date">26-Mar-2008 12:18</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Here is the Code I am using for the same function with more flexibility in static code:<br />
&lt;?<br />
$name = "FILE NAME";<br />
$filename = "FILE NAME WITH FULL PATH";<br />
<br />
//-- Code to Transfer File on Server Dt: 06-03-2008 by Aditya Bhatt --//<br />
//-- Connection Settings<br />
$ftp_server = "IP ADDRESS"; // Address of FTP server.<br />
$ftp_user_name = " SERVER USERNAME"; // Username<br />
$ftp_user_pass = " SERVER PASSWORD"; // Password<br />
$destination_file = " SERVER FILE PATH TO UPLOAD VIA FTP_PUT"; //where you want to throw the file on the webserver (relative to your login dir)<br />
<br />
$conn_id = ftp_connect($ftp_server) or die("&lt;span style='color:#FF0000'&gt;&lt;h2&gt;Couldn't connect to $ftp_server&lt;/h2&gt;&lt;/span&gt;");&nbsp; &nbsp; &nbsp; &nbsp; // set up basic connection<br />
<br />
$login_result = ftp_login($conn_id, $ftp_user_name, $ftp_user_pass) or die("&lt;span style='color:#FF0000'&gt;&lt;h2&gt;You do not have access to this ftp server!&lt;/h2&gt;&lt;/span&gt;");&nbsp;&nbsp; // login with username and password, or give invalid user message<br />
<br />
if ((!$conn_id) || (!$login_result)) {&nbsp; // check connection<br />
&nbsp;&nbsp;&nbsp; // wont ever hit this, b/c of the die call on ftp_login<br />
&nbsp;&nbsp;&nbsp; echo "&lt;span style='color:#FF0000'&gt;&lt;h2&gt;FTP connection has failed! &lt;br /&gt;";<br />
&nbsp;&nbsp;&nbsp; echo "Attempted to connect to $ftp_server for user $ftp_user_name&lt;/h2&gt;&lt;/span&gt;";<br />
&nbsp;&nbsp;&nbsp; exit;<br />
} else {<br />
&nbsp;&nbsp;&nbsp; //echo "Connected to $ftp_server, for user $ftp_user_name &lt;br /&gt;";<br />
}<br />
<br />
$upload = ftp_put($conn_id, $destination_file.$name, $filename, FTP_BINARY);&nbsp; // upload the file<br />
if (!$upload) {&nbsp; // check upload status<br />
&nbsp;&nbsp;&nbsp; echo "&lt;span style='color:#FF0000'&gt;&lt;h2&gt;FTP upload of $filename has failed!&lt;/h2&gt;&lt;/span&gt; &lt;br /&gt;";<br />
} else {<br />
&nbsp;&nbsp;&nbsp; echo "&lt;span style='color:#339900'&gt;&lt;h2&gt;Uploading $name Completed Successfully!&lt;/h2&gt;&lt;/span&gt;&lt;br /&gt;&lt;br /&gt;";<br />
}<br />
ftp_close($conn_id); // close the FTP stream&nbsp; &nbsp; <br />
?&gt;</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="79881""></a>
  <div class="note">
   <strong class="user">dherran at gmail dot com</strong>
   <a href="#79881" class="date">17-Dec-2007 09:01</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If you are moving files from one folder to another inside the same server, the "local file" field has to be indicated in a relative path according to the location of the script running the ftp_put() function.<br />
<br />
For example, your function is running on: /public_html/do_ftp.php and you want to move /public_html/products.php to /public_html/backup/products.php<br />
<br />
The correct way to build the function would be:<br />
<br />
ftp_put($ftp_id, '/public_html/backup/products.php', 'products.php', FTP_ASCII);<br />
<br />
After having headaches for 2 days trying to make this function work using absolute paths in both fields, I finally found the right way to use it. I hope it helps someone. Excuse my english, it isn't my native language.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="76462""></a>
  <div class="note">
   <strong class="user">Ari</strong>
   <a href="#76462" class="date">17-Jul-2007 08:30</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I'm copying fairly large backup files from server to server. ftp_put was running fine for awhile until it occasionally began reporting errors.<br />
When I set TRUE as the value for the ftp_pasv () (after login), ftp_put started working again.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="75097""></a>
  <div class="note">
   <strong class="user">todd</strong>
   <a href="#75097" class="date">12-May-2007 08:26</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
This is an extremely trivial thing but one that had me stumped forever (well, until I decided to check the error logs and see the error). I had a large file (mysql backup of a huge forum) that was only partially being uploaded to a remote backup server. Couldn't figure out why, until I realized that the max execution time was being hit since it was taking longer than 30 seconds to upload this file. <br />
<br />
<span class="default">&lt;?php<br />
set_time_limit</span><span class="keyword">(</span><span class="default">0</span><span class="keyword">);<br />
</span><span class="default">rest of the code here</span><span class="keyword">....<br />
</span><span class="default">?&gt;<br />
</span><br />
That did the trick. It's one of those dumb, trivial things, and if you're having trouble like I, it may be something you overlooked.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="73168""></a>
  <div class="note">
   <strong class="user">koen dot depoorter at gmail dot com</strong>
   <a href="#73168" class="date">12-Feb-2007 01:24</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If you are having timeouts uploading a file, even very small files, you might have a look at ftp_pasv()<br />
<br />
And don't forget to do it after your ftp_login();<br />
<br />
koen</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="59918""></a>
  <div class="note">
   <strong class="user">tom pittlik</strong>
   <a href="#59918" class="date">20-Dec-2005 11:25</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
ftp_put() can display confusing warning messages as it returns one line of the remote server's response which may be multi lined.<br />
<br />
If you're transferring large amounts of files note that some file systems only support up to 2000 files per directory. This had me stumped for a while.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="56162""></a>
  <div class="note">
   <strong class="user">ben at over dot bomb</strong>
   <a href="#56162" class="date">25-Aug-2005 02:28</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I spent some time debugging a silly problem:<br />
<br />
In php &gt;= 5, ftp_put() will apparently rewind to the start of the file regardless of the state you left it in before sending it to the $host.<br />
<br />
I found this out because I wasn't closing the file handle before using ftp_put(). Since I had just written to the file, the file pointer must have been located at the *bottom*.<br />
<br />
I was sending a 0-byte file on php 4.2.2., but worked fine on php 5.<br />
<br />
So, just a heads up, don't forget to close those filehandles. Even though I was using the filename as the argument for ftp_put, it still needs to be closed. <br />
<br />
I did not call rewind on the file handle, just fclose($file_h).</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="54827""></a>
  <div class="note">
   <strong class="user">Icy_Tiger_2000 at yahoo dot com dot au</strong>
   <a href="#54827" class="date">16-Jul-2005 10:35</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I had a little trouble getting the ftp_put to work, because of that particular server.&nbsp; All variables and data parsed from the previous web form had to be retreived using $_POST, $_GET or $_FILES.<br />
<br />
If you don't know what you sent use phpinfo(); to display what the server thinks about your data.<br />
<br />
so...when sending files using a form and PHP, make sure that all the data (text files etc...) are retreived with $_POST, and files (smiley.png, compression.zip, etc...) are retreived with $_FILES.<br />
<br />
here's what your start of a results.php file might look like:<br />
<span class="default">&lt;?PHP<br />
&nbsp;&nbsp; $myName </span><span class="keyword">= </span><span class="default">$_POST</span><span class="keyword">[</span><span class="string">'name'</span><span class="keyword">]; </span><span class="comment">//This will copy the text into a variable<br />
&nbsp;&nbsp; </span><span class="default">$myFile </span><span class="keyword">= </span><span class="default">$_FILES</span><span class="keyword">[</span><span class="string">'file_name'</span><span class="keyword">]; </span><span class="comment">// This will make an array out of the file information that was stored.<br />
</span><span class="default">?&gt;<br />
</span><br />
Now when it comes to transmitting that information...<br />
<br />
<span class="default">&lt;?PHP<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $destination_path </span><span class="keyword">= </span><span class="string">"src/bin/"</span><span class="keyword">; <br />
<br />
</span><span class="comment">//where you want to throw the file on the webserver (relative to your login dir)<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$destination_file </span><span class="keyword">= </span><span class="default">$destination_path</span><span class="keyword">.</span><span class="string">"img.jpg"</span><span class="keyword">;<br />
<br />
</span><span class="comment">//This will create a full path with the file on the end for you to&nbsp; use, I like splitting the variables like this in case I need to use on on their own or if I'm dynamically creating new folders.<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$file </span><span class="keyword">= </span><span class="default">$myFile</span><span class="keyword">[</span><span class="string">'tmp_name'</span><span class="keyword">];<br />
<br />
</span><span class="comment">//Converts the array into a new string containing the path name on the server where your file is.<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$upload </span><span class="keyword">= </span><span class="default">ftp_put</span><span class="keyword">(</span><span class="default">$conn_id</span><span class="keyword">, </span><span class="default">$destination_file</span><span class="keyword">, </span><span class="default">$file</span><span class="keyword">, </span><span class="default">FTP_BINARY</span><span class="keyword">);</span><span class="comment">// upload the file<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">if (!</span><span class="default">$upload</span><span class="keyword">) {</span><span class="comment">// check upload status<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">echo </span><span class="string">"FTP upload of </span><span class="default">$destination_file</span><span class="string"> has failed!"</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; } else {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; echo </span><span class="string">"Uploaded </span><span class="default">$file</span><span class="string"> to </span><span class="default">$conn_id</span><span class="string"> as </span><span class="default">$destination_file</span><span class="string">"</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }<br />
</span><span class="default">?&gt;<br />
</span><br />
hope this is usefull ^_^</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="54606""></a>
  <div class="note">
   <strong class="user">webmaster at sweetphp dot com</strong>
   <a href="#54606" class="date">09-Jul-2005 02:54</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Here is a fix for the function from lucas at rufy dot com below that will recursively put files from a source directory to a destination directory.&nbsp; As written below, it won't put a file in a directory that already exists, because the the destination is altered.&nbsp; So here is the corrected function that will allow it to work:<br />
<br />
function ftp_putAll($conn_id, $src_dir, $dst_dir) {<br />
&nbsp;&nbsp; $d = dir($src_dir);<br />
&nbsp;&nbsp; while($file = $d-&gt;read()) { // do this for each file in the directory<br />
&nbsp;&nbsp; &nbsp; &nbsp; if ($file != "." &amp;&amp; $file != "..") { // to prevent an infinite loop<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if (is_dir($src_dir."/".$file)) { // do the following if it is a directory<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if (!@ftp_nlist($conn_id, $dst_dir."/".$file)) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ftp_mkdir($conn_id, $dst_dir."/".$file); // create directories that do not yet exist<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ftp_putAll($conn_id, $src_dir."/".$file, $dst_dir."/".$file); // recursive part<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; } else {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $upload = ftp_put($conn_id, $dst_dir."/".$file, $src_dir."/".$file, FTP_BINARY); // put the files<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; }<br />
&nbsp;&nbsp; }<br />
&nbsp;&nbsp; $d-&gt;close();<br />
}</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="54278""></a>
  <div class="note">
   <strong class="user">jrisken at mn dot rr dot com</strong>
   <a href="#54278" class="date">29-Jun-2005 03:32</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
This solution to a common problem is implied elsewhere, but I thought it might be useful to put it all in one place (since I spent hours piecing it together!)<br />
<br />
Sometimes a web host will open PHP sessions with a user of 'nobody'. Files created by this user may not have the correct permissions to allow&nbsp; management of those files by the actual owner of the site.&nbsp; The following script allows the actual owner to open access to a directory so that 'nobody' can create a file using fopen(). Then using the handle created by 'nobody', the ftp_fput() command saves the file with the correct owner.&nbsp; The file 'nobody' created is discarded.<br />
&lt;?<br />
&nbsp;&nbsp;&nbsp; $connection = ftp_connect($ftpServer);<br />
&nbsp;&nbsp;&nbsp; ftp_login($connection, $ftpUser, $ftpPass);<br />
&nbsp;&nbsp;&nbsp; ftp_chdir($connection, $ftpDir);<br />
&nbsp;&nbsp;&nbsp; // open the directory so that 'nobody' can create a temporary file&nbsp; &nbsp; <br />
&nbsp;&nbsp;&nbsp; ftp_site($cn, "CHMOD 777 $ftpDir");<br />
&nbsp;&nbsp;&nbsp; $new="tempFile";<br />
&nbsp;&nbsp;&nbsp; @unlink($new); // just in case<br />
&nbsp;&nbsp;&nbsp; $handle=fopen($new,"x");<br />
&nbsp;&nbsp;&nbsp; chmod($new,0777);<br />
&nbsp;&nbsp;&nbsp; fputs($handle,"a bunch of stuff...");<br />
&nbsp;&nbsp;&nbsp; fclose($handle); // have to rewind <br />
&nbsp;&nbsp;&nbsp; $handle=fopen("tempFile","r");<br />
&nbsp;&nbsp;&nbsp; ftp_fput($connection, "finalFile", $handle, FTP_ASCII);<br />
&nbsp;&nbsp;&nbsp; fclose($handle);<br />
&nbsp;&nbsp;&nbsp; unlink($new);<br />
&nbsp;&nbsp;&nbsp; // remove open access to the directory<br />
&nbsp;&nbsp;&nbsp; ftp_site($connection, "CHMOD 755 $ftpDir")<br />
&nbsp;&nbsp;&nbsp; ftp_close($connection);<br />
?&gt;</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="43325""></a>
  <div class="note">
   <strong class="user">herok at atwatcher dot com</strong>
   <a href="#43325" class="date">17-Jun-2004 07:59</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
victor at nobel dot com dot br wrote that<br />
the correct dirpath format excluded "/home/USER/" from the public path, but for my server, i had to use it in order to get my scripts to work.<br />
<br />
it may be obvious to most but I'm positing that you cannot use the $_SERVER['DOCUMENT_ROOT'] path since FTP starts at your top-level and therefore bypasses (or just plain doesn't recognize) most of the virtual server pathing.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="36048""></a>
  <div class="note">
   <strong class="user">Saeven</strong>
   <a href="#36048" class="date">24-Sep-2003 06:43</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
if you examine the first user submitted function, ftp_putAll, it will work only if you extract this line and its matching bracket.<br />
<br />
if (!@ftp_chdir($conn_id, $dst_dir."/".$file))<br />
<br />
The function will have changed into that directory before having uploaded files to it.&nbsp; This alters your upload path and the system will try to upload into an essentially non-existent directory (duped at the end).<br />
<br />
Hope this helps some of you.<br />
Cheers.<br />
Saeven</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="34688""></a>
  <div class="note">
   <strong class="user">lucas at rufy dot com</strong>
   <a href="#34688" class="date">04-Aug-2003 10:45</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
The following is a fully tested function (based on a previous note) that recursively puts files from a source directory to a destination directory. See <a href="http://rufy.com/tech/archives/000026.html for more information." rel="nofollow" target="_blank">http://rufy.com/tech/archives/000026.html for more information.</a><br />
<br />
NOTE: use full path name for the destination directory and the destination directory must already exist<br />
<br />
function ftp_putAll($conn_id, $src_dir, $dst_dir) {<br />
&nbsp;&nbsp;&nbsp; $d = dir($src_dir);<br />
&nbsp;&nbsp;&nbsp; while($file = $d-&gt;read()) { // do this for each file in the directory<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if ($file != "." &amp;&amp; $file != "..") { // to prevent an infinite loop<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if (is_dir($src_dir."/".$file)) { // do the following if it is a directory<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if (!@ftp_chdir($conn_id, $dst_dir."/".$file)) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; ftp_mkdir($conn_id, $dst_dir."/".$file); // create directories that do not yet exist<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; ftp_putAll($conn_id, $src_dir."/".$file, $dst_dir."/".$file); // recursive part<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; } else {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $upload = ftp_put($conn_id, $dst_dir."/".$file, $src_dir."/".$file, FTP_BINARY); // put the files<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; $d-&gt;close();<br />
}</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="29177""></a>
  <div class="note">
   <strong class="user">darian lassan at yahoo de</strong>
   <a href="#29177" class="date">05-Feb-2003 01:06</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
ftp_put() overwrites existing files. <br />
Again: trivial but not mentioned here.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="25477""></a>
  <div class="note">
   <strong class="user">oheil at ecc-gmbh dot de</strong>
   <a href="#25477" class="date">25-Sep-2002 02:43</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If you want to copy a whole directory tree (with subdiretories), <br />
this function (ftp_copy) might be usefull. Tested with <br />
php 4.2.2 and a Linux OS. <br />
<br />
Example:<br />
----------------------------------------------------------------<br />
$conn_id = ftp_connect("server_adress"); <br />
...<br />
<br />
$src_dir = "/from";<br />
$dst_dir = "/to";<br />
<br />
ftp_copy($src_dir, $dst_dir);<br />
...<br />
ftp_close($conn_id)<br />
<br />
Function: ftp_copy()<br />
----------------------------------------------------------------<br />
function ftp_copy($src_dir, $dst_dir) {<br />
<br />
global $conn_id;<br />
<br />
$d = dir($src_dir);<br />
<br />
&nbsp;&nbsp;&nbsp; while($file = $d-&gt;read()) {<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if ($file != "." &amp;&amp; $file != "..") {<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if (is_dir($src_dir."/".$file)) {<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if (!@ftp_chdir($conn_id, $dst_dir."/".$file)) {<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; ftp_mkdir($conn_id, $dst_dir."/".$file);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; ftp_copy($src_dir."/".$file, $dst_dir."/".$file);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; else {<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $upload = ftp_put($conn_id, $dst_dir."/".$file, $src_dir."/".$file, FTP_BINARY);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; }<br />
<br />
$d-&gt;close();<br />
}</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="24783""></a>
  <div class="note">
   <strong class="user">kiwo1 at yahoo dot com</strong>
   <a href="#24783" class="date">28-Aug-2002 07:05</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Friends,<br />
If you wanna upload files from your harddisk by a form to a specified ftp this sample can help you...<br />
First of all create the form:<br />
&lt;html&gt;<br />
<br />
&lt;body marginwidth=4 marginheight=4 topmargin=4 leftmargin=4 bgcolor=white vlink="#0000ff" link="#0000ff"&gt;<br />
<br />
&lt;form name="Attachments"&nbsp; method=POST action="sendimage.php" enctype="multipart/form-data"&gt;<br />
<br />
&lt;input type=hidden name=box value=""&gt;<br />
<br />
&lt;tr&gt;<br />
&lt;td nowrap width="1%"&gt;&amp;nbsp;&amp;nbsp;&lt;b&gt;Image:&lt;/b&gt;&lt;/td&gt;<br />
&lt;td colspan=2&gt;<br />
&lt;input type=file name=source_file size=20&gt; &lt;br&gt;<br />
<br />
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;<br />
<br />
&lt;/td&gt;<br />
&lt;/tr&gt;<br />
&lt;input type=submit name=btnSubmit value=Submit size=20 style="border: 1px solid #0000FF"&gt;&lt;/form&gt;<br />
&lt;/body&gt;<br />
&lt;/html&gt;<br />
<br />
The critical point in this form is the usage of&nbsp; enctype="multipart/form-data"<br />
If you don't use this part your upload operations won't work.<br />
Then u must create sendimage.php as follows:<br />
<br />
<span class="default">&lt;?php<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; $ftp_server</span><span class="keyword">=</span><span class="string">'190.148.20.201'</span><span class="keyword">;</span><span class="comment">//serverip<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$conn_id </span><span class="keyword">= </span><span class="default">ftp_connect</span><span class="keyword">(</span><span class="default">$ftp_server</span><span class="keyword">); <br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">// login with username and password<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$user</span><span class="keyword">=</span><span class="string">"username"</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$passwd</span><span class="keyword">=</span><span class="string">"*****"</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$login_result </span><span class="keyword">= </span><span class="default">ftp_login</span><span class="keyword">(</span><span class="default">$conn_id</span><span class="keyword">, </span><span class="default">$user</span><span class="keyword">, </span><span class="default">$passwd</span><span class="keyword">); <br />
<br />
</span><span class="comment">// check connection<br />
&nbsp;&nbsp; </span><span class="keyword">if ((!</span><span class="default">$conn_id</span><span class="keyword">) || (!</span><span class="default">$login_result</span><span class="keyword">)) { <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; echo </span><span class="string">"FTP connection has failed!"</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; echo </span><span class="string">"Attempted to connect to </span><span class="default">$ftp_server</span><span class="string"> for user </span><span class="default">$ftp_user_name</span><span class="string">"</span><span class="keyword">; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; die; <br />
&nbsp;&nbsp;&nbsp; } else {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; echo </span><span class="string">"&lt;br&gt;Connected to </span><span class="default">$ftp_server</span><span class="string">, for user </span><span class="default">$user</span><span class="string">&lt;br&gt;"</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }<br />
</span><span class="comment">//directorylike /www.velibaba.com/images<br />
&nbsp; </span><span class="default">ftp_chdir</span><span class="keyword">(</span><span class="default">$conn_id</span><span class="keyword">, </span><span class="string">"www.velibab.com"</span><span class="keyword">);<br />
&nbsp; </span><span class="default">ftp_chdir</span><span class="keyword">(</span><span class="default">$conn_id</span><span class="keyword">, </span><span class="string">"compimages"</span><span class="keyword">);<br />
<br />
</span><span class="comment">//$destination_file=ftp_pwd($conn_id);<br />
<br />
</span><span class="default">$destination_file</span><span class="keyword">=</span><span class="string">"x.jpg"</span><span class="keyword">;<br />
echo (</span><span class="string">"&lt;br&gt;"</span><span class="keyword">);<br />
print </span><span class="default">$destination_file</span><span class="keyword">;<br />
<br />
echo (</span><span class="string">"&lt;br&gt;"</span><span class="keyword">);<br />
<br />
</span><span class="comment">// upload the file<br />
</span><span class="default">$upload </span><span class="keyword">= </span><span class="default">ftp_put</span><span class="keyword">(</span><span class="default">$conn_id</span><span class="keyword">, </span><span class="default">$destination_file</span><span class="keyword">, </span><span class="default">$source_file</span><span class="keyword">, </span><span class="default">FTP_BINARY</span><span class="keyword">); <br />
<br />
</span><span class="comment">// check upload status<br />
</span><span class="keyword">if (!</span><span class="default">$upload</span><span class="keyword">) { <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; echo </span><span class="string">"FTP upload has failed!"</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; } else {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; echo </span><span class="string">"Uploaded </span><span class="default">$source_file</span><span class="string"> to </span><span class="default">$ftp_server</span><span class="string"> as </span><span class="default">$destination_file</span><span class="string">"</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }<br />
<br />
</span><span class="comment">// close the FTP stream <br />
</span><span class="default">ftp_close</span><span class="keyword">(</span><span class="default">$conn_id</span><span class="keyword">); <br />
</span><span class="default">?&gt;<br />
</span><br />
In this example code $source_file is the path of the file in your disk, and destination file is the name of the uploaded file in ftpserver.<br />
In this code I use ftp_chdir to give the path of the<br />
&nbsp;uploaded file within ftpserver..<br />
For your questions about all categories of PHP my email:kiwo1@yahoo.com<br />
c u...</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="13728""></a>
  <div class="note">
   <strong class="user">clambert at whitecrown dot net</strong>
   <a href="#13728" class="date">30-Jun-2001 04:24</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
When using versions of PHP below 4.04b4, the ftp_put command doesn't work on NT/IIS4. Most of the other functions will work, but there was a bug while trying to send upstream data to an IIS webserver.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
</div>
</div>
<hr /><div class="manualnavbar" style="text-align: center;">
 <div class="prev" style="text-align: left; float: left;"><a href="function.ftp-pasv.html">ftp_pasv</a></div>
 <div class="next" style="text-align: right; float: right;"><a href="function.ftp-pwd.html">ftp_pwd</a></div>
 <div class="up"><a href="ref.ftp.html">FTP 関数</a></div>
 <div class="home"><a href="index.html">PHP Manual</a></div>
</div></body></html>
