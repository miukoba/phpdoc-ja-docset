<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
 <head>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <title>全ての結果行を含む配列を返す</title>
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <link media="all" rel="stylesheet" type="text/css" href="style.css"/>
 </head>
 <body class="docs"><div class="manualnavbar" style="text-align: center;">
 <div class="prev" style="text-align: left; float: left;"><a href="pdostatement.fetch.html">PDOStatement::fetch</a></div>
 <div class="next" style="text-align: right; float: right;"><a href="pdostatement.fetchcolumn.html">PDOStatement::fetchColumn</a></div>
 <div class="up"><a href="class.pdostatement.html">PDOStatement</a></div>
 <div class="home"><a href="index.html">PHP Manual</a></div>
</div><hr /><div id="pdostatement.fetchall" class="refentry">
 <div class="refnamediv">
  <h1 class="refname">PDOStatement::fetchAll</h1>
  <p class="verinfo">(PHP 5 &gt;= 5.1.0, PECL pdo &gt;= 0.1.0)</p><p class="refpurpose"><span class="refname">PDOStatement::fetchAll</span> &mdash; <span class="dc-title">
   全ての結果行を含む配列を返す
  </span></p>

 </div>
 <div class="refsect1 description" id="refsect1-pdostatement.fetchall-description">
  <h3 class="title">説明</h3>
  <div class="methodsynopsis dc-description">
   <span class="modifier">public</span> <span class="type">array</span> <span class="methodname"><strong>PDOStatement::fetchAll</strong></span>
    ([ <span class="methodparam"><span class="type">int</span> <code class="parameter">$fetch_style</code></span>
   [, <span class="methodparam"><span class="type"><a href="language.pseudo-types.html#language.types.mixed" class="type mixed">mixed</a></span> <code class="parameter">$fetch_argument</code></span>
   [, <span class="methodparam"><span class="type">array</span> <code class="parameter">$ctor_args</code><span class="initializer"> = array()</span></span>
  ]]] )</div>


 </div>


 <div class="refsect1 parameters" id="refsect1-pdostatement.fetchall-parameters">
  <h3 class="title">パラメータ</h3>
  <p class="para">
   <dl>

    <dt>

     <span class="term"><em><code class="parameter">fetch_style</code></em></span>
     <dd>

      <p class="para">
        <span class="function"><a href="pdostatement.fetch.html" class="function">PDOStatement::fetch()</a></span> に文章化されているような
       返される配列の内容を制御します。
       デフォルトは <strong><code>PDO::ATTR_DEFAULT_FETCH_MODE</code></strong> の値
       (そのデフォルトは <strong><code>PDO::FETCH_BOTH</code></strong>) です。
      </p>
      <p class="para">
       結果セットから単一カラムの全ての値を含む配列を返す場合、
       <strong><code>PDO::FETCH_COLUMN</code></strong> を指定します。
       <em><code class="parameter">column-index</code></em> パラメータにどのカラムを返すかを
       指定することができます。
      </p>
      <p class="para">
       結果セットから単一カラムの一意な値のみ取得する場合、
       <strong><code>PDO::FETCH_UNIQUE</code></strong> をビット OR した
       <strong><code>PDO::FETCH_COLUMN</code></strong> を指定します。
      </p>
      <p class="para">
       指定したカラムの値によってグループ化した連想配列を返す場合、
       <strong><code>PDO::FETCH_GROUP</code></strong> をビット OR した
       <strong><code>PDO::FETCH_COLUMN</code></strong> を指定します。
      </p>
     </dd>

    </dt>

    <dt>

     <span class="term"><em><code class="parameter">fetch_argument</code></em></span>
     <dd>

      <p class="para">
       この引数は、<em><code class="parameter">fetch_style</code></em> の値によって意味が異なります。
       <ul class="itemizedlist">
        <li class="listitem">
         <p class="para">
          <strong><code>PDO::FETCH_COLUMN</code></strong>: ここで指定した、
           0 から始まる番号のカラムを返します。
         </p>
        </li>
        <li class="listitem">
         <p class="para">
          <strong><code>PDO::FETCH_CLASS</code></strong>:
           ここで指定したクラスのインスタンスを返します。各行のカラムがクラスのプロパティ名にマッピングされます。
         </p>
        </li>
        <li class="listitem">
         <p class="para">
          <strong><code>PDO::FETCH_FUNC</code></strong>:
          ここで指定した関数をコールした結果を返します。各行のカラムを関数コール時のパラメータとします。
         </p>
        </li>
       </ul>
      </p>
     </dd>

    </dt>

    <dt>

     <span class="term"><em><code class="parameter">ctor_args</code></em></span>
     <dd>

      <p class="para">
       <em><code class="parameter">fetch_style</code></em> が
       <strong><code>PDO::FETCH_CLASS</code></strong>
       のときに使う、独自のクラスコンストラクタへの引数。
      </p>
     </dd>

    </dt>

   </dl>

  </p>
 </div>


 <div class="refsect1 returnvalues" id="refsect1-pdostatement.fetchall-returnvalues">
  <h3 class="title">返り値</h3>
  <p class="para">
    <span class="function"><strong>PDOStatement::fetchAll()</strong></span> は、
   結果セットに残っている全ての行を含む配列を返します。
   この配列は、カラム値の配列もしくは各カラム名に対応するプロパティを持つオブジェクトとして各行を表します。
   取得結果がゼロ件だった場合は空の配列を返し、
   失敗した場合は <strong><code>FALSE</code></strong> を返します。
  </p>
  <p class="para">
   大きな結果セットをフェッチするためにこのメソッドを使用することは、
   システムとネットワークリソースに大量の要求を行うことになります。
   PHP で全てのデータ処理と操作を行うよりも、データベースサーバー側で
   結果セットを操作することを検討してください。例えば、PHP で処理を行う前に
   SQL で WHERE 句や ORDER BY 句を使用し、結果を制限することです。
  </p>
 </div>


 <div class="refsect1 examples" id="refsect1-pdostatement.fetchall-examples">
  <h3 class="title">例</h3>
  <p class="para">
   <div class="example" id="example-949"><p><strong>例1 結果セットに残っている全ての行をフェッチする</strong></p>
    <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br />$sth&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$dbh</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">prepare</span><span style="color: #007700">(</span><span style="color: #DD0000">"SELECT&nbsp;name,&nbsp;colour&nbsp;FROM&nbsp;fruit"</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">$sth</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">execute</span><span style="color: #007700">();<br /><br /></span><span style="color: #FF8000">/*&nbsp;結果セットに残っている全ての行をフェッチする&nbsp;*/<br /></span><span style="color: #007700">print(</span><span style="color: #DD0000">"Fetch&nbsp;all&nbsp;of&nbsp;the&nbsp;remaining&nbsp;rows&nbsp;in&nbsp;the&nbsp;result&nbsp;set:\n"</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">$result&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$sth</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">fetchAll</span><span style="color: #007700">();<br /></span><span style="color: #0000BB">print_r</span><span style="color: #007700">(</span><span style="color: #0000BB">$result</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
    </div>

    <div class="example-contents"><p>上の例の出力は、
たとえば以下のようになります。</p></div>
    <div class="example-contents screen">
<div class="cdata"><pre>
Fetch all of the remaining rows in the result set:
Array
(
    [0] =&gt; Array
        (
            [NAME] =&gt; pear
            [0] =&gt; pear
            [COLOUR] =&gt; green
            [1] =&gt; green
        )

    [1] =&gt; Array
        (
            [NAME] =&gt; watermelon
            [0] =&gt; watermelon
            [COLOUR] =&gt; pink
            [1] =&gt; pink
        )

)
</pre></div>
    </div>
   </div>
   <div class="example" id="example-950"><p><strong>例2 結果セットから単一カラムの全ての値を取得する</strong></p>
    <div class="example-contents"><p>
     以下の例は、
     SQL ステートメント自身が行毎に複数のカラムを返す場合において、
     どのように結果セットから単一カラムの全ての値を取得するかを
     例示しています。
    </p></div>
    <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br />$sth&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$dbh</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">prepare</span><span style="color: #007700">(</span><span style="color: #DD0000">"SELECT&nbsp;name,&nbsp;colour&nbsp;FROM&nbsp;fruit"</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">$sth</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">execute</span><span style="color: #007700">();<br /><br /></span><span style="color: #FF8000">/*&nbsp;最初のカラムの全ての値を取得する&nbsp;*/<br /></span><span style="color: #0000BB">$result&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$sth</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">fetchAll</span><span style="color: #007700">(</span><span style="color: #0000BB">PDO</span><span style="color: #007700">::</span><span style="color: #0000BB">FETCH_COLUMN</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">0</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">var_dump</span><span style="color: #007700">(</span><span style="color: #0000BB">$result</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
    </div>

    <div class="example-contents"><p>上の例の出力は、
たとえば以下のようになります。</p></div>
    <div class="example-contents screen">
<div class="cdata"><pre>
Array(3)
(
    [0] =&gt;
    string(5) =&gt; apple
    [1] =&gt;
    string(4) =&gt; pear
    [2] =&gt;
    string(10) =&gt; watermelon
)
</pre></div>
    </div>
   </div>
   <div class="example" id="example-951"><p><strong>例3 単一カラムによる全ての値のグループ化</strong></p>
    <div class="example-contents"><p>
     以下の例は、どのように結果セット中の特定のカラムの値によって
     グループ化された連想配列を返すかを例示しています。
     その配列は 3 つのキーを有します。値 <em>apple</em>、
     <em>pear</em> は異なる 2
     つの異なる色を有する配列として返され、
     一方 <em>watermelon</em> は 1
     つの色のみ有する配列として返されます。
    </p></div>
    <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br />$insert&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$dbh</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">prepare</span><span style="color: #007700">(</span><span style="color: #DD0000">"INSERT&nbsp;INTO&nbsp;fruit(name,&nbsp;colour)&nbsp;VALUES&nbsp;(?,&nbsp;?)"</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">$insert</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">execute</span><span style="color: #007700">(array(</span><span style="color: #DD0000">'apple'</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">'green'</span><span style="color: #007700">));<br /></span><span style="color: #0000BB">$insert</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">execute</span><span style="color: #007700">(array(</span><span style="color: #DD0000">'pear'</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">'yellow'</span><span style="color: #007700">));<br /><br /></span><span style="color: #0000BB">$sth&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$dbh</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">prepare</span><span style="color: #007700">(</span><span style="color: #DD0000">"SELECT&nbsp;name,&nbsp;colour&nbsp;FROM&nbsp;fruit"</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">$sth</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">execute</span><span style="color: #007700">();<br /><br /></span><span style="color: #FF8000">/*&nbsp;最初のカラムの値によってグループ化する&nbsp;*/<br /></span><span style="color: #0000BB">var_dump</span><span style="color: #007700">(</span><span style="color: #0000BB">$sth</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">fetchAll</span><span style="color: #007700">(</span><span style="color: #0000BB">PDO</span><span style="color: #007700">::</span><span style="color: #0000BB">FETCH_COLUMN</span><span style="color: #007700">|</span><span style="color: #0000BB">PDO</span><span style="color: #007700">::</span><span style="color: #0000BB">FETCH_GROUP</span><span style="color: #007700">));<br /></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
    </div>

    <div class="example-contents"><p>上の例の出力は、
たとえば以下のようになります。</p></div>
    <div class="example-contents screen">
<div class="cdata"><pre>
array(3) {
  [&quot;apple&quot;]=&gt;
  array(2) {
    [0]=&gt;
    string(5) &quot;green&quot;
    [1]=&gt;
    string(3) &quot;red&quot;
  }
  [&quot;pear&quot;]=&gt;
  array(2) {
    [0]=&gt;
    string(5) &quot;green&quot;
    [1]=&gt;
    string(6) &quot;yellow&quot;
  }
  [&quot;watermelon&quot;]=&gt;
  array(1) {
    [0]=&gt;
    string(5) &quot;green&quot;
  }
}

</pre></div>
    </div>
   </div>
   <div class="example" id="example-952"><p><strong>例4 各結果用のクラスのインスタンス作成</strong></p>
    <div class="example-contents"><p>
     次の例は、
     <strong><code>PDO::FETCH_CLASS</code></strong> の振る舞いを示すものです。
    </p></div>
    <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br /></span><span style="color: #007700">class&nbsp;</span><span style="color: #0000BB">fruit&nbsp;</span><span style="color: #007700">{<br />&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;</span><span style="color: #0000BB">$name</span><span style="color: #007700">;<br />&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;</span><span style="color: #0000BB">$colour</span><span style="color: #007700">;<br />}<br /><br /></span><span style="color: #0000BB">$sth&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$dbh</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">prepare</span><span style="color: #007700">(</span><span style="color: #DD0000">"SELECT&nbsp;name,&nbsp;colour&nbsp;FROM&nbsp;fruit"</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">$sth</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">execute</span><span style="color: #007700">();<br /><br /></span><span style="color: #0000BB">$result&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$sth</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">fetchAll</span><span style="color: #007700">(</span><span style="color: #0000BB">PDO</span><span style="color: #007700">::</span><span style="color: #0000BB">FETCH_CLASS</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">"fruit"</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">var_dump</span><span style="color: #007700">(</span><span style="color: #0000BB">$result</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
    </div>

    <div class="example-contents"><p>上の例の出力は、
たとえば以下のようになります。</p></div>
    <div class="example-contents screen">
<div class="cdata"><pre>
array(3) {
  [0]=&gt;
  object(fruit)#1 (2) {
    [&quot;name&quot;]=&gt;
    string(5) &quot;apple&quot;
    [&quot;colour&quot;]=&gt;
    string(5) &quot;green&quot;
  }
  [1]=&gt;
  object(fruit)#2 (2) {
    [&quot;name&quot;]=&gt;
    string(4) &quot;pear&quot;
    [&quot;colour&quot;]=&gt;
    string(6) &quot;yellow&quot;
  }
  [2]=&gt;
  object(fruit)#3 (2) {
    [&quot;name&quot;]=&gt;
    string(10) &quot;watermelon&quot;
    [&quot;colour&quot;]=&gt;
    string(4) &quot;pink&quot;
  }
}
</pre></div>
    </div>
   </div>
   <div class="example" id="example-953"><p><strong>例5 各結果に対する関数コール</strong></p>
    <div class="example-contents"><p>
     次の例は、
     <strong><code>PDO::FETCH_FUNC</code></strong> の振る舞いを示すものです。
    </p></div>
    <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br /></span><span style="color: #007700">function&nbsp;</span><span style="color: #0000BB">fruit</span><span style="color: #007700">(</span><span style="color: #0000BB">$name</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$colour</span><span style="color: #007700">)&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;</span><span style="color: #DD0000">"</span><span style="color: #007700">{</span><span style="color: #0000BB">$name</span><span style="color: #007700">}</span><span style="color: #DD0000">:&nbsp;</span><span style="color: #007700">{</span><span style="color: #0000BB">$colour</span><span style="color: #007700">}</span><span style="color: #DD0000">"</span><span style="color: #007700">;<br />}<br /><br /></span><span style="color: #0000BB">$sth&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$dbh</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">prepare</span><span style="color: #007700">(</span><span style="color: #DD0000">"SELECT&nbsp;name,&nbsp;colour&nbsp;FROM&nbsp;fruit"</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">$sth</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">execute</span><span style="color: #007700">();<br /><br /></span><span style="color: #0000BB">$result&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$sth</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">fetchAll</span><span style="color: #007700">(</span><span style="color: #0000BB">PDO</span><span style="color: #007700">::</span><span style="color: #0000BB">FETCH_FUNC</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">"fruit"</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">var_dump</span><span style="color: #007700">(</span><span style="color: #0000BB">$result</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
    </div>

    <div class="example-contents"><p>上の例の出力は、
たとえば以下のようになります。</p></div>
    <div class="example-contents screen">
<div class="cdata"><pre>
array(3) {
  [0]=&gt;
  string(12) &quot;apple: green&quot;
  [1]=&gt;
  string(12) &quot;pear: yellow&quot;
  [2]=&gt;
  string(16) &quot;watermelon: pink&quot;
}
</pre></div>
    </div>
   </div>

  </p>
 </div>


 <div class="refsect1 seealso" id="refsect1-pdostatement.fetchall-seealso">
  <h3 class="title">参考</h3>
  <p class="para">
   <ul class="simplelist">
    <li class="member"> <span class="function"><a href="pdo.query.html" class="function" rel="rdfs-seeAlso">PDO::query()</a> - SQL ステートメントを実行し、結果セットを PDOStatement オブジェクトとして返す</span></li>
    <li class="member"> <span class="function"><a href="pdostatement.fetch.html" class="function" rel="rdfs-seeAlso">PDOStatement::fetch()</a> - 結果セットから次の行を取得する</span></li>
    <li class="member"> <span class="function"><a href="pdostatement.fetchcolumn.html" class="function" rel="rdfs-seeAlso">PDOStatement::fetchColumn()</a> - 結果セットの次行から単一カラムを返す</span></li>
    <li class="member"> <span class="function"><a href="pdo.prepare.html" class="function" rel="rdfs-seeAlso">PDO::prepare()</a> - 文を実行する準備を行い、文オブジェクトを返す</span></li>
    <li class="member"> <span class="function"><a href="pdostatement.setfetchmode.html" class="function" rel="rdfs-seeAlso">PDOStatement::setFetchMode()</a> - この文に対するデフォルトのフェッチモードを設定する</span></li>
   </ul>
  </p>
 </div>

</div><div id="usernotes">
 <div class="head">
  <h3 class="title">User Contributed Notes</h3>
 </div>
<div id="allnotes">  <a name="108796""></a>
  <div class="note">
   <strong class="user">ramon at monztro dot com</strong>
   <a href="#108796" class="date">25-May-2012 01:18</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If you are trying to call PDOStatement::fetchAll and is not getting the result set as expected (empty instead), check if you called PDOStatement::execute first.<br />
<br />
Remember PDOStatement::fetchAll does not execute the query, it just mounts the array. <br />
<br />
:)</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="104740""></a>
  <div class="note">
   <strong class="user">Hayley Watson</strong>
   <a href="#104740" class="date">05-Jul-2011 01:48</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If you use the PDO::FETCH_CLASS | PDO::FETCH_PROPS_LATE flags to map columns to object properties, fetchAll() will use any __set() method your object has when carrying out the mapping.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="104609""></a>
  <div class="note">
   <strong class="user">Anonymous</strong>
   <a href="#104609" class="date">25-Jun-2011 11:10</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Note that fetchAll() can be extremely memory inefficient for large data sets. My memory limit was set to 160 MB this is what happened when I tried:<br />
<br />
<span class="default">&lt;?php<br />
$arr </span><span class="keyword">= </span><span class="default">$stmt</span><span class="keyword">-&gt;</span><span class="default">fetchAll</span><span class="keyword">();<br />
</span><span class="comment">// Fatal error: Allowed memory size of 16777216 bytes exhausted<br />
</span><span class="default">?&gt;<br />
</span><br />
If you are going to loop through the output array of fetchAll(), instead use fetch() to minimize memory usage as follows:<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">while (</span><span class="default">$arr </span><span class="keyword">= </span><span class="default">$stmt</span><span class="keyword">-&gt;</span><span class="default">fetch</span><span class="keyword">()) {<br />
&nbsp;&nbsp;&nbsp; echo </span><span class="default">round</span><span class="keyword">(</span><span class="default">memory_get_usage</span><span class="keyword">() / (</span><span class="default">1024</span><span class="keyword">*</span><span class="default">1024</span><span class="keyword">),</span><span class="default">3</span><span class="keyword">) .</span><span class="string">' MB&lt;br /&gt;'</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">// do_other_stuff();<br />
</span><span class="keyword">}<br />
</span><span class="comment">// Last line for the same query shows only 28.973 MB usage<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="98359""></a>
  <div class="note">
   <strong class="user">Dennis</strong>
   <a href="#98359" class="date">10-Jun-2010 05:51</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Error:<br />
SQLSTATE[HY000]: General error: 2014 Cannot execute queries while other unbuffered queries are active. Consider using PDOStatement::fetchAll(). Alternatively, if your code is only ever going to run against mysql, you may enable query buffering by setting the PDO::MYSQL_ATTR_USE_BUFFERED_QUERY attribute.<br />
<br />
If you're using something like:<br />
<br />
while ($row = $query-&gt;fetchObject()) {<br />
&nbsp;&nbsp;&nbsp; [...]<br />
}<br />
<br />
try using this instead:<br />
<br />
$rows = $query-&gt;fetchAll(PDO::FETCH_CLASS, 'ArrayObject');<br />
<br />
foreach ($rows as $row) {<br />
&nbsp;&nbsp;&nbsp; [...]<br />
}</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="97973""></a>
  <div class="note">
   <strong class="user">esw at pixeloution dot removeme dot com</strong>
   <a href="#97973" class="date">19-May-2010 06:17</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Interestingly enough, when you use fetchAll, the constructor for your object is called AFTER the properties are assigned. For example:<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">class </span><span class="default">person </span><span class="keyword">{<br />
&nbsp;&nbsp;&nbsp; public </span><span class="default">$name</span><span class="keyword">;<br />
<br />
&nbsp;&nbsp;&nbsp; function </span><span class="default">__construct</span><span class="keyword">() {<br />
&nbsp;&nbsp; &nbsp; &nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">name </span><span class="keyword">= </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">name </span><span class="keyword">. </span><span class="string">" is my name."</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }<br />
}<br />
<br />
</span><span class="comment"># set up select from a database here with PDO<br />
</span><span class="default">$obj </span><span class="keyword">= </span><span class="default">$STH</span><span class="keyword">-&gt;</span><span class="default">fetchALL</span><span class="keyword">(</span><span class="default">PDO</span><span class="keyword">::</span><span class="default">FETCH_CLASS</span><span class="keyword">, </span><span class="string">'person'</span><span class="keyword">);<br />
</span><span class="default">?&gt;<br />
</span><br />
Will result in ' is my name' being appended to all the name columns. However if you call it slightly differently:<br />
<br />
<span class="default">&lt;?php<br />
$obj </span><span class="keyword">= </span><span class="default">$obj </span><span class="keyword">= </span><span class="default">$STH</span><span class="keyword">-&gt;</span><span class="default">fetchAll</span><span class="keyword">(</span><span class="default">PDO</span><span class="keyword">::</span><span class="default">FETCH_CLASS </span><span class="keyword">| </span><span class="default">PDO</span><span class="keyword">::</span><span class="default">FETCH_PROPS_LATE</span><span class="keyword">, </span><span class="string">'person'</span><span class="keyword">);<br />
</span><span class="default">?&gt;<br />
</span><br />
Then the constructor will be called before properties are assigned. I can't find this documented anywhere, so I thought it would be nice to add a note here.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="94236""></a>
  <div class="note">
   <strong class="user">mxrgus</strong>
   <a href="#94236" class="date">24-Oct-2009 01:22</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
In method body:<br />
<br />
return $pstmt-&gt;fetchAll() or die("bad");<br />
<br />
will not return correct value, but "1" instead.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="90692""></a>
  <div class="note">
   <strong class="user">Daniel Hofmann</strong>
   <a href="#90692" class="date">05-May-2009 09:21</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
PLEASE BE AWARE: If you do an OUTER LEFT JOIN and set PDO FetchALL to PDO::FETCH_ASSOC, any primary key you used in the OUTER LEFT JOIN will be set to a blank if there are no records returned in the JOIN.<br />
<br />
For example:<br />
<span class="default">&lt;?php<br />
</span><span class="comment">//query the product table and join to the image table and return any images, if we have any, for each product<br />
</span><span class="default">$sql </span><span class="keyword">= </span><span class="string">"SELECT * FROM product, image<br />
LEFT OUTER JOIN image ON (product.product_id = image.product_id)"</span><span class="keyword">;<br />
<br />
</span><span class="default">$array </span><span class="keyword">= </span><span class="default">$stmt</span><span class="keyword">-&gt;</span><span class="default">fetchAll</span><span class="keyword">(</span><span class="default">PDO</span><span class="keyword">::</span><span class="default">FETCH_ASSOC</span><span class="keyword">);<br />
<br />
</span><span class="default">print_r</span><span class="keyword">(</span><span class="default">$array</span><span class="keyword">);<br />
</span><span class="default">?&gt;<br />
</span><br />
The resulting array will look something like this:<br />
<br />
Array<br />
(<br />
&nbsp;&nbsp;&nbsp; [0] =&gt; Array<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; (<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [product_id] =&gt; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [notes] =&gt; "this product..."<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [brand] =&gt; "Best Yet"<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; ...<br />
<br />
The fix is to simply specify your field names in the SELECT clause instead of using the * as a wild card, or, you can also specify the field in addition to the *. The following example returns the product_id field correctly:<br />
<br />
<span class="default">&lt;?php<br />
$sql </span><span class="keyword">= </span><span class="string">"SELECT *, product.product_id FROM product, image<br />
LEFT OUTER JOIN image ON (product.product_id = image.product_id)"</span><span class="keyword">;<br />
<br />
</span><span class="default">$array </span><span class="keyword">= </span><span class="default">$stmt</span><span class="keyword">-&gt;</span><span class="default">fetchAll</span><span class="keyword">(</span><span class="default">PDO</span><span class="keyword">::</span><span class="default">FETCH_ASSOC</span><span class="keyword">);<br />
<br />
</span><span class="default">print_r</span><span class="keyword">(</span><span class="default">$array</span><span class="keyword">);<br />
</span><span class="default">?&gt;<br />
</span><br />
The resulting array will look something like this:<br />
<br />
Array<br />
(<br />
&nbsp;&nbsp;&nbsp; [0] =&gt; Array<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; (<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [product_id] =&gt; 3<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [notes] =&gt; "this product..."<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [brand] =&gt; "Best Yet"<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; ...</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="88699""></a>
  <div class="note">
   <strong class="user">Ant P.</strong>
   <a href="#88699" class="date">04-Feb-2009 03:37</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
You might find yourself wanting to use FETCH_GROUP and FETCH_ASSOC at the same time, to get your table's primary key as the array key:<br />
<span class="default">&lt;?php<br />
</span><span class="comment">// $stmt is some query like "SELECT rowid, username, comment"<br />
</span><span class="default">$results </span><span class="keyword">= </span><span class="default">$stmt</span><span class="keyword">-&gt;</span><span class="default">fetchAll</span><span class="keyword">(</span><span class="default">PDO</span><span class="keyword">::</span><span class="default">FETCH_GROUP</span><span class="keyword">|</span><span class="default">PDO</span><span class="keyword">::</span><span class="default">FETCH_ASSOC</span><span class="keyword">);<br />
<br />
</span><span class="comment">// It does work, but not as you might expect:<br />
</span><span class="default">$results </span><span class="keyword">= array(<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">1234 </span><span class="keyword">=&gt; array(</span><span class="default">0 </span><span class="keyword">=&gt; array(</span><span class="string">'username' </span><span class="keyword">=&gt; </span><span class="string">'abc'</span><span class="keyword">, </span><span class="string">'comment' </span><span class="keyword">=&gt; </span><span class="string">'[...]'</span><span class="keyword">)),<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">1235 </span><span class="keyword">=&gt; array(</span><span class="default">0 </span><span class="keyword">=&gt; array(</span><span class="string">'username' </span><span class="keyword">=&gt; </span><span class="string">'def'</span><span class="keyword">, </span><span class="string">'comment' </span><span class="keyword">=&gt; </span><span class="string">'[...]'</span><span class="keyword">)),<br />
);<br />
<br />
</span><span class="comment">// ...but you can at least strip the useless numbered array out easily:<br />
</span><span class="default">$results </span><span class="keyword">= </span><span class="default">array_map</span><span class="keyword">(</span><span class="string">'reset'</span><span class="keyword">, </span><span class="default">$results</span><span class="keyword">);<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="86769""></a>
  <div class="note">
   <strong class="user">davey at php dot net</strong>
   <a href="#86769" class="date">03-Nov-2008 03:54</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
When passing PDO::FETCH_CLASS as the first argument, this method will accept the class name as the second option:<br />
<br />
<span class="default">&lt;?php<br />
$query </span><span class="keyword">= </span><span class="default">$pdo</span><span class="keyword">-&gt;</span><span class="default">prepare</span><span class="keyword">(</span><span class="default">$sql</span><span class="keyword">);<br />
<br />
</span><span class="default">$result </span><span class="keyword">= </span><span class="default">$query</span><span class="keyword">-&gt;</span><span class="default">execute</span><span class="keyword">(</span><span class="default">$values</span><span class="keyword">);<br />
<br />
if (</span><span class="default">$result </span><span class="keyword">&amp;&amp; </span><span class="default">$query</span><span class="keyword">-&gt;</span><span class="default">rowCount</span><span class="keyword">() &gt; </span><span class="default">0</span><span class="keyword">) {<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$records </span><span class="keyword">= </span><span class="default">$query</span><span class="keyword">-&gt;</span><span class="default">fetchAll</span><span class="keyword">(</span><span class="default">PDO</span><span class="keyword">::</span><span class="default">FETCH_CLASS</span><span class="keyword">, </span><span class="string">'Some_Class'</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">// $record is now an array of Some_Class objects<br />
</span><span class="keyword">}<br />
</span><span class="default">?&gt;<br />
</span><br />
- Davey</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="86710""></a>
  <div class="note">
   <strong class="user">mrshelly at hotmail dot com</strong>
   <a href="#86710" class="date">31-Oct-2008 04:27</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
PHP fetchAll Data From SQL Server 2005 <br />
if field's data type is varchar(nvarchar), only fetch 255 chars. but the "text" data type is ok.<br />
<br />
so, notice! to change the 'varchar' or 'nvarchar' (length &gt; 255) to 'text' data type..<br />
<br />
hope to help u.<br />
<br />
<span class="default">&lt;?php<br />
<br />
$user </span><span class="keyword">= </span><span class="string">'sa'</span><span class="keyword">;<br />
</span><span class="default">$pass </span><span class="keyword">= </span><span class="string">'pass'</span><span class="keyword">;<br />
<br />
</span><span class="default">$conn </span><span class="keyword">= new </span><span class="default">PDO</span><span class="keyword">(</span><span class="string">'mssql:host=127.0.0.1; dbname=tempdb;'</span><span class="keyword">, </span><span class="default">$user</span><span class="keyword">, </span><span class="default">$pass</span><span class="keyword">);<br />
<br />
</span><span class="default">$mainSQL </span><span class="keyword">= </span><span class="string">"SELECT field_varchar, field_text FROM table1"</span><span class="keyword">;<br />
</span><span class="default">$sth </span><span class="keyword">= </span><span class="default">$conn</span><span class="keyword">-&gt;</span><span class="default">prepare</span><span class="keyword">(</span><span class="default">$mainSQL</span><span class="keyword">);<br />
</span><span class="default">$sth</span><span class="keyword">-&gt;</span><span class="default">setFetchMode</span><span class="keyword">(</span><span class="default">PDO</span><span class="keyword">::</span><span class="default">FETCH_ASSOC</span><span class="keyword">);<br />
</span><span class="default">$sth</span><span class="keyword">-&gt;</span><span class="default">execute</span><span class="keyword">();<br />
</span><span class="default">$retRows </span><span class="keyword">= </span><span class="default">$sth</span><span class="keyword">-&gt;</span><span class="default">fetchAll</span><span class="keyword">();<br />
</span><span class="comment">// the field_varchar field only to fetch 255 chars(max)<br />
// the field_text is ok.<br />
<br />
</span><span class="default">var_dump</span><span class="keyword">(</span><span class="default">$retRows</span><span class="keyword">);<br />
<br />
unset(</span><span class="default">$sth</span><span class="keyword">); unset(</span><span class="default">$conn</span><span class="keyword">);<br />
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="83750""></a>
  <div class="note">
   <strong class="user">harlequin2 at gmx dot de</strong>
   <a href="#83750" class="date">10-Jun-2008 02:01</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
There is also another fetch mode supported on Oracle and MSSQL: <br />
PDO::FETCH_ASSOC<br />
<br />
&gt; fetches only column names and omits the numeric index.<br />
<br />
If you would like to return all columns from an sql statement with column keys as table headers, it's as simple as this:<br />
<br />
<span class="default">&lt;?php<br />
$dbh </span><span class="keyword">= new </span><span class="default">PDO</span><span class="keyword">(</span><span class="string">"DS"</span><span class="keyword">, </span><span class="string">"USERNAME"</span><span class="keyword">, </span><span class="string">"PASSWORD"</span><span class="keyword">);<br />
</span><span class="default">$stmt </span><span class="keyword">= </span><span class="default">$dbh</span><span class="keyword">-&gt;</span><span class="default">prepare</span><span class="keyword">(</span><span class="string">"SELECT * FROM tablename"</span><span class="keyword">);<br />
</span><span class="default">$stmt</span><span class="keyword">-&gt;</span><span class="default">execute</span><span class="keyword">();<br />
</span><span class="default">$arrValues </span><span class="keyword">= </span><span class="default">$stmt</span><span class="keyword">-&gt;</span><span class="default">fetchAll</span><span class="keyword">(</span><span class="default">PDO</span><span class="keyword">::</span><span class="default">FETCH_ASSOC</span><span class="keyword">);<br />
</span><span class="comment">// open the table<br />
</span><span class="keyword">print </span><span class="string">"&lt;table wdith=\"100%\"&gt;\n"</span><span class="keyword">;<br />
print </span><span class="string">"&lt;tr&gt;\n"</span><span class="keyword">;<br />
</span><span class="comment">// add the table headers<br />
</span><span class="keyword">foreach (</span><span class="default">$arrValues</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">] as </span><span class="default">$key </span><span class="keyword">=&gt; </span><span class="default">$useless</span><span class="keyword">){<br />
&nbsp;&nbsp;&nbsp; print </span><span class="string">"&lt;th&gt;</span><span class="default">$key</span><span class="string">&lt;/th&gt;"</span><span class="keyword">;<br />
}<br />
print </span><span class="string">"&lt;/tr&gt;"</span><span class="keyword">;<br />
</span><span class="comment">// display data<br />
</span><span class="keyword">foreach (</span><span class="default">$arrValues </span><span class="keyword">as </span><span class="default">$row</span><span class="keyword">){<br />
&nbsp;&nbsp;&nbsp; print </span><span class="string">"&lt;tr&gt;"</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; foreach (</span><span class="default">$row </span><span class="keyword">as </span><span class="default">$key </span><span class="keyword">=&gt; </span><span class="default">$val</span><span class="keyword">){<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; print </span><span class="string">"&lt;td&gt;</span><span class="default">$val</span><span class="string">&lt;/td&gt;"</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; print </span><span class="string">"&lt;/tr&gt;\n"</span><span class="keyword">;<br />
}<br />
</span><span class="comment">// close the table<br />
</span><span class="keyword">print </span><span class="string">"&lt;/table&gt;\n"</span><span class="keyword">;<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="80164""></a>
  <div class="note">
   <strong class="user">Anonymous</strong>
   <a href="#80164" class="date">02-Jan-2008 08:13</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If no rows have been returned, fetchAll returns an empty array.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="70480""></a>
  <div class="note">
   <strong class="user">stas at metalinfo dot ru</strong>
   <a href="#70480" class="date">18-Oct-2006 03:37</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Note, that you can use PDO::FETCH_COLUMN|PDO::FETCH_GROUP pair only while selecting two columns, not like DB_common::getAssoc(), when grouping is set to true.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
</div>
</div>
<hr /><div class="manualnavbar" style="text-align: center;">
 <div class="prev" style="text-align: left; float: left;"><a href="pdostatement.fetch.html">PDOStatement::fetch</a></div>
 <div class="next" style="text-align: right; float: right;"><a href="pdostatement.fetchcolumn.html">PDOStatement::fetchColumn</a></div>
 <div class="up"><a href="class.pdostatement.html">PDOStatement</a></div>
 <div class="home"><a href="index.html">PHP Manual</a></div>
</div></body></html>
