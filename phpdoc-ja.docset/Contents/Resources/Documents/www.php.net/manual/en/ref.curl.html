<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
 <head>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <title>cURL 関数</title>
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <link media="all" rel="stylesheet" type="text/css" href="style.css"/>
 </head>
 <body class="docs"><div class="manualnavbar" style="text-align: center;">
 <div class="prev" style="text-align: left; float: left;"><a href="curl.examples-basic.html">基本的な curl の使用法</a></div>
 <div class="next" style="text-align: right; float: right;"><a href="function.curl-close.html">curl_close</a></div>
 <div class="up"><a href="book.curl.html">cURL</a></div>
 <div class="home"><a href="index.html">PHP Manual</a></div>
</div><hr /><div id="ref.curl" class="reference">
  <h1 class="title">cURL 関数</h1>

  
































































































































































































































 <h2>目次</h2><ul class="chunklist chunklist_reference"><li><a href="function.curl-close.html">curl_close</a> — cURL セッションを閉じる</li><li><a href="function.curl-copy-handle.html">curl_copy_handle</a> — cURL ハンドルを、その設定も含めてコピーする</li><li><a href="function.curl-errno.html">curl_errno</a> — 直近のエラー番号を返す</li><li><a href="function.curl-error.html">curl_error</a> — 現在のセッションに関する直近のエラー文字列を返す</li><li><a href="function.curl-escape.html">curl_escape</a> — 指定した文字列を URL エンコードする</li><li><a href="function.curl-exec.html">curl_exec</a> — cURL セッションを実行する</li><li><a href="function.curl-file-create.html">curl_file_create</a> — CURLFile オブジェクトを作る</li><li><a href="function.curl-getinfo.html">curl_getinfo</a> — 指定した伝送に関する情報を得る</li><li><a href="function.curl-init.html">curl_init</a> — cURL セッションを初期化する</li><li><a href="function.curl-multi-add-handle.html">curl_multi_add_handle</a> — cURL マルチハンドルに、通常の cURL ハンドルを追加する</li><li><a href="function.curl-multi-close.html">curl_multi_close</a> — cURL ハンドルのセットを閉じる</li><li><a href="function.curl-multi-exec.html">curl_multi_exec</a> — 現在の cURL ハンドルから、サブ接続を実行する</li><li><a href="function.curl-multi-getcontent.html">curl_multi_getcontent</a> — CURLOPT_RETURNTRANSFER が設定されている場合に、cURL ハンドルの内容を返す</li><li><a href="function.curl-multi-info-read.html">curl_multi_info_read</a> — 現在の転送についての情報を表示する</li><li><a href="function.curl-multi-init.html">curl_multi_init</a> — 新規 cURL マルチハンドルを返す</li><li><a href="function.curl-multi-remove-handle.html">curl_multi_remove_handle</a> — cURL ハンドルのセットからマルチハンドルを削除する</li><li><a href="function.curl-multi-select.html">curl_multi_select</a> — curl_multi 接続のアクティビティを待つ</li><li><a href="function.curl-multi-setopt.html">curl_multi_setopt</a> — cURL マルチハンドル用のオプションを設定する</li><li><a href="function.curl-multi-strerror.html">curl_multi_strerror</a> — エラーの内容を表す文字列を返す</li><li><a href="function.curl-pause.html">curl_pause</a> — 接続の中断と再開をする</li><li><a href="function.curl-reset.html">curl_reset</a> — libcurl セッションハンドルのすべてのオプションをリセットする</li><li><a href="function.curl-setopt-array.html">curl_setopt_array</a> — CURL 転送用の複数のオプションを設定する</li><li><a href="function.curl-setopt.html">curl_setopt</a> — cURL 転送用オプションを設定する</li><li><a href="function.curl-share-close.html">curl_share_close</a> — cURL 共有ハンドルを閉じる</li><li><a href="function.curl-share-init.html">curl_share_init</a> — curl 共有ハンドルを初期化する</li><li><a href="function.curl-share-setopt.html">curl_share_setopt</a> — cURL 共有ハンドルのオプションを設定する</li><li><a href="function.curl-strerror.html">curl_strerror</a> — エラーコードの説明を返す</li><li><a href="function.curl-unescape.html">curl_unescape</a> — URL エンコードされた文字列をデコードする</li><li><a href="function.curl-version.html">curl_version</a> — cURL のバージョンを返す</li></ul>
</div>
<div id="usernotes">
 <div class="head">
  <h3 class="title">User Contributed Notes</h3>
 </div>
<div id="allnotes">  <a name="93163""></a>
  <div class="note">
   <strong class="user">Emprivo.com</strong>
   <a href="#93163" class="date">26-Aug-2009 06:58</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Fixed bugs in the function posted earlier (better javascript redirect following and now supports HTTPS)<br />
<br />
<span class="default">&lt;?php<br />
<br />
</span><span class="comment">/*==================================<br />
Get url content and response headers (given a url, follows all redirections on it and returned content and response headers of final url)<br />
<br />
@return&nbsp; &nbsp; array[0]&nbsp; &nbsp; content<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; array[1]&nbsp; &nbsp; array of response headers<br />
==================================*/<br />
</span><span class="keyword">function </span><span class="default">get_url</span><span class="keyword">( </span><span class="default">$url</span><span class="keyword">,&nbsp; </span><span class="default">$javascript_loop </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">, </span><span class="default">$timeout </span><span class="keyword">= </span><span class="default">5 </span><span class="keyword">)<br />
{<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$url </span><span class="keyword">= </span><span class="default">str_replace</span><span class="keyword">( </span><span class="string">"&amp;amp;"</span><span class="keyword">, </span><span class="string">"&amp;"</span><span class="keyword">, </span><span class="default">urldecode</span><span class="keyword">(</span><span class="default">trim</span><span class="keyword">(</span><span class="default">$url</span><span class="keyword">)) );<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$cookie </span><span class="keyword">= </span><span class="default">tempnam </span><span class="keyword">(</span><span class="string">"/tmp"</span><span class="keyword">, </span><span class="string">"CURLCOOKIE"</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$ch </span><span class="keyword">= </span><span class="default">curl_init</span><span class="keyword">();<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">curl_setopt</span><span class="keyword">( </span><span class="default">$ch</span><span class="keyword">, </span><span class="default">CURLOPT_USERAGENT</span><span class="keyword">, </span><span class="string">"Mozilla/5.0 (Windows; U; Windows NT 5.1; rv:1.7.3) Gecko/20041001 Firefox/0.10.1" </span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">curl_setopt</span><span class="keyword">( </span><span class="default">$ch</span><span class="keyword">, </span><span class="default">CURLOPT_URL</span><span class="keyword">, </span><span class="default">$url </span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">curl_setopt</span><span class="keyword">( </span><span class="default">$ch</span><span class="keyword">, </span><span class="default">CURLOPT_COOKIEJAR</span><span class="keyword">, </span><span class="default">$cookie </span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">curl_setopt</span><span class="keyword">( </span><span class="default">$ch</span><span class="keyword">, </span><span class="default">CURLOPT_FOLLOWLOCATION</span><span class="keyword">, </span><span class="default">true </span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">curl_setopt</span><span class="keyword">( </span><span class="default">$ch</span><span class="keyword">, </span><span class="default">CURLOPT_ENCODING</span><span class="keyword">, </span><span class="string">"" </span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">curl_setopt</span><span class="keyword">( </span><span class="default">$ch</span><span class="keyword">, </span><span class="default">CURLOPT_RETURNTRANSFER</span><span class="keyword">, </span><span class="default">true </span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">curl_setopt</span><span class="keyword">( </span><span class="default">$ch</span><span class="keyword">, </span><span class="default">CURLOPT_AUTOREFERER</span><span class="keyword">, </span><span class="default">true </span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">curl_setopt</span><span class="keyword">( </span><span class="default">$ch</span><span class="keyword">, </span><span class="default">CURLOPT_SSL_VERIFYPEER</span><span class="keyword">, </span><span class="default">false </span><span class="keyword">);&nbsp; &nbsp; </span><span class="comment"># required for https urls<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">curl_setopt</span><span class="keyword">( </span><span class="default">$ch</span><span class="keyword">, </span><span class="default">CURLOPT_CONNECTTIMEOUT</span><span class="keyword">, </span><span class="default">$timeout </span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">curl_setopt</span><span class="keyword">( </span><span class="default">$ch</span><span class="keyword">, </span><span class="default">CURLOPT_TIMEOUT</span><span class="keyword">, </span><span class="default">$timeout </span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">curl_setopt</span><span class="keyword">( </span><span class="default">$ch</span><span class="keyword">, </span><span class="default">CURLOPT_MAXREDIRS</span><span class="keyword">, </span><span class="default">10 </span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$content </span><span class="keyword">= </span><span class="default">curl_exec</span><span class="keyword">( </span><span class="default">$ch </span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$response </span><span class="keyword">= </span><span class="default">curl_getinfo</span><span class="keyword">( </span><span class="default">$ch </span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">curl_close </span><span class="keyword">( </span><span class="default">$ch </span><span class="keyword">);<br />
<br />
&nbsp;&nbsp;&nbsp; if (</span><span class="default">$response</span><span class="keyword">[</span><span class="string">'http_code'</span><span class="keyword">] == </span><span class="default">301 </span><span class="keyword">|| </span><span class="default">$response</span><span class="keyword">[</span><span class="string">'http_code'</span><span class="keyword">] == </span><span class="default">302</span><span class="keyword">)<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">ini_set</span><span class="keyword">(</span><span class="string">"user_agent"</span><span class="keyword">, </span><span class="string">"Mozilla/5.0 (Windows; U; Windows NT 5.1; rv:1.7.3) Gecko/20041001 Firefox/0.10.1"</span><span class="keyword">);<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if ( </span><span class="default">$headers </span><span class="keyword">= </span><span class="default">get_headers</span><span class="keyword">(</span><span class="default">$response</span><span class="keyword">[</span><span class="string">'url'</span><span class="keyword">]) )<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; foreach( </span><span class="default">$headers </span><span class="keyword">as </span><span class="default">$value </span><span class="keyword">)<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if ( </span><span class="default">substr</span><span class="keyword">( </span><span class="default">strtolower</span><span class="keyword">(</span><span class="default">$value</span><span class="keyword">), </span><span class="default">0</span><span class="keyword">, </span><span class="default">9 </span><span class="keyword">) == </span><span class="string">"location:" </span><span class="keyword">)<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">get_url</span><span class="keyword">( </span><span class="default">trim</span><span class="keyword">( </span><span class="default">substr</span><span class="keyword">( </span><span class="default">$value</span><span class="keyword">, </span><span class="default">9</span><span class="keyword">, </span><span class="default">strlen</span><span class="keyword">(</span><span class="default">$value</span><span class="keyword">) ) ) );<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp;&nbsp; if (&nbsp; &nbsp; ( </span><span class="default">preg_match</span><span class="keyword">(</span><span class="string">"/&gt;[[:space:]]+window\.location\.replace\('(.*)'\)/i"</span><span class="keyword">, </span><span class="default">$content</span><span class="keyword">, </span><span class="default">$value</span><span class="keyword">) || </span><span class="default">preg_match</span><span class="keyword">(</span><span class="string">"/&gt;[[:space:]]+window\.location\=\"(.*)\"/i"</span><span class="keyword">, </span><span class="default">$content</span><span class="keyword">, </span><span class="default">$value</span><span class="keyword">) ) &amp;&amp;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$javascript_loop </span><span class="keyword">&lt; </span><span class="default">5<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">)<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">get_url</span><span class="keyword">( </span><span class="default">$value</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">], </span><span class="default">$javascript_loop</span><span class="keyword">+</span><span class="default">1 </span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; else<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return array( </span><span class="default">$content</span><span class="keyword">, </span><span class="default">$response </span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; }<br />
}<br />
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="82946""></a>
  <div class="note">
   <strong class="user">Peter X.</strong>
   <a href="#82946" class="date">03-May-2008 04:44</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Although it has been noted that cURL outperforms both file_get_contents and fopen when it comes to getting a file over a HTTP link, the disadvantage of cURL is that it has no way of only reading a part of a page at a time.<br />
<br />
For example, the following code is likely to generate a memory limit error:<br />
<br />
<span class="default">&lt;?php<br />
$ch </span><span class="keyword">= </span><span class="default">curl_init</span><span class="keyword">(</span><span class="string">"<a href="http://www.example.com/reallybigfile.tar.gz" rel="nofollow" target="_blank">http://www.example.com/reallybigfile.tar.gz</a>"</span><span class="keyword">);<br />
</span><span class="default">curl_setopt</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">, </span><span class="default">CURLOPT_RETURNTRANSFER</span><span class="keyword">, </span><span class="default">true</span><span class="keyword">);<br />
</span><span class="default">curl_setopt</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">, </span><span class="default">CURLOPT_BINARYTRANSFER</span><span class="keyword">, </span><span class="default">true</span><span class="keyword">);<br />
</span><span class="default">$output </span><span class="keyword">= </span><span class="default">curl_exec</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">);<br />
<br />
</span><span class="default">$fh </span><span class="keyword">= </span><span class="default">fopen</span><span class="keyword">(</span><span class="string">"out.tar.gz"</span><span class="keyword">, </span><span class="string">'w'</span><span class="keyword">);<br />
</span><span class="default">fwrite</span><span class="keyword">(</span><span class="default">$fh</span><span class="keyword">, </span><span class="default">$output</span><span class="keyword">);<br />
</span><span class="default">fclose</span><span class="keyword">(</span><span class="default">$fh</span><span class="keyword">);<br />
</span><span class="default">?&gt;<br />
</span><br />
While this, on the other hand, wouldn't<br />
<br />
<span class="default">&lt;?php<br />
$hostfile </span><span class="keyword">= </span><span class="default">fopen</span><span class="keyword">(</span><span class="string">"<a href="http://www.example.com/reallybigfile.tar.gz" rel="nofollow" target="_blank">http://www.example.com/reallybigfile.tar.gz</a>"</span><span class="keyword">, </span><span class="string">'r'</span><span class="keyword">);<br />
</span><span class="default">$fh </span><span class="keyword">= </span><span class="default">fopen</span><span class="keyword">(</span><span class="string">"out.tar.gz"</span><span class="keyword">, </span><span class="string">'w'</span><span class="keyword">);<br />
<br />
while (!</span><span class="default">feof</span><span class="keyword">(</span><span class="default">$hostfile</span><span class="keyword">)) {<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$output </span><span class="keyword">= </span><span class="default">fread</span><span class="keyword">(</span><span class="default">$hostfile</span><span class="keyword">, </span><span class="default">8192</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">fwrite</span><span class="keyword">(</span><span class="default">$fh</span><span class="keyword">, </span><span class="default">$output</span><span class="keyword">);<br />
}<br />
&nbsp;&nbsp;&nbsp; <br />
</span><span class="default">fclose</span><span class="keyword">(</span><span class="default">$hostfile</span><span class="keyword">);<br />
</span><span class="default">fclose</span><span class="keyword">(</span><span class="default">$fh</span><span class="keyword">);<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="76249""></a>
  <div class="note">
   <strong class="user">Mr.KTO</strong>
   <a href="#76249" class="date">07-Jul-2007 03:59</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Don't foget to curl_close($ch); Even if curl_errno($ch) != 0<br />
<br />
Because if you don't - on Windows this will produce windows-error-report (Program terminated unexpectedly)</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="73687""></a>
  <div class="note">
   <strong class="user">killermonk at REMOVE dot killermonk dot com</strong>
   <a href="#73687" class="date">06-Mar-2007 08:23</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
For anyone trying to use cURL to submit to an ASP/ASPX page that uses an image as the submit button.<br />
<br />
Make sure that you have 'button_name.x' and 'button_name.y' in the post fields. PHP names these fields 'button_name_x' and 'button_name_y', while ASP uses a dot.<br />
<br />
Also, as noted above, be sure to include the '__VIEWSTATE' input field in your post request.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="72608""></a>
  <div class="note">
   <strong class="user">gordon_e_rouse at yahoo dot com dot au</strong>
   <a href="#72608" class="date">25-Jan-2007 11:24</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Using curl to take snapshots of the current page for emailing the HTML is a clever little idea. (ie: Email this page to a friend)<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="comment">//to be explained below!<br />
</span><span class="default">session_write_close</span><span class="keyword">();<br />
<br />
</span><span class="default">$pageurl </span><span class="keyword">= </span><span class="string">"<a href="http://www.site.com/content.php?PHPSESSID=123XYZ" rel="nofollow" target="_blank">http://www.site.com/content.php?PHPSESSID=123XYZ</a><br />
curl_setopt(</span><span class="default">$ch</span><span class="string">, CURLOPT_RETURNTRANSFER, 1);<br />
<br />
curl_setopt (</span><span class="default">$ch</span><span class="string">, CURLOPT_URL, </span><span class="default">$pageurl</span><span class="string"> ); <br />
</span><span class="default">$html</span><span class="string"> = curl_exec ( </span><span class="default">$ch</span><span class="string"> );<br />
curl_close(</span><span class="default">$ch</span><span class="string">);<br />
<br />
//then you need to fix pathing to absolute<br />
</span><span class="default">$search</span><span class="string"> = "</span><span class="keyword">/(</span><span class="default">src</span><span class="keyword">|</span><span class="default">href</span><span class="keyword">|</span><span class="default">background</span><span class="keyword">)=\</span><span class="string">"[^:,^&gt;,^\"]*\"/i"</span><span class="keyword">;<br />
<br />
</span><span class="default">preg_match_all </span><span class="keyword">( </span><span class="default">$search</span><span class="keyword">, </span><span class="default">$html</span><span class="keyword">, </span><span class="default">$a_matches </span><span class="keyword">);<br />
<br />
</span><span class="comment">//you can figure out the rest ! but thought the reg expression is useful as well<br />
</span><span class="default">?&gt;<br />
</span><br />
But here is the catch, you may want to make sure curl connects to the server under the same session as the browser. So naturally you pass the session cookie through the curl system either by the cookie jar system, or through the query string in the path.<br />
<br />
This is where you will get stuck. PHP will need write access to the same session file simultaneously!! causing serious hanging issues!<br />
<br />
This is why you should close off your session before you make curl take a page snapshot!</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="67940""></a>
  <div class="note">
   <strong class="user">galvao at galvao.eti.br</strong>
   <a href="#67940" class="date">07-Jul-2006 05:27</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Note that on Win32 this documentation can get a little confusing.<br />
<br />
In order to get this to work you need to:<br />
<br />
1) Be sure that the folder where libeay32.dll and ssleay32.dll - tipically C:\\PHP - is present on the PATH variable.<br />
<br />
2) Uncomment - remove the semi-colon - the line that says "extension=php_curl.dll" from php.ini<br />
<br />
3) Restart the webserver (you should already know this one, but...)<br />
<br />
It took me some time to realize this, since this page doesn't mention the need to uncomment that php.ini's line.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="62547""></a>
  <div class="note">
   <strong class="user">richardkmiller AT gmail</strong>
   <a href="#62547" class="date">03-Mar-2006 01:21</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Beware of any extra spaces in the URL.&nbsp; A trailing space in the URL caused my script to fail with the message "empty reply from server".</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="62194""></a>
  <div class="note">
   <strong class="user">stevehartken at hotmail dot com</strong>
   <a href="#62194" class="date">22-Feb-2006 07:40</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I had the following experience when harvesting urls with a get variable from a page using cUrl. HTML pages will output ampersands as &amp;amp when the page is read by the curl function. <br />
<br />
If you code a script to find all hyperlinks, it will use &amp;amp instead of &amp;, especially using a regular expression search.<br />
<br />
It is hard to detect because when you output the url to the browser it renders the html. To fix, add a line to replace the &amp;amp with &amp;.<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">function </span><span class="default">processURL</span><span class="keyword">(</span><span class="default">$url</span><span class="keyword">){<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$url</span><span class="keyword">=</span><span class="default">str_replace</span><span class="keyword">(</span><span class="string">'&amp;amp;'</span><span class="keyword">,</span><span class="string">'&amp;'</span><span class="keyword">,</span><span class="default">$url</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$ch</span><span class="keyword">=</span><span class="default">curl_init</span><span class="keyword">();<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">curl_setopt</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">, </span><span class="default">CURLOPT_URL</span><span class="keyword">, </span><span class="default">$url</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">curl_setopt </span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">, </span><span class="default">CURLOPT_RETURNTRANSFER</span><span class="keyword">, </span><span class="default">1</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$xml </span><span class="keyword">= </span><span class="default">curl_exec </span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">curl_close </span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; echo </span><span class="default">$xml</span><span class="keyword">;<br />
}<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="46539""></a>
  <div class="note">
   <strong class="user">mikeb[at]xamo[dot]com</strong>
   <a href="#46539" class="date">14-Oct-2004 10:11</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
A note of warning for PHP 5 users: if you try to fetch the CURLINFO_CONTENT_TYPE using curl_getinfo when there is a connect error, you will core dump PHP. I have informed the Curl team about this, so it will hopefully be fixed soon. Just make sure you check for an error before you look for this data.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="45653""></a>
  <div class="note">
   <strong class="user">alidrus at langkah dot com</strong>
   <a href="#45653" class="date">14-Sep-2004 11:31</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
In recent versions of php, CURLOPT_MUTE has (probably) been deprecated. Any attempt of using curl_setopt() to set CURLOPT_MUTE will give you a warning like this:<br />
<br />
PHP Notice:&nbsp; Use of undefined constant CURLOPT_MUTE - assumed 'CURLOPT_MUTE' in ....<br />
<br />
If you wish tu silence the curl output, use the following instead:<br />
<br />
<span class="default">&lt;?php<br />
&nbsp;&nbsp;&nbsp; curl_setopt</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">, </span><span class="default">CURLOPT_RETURNTRANSFER</span><span class="keyword">, </span><span class="default">true</span><span class="keyword">);<br />
</span><span class="default">?&gt;<br />
</span><br />
And then,<br />
<br />
<span class="default">&lt;?php<br />
&nbsp;&nbsp;&nbsp; $curl_output</span><span class="keyword">=</span><span class="default">curl_exec</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">);<br />
</span><span class="default">?&gt;<br />
</span><br />
The output of the curl operation will be stored as a string in $curl_output while the operation remains totally silent.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="43156""></a>
  <div class="note">
   <strong class="user">rich @ richud dot com</strong>
   <a href="#43156" class="date">11-Jun-2004 04:12</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If you have upgraded to using thread safe PHP (with apache 2 MPM=worker) note that<br />
CURLOPT_COOKIEJAR / CURLOPT_COOKIEFILE both need an absolute path set for the cookie file location and no longer take a relative path. <br />
(As before, also remember to have set correct permissions to allow a writeable cookie file/dir by apache)<br />
[php 4.3.7/apache v2.0.49]</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="40437""></a>
  <div class="note">
   <strong class="user">simon [at] vhostdirect [dot] co [dot] uk</strong>
   <a href="#40437" class="date">04-Mar-2004 01:53</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
It took me quite some to to figure out how to get Curl (with SSL), OpenSSL and PHP to play nicely together.<br />
<br />
After reinstalling MS-VC7 and compiling OpenSSL to finally realise this was'nt nesscary.<br />
<br />
If your like me and like *Nix systems more than Windows then you'll most probly have similar problems.<br />
<br />
I came across this, on a simple google with the right keywords.<br />
<br />
<a href="http://www.tonyspencer.com/journal/00000037.htm" rel="nofollow" target="_blank">http://www.tonyspencer.com/journal/00000037.htm</a><br />
<br />
I read thru that and found my mistake.<br />
<br />
Its just a small list of notes, I found them to be the best I've found on the subject and the most simplist.<br />
<br />
Dont forget to add a simple line like this into your scripts to get them working on Win32.<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">if(</span><span class="default">$WINDIR</span><span class="keyword">) </span><span class="default">curl_setopt</span><span class="keyword">(</span><span class="default">$curl</span><span class="keyword">, </span><span class="default">CURLOPT_CAINFO</span><span class="keyword">, </span><span class="string">"c:\\windows\\ca-bundle.crt"</span><span class="keyword">);<br />
</span><span class="default">?&gt;<br />
</span><br />
Last note: ca-bundle.crt file is located in the Curl download. I stored mine in the windows directory and apache/php can access it fine.<br />
<br />
All the best and I hope this helps.<br />
<br />
Simon Lightfoot<br />
vHost Direct Limited</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
</div>
</div>
<hr /><div class="manualnavbar" style="text-align: center;">
 <div class="prev" style="text-align: left; float: left;"><a href="curl.examples-basic.html">基本的な curl の使用法</a></div>
 <div class="next" style="text-align: right; float: right;"><a href="function.curl-close.html">curl_close</a></div>
 <div class="up"><a href="book.curl.html">cURL</a></div>
 <div class="home"><a href="index.html">PHP Manual</a></div>
</div></body></html>
