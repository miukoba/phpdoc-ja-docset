<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
 <head>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <title>PBKDF2 を使ってパスワードからキーを生成する</title>
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <link media="all" rel="stylesheet" type="text/css" href="style.css"/>
 </head>
 <body class="docs"><div class="manualnavbar" style="text-align: center;">
 <div class="prev" style="text-align: left; float: left;"><a href="function.hash-init.html">hash_init</a></div>
 <div class="next" style="text-align: right; float: right;"><a href="function.hash-update-file.html">hash_update_file</a></div>
 <div class="up"><a href="ref.hash.html">Hash 関数</a></div>
 <div class="home"><a href="index.html">PHP Manual</a></div>
</div><hr /><div id="function.hash-pbkdf2" class="refentry">
 <div class="refnamediv">
  <h1 class="refname">hash_pbkdf2</h1>
  <p class="verinfo">(PHP 5 &gt;= 5.5.0)</p><p class="refpurpose"><span class="refname">hash_pbkdf2</span> &mdash; <span class="dc-title">PBKDF2 を使ってパスワードからキーを生成する</span></p>

 </div>

 <div class="refsect1 description" id="refsect1-function.hash-pbkdf2-description">
  <h3 class="title">説明</h3>
  <div class="methodsynopsis dc-description">
   <span class="type">string</span> <span class="methodname"><strong>hash_pbkdf2</strong></span>
    ( <span class="methodparam"><span class="type">string</span> <code class="parameter">$algo</code></span>
   , <span class="methodparam"><span class="type">string</span> <code class="parameter">$password</code></span>
   , <span class="methodparam"><span class="type">string</span> <code class="parameter">$salt</code></span>
   , <span class="methodparam"><span class="type">int</span> <code class="parameter">$iterations</code></span>
   [, <span class="methodparam"><span class="type">int</span> <code class="parameter">$length</code><span class="initializer"> = 0</span></span>
   [, <span class="methodparam"><span class="type">bool</span> <code class="parameter">$raw_output</code><span class="initializer"> = false</span></span>
  ]] )</div>

 </div>


 <div class="refsect1 parameters" id="refsect1-function.hash-pbkdf2-parameters">
  <h3 class="title">パラメータ</h3>
  <p class="para">
   <dl>

    <dt>

     <span class="term"><em><code class="parameter">algo</code></em></span>
     <dd>

      <p class="para">
       ハッシュアルゴリズムの名前 (たとえば <em>md5</em>,
       <em>sha256</em>, <em>haval160,4</em> など)。サポートされるアルゴリズムの一覧は
        <span class="function"><a href="function.hash-algos.html" class="function">hash_algos()</a></span> をご参照ください。
      </p>
     </dd>

    </dt>

    <dt>

     <span class="term"><em><code class="parameter">password</code></em></span>
     <dd>

      <p class="para">
       派生に使うパスワード
      </p>
     </dd>

    </dt>

    <dt>

     <span class="term"><em><code class="parameter">salt</code></em></span>
     <dd>

      <p class="para">
       派生に使うソルト
      </p>
     </dd>

    </dt>

    <dt>

     <span class="term"><em><code class="parameter">iterations</code></em></span>
     <dd>

      <p class="para">
       派生の実行の際の内部の反復回数
      </p>
     </dd>

    </dt>

    <dt>

     <span class="term"><em><code class="parameter">length</code></em></span>
     <dd>

      <p class="para">
       出力する派生キーの長さ。<em>0</em> の場合、渡されたアルゴリズムの長さが使われます。
      </p>
     </dd>

    </dt>

    <dt>

     <span class="term"><em><code class="parameter">raw_output</code></em></span>
     <dd>

      <p class="para">
       <strong><code>TRUE</code></strong> にセットされている場合、名前のバイナリデータが出力されます。<strong><code>FALSE</code></strong> の場合、小文字の16進数が出力されます。
      </p>
     </dd>

    </dt>

   </dl>

  </p>
 </div>


 <div class="refsect1 returnvalues" id="refsect1-function.hash-pbkdf2-returnvalues">
  <h3 class="title">返り値</h3>
  <p class="para">
   小文字の16進数を含む文字列が返されます。<em><code class="parameter">raw_output</code></em> が true の場合、派生キーの生のバイナリ表現が返されます。
  </p>
 </div>


 <div class="refsect1 errors" id="refsect1-function.hash-pbkdf2-errors">
  <h3 class="title">エラー / 例外</h3>
  <p class="para">
    <strong><code>E_WARNING</code></strong> が発生するのはアルゴリズムが未知である場合、<em><code class="parameter">iterations</code></em> パラメータが <em>0</em> 以下である場合、<em><code class="parameter">length</code></em> が <em>0</em> 以下である場合、<em><code class="parameter">salt</code></em> が長すぎる場合
   (<strong><code>INT_MAX</code></strong><em> - 4</em> よりも大きい) です。
  </p>
 </div>


 <div class="refsect1 examples" id="refsect1-function.hash-pbkdf2-examples">
  <h3 class="title">例</h3>
  <p class="para">
   <div class="example" id="example-832">
    <p><strong>例1  <span class="function"><strong>hash_pbkdf2()</strong></span> の基本的な使い方の例</strong></p>
    <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br />$password&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #DD0000">"password"</span><span style="color: #007700">;<br /></span><span style="color: #0000BB">$salt&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #DD0000">"salt"</span><span style="color: #007700">;<br /></span><span style="color: #0000BB">$hash&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">hash_pbkdf2</span><span style="color: #007700">(</span><span style="color: #DD0000">"sha256"</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$password</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$salt</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">1</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">20</span><span style="color: #007700">);<br />echo&nbsp;</span><span style="color: #0000BB">$hash</span><span style="color: #007700">;<br /></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
    </div>

    <div class="example-contents"><p>上の例の出力は以下となります。</p></div>
    <div class="example-contents screen">
<div class="cdata"><pre>
120fb6cffcf8b32c43e7
</pre></div>
    </div>
   </div>
  </p>
 </div>


 <div class="refsect1 notes" id="refsect1-function.hash-pbkdf2-notes">
  <h3 class="title">注意</h3>
  <div class="caution"><strong class="caution">警告</strong>
   <p class="para">
    PBKDF2 による方法はパスワードのハッシュを保存するために使うことができます (NIST が認めた利用方法です)。
    しかしながら、<strong><code>CRYPT_BLOWFISH</code></strong> のほうがパスワードの保存に適しており、 <span class="function"><a href="function.crypt.html" class="function">crypt()</a></span> を通じて利用できることを記しておきます。
   </p>
  </div>
 </div>


 <div class="refsect1 seealso" id="refsect1-function.hash-pbkdf2-seealso">
  <h3 class="title">参考</h3>
  <p class="para">
   <ul class="simplelist">
    <li class="member"> <span class="function"><a href="function.crypt.html" class="function" rel="rdfs-seeAlso">crypt()</a> - 文字列の一方向のハッシュ化を行う</span></li>
    <li class="member"> <span class="function"><a href="function.hash.html" class="function" rel="rdfs-seeAlso">hash()</a> - ハッシュ値 (メッセージダイジェスト) を生成する</span></li>
    <li class="member"> <span class="function"><a href="function.hash-algos.html" class="function" rel="rdfs-seeAlso">hash_algos()</a> - 登録されているハッシュアルゴリズムの一覧を返す</span></li>
    <li class="member"> <span class="function"><a href="function.hash-init.html" class="function" rel="rdfs-seeAlso">hash_init()</a> - 段階的なハッシュコンテキストを初期化する</span></li>
    <li class="member"> <span class="function"><a href="function.hash-hmac.html" class="function" rel="rdfs-seeAlso">hash_hmac()</a> - HMAC 方式を使用してハッシュ値を生成する</span></li>
    <li class="member"> <span class="function"><a href="function.hash-hmac-file.html" class="function" rel="rdfs-seeAlso">hash_hmac_file()</a> - HMAC 方式を使用して、指定されたファイルの内容からハッシュ値を生成する</span></li>
   </ul>
  </p>
 </div>


</div><div id="usernotes">
 <div class="head">
  <h3 class="title">User Contributed Notes</h3>
 </div>
<div id="allnotes">  <a name="113728""></a>
  <div class="note">
   <strong class="user">Peter</strong>
   <a href="#113728" class="date">22-Nov-2013 12:03</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
See also https://github.com/rchouinard/hash_pbkdf2-compat for a compatibility function</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="113528""></a>
  <div class="note">
   <strong class="user">does dot not at matter dot org</strong>
   <a href="#113528" class="date">26-Oct-2013 12:30</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
this snippet was posted over a year ago on a dutch PHP community: (reference/source: <a href="http://www.phphulp.nl/php/script/beveiliging/pbkdf2-een-veilige-manier-om-wachtwoorden-op-te-slaan/1956/pbkdf2php/1757/" rel="nofollow" target="_blank">http://www.phphulp.nl/php/script/beveiliging/pbkdf2-een-veilige-manier-om-wachtwoorden-op-te-slaan/1956/pbkdf2php/1757/</a>)<br />
<br />
<span class="default">&lt;?php<br />
<br />
</span><span class="comment">/**<br />
&nbsp;* @author Chris Horeweg<br />
&nbsp;* @package Security_Tools<br />
&nbsp;*/<br />
<br />
</span><span class="keyword">function </span><span class="default">pbkdf2</span><span class="keyword">(</span><span class="default">$password</span><span class="keyword">, </span><span class="default">$salt</span><span class="keyword">, </span><span class="default">$algorithm </span><span class="keyword">= </span><span class="string">'sha512'</span><span class="keyword">, </span><span class="default">$count </span><span class="keyword">= </span><span class="default">20000</span><span class="keyword">, </span><span class="default">$key_length </span><span class="keyword">= </span><span class="default">128</span><span class="keyword">, </span><span class="default">$raw_output </span><span class="keyword">= </span><span class="default">false</span><span class="keyword">)<br />
{<br />
&nbsp;&nbsp;&nbsp; if(!</span><span class="default">in_array</span><span class="keyword">(</span><span class="default">$algorithm</span><span class="keyword">, </span><span class="default">hash_algos</span><span class="keyword">(), </span><span class="default">true</span><span class="keyword">)) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; exit(</span><span class="string">'pbkdf2: Hash algoritme is niet geinstalleerd op het systeem.'</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; if(</span><span class="default">$count </span><span class="keyword">&lt;= </span><span class="default">0 </span><span class="keyword">|| </span><span class="default">$key_length </span><span class="keyword">&lt;= </span><span class="default">0</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$count </span><span class="keyword">= </span><span class="default">20000</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$key_length </span><span class="keyword">= </span><span class="default">128</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$hash_length </span><span class="keyword">= </span><span class="default">strlen</span><span class="keyword">(</span><span class="default">hash</span><span class="keyword">(</span><span class="default">$algorithm</span><span class="keyword">, </span><span class="string">""</span><span class="keyword">, </span><span class="default">true</span><span class="keyword">));<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$block_count </span><span class="keyword">= </span><span class="default">ceil</span><span class="keyword">(</span><span class="default">$key_length </span><span class="keyword">/ </span><span class="default">$hash_length</span><span class="keyword">);<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$output </span><span class="keyword">= </span><span class="string">""</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; for(</span><span class="default">$i </span><span class="keyword">= </span><span class="default">1</span><span class="keyword">; </span><span class="default">$i </span><span class="keyword">&lt;= </span><span class="default">$block_count</span><span class="keyword">; </span><span class="default">$i</span><span class="keyword">++) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$last </span><span class="keyword">= </span><span class="default">$salt </span><span class="keyword">. </span><span class="default">pack</span><span class="keyword">(</span><span class="string">"N"</span><span class="keyword">, </span><span class="default">$i</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$last </span><span class="keyword">= </span><span class="default">$xorsum </span><span class="keyword">= </span><span class="default">hash_hmac</span><span class="keyword">(</span><span class="default">$algorithm</span><span class="keyword">, </span><span class="default">$last</span><span class="keyword">, </span><span class="default">$password</span><span class="keyword">, </span><span class="default">true</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; for (</span><span class="default">$j </span><span class="keyword">= </span><span class="default">1</span><span class="keyword">; </span><span class="default">$j </span><span class="keyword">&lt; </span><span class="default">$count</span><span class="keyword">; </span><span class="default">$j</span><span class="keyword">++) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$xorsum </span><span class="keyword">^= (</span><span class="default">$last </span><span class="keyword">= </span><span class="default">hash_hmac</span><span class="keyword">(</span><span class="default">$algorithm</span><span class="keyword">, </span><span class="default">$last</span><span class="keyword">, </span><span class="default">$password</span><span class="keyword">, </span><span class="default">true</span><span class="keyword">));<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$output </span><span class="keyword">.= </span><span class="default">$xorsum</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp;&nbsp; if(</span><span class="default">$raw_output</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">substr</span><span class="keyword">(</span><span class="default">$output</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">$key_length</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; else {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">base64_encode</span><span class="keyword">(</span><span class="default">substr</span><span class="keyword">(</span><span class="default">$output</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">$key_length</span><span class="keyword">));<br />
&nbsp;&nbsp;&nbsp; }<br />
}</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="113488""></a>
  <div class="note">
   <strong class="user">Binod Kumar Luitel</strong>
   <a href="#113488" class="date">18-Oct-2013 07:25</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
People who wants pure PHP implementation of the function, i.e. who don't have PHP 5.5 installed within their server, can use the following implementation. Nothing has been modified so far as from reference https://defuse.ca/php-pbkdf2.htm but the OOP lovers might like this.<br />
For more information about PBKDF2 see: <a href="http://en.wikipedia.org/wiki/PBKDF2" rel="nofollow" target="_blank">http://en.wikipedia.org/wiki/PBKDF2</a><br />
<br />
<span class="default">&lt;?php<br />
</span><span class="comment">/**<br />
&nbsp;* PBKDF2 key derivation function as defined by RSA's PKCS #5: https://www.ietf.org/rfc/rfc2898.txt<br />
&nbsp;* $algorithm - The hash algorithm to use. Recommended: SHA256<br />
&nbsp;* $password - The password.<br />
&nbsp;* $salt - A salt that is unique to the password.<br />
&nbsp;* $count - Iteration count. Higher is better, but slower. Recommended: At least 1000.<br />
&nbsp;* $key_length - The length of the derived key in bytes.<br />
&nbsp;* $raw_output - If true, the key is returned in raw binary format. Hex encoded otherwise.<br />
&nbsp;* Returns: A $key_length-byte key derived from the password and salt.<br />
&nbsp;*/<br />
</span><span class="keyword">if (!</span><span class="default">function_exists</span><span class="keyword">(</span><span class="string">"hash_pbkdf2"</span><span class="keyword">)) {<br />
&nbsp;&nbsp;&nbsp; function </span><span class="default">hash_pbkdf2</span><span class="keyword">(</span><span class="default">$algorithm</span><span class="keyword">, </span><span class="default">$password</span><span class="keyword">, </span><span class="default">$salt</span><span class="keyword">, </span><span class="default">$count</span><span class="keyword">, </span><span class="default">$key_length</span><span class="keyword">, </span><span class="default">$raw_output </span><span class="keyword">= </span><span class="default">false</span><span class="keyword">) {<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; class </span><span class="default">pbkdf2 </span><span class="keyword">{<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; public </span><span class="default">$algorithm</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; public </span><span class="default">$password</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; public </span><span class="default">$salt</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; public </span><span class="default">$count</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; public </span><span class="default">$key_length</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; public </span><span class="default">$raw_output</span><span class="keyword">;<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; private </span><span class="default">$hash_length</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; private </span><span class="default">$output&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">= </span><span class="string">""</span><span class="keyword">;<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; public function </span><span class="default">__construct</span><span class="keyword">(</span><span class="default">$data </span><span class="keyword">= </span><span class="default">null</span><span class="keyword">)<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">$data </span><span class="keyword">!= </span><span class="default">null</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">init</span><span class="keyword">(</span><span class="default">$data</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; public function </span><span class="default">init</span><span class="keyword">(</span><span class="default">$data</span><span class="keyword">)<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">algorithm&nbsp; </span><span class="keyword">= </span><span class="default">$data</span><span class="keyword">[</span><span class="string">"algorithm"</span><span class="keyword">];<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">password&nbsp;&nbsp; </span><span class="keyword">= </span><span class="default">$data</span><span class="keyword">[</span><span class="string">"password"</span><span class="keyword">];<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">salt&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">= </span><span class="default">$data</span><span class="keyword">[</span><span class="string">"salt"</span><span class="keyword">];<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">count&nbsp; &nbsp; &nbsp; </span><span class="keyword">= </span><span class="default">$data</span><span class="keyword">[</span><span class="string">"count"</span><span class="keyword">];<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">key_length </span><span class="keyword">= </span><span class="default">$data</span><span class="keyword">[</span><span class="string">"key_length"</span><span class="keyword">];<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">raw_output </span><span class="keyword">= </span><span class="default">$data</span><span class="keyword">[</span><span class="string">"raw_output"</span><span class="keyword">];<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; public function </span><span class="default">hash</span><span class="keyword">()<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">algorithm </span><span class="keyword">= </span><span class="default">strtolower</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">algorithm</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if(!</span><span class="default">in_array</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">algorithm</span><span class="keyword">, </span><span class="default">hash_algos</span><span class="keyword">(), </span><span class="default">true</span><span class="keyword">))<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; throw new </span><span class="default">Exception</span><span class="keyword">(</span><span class="string">'PBKDF2 ERROR: Invalid hash algorithm.'</span><span class="keyword">);<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">count </span><span class="keyword">&lt;= </span><span class="default">0 </span><span class="keyword">|| </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">key_length </span><span class="keyword">&lt;= </span><span class="default">0</span><span class="keyword">)<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; throw new </span><span class="default">Exception</span><span class="keyword">(</span><span class="string">'PBKDF2 ERROR: Invalid parameters.'</span><span class="keyword">);<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">hash_length </span><span class="keyword">= </span><span class="default">strlen</span><span class="keyword">(</span><span class="default">hash</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">algorithm</span><span class="keyword">, </span><span class="string">""</span><span class="keyword">, </span><span class="default">true</span><span class="keyword">));<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$block_count </span><span class="keyword">= </span><span class="default">ceil</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">key_length </span><span class="keyword">/ </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">hash_length</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; for (</span><span class="default">$i </span><span class="keyword">= </span><span class="default">1</span><span class="keyword">; </span><span class="default">$i </span><span class="keyword">&lt;= </span><span class="default">$block_count</span><span class="keyword">; </span><span class="default">$i</span><span class="keyword">++) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// $i encoded as 4 bytes, big endian.<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$last </span><span class="keyword">= </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">salt </span><span class="keyword">. </span><span class="default">pack</span><span class="keyword">(</span><span class="string">"N"</span><span class="keyword">, </span><span class="default">$i</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// first iteration<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$last </span><span class="keyword">= </span><span class="default">$xorsum </span><span class="keyword">= </span><span class="default">hash_hmac</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">algorithm</span><span class="keyword">, </span><span class="default">$last</span><span class="keyword">, </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">password</span><span class="keyword">, </span><span class="default">true</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// perform the other $this-&gt;count - 1 iterations<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">for (</span><span class="default">$j </span><span class="keyword">= </span><span class="default">1</span><span class="keyword">; </span><span class="default">$j </span><span class="keyword">&lt; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">count</span><span class="keyword">; </span><span class="default">$j</span><span class="keyword">++) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$xorsum </span><span class="keyword">^= (</span><span class="default">$last </span><span class="keyword">= </span><span class="default">hash_hmac</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">algorithm</span><span class="keyword">, </span><span class="default">$last</span><span class="keyword">, </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">password</span><span class="keyword">, </span><span class="default">true</span><span class="keyword">));<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">output </span><span class="keyword">.= </span><span class="default">$xorsum</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">raw_output</span><span class="keyword">)<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">substr</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">output</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">key_length</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; else<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">bin2hex</span><span class="keyword">(</span><span class="default">substr</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">output</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">key_length</span><span class="keyword">));<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$data </span><span class="keyword">= array(</span><span class="string">'algorithm' </span><span class="keyword">=&gt; </span><span class="default">$algorithm</span><span class="keyword">, </span><span class="string">'password' </span><span class="keyword">=&gt; </span><span class="default">$password</span><span class="keyword">, </span><span class="string">'salt' </span><span class="keyword">=&gt; </span><span class="default">$salt</span><span class="keyword">, </span><span class="string">'count' </span><span class="keyword">=&gt; </span><span class="default">$count</span><span class="keyword">, </span><span class="string">'key_length' </span><span class="keyword">=&gt; </span><span class="default">$key_length</span><span class="keyword">, </span><span class="string">'raw_output' </span><span class="keyword">=&gt; </span><span class="default">$raw_output</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; try {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$pbkdf2 </span><span class="keyword">= new </span><span class="default">pbkdf2</span><span class="keyword">(</span><span class="default">$data</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">$pbkdf2</span><span class="keyword">-&gt;</span><span class="default">hash</span><span class="keyword">();<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; } catch (</span><span class="default">Exception $e</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; throw </span><span class="default">$e</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; }<br />
}</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="113451""></a>
  <div class="note">
   <strong class="user">comrade-gnarnav</strong>
   <a href="#113451" class="date">12-Oct-2013 09:19</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Note: length is not an optional parameter:<br />
<span class="default">&lt;?php<br />
hash_pbkdf2</span><span class="keyword">(</span><span class="string">'sha256'</span><span class="keyword">,</span><span class="default">$pass</span><span class="keyword">,</span><span class="default">$salt</span><span class="keyword">,</span><span class="default">100</span><span class="keyword">);<br />
</span><span class="comment">//returns: Warning: hash_pbkdf2(): Length must be greater than or equal to 0: -1273231880<br />
</span><span class="default">?&gt;<br />
</span>Use this instead:<br />
<span class="default">&lt;?php<br />
hash_pbkdf2</span><span class="keyword">(</span><span class="string">'sha256'</span><span class="keyword">,</span><span class="default">$pass</span><span class="keyword">,</span><span class="default">$salt</span><span class="keyword">,</span><span class="default">100</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">);<br />
</span><span class="comment">//Works as expected.<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="112691""></a>
  <div class="note">
   <strong class="user">Anonymous</strong>
   <a href="#112691" class="date">14-Jul-2013 01:29</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Sadly this function was added in PHP 5.5 but many webservers just provide PHP 5.3. But there exists a pure PHP implementation (found here: https://defuse.ca/php-pbkdf2.htm).<br />
I took this implementation, put it into a class with comments for PHPDoc and added a switch so that the native PHP function is used if available.<br />
<br />
Feel free to use it!<br />
<a href="http://pastebin.com/f5PDq735" rel="nofollow" target="_blank">http://pastebin.com/f5PDq735</a><br />
(Posted on pastebin.com since the text would have been too long)</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
</div>
</div>
<hr /><div class="manualnavbar" style="text-align: center;">
 <div class="prev" style="text-align: left; float: left;"><a href="function.hash-init.html">hash_init</a></div>
 <div class="next" style="text-align: right; float: right;"><a href="function.hash-update-file.html">hash_update_file</a></div>
 <div class="up"><a href="ref.hash.html">Hash 関数</a></div>
 <div class="home"><a href="index.html">PHP Manual</a></div>
</div></body></html>
