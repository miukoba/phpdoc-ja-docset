<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
 <head>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <title>指定されたメールボックスに文字列メッセージを追加する</title>
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <link media="all" rel="stylesheet" type="text/css" href="style.css"/>
 </head>
 <body class="docs"><div class="manualnavbar" style="text-align: center;">
 <div class="prev" style="text-align: left; float: left;"><a href="function.imap-alerts.html">imap_alerts</a></div>
 <div class="next" style="text-align: right; float: right;"><a href="function.imap-base64.html">imap_base64</a></div>
 <div class="up"><a href="ref.imap.html">IMAP 関数</a></div>
 <div class="home"><a href="index.html">PHP Manual</a></div>
</div><hr /><div id="function.imap-append" class="refentry">
 <div class="refnamediv">
  <h1 class="refname">imap_append</h1>
  <p class="verinfo">(PHP 4, PHP 5)</p><p class="refpurpose"><span class="refname">imap_append</span> &mdash; <span class="dc-title">指定されたメールボックスに文字列メッセージを追加する</span></p>

 </div>
 <div class="refsect1 description" id="refsect1-function.imap-append-description">
  <h3 class="title">説明</h3>
  <div class="methodsynopsis dc-description">
   <span class="type">bool</span> <span class="methodname"><strong>imap_append</strong></span>
    ( <span class="methodparam"><span class="type">resource</span> <code class="parameter">$imap_stream</code></span>
   , <span class="methodparam"><span class="type">string</span> <code class="parameter">$mailbox</code></span>
   , <span class="methodparam"><span class="type">string</span> <code class="parameter">$message</code></span>
   [, <span class="methodparam"><span class="type">string</span> <code class="parameter">$options</code><span class="initializer"> = <strong><code>NULL</code></strong></span></span>
   [, <span class="methodparam"><span class="type">string</span> <code class="parameter">$internal_date</code><span class="initializer"> = <strong><code>NULL</code></strong></span></span>
  ]] )</div>

  <p class="para rdfs-comment">
   指定したメールボックス <em><code class="parameter">mbox</code></em>
   に文字列メッセージ <em><code class="parameter">message</code></em> を追加します。
  </p>
 </div>

 <div class="refsect1 parameters" id="refsect1-function.imap-append-parameters">
  <h3 class="title">パラメータ</h3>
  <p class="para">
   <dl>

    <dt>
<span class="term"><em><code class="parameter">
imap_stream</code></em></span><dd>
<p class="para"> <span class="function"><a href="function.imap-open.html" class="function">imap_open()</a></span>
が返す IMAP ストリーム。</p></dd>
</dt>

    <dt>

     <span class="term"><em><code class="parameter">mailbox</code></em></span>
     <dd>

      <p class="para">
       メールボックスの名前。詳細は  <span class="function"><a href="function.imap-open.html" class="function">imap_open()</a></span>
       を参照ください。
      </p>
     </dd>

    </dt>

    <dt>

     <span class="term"><em><code class="parameter">message</code></em></span>
     <dd>

      <p class="para">
       追加したいメッセージを表す文字列。
      </p>
      <p class="para">
       Cyrus IMAP サーバーと通信する際には、改行コードとして &quot;\n&quot; のかわりに
       &quot;\r\n&quot; を使用する必要があります。さもなくば、操作は失敗します。
      </p>
     </dd>

    </dt>

    <dt>

     <span class="term"><em><code class="parameter">options</code></em></span>
     <dd>

      <p class="para">
       指定した場合は、
       <em><code class="parameter">options</code></em> もそのメールボックスに書きこまれます。
      </p>
     </dd>

    </dt>

    <dt>

     <span class="term"><em><code class="parameter">internal_date</code></em></span>
     <dd>

      <p class="para">
       このパラメータが設定されていると、追加したメッセージに INTERNALDATE を設定します。
       このパラメータは、rfc2060 の日付時刻値の仕様を満たす文字列でなければなりません。
      </p>
     </dd>

    </dt>

   </dl>

  </p>
 </div>

 <div class="refsect1 returnvalues" id="refsect1-function.imap-append-returnvalues">
  <h3 class="title">返り値</h3>
  <p class="para">
   成功した場合に <strong><code>TRUE</code></strong> を、失敗した場合に <strong><code>FALSE</code></strong> を返します。
  </p>
 </div>

 
 <div class="refsect1 changelog" id="refsect1-function.imap-append-changelog">
  <h3 class="title">変更履歴</h3>
  <p class="para">
   <table class="doctable informaltable">
    
     <thead>
      <tr>
       <th>バージョン</th>
       <th>説明</th>
      </tr>

     </thead>

     <tbody class="tbody">
      <tr>
       <td>5.3.2</td>
       <td>
        INTERNALDATE のサポートが追加されました。
       </td>
      </tr>

     </tbody>
    
   </table>

  </p>
 </div>

 
 <div class="refsect1 examples" id="refsect1-function.imap-append-examples">
  <h3 class="title">例</h3>
  <p class="para">
   <div class="example" id="example-3334">
    <p><strong>例1  <span class="function"><strong>imap_append()</strong></span> の例</strong></p>
    <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br />$stream&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">imap_open</span><span style="color: #007700">(</span><span style="color: #DD0000">"{imap.example.org}INBOX.Drafts"</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">"username"</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">"password"</span><span style="color: #007700">);<br /><br /></span><span style="color: #0000BB">$check&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">imap_check</span><span style="color: #007700">(</span><span style="color: #0000BB">$stream</span><span style="color: #007700">);<br />echo&nbsp;</span><span style="color: #DD0000">"Msg&nbsp;Count&nbsp;before&nbsp;append:&nbsp;"</span><span style="color: #007700">.&nbsp;</span><span style="color: #0000BB">$check</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">Nmsgs&nbsp;</span><span style="color: #007700">.&nbsp;</span><span style="color: #DD0000">"\n"</span><span style="color: #007700">;<br /><br /></span><span style="color: #0000BB">imap_append</span><span style="color: #007700">(</span><span style="color: #0000BB">$stream</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">"{imap.example.org}INBOX.Drafts"<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">"From:&nbsp;me@example.com\r\n"<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">.&nbsp;</span><span style="color: #DD0000">"To:&nbsp;you@example.com\r\n"<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">.&nbsp;</span><span style="color: #DD0000">"Subject:&nbsp;test\r\n"<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">.&nbsp;</span><span style="color: #DD0000">"\r\n"<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">.&nbsp;</span><span style="color: #DD0000">"this&nbsp;is&nbsp;a&nbsp;test&nbsp;message,&nbsp;please&nbsp;ignore\r\n"<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">);<br /><br /></span><span style="color: #0000BB">$check&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">imap_check</span><span style="color: #007700">(</span><span style="color: #0000BB">$stream</span><span style="color: #007700">);<br />echo&nbsp;</span><span style="color: #DD0000">"Msg&nbsp;Count&nbsp;after&nbsp;append&nbsp;:&nbsp;"</span><span style="color: #007700">.&nbsp;</span><span style="color: #0000BB">$check</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">Nmsgs&nbsp;</span><span style="color: #007700">.&nbsp;</span><span style="color: #DD0000">"\n"</span><span style="color: #007700">;<br /><br /></span><span style="color: #0000BB">imap_close</span><span style="color: #007700">(</span><span style="color: #0000BB">$stream</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
    </div>

   </div>
  </p>
 </div>

</div><div id="usernotes">
 <div class="head">
  <h3 class="title">User Contributed Notes</h3>
 </div>
<div id="allnotes">  <a name="111461""></a>
  <div class="note">
   <strong class="user">rixsta at hotmail dot com</strong>
   <a href="#111461" class="date">22-Feb-2013 05:59</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Hi,<br />
<br />
As we have been struggling with this for some time I wanted to share how we got imap_append working properly with all MIME parts including attachments.&nbsp; If you are sending email and also wish to append the sent message to the Sent Items folder, I cannot think of an easier way to do this, as follows:<br />
<br />
1) Use SwiftMailer to send the message via PHP.<br />
$message = Swift_Message::newInstance("Subject goes here");<br />
(then add from, to, body, attachments etc)<br />
$result = $mailer-&gt;send($message);<br />
<br />
2) When you construct the message in step 1) above save it to a variable as follows:<br />
<br />
$msg = $message-&gt;toString(); (this creates the full MIME message required for imap_append()!!&nbsp; After this you can call imap_append like this:<br />
<br />
imap_append($imap_conn,$mail_box,$msg."\r\n","\\Seen");<br />
<br />
I hope this helps the readers, and prevents saves people from doing what we started doing - hand crafting the MIME messages :-0</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="111323""></a>
  <div class="note">
   <strong class="user">serpent at paradise dot net dot nz</strong>
   <a href="#111323" class="date">07-Feb-2013 05:10</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
We couldn't get this function to work properly with MS-Exchange/IMAP, not because there's a problem with a the function as such, but because MS-Exchange changed the content-type in the header from multipart/[anything] to text/plain in every instance.&nbsp; We set ImapMessagesRetrievalMimeFormat to HtmlAndTextAlternative<br />
on the Exchange server, and that didn't help either.&nbsp; I even tried wrapping the multipart message in a message/rfc822 wrapper and it reached inside the outer message and tweeked the inner message from multipart/alternative to text/plain.<br />
<br />
Messages emailed to the mbox were unaffected, I suggest you try that route instead, and move the relevant messages to where you want them.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="106637""></a>
  <div class="note">
   <strong class="user">bill at dyndns dot org</strong>
   <a href="#106637" class="date">23-Nov-2011 08:45</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Here is how I used this function with an attachment. I used examples from everyone else but made it easier and cleaner to change.<br />
<br />
<span class="default">&lt;?php<br />
$authhost</span><span class="keyword">=</span><span class="string">"{000.000.000.000:993/validate-cert/ssl}Drafts"</span><span class="keyword">;<br />
<br />
</span><span class="default">$user</span><span class="keyword">=</span><span class="string">"sadasd"</span><span class="keyword">;<br />
</span><span class="default">$pass</span><span class="keyword">=</span><span class="string">"sadasd"</span><span class="keyword">;<br />
<br />
if (</span><span class="default">$mbox</span><span class="keyword">=</span><span class="default">imap_open</span><span class="keyword">( </span><span class="default">$authhost</span><span class="keyword">, </span><span class="default">$user</span><span class="keyword">, </span><span class="default">$pass</span><span class="keyword">))<br />
{<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$dmy</span><span class="keyword">=</span><span class="default">date</span><span class="keyword">(</span><span class="string">"d-M-Y H:i:s"</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$filename</span><span class="keyword">=</span><span class="string">"filename.pdf"</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$attachment </span><span class="keyword">= </span><span class="default">chunk_split</span><span class="keyword">(</span><span class="default">base64_encode</span><span class="keyword">(</span><span class="default">$filestring</span><span class="keyword">));<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$boundary </span><span class="keyword">= </span><span class="string">"------="</span><span class="keyword">.</span><span class="default">md5</span><span class="keyword">(</span><span class="default">uniqid</span><span class="keyword">(</span><span class="default">rand</span><span class="keyword">()));<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$msg </span><span class="keyword">= (</span><span class="string">"From: Somebody\r\n"<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">. </span><span class="string">"To: test@example.co.uk\r\n"<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">. </span><span class="string">"Date: </span><span class="default">$dmy</span><span class="string">\r\n"<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">. </span><span class="string">"Subject: This is the subject\r\n"<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">. </span><span class="string">"MIME-Version: 1.0\r\n"<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">. </span><span class="string">"Content-Type: multipart/mixed; boundary=\"</span><span class="default">$boundary</span><span class="string">\"\r\n"<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">. </span><span class="string">"\r\n\r\n"<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">. </span><span class="string">"--</span><span class="default">$boundary</span><span class="string">\r\n"<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">. </span><span class="string">"Content-Type: text/html;\r\n\tcharset=\"ISO-8859-1\"\r\n"<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">. </span><span class="string">"Content-Transfer-Encoding: 8bit \r\n"<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">. </span><span class="string">"\r\n\r\n"<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">. </span><span class="string">"Hello this is a test\r\n"<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">. </span><span class="string">"\r\n\r\n"<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">. </span><span class="string">"--</span><span class="default">$boundary</span><span class="string">\r\n"<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">. </span><span class="string">"Content-Transfer-Encoding: base64\r\n"<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">. </span><span class="string">"Content-Disposition: attachment; filename=\"</span><span class="default">$filename</span><span class="string">\"\r\n"<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">. </span><span class="string">"\r\n" </span><span class="keyword">. </span><span class="default">$attachment </span><span class="keyword">. </span><span class="string">"\r\n"<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">. </span><span class="string">"\r\n\r\n\r\n"<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">. </span><span class="string">"--</span><span class="default">$boundary</span><span class="string">--\r\n\r\n"</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; </span><span class="default">imap_append</span><span class="keyword">(</span><span class="default">$mbox</span><span class="keyword">,</span><span class="default">$authhost</span><span class="keyword">,</span><span class="default">$msg</span><span class="keyword">, </span><span class="string">"\\Draft"</span><span class="keyword">); <br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">imap_close</span><span class="keyword">(</span><span class="default">$mbox</span><span class="keyword">);<br />
}<br />
else<br />
{<br />
&nbsp;&nbsp;&nbsp; echo </span><span class="string">"&lt;h1&gt;FAIL!&lt;/h1&gt;\n"</span><span class="keyword">;<br />
}<br />
<br />
</span><span class="default">?&gt;<br />
</span><br />
Hope this helps someone.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="105303""></a>
  <div class="note">
   <strong class="user">Tigggger</strong>
   <a href="#105303" class="date">08-Aug-2011 06:30</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I encountered 3 problems when attempting to get my server to copy messages to the sent folder.<br />
<br />
1. Wouldn't login until I added /novalidate-cert<br />
2. No code example of getting the date sent<br />
3. Including an attachment<br />
<br />
Hope this code helps others<br />
<br />
<span class="default">&lt;?php<br />
$dmy</span><span class="keyword">=</span><span class="default">date</span><span class="keyword">(</span><span class="string">"d-M-Y H:i:s"</span><span class="keyword">);<br />
</span><span class="default">$dmy</span><span class="keyword">.= </span><span class="string">" +0100"</span><span class="keyword">; </span><span class="comment">// Had to do this bit manually as server and me are in different timezones<br />
</span><span class="default">$stream</span><span class="keyword">=@</span><span class="default">imap_open</span><span class="keyword">(</span><span class="string">"{mail.example.com/novalidate-cert}INBOX.Sent"</span><span class="keyword">, </span><span class="string">"username"</span><span class="keyword">, </span><span class="string">"password"</span><span class="keyword">);<br />
</span><span class="default">$boundary </span><span class="keyword">= </span><span class="string">"------="</span><span class="keyword">.</span><span class="default">md5</span><span class="keyword">(</span><span class="default">uniqid</span><span class="keyword">(</span><span class="default">rand</span><span class="keyword">()));<br />
</span><span class="default">$header </span><span class="keyword">= </span><span class="string">"MIME-Version: 1.0\r\n"</span><span class="keyword">;<br />
</span><span class="default">$header </span><span class="keyword">.= </span><span class="string">"Content-Type: multipart/mixed; boundary=\"</span><span class="default">$boundary</span><span class="string">\"\r\n"</span><span class="keyword">;<br />
</span><span class="default">$header </span><span class="keyword">.= </span><span class="string">"\r\n"</span><span class="keyword">;<br />
</span><span class="default">$file</span><span class="keyword">=</span><span class="string">"../path_to/filename.pdf"</span><span class="keyword">;<br />
</span><span class="default">$filename</span><span class="keyword">=</span><span class="string">"filename.pdf"</span><span class="keyword">;<br />
</span><span class="default">$ouv</span><span class="keyword">=</span><span class="default">fopen </span><span class="keyword">(</span><span class="string">"</span><span class="default">$file</span><span class="string">"</span><span class="keyword">, </span><span class="string">"rb"</span><span class="keyword">);</span><span class="default">$lir</span><span class="keyword">=</span><span class="default">fread </span><span class="keyword">(</span><span class="default">$ouv</span><span class="keyword">, </span><span class="default">filesize </span><span class="keyword">(</span><span class="string">"</span><span class="default">$file</span><span class="string">"</span><span class="keyword">));</span><span class="default">fclose<br />
</span><span class="keyword">(</span><span class="default">$ouv</span><span class="keyword">);<br />
</span><span class="default">$attachment </span><span class="keyword">= </span><span class="default">chunk_split</span><span class="keyword">(</span><span class="default">base64_encode</span><span class="keyword">(</span><span class="default">$lir</span><span class="keyword">));<br />
</span><span class="default">$msg2 </span><span class="keyword">.= </span><span class="string">"--</span><span class="default">$boundary</span><span class="string">\r\n"</span><span class="keyword">;<br />
</span><span class="default">$msg2 </span><span class="keyword">.= </span><span class="string">"Content-Transfer-Encoding: base64\r\n"</span><span class="keyword">;<br />
</span><span class="default">$msg2 </span><span class="keyword">.= </span><span class="string">"Content-Disposition: attachment; filename=\"</span><span class="default">$filename</span><span class="string">\"\r\n"</span><span class="keyword">;<br />
</span><span class="default">$msg2 </span><span class="keyword">.= </span><span class="string">"\r\n"</span><span class="keyword">;<br />
</span><span class="default">$msg2 </span><span class="keyword">.= </span><span class="default">$attachment </span><span class="keyword">. </span><span class="string">"\r\n"</span><span class="keyword">;<br />
</span><span class="default">$msg2 </span><span class="keyword">.= </span><span class="string">"\r\n\r\n"</span><span class="keyword">;<br />
</span><span class="default">$msg3 </span><span class="keyword">.= </span><span class="string">"--</span><span class="default">$boundary</span><span class="string">--\r\n"</span><span class="keyword">;<br />
</span><span class="default">imap_append</span><span class="keyword">(</span><span class="default">$stream</span><span class="keyword">,</span><span class="string">"{mail.example.com/novalidate-cert}INBOX.Sent"</span><span class="keyword">,</span><span class="string">"From: Somebody\r\n"</span><span class="keyword">.</span><span class="string">"To: test@example.co.uk\r\n"</span><span class="keyword">.</span><span class="string">"Date: </span><span class="default">$dmy</span><span class="string">\r\n"</span><span class="keyword">.</span><span class="string">"Subject: This is the subject\r\n"</span><span class="keyword">.</span><span class="string">"</span><span class="default">$header</span><span class="string">\r\n"</span><span class="keyword">.</span><span class="string">"</span><span class="default">$msg2</span><span class="string">\r\n"</span><span class="keyword">.</span><span class="string">"</span><span class="default">$msg3</span><span class="string">\r\n"</span><span class="keyword">);<br />
</span><span class="default">imap_close </span><span class="keyword">(</span><span class="default">$stream</span><span class="keyword">);<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="99407""></a>
  <div class="note">
   <strong class="user">kaminski at istori dot com</strong>
   <a href="#99407" class="date">16-Aug-2010 05:52</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
The date format string to use when creating $internal_date is 'd-M-Y H:i:s O'.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="80951""></a>
  <div class="note">
   <strong class="user">chris at sma-sportsmgmt dot com</strong>
   <a href="#80951" class="date">08-Feb-2008 08:06</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I spend most of today refining the example to make it work properly when saving to the Inbox.Sent folder.<br />
<br />
The append command now looks like:<br />
<br />
&nbsp;&nbsp;&nbsp; $return = imap_append($stream,$mailbox_addr<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; , "From: $fromReply\r\n"<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; . "To: $to\r\n"<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; . "Subject: $subject\r\n"<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; . "Date: $now&nbsp; \r\n"<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; . "X-Mailer: Cmail_v2.0 \r\n"<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; . "X-Originating-IP: $ip_addr \r\n"<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; . "MIME-Version: 1 \r\n"<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; . "Content-Type: text/html;\r\n\tcharset=\"ISO-8859-1\"\r\n"<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; . "Content-Transfer-Encoding: 8bit \r\n"<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; . "\r\n\r\n"<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; . "$wk_msg\r\n"<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; );<br />
<br />
This inserts the current date into the email and lets it support html content. The one thing that I haven't got working yet is including attachments. I presumably have to make the boundaries and attachment content part of the message body.<br />
<br />
Chris</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="74907""></a>
  <div class="note">
   <strong class="user">jille at DIESPAMMERShexon dot cx</strong>
   <a href="#74907" class="date">03-May-2007 04:36</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
The last argument, $options, are flags like for use with imap_setflag_full.<br />
It took a while before I found out</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="72397""></a>
  <div class="note">
   <strong class="user">svicentemolina at gmail dot com</strong>
   <a href="#72397" class="date">17-Jan-2007 04:57</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I have used this function to copy all the emails of one account from one server to another. The problem was that this function don't copy the original receiving date for each message.<br />
To add a fifth field to provide the date, I have made some changes at some php source files following the steps described in <a href="http://www.zend.com/lists/php-dev/200303/msg00843.html and it has worked fine." rel="nofollow" target="_blank">http://www.zend.com/lists/php-dev/200303/msg00843.html and it has worked fine.</a><br />
The correct date format is the returned by the function mail_date in c-client/mail.c source file, for instance: "17-Jan-2007 10:00:01 +0100"</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="33356""></a>
  <div class="note">
   <strong class="user">bithive</strong>
   <a href="#33356" class="date">24-Jun-2003 12:26</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
The parameter description is misleading.&nbsp; You can pass a string of flags such as '\Seen' [see imap_setflag_full()] as the last argument.&nbsp; In the other imap functions, 'options' seems to usually refer to a bitmask, not message flags.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="31651""></a>
  <div class="note">
   <strong class="user">michel dot jansens at ulb dot ac dot be</strong>
   <a href="#31651" class="date">29-Apr-2003 04:29</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I use imap_append() to decode message/rfc822 attachments type(embedded emails):<br />
<br />
$attachment = imap_fetchbody($mbox,$mailuid,$atpos,FT_UID);<br />
$attachment = imap_base64($attachment);<br />
$res =&nbsp; imap_append($mbox,mboxspec("INBOX"),$attachment);<br />
//the embedded email is now a normal mail in my INBOX</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="22244""></a>
  <div class="note">
   <strong class="user">bluebiru78 at hotmail dot com</strong>
   <a href="#22244" class="date">12-Jun-2002 09:24</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
i used imap_append to copy any composed message into INBOX.Sent folder..<br />
<br />
$app = imap_append($stream,"{" . $connectstring . "}INBOX.Sent","$header\r\n" ."$mbody\r\n");<br />
<br />
if (!$app) {<br />
&nbsp;error("Email copying to Sent folder FAILED!");<br />
}</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="14467""></a>
  <div class="note">
   <strong class="user">owain at vaughan dot com</strong>
   <a href="#14467" class="date">01-Aug-2001 03:49</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
With SIMS IMAP server you also need to use \r\n as a line terminator, otherwise you will be able to add all the header lines correctly, but the body of the message will not be saved.&lt;br&gt;<br />
You can use \n by itself for each header line, but when creating the blank line between the headers and the body you must use \r\n\r\n</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="1618""></a>
  <div class="note">
   <strong class="user">jesper at angelo dot dk</strong>
   <a href="#1618" class="date">14-Sep-1999 06:13</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Please observe that imap_append() do not support NNTP posting. Use fsockopen() instead, and do the work yourself.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
</div>
</div>
<hr /><div class="manualnavbar" style="text-align: center;">
 <div class="prev" style="text-align: left; float: left;"><a href="function.imap-alerts.html">imap_alerts</a></div>
 <div class="next" style="text-align: right; float: right;"><a href="function.imap-base64.html">imap_base64</a></div>
 <div class="up"><a href="ref.imap.html">IMAP 関数</a></div>
 <div class="home"><a href="index.html">PHP Manual</a></div>
</div></body></html>
