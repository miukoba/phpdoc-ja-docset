<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
 <head>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <title>スクリプト中の日付/時刻関数で使用されるデフォルトタイムゾーンを設定する</title>
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <link media="all" rel="stylesheet" type="text/css" href="style.css"/>
 </head>
 <body class="docs"><div class="manualnavbar" style="text-align: center;">
 <div class="prev" style="text-align: left; float: left;"><a href="function.date-default-timezone-get.html">date_default_timezone_get</a></div>
 <div class="next" style="text-align: right; float: right;"><a href="function.date-diff.html">date_diff</a></div>
 <div class="up"><a href="ref.datetime.html">日付・時刻 関数</a></div>
 <div class="home"><a href="index.html">PHP Manual</a></div>
</div><hr /><div id="function.date-default-timezone-set" class="refentry">
 <div class="refnamediv">
  <h1 class="refname">date_default_timezone_set</h1>
  <p class="verinfo">(PHP 5 &gt;= 5.1.0)</p><p class="refpurpose"><span class="refname">date_default_timezone_set</span> &mdash; <span class="dc-title">
   スクリプト中の日付/時刻関数で使用されるデフォルトタイムゾーンを設定する
  </span></p>

 </div>
 <div class="refsect1 description" id="refsect1-function.date-default-timezone-set-description">
  <h3 class="title">説明</h3>
  <div class="methodsynopsis dc-description">
   <span class="type">bool</span> <span class="methodname"><strong>date_default_timezone_set</strong></span>
    ( <span class="methodparam"><span class="type">string</span> <code class="parameter">$timezone_identifier</code></span>
   )</div>

  <p class="para rdfs-comment">
    <span class="function"><strong>date_default_timezone_set()</strong></span> は、日付/時刻関数で
   使用されるデフォルトタイムゾーンを設定します。
  </p>
  <blockquote class="note"><p><strong class="note">注意</strong>: 
   <p class="para">
    PHP 5.1.0 以降（日付/時刻 関数が書き直されてから）、タイムゾーンを
    正しく設定せずに日付/時刻関数をコールすると <strong><code>E_NOTICE</code></strong>
    が発生し、またシステムの設定や <var class="varname"><var class="varname">TZ</var></var> 環境変数を
    使用すると <strong><code>E_WARNING</code></strong>
    が発生するようになりました。
   </p>
  </p></blockquote>
  <p class="para">
   スクリプト内でこの関数を使用してデフォルトタイムゾーンを設定するかわりに、
   INI 設定 <a href="datetime.configuration.html#ini.date.timezone" class="link">date.timezone</a>
   でデフォルトタイムゾーンを設定することもできます。
  </p>
 </div>

 
 <div class="refsect1 parameters" id="refsect1-function.date-default-timezone-set-parameters">
  <h3 class="title">パラメータ</h3>
  <p class="para">
   <dl>

    <dt>

     <span class="term"><em><code class="parameter">timezone_identifier</code></em></span>
     <dd>

      <p class="para">
       タイムゾーン ID 。例えば <em>UTC</em> や
       <em>Europe/Lisbon</em> など。有効な ID の一覧は
       <a href="timezones.html" class="xref">サポートされるタイムゾーンのリスト</a> にあります。
      </p>
     </dd>

    </dt>

   </dl>

  </p>
 </div>


 <div class="refsect1 returnvalues" id="refsect1-function.date-default-timezone-set-returnvalues">
  <h3 class="title">返り値</h3>
  <p class="para">
   この関数は、<em><code class="parameter">timezone_identifier</code></em> が
   無効なものである場合に <strong><code>FALSE</code></strong>、それ以外の場合に
   <strong><code>TRUE</code></strong> を返します。
  </p>
 </div>


 <div class="refsect1 examples" id="refsect1-function.date-default-timezone-set-examples">
  <h3 class="title">例</h3>
  <p class="para">
   <div class="example" id="example-2286">
    <p><strong>例1 デフォルトのタイムゾーンの取得</strong></p>
    <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br />date_default_timezone_set</span><span style="color: #007700">(</span><span style="color: #DD0000">'America/Los_Angeles'</span><span style="color: #007700">);<br /><br /></span><span style="color: #0000BB">$script_tz&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">date_default_timezone_get</span><span style="color: #007700">();<br /><br />if&nbsp;(</span><span style="color: #0000BB">strcmp</span><span style="color: #007700">(</span><span style="color: #0000BB">$script_tz</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">ini_get</span><span style="color: #007700">(</span><span style="color: #DD0000">'date.timezone'</span><span style="color: #007700">))){<br />&nbsp;&nbsp;&nbsp;&nbsp;echo&nbsp;</span><span style="color: #DD0000">'Script&nbsp;timezone&nbsp;differs&nbsp;from&nbsp;ini-set&nbsp;timezone.'</span><span style="color: #007700">;<br />}&nbsp;else&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;echo&nbsp;</span><span style="color: #DD0000">'Script&nbsp;timezone&nbsp;and&nbsp;ini-set&nbsp;timezone&nbsp;match.'</span><span style="color: #007700">;<br />}<br /></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
    </div>

   </div>
  </p>
 </div>


 <div class="refsect1 changelog" id="refsect1-function.date-default-timezone-set-changelog">
  <h3 class="title">変更履歴</h3>
  <p class="para">
   <table class="doctable informaltable">
    
     <thead>
      <tr>
       <th>バージョン</th>
       <th>説明</th>
      </tr>

     </thead>

     <tbody class="tbody">
      <tr>
       <td>5.3.0</td>
       <td>
        <strong><code>E_STRICT</code></strong> ではなく
        <strong><code>E_WARNING</code></strong> をスローするようになりました。
       </td>
      </tr>

      <tr>
       <td>5.1.2</td>
       <td>
        <em><code class="parameter">timezone_identifier</code></em> パラメータの内容を
        検証するようになりました。
       </td>
      </tr>

     </tbody>
    
   </table>

  </p>
 </div>


 <div class="refsect1 seealso" id="refsect1-function.date-default-timezone-set-seealso">
  <h3 class="title">参考</h3>
  <p class="para">
   <ul class="simplelist">
    <li class="member"> <span class="function"><a href="function.date-default-timezone-get.html" class="function" rel="rdfs-seeAlso">date_default_timezone_get()</a> - スクリプト中の日付/時刻関数で使用されるデフォルトタイムゾーンを取得する</span></li>
    <li class="member"><a href="timezones.html" class="xref">サポートされるタイムゾーンのリスト</a></li>
   </ul>
  </p>
 </div>

</div><div id="usernotes">
 <div class="head">
  <h3 class="title">User Contributed Notes</h3>
 </div>
<div id="allnotes">  <a name="113864""></a>
  <div class="note">
   <strong class="user">chris at clwill dot com</strong>
   <a href="#113864" class="date">11-Dec-2013 08:54</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I'm sure I'm not the only one who is distressed by the recent default behavior change to E_NOTICE when the timezone isn't explicitly set in the program or in .ini.&nbsp; I insure that the clock on the server IS correct, and I don't want to have to set it in two places (the system AND PHP).&nbsp; So I want to read it from the system.&nbsp; But PHP won't accept that answer, and insists on a call to this function.&nbsp; So, here's my answer:<br />
<br />
<span class="default">&lt;?php<br />
&nbsp;</span><span class="keyword">function </span><span class="default">setTimezone</span><span class="keyword">(</span><span class="default">$default</span><span class="keyword">) {<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$timezone </span><span class="keyword">= </span><span class="string">""</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">// On many systems (Mac, for instance) "/etc/localtime" is a symlink<br />
&nbsp;&nbsp;&nbsp; // to the file with the timezone info<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">if (</span><span class="default">is_link</span><span class="keyword">(</span><span class="string">"/etc/localtime"</span><span class="keyword">)) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// If it is, that file's name is actually the "Olsen" format timezone<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$filename </span><span class="keyword">= </span><span class="default">readlink</span><span class="keyword">(</span><span class="string">"/etc/localtime"</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$pos </span><span class="keyword">= </span><span class="default">strpos</span><span class="keyword">(</span><span class="default">$filename</span><span class="keyword">, </span><span class="string">"zoneinfo"</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">$pos</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// When it is, it's in the "/usr/share/zoneinfo/" folder<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$timezone </span><span class="keyword">= </span><span class="default">substr</span><span class="keyword">(</span><span class="default">$filename</span><span class="keyword">, </span><span class="default">$pos </span><span class="keyword">+ </span><span class="default">strlen</span><span class="keyword">(</span><span class="string">"zoneinfo/"</span><span class="keyword">));<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; } else {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// If not, bail<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$timezone </span><span class="keyword">= </span><span class="default">$default</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; else {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// On other systems, like Ubuntu, there's file with the Olsen time<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; // right inside it.<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$timezone </span><span class="keyword">= </span><span class="default">file_get_contents</span><span class="keyword">(</span><span class="string">"/etc/timezone"</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if (!</span><span class="default">strlen</span><span class="keyword">(</span><span class="default">$timezone</span><span class="keyword">)) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$timezone </span><span class="keyword">= </span><span class="default">$default</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">date_default_timezone_set</span><span class="keyword">(</span><span class="default">$timezone</span><span class="keyword">);<br />
&nbsp;}<br />
</span><span class="default">?&gt;<br />
</span><br />
Use it by calling it with a fallback default answer.<br />
<br />
Yes, I know it doesn't work on Windows.&nbsp; Neither do I :)&nbsp; Perhaps someone wants to add that functionality.<br />
<br />
Hope this helps someone.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="111624""></a>
  <div class="note">
   <strong class="user">Christopher Kramer</strong>
   <a href="#111624" class="date">10-Mar-2013 06:39</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Regarding my post 3 years before:<br />
The performance impact seems to be caused by the fact that a log message is written if you do not set a timezone. And writing a log message to disk can take significantly longer than actually calculating date() or getdate() - esp. on systems with slow IO like the Windows machine I used 3 years ago.<br />
<br />
PHP 4 did not produce any log messages, and therefore was as fast as PHP5 with a timezone set.<br />
<br />
So if you run date() or getdate() a lot of times, this will cause a lot of log messages to be written to disk (if you did not disable them in your php.ini settings), which will take its time.<br />
<br />
So either use this function or set the ini-setting "date.timezone" to make things faster.<br />
(And have a look into your logfiles! Solving all those warnings will not only save you disk space but will also speed up your web application.)</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="109321""></a>
  <div class="note">
   <strong class="user">Pierre Gourlaouen</strong>
   <a href="#109321" class="date">06-Jul-2012 05:45</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
A simple method for conversation between two time zone.<br />
<br />
<span class="default">&lt;?php<br />
$date </span><span class="keyword">= new </span><span class="default">DateTime</span><span class="keyword">(</span><span class="string">"2012-07-05 16:43:21"</span><span class="keyword">, new </span><span class="default">DateTimeZone</span><span class="keyword">(</span><span class="string">'Europe/Paris'</span><span class="keyword">));<br />
<br />
</span><span class="default">date_default_timezone_set</span><span class="keyword">(</span><span class="string">'America/New_York'</span><span class="keyword">);<br />
<br />
echo </span><span class="default">date</span><span class="keyword">(</span><span class="string">"Y-m-d h:iA"</span><span class="keyword">, </span><span class="default">$date</span><span class="keyword">-&gt;</span><span class="default">format</span><span class="keyword">(</span><span class="string">'U'</span><span class="keyword">));<br />
<br />
</span><span class="comment">// 2012-07-05 10:43AM<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="107297""></a>
  <div class="note">
   <strong class="user">daneiracleous at gmail dot com</strong>
   <a href="#107297" class="date">28-Jan-2012 05:11</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If you want to set the default timezone to the user's local timezone, you have to combine PHP and JavaScript. Here's how to do it:<br />
<br />
<span class="default">&lt;?php<br />
session_start</span><span class="keyword">();<br />
if(!isset(</span><span class="default">$_SESSION</span><span class="keyword">[</span><span class="string">'timezone'</span><span class="keyword">]))<br />
{<br />
&nbsp;&nbsp;&nbsp; if(!isset(</span><span class="default">$_REQUEST</span><span class="keyword">[</span><span class="string">'offset'</span><span class="keyword">]))<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">?&gt;<br />
</span>&nbsp; &nbsp; &lt;script&gt;<br />
&nbsp;&nbsp;&nbsp; var d = new Date()<br />
&nbsp;&nbsp;&nbsp; var offset= -d.getTimezoneOffset()/60;<br />
&nbsp;&nbsp;&nbsp; location.href = "<span class="default">&lt;?php </span><span class="keyword">echo </span><span class="default">$_SERVER</span><span class="keyword">[</span><span class="string">'PHP_SELF'</span><span class="keyword">]; </span><span class="default">?&gt;</span>?offset="+offset;<br />
&nbsp;&nbsp;&nbsp; &lt;/script&gt;<br />
&nbsp;&nbsp;&nbsp; <span class="default">&lt;?php&nbsp; &nbsp; <br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">}<br />
&nbsp;&nbsp;&nbsp; else<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$zonelist </span><span class="keyword">= array(</span><span class="string">'Kwajalein' </span><span class="keyword">=&gt; -</span><span class="default">12.00</span><span class="keyword">, </span><span class="string">'Pacific/Midway' </span><span class="keyword">=&gt; -</span><span class="default">11.00</span><span class="keyword">, </span><span class="string">'Pacific/Honolulu' </span><span class="keyword">=&gt; -</span><span class="default">10.00</span><span class="keyword">, </span><span class="string">'America/Anchorage' </span><span class="keyword">=&gt; -</span><span class="default">9.00</span><span class="keyword">, </span><span class="string">'America/Los_Angeles' </span><span class="keyword">=&gt; -</span><span class="default">8.00</span><span class="keyword">, </span><span class="string">'America/Denver' </span><span class="keyword">=&gt; -</span><span class="default">7.00</span><span class="keyword">, </span><span class="string">'America/Tegucigalpa' </span><span class="keyword">=&gt; -</span><span class="default">6.00</span><span class="keyword">, </span><span class="string">'America/New_York' </span><span class="keyword">=&gt; -</span><span class="default">5.00</span><span class="keyword">, </span><span class="string">'America/Caracas' </span><span class="keyword">=&gt; -</span><span class="default">4.30</span><span class="keyword">, </span><span class="string">'America/Halifax' </span><span class="keyword">=&gt; -</span><span class="default">4.00</span><span class="keyword">, </span><span class="string">'America/St_Johns' </span><span class="keyword">=&gt; -</span><span class="default">3.30</span><span class="keyword">, </span><span class="string">'America/Argentina/Buenos_Aires' </span><span class="keyword">=&gt; -</span><span class="default">3.00</span><span class="keyword">, </span><span class="string">'America/Sao_Paulo' </span><span class="keyword">=&gt; -</span><span class="default">3.00</span><span class="keyword">, </span><span class="string">'Atlantic/South_Georgia' </span><span class="keyword">=&gt; -</span><span class="default">2.00</span><span class="keyword">, </span><span class="string">'Atlantic/Azores' </span><span class="keyword">=&gt; -</span><span class="default">1.00</span><span class="keyword">, </span><span class="string">'Europe/Dublin' </span><span class="keyword">=&gt; </span><span class="default">0</span><span class="keyword">, </span><span class="string">'Europe/Belgrade' </span><span class="keyword">=&gt; </span><span class="default">1.00</span><span class="keyword">, </span><span class="string">'Europe/Minsk' </span><span class="keyword">=&gt; </span><span class="default">2.00</span><span class="keyword">, </span><span class="string">'Asia/Kuwait' </span><span class="keyword">=&gt; </span><span class="default">3.00</span><span class="keyword">, </span><span class="string">'Asia/Tehran' </span><span class="keyword">=&gt; </span><span class="default">3.30</span><span class="keyword">, </span><span class="string">'Asia/Muscat' </span><span class="keyword">=&gt; </span><span class="default">4.00</span><span class="keyword">, </span><span class="string">'Asia/Yekaterinburg' </span><span class="keyword">=&gt; </span><span class="default">5.00</span><span class="keyword">, </span><span class="string">'Asia/Kolkata' </span><span class="keyword">=&gt; </span><span class="default">5.30</span><span class="keyword">, </span><span class="string">'Asia/Katmandu' </span><span class="keyword">=&gt; </span><span class="default">5.45</span><span class="keyword">, </span><span class="string">'Asia/Dhaka' </span><span class="keyword">=&gt; </span><span class="default">6.00</span><span class="keyword">, </span><span class="string">'Asia/Rangoon' </span><span class="keyword">=&gt; </span><span class="default">6.30</span><span class="keyword">, </span><span class="string">'Asia/Krasnoyarsk' </span><span class="keyword">=&gt; </span><span class="default">7.00</span><span class="keyword">, </span><span class="string">'Asia/Brunei' </span><span class="keyword">=&gt; </span><span class="default">8.00</span><span class="keyword">, </span><span class="string">'Asia/Seoul' </span><span class="keyword">=&gt; </span><span class="default">9.00</span><span class="keyword">, </span><span class="string">'Australia/Darwin' </span><span class="keyword">=&gt; </span><span class="default">9.30</span><span class="keyword">, </span><span class="string">'Australia/Canberra' </span><span class="keyword">=&gt; </span><span class="default">10.00</span><span class="keyword">, </span><span class="string">'Asia/Magadan' </span><span class="keyword">=&gt; </span><span class="default">11.00</span><span class="keyword">, </span><span class="string">'Pacific/Fiji' </span><span class="keyword">=&gt; </span><span class="default">12.00</span><span class="keyword">, </span><span class="string">'Pacific/Tongatapu' </span><span class="keyword">=&gt; </span><span class="default">13.00</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$index </span><span class="keyword">= </span><span class="default">array_keys</span><span class="keyword">(</span><span class="default">$zonelist</span><span class="keyword">, </span><span class="default">$_REQUEST</span><span class="keyword">[</span><span class="string">'offset'</span><span class="keyword">]);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$_SESSION</span><span class="keyword">[</span><span class="string">'timezone'</span><span class="keyword">] = </span><span class="default">$index</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">];<br />
&nbsp;&nbsp;&nbsp; }<br />
}<br />
</span><span class="default">date_default_timezone_set</span><span class="keyword">(</span><span class="default">$_SESSION</span><span class="keyword">[</span><span class="string">'timezone'</span><span class="keyword">]);<br />
<br />
</span><span class="comment">//rest of your code goes here<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="102187""></a>
  <div class="note">
   <strong class="user">power2all at gmail dot com</strong>
   <a href="#102187" class="date">01-Feb-2011 05:30</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
After poundering and knocking my head on the table, I finally got a proper fix for Windows and PHP timezone handling.<br />
<br />
Since Windows applies the DST to ActiveTimeBias in the registry, you only need this to apply.<br />
The only problem is, that it cant use the timezone_set command.<br />
<br />
You can request a response back in any date-format you wish, or use the default one given in the function itself.<br />
<br />
<span class="default">&lt;?php<br />
<br />
</span><span class="comment">// Return proper time<br />
</span><span class="keyword">function </span><span class="default">time_zone_fix</span><span class="keyword">(</span><span class="default">$timeGiven </span><span class="keyword">= </span><span class="string">"H:i:s"</span><span class="keyword">)<br />
{<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$shell </span><span class="keyword">= new </span><span class="default">COM</span><span class="keyword">(</span><span class="string">"WScript.Shell"</span><span class="keyword">) or die(</span><span class="string">"Requires Windows Scripting Host"</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$time_bias </span><span class="keyword">= -(</span><span class="default">$shell</span><span class="keyword">-&gt;</span><span class="default">RegRead</span><span class="keyword">(</span><span class="string">"HKEY_LOCAL_MACHINE\\SYSTEM\\<br />
CurrentControlSet\\Control\\TimeZoneInformation\\<br />
ActiveTimeBias"</span><span class="keyword">)) / </span><span class="default">60</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$timestamp_bias </span><span class="keyword">= </span><span class="default">60 </span><span class="keyword">* </span><span class="default">60 </span><span class="keyword">* </span><span class="default">$time_bias</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; echo </span><span class="default">$time_bias </span><span class="keyword">. </span><span class="string">"&lt;br /&gt;"</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; return </span><span class="default">gmdate</span><span class="keyword">(</span><span class="default">$timeGiven</span><span class="keyword">, </span><span class="default">strtotime</span><span class="keyword">(</span><span class="default">$timestamp_bias </span><span class="keyword">. </span><span class="string">" seconds"</span><span class="keyword">));<br />
}<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="101020""></a>
  <div class="note">
   <strong class="user">Anonymous</strong>
   <a href="#101020" class="date">20-Nov-2010 10:58</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
People complaining that there's no way to set the offset - you are wrong. You can easily set the offset from GMT (see "Other" in available zones). And since all zones are offset from GMT it's just easy math with + or - to get that. So if you i.e. want the offset not from GMT but your timezone, then compute offset of your zone from GMT (say if you in Berlin its +1 now (mind summer time!)) and then offset for your target zone (i.e NYC is -5) then sum abs! of these values and set the sign of bigger (abs) value -&gt; total offset from your european zone to NYC is then abs(-5)+abs(1) = 6 and set "-" as NYC zone absolute value is bigger. So whatever time is in Berlin, in NYC it's 6hrs earlier. But it's better to do two step calculation and calculate always from GMT</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="100357""></a>
  <div class="note">
   <strong class="user">steve at pozzie dot net</strong>
   <a href="#100357" class="date">11-Oct-2010 10:35</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Most of the scripts here depend on PHP identifying the correct zone when one is not set, but that does not always happen. <br />
<br />
For example PHP 5.3.3 gives a 'UTC' result for a detected '8.0/no DST'. Not much help.<br />
<br />
So for those of us who for very good reasons really cannot set time zones in scripts of in .ini files, here is a function <br />
for use in a Windows environment that sets the default time zone to the OS time zone and returns the detected and set texts.<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">function </span><span class="default">date_system_timezone_set</span><span class="keyword">(){<br />
&nbsp; </span><span class="default">$shell </span><span class="keyword">= new </span><span class="default">COM</span><span class="keyword">(</span><span class="string">"WScript.Shell"</span><span class="keyword">) or die(</span><span class="string">"Requires Windows Scripting Host"</span><span class="keyword">);<br />
&nbsp; </span><span class="default">$time_bias </span><span class="keyword">= -(</span><span class="default">$shell</span><span class="keyword">-&gt;</span><span class="default">RegRead</span><span class="keyword">(<br />
</span><span class="string">"HKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Control<br />
\\TimeZoneInformation\\Bias"</span><span class="keyword">))/</span><span class="default">60</span><span class="keyword">;<br />
&nbsp; </span><span class="default">$ab </span><span class="keyword">= -(</span><span class="default">$shell</span><span class="keyword">-&gt;</span><span class="default">RegRead</span><span class="keyword">(<br />
</span><span class="string">"HKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Control<br />
\\TimeZoneInformation\\ActiveTimeBias"</span><span class="keyword">))/</span><span class="default">60</span><span class="keyword">;<br />
&nbsp; </span><span class="default">$sc </span><span class="keyword">= </span><span class="default">$shell</span><span class="keyword">-&gt;</span><span class="default">RegRead</span><span class="keyword">(<br />
</span><span class="string">"HKEY_USERS\\.DEFAULT\\Control Panel\\International\\sCountry"</span><span class="keyword">);<br />
&nbsp; foreach(</span><span class="default">timezone_abbreviations_list</span><span class="keyword">() as </span><span class="default">$tza</span><span class="keyword">) foreach(</span><span class="default">$tza </span><span class="keyword">as </span><span class="default">$entry</span><span class="keyword">){<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$country </span><span class="keyword">= </span><span class="default">strtok</span><span class="keyword">(</span><span class="default">$entry</span><span class="keyword">[</span><span class="string">'timezone_id'</span><span class="keyword">],</span><span class="string">'/'</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$locale </span><span class="keyword">= </span><span class="default">strtok</span><span class="keyword">(</span><span class="string">'|'</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; if(</span><span class="default">$country</span><span class="keyword">==</span><span class="default">$sc </span><span class="keyword">&amp;&amp; </span><span class="default">$ab</span><span class="keyword">==(</span><span class="default">$entry</span><span class="keyword">[</span><span class="string">'offset'</span><span class="keyword">]/</span><span class="default">60</span><span class="keyword">/</span><span class="default">60</span><span class="keyword">) &amp;&amp; (</span><span class="default">$ds </span><span class="keyword">= </span><span class="default">$time_bias</span><span class="keyword">!=</span><span class="default">$ab</span><span class="keyword">)==</span><span class="default">$entry</span><span class="keyword">[</span><span class="string">'dst'</span><span class="keyword">]){<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="default">date_default_timezone_set</span><span class="keyword">(</span><span class="default">$timezone_identifier </span><span class="keyword">= </span><span class="default">$country</span><span class="keyword">.</span><span class="string">"/"</span><span class="keyword">.</span><span class="default">$locale</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp;&nbsp; return </span><span class="default">sprintf</span><span class="keyword">(</span><span class="string">'%.1f'</span><span class="keyword">,</span><span class="default">$ab</span><span class="keyword">).</span><span class="string">"/"</span><span class="keyword">.(</span><span class="default">$ds</span><span class="keyword">?</span><span class="string">''</span><span class="keyword">:</span><span class="string">'no '</span><span class="keyword">).</span><span class="string">'DST'</span><span class="keyword">.</span><span class="string">" "</span><span class="keyword">.</span><span class="default">$timezone_identifier</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; }<br />
&nbsp;&nbsp; }<br />
&nbsp; return </span><span class="default">false</span><span class="keyword">; <br />
&nbsp;}<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="99865""></a>
  <div class="note">
   <strong class="user">Tom S</strong>
   <a href="#99865" class="date">11-Sep-2010 03:22</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
This is a good script if you know or control your system so that you know that the local TZ in your OS is correct. Unfortunately, this script still creates an warning message under BSD UNIX.<br />
<br />
To fix this, just add an "@" in front of "localtime" as:<br />
<br />
$arr = @localtime($iTime);</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="96551""></a>
  <div class="note">
   <strong class="user">Frederick Hathaway</strong>
   <a href="#96551" class="date">04-Mar-2010 05:54</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
It's really a hassle that there is no way to set the timezone offset. I attempted to use the code that searched for the correct timezone name by offset from below. I found it didn't work reliably since various cities may have different rules about time DST etc. My solution is to actually search the array and do a test to insure the offset is what I expect it to be. It seems very kludgey (if thats a word) but it works. <br />
<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">function </span><span class="default">setTimezoneByOffset</span><span class="keyword">(</span><span class="default">$offset</span><span class="keyword">) <br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="default">$testTimestamp </span><span class="keyword">= </span><span class="default">time</span><span class="keyword">();<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">date_default_timezone_set</span><span class="keyword">(</span><span class="string">'UTC'</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$testLocaltime </span><span class="keyword">= </span><span class="default">localtime</span><span class="keyword">(</span><span class="default">$testTimestamp</span><span class="keyword">,</span><span class="default">true</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$testHour </span><span class="keyword">= </span><span class="default">$testLocaltime</span><span class="keyword">[</span><span class="string">'tm_hour'</span><span class="keyword">];&nbsp; &nbsp; &nbsp; &nbsp; <br />
<br />
&nbsp;&nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$abbrarray </span><span class="keyword">= </span><span class="default">timezone_abbreviations_list</span><span class="keyword">();<br />
&nbsp;&nbsp;&nbsp; foreach (</span><span class="default">$abbrarray </span><span class="keyword">as </span><span class="default">$abbr</span><span class="keyword">) <br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">//echo $abbr."&lt;br&gt;";<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="keyword">foreach (</span><span class="default">$abbr </span><span class="keyword">as </span><span class="default">$city</span><span class="keyword">) <br />
&nbsp;&nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">date_default_timezone_set</span><span class="keyword">(</span><span class="default">$city</span><span class="keyword">[</span><span class="string">'timezone_id'</span><span class="keyword">]);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$testLocaltime&nbsp; &nbsp;&nbsp; </span><span class="keyword">= </span><span class="default">localtime</span><span class="keyword">(</span><span class="default">$testTimestamp</span><span class="keyword">,</span><span class="default">true</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$hour&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">= </span><span class="default">$testLocaltime</span><span class="keyword">[</span><span class="string">'tm_hour'</span><span class="keyword">];&nbsp; &nbsp; &nbsp; &nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$testOffset </span><span class="keyword">=&nbsp; </span><span class="default">$hour </span><span class="keyword">- </span><span class="default">$testHour</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if(</span><span class="default">$testOffset </span><span class="keyword">== </span><span class="default">$offset</span><span class="keyword">)<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">true</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; return </span><span class="default">false</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="95564""></a>
  <div class="note">
   <strong class="user">Christopher Kramer</strong>
   <a href="#95564" class="date">09-Jan-2010 04:52</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I experienced that using this function highly increases performance of functions like getdate() or date() using PHP 5.2.6 on Windows.<br />
I experienced similar results on Linux servers with PHP 5.2.6 and 5.2.10, although the difference was not that significant on these servers: The PHP 5.2.10 server did run with date_default_timezone_set ("only") twice as fast as without. The 5.2.6 server did 5 times faster with date_default_timezone_set. As you can see below, the 5.2.6-Windows machine did a LOT faster.<br />
Of course these machines have completely different hardware and can not really be compared, but all show improved performance.<br />
<br />
I checked PHP 4.4.9 on Windows (without date_default_timezone_set of course) and noticed that its as fast as PHP 5.2.6 with date_default_timezone_set.<br />
<br />
The following script shows this:<br />
<br />
<span class="default">&lt;?php<br />
<br />
</span><span class="comment"># uncomment to see difference<br />
# date_default_timezone_set(date_default_timezone_get());<br />
<br />
</span><span class="keyword">function </span><span class="default">getmicrotime</span><span class="keyword">()<br />
&nbsp;{<br />
&nbsp;list(</span><span class="default">$usec</span><span class="keyword">, </span><span class="default">$sec</span><span class="keyword">) = </span><span class="default">explode</span><span class="keyword">(</span><span class="string">' '</span><span class="keyword">,</span><span class="default">microtime</span><span class="keyword">());<br />
&nbsp;return (</span><span class="default">$sec</span><span class="keyword">.</span><span class="default">substr</span><span class="keyword">(</span><span class="default">$usec</span><span class="keyword">,</span><span class="default">1</span><span class="keyword">,</span><span class="default">7</span><span class="keyword">));<br />
&nbsp;}<br />
&nbsp;<br />
</span><span class="default">$start</span><span class="keyword">=</span><span class="default">mktime</span><span class="keyword">(</span><span class="default">0</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">,</span><span class="default">1</span><span class="keyword">,</span><span class="default">1</span><span class="keyword">,</span><span class="default">2005</span><span class="keyword">);<br />
</span><span class="default">$end</span><span class="keyword">=</span><span class="default">mktime</span><span class="keyword">(</span><span class="default">0</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">,</span><span class="default">1</span><span class="keyword">,</span><span class="default">1</span><span class="keyword">,</span><span class="default">2020</span><span class="keyword">);<br />
</span><span class="default">$nr</span><span class="keyword">=</span><span class="default">50000</span><span class="keyword">;<br />
&nbsp;<br />
</span><span class="default">$start_time</span><span class="keyword">=</span><span class="default">getmicrotime</span><span class="keyword">();<br />
for(</span><span class="default">$i</span><span class="keyword">=</span><span class="default">0</span><span class="keyword">;</span><span class="default">$i</span><span class="keyword">&lt;</span><span class="default">$nr</span><span class="keyword">;</span><span class="default">$i</span><span class="keyword">++) {<br />
</span><span class="comment"># $value=getdate(rand($start,$end));<br />
&nbsp; </span><span class="default">date</span><span class="keyword">(</span><span class="string">"H:i:s d.m.Y"</span><span class="keyword">,</span><span class="default">rand</span><span class="keyword">(</span><span class="default">$start</span><span class="keyword">,</span><span class="default">$end</span><span class="keyword">));<br />
}<br />
</span><span class="default">$end_time</span><span class="keyword">=</span><span class="default">getmicrotime</span><span class="keyword">();<br />
<br />
echo </span><span class="string">"Time: "</span><span class="keyword">.(</span><span class="default">$end_time</span><span class="keyword">-</span><span class="default">$start_time</span><span class="keyword">);<br />
<br />
</span><span class="comment">// With date_default_timezone_set(): "Time: 0.379343986511"<br />
// Without date_default_timezone_set(): "Time: 7.4971370697"<br />
<br />
</span><span class="default">?&gt;<br />
</span><br />
Note that the timezone is not changed, it is only set again. I really wonder why this makes such a big performance difference, but its good to know.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="87389""></a>
  <div class="note">
   <strong class="user">ted dot chou12 at gmail dot com</strong>
   <a href="#87389" class="date">03-Dec-2008 08:13</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Timezone using other approaches:<br />
<span class="default">&lt;?php $datetime </span><span class="keyword">= </span><span class="default">strtotime</span><span class="keyword">(</span><span class="default">$originaldatetime</span><span class="keyword">) + </span><span class="default">$time</span><span class="keyword">;<br />
</span><span class="default">$datetime </span><span class="keyword">= </span><span class="default">date</span><span class="keyword">(</span><span class="string">'M d, Y h:i A'</span><span class="keyword">, </span><span class="default">$datetime</span><span class="keyword">);</span><span class="default">?&gt;<br />
</span><br />
$time obtained from table below:<br />
-25200|International Date Line (West) GMT-12|<br />
-21600|Midway Island, Samoa GMT-11|<br />
-18000|Hawaii, Honolulu GMT-10|<br />
-14400|Alaska GMT-9|<br />
-10800|Pacific Standard Time, US, Canada GMT-8|<br />
-7200|British Columbia N.E., Santa Fe, Mountain Time GMT-7|<br />
-3600|Central America, Chicago, Guatamala, Mexico City GMT-6|<br />
0|US, Canada, Bogota, Boston, New York GMT-5|<br />
+3600|Canada, Santiago, Atlantic Standard Time GMT-4|<br />
+7200|Brazilia, Buenos Aires, Georgetown, Greenland GMT-3|<br />
+10800|Mid-Atlantic GMT-2|<br />
+14400|Azores, Cape Verde Is., Western Africa Time GMT-1|<br />
+18000|London, Iceland, Ireland, Morocco, Portugal GMT|<br />
+21600|Amsterdam, Berlin, Bern, Madrid, Paris, Rome, GMT+1|<br />
+25200|Athens, Cairo, Cape Town, Finland, Greece, Israel GMT+2|<br />
+28800|Ankara, Aden, Baghdad, Beruit, Kuwait, Moscow GMT+3|<br />
+32400|Abu Dhabi, Baku, Kabul, Tehran, Tbilisi, Volgograd GMT+4|<br />
+36000|Calcutta, Colombo, Islamabad, Madras, New Dehli GMT+5|<br />
+39600|Almaty, Dhakar, Kathmandu, Colombo, Sri Lanka GMT+6|<br />
+43200|Bangkok, Hanoi, Jakarta, Phnom Penh, Australia GMT+7|<br />
+46800|Taipei, Beijing, Hong Kong, Singapore, GMT+8|<br />
+50400|Seoul, Tokyo, Central Australia GMT+9|<br />
+54000|Brisbane, Canberra, Guam, Melbourne, Sydney, GMT+10|<br />
+57600|Magadan, New Caledonia, Solomon Is. GMT+11|<br />
+61200|Auckland, Fiji, Kamchatka, Marshall, Wellington, GMT+12|</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="86950""></a>
  <div class="note">
   <strong class="user">jason at jasonpriem dot com</strong>
   <a href="#86950" class="date">12-Nov-2008 05:29</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
While it's easy to change timezones based on names or abbreviations, I haven't found any straightforward way of doing so using an offset integer.&nbsp; This situation comes up if you're using AJAX to get information about a user's timezone; javascript's getTimezoneOffset() method just sends you an offset number. So, here's my clunky solution: an adaptation of chris' function at <a href="http://us.php.net/manual/en/function.timezone-name-from-abbr.php." rel="nofollow" target="_blank">http://us.php.net/manual/en/function.timezone-name-from-abbr.php.</a><br />
<br />
<span class="default">&lt;?php<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">function </span><span class="default">set_tz_by_offset</span><span class="keyword">(</span><span class="default">$offset</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$offset </span><span class="keyword">= </span><span class="default">$offset</span><span class="keyword">*</span><span class="default">60</span><span class="keyword">*</span><span class="default">60</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$abbrarray </span><span class="keyword">= </span><span class="default">timezone_abbreviations_list</span><span class="keyword">();<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; foreach (</span><span class="default">$abbrarray </span><span class="keyword">as </span><span class="default">$abbr</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">//echo $abbr."&lt;br&gt;";<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">foreach (</span><span class="default">$abbr </span><span class="keyword">as </span><span class="default">$city</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">//echo $city['offset']." $offset&lt;br&gt;";<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">if (</span><span class="default">$city</span><span class="keyword">[</span><span class="string">'offset'</span><span class="keyword">] == </span><span class="default">$offset</span><span class="keyword">) { </span><span class="comment">// remember to multiply $offset by -1 if you're getting it from js<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">date_default_timezone_set</span><span class="keyword">(</span><span class="default">$city</span><span class="keyword">[</span><span class="string">'timezone_id'</span><span class="keyword">]);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; return </span><span class="default">true</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">date_default_timezone_set</span><span class="keyword">(</span><span class="string">"ust"</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; return </span><span class="default">false</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; }<br />
<br />
</span><span class="default">set_tz_by_offset</span><span class="keyword">(-</span><span class="default">1</span><span class="keyword">);<br />
<br />
</span><span class="default">?&gt;<br />
</span><br />
[EDIT BY thiago AT php DOT net: This code has contributions from iateadonut at gmail dot com]</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="84459""></a>
  <div class="note">
   <strong class="user">Rob Kaper</strong>
   <a href="#84459" class="date">15-Jul-2008 10:46</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If you want users to choose their own timezones, here's some code that gets all available timezones but only uses one city for each possible value:<br />
<br />
<span class="default">&lt;?php<br />
<br />
$timezones </span><span class="keyword">= </span><span class="default">DateTimeZone</span><span class="keyword">::</span><span class="default">listAbbreviations</span><span class="keyword">();<br />
<br />
</span><span class="default">$cities </span><span class="keyword">= array();<br />
foreach( </span><span class="default">$timezones </span><span class="keyword">as </span><span class="default">$key </span><span class="keyword">=&gt; </span><span class="default">$zones </span><span class="keyword">)<br />
{<br />
&nbsp;&nbsp;&nbsp; foreach( </span><span class="default">$zones </span><span class="keyword">as </span><span class="default">$id </span><span class="keyword">=&gt; </span><span class="default">$zone </span><span class="keyword">)<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">/**<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; * Only get timezones explicitely not part of "Others".<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; * @see <a href="http://www.php.net/manual/en/timezones.others.php" rel="nofollow" target="_blank">http://www.php.net/manual/en/timezones.others.php</a><br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; */<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">if ( </span><span class="default">preg_match</span><span class="keyword">( </span><span class="string">'/^(America|Antartica|Arctic|Asia|Atlantic|Europe|Indian|Pacific)\//'</span><span class="keyword">, </span><span class="default">$zone</span><span class="keyword">[</span><span class="string">'timezone_id'</span><span class="keyword">] ) )<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$cities</span><span class="keyword">[</span><span class="default">$zone</span><span class="keyword">[</span><span class="string">'timezone_id'</span><span class="keyword">]][] = </span><span class="default">$key</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }<br />
}<br />
<br />
</span><span class="comment">// For each city, have a comma separated list of all possible timezones for that city.<br />
</span><span class="keyword">foreach( </span><span class="default">$cities </span><span class="keyword">as </span><span class="default">$key </span><span class="keyword">=&gt; </span><span class="default">$value </span><span class="keyword">)<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$cities</span><span class="keyword">[</span><span class="default">$key</span><span class="keyword">] = </span><span class="default">join</span><span class="keyword">( </span><span class="string">', '</span><span class="keyword">, </span><span class="default">$value</span><span class="keyword">);<br />
<br />
</span><span class="comment">// Only keep one city (the first and also most important) for each set of possibilities. <br />
</span><span class="default">$cities </span><span class="keyword">= </span><span class="default">array_unique</span><span class="keyword">( </span><span class="default">$cities </span><span class="keyword">);<br />
<br />
</span><span class="comment">// Sort by area/city name.<br />
</span><span class="default">ksort</span><span class="keyword">( </span><span class="default">$cities </span><span class="keyword">);<br />
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="73174""></a>
  <div class="note">
   <strong class="user">PeerGoal.com</strong>
   <a href="#73174" class="date">12-Feb-2007 01:21</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
The problem:<br />
<br />
date() [function.date]: It is not safe to rely on the system's timezone settings. Please use the date.timezone setting, the TZ environment variable or the date_default_timezone_set() function. In case you used any of those methods and you are still getting this warning, you most likely misspelled the timezone identifier. We selected 'America/Los_Angeles' for 'PST/-8.0/no DST' instead<br />
<br />
Of course this is a problem that recently surfaced since PHP5. Quick fix is to set your time zone, add this line to your php code:<br />
<br />
date_default_timezone_set("America/Los_Angeles");</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="71909""></a>
  <div class="note">
   <strong class="user">davidn at datalinktech dot com dot au</strong>
   <a href="#71909" class="date">22-Dec-2006 02:27</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Note that there may be some unexpected side-effects that result from using either set_default_timezone() or the putenv("TZ=...") workalike for earlier PHP versions.&nbsp; ANY date formatted and output either by PHP or its apache host process will be unconditionally expressed in that timezone.<br />
<br />
[red. That is only true for the putenv() hack - Derick]<br />
<br />
This does indeed include the web server's logs and other output files and reports which by default usually do not include any indication of timezone. This has a further side-effect on log processing and analysis, obviously.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
</div>
</div>
<hr /><div class="manualnavbar" style="text-align: center;">
 <div class="prev" style="text-align: left; float: left;"><a href="function.date-default-timezone-get.html">date_default_timezone_get</a></div>
 <div class="next" style="text-align: right; float: right;"><a href="function.date-diff.html">date_diff</a></div>
 <div class="up"><a href="ref.datetime.html">日付・時刻 関数</a></div>
 <div class="home"><a href="index.html">PHP Manual</a></div>
</div></body></html>
