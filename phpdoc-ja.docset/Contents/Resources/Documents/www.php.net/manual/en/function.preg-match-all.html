<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
 <head>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <title>繰り返し正規表現検索を行う</title>
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <link media="all" rel="stylesheet" type="text/css" href="style.css"/>
 </head>
 <body class="docs"><div class="manualnavbar" style="text-align: center;">
 <div class="prev" style="text-align: left; float: left;"><a href="function.preg-last-error.html">preg_last_error</a></div>
 <div class="next" style="text-align: right; float: right;"><a href="function.preg-match.html">preg_match</a></div>
 <div class="up"><a href="ref.pcre.html">PCRE 関数</a></div>
 <div class="home"><a href="index.html">PHP Manual</a></div>
</div><hr /><div id="function.preg-match-all" class="refentry">
 <div class="refnamediv">
  <h1 class="refname">preg_match_all</h1>
  <p class="verinfo">(PHP 4, PHP 5)</p><p class="refpurpose"><span class="refname">preg_match_all</span> &mdash; <span class="dc-title">繰り返し正規表現検索を行う</span></p>

 </div>

 <div class="refsect1 description" id="refsect1-function.preg-match-all-description">
  <h3 class="title">説明</h3>
  <div class="methodsynopsis dc-description">
   <span class="type">int</span> <span class="methodname"><strong>preg_match_all</strong></span>
    ( <span class="methodparam"><span class="type">string</span> <code class="parameter">$pattern</code></span>
   , <span class="methodparam"><span class="type">string</span> <code class="parameter">$subject</code></span>
   [, <span class="methodparam"><span class="type">array</span> <code class="parameter reference">&$matches</code></span>
   [, <span class="methodparam"><span class="type">int</span> <code class="parameter">$flags</code><span class="initializer"> = <strong><code>PREG_PATTERN_ORDER</code></strong></span></span>
   [, <span class="methodparam"><span class="type">int</span> <code class="parameter">$offset</code><span class="initializer"> = 0</span></span>
  ]]] )</div>

  <p class="para rdfs-comment">
   <em><code class="parameter">subject</code></em> を検索し、
   <em><code class="parameter">pattern</code></em> に指定した正規表現にマッチした
   すべての文字列を、<em><code class="parameter">flags</code></em> で指定した
   順番で、<em><code class="parameter">matches</code></em> に代入します。
  </p>
  <p class="para">
   正規表現にマッチすると、そのマッチした文字列の後から
   検索が続行されます。
  </p>
 </div>


 <div class="refsect1 parameters" id="refsect1-function.preg-match-all-parameters">
  <h3 class="title">パラメータ</h3>
  <p class="para">
   <dl>

    <dt>

     <span class="term"><em><code class="parameter">pattern</code></em></span>
     <dd>

      <p class="para">
       検索するパターンを表す文字列。
      </p>
     </dd>

    </dt>

    <dt>

     <span class="term"><em><code class="parameter">subject</code></em></span>
     <dd>

      <p class="para">
       入力文字列。
      </p>
     </dd>

    </dt>

    <dt>

     <span class="term"><em><code class="parameter">matches</code></em></span>
     <dd>

      <p class="para">
       マッチしたすべての内容を含む、
       <em><code class="parameter">flags</code></em>
       で指定した形式の多次元配列。
      </p>
     </dd>

    </dt>

    <dt>

     <span class="term"><em><code class="parameter">flags</code></em></span>
     <dd>

      <p class="para">
       以下のフラグの組み合わせ
       (<strong><code>PREG_PATTERN_ORDER</code></strong> を
       <strong><code>PREG_SET_ORDER</code></strong> と組み合わせて使用することは
       無意味ですので注意してください)。
       <dl>

        <dt>

         <span class="term"><strong><code>PREG_PATTERN_ORDER</code></strong></span>
         <dd>

          <p class="para">
           <var class="varname"><var class="varname">$matches[0]</var></var> はパターン全体にマッチした文字列の配列、
           <var class="varname"><var class="varname">$matches[1]</var></var> は第 1 のキャプチャ用サブパターンにマッチした文字列の配列、
           といった順番となります。
          </p>
          <p class="para">
           <div class="informalexample">
            <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br />preg_match_all</span><span style="color: #007700">(</span><span style="color: #DD0000">"|&lt;[^&gt;]+&gt;(.*)&lt;/[^&gt;]+&gt;|U"</span><span style="color: #007700">,<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #DD0000">"&lt;b&gt;example:&nbsp;&lt;/b&gt;&lt;div&nbsp;align=left&gt;this&nbsp;is&nbsp;a&nbsp;test&lt;/div&gt;"</span><span style="color: #007700">,<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$out</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">PREG_PATTERN_ORDER</span><span style="color: #007700">);<br />echo&nbsp;</span><span style="color: #0000BB">$out</span><span style="color: #007700">[</span><span style="color: #0000BB">0</span><span style="color: #007700">][</span><span style="color: #0000BB">0</span><span style="color: #007700">]&nbsp;.&nbsp;</span><span style="color: #DD0000">",&nbsp;"&nbsp;</span><span style="color: #007700">.&nbsp;</span><span style="color: #0000BB">$out</span><span style="color: #007700">[</span><span style="color: #0000BB">0</span><span style="color: #007700">][</span><span style="color: #0000BB">1</span><span style="color: #007700">]&nbsp;.&nbsp;</span><span style="color: #DD0000">"\n"</span><span style="color: #007700">;<br />echo&nbsp;</span><span style="color: #0000BB">$out</span><span style="color: #007700">[</span><span style="color: #0000BB">1</span><span style="color: #007700">][</span><span style="color: #0000BB">0</span><span style="color: #007700">]&nbsp;.&nbsp;</span><span style="color: #DD0000">",&nbsp;"&nbsp;</span><span style="color: #007700">.&nbsp;</span><span style="color: #0000BB">$out</span><span style="color: #007700">[</span><span style="color: #0000BB">1</span><span style="color: #007700">][</span><span style="color: #0000BB">1</span><span style="color: #007700">]&nbsp;.&nbsp;</span><span style="color: #DD0000">"\n"</span><span style="color: #007700">;<br /></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
            </div>

            <p class="para">上の例の出力は以下となります。</p>
            <div class="example-contents screen">
<div class="cdata"><pre>
&lt;b&gt;example: &lt;/b&gt;, &lt;div align=left&gt;this is a test&lt;/div&gt;
example: , this is a test
</pre></div>
            </div>
            <p class="para">
             <var class="varname"><var class="varname">$out[0]</var></var> はパターン全体にマッチした文字列の配列を有しており、
             <var class="varname"><var class="varname">$out[1]</var></var> はタグで囲まれた文字列の配列を有しています。
            </p>
           </div>
          </p>
         </dd>

        </dt>

        <dt>

         <span class="term"><strong><code>PREG_SET_ORDER</code></strong></span>
         <dd>

          <p class="para">
           <var class="varname"><var class="varname">$matches[0]</var></var> は 1 回目のマッチングでキャプチャした値の配列、
           <var class="varname"><var class="varname">$matches[1]</var></var> は 2 回目のマッチングでキャプチャした値の配列、
           といった順序となります。
           <div class="informalexample">
            <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br />preg_match_all</span><span style="color: #007700">(</span><span style="color: #DD0000">"|&lt;[^&gt;]+&gt;(.*)&lt;/[^&gt;]+&gt;|U"</span><span style="color: #007700">,<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #DD0000">"&lt;b&gt;example:&nbsp;&lt;/b&gt;&lt;div&nbsp;align=\"left\"&gt;this&nbsp;is&nbsp;a&nbsp;test&lt;/div&gt;"</span><span style="color: #007700">,<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$out</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">PREG_SET_ORDER</span><span style="color: #007700">);<br />echo&nbsp;</span><span style="color: #0000BB">$out</span><span style="color: #007700">[</span><span style="color: #0000BB">0</span><span style="color: #007700">][</span><span style="color: #0000BB">0</span><span style="color: #007700">]&nbsp;.&nbsp;</span><span style="color: #DD0000">",&nbsp;"&nbsp;</span><span style="color: #007700">.&nbsp;</span><span style="color: #0000BB">$out</span><span style="color: #007700">[</span><span style="color: #0000BB">0</span><span style="color: #007700">][</span><span style="color: #0000BB">1</span><span style="color: #007700">]&nbsp;.&nbsp;</span><span style="color: #DD0000">"\n"</span><span style="color: #007700">;<br />echo&nbsp;</span><span style="color: #0000BB">$out</span><span style="color: #007700">[</span><span style="color: #0000BB">1</span><span style="color: #007700">][</span><span style="color: #0000BB">0</span><span style="color: #007700">]&nbsp;.&nbsp;</span><span style="color: #DD0000">",&nbsp;"&nbsp;</span><span style="color: #007700">.&nbsp;</span><span style="color: #0000BB">$out</span><span style="color: #007700">[</span><span style="color: #0000BB">1</span><span style="color: #007700">][</span><span style="color: #0000BB">1</span><span style="color: #007700">]&nbsp;.&nbsp;</span><span style="color: #DD0000">"\n"</span><span style="color: #007700">;<br /></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
            </div>

            <p class="para">上の例の出力は以下となります。</p>
            <div class="example-contents screen">
<div class="cdata"><pre>
&lt;b&gt;example: &lt;/b&gt;, example:
&lt;div align=&quot;left&quot;&gt;this is a test&lt;/div&gt;, this is a test
</pre></div>
            </div>
           </div>
          </p>
         </dd>

        </dt>

        <dt>

         <span class="term"><strong><code>PREG_OFFSET_CAPTURE</code></strong></span>
         <dd>

          <p class="para">
           このフラグを設定した場合、各マッチに対応する文字列のオフセットも返されます。
           これにより、返り値は配列となり、配列の要素 <em>0</em> はマッチした文字列、 
           要素 <em>1</em> は <em><code class="parameter">subject</code></em> における
           マッチした文字列のオフセット値となることに注意してください。 
          </p>
         </dd>

        </dt>

       </dl>

      </p>
      <p class="para">
       <em><code class="parameter">flags</code></em> を指定しない場合は、
       <strong><code>PREG_PATTERN_ORDER</code></strong> が指定されたことになります。
      </p>
     </dd>

    </dt>

    <dt>

     <span class="term"><em><code class="parameter">offset</code></em></span>
     <dd>

      <p class="para">
       通常、検索は対象文字列の先頭から開始されます。
       オプションのパラメータ <em><code class="parameter">offset</code></em> を使用して
       検索の開始位置を (バイト単位で) 指定することも可能です。
      </p>
      <blockquote class="note"><p><strong class="note">注意</strong>: 
       <p class="para">
        <em><code class="parameter">offset</code></em> を用いるのと、
        <em>substr($subject, $offset)</em> を
         <span class="function"><strong>preg_match_all()</strong></span>の対象文字列として指定するのとは
        等価ではありません。
        これは、<em><code class="parameter">pattern</code></em> には、
        <em class="emphasis">^</em>, <em class="emphasis">$</em> や
        <em class="emphasis">(?&lt;=x)</em> のような言明を含めることができるためです。
        これに関する例については、
         <span class="function"><a href="function.preg-match.html" class="function">preg_match()</a></span> を参照してください。
       </p>
      </p></blockquote>
     </dd>

    </dt>

   </dl>

  </p>
 </div>


 <div class="refsect1 returnvalues" id="refsect1-function.preg-match-all-returnvalues">
  <h3 class="title">返り値</h3>
  <p class="para">
   パターンがマッチした総数を返します（ゼロとなる可能性もあります）。
   または、エラーが発生した場合に <strong><code>FALSE</code></strong> を返します。
  </p>
 </div>


 <div class="refsect1 changelog" id="refsect1-function.preg-match-all-changelog">
  <h3 class="title">変更履歴</h3>
  <p class="para">
   <table class="doctable informaltable">
    
     <thead>
      <tr>
       <th>バージョン</th>
       <th>説明</th>
      </tr>

     </thead>

     <tbody class="tbody">
      <tr>
       <td>5.4.0</td>
       <td>
        <em><code class="parameter">matches</code></em> パラメータが必須ではなくなりました。
       </td>
      </tr>

      <tr>
       <td>5.3.6</td>
       <td>
        <em><code class="parameter">offset</code></em> が
        <em><code class="parameter">subject</code></em> よりも長いときに <strong><code>FALSE</code></strong> を返すようになりました。
       </td>
      </tr>

      <tr>
       <td>5.2.2</td>
       <td>
        名前付きサブパターンで、
        <em>(?&lt;name&gt;)</em> や
        <em>(?&#039;name&#039;)</em> のような構文を
        <em>(?P&lt;name&gt;)</em> と同様に受け入れるようになりました。
        以前のバージョンでは
        <em>(?P&lt;name&gt;)</em> 形式しか使えませんでした。
       </td>
      </tr>

      <tr>
       <td>4.3.3</td>
       <td>
        パラメータ <em><code class="parameter">offset</code></em> が追加されました。
       </td>
      </tr>

      <tr>
       <td>4.3.0</td>
       <td>
        フラグ <strong><code>PREG_OFFSET_CAPTURE</code></strong> が追加されました。
       </td>
      </tr>

     </tbody>
    
   </table>

  </p>
 </div>


 <div class="refsect1 examples" id="refsect1-function.preg-match-all-examples">
  <h3 class="title">例</h3>
  <p class="para">
   <div class="example" id="example-4758">
    <p><strong>例1 テキストからすべての電話番号を得る</strong></p>
    <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br />preg_match_all</span><span style="color: #007700">(</span><span style="color: #DD0000">"/\(?&nbsp;&nbsp;(\d{3})?&nbsp;&nbsp;\)?&nbsp;&nbsp;(?(1)&nbsp;&nbsp;[\-\s]&nbsp;)&nbsp;\d{3}-\d{4}/x"</span><span style="color: #007700">,<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #DD0000">"Call&nbsp;555-1212&nbsp;or&nbsp;1-800-555-1212"</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$phones</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
    </div>

   </div>
  </p>
  <p class="para">
   <div class="example" id="example-4759">
    <p><strong>例2 HTML タグにマッチするものを見付ける（貪欲）</strong></p>
    <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br /></span><span style="color: #FF8000">//&nbsp;\\2&nbsp;は後方参照の例。これは、pcre&nbsp;に正規表現中の括弧の&nbsp;2&nbsp;番目の<br />//&nbsp;組、つまりこの場合は&nbsp;([\w]+)、にマッチする。文字列が二重引用符で<br />//&nbsp;括られているため、バックスラッシュの追加が必要。<br /></span><span style="color: #0000BB">$html&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #DD0000">"&lt;b&gt;bold&nbsp;text&lt;/b&gt;&lt;a&nbsp;href=howdy.html&gt;click&nbsp;me&lt;/a&gt;"</span><span style="color: #007700">;<br /><br /></span><span style="color: #0000BB">preg_match_all</span><span style="color: #007700">(</span><span style="color: #DD0000">"/(&lt;([\w]+)[^&gt;]*&gt;)(.*?)(&lt;\/\\2&gt;)/"</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$html</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$matches</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">PREG_SET_ORDER</span><span style="color: #007700">);<br /><br />foreach&nbsp;(</span><span style="color: #0000BB">$matches&nbsp;</span><span style="color: #007700">as&nbsp;</span><span style="color: #0000BB">$val</span><span style="color: #007700">)&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;echo&nbsp;</span><span style="color: #DD0000">"matched:&nbsp;"&nbsp;</span><span style="color: #007700">.&nbsp;</span><span style="color: #0000BB">$val</span><span style="color: #007700">[</span><span style="color: #0000BB">0</span><span style="color: #007700">]&nbsp;.&nbsp;</span><span style="color: #DD0000">"\n"</span><span style="color: #007700">;<br />&nbsp;&nbsp;&nbsp;&nbsp;echo&nbsp;</span><span style="color: #DD0000">"part&nbsp;1:&nbsp;"&nbsp;</span><span style="color: #007700">.&nbsp;</span><span style="color: #0000BB">$val</span><span style="color: #007700">[</span><span style="color: #0000BB">1</span><span style="color: #007700">]&nbsp;.&nbsp;</span><span style="color: #DD0000">"\n"</span><span style="color: #007700">;<br />&nbsp;&nbsp;&nbsp;&nbsp;echo&nbsp;</span><span style="color: #DD0000">"part&nbsp;2:&nbsp;"&nbsp;</span><span style="color: #007700">.&nbsp;</span><span style="color: #0000BB">$val</span><span style="color: #007700">[</span><span style="color: #0000BB">2</span><span style="color: #007700">]&nbsp;.&nbsp;</span><span style="color: #DD0000">"\n"</span><span style="color: #007700">;<br />&nbsp;&nbsp;&nbsp;&nbsp;echo&nbsp;</span><span style="color: #DD0000">"part&nbsp;3:&nbsp;"&nbsp;</span><span style="color: #007700">.&nbsp;</span><span style="color: #0000BB">$val</span><span style="color: #007700">[</span><span style="color: #0000BB">3</span><span style="color: #007700">]&nbsp;.&nbsp;</span><span style="color: #DD0000">"\n"</span><span style="color: #007700">;<br />&nbsp;&nbsp;&nbsp;&nbsp;echo&nbsp;</span><span style="color: #DD0000">"part&nbsp;4:&nbsp;"&nbsp;</span><span style="color: #007700">.&nbsp;</span><span style="color: #0000BB">$val</span><span style="color: #007700">[</span><span style="color: #0000BB">4</span><span style="color: #007700">]&nbsp;.&nbsp;</span><span style="color: #DD0000">"\n\n"</span><span style="color: #007700">;<br />}<br /></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
    </div>

    <div class="example-contents"><p>上の例の出力は以下となります。</p></div>
    <div class="example-contents screen">
<div class="cdata"><pre>
matched: &lt;b&gt;bold text&lt;/b&gt;
part 1: &lt;b&gt;
part 2: b
part 3: bold text
part 4: &lt;/b&gt;

matched: &lt;a href=howdy.html&gt;click me&lt;/a&gt;
part 1: &lt;a href=howdy.html&gt;
part 2: a
part 3: click me
part 4: &lt;/a&gt;
</pre></div>
    </div>
   </div>
  </p>
  <p class="para">
   <div class="example" id="example-4760">
    <p><strong>例3 名前つきサブパターンの使用法</strong></p>
    <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br /><br />$str&nbsp;</span><span style="color: #007700">=&nbsp;&lt;&lt;&lt;FOO<br /></span><span style="color: #DD0000">a:&nbsp;1<br />b:&nbsp;2<br />c:&nbsp;3<br /></span><span style="color: #007700">FOO;<br /><br /></span><span style="color: #0000BB">preg_match_all</span><span style="color: #007700">(</span><span style="color: #DD0000">'/(?P&lt;name&gt;\w+):&nbsp;(?P&lt;digit&gt;\d+)/'</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$str</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$matches</span><span style="color: #007700">);<br /><br /></span><span style="color: #FF8000">/*&nbsp;PHP&nbsp;5.2.2&nbsp;(PCRE&nbsp;7.0)&nbsp;以降ではこの形式でも動作しますが、<br />&nbsp;*&nbsp;過去との互換性を考慮して上の形式のほうを推奨します&nbsp;*/<br />//&nbsp;preg_match_all('/(?&lt;name&gt;\w+):&nbsp;(?&lt;digit&gt;\d+)/',&nbsp;$str,&nbsp;$matches);<br /><br /></span><span style="color: #0000BB">print_r</span><span style="color: #007700">(</span><span style="color: #0000BB">$matches</span><span style="color: #007700">);<br /><br /></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
    </div>

    <div class="example-contents"><p>上の例の出力は以下となります。</p></div>
    <div class="example-contents screen">
<div class="cdata"><pre>
Array
(
    [0] =&gt; Array
        (
            [0] =&gt; a: 1
            [1] =&gt; b: 2
            [2] =&gt; c: 3
        )

    [name] =&gt; Array
        (
            [0] =&gt; a
            [1] =&gt; b
            [2] =&gt; c
        )

    [1] =&gt; Array
        (
            [0] =&gt; a
            [1] =&gt; b
            [2] =&gt; c
        )

    [digit] =&gt; Array
        (
            [0] =&gt; 1
            [1] =&gt; 2
            [2] =&gt; 3
        )

    [2] =&gt; Array
        (
            [0] =&gt; 1
            [1] =&gt; 2
            [2] =&gt; 3
        )

)
</pre></div>
    </div>
   </div>
  </p>
 </div>


 <div class="refsect1 seealso" id="refsect1-function.preg-match-all-seealso">
  <h3 class="title">参考</h3>
  <p class="para">
   <ul class="simplelist">
    <li class="member"><a href="pcre.pattern.html" class="link">PCRE のパターン</a></li>
    <li class="member"> <span class="function"><a href="function.preg-match.html" class="function" rel="rdfs-seeAlso">preg_match()</a> - 正規表現によるマッチングを行う</span></li>
    <li class="member"> <span class="function"><a href="function.preg-replace.html" class="function" rel="rdfs-seeAlso">preg_replace()</a> - 正規表現検索および置換を行う</span></li>
    <li class="member"> <span class="function"><a href="function.preg-split.html" class="function" rel="rdfs-seeAlso">preg_split()</a> - 正規表現で文字列を分割する</span></li>
    <li class="member"> <span class="function"><a href="function.preg-last-error.html" class="function" rel="rdfs-seeAlso">preg_last_error()</a> - 直近の PCRE 正規表現処理のエラーコードを返す</span></li>
   </ul>
  </p>
 </div>


</div><div id="usernotes">
 <div class="head">
  <h3 class="title">User Contributed Notes</h3>
 </div>
<div id="allnotes">  <a name="110147""></a>
  <div class="note">
   <strong class="user">fab</strong>
   <a href="#110147" class="date">24-Sep-2012 06:14</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Here is a function that replaces all occurrences of a number in a string by the number--<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">function </span><span class="default">decremente_chaine</span><span class="keyword">(</span><span class="default">$chaine</span><span class="keyword">)<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">//récupérer toutes les occurrences de nombres et leurs indices<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">preg_match_all</span><span class="keyword">(</span><span class="string">"/[0-9]+/"</span><span class="keyword">,</span><span class="default">$chaine</span><span class="keyword">,</span><span class="default">$out</span><span class="keyword">,</span><span class="default">PREG_OFFSET_CAPTURE</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">//parcourir les occurrences <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">for(</span><span class="default">$i</span><span class="keyword">=</span><span class="default">0</span><span class="keyword">;</span><span class="default">$i</span><span class="keyword">&lt;</span><span class="default">sizeof</span><span class="keyword">(</span><span class="default">$out</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">]);</span><span class="default">$i</span><span class="keyword">++)<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$longueurnombre </span><span class="keyword">= </span><span class="default">strlen</span><span class="keyword">((string)</span><span class="default">$out</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">][</span><span class="default">$i</span><span class="keyword">][</span><span class="default">0</span><span class="keyword">]);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$taillechaine </span><span class="keyword">= </span><span class="default">strlen</span><span class="keyword">(</span><span class="default">$chaine</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// découper la chaine en 3 morceaux<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$debut </span><span class="keyword">= </span><span class="default">substr</span><span class="keyword">(</span><span class="default">$chaine</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">,</span><span class="default">$out</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">][</span><span class="default">$i</span><span class="keyword">][</span><span class="default">1</span><span class="keyword">]);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$milieu </span><span class="keyword">= (</span><span class="default">$out</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">][</span><span class="default">$i</span><span class="keyword">][</span><span class="default">0</span><span class="keyword">])-</span><span class="default">1</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$fin </span><span class="keyword">= </span><span class="default">substr</span><span class="keyword">(</span><span class="default">$chaine</span><span class="keyword">,</span><span class="default">$out</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">][</span><span class="default">$i</span><span class="keyword">][</span><span class="default">1</span><span class="keyword">]+</span><span class="default">$longueurnombre</span><span class="keyword">,</span><span class="default">$taillechaine</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="comment">// si c'est 10,100,1000 etc. on décale tout de 1 car le résultat comporte un chiffre de moins<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="keyword">if(</span><span class="default">preg_match</span><span class="keyword">(</span><span class="string">'#[1][0]+$#'</span><span class="keyword">, </span><span class="default">$out</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">][</span><span class="default">$i</span><span class="keyword">][</span><span class="default">0</span><span class="keyword">]))<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; for(</span><span class="default">$j </span><span class="keyword">= </span><span class="default">$i</span><span class="keyword">+</span><span class="default">1</span><span class="keyword">;</span><span class="default">$j</span><span class="keyword">&lt;</span><span class="default">sizeof</span><span class="keyword">(</span><span class="default">$out</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">]);</span><span class="default">$j</span><span class="keyword">++)<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$out</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">][</span><span class="default">$j</span><span class="keyword">][</span><span class="default">1</span><span class="keyword">] = </span><span class="default">$out</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">][</span><span class="default">$j</span><span class="keyword">][</span><span class="default">1</span><span class="keyword">] -</span><span class="default">1</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$chaine </span><span class="keyword">= </span><span class="default">$debut</span><span class="keyword">.</span><span class="default">$milieu</span><span class="keyword">.</span><span class="default">$fin</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">$chaine</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="110129""></a>
  <div class="note">
   <strong class="user">fseverin at free dot fr</strong>
   <a href="#110129" class="date">23-Sep-2012 02:52</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
As I intended to create for my own purpose a clean PHP class to act on XML files, combining the use of DOM and simplexml functions, I had that small problem, but very annoying, that the offsets in a path is not numbered the same in both. <br />
<br />
That is to say, for example, if i get a DOM xpath object it appears like:<br />
/ANODE/ANOTHERNODE/SOMENODE[9]/NODE[2]<br />
and as a simplexml object would be equivalent to:<br />
ANODE-&gt;ANOTHERNODE-&gt;SOMENODE[8]-&gt;NODE[1]<br />
<br />
So u see what I mean? I used preg_match_all to solve that problem, and finally I got this after some hours of headlock (as I'm french the names of variables are in French sorry), hoping it could be useful to some of you:<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">function </span><span class="default">decrease_string</span><span class="keyword">(</span><span class="default">$string</span><span class="keyword">)<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">/* retrieve all occurrences AND offsets of numbers in the original string: */<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">preg_match_all</span><span class="keyword">(</span><span class="string">"/[0-9]+/"</span><span class="keyword">,</span><span class="default">$chaine</span><span class="keyword">,</span><span class="default">$out</span><span class="keyword">,</span><span class="default">PREG_OFFSET_CAPTURE</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; for(</span><span class="default">$i</span><span class="keyword">=</span><span class="default">0</span><span class="keyword">;</span><span class="default">$i</span><span class="keyword">&lt;</span><span class="default">sizeof</span><span class="keyword">(</span><span class="default">$out</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">]);</span><span class="default">$i</span><span class="keyword">++)<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$longueurnombre </span><span class="keyword">= </span><span class="default">strlen</span><span class="keyword">((string)</span><span class="default">$out</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">][</span><span class="default">$i</span><span class="keyword">][</span><span class="default">0</span><span class="keyword">]);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$taillechaine </span><span class="keyword">= </span><span class="default">strlen</span><span class="keyword">(</span><span class="default">$chaine</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// cut the string in 3 pieces<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$debut </span><span class="keyword">= </span><span class="default">substr</span><span class="keyword">(</span><span class="default">$chaine</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">,</span><span class="default">$out</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">][</span><span class="default">$i</span><span class="keyword">][</span><span class="default">1</span><span class="keyword">]);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$milieu </span><span class="keyword">= (</span><span class="default">$out</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">][</span><span class="default">$i</span><span class="keyword">][</span><span class="default">0</span><span class="keyword">])-</span><span class="default">1</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$fin </span><span class="keyword">= </span><span class="default">substr</span><span class="keyword">(</span><span class="default">$chaine</span><span class="keyword">,</span><span class="default">$out</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">][</span><span class="default">$i</span><span class="keyword">][</span><span class="default">1</span><span class="keyword">]+</span><span class="default">$longueurnombre</span><span class="keyword">,</span><span class="default">$taillechaine</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="comment">/* if it's 10,100,1000, the problem is that the string gets shorter and it shifts all the offsets, so we have to decrease them of 1 */<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="keyword">if(</span><span class="default">preg_match</span><span class="keyword">(</span><span class="string">'#[1][0]+$#'</span><span class="keyword">, </span><span class="default">$out</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">][</span><span class="default">$i</span><span class="keyword">][</span><span class="default">0</span><span class="keyword">]))<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; for(</span><span class="default">$j </span><span class="keyword">= </span><span class="default">$i</span><span class="keyword">+</span><span class="default">1</span><span class="keyword">;</span><span class="default">$j</span><span class="keyword">&lt;</span><span class="default">sizeof</span><span class="keyword">(</span><span class="default">$out</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">]);</span><span class="default">$j</span><span class="keyword">++)<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$out</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">][</span><span class="default">$j</span><span class="keyword">][</span><span class="default">1</span><span class="keyword">] = </span><span class="default">$out</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">][</span><span class="default">$j</span><span class="keyword">][</span><span class="default">1</span><span class="keyword">] -</span><span class="default">1</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$chaine </span><span class="keyword">= </span><span class="default">$debut</span><span class="keyword">.</span><span class="default">$milieu</span><span class="keyword">.</span><span class="default">$fin</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">$chaine</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="108539""></a>
  <div class="note">
   <strong class="user">marc</strong>
   <a href="#108539" class="date">05-May-2012 12:48</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Better use preg_replace to convert text in a clickable link with tag &lt;a&gt; <br />
<br />
$html = preg_replace('"\b(<a href="http://" rel="nofollow" target="_blank">http://</a>\S+)"', '&lt;a href="$1"&gt;$1&lt;/a&gt;', $text);</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="105853""></a>
  <div class="note">
   <strong class="user">satyavvd at ymail dot com</strong>
   <a href="#105853" class="date">20-Sep-2011 01:08</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Extract fields out of csv string : ( since before php5.3 you can't use str_getcsv function ) <br />
Here is the regex :<br />
<br />
<span class="default">&lt;?php<br />
<br />
$csvData </span><span class="keyword">= &lt;&lt;&lt;EOF<br />
</span><span class="string">10,'20',"30","'40","'50'","\"60","70,80","09\\/18,/\"2011",'a,sdfcd'<br />
</span><span class="keyword">EOF<br />
<br />
</span><span class="default">$reg </span><span class="keyword">= &lt;&lt;&lt;EOF<br />
</span><span class="string">/<br />
&nbsp;&nbsp;&nbsp; (<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; (<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; ([\'\"])<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; (<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ( <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [^\'\"]<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; |<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; (\\\\.)<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; )*<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; )<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; (\\3)<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; |<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; (<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [^,]<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; |<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; (\\\\.)<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; )*<br />
&nbsp;&nbsp;&nbsp; ),)<br />
&nbsp;&nbsp;&nbsp; /x<br />
</span><span class="keyword">EOF;<br />
<br />
</span><span class="default">preg_match_all</span><span class="keyword">(</span><span class="default">$reg</span><span class="keyword">,</span><span class="default">$csvData</span><span class="keyword">,</span><span class="default">$matches</span><span class="keyword">);<br />
<br />
</span><span class="comment">// to extract csv fields<br />
</span><span class="default">print_r</span><span class="keyword">(</span><span class="default">$matches</span><span class="keyword">[</span><span class="default">2</span><span class="keyword">]);<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="102520""></a>
  <div class="note">
   <strong class="user">john at mccarthy dot net</strong>
   <a href="#102520" class="date">18-Feb-2011 08:21</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I needed a function to rotate the results of a preg_match_all query, and made this. Not sure if it exists.<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">function </span><span class="default">turn_array</span><span class="keyword">(</span><span class="default">$m</span><span class="keyword">)<br />
{<br />
&nbsp;&nbsp;&nbsp; for (</span><span class="default">$z </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">;</span><span class="default">$z </span><span class="keyword">&lt; </span><span class="default">count</span><span class="keyword">(</span><span class="default">$m</span><span class="keyword">);</span><span class="default">$z</span><span class="keyword">++)<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; for (</span><span class="default">$x </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">;</span><span class="default">$x </span><span class="keyword">&lt; </span><span class="default">count</span><span class="keyword">(</span><span class="default">$m</span><span class="keyword">[</span><span class="default">$z</span><span class="keyword">]);</span><span class="default">$x</span><span class="keyword">++)<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$rt</span><span class="keyword">[</span><span class="default">$x</span><span class="keyword">][</span><span class="default">$z</span><span class="keyword">] = </span><span class="default">$m</span><span class="keyword">[</span><span class="default">$z</span><span class="keyword">][</span><span class="default">$x</span><span class="keyword">];<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; }&nbsp; &nbsp; <br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; return </span><span class="default">$rt</span><span class="keyword">;<br />
}<br />
</span><span class="default">?&gt;<br />
</span><br />
Example - Take results of some preg_match_all query:<br />
<br />
Array<br />
(<br />
&nbsp;&nbsp;&nbsp; [0] =&gt; Array<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; (<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [1] =&gt; Banff <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [2] =&gt; Canmore<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [3] =&gt; Invermere<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; )<br />
&nbsp;<br />
&nbsp;&nbsp;&nbsp; [1] =&gt; Array<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; (<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [1] =&gt; AB <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [2] =&gt; AB<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [3] =&gt; BC<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; )<br />
&nbsp;<br />
&nbsp;&nbsp;&nbsp; [2] =&gt; Array<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; (<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [1] =&gt; 51.1746254 <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [2] =&gt; 51.0938416<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [3] =&gt; 50.5065193<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; )<br />
&nbsp;<br />
&nbsp;&nbsp;&nbsp; [3] =&gt; Array<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; (<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [1] =&gt; -115.5719757 <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [2] =&gt; -115.3517761<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [3] =&gt; -116.0321884<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; )<br />
&nbsp;<br />
&nbsp;&nbsp;&nbsp; [4] =&gt; Array<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; (<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [1] =&gt; T1L 1B3 <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [2] =&gt; T1W 1N2<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [3] =&gt; V0B 2G0<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; )<br />
<br />
)<br />
<br />
Rotate it 90 degrees to group results as records:<br />
<br />
Array<br />
(<br />
&nbsp;&nbsp;&nbsp; [0] =&gt; Array<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; (<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [1] =&gt; Banff <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [2] =&gt; AB<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [3] =&gt; 51.1746254<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [4] =&gt; -115.5719757<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [5] =&gt; T1L 1B3<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; )<br />
&nbsp;<br />
&nbsp;&nbsp;&nbsp; [1] =&gt; Array<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; (<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [1] =&gt; Canmore<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [2] =&gt; AB<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [3] =&gt; 51.0938416<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [4] =&gt; -115.3517761<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [5] =&gt; T1W 1N2<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; )<br />
&nbsp;<br />
&nbsp;&nbsp;&nbsp; [2] =&gt; Array<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; (<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [1] =&gt; Invermere<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [2] =&gt; BC<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [3] =&gt; 50.5065193<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [4] =&gt; -116.0321884<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [5] =&gt; V0B 2G0<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; )<br />
)</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="101259""></a>
  <div class="note">
   <strong class="user">buuh</strong>
   <a href="#101259" class="date">06-Dec-2010 11:03</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
if you want to extract all {token}s from a string:<br />
<br />
<span class="default">&lt;?php<br />
$pattern </span><span class="keyword">= </span><span class="string">"/{[^}]*}/"</span><span class="keyword">;<br />
</span><span class="default">$subject </span><span class="keyword">= </span><span class="string">"{token1} foo {token2} bar"</span><span class="keyword">;<br />
</span><span class="default">preg_match_all</span><span class="keyword">(</span><span class="default">$pattern</span><span class="keyword">, </span><span class="default">$subject</span><span class="keyword">, </span><span class="default">$matches</span><span class="keyword">);<br />
</span><span class="default">print_r</span><span class="keyword">(</span><span class="default">$matches</span><span class="keyword">);<br />
</span><span class="default">?&gt;<br />
</span><br />
output:<br />
<br />
Array<br />
(<br />
&nbsp;&nbsp;&nbsp; [0] =&gt; Array<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; (<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [0] =&gt; {token1}<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [1] =&gt; {token2}<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; )<br />
<br />
)</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="99817""></a>
  <div class="note">
   <strong class="user">no at bo dot dy</strong>
   <a href="#99817" class="date">08-Sep-2010 08:23</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
For parsing queries with entities use:<br />
<br />
<span class="default">&lt;?php<br />
preg_match_all</span><span class="keyword">(</span><span class="string">"/(?:^|(?&lt;=\&amp;(?![a-z]+\;)))([^\=]+)=(.*?)(?:$|\&amp;(?![a-z]+\;))/i"</span><span class="keyword">,<br />
&nbsp; </span><span class="default">$s</span><span class="keyword">, </span><span class="default">$m</span><span class="keyword">, </span><span class="default">PREG_SET_ORDER </span><span class="keyword">);<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="93694""></a>
  <div class="note">
   <strong class="user">avengis at gmail dot com</strong>
   <a href="#93694" class="date">23-Sep-2009 11:25</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
The next function works with almost any complex xml/xhtml string<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="comment">/**<br />
* Find and close unclosed xml tags<br />
**/<br />
</span><span class="keyword">function </span><span class="default">close_tags</span><span class="keyword">(</span><span class="default">$text</span><span class="keyword">) {<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$patt_open&nbsp; &nbsp; </span><span class="keyword">= </span><span class="string">"%((?&lt;!&lt;/)(?&lt;=&lt;)[\s]*[^/!&gt;\s]+(?=&gt;|[\s]+[^&gt;]*[^/]&gt;)(?!/&gt;))%"</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$patt_close&nbsp; &nbsp; </span><span class="keyword">= </span><span class="string">"%((?&lt;=&lt;/)([^&gt;]+)(?=&gt;))%"</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; if (</span><span class="default">preg_match_all</span><span class="keyword">(</span><span class="default">$patt_open</span><span class="keyword">,</span><span class="default">$text</span><span class="keyword">,</span><span class="default">$matches</span><span class="keyword">))<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$m_open </span><span class="keyword">= </span><span class="default">$matches</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">];<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if(!empty(</span><span class="default">$m_open</span><span class="keyword">))<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">preg_match_all</span><span class="keyword">(</span><span class="default">$patt_close</span><span class="keyword">,</span><span class="default">$text</span><span class="keyword">,</span><span class="default">$matches2</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$m_close </span><span class="keyword">= </span><span class="default">$matches2</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">];<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">count</span><span class="keyword">(</span><span class="default">$m_open</span><span class="keyword">) &gt; </span><span class="default">count</span><span class="keyword">(</span><span class="default">$m_close</span><span class="keyword">))<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$m_open </span><span class="keyword">= </span><span class="default">array_reverse</span><span class="keyword">(</span><span class="default">$m_open</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; foreach (</span><span class="default">$m_close </span><span class="keyword">as </span><span class="default">$tag</span><span class="keyword">) </span><span class="default">$c_tags</span><span class="keyword">[</span><span class="default">$tag</span><span class="keyword">]++;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; foreach (</span><span class="default">$m_open </span><span class="keyword">as </span><span class="default">$k </span><span class="keyword">=&gt; </span><span class="default">$tag</span><span class="keyword">)&nbsp; &nbsp; if (</span><span class="default">$c_tags</span><span class="keyword">[</span><span class="default">$tag</span><span class="keyword">]--&lt;=</span><span class="default">0</span><span class="keyword">) </span><span class="default">$text</span><span class="keyword">.=</span><span class="string">'&lt;/'</span><span class="keyword">.</span><span class="default">$tag</span><span class="keyword">.</span><span class="string">'&gt;'</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; return </span><span class="default">$text</span><span class="keyword">;<br />
}<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="93504""></a>
  <div class="note">
   <strong class="user">royaltm75 at gmail dot com</strong>
   <a href="#93504" class="date">13-Sep-2009 11:44</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I have received complains, that my html2a() code (see below) doesn't work in some cases. <br />
It is however not the problem with algorithm or procedure, but with PCRE recursive stack limits.<br />
<br />
If you use recursive PCRE (?R) you should remember to increase those two ini settings:<br />
<br />
ini_set('pcre.backtrack_limit', 10000000);<br />
ini_set('pcre.recursion_limit', 10000000);<br />
<br />
But be warned: (from php.ini)<br />
<br />
;Please note that if you set this value to a high number you may consume all<br />
;the available process stack and eventually crash PHP (due to reaching the<br />
;stack size limit imposed by the Operating System).<br />
<br />
I have written this example mainly to demonstrate the power of PCRE LANGUAGE, not the power of it's implementation&nbsp; :) <br />
<br />
But if you like it, use it, of course on your own risk.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="92312""></a>
  <div class="note">
   <strong class="user">elyknosrac at gmail dot com</strong>
   <a href="#92312" class="date">19-Jul-2009 12:51</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Using preg_match_all I made a pretty handy function.<br />
<br />
<span class="default">&lt;?php<br />
<br />
</span><span class="keyword">function </span><span class="default">reg_smart_replace</span><span class="keyword">(</span><span class="default">$pattern</span><span class="keyword">, </span><span class="default">$replacement</span><span class="keyword">, </span><span class="default">$subject</span><span class="keyword">, </span><span class="default">$replacementChar </span><span class="keyword">= </span><span class="string">"$$$"</span><span class="keyword">, </span><span class="default">$limit </span><span class="keyword">= -</span><span class="default">1</span><span class="keyword">)<br />
{<br />
&nbsp;&nbsp;&nbsp; if (! </span><span class="default">$pattern </span><span class="keyword">|| ! </span><span class="default">$subject </span><span class="keyword">|| ! </span><span class="default">$replacement </span><span class="keyword">) { return </span><span class="default">false</span><span class="keyword">; }<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$replacementChar </span><span class="keyword">= </span><span class="default">preg_quote</span><span class="keyword">(</span><span class="default">$replacementChar</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; </span><span class="default">preg_match_all </span><span class="keyword">( </span><span class="default">$pattern</span><span class="keyword">, </span><span class="default">$subject</span><span class="keyword">, </span><span class="default">$matches</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; if (</span><span class="default">$limit </span><span class="keyword">&gt; -</span><span class="default">1</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; foreach (</span><span class="default">$matches </span><span class="keyword">as </span><span class="default">$count </span><span class="keyword">=&gt; </span><span class="default">$value </span><span class="keyword">)<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">$count </span><span class="keyword">+ </span><span class="default">1 </span><span class="keyword">&gt; </span><span class="default">$limit </span><span class="keyword">) { unset(</span><span class="default">$matches</span><span class="keyword">[</span><span class="default">$count</span><span class="keyword">]); }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; foreach (</span><span class="default">$matches</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">] as </span><span class="default">$match</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$rep </span><span class="keyword">= </span><span class="default">ereg_replace</span><span class="keyword">(</span><span class="default">$replacementChar</span><span class="keyword">, </span><span class="default">$match</span><span class="keyword">, </span><span class="default">$replacement</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$subject </span><span class="keyword">= </span><span class="default">ereg_replace</span><span class="keyword">(</span><span class="default">$match</span><span class="keyword">, </span><span class="default">$rep</span><span class="keyword">, </span><span class="default">$subject</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; return </span><span class="default">$subject</span><span class="keyword">;<br />
}<br />
</span><span class="default">?&gt;<br />
</span><br />
This function can turn blocks of text into clickable links or whatever.&nbsp; Example:<br />
<br />
<span class="default">&lt;?php<br />
reg_smart_replace</span><span class="keyword">(</span><span class="default">EMAIL_REGEX</span><span class="keyword">, </span><span class="string">'&lt;a href="<a href="mailto:$$$" rel="nofollow" target="_blank">mailto:$$$</a>"&gt;$$$&lt;/a&gt;'</span><span class="keyword">, </span><span class="default">$description</span><span class="keyword">)<br />
</span><span class="default">?&gt;<br />
</span>will turn all email addresses into actual links.<br />
<br />
Just substitute $$$ with the text that will be found by the regex.&nbsp; If you can't use $$$ then use the 4th parameter $replacementChar</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="90000""></a>
  <div class="note">
   <strong class="user">ad</strong>
   <a href="#90000" class="date">01-Apr-2009 02:18</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
i have made up a simple function to extract a number from a string..<br />
<br />
I am not sure how good it is, but it works.<br />
<br />
It gets only the numbers 0-9, the "-", " ", "(", ")", "."<br />
<br />
characters.. This is as far as I know the most widely used characters for a Phone number.<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">function </span><span class="default">clean_phone_number</span><span class="keyword">(</span><span class="default">$phone</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; if (!empty(</span><span class="default">$phone</span><span class="keyword">)) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="comment">//var_dump($phone);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">preg_match_all</span><span class="keyword">(</span><span class="string">'/[0-9\(\)+.\- ]/s'</span><span class="keyword">, </span><span class="default">$phone</span><span class="keyword">, </span><span class="default">$cleaned</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; foreach(</span><span class="default">$cleaned</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">] as </span><span class="default">$k</span><span class="keyword">=&gt;</span><span class="default">$v</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$ready </span><span class="keyword">.= </span><span class="default">$v</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">var_dump</span><span class="keyword">(</span><span class="default">$ready</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; die;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if (</span><span class="default">mb_strlen</span><span class="keyword">(</span><span class="default">$cleaned</span><span class="keyword">) &gt; </span><span class="default">4 </span><span class="keyword">&amp;&amp; </span><span class="default">mb_strlen</span><span class="keyword">(</span><span class="default">$cleaned</span><span class="keyword">) &lt;=</span><span class="default">25</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; return </span><span class="default">$cleaned</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; else {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; return </span><span class="default">false</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; return </span><span class="default">false</span><span class="keyword">;<br />
}<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="89092""></a>
  <div class="note">
   <strong class="user">royaltm75 at NOSPAM dot gmail dot com</strong>
   <a href="#89092" class="date">21-Feb-2009 11:55</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
The power of pregs is limited only by your *imagination* :)<br />
I wrote this html2a() function using preg recursive match (?R) which provides quite safe and bulletproof html/xml extraction:<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">function </span><span class="default">html2a </span><span class="keyword">( </span><span class="default">$html </span><span class="keyword">) {<br />
&nbsp; if ( !</span><span class="default">preg_match_all</span><span class="keyword">( </span><span class="string">'<br />
@<br />
\&lt;\s*?(\w+)((?:\b(?:\'[^\']*\'|"[^"]*"|[^\&gt;])*)?)\&gt;<br />
((?:(?&gt;[^\&lt;]*)|(?R))*)<br />
\&lt;\/\s*?\\1(?:\b[^\&gt;]*)?\&gt;<br />
|\&lt;\s*(\w+)(\b(?:\'[^\']*\'|"[^"]*"|[^\&gt;])*)?\/?\&gt;<br />
@uxis'</span><span class="keyword">, </span><span class="default">$html </span><span class="keyword">= </span><span class="default">trim</span><span class="keyword">(</span><span class="default">$html</span><span class="keyword">), </span><span class="default">$m</span><span class="keyword">, </span><span class="default">PREG_OFFSET_CAPTURE </span><span class="keyword">| </span><span class="default">PREG_SET_ORDER</span><span class="keyword">) )<br />
&nbsp;&nbsp;&nbsp; return </span><span class="default">$html</span><span class="keyword">;<br />
&nbsp; </span><span class="default">$i </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">;<br />
&nbsp; </span><span class="default">$ret </span><span class="keyword">= array();<br />
&nbsp; foreach (</span><span class="default">$m </span><span class="keyword">as </span><span class="default">$set</span><span class="keyword">) {<br />
&nbsp;&nbsp;&nbsp; if ( </span><span class="default">strlen</span><span class="keyword">( </span><span class="default">$val </span><span class="keyword">= </span><span class="default">trim</span><span class="keyword">( </span><span class="default">substr</span><span class="keyword">(</span><span class="default">$html</span><span class="keyword">, </span><span class="default">$i</span><span class="keyword">, </span><span class="default">$set</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">][</span><span class="default">1</span><span class="keyword">] - </span><span class="default">$i</span><span class="keyword">) ) ) )<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="default">$ret</span><span class="keyword">[] = </span><span class="default">$val</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$val </span><span class="keyword">= </span><span class="default">$set</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">][</span><span class="default">1</span><span class="keyword">] &lt; </span><span class="default">0 <br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="keyword">? array( </span><span class="string">'tag' </span><span class="keyword">=&gt; </span><span class="default">strtolower</span><span class="keyword">(</span><span class="default">$set</span><span class="keyword">[</span><span class="default">4</span><span class="keyword">][</span><span class="default">0</span><span class="keyword">]) )<br />
&nbsp;&nbsp; &nbsp;&nbsp; : array( </span><span class="string">'tag' </span><span class="keyword">=&gt; </span><span class="default">strtolower</span><span class="keyword">(</span><span class="default">$set</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">][</span><span class="default">0</span><span class="keyword">]), </span><span class="string">'val' </span><span class="keyword">=&gt; </span><span class="default">html2a</span><span class="keyword">(</span><span class="default">$set</span><span class="keyword">[</span><span class="default">3</span><span class="keyword">][</span><span class="default">0</span><span class="keyword">]) );<br />
&nbsp;&nbsp;&nbsp; if ( </span><span class="default">preg_match_all</span><span class="keyword">( </span><span class="string">'<br />
/(\w+)\s*(?:=\s*(?:"([^"]*)"|\'([^\']*)\'|(\w+)))?/usix<br />
'</span><span class="keyword">, isset(</span><span class="default">$set</span><span class="keyword">[</span><span class="default">5</span><span class="keyword">]) &amp;&amp; </span><span class="default">$set</span><span class="keyword">[</span><span class="default">2</span><span class="keyword">][</span><span class="default">1</span><span class="keyword">] &lt; </span><span class="default">0<br />
&nbsp; </span><span class="keyword">? </span><span class="default">$set</span><span class="keyword">[</span><span class="default">5</span><span class="keyword">][</span><span class="default">0</span><span class="keyword">]<br />
&nbsp; : </span><span class="default">$set</span><span class="keyword">[</span><span class="default">2</span><span class="keyword">][</span><span class="default">0</span><span class="keyword">]<br />
&nbsp; ,</span><span class="default">$attrs</span><span class="keyword">, </span><span class="default">PREG_SET_ORDER </span><span class="keyword">) ) {<br />
&nbsp;&nbsp; &nbsp;&nbsp; foreach (</span><span class="default">$attrs </span><span class="keyword">as </span><span class="default">$a</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$val</span><span class="keyword">[</span><span class="string">'attr'</span><span class="keyword">][</span><span class="default">$a</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">]]=</span><span class="default">$a</span><span class="keyword">[</span><span class="default">count</span><span class="keyword">(</span><span class="default">$a</span><span class="keyword">)-</span><span class="default">1</span><span class="keyword">];<br />
&nbsp;&nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$ret</span><span class="keyword">[] = </span><span class="default">$val</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$i </span><span class="keyword">= </span><span class="default">$set</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">][</span><span class="default">1</span><span class="keyword">]+</span><span class="default">strlen</span><span class="keyword">( </span><span class="default">$set</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">][</span><span class="default">0</span><span class="keyword">] );<br />
&nbsp; }<br />
&nbsp; </span><span class="default">$l </span><span class="keyword">= </span><span class="default">strlen</span><span class="keyword">(</span><span class="default">$html</span><span class="keyword">);<br />
&nbsp; if ( </span><span class="default">$i </span><span class="keyword">&lt; </span><span class="default">$l </span><span class="keyword">)<br />
&nbsp;&nbsp;&nbsp; if ( </span><span class="default">strlen</span><span class="keyword">( </span><span class="default">$val </span><span class="keyword">= </span><span class="default">trim</span><span class="keyword">( </span><span class="default">substr</span><span class="keyword">( </span><span class="default">$html</span><span class="keyword">, </span><span class="default">$i</span><span class="keyword">, </span><span class="default">$l </span><span class="keyword">- </span><span class="default">$i </span><span class="keyword">) ) ) )<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="default">$ret</span><span class="keyword">[] = </span><span class="default">$val</span><span class="keyword">;<br />
&nbsp; return </span><span class="default">$ret</span><span class="keyword">;<br />
}<br />
</span><span class="default">?&gt;<br />
</span><br />
Now let's try it with this example: (there are some really nasty xhtml compliant bugs, but ... we shouldn't worry)<br />
<br />
<span class="default">&lt;?php<br />
$html </span><span class="keyword">= &lt;&lt;&lt;EOT<br />
</span><span class="string">some leftover text...<br />
&nbsp;&nbsp; &nbsp; &lt; DIV class=noCompliant style = "text-align:left;" &gt;<br />
... and some other ...<br />
&lt; dIv &gt; &lt; empty&gt;&nbsp; &lt;/ empty&gt;<br />
&nbsp; &lt;p&gt; This is yet another text &lt;br&nbsp; &gt;<br />
&nbsp;&nbsp; &nbsp; that wasn't &lt;b&gt;compliant&lt;/b&gt; too... &lt;br&nbsp;&nbsp; /&gt;<br />
&nbsp;&nbsp; &nbsp; &lt;/p&gt;<br />
&nbsp;&lt;div class="noClass" &gt; this one is better but we don't care anyway &lt;/div &gt;&lt;P&gt;<br />
&nbsp;&nbsp;&nbsp; &lt;input&nbsp;&nbsp; type= "text"&nbsp; name ='my "name' value&nbsp; = "nothin really." readonly&gt;<br />
end of paragraph &lt;/p&gt; &lt;/Div&gt;&nbsp;&nbsp; &lt;/div&gt;&nbsp;&nbsp; some trailing text <br />
</span><span class="keyword">EOT;<br />
<br />
</span><span class="default">$a </span><span class="keyword">= </span><span class="default">html2a</span><span class="keyword">(</span><span class="default">$html</span><span class="keyword">);<br />
</span><span class="comment">//now we will make some neat html out of it<br />
</span><span class="keyword">echo </span><span class="default">a2html</span><span class="keyword">(</span><span class="default">$a</span><span class="keyword">);<br />
<br />
function </span><span class="default">a2html </span><span class="keyword">( </span><span class="default">$a</span><span class="keyword">, </span><span class="default">$in </span><span class="keyword">= </span><span class="string">"" </span><span class="keyword">) {<br />
&nbsp; if ( </span><span class="default">is_array</span><span class="keyword">(</span><span class="default">$a</span><span class="keyword">) ) {<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$s </span><span class="keyword">= </span><span class="string">""</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; foreach (</span><span class="default">$a </span><span class="keyword">as </span><span class="default">$t</span><span class="keyword">)<br />
&nbsp;&nbsp; &nbsp;&nbsp; if ( </span><span class="default">is_array</span><span class="keyword">(</span><span class="default">$t</span><span class="keyword">) ) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$attrs</span><span class="keyword">=</span><span class="string">""</span><span class="keyword">; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if ( isset(</span><span class="default">$t</span><span class="keyword">[</span><span class="string">'attr'</span><span class="keyword">]) )<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; foreach( </span><span class="default">$t</span><span class="keyword">[</span><span class="string">'attr'</span><span class="keyword">] as </span><span class="default">$k </span><span class="keyword">=&gt; </span><span class="default">$v </span><span class="keyword">)<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$attrs</span><span class="keyword">.=</span><span class="string">" </span><span class="keyword">${</span><span class="default">k</span><span class="keyword">}</span><span class="string">="</span><span class="keyword">.( </span><span class="default">strpos</span><span class="keyword">( </span><span class="default">$v</span><span class="keyword">, </span><span class="string">'"' </span><span class="keyword">)!==</span><span class="default">false </span><span class="keyword">? </span><span class="string">"'</span><span class="default">$v</span><span class="string">'" </span><span class="keyword">: </span><span class="string">"\"</span><span class="default">$v</span><span class="string">\"" </span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$s</span><span class="keyword">.= </span><span class="default">$in</span><span class="keyword">.</span><span class="string">"&lt;"</span><span class="keyword">.</span><span class="default">$t</span><span class="keyword">[</span><span class="string">'tag'</span><span class="keyword">].</span><span class="default">$attrs</span><span class="keyword">.( isset( </span><span class="default">$t</span><span class="keyword">[</span><span class="string">'val'</span><span class="keyword">] ) ? </span><span class="string">"&gt;\n"</span><span class="keyword">.</span><span class="default">a2html</span><span class="keyword">( </span><span class="default">$t</span><span class="keyword">[</span><span class="string">'val'</span><span class="keyword">], </span><span class="default">$in</span><span class="keyword">.</span><span class="string">"&nbsp; " </span><span class="keyword">).</span><span class="default">$in</span><span class="keyword">.</span><span class="string">"&lt;/"</span><span class="keyword">.</span><span class="default">$t</span><span class="keyword">[</span><span class="string">'tag'</span><span class="keyword">] : </span><span class="string">"/" </span><span class="keyword">).</span><span class="string">"&gt;\n"</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp;&nbsp; } else<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$s</span><span class="keyword">.= </span><span class="default">$in</span><span class="keyword">.</span><span class="default">$t</span><span class="keyword">.</span><span class="string">"\n"</span><span class="keyword">;<br />
&nbsp; } else {<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$s </span><span class="keyword">= empty(</span><span class="default">$a</span><span class="keyword">) ? </span><span class="string">"" </span><span class="keyword">: </span><span class="default">$in</span><span class="keyword">.</span><span class="default">$a</span><span class="keyword">.</span><span class="string">"\n"</span><span class="keyword">;<br />
&nbsp; }<br />
&nbsp; return </span><span class="default">$s</span><span class="keyword">;<br />
}<br />
</span><span class="default">?&gt;<br />
</span>This produces:<br />
some leftover text...<br />
&lt;div class="noCompliant" style="text-align:left;"&gt;<br />
&nbsp; ... and some other ...<br />
&nbsp; &lt;div&gt;<br />
&nbsp;&nbsp;&nbsp; &lt;empty&gt;<br />
&nbsp;&nbsp;&nbsp; &lt;/empty&gt;<br />
&nbsp;&nbsp;&nbsp; &lt;p&gt;<br />
&nbsp;&nbsp; &nbsp;&nbsp; This is yet another text<br />
&nbsp;&nbsp; &nbsp;&nbsp; &lt;br/&gt;<br />
&nbsp;&nbsp; &nbsp;&nbsp; that wasn't<br />
&nbsp;&nbsp; &nbsp;&nbsp; &lt;b&gt;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; compliant<br />
&nbsp;&nbsp; &nbsp;&nbsp; &lt;/b&gt;<br />
&nbsp;&nbsp; &nbsp;&nbsp; too...<br />
&nbsp;&nbsp; &nbsp;&nbsp; &lt;br/&gt;<br />
&nbsp;&nbsp;&nbsp; &lt;/p&gt;<br />
&nbsp;&nbsp;&nbsp; &lt;div class="noClass"&gt;<br />
&nbsp;&nbsp; &nbsp;&nbsp; this one is better but we don't care anyway<br />
&nbsp;&nbsp;&nbsp; &lt;/div&gt;<br />
&nbsp;&nbsp;&nbsp; &lt;p&gt;<br />
&nbsp;&nbsp; &nbsp;&nbsp; &lt;input type="text" name='my "name' value="nothin really." readonly="readonly"/&gt;<br />
&nbsp;&nbsp; &nbsp;&nbsp; end of paragraph<br />
&nbsp;&nbsp;&nbsp; &lt;/p&gt;<br />
&nbsp; &lt;/div&gt;<br />
&lt;/div&gt;<br />
some trailing text</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="86366""></a>
  <div class="note">
   <strong class="user">meaneye at mail dot com</strong>
   <a href="#86366" class="date">15-Oct-2008 11:56</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Recently I had to write search engine in hebrew and ran into huge amount of problems. My data was stored in MySQL table with utf8_bin encoding.<br />
<br />
So, to be able to write hebrew in utf8 table you need to do<br />
<span class="default">&lt;?php<br />
$prepared_text </span><span class="keyword">= </span><span class="default">addslashes</span><span class="keyword">(</span><span class="default">urf8_encode</span><span class="keyword">(</span><span class="default">$text</span><span class="keyword">));<br />
</span><span class="default">?&gt;<br />
</span><br />
But then I had to find if some word exists in stored text. This is the place I got stuck. Simple preg_match would not find text since hebrew doesnt work that easy. I've tried with /u and who kows what else.<br />
<br />
Solution was somewhat logical and simple... <br />
<span class="default">&lt;?php<br />
$db_text </span><span class="keyword">= </span><span class="default">bin2hex</span><span class="keyword">(</span><span class="default">stripslashes</span><span class="keyword">(</span><span class="default">utf8_decode</span><span class="keyword">(</span><span class="default">$db_text</span><span class="keyword">)));<br />
</span><span class="default">$word </span><span class="keyword">= </span><span class="default">bin2hex</span><span class="keyword">(</span><span class="default">$word</span><span class="keyword">);<br />
<br />
</span><span class="default">$found </span><span class="keyword">= </span><span class="default">preg_match_all</span><span class="keyword">(</span><span class="string">"/(</span><span class="default">$word</span><span class="string">)+/i"</span><span class="keyword">, </span><span class="default">$db_text</span><span class="keyword">, </span><span class="default">$matches</span><span class="keyword">);<br />
</span><span class="default">?&gt;<br />
</span><br />
I've used preg_match_all since it returns number of occurences. So I could sort search results acording to that.<br />
<br />
Hope someone finds this useful!</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="86182""></a>
  <div class="note">
   <strong class="user">MonkeyMan</strong>
   <a href="#86182" class="date">07-Oct-2008 10:25</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Here is a way to match everything on the page, performing an action for each match as you go. I had used this idiom in other languages, where its use is customary, but in PHP it seems to be not quite as common.<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">function </span><span class="default">custom_preg_match_all</span><span class="keyword">(</span><span class="default">$pattern</span><span class="keyword">, </span><span class="default">$subject</span><span class="keyword">)<br />
{<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$offset </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$match_count </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; while(</span><span class="default">preg_match</span><span class="keyword">(</span><span class="default">$pattern</span><span class="keyword">, </span><span class="default">$subject</span><span class="keyword">, </span><span class="default">$matches</span><span class="keyword">, </span><span class="default">PREG_OFFSET_CAPTURE</span><span class="keyword">, </span><span class="default">$offset</span><span class="keyword">))<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// Increment counter<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$match_count</span><span class="keyword">++;<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// Get byte offset and byte length (assuming single byte encoded)<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$match_start </span><span class="keyword">= </span><span class="default">$matches</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">][</span><span class="default">1</span><span class="keyword">];<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$match_length </span><span class="keyword">= </span><span class="default">strlen</span><span class="keyword">(</span><span class="default">matches</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">][</span><span class="default">0</span><span class="keyword">]);<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// (Optional) Transform $matches to the format it is usually set as (without PREG_OFFSET_CAPTURE set)<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">foreach(</span><span class="default">$matches </span><span class="keyword">as </span><span class="default">$k </span><span class="keyword">=&gt; </span><span class="default">$match</span><span class="keyword">) </span><span class="default">$newmatches</span><span class="keyword">[</span><span class="default">$k</span><span class="keyword">] = </span><span class="default">$match</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">];<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$matches </span><span class="keyword">= </span><span class="default">$new_matches</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// Your code here<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">echo </span><span class="string">"Match number </span><span class="default">$match_count</span><span class="string">, at byte offset </span><span class="default">$match_start</span><span class="string">, </span><span class="default">$match_length</span><span class="string"> bytes long: "</span><span class="keyword">.</span><span class="default">$matches</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">].</span><span class="string">"\r\n"</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// Update offset to the end of the match<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$offset </span><span class="keyword">= </span><span class="default">$match_start </span><span class="keyword">+ </span><span class="default">$match_length</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp;&nbsp; return </span><span class="default">$match_count</span><span class="keyword">;<br />
}<br />
</span><span class="default">?&gt;<br />
</span><br />
Note that the offsets returned are byte values (not necessarily number of characters) so you'll have to make sure the data is single-byte encoded. (Or have a look at paolo mosna's strByte function on the strlen manual page).<br />
I'd be interested to know how this method performs speedwise against using preg_match_all and then recursing through the results.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="83944""></a>
  <div class="note">
   <strong class="user">sledge NOSPAM</strong>
   <a href="#83944" class="date">19-Jun-2008 10:46</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Perhaps you want to find the positions of all anchor tags.&nbsp; This will return a two dimensional array of which the starting and ending positions will be returned.<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">function </span><span class="default">getTagPositions</span><span class="keyword">(</span><span class="default">$strBody</span><span class="keyword">)<br />
{<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">define</span><span class="keyword">(</span><span class="default">DEBUG</span><span class="keyword">, </span><span class="default">false</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">define</span><span class="keyword">(</span><span class="default">DEBUG_FILE_PREFIX</span><span class="keyword">, </span><span class="string">"/tmp/findlinks_"</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; </span><span class="default">preg_match_all</span><span class="keyword">(</span><span class="string">"/&lt;[^&gt;]+&gt;(.*)&lt;\/[^&gt;]+&gt;/U"</span><span class="keyword">, </span><span class="default">$strBody</span><span class="keyword">, </span><span class="default">$strTag</span><span class="keyword">, </span><span class="default">PREG_PATTERN_ORDER</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$intOffset </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$intIndex </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$intTagPositions </span><span class="keyword">= array();<br />
<br />
&nbsp;&nbsp;&nbsp; foreach(</span><span class="default">$strTag</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">] as </span><span class="default">$strFullTag</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if(</span><span class="default">DEBUG </span><span class="keyword">== </span><span class="default">true</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$fhDebug </span><span class="keyword">= </span><span class="default">fopen</span><span class="keyword">(</span><span class="default">DEBUG_FILE_PREFIX</span><span class="keyword">.</span><span class="default">time</span><span class="keyword">(), </span><span class="string">"a"</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">fwrite</span><span class="keyword">(</span><span class="default">$fhDebug</span><span class="keyword">, </span><span class="default">$fulltag</span><span class="keyword">.</span><span class="string">"\n"</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">fwrite</span><span class="keyword">(</span><span class="default">$fhDebug</span><span class="keyword">, </span><span class="string">"Starting position: "</span><span class="keyword">.</span><span class="default">strpos</span><span class="keyword">(</span><span class="default">$strBody</span><span class="keyword">, </span><span class="default">$strFullTag</span><span class="keyword">, </span><span class="default">$intOffset</span><span class="keyword">).</span><span class="string">"\n"</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">fwrite</span><span class="keyword">(</span><span class="default">$fhDebug</span><span class="keyword">, </span><span class="string">"Ending position: "</span><span class="keyword">.(</span><span class="default">strpos</span><span class="keyword">(</span><span class="default">$strBody</span><span class="keyword">, </span><span class="default">$strFullTag</span><span class="keyword">, </span><span class="default">$intOffset</span><span class="keyword">) + </span><span class="default">strlen</span><span class="keyword">(</span><span class="default">$strFullTag</span><span class="keyword">)).</span><span class="string">"\n"</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">fwrite</span><span class="keyword">(</span><span class="default">$fhDebug</span><span class="keyword">, </span><span class="string">"Length: "</span><span class="keyword">.</span><span class="default">strlen</span><span class="keyword">(</span><span class="default">$strFullTag</span><span class="keyword">).</span><span class="string">"\n\n"</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">fclose</span><span class="keyword">(</span><span class="default">$fhDebug</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$intTagPositions</span><span class="keyword">[</span><span class="default">$intIndex</span><span class="keyword">] = array(</span><span class="string">'start' </span><span class="keyword">=&gt; (</span><span class="default">strpos</span><span class="keyword">(</span><span class="default">$strBody</span><span class="keyword">, </span><span class="default">$strFullTag</span><span class="keyword">, </span><span class="default">$intOffset</span><span class="keyword">)), </span><span class="string">'end' </span><span class="keyword">=&gt; (</span><span class="default">strpos</span><span class="keyword">(</span><span class="default">$strBody</span><span class="keyword">, </span><span class="default">$strFullTag</span><span class="keyword">, </span><span class="default">$intOffset</span><span class="keyword">) + </span><span class="default">strlen</span><span class="keyword">(</span><span class="default">$strFullTag</span><span class="keyword">)));<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$intOffset </span><span class="keyword">+= </span><span class="default">strlen</span><span class="keyword">(</span><span class="default">$strFullTag</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$intIndex</span><span class="keyword">++;<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; return </span><span class="default">$intTagPositions</span><span class="keyword">;<br />
}<br />
<br />
</span><span class="default">$strBody </span><span class="keyword">= </span><span class="string">'I have lots of &lt;a href="<a href="http://my.site.com" rel="nofollow" target="_blank">http://my.site.com</a>"&gt;links&lt;/a&gt; on this &lt;a href="<a href="http://my.site.com" rel="nofollow" target="_blank">http://my.site.com</a>"&gt;page&lt;/a&gt; that I want to &lt;a href="<a href="http://my.site.com" rel="nofollow" target="_blank">http://my.site.com</a>"&gt;find&lt;/a&gt; the positions.'</span><span class="keyword">;<br />
<br />
</span><span class="default">$strBody </span><span class="keyword">= </span><span class="default">strip_tags</span><span class="keyword">(</span><span class="default">html_entity_decode</span><span class="keyword">(</span><span class="default">$strBody</span><span class="keyword">), </span><span class="string">'&lt;a&gt;'</span><span class="keyword">);<br />
</span><span class="default">$intTagPositions </span><span class="keyword">= </span><span class="default">getTagPositions</span><span class="keyword">(</span><span class="default">$strBody</span><span class="keyword">);<br />
</span><span class="default">print_r</span><span class="keyword">(</span><span class="default">$intTagPositions</span><span class="keyword">);<br />
<br />
</span><span class="comment">/*****<br />
Output:<br />
<br />
Array ( <br />
&nbsp;&nbsp;&nbsp; [0] =&gt; Array ( <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; [start] =&gt; 15 <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; [end] =&gt; 53 ) <br />
&nbsp;&nbsp;&nbsp; [1] =&gt; Array ( <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; [start] =&gt; 62 <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; [end] =&gt; 99 ) <br />
&nbsp;&nbsp;&nbsp; [2] =&gt; Array ( <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; [start] =&gt; 115 <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; [end] =&gt; 152 )<br />
&nbsp;) <br />
*****/<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="82661""></a>
  <div class="note">
   <strong class="user">spambegone at cratemedia dot com</strong>
   <a href="#82661" class="date">21-Apr-2008 08:39</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I found simpleXML to be useful only in cases where the XML was extremely small, otherwise the server would run out of memory (I suspect there is a memory leak or something?). So while searching for alternative parsers, I decided to try a simpler approach. I don't know how this compares with cpu usage, but I know it works with large XML structures. This is more a manual method, but it works for me since I always know what structure of data I will be receiving. <br />
<br />
Essentially I just preg_match() unique nodes to find the values I am looking for, or I preg_match_all to find multiple nodes. This puts the results in an array and I can then process this data as I please.<br />
<br />
I was unhappy though, that preg_match_all() stores the data twice (requiring twice the memory), one array for all the full pattern matches, and one array for all the sub pattern matches. You could probably write your own function that overcame this. But for now this works for me, and I hope it saves someone else some time as well.<br />
<br />
// SAMPLE XML<br />
&lt;RETS ReplyCode="0" ReplyText="Operation Successful"&gt;<br />
&nbsp; &lt;COUNT Records="14" /&gt;<br />
&nbsp; &lt;DELIMITER value="09" /&gt;<br />
&nbsp; &lt;COLUMNS&gt;PropertyID&lt;/COLUMNS&gt;<br />
&nbsp; &lt;DATA&gt;521897&lt;/DATA&gt;<br />
&nbsp; &lt;DATA&gt;677208&lt;/DATA&gt;<br />
&nbsp; &lt;DATA&gt;686037&lt;/DATA&gt;<br />
&lt;/RETS&gt;<br />
<br />
<span class="default">&lt;?PHP<br />
<br />
</span><span class="comment">// SAMPLE FUNCTION<br />
</span><span class="keyword">function </span><span class="default">parse_xml</span><span class="keyword">(</span><span class="default">$xml</span><span class="keyword">) {<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">// GET DELIMITER (single instance)<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$match_res </span><span class="keyword">= </span><span class="default">preg_match</span><span class="keyword">(</span><span class="string">'/&lt;DELIMITER value ?= ?"(.*)" ?\/&gt;/'</span><span class="keyword">, </span><span class="default">$xml</span><span class="keyword">, </span><span class="default">$matches</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; if(!empty(</span><span class="default">$matches</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">])) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$results</span><span class="keyword">[</span><span class="string">"delimiter"</span><span class="keyword">] = </span><span class="default">chr</span><span class="keyword">(</span><span class="default">$matches</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">]);<br />
&nbsp;&nbsp;&nbsp; } else {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// DEFAULT DELIMITER<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$results</span><span class="keyword">[</span><span class="string">"delimiter"</span><span class="keyword">] = </span><span class="string">"\t"</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; unset(</span><span class="default">$match_res</span><span class="keyword">, </span><span class="default">$matches</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">// GET MULTIPLE DATA NODES (multiple instances)<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$results</span><span class="keyword">[</span><span class="string">"data_count"</span><span class="keyword">] = </span><span class="default">preg_match_all</span><span class="keyword">(</span><span class="string">"/&lt;DATA&gt;(.*)&lt;\/DATA&gt;/"</span><span class="keyword">, </span><span class="default">$xml</span><span class="keyword">, </span><span class="default">$matches</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">// GET MATCHES OF SUB PATTERN, DISCARD THE REST<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$results</span><span class="keyword">[</span><span class="string">"data"</span><span class="keyword">]=</span><span class="default">$matches</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">];<br />
&nbsp;&nbsp;&nbsp; unset(</span><span class="default">$match_res</span><span class="keyword">, </span><span class="default">$matches</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">// UNSET XML TO SAVE MEMORY (should unset outside the function as well)<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">unset(</span><span class="default">$xml</span><span class="keyword">);<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">// RETURN RESULTS ARRAY<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">return </span><span class="default">$results</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; <br />
}<br />
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="81559""></a>
  <div class="note">
   <strong class="user">bruha</strong>
   <a href="#81559" class="date">04-Mar-2008 09:13</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
To count str_length in UTF-8 string i use<br />
<br />
$count = preg_match_all("/[[:print:]\pL]/u", $str, $pockets);<br />
<br />
where<br />
[:print:] - printing characters, including space<br />
\pL - UTF-8 Letter<br />
/u - UTF-8 string<br />
other unicode character properties on <a href="http://www.pcre.org/pcre.txt" rel="nofollow" target="_blank">http://www.pcre.org/pcre.txt</a></span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="80681""></a>
  <div class="note">
   <strong class="user">dolbegraeb</strong>
   <a href="#80681" class="date">29-Jan-2008 01:30</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
please note, that the function of "mail at SPAMBUSTER at milianw dot de" can result in invalid xhtml in some cases. think i used it in the right way but my result is sth like this:<br />
<br />
&lt;img src="./img.jpg" alt="nice picture" /&gt;foo foo foo foo &lt;/img&gt;<br />
<br />
correct me if i'm wrong. <br />
i'll see when there's time to fix that. -.-</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="76388""></a>
  <div class="note">
   <strong class="user">mr davin</strong>
   <a href="#76388" class="date">12-Jul-2007 11:57</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
<span class="default">&lt;?php<br />
</span><span class="comment">// Returns an array of strings where the start and end are found<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">function </span><span class="default">findinside</span><span class="keyword">(</span><span class="default">$start</span><span class="keyword">, </span><span class="default">$end</span><span class="keyword">, </span><span class="default">$string</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">preg_match_all</span><span class="keyword">(</span><span class="string">'/' </span><span class="keyword">. </span><span class="default">preg_quote</span><span class="keyword">(</span><span class="default">$start</span><span class="keyword">, </span><span class="string">'/'</span><span class="keyword">) . </span><span class="string">'([^\.)]+)'</span><span class="keyword">. </span><span class="default">preg_quote</span><span class="keyword">(</span><span class="default">$end</span><span class="keyword">, </span><span class="string">'/'</span><span class="keyword">).</span><span class="string">'/i'</span><span class="keyword">, </span><span class="default">$string</span><span class="keyword">, </span><span class="default">$m</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">$m</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">];<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$start </span><span class="keyword">= </span><span class="string">"mary has"</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$end </span><span class="keyword">= </span><span class="string">"lambs."</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$string </span><span class="keyword">= </span><span class="string">"mary has 6 lambs. phil has 13 lambs. mary stole phil's lambs. now mary has all the lambs."</span><span class="keyword">;<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$out </span><span class="keyword">= </span><span class="default">findinside</span><span class="keyword">(</span><span class="default">$start</span><span class="keyword">, </span><span class="default">$end</span><span class="keyword">, </span><span class="default">$string</span><span class="keyword">);<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">print_r </span><span class="keyword">(</span><span class="default">$out</span><span class="keyword">);<br />
<br />
</span><span class="comment">/* Results in <br />
(<br />
&nbsp;&nbsp;&nbsp; [0] =&gt;&nbsp; 6 <br />
&nbsp;&nbsp;&nbsp; [1] =&gt;&nbsp; all the <br />
)<br />
*/ <br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="76027""></a>
  <div class="note">
   <strong class="user">phektus at gmail dot com</strong>
   <a href="#76027" class="date">27-Jun-2007 08:22</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If you'd like to include DOUBLE QUOTES on a regular expression for use with preg_match_all, try ESCAPING THRICE, as in: \\\"<br />
<br />
For example, the pattern:<br />
'/&lt;table&gt;[\s\w\/&lt;&gt;=\\\"]*&lt;\/table&gt;/'<br />
<br />
Should be able to match:<br />
&lt;table&gt;<br />
&lt;row&gt;<br />
&lt;col align="left" valign="top"&gt;a&lt;/col&gt;<br />
&lt;col align="right" valign="bottom"&gt;b&lt;/col&gt;<br />
&lt;/row&gt;<br />
&lt;/table&gt;<br />
.. with all there is under those table tags.<br />
<br />
I'm not really sure why this is so, but I tried just the double quote and one or even two escape characters and it won't work. In my frustration I added another one and then it's cool.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="71572""></a>
  <div class="note">
   <strong class="user">chuckie</strong>
   <a href="#71572" class="date">06-Dec-2006 03:20</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
This is a function to convert byte offsets into (UTF-8) character offsets (this is reagardless of whether you use /u modifier:<br />
<br />
<span class="default">&lt;?php<br />
<br />
</span><span class="keyword">function </span><span class="default">mb_preg_match_all</span><span class="keyword">(</span><span class="default">$ps_pattern</span><span class="keyword">, </span><span class="default">$ps_subject</span><span class="keyword">, &amp;</span><span class="default">$pa_matches</span><span class="keyword">, </span><span class="default">$pn_flags </span><span class="keyword">= </span><span class="default">PREG_PATTERN_ORDER</span><span class="keyword">, </span><span class="default">$pn_offset </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">, </span><span class="default">$ps_encoding </span><span class="keyword">= </span><span class="default">NULL</span><span class="keyword">) {<br />
&nbsp; </span><span class="comment">// WARNING! - All this function does is to correct offsets, nothing else:<br />
&nbsp; //<br />
&nbsp; </span><span class="keyword">if (</span><span class="default">is_null</span><span class="keyword">(</span><span class="default">$ps_encoding</span><span class="keyword">))<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$ps_encoding </span><span class="keyword">= </span><span class="default">mb_internal_encoding</span><span class="keyword">();<br />
<br />
&nbsp; </span><span class="default">$pn_offset </span><span class="keyword">= </span><span class="default">strlen</span><span class="keyword">(</span><span class="default">mb_substr</span><span class="keyword">(</span><span class="default">$ps_subject</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">$pn_offset</span><span class="keyword">, </span><span class="default">$ps_encoding</span><span class="keyword">));<br />
&nbsp; </span><span class="default">$ret </span><span class="keyword">= </span><span class="default">preg_match_all</span><span class="keyword">(</span><span class="default">$ps_pattern</span><span class="keyword">, </span><span class="default">$ps_subject</span><span class="keyword">, </span><span class="default">$pa_matches</span><span class="keyword">, </span><span class="default">$pn_flags</span><span class="keyword">, </span><span class="default">$pn_offset</span><span class="keyword">);<br />
<br />
&nbsp; if (</span><span class="default">$ret </span><span class="keyword">&amp;&amp; (</span><span class="default">$pn_flags </span><span class="keyword">&amp; </span><span class="default">PREG_OFFSET_CAPTURE</span><span class="keyword">))<br />
&nbsp;&nbsp;&nbsp; foreach(</span><span class="default">$pa_matches </span><span class="keyword">as &amp;</span><span class="default">$ha_match</span><span class="keyword">)<br />
&nbsp;&nbsp; &nbsp;&nbsp; foreach(</span><span class="default">$ha_match </span><span class="keyword">as &amp;</span><span class="default">$ha_match</span><span class="keyword">)<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$ha_match</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">] = </span><span class="default">mb_strlen</span><span class="keyword">(</span><span class="default">substr</span><span class="keyword">(</span><span class="default">$ps_subject</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">$ha_match</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">]), </span><span class="default">$ps_encoding</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">//<br />
&nbsp;&nbsp;&nbsp; // (code is independent of PREG_PATTER_ORDER / PREG_SET_ORDER)<br />
<br />
&nbsp; </span><span class="keyword">return </span><span class="default">$ret</span><span class="keyword">;<br />
&nbsp; }<br />
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="62104""></a>
  <div class="note">
   <strong class="user">phpnet at sinful-music dot com</strong>
   <a href="#62104" class="date">20-Feb-2006 09:53</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Here's some fleecy code to 1. validate RCF2822 conformity of address lists and 2. to extract the address specification (the part commonly known as 'email'). I wouldn't suggest using it for input form email checking, but it might be just what you want for other email applications. I know it can be optimized further, but that part I'll leave up to you nutcrackers. The total length of the resulting Regex is about 30000 bytes. That because it accepts comments. You can remove that by setting $cfws to $fws and it shrinks to about 6000 bytes. Conformity checking is absolutely and strictly referring to RFC2822. Have fun and email me if you have any enhancements!<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">function </span><span class="default">mime_extract_rfc2822_address</span><span class="keyword">(</span><span class="default">$string</span><span class="keyword">)<br />
{<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">//rfc2822 token setup<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$crlf&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">= </span><span class="string">"(?:\r\n)"</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$wsp&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="keyword">= </span><span class="string">"[\t ]"</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$text&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">= </span><span class="string">"[\\x01-\\x09\\x0B\\x0C\\x0E-\\x7F]"</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$quoted_pair&nbsp; &nbsp; </span><span class="keyword">= </span><span class="string">"(?:\\\\</span><span class="default">$text</span><span class="string">)"</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$fws&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="keyword">= </span><span class="string">"(?:(?:</span><span class="default">$wsp</span><span class="string">*</span><span class="default">$crlf</span><span class="string">)?</span><span class="default">$wsp</span><span class="string">+)"</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$ctext&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="keyword">= </span><span class="string">"[\\x01-\\x08\\x0B\\x0C\\x0E-\\x1F" </span><span class="keyword">.<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="string">"!-'*-[\\]-\\x7F]"</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$comment&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="keyword">= </span><span class="string">"(\\((?:</span><span class="default">$fws</span><span class="string">?(?:</span><span class="default">$ctext</span><span class="string">|</span><span class="default">$quoted_pair</span><span class="string">|(?1)))*" </span><span class="keyword">.<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="string">"</span><span class="default">$fws</span><span class="string">?\\))"</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$cfws&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">= </span><span class="string">"(?:(?:</span><span class="default">$fws</span><span class="string">?</span><span class="default">$comment</span><span class="string">)*(?:(?:</span><span class="default">$fws</span><span class="string">?</span><span class="default">$comment</span><span class="string">)|</span><span class="default">$fws</span><span class="string">))"</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">//$cfws&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; = $fws; //an alternative to comments<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$atext&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="keyword">= </span><span class="string">"[!#-'*+\\-\\/0-9=?A-Z\\^-~]"</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$atom&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">= </span><span class="string">"(?:</span><span class="default">$cfws</span><span class="string">?</span><span class="default">$atext</span><span class="string">+</span><span class="default">$cfws</span><span class="string">?)"</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$dot_atom_text&nbsp; </span><span class="keyword">= </span><span class="string">"(?:</span><span class="default">$atext</span><span class="string">+(?:\\.</span><span class="default">$atext</span><span class="string">+)*)"</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$dot_atom&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">= </span><span class="string">"(?:</span><span class="default">$cfws</span><span class="string">?</span><span class="default">$dot_atom_text$cfws</span><span class="string">?)"</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$qtext&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="keyword">= </span><span class="string">"[\\x01-\\x08\\x0B\\x0C\\x0E-\\x1F!#-[\\]-\\x7F]"</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$qcontent&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">= </span><span class="string">"(?:</span><span class="default">$qtext</span><span class="string">|</span><span class="default">$quoted_pair</span><span class="string">)"</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$quoted_string&nbsp; </span><span class="keyword">= </span><span class="string">"(?:</span><span class="default">$cfws</span><span class="string">?\"(?:</span><span class="default">$fws</span><span class="string">?</span><span class="default">$qcontent</span><span class="string">)*</span><span class="default">$fws</span><span class="string">?\"</span><span class="default">$cfws</span><span class="string">?)"</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$dtext&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="keyword">= </span><span class="string">"[\\x01-\\x08\\x0B\\x0C\\x0E-\\x1F!-Z\\^-\\x7F]"</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$dcontent&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">= </span><span class="string">"(?:</span><span class="default">$dtext</span><span class="string">|</span><span class="default">$quoted_pair</span><span class="string">)"</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$domain_literal </span><span class="keyword">= </span><span class="string">"(?:</span><span class="default">$cfws</span><span class="string">?\\[(?:</span><span class="default">$fws</span><span class="string">?</span><span class="default">$dcontent</span><span class="string">)*</span><span class="default">$fws</span><span class="string">?]</span><span class="default">$cfws</span><span class="string">?)"</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$domain&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">= </span><span class="string">"(?:</span><span class="default">$dot_atom</span><span class="string">|</span><span class="default">$domain_literal</span><span class="string">)"</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$local_part&nbsp; &nbsp;&nbsp; </span><span class="keyword">= </span><span class="string">"(?:</span><span class="default">$dot_atom</span><span class="string">|</span><span class="default">$quoted_string</span><span class="string">)"</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$addr_spec&nbsp; &nbsp; &nbsp; </span><span class="keyword">= </span><span class="string">"(</span><span class="default">$local_part</span><span class="string">@</span><span class="default">$domain</span><span class="string">)"</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$display_name&nbsp;&nbsp; </span><span class="keyword">= </span><span class="string">"(?:(?:</span><span class="default">$atom</span><span class="string">|</span><span class="default">$quoted_string</span><span class="string">)+)"</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$angle_addr&nbsp; &nbsp;&nbsp; </span><span class="keyword">= </span><span class="string">"(?:</span><span class="default">$cfws</span><span class="string">?&lt;</span><span class="default">$addr_spec</span><span class="string">&gt;</span><span class="default">$cfws</span><span class="string">?)"</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$name_addr&nbsp; &nbsp; &nbsp; </span><span class="keyword">= </span><span class="string">"(?:</span><span class="default">$display_name</span><span class="string">?</span><span class="default">$angle_addr</span><span class="string">)"</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$mailbox&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="keyword">= </span><span class="string">"(?:</span><span class="default">$name_addr</span><span class="string">|</span><span class="default">$addr_spec</span><span class="string">)"</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$mailbox_list&nbsp;&nbsp; </span><span class="keyword">= </span><span class="string">"(?:(?:(?:(?&lt;=:)|,)</span><span class="default">$mailbox</span><span class="string">)+)"</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$group&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="keyword">= </span><span class="string">"(?:</span><span class="default">$display_name</span><span class="string">:(?:</span><span class="default">$mailbox_list</span><span class="string">|</span><span class="default">$cfws</span><span class="string">)?;</span><span class="default">$cfws</span><span class="string">?)"</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$address&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="keyword">= </span><span class="string">"(?:</span><span class="default">$mailbox</span><span class="string">|</span><span class="default">$group</span><span class="string">)"</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$address_list&nbsp;&nbsp; </span><span class="keyword">= </span><span class="string">"(?:(?:^|,)</span><span class="default">$address</span><span class="string">)+"</span><span class="keyword">;<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">//output length of string (just so you see how f**king long it is)<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">echo(</span><span class="default">strlen</span><span class="keyword">(</span><span class="default">$address_list</span><span class="keyword">) . </span><span class="string">" "</span><span class="keyword">);<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">//apply expression<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">preg_match_all</span><span class="keyword">(</span><span class="string">"/^</span><span class="default">$address_list</span><span class="string">$/"</span><span class="keyword">, </span><span class="default">$string</span><span class="keyword">, </span><span class="default">$array</span><span class="keyword">, </span><span class="default">PREG_SET_ORDER</span><span class="keyword">);<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">$array</span><span class="keyword">;<br />
};<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="61426""></a>
  <div class="note">
   <strong class="user">mnc at u dot nu</strong>
   <a href="#61426" class="date">03-Feb-2006 07:05</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
PREG_OFFSET_CAPTURE always seems to provide byte offsets, rather than character position offsets, even when you are using the unicode /u modifier.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
</div>
</div>
<hr /><div class="manualnavbar" style="text-align: center;">
 <div class="prev" style="text-align: left; float: left;"><a href="function.preg-last-error.html">preg_last_error</a></div>
 <div class="next" style="text-align: right; float: right;"><a href="function.preg-match.html">preg_match</a></div>
 <div class="up"><a href="ref.pcre.html">PCRE 関数</a></div>
 <div class="home"><a href="index.html">PHP Manual</a></div>
</div></body></html>
