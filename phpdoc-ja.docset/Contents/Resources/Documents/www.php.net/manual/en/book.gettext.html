<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
 <head>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <title>Gettext</title>
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <link media="all" rel="stylesheet" type="text/css" href="style.css"/>
 </head>
 <body class="docs"><div class="manualnavbar" style="text-align: center;">
 <div class="prev" style="text-align: left; float: left;"><a href="gender-gender.similarnames.html">Gender\Gender::similarNames</a></div>
 <div class="next" style="text-align: right; float: right;"><a href="intro.gettext.html">導入</a></div>
 <div class="up"><a href="refs.international.html">自然言語および文字エンコーディング</a></div>
 <div class="home"><a href="index.html">PHP Manual</a></div>
</div><hr /><div id="book.gettext" class="book">
 
 <h1 class="title">Gettext</h1>
 
 
 
 
 
 









 









 









<ul class="chunklist chunklist_book"><li><a href="intro.gettext.html">導入</a></li><li><a href="gettext.setup.html">インストール/設定</a><ul class="chunklist chunklist_book chunklist_children"><li><a href="gettext.requirements.html">要件</a></li><li><a href="gettext.installation.html">インストール手順</a></li><li><a href="gettext.configuration.html">実行時設定</a></li><li><a href="gettext.resources.html">リソース型</a></li></ul></li><li><a href="gettext.constants.html">定義済み定数</a></li><li><a href="ref.gettext.html">Gettext 関数</a><ul class="chunklist chunklist_book chunklist_children"><li><a href="function.bind-textdomain-codeset.html">bind_textdomain_codeset</a> — DOMAIN メッセージカタログから返されるメッセージの文字エンコーディングを指定する</li><li><a href="function.bindtextdomain.html">bindtextdomain</a> — ドメインのパスを設定する</li><li><a href="function.dcgettext.html">dcgettext</a> — 単一の参照に関するドメインを上書きする</li><li><a href="function.dcngettext.html">dcngettext</a> — dcgettext の複数形版</li><li><a href="function.dgettext.html">dgettext</a> — 現在のドメインを上書きする</li><li><a href="function.dngettext.html">dngettext</a> — dgettext の複数形版</li><li><a href="function.gettext.html">gettext</a> — 現在のドメインのメッセージを参照する</li><li><a href="function.ngettext.html">ngettext</a> — gettext の複数形版</li><li><a href="function.textdomain.html">textdomain</a> — デフォルトドメインを設定する</li></ul></li></ul></div><div id="usernotes">
 <div class="head">
  <h3 class="title">User Contributed Notes</h3>
 </div>
<div id="allnotes">  <a name="91650""></a>
  <div class="note">
   <strong class="user">yuricardenas at gmail dot com</strong>
   <a href="#91650" class="date">21-Jun-2009 08:30</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
*An important thing to keep in mind*:<br />
Do not forget to set the charset in .po file! <br />
For example:<br />
<br />
"Content-Type: text/plain; charset=UTF-8\n"<br />
<br />
Then PHP will be able to find the .mo file you generated, using msgfmt, from the .po file WITH CHARSET SET.<br />
<br />
Because of this I've wasted a lot of time debugging my code, testing every single little changes people suggested over this manual and Internet: <br />
<br />
<span class="default">&lt;?php<br />
<br />
</span><span class="comment">//this:<br />
</span><span class="default">setlocale</span><span class="keyword">( </span><span class="default">LC_MESSAGES</span><span class="keyword">, </span><span class="string">'pt_BR'</span><span class="keyword">)<br />
</span><span class="comment">//or this:<br />
</span><span class="default">setlocale</span><span class="keyword">( </span><span class="default">LC_MESSAGES</span><span class="keyword">, </span><span class="string">'pt_BR.utf8'</span><span class="keyword">)<br />
</span><span class="comment">//or this:<br />
</span><span class="default">setlocale</span><span class="keyword">( </span><span class="default">LC_MESSAGES</span><span class="keyword">, </span><span class="string">''</span><span class="keyword">)<br />
<br />
</span><span class="comment">//this:<br />
</span><span class="default">putenv</span><span class="keyword">(</span><span class="string">"LANG=pt_BR.utf8"</span><span class="keyword">);<br />
</span><span class="comment">//or this:<br />
</span><span class="default">putenv</span><span class="keyword">(</span><span class="string">"LANGUAGE=pt_BR.utf8"</span><span class="keyword">);<br />
<br />
</span><span class="comment">//this:<br />
</span><span class="default">bindtextdomain</span><span class="keyword">(</span><span class="string">'mydomain'</span><span class="keyword">, </span><span class="default">dirname</span><span class="keyword">(</span><span class="default">__FILE__</span><span class="keyword">).</span><span class="string">'/locale'</span><span class="keyword">);<br />
</span><span class="comment">//or this:<br />
</span><span class="default">bindtextdomain</span><span class="keyword">(</span><span class="string">"*"</span><span class="keyword">, </span><span class="default">dirname</span><span class="keyword">(</span><span class="default">__FILE__</span><span class="keyword">).</span><span class="string">'/locale'</span><span class="keyword">);<br />
</span><span class="comment">//or this:<br />
</span><span class="default">bindtextdomain</span><span class="keyword">(</span><span class="string">'*'</span><span class="keyword">, </span><span class="default">dirname</span><span class="keyword">(</span><span class="default">__FILE__</span><span class="keyword">).</span><span class="string">'/locale'</span><span class="keyword">);<br />
<br />
</span><span class="comment">//setting or not "bind_textdomain_codeset()":<br />
</span><span class="default">bind_textdomain_codeset</span><span class="keyword">(</span><span class="string">"mydomain"</span><span class="keyword">, </span><span class="string">'UTF-8'</span><span class="keyword">);<br />
</span><span class="default">?&gt;<br />
</span><br />
As well as what locale directory name to set:<br />
./locale/pt_BR.UTF8/LC_MESSAGES/mydomain.mo<br />
or<br />
./locale/pt_BR/LC_MESSAGES/mydomain.mo<br />
or<br />
./locale/pt/LC_MESSAGES/mydomain.mo<br />
<br />
Finally, the code which brought the right translated strings (also with the correct charset) was:<br />
<br />
<span class="default">&lt;?php<br />
<br />
$directory </span><span class="keyword">= </span><span class="default">dirname</span><span class="keyword">(</span><span class="default">__FILE__</span><span class="keyword">).</span><span class="string">'/locale'</span><span class="keyword">;<br />
</span><span class="default">$domain </span><span class="keyword">= </span><span class="string">'mydomain'</span><span class="keyword">;<br />
</span><span class="default">$locale </span><span class="keyword">=</span><span class="string">"pt_BR.utf8"</span><span class="keyword">;<br />
<br />
</span><span class="comment">//putenv("LANG=".$locale); //not needed for my tests, but people say it's useful for windows<br />
<br />
</span><span class="default">setlocale</span><span class="keyword">( </span><span class="default">LC_MESSAGES</span><span class="keyword">, </span><span class="default">$locale</span><span class="keyword">);<br />
</span><span class="default">bindtextdomain</span><span class="keyword">(</span><span class="default">$domain</span><span class="keyword">, </span><span class="default">$directory</span><span class="keyword">);<br />
</span><span class="default">textdomain</span><span class="keyword">(</span><span class="default">$domain</span><span class="keyword">);<br />
</span><span class="default">bind_textdomain_codeset</span><span class="keyword">(</span><span class="default">$domain</span><span class="keyword">, </span><span class="string">'UTF-8'</span><span class="keyword">);<br />
</span><span class="default">?&gt;<br />
</span><br />
And the three directory's names worked out, using the pt_BR.utf8 locale. (My tests were made restarting Apache then trying each directory).<br />
<br />
I hope to help someone else not to waste as much time as I've wasted... =P<br />
<br />
Using:<br />
Ubuntu 8.04 (hardy)<br />
Apache 2.2.8<br />
PHP 5.2.4-2ubuntu5.6</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="91187""></a>
  <div class="note">
   <strong class="user">jpatokal at iki dot fi</strong>
   <a href="#91187" class="date">29-May-2009 09:05</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Warning for Linux (Ubuntu) users!&nbsp; Your system will *only* support the locales installed on your OS, in the *exact* format given by your OS.&nbsp; (See also the PHP setlocale man page.)&nbsp; To get a list of them, enter locale -a, which will give you something like this:<br />
<br />
C<br />
en_US.utf8<br />
ja_JP.utf8<br />
POSIX<br />
<br />
So this machine only has English and Japanese!&nbsp; To add eg. Finnish, install the package:<br />
<br />
sudo apt-get install language-pack-fi-base<br />
<br />
Rerun locale -a, and "fi_FI.utf8" should appear.&nbsp; Make sure you're using the same name in your PHP code:<br />
<br />
setlocale(LC_ALL, "fi_FI.utf8");<br />
<br />
Adjust your po paths so that they match, e.g. "./locale/fi_FI.utf8/LC_MESSAGES/messages.po".<br />
<br />
Now restart Apache, and it should finally work.&nbsp; Figuring this out took quite a while...</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="89975""></a>
  <div class="note">
   <strong class="user">sasq1 at go2 dot pl</strong>
   <a href="#89975" class="date">31-Mar-2009 07:18</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
And what about pgettext and npgettext? They are there in the gettext documentation, but there aren't in PHP. They're very useful if you have the same messages for translation, but in different contexts, so they should be translated separately and probably differently.<br />
<br />
Fortunately, there is a simple work-around, which may help:<br />
From the gettext.h header one can find out that pgettext() is only a macro calling dcgettext() internally with properly mangled parameters - msgctxt and msgid are glued together with use of ASCII char 4 [EOT, End Of Text]. The same way they're written in .mo files, so it's possible to refer them this way.<br />
<br />
Here's my "emulated" pgettext() function:<br />
<br />
<span class="default">&lt;?php<br />
&nbsp;&nbsp; </span><span class="keyword">if (!</span><span class="default">function_exists</span><span class="keyword">(</span><span class="string">'pgettext'</span><span class="keyword">)) {<br />
&nbsp;&nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp;&nbsp; function </span><span class="default">pgettext</span><span class="keyword">(</span><span class="default">$context</span><span class="keyword">, </span><span class="default">$msgid</span><span class="keyword">)<br />
&nbsp;&nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$contextString </span><span class="keyword">= </span><span class="string">"</span><span class="keyword">{</span><span class="default">$context</span><span class="keyword">}</span><span class="string">\004</span><span class="keyword">{</span><span class="default">$msgid</span><span class="keyword">}</span><span class="string">"</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$translation </span><span class="keyword">= </span><span class="default">dcgettext</span><span class="keyword">(</span><span class="string">'messages'</span><span class="keyword">, </span><span class="default">contextString</span><span class="keyword">,</span><span class="default">LC_MESSAGES</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; if (</span><span class="default">$translation </span><span class="keyword">== </span><span class="default">$contextString</span><span class="keyword">)&nbsp; return </span><span class="default">$msgid</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; else&nbsp; return </span><span class="default">$translation</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; }<br />
</span><span class="default">?&gt;<br />
</span><br />
By default, xgettext doesn't support pgettext function for PHP source files. But there is a parameter which can work-around it. Here's how I call xgettext:<br />
<br />
&nbsp;&nbsp; xgettext --force-po --keyword="pgettext:1c,2" -c -o messages.po sourceFile.php<br />
<br />
In sourceFile.php I use the following test code:<br />
<br />
&nbsp;&nbsp; pgettext('menu', 'Open');&nbsp; //Substitute "Otwórz"<br />
&nbsp;&nbsp; pgettext('forum', 'Open');&nbsp; //Substitute "Otwarty", different context<br />
<br />
Generated .po file fragment:<br />
<br />
&nbsp;&nbsp; msgctxt "menu"<br />
&nbsp;&nbsp; msgid "Open"<br />
&nbsp;&nbsp; msgstr "Otwórz"<br />
&nbsp;&nbsp; <br />
&nbsp;&nbsp; msgctxt "forum"<br />
&nbsp;&nbsp; msgctxt "Open"<br />
&nbsp;&nbsp; msgstr "Otwarty"<br />
<br />
I've tested it out and everything works fine :-) If anyone have some further suggestions or fixes, please write ;-)</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="89696""></a>
  <div class="note">
   <strong class="user">rainwalker at seznam dot cz</strong>
   <a href="#89696" class="date">19-Mar-2009 06:16</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
My PHP app was made for UTF-8 but i had a problem that gettext always returned all texts in ISO-8859-2 instead of UTF-8.<br />
<br />
Then i found out that you have to set locale in PHP exactly to encoding you request. So when i wanted czech UTF-8 i used:<br />
<br />
setlocale(LC_ALL, "cs_CZ.UTF-8");<br />
<br />
Now it works...</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="87565""></a>
  <div class="note">
   <strong class="user">djogopatrao at gmail dot com</strong>
   <a href="#87565" class="date">10-Dec-2008 07:49</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
It is noteworthy that, according to the GNU gettext FAQ[1], * source code must be ASCII *. That means that you can't write code like<br />
<br />
&lt;?= _("áááàààãã")?&gt;<br />
<br />
in UTF-8, ISO-8859-1 or whatever, and hope that that will work. It won't.<br />
<br />
[1]<a href="http://www.gnu.org/software/gettext/FAQ.html#nonascii_strings" rel="nofollow" target="_blank">http://www.gnu.org/software/gettext/FAQ.html#nonascii_strings</a></span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="85221""></a>
  <div class="note">
   <strong class="user">php at devicenull dot org</strong>
   <a href="#85221" class="date">21-Aug-2008 04:58</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
To get this working properly on debian, install the locales-all package.&nbsp; I just spent a few hours finding a bug where it wouldn't work because that package is missing</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
</div>
</div>
<hr /><div class="manualnavbar" style="text-align: center;">
 <div class="prev" style="text-align: left; float: left;"><a href="gender-gender.similarnames.html">Gender\Gender::similarNames</a></div>
 <div class="next" style="text-align: right; float: right;"><a href="intro.gettext.html">導入</a></div>
 <div class="up"><a href="refs.international.html">自然言語および文字エンコーディング</a></div>
 <div class="home"><a href="index.html">PHP Manual</a></div>
</div></body></html>
