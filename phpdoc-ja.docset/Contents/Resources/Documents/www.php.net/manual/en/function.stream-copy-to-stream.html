<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
 <head>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <title>データをあるストリームから別のストリームにコピーする</title>
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <link media="all" rel="stylesheet" type="text/css" href="style.css"/>
 </head>
 <body class="docs"><div class="manualnavbar" style="text-align: center;">
 <div class="prev" style="text-align: left; float: left;"><a href="function.stream-context-set-params.html">stream_context_set_params</a></div>
 <div class="next" style="text-align: right; float: right;"><a href="function.stream-encoding.html">stream_encoding</a></div>
 <div class="up"><a href="ref.stream.html">ストリーム 関数</a></div>
 <div class="home"><a href="index.html">PHP Manual</a></div>
</div><hr /><div id="function.stream-copy-to-stream" class="refentry">
 <div class="refnamediv">
  <h1 class="refname">stream_copy_to_stream</h1>
  <p class="verinfo">(PHP 5)</p><p class="refpurpose"><span class="refname">stream_copy_to_stream</span> &mdash; <span class="dc-title">データをあるストリームから別のストリームにコピーする</span></p>

 </div>
 <div class="refsect1 description" id="refsect1-function.stream-copy-to-stream-description">
  <h3 class="title">説明</h3>
  <div class="methodsynopsis dc-description">
   <span class="type">int</span> <span class="methodname"><strong>stream_copy_to_stream</strong></span>
    ( <span class="methodparam"><span class="type">resource</span> <code class="parameter">$source</code></span>
   , <span class="methodparam"><span class="type">resource</span> <code class="parameter">$dest</code></span>
   [, <span class="methodparam"><span class="type">int</span> <code class="parameter">$maxlength</code><span class="initializer"> = -1</span></span>
   [, <span class="methodparam"><span class="type">int</span> <code class="parameter">$offset</code><span class="initializer"> = 0</span></span>
  ]] )</div>

  <p class="para rdfs-comment">
   現在の位置（あるいはもし指定されていれば
   <em><code class="parameter">offset</code></em> の位置）から最大
   <em><code class="parameter">maxlength</code></em> バイトのデータを
   <em><code class="parameter">source</code></em> から <em><code class="parameter">dest</code></em>
   にコピーします。もし <em><code class="parameter">maxlength</code></em> が指定されていない
   場合は、<em><code class="parameter">source</code></em> にある残りすべてのデータが
   コピーされます。
  </p>
 </div>


 <div class="refsect1 parameters" id="refsect1-function.stream-copy-to-stream-parameters">
  <h3 class="title">パラメータ</h3>
  <p class="para">
   <dl>

    <dt>

     <span class="term"><em><code class="parameter">source</code></em></span>
     <dd>

      <p class="para">
       コピー元のストリーム。
      </p>
     </dd>

    </dt>

    <dt>

     <span class="term"><em><code class="parameter">dest</code></em></span>
     <dd>

      <p class="para">
       コピー先のストリーム。
      </p>
     </dd>

    </dt>

    <dt>

     <span class="term"><em><code class="parameter">maxlength</code></em></span>
     <dd>

      <p class="para">
       コピーする最大バイト数。
      </p>
     </dd>

    </dt>

    <dt>

     <span class="term"><em><code class="parameter">offset</code></em></span>
     <dd>

      <p class="para">
       コピーを開始する位置。
      </p>
     </dd>

    </dt>

   </dl>

  </p>
 </div>


 <div class="refsect1 returnvalues" id="refsect1-function.stream-copy-to-stream-returnvalues">
  <h3 class="title">返り値</h3>
  <p class="para">
   コピーされたバイト数を返します。
  </p>
 </div>


 <div class="refsect1 changelog" id="refsect1-function.stream-copy-to-stream-changelog">
  <h3 class="title">変更履歴</h3>
  <p class="para">
   <table class="doctable informaltable">
    
     <thead>
      <tr>
       <th>バージョン</th>
       <th>説明</th>
      </tr>

     </thead>

     <tbody class="tbody">
      <tr>
       <td>5.1.0</td>
       <td>
        <em><code class="parameter">offset</code></em> パラメータが追加されました。
       </td>
      </tr>

     </tbody>
    
   </table>

  </p>
 </div>


 <div class="refsect1 examples" id="refsect1-function.stream-copy-to-stream-examples">
  <h3 class="title">例</h3>
  <p class="para">
   <div class="example" id="example-3996">
    <p><strong>例1  <span class="function"><strong>stream_copy_to_stream()</strong></span> の例</strong></p>
    <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br />$src&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">fopen</span><span style="color: #007700">(</span><span style="color: #DD0000">'http://www.example.com'</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">'r'</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">$dest1&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">fopen</span><span style="color: #007700">(</span><span style="color: #DD0000">'first1k.txt'</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">'w'</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">$dest2&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">fopen</span><span style="color: #007700">(</span><span style="color: #DD0000">'remainder.txt'</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">'w'</span><span style="color: #007700">);<br /><br />echo&nbsp;</span><span style="color: #0000BB">stream_copy_to_stream</span><span style="color: #007700">(</span><span style="color: #0000BB">$src</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$dest1</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">1024</span><span style="color: #007700">)&nbsp;.&nbsp;</span><span style="color: #DD0000">"&nbsp;バイトが&nbsp;first1k.txt&nbsp;にコピーされました\n"</span><span style="color: #007700">;<br />echo&nbsp;</span><span style="color: #0000BB">stream_copy_to_stream</span><span style="color: #007700">(</span><span style="color: #0000BB">$src</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$dest2</span><span style="color: #007700">)&nbsp;.&nbsp;</span><span style="color: #DD0000">"&nbsp;バイトが&nbsp;remainder.txt&nbsp;にコピーされました\n"</span><span style="color: #007700">;<br /><br /></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
    </div>

   </div>
  </p>
 </div>


 <div class="refsect1 seealso" id="refsect1-function.stream-copy-to-stream-seealso">
  <h3 class="title">参考</h3>
  <p class="para">
   <ul class="simplelist">
    <li class="member"> <span class="function"><a href="function.copy.html" class="function" rel="rdfs-seeAlso">copy()</a> - ファイルをコピーする</span></li>
   </ul>
  </p>
 </div>

</div><div id="usernotes">
 <div class="head">
  <h3 class="title">User Contributed Notes</h3>
 </div>
<div id="allnotes">  <a name="98119""></a>
  <div class="note">
   <strong class="user">felix dot nensa at gmail dot com</strong>
   <a href="#98119" class="date">27-May-2010 01:57</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
As stream_copy_to_stream() seems to be quite a memory hog (at least in PHP 5.1.6 64-bit) it may be way more efficient just to copy streams with this simple PHP alternative:<br />
<br />
<span class="default">&lt;?php<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">function </span><span class="default">pipe_streams</span><span class="keyword">(</span><span class="default">$in</span><span class="keyword">, </span><span class="default">$out</span><span class="keyword">)<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$size </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; while (!</span><span class="default">feof</span><span class="keyword">(</span><span class="default">$in</span><span class="keyword">)) </span><span class="default">$size </span><span class="keyword">+= </span><span class="default">fwrite</span><span class="keyword">(</span><span class="default">$out</span><span class="keyword">,</span><span class="default">fread</span><span class="keyword">(</span><span class="default">$in</span><span class="keyword">,</span><span class="default">8192</span><span class="keyword">));<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">$size</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }<br />
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="76669""></a>
  <div class="note">
   <strong class="user">sundance2001 guess what gmail.com</strong>
   <a href="#76669" class="date">25-Jul-2007 03:54</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If you need to copy a file from any website into yours you can use following function:<br />
<br />
function getUrlContents($url)<br />
{<br />
&nbsp;&nbsp; $url_parsed = parse_url($url);<br />
<br />
&nbsp;&nbsp; $host = $url_parsed["host"];<br />
&nbsp;&nbsp; if ($url == '' || $host == '') {<br />
&nbsp;&nbsp; &nbsp; &nbsp; return false;<br />
&nbsp;&nbsp; }<br />
&nbsp;&nbsp; $port = 80;<br />
&nbsp;&nbsp; $path = (empty($url_parsed["path"]) ? '/' : $url_parsed["path"]);<br />
&nbsp;&nbsp; $path.= (!empty($url_parsed["query"]) ? '?'.$url_parsed["query"] : '');<br />
&nbsp;&nbsp; $out = "GET $path HTTP/1.0\r\nHost: $host\r\nConnection: Close\r\n\r\n";<br />
&nbsp;&nbsp; $fp = fsockopen($host, $port, $errno, $errstr, 30);<br />
&nbsp;&nbsp; fwrite($fp, $out);<br />
&nbsp;&nbsp; $headers = '';<br />
&nbsp;&nbsp; $content = '';<br />
&nbsp;&nbsp; $buf = '';<br />
&nbsp;&nbsp; $isBody = false;<br />
&nbsp; while (!feof($fp) and !$isBody) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $buf = fgets($fp, 1024);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if ($buf == "\r\n" ) {$isBody = true;}<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; else{$headers .= $buf;}<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $file1 = fopen(basename($url_parsed["path"]), 'w');<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $bytes=stream_copy_to_stream($fp,$file1);<br />
&nbsp;&nbsp; fclose($fp);<br />
&nbsp;&nbsp; return $bytes;<br />
}</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="75790""></a>
  <div class="note">
   <strong class="user">none at noone dot com</strong>
   <a href="#75790" class="date">16-Jun-2007 01:27</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
stream_copy_to_stream almost copies a stream...<br />
<br />
$objInputStream = fopen("php://input", "rb");<br />
$objTempStream = fopen("php://temp", "w+b");<br />
stream_copy_to_stream($objInputStream, $objTempStream);<br />
<br />
That code will copy a stream but it will also move the stream pointers to EOF.&nbsp; This is fine if you plan on rewinding the temp stream but good luck rewinding the input stream.<br />
<br />
rewind($objTempStream);<br />
rewind($objInputStream);<br />
<br />
So as you can see this is stream copy or stream move depending on what kind of stream you are working with, and because there are no peaking functions your effed if you need to read from an input stream in multiple classes that are unrelated.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
</div>
</div>
<hr /><div class="manualnavbar" style="text-align: center;">
 <div class="prev" style="text-align: left; float: left;"><a href="function.stream-context-set-params.html">stream_context_set_params</a></div>
 <div class="next" style="text-align: right; float: right;"><a href="function.stream-encoding.html">stream_encoding</a></div>
 <div class="up"><a href="ref.stream.html">ストリーム 関数</a></div>
 <div class="home"><a href="index.html">PHP Manual</a></div>
</div></body></html>
