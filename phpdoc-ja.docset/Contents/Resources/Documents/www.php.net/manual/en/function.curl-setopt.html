<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
 <head>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <title>cURL 転送用オプションを設定する</title>
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <link media="all" rel="stylesheet" type="text/css" href="style.css"/>
 </head>
 <body class="docs"><div class="manualnavbar" style="text-align: center;">
 <div class="prev" style="text-align: left; float: left;"><a href="function.curl-setopt-array.html">curl_setopt_array</a></div>
 <div class="next" style="text-align: right; float: right;"><a href="function.curl-share-close.html">curl_share_close</a></div>
 <div class="up"><a href="ref.curl.html">cURL 関数</a></div>
 <div class="home"><a href="index.html">PHP Manual</a></div>
</div><hr /><div id="function.curl-setopt" class="refentry">
 <div class="refnamediv">
  <h1 class="refname">curl_setopt</h1>
  <p class="verinfo">(PHP 4 &gt;= 4.0.2, PHP 5)</p><p class="refpurpose"><span class="refname">curl_setopt</span> &mdash; <span class="dc-title">cURL 転送用オプションを設定する</span></p>

 </div>
 
 <div class="refsect1 description" id="refsect1-function.curl-setopt-description">
  <h3 class="title">説明</h3>
  <div class="methodsynopsis dc-description">
   <span class="type">bool</span> <span class="methodname"><strong>curl_setopt</strong></span>
    ( <span class="methodparam"><span class="type">resource</span> <code class="parameter">$ch</code></span>
   , <span class="methodparam"><span class="type">int</span> <code class="parameter">$option</code></span>
   , <span class="methodparam"><span class="type"><a href="language.pseudo-types.html#language.types.mixed" class="type mixed">mixed</a></span> <code class="parameter">$value</code></span>
   )</div>

  <p class="para rdfs-comment">
   指定した cURL セッションハンドルのオプションを設定します。
  </p>
 </div>


 <div class="refsect1 parameters" id="refsect1-function.curl-setopt-parameters">
  <h3 class="title">パラメータ</h3>
  <p class="para">
   <dl>

    <dt>
<span class="term"><em><code class="parameter">ch</code></em>
</span><dd>
<p class="para"> <span class="function"><a href="function.curl-init.html" class="function">curl_init()</a></span>
が返す cURL ハンドル。</p></dd>
</dt>

    <dt>

     <span class="term"><em><code class="parameter">option</code></em></span>
     <dd>

      <p class="para">
       設定したい <em>CURLOPT_XXX</em> オプション。
      </p>
     </dd>

    </dt>

    <dt>

     <span class="term"><em><code class="parameter">value</code></em></span>
     <dd>

      <p class="para">
       <em><code class="parameter">option</code></em> に設定する値。
      </p>
      <p class="para">
       <em><code class="parameter">value</code></em> には、
       <em><code class="parameter">option</code></em> の以下の値に関して
       bool 値を指定する必要があります。
       <table class="doctable informaltable">
        
         <thead>
          <tr>
           <th>オプション</th>
           <th><em><code class="parameter">value</code></em> への設定値</th>
           <th>注記</th>
          </tr>

         </thead>

         <tbody class="tbody">
          <tr>
           <td style="vertical-align: top;"><strong><code>CURLOPT_AUTOREFERER</code></strong></td>
           <td style="vertical-align: top;">
            <strong><code>TRUE</code></strong> を設定すると、<em>Location:</em> によるリダイレクトを
            たどる際には自動的に <em>Referer:</em> フィールドをリクエストに
            追加します。
           </td>
           <td style="vertical-align: top;">
           </td>
          </tr>

          <tr>
           <td style="vertical-align: top;"><strong><code>CURLOPT_BINARYTRANSFER</code></strong></td>
           <td style="vertical-align: top;">
            <strong><code>TRUE</code></strong> を設定すると、<strong><code>CURLOPT_RETURNTRANSFER</code></strong>
            が使用された場合に出力結果を何も加工せずに返します。
           </td>
           <td style="vertical-align: top;">
            PHP 5.1.3 以降では、このオプションは何の効果もありません。
            <strong><code>CURLOPT_RETURNTRANSFER</code></strong> を使ったときには
            常に出力をそのまま返すようになりました。
           </td>
          </tr>

          <tr>
           <td style="vertical-align: top;"><strong><code>CURLOPT_COOKIESESSION</code></strong></td>
           <td style="vertical-align: top;">
            <strong><code>TRUE</code></strong> を設定すると、クッキーの &quot;セッション&quot; を新しく開始します。
            以前のセッションで読み込まれていた &quot;セッションクッキー&quot; は無視するよう、
            libcurl に指示します。デフォルトでは、それがセッションクッキーであるか
            どうかにかかわらず libcurl はすべてのクッキーを読み込んで保存します。
            セッションクッキーとは、有効期限が指定されておらず &quot;セッション&quot; の間のみ
            有効であるクッキーのことです。
           </td>
           <td style="vertical-align: top;">
           </td>
          </tr>

          <tr>
           <td style="vertical-align: top;"><strong><code>CURLOPT_CERTINFO</code></strong></td>
           <td style="vertical-align: top;">
            <strong><code>TRUE</code></strong> を設定すると、セキュアな転送時に SSL 証明書の情報を
            <em>STDERR</em> に出力します。
           </td>
           <td style="vertical-align: top;">
            cURL 7.19.1 で追加されました。
            PHP 5.3.2 以降で使用可能です。これを使うには、<strong><code>CURLOPT_VERBOSE</code></strong>
            を on にしておかなければなりません。
           </td>
          </tr>

          <tr>
           <td style="vertical-align: top;"><strong><code>CURLOPT_CONNECT_ONLY</code></strong></td>
           <td style="vertical-align: top;">
            <strong><code>TRUE</code></strong> を設定すると、プロキシの認証や接続の確立などをすべて行いますが、データは転送しません。
            このオプションは、HTTP や SMTP そして POP3 用に実装されています。
           </td>
           <td style="vertical-align: top;">
            7.15.2 で追加されました。
            PHP 5.5.0 以降で使用可能です。
           </td>
          </tr>

          <tr>
           <td style="vertical-align: top;"><strong><code>CURLOPT_CRLF</code></strong></td>
           <td style="vertical-align: top;">
            <strong><code>TRUE</code></strong> を設定すると、転送時に Unix 形式の改行を CRLF 形式に変換します。
           </td>
           <td style="vertical-align: top;">
           </td>
          </tr>

          <tr>
           <td style="vertical-align: top;"><strong><code>CURLOPT_DNS_USE_GLOBAL_CACHE</code></strong></td>
           <td style="vertical-align: top;">
            <strong><code>TRUE</code></strong> を設定すると、グローバル DNS キャッシュを利用します。
            このオプションはスレッドセーフではありません。また、デフォルトで
            有効になっています。
           </td>
           <td style="vertical-align: top;">
           </td>
          </tr>

          <tr>
           <td style="vertical-align: top;"><strong><code>CURLOPT_FAILONERROR</code></strong></td>
           <td style="vertical-align: top;">
            <strong><code>TRUE</code></strong> を設定すると、HTTP で 400 以上のコードが返ってきた際に
            処理失敗と判断します。デフォルトでは、コードの値を無視して
            ページの内容を取得します。
           </td>
           <td style="vertical-align: top;">
           </td>
          </tr>

          <tr>
           <td style="vertical-align: top;"><strong><code>CURLOPT_FILETIME</code></strong></td>
           <td style="vertical-align: top;">
            <strong><code>TRUE</code></strong> を設定すると、ドキュメントの更新日時を取得しようと試みます。
            この値を取得するには、 <span class="function"><a href="function.curl-getinfo.html" class="function">curl_getinfo()</a></span> で
            <em><code class="parameter">CURLINFO_FILETIME</code></em> オプションを用います。
           </td>
           <td style="vertical-align: top;">
           </td>
          </tr>

          <tr>
           <td style="vertical-align: top;"><strong><code>CURLOPT_FOLLOWLOCATION</code></strong></td>
           <td style="vertical-align: top;">
            <strong><code>TRUE</code></strong> を設定すると、サーバーが HTTP ヘッダの一部として送ってくる
            <em>&quot;Location: &quot;</em> ヘッダの内容をたどります
           （これは再帰的に行われます。<strong><code>CURLOPT_MAXREDIRS</code></strong>
            が指定されていない限り、送ってくる <em>&quot;Location: &quot;</em>
            ヘッダの内容をずっとたどり続けることに注意しましょう）。
           </td>
           <td style="vertical-align: top;">
           </td>
          </tr>

          <tr>
           <td style="vertical-align: top;"><strong><code>CURLOPT_FORBID_REUSE</code></strong></td>
           <td style="vertical-align: top;">
            <strong><code>TRUE</code></strong> を設定すると、処理が終了した際に明示的に接続を切断します。
            接続を再利用しません。
           </td>
           <td style="vertical-align: top;">
           </td>
          </tr>

          <tr>
           <td style="vertical-align: top;"><strong><code>CURLOPT_FRESH_CONNECT</code></strong></td>
           <td style="vertical-align: top;">
            <strong><code>TRUE</code></strong> を設定すると、キャッシュされている接続を利用せずに
            新しい接続を確立します。
           </td>
           <td style="vertical-align: top;">
           </td>
          </tr>

          <tr>
           <td style="vertical-align: top;"><strong><code>CURLOPT_FTP_USE_EPRT</code></strong></td>
           <td style="vertical-align: top;">
            <strong><code>TRUE</code></strong> を設定すると、FTP のダウンロードに EPRT（および LPRT）
            を利用します。<strong><code>FALSE</code></strong> の場合は EPRT・LPRT を無効にして PORT
            を利用します。
           </td>
           <td style="vertical-align: top;">
           </td>
          </tr>

          <tr>
           <td style="vertical-align: top;"><strong><code>CURLOPT_FTP_USE_EPSV</code></strong></td>
           <td style="vertical-align: top;">
            <strong><code>TRUE</code></strong> を設定すると、FTP 転送の際にまず EPSV コマンドの利用を
            試みます。失敗した場合は PASV を利用します。<strong><code>FALSE</code></strong> を設定すると、
            EPSV を無効にします。
           </td>
           <td style="vertical-align: top;">
           </td>
          </tr>

          <tr>
           <td style="vertical-align: top;"><strong><code>CURLOPT_FTP_CREATE_MISSING_DIRS</code></strong></td>
           <td style="vertical-align: top;">
            <strong><code>TRUE</code></strong> を設定すると、FTP の操作中にパスが存在しなかったときに
            ディレクトリを作成します。
           </td>
           <td style="vertical-align: top;">
           </td>
          </tr>

          <tr>
           <td style="vertical-align: top;"><strong><code>CURLOPT_FTPAPPEND</code></strong></td>
           <td style="vertical-align: top;">
            <strong><code>TRUE</code></strong> を設定すると、リモートファイルを上書きせずに追記します。
           </td>
           <td style="vertical-align: top;">
           </td>
          </tr>

          <tr>
           <td style="vertical-align: top;"><strong><code>CURLOPT_FTPASCII</code></strong></td>
           <td style="vertical-align: top;">
            <strong><code>CURLOPT_TRANSFERTEXT</code></strong> のエイリアスです。
           </td>
           <td style="vertical-align: top;">
           </td>
          </tr>

          <tr>
           <td style="vertical-align: top;"><strong><code>CURLOPT_FTPLISTONLY</code></strong></td>
           <td style="vertical-align: top;">
            <strong><code>TRUE</code></strong> を設定すると、FTP でディレクトリ名のみ表示します。
           </td>
           <td style="vertical-align: top;">
           </td>
          </tr>

          <tr>
           <td style="vertical-align: top;"><strong><code>CURLOPT_HEADER</code></strong></td>
           <td style="vertical-align: top;">
            <strong><code>TRUE</code></strong> を設定すると、ヘッダの内容も出力します。
           </td>
           <td style="vertical-align: top;">
           </td>
          </tr>

          <tr>
           <td style="vertical-align: top;"><strong><code>CURLINFO_HEADER_OUT</code></strong></td>
           <td style="vertical-align: top;">
            <strong><code>TRUE</code></strong> を設定すると、リクエスト文字列を追跡します。
           </td>
           <td style="vertical-align: top;">
            PHP 5.1.3 以降で使用可能です。プレフィックスが <strong><code>CURLINFO_</code></strong>
            となっているのは意図的なものです。
           </td>
          </tr>

          <tr>
           <td style="vertical-align: top;"><strong><code>CURLOPT_HTTPGET</code></strong></td>
           <td style="vertical-align: top;">
            <strong><code>TRUE</code></strong> を設定すると、HTTP のリクエスト形式を GET に戻します。
            GET はデフォルト設定なので、リクエスト形式が変更されている
            場合にのみ必要となります。
           </td>
           <td style="vertical-align: top;">
           </td>
          </tr>

          <tr>
           <td style="vertical-align: top;"><strong><code>CURLOPT_HTTPPROXYTUNNEL</code></strong></td>
           <td style="vertical-align: top;">
            <strong><code>TRUE</code></strong> にすると、指定された HTTP プロキシを介してトンネルします。
           </td>
           <td style="vertical-align: top;">
           </td>
          </tr>

          <tr>
           <td style="vertical-align: top;"><strong><code>CURLOPT_MUTE</code></strong></td>
           <td style="vertical-align: top;">
            <strong><code>TRUE</code></strong> を設定すると、cURL 関数に関連する出力を完全に抑えます。
           </td>
           <td style="vertical-align: top;">
            cURL 7.15.5 で削除されました (かわりに CURLOPT_RETURNTRANSFER が使えます)
           </td>
          </tr>

          <tr>
           <td style="vertical-align: top;"><strong><code>CURLOPT_NETRC</code></strong></td>
           <td style="vertical-align: top;">
            <strong><code>TRUE</code></strong> を設定すると、リモートサイトと接続を確立する際に用いる
            ユーザー名やパスワードを、<var class="filename">~/.netrc</var> から取得します。
           </td>
           <td style="vertical-align: top;">
           </td>
          </tr>

          <tr>
           <td style="vertical-align: top;"><strong><code>CURLOPT_NOBODY</code></strong></td>
           <td style="vertical-align: top;">
            <strong><code>TRUE</code></strong> を設定すると、出力から本文を削除します。
            リクエストメソッドは HEAD となります。これを <strong><code>FALSE</code></strong>
            に変更してもリクエストメソッドは GET には変わりません。
           </td>
           <td style="vertical-align: top;">
           </td>
          </tr>

          <tr>
           <td style="vertical-align: top;"><strong><code>CURLOPT_NOPROGRESS</code></strong></td>
           <td style="vertical-align: top;">
            <strong><code>TRUE</code></strong> を設定すると、cURL 転送の進捗状況表示を無効にします。
            <blockquote class="note"><p><strong class="note">注意</strong>: 
             <p class="para">
              PHP は、このオプションを自動的に <strong><code>TRUE</code></strong> に設定します。
              これを変更するのは、デバッグ時のみにすべきです。
             </p>
            </p></blockquote>
           </td>
           <td style="vertical-align: top;">
           </td>
          </tr>

          <tr>
           <td style="vertical-align: top;"><strong><code>CURLOPT_NOSIGNAL</code></strong></td>
           <td style="vertical-align: top;">
            <strong><code>TRUE</code></strong> を設定すると、cURL 関数が PHP プロセスに送信するシグナルを
            無視します。マルチスレッド SAPI ではデフォルトで on となっており、
            そのためタイムアウトオプションもまだ利用されています。
           </td>
           <td style="vertical-align: top;">
            cURL 7.10 で追加されました。
           </td>
          </tr>

          <tr>
           <td style="vertical-align: top;"><strong><code>CURLOPT_POST</code></strong></td>
           <td style="vertical-align: top;">
            <strong><code>TRUE</code></strong> を設定すると、HTTP POST を行います。POST は、
            <em>application/x-www-form-urlencoded</em> 形式で
            行われます。これは一般的な HTML のフォームと同じ形式です。
           </td>
           <td style="vertical-align: top;">
           </td>
          </tr>

          <tr>
           <td style="vertical-align: top;"><strong><code>CURLOPT_PUT</code></strong></td>
           <td style="vertical-align: top;">
            <strong><code>TRUE</code></strong> を設定すると、HTTP PUT を行います。PUT するファイルは
            <strong><code>CURLOPT_INFILE</code></strong> および
            <strong><code>CURLOPT_INFILESIZE</code></strong>
            で指定されている必要があります。
           </td>
           <td style="vertical-align: top;">
           </td>
          </tr>

          <tr>
           <td style="vertical-align: top;"><strong><code>CURLOPT_RETURNTRANSFER</code></strong></td>
           <td style="vertical-align: top;">
            <strong><code>TRUE</code></strong> を設定すると、 <span class="function"><a href="function.curl-exec.html" class="function">curl_exec()</a></span> の返り値を
            文字列で返します。通常はデータを直接出力します。
           </td>
           <td style="vertical-align: top;">
           </td>
          </tr>

          <tr>
           <td style="vertical-align: top;"><strong><code>CURLOPT_SSL_VERIFYPEER</code></strong></td>
           <td style="vertical-align: top;">
            <strong><code>FALSE</code></strong> を設定すると、cURL はサーバー証明書の検証を行いません。
            別の証明書を <strong><code>CURLOPT_CAINFO</code></strong> オプションで
            指定するか、<strong><code>CURLOPT_CAPATH</code></strong> オプションで
            証明ディレクトリを指定します。
           </td>
           <td style="vertical-align: top;">
            cURL 7.10 以降、デフォルト値は <strong><code>TRUE</code></strong> です。また、
            cURL 7.10 以降、デフォルトでインストールされています。
           </td>
          </tr>

          <tr>
           <td style="vertical-align: top;"><strong><code>CURLOPT_TRANSFERTEXT</code></strong></td>
           <td style="vertical-align: top;">
            <strong><code>TRUE</code></strong> を設定すると、FTP 転送を ASCII モードで行います。
            LDAP の場合は、データを HTML ではなくプレーンテキストで取得します。
            Windows システムでは <em>STDOUT</em>
            に対してバイナリモードを設定しないでください。
           </td>
           <td style="vertical-align: top;">
           </td>
          </tr>

          <tr>
           <td style="vertical-align: top;"><strong><code>CURLOPT_UNRESTRICTED_AUTH</code></strong></td>
           <td style="vertical-align: top;">
            <strong><code>TRUE</code></strong> を設定すると、（<strong><code>CURLOPT_FOLLOWLOCATION</code></strong>
            を利用して）場所をたどっていく際にユーザー名とパスワードを送信し続けます。
            これは、たとえホスト名が変わっても続けられます。
           </td>
           <td style="vertical-align: top;">
           </td>
          </tr>

          <tr>
           <td style="vertical-align: top;"><strong><code>CURLOPT_UPLOAD</code></strong></td>
           <td style="vertical-align: top;">
            <strong><code>TRUE</code></strong> を設定すると、アップロードの準備をします。
           </td>
           <td style="vertical-align: top;">
           </td>
          </tr>

          <tr>
           <td style="vertical-align: top;"><strong><code>CURLOPT_VERBOSE</code></strong></td>
           <td style="vertical-align: top;">
            <strong><code>TRUE</code></strong> を設定すると、詳細な情報を出力します。情報は
            <em>STDERR</em> か、または
            <strong><code>CURLOPT_STDERR</code></strong>
            で指定したファイルに出力されます。
           </td>
           <td style="vertical-align: top;">
           </td>
          </tr>

         </tbody>
        
       </table>

      </p>
      <p class="para">
       <em><code class="parameter">value</code></em> には、
       <em><code class="parameter">option</code></em> の以下の値に関して
       整数値を指定する必要があります。
       <table class="doctable informaltable">
        
         <thead>
          <tr>
           <th>オプション</th>
           <th><em><code class="parameter">value</code></em> への設定値</th>
           <th>注記</th>
          </tr>

         </thead>

         <tbody class="tbody">
          <tr>
           <td style="vertical-align: top;"><strong><code>CURLOPT_BUFFERSIZE</code></strong></td>
           <td style="vertical-align: top;">
            1 回の読み込みに用いるバッファのサイズ。しかしながら、必ず
            このバッファいっぱいまで読み込まれることを保証するものではありません。
           </td>
           <td style="vertical-align: top;">
            cURL 7.10 で追加されました。
           </td>
          </tr>

          <tr>
           <td style="vertical-align: top;"><strong><code>CURLOPT_CLOSEPOLICY</code></strong></td>
           <td style="vertical-align: top;">
            <em><code class="parameter">CURLCLOSEPOLICY_LEAST_RECENTLY_USED</code></em> あるいは
            <em><code class="parameter">CURLCLOSEPOLICY_OLDEST</code></em> です。
            他にも 3 つの <em>CURLCLOSEPOLICY_</em> 定数が存在しますが、
            cURL はそれらをまだサポートしていません。
           </td>
           <td style="vertical-align: top;">
           </td>
          </tr>

          <tr>
           <td style="vertical-align: top;"><strong><code>CURLOPT_CONNECTTIMEOUT</code></strong></td>
           <td style="vertical-align: top;">
            接続の試行を待ち続ける秒数。0 は永遠に待ち続けることを意味します。
           </td>
           <td style="vertical-align: top;">
           </td>
          </tr>

          <tr>
           <td style="vertical-align: top;"><strong><code>CURLOPT_CONNECTTIMEOUT_MS</code></strong></td>
           <td style="vertical-align: top;">
            接続の試行を待ち続けるミリ秒数。0 は永遠に待ち続けることを意味します。
            
            システムの標準の名前解決を使うように libcurl をビルドしている場合は、
            接続のタイムアウトは秒単位の精度となり、最小のタイムアウトは 1 秒となります。
           </td>
           <td style="vertical-align: top;">
            cURL 7.16.2 で追加されました。PHP 5.2.3 以降で使用可能です。
           </td>
          </tr>

          <tr>
           <td style="vertical-align: top;"><strong><code>CURLOPT_DNS_CACHE_TIMEOUT</code></strong></td>
           <td style="vertical-align: top;">
            DNS エントリをメモリ内に保持し続ける秒数。デフォルトでは
            120（2 分）に設定されています。
           </td>
           <td style="vertical-align: top;">
           </td>
          </tr>

          <tr>
           <td style="vertical-align: top;"><strong><code>CURLOPT_FTPSSLAUTH</code></strong></td>
           <td style="vertical-align: top;">
            （使用可能な場合の）FTP 認証方法。
            <em>CURLFTPAUTH_SSL</em>（まず SSL を試す）、
            <em>CURLFTPAUTH_TLS</em>（まず TLS を試す）あるいは
            <em>CURLFTPAUTH_DEFAULT</em>（cURL が決める）のいずれかです。
           </td>
           <td style="vertical-align: top;">
            cURL 7.12.2 で追加されました。
           </td>
          </tr>

          <tr>
           <td style="vertical-align: top;"><strong><code>CURLOPT_HTTP_VERSION</code></strong></td>
           <td style="vertical-align: top;">
            <em><code class="parameter">CURL_HTTP_VERSION_NONE</code></em> (デフォルト。
            使用するバージョンを決めるのは cURL にまかせる)、
            <em><code class="parameter">CURL_HTTP_VERSION_1_0</code></em> (HTTP/1.0 を使用する)、
            あるいは <em><code class="parameter">CURL_HTTP_VERSION_1_1</code></em> (HTTP/1.1 を使用する)
            のいずれかです。
           </td>
           <td style="vertical-align: top;">
           </td>
          </tr>

          <tr>
           <td style="vertical-align: top;"><strong><code>CURLOPT_HTTPAUTH</code></strong></td>
           <td style="vertical-align: top;">
            <p class="para">
             使用する HTTP 認証方法。以下の中から選びます。
             <em><code class="parameter">CURLAUTH_BASIC</code></em>、
             <em><code class="parameter">CURLAUTH_DIGEST</code></em>、
             <em><code class="parameter">CURLAUTH_GSSNEGOTIATE</code></em>、
             <em><code class="parameter">CURLAUTH_NTLM</code></em>、
             <em><code class="parameter">CURLAUTH_ANY</code></em> および
             <em><code class="parameter">CURLAUTH_ANYSAFE</code></em>。
            </p>
            <p class="para">
             2 つ以上の方法を組み合わせるには、ビット演算子 <em>|</em>（or）
             を使用します。このような場合、cURL はサーバーがサポートしている方法を
             問い合わせたうえで最適な方法を選択します。
            </p>
            <p class="para">
             <em><code class="parameter">CURLAUTH_ANY</code></em> は
             <em>CURLAUTH_BASIC | CURLAUTH_DIGEST | CURLAUTH_GSSNEGOTIATE | CURLAUTH_NTLM</em>
             のエイリアスです。
            </p>
            <p class="para">
              <em><code class="parameter">CURLAUTH_ANYSAFE</code></em> は
              <em>CURLAUTH_DIGEST | CURLAUTH_GSSNEGOTIATE | CURLAUTH_NTLM</em>
              のエイリアスです。
            </p>
           </td>
           <td style="vertical-align: top;">
           </td>
          </tr>

          <tr>
           <td style="vertical-align: top;"><strong><code>CURLOPT_INFILESIZE</code></strong></td>
           <td style="vertical-align: top;">
            ファイルをリモートサイトにアップロードする際のファイルサイズ。
            このオプションを指定しても、libcurl がそれ以上のデータを送信するのは止められないことに注意しましょう。
            実際に何が送信されるのかは
            <strong><code>CURLOPT_READFUNCTION</code></strong> に依存します。
           </td>
           <td style="vertical-align: top;">
           </td>
          </tr>

          <tr>
           <td style="vertical-align: top;"><strong><code>CURLOPT_LOW_SPEED_LIMIT</code></strong></td>
           <td style="vertical-align: top;">
            1 秒あたりのバイト数で、転送速度がこれより遅い期間が
            <strong><code>CURLOPT_LOW_SPEED_TIME</code></strong> 秒以上続いた場合に
            PHP は転送を終了します。
           </td>
           <td style="vertical-align: top;">
           </td>
          </tr>

          <tr>
           <td style="vertical-align: top;"><strong><code>CURLOPT_LOW_SPEED_TIME</code></strong></td>
           <td style="vertical-align: top;">
            転送速度が <strong><code>CURLOPT_LOW_SPEED_LIMIT</code></strong>
            より遅い期間がどれだけ続いた場合に転送を異常終了させるかを、
            秒単位で指定します。
           </td>
           <td style="vertical-align: top;">
           </td>
          </tr>

          <tr>
           <td style="vertical-align: top;"><strong><code>CURLOPT_MAXCONNECTS</code></strong></td>
           <td style="vertical-align: top;">
            許可される持続的接続の最大数。もしこの値に達した場合、
            どの接続を閉じるのかを <strong><code>CURLOPT_CLOSEPOLICY</code></strong>
            によって決定します。
           </td>
           <td style="vertical-align: top;">
           </td>
          </tr>

          <tr>
           <td style="vertical-align: top;"><strong><code>CURLOPT_MAXREDIRS</code></strong></td>
           <td style="vertical-align: top;">
            HTTP のリダイレクト先を追いかける最大値。
            <strong><code>CURLOPT_FOLLOWLOCATION</code></strong> とあわせて使用します。
           </td>
           <td style="vertical-align: top;">
           </td>
          </tr>

          <tr>
           <td style="vertical-align: top;"><strong><code>CURLOPT_PORT</code></strong></td>
           <td style="vertical-align: top;">
            接続先のポート番号。
           </td>
           <td style="vertical-align: top;">
           </td>
          </tr>

          <tr>
           <td style="vertical-align: top;"><strong><code>CURLOPT_PROTOCOLS</code></strong></td>
           <td style="vertical-align: top;">
            <p class="para">
             <strong><code>CURLPROTO_*</code></strong> の値のビットマスク。使用すると、
             転送時に libcurl がどのプロトコルを使用するのかに制約を加えます。
             さまざまなプロトコルに対応するよう libcurl をビルドしていた場合でも、
             これによって特定の転送プロトコルのみを使用するように制限することができます。
             デフォルトでは、libcurl がサポートしているすべてのプロトコルの使用を許可します。
             <strong><code>CURLOPT_REDIR_PROTOCOLS</code></strong> も参照ください。
            </p>
            <p class="para">
             使用できるプロトコルオプションは次のとおりです。
             <em><code class="parameter">CURLPROTO_HTTP</code></em>,
             <em><code class="parameter">CURLPROTO_HTTPS</code></em>,
             <em><code class="parameter">CURLPROTO_FTP</code></em>,
             <em><code class="parameter">CURLPROTO_FTPS</code></em>,
             <em><code class="parameter">CURLPROTO_SCP</code></em>,
             <em><code class="parameter">CURLPROTO_SFTP</code></em>,
             <em><code class="parameter">CURLPROTO_TELNET</code></em>,
             <em><code class="parameter">CURLPROTO_LDAP</code></em>,
             <em><code class="parameter">CURLPROTO_LDAPS</code></em>,
             <em><code class="parameter">CURLPROTO_DICT</code></em>,
             <em><code class="parameter">CURLPROTO_FILE</code></em>,
             <em><code class="parameter">CURLPROTO_TFTP</code></em>,
             <em><code class="parameter">CURLPROTO_ALL</code></em>
            </p>
           </td>
           <td style="vertical-align: top;">
            cURL 7.19.4 で追加されました。
           </td>
          </tr>

          <tr>
           <td style="vertical-align: top;"><strong><code>CURLOPT_PROXYAUTH</code></strong></td>
           <td style="vertical-align: top;">
            プロキシ接続に使用する HTTP 認証の方法。
            <strong><code>CURLOPT_HTTPAUTH</code></strong> で説明したのと同じオプションを
            指定可能です。プロキシ認証でサポートされているのは、今のところ
            <em><code class="parameter">CURLAUTH_BASIC</code></em> および
            <em><code class="parameter">CURLAUTH_NTLM</code></em> のみです。
           </td>
           <td style="vertical-align: top;">
            cURL 7.10.7 で追加されました。
           </td>
          </tr>

          <tr>
           <td style="vertical-align: top;"><strong><code>CURLOPT_PROXYPORT</code></strong></td>
           <td style="vertical-align: top;">
            プロキシ接続のポート番号。このポート番号は、
            <strong><code>CURLOPT_PROXY</code></strong> で指定することも可能です。
           </td>
           <td style="vertical-align: top;">
           </td>
          </tr>

          <tr>
           <td style="vertical-align: top;"><strong><code>CURLOPT_PROXYTYPE</code></strong></td>
           <td style="vertical-align: top;">
            <em><code class="parameter">CURLPROXY_HTTP</code></em>（デフォルト）あるいは
            <em><code class="parameter">CURLPROXY_SOCKS5</code></em>。
           </td>
           <td style="vertical-align: top;">
            cURL 7.10 で追加されました。
           </td>
          </tr>

          <tr>
           <td style="vertical-align: top;"><strong><code>CURLOPT_REDIR_PROTOCOLS</code></strong></td>
           <td style="vertical-align: top;">
            <strong><code>CURLPROTO_*</code></strong> の値のビットマスク。使用すると、
            <strong><code>CURLOPT_FOLLOWLOCATION</code></strong> が有効な場合のリダイレクト時の転送に
            libcurl がどのプロトコルを使用するのかに制約を加えます。これによって、
            リダイレクト時に特定の転送プロトコルのみを使用するように制限することができます。
            デフォルトでは、libcurl がサポートしているすべてのプロトコルのうち
            FILE と SCP 以外のすべての使用を許可します。この挙動は 7.19.4
            より前のバージョンとは異なります。7.19.4 より前のバージョンでは、
            サポートするすべてのプロトコルを無条件に許可していました。
            プロトコル定数の値は <strong><code>CURLOPT_PROTOCOLS</code></strong> を参照ください。
           </td>
           <td style="vertical-align: top;">
            cURL 7.19.4 で追加されました。
           </td>
          </tr>

          <tr>
           <td style="vertical-align: top;"><strong><code>CURLOPT_RESUME_FROM</code></strong></td>
           <td style="vertical-align: top;">
            転送を途中から再開する場合のバイトオフセット。
           </td>
           <td style="vertical-align: top;">
           </td>
          </tr>

          <tr>
           <td style="vertical-align: top;"><strong><code>CURLOPT_SSL_VERIFYHOST</code></strong></td>
           <td style="vertical-align: top;">
            1 は SSL ピア証明書に一般名が存在するかどうかを調べます。
            2 はそれに加え、その名前がホスト名と一致することを検証します。
            本番環境では、このオプションの値は常に
            2 (デフォルト値) にしておかなければなりません。
           </td>
           <td style="vertical-align: top;">
            値 1 は、cURL 7.28.1 以降では使えなくなりました。
           </td>
          </tr>

          <tr>
           <td style="vertical-align: top;"><strong><code>CURLOPT_SSLVERSION</code></strong></td>
           <td style="vertical-align: top;">
            使用する SSL のバージョン（2 あるいは 3）。デフォルトでは
            PHP が自動的に判断しますが、これを手動で設定する必要がある場合もあります。
           </td>
           <td style="vertical-align: top;">
           </td>
          </tr>

          <tr>
           <td style="vertical-align: top;"><strong><code>CURLOPT_TIMECONDITION</code></strong></td>
           <td style="vertical-align: top;">
            <strong><code>CURLOPT_TIMEVALUE</code></strong> の扱いを決定します。
            <strong><code>CURLOPT_TIMEVALUE</code></strong> で指定した時刻以降に
            変更されたページのみを返す場合は
            <em><code class="parameter">CURL_TIMECOND_IFMODSINCE</code></em> を使用します。
            <strong><code>CURLOPT_HEADER</code></strong> が <strong><code>TRUE</code></strong> だと仮定すると、
            ページが変更されていない場合は
            <em>&quot;304 Not Modified&quot;</em> ヘッダが返されます。
            <em><code class="parameter">CURL_TIMECOND_IFUNMODSINCE</code></em> は反対の意味です。
            デフォルトは <em><code class="parameter">CURL_TIMECOND_IFMODSINCE</code></em>
            です。
           </td>
           <td style="vertical-align: top;">
           </td>
          </tr>

          <tr>
           <td style="vertical-align: top;"><strong><code>CURLOPT_TIMEOUT</code></strong></td>
           <td style="vertical-align: top;">
            cURL 関数の実行にかけられる時間の最大値。
           </td>
           <td style="vertical-align: top;">
           </td>
          </tr>

          <tr>
           <td style="vertical-align: top;"><strong><code>CURLOPT_TIMEOUT_MS</code></strong></td>
           <td style="vertical-align: top;">
            cURL 関数の実行にかけられる最大のミリ秒数。
            
            システムの標準の名前解決を使うように libcurl をビルドしている場合は、
            接続のタイムアウトは秒単位の精度となり、最小のタイムアウトは 1 秒となります。
           </td>
           <td style="vertical-align: top;">
            cURL 7.16.2 で追加されました。PHP 5.2.3 以降で使用可能です。
           </td>
          </tr>

          <tr>
           <td style="vertical-align: top;"><strong><code>CURLOPT_TIMEVALUE</code></strong></td>
           <td style="vertical-align: top;">
            1970 年 1 月 1 日からの経過秒数。この値は
            <strong><code>CURLOPT_TIMECONDITION</code></strong> で使用されます。デフォルトでは
            <em><code class="parameter">CURL_TIMECOND_IFMODSINCE</code></em> が設定されます。
           </td>
           <td style="vertical-align: top;">
           </td>
          </tr>

          <tr>
           <td style="vertical-align: top;"><strong><code>CURLOPT_MAX_RECV_SPEED_LARGE</code></strong></td>
           <td style="vertical-align: top;">
            ダウンロード速度 (単位は「バイト/秒」) の転送中累加平均がこの値を超えると、
            転送を一時停止して、平均速度がこのパラメータの値以下に落ちるまで待ちます。
            デフォルトは無制限です。
           </td>
           <td style="vertical-align: top;">
            cURL 7.15.5 で追加されました。PHP 5.4.0 以降で使用可能です。
           </td>
          </tr>

          <tr>
           <td style="vertical-align: top;"><strong><code>CURLOPT_MAX_SEND_SPEED_LARGE</code></strong></td>
           <td style="vertical-align: top;">
            アップロード速度 (単位は「バイト/秒」) の転送中累加平均がこの値を超えると、
            転送を一時停止して、平均速度がこのパラメータの値以下に落ちるまで待ちます。
            デフォルトは無制限です。
           </td>
           <td style="vertical-align: top;">
            cURL 7.15.5 で追加されました。PHP 5.4.0 以降で使用可能です。
           </td>
          </tr>

          <tr>
           <td style="vertical-align: top;"><strong><code>CURLOPT_SSH_AUTH_TYPES</code></strong></td>
           <td style="vertical-align: top;">
            <strong><code>CURLSSH_AUTH_PUBLICKEY</code></strong>, 
            <strong><code>CURLSSH_AUTH_PASSWORD</code></strong>, 
            <strong><code>CURLSSH_AUTH_HOST</code></strong>, 
            <strong><code>CURLSSH_AUTH_KEYBOARD</code></strong>
            のビットマスク。
            <strong><code>CURLSSH_AUTH_ANY</code></strong> にすると libcurl がいずれかひとつを選択します。
           </td>
           <td style="vertical-align: top;">
            cURL 7.16.1 で追加されました。
           </td>
          </tr>

          <tr>
           <td style="vertical-align: top;"><strong><code>CURLOPT_IPRESOLVE</code></strong></td>
           <td style="vertical-align: top;">
            ホスト名の解決にどの形式の IP アドレスを使うのかを、アプリケーションが選べるようにします。
            複数のバージョンの IP アドレスで解決できるホスト名のときに使うもので、指定できる値は
            <strong><code>CURLOPT_IPRESOLVE_WHATEVER</code></strong>、
            <strong><code>CURLOPT_IPRESOLVE_V4</code></strong> そして
            <strong><code>CURLOPT_IPRESOLVE_V6</code></strong> です。
            デフォルトは <strong><code>CURLOPT_IPRESOLVE_WHATEVER</code></strong> です。
           </td>
           <td style="vertical-align: top;">
            cURL 7.10.8 で追加されました。
           </td>
          </tr>

         </tbody>
        
       </table>

      </p>
      <p class="para">
       <em><code class="parameter">value</code></em> は、
       <em><code class="parameter">option</code></em> パラメータの
       以下の値に関して文字列である必要があります。
       <table class="doctable informaltable">
        
         <thead>
          <tr>
           <th>オプション</th>
           <th><em><code class="parameter">value</code></em> への設定値</th>
           <th>注記</th>
          </tr>

         </thead>

         <tbody class="tbody">
          <tr>
           <td style="vertical-align: top;"><strong><code>CURLOPT_CAINFO</code></strong></td>
           <td style="vertical-align: top;">
            接続先を検証するための証明書を保持するファイル名。
            これは <strong><code>CURLOPT_SSL_VERIFYPEER</code></strong> を使用する場合に
            のみ意味を持ちます。
           </td>
           <td style="vertical-align: top;">
            絶対パスで指定しなければなりません。
           </td>
          </tr>

          <tr>
           <td style="vertical-align: top;"><strong><code>CURLOPT_CAPATH</code></strong></td>
           <td style="vertical-align: top;">
            複数の証明書ファイルを保持するディレクトリ。このオプションは
            <strong><code>CURLOPT_SSL_VERIFYPEER</code></strong> とともに使用します。
           </td>
           <td style="vertical-align: top;">
           </td>
          </tr>

          <tr>
           <td style="vertical-align: top;"><strong><code>CURLOPT_COOKIE</code></strong></td>
           <td style="vertical-align: top;">
            HTTP リクエストにおける
            <em>&quot;Cookie: &quot;</em> ヘッダの内容。
            クッキーが複数ある場合は、セミコロンとスペースで区切られる
            (例 &quot;<em>fruit=apple; colour=red</em>&quot;)
            ことに注意しましょう。
           </td>
           <td style="vertical-align: top;">
           </td>
          </tr>

          <tr>
           <td style="vertical-align: top;"><strong><code>CURLOPT_COOKIEFILE</code></strong></td>
           <td style="vertical-align: top;">
            クッキーのデータを保持するファイルの名前。クッキーファイルは、
            Netscape フォーマットあるいは
            HTTP ヘッダを単純にファイルにダンプしたものが使用可能です。
            名前が空文字列の場合はクッキーを読み込みませんが、クッキーの処理は有効なままです。
           </td>
           <td style="vertical-align: top;">
           </td>
          </tr>

          <tr>
           <td style="vertical-align: top;"><strong><code>CURLOPT_COOKIEJAR</code></strong></td>
           <td style="vertical-align: top;">
            ハンドルを閉じる際 (curl_close のコール後など) に、
            すべての内部クッキーを保存するファイルの名前。
           </td>
           <td style="vertical-align: top;">
           </td>
          </tr>

          <tr>
           <td style="vertical-align: top;"><strong><code>CURLOPT_CUSTOMREQUEST</code></strong></td>
           <td style="vertical-align: top;">
            HTTP リクエストで
            <em>&quot;GET&quot;</em> あるいは <em>&quot;HEAD&quot;</em> 以外に
            使用するカスタムメソッド。これが有用なのは、<em>&quot;DELETE&quot;</em>
            やその他のあまり知られていない HTTP リクエストを実行する場合です。
            使用可能な値は <em>&quot;GET&quot;</em>、
            <em>&quot;POST&quot;</em>、<em>&quot;CONNECT&quot;</em> などです。
            HTTP リクエストの内容をすべて指定するわけではありません。つまり、
            <em>&quot;GET /index.html HTTP/1.0\r\n\r\n&quot;</em> のような
            記述は間違いだということです。
            <blockquote class="note"><p><strong class="note">注意</strong>: 
             <p class="para">
              使用しようとしているメソッドをサーバーがサポートしていることを
              確かめるまで、これを使用しないでください。
             </p>
            </p></blockquote>
           </td>
           <td style="vertical-align: top;">
           </td>
          </tr>

          <tr>
           <td style="vertical-align: top;"><strong><code>CURLOPT_EGDSOCKET</code></strong></td>
           <td style="vertical-align: top;">
            <strong><code>CURLOPT_RANDOM_FILE</code></strong> と似ていますが、
            Entropy Gathering Daemon ソケットを使用してファイル名を生成する点が
            違います。
           </td>
           <td style="vertical-align: top;">
           </td>
          </tr>

          <tr>
           <td style="vertical-align: top;"><strong><code>CURLOPT_ENCODING</code></strong></td>
           <td style="vertical-align: top;">
            <em>&quot;Accept-Encoding: &quot;</em> ヘッダの内容。
            これにより、応答のデコードを可能にします。サポートされる
            エンコーディングは <em>&quot;identity&quot;</em>、
            <em>&quot;deflate&quot;</em> および <em>&quot;gzip&quot;</em>
            です。もし空文字列 <em>&quot;&quot;</em> が指定された場合、
            サポートされるエンコーディングをすべて含むヘッダが送信されます。
           </td>
           <td style="vertical-align: top;">
            cURL 7.10 で追加されました。
           </td>
          </tr>

          <tr>
           <td style="vertical-align: top;"><strong><code>CURLOPT_FTPPORT</code></strong></td>
           <td style="vertical-align: top;">
            FTP で &quot;POST&quot; を使用するための IP アドレスを取得する際に使用される値。
            &quot;POST&quot; は、リモートサーバーに対してこちらが指定した IP アドレスに
            接続するよう指示します。この値に設定できる内容は IP アドレス、ホスト名、
            ネットワークインターフェイス名（Unix）、あるいは単に &#039;-&#039; を指定する
            ことでシステムのデフォルト IP アドレスを指定します。
           </td>
           <td style="vertical-align: top;">
           </td>
          </tr>

          <tr>
           <td style="vertical-align: top;"><strong><code>CURLOPT_INTERFACE</code></strong></td>
           <td style="vertical-align: top;">
            使用するネットワークインターフェイスの名前。
            インターフェイス名、IP アドレスあるいはホスト名が指定可能です。
           </td>
           <td style="vertical-align: top;">
           </td>
          </tr>

          <tr>
           <td style="vertical-align: top;"><strong><code>CURLOPT_KEYPASSWD</code></strong></td>
           <td style="vertical-align: top;">
            <strong><code>CURLOPT_SSLKEY</code></strong>
            あるいは <strong><code>CURLOPT_SSH_PRIVATE_KEYFILE</code></strong> 秘密鍵を使うときに必須となるパスワード。
           </td>
           <td style="vertical-align: top;">
            cURL 7.16.1 で追加されました。
           </td>
          </tr>

          <tr>
           <td style="vertical-align: top;"><strong><code>CURLOPT_KRB4LEVEL</code></strong></td>
           <td style="vertical-align: top;">
            KRB4（Kerberos 4）セキュリティレベル。以下の値のいずれか
            （セキュリティの低い順です）が指定可能です。
            <em>&quot;clear&quot;</em>、
            <em>&quot;safe&quot;</em>、
            <em>&quot;confidential&quot;</em>、
            <em>&quot;private&quot;</em>。
            文字列がこれらのどれでもなかった場合は、
            <em>&quot;private&quot;</em> が使用されます。このオプションを <strong><code>NULL</code></strong>
            にすると KRB4 セキュリティを無効にします。現時点では、KRB4
            セキュリティは FTP 転送にのみ使用可能です。
           </td>
           <td style="vertical-align: top;">
           </td>
          </tr>

          <tr>
           <td style="vertical-align: top;"><strong><code>CURLOPT_POSTFIELDS</code></strong></td>
           <td style="vertical-align: top;">
            <span class="simpara">
             HTTP &quot;POST&quot; で送信するすべてのデータ。
             ファイルを送信するには、ファイル名の先頭に <em>@</em>
             をつけてフルパスを指定します。ファイルタイプを明示的に指定するには、ファイル名の後に
             &#039;<em>;type=mimetype</em>&#039; 形式で続けます。
             このパラメータは
             &#039;<em>para1=val1&amp;para2=val2&amp;...</em>&#039;
             のように url エンコードされた文字列形式で渡すこともできますし、
             フィールド名をキー、データを値とする配列で渡すこともできます。
             <em><code class="parameter">value</code></em> が配列の場合、
             <em>Content-Type</em> ヘッダには
             <em>multipart/form-data</em> を設定します。
            </span>
            <span class="simpara">
             PHP 5.2.0 以降、このオプションに
             <em>@</em> プレフィックスつきでファイルを渡したときは
             <em><code class="parameter">value</code></em> が配列でなければならなくなりました。
            </span>
            <span class="simpara">
             PHP 5.5.0 以降、<em>@</em> プレフィックスは非推奨になりました。
             また、ファイルを <a href="class.curlfile.html" class="classname">CURLFile</a> で送信できるようになりました。
            </span>
           </td>
           <td style="vertical-align: top;">
           </td>
          </tr>

          <tr>
           <td style="vertical-align: top;"><strong><code>CURLOPT_PROXY</code></strong></td>
           <td style="vertical-align: top;">
            リクエストを経由させる HTTP プロキシ。
           </td>
           <td style="vertical-align: top;">
           </td>
          </tr>

          <tr>
           <td style="vertical-align: top;"><strong><code>CURLOPT_PROXYUSERPWD</code></strong></td>
           <td style="vertical-align: top;">
            プロキシに接続するためのユーザー名とパスワード。
            <em>&quot;[username]:[password]&quot;</em> 形式で指定します。
           </td>
           <td style="vertical-align: top;">
           </td>
          </tr>

          <tr>
           <td style="vertical-align: top;"><strong><code>CURLOPT_RANDOM_FILE</code></strong></td>
           <td style="vertical-align: top;">
            使用するファイル名を、SSL の乱数生成器を使用して作成します。
           </td>
           <td style="vertical-align: top;">
           </td>
          </tr>

          <tr>
           <td style="vertical-align: top;"><strong><code>CURLOPT_RANGE</code></strong></td>
           <td style="vertical-align: top;">
            取得するデータの範囲を
            <em>&quot;X-Y&quot;</em> 形式で指定します。X あるいは Y は省略可能です。
            HTTP 転送では、いくつかの範囲をカンマで区切った
            <em>&quot;X-Y,N-M&quot;</em> のような形式もサポートしています。
           </td>
           <td style="vertical-align: top;">
           </td>
          </tr>

          <tr>
           <td style="vertical-align: top;"><strong><code>CURLOPT_REFERER</code></strong></td>
           <td style="vertical-align: top;">
            HTTP リクエストで使用される <em>&quot;Referer: &quot;</em>
            ヘッダの内容。
           </td>
           <td style="vertical-align: top;">
           </td>
          </tr>

          <tr>
           <td style="vertical-align: top;"><strong><code>CURLOPT_SSH_HOST_PUBLIC_KEY_MD5</code></strong></td>
           <td style="vertical-align: top;">
            32 桁の十六進文字列。この文字列は、リモートホストの公開鍵の MD5 チェックサムでなければなりません。
            md5sum がマッチしない限り、libcurl はホストとの接続を拒否します。
            このオプションは、SCP および SFTP でのみ有効です。
           </td>
           <td style="vertical-align: top;">
            cURL 7.17.1 で追加されました。
           </td>
          </tr>

          <tr>
           <td style="vertical-align: top;"><strong><code>CURLOPT_SSH_PUBLIC_KEYFILE</code></strong></td>
           <td style="vertical-align: top;">
            公開鍵のファイル名。指定しなかった場合、libcurl はデフォルトの場所を探します。デフォルトは、
            環境変数 HOME が設定されていれば $HOME/.ssh/id_dsa.pub、設定されていなければ
            カレントディレクトリの &quot;id_dsa.pub&quot; です。
           </td>
           <td style="vertical-align: top;">
            cURL 7.16.1 で追加されました。
           </td>
          </tr>

          <tr>
           <td style="vertical-align: top;"><strong><code>CURLOPT_SSH_PRIVATE_KEYFILE</code></strong></td>
           <td style="vertical-align: top;">
            秘密鍵のファイル名。指定しなかった場合、libcurl はデフォルトの場所を探します。デフォルトは、
            環境変数 HOME が設定されていれば $HOME/.ssh/id_dsa、設定されていなければ
            カレントディレクトリの &quot;id_dsa&quot; です。
            ファイルがパスワードで保護されている場合は、パスワードを
            <strong><code>CURLOPT_KEYPASSWD</code></strong> に設定します。
           </td>
           <td style="vertical-align: top;">
            cURL 7.16.1 で追加されました。
           </td>
          </tr>

          <tr>
           <td style="vertical-align: top;"><strong><code>CURLOPT_SSL_CIPHER_LIST</code></strong></td>
           <td style="vertical-align: top;">
            SSL で使用する暗号のリスト。例えば
            <em>RC4-SHA</em> および <em>TLSv1</em> が
            使用可能です。
           </td>
           <td style="vertical-align: top;">
           </td>
          </tr>

          <tr>
           <td style="vertical-align: top;"><strong><code>CURLOPT_SSLCERT</code></strong></td>
           <td style="vertical-align: top;">
            PEM フォーマットの証明書を含むファイルの名前。
           </td>
           <td style="vertical-align: top;">
           </td>
          </tr>

          <tr>
           <td style="vertical-align: top;"><strong><code>CURLOPT_SSLCERTPASSWD</code></strong></td>
           <td style="vertical-align: top;">
            <strong><code>CURLOPT_SSLCERT</code></strong>
            証明書を使用する際に必要なパスワード。
           </td>
           <td style="vertical-align: top;">
           </td>
          </tr>

          <tr>
           <td style="vertical-align: top;"><strong><code>CURLOPT_SSLCERTTYPE</code></strong></td>
           <td style="vertical-align: top;">
            証明書の形式。サポートされるフォーマットは
            <em>&quot;PEM&quot;</em>（デフォルト）、<em>&quot;DER&quot;</em>
            および <em>&quot;ENG&quot;</em> です。
           </td>
           <td style="vertical-align: top;">
            cURL 7.9.3 で追加されました。
           </td>
          </tr>

          <tr>
           <td style="vertical-align: top;"><strong><code>CURLOPT_SSLENGINE</code></strong></td>
           <td style="vertical-align: top;">
            <strong><code>CURLOPT_SSLKEY</code></strong> で指定した SSL 秘密鍵の
            暗号化エンジンの ID 。
           </td>
           <td style="vertical-align: top;">
           </td>
          </tr>

          <tr>
           <td style="vertical-align: top;"><strong><code>CURLOPT_SSLENGINE_DEFAULT</code></strong></td>
           <td style="vertical-align: top;">
            非対称暗号化で使用する暗号化エンジンの ID 。
           </td>
           <td style="vertical-align: top;">
           </td>
          </tr>

          <tr>
           <td style="vertical-align: top;"><strong><code>CURLOPT_SSLKEY</code></strong></td>
           <td style="vertical-align: top;">
            SSL 秘密鍵を含むファイルの名前。
           </td>
           <td style="vertical-align: top;">
           </td>
          </tr>

          <tr>
           <td style="vertical-align: top;"><strong><code>CURLOPT_SSLKEYPASSWD</code></strong></td>
           <td style="vertical-align: top;">
            <strong><code>CURLOPT_SSLKEY</code></strong> で指定した SSL 秘密鍵を
            使用するために必要なパスワード。
            <blockquote class="note"><p><strong class="note">注意</strong>: 
             <p class="para">
              このオプションには重要なパスワードが含まれます。PHP スクリプトを
              安全な状態におくことを忘れないでください。
             </p>
            </p></blockquote>
           </td>
           <td style="vertical-align: top;">
           </td>
          </tr>

          <tr>
           <td style="vertical-align: top;"><strong><code>CURLOPT_SSLKEYTYPE</code></strong></td>
           <td style="vertical-align: top;">
            <strong><code>CURLOPT_SSLKEY</code></strong> で指定した SSL 秘密鍵の
            形式。サポートされる型は以下のとおりです。
            <em>&quot;PEM&quot;</em>（デフォルト）、<em>&quot;DER&quot;</em>
            および <em>&quot;ENG&quot;</em> 。
           </td>
           <td style="vertical-align: top;">
           </td>
          </tr>

          <tr>
           <td style="vertical-align: top;"><strong><code>CURLOPT_URL</code></strong></td>
           <td style="vertical-align: top;">
            取得する URL 。 <span class="function"><a href="function.curl-init.html" class="function">curl_init()</a></span> でセッションを
            初期化する際に指定することも可能です。
           </td>
           <td style="vertical-align: top;">
           </td>
          </tr>

          <tr>
           <td style="vertical-align: top;"><strong><code>CURLOPT_USERAGENT</code></strong></td>
           <td style="vertical-align: top;">
            HTTP リクエストで使用される <em>&quot;User-Agent: &quot;</em>
            ヘッダの内容。
           </td>
           <td style="vertical-align: top;">
           </td>
          </tr>

          <tr>
           <td style="vertical-align: top;"><strong><code>CURLOPT_USERPWD</code></strong></td>
           <td style="vertical-align: top;">
            接続に使用するユーザー名とパスワード。
            <em>&quot;[username]:[password]&quot;</em> 形式で指定します。
           </td>
           <td style="vertical-align: top;">
           </td>
          </tr>

         </tbody>
        
       </table>

      </p>
      <p class="para">
       <em><code class="parameter">value</code></em> には、
       <em><code class="parameter">option</code></em> の以下の値に関して
       配列を指定する必要があります。
       <table class="doctable informaltable">
        
         <thead>
          <tr>
           <th>オプション</th>
           <th><em><code class="parameter">value</code></em> への設定値</th>
           <th>注記</th>
          </tr>

         </thead>

         <tbody class="tbody">
          <tr>
           <td style="vertical-align: top;"><strong><code>CURLOPT_HTTP200ALIASES</code></strong></td>
           <td style="vertical-align: top;">
            エラーではなく正常な応答として扱われる、HTTP 200 レスポンスの配列。
           </td>
           <td style="vertical-align: top;">
            cURL 7.10.3 で追加されました。
           </td>
          </tr>

          <tr>
           <td style="vertical-align: top;"><strong><code>CURLOPT_HTTPHEADER</code></strong></td>
           <td style="vertical-align: top;">
            設定する HTTP ヘッダフィールドの配列。
            <code class="code">
             array(&#039;Content-type: text/plain&#039;, &#039;Content-length: 100&#039;)
            </code>
            形式。
           </td>
           <td style="vertical-align: top;">
           </td>
          </tr>

          <tr>
           <td style="vertical-align: top;"><strong><code>CURLOPT_POSTQUOTE</code></strong></td>
           <td style="vertical-align: top;">
            FTP リクエストの実行後に、サーバー上で実行する FTP コマンドの配列。
           </td>
           <td style="vertical-align: top;">
           </td>
          </tr>

          <tr>
           <td style="vertical-align: top;"><strong><code>CURLOPT_QUOTE</code></strong></td>
           <td style="vertical-align: top;">
            FTP リクエストの前にサーバー上で実行する FTP コマンドの配列。
           </td>
           <td style="vertical-align: top;">
           </td>
          </tr>

         </tbody>
        
       </table>

      </p>
      <p class="para">
       <em><code class="parameter">value</code></em> はストリームリソース（例えば
        <span class="function"><a href="function.fopen.html" class="function">fopen()</a></span> が作成するもの）であり、以下の
       <em><code class="parameter">option</code></em> パラメータに設定します。
       <table class="doctable informaltable">
        
         <thead>
          <tr>
           <th>オプション</th>
           <th><em><code class="parameter">value</code></em> に設定する内容</th>
          </tr>

         </thead>

         <tbody class="tbody">
          <tr>
           <td style="vertical-align: top;"><strong><code>CURLOPT_FILE</code></strong></td>
           <td style="vertical-align: top;">
            転送内容が書き込まれるファイル。デフォルトは <em>STDOUT</em>
            （ブラウザウィンドウ）。
           </td>
          </tr>

          <tr>
           <td style="vertical-align: top;"><strong><code>CURLOPT_INFILE</code></strong></td>
           <td style="vertical-align: top;">
            アップロード時に転送内容を読み込むファイル。
           </td>
          </tr>

          <tr>
           <td style="vertical-align: top;"><strong><code>CURLOPT_STDERR</code></strong></td>
           <td style="vertical-align: top;">
            <em>STDERR</em> の代わりにエラーを出力する場所。
           </td>
          </tr>

          <tr>
           <td style="vertical-align: top;"><strong><code>CURLOPT_WRITEHEADER</code></strong></td>
           <td style="vertical-align: top;">
            転送のヘッダ部分が書き込まれるファイル。
           </td>
          </tr>

         </tbody>
        
       </table>

      </p>
      <p class="para">
       <em><code class="parameter">value</code></em> には、
       <em><code class="parameter">option</code></em> の以下の値に関して
       有効な関数あるいはクロージャの名前を指定する必要があります。
       <table class="doctable informaltable">
        
         <thead>
          <tr>
           <th>オプション</th>
           <th><em><code class="parameter">value</code></em> への設定値</th>
          </tr>

         </thead>

         <tbody class="tbody">
          <tr>
           <td style="vertical-align: top;"><strong><code>CURLOPT_HEADERFUNCTION</code></strong></td>
           <td style="vertical-align: top;">
            二つのパラメータをとるコールバック。
            最初のパラメータは CURL リソースで、2 番目は書き込む
            ヘッダデータの文字列です。このコールバック関数を使用するにあたり、
            ヘッダデータを書き込む処理を実装するのはあなたの役目となります。
            書き込んだデータのバイト数を返します。
           </td>
          </tr>

          <tr>
           <td style="vertical-align: top;"><strong><code>CURLOPT_PASSWDFUNCTION</code></strong></td>
           <td style="vertical-align: top;">
            三つのパラメータをとるコールバック。
            最初のパラメータは CURL リソースで、2 番目はパスワード
            プロンプトの文字列、そして 3 番目はパスワードの最大長です。
            入力されたパスワードを文字列で返します。
           </td>
          </tr>

          <tr>
           <td style="vertical-align: top;"><strong><code>CURLOPT_PROGRESSFUNCTION</code></strong></td>
           <td style="vertical-align: top;">
            <p class="para">
             五つのパラメータをとるコールバック。
             最初のパラメータは cURL 利ソールで、2 番目はこの転送でダウンロードしようとしている総バイト数、
             3 番目はこれまでにダウンロードしたバイト数、4 番目はこの転送でアップロードしようとしている総バイト数、
             そして 5 番目はこれまでにアップロードしたバイト数です。
            </p>
            <blockquote class="note"><p><strong class="note">注意</strong>: 
             <p class="para">
              このコールバックが呼ばれるのは、<strong><code>CURLOPT_NOPROGRESS</code></strong>
              が <strong><code>FALSE</code></strong> の場合だけです。
             </p>
            </p></blockquote>
            <p class="para">
             ゼロ以外の値を返すと、転送を強制終了できます。このとき、この転送にはエラー
             <strong><code>CURLE_ABORTED_BY_CALLBACK</code></strong>
             が設定されます。
            </p>
           </td>
          </tr>

          <tr>
           <td style="vertical-align: top;"><strong><code>CURLOPT_READFUNCTION</code></strong></td>
           <td style="vertical-align: top;">
            三つのパラメータをとるコールバック。
            最初のパラメータは CURL リソースで、2 番目は
            <strong><code>CURLOPT_INFILE</code></strong> で cURL に渡したストリームリソース、
            そして最後が読み込むデータの最大量です。
            コールバックは、要求したデータ量以下の長さの文字列を返さなければなりません。
            一般的には、渡されたストリームリソースから読み込んだデータを返します。
            <em>EOF</em> を伝えるには空文字列を返さなければなりません。
           </td>
          </tr>

          <tr>
           <td style="vertical-align: top;"><strong><code>CURLOPT_WRITEFUNCTION</code></strong></td>
           <td style="vertical-align: top;">
            二つのパラメータをとるコールバック。
            最初のパラメータは CURL リソースで、2 番目は書き込む
            データの文字列です。データの保存には、
            このコールバック関数を使わなければなりません。
            書き込んだデータの正確なバイト数を返す必要があります。
            返さなければ、エラーで転送が異常終了します。
           </td>
          </tr>

         </tbody>
        
       </table>

      </p>
      <p class="para">
       その他の値
       <table class="doctable informaltable">
        
         <thead>
          <tr>
           <th>オプション</th>
           <th><em><code class="parameter">value</code></em> への設定値</th>
          </tr>

         </thead>

         <tbody class="tbody">
          <tr>
           <td style="vertical-align: top;"><strong><code>CURLOPT_SHARE</code></strong></td>
           <td style="vertical-align: top;">
             <span class="function"><a href="function.curl-share-init.html" class="function">curl_share_init()</a></span> の結果。
            この cURL ハンドルに、共有ハンドルからのデータを使わせるようにします。
           </td>
          </tr>

         </tbody>
        
       </table>

      </p>
     </dd>

    </dt>

   </dl>

  </p>
 </div>

 
 <div class="refsect1 returnvalues" id="refsect1-function.curl-setopt-returnvalues">
  <h3 class="title">返り値</h3>
  <p class="para">
   成功した場合に <strong><code>TRUE</code></strong> を、失敗した場合に <strong><code>FALSE</code></strong> を返します。
  </p>
 </div>


 <div class="refsect1 changelog" id="refsect1-function.curl-setopt-changelog">
  <h3 class="title">変更履歴</h3>
  <p class="para">
   <table class="doctable informaltable">
    
     <thead>
      <tr>
       <th>バージョン</th>
       <th>説明</th>
      </tr>

     </thead>

     <tbody class="tbody">
      <tr>
       <td>5.5.0</td>
       <td>
        cURL リソースを、
        <strong><code>CURLOPT_PROGRESSFUNCTION</code></strong> コールバックの最初の引数として渡すようになりました。
       </td>
      </tr>

      <tr>
       <td>5.5.0</td>
       <td>
        <strong><code>CURLOPT_SHARE</code></strong> が追加されました。
       </td>
      </tr>

      <tr>
       <td>5.3.0</td>
       <td>
        <strong><code>CURLOPT_PROGRESSFUNCTION</code></strong> が追加されました。
       </td>
      </tr>

      <tr>
       <td>5.2.10</td>
       <td>
        <strong><code>CURLOPT_PROTOCOLS</code></strong> および
        <strong><code>CURLOPT_REDIR_PROTOCOLS</code></strong>
        が追加されました。
       </td>
      </tr>

      <tr>
       <td>5.1.0</td>
       <td>
        <strong><code>CURLOPT_AUTOREFERER</code></strong>,
        <strong><code>CURLOPT_BINARYTRANSFER</code></strong>,
        <strong><code>CURLOPT_FTPSSLAUTH</code></strong>,
        <strong><code>CURLOPT_PROXYAUTH</code></strong> および
        <strong><code>CURLOPT_TIMECONDITION</code></strong>
        が追加されました。
       </td>
      </tr>

      <tr>
       <td>5.0.0</td>
       <td>
        <strong><code>CURLOPT_FTP_USE_EPRT</code></strong>,
        <strong><code>CURLOPT_NOSIGNAL</code></strong>,
        <strong><code>CURLOPT_UNRESTRICTED_AUTH</code></strong>,
        <strong><code>CURLOPT_BUFFERSIZE</code></strong>,
        <strong><code>CURLOPT_HTTPAUTH</code></strong>,
        <strong><code>CURLOPT_PROXYPORT</code></strong>,
        <strong><code>CURLOPT_PROXYTYPE</code></strong>,
        <strong><code>CURLOPT_SSLCERTTYPE</code></strong> および
        <strong><code>CURLOPT_HTTP200ALIASES</code></strong>
        が追加されました。
       </td>
      </tr>

     </tbody>
    
   </table>

  </p>
 </div>

 
 <div class="refsect1 examples" id="refsect1-function.curl-setopt-examples">
  <h3 class="title">例</h3>
  <p class="para">
   <div class="example" id="example-4204">
    <p><strong>例1 新規に cURL セッションを初期化、ウェブページを取得する</strong></p>
    <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br /></span><span style="color: #FF8000">//&nbsp;新しい&nbsp;cURL&nbsp;リソースを作成します<br /></span><span style="color: #0000BB">$ch&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">curl_init</span><span style="color: #007700">();<br /><br /></span><span style="color: #FF8000">//&nbsp;URL&nbsp;その他のオプションを適切に設定します<br /></span><span style="color: #0000BB">curl_setopt</span><span style="color: #007700">(</span><span style="color: #0000BB">$ch</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">CURLOPT_URL</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">"http://www.example.com/"</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">curl_setopt</span><span style="color: #007700">(</span><span style="color: #0000BB">$ch</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">CURLOPT_HEADER</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">false</span><span style="color: #007700">);<br /><br /></span><span style="color: #FF8000">//&nbsp;URL&nbsp;の内容を取得し、ブラウザに渡します<br /></span><span style="color: #0000BB">curl_exec</span><span style="color: #007700">(</span><span style="color: #0000BB">$ch</span><span style="color: #007700">);<br /><br /></span><span style="color: #FF8000">//&nbsp;cURL&nbsp;リソースを閉じ、システムリソースを開放します<br /></span><span style="color: #0000BB">curl_close</span><span style="color: #007700">(</span><span style="color: #0000BB">$ch</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
    </div>

   </div>
  </p>
  <p class="para">
   <div class="example" id="example-4205">
    <p><strong>例2 ファイルのアップロード</strong></p>
    <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br /><br /></span><span style="color: #FF8000">/*&nbsp;http://localhost/upload.php:<br />print_r($_POST);<br />print_r($_FILES);<br />*/<br /><br /></span><span style="color: #0000BB">$ch&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">curl_init</span><span style="color: #007700">();<br /><br /></span><span style="color: #0000BB">$data&nbsp;</span><span style="color: #007700">=&nbsp;array(</span><span style="color: #DD0000">'name'&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #DD0000">'Foo'</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">'file'&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #DD0000">'@/home/user/test.png'</span><span style="color: #007700">);<br /><br /></span><span style="color: #0000BB">curl_setopt</span><span style="color: #007700">(</span><span style="color: #0000BB">$ch</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">CURLOPT_URL</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">'http://localhost/upload.php'</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">curl_setopt</span><span style="color: #007700">(</span><span style="color: #0000BB">$ch</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">CURLOPT_POST</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">1</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">curl_setopt</span><span style="color: #007700">(</span><span style="color: #0000BB">$ch</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">CURLOPT_POSTFIELDS</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$data</span><span style="color: #007700">);<br /><br /></span><span style="color: #0000BB">curl_exec</span><span style="color: #007700">(</span><span style="color: #0000BB">$ch</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
    </div>

    <div class="example-contents"><p>上の例の出力は以下となります。</p></div>
    <div class="example-contents screen">
<div class="cdata"><pre>
Array
(
    [name] =&gt; Foo
)
Array
(
    [file] =&gt; Array
        (
            [name] =&gt; test.png
            [type] =&gt; image/png
            [tmp_name] =&gt; /tmp/phpcpjNeQ
            [error] =&gt; 0
            [size] =&gt; 279
        )

)

</pre></div>
    </div>
   </div>
  </p>
 </div>

 
 <div class="refsect1 notes" id="refsect1-function.curl-setopt-notes">
  <h3 class="title">注意</h3>
  <blockquote class="note"><p><strong class="note">注意</strong>: 
   <p class="para">
    配列を <strong><code>CURLOPT_POSTFIELDS</code></strong> に渡すと、データを
    <em class="emphasis">multipart/form-data</em> でエンコードします。
    一方 URL エンコードされた文字列を渡すと、データを
    <em class="emphasis">application/x-www-form-urlencoded</em> でエンコードします。
   </p>
  </p></blockquote>
 </div>

 
 <div class="refsect1 seealso" id="refsect1-function.curl-setopt-seealso">
  <h3 class="title">参考</h3>
  <p class="para">
   <ul class="simplelist">
    <li class="member"> <span class="function"><a href="function.curl-setopt-array.html" class="function" rel="rdfs-seeAlso">curl_setopt_array()</a> - CURL 転送用の複数のオプションを設定する</span></li>
   </ul>
  </p>
 </div>


</div><div id="usernotes">
 <div class="head">
  <h3 class="title">User Contributed Notes</h3>
 </div>
<div id="allnotes">  <a name="113754""></a>
  <div class="note">
   <strong class="user">etiennez0r at gmail dot com</strong>
   <a href="#113754" class="date">27-Nov-2013 05:48</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
// For those having message<br />
// SSL connection timeout<br />
curl_setopt($ch, CURLOPT_SSLVERSION, 1);<br />
// solved for me</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="113682""></a>
  <div class="note">
   <strong class="user">badman</strong>
   <a href="#113682" class="date">15-Nov-2013 07:36</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Many hosters use PHP safe_mode or/and open_basedir, so you can't use CURLOPT_FOLLOWLOCATION. If you try, you see message like this:<br />
CURLOPT_FOLLOWLOCATION cannot be activated when safe_mode is enabled or an open_basedir is set in [you script name &amp; path] on line XXX<br />
<br />
First, I try to use zsalab function (<a href="http://us2.php.net/manual/en/function.curl-setopt.php#102121" rel="nofollow" target="_blank">http://us2.php.net/manual/en/function.curl-setopt.php#102121</a>) from this page, but for some reason it did not work properly. So, I wrote my own.<br />
<br />
It can be use instead of curl_exec. If server HTTP response codes is 30x, function will forward the request as long as the response is not different from 30x (for example, 200 Ok). Also you can use POST.<br />
<br />
function curlExec(/* Array */$curlOptions='', /* Array */$curlHeaders='', /* Array */$postFields='')<br />
{<br />
&nbsp; $newUrl = '';<br />
&nbsp; $maxRedirection = 10;<br />
&nbsp; do<br />
&nbsp; {<br />
&nbsp;&nbsp;&nbsp; if ($maxRedirection&lt;1) die('Error: reached the limit of redirections');<br />
<br />
&nbsp;&nbsp;&nbsp; $ch = curl_init();<br />
&nbsp;&nbsp;&nbsp; if (!empty($curlOptions)) curl_setopt_array($ch, $curlOptions);<br />
&nbsp;&nbsp;&nbsp; if (!empty($curlHeaders)) curl_setopt($ch, CURLOPT_HTTPHEADER, $curlHeaders);<br />
&nbsp;&nbsp;&nbsp; if (!empty($postFields))<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp;&nbsp; curl_setopt($ch, CURLOPT_POST, 1);<br />
&nbsp;&nbsp; &nbsp;&nbsp; curl_setopt($ch, CURLOPT_POSTFIELDS, $postFields);<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; if (!empty($newUrl)) curl_setopt($ch, CURLOPT_URL, $newUrl); // redirect needed<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; $curlResult = curl_exec($ch);<br />
&nbsp;&nbsp;&nbsp; $code = curl_getinfo($ch, CURLINFO_HTTP_CODE);<br />
<br />
&nbsp;&nbsp;&nbsp; if ($code == 301 || $code == 302 || $code == 303 || $code == 307)<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp;&nbsp; preg_match('/Location:(.*?)\n/', $curlResult, $matches);<br />
&nbsp;&nbsp; &nbsp;&nbsp; $newUrl = trim(array_pop($matches));<br />
&nbsp;&nbsp; &nbsp;&nbsp; curl_close($ch);<br />
<br />
&nbsp;&nbsp; &nbsp;&nbsp; $maxRedirection--;<br />
&nbsp;&nbsp; &nbsp;&nbsp; continue;<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; else // no more redirection<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp;&nbsp; $code = 0;<br />
&nbsp;&nbsp; &nbsp;&nbsp; curl_close($ch);<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp; }<br />
&nbsp; while($code);<br />
&nbsp; return $curlResult;<br />
}</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="113029""></a>
  <div class="note">
   <strong class="user">mfuhrman at enetarch dot net</strong>
   <a href="#113029" class="date">21-Aug-2013 08:20</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Here is an example of sending JSON data as via POST.<br />
<br />
index.php<br />
------<br />
$data = array<br />
(<br />
&nbsp; "command" =&gt; "isInstalled", <br />
&nbsp; "params" =&gt; Array<br />
&nbsp; (<br />
&nbsp;&nbsp;&nbsp; "1" =&gt; "3",<br />
&nbsp;&nbsp;&nbsp; "2" =&gt; "4",<br />
&nbsp; )<br />
);<br />
<br />
$data_string = "json=" . json_encode($data) . "&amp;";<br />
$ch = curl_init("<a href="http://localhose/parrot.php" rel="nofollow" target="_blank">http://localhose/parrot.php</a>");<br />
curl_setopt($ch, CURLOPT_POST, true);<br />
curl_setopt($ch, CURLOPT_RETURNTRANSFER, true);<br />
curl_setopt($ch, CURLOPT_POSTFIELDS, $data_string);<br />
$results = curl_exec($ch);<br />
<br />
print ($results);<br />
?&gt;<br />
=====<br />
<br />
parrot.php<br />
------<br />
&lt;?<br />
print_r ($_REQUEST);<br />
?&gt;</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="112326""></a>
  <div class="note">
   <strong class="user">shiplu at programmer dot net</strong>
   <a href="#112326" class="date">02-Jun-2013 03:23</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
CURLOPT_POST should be set before CURLOPT_POSTFIELDS. Otherwise you might encounter 411 Length required error.<br />
<br />
Following code generates "411 Length Required" on nginx/1.1.15<br />
<span class="default">&lt;?php<br />
curl_setopt </span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">, </span><span class="default">CURLOPT_POSTFIELDS</span><span class="keyword">, </span><span class="default">$postfields</span><span class="keyword">); <br />
</span><span class="default">curl_setopt </span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">, </span><span class="default">CURLOPT_POST</span><span class="keyword">, </span><span class="default">1</span><span class="keyword">);<br />
</span><span class="default">?&gt;<br />
</span><br />
But this one works.<br />
<br />
<span class="default">&lt;?php<br />
curl_setopt </span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">, </span><span class="default">CURLOPT_POST</span><span class="keyword">, </span><span class="default">1</span><span class="keyword">);<br />
</span><span class="default">curl_setopt </span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">, </span><span class="default">CURLOPT_POSTFIELDS</span><span class="keyword">, </span><span class="default">$postfields</span><span class="keyword">); <br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="112158""></a>
  <div class="note">
   <strong class="user">Manasi</strong>
   <a href="#112158" class="date">11-May-2013 02:55</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
CURLAUTH_ANY is not an alias for CURLAUTH_NTLM. I had to specify CURLAUTH_NTLM for a Windows authenticated URL</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="112113""></a>
  <div class="note">
   <strong class="user">Madcat</strong>
   <a href="#112113" class="date">07-May-2013 12:14</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If you have a mixture of strings starting with @ (at character) and files in CURLOPT_POSTFIELDS you have a problem (such as posting a tweet with attached media) because curl tries to interpret anything starting with @ as a file.<br />
<br />
<span class="default">&lt;?php<br />
<br />
$postfields </span><span class="keyword">= array(<br />
&nbsp;&nbsp;&nbsp; </span><span class="string">'upload_file' </span><span class="keyword">=&gt; </span><span class="string">'@file_to_upload.png'</span><span class="keyword">,<br />
&nbsp;&nbsp;&nbsp; </span><span class="string">'upload_text' </span><span class="keyword">=&gt; </span><span class="string">'@text_to_upload'<br />
</span><span class="keyword">);<br />
<br />
</span><span class="default">$curl </span><span class="keyword">= </span><span class="default">curl_init</span><span class="keyword">();<br />
</span><span class="default">curl_setopt</span><span class="keyword">(</span><span class="default">$curl</span><span class="keyword">, </span><span class="default">CURLOPT_URL</span><span class="keyword">, </span><span class="string">'<a href="http://example.com/upload-test" rel="nofollow" target="_blank">http://example.com/upload-test</a>'</span><span class="keyword">);<br />
</span><span class="default">curl_setopt</span><span class="keyword">(</span><span class="default">$curl</span><span class="keyword">, </span><span class="default">CURLOPT_POSTFIELDS</span><span class="keyword">, </span><span class="default">$postfields</span><span class="keyword">);<br />
</span><span class="default">curl_exec</span><span class="keyword">(</span><span class="default">$curl</span><span class="keyword">);<br />
</span><span class="default">curl_close</span><span class="keyword">(</span><span class="default">$curl</span><span class="keyword">);<br />
<br />
</span><span class="default">?&gt;<br />
</span><br />
To get around this, prepend the text string with the NULL character like so:<br />
<br />
<span class="default">&lt;?php<br />
&nbsp;&nbsp;&nbsp; $postfields </span><span class="keyword">= array(<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="string">'upload_file' </span><span class="keyword">=&gt; </span><span class="string">'@file_to_upload.png'</span><span class="keyword">,<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="string">'upload_text' </span><span class="keyword">=&gt; </span><span class="default">sprintf</span><span class="keyword">(</span><span class="string">"\0%s"</span><span class="keyword">, </span><span class="string">'@text_to_upload'</span><span class="keyword">)<br />
&nbsp;&nbsp;&nbsp; );<br />
</span><span class="default">?&gt;<br />
</span><br />
Original source: <a href="http://bit.ly/AntMle" rel="nofollow" target="_blank">http://bit.ly/AntMle</a></span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="111978""></a>
  <div class="note">
   <strong class="user">S.F.</strong>
   <a href="#111978" class="date">19-Apr-2013 03:48</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I spent a couple of days trying to upload a file using a curl post.<br />
<br />
The problem I ran into was the filename had an '@' in the middle of it.&nbsp; It turned out that at least on my system if I encoded the file path using the quoted_printable_encode() function the upload works.<br />
<br />
I'm posting this in the hopes that it will help someone else, and for my own future reference.<br />
<br />
Code:<br />
<span class="default">&lt;?php<br />
<br />
$filepath </span><span class="keyword">= </span><span class="string">'/tmp/test@example.txt'</span><span class="keyword">;<br />
</span><span class="default">$postdata</span><span class="keyword">[</span><span class="string">'file'</span><span class="keyword">] = </span><span class="string">'@' </span><span class="keyword">. </span><span class="default">quoted_printable_encode</span><span class="keyword">(</span><span class="default">$filepath</span><span class="keyword">);<br />
<br />
</span><span class="comment">//... supporting code.<br />
<br />
</span><span class="default">$result </span><span class="keyword">= </span><span class="default">curl_exec</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">);<br />
<br />
</span><span class="default">?&gt;<br />
</span>I'm not exactly sure why this works when escaping the '@' doesn't work but it does for me.<br />
<br />
If anyone can offer insight into why this works or a better way to handle the '@' symbol in a filename when using curl to upload I would love to hear it.<br />
<br />
Thanks</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="111975""></a>
  <div class="note">
   <strong class="user">dardyole at hotmail dot com</strong>
   <a href="#111975" class="date">19-Apr-2013 01:29</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Another note addressing the issues with servers that have open_basedir and safe mode turned on. Such an issue spawns the following E_WARNING:<br />
<br />
Warning: curl_setopt() [function.curl-setopt]: CURLOPT_FOLLOWLOCATION cannot be activated when safe_mode is enabled or an open_basedir is set<br />
<br />
After looking through the notes, most of the proposed manual implementations were kind of clunky and in some cases just didn't work at all. Most importantly (in my case), was the behaviour of the 302 Header. Anyway, here's the code I ended up using which has worked well for me in all cases so far, it even addresses the issue that caused FOLLOWLOCATION to be turned off in some cases :)<br />
<br />
EDIT: Unfortunately the code itself is deemed "too long" for PHP's note system. I've uploaded it to a few paste sites below so hopefully the links will live for a while at least.<br />
<br />
<a href="http://pastebin.com/aaJtPy1j" rel="nofollow" target="_blank">http://pastebin.com/aaJtPy1j</a><br />
<a href="http://pastie.org/7646116" rel="nofollow" target="_blank">http://pastie.org/7646116</a><br />
<br />
Use it as a replacement for curl_exec. For example:<br />
<br />
<span class="default">&lt;?php<br />
$ch </span><span class="keyword">= </span><span class="default">curl_init</span><span class="keyword">(</span><span class="string">"<a href="http://php.net" rel="nofollow" target="_blank">http://php.net</a>"</span><span class="keyword">);<br />
</span><span class="default">var_dump</span><span class="keyword">(</span><span class="default">curl_exec_follow</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">, </span><span class="default">9001</span><span class="keyword">));<br />
</span><span class="default">curl_close</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">);<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="111696""></a>
  <div class="note">
   <strong class="user">xuyan83121 at gmail dot com</strong>
   <a href="#111696" class="date">18-Mar-2013 02:54</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
when use curl_multi_exec, the CURLOPT_TIMEOUT need curl version newer than 7.21.2.<br />
this can be found at curl changelog.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="110473""></a>
  <div class="note">
   <strong class="user">m at mar dot lt</strong>
   <a href="#110473" class="date">26-Oct-2012 12:06</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Be careful when changing CURLOPT_SSL_VERIFYHOST or other options to true (boolean). It may cause insecure behavior [1]<br />
<br />
This is because boolean true casts into integer 1, and CURLOPT_SSL_VERIFYHOST = 1 is not secure behavior.<br />
<br />
[1] Martin Georgiev and Subodh Iyengar and Suman Jana and Rishita Anubhai and Dan Boneh and Vitaly Shmatikov, The most dangerous code in the world: validating SSL certificates in non-browser software, ACM CCS '12, pp. 38-49, 2012</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="110457""></a>
  <div class="note">
   <strong class="user">rmckay at webaware dot com dot au</strong>
   <a href="#110457" class="date">24-Oct-2012 09:21</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Please everyone, stop setting CURLOPT_SSL_VERIFYPEER to false or 0. If your PHP installation doesn't have an up-to-date CA root certificate bundle, download the one at the curl website and save it on your server:<br />
<br />
<a href="http://curl.haxx.se/docs/caextract.html" rel="nofollow" target="_blank">http://curl.haxx.se/docs/caextract.html</a><br />
<br />
Then set a path to it in your php.ini file, e.g. on Windows:<br />
<br />
curl.cainfo=c:\php\cacert.pem<br />
<br />
Turning off CURLOPT_SSL_VERIFYPEER allows man in the middle (MITM) attacks, which you don't want!</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="110442""></a>
  <div class="note">
   <strong class="user">regan dot corey at gmail dot com</strong>
   <a href="#110442" class="date">23-Oct-2012 07:22</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I spent a couple of days trying to POST a multi-dimensional array of form fields, including a file upload, to a remote server to update a product. Here are the breakthroughs that FINALLY allowed the script to run as desired.<br />
<br />
Firstly, the HTML form used input names like these:<br />
&lt;input type="text" name="product[name]" /&gt;<br />
&lt;input type="text" name="product[cost]" /&gt;<br />
&lt;input type="file" name="product[thumbnail]" /&gt;<br />
in conjunction with two other form inputs not part of the product array<br />
&lt;input type="text" name="method" value="put" /&gt;<br />
&lt;input type="text" name="mode" /&gt;<br />
<br />
I used several cURL options, but the only two (other than URL) that mattered were:<br />
curl_setopt($handle, CURLOPT_POST, true);<br />
curl_setopt($handle, CURLOPT_POSTFIELDS, $postfields);<br />
Pretty standard so far.<br />
Note: headers didn't need to be set, cURL automatically sets headers (like content-type: multipart/form-data; content-length...) when you pass an array into CURLOPT_POSTFIELDS.<br />
Note: even though this is supposed to be a PUT command through an HTTP POST form, no special PUT options needed to be passed natively through cURL. Options such as<br />
curl_setopt($handle, CURLOPT_HTTPHEADER, array('X-HTTP-Method-Override: PUT', 'Content-Length: ' . strlen($fields)));<br />
or<br />
curl_setopt($handle, CURLOPT_PUT, true);<br />
or<br />
curl_setopt($handle, CURLOPT_CUSTOMREQUEST, "PUT);<br />
were not needed to make the code work.<br />
<br />
The fields I wanted to pass through cURL were arranged into an array something like this:<br />
$postfields = array("method" =&gt; $_POST["method"],<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; "mode" =&gt; $_POST["mode"],<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; "product" =&gt; array("name" =&gt; $_POST["product"], <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; "cost" =&gt; $_POST["product"]["cost"], <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; "thumbnail" =&gt; "@{$_FILES["thumbnail"]["tmp_name"]};type={$_FILES["thumbnail"]["type"]}")<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; );<br />
<br />
-Notice how the @ precedes the temporary filename, this creates a link so PHP will upload/transfer an actual file instead of just the file name, which would happen if the @ isn't included.<br />
-Notice how I forcefully set the mime-type of the file to upload. I was having issues where images filetypes were defaulting to octet-stream instead of image/png or image/jpeg or whatever the type of the selected image.<br />
<br />
I then tried passing $postfields straight into curl_setopt($this-&gt;handle, CURLOPT_POSTFIELDS, $postfields); but it didn't work.<br />
I tried using http_build_query($postfields); but that didn't work properly either.<br />
In both cases either the file wouldn't be treated as an actual file and the form data wasn't being sent properly. The problem was HTTP's methods of transmitting arrays. While PHP and other languages can figure out how to handle arrays passed via forms, HTTP isn't quite as sofisticated. I had to rewrite the $postfields array like so:<br />
$postfields = array("method" =&gt; $_POST["method"],<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; "mode" =&gt; $_POST["mode"],<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; "product[name]" =&gt; $_POST["product"], <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; "product[cost]" =&gt; $_POST["product"]["cost"], <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; "product[thumbnail]" =&gt; "@{$_FILES["thumbnail"]["tmp_name"]}");<br />
curl_setopt($handle, CURLOPT_POSTFIELDS, $postfields);<br />
<br />
This, without the use of http_build_query, solved all of my problems. Now the receiving host outputs both $_POST and $_FILES vars correctly.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="110417""></a>
  <div class="note">
   <strong class="user">miloshio at gmail dot com</strong>
   <a href="#110417" class="date">20-Oct-2012 09:06</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Remember: <br />
<br />
- 'Server-side' cookies exists as information even before they were set on browser agent(HTTP COOKIE HEADER),<br />
- javascript cookies does NOT exists as information before they were set on browser agent,<br />
<br />
so, if you're trying to save cookies using CURLOPT_COOKIEJAR to a local file, that cookie must be server - side cookie, otherwise you are wasting time, javascript-produced cookies only exists when client browser's JS interpreter set them.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="110162""></a>
  <div class="note">
   <strong class="user">juozaspo at gmail dot com</strong>
   <a href="#110162" class="date">25-Sep-2012 05:47</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I've created an example that gets the file on url passed to script and outputs it to the browser. <br />
<br />
<span class="default">&lt;?php<br />
</span><span class="comment">//get the file (e.g. image) and output it to the browser<br />
</span><span class="default">$ch </span><span class="keyword">= </span><span class="default">curl_init</span><span class="keyword">(); </span><span class="comment">//open curl handle<br />
</span><span class="default">curl_setopt</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">, </span><span class="default">CURLOPT_URL</span><span class="keyword">, </span><span class="default">$_GET</span><span class="keyword">[</span><span class="string">'url'</span><span class="keyword">]); </span><span class="comment">//set an url<br />
</span><span class="default">curl_setopt</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">, </span><span class="default">CURLOPT_RETURNTRANSFER</span><span class="keyword">, </span><span class="default">1</span><span class="keyword">); </span><span class="comment">//do not output directly, use variable<br />
</span><span class="default">curl_setopt</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">, </span><span class="default">CURLOPT_BINARYTRANSFER</span><span class="keyword">, </span><span class="default">1</span><span class="keyword">); </span><span class="comment">//do a binary transfer<br />
</span><span class="default">curl_setopt</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">, </span><span class="default">CURLOPT_FAILONERROR</span><span class="keyword">, </span><span class="default">1</span><span class="keyword">); </span><span class="comment">//stop if an error occurred<br />
</span><span class="default">$file</span><span class="keyword">=</span><span class="default">curl_exec</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">); </span><span class="comment">//store the content in variable<br />
</span><span class="keyword">if(!</span><span class="default">curl_errno</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">))<br />
{<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">//send out headers and output<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">header </span><span class="keyword">(</span><span class="string">"Content-type: "</span><span class="keyword">.</span><span class="default">curl_getinfo</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">, </span><span class="default">CURLINFO_CONTENT_TYPE</span><span class="keyword">).</span><span class="string">""</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">header </span><span class="keyword">(</span><span class="string">"Content-Length: "</span><span class="keyword">.</span><span class="default">curl_getinfo</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">, </span><span class="default">CURLINFO_CONTENT_LENGTH_DOWNLOAD</span><span class="keyword">).</span><span class="string">""</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; echo </span><span class="default">$file</span><span class="keyword">;<br />
} else echo </span><span class="string">'Curl error: ' </span><span class="keyword">. </span><span class="default">curl_error</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">);<br />
</span><span class="default">curl_close</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">); </span><span class="comment">//close curl handle<br />
</span><span class="default">?&gt;<br />
</span><br />
p.s. Make sure that there're no new lines before and after code or script may not work.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="109634""></a>
  <div class="note">
   <strong class="user">qeremy [atta] gmail [dotta] com</strong>
   <a href="#109634" class="date">03-Aug-2012 05:57</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If you are trying to update something on your server and you need to handle this update operation by PUT;<br />
<br />
<span class="default">&lt;?php<br />
curl_setopt</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">, </span><span class="default">CURLOPT_CUSTOMREQUEST</span><span class="keyword">, </span><span class="string">"PUT"</span><span class="keyword">);<br />
</span><span class="default">curl_setopt</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">, </span><span class="default">CURLOPT_PUT</span><span class="keyword">, </span><span class="default">1</span><span class="keyword">);<br />
</span><span class="default">?&gt;<br />
</span><br />
are "useless" without;<br />
<br />
<span class="default">&lt;?php<br />
curl_setopt</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">, </span><span class="default">CURLOPT_HTTPHEADER</span><span class="keyword">, array(</span><span class="string">'X-HTTP-Method-Override: PUT'</span><span class="keyword">));<br />
</span><span class="default">?&gt;<br />
</span><br />
Example;<br />
<br />
Updating a book data in database identified by "id 1";<br />
<br />
--cURL Part--<br />
<span class="default">&lt;?php<br />
$data </span><span class="keyword">= </span><span class="default">http_build_query</span><span class="keyword">(</span><span class="default">$_POST</span><span class="keyword">);<br />
</span><span class="comment">// or<br />
</span><span class="default">$data </span><span class="keyword">= </span><span class="default">http_build_query</span><span class="keyword">(array(<br />
&nbsp;&nbsp; </span><span class="string">'name'&nbsp; </span><span class="keyword">=&gt; </span><span class="string">'PHP in Action'</span><span class="keyword">,<br />
&nbsp;&nbsp; </span><span class="string">'price' </span><span class="keyword">=&gt; </span><span class="default">10.9<br />
</span><span class="keyword">));<br />
<br />
</span><span class="default">$ch </span><span class="keyword">= </span><span class="default">curl_init</span><span class="keyword">();<br />
</span><span class="default">curl_setopt</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">, </span><span class="default">CURLOPT_URL</span><span class="keyword">, </span><span class="string">"<a href="http://api.localhost/rest/books/1" rel="nofollow" target="_blank">http://api.localhost/rest/books/1</a>"</span><span class="keyword">);<br />
</span><span class="default">curl_setopt</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">, </span><span class="default">CURLOPT_RETURNTRANSFER</span><span class="keyword">, </span><span class="default">1</span><span class="keyword">);<br />
</span><span class="comment">// curl_setopt($ch, CURLOPT_CUSTOMREQUEST, "PUT"); // no need anymore<br />
// or<br />
// curl_setopt($ch, CURLOPT_PUT, 1); // no need anymore<br />
</span><span class="default">curl_setopt</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">, </span><span class="default">CURLOPT_HTTPHEADER</span><span class="keyword">, array(</span><span class="string">'X-HTTP-Method-Override: PUT'</span><span class="keyword">));<br />
</span><span class="default">curl_setopt</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">, </span><span class="default">CURLOPT_POSTFIELDS</span><span class="keyword">, </span><span class="default">$data</span><span class="keyword">);<br />
</span><span class="default">$ce </span><span class="keyword">= </span><span class="default">curl_exec</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">);<br />
</span><span class="default">curl_close</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">);<br />
</span><span class="default">print_r</span><span class="keyword">(</span><span class="default">$ce</span><span class="keyword">);<br />
</span><span class="default">?&gt;<br />
</span><br />
--API class--<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">public function </span><span class="default">putAction</span><span class="keyword">() {<br />
&nbsp;&nbsp;&nbsp; echo </span><span class="string">"putAction() -&gt; id: "</span><span class="keyword">. </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">_getParam</span><span class="keyword">(</span><span class="string">'id'</span><span class="keyword">) .</span><span class="string">"\n"</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">print_r</span><span class="keyword">(</span><span class="default">$_POST</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">// do stuff with post data<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">...<br />
</span><span class="default">?&gt;<br />
</span><br />
--Output--<br />
putAction() -&gt; id: 15<br />
Array<br />
(<br />
&nbsp;&nbsp;&nbsp; [name] =&gt; PHP in Action<br />
&nbsp;&nbsp;&nbsp; [price] =&gt; 10.9<br />
)<br />
<br />
---Keywords--<br />
rest, restfull api, restfull put, curl put, curl customrequest put</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="109319""></a>
  <div class="note">
   <strong class="user">adrian at foeder dot de</strong>
   <a href="#109319" class="date">06-Jul-2012 04:37</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
if you want to do a GET request with additional body data it will become tricky not to implicitly change the request to a POST, like many notes below correctly state.<br />
So to do the analogy of command line's<br />
<br />
curl -XGET '<a href="http://example.org?foo=bar" rel="nofollow" target="_blank">http://example.org?foo=bar</a>' -d '&lt;baz&gt;some additional data&lt;/baz&gt;'<br />
<br />
in PHP you'll do, besides your other necessary stuff,<br />
<br />
<span class="default">&lt;?php<br />
&nbsp;&nbsp;&nbsp; curl_setopt</span><span class="keyword">(</span><span class="default">$curlHandle</span><span class="keyword">, </span><span class="default">CURLOPT_CUSTOMREQUEST</span><span class="keyword">, </span><span class="string">'GET'</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">curl_setopt</span><span class="keyword">(</span><span class="default">$curlHandle</span><span class="keyword">, </span><span class="default">CURLOPT_POSTFIELDS</span><span class="keyword">, </span><span class="string">'&lt;baz&gt;some additional data&lt;/baz&gt;'</span><span class="keyword">);<br />
</span><span class="default">?&gt;<br />
</span><br />
during my experiments, every other "similar" way, like e.g. CURLOPT_HTTPGET, didn't send the additional data or fell into POST.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="108881""></a>
  <div class="note">
   <strong class="user">coding query</strong>
   <a href="#108881" class="date">01-Jun-2012 02:52</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Sometimes we want to extract the HTML content of the remote website page, this technique is called as HTML scrapper. This article will discuss on how we can extract the HTML content of the remote webpage.<br />
We can achieve HTML scrapper operation in 2 step operation:<br />
Call to Remote Web Page and extract the HTML content.<br />
Match the HTML tags using Regular Expression.<br />
Call to Remote Web Page using PHP:<br />
In PHP there are various ways we can call the remote webpage. But here we will be using CURL to achieve our operation.<br />
<br />
<span class="default">&lt;?php<br />
$ch </span><span class="keyword">= </span><span class="default">curl_init</span><span class="keyword">();<br />
</span><span class="default">$timeout </span><span class="keyword">= </span><span class="default">5</span><span class="keyword">; </span><span class="comment">// set to zero for no timeout<br />
</span><span class="default">curl_setopt </span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">, </span><span class="default">CURLOPT_URL</span><span class="keyword">, </span><span class="default">$url</span><span class="keyword">);<br />
</span><span class="default">curl_setopt </span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">, </span><span class="default">CURLOPT_RETURNTRANSFER</span><span class="keyword">, </span><span class="default">1</span><span class="keyword">);<br />
</span><span class="default">curl_setopt </span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">, </span><span class="default">CURLOPT_CONNECTTIMEOUT</span><span class="keyword">, </span><span class="default">$timeout</span><span class="keyword">);<br />
</span><span class="default">$file_contents </span><span class="keyword">= </span><span class="default">curl_exec</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">);<br />
</span><span class="default">curl_close</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">);<br />
<br />
&nbsp;</span><span class="default">preg_match_all</span><span class="keyword">(</span><span class="string">'/&lt;span&gt;[\\/\\(\\)-:&lt;&gt;\\w\\s]+&lt; \\/span&gt;/'</span><span class="keyword">,</span><span class="default">$file_contents</span><span class="keyword">,</span><span class="default">$htmlContent</span><span class="keyword">);<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="108583""></a>
  <div class="note">
   <strong class="user">jeffb at nospam dot videx dot com</strong>
   <a href="#108583" class="date">09-May-2012 07:53</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
When trying to pass a multi-dimensional array to CURLOPT_POSTFIELDS, first run it through http_build_query().&nbsp; That will get rid of the Array to String conversion notice.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="108333""></a>
  <div class="note">
   <strong class="user">Joey Hewitt</strong>
   <a href="#108333" class="date">18-Apr-2012 07:52</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Note that if you put a certificate chain in a PEM file, the certificates need to be ordered so that each certificate is followed by its issuer (i.e., root last.)<br />
<br />
Source: <a href="http://publib.boulder.ibm.com/tividd/td/ITIM/SC32-1493-00/en_US/HTML/im451_config09.htm" rel="nofollow" target="_blank">http://publib.boulder.ibm.com/tividd/td/ITIM/SC32-1493-00/en_US/HTML/im451_config09.htm</a></span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="108195""></a>
  <div class="note">
   <strong class="user">ellert at _removeme_ vankoperen dot nl</strong>
   <a href="#108195" class="date">06-Apr-2012 10:41</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If you are using curl to do a soap request and consistently get the following error back: <br />
The server cannot service the request because the media type is unsupported.<br />
You are sending the Content-type of soap 1.2 to a 1.1 server.<br />
Soap 1.1 needs Content-Type: text/xml;<br />
Soap 1.2 should have Content-Type: application/soap+xml;</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="108162""></a>
  <div class="note">
   <strong class="user">anonymous</strong>
   <a href="#108162" class="date">04-Apr-2012 12:55</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
This may be not obvious, but if you specify the CURLOPT_POSTFIELDS and don't specify the CURLOPT_POST - it will still send POST, not GET (as you might think - since GET is default).<br />
So the line:<br />
<br />
curl_setopt($ch, CURLOPT_POSTFIELDS, $data);<br />
<br />
is synonym to:<br />
<br />
curl_setopt($ch, CURLOPT_POST, 1);<br />
curl_setopt($ch, CURLOPT_POSTFIELDS, $data);<br />
<br />
Even if you set the options like this (in this order):<br />
<br />
curl_setopt($ch, CURLOPT_POST, 0);<br />
curl_setopt($ch, CURLOPT_POSTFIELDS, $data);<br />
<br />
it will send POST, since CURLOPT_POSTFIELDS is latter.<br />
So if you want GET - make sure you don't have CURLOPT_POSTFIELDS specified somewhere.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="108137""></a>
  <div class="note">
   <strong class="user">mw+php dot net at lw-systems dot de</strong>
   <a href="#108137" class="date">01-Apr-2012 03:45</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
The description of the use of the CURLOPT_POSTFIELDS option should be emphasize, that using POST with HTTP/1.1 with cURL implies the use of a "Expect: 100-continue" header. Some web servers will not understand the handling of chunked transfer of post data.<br />
<br />
To disable this behavior one must disable the use of the "Expect:" header with<br />
<br />
&nbsp;&nbsp;&nbsp; curl_setopt($ch, CURLOPT_HTTPHEADER,array("Expect:"));</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="107739""></a>
  <div class="note">
   <strong class="user">dotpointer at gmail dot com</strong>
   <a href="#107739" class="date">01-Mar-2012 05:48</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
About CURLOPT_COOKIEJAR and CURLOPT_COOKIEFILE, and which / how to use.<br />
<br />
- CURLOPT_COOKIEJAR is used when cURL is reading cookie data from disk.<br />
<br />
- CURLOPT_COOKIEFILE is used when cURL is writing the cookie data to disk.<br />
<br />
So you need to specify both (and set the same file location on both) when working with sessions for example.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="107667""></a>
  <div class="note">
   <strong class="user">wonderfish+php at gmail dot com</strong>
   <a href="#107667" class="date">25-Feb-2012 09:22</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
As of at least PHP 5.3.9, if you are continuing to use a cURL session handle after downloading a file and closing the file handle, you will need to change CURLOPT_FILE back to stdout, and cannot count simply on a side effect of CURLOPT_RETURNTRANSFER to do so, even if you are setting it.&nbsp; For example:<br />
<br />
<span class="default">&lt;?php<br />
$ch </span><span class="keyword">= </span><span class="default">curl_init</span><span class="keyword">();<br />
</span><span class="default">$fh </span><span class="keyword">= </span><span class="default">fopen</span><span class="keyword">(</span><span class="string">'/path/to/stored/file/example_file.dat'</span><span class="keyword">, </span><span class="string">'w'</span><span class="keyword">);<br />
</span><span class="default">curl_setopt</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">, </span><span class="default">CURLOPT_FILE</span><span class="keyword">, </span><span class="default">$fh</span><span class="keyword">);<br />
</span><span class="default">curl_setopt</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">, </span><span class="default">CURLOPT_URL</span><span class="keyword">, </span><span class="string">'<a href="http://example.com/example_file.dat" rel="nofollow" target="_blank">http://example.com/example_file.dat</a>'</span><span class="keyword">);<br />
</span><span class="default">curl_exec</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">);<br />
</span><span class="default">fflush</span><span class="keyword">(</span><span class="default">$fh</span><span class="keyword">);<br />
</span><span class="default">fclose</span><span class="keyword">(</span><span class="default">$fh</span><span class="keyword">);<br />
<br />
</span><span class="comment">//must reset cURL file handle. Not doing so will cause a warning to be<br />
//thrown and for cURL to default to output regardless<br />
//for our example, we'll set return transfer.<br />
</span><span class="default">curl_setopt</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">, </span><span class="default">CURLOPT_FILE</span><span class="keyword">, </span><span class="default">fopen</span><span class="keyword">(</span><span class="string">'php://stdout'</span><span class="keyword">, </span><span class="string">'w'</span><span class="keyword">));<br />
</span><span class="default">curl_setopt</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">, </span><span class="default">CURLOPT_RETURNTRANSFER</span><span class="keyword">, </span><span class="default">TRUE</span><span class="keyword">);<br />
</span><span class="default">curl_setopt</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">, </span><span class="default">CURLOPT_URL</span><span class="keyword">, </span><span class="string">'<a href="http://example.org/index.html" rel="nofollow" target="_blank">http://example.org/index.html</a>'</span><span class="keyword">);<br />
</span><span class="default">$html </span><span class="keyword">= </span><span class="default">curl_exec</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">); </span><span class="comment">//this will now work<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="107621""></a>
  <div class="note">
   <strong class="user">dotpointer at gmail dot com</strong>
   <a href="#107621" class="date">22-Feb-2012 10:13</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I noted something when using CURLOPT_POSTFIELDS in combination with arrays from PHP.<br />
<br />
You may supply an array, but there may not be any sub-arrays in this array, as this will give Array-to-string-conversion notice.<br />
<br />
Example:<br />
<br />
<span class="default">&lt;?php<br />
$ch </span><span class="keyword">= </span><span class="default">curl_init</span><span class="keyword">();<br />
<br />
</span><span class="comment"># this works<br />
</span><span class="default">$data </span><span class="keyword">= array(</span><span class="string">'name' </span><span class="keyword">=&gt; </span><span class="string">'value'</span><span class="keyword">);<br />
<br />
</span><span class="comment"># this gives "Notice: Array to string conversion..."<br />
</span><span class="default">$data </span><span class="keyword">= array(</span><span class="string">'name' </span><span class="keyword">=&gt; array(</span><span class="string">'subname' </span><span class="keyword">=&gt; </span><span class="string">'subvalue'</span><span class="keyword">));<br />
<br />
</span><span class="default">curl_setopt</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">, </span><span class="default">CURLOPT_URL</span><span class="keyword">, </span><span class="string">'<a href="http://localhost/test.php" rel="nofollow" target="_blank">http://localhost/test.php</a>'</span><span class="keyword">);<br />
</span><span class="default">curl_setopt</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">, </span><span class="default">CURLOPT_POST</span><span class="keyword">, </span><span class="default">1</span><span class="keyword">);<br />
</span><span class="default">curl_setopt</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">, </span><span class="default">CURLOPT_POSTFIELDS</span><span class="keyword">, </span><span class="default">$data</span><span class="keyword">);<br />
<br />
</span><span class="default">curl_exec</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">);<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="107546""></a>
  <div class="note">
   <strong class="user">v dot tverdun at gmail dot com</strong>
   <a href="#107546" class="date">17-Feb-2012 01:00</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Make sure to set keys for array if passing to CURLOPT_POSTFIELDS.<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="comment">//This can cause errors<br />
</span><span class="default">$data </span><span class="keyword">= array(</span><span class="string">'bar'</span><span class="keyword">);<br />
<br />
</span><span class="comment">//Use this instead<br />
</span><span class="default">$data </span><span class="keyword">= array(</span><span class="string">'foo' </span><span class="keyword">=&gt; </span><span class="string">'bar'</span><span class="keyword">);<br />
<br />
</span><span class="default">curl_setopt</span><span class="keyword">(</span><span class="default">CURLOPT_POSTFIELDS</span><span class="keyword">, </span><span class="default">$data</span><span class="keyword">);<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="107314""></a>
  <div class="note">
   <strong class="user">Tim Severien</strong>
   <a href="#107314" class="date">30-Jan-2012 08:51</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I've been stuck when using the CURLOPT_CONNECTTIMEOUT_MS constant. In fact, on my PHP version (5.3.1) it's not a number but rather a string. Same thing for CURLOPT_TIMEOUT_MS.<br />
<br />
I got this error: Warning: curl_setopt() expects parameter 2 to be long, string given<br />
<br />
If you are experiencing simular problems, you can replace the constant with the actual number or (re)define the constant.<br />
<br />
CURLOPT_TIMEOUT_MS should be 155<br />
CURLOPT_CONNECTTIMEOUT_MS should be 156<br />
<br />
curl_setopt($ch, CURLOPT_CONNECTTIMEOUT_MS, 2500); // error<br />
curl_setopt($ch, 156, 2500); // problem solved</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="107146""></a>
  <div class="note">
   <strong class="user">Adam Monsen</strong>
   <a href="#107146" class="date">11-Jan-2012 01:36</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
CURLOPT_POST must be left unset if you want the Content-Type header set to "multipart/form-data" (e.g., when CURLOPT_POSTFIELDS is an array). If you set CURLOPT_POSTFIELDS to an array and have CURLOPT_POST set to TRUE, Content-Length will be -1 and most sane servers will reject the request. If you set CURLOPT_POSTFIELDS to an array and have CURLOPT_POST set to FALSE, cURL will send a GET request.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="106891""></a>
  <div class="note">
   <strong class="user">chsa at ten dot ch</strong>
   <a href="#106891" class="date">16-Dec-2011 10:39</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Sending a post file upload across a squid proxy, the request was rejected by the proxy. In the error page returned it provided among other possible causes:"Expect:" feature is being asked from a HTTP/one.zero.<br />
Solution: Add the option <span class="default">&lt;?php curl_setopt</span><span class="keyword">(</span><span class="default">$cl</span><span class="keyword">,</span><span class="default">CURLOPT_HTTPHEADER</span><span class="keyword">,array(</span><span class="string">"Expect:"</span><span class="keyword">)); </span><span class="default">?&gt;</span>. This will remove the expect http header.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="104597""></a>
  <div class="note">
   <strong class="user">Steve Kamerman</strong>
   <a href="#104597" class="date">24-Jun-2011 08:47</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If you want cURL to timeout in less than one second, you can use CURLOPT_TIMEOUT_MS, although there is a bug/"feature"&nbsp; on "Unix-like systems" that causes libcurl to timeout immediately if the value is &lt; 1000 ms with the error "cURL Error (28): Timeout was reached".&nbsp; The explanation for this behavior is:<br />
<br />
"If libcurl is built to use the standard system name resolver, that portion of the transfer will still use full-second resolution for timeouts with a minimum timeout allowed of one second."<br />
<br />
What this means to PHP developers is "You can use this function without testing it first, because you can't tell if libcurl is using the standard system name resolver (but you can be pretty sure it is)"<br />
<br />
The problem is that on (Li|U)nix, when libcurl uses the standard name resolver, a SIGALRM is raised during name resolution which libcurl thinks is the timeout alarm.<br />
<br />
The solution is to disable signals using CURLOPT_NOSIGNAL.&nbsp; Here's an example script that requests itself causing a 10-second delay so you can test timeouts:<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">if (!isset(</span><span class="default">$_GET</span><span class="keyword">[</span><span class="string">'foo'</span><span class="keyword">])) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// Client<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$ch </span><span class="keyword">= </span><span class="default">curl_init</span><span class="keyword">(</span><span class="string">'<a href="http://localhost/test/test_timeout.php?foo=bar" rel="nofollow" target="_blank">http://localhost/test/test_timeout.php?foo=bar</a>'</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">curl_setopt</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">, </span><span class="default">CURLOPT_RETURNTRANSFER</span><span class="keyword">, </span><span class="default">true</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">curl_setopt</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">, </span><span class="default">CURLOPT_NOSIGNAL</span><span class="keyword">, </span><span class="default">1</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">curl_setopt</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">, </span><span class="default">CURLOPT_TIMEOUT_MS</span><span class="keyword">, </span><span class="default">200</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$data </span><span class="keyword">= </span><span class="default">curl_exec</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$curl_errno </span><span class="keyword">= </span><span class="default">curl_errno</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$curl_error </span><span class="keyword">= </span><span class="default">curl_error</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">curl_close</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">);<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">$curl_errno </span><span class="keyword">&gt; </span><span class="default">0</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; echo </span><span class="string">"cURL Error (</span><span class="default">$curl_errno</span><span class="string">): </span><span class="default">$curl_error</span><span class="string">\n"</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; } else {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; echo </span><span class="string">"Data received: </span><span class="default">$data</span><span class="string">\n"</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
} else {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// Server<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">sleep</span><span class="keyword">(</span><span class="default">10</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; echo </span><span class="string">"Done."</span><span class="keyword">;<br />
}<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="104387""></a>
  <div class="note">
   <strong class="user">m dot ghadam at gmail dot com</strong>
   <a href="#104387" class="date">13-Jun-2011 11:02</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
When you set ($ch, curlopt_post, 1) , after you have posted your data with curl_exec , you need to set ($ch, curlopt_post, 0), Otherwise all your subsequent requests seems as a post with no postdata and some reverse proxy servers send 500 or 403 error for these case ( access denied or forbidden )!</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="103232""></a>
  <div class="note">
   <strong class="user">PHP at RHaworth dot net</strong>
   <a href="#103232" class="date">02-Apr-2011 11:31</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
When CURLOPT_FOLLOWLOCATION and CURLOPT_HEADER are both true and redirect/s have happened then the header returned by curl_exec() will contain all the headers in the redirect chain in the order they were encountered.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="102793""></a>
  <div class="note">
   <strong class="user">support at lostair dot com</strong>
   <a href="#102793" class="date">07-Mar-2011 12:26</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Force Curl Request To Go To A Particular IP Address<br />
<br />
Yes, there is a method of passing an IP address to curl.&nbsp; Excellent for services with multiple IP addresses and also to take DNS out of the equation for testing/debugging.<br />
<br />
<span class="default">&lt;?php<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">function </span><span class="default">fetch_page</span><span class="keyword">(</span><span class="default">$url</span><span class="keyword">, </span><span class="default">$host_ip </span><span class="keyword">= </span><span class="default">NULL</span><span class="keyword">)<br />
&nbsp;&nbsp;&nbsp; {<br />
<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="default">$ch </span><span class="keyword">= </span><span class="default">curl_init</span><span class="keyword">();<br />
<br />
&nbsp;&nbsp; &nbsp;&nbsp; if (!</span><span class="default">is_null</span><span class="keyword">(</span><span class="default">$host_ip</span><span class="keyword">))<br />
&nbsp;&nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$urldata </span><span class="keyword">= </span><span class="default">parse_url</span><span class="keyword">(</span><span class="default">$url</span><span class="keyword">);<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">//&nbsp; Ensure we have the query too, if there is any...<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">if (!empty(</span><span class="default">$urldata</span><span class="keyword">[</span><span class="string">'query'</span><span class="keyword">]))<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$urldata</span><span class="keyword">[</span><span class="string">'path'</span><span class="keyword">] .= </span><span class="string">"?"</span><span class="keyword">.</span><span class="default">$urldata</span><span class="keyword">[</span><span class="string">'query'</span><span class="keyword">];<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">//&nbsp; Specify the host (name) we want to fetch...<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$headers </span><span class="keyword">= array(</span><span class="string">"Host: "</span><span class="keyword">.</span><span class="default">$urldata</span><span class="keyword">[</span><span class="string">'host'</span><span class="keyword">]);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">curl_setopt</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">, </span><span class="default">CURLOPT_HTTPHEADER</span><span class="keyword">, </span><span class="default">$headers</span><span class="keyword">);<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">//&nbsp; create the connecting url (with the hostname replaced by IP)<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$url </span><span class="keyword">= </span><span class="default">$urldata</span><span class="keyword">[</span><span class="string">'scheme'</span><span class="keyword">].</span><span class="string">"://"</span><span class="keyword">.</span><span class="default">$host_ip</span><span class="keyword">.</span><span class="default">$urldata</span><span class="keyword">[</span><span class="string">'path'</span><span class="keyword">];<br />
&nbsp;&nbsp; &nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="default">curl_setopt</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">,&nbsp; </span><span class="default">CURLOPT_URL</span><span class="keyword">, </span><span class="default">$url</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="default">curl_setopt </span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">, </span><span class="default">CURLOPT_HEADER</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="default">curl_setopt</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">,&nbsp; </span><span class="default">CURLOPT_RETURNTRANSFER</span><span class="keyword">, </span><span class="default">true</span><span class="keyword">);<br />
<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="default">$result </span><span class="keyword">= </span><span class="default">curl_exec </span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="default">curl_close </span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">);<br />
<br />
&nbsp;&nbsp; &nbsp;&nbsp; return </span><span class="default">$result</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="102519""></a>
  <div class="note">
   <strong class="user">S\</strong>
   <a href="#102519" class="date">18-Feb-2011 08:04</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
When using CURLOPT_POSTFIELDS with an array as parameter, you have to pay high attention to user input. Unvalidated user input will lead to serious security issues.<br />
<br />
<span class="default">&lt;?php<br />
<br />
</span><span class="comment">/**<br />
&nbsp;* test.php:<br />
&nbsp;*/<br />
</span><span class="default">$ch </span><span class="keyword">= </span><span class="default">curl_init</span><span class="keyword">(</span><span class="string">'<a href="http://example.com" rel="nofollow" target="_blank">http://example.com</a>'</span><span class="keyword">);<br />
<br />
</span><span class="default">curl_setopt</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">, </span><span class="default">CURLOPT_POST</span><span class="keyword">, </span><span class="default">1</span><span class="keyword">);<br />
</span><span class="default">curl_setopt</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">, </span><span class="default">CURLOPT_POSTFIELDS</span><span class="keyword">, array(<br />
&nbsp;&nbsp;&nbsp; </span><span class="string">'foo' </span><span class="keyword">=&gt; </span><span class="default">$_GET</span><span class="keyword">[</span><span class="string">'bar'</span><span class="keyword">]<br />
));<br />
<br />
</span><span class="default">curl_exec</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">);<br />
<br />
</span><span class="default">?&gt;<br />
</span><br />
Requesting "test.php?bar=@/home/user/test.png" will send "test.png" to example.com. <br />
Make sure you remove the leading "@" from user input.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="102264""></a>
  <div class="note">
   <strong class="user">anon@mouse dot com</strong>
   <a href="#102264" class="date">04-Feb-2011 07:11</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If your POST data seems to be disappearing (POST data empty, request is being handled by the server as a GET), try rearranging the order of CURLOPT_POSTFIELDS setting with CURLOPT_NOBODY. CURLOPT_POSTFIELDS has to come AFTER CURLOPT_NOBODY setting because if it comes after it wipes out the Content-Type header that tells your URL target that the request is a POST not a GET. <br />
<br />
Not sure if this is expected behavior but it certainly isn't documented (except on Stackoverflow.com, which is supremely unhelpful - BTW, guys over on stack overflow... once you've figured out a PHP problem, posting the solution here would save everyone extra search time).</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="102260""></a>
  <div class="note">
   <strong class="user">W at RHaworth dot net</strong>
   <a href="#102260" class="date">04-Feb-2011 01:22</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I had problems with the Wikimedia software and sending a POST request where the data was more than 1024 bytes long. I traced this to cURL adding: Expect: 100-continue to the headers.<br />
<br />
I added curl_setopt($ch,CURLOPT_HTTPHEADER,array("Expect:")); and that suppresses the Expect line.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="102121""></a>
  <div class="note">
   <strong class="user">zsalab</strong>
   <a href="#102121" class="date">28-Jan-2011 02:12</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Handling redirections with curl if safe_mode or open_basedir is enabled. The function working transparent, no problem with header and returntransfer options. You can handle the max redirection with the optional second argument (the function is set the variable to zero if max redirection exceeded).<br />
Second parameter values:<br />
- maxredirect is null or not set: redirect maximum five time, after raise PHP warning<br />
- maxredirect is greather then zero: no raiser error, but parameter variable set to zero<br />
- maxredirect is less or equal zero: no follow redirections<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">function </span><span class="default">curl_exec_follow</span><span class="keyword">(</span><span class="comment">/*resource*/ </span><span class="default">$ch</span><span class="keyword">, </span><span class="comment">/*int*/ </span><span class="keyword">&amp;</span><span class="default">$maxredirect </span><span class="keyword">= </span><span class="default">null</span><span class="keyword">) {<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$mr </span><span class="keyword">= </span><span class="default">$maxredirect </span><span class="keyword">=== </span><span class="default">null </span><span class="keyword">? </span><span class="default">5 </span><span class="keyword">: </span><span class="default">intval</span><span class="keyword">(</span><span class="default">$maxredirect</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; if (</span><span class="default">ini_get</span><span class="keyword">(</span><span class="string">'open_basedir'</span><span class="keyword">) == </span><span class="string">'' </span><span class="keyword">&amp;&amp; </span><span class="default">ini_get</span><span class="keyword">(</span><span class="string">'safe_mode' </span><span class="keyword">== </span><span class="string">'Off'</span><span class="keyword">)) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">curl_setopt</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">, </span><span class="default">CURLOPT_FOLLOWLOCATION</span><span class="keyword">, </span><span class="default">$mr </span><span class="keyword">&gt; </span><span class="default">0</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">curl_setopt</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">, </span><span class="default">CURLOPT_MAXREDIRS</span><span class="keyword">, </span><span class="default">$mr</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; } else {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">curl_setopt</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">, </span><span class="default">CURLOPT_FOLLOWLOCATION</span><span class="keyword">, </span><span class="default">false</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">$mr </span><span class="keyword">&gt; </span><span class="default">0</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$newurl </span><span class="keyword">= </span><span class="default">curl_getinfo</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">, </span><span class="default">CURLINFO_EFFECTIVE_URL</span><span class="keyword">);<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$rch </span><span class="keyword">= </span><span class="default">curl_copy_handle</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">curl_setopt</span><span class="keyword">(</span><span class="default">$rch</span><span class="keyword">, </span><span class="default">CURLOPT_HEADER</span><span class="keyword">, </span><span class="default">true</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">curl_setopt</span><span class="keyword">(</span><span class="default">$rch</span><span class="keyword">, </span><span class="default">CURLOPT_NOBODY</span><span class="keyword">, </span><span class="default">true</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">curl_setopt</span><span class="keyword">(</span><span class="default">$rch</span><span class="keyword">, </span><span class="default">CURLOPT_FORBID_REUSE</span><span class="keyword">, </span><span class="default">false</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">curl_setopt</span><span class="keyword">(</span><span class="default">$rch</span><span class="keyword">, </span><span class="default">CURLOPT_RETURNTRANSFER</span><span class="keyword">, </span><span class="default">true</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; do {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">curl_setopt</span><span class="keyword">(</span><span class="default">$rch</span><span class="keyword">, </span><span class="default">CURLOPT_URL</span><span class="keyword">, </span><span class="default">$newurl</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$header </span><span class="keyword">= </span><span class="default">curl_exec</span><span class="keyword">(</span><span class="default">$rch</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">curl_errno</span><span class="keyword">(</span><span class="default">$rch</span><span class="keyword">)) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$code </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; } else {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$code </span><span class="keyword">= </span><span class="default">curl_getinfo</span><span class="keyword">(</span><span class="default">$rch</span><span class="keyword">, </span><span class="default">CURLINFO_HTTP_CODE</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">$code </span><span class="keyword">== </span><span class="default">301 </span><span class="keyword">|| </span><span class="default">$code </span><span class="keyword">== </span><span class="default">302</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">preg_match</span><span class="keyword">(</span><span class="string">'/Location:(.*?)\n/'</span><span class="keyword">, </span><span class="default">$header</span><span class="keyword">, </span><span class="default">$matches</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$newurl </span><span class="keyword">= </span><span class="default">trim</span><span class="keyword">(</span><span class="default">array_pop</span><span class="keyword">(</span><span class="default">$matches</span><span class="keyword">));<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; } else {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$code </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; } while (</span><span class="default">$code </span><span class="keyword">&amp;&amp; --</span><span class="default">$mr</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">curl_close</span><span class="keyword">(</span><span class="default">$rch</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if (!</span><span class="default">$mr</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">$maxredirect </span><span class="keyword">=== </span><span class="default">null</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">trigger_error</span><span class="keyword">(</span><span class="string">'Too many redirects. When following redirects, libcurl hit the maximum amount.'</span><span class="keyword">, </span><span class="default">E_USER_WARNING</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; } else {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$maxredirect </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">false</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">curl_setopt</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">, </span><span class="default">CURLOPT_URL</span><span class="keyword">, </span><span class="default">$newurl</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; return </span><span class="default">curl_exec</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">);<br />
}<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="102090""></a>
  <div class="note">
   <strong class="user">gskluzacek at gmail dot com</strong>
   <a href="#102090" class="date">26-Jan-2011 10:42</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
FYI... unless you specifically set the user agent, no user agent will be sent in your request as there is no default value like some of the other options.<br />
<br />
As others have said, not sending a user agent may cause you to not&nbsp; get the results that you expected, e.g., 0 byte length content, different content, etc.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="101231""></a>
  <div class="note">
   <strong class="user">john dot david dot steele at gmail dot com</strong>
   <a href="#101231" class="date">03-Dec-2010 10:03</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
A note on the way Curl posts files...<br />
<br />
<span class="default">&lt;?php<br />
&nbsp; curl_setopt</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">, </span><span class="default">CURLOPT_POSTFIELDS</span><span class="keyword">, array(</span><span class="string">'file' </span><span class="keyword">=&gt; </span><span class="string">'@/path/to/file.ext'</span><span class="keyword">);<br />
</span><span class="default">?&gt;<br />
</span><br />
will post the FULL PATH of the file in the filename field:<br />
<br />
Content-Disposition: form-data; name="file"; filename="/path/to/file.ext"<br />
<br />
Whereas typical browser behavior only sends the filename:<br />
<br />
Content-Disposition: form-data; name="file"; filename="file.ext"<br />
<br />
Workaround: <br />
<span class="default">&lt;?php<br />
&nbsp; curl_setopt</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">, </span><span class="default">CURLOPT_POSTFIELDS</span><span class="keyword">, array(</span><span class="string">'file' </span><span class="keyword">=&gt; </span><span class="string">'@file.ext'</span><span class="keyword">);<br />
&nbsp; </span><span class="default">$cwd </span><span class="keyword">= </span><span class="default">getcwd</span><span class="keyword">();<br />
&nbsp; </span><span class="default">chdir</span><span class="keyword">(</span><span class="string">'/path/to/'</span><span class="keyword">);<br />
&nbsp; </span><span class="default">$receivedData </span><span class="keyword">= </span><span class="default">curl_exec</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">);<br />
&nbsp; </span><span class="default">chdir</span><span class="keyword">(</span><span class="default">$cwd</span><span class="keyword">);<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="101139""></a>
  <div class="note">
   <strong class="user">scy-phpmanual at scytale dot name</strong>
   <a href="#101139" class="date">29-Nov-2010 01:01</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
In order to reset CURLOPT_HTTPHEADER, set it to array(). The cURL C API says you should set it to NULL, but that doesn’t work in the PHP wrapper.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="100716""></a>
  <div class="note">
   <strong class="user">prohfesor at gmail dot com</strong>
   <a href="#100716" class="date">02-Nov-2010 10:30</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
This function helps to parse netscape cookie file, generated by cURL into cookie array:<br />
<br />
<span class="default">&lt;?php<br />
&nbsp; </span><span class="keyword">function </span><span class="default">_curl_parse_cookiefile</span><span class="keyword">(</span><span class="default">$file</span><span class="keyword">) {<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$aCookies </span><span class="keyword">= array();<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$aLines </span><span class="keyword">= </span><span class="default">file</span><span class="keyword">(</span><span class="default">$file</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; foreach(</span><span class="default">$aLines </span><span class="keyword">as </span><span class="default">$line</span><span class="keyword">){<br />
&nbsp;&nbsp; &nbsp;&nbsp; if(</span><span class="string">'#'</span><span class="keyword">==</span><span class="default">$line</span><span class="keyword">{</span><span class="default">0</span><span class="keyword">})<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; continue;<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="default">$arr </span><span class="keyword">= </span><span class="default">explode</span><span class="keyword">(</span><span class="string">"\t"</span><span class="keyword">, </span><span class="default">$line</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp;&nbsp; if(isset(</span><span class="default">$arr</span><span class="keyword">[</span><span class="default">5</span><span class="keyword">]) &amp;&amp; isset(</span><span class="default">$arr</span><span class="keyword">[</span><span class="default">6</span><span class="keyword">]))<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$aCookies</span><span class="keyword">[</span><span class="default">$arr</span><span class="keyword">[</span><span class="default">5</span><span class="keyword">]] = </span><span class="default">$arr</span><span class="keyword">[</span><span class="default">6</span><span class="keyword">];<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; return </span><span class="default">$aCookies</span><span class="keyword">; <br />
&nbsp; }<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="100083""></a>
  <div class="note">
   <strong class="user">kavih7 at yahoo dot com</strong>
   <a href="#100083" class="date">24-Sep-2010 05:59</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
When POSTing with cURL, my POSTs were magically being converted to GETs and I debugged it until finding the issue. I was setting the CURLOPT_MUTE option. Not sure why this conflicts, since the documentation doesn't specify as such. Anyways, if your $_POST is empty, make sure you aren't setting CURLOPT_MUTE.<br />
<br />
Cheers!</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="99475""></a>
  <div class="note">
   <strong class="user">curlysue</strong>
   <a href="#99475" class="date">19-Aug-2010 11:34</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If you've got problems with connecting througth a proxy using php/apache/xampp. So if you get no result string from the exec function, try enabling the following options in apache.<br />
<br />
...\xampp\apache\conf<br />
LoadModule proxy_module modules/mod_proxy.so<br />
LoadModule proxy_http_module modules/mod_proxy_http.so<br />
<br />
cURL seems to neet this modules.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="99399""></a>
  <div class="note">
   <strong class="user">daniel at blacklotus dot no</strong>
   <a href="#99399" class="date">15-Aug-2010 02:33</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Sime sites may protect themselves from remote logins by checking which site you came from.<br />
<br />
Then you might want to use CURLOPT_REFERER.<br />
<br />
<span class="default">&lt;?php<br />
<br />
</span><span class="comment">// $url = page to POST data<br />
// $ref_url = tell the server which page you came from (spoofing)<br />
// $login = true will make a clean cookie-file.<br />
// $proxy = proxy data<br />
// $proxystatus = do you use a proxy ? true/false<br />
<br />
</span><span class="keyword">function <br />
</span><span class="default">curl_grab_page</span><span class="keyword">(</span><span class="default">$url</span><span class="keyword">,</span><span class="default">$ref_url</span><span class="keyword">,</span><span class="default">$data</span><span class="keyword">,</span><span class="default">$login</span><span class="keyword">,</span><span class="default">$proxy</span><span class="keyword">,</span><span class="default">$proxystatus</span><span class="keyword">){<br />
&nbsp;&nbsp;&nbsp; if(</span><span class="default">$login </span><span class="keyword">== </span><span class="string">'true'</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$fp </span><span class="keyword">= </span><span class="default">fopen</span><span class="keyword">(</span><span class="string">"cookie.txt"</span><span class="keyword">, </span><span class="string">"w"</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">fclose</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$ch </span><span class="keyword">= </span><span class="default">curl_init</span><span class="keyword">();<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">curl_setopt</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">, </span><span class="default">CURLOPT_COOKIEJAR</span><span class="keyword">, </span><span class="string">"cookie.txt"</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">curl_setopt</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">, </span><span class="default">CURLOPT_COOKIEFILE</span><span class="keyword">, </span><span class="string">"cookie.txt"</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">curl_setopt</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">, </span><span class="default">CURLOPT_USERAGENT</span><span class="keyword">, </span><span class="string">"Mozilla/4.0 (compatible; MSIE 5.01; Windows NT 5.0)"</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">curl_setopt</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">, </span><span class="default">CURLOPT_TIMEOUT</span><span class="keyword">, </span><span class="default">40</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">curl_setopt</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">, </span><span class="default">CURLOPT_RETURNTRANSFER</span><span class="keyword">, </span><span class="default">TRUE</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; if (</span><span class="default">$proxystatus </span><span class="keyword">== </span><span class="string">'true'</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">curl_setopt</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">, </span><span class="default">CURLOPT_HTTPPROXYTUNNEL</span><span class="keyword">, </span><span class="default">TRUE</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">curl_setopt</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">, </span><span class="default">CURLOPT_PROXY</span><span class="keyword">, </span><span class="default">$proxy</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">curl_setopt</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">, </span><span class="default">CURLOPT_SSL_VERIFYHOST</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">curl_setopt</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">, </span><span class="default">CURLOPT_SSL_VERIFYPEER</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">);<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">curl_setopt</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">, </span><span class="default">CURLOPT_URL</span><span class="keyword">, </span><span class="default">$url</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">curl_setopt</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">, </span><span class="default">CURLOPT_RETURNTRANSFER</span><span class="keyword">, </span><span class="default">1</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">curl_setopt</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">, </span><span class="default">CURLOPT_REFERER</span><span class="keyword">, </span><span class="default">$ref_url</span><span class="keyword">);<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">curl_setopt</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">, </span><span class="default">CURLOPT_HEADER</span><span class="keyword">, </span><span class="default">TRUE</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">curl_setopt</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">, </span><span class="default">CURLOPT_USERAGENT</span><span class="keyword">, </span><span class="default">$_SERVER</span><span class="keyword">[</span><span class="string">'HTTP_USER_AGENT'</span><span class="keyword">]);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">curl_setopt</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">, </span><span class="default">CURLOPT_FOLLOWLOCATION</span><span class="keyword">, </span><span class="default">TRUE</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">curl_setopt</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">, </span><span class="default">CURLOPT_POST</span><span class="keyword">, </span><span class="default">TRUE</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">curl_setopt</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">, </span><span class="default">CURLOPT_POSTFIELDS</span><span class="keyword">, </span><span class="default">$data</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">ob_start</span><span class="keyword">();<br />
&nbsp;&nbsp;&nbsp; return </span><span class="default">curl_exec </span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">); </span><span class="comment">// execute the curl command<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">ob_end_clean</span><span class="keyword">();<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">curl_close </span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; unset(</span><span class="default">$ch</span><span class="keyword">);<br />
}<br />
<br />
echo </span><span class="default">curl_grab_page</span><span class="keyword">(</span><span class="string">"https://www.example.net/login.php"</span><span class="keyword">, </span><span class="string">"https://www.example.net/"</span><span class="keyword">, </span><span class="string">"username=foo&amp;password=bar"</span><span class="keyword">, </span><span class="string">"true"</span><span class="keyword">,&nbsp; </span><span class="string">"null"</span><span class="keyword">, </span><span class="string">"false"</span><span class="keyword">);<br />
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="99108""></a>
  <div class="note">
   <strong class="user">sam at def dot reyssi dot net</strong>
   <a href="#99108" class="date">28-Jul-2010 12:43</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Be careful when setting the CURLOPT_POSTFIELDS setting using an array. The array used to set the POST fields must only contain scalar values. Multidimentional arrays or objects lacking a __toString implementation will cause Curl to error.<br />
<br />
If there is a need to send non-scalar values using a POST request, consider serializing them before transmission.<br />
<br />
<span class="default">&lt;?php<br />
$ch </span><span class="keyword">= </span><span class="default">curl_init</span><span class="keyword">(</span><span class="string">'<a href="http://host.example.com" rel="nofollow" target="_blank">http://host.example.com</a>'</span><span class="keyword">);<br />
<br />
</span><span class="comment">// Data to post<br />
</span><span class="default">$multiDimensional </span><span class="keyword">= array(<br />
&nbsp;&nbsp; </span><span class="string">'name' </span><span class="keyword">= </span><span class="string">'foo'</span><span class="keyword">,<br />
&nbsp;&nbsp; </span><span class="string">'data' </span><span class="keyword">= array(</span><span class="default">1</span><span class="keyword">,</span><span class="default">2</span><span class="keyword">,</span><span class="default">3</span><span class="keyword">,</span><span class="default">4</span><span class="keyword">),<br />
&nbsp;&nbsp; </span><span class="string">'value' </span><span class="keyword">= </span><span class="string">'bar'<br />
</span><span class="keyword">);<br />
<br />
</span><span class="comment">// Will error<br />
</span><span class="default">curl_setopt</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">, </span><span class="default">CURLOPT_POSTFIELDS</span><span class="keyword">, </span><span class="default">$multiDimensional</span><span class="keyword">);<br />
<br />
</span><span class="comment">// Data to post<br />
</span><span class="default">$postData </span><span class="keyword">= array(<br />
&nbsp; </span><span class="string">'name' </span><span class="keyword">= </span><span class="string">'foo'</span><span class="keyword">,<br />
&nbsp; </span><span class="string">'data' </span><span class="keyword">= </span><span class="default">serialize</span><span class="keyword">(array(</span><span class="default">1</span><span class="keyword">,</span><span class="default">2</span><span class="keyword">,</span><span class="default">3</span><span class="keyword">,</span><span class="default">4</span><span class="keyword">)),<br />
&nbsp; </span><span class="string">'value' </span><span class="keyword">= </span><span class="string">'bar'<br />
</span><span class="keyword">);<br />
<br />
</span><span class="comment">// Will not error<br />
</span><span class="default">curl_setopt</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">, </span><span class="default">CURLOPT_POSTFIELDS</span><span class="keyword">, </span><span class="default">$postData</span><span class="keyword">);<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="99082""></a>
  <div class="note">
   <strong class="user">joeterranova at gmail dot com</strong>
   <a href="#99082" class="date">26-Jul-2010 09:57</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
It appears that setting CURLOPT_FILE before setting CURLOPT_RETURNTRANSFER doesn't work, presumably because CURLOPT_FILE depends on CURLOPT_RETURNTRANSFER being set.<br />
<br />
So do this:<br />
<br />
<span class="default">&lt;?php<br />
curl_setopt</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">, </span><span class="default">CURLOPT_RETURNTRANSFER</span><span class="keyword">, </span><span class="default">1</span><span class="keyword">);<br />
</span><span class="default">curl_setopt</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">, </span><span class="default">CURLOPT_FILE</span><span class="keyword">, </span><span class="default">$fp</span><span class="keyword">);<br />
</span><span class="default">?&gt;<br />
</span><br />
not this:<br />
<br />
<span class="default">&lt;?php<br />
curl_setopt</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">, </span><span class="default">CURLOPT_FILE</span><span class="keyword">, </span><span class="default">$fp</span><span class="keyword">);<br />
</span><span class="default">curl_setopt</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">, </span><span class="default">CURLOPT_RETURNTRANSFER</span><span class="keyword">, </span><span class="default">1</span><span class="keyword">);<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="98751""></a>
  <div class="note">
   <strong class="user">patryk at do dot not dot spam dot com</strong>
   <a href="#98751" class="date">05-Jul-2010 02:33</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
CURLOPT_HTTPPROXYTUNNEL means curl will use CONNECT method of the HTTP protocol to make a tunnel through a proxy, which is most likely not the one you want to do.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="98491""></a>
  <div class="note">
   <strong class="user">JScott jscott401 at gmail dot com</strong>
   <a href="#98491" class="date">18-Jun-2010 04:29</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Some additional notes for curlopt_writefunction. I struggled with this at first because it really isn't documented very well.<br />
<br />
When you write a callback function and use it with curlopt_writefunction it will be called MULTIPLE times. Your function MUST return the ammount of data written to it each time. It is very picky about this. Here is a snippet from my code that may help you<br />
<br />
<span class="default">&lt;?php<br />
curl_setopt</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">curl_handle</span><span class="keyword">, </span><span class="default">CURLOPT_WRITEFUNCTION</span><span class="keyword">, array(</span><span class="default">$this</span><span class="keyword">, </span><span class="string">"receiveResponse"</span><span class="keyword">));<br />
<br />
</span><span class="comment">// later on in the class I wrote my receive Response method<br />
<br />
</span><span class="keyword">private function </span><span class="default">receiveResponse</span><span class="keyword">(</span><span class="default">$curlHandle</span><span class="keyword">,</span><span class="default">$xmldata</span><span class="keyword">)<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">responseString </span><span class="keyword">= </span><span class="default">$xmldata</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">responseXML </span><span class="keyword">.=&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">responseString</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">length </span><span class="keyword">= </span><span class="default">strlen</span><span class="keyword">(</span><span class="default">$xmldata</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">size </span><span class="keyword">+= </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">length</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">length</span><span class="keyword">;<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
</span><span class="default">?&gt;<br />
</span><br />
Now I did this for a class. If you aren't doing OOP then you will obviously need to modify this for your own use.<br />
<br />
CURL calls your script MULTIPLE times because the data will not always be sent all at once. Were talking internet here so its broken up into packets. You need to take your data and concatenate it all together until it is all written. I was about to pull my damn hair out because I would get broken chunks of XML back from the server and at random lengths. I finally figured out what was going on. Hope this helps</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="98164""></a>
  <div class="note">
   <strong class="user">shailesh4all at gmail dot com</strong>
   <a href="#98164" class="date">29-May-2010 12:42</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Hi,<br />
Anyone who is interested in submitting their information by post to HTTPS site (e.g. payment gateway) where https page needs basic authentication before submitting the information. below code will be helpful. <br />
<br />
<span class="default">&lt;?php<br />
$submit_url </span><span class="keyword">= </span><span class="string">"https://sitename/process.php"</span><span class="keyword">;<br />
<br />
</span><span class="default">$curl </span><span class="keyword">= </span><span class="default">curl_init</span><span class="keyword">();<br />
<br />
</span><span class="default">curl_setopt</span><span class="keyword">(</span><span class="default">$curl</span><span class="keyword">, </span><span class="default">CURLOPT_HTTPAUTH</span><span class="keyword">, </span><span class="default">CURLAUTH_BASIC </span><span class="keyword">) ;<br />
</span><span class="default">curl_setopt</span><span class="keyword">(</span><span class="default">$curl</span><span class="keyword">, </span><span class="default">CURLOPT_USERPWD</span><span class="keyword">, </span><span class="string">"username:password"</span><span class="keyword">);<br />
</span><span class="default">curl_setopt</span><span class="keyword">(</span><span class="default">$curl</span><span class="keyword">, </span><span class="default">CURLOPT_SSLVERSION</span><span class="keyword">,</span><span class="default">3</span><span class="keyword">);<br />
</span><span class="default">curl_setopt</span><span class="keyword">(</span><span class="default">$curl</span><span class="keyword">, </span><span class="default">CURLOPT_SSL_VERIFYPEER</span><span class="keyword">, </span><span class="default">FALSE</span><span class="keyword">);<br />
</span><span class="default">curl_setopt</span><span class="keyword">(</span><span class="default">$curl</span><span class="keyword">, </span><span class="default">CURLOPT_SSL_VERIFYHOST</span><span class="keyword">, </span><span class="default">2</span><span class="keyword">);<br />
</span><span class="default">curl_setopt</span><span class="keyword">(</span><span class="default">$curl</span><span class="keyword">, </span><span class="default">CURLOPT_HEADER</span><span class="keyword">, </span><span class="default">true</span><span class="keyword">);<br />
</span><span class="default">curl_setopt</span><span class="keyword">(</span><span class="default">$curl</span><span class="keyword">, </span><span class="default">CURLOPT_POST</span><span class="keyword">, </span><span class="default">true</span><span class="keyword">);<br />
</span><span class="default">curl_setopt</span><span class="keyword">(</span><span class="default">$curl</span><span class="keyword">, </span><span class="default">CURLOPT_POSTFIELDS</span><span class="keyword">, </span><span class="default">$params </span><span class="keyword">); <br />
</span><span class="default">curl_setopt</span><span class="keyword">(</span><span class="default">$curl</span><span class="keyword">, </span><span class="default">CURLOPT_RETURNTRANSFER</span><span class="keyword">, </span><span class="default">true</span><span class="keyword">);<br />
</span><span class="default">curl_setopt</span><span class="keyword">(</span><span class="default">$curl</span><span class="keyword">, </span><span class="default">CURLOPT_USERAGENT</span><span class="keyword">, </span><span class="string">"Mozilla/4.0 (compatible; MSIE 5.01; Windows NT 5.0)"</span><span class="keyword">);<br />
</span><span class="default">curl_setopt</span><span class="keyword">(</span><span class="default">$curl</span><span class="keyword">, </span><span class="default">CURLOPT_URL</span><span class="keyword">, </span><span class="default">$submit_url</span><span class="keyword">);<br />
<br />
</span><span class="default">$data </span><span class="keyword">= </span><span class="default">split</span><span class="keyword">(</span><span class="string">"text/html"</span><span class="keyword">, </span><span class="default">curl_exec</span><span class="keyword">(</span><span class="default">$curl</span><span class="keyword">) );<br />
</span><span class="default">$temp </span><span class="keyword">= </span><span class="default">split</span><span class="keyword">(</span><span class="string">"\r\n"</span><span class="keyword">, </span><span class="default">$data</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">]) ;<br />
<br />
</span><span class="default">$result </span><span class="keyword">= </span><span class="default">unserialize</span><span class="keyword">( </span><span class="default">$temp</span><span class="keyword">[</span><span class="default">2</span><span class="keyword">] ) ;<br />
<br />
</span><span class="default">print_r</span><span class="keyword">(</span><span class="default">$result</span><span class="keyword">);<br />
</span><span class="default">curl_close</span><span class="keyword">(</span><span class="default">$curl</span><span class="keyword">);<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="97591""></a>
  <div class="note">
   <strong class="user">obones_remove_me at free dot fr</strong>
   <a href="#97591" class="date">27-Apr-2010 12:27</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
For those of you wondering how to specify the content-type for a file uploaded via curl, the syntax is as follows:<br />
<br />
<span class="default">&lt;?php<br />
<br />
$data </span><span class="keyword">= array(</span><span class="string">'file' </span><span class="keyword">=&gt; </span><span class="string">'@/home/user/test.png;type=image/png'</span><span class="keyword">);<br />
<br />
</span><span class="default">?&gt;<br />
</span><br />
Simply adding a semicolon with the type= at the end.<br />
Note that this has been reported not to work in all versions of PHP and I have done the following tests:<br />
<br />
5.2.6 (libcurl 7.18.2) : Does not work<br />
5.2.13 (libcurl 7.20.0) : Works just fine<br />
<br />
So it might be worth updating your installation of PHP and/or libcurl if you want to be able to use this syntax</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="97493""></a>
  <div class="note">
   <strong class="user">sjungwirth at google mail dot com</strong>
   <a href="#97493" class="date">23-Apr-2010 12:11</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I couldn't find a way to force a curl request to go to a particular IP address, but you can do it with fsockopen:<br />
<span class="default">&lt;?php<br />
&nbsp;&nbsp;&nbsp; $ip </span><span class="keyword">= </span><span class="string">'123.45.67.89'</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$fp </span><span class="keyword">= </span><span class="default">fsockopen</span><span class="keyword">(</span><span class="default">$ip</span><span class="keyword">, </span><span class="default">80</span><span class="keyword">, </span><span class="default">$errno</span><span class="keyword">, </span><span class="default">$errstr</span><span class="keyword">, </span><span class="default">5</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$result </span><span class="keyword">= </span><span class="string">''</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; if (!</span><span class="default">$fp</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; echo </span><span class="string">"</span><span class="default">$errstr</span><span class="string"> (</span><span class="default">$errno</span><span class="string">)&lt;br /&gt;\n"</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; } else {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$out </span><span class="keyword">= </span><span class="string">"GET /path/to/the/file.ext HTTP/1.1\r\n"</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$out </span><span class="keyword">.= </span><span class="string">"Host: www.exampl.com\r\n"</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$out </span><span class="keyword">.= </span><span class="string">"Connection: Close\r\n\r\n"</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">fwrite</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">, </span><span class="default">$out</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; while (!</span><span class="default">feof</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">)) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$result </span><span class="keyword">.= </span><span class="default">fgets</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">, </span><span class="default">128</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">fclose</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; }<br />
</span><span class="default">?&gt;<br />
</span>I needed it to test the response from a set of servers behind a load balancer.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="97383""></a>
  <div class="note">
   <strong class="user">clint at fewbar dot com</strong>
   <a href="#97383" class="date">16-Apr-2010 11:56</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If you have turned on conditional gets on a curl handle, and then for a subsequent request, you don't have a good setting for CURLOPT_TIMEVALUE , you can disable If-Modified-Since checking with:<br />
<br />
<span class="default">&lt;?php<br />
<br />
$ch </span><span class="keyword">= </span><span class="default">curl_init</span><span class="keyword">();<br />
</span><span class="default">curl_setopt</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">, </span><span class="default">CURLOPT_URL</span><span class="keyword">, </span><span class="default">$foo</span><span class="keyword">);<br />
</span><span class="default">curl_setopt</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">, </span><span class="default">CURLOPT_TIMEVALUE</span><span class="keyword">, </span><span class="default">filemtime</span><span class="keyword">(</span><span class="default">$foo_path</span><span class="keyword">));<br />
</span><span class="default">curl_setopt</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">, </span><span class="default">CURLOPT_TIMECONDITION</span><span class="keyword">, </span><span class="default">CURLOPT_TIMECOND_IFMODIFIEDSINCE</span><span class="keyword">);<br />
</span><span class="default">curl_exec</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">);<br />
</span><span class="comment">// Reuse same curl handle<br />
</span><span class="default">curl_setopt</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">, </span><span class="default">CURLOPT_URL</span><span class="keyword">, </span><span class="default">$bar</span><span class="keyword">);<br />
</span><span class="default">curl_setopt</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">, </span><span class="default">CURLOPT_TIMEVALUE</span><span class="keyword">, </span><span class="default">null</span><span class="keyword">); </span><span class="comment">// don't know mtime<br />
</span><span class="default">curl_setopt</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">, </span><span class="default">CURLOPT_TIMECONDITION</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">); </span><span class="comment">// set it to 0, turns it off<br />
</span><span class="default">curl_exec</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">);<br />
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="97206""></a>
  <div class="note">
   <strong class="user">julien veneziano</strong>
   <a href="#97206" class="date">08-Apr-2010 12:56</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If you need to send deta in a DELETE request, use:<br />
<br />
<span class="default">&lt;?php<br />
$request_body </span><span class="keyword">= </span><span class="string">'some data'</span><span class="keyword">;<br />
</span><span class="default">$ch </span><span class="keyword">= </span><span class="default">curl_init</span><span class="keyword">(</span><span class="string">'<a href="http://www.example.com" rel="nofollow" target="_blank">http://www.example.com</a>'</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">curl_setopt</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">, </span><span class="default">CURLOPT_POSTFIELDS</span><span class="keyword">, </span><span class="default">$request_body</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">curl_setopt</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">, </span><span class="default">CURLOPT_FOLLOWLOCATION</span><span class="keyword">, </span><span class="default">1</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">curl_setopt</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">, </span><span class="default">CURLOPT_HEADER</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">); <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">curl_setopt</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">, </span><span class="default">CURLOPT_RETURNTRANSFER</span><span class="keyword">, </span><span class="default">1</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">curl_setopt</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">, </span><span class="default">CURLOPT_CUSTOMREQUEST</span><span class="keyword">, </span><span class="string">"DELETE"</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$response </span><span class="keyword">= </span><span class="default">curl_exec</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">);<br />
</span><span class="default">var_dump</span><span class="keyword">(</span><span class="default">$response</span><span class="keyword">);<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="96903""></a>
  <div class="note">
   <strong class="user">anderseta at gmail dot com</strong>
   <a href="#96903" class="date">22-Mar-2010 11:48</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If you wish to find the size of the file you are streaming and use it as your header this is how:<br />
<br />
<span class="default">&lt;?php<br />
<br />
</span><span class="keyword">function </span><span class="default">write_function</span><span class="keyword">(</span><span class="default">$curl_resource</span><span class="keyword">, </span><span class="default">$string</span><span class="keyword">)<br />
{<br />
&nbsp;&nbsp;&nbsp; if(</span><span class="default">curl_getinfo</span><span class="keyword">(</span><span class="default">$curl_resource</span><span class="keyword">, </span><span class="default">CURLINFO_SIZE_DOWNLOAD</span><span class="keyword">) &lt;= </span><span class="default">2000</span><span class="keyword">)<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">header</span><span class="keyword">(</span><span class="string">'Expires: 0'</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">header</span><span class="keyword">(</span><span class="string">'Cache-Control: must-revalidate, post-check=0, pre-check=0'</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">header</span><span class="keyword">(</span><span class="string">'Pragma: public'</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">header</span><span class="keyword">(</span><span class="string">'Content-Description: File Transfer'</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">header</span><span class="keyword">(</span><span class="string">"Content-Transfer-Encoding: binary"</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">header</span><span class="keyword">(</span><span class="string">"Content-Type: "</span><span class="keyword">.</span><span class="default">curl_getinfo</span><span class="keyword">(</span><span class="default">$curl_resource</span><span class="keyword">, </span><span class="default">CURLINFO_CONTENT_TYPE</span><span class="keyword">).</span><span class="string">""</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">header</span><span class="keyword">(</span><span class="string">"Content-Length: "</span><span class="keyword">.</span><span class="default">curl_getinfo</span><span class="keyword">(</span><span class="default">$curl_resource</span><span class="keyword">, </span><span class="default">CURLINFO_CONTENT_LENGTH_DOWNLOAD</span><span class="keyword">).</span><span class="string">""</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; print </span><span class="default">$string</span><span class="keyword">;<br />
<br />
&nbsp;&nbsp;&nbsp; return </span><span class="default">mb_strlen</span><span class="keyword">(</span><span class="default">$string</span><span class="keyword">, </span><span class="string">'8bit'</span><span class="keyword">);<br />
}<br />
<br />
</span><span class="default">?&gt;<br />
</span><br />
1440 is the the default number of bytes curl will call the write function (BUFFERSIZE does not affect this, i actually think you can not change this value), so it means the headers are going to be set only one time.<br />
<br />
write_function must return the exact number of bytes of the string, so you can return a value with mb_strlen.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="96313""></a>
  <div class="note">
   <strong class="user">starosielec at googlemail dot com</strong>
   <a href="#96313" class="date">20-Feb-2010 12:07</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
You can use also use object methods as callback functions. This is usefull if your curl ressource is part of an object handling transfers.<br />
Instead of curl_setopt($curl, CURLOPT_WRITEFUNCTION, "curl_handler_recv") you can use array($object, "method") as value for callback options.<br />
<br />
For example:<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">class </span><span class="default">downloader </span><span class="keyword">{<br />
&nbsp;&nbsp;&nbsp; private </span><span class="default">$curl</span><span class="keyword">;<br />
<br />
&nbsp;&nbsp;&nbsp; function </span><span class="default">__construct</span><span class="keyword">() {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">curl </span><span class="keyword">= </span><span class="default">curl_init</span><span class="keyword">();<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">curl_setopt</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">curl</span><span class="keyword">, </span><span class="default">CURLOPT_WRITEFUNCTION</span><span class="keyword">, array(</span><span class="default">$this</span><span class="keyword">, </span><span class="string">"curl_handler_recv"</span><span class="keyword">));<br />
&nbsp;&nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp; &nbsp; function </span><span class="default">curl_handler_recv</span><span class="keyword">(</span><span class="default">$res</span><span class="keyword">, </span><span class="default">$data</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="comment">//...<br />
&nbsp;&nbsp; &nbsp; </span><span class="keyword">}<br />
&nbsp;&nbsp; </span><span class="comment">//... <br />
</span><span class="keyword">}<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="96056""></a>
  <div class="note">
   <strong class="user">Ed Cradock</strong>
   <a href="#96056" class="date">05-Feb-2010 07:47</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
PUT requests are very simple, just make sure to specify a content-length header and set post fields as a string.<br />
<br />
Example:<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">function </span><span class="default">doPut</span><span class="keyword">(</span><span class="default">$url</span><span class="keyword">, </span><span class="default">$fields</span><span class="keyword">)<br />
{<br />
&nbsp;&nbsp; </span><span class="default">$fields </span><span class="keyword">= (</span><span class="default">is_array</span><span class="keyword">(</span><span class="default">$fields</span><span class="keyword">)) ? </span><span class="default">http_build_query</span><span class="keyword">(</span><span class="default">$fields</span><span class="keyword">) : </span><span class="default">$fields</span><span class="keyword">;<br />
<br />
&nbsp;&nbsp; if(</span><span class="default">$ch </span><span class="keyword">= </span><span class="default">curl_init</span><span class="keyword">(</span><span class="default">$url</span><span class="keyword">))<br />
&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="default">curl_setopt</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">, </span><span class="default">CURLOPT_CUSTOMREQUEST</span><span class="keyword">, </span><span class="string">'PUT'</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="default">curl_setopt</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">, </span><span class="default">CURLOPT_RETURNTRANSFER</span><span class="keyword">, </span><span class="default">true</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="default">curl_setopt</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">, </span><span class="default">CURLOPT_HTTPHEADER</span><span class="keyword">, array(</span><span class="string">'Content-Length: ' </span><span class="keyword">. </span><span class="default">strlen</span><span class="keyword">(</span><span class="default">$fields</span><span class="keyword">)));<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="default">curl_setopt</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">, </span><span class="default">CURLOPT_POSTFIELDS</span><span class="keyword">, </span><span class="default">$fields</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="default">curl_exec</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">);<br />
<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="default">$status </span><span class="keyword">= </span><span class="default">curl_getinfo</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">, </span><span class="default">CURLINFO_HTTP_CODE</span><span class="keyword">);<br />
<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="default">curl_close</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">);<br />
<br />
&nbsp;&nbsp; &nbsp;&nbsp; return (int) </span><span class="default">$status</span><span class="keyword">;<br />
&nbsp;&nbsp; }<br />
&nbsp;&nbsp; else<br />
&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp;&nbsp; return </span><span class="default">false</span><span class="keyword">;<br />
&nbsp;&nbsp; }<br />
}<br />
<br />
if(</span><span class="default">doPut</span><span class="keyword">(</span><span class="string">'<a href="http://example.com/api/a/b/c" rel="nofollow" target="_blank">http://example.com/api/a/b/c</a>'</span><span class="keyword">, array(</span><span class="string">'foo' </span><span class="keyword">=&gt; </span><span class="string">'bar'</span><span class="keyword">)) == </span><span class="default">200</span><span class="keyword">)<br />
&nbsp;&nbsp; </span><span class="comment">// do something<br />
</span><span class="keyword">else<br />
&nbsp;&nbsp; </span><span class="comment">// do something else.<br />
</span><span class="default">?&gt;<br />
</span><br />
You can grab the request data on the other side with:<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">if(</span><span class="default">$_SERVER</span><span class="keyword">[</span><span class="string">'REQUEST_METHOD'</span><span class="keyword">] == </span><span class="string">'PUT'</span><span class="keyword">)<br />
{<br />
&nbsp;&nbsp; </span><span class="default">parse_str</span><span class="keyword">(</span><span class="default">file_get_contents</span><span class="keyword">(</span><span class="string">'php://input'</span><span class="keyword">), </span><span class="default">$requestData</span><span class="keyword">);<br />
<br />
&nbsp;&nbsp; </span><span class="comment">// Array ( [foo] =&gt; bar )<br />
&nbsp;&nbsp; </span><span class="default">print_r</span><span class="keyword">(</span><span class="default">$requestData</span><span class="keyword">);<br />
<br />
&nbsp;&nbsp; </span><span class="comment">// Do something with data...<br />
</span><span class="keyword">}<br />
</span><span class="default">?&gt;<br />
</span><br />
DELETE&nbsp; can be done in exactly the same way.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="95027""></a>
  <div class="note">
   <strong class="user">Pawel Antczak</strong>
   <a href="#95027" class="date">09-Dec-2009 09:07</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Hello. <br />
During problems with "CURLOPT_FOLLOWLOCATION cannot be activated when in safe_mode or an open_basedir is set" <br />
I was looking for solution. <br />
I've found few methods on this page, but none of them was good enough, so I made one.<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">function </span><span class="default">curl_redirect_exec</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">, &amp;</span><span class="default">$redirects</span><span class="keyword">, </span><span class="default">$curlopt_header </span><span class="keyword">= </span><span class="default">false</span><span class="keyword">) {<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">curl_setopt</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">, </span><span class="default">CURLOPT_HEADER</span><span class="keyword">, </span><span class="default">true</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">curl_setopt</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">, </span><span class="default">CURLOPT_RETURNTRANSFER</span><span class="keyword">, </span><span class="default">true</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$data </span><span class="keyword">= </span><span class="default">curl_exec</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$http_code </span><span class="keyword">= </span><span class="default">curl_getinfo</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">, </span><span class="default">CURLINFO_HTTP_CODE</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; if (</span><span class="default">$http_code </span><span class="keyword">== </span><span class="default">301 </span><span class="keyword">|| </span><span class="default">$http_code </span><span class="keyword">== </span><span class="default">302</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; list(</span><span class="default">$header</span><span class="keyword">) = </span><span class="default">explode</span><span class="keyword">(</span><span class="string">"\r\n\r\n"</span><span class="keyword">, </span><span class="default">$data</span><span class="keyword">, </span><span class="default">2</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$matches </span><span class="keyword">= array();<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">preg_match</span><span class="keyword">(</span><span class="string">'/(Location:|URI:)(.*?)\n/'</span><span class="keyword">, </span><span class="default">$header</span><span class="keyword">, </span><span class="default">$matches</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$url </span><span class="keyword">= </span><span class="default">trim</span><span class="keyword">(</span><span class="default">array_pop</span><span class="keyword">(</span><span class="default">$matches</span><span class="keyword">));<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$url_parsed </span><span class="keyword">= </span><span class="default">parse_url</span><span class="keyword">(</span><span class="default">$url</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if (isset(</span><span class="default">$url_parsed</span><span class="keyword">)) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">curl_setopt</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">, </span><span class="default">CURLOPT_URL</span><span class="keyword">, </span><span class="default">$url</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$redirects</span><span class="keyword">++;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">curl_redirect_exec</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">, </span><span class="default">$redirects</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; if (</span><span class="default">$curlopt_header</span><span class="keyword">)<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">$data</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; else {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; list(,</span><span class="default">$body</span><span class="keyword">) = </span><span class="default">explode</span><span class="keyword">(</span><span class="string">"\r\n\r\n"</span><span class="keyword">, </span><span class="default">$data</span><span class="keyword">, </span><span class="default">2</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">$body</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }<br />
}<br />
</span><span class="default">?&gt;<br />
</span><br />
Main issue in existing functions was lack of information, how many redirects was done. <br />
This one will count it. <br />
First parameter as usual. <br />
Second should be already initialized integer, it will be incremented by number of done redirects. <br />
You can set CURLOPT_HEADER if You need it.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="94405""></a>
  <div class="note">
   <strong class="user">php dot net at NO dot sgerrand dot SPAM dot com</strong>
   <a href="#94405" class="date">03-Nov-2009 08:01</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If you change the post array to a string, PHP creates the post data successfully.<br />
<br />
As a quick and dirty example of implementing this fix:<br />
<br />
<span class="default">&lt;?php<br />
<br />
$ch </span><span class="keyword">= </span><span class="default">curl_init</span><span class="keyword">;<br />
</span><span class="default">$url </span><span class="keyword">= </span><span class="string">'<a href="http://www.example.com" rel="nofollow" target="_blank">http://www.example.com</a>'</span><span class="keyword">;<br />
<br />
</span><span class="default">curl_setopt</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">, </span><span class="default">CURLOPT_URL</span><span class="keyword">, </span><span class="default">$url</span><span class="keyword">);<br />
</span><span class="default">curl_setopt</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">, </span><span class="default">CURLOPT_POST</span><span class="keyword">, </span><span class="default">true</span><span class="keyword">);<br />
<br />
foreach (</span><span class="default">$postData </span><span class="keyword">as </span><span class="default">$var</span><span class="keyword">) if (</span><span class="default">strpos</span><span class="keyword">(</span><span class="default">$var</span><span class="keyword">, </span><span class="string">'@'</span><span class="keyword">) === </span><span class="default">0</span><span class="keyword">) {<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$postAsString </span><span class="keyword">= </span><span class="default">true</span><span class="keyword">;<br />
}<br />
<br />
if (</span><span class="default">$postAsString </span><span class="keyword">=== </span><span class="default">true</span><span class="keyword">) {<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$str </span><span class="keyword">= </span><span class="string">''</span><span class="keyword">;<br />
<br />
&nbsp;&nbsp;&nbsp; foreach (</span><span class="default">$postData </span><span class="keyword">as </span><span class="default">$key </span><span class="keyword">=&gt; </span><span class="default">$val</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$str </span><span class="keyword">.= </span><span class="string">'&amp;' </span><span class="keyword">. </span><span class="default">$key </span><span class="keyword">. </span><span class="string">'=' </span><span class="keyword">. </span><span class="default">$val</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$postData </span><span class="keyword">= </span><span class="default">substr_replace</span><span class="keyword">(</span><span class="default">$str</span><span class="keyword">, </span><span class="string">''</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">1</span><span class="keyword">);<br />
}<br />
<br />
</span><span class="default">curl_setopt</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">, </span><span class="default">CURLOPT_POSTFIELDS</span><span class="keyword">, </span><span class="default">$postData</span><span class="keyword">);<br />
<br />
</span><span class="default">curl_exec</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">);<br />
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="93686""></a>
  <div class="note">
   <strong class="user">Chris at PureFormSolutions dot com</strong>
   <a href="#93686" class="date">23-Sep-2009 12:54</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I've found that setting CURLOPT_HTTPHEADER more than once will clear out any headers you've set previously with CURLOPT_HTTPHEADER.<br />
<br />
Consider the following:<br />
<span class="default">&lt;?php<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment"># ...<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">curl_setopt</span><span class="keyword">(</span><span class="default">$cURL</span><span class="keyword">,</span><span class="default">CURLOPT_HTTPHEADER</span><span class="keyword">,array (<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="string">"Content-Type: text/xml; charset=utf-8"</span><span class="keyword">,<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="string">"Expect: 100-continue"<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">));<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment"># ... do some other stuff ...<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">curl_setopt</span><span class="keyword">(</span><span class="default">$cURL</span><span class="keyword">,</span><span class="default">CURLOPT_HTTPHEADER</span><span class="keyword">,array (<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="string">"Accept: application/json"<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">));<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment"># ...<br />
</span><span class="default">?&gt;<br />
</span><br />
Both the Content-Type and Expect I set will not be in the outgoing headers, but Accept will.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="93630""></a>
  <div class="note">
   <strong class="user">Stan van de Burgt</strong>
   <a href="#93630" class="date">19-Sep-2009 11:41</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If you get a "failed creating formpost data" upon curl_exec() when POSTing a form, check if one of the field values starts with the @ character.<br />
<br />
Took me an hour or so to find out as I wanted to post a @reply tweet to twitter which typically start with @screenname.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="93351""></a>
  <div class="note">
   <strong class="user">Tyranoweb</strong>
   <a href="#93351" class="date">04-Sep-2009 11:42</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
There is a function to send POST data in page with five parameters :<br />
<br />
$post must be an array<br />
$page is the page where POST datas will be send.<br />
$n must be true to continue if they are php redirection (Location: )<br />
$session must be define true if you want to use cookies <br />
$referer must be a link to get a wrong referer or only to have a referer.<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">function </span><span class="default">curl_data_post</span><span class="keyword">(</span><span class="default">$post</span><span class="keyword">, </span><span class="default">$page</span><span class="keyword">, </span><span class="default">$n</span><span class="keyword">, </span><span class="default">$session</span><span class="keyword">, </span><span class="default">$referer</span><span class="keyword">)<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if(!</span><span class="default">is_array</span><span class="keyword">(</span><span class="default">$post</span><span class="keyword">))<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; return </span><span class="default">false</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$DATA_POST </span><span class="keyword">= </span><span class="default">curl_init</span><span class="keyword">();<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">curl_setopt</span><span class="keyword">(</span><span class="default">$DATA_POST</span><span class="keyword">, </span><span class="default">CURLOPT_RETURNTRANSFER</span><span class="keyword">, </span><span class="default">true</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">curl_setopt</span><span class="keyword">(</span><span class="default">$DATA_POST</span><span class="keyword">, </span><span class="default">CURLOPT_URL</span><span class="keyword">, </span><span class="default">$page</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">curl_setopt</span><span class="keyword">(</span><span class="default">$DATA_POST</span><span class="keyword">, </span><span class="default">CURLOPT_POST</span><span class="keyword">, </span><span class="default">true</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if(</span><span class="default">$n</span><span class="keyword">)<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">curl_setopt</span><span class="keyword">(</span><span class="default">$DATA_POST</span><span class="keyword">, </span><span class="default">CURLOPT_FOLLOWLOCATION</span><span class="keyword">, </span><span class="default">true</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if(</span><span class="default">$session</span><span class="keyword">)<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">curl_setopt</span><span class="keyword">(</span><span class="default">$DATA_POST</span><span class="keyword">, </span><span class="default">CURLOPT_COOKIEFILE</span><span class="keyword">, </span><span class="string">'cookiefile.txt'</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">curl_setopt</span><span class="keyword">(</span><span class="default">$DATA_POST</span><span class="keyword">, </span><span class="default">CURLOPT_COOKIEJAR</span><span class="keyword">, </span><span class="string">'cookiefile.txt'</span><span class="keyword">); <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if(</span><span class="default">$referer</span><span class="keyword">)<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">curl_setopt</span><span class="keyword">(</span><span class="default">$DATA_POST</span><span class="keyword">, </span><span class="default">CURLOPT_REFERER</span><span class="keyword">, </span><span class="default">$referer</span><span class="keyword">); <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">curl_setopt</span><span class="keyword">(</span><span class="default">$DATA_POST</span><span class="keyword">, </span><span class="default">CURLOPT_POSTFIELDS</span><span class="keyword">, </span><span class="default">$post</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$data </span><span class="keyword">= </span><span class="default">curl_exec</span><span class="keyword">(</span><span class="default">$DATA_POST</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if(</span><span class="default">$data </span><span class="keyword">== </span><span class="default">false</span><span class="keyword">)<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; echo</span><span class="string">'Warning : ' </span><span class="keyword">. </span><span class="default">curl_error</span><span class="keyword">(</span><span class="default">$DATA_POST</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">curl_close</span><span class="keyword">(</span><span class="default">$DATA_POST</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; return </span><span class="default">false</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; else<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">curl_close</span><span class="keyword">(</span><span class="default">$DATA_POST</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; return </span><span class="default">$data</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; }<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="93108""></a>
  <div class="note">
   <strong class="user">rob</strong>
   <a href="#93108" class="date">24-Aug-2009 06:07</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Whats not mentioned in the documentation is that you have to set CURLOPT_COOKIEJAR to a file for the CURL handle to actually use cookies, if it is not set then cookies will not be parsed.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="92522""></a>
  <div class="note">
   <strong class="user">Sylvain R</strong>
   <a href="#92522" class="date">28-Jul-2009 12:05</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
When you are using CURLOPT_FILE to download directly into a file you must close the file handler after the curl_close() otherwise the file will be incomplete and you will not be able to use it until the end of the execution of the php process.<br />
<br />
<span class="default">&lt;?php<br />
<br />
$fh </span><span class="keyword">= </span><span class="default">fopen</span><span class="keyword">(</span><span class="string">'/tmp/foo'</span><span class="keyword">, </span><span class="string">'w'</span><span class="keyword">);<br />
</span><span class="default">$ch </span><span class="keyword">= </span><span class="default">curl_init</span><span class="keyword">(</span><span class="string">'<a href="http://example.com/foo" rel="nofollow" target="_blank">http://example.com/foo</a>'</span><span class="keyword">);<br />
</span><span class="default">curl_setopt</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">, </span><span class="default">CURLOPT_FILE</span><span class="keyword">, </span><span class="default">$fh</span><span class="keyword">);<br />
</span><span class="default">curl_exec</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">);<br />
</span><span class="default">curl_close</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">);<br />
<br />
</span><span class="comment"># at this point your file is not complete and corrupted<br />
<br />
</span><span class="default">fclose</span><span class="keyword">(</span><span class="default">$fh</span><span class="keyword">);<br />
<br />
</span><span class="comment"># now you can use your file;<br />
<br />
</span><span class="default">read_file</span><span class="keyword">(</span><span class="string">'/tmp/foo'</span><span class="keyword">);<br />
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="92235""></a>
  <div class="note">
   <strong class="user">mikeseth at gmail dot com</strong>
   <a href="#92235" class="date">15-Jul-2009 11:32</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
When using CURLOPT_FILE, pass it the file handle that is open for write only (eg fopen('blahblah', 'w+')). If you also open the file for reading (eg fopen('blahblah', 'rw')), curl will fail with error 23.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="91978""></a>
  <div class="note">
   <strong class="user">Victor Jerlin</strong>
   <a href="#91978" class="date">03-Jul-2009 01:12</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Seems like some options not mentioned on this page, but listed on <a href="http://curl.haxx.se/libcurl/c/curl_easy_setopt.html is actually supported." rel="nofollow" target="_blank">http://curl.haxx.se/libcurl/c/curl_easy_setopt.html is actually supported.</a><br />
<br />
I was happy to see that I could actually use CURLOPT_FTP_CREATE_MISSING_DIRS even from PHP.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="91952""></a>
  <div class="note">
   <strong class="user">xektrum at gmail dot com</strong>
   <a href="#91952" class="date">02-Jul-2009 06:14</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
As of php 5.3 CURLOPT_PROGRESSFUNCTION its supported here's how:<br />
<br />
<span class="default">&lt;?php<br />
<br />
</span><span class="keyword">function </span><span class="default">callback</span><span class="keyword">(</span><span class="default">$download_size</span><span class="keyword">, </span><span class="default">$downloaded</span><span class="keyword">, </span><span class="default">$upload_size</span><span class="keyword">, </span><span class="default">$uploaded</span><span class="keyword">)<br />
{<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">// do your progress stuff here<br />
</span><span class="keyword">}<br />
<br />
</span><span class="default">$ch </span><span class="keyword">= </span><span class="default">curl_init</span><span class="keyword">(</span><span class="string">'<a href="http://www.example.com" rel="nofollow" target="_blank">http://www.example.com</a>'</span><span class="keyword">);<br />
<br />
</span><span class="comment">// This is required to curl give us some progress<br />
// if this is not set to false the progress function never<br />
// gets called<br />
</span><span class="default">curl_setopt</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">, </span><span class="default">CURLOPT_NOPROGRESS</span><span class="keyword">, </span><span class="default">false</span><span class="keyword">);<br />
<br />
</span><span class="comment">// Set up the callback<br />
</span><span class="default">curl_setopt</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">, </span><span class="default">CURLOPT_PROGRESSFUNCTION</span><span class="keyword">, </span><span class="string">'callback'</span><span class="keyword">);<br />
<br />
</span><span class="comment">// Big buffer less progress info/callbacks<br />
// Small buffer more progress info/callbacks<br />
</span><span class="default">curl_setopt</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">, </span><span class="default">CURLOPT_BUFFERSIZE</span><span class="keyword">, </span><span class="default">128</span><span class="keyword">);<br />
<br />
</span><span class="default">$data </span><span class="keyword">= </span><span class="default">curl_exec</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">);<br />
<br />
</span><span class="default">?&gt;<br />
</span><br />
Hope this help.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="91510""></a>
  <div class="note">
   <strong class="user">Andrew</strong>
   <a href="#91510" class="date">14-Jun-2009 01:56</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I noticed that if you want to get current cookie file after curl_exec() - you need to close current curl handle (like it said in manual), but if you want cookies to be dumped to file after any curl_exec (without curl_close) you can:<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="comment">#call it normally<br />
</span><span class="default">$ch </span><span class="keyword">= </span><span class="default">curl_init</span><span class="keyword">(); <br />
</span><span class="default">curl_setopt</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">, </span><span class="default">CURLOPT_HEADER</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">); <br />
</span><span class="default">curl_setopt</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">, </span><span class="default">CURLOPT_COOKIEFILE</span><span class="keyword">, </span><span class="string">"cookiefile"</span><span class="keyword">); <br />
</span><span class="default">curl_setopt</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">, </span><span class="default">CURLOPT_COOKIEJAR</span><span class="keyword">, </span><span class="string">"cookiefile"</span><span class="keyword">); <br />
</span><span class="default">curl_setopt</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">, </span><span class="default">CURLOPT_FOLLOWLOCATION</span><span class="keyword">, </span><span class="default">1</span><span class="keyword">); <br />
</span><span class="default">curl_setopt</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">, </span><span class="default">CURLOPT_URL</span><span class="keyword">, </span><span class="string">'<a href="http://www.example.com/" rel="nofollow" target="_blank">http://www.example.com/</a>'</span><span class="keyword">); <br />
</span><span class="default">$result1 </span><span class="keyword">= </span><span class="default">curl_exec</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">); <br />
<br />
</span><span class="comment">#and then&nbsp; make a temp copy<br />
</span><span class="default">$ch_temp</span><span class="keyword">=</span><span class="default">curl_copy_handle</span><span class="keyword">(</span><span class="default">ch</span><span class="keyword">);<br />
</span><span class="default">curl_close</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">);<br />
</span><span class="default">$ch</span><span class="keyword">=</span><span class="default">$ch_temp</span><span class="keyword">;<br />
</span><span class="default">?&gt;<br />
</span><br />
Only this way, if you close $ch_temp - cookies wont be dumped.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="91297""></a>
  <div class="note">
   <strong class="user">ericbianchetti at gmail dot com</strong>
   <a href="#91297" class="date">04-Jun-2009 12:06</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
if you need to send a SOAP string that is the CURL you must use :<br />
<br />
<span class="default">&lt;?php<br />
$ch </span><span class="keyword">= </span><span class="default">curl_init</span><span class="keyword">();<br />
</span><span class="default">curl_setopt</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">, </span><span class="default">CURLOPT_URL</span><span class="keyword">, </span><span class="default">XML_POST_URL</span><span class="keyword">); <br />
</span><span class="default">curl_setopt </span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">, </span><span class="default">CURLOPT_HTTPHEADER</span><span class="keyword">, array(</span><span class="string">'SOAPAction: ""'</span><span class="keyword">));&nbsp; &nbsp; <br />
</span><span class="default">curl_setopt</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">, </span><span class="default">CURLOPT_RETURNTRANSFER</span><span class="keyword">, </span><span class="default">1</span><span class="keyword">); <br />
</span><span class="default">curl_setopt</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">, </span><span class="default">CURLOPT_SSL_VERIFYPEER</span><span class="keyword">, </span><span class="default">FALSE</span><span class="keyword">);<br />
</span><span class="default">curl_setopt</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">, </span><span class="default">CURLOPT_POSTFIELDS</span><span class="keyword">, </span><span class="default">XML_PAYLOAD</span><span class="keyword">); <br />
</span><span class="default">curl_setopt</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">, </span><span class="default">CURLOPT_HEADER</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">);<br />
<br />
</span><span class="default">$output </span><span class="keyword">= </span><span class="default">curl_exec</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">); <br />
</span><span class="default">?&gt;<br />
</span><br />
Note : Having based my snipet on Chemo demonstration (oscommerce user know who he is), XML_POST_URL and XML_PAYLOAD where defined as constant with define().<br />
<br />
The point is : at the opposite of .xml , SOAP must send the header 'SOAPAction: ""' that can be a valid URI, an empty string (that is here) or nothing ('SOAPAction: '). The later case baing not accepted by all server, the second one indicating the target is the URI used to post the SOAP.<br />
<a href="http://www.w3.org/TR/2000/NOTE-SOAP-20000508/#_Toc478383528" rel="nofollow" target="_blank">http://www.w3.org/TR/2000/NOTE-SOAP-20000508/#_Toc478383528</a></span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="90988""></a>
  <div class="note">
   <strong class="user">franciscocha at gmail dot com</strong>
   <a href="#90988" class="date">20-May-2009 12:11</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Example how to connect to FTPES (FTP explicit SSL). This script will connect to any FTPES server and out put the list of directories.<br />
<br />
<span class="default">&lt;?php<br />
&nbsp;&nbsp;&nbsp; $username </span><span class="keyword">= </span><span class="string">'username'</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$password </span><span class="keyword">= </span><span class="string">'password'</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$url </span><span class="keyword">= </span><span class="string">'example.com'</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$ftp_server </span><span class="keyword">= </span><span class="string">"<a href="ftp://" rel="nofollow" target="_blank">ftp://</a>" </span><span class="keyword">. </span><span class="default">$username </span><span class="keyword">. </span><span class="string">":" </span><span class="keyword">. </span><span class="default">$password </span><span class="keyword">. </span><span class="string">"@" </span><span class="keyword">. </span><span class="default">$url</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; echo </span><span class="string">"Starting CURL.\n"</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$ch </span><span class="keyword">= </span><span class="default">curl_init</span><span class="keyword">();<br />
&nbsp;&nbsp;&nbsp; echo </span><span class="string">"Set CURL URL.\n"</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">//curl FTP<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">curl_setopt</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">, </span><span class="default">CURLOPT_URL</span><span class="keyword">, </span><span class="default">$ftp_server</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">//For Debugging<br />
&nbsp;&nbsp;&nbsp; //curl_setopt($ch, CURLOPT_VERBOSE, TRUE);&nbsp; &nbsp; <br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; //SSL Settings<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">curl_setopt</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">, </span><span class="default">CURLOPT_SSL_VERIFYPEER</span><span class="keyword">, </span><span class="default">FALSE</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">curl_setopt</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">, </span><span class="default">CURLOPT_SSL_VERIFYHOST</span><span class="keyword">, </span><span class="default">FALSE</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">curl_setopt</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">, </span><span class="default">CURLOPT_FTP_SSL</span><span class="keyword">, </span><span class="default">CURLFTPSSL_TRY</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">//List FTP files and directories<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">curl_setopt</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">, </span><span class="default">CURLOPT_FTPLISTONLY</span><span class="keyword">, </span><span class="default">TRUE</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">//Output to curl_exec<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">curl_setopt</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">, </span><span class="default">CURLOPT_RETURNTRANSFER</span><span class="keyword">, </span><span class="default">1</span><span class="keyword">);<br />
<br />
&nbsp;&nbsp;&nbsp; echo </span><span class="string">"Executing CURL.\n"</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$output </span><span class="keyword">= </span><span class="default">curl_exec</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">curl_close</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; echo </span><span class="string">"Closing CURL.\n"</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; echo </span><span class="default">$output </span><span class="keyword">. </span><span class="string">"\n"</span><span class="keyword">;<br />
<br />
&nbsp;&nbsp; </span><span class="default">$files </span><span class="keyword">= </span><span class="default">explode</span><span class="keyword">(</span><span class="string">"\n"</span><span class="keyword">, </span><span class="default">$output</span><span class="keyword">);<br />
&nbsp;&nbsp; </span><span class="default">print_r</span><span class="keyword">(</span><span class="default">$files</span><span class="keyword">);<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="89770""></a>
  <div class="note">
   <strong class="user">ashooner - - gmail , com</strong>
   <a href="#89770" class="date">23-Mar-2009 12:28</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
When passing CURLOPT_POSTFIELDS a url-encoded string in order to use Content-Type: application/x-www-form-urlencoded, you can pass a string directly:<br />
<span class="default">&lt;?php<br />
curl_setopt</span><span class="keyword">(</span><span class="default">CURLOPT_POSTFIELDS</span><span class="keyword">, </span><span class="string">'field1=value&amp;field2=value2'</span><span class="keyword">);<br />
</span><span class="default">?&gt;<br />
</span><br />
rather than passing the string in an array, as in fred at themancan dot com's example.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="88640""></a>
  <div class="note">
   <strong class="user">Ariz Jacinto</strong>
   <a href="#88640" class="date">02-Feb-2009 03:36</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
if unserialize() returns FALSE on a serialized PHP object due to an extraneous string (e.g. "1") appended at the end of the object, you need to set the ff cURL option:<br />
<br />
<span class="default">&lt;?php<br />
curl_setopt</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">, </span><span class="default">CURLOPT_RETURNTRANSFER</span><span class="keyword">, </span><span class="default">true</span><span class="keyword">);<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="88538""></a>
  <div class="note">
   <strong class="user">urkle at outoforder dot cc</strong>
   <a href="#88538" class="date">28-Jan-2009 03:49</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
To send a post as a different content-type (ie.. application/json or text/xml) add this setopt call<br />
<br />
<span class="default">&lt;?php<br />
curl_setopt</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">, </span><span class="default">CURLOPT_HTTPHEADER</span><span class="keyword">,array(</span><span class="string">'Content-Type: application/json'</span><span class="keyword">));<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="87341""></a>
  <div class="note">
   <strong class="user">fnjordy at gmail dot com</strong>
   <a href="#87341" class="date">01-Dec-2008 08:28</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Note that CURLOPT_RETURNTRANSFER when used with CURLOPT_WRITEFUNCTION has effectively three settings: default, true, and false.<br />
<br />
default - callbacks will be called as expected.<br />
true - content will be returned but callback function will not be called.<br />
false - content will be output and callback function will not be called.<br />
<br />
Note that CURLOPT_HEADERFUNCTION callbacks are always called.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="87112""></a>
  <div class="note">
   <strong class="user">saidk at phirebranding dot com</strong>
   <a href="#87112" class="date">19-Nov-2008 10:31</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Passing in PHP's $_SESSION into your cURL call:<br />
<br />
<span class="default">&lt;?php<br />
session_start</span><span class="keyword">();<br />
</span><span class="default">$strCookie </span><span class="keyword">= </span><span class="string">'PHPSESSID=' </span><span class="keyword">. </span><span class="default">$_COOKIE</span><span class="keyword">[</span><span class="string">'PHPSESSID'</span><span class="keyword">] . </span><span class="string">'; path=/'</span><span class="keyword">;<br />
</span><span class="default">session_write_close</span><span class="keyword">();<br />
<br />
</span><span class="default">$curl_handle </span><span class="keyword">= </span><span class="default">curl_init</span><span class="keyword">(</span><span class="string">'enter_external_url_here'</span><span class="keyword">);<br />
</span><span class="default">curl_setopt</span><span class="keyword">( </span><span class="default">$curl_handle</span><span class="keyword">, </span><span class="default">CURLOPT_COOKIE</span><span class="keyword">, </span><span class="default">$strCookie </span><span class="keyword">);<br />
</span><span class="default">curl_exec</span><span class="keyword">(</span><span class="default">$curl_handle</span><span class="keyword">);<br />
</span><span class="default">curl_close</span><span class="keyword">(</span><span class="default">$curl_handle</span><span class="keyword">);<br />
</span><span class="default">?&gt;<br />
</span><br />
This worked great for me.&nbsp; I was calling pages from the same server and needed to keep the $_SESSION variables.&nbsp; This passes them over.&nbsp; If you want to test, just print_r($_SESSION);<br />
<br />
Enjoy!</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="86284""></a>
  <div class="note">
   <strong class="user">dorphalsig at gmail dot com</strong>
   <a href="#86284" class="date">10-Oct-2008 11:20</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
This may not be a surprise for many, but I know I bled my eyes out trying to implement this in php. And when I knew it was this simple, I really felt extremely stupid. So I put this just so google will save somebody some time in the future.<br />
<br />
PHP NTLM AUTH<br />
<br />
Make sure you have the 'curl' extension loaded<br />
now just do...<br />
<br />
<span class="default">&lt;?php<br />
curl_setopt</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">,</span><span class="default">CURLAUTH_NTLM</span><span class="keyword">);<br />
</span><span class="default">curl_setopt</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">,</span><span class="default">CURLOPT_USERPWD</span><span class="keyword">,</span><span class="string">"</span><span class="default">$username</span><span class="string">:</span><span class="default">$password</span><span class="string">"</span><span class="keyword">);<br />
</span><span class="default">?&gt;<br />
</span><br />
and just continue to use curl in the ordinary fashion.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="85956""></a>
  <div class="note">
   <strong class="user">OPALA</strong>
   <a href="#85956" class="date">26-Sep-2008 09:37</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
To fetch (or submit data to) multiple pages during one session,use this:<br />
<br />
<span class="default">&lt;?php<br />
$ch </span><span class="keyword">= </span><span class="default">curl_init</span><span class="keyword">();<br />
</span><span class="default">curl_setopt</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">, </span><span class="default">CURLOPT_SSL_VERIFYPEER</span><span class="keyword">, </span><span class="default">FALSE</span><span class="keyword">);<br />
</span><span class="default">curl_setopt</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">, </span><span class="default">CURLOPT_RETURNTRANSFER</span><span class="keyword">, </span><span class="default">TRUE</span><span class="keyword">);<br />
</span><span class="default">curl_setopt</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">, </span><span class="default">CURLOPT_COOKIESESSION</span><span class="keyword">, </span><span class="default">TRUE</span><span class="keyword">);<br />
</span><span class="default">curl_setopt</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">, </span><span class="default">CURLOPT_HEADER</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">);<br />
</span><span class="default">curl_setopt</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">, </span><span class="default">CURLOPT_COOKIEFILE</span><span class="keyword">, </span><span class="string">"cookiefile"</span><span class="keyword">);<br />
</span><span class="default">curl_setopt</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">, </span><span class="default">CURLOPT_COOKIEJAR</span><span class="keyword">, </span><span class="string">"cookiefile"</span><span class="keyword">);<br />
</span><span class="default">curl_setopt</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">, </span><span class="default">CURLOPT_COOKIE</span><span class="keyword">, </span><span class="default">session_name</span><span class="keyword">() . </span><span class="string">'=' </span><span class="keyword">. </span><span class="default">session_id</span><span class="keyword">());<br />
</span><span class="default">curl_setopt</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">, </span><span class="default">CURLOPT_FOLLOWLOCATION</span><span class="keyword">, </span><span class="default">1</span><span class="keyword">);<br />
<br />
</span><span class="default">curl_setopt</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">, </span><span class="default">CURLOPT_URL</span><span class="keyword">, </span><span class="string">'<a href="http://example.com/page1.php" rel="nofollow" target="_blank">http://example.com/page1.php</a>'</span><span class="keyword">);<br />
</span><span class="default">$result1 </span><span class="keyword">= </span><span class="default">curl_exec</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">);<br />
<br />
</span><span class="default">curl_setopt</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">, </span><span class="default">CURLOPT_URL</span><span class="keyword">, </span><span class="string">'<a href="http://example.com/page2.php" rel="nofollow" target="_blank">http://example.com/page2.php</a>'</span><span class="keyword">);<br />
</span><span class="default">$result2 </span><span class="keyword">= </span><span class="default">curl_exec</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">);<br />
<br />
</span><span class="default">curl_close</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">);<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="85747""></a>
  <div class="note">
   <strong class="user">rkirilow at gmail dot com</strong>
   <a href="#85747" class="date">16-Sep-2008 10:34</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Some of you may noticed that curl is not transferring cookies between sequent calls to a host. This is because you must activate curl`s "cookie parser". That is achieved using an external file like this:<br />
<span class="default">&lt;?php<br />
curl_setopt</span><span class="keyword">(</span><span class="default">CURLOPT_FILE</span><span class="keyword">, </span><span class="string">'/tmp/cookies_file'</span><span class="keyword">);<br />
</span><span class="default">?&gt;<br />
</span>If you don`t need to read any cookies but you still want the "cookie parser" use the same code but with dummy file with no data like '/dev/null', that way curl is storing cookies internaly per curl_handle:<br />
<span class="default">&lt;?php<br />
curl_setopt</span><span class="keyword">(</span><span class="default">CURLOPT_FILE</span><span class="keyword">, </span><span class="string">'/dev/null'</span><span class="keyword">);<br />
</span><span class="default">?&gt;<br />
</span><br />
[EDIT BY danbrown AT php DOT net: In a note dated 26-SEP-08, (adamplumb AT gmail DOT com) offered the following addendum:<br />
<br />
[It] should really be CURLOPT_COOKIEFILE.&nbsp; I was bitten by this issue myself with code that previously worked for logging into a website and posting a form.&nbsp; However, at some point the code just stopped working, and I eventually found that I needed to set this option to /dev/null for it to work.<br />
]</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="85275""></a>
  <div class="note">
   <strong class="user">George</strong>
   <a href="#85275" class="date">23-Aug-2008 02:14</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If you set CURLOPT_RESUME_FROM to resume the file, and then reuse the same Curl handle to download another file, you must reset the resume status by calling curl_setopt( $ch, CURLOPT_RESUME_FROM, 0 ). It will not reset, and will apply to all subsequent transfers even if the URL is the same.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="85044""></a>
  <div class="note">
   <strong class="user">w dot danford at electronics-software dot com</strong>
   <a href="#85044" class="date">12-Aug-2008 07:12</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Just a small detail I too easily overlooked.<br />
<span class="default">&lt;?php<br />
</span><span class="comment">/*&nbsp; If you set:&nbsp; */<br />
</span><span class="default">curl_setopt </span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">, </span><span class="default">CURLOPT_POST</span><span class="keyword">, </span><span class="default">1</span><span class="keyword">);<br />
</span><span class="comment">/* then you must have the data: */<br />
</span><span class="default">curl_setopt </span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">, </span><span class="default">CURLOPT_POSTFIELDS</span><span class="keyword">, </span><span class="default">$PostData</span><span class="keyword">);<br />
</span><span class="default">?&gt;<br />
</span>I found with only the CURLOPT_POST set (from copy, paste editing of course) cookies were not getting sent with CURLOPT_COOKIE.&nbsp; Just something subtle to watch out for.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="84916""></a>
  <div class="note">
   <strong class="user">fred at themancan dot com</strong>
   <a href="#84916" class="date">06-Aug-2008 01:28</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
To find what encoding a given HTTP POST request uses is easy -- passing an array to CURLOPT_POSTFIELDS results in&nbsp; multipart/form-data:<br />
<br />
<span class="default">&lt;?php<br />
curl_setopt</span><span class="keyword">(</span><span class="default">CURLOPT_POSTFIELDS</span><span class="keyword">, array(</span><span class="string">'field1' </span><span class="keyword">=&gt; </span><span class="string">'value'</span><span class="keyword">));<br />
</span><span class="default">?&gt;<br />
</span><br />
Passing a URL-encoded string will result in application/x-www-form-urlencoded:<br />
<br />
<span class="default">&lt;?php<br />
curl_setopt</span><span class="keyword">(</span><span class="default">CURLOPT_POSTFIELDS</span><span class="keyword">, array(</span><span class="string">'field1=value&amp;field2=value2'</span><span class="keyword">));<br />
</span><span class="default">?&gt;<br />
</span><br />
I ran across this when integrating with both a warehouse system and an email system; neither would accept multipart/form-data, but both happily accepted application/x-www-form-urlencoded.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="84902""></a>
  <div class="note">
   <strong class="user">jID</strong>
   <a href="#84902" class="date">05-Aug-2008 01:56</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
if you use<br />
<span class="default">&lt;?php<br />
curl_setopt</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">, </span><span class="default">CURLOPT_INTERFACE</span><span class="keyword">, </span><span class="string">"XXX.XXX.XXX.XXX"</span><span class="keyword">);<br />
</span><span class="default">?&gt;<br />
</span>to specify IP adress for request, sometimes you need to get list of all your IP's.<br />
<br />
ifconfig command will output something like:<br />
<br />
rl0: flags=8843&lt;UP,BROADCAST,RUNNING,SIMPLEX,MULTICAST&gt; mtu 1500<br />
&nbsp;&nbsp;&nbsp; options=8&lt;VLAN_MTU&gt;<br />
&nbsp;&nbsp;&nbsp; inet 82.146.XXX.XXX netmask 0xffffffff broadcast 82.146.XXX.XXX<br />
&nbsp;&nbsp;&nbsp; inet 78.24.XXX.XXX netmask 0xffffffff broadcast 78.24.XXX.XXX<br />
&nbsp;&nbsp;&nbsp; inet 82.146.XXX.XXX netmask 0xffffffff broadcast 82.146.XXX.XXX<br />
&nbsp;&nbsp;&nbsp; inet 82.146.XXX.XXX netmask 0xffffffff broadcast 82.146.XXX.XXX<br />
&nbsp;&nbsp;&nbsp; inet 82.146.XXX.XXX netmask 0xffffffff broadcast 82.146.XXX.XXX<br />
&nbsp;&nbsp;&nbsp; inet 78.24.XXX.XXX netmask 0xffffffff broadcast 78.24.XXX.XXX<br />
&nbsp;&nbsp;&nbsp; inet 78.24.XXX.XXX netmask 0xffffffff broadcast 78.24.XXX.XXX<br />
&nbsp;&nbsp;&nbsp; ether XX:XX:XX:XX:XX:XX<br />
&nbsp;&nbsp;&nbsp; media: Ethernet autoselect (100baseTX &lt;full-duplex&gt;)<br />
&nbsp;&nbsp;&nbsp; status: active<br />
lo0: flags=8049&lt;UP,LOOPBACK,RUNNING,MULTICAST&gt; mtu 16384<br />
tun0: flags=8051&lt;UP,POINTOPOINT,RUNNING,MULTICAST&gt; mtu 1500<br />
&nbsp;&nbsp;&nbsp; Opened by PID 564<br />
tun1: flags=8051&lt;UP,POINTOPOINT,RUNNING,MULTICAST&gt; mtu 1500<br />
&nbsp;&nbsp;&nbsp; Opened by PID 565<br />
&nbsp;&nbsp;&nbsp; Opened by PID 565<br />
<br />
My solution for FreeBSD 6 and PHP 5 was:<br />
<span class="default">&lt;?php<br />
&nbsp; ob_start</span><span class="keyword">();<br />
&nbsp; </span><span class="default">$ips</span><span class="keyword">=array();<br />
&nbsp; </span><span class="default">$ifconfig</span><span class="keyword">=</span><span class="default">system</span><span class="keyword">(</span><span class="string">"ifconfig"</span><span class="keyword">);<br />
&nbsp; echo </span><span class="default">$ifconfig</span><span class="keyword">;<br />
&nbsp; </span><span class="default">$ifconfig</span><span class="keyword">=</span><span class="default">ob_get_contents</span><span class="keyword">();<br />
&nbsp; </span><span class="default">ob_end_clean</span><span class="keyword">();<br />
&nbsp; </span><span class="default">$ifconfig</span><span class="keyword">=</span><span class="default">explode</span><span class="keyword">(</span><span class="default">chr</span><span class="keyword">(</span><span class="default">10</span><span class="keyword">), </span><span class="default">$ifconfig</span><span class="keyword">);<br />
&nbsp; for (</span><span class="default">$i</span><span class="keyword">=</span><span class="default">0</span><span class="keyword">; </span><span class="default">$i</span><span class="keyword">&lt;</span><span class="default">count</span><span class="keyword">(</span><span class="default">$ifconfig</span><span class="keyword">); </span><span class="default">$i</span><span class="keyword">++) {<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$t</span><span class="keyword">=</span><span class="default">explode</span><span class="keyword">(</span><span class="string">" "</span><span class="keyword">, </span><span class="default">$ifconfig</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">]);<br />
&nbsp;&nbsp;&nbsp; if (</span><span class="default">$t</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">]==</span><span class="string">"\tinet"</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="default">array_push</span><span class="keyword">(</span><span class="default">$ips</span><span class="keyword">, </span><span class="default">$t</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">]);<br />
&nbsp;&nbsp;&nbsp; }&nbsp; &nbsp;&nbsp; <br />
&nbsp; }<br />
&nbsp; for (</span><span class="default">$i</span><span class="keyword">=</span><span class="default">0</span><span class="keyword">; </span><span class="default">$i</span><span class="keyword">&lt;</span><span class="default">count</span><span class="keyword">(</span><span class="default">$ips</span><span class="keyword">); </span><span class="default">$i</span><span class="keyword">++) {<br />
&nbsp;&nbsp;&nbsp; echo </span><span class="default">$ips</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">].</span><span class="string">"\n"</span><span class="keyword">;<br />
&nbsp; }<br />
</span><span class="default">?&gt;<br />
</span><br />
You will get list of IP adresses in $ips array, like:<br />
82.146.XXX.XXX<br />
78.24.XXX.XXX<br />
82.146.XXX.XXX<br />
82.146.XXX.XXX<br />
82.146.XXX.XXX<br />
78.24.XXX.XXX<br />
78.24.XXX.XXX</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="84374""></a>
  <div class="note">
   <strong class="user">ac at an dot y-co dot de</strong>
   <a href="#84374" class="date">10-Jul-2008 07:08</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If you want to connect to a server which requires that you identify yourself with a certificate, use following code. Your certificate and servers certificate are signed by an authority whose certificate is in ca.ctr.<br />
<br />
<span class="default">&lt;?php<br />
curl_setopt</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">, </span><span class="default">CURLOPT_VERBOSE</span><span class="keyword">, </span><span class="string">'1'</span><span class="keyword">);<br />
</span><span class="default">curl_setopt</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">, </span><span class="default">CURLOPT_SSL_VERIFYHOST</span><span class="keyword">, </span><span class="string">'1'</span><span class="keyword">);<br />
</span><span class="default">curl_setopt</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">, </span><span class="default">CURLOPT_SSL_VERIFYPEER</span><span class="keyword">, </span><span class="string">'1'</span><span class="keyword">);<br />
</span><span class="default">curl_setopt</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">, </span><span class="default">CURLOPT_CAINFO</span><span class="keyword">,&nbsp; </span><span class="default">getcwd</span><span class="keyword">().</span><span class="string">'/cert/ca.crt'</span><span class="keyword">);<br />
</span><span class="default">curl_setopt</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">, </span><span class="default">CURLOPT_SSLCERT</span><span class="keyword">, </span><span class="default">getcwd</span><span class="keyword">().</span><span class="string">'/cert/mycert.pem'</span><span class="keyword">);<br />
</span><span class="default">curl_setopt</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">, </span><span class="default">CURLOPT_SSLCERTPASSWD</span><span class="keyword">, </span><span class="string">'password'</span><span class="keyword">);<br />
</span><span class="default">?&gt;<br />
</span><br />
If your original certificate is in .pfx format, you have to convert it to .pem using following commands<br />
# openssl pkcs12 -in mycert.pfx -out mycert.key<br />
# openssl rsa -in mycert.key -out mycert.pem<br />
# openssl x509 -in mycert.key &gt;&gt; mycert.pem</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="84277""></a>
  <div class="note">
   <strong class="user">nick at glype dot com</strong>
   <a href="#84277" class="date">07-Jul-2008 06:18</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Although CURLOPT_CLOSEPOLICY and the applicable choices are valid constants, setting this option with curl_setopt() always returns false. A quick google search suggests the option is deprecated and/or never worked.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="83937""></a>
  <div class="note">
   <strong class="user">Salil Kothadia</strong>
   <a href="#83937" class="date">19-Jun-2008 06:02</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
In PHP5, for the "CURLOPT_POSTFIELDS" option, we can use:<br />
<br />
<span class="default">&lt;?php<br />
$ch </span><span class="keyword">= </span><span class="default">curl_init</span><span class="keyword">(</span><span class="default">$URI</span><span class="keyword">);<br />
</span><span class="default">$Post </span><span class="keyword">= </span><span class="default">http_build_query</span><span class="keyword">(</span><span class="default">$PostData</span><span class="keyword">);<br />
</span><span class="default">curl_setopt</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">, </span><span class="default">CURLOPT_POSTFIELDS</span><span class="keyword">, </span><span class="default">$Post</span><span class="keyword">);<br />
</span><span class="default">$Output </span><span class="keyword">= </span><span class="default">curl_exec</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">);<br />
</span><span class="default">curl_close</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">);<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="82418""></a>
  <div class="note">
   <strong class="user">sgamon at yahoo dot com</strong>
   <a href="#82418" class="date">10-Apr-2008 02:55</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If you are doing a POST, and the content length is 1,025 or greater, then curl exploits a feature of http 1.1: 100 (Continue) Status.<br />
<br />
See <a href="http://www.w3.org/Protocols/rfc2616/rfc2616-sec8.html#sec8.2.3" rel="nofollow" target="_blank">http://www.w3.org/Protocols/rfc2616/rfc2616-sec8.html#sec8.2.3</a><br />
<br />
* it adds a header, "Expect: 100-continue".&nbsp; <br />
* it then sends the request head, waits for a 100 response code, then sends the content <br />
<br />
Not all web servers support this though.&nbsp; Various errors are returned depending on the server.&nbsp; If this happens to you, suppress the "Expect" header with this command:<br />
<br />
<span class="default">&lt;?php<br />
curl_setopt</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">, </span><span class="default">CURLOPT_HTTPHEADER</span><span class="keyword">, array(</span><span class="string">'Expect:'</span><span class="keyword">));<br />
</span><span class="default">?&gt;<br />
</span><br />
See <a href="http://www.gnegg.ch/2007/02/the-return-of-except-100-continue/" rel="nofollow" target="_blank">http://www.gnegg.ch/2007/02/the-return-of-except-100-continue/</a></span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="82300""></a>
  <div class="note">
   <strong class="user">john factorial</strong>
   <a href="#82300" class="date">04-Apr-2008 05:22</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Clarification for the CURLOPT_NOBODY option: by excluding the body from your request, you're effectively making a HEAD request. Use the CURLOPT_NOBODY option to return only the headers in the remote response.<br />
<br />
Example:<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">function </span><span class="default">check_url</span><span class="keyword">(</span><span class="default">$url</span><span class="keyword">) {<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$c </span><span class="keyword">= </span><span class="default">curl_init</span><span class="keyword">();<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">curl_setopt</span><span class="keyword">(</span><span class="default">$c</span><span class="keyword">, </span><span class="default">CURLOPT_URL</span><span class="keyword">, </span><span class="default">$url</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">curl_setopt</span><span class="keyword">(</span><span class="default">$c</span><span class="keyword">, </span><span class="default">CURLOPT_HEADER</span><span class="keyword">, </span><span class="default">1</span><span class="keyword">); </span><span class="comment">// get the header<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">curl_setopt</span><span class="keyword">(</span><span class="default">$c</span><span class="keyword">, </span><span class="default">CURLOPT_NOBODY</span><span class="keyword">, </span><span class="default">1</span><span class="keyword">); </span><span class="comment">// and *only* get the header<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">curl_setopt</span><span class="keyword">(</span><span class="default">$c</span><span class="keyword">, </span><span class="default">CURLOPT_RETURNTRANSFER</span><span class="keyword">, </span><span class="default">1</span><span class="keyword">); </span><span class="comment">// get the response as a string from curl_exec(), rather than echoing it<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">curl_setopt</span><span class="keyword">(</span><span class="default">$c</span><span class="keyword">, </span><span class="default">CURLOPT_FRESH_CONNECT</span><span class="keyword">, </span><span class="default">1</span><span class="keyword">); </span><span class="comment">// don't use a cached version of the url<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">if (!</span><span class="default">curl_exec</span><span class="keyword">(</span><span class="default">$c</span><span class="keyword">)) { return </span><span class="default">false</span><span class="keyword">; }<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$httpcode </span><span class="keyword">= </span><span class="default">curl_getinfo</span><span class="keyword">(</span><span class="default">$c</span><span class="keyword">, </span><span class="default">CURLINFO_HTTP_CODE</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; return (</span><span class="default">$httpcode </span><span class="keyword">&lt; </span><span class="default">400</span><span class="keyword">);<br />
}<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="81581""></a>
  <div class="note">
   <strong class="user">c00lways at gmail dot com</strong>
   <a href="#81581" class="date">04-Mar-2008 10:16</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
if you would like to send xml request to a server (lets say, making a soap proxy),<br />
you have to set<br />
<br />
<span class="default">&lt;?php<br />
curl_setopt</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">, </span><span class="default">CURLOPT_HTTPHEADER</span><span class="keyword">, Array(</span><span class="string">"Content-Type: text/xml"</span><span class="keyword">));<br />
</span><span class="default">?&gt;<br />
</span><br />
makesure you watch for cache issue:<br />
the below code will prevent cache...<br />
<br />
<span class="default">&lt;?php<br />
curl_setopt</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">, </span><span class="default">CURLOPT_FORBID_REUSE</span><span class="keyword">, </span><span class="default">1</span><span class="keyword">);<br />
</span><span class="default">curl_setopt</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">, </span><span class="default">CURLOPT_FRESH_CONNECT</span><span class="keyword">, </span><span class="default">1</span><span class="keyword">);<br />
</span><span class="default">?&gt;<br />
</span><br />
hope it helps ;)</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="81161""></a>
  <div class="note">
   <strong class="user">mavook at gmail dot com</strong>
   <a href="#81161" class="date">16-Feb-2008 07:26</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If you try to upload file to a server, you need do CURLOPT_POST first and then fill CURLOPT_POSTFIELDS.<br />
<br />
<span class="default">&lt;?php<br />
curl_setopt</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">, </span><span class="default">CURLOPT_POST</span><span class="keyword">, </span><span class="default">1</span><span class="keyword">);<br />
</span><span class="default">curl_setopt</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">, </span><span class="default">CURLOPT_POSTFIELDS</span><span class="keyword">, </span><span class="default">$postvars</span><span class="keyword">);<br />
</span><span class="comment">// ^^ This will post multipart/form-data<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="80271""></a>
  <div class="note">
   <strong class="user">jade dot skaggs at gmail dot com</strong>
   <a href="#80271" class="date">07-Jan-2008 06:48</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
After much struggling, I managed to get a SOAP request requiring HTTP authentication to work.&nbsp; Here's some source that will hopefully be useful to others. <br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; <span class="default">&lt;?php<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; $credentials </span><span class="keyword">= </span><span class="string">"username:password"</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="comment">// Read the XML to send to the Web Service<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$request_file </span><span class="keyword">= </span><span class="string">"./SampleRequest.xml"</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$fh </span><span class="keyword">= </span><span class="default">fopen</span><span class="keyword">(</span><span class="default">$request_file</span><span class="keyword">, </span><span class="string">'r'</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$xml_data </span><span class="keyword">= </span><span class="default">fread</span><span class="keyword">(</span><span class="default">$fh</span><span class="keyword">, </span><span class="default">filesize</span><span class="keyword">(</span><span class="default">$request_file</span><span class="keyword">));<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">fclose</span><span class="keyword">(</span><span class="default">$fh</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$url </span><span class="keyword">= </span><span class="string">"<a href="http://www.example.com/services/calculation" rel="nofollow" target="_blank">http://www.example.com/services/calculation</a>"</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$page </span><span class="keyword">= </span><span class="string">"/services/calculation"</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$headers </span><span class="keyword">= array(<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="string">"POST "</span><span class="keyword">.</span><span class="default">$page</span><span class="keyword">.</span><span class="string">" HTTP/1.0"</span><span class="keyword">,<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="string">"Content-type: text/xml;charset=\"utf-8\""</span><span class="keyword">,<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="string">"Accept: text/xml"</span><span class="keyword">,<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="string">"Cache-Control: no-cache"</span><span class="keyword">,<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="string">"Pragma: no-cache"</span><span class="keyword">,<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="string">"SOAPAction: \"run\""</span><span class="keyword">,<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="string">"Content-length: "</span><span class="keyword">.</span><span class="default">strlen</span><span class="keyword">(</span><span class="default">$xml_data</span><span class="keyword">),<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="string">"Authorization: Basic " </span><span class="keyword">. </span><span class="default">base64_encode</span><span class="keyword">(</span><span class="default">$credentials</span><span class="keyword">)<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; );<br />
&nbsp;&nbsp; &nbsp; &nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$ch </span><span class="keyword">= </span><span class="default">curl_init</span><span class="keyword">();<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">curl_setopt</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">, </span><span class="default">CURLOPT_URL</span><span class="keyword">,</span><span class="default">$url</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">curl_setopt</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">, </span><span class="default">CURLOPT_RETURNTRANSFER</span><span class="keyword">, </span><span class="default">1</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">curl_setopt</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">, </span><span class="default">CURLOPT_TIMEOUT</span><span class="keyword">, </span><span class="default">60</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">curl_setopt</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">, </span><span class="default">CURLOPT_HTTPHEADER</span><span class="keyword">, </span><span class="default">$headers</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">curl_setopt</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">, </span><span class="default">CURLOPT_USERAGENT</span><span class="keyword">, </span><span class="default">$defined_vars</span><span class="keyword">[</span><span class="string">'HTTP_USER_AGENT'</span><span class="keyword">]);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// Apply the XML to our curl call<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">curl_setopt</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">, </span><span class="default">CURLOPT_POST</span><span class="keyword">, </span><span class="default">1</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">curl_setopt</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">, </span><span class="default">CURLOPT_POSTFIELDS</span><span class="keyword">, </span><span class="default">$xml_data</span><span class="keyword">); <br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$data </span><span class="keyword">= </span><span class="default">curl_exec</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">); <br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">curl_errno</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">)) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; print </span><span class="string">"Error: " </span><span class="keyword">. </span><span class="default">curl_error</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; } else {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// Show me the result<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">var_dump</span><span class="keyword">(</span><span class="default">$data</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">curl_close</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="78046""></a>
  <div class="note">
   <strong class="user">Ojas Ojasvi</strong>
   <a href="#78046" class="date">25-Sep-2007 07:52</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
<span class="default">&lt;?php<br />
</span><span class="comment">/*<br />
* Author: Ojas Ojasvi<br />
* Released: September 25, 2007<br />
* Description: An example of the disguise_curl() function in order to grab contents from a website while remaining fully camouflaged by using a fake user agent and fake headers.<br />
*/<br />
<br />
</span><span class="default">$url </span><span class="keyword">= </span><span class="string">'<a href="http://www.php.net" rel="nofollow" target="_blank">http://www.php.net</a>'</span><span class="keyword">;<br />
<br />
</span><span class="comment">// disguises the curl using fake headers and a fake user agent.<br />
</span><span class="keyword">function </span><span class="default">disguise_curl</span><span class="keyword">(</span><span class="default">$url</span><span class="keyword">)<br />
{<br />
&nbsp; </span><span class="default">$curl </span><span class="keyword">= </span><span class="default">curl_init</span><span class="keyword">();<br />
<br />
&nbsp; </span><span class="comment">// Setup headers - I used the same headers from Firefox version 2.0.0.6<br />
&nbsp; // below was split up because php.net said the line was too long. :/<br />
&nbsp; </span><span class="default">$header</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">] = </span><span class="string">"Accept: text/xml,application/xml,application/xhtml+xml,"</span><span class="keyword">;<br />
&nbsp; </span><span class="default">$header</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">] .= </span><span class="string">"text/html;q=0.9,text/plain;q=0.8,image/png,*/*;q=0.5"</span><span class="keyword">;<br />
&nbsp; </span><span class="default">$header</span><span class="keyword">[] = </span><span class="string">"Cache-Control: max-age=0"</span><span class="keyword">;<br />
&nbsp; </span><span class="default">$header</span><span class="keyword">[] = </span><span class="string">"Connection: keep-alive"</span><span class="keyword">;<br />
&nbsp; </span><span class="default">$header</span><span class="keyword">[] = </span><span class="string">"Keep-Alive: 300"</span><span class="keyword">;<br />
&nbsp; </span><span class="default">$header</span><span class="keyword">[] = </span><span class="string">"Accept-Charset: ISO-8859-1,utf-8;q=0.7,*;q=0.7"</span><span class="keyword">;<br />
&nbsp; </span><span class="default">$header</span><span class="keyword">[] = </span><span class="string">"Accept-Language: en-us,en;q=0.5"</span><span class="keyword">;<br />
&nbsp; </span><span class="default">$header</span><span class="keyword">[] = </span><span class="string">"Pragma: "</span><span class="keyword">; </span><span class="comment">// browsers keep this blank.<br />
<br />
&nbsp; </span><span class="default">curl_setopt</span><span class="keyword">(</span><span class="default">$curl</span><span class="keyword">, </span><span class="default">CURLOPT_URL</span><span class="keyword">, </span><span class="default">$url</span><span class="keyword">);<br />
&nbsp; </span><span class="default">curl_setopt</span><span class="keyword">(</span><span class="default">$curl</span><span class="keyword">, </span><span class="default">CURLOPT_USERAGENT</span><span class="keyword">, </span><span class="string">'Googlebot/2.1 (+<a href="http://www.google.com/bot.html" rel="nofollow" target="_blank">http://www.google.com/bot.html</a>)'</span><span class="keyword">);<br />
&nbsp; </span><span class="default">curl_setopt</span><span class="keyword">(</span><span class="default">$curl</span><span class="keyword">, </span><span class="default">CURLOPT_HTTPHEADER</span><span class="keyword">, </span><span class="default">$header</span><span class="keyword">);<br />
&nbsp; </span><span class="default">curl_setopt</span><span class="keyword">(</span><span class="default">$curl</span><span class="keyword">, </span><span class="default">CURLOPT_REFERER</span><span class="keyword">, </span><span class="string">'<a href="http://www.google.com" rel="nofollow" target="_blank">http://www.google.com</a>'</span><span class="keyword">);<br />
&nbsp; </span><span class="default">curl_setopt</span><span class="keyword">(</span><span class="default">$curl</span><span class="keyword">, </span><span class="default">CURLOPT_ENCODING</span><span class="keyword">, </span><span class="string">'gzip,deflate'</span><span class="keyword">);<br />
&nbsp; </span><span class="default">curl_setopt</span><span class="keyword">(</span><span class="default">$curl</span><span class="keyword">, </span><span class="default">CURLOPT_AUTOREFERER</span><span class="keyword">, </span><span class="default">true</span><span class="keyword">);<br />
&nbsp; </span><span class="default">curl_setopt</span><span class="keyword">(</span><span class="default">$curl</span><span class="keyword">, </span><span class="default">CURLOPT_RETURNTRANSFER</span><span class="keyword">, </span><span class="default">1</span><span class="keyword">);<br />
&nbsp; </span><span class="default">curl_setopt</span><span class="keyword">(</span><span class="default">$curl</span><span class="keyword">, </span><span class="default">CURLOPT_TIMEOUT</span><span class="keyword">, </span><span class="default">10</span><span class="keyword">);<br />
<br />
&nbsp; </span><span class="default">$html </span><span class="keyword">= </span><span class="default">curl_exec</span><span class="keyword">(</span><span class="default">$curl</span><span class="keyword">); </span><span class="comment">// execute the curl command<br />
&nbsp; </span><span class="default">curl_close</span><span class="keyword">(</span><span class="default">$curl</span><span class="keyword">); </span><span class="comment">// close the connection<br />
<br />
&nbsp; </span><span class="keyword">return </span><span class="default">$html</span><span class="keyword">; </span><span class="comment">// and finally, return $html<br />
</span><span class="keyword">}<br />
<br />
</span><span class="comment">// uses the function and displays the text off the website<br />
</span><span class="default">$text </span><span class="keyword">= </span><span class="default">disguise_curl</span><span class="keyword">(</span><span class="default">$url</span><span class="keyword">);<br />
echo </span><span class="default">$text</span><span class="keyword">;<br />
</span><span class="default">?&gt;<br />
</span><br />
Ojas Ojasvi</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="77502""></a>
  <div class="note">
   <strong class="user">charles at tastik dot net</strong>
   <a href="#77502" class="date">01-Sep-2007 11:27</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
FYI,<br />
<br />
Anyone trying to connect to .NET with CURL to send a simple XML post, pay attention to the following. This will save you hours! There is a previous note that I saw either on this page, or somewhere else on this site that explains the correct way to specify the header option is to create an array, then reference the array from the CURLOPT. <br />
<br />
ie.&nbsp; Do something like this:<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="comment">// Req. HTTP Header Values <br />
&nbsp;</span><span class="default">$header</span><span class="keyword">[] = </span><span class="string">"Content-type: text/xml"</span><span class="keyword">;<br />
<br />
</span><span class="comment">// Target URL<br />
&nbsp;</span><span class="default">$sendTo </span><span class="keyword">= </span><span class="string">"<a href="http://www.example.com" rel="nofollow" target="_blank">http://www.example.com</a>"</span><span class="keyword">;<br />
<br />
</span><span class="comment">// Post Data<br />
&nbsp;</span><span class="default">$post </span><span class="keyword">= </span><span class="string">"&lt;?xml version=\"1.0\" encoding=\"utf-8\"?&gt;\n&lt;root&gt;\n....etc, etc,"</span><span class="keyword">;<br />
<br />
</span><span class="comment">// Create CURL Connection<br />
&nbsp;</span><span class="default">$ch </span><span class="keyword">= </span><span class="default">curl_init</span><span class="keyword">();<br />
&nbsp;</span><span class="default">curl_setopt</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">, </span><span class="default">CURLOPT_USERAGENT</span><span class="keyword">, </span><span class="string">'XtraDoh xAgent'</span><span class="keyword">);<br />
&nbsp;</span><span class="default">curl_setopt</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">, </span><span class="default">CURLOPT_URL</span><span class="keyword">, </span><span class="default">$sendTo</span><span class="keyword">);<br />
&nbsp;</span><span class="default">curl_setopt</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">, </span><span class="default">CURLOPT_TIMEOUT</span><span class="keyword">, </span><span class="default">900</span><span class="keyword">);<br />
&nbsp;</span><span class="default">curl_setopt</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">, </span><span class="default">CURLOPT_CONNECTIONTIMEOUT</span><span class="keyword">, </span><span class="default">30</span><span class="keyword">);<br />
&nbsp;</span><span class="default">curl_setopt</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">, </span><span class="default">CURLOPT_FAILONERROR</span><span class="keyword">, </span><span class="default">false</span><span class="keyword">);<br />
&nbsp;</span><span class="default">curl_setopt</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">, </span><span class="default">CURLOPT_SSL_VERIFYHOST</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">);<br />
&nbsp;</span><span class="default">curl_setopt</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">, </span><span class="default">CURLOPT_SSL_VERIFYPEER</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">);<br />
&nbsp;</span><span class="default">curl_setopt</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">, </span><span class="default">CURLOPT_FOLLOWLOCATION</span><span class="keyword">, </span><span class="default">true</span><span class="keyword">);<br />
&nbsp;</span><span class="default">curl_setopt</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">, </span><span class="default">CURLOPT_RETURNTRANSFER</span><span class="keyword">, </span><span class="default">true</span><span class="keyword">);<br />
&nbsp;</span><span class="default">curl_setopt</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">, </span><span class="default">CURLOPT_HTTPHEADER</span><span class="keyword">, </span><span class="default">$header</span><span class="keyword">);<br />
&nbsp;</span><span class="default">curl_setopt</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">, </span><span class="default">CURLOPT_POST</span><span class="keyword">, </span><span class="default">true</span><span class="keyword">);<br />
&nbsp;</span><span class="default">curl_setopt</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">, </span><span class="default">CURLOPT_POSTFIELDS</span><span class="keyword">, </span><span class="default">$post</span><span class="keyword">);<br />
</span><span class="default">?&gt;<br />
</span><br />
Notice the HTTPHEADER, $header above. I have not been able to get .NET to properly read the HTTP header as specified (in this case as text/xml) when using the following:<br />
<br />
<span class="default">&lt;?php<br />
curl_setopt</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">, </span><span class="default">CURLOPT_HTTPHEADER</span><span class="keyword">, array(</span><span class="string">'Content-Type'</span><span class="keyword">=&gt;</span><span class="string">'text/xml'</span><span class="keyword">));<br />
</span><span class="default">?&gt;<br />
</span><br />
Although this may work when working with other PHP, IIS, or even PHP, Apache, it does not (at least in my experience) work with .NET, IIS.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="77224""></a>
  <div class="note">
   <strong class="user">andrabr at gmail dot com</strong>
   <a href="#77224" class="date">20-Aug-2007 11:03</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
This is very clear in hindsight, but it still cost me several hours:<br />
<br />
<span class="default">&lt;?php curl_setopt</span><span class="keyword">(</span><span class="default">$session</span><span class="keyword">, </span><span class="default">CURLOPT_HTTPPROXYTUNNEL</span><span class="keyword">, </span><span class="default">1</span><span class="keyword">); </span><span class="default">?&gt;<br />
</span><br />
means that you will tunnel THROUGH the proxy, as in "your communications will go as if the proxy is NOT THERE".<br />
<br />
Why do you care? - Well, if you are trying to use, say, Paros, to debug HTTP between your cURL and the server, with CURLOPT_HTTPPROXYTUNNEL set to TRUE Paros will not see or log your traffic thus defeating the purpose and driving you nuts.<br />
<br />
There are other cases, of course, where this option is extremely useful...</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="76219""></a>
  <div class="note">
   <strong class="user">michael sky</strong>
   <a href="#76219" class="date">06-Jul-2007 12:09</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
if you are trying to connect to 'https://...' and after that want to work with POST data - that's the way:<br />
<br />
<span class="default">&lt;?php<br />
$curl </span><span class="keyword">= </span><span class="default">curl_init</span><span class="keyword">();<br />
</span><span class="default">curl_setopt</span><span class="keyword">(</span><span class="default">$curl</span><span class="keyword">, </span><span class="default">CURLOPT_SSL_VERIFYPEER</span><span class="keyword">, </span><span class="default">FALSE</span><span class="keyword">);<br />
</span><span class="default">curl_setopt</span><span class="keyword">(</span><span class="default">$curl</span><span class="keyword">, </span><span class="default">CURLOPT_HEADER</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">);<br />
</span><span class="default">curl_setopt</span><span class="keyword">(</span><span class="default">$curl</span><span class="keyword">, </span><span class="default">CURLOPT_POST</span><span class="keyword">, </span><span class="default">true</span><span class="keyword">);<br />
</span><span class="default">curl_setopt</span><span class="keyword">(</span><span class="default">$curl</span><span class="keyword">, </span><span class="default">CURLOPT_RETURNTRANSFER</span><span class="keyword">, </span><span class="default">true</span><span class="keyword">);<br />
</span><span class="default">curl_setopt</span><span class="keyword">(</span><span class="default">$curl</span><span class="keyword">, </span><span class="default">CURLOPT_USERAGENT</span><span class="keyword">, </span><span class="string">"Mozilla/4.0 (compatible; MSIE 5.01; Windows NT 5.0)"</span><span class="keyword">);<br />
</span><span class="default">curl_setopt</span><span class="keyword">(</span><span class="default">$curl</span><span class="keyword">, </span><span class="default">CURLOPT_FOLLOWLOCATION</span><span class="keyword">, </span><span class="default">true</span><span class="keyword">);<br />
</span><span class="default">curl_setopt</span><span class="keyword">(</span><span class="default">$curl</span><span class="keyword">, </span><span class="default">CURLOPT_COOKIEFILE</span><span class="keyword">, </span><span class="string">"cookiefile"</span><span class="keyword">);<br />
</span><span class="default">curl_setopt</span><span class="keyword">(</span><span class="default">$curl</span><span class="keyword">, </span><span class="default">CURLOPT_COOKIEJAR</span><span class="keyword">, </span><span class="string">"cookiefile"</span><span class="keyword">); </span><span class="comment"># SAME cookiefile<br />
</span><span class="default">curl_setopt</span><span class="keyword">(</span><span class="default">$curl</span><span class="keyword">, </span><span class="default">CURLOPT_URL</span><span class="keyword">, </span><span class="string">"url1"</span><span class="keyword">); </span><span class="comment"># this is where you first time connect - GET method authorization in my case, if you have POST - need to edit code a bit<br />
</span><span class="default">$xxx </span><span class="keyword">= </span><span class="default">curl_exec</span><span class="keyword">(</span><span class="default">$curl</span><span class="keyword">);<br />
<br />
</span><span class="default">curl_setopt</span><span class="keyword">(</span><span class="default">$curl</span><span class="keyword">, </span><span class="default">CURLOPT_URL</span><span class="keyword">, </span><span class="string">"url2"</span><span class="keyword">); </span><span class="comment"># this is where you are requesting POST-method form results (working with secure connection using cookies after auth)<br />
</span><span class="default">curl_setopt</span><span class="keyword">(</span><span class="default">$curl</span><span class="keyword">, </span><span class="default">CURLOPT_POSTFIELDS</span><span class="keyword">, </span><span class="string">"var1=value&amp;var2=value&amp;var3=value&amp;"</span><span class="keyword">); </span><span class="comment"># form params that'll be used to get form results<br />
</span><span class="default">$xxx </span><span class="keyword">= </span><span class="default">curl_exec</span><span class="keyword">(</span><span class="default">$curl</span><span class="keyword">);<br />
<br />
</span><span class="default">curl_close </span><span class="keyword">(</span><span class="default">$curl</span><span class="keyword">);<br />
echo </span><span class="default">$xxx</span><span class="keyword">;<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="75711""></a>
  <div class="note">
   <strong class="user">mcbreen at gmail dot com</strong>
   <a href="#75711" class="date">12-Jun-2007 11:35</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If you are getting the following error:<br />
<br />
SSL: certificate subject name 'example.com' does not match target host name 'example.net'<br />
<br />
Then you can set the following option to get around it:<br />
<br />
<span class="default">&lt;?php curl_setopt</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">, </span><span class="default">CURLOPT_SSL_VERIFYHOST</span><span class="keyword">, </span><span class="default">FALSE</span><span class="keyword">); </span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="75693""></a>
  <div class="note">
   <strong class="user">vincent at ludden dot nl</strong>
   <a href="#75693" class="date">12-Jun-2007 10:55</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Please note that the CURLOPT_INTERFACE setting only accepts IP addresses and hostnames of the local machine. It is not meant to send a URL to a specific IP address.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="75525""></a>
  <div class="note">
   <strong class="user">ashw1 - at - no spam - post - dot - cz</strong>
   <a href="#75525" class="date">04-Jun-2007 01:51</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
In case you wonder how come, that cookies don't work under Windows, I've googled for some answers, and here is the result: Under WIN you need to input absolute path of the cookie file.<br />
<br />
This piece of code solves it:<br />
<br />
<span class="default">&lt;?php<br />
<br />
</span><span class="keyword">if (</span><span class="default">$cookies </span><span class="keyword">!= </span><span class="string">''</span><span class="keyword">)<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp;&nbsp; if (</span><span class="default">substr</span><span class="keyword">(</span><span class="default">PHP_OS</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">3</span><span class="keyword">) == </span><span class="string">'WIN'</span><span class="keyword">)<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; {</span><span class="default">$cookies </span><span class="keyword">= </span><span class="default">str_replace</span><span class="keyword">(</span><span class="string">'\\'</span><span class="keyword">,</span><span class="string">'/'</span><span class="keyword">, </span><span class="default">getcwd</span><span class="keyword">().</span><span class="string">'/'</span><span class="keyword">.</span><span class="default">$cookies</span><span class="keyword">);}<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">curl_setopt</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">, </span><span class="default">CURLOPT_COOKIEJAR</span><span class="keyword">, </span><span class="default">$cookies</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">curl_setopt</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">, </span><span class="default">CURLOPT_COOKIEFILE</span><span class="keyword">, </span><span class="default">$cookies</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; }<br />
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="75096""></a>
  <div class="note">
   <strong class="user">Jon Freilich</strong>
   <a href="#75096" class="date">12-May-2007 06:52</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
curl will sometimes return an "Empty reply from server" error if you don't send a User-Agent string.&nbsp; Use the CURLOPT_USERAGENT option.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="74709""></a>
  <div class="note">
   <strong class="user">rob at infoglobe dot net</strong>
   <a href="#74709" class="date">24-Apr-2007 06:01</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Options not included in the above, but that work (Taken from the libcurl.a C documentation)<br />
<br />
CURLOPT_FTP_SSL <br />
<br />
Pass a long using one of the values from below, to make libcurl use your desired level of SSL for the ftp transfer. (Added in 7.11.0) <br />
<br />
CURLFTPSSL_NONE <br />
<br />
Don't attempt to use SSL. <br />
<br />
CURLFTPSSL_TRY <br />
<br />
Try using SSL, proceed as normal otherwise. <br />
<br />
CURLFTPSSL_CONTROL <br />
<br />
Require SSL for the control connection or fail with CURLE_FTP_SSL_FAILED. <br />
<br />
CURLFTPSSL_ALL <br />
<br />
Require SSL for all communication or fail with CURLE_FTP_SSL_FAILED.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="73871""></a>
  <div class="note">
   <strong class="user">alfredoaguirre dot v at gmail dot com</strong>
   <a href="#73871" class="date">14-Mar-2007 01:26</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Seems that CURLOPT_RETURNTRANSFER Option set to TRUE, returns a "1" when the transaction returns a blank page.<br />
<br />
I think is for eliminate the FALSE to can be with a blank page as return</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="73742""></a>
  <div class="note">
   <strong class="user">paczor</strong>
   <a href="#73742" class="date">08-Mar-2007 03:50</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
How to get rid of response after POST: just add callback function for returned data (CURLOPT_WRITEFUNCTION) and make this function empty.<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">function </span><span class="default">curlHeaderCallback</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">, </span><span class="default">$strHeader</span><span class="keyword">) {<br />
}<br />
</span><span class="default">curl_setopt</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">, </span><span class="default">CURLOPT_WRITEFUNCTION</span><span class="keyword">, </span><span class="string">'curlHeaderCallback'</span><span class="keyword">);<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="71326""></a>
  <div class="note">
   <strong class="user">pyroevi at yahoo dot com</strong>
   <a href="#71326" class="date">22-Nov-2006 07:33</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I was working on using php to interface with an authorize.net gateway, and I ran into a problem with certificates using curl to talk the https:// url.<br />
<br />
curl_error() told me "SSL certificate problem, verify that the CA cert is OK."<br />
<br />
I googled it and found the same "solution" over and over again: bypass verification by adding this line after curl_init():<br />
<br />
<span class="default">&lt;?php<br />
curl_setopt</span><span class="keyword">(</span><span class="default">$connection</span><span class="keyword">, </span><span class="default">CURLOPT_SSL_VERIFYPEER</span><span class="keyword">, </span><span class="default">false</span><span class="keyword">);<br />
</span><span class="default">?&gt;<br />
</span><br />
This worked great, but I was required to verify, so here's what I did. Add the following lines:<br />
<br />
<span class="default">&lt;?php<br />
curl_setopt</span><span class="keyword">(</span><span class="default">$connection</span><span class="keyword">, </span><span class="default">CURLOPT_SSL_VERIFYPEER</span><span class="keyword">, </span><span class="default">1</span><span class="keyword">);<br />
</span><span class="default">curl_setopt</span><span class="keyword">(</span><span class="default">$connection</span><span class="keyword">, </span><span class="default">CURLOPT_CAINFO</span><span class="keyword">, </span><span class="string">"path:/ca-bundle.crt"</span><span class="keyword">);<br />
</span><span class="default">?&gt;<br />
</span><br />
with "path:/ca-bundle.crt" being the path to that certificate file. You can get this file by downloading the curl package (<a href="http://curl.haxx.se/download.html" rel="nofollow" target="_blank">http://curl.haxx.se/download.html</a>) and looking for it in the lib folder.<br />
<br />
Feel free to email me.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="71313""></a>
  <div class="note">
   <strong class="user">eion at bigfoot dot com</strong>
   <a href="#71313" class="date">22-Nov-2006 05:40</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If you are trying to use CURLOPT_FOLLOWLOCATION and you get this warning:<br />
Warning: curl_setopt() [function.curl-setopt]: CURLOPT_FOLLOWLOCATION cannot be activated when in safe_mode or an open_basedir is set...<br />
<br />
then you will want to read <a href="http://www.php.net/ChangeLog-4.php which says " rel="nofollow" target="_blank">http://www.php.net/ChangeLog-4.php which says </a>"Disabled CURLOPT_FOLLOWLOCATION in curl when open_basedir or safe_mode are enabled." as of PHP 4.4.4/5.1.5.&nbsp; This is due to the fact that curl is not part of PHP and doesn't know the values of open_basedir or safe_mode, so you could comprimise your webserver operating in safe_mode by redirecting (using header('Location: ...')) to "file://" urls, which curl would have gladly retrieved.<br />
<br />
Until the curl extension is changed in PHP or curl (if it ever will) to deal with "Location:" headers, here is a far from perfect remake of the curl_exec function that I am using.<br />
<br />
Since there's no curl_getopt function equivalent, you'll have to tweak the function to make it work for your specific use.&nbsp; As it is here, it returns the body of the response and not the header.&nbsp; It also doesn't deal with redirection urls with username and passwords in them.<br />
<br />
<span class="default">&lt;?php<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">function </span><span class="default">curl_redir_exec</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">)<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; static </span><span class="default">$curl_loops </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; static </span><span class="default">$curl_max_loops </span><span class="keyword">= </span><span class="default">20</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">$curl_loops</span><span class="keyword">++ &gt;= </span><span class="default">$curl_max_loops</span><span class="keyword">)<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$curl_loops </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">FALSE</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">curl_setopt</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">, </span><span class="default">CURLOPT_HEADER</span><span class="keyword">, </span><span class="default">true</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">curl_setopt</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">, </span><span class="default">CURLOPT_RETURNTRANSFER</span><span class="keyword">, </span><span class="default">true</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$data </span><span class="keyword">= </span><span class="default">curl_exec</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; list(</span><span class="default">$header</span><span class="keyword">, </span><span class="default">$data</span><span class="keyword">) = </span><span class="default">explode</span><span class="keyword">(</span><span class="string">"\n\n"</span><span class="keyword">, </span><span class="default">$data</span><span class="keyword">, </span><span class="default">2</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$http_code </span><span class="keyword">= </span><span class="default">curl_getinfo</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">, </span><span class="default">CURLINFO_HTTP_CODE</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">$http_code </span><span class="keyword">== </span><span class="default">301 </span><span class="keyword">|| </span><span class="default">$http_code </span><span class="keyword">== </span><span class="default">302</span><span class="keyword">)<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$matches </span><span class="keyword">= array();<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">preg_match</span><span class="keyword">(</span><span class="string">'/Location:(.*?)\n/'</span><span class="keyword">, </span><span class="default">$header</span><span class="keyword">, </span><span class="default">$matches</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$url </span><span class="keyword">= @</span><span class="default">parse_url</span><span class="keyword">(</span><span class="default">trim</span><span class="keyword">(</span><span class="default">array_pop</span><span class="keyword">(</span><span class="default">$matches</span><span class="keyword">)));<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if (!</span><span class="default">$url</span><span class="keyword">)<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">//couldn't process the url to redirect to<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$curl_loops </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">$data</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$last_url </span><span class="keyword">= </span><span class="default">parse_url</span><span class="keyword">(</span><span class="default">curl_getinfo</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">, </span><span class="default">CURLINFO_EFFECTIVE_URL</span><span class="keyword">));<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if (!</span><span class="default">$url</span><span class="keyword">[</span><span class="string">'scheme'</span><span class="keyword">])<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$url</span><span class="keyword">[</span><span class="string">'scheme'</span><span class="keyword">] = </span><span class="default">$last_url</span><span class="keyword">[</span><span class="string">'scheme'</span><span class="keyword">];<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if (!</span><span class="default">$url</span><span class="keyword">[</span><span class="string">'host'</span><span class="keyword">])<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$url</span><span class="keyword">[</span><span class="string">'host'</span><span class="keyword">] = </span><span class="default">$last_url</span><span class="keyword">[</span><span class="string">'host'</span><span class="keyword">];<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if (!</span><span class="default">$url</span><span class="keyword">[</span><span class="string">'path'</span><span class="keyword">])<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$url</span><span class="keyword">[</span><span class="string">'path'</span><span class="keyword">] = </span><span class="default">$last_url</span><span class="keyword">[</span><span class="string">'path'</span><span class="keyword">];<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$new_url </span><span class="keyword">= </span><span class="default">$url</span><span class="keyword">[</span><span class="string">'scheme'</span><span class="keyword">] . </span><span class="string">'://' </span><span class="keyword">. </span><span class="default">$url</span><span class="keyword">[</span><span class="string">'host'</span><span class="keyword">] . </span><span class="default">$url</span><span class="keyword">[</span><span class="string">'path'</span><span class="keyword">] . (</span><span class="default">$url</span><span class="keyword">[</span><span class="string">'query'</span><span class="keyword">]?</span><span class="string">'?'</span><span class="keyword">.</span><span class="default">$url</span><span class="keyword">[</span><span class="string">'query'</span><span class="keyword">]:</span><span class="string">''</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">curl_setopt</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">, </span><span class="default">CURLOPT_URL</span><span class="keyword">, </span><span class="default">$new_url</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">debug</span><span class="keyword">(</span><span class="string">'Redirecting to'</span><span class="keyword">, </span><span class="default">$new_url</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">curl_redir_exec</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; } else {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$curl_loops</span><span class="keyword">=</span><span class="default">0</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">$data</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; }<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="69115""></a>
  <div class="note">
   <strong class="user">php at miggy dot org</strong>
   <a href="#69115" class="date">23-Aug-2006 07:35</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Note that if you want to use a proxy and use it as a _cache_, you'll have to do:<br />
<br />
<span class="default">&lt;?php curl_setopt</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">, </span><span class="default">CURLOPT_HTTPHEADER</span><span class="keyword">, array(</span><span class="string">"Pragma: "</span><span class="keyword">)); </span><span class="default">?&gt;<br />
</span><br />
else by default Curl puts a "Pragma: no-cache" header in and thus force cache misses for all requests.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="66832""></a>
  <div class="note">
   <strong class="user">Philippe dot Jausions at 11abacus dot com</strong>
   <a href="#66832" class="date">30-May-2006 08:31</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Clarification on the callback methods:<br />
<br />
- CURLOPT_HEADERFUNCTION is for handling header lines received *in the response*,<br />
- CURLOPT_WRITEFUNCTION is for handling data received *from the response*,<br />
- CURLOPT_READFUNCTION is for handling data passed along *in the request*.<br />
<br />
The callback "string" can be any callable function, that includes the array(&amp;$obj, 'someMethodName') format.<br />
<br />
&nbsp;-Philippe</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="64447""></a>
  <div class="note">
   <strong class="user">mr at coder dot tv</strong>
   <a href="#64447" class="date">14-Apr-2006 04:22</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Sometimes you can't use CURLOPT_COOKIEJAR and CURLOPT_COOKIEFILE becoz of the server php-settings(They say u may grab any files from server using these options). Here is the solution<br />
1)Don't use CURLOPT_FOLLOWLOCATION<br />
2)Use curl_setopt($ch, CURLOPT_HEADER, 1)<br />
3)Grab from the header cookies like this:<br />
preg_match_all('|Set-Cookie: (.*);|U', $content, $results);&nbsp; &nbsp; <br />
$cookies = implode(';', $results[1]);<br />
4)Set them using curl_setopt($ch, CURLOPT_COOKIE,&nbsp; $cookies);<br />
<br />
Good Luck, Yevgen</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="62274""></a>
  <div class="note">
   <strong class="user">heyrocker at yahoo dot com</strong>
   <a href="#62274" class="date">23-Feb-2006 10:57</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
The examples below for HTTP file upload work great, but I wanted to be able to post multiple files through HTTP upload using HTML arrays as specified in example 38.3 at<br />
<br />
<a href="http://php.net/features.file-upload" rel="nofollow" target="_blank">http://php.net/features.file-upload</a><br />
<br />
In this case, you need to set the arrays AND keys in the $post_data, it will not work with just the array names. The following example shows how this works:<br />
<br />
<span class="default">&lt;?php<br />
<br />
&nbsp;&nbsp;&nbsp; $post_data </span><span class="keyword">= array();<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$post_data</span><span class="keyword">[</span><span class="string">'pictures[0]'</span><span class="keyword">] = </span><span class="string">"@cat.jpg"</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$post_data</span><span class="keyword">[</span><span class="string">'pictures[1]'</span><span class="keyword">] = </span><span class="string">"@dog.jpg"</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; <br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$ch </span><span class="keyword">= </span><span class="default">curl_init</span><span class="keyword">();<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">curl_setopt</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">, </span><span class="default">CURLOPT_URL</span><span class="keyword">, </span><span class="string">"<a href="http://example.com/my_url.php" rel="nofollow" target="_blank">http://example.com/my_url.php</a>" </span><span class="keyword">); <br />
&nbsp;&nbsp;&nbsp; </span><span class="default">curl_setopt</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">, </span><span class="default">CURLOPT_POST</span><span class="keyword">, </span><span class="default">1 </span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">curl_setopt</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">, </span><span class="default">CURLOPT_POSTFIELDS</span><span class="keyword">, </span><span class="default">$post_data</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">curl_setopt</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">, </span><span class="default">CURLOPT_RETURNTRANSFER</span><span class="keyword">, </span><span class="default">1</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$postResult </span><span class="keyword">= </span><span class="default">curl_exec</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">);<br />
<br />
&nbsp;&nbsp;&nbsp; if (</span><span class="default">curl_errno</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">)) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; print </span><span class="default">curl_error</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">curl_close</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; print </span><span class="string">"</span><span class="default">$postResult</span><span class="string">"</span><span class="keyword">;<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="62020""></a>
  <div class="note">
   <strong class="user">petelu $ post dot sk</strong>
   <a href="#62020" class="date">17-Feb-2006 01:19</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
load https:// or&nbsp; <a href="http://example.com/exam.php&nbsp; " rel="nofollow" target="_blank">http://example.com/exam.php&nbsp; </a><br />
with&nbsp; POST&nbsp; data (name=alex&amp;year=18) and apply COOKIEs<br />
<br />
<span class="default">&lt;?php<br />
$sessions </span><span class="keyword">= </span><span class="default">curl_init</span><span class="keyword">();<br />
</span><span class="default">curl_setopt</span><span class="keyword">(</span><span class="default">$sessions</span><span class="keyword">,</span><span class="default">CURLOPT_URL</span><span class="keyword">,</span><span class="string">'<a href="http://example.com/exam.php" rel="nofollow" target="_blank">http://example.com/exam.php</a>'</span><span class="keyword">);<br />
</span><span class="default">curl_setopt</span><span class="keyword">(</span><span class="default">$sessions</span><span class="keyword">, </span><span class="default">CURLOPT_POST</span><span class="keyword">, </span><span class="default">1</span><span class="keyword">);<br />
</span><span class="default">curl_setopt</span><span class="keyword">(</span><span class="default">$sessions</span><span class="keyword">,</span><span class="default">CURLOPT_POSTFIELDS</span><span class="keyword">,</span><span class="string">'name=alex&amp;year=18'</span><span class="keyword">);<br />
</span><span class="default">curl_setopt</span><span class="keyword">(</span><span class="default">$sessions</span><span class="keyword">,</span><span class="default">CURLOPT_COOKIEJAR</span><span class="keyword">,<br />
</span><span class="default">dirname</span><span class="keyword">(</span><span class="default">__FILE__</span><span class="keyword">).</span><span class="string">'/cookie.txt'</span><span class="keyword">);<br />
</span><span class="default">curl_setopt</span><span class="keyword">(</span><span class="default">$sessions</span><span class="keyword">,</span><span class="default">CURLOPT_FOLLOWLOCATION</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">);<br />
</span><span class="default">curl_setopt</span><span class="keyword">(</span><span class="default">$sessions</span><span class="keyword">, </span><span class="default">CURLOPT_HEADER </span><span class="keyword">, </span><span class="default">1</span><span class="keyword">);<br />
</span><span class="default">curl_setopt</span><span class="keyword">(</span><span class="default">$sessions</span><span class="keyword">, </span><span class="default">CURLOPT_RETURNTRANSFER</span><span class="keyword">,</span><span class="default">1</span><span class="keyword">);<br />
</span><span class="default">$my_load_page </span><span class="keyword">= </span><span class="default">curl_exec</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">sessions</span><span class="keyword">);<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="61395""></a>
  <div class="note">
   <strong class="user">luca dot manzo at bbsitalia dot com</strong>
   <a href="#61395" class="date">02-Feb-2006 12:55</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If you're getting trouble with cookie handling in curl: <br />
<br />
- curl manages tranparently cookies in a single curl session<br />
- the option <br />
<span class="default">&lt;?php curl_setopt</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">, </span><span class="default">CURLOPT_COOKIEJAR</span><span class="keyword">, </span><span class="string">"/tmp/cookieFileName"</span><span class="keyword">); </span><span class="default">?&gt;<br />
</span><br />
makes curl to store the cookies in a file at the and of the curl session<br />
<br />
- the option <br />
<span class="default">&lt;?php curl_setopt</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">, </span><span class="default">CURLOPT_COOKIEFILE</span><span class="keyword">, </span><span class="string">"/tmp/cookieFileName"</span><span class="keyword">); </span><span class="default">?&gt;<br />
</span><br />
makes curl to use the given file as source for the cookies to send to the server. <br />
<br />
so to handle correctly cookies between different curl session, the you have to do something like this:<br />
<br />
<span class="default">&lt;?php<br />
&nbsp;&nbsp; &nbsp; &nbsp; $ch </span><span class="keyword">= </span><span class="default">curl_init</span><span class="keyword">(); <br />
&nbsp;&nbsp; &nbsp; &nbsp; </span><span class="default">curl_setopt </span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">, </span><span class="default">CURLOPT_URL</span><span class="keyword">, </span><span class="default">$url</span><span class="keyword">); <br />
&nbsp;&nbsp; &nbsp; &nbsp; </span><span class="default">curl_setopt </span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">, </span><span class="default">CURLOPT_COOKIEJAR</span><span class="keyword">, </span><span class="default">COOKIE_FILE_PATH</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; </span><span class="default">curl_setopt </span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">, </span><span class="default">CURLOPT_COOKIEFILE</span><span class="keyword">, </span><span class="default">COOKIE_FILE_PATH</span><span class="keyword">);<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp; </span><span class="default">curl_setopt </span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">, </span><span class="default">CURLOPT_RETURNTRANSFER</span><span class="keyword">, </span><span class="default">1</span><span class="keyword">); <br />
&nbsp;&nbsp; &nbsp; &nbsp; </span><span class="default">$result </span><span class="keyword">= </span><span class="default">curl_exec </span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; </span><span class="default">curl_close</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; return </span><span class="default">$result</span><span class="keyword">;<br />
</span><span class="default">?&gt;<br />
</span><br />
in particular this is NECESSARY if you are using PEAR_SOAP libraries to build a webservice client over https and the remote server need to establish a session cookie. in fact each soap message is sent using a different curl session!!<br />
<br />
I hope this can help someone<br />
Luca</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="60142""></a>
  <div class="note">
   <strong class="user">Dustin Hawkins</strong>
   <a href="#60142" class="date">27-Dec-2005 11:24</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
To further expand upon use of CURLOPT_CAPATH and CURLOPT_CAINFO...<br />
<br />
In my case I wanted to prevent curl from talking to any HTTPS server except my own using a self signed certificate. To do this, you'll need openssl installed and access to the HTTPS Server Certificate (server.crt by default on apache)<br />
<br />
You can then use a command simiar to this to translate your apache certificate into one that curl likes.<br />
<br />
$ openssl x509 -in server.crt -out outcert.pem -text<br />
<br />
Then set CURLOPT_CAINFO equal to the the full path to outcert.pem and turn on CURLOPT_SSL_VERIFYPEER.<br />
<br />
If you want to use the CURLOPT_CAPATH option, you should create a directory for all the valid certificates you have created, then use the c_rehash script that is included with openssl to "prepare" the directory.<br />
<br />
If you dont use the c_rehash utility, curl will ignore any file in the directory you set.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="59993""></a>
  <div class="note">
   <strong class="user">skyogre __at__ yandex __dot__ ru</strong>
   <a href="#59993" class="date">22-Dec-2005 11:13</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
There is really a problem of transmitting $_POST data with curl in php 4+ at least.<br />
I improved the encoding function by Alejandro Moreno to work properly with mulltidimensional arrays.<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">function </span><span class="default">data_encode</span><span class="keyword">(</span><span class="default">$data</span><span class="keyword">, </span><span class="default">$keyprefix </span><span class="keyword">= </span><span class="string">""</span><span class="keyword">, </span><span class="default">$keypostfix </span><span class="keyword">= </span><span class="string">""</span><span class="keyword">) {<br />
&nbsp; </span><span class="default">assert</span><span class="keyword">( </span><span class="default">is_array</span><span class="keyword">(</span><span class="default">$data</span><span class="keyword">) );<br />
&nbsp; </span><span class="default">$vars</span><span class="keyword">=</span><span class="default">null</span><span class="keyword">;<br />
&nbsp; foreach(</span><span class="default">$data </span><span class="keyword">as </span><span class="default">$key</span><span class="keyword">=&gt;</span><span class="default">$value</span><span class="keyword">) {<br />
&nbsp;&nbsp;&nbsp; if(</span><span class="default">is_array</span><span class="keyword">(</span><span class="default">$value</span><span class="keyword">)) </span><span class="default">$vars </span><span class="keyword">.= </span><span class="default">data_encode</span><span class="keyword">(</span><span class="default">$value</span><span class="keyword">, </span><span class="default">$keyprefix</span><span class="keyword">.</span><span class="default">$key</span><span class="keyword">.</span><span class="default">$keypostfix</span><span class="keyword">.</span><span class="default">urlencode</span><span class="keyword">(</span><span class="string">"["</span><span class="keyword">), </span><span class="default">urlencode</span><span class="keyword">(</span><span class="string">"]"</span><span class="keyword">));<br />
&nbsp;&nbsp;&nbsp; else </span><span class="default">$vars </span><span class="keyword">.= </span><span class="default">$keyprefix</span><span class="keyword">.</span><span class="default">$key</span><span class="keyword">.</span><span class="default">$keypostfix</span><span class="keyword">.</span><span class="string">"="</span><span class="keyword">.</span><span class="default">urlencode</span><span class="keyword">(</span><span class="default">$value</span><span class="keyword">).</span><span class="string">"&amp;"</span><span class="keyword">;<br />
&nbsp; }<br />
&nbsp; return </span><span class="default">$vars</span><span class="keyword">;<br />
}<br />
<br />
</span><span class="default">curl_setopt</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">, </span><span class="default">CURLOPT_POSTFIELDS</span><span class="keyword">, </span><span class="default">substr</span><span class="keyword">(</span><span class="default">data_encode</span><span class="keyword">(</span><span class="default">$_POST</span><span class="keyword">), </span><span class="default">0</span><span class="keyword">, -</span><span class="default">1</span><span class="keyword">) );<br />
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="58074""></a>
  <div class="note">
   <strong class="user">phpnet at wafflehouse dot de</strong>
   <a href="#58074" class="date">23-Oct-2005 03:34</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Resetting CURLOPT_FILE to STDOUT won't work by calling curl_setopt() with the STDOUT constant or a php://output stream handle (at least I get error messages when trying the code from phpnet at andywaite dot com). Instead, one can simply reset it as a side effect of CURLOPT_RETURNTRANSFER. Just say<br />
<br />
<span class="default">&lt;?php curl_setopt</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">curl</span><span class="keyword">,</span><span class="default">CURLOPT_RETURNTRANSFER</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">); </span><span class="default">?&gt;<br />
</span><br />
and following calls to curl_exec() will output to STDOUT again.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="57988""></a>
  <div class="note">
   <strong class="user">webmaster () stauceni.com</strong>
   <a href="#57988" class="date">20-Oct-2005 10:42</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
A little mistake, that took a half-day to fix it:<br />
When specifing CURLOPT_COOKIEFILE or CURLOPT_COOKIEJAR options, don't forget to "chmod 777" that directory where cookie-file must be created.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="57005""></a>
  <div class="note">
   <strong class="user">ROXORT at TGNOOB dot FR</strong>
   <a href="#57005" class="date">21-Sep-2005 04:09</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
<span class="default">&lt;?php<br />
</span><span class="comment">/*<br />
&nbsp; Here is a script that is usefull to :<br />
&nbsp; - login to a POST form,<br />
&nbsp; - store a session cookie,<br />
&nbsp; - download a file once logged in.<br />
*/<br />
<br />
// INIT CURL<br />
</span><span class="default">$ch </span><span class="keyword">= </span><span class="default">curl_init</span><span class="keyword">();<br />
<br />
</span><span class="comment">// SET URL FOR THE POST FORM LOGIN<br />
</span><span class="default">curl_setopt</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">, </span><span class="default">CURLOPT_URL</span><span class="keyword">, </span><span class="string">'<a href="http://www.example.com/Members/Login.php" rel="nofollow" target="_blank">http://www.example.com/Members/Login.php</a>'</span><span class="keyword">);<br />
<br />
</span><span class="comment">// ENABLE HTTP POST<br />
</span><span class="default">curl_setopt </span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">, </span><span class="default">CURLOPT_POST</span><span class="keyword">, </span><span class="default">1</span><span class="keyword">);<br />
<br />
</span><span class="comment">// SET POST PARAMETERS : FORM VALUES FOR EACH FIELD<br />
</span><span class="default">curl_setopt </span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">, </span><span class="default">CURLOPT_POSTFIELDS</span><span class="keyword">, </span><span class="string">'fieldname1=fieldvalue1&amp;fieldname2=fieldvalue2'</span><span class="keyword">);<br />
<br />
</span><span class="comment">// IMITATE CLASSIC BROWSER'S BEHAVIOUR : HANDLE COOKIES<br />
</span><span class="default">curl_setopt </span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">, </span><span class="default">CURLOPT_COOKIEJAR</span><span class="keyword">, </span><span class="string">'cookie.txt'</span><span class="keyword">);<br />
<br />
</span><span class="comment"># Setting CURLOPT_RETURNTRANSFER variable to 1 will force cURL<br />
# not to print out the results of its query.<br />
# Instead, it will return the results as a string return value<br />
# from curl_exec() instead of the usual true/false.<br />
</span><span class="default">curl_setopt </span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">, </span><span class="default">CURLOPT_RETURNTRANSFER</span><span class="keyword">, </span><span class="default">1</span><span class="keyword">);<br />
<br />
</span><span class="comment">// EXECUTE 1st REQUEST (FORM LOGIN)<br />
</span><span class="default">$store </span><span class="keyword">= </span><span class="default">curl_exec </span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">);<br />
<br />
</span><span class="comment">// SET FILE TO DOWNLOAD<br />
</span><span class="default">curl_setopt</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">, </span><span class="default">CURLOPT_URL</span><span class="keyword">, </span><span class="string">'<a href="http://www.example.com/Members/Downloads/AnnualReport.pdf" rel="nofollow" target="_blank">http://www.example.com/Members/Downloads/AnnualReport.pdf</a>'</span><span class="keyword">);<br />
<br />
</span><span class="comment">// EXECUTE 2nd REQUEST (FILE DOWNLOAD)<br />
</span><span class="default">$content </span><span class="keyword">= </span><span class="default">curl_exec </span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">);<br />
<br />
</span><span class="comment">// CLOSE CURL<br />
</span><span class="default">curl_close </span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">); <br />
<br />
</span><span class="comment">/*<br />
&nbsp; At this point you can do do whatever you want<br />
&nbsp; with the downloaded file stored in $content :<br />
&nbsp; display it, save it as file, and so on.<br />
*/<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="56086""></a>
  <div class="note">
   <strong class="user">mcknight at chek dot com</strong>
   <a href="#56086" class="date">23-Aug-2005 05:10</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
when specifing the file for either CURLOPT_COOKIEFILE or CURLOPT_COOKIEJAR you may need to use the full file path instead of just the relative path.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="53636""></a>
  <div class="note">
   <strong class="user">phpnet at andywaite dot com</strong>
   <a href="#53636" class="date">07-Jun-2005 11:08</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
After setting CURLOPT_FILE, you may want want to revert back to the normal behaviour of displaying the results. This can be achieved using:<br />
<br />
<span class="default">&lt;?php<br />
$fp </span><span class="keyword">= </span><span class="default">fopen </span><span class="keyword">(</span><span class="string">"php://output"</span><span class="keyword">, </span><span class="string">"w"</span><span class="keyword">) or die(</span><span class="string">"Unable to open stdout for writing.\n"</span><span class="keyword">);<br />
</span><span class="default">curl_setopt</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">, </span><span class="default">CURLOPT_FILE</span><span class="keyword">, </span><span class="default">$fp</span><span class="keyword">);<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="53445""></a>
  <div class="note">
   <strong class="user">michaeledwards.com</strong>
   <a href="#53445" class="date">01-Jun-2005 11:57</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Problems can occur if you mix CURLOPT_URL with a 'Host:' header in CURLOPT_HEADERS on redirects because cURL will combine the host you explicitly stated in the 'Host:' header with the host from the Location: header of the redirect response. <br />
<br />
In short, don't do this:<br />
<br />
<span class="default">&lt;?php<br />
$host </span><span class="keyword">= </span><span class="string">"www.example.com"</span><span class="keyword">;<br />
</span><span class="default">$url </span><span class="keyword">= </span><span class="string">"<a href="http://" rel="nofollow" target="_blank">http://</a></span><span class="default">$host</span><span class="string">/"</span><span class="keyword">;<br />
<br />
</span><span class="default">$headers </span><span class="keyword">= array(</span><span class="string">"Host: </span><span class="default">$host</span><span class="string">"</span><span class="keyword">);<br />
<br />
</span><span class="default">$ch </span><span class="keyword">= </span><span class="default">curl_init</span><span class="keyword">();<br />
<br />
</span><span class="default">curl_setopt</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">, </span><span class="default">CURLOPT_URL</span><span class="keyword">, </span><span class="default">$url</span><span class="keyword">);<br />
</span><span class="default">curl_setopt</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">, </span><span class="default">CURLOPT_HTTPHEADER</span><span class="keyword">, </span><span class="default">$headers</span><span class="keyword">);<br />
<br />
Do </span><span class="default">this instead</span><span class="keyword">:<br />
<br />
</span><span class="default">$host </span><span class="keyword">= </span><span class="string">"www.example.com"</span><span class="keyword">;<br />
</span><span class="default">$url </span><span class="keyword">= </span><span class="string">"<a href="http://" rel="nofollow" target="_blank">http://</a></span><span class="default">$host</span><span class="string">/"</span><span class="keyword">;<br />
<br />
</span><span class="default">$ch </span><span class="keyword">= </span><span class="default">curl_init</span><span class="keyword">();<br />
<br />
</span><span class="default">curl_setopt</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">, </span><span class="default">CURLOPT_URL</span><span class="keyword">, </span><span class="default">$url</span><span class="keyword">);<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="52844""></a>
  <div class="note">
   <strong class="user">samlowry at e-baka dot net</strong>
   <a href="#52844" class="date">14-May-2005 03:09</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
About CURLOPT_ENCODING:<br />
added in curl in 7.10 - Oct 1 2002<br />
In 7.10.5 - May 19 2003 syntax was chnaged:<br />
"setting CURLOPT_ENCODING to "" automaticly enables all supported encodings"</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="52675""></a>
  <div class="note">
   <strong class="user">ikendra at yken dot nospam dot org</strong>
   <a href="#52675" class="date">09-May-2005 06:26</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Using cURL, I needed to call a third-party script which was returning binary data as attachment to pass on retrieved data again as attachment.<br />
<br />
Problem was that the third-party script occassionally returned HTTP errors and I wanted to avoid passing on zero-length attachment in such case.<br />
<br />
Combination of using CURLOPT_FAILONERROR and CURLOPT_HEADERFUNCTION callback helped to process the third-party script HTTP errors neatly:<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">function </span><span class="default">curlHeaderCallback</span><span class="keyword">(</span><span class="default">$resURL</span><span class="keyword">, </span><span class="default">$strHeader</span><span class="keyword">) {<br />
&nbsp;&nbsp;&nbsp; if (</span><span class="default">preg_match</span><span class="keyword">(</span><span class="string">'/^HTTP/i'</span><span class="keyword">, </span><span class="default">$strHeader</span><span class="keyword">)) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">header</span><span class="keyword">(</span><span class="default">$strHeader</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">header</span><span class="keyword">(</span><span class="string">'Content-Disposition: attachment; filename="file-name.zip"'</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; return </span><span class="default">strlen</span><span class="keyword">(</span><span class="default">$strHeader</span><span class="keyword">);<br />
}<br />
<br />
</span><span class="default">$strURL </span><span class="keyword">= </span><span class="string">'<a href="http://www.example.com/script-whichs-dumps-binary-attachment.php" rel="nofollow" target="_blank">http://www.example.com/script-whichs-dumps-binary-attachment.php</a>'</span><span class="keyword">;<br />
<br />
</span><span class="default">$resURL </span><span class="keyword">= </span><span class="default">curl_init</span><span class="keyword">();<br />
</span><span class="default">curl_setopt</span><span class="keyword">(</span><span class="default">$resURL</span><span class="keyword">, </span><span class="default">CURLOPT_URL</span><span class="keyword">, </span><span class="default">$strURL</span><span class="keyword">);<br />
</span><span class="default">curl_setopt</span><span class="keyword">(</span><span class="default">$resURL</span><span class="keyword">, </span><span class="default">CURLOPT_BINARYTRANSFER</span><span class="keyword">, </span><span class="default">1</span><span class="keyword">);<br />
</span><span class="default">curl_setopt</span><span class="keyword">(</span><span class="default">$resURL</span><span class="keyword">, </span><span class="default">CURLOPT_HEADERFUNCTION</span><span class="keyword">, </span><span class="string">'curlHeaderCallback'</span><span class="keyword">);<br />
</span><span class="default">curl_setopt</span><span class="keyword">(</span><span class="default">$resURL</span><span class="keyword">, </span><span class="default">CURLOPT_FAILONERROR</span><span class="keyword">, </span><span class="default">1</span><span class="keyword">);<br />
<br />
</span><span class="default">curl_exec </span><span class="keyword">(</span><span class="default">$resURL</span><span class="keyword">);<br />
<br />
</span><span class="default">$intReturnCode </span><span class="keyword">= </span><span class="default">curl_getinfo</span><span class="keyword">(</span><span class="default">$resURL</span><span class="keyword">, </span><span class="default">CURLINFO_HTTP_CODE</span><span class="keyword">);<br />
</span><span class="default">curl_close </span><span class="keyword">(</span><span class="default">$resURL</span><span class="keyword">);<br />
<br />
if (</span><span class="default">$intReturnCode </span><span class="keyword">!= </span><span class="default">200</span><span class="keyword">) {<br />
&nbsp;&nbsp;&nbsp; print </span><span class="string">'was error: ' </span><span class="keyword">. </span><span class="default">$intReturnCode</span><span class="keyword">;<br />
}<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="44349""></a>
  <div class="note">
   <strong class="user">raul at navenetworks dot com</strong>
   <a href="#44349" class="date">21-Jul-2004 10:19</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Hi!<br />
<br />
I have found some information I am sure it could help lot of programmers when they want to connect with curl to any https website and they haven't a good or right CA Cert :)<br />
<br />
I give you just one example It has resolved me 2 hours of my time looking for a solution.<br />
<br />
It is simple, just if you get any error in the curl_exec (use curl_error(...) to see the error to trace it) add the next line and everything is solved:<br />
<br />
(note: replace $ch with the right curl variable)<br />
<br />
curl_setopt($ch, CURLOPT_SSL_VERIFYPEER, FALSE);<br />
<br />
<span class="default">&lt;?php<br />
<br />
$ch </span><span class="keyword">= </span><span class="default">curl_init</span><span class="keyword">();<br />
</span><span class="default">$res</span><span class="keyword">= </span><span class="default">curl_setopt </span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">, </span><span class="default">CURLOPT_URL</span><span class="keyword">,</span><span class="string">"https://yoururl/cgi"</span><span class="keyword">);<br />
<br />
</span><span class="default">curl_setopt</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">, </span><span class="default">CURLOPT_SSL_VERIFYPEER</span><span class="keyword">, </span><span class="default">FALSE</span><span class="keyword">);<br />
</span><span class="default">curl_setopt </span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">, </span><span class="default">CURLOPT_HEADER</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">);<br />
</span><span class="default">curl_setopt</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">, </span><span class="default">CURLOPT_POST</span><span class="keyword">, </span><span class="default">1</span><span class="keyword">);<br />
</span><span class="default">curl_setopt</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">, </span><span class="default">CURLOPT_POSTFIELDS</span><span class="keyword">, </span><span class="string">"Idc=si&amp;"</span><span class="keyword">);<br />
</span><span class="default">curl_setopt </span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">, </span><span class="default">CURLOPT_RETURNTRANSFER</span><span class="keyword">, </span><span class="default">1</span><span class="keyword">);<br />
</span><span class="default">$xyz </span><span class="keyword">= </span><span class="default">curl_exec </span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">);<br />
<br />
</span><span class="default">curl_close </span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">);<br />
echo </span><span class="default">$xyz</span><span class="keyword">;<br />
if (</span><span class="default">$xyz </span><span class="keyword">== </span><span class="default">NULL</span><span class="keyword">) { <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; echo </span><span class="string">"Error:&lt;br&gt;"</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; echo </span><span class="default">curl_errno</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">) . </span><span class="string">" - " </span><span class="keyword">. </span><span class="default">curl_error</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">) . </span><span class="string">"&lt;br&gt;"</span><span class="keyword">;<br />
}<br />
</span><span class="default">?&gt;<br />
</span><br />
I hope this helps.<br />
<br />
Raul Mate Galan<br />
Ceo Navenetworks Corp.<br />
<br />
Note: Thanks to Ruben Lopez Gea for his help too.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="42201""></a>
  <div class="note">
   <strong class="user">ron at ttvavanti dot nl</strong>
   <a href="#42201" class="date">07-May-2004 05:00</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If you specify a CAINFO, note that the file must be in PEM format! (If not, it won't work).<br />
Using Openssl you can use: <br />
openssl x509 -in &lt;cert&gt; -inform d -outform PEM -out cert.pem <br />
To create a pem formatted certificate from a binary certificate (the one you get if you download the ca somewhere).</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="41256""></a>
  <div class="note">
   <strong class="user">Jakub Horky &lt;jakub dot php at horky dot net&gt;</strong>
   <a href="#41256" class="date">04-Apr-2004 10:20</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
A bit more documentation (without minimum version numbers):<br />
<br />
- CURLOPT_WRITEFUNCTION<br />
- CURLOPT_HEADERFUNCTION<br />
&nbsp; Pass a function which will be called to write data or headers respectively. The callback function prototype:<br />
<br />
long write_callback (resource ch, string data)<br />
<br />
The ch argument is CURL session handle. The data argument is data received. Note that its size is variable. When writing data, as much data as possible will be returned in all invokes. When writing headers, exactly one complete header line is returned for better parsing.<br />
The function must return number of bytes actually taken care of. If that amount differs from the amount passed to this function, an error will occur.<br />
<br />
- CURLOPT_READFUNCTION<br />
&nbsp; Pass a function which will be called to read data. The callback function prototype:<br />
<br />
string read_callback (resource ch, resource fd, long length)<br />
<br />
The ch argument is CURL session handle. The fd argument is file descriptor passed to CURL by CURLOPT_INFILE option. The length argument is maximum length which can be returned.<br />
The function must return string containing the data which were read. If length of the data is more than maximum length, it will be truncated to maximum length. Returning anything else than a string means an EOF.<br />
<br />
[Note: there is more callbacks implemented in current cURL library but they aren't unfortunately implemented in php curl interface yet.]</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="37530""></a>
  <div class="note">
   <strong class="user">tim dot php at ebw dot ca</strong>
   <a href="#37530" class="date">19-Nov-2003 03:18</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
The page <a href="http://curl.haxx.se/libcurl/c/curl_easy_setopt.html at the cURL site has a list of all the CURLOPTS, including many not mentioned here. Also see http://curl.haxx.se/libcurl/php/examples/ for cURL examples in PHP." rel="nofollow" target="_blank">http://curl.haxx.se/libcurl/c/curl_easy_setopt.html at the cURL site has a list of all the CURLOPTS, including many not mentioned here. Also see http://curl.haxx.se/libcurl/php/examples/ for cURL examples in PHP.</a></span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="33773""></a>
  <div class="note">
   <strong class="user">eric at imap dot ch</strong>
   <a href="#33773" class="date">07-Jul-2003 06:38</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I managed to use curl to retrieve information from severs on ports other than 80 or 443 (for https) on some installations but not on all. <br />
If you get an "CURLE_COULDNT_CONNECT /* 7 */" error, try adding the port : (for example)<br />
<br />
<span class="default">&lt;?php curl_setopt</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">, </span><span class="default">CURLOPT_PORT</span><span class="keyword">, </span><span class="default">$_SERVER</span><span class="keyword">[</span><span class="string">'SERVER_PORT'</span><span class="keyword">]); </span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="32040""></a>
  <div class="note">
   <strong class="user">me</strong>
   <a href="#32040" class="date">14-May-2003 06:36</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Just a reminder: When setting your CURLOPT_POSTFIELDS remember to replace the spaces in your values with %20</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="30906""></a>
  <div class="note">
   <strong class="user">dweingart at pobox dot com</strong>
   <a href="#30906" class="date">03-Apr-2003 12:08</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If you want to Curl to follow redirects and you would also like Curl to echo back any cookies that are set in the process, use this:<br />
<br />
<span class="default">&lt;?php curl_setopt</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">, </span><span class="default">CURLOPT_COOKIEJAR</span><span class="keyword">, </span><span class="string">'-'</span><span class="keyword">); </span><span class="default">?&gt;<br />
</span><br />
'-' means stdout<br />
<br />
-dw</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="26797""></a>
  <div class="note">
   <strong class="user">yann dot corno at free dot fr</strong>
   <a href="#26797" class="date">13-Nov-2002 01:19</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
About the CURLOPT_HTTPHEADER option, it took me some time to figure out how to format the so-called 'Array'. It fact, it is a list of strings. If Curl was already defining a header item, yours will replace it. Here is an example to change the Content Type in a POST:<br />
<br />
<span class="default">&lt;?php curl_setopt </span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">, </span><span class="default">CURLOPT_HTTPHEADER</span><span class="keyword">, Array(</span><span class="string">"Content-Type: text/xml"</span><span class="keyword">)); </span><span class="default">?&gt;<br />
</span><br />
Yann</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="26239""></a>
  <div class="note">
   
   <a href="#26239" class="date">23-Oct-2002 09:04</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
beware that not all cURLlib constants are supported under php :<br />
e.g. CURLOPT_PROGRESSFUNCTION or CURLOPT_WRITEDATA are not supported.<br />
<br />
CURLOPT_WRITEFUNCTION, although undocumented is supported. It takes the name of a user_defined function.<br />
the function should take two arguments (the curl handle, and the inputdata) and return the length of the written data<br />
e.g.<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">function </span><span class="default">myPoorProgressFunc</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">,</span><span class="default">$str</span><span class="keyword">){<br />
global </span><span class="default">$fd</span><span class="keyword">;<br />
</span><span class="default">$len </span><span class="keyword">= </span><span class="default">fwrite</span><span class="keyword">(</span><span class="default">$fd</span><span class="keyword">,</span><span class="default">$str</span><span class="keyword">);<br />
print(</span><span class="string">"#"</span><span class="keyword">);<br />
return </span><span class="default">$len</span><span class="keyword">;<br />
}<br />
<br />
</span><span class="default">curl_setopt</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">,</span><span class="default">CURLOPT_WRITEFUNCTION</span><span class="keyword">,</span><span class="string">"myPoorProgressFunc"</span><span class="keyword">);<br />
</span><span class="default">?&gt;<br />
</span><br />
Also be aware that CURLOPT_WRITEFUNCTION&nbsp; does NOT take the CURLOPT_FILE as a parameter! <br />
in curl lib it would take CURLOPT_WRITEDATA but this is not supported by php; that's why I use "global $fd;" in my exemple function.<br />
<br />
CURLOPT_HEADERFUNCTION works the same, and is guaranteed to receive complete header lines as input! <br />
<br />
Hope this helps<br />
<br />
Ivan</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="25197""></a>
  <div class="note">
   <strong class="user">mrcheezy at hotmail dot com</strong>
   <a href="#25197" class="date">13-Sep-2002 11:34</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If you set return transfer to 1 and are sending a post form and find that this crashes php try setting follow location to 1 also. I'm not exactly sure why this crashed, but after i used follow it stopped.<br />
<br />
<span class="default">&lt;?php<br />
&nbsp; curl_setopt </span><span class="keyword">(</span><span class="default">$sess</span><span class="keyword">, </span><span class="default">CURLOPT_FOLLOWLOCATION</span><span class="keyword">, </span><span class="string">'1'</span><span class="keyword">);<br />
&nbsp; </span><span class="default">curl_setopt </span><span class="keyword">(</span><span class="default">$sess</span><span class="keyword">, </span><span class="default">CURLOPT_RETURNTRANSFER</span><span class="keyword">, </span><span class="string">'1'</span><span class="keyword">);<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="24709""></a>
  <div class="note">
   <strong class="user">paul at zgtec dot com</strong>
   <a href="#24709" class="date">26-Aug-2002 11:31</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
To make a POST in multipart/form-data mode <br />
this worked for me, the " \n" at the end of the variables was very important on my OS X server.<br />
<br />
<span class="default">&lt;?php<br />
<br />
$file </span><span class="keyword">= </span><span class="string">"file_to_upload.txt"</span><span class="keyword">;<br />
</span><span class="default">$submit_url </span><span class="keyword">= </span><span class="string">"<a href="http://www.example.com/upload_page.php" rel="nofollow" target="_blank">http://www.example.com/upload_page.php</a>"</span><span class="keyword">;<br />
<br />
</span><span class="default">$formvars </span><span class="keyword">= array(</span><span class="string">"cc"</span><span class="keyword">=&gt;</span><span class="string">"us \n"</span><span class="keyword">);<br />
</span><span class="default">$formvars</span><span class="keyword">[</span><span class="default">variable_1</span><span class="keyword">] = </span><span class="string">"bla bla \n"</span><span class="keyword">;<br />
</span><span class="default">$formvars</span><span class="keyword">[</span><span class="default">variable_2</span><span class="keyword">] = </span><span class="string">"bla bla \n"</span><span class="keyword">;<br />
</span><span class="default">$formvars</span><span class="keyword">[</span><span class="default">variable_3</span><span class="keyword">] = </span><span class="string">"bla bla \n"</span><span class="keyword">;<br />
</span><span class="default">$formvars</span><span class="keyword">[</span><span class="default">variable_4</span><span class="keyword">] = </span><span class="string">"bla bla \n"</span><span class="keyword">;<br />
</span><span class="default">$formvars</span><span class="keyword">[</span><span class="default">upfile</span><span class="keyword">] = </span><span class="string">"@</span><span class="default">$file</span><span class="string">"</span><span class="keyword">; </span><span class="comment">// "@" causes cURL to send as file and not string (I believe) <br />
<br />
&nbsp;&nbsp;&nbsp; // init curl handle<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$ch </span><span class="keyword">= </span><span class="default">curl_init</span><span class="keyword">(</span><span class="default">$submit_url</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">curl_setopt</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">, </span><span class="default">CURLOPT_COOKIEJAR</span><span class="keyword">, </span><span class="string">"my_cookies.txt"</span><span class="keyword">);&nbsp; </span><span class="comment">//initiates cookie file if needed<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">curl_setopt</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">, </span><span class="default">CURLOPT_COOKIEFILE</span><span class="keyword">, </span><span class="string">"my_cookies.txt"</span><span class="keyword">);&nbsp; </span><span class="comment">// Uses cookies from previous session if exist<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">curl_setopt</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">, </span><span class="default">CURLOPT_REFERER</span><span class="keyword">, </span><span class="string">"<a href="http://www.example.net" rel="nofollow" target="_blank">http://www.example.net</a>"</span><span class="keyword">);&nbsp; </span><span class="comment">//if server needs to think this post came from elsewhere<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">curl_setopt</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">, </span><span class="default">CURLOPT_VERBOSE</span><span class="keyword">, </span><span class="default">1</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">curl_setopt</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">, </span><span class="default">CURLOPT_HEADER</span><span class="keyword">, </span><span class="default">1</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">curl_setopt</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">, </span><span class="default">CURLOPT_FOLLOWLOCATION</span><span class="keyword">,</span><span class="default">1</span><span class="keyword">); </span><span class="comment">// follow redirects recursively<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">curl_setopt</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">, </span><span class="default">CURLOPT_RETURNTRANSFER</span><span class="keyword">, </span><span class="default">1</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">curl_setopt</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">, </span><span class="default">CURLOPT_POSTFIELDS</span><span class="keyword">, </span><span class="default">$formvars</span><span class="keyword">);<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">// perform post<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">echo </span><span class="default">$pnp_result_page </span><span class="keyword">= </span><span class="default">curl_exec</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">curl_close </span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">);<br />
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="20410""></a>
  <div class="note">
   <strong class="user">tychay at alumni dot caltech dot edu</strong>
   <a href="#20410" class="date">03-Apr-2002 10:14</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
CURLOPT_HTTPHEADER is NOT like the -H command line switch. The command line switch adds or replaces headers (much like the header() line in PHP, but for HTTP clients instead of servers), but the curl extension will eliminate the headers cURL sends by default.<br />
<br />
For instance, your Authorization, Host, Referer, Pragma, and Accept headers which are normally written by default or by other CURLOPT_*'s.<br />
<br />
Also, it might seem intuitive that this should accept an array hash of header-&gt;values, but this is not the case. It accepts an array of strings of the format "Header: Value", much like the -H command-line switch.<br />
<br />
Hope this helps,<br />
<br />
terry</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="17640""></a>
  <div class="note">
   <strong class="user">bvwj at swbell dot net</strong>
   <a href="#17640" class="date">18-Dec-2001 10:35</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
To collect cookies recieved with a request, set CURLOPT_COOKIEJAR "cookieFileName".&nbsp; Then use CURLOPT_COOKIEFILE "cookieFileName" to recall them in subsequent transactions.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="15603""></a>
  <div class="note">
   
   <a href="#15603" class="date">22-Sep-2001 06:52</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
To make a POST in multipart/form-data mode<br />
<br />
(to upload a file for example) you can use <br />
<br />
<span class="default">&lt;?php curl_setopt</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">,</span><span class="default">CURLOPT_POSTFIELDS</span><span class="keyword">,</span><span class="default">$post</span><span class="keyword">); </span><span class="default">?&gt;<br />
</span><br />
where $post is an array :<br />
<br />
<span class="default">&lt;?php<br />
$post</span><span class="keyword">[</span><span class="string">'key1'</span><span class="keyword">] = </span><span class="string">'data1'</span><span class="keyword">;<br />
</span><span class="comment">//&nbsp; like a text field in a POST<br />
</span><span class="default">$post</span><span class="keyword">[</span><span class="string">'file1'</span><span class="keyword">] = </span><span class="string">'@filename1' <br />
</span><span class="comment">// upload filename1<br />
</span><span class="default">?&gt;<br />
</span><br />
For more informations see the <br />
<br />
curl_formparse man page.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="12895""></a>
  <div class="note">
   <strong class="user">sr2899.at.hotmail.com</strong>
   <a href="#12895" class="date">14-May-2001 11:00</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
CURLOPT_RETURNTRANSFER has the interesting behaviour of tacking a null char onto the end of the string.&nbsp; This null char is actually on the end of the php string, and can cause some odd results if you're not expecting it to be there.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="11470""></a>
  <div class="note">
   <strong class="user">fil at rezox dot com</strong>
   <a href="#11470" class="date">22-Feb-2001 02:50</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If you want to connect to a secure server for posting info/reading info, you need to make cURL with the openSSL options. Then the sequence is nearly identical to the previous example (except http_S_://, and possibly add the useragent):<br />
<br />
<span class="default">&lt;?php<br />
curl_setopt</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">, </span><span class="default">CURLOPT_URL</span><span class="keyword">,</span><span class="string">"https://example.com"</span><span class="keyword">);<br />
</span><span class="comment">//some sites only accept your request if your browser looks legit, so send a useragent profile... <br />
</span><span class="default">curl_setopt </span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">, </span><span class="default">CURLOPT_USERAGENT</span><span class="keyword">, </span><span class="string">"Mozilla/4.0 (compatible; MSIE 5.01; Windows NT 5.0)"</span><span class="keyword">);<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="11132""></a>
  <div class="note">
   <strong class="user">bvr at xs4all dot nl</strong>
   <a href="#11132" class="date">07-Feb-2001 04:09</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If you'd like to include extra headers in your POST request, you can accomplish this by setting the following option:<br />
<br />
CURLOPT_HTTPHEADER<br />
<br />
This is similar to the CURL -H command line switch.<br />
<br />
Thanks to Daniel Stenberg for pointing out this usefull feature!<br />
<br />
Note: this option was first supported in PHP version 4.03 .</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="10904""></a>
  <div class="note">
   <strong class="user">awestholm at imail dot usi dot net</strong>
   <a href="#10904" class="date">25-Jan-2001 08:33</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Just because the docs are rather sparse on this, to set multiple values in a cookie, you separate them with a semicolon, as usual. An example, yo set j to j and k to k:<br />
<br />
<span class="default">&lt;?php curl_setopt</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">,</span><span class="default">CURLOPT_COOKIE</span><span class="keyword">,</span><span class="string">"j=j;k=k"</span><span class="keyword">); </span><span class="default">?&gt;<br />
</span><br />
&nbsp;&nbsp;&nbsp; -- Alex</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="10692""></a>
  <div class="note">
   <strong class="user">dan dot polansky at seznam dot cz</strong>
   <a href="#10692" class="date">17-Jan-2001 11:31</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I used to download www pages to my script and one of the pages was different in MS explorer and different, when I downloaded it. Namely, information, I was really interested in was missing. That was because the server on the other bank of the river was looking at who is downloading the page. Everything got fixed when I pretended I was MSIE. It is done with curl. Here is a function, that you may use in similar situation<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">function </span><span class="default">download_pretending</span><span class="keyword">(</span><span class="default">$url</span><span class="keyword">,</span><span class="default">$user_agent</span><span class="keyword">) {<br />
&nbsp;&nbsp; </span><span class="default">$ch </span><span class="keyword">= </span><span class="default">curl_init</span><span class="keyword">();<br />
&nbsp;&nbsp; </span><span class="default">curl_setopt </span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">, </span><span class="default">CURLOPT_URL</span><span class="keyword">, </span><span class="default">$url</span><span class="keyword">);<br />
&nbsp;&nbsp; </span><span class="default">curl_setopt </span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">, </span><span class="default">CURLOPT_USERAGENT</span><span class="keyword">, </span><span class="default">$user_agent</span><span class="keyword">);<br />
&nbsp;&nbsp; </span><span class="default">curl_setopt </span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">, </span><span class="default">CURLOPT_HEADER</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">);<br />
&nbsp;&nbsp; </span><span class="default">curl_setopt </span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">, </span><span class="default">CURLOPT_RETURNTRANSFER</span><span class="keyword">, </span><span class="default">1</span><span class="keyword">);<br />
&nbsp;&nbsp; </span><span class="default">$result </span><span class="keyword">= </span><span class="default">curl_exec </span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">); <br />
&nbsp;&nbsp; </span><span class="default">curl_close </span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">);<br />
&nbsp;&nbsp; return </span><span class="default">$result</span><span class="keyword">;<br />
}<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
</div>
</div>
<hr /><div class="manualnavbar" style="text-align: center;">
 <div class="prev" style="text-align: left; float: left;"><a href="function.curl-setopt-array.html">curl_setopt_array</a></div>
 <div class="next" style="text-align: right; float: right;"><a href="function.curl-share-close.html">curl_share_close</a></div>
 <div class="up"><a href="ref.curl.html">cURL 関数</a></div>
 <div class="home"><a href="index.html">PHP Manual</a></div>
</div></body></html>
