<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
 <head>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <title>副文字列の出現回数を数える</title>
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <link media="all" rel="stylesheet" type="text/css" href="style.css"/>
 </head>
 <body class="docs"><div class="manualnavbar" style="text-align: center;">
 <div class="prev" style="text-align: left; float: left;"><a href="function.substr-compare.html">substr_compare</a></div>
 <div class="next" style="text-align: right; float: right;"><a href="function.substr-replace.html">substr_replace</a></div>
 <div class="up"><a href="ref.strings.html">String 関数</a></div>
 <div class="home"><a href="index.html">PHP Manual</a></div>
</div><hr /><div id="function.substr-count" class="refentry">
 <div class="refnamediv">
  <h1 class="refname">substr_count</h1>
  <p class="verinfo">(PHP 4, PHP 5)</p><p class="refpurpose"><span class="refname">substr_count</span> &mdash; <span class="dc-title">副文字列の出現回数を数える</span></p>

 </div>
 <div class="refsect1 description" id="refsect1-function.substr-count-description">
  <h3 class="title">説明</h3>
  <div class="methodsynopsis dc-description">
   <span class="type">int</span> <span class="methodname"><strong>substr_count</strong></span>
    ( <span class="methodparam"><span class="type">string</span> <code class="parameter">$haystack</code></span>
   , <span class="methodparam"><span class="type">string</span> <code class="parameter">$needle</code></span>
   [, <span class="methodparam"><span class="type">int</span> <code class="parameter">$offset</code><span class="initializer"> = 0</span></span>
   [, <span class="methodparam"><span class="type">int</span> <code class="parameter">$length</code></span>
  ]] )</div>

  <p class="para rdfs-comment">
    <span class="function"><strong>substr_count()</strong></span> は、文字列
   <em><code class="parameter">haystack</code></em> の中での副文字列
   <em><code class="parameter">needle</code></em> の出現回数を返します。
   <em><code class="parameter">needle</code></em>
   は英大小文字を区別することに注意してください。
  </p>
  <blockquote class="note"><p><strong class="note">注意</strong>: 
   <p class="para">
    この関数は重なり合う副文字列をカウントしません。以下の例を見てください !
   </p>
  </p></blockquote>
 </div>


 <div class="refsect1 parameters" id="refsect1-function.substr-count-parameters">
  <h3 class="title">パラメータ</h3>
  <p class="para">
   <dl>

    <dt>

     <span class="term"><em><code class="parameter">haystack</code></em></span>
     <dd>

      <p class="para">
       検索対象の文字列
      </p>
     </dd>

    </dt>

    <dt>

     <span class="term"><em><code class="parameter">needle</code></em></span>
     <dd>

      <p class="para">
       検索する副文字列
      </p>
     </dd>

    </dt>

    <dt>

     <span class="term"><em><code class="parameter">offset</code></em></span>
     <dd>

      <p class="para">
       開始位置のオフセット
      </p>
     </dd>

    </dt>

    <dt>

     <span class="term"><em><code class="parameter">length</code></em></span>
     <dd>

      <p class="para">
       指定したオフセット以降に副文字列で検索する最大長。
       オフセットと長さの総和が <em><code class="parameter">haystack</code></em>
       の長さよりも長い場合、警告が発生します。
      </p>
     </dd>

    </dt>

   </dl>

  </p>
 </div>


 <div class="refsect1 returnvalues" id="refsect1-function.substr-count-returnvalues">
  <h3 class="title">返り値</h3>
  <p class="para">
   この関数は <span class="type"><span class="type 整数">整数</span></span> を返します。
  </p>
 </div>


 <div class="refsect1 changelog" id="refsect1-function.substr-count-changelog">
  <h3 class="title">変更履歴</h3>
  <p class="para">
   <table class="doctable informaltable">
    
     <thead>
      <tr>
       <th>バージョン</th>
       <th>説明</th>
      </tr>

     </thead>

     <tbody class="tbody">
      <tr>
       <td>5.1.0</td>
       <td>
        <em><code class="parameter">offset</code></em> と <em><code class="parameter">length</code></em>
        パラメータが追加されました。
       </td>
      </tr>

     </tbody>
    
   </table>

  </p>
 </div>


 <div class="refsect1 examples" id="refsect1-function.substr-count-examples">
  <h3 class="title">例</h3>
  <p class="para">
   <div class="example" id="example-4887">
    <p><strong>例1  <span class="function"><strong>substr_count()</strong></span> の例</strong></p>
    <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br />$text&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #DD0000">'This&nbsp;is&nbsp;a&nbsp;test'</span><span style="color: #007700">;<br />echo&nbsp;</span><span style="color: #0000BB">strlen</span><span style="color: #007700">(</span><span style="color: #0000BB">$text</span><span style="color: #007700">);&nbsp;</span><span style="color: #FF8000">//&nbsp;14<br /><br /></span><span style="color: #007700">echo&nbsp;</span><span style="color: #0000BB">substr_count</span><span style="color: #007700">(</span><span style="color: #0000BB">$text</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">'is'</span><span style="color: #007700">);&nbsp;</span><span style="color: #FF8000">//&nbsp;2<br /><br />//&nbsp;文字列は&nbsp;'s&nbsp;is&nbsp;a&nbsp;test'&nbsp;になっているので,&nbsp;1&nbsp;が表示される<br /></span><span style="color: #007700">echo&nbsp;</span><span style="color: #0000BB">substr_count</span><span style="color: #007700">(</span><span style="color: #0000BB">$text</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">'is'</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">3</span><span style="color: #007700">);<br /><br /></span><span style="color: #FF8000">//&nbsp;テキストは&nbsp;'s&nbsp;i'&nbsp;になっているので,&nbsp;0&nbsp;が表示される<br /></span><span style="color: #007700">echo&nbsp;</span><span style="color: #0000BB">substr_count</span><span style="color: #007700">(</span><span style="color: #0000BB">$text</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">'is'</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">3</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">3</span><span style="color: #007700">);<br /><br /></span><span style="color: #FF8000">//&nbsp;5+10&nbsp;&gt;&nbsp;14&nbsp;なので、警告が発生する<br /></span><span style="color: #007700">echo&nbsp;</span><span style="color: #0000BB">substr_count</span><span style="color: #007700">(</span><span style="color: #0000BB">$text</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">'is'</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">5</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">10</span><span style="color: #007700">);<br /><br /><br /></span><span style="color: #FF8000">//&nbsp;重なっている副文字列はカウントされないので、1&nbsp;が表示される<br /></span><span style="color: #0000BB">$text2&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #DD0000">'gcdgcdgcd'</span><span style="color: #007700">;<br />echo&nbsp;</span><span style="color: #0000BB">substr_count</span><span style="color: #007700">(</span><span style="color: #0000BB">$text2</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">'gcdgcd'</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
    </div>

   </div>
  </p>
 </div>


 <div class="refsect1 seealso" id="refsect1-function.substr-count-seealso">
  <h3 class="title">参考</h3>
  <p class="para">
   <ul class="simplelist">
    <li class="member"> <span class="function"><a href="function.count-chars.html" class="function" rel="rdfs-seeAlso">count_chars()</a> - 文字列で使用されている文字に関する情報を返す</span></li>
    <li class="member"> <span class="function"><a href="function.strpos.html" class="function" rel="rdfs-seeAlso">strpos()</a> - 文字列内の部分文字列が最初に現れる場所を見つける</span></li>
    <li class="member"> <span class="function"><a href="function.substr.html" class="function" rel="rdfs-seeAlso">substr()</a> - 文字列の一部分を返す</span></li>
    <li class="member"> <span class="function"><a href="function.strstr.html" class="function" rel="rdfs-seeAlso">strstr()</a> - 文字列が最初に現れる位置を見つける</span></li>
   </ul>
  </p>
 </div>

</div><div id="usernotes">
 <div class="head">
  <h3 class="title">User Contributed Notes</h3>
 </div>
<div id="allnotes">  <a name="113288""></a>
  <div class="note">
   <strong class="user">qeremy [atta] gmail [dotta] com</strong>
   <a href="#113288" class="date">21-Sep-2013 05:45</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Unicode example with "case-sensitive" option;<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">function </span><span class="default">substr_count_unicode</span><span class="keyword">(</span><span class="default">$str</span><span class="keyword">, </span><span class="default">$substr</span><span class="keyword">, </span><span class="default">$caseSensitive </span><span class="keyword">= </span><span class="default">true</span><span class="keyword">, </span><span class="default">$offset </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">, </span><span class="default">$length </span><span class="keyword">= </span><span class="default">null</span><span class="keyword">) {<br />
&nbsp;&nbsp;&nbsp; if (</span><span class="default">$offset</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$str </span><span class="keyword">= </span><span class="default">substr_unicode</span><span class="keyword">(</span><span class="default">$str</span><span class="keyword">, </span><span class="default">$offset</span><span class="keyword">, </span><span class="default">$length</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$pattern </span><span class="keyword">= </span><span class="default">$caseSensitive<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">? </span><span class="string">'~(?:'</span><span class="keyword">. </span><span class="default">preg_quote</span><span class="keyword">(</span><span class="default">$substr</span><span class="keyword">) .</span><span class="string">')~u'<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">: </span><span class="string">'~(?:'</span><span class="keyword">. </span><span class="default">preg_quote</span><span class="keyword">(</span><span class="default">$substr</span><span class="keyword">) .</span><span class="string">')~ui'</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">preg_match_all</span><span class="keyword">(</span><span class="default">$pattern</span><span class="keyword">, </span><span class="default">$str</span><span class="keyword">, </span><span class="default">$matches</span><span class="keyword">);<br />
<br />
&nbsp;&nbsp;&nbsp; return isset(</span><span class="default">$matches</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">]) ? </span><span class="default">count</span><span class="keyword">(</span><span class="default">$matches</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">]) : </span><span class="default">0</span><span class="keyword">;<br />
}<br />
<br />
function </span><span class="default">substr_unicode</span><span class="keyword">(</span><span class="default">$str</span><span class="keyword">, </span><span class="default">$start</span><span class="keyword">, </span><span class="default">$length </span><span class="keyword">= </span><span class="default">null</span><span class="keyword">) {<br />
&nbsp;&nbsp;&nbsp; return </span><span class="default">join</span><span class="keyword">(</span><span class="string">''</span><span class="keyword">, </span><span class="default">array_slice</span><span class="keyword">(<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">preg_split</span><span class="keyword">(</span><span class="string">'~~u'</span><span class="keyword">, </span><span class="default">$str</span><span class="keyword">, -</span><span class="default">1</span><span class="keyword">, </span><span class="default">PREG_SPLIT_NO_EMPTY</span><span class="keyword">), </span><span class="default">$start</span><span class="keyword">, </span><span class="default">$length</span><span class="keyword">));<br />
}<br />
<br />
</span><span class="default">$s </span><span class="keyword">= </span><span class="string">'Ümit yüzüm gözüm...'</span><span class="keyword">;<br />
print </span><span class="default">substr_count_unicode</span><span class="keyword">(</span><span class="default">$s</span><span class="keyword">, </span><span class="string">'ü'</span><span class="keyword">);&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="comment">// 3<br />
</span><span class="keyword">print </span><span class="default">substr_count_unicode</span><span class="keyword">(</span><span class="default">$s</span><span class="keyword">, </span><span class="string">'ü'</span><span class="keyword">, </span><span class="default">false</span><span class="keyword">);&nbsp; &nbsp;&nbsp; </span><span class="comment">// 4<br />
</span><span class="keyword">print </span><span class="default">substr_count_unicode</span><span class="keyword">(</span><span class="default">$s</span><span class="keyword">, </span><span class="string">'ü'</span><span class="keyword">, </span><span class="default">false</span><span class="keyword">, </span><span class="default">10</span><span class="keyword">); </span><span class="comment">// 1<br />
<br />
</span><span class="keyword">print </span><span class="default">substr_count_unicode</span><span class="keyword">(</span><span class="default">$s</span><span class="keyword">, </span><span class="string">'üm'</span><span class="keyword">);&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// 2<br />
</span><span class="keyword">print </span><span class="default">substr_count_unicode</span><span class="keyword">(</span><span class="default">$s</span><span class="keyword">, </span><span class="string">'üm'</span><span class="keyword">, </span><span class="default">false</span><span class="keyword">);&nbsp; &nbsp; </span><span class="comment">// 3<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="93170""></a>
  <div class="note">
   <strong class="user">chrisstocktonaz at gmail dot com</strong>
   <a href="#93170" class="date">27-Aug-2009 01:52</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
In regards to anyone thinking of using code contributed by zmindster at gmail dot com<br />
<br />
Please take careful consideration of possible edge cases with that regex, in example:<br />
<br />
$url = '<a href="http://w3.host.tld/path/to/file/..../file.extension" rel="nofollow" target="_blank">http://w3.host.tld/path/to/file/..../file.extension</a>';<br />
$url = '<a href="http://w3.host.tld/path/to/file/../file.extension?malicous=...." rel="nofollow" target="_blank">http://w3.host.tld/path/to/file/../file.extension?malicous=....</a>';<br />
<br />
This would cause a infinite loop and for example be a possible entry point for a denial of service attack. A correct fix would require additional code, a quick hack would be just adding a additional check, without clarity or performance in mind:<br />
<br />
...<br />
$i = 0;<br />
while (substr_count($url, '../') &amp;&amp; ++$i &lt; strlen($url))<br />
...<br />
<br />
-Chris</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="91588""></a>
  <div class="note">
   <strong class="user">jrhodes at roket-enterprises dot com</strong>
   <a href="#91588" class="date">18-Jun-2009 10:37</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
It was suggested to use<br />
<br />
substr_count ( implode( $haystackArray ), $needle );<br />
<br />
instead of the function described previously, however this has one flaw.&nbsp; For example this array:<br />
<br />
array (<br />
&nbsp; 0 =&gt; "mystringth",<br />
&nbsp; 1 =&gt; "atislong"<br />
);<br />
<br />
If you are counting "that", the implode version will return 1, but the function previously described will return 0.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="88139""></a>
  <div class="note">
   <strong class="user">gigi at phpmycoder dot com</strong>
   <a href="#88139" class="date">12-Jan-2009 05:17</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
below was suggested a function for substr_count'ing an array, yet for a simpler procedure, use the following:<br />
<br />
<span class="default">&lt;?php<br />
substr_count </span><span class="keyword">( </span><span class="default">implode</span><span class="keyword">( </span><span class="default">$haystackArray </span><span class="keyword">), </span><span class="default">$needle </span><span class="keyword">);<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="74952""></a>
  <div class="note">
   <strong class="user">info at fat-fish dot co dot il</strong>
   <a href="#74952" class="date">06-May-2007 01:07</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
a simple version for an array needle (multiply sub-strings):<br />
<span class="default">&lt;?php<br />
<br />
</span><span class="keyword">function </span><span class="default">substr_count_array</span><span class="keyword">( </span><span class="default">$haystack</span><span class="keyword">, </span><span class="default">$needle </span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; </span><span class="default">$count </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; foreach (</span><span class="default">$needle </span><span class="keyword">as </span><span class="default">$substring</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$count </span><span class="keyword">+= </span><span class="default">substr_count</span><span class="keyword">( </span><span class="default">$haystack</span><span class="keyword">, </span><span class="default">$substring</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; }<br />
&nbsp;&nbsp; &nbsp; return </span><span class="default">$count</span><span class="keyword">;<br />
}<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="70742""></a>
  <div class="note">
   <strong class="user">flobi at flobi dot com</strong>
   <a href="#70742" class="date">26-Oct-2006 04:07</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Making this case insensitive is easy for anyone who needs this.&nbsp; Simply convert the haystack and the needle to the same case (upper or lower).<br />
<br />
substr_count(strtoupper($haystack), strtoupper($needle))</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="38442""></a>
  <div class="note">
   <strong class="user">XinfoX X at X XkarlX X-X XphilippX X dot X XdeX</strong>
   <a href="#38442" class="date">21-Dec-2003 10:27</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Yet another reference to the "cgcgcgcgcgcgc" example posted by "chris at pecoraro dot net":<br />
<br />
Your request can be fulfilled with the Perl compatible regular expressions and their lookahead and lookbehind features.<br />
<br />
The example<br />
<br />
&nbsp;$number_of_full_pattern = preg_match_all('/(cgc)/', "cgcgcgcgcgcgcg", $chunks);<br />
<br />
works like the substr_count function. The variable $number_of_full_pattern has the value 3, because the default behavior of Perl compatible regular expressions is to consume the characters of the string subject that were matched by the (sub)pattern. That is, the pointer will be moved to the end of the matched substring.<br />
But we can use the lookahead feature that disables the moving of the pointer:<br />
<br />
&nbsp;$number_of_full_pattern = preg_match_all('/(cg(?=c))/', "cgcgcgcgcgcgcg", $chunks);<br />
<br />
In this case the variable $number_of_full_pattern has the value 6.<br />
Firstly a string "cg" will be matched and the pointer will be moved to the end of this string. Then the regular expression looks ahead whether a 'c' can be matched. Despite of the occurence of the character 'c' the pointer is not moved.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
</div>
</div>
<hr /><div class="manualnavbar" style="text-align: center;">
 <div class="prev" style="text-align: left; float: left;"><a href="function.substr-compare.html">substr_compare</a></div>
 <div class="next" style="text-align: right; float: right;"><a href="function.substr-replace.html">substr_replace</a></div>
 <div class="up"><a href="ref.strings.html">String 関数</a></div>
 <div class="home"><a href="index.html">PHP Manual</a></div>
</div></body></html>
