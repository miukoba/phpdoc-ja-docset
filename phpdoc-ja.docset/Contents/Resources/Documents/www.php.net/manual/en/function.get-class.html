<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
 <head>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <title>オブジェクトのクラス名を返す</title>
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <link media="all" rel="stylesheet" type="text/css" href="style.css"/>
 </head>
 <body class="docs"><div class="manualnavbar" style="text-align: center;">
 <div class="prev" style="text-align: left; float: left;"><a href="function.get-class-vars.html">get_class_vars</a></div>
 <div class="next" style="text-align: right; float: right;"><a href="function.get-declared-classes.html">get_declared_classes</a></div>
 <div class="up"><a href="ref.classobj.html">クラス/オブジェクト関数</a></div>
 <div class="home"><a href="index.html">PHP Manual</a></div>
</div><hr /><div id="function.get-class" class="refentry">
 <div class="refnamediv">
  <h1 class="refname">get_class</h1>
  <p class="verinfo">(PHP 4, PHP 5)</p><p class="refpurpose"><span class="refname">get_class</span> &mdash; <span class="dc-title">オブジェクトのクラス名を返す</span></p>

 </div>
 <div class="refsect1 description" id="refsect1-function.get-class-description">
  <h3 class="title">説明</h3>
  <div class="methodsynopsis dc-description">
   <span class="type">string</span> <span class="methodname"><strong>get_class</strong></span>
    ([ <span class="methodparam"><span class="type">object</span> <code class="parameter">$object</code><span class="initializer"> = <strong><code>NULL</code></strong></span></span>
  ] )</div>

  <p class="para rdfs-comment">
   指定した <em><code class="parameter">object</code></em> のクラス名を取得します。
  </p>
 </div>

 <div class="refsect1 parameters" id="refsect1-function.get-class-parameters">
  <h3 class="title">パラメータ</h3>
  <p class="para">
   <dl>

    <dt>

     <span class="term"><em><code class="parameter">object</code></em></span>
     <dd>

      <p class="para">
       調べるオブジェクト。クラスの内部ではこのパラメータを省略することもできます。
      </p>
     </dd>

    </dt>

   </dl>

  </p>
 </div>

 <div class="refsect1 returnvalues" id="refsect1-function.get-class-returnvalues">
  <h3 class="title">返り値</h3>
  <p class="para">
   オブジェクト <em><code class="parameter">object</code></em> がインスタンス
   であるクラスの名前を返します。<em><code class="parameter">object</code></em>
   がオブジェクトでない場合には<strong><code>FALSE</code></strong>が返されます。
  </p>
  <p class="para">
   クラスの内部で <em><code class="parameter">object</code></em> を省略すると、
   そのクラスの名前を返します。
  </p>
 </div>

 <div class="refsect1 errors" id="refsect1-function.get-class-errors">
  <h3 class="title">エラー / 例外</h3>
  <p class="para">
   オブジェクト以外に対して  <span class="function"><strong>get_class()</strong></span> をコールすると、
   <strong><code>E_WARNING</code></strong> レベルのエラーが発生します。
  </p>
 </div>

 <div class="refsect1 changelog" id="refsect1-function.get-class-changelog">
  <h3 class="title">変更履歴</h3>
  <p class="para">
   <table class="doctable informaltable">
    
     <thead>
      <tr>
       <th>バージョン</th>
       <th>説明</th>
      </tr>

     </thead>

     <tbody class="tbody">
      <tr>
       <td>5.3.0</td>
       <td>
        <strong><code>NULL</code></strong> が <em><code class="parameter">object</code></em> のデフォルトとなりました。
        したがって、<strong><code>NULL</code></strong> を <em><code class="parameter">object</code></em>
        に渡すのは何も指定しないのと同じ意味ということになります。
       </td>
      </tr>

      <tr>
       <td>5.0.0</td>
       <td>
        クラス名はその本来の表記で返されます。
       </td>
      </tr>

      <tr>
       <td>5.0.0</td>
       <td>
        <em><code class="parameter">object</code></em> パラメータは、
        オブジェクトのメソッドからコールされた場合はオプションとなります。
       </td>
      </tr>

     </tbody>
    
   </table>

  </p>
 </div>

 <div class="refsect1 examples" id="refsect1-function.get-class-examples">
  <h3 class="title">例</h3>
  <p class="para">
   <div class="example" id="example-5024">
    <p><strong>例1  <span class="function"><strong>get_class()</strong></span> の使用例</strong></p>
    <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br /><br /></span><span style="color: #007700">class&nbsp;</span><span style="color: #0000BB">foo&nbsp;</span><span style="color: #007700">{<br />&nbsp;&nbsp;&nbsp;&nbsp;function&nbsp;</span><span style="color: #0000BB">name</span><span style="color: #007700">()<br />&nbsp;&nbsp;&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;echo&nbsp;</span><span style="color: #DD0000">"My&nbsp;name&nbsp;is&nbsp;"&nbsp;</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">get_class</span><span style="color: #007700">(</span><span style="color: #0000BB">$this</span><span style="color: #007700">)&nbsp;,&nbsp;</span><span style="color: #DD0000">"\n"</span><span style="color: #007700">;<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br />}<br /><br /></span><span style="color: #FF8000">//&nbsp;オブジェクトを生成<br /></span><span style="color: #0000BB">$bar&nbsp;</span><span style="color: #007700">=&nbsp;new&nbsp;</span><span style="color: #0000BB">foo</span><span style="color: #007700">();<br /><br /></span><span style="color: #FF8000">//&nbsp;外部からコール<br /></span><span style="color: #007700">echo&nbsp;</span><span style="color: #DD0000">"Its&nbsp;name&nbsp;is&nbsp;"&nbsp;</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">get_class</span><span style="color: #007700">(</span><span style="color: #0000BB">$bar</span><span style="color: #007700">)&nbsp;,&nbsp;</span><span style="color: #DD0000">"\n"</span><span style="color: #007700">;<br /><br /></span><span style="color: #FF8000">//&nbsp;内部からコール<br /></span><span style="color: #0000BB">$bar</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">name</span><span style="color: #007700">();<br /><br /></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
    </div>

    <div class="example-contents"><p>上の例の出力は以下となります。</p></div>
    <div class="example-contents screen">
<div class="cdata"><pre>
Its name is foo
My name is foo
</pre></div>
    </div>
   </div>
   <div class="example" id="example-5025">
    <p><strong>例2  <span class="function"><strong>get_class()</strong></span> のスーパークラスでの使用例</strong></p>
    <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br /><br /></span><span style="color: #007700">abstract&nbsp;class&nbsp;</span><span style="color: #0000BB">bar&nbsp;</span><span style="color: #007700">{<br />&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;function&nbsp;</span><span style="color: #0000BB">__construct</span><span style="color: #007700">()<br />&nbsp;&nbsp;&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">var_dump</span><span style="color: #007700">(</span><span style="color: #0000BB">get_class</span><span style="color: #007700">(</span><span style="color: #0000BB">$this</span><span style="color: #007700">));<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">var_dump</span><span style="color: #007700">(</span><span style="color: #0000BB">get_class</span><span style="color: #007700">());<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br />}<br /><br />class&nbsp;</span><span style="color: #0000BB">foo&nbsp;</span><span style="color: #007700">extends&nbsp;</span><span style="color: #0000BB">bar&nbsp;</span><span style="color: #007700">{<br />}<br /><br />new&nbsp;</span><span style="color: #0000BB">foo</span><span style="color: #007700">;<br /><br /></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
    </div>

    <div class="example-contents"><p>上の例の出力は以下となります。</p></div>
    <div class="example-contents screen">
<div class="cdata"><pre>
string(3) &quot;foo&quot;
string(3) &quot;bar&quot;
</pre></div>
    </div>
   </div>
  </p>
 </div>

 <div class="refsect1 seealso" id="refsect1-function.get-class-seealso">
  <h3 class="title">参考</h3>
  <p class="para">
   <ul class="simplelist">
    <li class="member"> <span class="function"><a href="function.get-called-class.html" class="function" rel="rdfs-seeAlso">get_called_class()</a> - &quot;静的遅延束縛&quot; のクラス名</span></li>
    <li class="member"> <span class="function"><a href="function.get-parent-class.html" class="function" rel="rdfs-seeAlso">get_parent_class()</a> - オブジェクトの親クラスの名前を取得する</span></li>
    <li class="member"> <span class="function"><a href="function.gettype.html" class="function" rel="rdfs-seeAlso">gettype()</a> - 変数の型を取得する</span></li>
    <li class="member"> <span class="function"><a href="function.is-subclass-of.html" class="function" rel="rdfs-seeAlso">is_subclass_of()</a> - あるオブジェクトが指定したクラスのサブクラスに属するかどうかを調べる</span></li>
   </ul>
  </p>
 </div>

</div><div id="usernotes">
 <div class="head">
  <h3 class="title">User Contributed Notes</h3>
 </div>
<div id="allnotes">  <a name="112159""></a>
  <div class="note">
   <strong class="user">emmanuel dot antico at gmail dot com</strong>
   <a href="#112159" class="date">11-May-2013 04:35</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
/**<br />
&nbsp;* Obtains an object class name without namespaces<br />
&nbsp;*/<br />
function get_real_class($obj) {<br />
&nbsp;&nbsp;&nbsp; $classname = get_class($obj);<br />
<br />
&nbsp;&nbsp;&nbsp; if (preg_match('@\\\\([\w]+)$@', $classname, $matches)) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $classname = $matches[1];<br />
&nbsp;&nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp;&nbsp; return $classname;<br />
}</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="107964""></a>
  <div class="note">
   <strong class="user">macnimble at gmail dot com</strong>
   <a href="#107964" class="date">18-Mar-2012 04:24</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Need a quick way to parse the name of a class when it's namespaced? Try this:<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">namespace </span><span class="default">Engine</span><span class="keyword">;<br />
function </span><span class="default">parse_classname </span><span class="keyword">(</span><span class="default">$name</span><span class="keyword">)<br />
{<br />
&nbsp; return array(<br />
&nbsp;&nbsp;&nbsp; </span><span class="string">'namespace' </span><span class="keyword">=&gt; </span><span class="default">array_slice</span><span class="keyword">(</span><span class="default">explode</span><span class="keyword">(</span><span class="string">'\\'</span><span class="keyword">, </span><span class="default">$name</span><span class="keyword">), </span><span class="default">0</span><span class="keyword">, -</span><span class="default">1</span><span class="keyword">),<br />
&nbsp;&nbsp;&nbsp; </span><span class="string">'classname' </span><span class="keyword">=&gt; </span><span class="default">join</span><span class="keyword">(</span><span class="string">''</span><span class="keyword">, </span><span class="default">array_slice</span><span class="keyword">(</span><span class="default">explode</span><span class="keyword">(</span><span class="string">'\\'</span><span class="keyword">, </span><span class="default">$name</span><span class="keyword">), -</span><span class="default">1</span><span class="keyword">)),<br />
&nbsp; );<br />
}<br />
final class </span><span class="default">Kernel<br />
</span><span class="keyword">{<br />
&nbsp; final public function </span><span class="default">__construct </span><span class="keyword">()<br />
&nbsp; {<br />
&nbsp;&nbsp;&nbsp; echo </span><span class="string">'&lt;pre&gt;'</span><span class="keyword">, </span><span class="default">print_r</span><span class="keyword">(</span><span class="default">parse_classname</span><span class="keyword">(</span><span class="default">__CLASS__</span><span class="keyword">),</span><span class="default">1</span><span class="keyword">), </span><span class="string">'&lt;/pre&gt;'</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">// Or this for a one-line method to get just the classname:<br />
&nbsp;&nbsp;&nbsp; // echo join('', array_slice(explode('\\', __CLASS__), -1));<br />
&nbsp; </span><span class="keyword">}<br />
}<br />
new </span><span class="default">Kernel</span><span class="keyword">();<br />
</span><span class="default">?&gt;<br />
</span><br />
Outputs:<br />
Array<br />
(<br />
&nbsp;&nbsp;&nbsp; [namespace] =&gt; Array<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; (<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [0] =&gt; Engine<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; )<br />
<br />
&nbsp;&nbsp;&nbsp; [classname] =&gt; Kernel<br />
)</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="106794""></a>
  <div class="note">
   <strong class="user">mail dot temc at gmail dot com</strong>
   <a href="#106794" class="date">06-Dec-2011 11:51</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
People seem to mix up what __METHOD__, get_class($obj) and get_class() do, related to class inheritance.<br />
<br />
Here's a good example that should fix that for ever:<br />
<br />
<span class="default">&lt;?php<br />
<br />
</span><span class="keyword">class </span><span class="default">Foo </span><span class="keyword">{<br />
&nbsp;function </span><span class="default">doMethod</span><span class="keyword">(){<br />
&nbsp; echo </span><span class="default">__METHOD__ </span><span class="keyword">. </span><span class="string">"\n"</span><span class="keyword">;<br />
&nbsp;}<br />
&nbsp;function </span><span class="default">doGetClassThis</span><span class="keyword">(){<br />
&nbsp; echo </span><span class="default">get_class</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">).</span><span class="string">'::doThat' </span><span class="keyword">. </span><span class="string">"\n"</span><span class="keyword">;<br />
&nbsp;}<br />
&nbsp;function </span><span class="default">doGetClass</span><span class="keyword">(){<br />
&nbsp; echo </span><span class="default">get_class</span><span class="keyword">().</span><span class="string">'::doThat' </span><span class="keyword">. </span><span class="string">"\n"</span><span class="keyword">;<br />
&nbsp;}<br />
}<br />
<br />
class </span><span class="default">Bar </span><span class="keyword">extends </span><span class="default">Foo </span><span class="keyword">{<br />
<br />
}<br />
<br />
class </span><span class="default">Quux </span><span class="keyword">extends </span><span class="default">Bar </span><span class="keyword">{<br />
&nbsp;function </span><span class="default">doMethod</span><span class="keyword">(){<br />
&nbsp; echo </span><span class="default">__METHOD__ </span><span class="keyword">. </span><span class="string">"\n"</span><span class="keyword">;<br />
&nbsp;}<br />
&nbsp;function </span><span class="default">doGetClassThis</span><span class="keyword">(){<br />
&nbsp; echo </span><span class="default">get_class</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">).</span><span class="string">'::doThat' </span><span class="keyword">. </span><span class="string">"\n"</span><span class="keyword">;<br />
&nbsp;}<br />
&nbsp;function </span><span class="default">doGetClass</span><span class="keyword">(){<br />
&nbsp; echo </span><span class="default">get_class</span><span class="keyword">().</span><span class="string">'::doThat' </span><span class="keyword">. </span><span class="string">"\n"</span><span class="keyword">;<br />
&nbsp;}<br />
}<br />
<br />
</span><span class="default">$foo </span><span class="keyword">= new </span><span class="default">Foo</span><span class="keyword">();<br />
</span><span class="default">$bar </span><span class="keyword">= new </span><span class="default">Bar</span><span class="keyword">();<br />
</span><span class="default">$quux </span><span class="keyword">= new </span><span class="default">Quux</span><span class="keyword">();<br />
<br />
echo </span><span class="string">"\n--doMethod--\n"</span><span class="keyword">;<br />
<br />
</span><span class="default">$foo</span><span class="keyword">-&gt;</span><span class="default">doMethod</span><span class="keyword">();<br />
</span><span class="default">$bar</span><span class="keyword">-&gt;</span><span class="default">doMethod</span><span class="keyword">();<br />
</span><span class="default">$quux</span><span class="keyword">-&gt;</span><span class="default">doMethod</span><span class="keyword">();<br />
<br />
echo </span><span class="string">"\n--doGetClassThis--\n"</span><span class="keyword">;<br />
<br />
</span><span class="default">$foo</span><span class="keyword">-&gt;</span><span class="default">doGetClassThis</span><span class="keyword">();<br />
</span><span class="default">$bar</span><span class="keyword">-&gt;</span><span class="default">doGetClassThis</span><span class="keyword">();<br />
</span><span class="default">$quux</span><span class="keyword">-&gt;</span><span class="default">doGetClassThis</span><span class="keyword">();<br />
<br />
echo </span><span class="string">"\n--doGetClass--\n"</span><span class="keyword">;<br />
<br />
</span><span class="default">$foo</span><span class="keyword">-&gt;</span><span class="default">doGetClass</span><span class="keyword">();<br />
</span><span class="default">$bar</span><span class="keyword">-&gt;</span><span class="default">doGetClass</span><span class="keyword">();<br />
</span><span class="default">$quux</span><span class="keyword">-&gt;</span><span class="default">doGetClass</span><span class="keyword">();<br />
<br />
</span><span class="default">?&gt;<br />
</span><br />
OUTPUT:<br />
<br />
--doMethod--<br />
Foo::doMethod<br />
Foo::doMethod<br />
Quux::doMethod<br />
<br />
--doGetClassThis--<br />
Foo::doThat<br />
Bar::doThat<br />
Quux::doThat<br />
<br />
--doGetClass--<br />
Foo::doThat<br />
Foo::doThat<br />
Quux::doThat</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="106686""></a>
  <div class="note">
   <strong class="user">ozana at omdesign dot cz</strong>
   <a href="#106686" class="date">28-Nov-2011 04:53</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Simplest way how to gets Class without namespace<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">namespace </span><span class="default">a</span><span class="keyword">\</span><span class="default">b</span><span class="keyword">\</span><span class="default">c</span><span class="keyword">\</span><span class="default">d</span><span class="keyword">\</span><span class="default">e</span><span class="keyword">\</span><span class="default">f</span><span class="keyword">;<br />
<br />
class </span><span class="default">Foo </span><span class="keyword">{<br />
<br />
&nbsp; public function </span><span class="default">__toString</span><span class="keyword">() {<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$class </span><span class="keyword">= </span><span class="default">explode</span><span class="keyword">(</span><span class="string">'\\'</span><span class="keyword">, </span><span class="default">__CLASS__</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; return </span><span class="default">end</span><span class="keyword">(</span><span class="default">$class</span><span class="keyword">);<br />
&nbsp; }<br />
}<br />
<br />
echo new </span><span class="default">Foo</span><span class="keyword">(); </span><span class="comment">// prints Foo<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="106368""></a>
  <div class="note">
   <strong class="user">Michael Richey</strong>
   <a href="#106368" class="date">31-Oct-2011 09:01</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Attempting various singleton base class methods described on this page, I have created a base class and bridge function that allows it to work without get_called_class() if it's not available.&nbsp; Unlike other methods listed here, I chose not to prevent use of __construct() or __clone().<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">abstract class </span><span class="default">Singleton </span><span class="keyword">{<br />
&nbsp;&nbsp;&nbsp; protected static </span><span class="default">$m_pInstance</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; final public static function </span><span class="default">getInstance</span><span class="keyword">(){<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$class </span><span class="keyword">= static::</span><span class="default">getClass</span><span class="keyword">();<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if(!isset(static::</span><span class="default">$m_pInstance</span><span class="keyword">[</span><span class="default">$class</span><span class="keyword">])) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; static::</span><span class="default">$m_pInstance</span><span class="keyword">[</span><span class="default">$class</span><span class="keyword">] = new </span><span class="default">$class</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return static::</span><span class="default">$m_pInstance</span><span class="keyword">[</span><span class="default">$class</span><span class="keyword">];<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; final public static function </span><span class="default">getClass</span><span class="keyword">(){<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">get_called_class</span><span class="keyword">();<br />
&nbsp;&nbsp;&nbsp; }<br />
}<br />
<br />
</span><span class="comment">// I don't remember where I found this, but this is to allow php &lt; 5.3 to use this method.<br />
</span><span class="keyword">if (!</span><span class="default">function_exists</span><span class="keyword">(</span><span class="string">'get_called_class'</span><span class="keyword">)) {<br />
&nbsp;&nbsp;&nbsp; function </span><span class="default">get_called_class</span><span class="keyword">(</span><span class="default">$bt </span><span class="keyword">= </span><span class="default">false</span><span class="keyword">, </span><span class="default">$l </span><span class="keyword">= </span><span class="default">1</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if (!</span><span class="default">$bt</span><span class="keyword">)<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$bt </span><span class="keyword">= </span><span class="default">debug_backtrace</span><span class="keyword">();<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if (!isset(</span><span class="default">$bt</span><span class="keyword">[</span><span class="default">$l</span><span class="keyword">]))<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; throw new </span><span class="default">Exception</span><span class="keyword">(</span><span class="string">"Cannot find called class -&gt; stack level too deep."</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if (!isset(</span><span class="default">$bt</span><span class="keyword">[</span><span class="default">$l</span><span class="keyword">][</span><span class="string">'type'</span><span class="keyword">])) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; throw new </span><span class="default">Exception</span><span class="keyword">(</span><span class="string">'type not set'</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; else<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; switch (</span><span class="default">$bt</span><span class="keyword">[</span><span class="default">$l</span><span class="keyword">][</span><span class="string">'type'</span><span class="keyword">]) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; case </span><span class="string">'::'</span><span class="keyword">:<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$lines </span><span class="keyword">= </span><span class="default">file</span><span class="keyword">(</span><span class="default">$bt</span><span class="keyword">[</span><span class="default">$l</span><span class="keyword">][</span><span class="string">'file'</span><span class="keyword">]);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$i </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$callerLine </span><span class="keyword">= </span><span class="string">''</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; do {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$i</span><span class="keyword">++;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$callerLine </span><span class="keyword">= </span><span class="default">$lines</span><span class="keyword">[</span><span class="default">$bt</span><span class="keyword">[</span><span class="default">$l</span><span class="keyword">][</span><span class="string">'line'</span><span class="keyword">] - </span><span class="default">$i</span><span class="keyword">] . </span><span class="default">$callerLine</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; } while (</span><span class="default">stripos</span><span class="keyword">(</span><span class="default">$callerLine</span><span class="keyword">, </span><span class="default">$bt</span><span class="keyword">[</span><span class="default">$l</span><span class="keyword">][</span><span class="string">'function'</span><span class="keyword">]) === </span><span class="default">false</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">preg_match</span><span class="keyword">(</span><span class="string">'/([a-zA-Z0-9\_]+)::' </span><span class="keyword">. </span><span class="default">$bt</span><span class="keyword">[</span><span class="default">$l</span><span class="keyword">][</span><span class="string">'function'</span><span class="keyword">] . </span><span class="string">'/'</span><span class="keyword">, </span><span class="default">$callerLine</span><span class="keyword">, </span><span class="default">$matches</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if (!isset(</span><span class="default">$matches</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">])) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// must be an edge case.<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">throw new </span><span class="default">Exception</span><span class="keyword">(</span><span class="string">"Could not find caller class: originating method call is obscured."</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; switch (</span><span class="default">$matches</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">]) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; case </span><span class="string">'self'</span><span class="keyword">:<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; case </span><span class="string">'parent'</span><span class="keyword">:<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">get_called_class</span><span class="keyword">(</span><span class="default">$bt</span><span class="keyword">, </span><span class="default">$l </span><span class="keyword">+ </span><span class="default">1</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; default:<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">$matches</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">];<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// won't get here.<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">case </span><span class="string">'-&gt;'</span><span class="keyword">: switch (</span><span class="default">$bt</span><span class="keyword">[</span><span class="default">$l</span><span class="keyword">][</span><span class="string">'function'</span><span class="keyword">]) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; case </span><span class="string">'__get'</span><span class="keyword">:<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// edge case -&gt; get class of calling object<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">if (!</span><span class="default">is_object</span><span class="keyword">(</span><span class="default">$bt</span><span class="keyword">[</span><span class="default">$l</span><span class="keyword">][</span><span class="string">'object'</span><span class="keyword">]))<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; throw new </span><span class="default">Exception</span><span class="keyword">(</span><span class="string">"Edge case fail. __get called on non object."</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">get_class</span><span class="keyword">(</span><span class="default">$bt</span><span class="keyword">[</span><span class="default">$l</span><span class="keyword">][</span><span class="string">'object'</span><span class="keyword">]);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; default: return </span><span class="default">$bt</span><span class="keyword">[</span><span class="default">$l</span><span class="keyword">][</span><span class="string">'class'</span><span class="keyword">];<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; default: throw new </span><span class="default">Exception</span><span class="keyword">(</span><span class="string">"Unknown backtrace method type"</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; }<br />
}<br />
<br />
class </span><span class="default">B </span><span class="keyword">extends </span><span class="default">Singleton </span><span class="keyword">{<br />
}<br />
<br />
class </span><span class="default">C </span><span class="keyword">extends </span><span class="default">Singleton </span><span class="keyword">{<br />
}<br />
<br />
</span><span class="default">$b </span><span class="keyword">= </span><span class="default">B</span><span class="keyword">::</span><span class="default">getInstance</span><span class="keyword">();<br />
echo </span><span class="string">'class: '</span><span class="keyword">.</span><span class="default">get_class</span><span class="keyword">(</span><span class="default">$b</span><span class="keyword">);<br />
<br />
echo </span><span class="string">'&lt;br /&gt;'</span><span class="keyword">;<br />
<br />
</span><span class="default">$c </span><span class="keyword">= </span><span class="default">C</span><span class="keyword">::</span><span class="default">getInstance</span><span class="keyword">();<br />
echo echo </span><span class="string">'class: '</span><span class="keyword">.</span><span class="default">get_class</span><span class="keyword">(</span><span class="default">$c</span><span class="keyword">);<br />
</span><span class="default">?&gt;<br />
</span>This returns:<br />
class: b<br />
class: c</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="101272""></a>
  <div class="note">
   <strong class="user">me at nwhiting dot com</strong>
   <a href="#101272" class="date">06-Dec-2010 05:14</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Method for pulling the name of a class with namespaces pre-stripped.<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="comment">/**<br />
&nbsp;* Returns the name of a class using get_class with the namespaces stripped.<br />
&nbsp;* This will not work inside a class scope as get_class() a workaround for<br />
&nbsp;* that is using get_class_name(get_class());<br />
&nbsp;*<br />
&nbsp;* @param&nbsp; object|string&nbsp; $object&nbsp; Object or Class Name to retrieve name<br />
<br />
&nbsp;* @return&nbsp; string&nbsp; Name of class with namespaces stripped<br />
&nbsp;*/<br />
</span><span class="keyword">function </span><span class="default">get_class_name</span><span class="keyword">(</span><span class="default">$object </span><span class="keyword">= </span><span class="default">null</span><span class="keyword">)<br />
{<br />
&nbsp;&nbsp;&nbsp; if (!</span><span class="default">is_object</span><span class="keyword">(</span><span class="default">$object</span><span class="keyword">) &amp;&amp; !</span><span class="default">is_string</span><span class="keyword">(</span><span class="default">$object</span><span class="keyword">)) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">false</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$class </span><span class="keyword">= </span><span class="default">explode</span><span class="keyword">(</span><span class="string">'\\'</span><span class="keyword">, (</span><span class="default">is_string</span><span class="keyword">(</span><span class="default">$object</span><span class="keyword">) ? </span><span class="default">$object </span><span class="keyword">: </span><span class="default">get_class</span><span class="keyword">(</span><span class="default">$object</span><span class="keyword">)));<br />
&nbsp;&nbsp;&nbsp; return </span><span class="default">$class</span><span class="keyword">[</span><span class="default">count</span><span class="keyword">(</span><span class="default">$class</span><span class="keyword">) - </span><span class="default">1</span><span class="keyword">];<br />
}<br />
</span><span class="default">?&gt;<br />
</span><br />
And for everyone for Unit Test goodiness!<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">namespace </span><span class="default">testme</span><span class="keyword">\</span><span class="default">here</span><span class="keyword">;<br />
<br />
class </span><span class="default">TestClass </span><span class="keyword">{<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; public function </span><span class="default">test</span><span class="keyword">()<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; return </span><span class="default">get_class_name</span><span class="keyword">(</span><span class="default">get_class</span><span class="keyword">());<br />
&nbsp;&nbsp;&nbsp; }<br />
}<br />
<br />
class </span><span class="default">GetClassNameTest </span><span class="keyword">extends \</span><span class="default">PHPUnit_Framework_TestCase<br />
</span><span class="keyword">{<br />
&nbsp;&nbsp;&nbsp; public function </span><span class="default">testGetClassName</span><span class="keyword">()<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$class&nbsp; </span><span class="keyword">= new </span><span class="default">TestClass</span><span class="keyword">();<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$std&nbsp; </span><span class="keyword">= new \</span><span class="default">stdClass</span><span class="keyword">();<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">assertEquals</span><span class="keyword">(</span><span class="string">'TestClass'</span><span class="keyword">, </span><span class="default">get_class_name</span><span class="keyword">(</span><span class="default">$class</span><span class="keyword">));<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">assertEquals</span><span class="keyword">(</span><span class="string">'stdClass'</span><span class="keyword">, </span><span class="default">get_class_name</span><span class="keyword">(</span><span class="default">$std</span><span class="keyword">));<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">assertEquals</span><span class="keyword">(</span><span class="string">'Test'</span><span class="keyword">, </span><span class="default">get_class_name</span><span class="keyword">(</span><span class="string">'Test'</span><span class="keyword">));<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">assertFalse</span><span class="keyword">(</span><span class="default">get_class_name</span><span class="keyword">(</span><span class="default">null</span><span class="keyword">));<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">assertFalse</span><span class="keyword">(</span><span class="default">get_class_name</span><span class="keyword">(array()));<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">assertEquals</span><span class="keyword">(</span><span class="string">'TestClass'</span><span class="keyword">, </span><span class="default">$class</span><span class="keyword">-&gt;</span><span class="default">test</span><span class="keyword">());<br />
&nbsp;&nbsp;&nbsp; }<br />
}<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="98496""></a>
  <div class="note">
   <strong class="user">Aaron</strong>
   <a href="#98496" class="date">18-Jun-2010 08:14</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
This can sometimes be used in place of get_called_class(). I used this function in a parent class to get the name of the class that extends it.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="97164""></a>
  <div class="note">
   <strong class="user">ovidiu.bute [at] gmail.com</strong>
   <a href="#97164" class="date">06-Apr-2010 07:23</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If you are using namespaces this function will return the name of the class including the namespace, so watch out if your code does any checks for this. Ex:<br />
<br />
namespace Shop;<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">class </span><span class="default">Foo<br />
</span><span class="keyword">{<br />
&nbsp; public function </span><span class="default">__construct</span><span class="keyword">()<br />
&nbsp; {<br />
&nbsp;&nbsp; &nbsp; echo </span><span class="string">"Foo"</span><span class="keyword">;<br />
&nbsp; }<br />
}<br />
<br />
</span><span class="comment">//Different file<br />
<br />
</span><span class="keyword">include(</span><span class="string">'inc/Shop.class.php'</span><span class="keyword">); <br />
<br />
</span><span class="default">$test </span><span class="keyword">= new </span><span class="default">Shop</span><span class="keyword">\</span><span class="default">Foo</span><span class="keyword">();<br />
echo </span><span class="default">get_class</span><span class="keyword">(</span><span class="default">$test</span><span class="keyword">);</span><span class="comment">//returns Shop\Foo<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="93597""></a>
  <div class="note">
   <strong class="user">Tom Brown</strong>
   <a href="#93597" class="date">17-Sep-2009 08:02</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
As of 5.3.0 this function seems to have started throwing an E_WARNING error if you pass it a non-object. Supress that with "@" if you are actually checking and handling the false return code.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="88856""></a>
  <div class="note">
   <strong class="user">Lanselot</strong>
   <a href="#88856" class="date">11-Feb-2009 11:09</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Beware if you're omitting the parameter on inherited classes.<br />
It'll return the class name of the method where it's called.<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">class </span><span class="default">A </span><span class="keyword">{<br />
&nbsp;&nbsp;&nbsp; function </span><span class="default">foo</span><span class="keyword">() {<br />
&nbsp;&nbsp; &nbsp;&nbsp; return </span><span class="default">get_class</span><span class="keyword">();<br />
&nbsp;&nbsp;&nbsp; }<br />
}<br />
class </span><span class="default">B </span><span class="keyword">extends </span><span class="default">A </span><span class="keyword">{<br />
&nbsp;&nbsp; function </span><span class="default">bar</span><span class="keyword">() {<br />
&nbsp;&nbsp; &nbsp;&nbsp; return </span><span class="default">get_class</span><span class="keyword">();<br />
&nbsp;&nbsp; }<br />
}<br />
</span><span class="default">$instance </span><span class="keyword">= new </span><span class="default">B</span><span class="keyword">();<br />
echo </span><span class="default">$instance</span><span class="keyword">-&gt;</span><span class="default">bar</span><span class="keyword">(); </span><span class="comment">//Prints 'B';<br />
</span><span class="keyword">echo </span><span class="default">$instance</span><span class="keyword">-&gt;</span><span class="default">foo</span><span class="keyword">(); </span><span class="comment">//Prints 'A';<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="86230""></a>
  <div class="note">
   <strong class="user">danbettles at yahoo dot co dot uk</strong>
   <a href="#86230" class="date">08-Oct-2008 08:56</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
It is possible to write a completely self-contained Singleton base class in PHP 5.3 using the new get_called_class function.&nbsp; When called in a static method, this function returns the name of the class the call was made against.<br />
<br />
<span class="default">&lt;?php<br />
<br />
</span><span class="keyword">abstract class </span><span class="default">Singleton </span><span class="keyword">{<br />
<br />
&nbsp;&nbsp;&nbsp; protected function </span><span class="default">__construct</span><span class="keyword">() {<br />
&nbsp;&nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp;&nbsp; final public static function </span><span class="default">getInstance</span><span class="keyword">() {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; static </span><span class="default">$aoInstance </span><span class="keyword">= array();<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$calledClassName </span><span class="keyword">= </span><span class="default">get_called_class</span><span class="keyword">();<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if (! isset (</span><span class="default">$aoInstance</span><span class="keyword">[</span><span class="default">$calledClassName</span><span class="keyword">])) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$aoInstance</span><span class="keyword">[</span><span class="default">$calledClassName</span><span class="keyword">] = new </span><span class="default">$calledClassName</span><span class="keyword">();<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">$aoInstance</span><span class="keyword">[</span><span class="default">$calledClassName</span><span class="keyword">];<br />
&nbsp;&nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp;&nbsp; final private function </span><span class="default">__clone</span><span class="keyword">() {<br />
&nbsp;&nbsp;&nbsp; }<br />
}<br />
<br />
class </span><span class="default">DatabaseConnection </span><span class="keyword">extends </span><span class="default">Singleton </span><span class="keyword">{<br />
<br />
&nbsp;&nbsp;&nbsp; protected </span><span class="default">$connection</span><span class="keyword">;<br />
<br />
&nbsp;&nbsp;&nbsp; protected function </span><span class="default">__construct</span><span class="keyword">() {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// @todo Connect to the database<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">}<br />
<br />
&nbsp;&nbsp;&nbsp; public function </span><span class="default">__destruct</span><span class="keyword">() {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// @todo Drop the connection to the database<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">}<br />
}<br />
<br />
</span><span class="default">$oDbConn </span><span class="keyword">= new </span><span class="default">DatabaseConnection</span><span class="keyword">();&nbsp; </span><span class="comment">// Fatal error<br />
<br />
</span><span class="default">$oDbConn </span><span class="keyword">= </span><span class="default">DatabaseConnection</span><span class="keyword">::</span><span class="default">getInstance</span><span class="keyword">();&nbsp; </span><span class="comment">// Returns single instance<br />
</span><span class="default">?&gt;<br />
</span><br />
Full write-up in Oct 2008: <a href="http://danbettles.blogspot.com" rel="nofollow" target="_blank">http://danbettles.blogspot.com</a></span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="86133""></a>
  <div class="note">
   <strong class="user">Maik</strong>
   <a href="#86133" class="date">04-Oct-2008 05:36</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
The code just worked fine with PHP 5.3.<br />
Thanks to you it could be rebuild to work with earlier versions of PHP 5.<br />
<br />
I just changed the 'static' to 'self' and die() to an Exception.<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="comment">// This one extends Singleton with proper class name<br />
</span><span class="keyword">class </span><span class="default">someSingleton </span><span class="keyword">extends </span><span class="default">Singleton </span><span class="keyword">{<br />
&nbsp;&nbsp;&nbsp; public static function </span><span class="default">getInstance</span><span class="keyword">() {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">parent</span><span class="keyword">::</span><span class="default">$__CLASS__ </span><span class="keyword">= </span><span class="default">__CLASS__</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">parent</span><span class="keyword">::</span><span class="default">getInstance</span><span class="keyword">();<br />
&nbsp;&nbsp;&nbsp; }<br />
}<br />
</span><span class="comment">// This one does the logic<br />
</span><span class="keyword">abstract class </span><span class="default">Singleton </span><span class="keyword">{<br />
&nbsp;&nbsp;&nbsp; protected static </span><span class="default">$__CLASS__ </span><span class="keyword">= </span><span class="default">__CLASS__</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; protected static </span><span class="default">$instance </span><span class="keyword">= </span><span class="default">null</span><span class="keyword">;<br />
<br />
&nbsp;&nbsp;&nbsp; protected function </span><span class="default">__construct</span><span class="keyword">() {}&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; abstract protected function </span><span class="default">init</span><span class="keyword">();<br />
&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">/**<br />
&nbsp;&nbsp; &nbsp; * Gets an instance of this singleton. If no instance exists, a new instance is created and returned.<br />
&nbsp;&nbsp; &nbsp; * If one does exist, then the existing instance is returned.<br />
&nbsp;&nbsp; &nbsp; */<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">public static function </span><span class="default">getInstance</span><span class="keyword">() {&nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$class </span><span class="keyword">= </span><span class="default">self</span><span class="keyword">::</span><span class="default">getClass</span><span class="keyword">();<br />
&nbsp;&nbsp; &nbsp; &nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">self</span><span class="keyword">::</span><span class="default">$instance </span><span class="keyword">=== </span><span class="default">null</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">self</span><span class="keyword">::</span><span class="default">$instance </span><span class="keyword">= new </span><span class="default">$class</span><span class="keyword">();<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">self</span><span class="keyword">::</span><span class="default">$instance</span><span class="keyword">-&gt;</span><span class="default">init</span><span class="keyword">();<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">self</span><span class="keyword">::</span><span class="default">$instance</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">/**<br />
&nbsp;&nbsp; &nbsp; * Returns the classname of the child class extending this class<br />
&nbsp;&nbsp; &nbsp; *<br />
&nbsp;&nbsp; &nbsp; * @return string The class name<br />
&nbsp;&nbsp; &nbsp; */<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">private static function </span><span class="default">getClass</span><span class="keyword">() {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$implementing_class </span><span class="keyword">= </span><span class="default">self</span><span class="keyword">::</span><span class="default">$__CLASS__</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$original_class </span><span class="keyword">= </span><span class="default">__CLASS__</span><span class="keyword">;<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">$implementing_class </span><span class="keyword">=== </span><span class="default">$original_class</span><span class="keyword">)<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; throw new </span><span class="default">Exception</span><span class="keyword">(</span><span class="string">"You MUST provide a &lt;code&gt;protected static \$__CLASS__ = __CLASS__;&lt;/code&gt; statement in your Singleton-class!"</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">$implementing_class</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }<br />
}<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="85228""></a>
  <div class="note">
   <strong class="user">Edward</strong>
   <a href="#85228" class="date">21-Aug-2008 12:26</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
The code in my previous comment was not completely correct. I think this one is. <br />
<br />
&lt;?<br />
abstract class Singleton {<br />
&nbsp;&nbsp;&nbsp; protected static $__CLASS__ = __CLASS__;<br />
<br />
&nbsp;&nbsp;&nbsp; protected function __construct() {<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; abstract protected function init();<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; /**<br />
&nbsp;&nbsp; &nbsp; * Gets an instance of this singleton. If no instance exists, a new instance is created and returned.<br />
&nbsp;&nbsp; &nbsp; * If one does exist, then the existing instance is returned.<br />
&nbsp;&nbsp; &nbsp; */<br />
&nbsp;&nbsp;&nbsp; public static function getInstance() {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; static $instance;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $class = self::getClass();<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if ($instance === null) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $instance = new $class();<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $instance-&gt;init();<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return $instance;<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; /**<br />
&nbsp;&nbsp; &nbsp; * Returns the classname of the child class extending this class<br />
&nbsp;&nbsp; &nbsp; *<br />
&nbsp;&nbsp; &nbsp; * @return string The class name<br />
&nbsp;&nbsp; &nbsp; */<br />
&nbsp;&nbsp;&nbsp; private static function getClass() {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $implementing_class = static::$__CLASS__;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $original_class = __CLASS__;<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if ($implementing_class === $original_class) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; die("You MUST provide a &lt;code&gt;protected static \$__CLASS__ = __CLASS__;&lt;/code&gt; statement in your Singleton-class!");<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return $implementing_class;<br />
&nbsp;&nbsp;&nbsp; }<br />
}<br />
?&gt;</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="85209""></a>
  <div class="note">
   <strong class="user">Edward</strong>
   <a href="#85209" class="date">20-Aug-2008 02:42</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
With Late Static Bindings, available as of PHP 5.3.0, it is now possible to implement an abstract Singleton class with minimal overhead in the child classes. Late static bindings are explained here: <a href="http://nl2.php.net/manual/en/language.oop5.late-static-bindings.php" rel="nofollow" target="_blank">http://nl2.php.net/manual/en/language.oop5.late-static-bindings.php</a><br />
<br />
In short, it introduces a new 'static::' keyword, that is evaluated at runtime. In the following code I use it to determine the classname of the child Singleton class.<br />
<br />
&lt;?<br />
abstract class Singleton {<br />
&nbsp;&nbsp;&nbsp; protected static $__CLASS__ = __CLASS__;<br />
&nbsp;&nbsp;&nbsp; protected static $instance;<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; protected function __construct() {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; static::$instance = $this;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $this-&gt;init();<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; abstract protected function init();<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; protected function getInstance() {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $class = static::getClass();<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if (static::$instance===null) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; static::$instance = new $class;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return static::$instance;<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; private static function getClass() {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if (static::$__CLASS__ == __CLASS__) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; die("You MUST provide a &lt;code&gt;protected static \$__CLASS__ = __CLASS__;&lt;/code&gt; statement in your Singleton-class!");<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return static::$__CLASS__;<br />
&nbsp;&nbsp;&nbsp; }<br />
}<br />
?&gt;<br />
<br />
An example Singleton class can then be implemented as follows:<br />
<br />
&lt;?<br />
class A extends Singleton {<br />
&nbsp;&nbsp;&nbsp; protected static $__CLASS__ = __CLASS__; // Provide this in each singleton class.<br />
<br />
&nbsp;&nbsp;&nbsp; protected function someFunction() {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $instance = static::getInstance();<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; // ...<br />
&nbsp;&nbsp;&nbsp; }<br />
}<br />
?&gt;<br />
<br />
Hope this helps you save some time :)</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="83984""></a>
  <div class="note">
   <strong class="user">James</strong>
   <a href="#83984" class="date">22-Jun-2008 11:46</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
To get round this problem, another option is a factory to create singletons.<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">class </span><span class="default">Factory </span><span class="keyword">{<br />
&nbsp; private static </span><span class="default">$instances </span><span class="keyword">= array();<br />
&nbsp; public static function </span><span class="default">getInstance</span><span class="keyword">(</span><span class="default">$class_name</span><span class="keyword">) {<br />
&nbsp;&nbsp;&nbsp; if(!</span><span class="default">array_key_exists</span><span class="keyword">(</span><span class="default">$class_name</span><span class="keyword">, </span><span class="default">self</span><span class="keyword">::</span><span class="default">$instances</span><span class="keyword">)) {<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="default">self</span><span class="keyword">::</span><span class="default">$instances</span><span class="keyword">[</span><span class="default">$class_name</span><span class="keyword">] = new </span><span class="default">$class_name</span><span class="keyword">();<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; return </span><span class="default">self</span><span class="keyword">::</span><span class="default">$instances</span><span class="keyword">[</span><span class="default">$class_name</span><span class="keyword">];<br />
&nbsp; }<br />
}<br />
</span><span class="default">?&gt;<br />
</span><br />
I guess you could modify this to create singletons from some, and prototypes for the rest.<br />
<br />
There's probably some good way to stop people instantiating objects directly. Perhaps by using the backtrace in the constructor of the class to ensure that it was indeed the Factory that created the object.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="82874""></a>
  <div class="note">
   <strong class="user">Anonymous</strong>
   <a href="#82874" class="date">30-Apr-2008 06:59</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I jumped the gun. The following code also working for statics called inside other classes.<br />
<br />
<span class="default">&lt;?php<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">for( </span><span class="default">$i</span><span class="keyword">=</span><span class="default">0 </span><span class="keyword">; </span><span class="default">$i </span><span class="keyword">&lt; </span><span class="default">count</span><span class="keyword">(</span><span class="default">$bt</span><span class="keyword">) ; </span><span class="default">$i</span><span class="keyword">++)<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if(</span><span class="default">$bt</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">][</span><span class="string">'function'</span><span class="keyword">] == </span><span class="string">'getInstance'</span><span class="keyword">)<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$class </span><span class="keyword">= </span><span class="default">$bt</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">][</span><span class="string">'class'</span><span class="keyword">];<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; } else {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; break;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="82873""></a>
  <div class="note">
   <strong class="user">dave dot zap at gmail dot com</strong>
   <a href="#82873" class="date">30-Apr-2008 06:13</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Take care using the backtrace method to find the calling class of a static method, you should step backward through the array and find a match for your getInstance() function. In backtrace the class name you want is not always the last item in the array.<br />
<br />
I will not post the whole singleton class here, but have made the following modification to Frederik Krautwald's method (found below)<br />
<br />
<span class="default">&lt;?php <br />
$bt </span><span class="keyword">= </span><span class="default">debug_backtrace</span><span class="keyword">();<br />
</span><span class="comment">// this method is count($bt)-1) by Frederik will fall over when calling getInstance from within an include file.<br />
//$class = $bt[count($bt) - 1]['class'];<br />
<br />
</span><span class="keyword">for( </span><span class="default">$i</span><span class="keyword">=</span><span class="default">count</span><span class="keyword">(</span><span class="default">$bt</span><span class="keyword">)-</span><span class="default">1 </span><span class="keyword">; </span><span class="default">$i </span><span class="keyword">&gt; </span><span class="default">0 </span><span class="keyword">; </span><span class="default">$i</span><span class="keyword">--)<br />
{<br />
&nbsp;&nbsp;&nbsp; if(</span><span class="default">$bt</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">][</span><span class="string">'function'</span><span class="keyword">] == </span><span class="string">'getInstance'</span><span class="keyword">)<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$class </span><span class="keyword">= </span><span class="default">$bt</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">][</span><span class="string">'class'</span><span class="keyword">];<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; break;<br />
&nbsp;&nbsp;&nbsp; }<br />
}<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="82479""></a>
  <div class="note">
   <strong class="user">Anonymous</strong>
   <a href="#82479" class="date">12-Apr-2008 11:01</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
In Perl (and some other languages) you can call some methods in both object and class (aka static) context. I made such a method for one of my classes in PHP5, but found out that static methods in PHP5 do not 'know' the name of the calling subclass', so I use a backtrace to determine it. I don't like hacks like this, but as long as PHP doesn't have an alternative, this is what has to be done:<br />
<br />
public function table_name() {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $result = null;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if (isset($this)) { // object context<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $result = get_class($this);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; else { // class context<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $result = get_class();<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $trace = debug_backtrace();<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; foreach ($trace as &amp;$frame) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if (!isset($frame['class'])) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; break;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if ($frame['class'] != $result) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if (!is_subclass_of($frame['class'], $result)) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; break;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $result = $frame['class'];<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return $result;<br />
&nbsp;&nbsp;&nbsp; }</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="81481""></a>
  <div class="note">
   <strong class="user">frederic dot sureau at gmail dot com</strong>
   <a href="#81481" class="date">29-Feb-2008 08:01</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
@ hek :<br />
<br />
The problem is that the method getInstance() in a Singleton must be static, so we cannot use $this because it doesn't exists :(</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="81304""></a>
  <div class="note">
   <strong class="user">andregs at NOSPAM dot gmail dot NOSPAM dot com</strong>
   <a href="#81304" class="date">21-Feb-2008 10:17</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
After reading the previous comments, this is the best I've done to get the final class name of a subclass:<br />
<br />
<span class="default">&lt;?php<br />
<br />
</span><span class="keyword">class </span><span class="default">Singleton<br />
</span><span class="keyword">{<br />
&nbsp;&nbsp; private static </span><span class="default">$_instances </span><span class="keyword">= array();<br />
&nbsp;&nbsp; protected final function </span><span class="default">__construct</span><span class="keyword">(){}<br />
&nbsp;&nbsp; <br />
&nbsp;&nbsp; </span><span class="comment">/**<br />
&nbsp;&nbsp;&nbsp; * @param string $classname<br />
&nbsp;&nbsp;&nbsp; * @return Singleton<br />
&nbsp;&nbsp;&nbsp; */<br />
&nbsp;&nbsp; </span><span class="keyword">protected static function </span><span class="default">getInstance</span><span class="keyword">()<br />
&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="default">$classname </span><span class="keyword">= </span><span class="default">func_get_arg</span><span class="keyword">(</span><span class="default">0</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp;&nbsp; if (! isset(</span><span class="default">self</span><span class="keyword">::</span><span class="default">$_instances</span><span class="keyword">[</span><span class="default">$classname</span><span class="keyword">]))<br />
&nbsp;&nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">self</span><span class="keyword">::</span><span class="default">$_instances</span><span class="keyword">[</span><span class="default">$classname</span><span class="keyword">] = new </span><span class="default">$classname</span><span class="keyword">();<br />
&nbsp;&nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp;&nbsp; return </span><span class="default">self</span><span class="keyword">::</span><span class="default">$_instances</span><span class="keyword">[</span><span class="default">$classname</span><span class="keyword">];<br />
&nbsp;&nbsp; }<br />
&nbsp;&nbsp; <br />
}<br />
<br />
class </span><span class="default">Child </span><span class="keyword">extends </span><span class="default">Singleton<br />
</span><span class="keyword">{<br />
&nbsp;&nbsp; </span><span class="comment">/**<br />
&nbsp;&nbsp;&nbsp; * @return Child<br />
&nbsp;&nbsp;&nbsp; */<br />
&nbsp;&nbsp; </span><span class="keyword">public static function </span><span class="default">getInstance</span><span class="keyword">()<br />
&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp;&nbsp; return </span><span class="default">parent</span><span class="keyword">::</span><span class="default">getInstance</span><span class="keyword">(</span><span class="default">get_class</span><span class="keyword">());<br />
&nbsp;&nbsp; }<br />
}<br />
<br />
</span><span class="default">?&gt;<br />
</span><br />
Subclasses must override "getInstance" and cannot override "__construct".</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="77698""></a>
  <div class="note">
   <strong class="user">dodgie74 at NOSPAM dot yahoo dot NOSPAM dot co dot uk</strong>
   <a href="#77698" class="date">09-Sep-2007 02:40</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
As noted in bug #30934 (which is not actually a bug but a consequence of a design decision), the "self" keyword is bound at compile time. Amongst other things, this means that in base class methods, any use of the "self" keyword will refer to that base class regardless of the actual (derived) class on which the method was invoked. This becomes problematic when attempting to call an overridden static method from within an inherited method in a derived class. For example:<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">class </span><span class="default">Base<br />
</span><span class="keyword">{<br />
&nbsp;&nbsp;&nbsp; protected </span><span class="default">$m_instanceName </span><span class="keyword">= </span><span class="string">''</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; public static function </span><span class="default">classDisplayName</span><span class="keyword">()<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="string">'Base Class'</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; public function </span><span class="default">instanceDisplayName</span><span class="keyword">()<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">//here, we want "self" to refer to the actual class, which might be a derived class that inherits this method, not necessarily this base class<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">return </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">m_instanceName </span><span class="keyword">. </span><span class="string">' - ' </span><span class="keyword">. </span><span class="default">self</span><span class="keyword">::</span><span class="default">classDisplayName</span><span class="keyword">();<br />
&nbsp;&nbsp;&nbsp; }<br />
}<br />
<br />
class </span><span class="default">Derived </span><span class="keyword">extends </span><span class="default">Base<br />
</span><span class="keyword">{<br />
&nbsp;&nbsp;&nbsp; public function </span><span class="default">Derived</span><span class="keyword">( </span><span class="default">$name </span><span class="keyword">)<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">m_instanceName </span><span class="keyword">= </span><span class="default">$name</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; public static function </span><span class="default">classDisplayName</span><span class="keyword">()<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="string">'Derived Class'</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }<br />
}<br />
<br />
</span><span class="default">$o </span><span class="keyword">= new </span><span class="default">Derived</span><span class="keyword">(</span><span class="string">'My Instance'</span><span class="keyword">);<br />
echo </span><span class="default">$o</span><span class="keyword">-&gt;</span><span class="default">instanceDisplayName</span><span class="keyword">();<br />
</span><span class="default">?&gt;<br />
</span><br />
In the above example, assuming runtime binding (where the keyword "self" refers to the actual class on which the method was invoked rather than the class in which the method is defined) would produce the output:<br />
<br />
My Instance - Derived Class<br />
<br />
However, assuming compile-time binding (where the keyword "self" refers to the class in which the method is defined), which is how php works, the output would be:<br />
<br />
My Instance - Base Class<br />
<br />
The oddity here is that "$this" is bound at runtime to the actual class of the object (obviously) but "self" is bound at compile-time, which seems counter-intuitive to me. "self" is ALWAYS a synonym for the name of the class in which it is written, which the programmer knows so s/he can just use the class name; what the programmer cannot know is the name of the actual class on which the method was invoked (because the method could be invoked on a derived class), which it seems to me is something for which "self" ought to be useful.<br />
<br />
However, questions about design decisions aside, the problem still exists of how to achieve behaviour similar to "self" being bound at runtime, so that both static and non-static methods invoked on or from within a derived class act on that derived class. The get_class() function can be used to emulate the functionality of runtime binding for the "self" keyword for static methods:<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">class </span><span class="default">Base<br />
</span><span class="keyword">{<br />
&nbsp;&nbsp;&nbsp; protected </span><span class="default">$m_instanceName </span><span class="keyword">= </span><span class="string">''</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; public static function </span><span class="default">classDisplayName</span><span class="keyword">()<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="string">'Base Class'</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; public function </span><span class="default">instanceDisplayName</span><span class="keyword">()<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$realClass </span><span class="keyword">= </span><span class="default">get_class</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">m_instanceName </span><span class="keyword">. </span><span class="string">' - ' </span><span class="keyword">. </span><span class="default">call_user_func</span><span class="keyword">(array(</span><span class="default">$realClass</span><span class="keyword">, </span><span class="string">'classDisplayName'</span><span class="keyword">));<br />
&nbsp;&nbsp;&nbsp; }<br />
}<br />
<br />
class </span><span class="default">Derived </span><span class="keyword">extends </span><span class="default">Base<br />
</span><span class="keyword">{<br />
&nbsp;&nbsp;&nbsp; public function </span><span class="default">Derived</span><span class="keyword">( </span><span class="default">$name </span><span class="keyword">)<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">m_instanceName </span><span class="keyword">= </span><span class="default">$name</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; public static function </span><span class="default">classDisplayName</span><span class="keyword">()<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="string">'Derived Class'</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }<br />
}<br />
<br />
</span><span class="default">$o </span><span class="keyword">= new </span><span class="default">Derived</span><span class="keyword">(</span><span class="string">'My Instance'</span><span class="keyword">);<br />
echo </span><span class="default">$o</span><span class="keyword">-&gt;</span><span class="default">instanceDisplayName</span><span class="keyword">();<br />
</span><span class="default">?&gt;<br />
</span><br />
Output:<br />
My Instance - Derived Class<br />
<br />
I realise that some people might respond "why don't use just just the class name with ' Class' appended instead of the classDisplayName() method", which is to miss the point. The point is not the actual strings returned but the concept of wanting to use the real class for an overridden static method from within an inherited non-static method. The above is just a simplified version of a real-world problem that was too complex to use as an example.<br />
<br />
Apologies if this has been mentioned before.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="77214""></a>
  <div class="note">
   <strong class="user">bramus at bram dot us</strong>
   <a href="#77214" class="date">20-Aug-2007 05:40</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
@ Frederik : <br />
<br />
&lt;?<br />
$class = $bt[count($bt) - 1]['class']; <br />
?&gt;<br />
<br />
should be<br />
<br />
&lt;?<br />
$class = $bt[count($bt) - 2]['class'];<br />
?&gt;<br />
<br />
;-)</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="75979""></a>
  <div class="note">
   <strong class="user">Frederik Krautwald</strong>
   <a href="#75979" class="date">25-Jun-2007 05:13</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Due to PHP 5 engine that permits to get final class in a static called function, and this is a modified version of examples published below.<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">abstract class </span><span class="default">Singleton </span><span class="keyword">{<br />
&nbsp;&nbsp;&nbsp; protected static </span><span class="default">$_instances </span><span class="keyword">= array();<br />
&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; protected function </span><span class="default">__construct</span><span class="keyword">() {}<br />
&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; protected static function </span><span class="default">getInstance</span><span class="keyword">() {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$bt </span><span class="keyword">= </span><span class="default">debug_backtrace</span><span class="keyword">();<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$class </span><span class="keyword">= </span><span class="default">$bt</span><span class="keyword">[</span><span class="default">count</span><span class="keyword">(</span><span class="default">$bt</span><span class="keyword">) - </span><span class="default">1</span><span class="keyword">][</span><span class="string">'class'</span><span class="keyword">];<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if (!isset(</span><span class="default">self</span><span class="keyword">::</span><span class="default">$_instances</span><span class="keyword">[</span><span class="default">$class</span><span class="keyword">])) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">self</span><span class="keyword">::</span><span class="default">$_instances</span><span class="keyword">[</span><span class="default">$class</span><span class="keyword">] = new </span><span class="default">$class</span><span class="keyword">();<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">self</span><span class="keyword">::</span><span class="default">$_instances</span><span class="keyword">[</span><span class="default">$class</span><span class="keyword">];<br />
&nbsp;&nbsp;&nbsp; }<br />
}<br />
class </span><span class="default">A </span><span class="keyword">extends </span><span class="default">Singleton </span><span class="keyword">{<br />
&nbsp;&nbsp;&nbsp; public static function </span><span class="default">getInstance</span><span class="keyword">() {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">parent</span><span class="keyword">::</span><span class="default">getInstance</span><span class="keyword">();<br />
&nbsp;&nbsp;&nbsp; }<br />
}<br />
class </span><span class="default">B </span><span class="keyword">extends </span><span class="default">Singleton </span><span class="keyword">{<br />
&nbsp;&nbsp;&nbsp; public static function </span><span class="default">getInstance</span><span class="keyword">() {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">parent</span><span class="keyword">::</span><span class="default">getInstance</span><span class="keyword">();<br />
&nbsp;&nbsp;&nbsp; }<br />
}<br />
class </span><span class="default">C </span><span class="keyword">extends </span><span class="default">A </span><span class="keyword">{<br />
&nbsp;&nbsp;&nbsp; public static function </span><span class="default">getInstance</span><span class="keyword">() {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">parent</span><span class="keyword">::</span><span class="default">getInstance</span><span class="keyword">();<br />
&nbsp;&nbsp;&nbsp; }<br />
}<br />
<br />
</span><span class="default">$a </span><span class="keyword">= </span><span class="default">A</span><span class="keyword">::</span><span class="default">getInstance</span><span class="keyword">();<br />
</span><span class="default">$b </span><span class="keyword">= </span><span class="default">B</span><span class="keyword">::</span><span class="default">getInstance</span><span class="keyword">();<br />
</span><span class="default">$c </span><span class="keyword">= </span><span class="default">C</span><span class="keyword">::</span><span class="default">getInstance</span><span class="keyword">();<br />
<br />
echo </span><span class="string">"\$a is a " </span><span class="keyword">. </span><span class="default">get_class</span><span class="keyword">(</span><span class="default">$a</span><span class="keyword">) . </span><span class="string">"&lt;br /&gt;"</span><span class="keyword">;<br />
echo </span><span class="string">"\$b is a " </span><span class="keyword">. </span><span class="default">get_class</span><span class="keyword">(</span><span class="default">$b</span><span class="keyword">) . </span><span class="string">"&lt;br /&gt;"</span><span class="keyword">;<br />
echo </span><span class="string">"\$c is a " </span><span class="keyword">. </span><span class="default">get_class</span><span class="keyword">(</span><span class="default">$c</span><span class="keyword">) . </span><span class="string">"&lt;br /&gt;"</span><span class="keyword">;<br />
</span><span class="default">?&gt;<br />
</span><br />
I don't know about if performance would increase if debug_backtrace() is skipped and instead have getInstance() to accept a passed class retrieved by get_class() method as parameter as described in a post below.<br />
<br />
By having set getInstance() to protected in the Singleton class, the function is required to be overridden (good OOP practice).<br />
<br />
One thing to mention is, that there is no error checking in case $class is null or undefined, which would result in a fatal error. At the moment, though, I can't see how it could happen when the getInstance() is protected, i.e. has to be overridden in a subclass -- but with good coding practice you should always error check.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="75949""></a>
  <div class="note">
   <strong class="user">mightye at gmail dot com</strong>
   <a href="#75949" class="date">23-Jun-2007 03:20</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
To: Bryan<br />
<br />
In this model it is still workable if your singleton variable is actually an array.&nbsp; Consider:<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">abstract class </span><span class="default">Singleton </span><span class="keyword">{<br />
&nbsp;&nbsp;&nbsp; protected final static </span><span class="default">$instances </span><span class="keyword">= array();<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; protected </span><span class="default">__construct</span><span class="keyword">(){}<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; protected function </span><span class="default">getInstance</span><span class="keyword">() {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$class </span><span class="keyword">= </span><span class="default">get_real_class</span><span class="keyword">(); </span><span class="comment">// imaginary function returning the final class name, not the class the code executes from<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">if (!isset(</span><span class="default">self</span><span class="keyword">::</span><span class="default">$instances</span><span class="keyword">[</span><span class="default">$class</span><span class="keyword">])) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">self</span><span class="keyword">::</span><span class="default">$instances</span><span class="keyword">[</span><span class="default">$class</span><span class="keyword">] = new </span><span class="default">$class</span><span class="keyword">();<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">self</span><span class="keyword">::</span><span class="default">$instances</span><span class="keyword">[</span><span class="default">$class</span><span class="keyword">];<br />
&nbsp;&nbsp;&nbsp; }<br />
}<br />
class </span><span class="default">A </span><span class="keyword">extends </span><span class="default">Singleton </span><span class="keyword">{<br />
}<br />
class </span><span class="default">B </span><span class="keyword">extends </span><span class="default">Singleton </span><span class="keyword">{<br />
}<br />
<br />
</span><span class="default">$a </span><span class="keyword">= </span><span class="default">A</span><span class="keyword">::</span><span class="default">getInstance</span><span class="keyword">();<br />
</span><span class="default">$b </span><span class="keyword">= </span><span class="default">B</span><span class="keyword">::</span><span class="default">getInstance</span><span class="keyword">();<br />
<br />
echo </span><span class="string">"\$a is a " </span><span class="keyword">. </span><span class="default">get_class</span><span class="keyword">(</span><span class="default">$a</span><span class="keyword">) . </span><span class="string">"&lt;br /&gt;"</span><span class="keyword">;<br />
echo </span><span class="string">"\$b is a " </span><span class="keyword">. </span><span class="default">get_class</span><span class="keyword">(</span><span class="default">$b</span><span class="keyword">) . </span><span class="string">"&lt;br /&gt;"</span><span class="keyword">;<br />
</span><span class="default">?&gt;<br />
</span>This would output:<br />
$a is a A<br />
$b is a B<br />
<br />
The only alternative as described elsewhere is to make getInstance() protected abstract, accept the class name as an argument, and extend this call with a public final method for every sub-class which uses get_class() in its local object scope and passes it to the superclass.<br />
<br />
Or else create a singleton factory like this:<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">final class </span><span class="default">SingletonFactory </span><span class="keyword">{<br />
&nbsp;&nbsp;&nbsp; protected static </span><span class="default">$instances </span><span class="keyword">= array();<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; protected </span><span class="default">getInstance</span><span class="keyword">(</span><span class="default">$class</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if (!isset(</span><span class="default">self</span><span class="keyword">::</span><span class="default">$instances</span><span class="keyword">[</span><span class="default">$class</span><span class="keyword">])) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">self</span><span class="keyword">::</span><span class="default">$instances</span><span class="keyword">[</span><span class="default">$class</span><span class="keyword">] = new </span><span class="default">$class</span><span class="keyword">();<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">self</span><span class="keyword">::</span><span class="default">$instances</span><span class="keyword">[</span><span class="default">$class</span><span class="keyword">];<br />
&nbsp;&nbsp;&nbsp; }<br />
}<br />
</span><span class="default">?&gt;<br />
</span>The downside to this of course to this latter model is that the class itself doesn't get to decide if it is a singleton, the calling code gets to decide this instead, and a class that really wants or *needs* to be a singleton has no way to enforce this, not even by making its constructor protected.<br />
<br />
Basically these design patterns, and various other meta manipulations (things which operate on the nature of the object, not on the data the object holds) could benefit greatly from knowing exactly what the final type of this object is, and not having native access to this information obligates work-arounds.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="75862""></a>
  <div class="note">
   <strong class="user">Bryan</strong>
   <a href="#75862" class="date">19-Jun-2007 05:07</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
janci's Singleton example is all well and good, until you create another class "Bar" which also extends Singleton.<br />
<br />
<span class="default">&lt;?php<br />
$single_foo </span><span class="keyword">= </span><span class="default">Foo</span><span class="keyword">::</span><span class="default">getInstance</span><span class="keyword">();<br />
</span><span class="default">$single_bar </span><span class="keyword">= </span><span class="default">Bar</span><span class="keyword">::</span><span class="default">getInstance</span><span class="keyword">();<br />
</span><span class="default">?&gt;<br />
</span><br />
$single_bar will now be an instance of Foo! This is because there is only one copy of the static variable $__instance in the Singleton class. Here is a better Singleton class:<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">abstract class </span><span class="default">Singleton </span><span class="keyword">{<br />
&nbsp;&nbsp;&nbsp; static </span><span class="default">$_instances </span><span class="keyword">= array();<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">//Prevent singletons from being instantiated other than via getInstance();<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">protected function </span><span class="default">__construct</span><span class="keyword">() {}<br />
&nbsp;&nbsp;&nbsp; protected function </span><span class="default">__clone</span><span class="keyword">() {}<br />
&nbsp;&nbsp; &nbsp; &nbsp; <br />
&nbsp;&nbsp;&nbsp; static function </span><span class="default">getInstance</span><span class="keyword">(</span><span class="default">$class_name</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if(!isset(</span><span class="default">self</span><span class="keyword">::</span><span class="default">$_instances</span><span class="keyword">[</span><span class="default">$class_name</span><span class="keyword">])) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">self</span><span class="keyword">::</span><span class="default">$_instances</span><span class="keyword">[</span><span class="default">$class_name</span><span class="keyword">] = new </span><span class="default">$class_name</span><span class="keyword">();<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">self</span><span class="keyword">::</span><span class="default">$_instances</span><span class="keyword">[</span><span class="default">$class_name</span><span class="keyword">];<br />
&nbsp;&nbsp;&nbsp; }<br />
}</span><span class="default">?&gt;<br />
</span><br />
Unfortunately, you are still required to define Foo as janci does. I would love to see an example where the only thing you add to the class is "extends Singleton" and you're done, but that seems to be impossible.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="74846""></a>
  <div class="note">
   <strong class="user">janci</strong>
   <a href="#74846" class="date">30-Apr-2007 09:00</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
To yicheng zero-four at gmail dot com: Another, maybe better example where finding out the real class (not the class we are in) in static method should be quite usefull is the Singleton pattern. <br />
<br />
There is currently no way how to create an abstract Singleton class that could be used just by extending it without the need to change the extended class. Consider this example:<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">abstract class </span><span class="default">Singleton<br />
</span><span class="keyword">{<br />
&nbsp;&nbsp;&nbsp; protected static </span><span class="default">$__instance </span><span class="keyword">= </span><span class="default">false</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; public static function </span><span class="default">getInstance</span><span class="keyword">()<br />
&nbsp;&nbsp;&nbsp; {&nbsp; &nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">self</span><span class="keyword">::</span><span class="default">$__instance </span><span class="keyword">== </span><span class="default">false</span><span class="keyword">)<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// This acctually is not what we want, $class will always be 'Singleton' :(<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$class </span><span class="keyword">= </span><span class="default">get_class</span><span class="keyword">();<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">self</span><span class="keyword">::</span><span class="default">$__instance </span><span class="keyword">= new </span><span class="default">$class</span><span class="keyword">();&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">self</span><span class="keyword">::</span><span class="default">$__instance</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }<br />
}<br />
<br />
class </span><span class="default">Foo </span><span class="keyword">extends </span><span class="default">Singleton<br />
</span><span class="keyword">{<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">// ...<br />
</span><span class="keyword">}<br />
<br />
</span><span class="default">$single_foo </span><span class="keyword">= </span><span class="default">Foo</span><span class="keyword">::</span><span class="default">getInstance</span><span class="keyword">();<br />
</span><span class="default">?&gt;<br />
</span>This piece of code will result in a fatal error saying: Cannot instantiate abstract class Singleton in ... on line 11<br />
<br />
The best way I figured out how to avoid this requires simple but still a change of the extended (Foo) class:<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">abstract class </span><span class="default">Singleton<br />
</span><span class="keyword">{<br />
&nbsp;&nbsp;&nbsp; protected static </span><span class="default">$__instance </span><span class="keyword">= </span><span class="default">false</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; protected static function </span><span class="default">getInstance</span><span class="keyword">(</span><span class="default">$class</span><span class="keyword">)<br />
&nbsp;&nbsp;&nbsp; {&nbsp; &nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">self</span><span class="keyword">::</span><span class="default">$__instance </span><span class="keyword">== </span><span class="default">false</span><span class="keyword">)<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">class_exists</span><span class="keyword">(</span><span class="default">$class</span><span class="keyword">))<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">self</span><span class="keyword">::</span><span class="default">$__instance </span><span class="keyword">= new </span><span class="default">$class</span><span class="keyword">();&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; else <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; throw new </span><span class="default">Exception</span><span class="keyword">(</span><span class="string">'Cannot instantiate undefined class [' </span><span class="keyword">. </span><span class="default">$class </span><span class="keyword">. </span><span class="string">']'</span><span class="keyword">, </span><span class="default">1</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">self</span><span class="keyword">::</span><span class="default">$__instance</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }<br />
}<br />
<br />
class </span><span class="default">Foo </span><span class="keyword">extends </span><span class="default">Singleton<br />
</span><span class="keyword">{<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">// You have to overload the getInstance method in each extended class:<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">public static function </span><span class="default">getInstance</span><span class="keyword">()<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">parent</span><span class="keyword">::</span><span class="default">getInstance</span><span class="keyword">(</span><span class="default">get_class</span><span class="keyword">());<br />
&nbsp;&nbsp;&nbsp; }<br />
}<br />
<br />
</span><span class="default">$single_foo </span><span class="keyword">= </span><span class="default">Foo</span><span class="keyword">::</span><span class="default">getInstance</span><span class="keyword">();<br />
</span><span class="default">?&gt;<br />
</span><br />
This is of course nothing horrible, you will propably need to change something in the extended class anyway (at least the constructor access), but still... it is just not as nice as it possibly could be ;)</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="74802""></a>
  <div class="note">
   <strong class="user">yicheng zero-four at gmail dot com</strong>
   <a href="#74802" class="date">27-Apr-2007 09:29</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
To matsgefvert dot se and Marc,<br />
<br />
I'm sorry but I'm still having a very difficult time understanding why you would want this behavior.&nbsp; I understand that you are generating some code for some persistent layer for database access.&nbsp; <br />
<br />
In your code example, Marc, you say that you would like the SomeTable::read() to return "SomeTable" when called from your client.&nbsp; Yet, at this point you *know* what the class name is.&nbsp; Even assuming you are generating this code automatically, you can simply generate your SomeTable class as such.<br />
<br />
<span class="default">&lt;?php<br />
<br />
</span><span class="keyword">class </span><span class="default">PersistedObject </span><span class="keyword">{<br />
&nbsp; </span><span class="comment">//...<br />
&nbsp; </span><span class="keyword">public static function </span><span class="default">read</span><span class="keyword">(</span><span class="default">$table</span><span class="keyword">, </span><span class="default">$key</span><span class="keyword">){<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">// do some databasey stuff <br />
&nbsp;&nbsp;&nbsp; // with $table which is the table name<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">return </span><span class="default">$table</span><span class="keyword">;<br />
&nbsp; }<br />
}<br />
<br />
class </span><span class="default">SomeTable </span><span class="keyword">extends </span><span class="default">PersistedObject </span><span class="keyword">{<br />
&nbsp; </span><span class="comment">//...<br />
&nbsp; // make a copy in the child class<br />
&nbsp; </span><span class="keyword">public static function </span><span class="default">read</span><span class="keyword">(</span><span class="default">$key</span><span class="keyword">){<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$table </span><span class="keyword">= </span><span class="default">get_class</span><span class="keyword">();<br />
&nbsp;&nbsp;&nbsp; return </span><span class="default">parent</span><span class="keyword">::</span><span class="default">read</span><span class="keyword">(</span><span class="default">$table</span><span class="keyword">, </span><span class="default">$key</span><span class="keyword">);<br />
&nbsp; }<br />
}<br />
<br />
</span><span class="comment">// this will now return "SomeTable"<br />
</span><span class="default">$someTableObject </span><span class="keyword">= </span><span class="default">SomeTable</span><span class="keyword">::</span><span class="default">read</span><span class="keyword">(</span><span class="default">1234</span><span class="keyword">);<br />
<br />
</span><span class="default">?&gt;<br />
</span><br />
I'm still failing to see how this would provide but a convenience for very rare &amp; specific issues, at the cost of non-OOP behavior by allowing static methods to bind to objects instead of classes.&nbsp; <br />
<br />
One of the most common uses for get_class() is for debugging lines, for example:<br />
<br />
<span class="default">&lt;?php<br />
<br />
</span><span class="keyword">class </span><span class="default">PersistedObject </span><span class="keyword">{<br />
&nbsp; </span><span class="comment">//...<br />
&nbsp; </span><span class="keyword">public static function </span><span class="default">transaction</span><span class="keyword">(</span><span class="default">$params</span><span class="keyword">){<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">// do some stuff<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">if (</span><span class="default">$error_occurred</span><span class="keyword">){<br />
&nbsp;&nbsp; &nbsp;&nbsp; echo </span><span class="string">"Error : WTFBBQ happened in " </span><span class="keyword">. </span><span class="default">get_class</span><span class="keyword">() . </span><span class="string">"::" </span><span class="keyword">. </span><span class="default">__FUNCTION__ </span><span class="keyword">. </span><span class="string">".&nbsp; Time to get some coffee!"</span><span class="keyword">;<br />
&nbsp; }<br />
}<br />
<br />
class </span><span class="default">SomeTable </span><span class="keyword">extends </span><span class="default">PersistedObject </span><span class="keyword">{<br />
&nbsp; </span><span class="comment">//...<br />
</span><span class="keyword">}<br />
<br />
</span><span class="default">SomeTable</span><span class="keyword">::</span><span class="default">transaction</span><span class="keyword">( </span><span class="default">$someParams </span><span class="keyword">);<br />
</span><span class="default">?&gt;<br />
</span><br />
Now, when an error occurs inside the call to SomeTable::transaction(), we get incorrect error output.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="74514""></a>
  <div class="note">
   <strong class="user">Kerry Kobashi</strong>
   <a href="#74514" class="date">15-Apr-2007 08:58</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
It should be noted that class names are represented in lowercase under PHP 4.x. <br />
<br />
class MyClass {<br />
&nbsp;&nbsp; function MyClass() {<br />
&nbsp;&nbsp; }<br />
&nbsp;&nbsp; function ShowClass() {<br />
&nbsp;&nbsp; &nbsp;&nbsp; echo get_class($this);<br />
&nbsp;&nbsp; }<br />
}<br />
<br />
$p = new MyClass();<br />
$p-&gt;ShowClass();<br />
<br />
Displays:<br />
<br />
myclass<br />
<br />
If you serialize $p, you will also see that the class name is lower case as well:<br />
<br />
$p = new MyClass();<br />
echo serialize($p);<br />
<br />
Displays:<br />
<br />
O:7:"myclass":1:{s:3:"val";i:100;}<br />
<br />
In my case, this is an important point for mapping class names to database table names (and vice versa).</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="74491""></a>
  <div class="note">
   <strong class="user">Marc W.</strong>
   <a href="#74491" class="date">13-Apr-2007 06:40</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
The previous comment (from matsgefvert dot se) is 100% correct. To further elaborate on the persistence layers example suggested, consider the case where you are dynamically creating inherited objects. For example:<br />
<span class="default">&lt;?php<br />
<br />
</span><span class="keyword">class </span><span class="default">PersistedObject </span><span class="keyword">{<br />
</span><span class="comment">//...<br />
</span><span class="keyword">public static function </span><span class="default">read</span><span class="keyword">(</span><span class="default">$key</span><span class="keyword">){<br />
</span><span class="comment">//You will need the table name here to actually read<br />
// from the persistence medium<br />
</span><span class="keyword">echo </span><span class="default">get_class</span><span class="keyword">();<br />
}<br />
<br />
class </span><span class="default">SomeTable </span><span class="keyword">extends </span><span class="default">PersistedObject </span><span class="keyword">{<br />
</span><span class="comment">//...<br />
</span><span class="keyword">}<br />
<br />
</span><span class="comment">/*<br />
Somewhere else in our code we would like to call the read method<br />
*/<br />
<br />
</span><span class="default">$someTableObject </span><span class="keyword">= </span><span class="default">SomeTable</span><span class="keyword">::</span><span class="default">read</span><span class="keyword">(</span><span class="default">1234</span><span class="keyword">);<br />
<br />
</span><span class="default">?&gt;<br />
</span>Remember that the SomeTable class would be generated on the fly, probably by some DB schema. The problem is that you would actually like the above example to output "SomeTable", but unfortunately, it will output "PersistedObject".</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="73467""></a>
  <div class="note">
   <strong class="user">spam at matsgefvert dot se</strong>
   <a href="#73467" class="date">24-Feb-2007 10:37</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I disagree with the notion that the authors of the previous posts are unfamiliar with OOP. Without the ability to know from general (parent) objects what kind of classes we're operating on, it makes things rather difficult, especially in building frameworks that rely heavily on class types (e.g. persistence layers).<br />
<br />
The proposed BooBoof::getclass() and CooCoof::getclass() scheme will not work in some particular scenarios since static calls aren't virtual, which means a parent class will always call its own getclass() function instead of the one needed to find out the class name.<br />
<br />
The only solution I've found is to pass along a string containing the class name we're working on to the generalized functions. It is however an ugly solution, certainly less than ideal and goes against what OOP and reflection is all about, IMHO.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="72440""></a>
  <div class="note">
   <strong class="user">yicheng zero-four at gmail dot com</strong>
   <a href="#72440" class="date">18-Jan-2007 09:22</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
This a response to luke at liveoakinteractive dot com and davidc at php dot net.&nbsp; Static methods and variables, by definition, are bound to class types not object instances.&nbsp; You should not need to dynamically find out what class a static method belongs to, since the context of your code should make it quite obvious.&nbsp; Your questions reveals that you probably don't quite understand OOP quite yet (it took me a while as well).<br />
<br />
Luke, the observed behavior from your particular code snippet makes perfect sense when you think about it.&nbsp; The method getclass() is defined in BooBoof, so the __CLASS__ macro would be bound to BooBoof and defined in relation to the BooBoof class.&nbsp; The fact that CooCoof is a subclass of BooBoof just means that it gains a shortcut to BooBoof::getclass().&nbsp; So, in effect, you are really asking (in a convoluted way): "What is the class to which belongs the method call BooBoof::getclass()?"&nbsp; The correct solution (if you actually want/need to do this) is to simply implement CooCoof::getclass() { return __CLASS__; } inside of the CooCoof definition, and any childclasses that you want to mimic this behavior.&nbsp; CooCoof::getclass() will have the expected behavior.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="71812""></a>
  <div class="note">
   <strong class="user">makc dot the dot great at gmail dot com</strong>
   <a href="#71812" class="date">17-Dec-2006 06:29</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Check it out:<br />
<br />
<span class="default">&lt;?php<br />
<br />
</span><span class="keyword">class </span><span class="default">A </span><span class="keyword">{<br />
&nbsp;function </span><span class="default">s </span><span class="keyword">() { return </span><span class="string">"A::s"</span><span class="keyword">; }<br />
&nbsp;function </span><span class="default">s1 </span><span class="keyword">() { return </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">s</span><span class="keyword">(); }<br />
}<br />
<br />
class </span><span class="default">B </span><span class="keyword">extends </span><span class="default">A </span><span class="keyword">{<br />
&nbsp;function </span><span class="default">s </span><span class="keyword">() { return </span><span class="string">"B::s"</span><span class="keyword">; }<br />
}<br />
<br />
</span><span class="default">$a </span><span class="keyword">= new </span><span class="default">A</span><span class="keyword">(); echo </span><span class="default">$a</span><span class="keyword">-&gt;</span><span class="default">s1</span><span class="keyword">();<br />
echo </span><span class="string">"&lt;br&gt;"</span><span class="keyword">;<br />
</span><span class="default">$b </span><span class="keyword">= new </span><span class="default">B</span><span class="keyword">(); echo </span><span class="default">$b</span><span class="keyword">-&gt;</span><span class="default">s1</span><span class="keyword">();<br />
echo </span><span class="string">"&lt;br&gt;"</span><span class="keyword">;<br />
<br />
class </span><span class="default">C </span><span class="keyword">{<br />
&nbsp;static function </span><span class="default">s </span><span class="keyword">() { return </span><span class="string">"C::s"</span><span class="keyword">; }<br />
&nbsp;static function </span><span class="default">s1 </span><span class="keyword">() { return </span><span class="default">self</span><span class="keyword">::</span><span class="default">s</span><span class="keyword">(); }<br />
}<br />
<br />
class </span><span class="default">D </span><span class="keyword">extends </span><span class="default">C </span><span class="keyword">{<br />
&nbsp;static function </span><span class="default">s </span><span class="keyword">() { return </span><span class="string">"D::s"</span><span class="keyword">; }<br />
}<br />
<br />
echo </span><span class="default">C</span><span class="keyword">::</span><span class="default">s1</span><span class="keyword">();<br />
echo </span><span class="string">"&lt;br&gt;"</span><span class="keyword">;<br />
echo </span><span class="default">D</span><span class="keyword">::</span><span class="default">s1</span><span class="keyword">();<br />
echo </span><span class="string">"&lt;br&gt;"</span><span class="keyword">;<br />
<br />
</span><span class="default">?&gt;<br />
</span><br />
Output:<br />
A::s<br />
B::s<br />
C::s<br />
C::s<br />
<br />
Seems like static function always belong to its class.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="71574""></a>
  <div class="note">
   <strong class="user">luke at liveoakinteractive dot com</strong>
   <a href="#71574" class="date">06-Dec-2006 04:03</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
This note is a response to the earlier post by davidc at php dot net. Unfortunately, the solution posted for getting the class name from a static method does not work with inherited classes.<br />
<br />
Observe the following:<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">class </span><span class="default">BooBoof </span><span class="keyword">{<br />
&nbsp; public static function </span><span class="default">getclass</span><span class="keyword">() {<br />
&nbsp;&nbsp;&nbsp; return </span><span class="default">__CLASS__</span><span class="keyword">;<br />
&nbsp; }<br />
<br />
&nbsp; public function </span><span class="default">retrieve_class</span><span class="keyword">() {<br />
&nbsp;&nbsp;&nbsp; return </span><span class="default">get_class</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">);<br />
&nbsp; }<br />
}<br />
<br />
class </span><span class="default">CooCoof </span><span class="keyword">extends </span><span class="default">BooBoof </span><span class="keyword">{<br />
}<br />
<br />
echo </span><span class="default">CooCoof</span><span class="keyword">::</span><span class="default">getclass</span><span class="keyword">();<br />
</span><span class="comment">// outputs BooBoof<br />
<br />
</span><span class="default">$coocoof </span><span class="keyword">= new </span><span class="default">CooCoof</span><span class="keyword">;<br />
echo </span><span class="default">$coocoof</span><span class="keyword">-&gt;</span><span class="default">retrieve_class</span><span class="keyword">();<br />
</span><span class="comment">// outputs CooCoof<br />
</span><span class="default">?&gt;<br />
</span><br />
__CLASS__ and get_class($this) do not work the same way with inherited classes. I have been thus far unable to determine a reliable way to get the actual class from a static method.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="65249""></a>
  <div class="note">
   <strong class="user">benjaminhill at gmail dot com</strong>
   <a href="#65249" class="date">27-Apr-2006 07:47</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
More funkyness:<br />
<br />
class Parent {<br />
&nbsp;&nbsp; function displayTableName() {<br />
&nbsp;&nbsp; &nbsp;&nbsp; echo get_class($this);<br />
&nbsp;&nbsp; &nbsp;&nbsp; echo get_class();<br />
&nbsp;&nbsp; }<br />
}<br />
<br />
class Child {<br />
&nbsp;&nbsp; function __construct() {<br />
&nbsp;&nbsp; &nbsp;&nbsp; $this-&gt;displayTableName();<br />
&nbsp;&nbsp; }<br />
}<br />
<br />
Will return <br />
- Child<br />
- Parent<br />
<br />
So when they say "the object isn't required in PHP5" - they don't really mean it.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="58812""></a>
  <div class="note">
   <strong class="user">brjann at NOSPAMATALLgmail dot com</strong>
   <a href="#58812" class="date">16-Nov-2005 09:39</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
This behavior is unexpected, but good to be aware of<br />
<br />
class parentclass {<br />
&nbsp;&nbsp;&nbsp; public function getClass(){<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; echo get_class($this); //using "$this"<br />
&nbsp;&nbsp;&nbsp; }<br />
}<br />
class child extends parentclass {<br />
}<br />
<br />
$obj = new child();<br />
$obj-&gt;getClass(); //outputs "child"<br />
<br />
class parentclass {<br />
&nbsp;&nbsp;&nbsp; public function getClass(){<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; echo get_class(); //note, no "$this"<br />
&nbsp;&nbsp;&nbsp; }<br />
}<br />
class child extends parentclass {<br />
}<br />
<br />
$obj = new child();<br />
$obj-&gt;getClass(); //outputs "parentclass"</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="57146""></a>
  <div class="note">
   <strong class="user">wired at evd dot ru</strong>
   <a href="#57146" class="date">25-Sep-2005 11:25</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
There is one unexpected bahaviour (for me as least):<br />
<br />
<span class="default">&lt;?php<br />
<br />
&nbsp; </span><span class="keyword">class </span><span class="default">parent<br />
&nbsp; </span><span class="keyword">{<br />
&nbsp;&nbsp;&nbsp; ...<br />
<br />
&nbsp;&nbsp;&nbsp; public function </span><span class="default">getInstance </span><span class="keyword">(</span><span class="default">$id</span><span class="keyword">)<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp;&nbsp; ...<br />
<br />
&nbsp;&nbsp; &nbsp;&nbsp; print </span><span class="default">get_class</span><span class="keyword">() . </span><span class="string">"\n" </span><span class="keyword">. </span><span class="default">__CLASS__</span><span class="keyword">;<br />
<br />
&nbsp;&nbsp; &nbsp;&nbsp; ...<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp; }<br />
<br />
&nbsp; class </span><span class="default">child </span><span class="keyword">extends </span><span class="default">parent<br />
&nbsp; </span><span class="keyword">{<br />
&nbsp;&nbsp;&nbsp; ...<br />
&nbsp; }<br />
<br />
&nbsp; </span><span class="default">child</span><span class="keyword">::</span><span class="default">getInstance</span><span class="keyword">(...);<br />
</span><span class="default">?&gt;<br />
</span><br />
This code will produce:<br />
<br />
&nbsp; parent<br />
&nbsp; parent<br />
<br />
So I can't make "new $className(...)" in getInstance(). The only option is to do a fabric.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="55089""></a>
  <div class="note">
   <strong class="user">kunxin at creaion dot com</strong>
   <a href="#55089" class="date">25-Jul-2005 02:30</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I just migrated from PHP 4 to PHP 5 and noticed that in PHP 5.03 that a lot of code dependent on get_class() and its variants stop working.<br />
<br />
It turns out that get_class() and its variants are now case-sensitive.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="54480""></a>
  <div class="note">
   <strong class="user">refrozen dot com</strong>
   <a href="#54480" class="date">06-Jul-2005 12:01</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
philip at cornado dot com, it returns the value of the class from which it was called, rather than the instance's name... causing inheritance to result in unexpected returns</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="39558""></a>
  <div class="note">
   <strong class="user">MagicalTux at FF.ST</strong>
   <a href="#39558" class="date">02-Feb-2004 01:11</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Note that the constant __CLASS__ is different from get_class($this) :<br />
&lt;?<br />
&nbsp; class test {<br />
&nbsp;&nbsp;&nbsp; function whoami() {<br />
&nbsp;&nbsp; &nbsp;&nbsp; echo "Hello, I'm whoami 1 !\r\n";<br />
&nbsp;&nbsp; &nbsp;&nbsp; echo "Value of __CLASS__ : ".__CLASS__."\r\n";<br />
&nbsp;&nbsp; &nbsp;&nbsp; echo "Value of get_class() : ".get_class($this)."\r\n\r\n";<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp; }<br />
&nbsp; class test2 extends test {<br />
&nbsp;&nbsp;&nbsp; function whoami2() {<br />
&nbsp;&nbsp; &nbsp;&nbsp; echo "Hello, I'm whoami 2 !\r\n";<br />
&nbsp;&nbsp; &nbsp;&nbsp; echo "Value of __CLASS__ : ".__CLASS__."\r\n";<br />
&nbsp;&nbsp; &nbsp;&nbsp; echo "Value of get_class() : ".get_class($this)."\r\n\r\n";<br />
&nbsp;&nbsp; &nbsp;&nbsp; parent::whoami(); // call parent whoami() function<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp; }<br />
&nbsp; $test=new test;<br />
&nbsp; $test-&gt;whoami();<br />
&nbsp; $test2=new test2;<br />
&nbsp; $test2-&gt;whoami();<br />
&nbsp; $test2-&gt;whoami2();<br />
?&gt;<br />
<br />
The output is :<br />
Hello, I'm whoami 1 !<br />
Value of __CLASS__ : test<br />
Value of get_class() : test<br />
<br />
Hello, I'm whoami 1 !<br />
Value of __CLASS__ : test<br />
Value of get_class() : test2<br />
<br />
Hello, I'm whoami 2 !<br />
Value of __CLASS__ : test2<br />
Value of get_class() : test2<br />
<br />
Hello, I'm whoami 1 !<br />
Value of __CLASS__ : test<br />
Value of get_class() : test2<br />
<br />
In fact, __CLASS__ returns the name of the class the function is in and get_class($this) returns the name of the class which was created.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="29006""></a>
  <div class="note">
   <strong class="user">Dan</strong>
   <a href="#29006" class="date">30-Jan-2003 07:00</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
This function does return the class name in lowercase, but that does not seem to make any difference. The code below, although very sloppy, works fine in all of the following configurations.<br />
<br />
PHP 4.2.2 on Windows NT5 with Apache 1.3.24<br />
PHP 4.2.1 in Zend Development Environment on box above<br />
PHP 4.2.3 on Linux RedHat 7.3 with Apache 1.3.27<br />
<br />
class TeSt {<br />
&nbsp;&nbsp; var $a;<br />
&nbsp;&nbsp; var $b = "Fred";<br />
<br />
&nbsp;&nbsp; // Notice the case difference in the constructor name<br />
<br />
&nbsp;&nbsp; function Test() {<br />
&nbsp;&nbsp; &nbsp;&nbsp; $classname = get_class($this); // $classname = "test"<br />
&nbsp;&nbsp; &nbsp;&nbsp; $this-&gt;ra = get_class_vars($classname);<br />
&nbsp;&nbsp; }<br />
}<br />
// Next line also works with Test(), TEST(), or test()<br />
$obj = new TeSt();<br />
print_r($obj-&gt;ra);<br />
<br />
Result :<br />
&nbsp;&nbsp; Array<br />
&nbsp;&nbsp; (<br />
&nbsp;&nbsp; &nbsp; &nbsp; [a] =&gt; <br />
&nbsp;&nbsp; &nbsp; &nbsp; [b] =&gt; Fred<br />
&nbsp;&nbsp; )</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="24326""></a>
  <div class="note">
   <strong class="user">oliver DOT pliquett @mediagear DOT de</strong>
   <a href="#24326" class="date">13-Aug-2002 05:07</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
This function can become _VERY_ helpful if you want to return a new object of the same type. See this example:<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">class </span><span class="default">Foo</span><span class="keyword">{<br />
&nbsp;&nbsp;&nbsp; var </span><span class="default">$name</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; function </span><span class="default">Foo</span><span class="keyword">( </span><span class="default">$parameter </span><span class="keyword">){<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">name </span><span class="keyword">= </span><span class="default">$parameter</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp;&nbsp; function </span><span class="default">whoami</span><span class="keyword">() {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; echo </span><span class="string">"I'm a " </span><span class="keyword">. </span><span class="default">get_class</span><span class="keyword">( </span><span class="default">$this </span><span class="keyword">) .</span><span class="string">"\n"</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; function </span><span class="default">getNew</span><span class="keyword">() {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$className </span><span class="keyword">= </span><span class="default">get_class</span><span class="keyword">( </span><span class="default">$this </span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// here it happens:<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">return new </span><span class="default">$className </span><span class="keyword">( </span><span class="string">"world" </span><span class="keyword">) ;<br />
&nbsp;&nbsp;&nbsp; }<br />
}<br />
class </span><span class="default">Bar </span><span class="keyword">extends </span><span class="default">Foo </span><span class="keyword">{<br />
<br />
&nbsp;&nbsp;&nbsp; function </span><span class="default">Bar</span><span class="keyword">( </span><span class="default">$name </span><span class="keyword">){<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">Foo</span><span class="keyword">( </span><span class="default">$name </span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp;&nbsp; function </span><span class="default">welcome</span><span class="keyword">() {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; echo </span><span class="string">"Hello, " </span><span class="keyword">. </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">name </span><span class="keyword">.&nbsp; </span><span class="string">"! \n"</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; } <br />
}<br />
<br />
</span><span class="comment">// We generate a Bar object:<br />
</span><span class="default">$myBar </span><span class="keyword">= new </span><span class="default">Bar</span><span class="keyword">( </span><span class="string">"Oliver" </span><span class="keyword">);<br />
</span><span class="default">$myBar</span><span class="keyword">-&gt;</span><span class="default">welcome</span><span class="keyword">();<br />
<br />
</span><span class="comment">//now let's instanciate a new Bar object. <br />
//note: this method is inherited from Foo by Bar!<br />
<br />
</span><span class="default">$baba </span><span class="keyword">= </span><span class="default">$myBar</span><span class="keyword">-&gt;</span><span class="default">getNew</span><span class="keyword">();<br />
<br />
</span><span class="default">$baba</span><span class="keyword">-&gt;</span><span class="default">welcome</span><span class="keyword">();<br />
</span><span class="default">$baba</span><span class="keyword">-&gt;</span><span class="default">whoami</span><span class="keyword">();<br />
<br />
</span><span class="comment">/* Output: <br />
Hello, Oliver!<br />
Hello, world!<br />
I'm a bar <br />
*/<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="22515""></a>
  <div class="note">
   <strong class="user">philip at cornado dot com</strong>
   <a href="#22515" class="date">20-Jun-2002 09:15</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
As of PHP 4.3.0 the constant __CLASS__ exists and contains the class name.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
</div>
</div>
<hr /><div class="manualnavbar" style="text-align: center;">
 <div class="prev" style="text-align: left; float: left;"><a href="function.get-class-vars.html">get_class_vars</a></div>
 <div class="next" style="text-align: right; float: right;"><a href="function.get-declared-classes.html">get_declared_classes</a></div>
 <div class="up"><a href="ref.classobj.html">クラス/オブジェクト関数</a></div>
 <div class="home"><a href="index.html">PHP Manual</a></div>
</div></body></html>
