<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
 <head>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <title>ユーザーレベルのエラー/警告/通知メッセージを生成する</title>
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <link media="all" rel="stylesheet" type="text/css" href="style.css"/>
 </head>
 <body class="docs"><div class="manualnavbar" style="text-align: center;">
 <div class="prev" style="text-align: left; float: left;"><a href="function.set-exception-handler.html">set_exception_handler</a></div>
 <div class="next" style="text-align: right; float: right;"><a href="function.user-error.html">user_error</a></div>
 <div class="up"><a href="ref.errorfunc.html">エラー処理関数</a></div>
 <div class="home"><a href="index.html">PHP Manual</a></div>
</div><hr /><div id="function.trigger-error" class="refentry">
 <div class="refnamediv">
  <h1 class="refname">trigger_error</h1>
  <p class="verinfo">(PHP 4 &gt;= 4.0.1, PHP 5)</p><p class="refpurpose"><span class="refname">trigger_error</span> &mdash; <span class="dc-title">ユーザーレベルのエラー/警告/通知メッセージを生成する</span></p>

 </div>

 <div class="refsect1 description" id="refsect1-function.trigger-error-description">
  <h3 class="title">説明</h3>
  <div class="methodsynopsis dc-description"> <span class="type">bool</span> <span class="methodname"><strong>trigger_error</strong></span>
    ( <span class="methodparam"><span class="type">string</span> <code class="parameter">$error_msg</code></span>
   [, <span class="methodparam"><span class="type">int</span> <code class="parameter">$error_type</code><span class="initializer"> = E_USER_NOTICE</span></span>
  ] )</div>

  <p class="para rdfs-comment">
   ユーザーエラーを発生させるために使います。組み込みのエラーハンドラまたは新しいエラーハンドラ ( <span class="function"><a href="function.set-error-handler.html" class="function">set_error_handler()</a></span>)
   として設定済みのユーザー定義関数と組み合わせて使うこともできます。
  </p>
  <p class="para">
   この関数は、実行時の例外に特定の応答を生成する必要がある場合に便利です。
  </p>
 </div>


 <div class="refsect1 parameters" id="refsect1-function.trigger-error-parameters">
  <h3 class="title">パラメータ</h3>
  <p class="para">
   <dl>

    <dt>

     <span class="term"><em><code class="parameter">error_msg</code></em></span>
     <dd>

      <p class="para">
       このエラーに割り当てられたメッセージ。長さは最大 1024 バイトまでです。1024 バイトを超える部分は切り捨てられます。
      </p>
     </dd>

    </dt>

    <dt>

     <span class="term"><em><code class="parameter">error_type</code></em></span>
     <dd>

      <p class="para">
       このエラーに割り当てられたエラー型です。E_USER 関連の定数のみが指定可能で、デフォルトは <strong><code>E_USER_NOTICE</code></strong> です。
      </p>
     </dd>

    </dt>

   </dl>

  </p>
 </div>


 <div class="refsect1 returnvalues" id="refsect1-function.trigger-error-returnvalues">
  <h3 class="title">返り値</h3>
  <p class="para">
   この関数は、間違った <em><code class="parameter">error_type</code></em> が指定された場合に <strong><code>FALSE</code></strong> を、それ以外の場合に <strong><code>TRUE</code></strong> を返します。
  </p>
 </div>


 <div class="refsect1 examples" id="refsect1-function.trigger-error-examples">
  <h3 class="title">例</h3>
  <p class="para">
   <div class="example" id="example-455">
    <p><strong>例1  <span class="function"><strong>trigger_error()</strong></span> の例</strong></p>
    <div class="example-contents"><p>
     より拡張した例については  <span class="function"><a href="function.set-error-handler.html" class="function">set_error_handler()</a></span>
     を参照ください。
    </p></div>
    <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br /></span><span style="color: #007700">if&nbsp;(</span><span style="color: #0000BB">$divisor&nbsp;</span><span style="color: #007700">==&nbsp;</span><span style="color: #0000BB">0</span><span style="color: #007700">)&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">trigger_error</span><span style="color: #007700">(</span><span style="color: #DD0000">"ゼロで割ることはできません"</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">E_USER_ERROR</span><span style="color: #007700">);<br />}<br /></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
    </div>

   </div>
  </p>
 </div>


 <div class="refsect1 notes" id="refsect1-function.trigger-error-notes">
  <h3 class="title">注意</h3>
  <div class="warning"><strong class="warning">警告</strong>
   <p class="para">
     <em><code class="parameter">error_msg</code></em> の HTML エンティティはエスケープされません。エラーをブラウザに表示するのであれば、メッセージに  <span class="function"><a href="function.htmlentities.html" class="function">htmlentities()</a></span> を使います。
   </p>
  </div>
 </div>


 <div class="refsect1 seealso" id="refsect1-function.trigger-error-seealso">
  <h3 class="title">参考</h3>
  <p class="para">
   <ul class="simplelist">
    <li class="member"> <span class="function"><a href="function.error-reporting.html" class="function" rel="rdfs-seeAlso">error_reporting()</a> - 出力する PHP エラーの種類を設定する</span></li>
    <li class="member"> <span class="function"><a href="function.set-error-handler.html" class="function" rel="rdfs-seeAlso">set_error_handler()</a> - ユーザー定義のエラーハンドラ関数を設定する</span></li>
    <li class="member"> <span class="function"><a href="function.restore-error-handler.html" class="function" rel="rdfs-seeAlso">restore_error_handler()</a> - 以前のエラーハンドラ関数を回復する</span></li>
    <li class="member"><a href="errorfunc.constants.html" class="link">エラーレベル定数</a></li>
   </ul>
  </p>
 </div>

</div><div id="usernotes">
 <div class="head">
  <h3 class="title">User Contributed Notes</h3>
 </div>
<div id="allnotes">  <a name="98910""></a>
  <div class="note">
   <strong class="user">PhpMyCoder</strong>
   <a href="#98910" class="date">15-Jul-2010 12:18</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
For those of you looking to use your own file or line number in the error (possibly using debug_backtrace()) instead of the ones created by trigger_error(), here is a solution:<br />
Create a custom function to handle E_USER_ERRORs that simply outputs the error type and message, while excluding the line number and file trigger_error() reports. You may also configure it to handle user warnings and notices if necessary (I did in the example below).<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">function </span><span class="default">error_handler</span><span class="keyword">(</span><span class="default">$level</span><span class="keyword">, </span><span class="default">$message</span><span class="keyword">, </span><span class="default">$file</span><span class="keyword">, </span><span class="default">$line</span><span class="keyword">, </span><span class="default">$context</span><span class="keyword">) {<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">//Handle user errors, warnings, and notices ourself<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">if(</span><span class="default">$level </span><span class="keyword">=== </span><span class="default">E_USER_ERROR </span><span class="keyword">|| </span><span class="default">$level </span><span class="keyword">=== </span><span class="default">E_USER_WARNING </span><span class="keyword">|| </span><span class="default">$level </span><span class="keyword">=== </span><span class="default">E_USER_NOTICE</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; echo </span><span class="string">'&lt;strong&gt;Error:&lt;/strong&gt; '</span><span class="keyword">.</span><span class="default">$message</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return(</span><span class="default">true</span><span class="keyword">); </span><span class="comment">//And prevent the PHP error handler from continuing<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">}<br />
&nbsp;&nbsp;&nbsp; return(</span><span class="default">false</span><span class="keyword">); </span><span class="comment">//Otherwise, use PHP's error handler<br />
</span><span class="keyword">}<br />
<br />
function </span><span class="default">trigger_my_error</span><span class="keyword">(</span><span class="default">$message</span><span class="keyword">, </span><span class="default">$level</span><span class="keyword">) {<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">//Get the caller of the calling function and details about it<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$callee </span><span class="keyword">= </span><span class="default">next</span><span class="keyword">(</span><span class="default">debug_backtrace</span><span class="keyword">());<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">//Trigger appropriate error<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">trigger_error</span><span class="keyword">(</span><span class="default">$message</span><span class="keyword">.</span><span class="string">' in &lt;strong&gt;'</span><span class="keyword">.</span><span class="default">$callee</span><span class="keyword">[</span><span class="string">'file'</span><span class="keyword">].</span><span class="string">'&lt;/strong&gt; on line &lt;strong&gt;'</span><span class="keyword">.</span><span class="default">$callee</span><span class="keyword">[</span><span class="string">'line'</span><span class="keyword">].</span><span class="string">'&lt;/strong&gt;'</span><span class="keyword">, </span><span class="default">$level</span><span class="keyword">);<br />
}<br />
<br />
</span><span class="comment">//Use our custom handler<br />
</span><span class="default">set_error_handler</span><span class="keyword">(</span><span class="string">'error_handler'</span><span class="keyword">);<br />
<br />
</span><span class="comment">//-------------------------------<br />
//Demo usage:<br />
//-------------------------------<br />
</span><span class="keyword">function </span><span class="default">abc</span><span class="keyword">(</span><span class="default">$str</span><span class="keyword">) {<br />
&nbsp;&nbsp;&nbsp; if(!</span><span class="default">is_string</span><span class="keyword">(</span><span class="default">$str</span><span class="keyword">)) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">trigger_my_error</span><span class="keyword">(</span><span class="string">'abc() expects parameter 1 to be a string'</span><span class="keyword">, </span><span class="default">E_USER_ERROR</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; }<br />
}<br />
<br />
</span><span class="default">abc</span><span class="keyword">(</span><span class="string">'Hello world!'</span><span class="keyword">); </span><span class="comment">//Works<br />
</span><span class="default">abc</span><span class="keyword">(</span><span class="default">18</span><span class="keyword">); </span><span class="comment">//Error: abc() expects parameter 1 to be a string in [FILE].php on line 31<br />
</span><span class="default">?&gt;<br />
</span><br />
This is a pretty simple concept and I'm sure most of you know this, but for those that don't, let it serve as a good example!</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="94081""></a>
  <div class="note">
   <strong class="user">tudor AT iccblue DOT com DOT nospam</strong>
   <a href="#94081" class="date">15-Oct-2009 05:07</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
It actually turns out - at least on PHP 5.2.6 on XAMPP (Windows) that for the custom error handler, you will need to set $errorType as the first parameter, and only the second parameter as $message, i.e. in reverse order compared to how the manual states it now.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="92016""></a>
  <div class="note">
   <strong class="user">Howard Yeend</strong>
   <a href="#92016" class="date">05-Jul-2009 01:39</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
trigger_error always reports the line and file that trigger_error was called on. Which isn't very useful.<br />
<br />
eg:<br />
<br />
main.php:<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">include(</span><span class="string">'functions.php'</span><span class="keyword">);<br />
</span><span class="default">$x </span><span class="keyword">= </span><span class="string">'test'</span><span class="keyword">;<br />
</span><span class="default">doFunction</span><span class="keyword">(</span><span class="default">$x</span><span class="keyword">);<br />
</span><span class="default">?&gt;<br />
</span><br />
functions.php:<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">function </span><span class="default">doFunction</span><span class="keyword">(</span><span class="default">$var</span><span class="keyword">) {<br />
if(</span><span class="default">is_numeric</span><span class="keyword">(</span><span class="default">$var</span><span class="keyword">)) {<br />
&nbsp;</span><span class="comment">/* do some stuff*/<br />
</span><span class="keyword">} else {<br />
&nbsp;</span><span class="default">trigger_error</span><span class="keyword">(</span><span class="string">'var must be numeric'</span><span class="keyword">);<br />
}<br />
}<br />
</span><span class="default">?&gt;<br />
</span><br />
will output "Notice: var must be numeric in functions.php on line 6"<br />
whereas "Notice: var must be numeric in main.php on line 4" would be more useful<br />
<br />
here's a function to do that:<br />
<br />
<span class="default">&lt;?php<br />
<br />
</span><span class="keyword">function </span><span class="default">error</span><span class="keyword">(</span><span class="default">$message</span><span class="keyword">, </span><span class="default">$level</span><span class="keyword">=</span><span class="default">E_USER_NOTICE</span><span class="keyword">) {<br />
</span><span class="default">$caller </span><span class="keyword">= </span><span class="default">next</span><span class="keyword">(</span><span class="default">debug_backtrace</span><span class="keyword">());<br />
</span><span class="default">trigger_error</span><span class="keyword">(</span><span class="default">$message</span><span class="keyword">.</span><span class="string">' in &lt;strong&gt;'</span><span class="keyword">.</span><span class="default">$caller</span><span class="keyword">[</span><span class="string">'function'</span><span class="keyword">].</span><span class="string">'&lt;/strong&gt; called from &lt;strong&gt;'</span><span class="keyword">.</span><span class="default">$caller</span><span class="keyword">[</span><span class="string">'file'</span><span class="keyword">].</span><span class="string">'&lt;/strong&gt; on line &lt;strong&gt;'</span><span class="keyword">.</span><span class="default">$caller</span><span class="keyword">[</span><span class="string">'line'</span><span class="keyword">].</span><span class="string">'&lt;/strong&gt;'</span><span class="keyword">.</span><span class="string">"\n&lt;br /&gt;error handler"</span><span class="keyword">, </span><span class="default">$level</span><span class="keyword">);<br />
}<br />
</span><span class="default">?&gt;<br />
</span><br />
So now in our example:<br />
<br />
main.php:<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">include(</span><span class="string">'functions.php'</span><span class="keyword">);<br />
</span><span class="default">$x </span><span class="keyword">= </span><span class="string">'test'</span><span class="keyword">;<br />
</span><span class="default">doFunction</span><span class="keyword">(</span><span class="default">$x</span><span class="keyword">);<br />
</span><span class="default">?&gt;<br />
</span><br />
functions.php:<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">function </span><span class="default">doFunction</span><span class="keyword">(</span><span class="default">$var</span><span class="keyword">) {<br />
&nbsp;&nbsp;&nbsp; if(</span><span class="default">is_numeric</span><span class="keyword">(</span><span class="default">$var</span><span class="keyword">)) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="comment">/* do some stuff*/<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">} else {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">error</span><span class="keyword">(</span><span class="string">'var must be numeric'</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; }<br />
}<br />
<br />
function </span><span class="default">error</span><span class="keyword">(</span><span class="default">$message</span><span class="keyword">, </span><span class="default">$level</span><span class="keyword">=</span><span class="default">E_USER_NOTICE</span><span class="keyword">) {<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$caller </span><span class="keyword">= </span><span class="default">next</span><span class="keyword">(</span><span class="default">debug_backtrace</span><span class="keyword">());<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">trigger_error</span><span class="keyword">(</span><span class="default">$message</span><span class="keyword">.</span><span class="string">' in &lt;strong&gt;'</span><span class="keyword">.</span><span class="default">$caller</span><span class="keyword">[</span><span class="string">'function'</span><span class="keyword">].</span><span class="string">'&lt;/strong&gt; called from &lt;strong&gt;'</span><span class="keyword">.</span><span class="default">$caller</span><span class="keyword">[</span><span class="string">'file'</span><span class="keyword">].</span><span class="string">'&lt;/strong&gt; on line &lt;strong&gt;'</span><span class="keyword">.</span><span class="default">$caller</span><span class="keyword">[</span><span class="string">'line'</span><span class="keyword">].</span><span class="string">'&lt;/strong&gt;'</span><span class="keyword">.</span><span class="string">"\n&lt;br /&gt;error handler"</span><span class="keyword">, </span><span class="default">$level</span><span class="keyword">);<br />
}<br />
</span><span class="default">?&gt;<br />
</span><br />
now outputs:<br />
<br />
"Notice: var must be numeric in doFunction called from main.php on line 4"<br />
<br />
<a href="http://www.puremango.co.uk" rel="nofollow" target="_blank">http://www.puremango.co.uk</a></span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="80206""></a>
  <div class="note">
   <strong class="user">webmaster at paramiliar dot com</strong>
   <a href="#80206" class="date">04-Jan-2008 08:11</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
We wanted to be able to pass an SQL query to the error handler on our site so we could monitor SQL problems, you cant do this through normal methods so we came up with this bridge script that 100% works<br />
<br />
<span class="default">&lt;?php<br />
<br />
</span><span class="keyword">function </span><span class="default">myErrorHandler</span><span class="keyword">(</span><span class="default">$errno</span><span class="keyword">, </span><span class="default">$errstr</span><span class="keyword">, </span><span class="default">$errfile</span><span class="keyword">, </span><span class="default">$errline</span><span class="keyword">){<br />
&nbsp;&nbsp;&nbsp; switch (</span><span class="default">$errno</span><span class="keyword">) {<br />
&nbsp;&nbsp;&nbsp; case </span><span class="default">E_USER_ERROR</span><span class="keyword">:<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">$errstr </span><span class="keyword">== </span><span class="string">"(SQL)"</span><span class="keyword">){<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// handling an sql error<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">echo </span><span class="string">"&lt;b&gt;SQL Error&lt;/b&gt; [</span><span class="default">$errno</span><span class="string">] " </span><span class="keyword">. </span><span class="default">SQLMESSAGE </span><span class="keyword">. </span><span class="string">"&lt;br /&gt;\n"</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; echo </span><span class="string">"Query : " </span><span class="keyword">. </span><span class="default">SQLQUERY </span><span class="keyword">. </span><span class="string">"&lt;br /&gt;\n"</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; echo </span><span class="string">"On line " </span><span class="keyword">. </span><span class="default">SQLERRORLINE </span><span class="keyword">. </span><span class="string">" in file " </span><span class="keyword">. </span><span class="default">SQLERRORFILE </span><span class="keyword">. </span><span class="string">" "</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; echo </span><span class="string">", PHP " </span><span class="keyword">. </span><span class="default">PHP_VERSION </span><span class="keyword">. </span><span class="string">" (" </span><span class="keyword">. </span><span class="default">PHP_OS </span><span class="keyword">. </span><span class="string">")&lt;br /&gt;\n"</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; echo </span><span class="string">"Aborting...&lt;br /&gt;\n"</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; } else {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; echo </span><span class="string">"&lt;b&gt;My ERROR&lt;/b&gt; [</span><span class="default">$errno</span><span class="string">] </span><span class="default">$errstr</span><span class="string">&lt;br /&gt;\n"</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; echo </span><span class="string">"&nbsp; Fatal error on line </span><span class="default">$errline</span><span class="string"> in file </span><span class="default">$errfile</span><span class="string">"</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; echo </span><span class="string">", PHP " </span><span class="keyword">. </span><span class="default">PHP_VERSION </span><span class="keyword">. </span><span class="string">" (" </span><span class="keyword">. </span><span class="default">PHP_OS </span><span class="keyword">. </span><span class="string">")&lt;br /&gt;\n"</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; echo </span><span class="string">"Aborting...&lt;br /&gt;\n"</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; exit(</span><span class="default">1</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; break;<br />
<br />
&nbsp;&nbsp;&nbsp; case </span><span class="default">E_USER_WARNING</span><span class="keyword">:<br />
&nbsp;&nbsp;&nbsp; case </span><span class="default">E_USER_NOTICE</span><span class="keyword">:<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">/* Don't execute PHP internal error handler */<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">return </span><span class="default">true</span><span class="keyword">;<br />
}<br />
<br />
</span><span class="comment">// function to test the error handling<br />
<br />
</span><span class="keyword">function </span><span class="default">sqlerrorhandler</span><span class="keyword">(</span><span class="default">$ERROR</span><span class="keyword">, </span><span class="default">$QUERY</span><span class="keyword">, </span><span class="default">$PHPFILE</span><span class="keyword">, </span><span class="default">$LINE</span><span class="keyword">){<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">define</span><span class="keyword">(</span><span class="string">"SQLQUERY"</span><span class="keyword">, </span><span class="default">$QUERY</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">define</span><span class="keyword">(</span><span class="string">"SQLMESSAGE"</span><span class="keyword">, </span><span class="default">$ERROR</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">define</span><span class="keyword">(</span><span class="string">"SQLERRORLINE"</span><span class="keyword">, </span><span class="default">$LINE</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">define</span><span class="keyword">(</span><span class="string">"SQLERRORFILE"</span><span class="keyword">, </span><span class="default">$PHPFILE</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">trigger_error</span><span class="keyword">(</span><span class="string">"(SQL)"</span><span class="keyword">, </span><span class="default">E_USER_ERROR</span><span class="keyword">);<br />
}<br />
<br />
</span><span class="default">set_error_handler</span><span class="keyword">(</span><span class="string">"myErrorHandler"</span><span class="keyword">);<br />
<br />
</span><span class="comment">// trigger an sql error<br />
</span><span class="default">$query </span><span class="keyword">= </span><span class="string">"SELECT * FROM tbl LIMIT 1"</span><span class="keyword">;<br />
</span><span class="default">$sql </span><span class="keyword">= @</span><span class="default">mysql_query</span><span class="keyword">(</span><span class="default">$query</span><span class="keyword">)<br />
&nbsp;&nbsp;&nbsp; or </span><span class="default">sqlerrorhandler</span><span class="keyword">(</span><span class="string">"("</span><span class="keyword">.</span><span class="default">mysql_errno</span><span class="keyword">().</span><span class="string">") "</span><span class="keyword">.</span><span class="default">mysql_error</span><span class="keyword">(), </span><span class="default">$query</span><span class="keyword">, </span><span class="default">$_SERVER</span><span class="keyword">[</span><span class="string">'PHP_SELF'</span><span class="keyword">], </span><span class="default">__LINE__</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; <br />
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="63910""></a>
  <div class="note">
   <strong class="user">richard at 2006 dot atterer dot net</strong>
   <a href="#63910" class="date">03-Apr-2006 06:28</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Beware, trigger_error() is absolutely useless for transporting your own function's error messages in $php_errormsg:<br />
<br />
ini_set('track_errors', TRUE);<br />
function x() { trigger_error('MY ERROR'); }<br />
@x();<br />
echo "Error 1: \\"$php_errormsg\\"\\n";<br />
@file_get_contents('/nonexisting');<br />
echo "Error 2: \\"$php_errormsg\\"\\n";<br />
<br />
This outputs:<br />
<br />
Error 1: ""<br />
Error 2: "failed to open stream: No such file or directory"<br />
<br />
This behaviour is consistent with the description of $php_errormsg, which says that the variable will only be available within the scope in which the error occurred. The problem can be worked around with a custom error handler like the one below. However, I'm undecided whether changing the language in this way is good:<br />
<br />
function errHandler($errno, $errstr, $errfile, $errline) {<br />
&nbsp; global $php_errormsg; $php_errormsg = $errstr;<br />
}<br />
set_error_handler('errHandler');</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="52255""></a>
  <div class="note">
   <strong class="user">mano at easymail dot hu</strong>
   <a href="#52255" class="date">26-Apr-2005 02:13</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I am not so familiar with this but I think you can reach some of the functionality of try..catch with this function. I would disagree or correct the previous note. The @ is not the catch, it sets the error_reporting to 0 tempolary but with set_error_handler you can try to imitate some behavior like catch.<br />
I've just made this to try if it possible, I never tried in projects but I think could work in php 4. Actually if you want to have the Trace of the error you need to use php4.3+.<br />
Maybe not many of you will create new scripts in php4 and try to have some features from php5 but in some cases (extending older projects) this could be better error handling.<br />
<br />
If this is a wrong approach, waiting for comments, if its not, use it!<br />
<br />
&lt;?<br />
function catch($errno, $errstr, $errfile, $errline){<br />
&nbsp;&nbsp;&nbsp; $GLOBALS['throw'] = $errstr;<br />
&nbsp;&nbsp;&nbsp; $GLOBALS['throw_info'] = array(<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; 'Message'=&gt;$errstr<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; ,'Code'=&gt;$errno<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; ,'Line'=&gt;$errline<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; ,'File'=&gt;$errfile<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; ,'Trace'=&gt;debug_backtrace()<br />
&nbsp;&nbsp;&nbsp; );<br />
&nbsp;&nbsp;&nbsp; <br />
}<br />
set_error_handler('catch');<br />
<br />
function badgirl(){<br />
&nbsp;&nbsp;&nbsp; if(true){ //error occure<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; trigger_error("BadGirlWithError",E_USER_NOTICE); // as throw with notice<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return; // ...because trigger_error does not stop the function<br />
&nbsp;&nbsp;&nbsp; }else{<br />
&nbsp;&nbsp; &nbsp; &nbsp; return true;<br />
&nbsp;&nbsp;&nbsp; }<br />
}<br />
<br />
// Try <br />
$GLOBALS['throw'] = null; // ...try...<br />
$sheis = badgirl(); //could be @badgirl, display_errors is something else, this just the handling<br />
// ..try<br />
if($GLOBALS['throw']){&nbsp; // This actually catch re-throws too...<br />
&nbsp;&nbsp;&nbsp; switch($GLOBALS['throw']){ // Catch<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; case 'GoodGirlException':<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; die('No bad girl today!');<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; break;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; case 'BadGirlWithError':<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; die('Bad girl has some error');<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; break;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; default:<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return; // or you can make another trigger_error and re-throw another 'exception' or some other action<br />
&nbsp;&nbsp;&nbsp; }<br />
}<br />
echo "You will never see this line - @ only supress message, not a control flow";<br />
echo "Wrong! You could see this:)";<br />
<br />
?&gt;<br />
<br />
.mano</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="39196""></a>
  <div class="note">
   <strong class="user">dzn'tM@ter</strong>
   <a href="#39196" class="date">20-Jan-2004 06:05</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Some might think that trigger_error is like a throw() or an err.raise construction, and @ works like catch(){} one - in fact it's NOT.<br />
<br />
function badgirl(){<br />
&nbsp;&nbsp;&nbsp; trigger_error("shame on me",E_USER_ERROR);<br />
&nbsp;&nbsp;&nbsp; return true;<br />
}<br />
<br />
$sheis = @badgirl();<br />
echo "You will never see this line - @ only supress message, not a control flow";</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="36043""></a>
  <div class="note">
   <strong class="user">robert at klugher dot com</strong>
   <a href="#36043" class="date">24-Sep-2003 02:12</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
This one took me some time ...<br />
<br />
When you use trigger_error with your own error handler, the class instances are destroyed (don't know how to say it better, I am not an expert).<br />
<br />
So, if you try to call a class function from within the error handler function, you will get 'Call to a member function on a non-object' error, even if this function works perfectly in the rest of your script.<br />
<br />
Solution : re-use the xxx = new yyy to re-create the instance in the beginning of your error handler ... and then you can call the class functions you want !</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="34526""></a>
  <div class="note">
   <strong class="user">mail at dooley dot cjb dot net</strong>
   <a href="#34526" class="date">30-Jul-2003 04:16</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
i recently began using a custom error handling class. the biggest problem is that, with call time pass by reference deprecated, you can't manipulate the error handler class after assigning at as the error handler (and it appears not to be returned by the set_error_handler method as the old error handler). my goal was to be able to store up all my non-fatal errors and print them at the end of script execution. that way i can use 'trigger_error' (which i actually have wrapped in a static method ErrorHandler::throwException for portability purposes... which is a pain because it always has the same line number information!!) for all kinds of errors, including user input erros. so when i check a user's password, for instance i would trigger a warning that said 'incorrect password'. of course i would only want this to print out the error once the script had completed. <br />
<br />
so in my error handler class i have the following in the constructor:<br />
<br />
function ErrorHandler()<br />
{<br />
&nbsp;&nbsp;&nbsp; $this-&gt;error_messages&nbsp; = array();<br />
&nbsp;&nbsp;&nbsp; error_reporting (E_ALL);<br />
&nbsp;&nbsp;&nbsp; set_error_handler(array($this,"assignError"));<br />
}<br />
<br />
and my assignError method:<br />
//accept the required arguments<br />
function assignError($errno, $errstr, $errfile, $errline)<br />
{<br />
&nbsp;&nbsp;&nbsp; //get the error string<br />
&nbsp;&nbsp;&nbsp; $error_message = $errstr;<br />
//if in debug mode, add line number and file info<br />
&nbsp;if(ErrorHandler::DEBUG())<br />
&nbsp;$error_message .= "&lt;br&gt;".basename($errfile).",line: ".$errline;<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; switch ($errno)<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; //if the error was fatal, then add the error<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; //display an error page and exit<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; case ErrorHandler::FATAL():<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $this-&gt;setType('Fatal');<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $this-&gt;addError($error_message);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; Display::errorPage($this-&gt;errorMessages());<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; exit(1);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; break;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; //if it was an error message, add a message of<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; //type error<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; case ErrorHandler::ERROR():<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $this-&gt;setType('Error');<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $this-&gt;addError($error_message);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; break;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; //if it was a warning, add a message of type<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; //warning<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; case ErrorHandler::WARNING():<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $this-&gt;setType('Warning');<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $this-&gt;addError($error_message);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; break;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; //if it was some other code then display all<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; //the error messages that were added<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; default:<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; Display::errorRows($this-&gt;errorMessages());<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; break;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; //return a value so that the script will continue<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; //execution<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return 1;<br />
}<br />
<br />
the key part there is the 'default' behaviour. i found that if i call trigger_error with anything other than E_USER_ERROR, E_USER_WARNING or E_USER_NOTICE, then error code '2' is passed to the handler method. so when it is time to print all my non-fatal errors, like 'password and confirm password don't match' or something, i call ErrorHandler::printAllErrors()<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; function printAllErrors()<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; trigger_error("",2);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
<br />
which leads to the default behaviour in my switch statement in the assignError method above. the only problem with this is that the weird bug 'Problem with method call' that occurs with some static method calls (that one person on the bug lists said was fixed and another said wouldn't be fixed until version 5) also produces error code 2!! i have just taken to suppressing these errors with @, because despite the alledged problem with the method call, the script still seems to execute fine.<br />
<br />
iain.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="32316""></a>
  <div class="note">
   <strong class="user">someone at attbi dot com</strong>
   <a href="#32316" class="date">23-May-2003 06:24</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
sl0th, the idea is never to give out file names, line numbers, and cryptic codes to the user. Use trigger_error() after you used set_error_handler() to register your own callback function which either logs or emails the error codes to you, and echo a simple friendly message to the user.<br />
<br />
And turn on a more verbose error handler function when you need to debug your scripts. In my init.php scripts I always have:<br />
<br />
if (_DEBUG_) {<br />
&nbsp;&nbsp;&nbsp; set_error_handler ('debug_error_handler');<br />
}<br />
else {<br />
&nbsp;&nbsp;&nbsp; set_error_handler ('nice_error_handler');<br />
}</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="32228""></a>
  <div class="note">
   <strong class="user">sl0th at r00thell dot ath dot cx</strong>
   <a href="#32228" class="date">21-May-2003 04:25</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Well this is a good way on debuging your php scripts, but i wouldn't feel<br />
too comfortable by giving out my web servers structure.<br />
Notice that what helps you finding and isolating errors in your php helps also a potential attacker.<br />
Or maybe i am just paranoid, but its worth mention it.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="26378""></a>
  <div class="note">
   <strong class="user">ceo at l-i-e dot com</strong>
   <a href="#26378" class="date">29-Oct-2002 02:20</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
You should be using set_error_handler (possibly in conjuction with error_log and/or trigger_error) if you want FILE and LINE number information.<br />
You don't need macros for this.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
</div>
</div>
<hr /><div class="manualnavbar" style="text-align: center;">
 <div class="prev" style="text-align: left; float: left;"><a href="function.set-exception-handler.html">set_exception_handler</a></div>
 <div class="next" style="text-align: right; float: right;"><a href="function.user-error.html">user_error</a></div>
 <div class="up"><a href="ref.errorfunc.html">エラー処理関数</a></div>
 <div class="home"><a href="index.html">PHP Manual</a></div>
</div></body></html>
