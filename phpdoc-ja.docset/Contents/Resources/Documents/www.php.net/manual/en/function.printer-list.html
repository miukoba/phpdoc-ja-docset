<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
 <head>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <title>サーバーに登録されたプリンタの配列を返す</title>
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <link media="all" rel="stylesheet" type="text/css" href="style.css"/>
 </head>
 <body class="docs"><div class="manualnavbar" style="text-align: center;">
 <div class="prev" style="text-align: left; float: left;"><a href="function.printer-get-option.html">printer_get_option</a></div>
 <div class="next" style="text-align: right; float: right;"><a href="function.printer-logical-fontheight.html">printer_logical_fontheight</a></div>
 <div class="up"><a href="ref.printer.html">プリンタ 関数</a></div>
 <div class="home"><a href="index.html">PHP Manual</a></div>
</div><hr /><div id="function.printer-list" class="refentry">
 <div class="refnamediv">
  <h1 class="refname">printer_list</h1>
  <p class="verinfo">(PECL printer SVN)</p><p class="refpurpose"><span class="refname">printer_list</span> &mdash; <span class="dc-title">サーバーに登録されたプリンタの配列を返す</span></p>

 </div>
 
 <div class="refsect1 description" id="refsect1-function.printer-list-description">
  <h3 class="title">説明</h3>
  <div class="methodsynopsis dc-description">
   <span class="type">array</span> <span class="methodname"><strong>printer_list</strong></span>
    ( <span class="methodparam"><span class="type">int</span> <code class="parameter">$enumtype</code></span>
   [, <span class="methodparam"><span class="type">string</span> <code class="parameter">$name</code></span>
   [, <span class="methodparam"><span class="type">int</span> <code class="parameter">$level</code></span>
  ]] )</div>

  <p class="para rdfs-comment">
   この関数は、利用可能なプリンタとその機能を調べます。
  </p>
 </div>


 <div class="refsect1 parameters" id="refsect1-function.printer-list-parameters">
  <h3 class="title">パラメータ</h3>
  <p class="para">
   <dl>

    <dt>

     <span class="term"><em><code class="parameter">enumtype</code></em></span>
     <dd>

      <p class="para">
       <em><code class="parameter">enumtype</code></em>
       は次の定義済みの定数のどれかとする必要があります。
       <ul class="itemizedlist">
        <li class="listitem">
         <span class="simpara">
          <strong><code>PRINTER_ENUM_LOCAL</code></strong>:
          ローカルにインストールされたプリンタを列挙します。
         </span>
        </li>
        <li class="listitem">
         <span class="simpara">
          <strong><code>PRINTER_ENUM_NAME</code></strong>:
          <em><code class="parameter">name</code></em> のサーバー、
          ドメインまたはプリントプロバイダになることができるものを列挙します。
         </span>
        </li>
        <li class="listitem">
         <span class="simpara">
          <strong><code>PRINTER_ENUM_SHARED</code></strong>:
          このパラメータは単独では使用できず、
          他のパラメータとともに使用する必要があります。
          たとえば <strong><code>PRINTER_ENUM_LOCAL</code></strong> とともに使用することで、
          ローカルの共有プリンタを検出します。
         </span>
        </li>
        <li class="listitem">
         <span class="simpara">
          <strong><code>PRINTER_ENUM_DEFAULT</code></strong>:
          (Win9.x のみ) デフォルトのプリンタを列挙します。
         </span>
        </li>
        <li class="listitem">
         <span class="simpara">
          <strong><code>PRINTER_ENUM_CONNECTIONS</code></strong>:
          (WinNT/2000 のみ) ユーザーが接続済みのプリンタを列挙します。
         </span>
        </li>
        <li class="listitem">
         <span class="simpara">
          <strong><code>PRINTER_ENUM_NETWORK</code></strong>:
          (WinNT/2000 のみ) コンピュータのドメインにあるネットワークプリンタを列挙します。
          <em><code class="parameter">level</code></em> が 1 の場合のみ有効です。
         </span>
        </li>
        <li class="listitem">
         <span class="simpara">
          <strong><code>PRINTER_ENUM_REMOTE</code></strong>:
          (WinNT/2000 のみ) コンピュータのドメインにある
          ネットワークプリンタとプリンタサーバーを列挙します。
          <em><code class="parameter">level</code></em> が 1 の場合のみ有効です。
         </span>
        </li>
       </ul>
      </p>
     </dd>

    </dt>

    <dt>

     <span class="term"><em><code class="parameter">name</code></em></span>
     <dd>

      <p class="para">
       <strong><code>PRINTER_ENUM_NAME</code></strong> とともに使用します。
      </p>
     </dd>

    </dt>

    <dt>

     <span class="term"><em><code class="parameter">level</code></em></span>
     <dd>

      <p class="para">
       <em><code class="parameter">level</code></em> には、情報要求のレベルを設定します。
       これは、1,2,4 または 5 とすることが可能です、
      </p>
     </dd>

    </dt>

   </dl>

  </p>
 </div>


 <div class="refsect1 returnvalues" id="refsect1-function.printer-list-returnvalues">
  <h3 class="title">返り値</h3>
  <p class="para">
   プリンタの配列を返します。
  </p>
 </div>


 <div class="refsect1 examples" id="refsect1-function.printer-list-examples">
  <h3 class="title">例</h3>
  <p class="para">
   <div class="example" id="example-5333">
    <p><strong>例1  <span class="function"><strong>printer_list()</strong></span> の例</strong></p>
    <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br /></span><span style="color: #FF8000">/*&nbsp;ローカルな共有プリンタを検出&nbsp;*/<br /></span><span style="color: #0000BB">var_dump</span><span style="color: #007700">(</span><span style="color: #0000BB">printer_list</span><span style="color: #007700">(</span><span style="color: #0000BB">PRINTER_ENUM_LOCAL&nbsp;</span><span style="color: #007700">|&nbsp;</span><span style="color: #0000BB">PRINTER_ENUM_SHARED</span><span style="color: #007700">));<br /></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
    </div>

   </div>
  </p>
 </div>

 
</div><div id="usernotes">
 <div class="head">
  <h3 class="title">User Contributed Notes</h3>
 </div>
<div id="allnotes">  <a name="112182""></a>
  <div class="note">
   <strong class="user">fziu02 at gmail dot com</strong>
   <a href="#112182" class="date">14-May-2013 11:07</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
You can use AJAX, and everything works fine...<br />
<br />
PHP // lsprt.php<br />
<span class="default">&lt;?php<br />
&nbsp;&nbsp;&nbsp; $getprt</span><span class="keyword">=</span><span class="default">printer_list</span><span class="keyword">( </span><span class="default">PRINTER_ENUM_LOCAL </span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; echo </span><span class="default">json_encode</span><span class="keyword">(</span><span class="default">$getprt</span><span class="keyword">);<br />
</span><span class="default">?&gt;<br />
</span><br />
HTML<br />
&lt;script&gt;<br />
$.post('lsprt.php', function(data) {<br />
&nbsp;&nbsp;&nbsp; value = JSON.parse(data);<br />
&nbsp;&nbsp;&nbsp; for (val in value) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $('#asd').append('&lt;option value="'+ value[val]['NAME'] +'"&gt;'+ value[val]['NAME'] +'&lt;/option&gt;');<br />
&nbsp;&nbsp;&nbsp; }<br />
});<br />
&lt;/script&gt;<br />
<br />
&lt;select id="asd"&gt;&lt;/select&gt;</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="73042""></a>
  <div class="note">
   <strong class="user">ewilde aht bsmdevelopment dawt com</strong>
   <a href="#73042" class="date">07-Feb-2007 08:14</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
First, before you do anything, make sure you have a copy of php_printer.dll that is dated later than the first of February, 2007 because there were several parameter handling bugs that were fixed just prior to that date.<br />
<br />
Also, beware that the Windows function EnumPrinters often does not return all of the networked printers until someone on the Web server uses the file manager to look at the networked printers, first.&nbsp; I'm presuming this causes the server to contact the domain controller for the browse list, which is then used to enumerate the printers.&nbsp; It does not appear that EnumPrinters will do this on its own, although some of the other values for flags may cause it to do so.<br />
<br />
Having said all that, the following code should show you both local and networked printers:<br />
<br />
if (function_exists("printer_list"))<br />
&nbsp; {<br />
&nbsp; $PrintCurr = 0;<br />
<br />
&nbsp; // Get the local printers.<br />
&nbsp; $PrintDests = printer_list(PRINTER_ENUM_LOCAL);<br />
<br />
&nbsp; if (isset($PrintDests))<br />
&nbsp;&nbsp;&nbsp; foreach ($PrintDests as $PrintDest)<br />
&nbsp;&nbsp; &nbsp;&nbsp; $PrinterList[$PrintCurr++] = $PrintDest["NAME"];<br />
<br />
&nbsp; // We should be able to enumerate the remote printers too.&nbsp; Let's have a<br />
&nbsp; // shot at it.<br />
&nbsp; //<br />
&nbsp; // Start by looking for the remote printers tree.<br />
&nbsp; $PrintDoms = printer_list(PRINTER_ENUM_NAME); $PrintTree = "";<br />
<br />
&nbsp; if (isset($PrintDoms))<br />
&nbsp;&nbsp;&nbsp; foreach ($PrintDoms as $PrintDomain)<br />
&nbsp;&nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp;&nbsp; if (preg_match("/Remote/i", $PrintDomain["NAME"]))<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; { $PrintTree = $PrintDomain["NAME"]; break; }<br />
&nbsp;&nbsp; &nbsp;&nbsp; }<br />
<br />
&nbsp; // If we found a remote printers tree, we need to enumerate all of the<br />
&nbsp; // domains/workgroups/nodes within the tree and all the printers attached<br />
&nbsp; // to those nodes.<br />
&nbsp; if ($PrintTree != "")<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp;&nbsp; // Enumerate all of the domains.<br />
&nbsp;&nbsp;&nbsp; $PrintDoms = printer_list(PRINTER_ENUM_NAME, $PrintTree);<br />
<br />
&nbsp;&nbsp;&nbsp; if (isset($PrintDoms))<br />
&nbsp;&nbsp; &nbsp;&nbsp; foreach ($PrintDoms as $PrintDomain)<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; // Enumerate all of the nodes within the domain.<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $PrintNodes = printer_list(PRINTER_ENUM_NAME, $PrintDomain["NAME"]);<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if (isset($PrintNodes))<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; foreach ($PrintNodes as $PrintNode)<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; // Enumerate all of the printers within the node.<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $PrintDests = printer_list(PRINTER_ENUM_NAME,<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $PrintNode["NAME"]);<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if (isset($PrintDests))<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; foreach ($PrintDests as $PrintDest)<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $PrinterList[$PrintCurr++] = $PrintDest["NAME"];<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp; }</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="72724""></a>
  <div class="note">
   <strong class="user">ewilde aht bsmdevelopment dawt com</strong>
   <a href="#72724" class="date">31-Jan-2007 04:21</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
printer_list was not working for me and the docs are a little sparse.&nbsp; So, I took a look at the code for php_printer.dll (which is at <a href="http://viewcvs.php.net/viewvc.cgi/pecl/printer/printer.c, BTW" rel="nofollow" target="_blank">http://viewcvs.php.net/viewvc.cgi/pecl/printer/printer.c, BTW</a>) to figure out what was going on.<br />
<br />
Basically, this function is a wrapper for the Windows function EnumPrinters.&nbsp; You can find this function documented in MSDN (which is at <a href="http://msdn.microsoft.com" rel="nofollow" target="_blank">http://msdn.microsoft.com</a>).&nbsp; Do a search for EnumPrinters and you should see the function itself as the first hit in the search list.<br />
<br />
There is a lot more information about what the parameters to the function mean and the results returned.&nbsp; The printer_list function basically copies the enumtype, name and level parameters directly to the Flags, Name and Level parameters of EnumPrinters, calls the function and then copies all of the fields, in the appropriate data structure returned for the level of information requested, back to the results array.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="57775""></a>
  <div class="note">
   <strong class="user">gabriel dot smagghe at laposte dot net</strong>
   <a href="#57775" class="date">13-Oct-2005 10:33</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
You can use all the array data, with no crash.<br />
For that you can do this :<br />
<br />
$getprt=printer_list(PRINTER_ENUM_LOCAL| PRINTER_ENUM_SHARED );<br />
<br />
if ($debugprt){echo "&lt;pre&gt; get prt";<br />
&nbsp;&nbsp;&nbsp; print_r($getprt);<br />
&nbsp;&nbsp;&nbsp; echo "&lt;/pre&gt;";<br />
&nbsp;&nbsp;&nbsp; echo count($getprt);<br />
}<br />
$printers = serialize($getprt);<br />
//echo $printers ;<br />
$pp=str_replace _<br />
(";s:11:\"DESCRIPTION\";",";s:4:\"DESC\";",_<br />
str_replace(";s:7:\"COMMENT\";",";s:4:\"COMM\";",$printers));<br />
$printers=unserialize($pp);<br />
if ($debugprt){echo "&lt;pre&gt; pp :";<br />
<br />
&nbsp;&nbsp;&nbsp; print_r($printers);<br />
&nbsp;&nbsp;&nbsp; echo "&lt;/pre&gt;";<br />
&nbsp;&nbsp;&nbsp; echo count($printers);<br />
}<br />
<br />
An that's ok</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="47935""></a>
  <div class="note">
   <strong class="user">jt at jtis dot de</strong>
   <a href="#47935" class="date">06-Dec-2004 12:19</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
As saidyjade mentioned below, printer_list crashes Apache when you pound the resulting array too much. I don't know why this happens, somebody should look deeper into the subject...<br />
I have found out, contrary to saidyjade, that also just getting the NAME attribute (and remember, it's case-sensitive! :-) can crash Apache.<br />
<br />
Here's what I had:<br />
<span class="default">&lt;?php<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">foreach (</span><span class="default">printer_list</span><span class="keyword">(</span><span class="default">PRINTER_ENUM_CONNECTIONS</span><span class="keyword">) as </span><span class="default">$printer</span><span class="keyword">)<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; echo </span><span class="string">"&lt;option value=\"" </span><span class="keyword">. </span><span class="default">addslashes</span><span class="keyword">(</span><span class="default">strtoupper</span><span class="keyword">(</span><span class="default">$printer</span><span class="keyword">[</span><span class="string">"NAME"</span><span class="keyword">])) . </span><span class="string">"\"&gt;" </span><span class="keyword">. </span><span class="default">strtoupper</span><span class="keyword">(</span><span class="default">$printer</span><span class="keyword">[</span><span class="string">"NAME"</span><span class="keyword">]) . </span><span class="string">"\n"</span><span class="keyword">;<br />
</span><span class="default">?&gt;<br />
</span>This snippet worked alright, whereas<br />
<span class="default">&lt;?php<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">foreach (</span><span class="default">printer_list</span><span class="keyword">(</span><span class="default">PRINTER_ENUM_CONNECTIONS</span><span class="keyword">) as </span><span class="default">$printer</span><span class="keyword">)<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; echo </span><span class="string">"&lt;option value=\"" </span><span class="keyword">. </span><span class="default">addslashes</span><span class="keyword">(</span><span class="default">strtoupper</span><span class="keyword">(</span><span class="default">$printer</span><span class="keyword">[</span><span class="string">"NAME"</span><span class="keyword">])) . </span><span class="string">"\"" </span><span class="keyword">. ((</span><span class="default">strtoupper</span><span class="keyword">(</span><span class="default">$printer</span><span class="keyword">[</span><span class="string">"NAME"</span><span class="keyword">])) ? </span><span class="string">" selected" </span><span class="keyword">: </span><span class="string">""</span><span class="keyword">) . </span><span class="string">"&gt;" </span><span class="keyword">. </span><span class="default">strtoupper</span><span class="keyword">(</span><span class="default">$printer</span><span class="keyword">[</span><span class="string">"NAME"</span><span class="keyword">]) . </span><span class="string">"\n"</span><span class="keyword">;<br />
</span><span class="default">?&gt;<br />
</span>crashed Apache everytime the page was loaded.<br />
<br />
I played around a bit and found this snippet not crashing:<br />
<span class="default">&lt;?php<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">foreach (</span><span class="default">printer_list</span><span class="keyword">(</span><span class="default">PRINTER_ENUM_CONNECTIONS</span><span class="keyword">) as </span><span class="default">$printer</span><span class="keyword">)<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$curprin </span><span class="keyword">= </span><span class="default">strtoupper</span><span class="keyword">(</span><span class="default">$printer</span><span class="keyword">[</span><span class="string">"NAME"</span><span class="keyword">]);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; echo </span><span class="string">"&lt;option value=\"" </span><span class="keyword">. </span><span class="default">addslashes</span><span class="keyword">(</span><span class="default">$curprin</span><span class="keyword">) . </span><span class="string">"\"" </span><span class="keyword">. ((</span><span class="default">$curprin </span><span class="keyword">== </span><span class="default">$user</span><span class="keyword">[</span><span class="string">"drucker"</span><span class="keyword">]) ? </span><span class="string">" selected" </span><span class="keyword">: </span><span class="string">""</span><span class="keyword">) . </span><span class="string">"&gt;</span><span class="default">$curprin</span><span class="string">\n"</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }<br />
</span><span class="default">?&gt;<br />
</span><br />
So, in essence you just need to be careful about how much you use the array and if necessary define help variables that you can use as much as you want.<br />
<br />
Hope this saves somebody some more minutes...</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="33032""></a>
  <div class="note">
   <strong class="user">saidyjade at hotmail dot com</strong>
   <a href="#33032" class="date">14-Jun-2003 08:52</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
You can still get the "NAME" of printers through the printer_list as only the array keys "DESCRIPTION" and "COMMENT" crash and not the "NAME" key.<br />
<br />
$list_printers = printer_list(PRINTER_ENUM_LOCAL |<br />
PRINTER_ENUM_SHARED);<br />
<br />
// get the name of the first returned printer<br />
//(you can add array walk function to get all printer names if you wish.. but I am lazy)<br />
<br />
$this_printer = $list_printers[0]["NAME"];<br />
<br />
// open a connection to your printer<br />
$my_printer = printer_open($this_printer);<br />
<br />
.. blah blah<br />
<br />
The output of var_dump (as an example)<br />
<br />
var_dump( printer_list(PRINTER_ENUM_LOCAL | PRINTER_ENUM_SHARED) );<br />
<br />
array(1) {<br />
&nbsp; [0]=&gt; array(3) {<br />
&nbsp; ["NAME"]=&gt; string(14) "Canon BJC-4550"<br />
&nbsp; ["DESCRIPTION"]=&gt; string(30) "Canon BJC-4550,Canon BJC-4550,"<br />
&nbsp; ["COMMENT"]=&gt; string(0) "This is my funky printer!" } }<br />
<br />
As you can see var_dump (under variable functions in the manual) shows and/or retrieves the corrent information but if you try to place into a variable or read the variable it crashes either apache using php4apache.dll or php when you the command line client or cgi.<br />
<br />
So as long as you do not get the comment or description it will list your printers.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
</div>
</div>
<hr /><div class="manualnavbar" style="text-align: center;">
 <div class="prev" style="text-align: left; float: left;"><a href="function.printer-get-option.html">printer_get_option</a></div>
 <div class="next" style="text-align: right; float: right;"><a href="function.printer-logical-fontheight.html">printer_logical_fontheight</a></div>
 <div class="up"><a href="ref.printer.html">プリンタ 関数</a></div>
 <div class="home"><a href="index.html">PHP Manual</a></div>
</div></body></html>
