<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
 <head>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <title>結果を保存するため、プリペアドステートメントに変数をバインドする</title>
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <link media="all" rel="stylesheet" type="text/css" href="style.css"/>
 </head>
 <body class="docs"><div class="manualnavbar" style="text-align: center;">
 <div class="prev" style="text-align: left; float: left;"><a href="mysqli-stmt.bind-param.html">mysqli_stmt::bind_param</a></div>
 <div class="next" style="text-align: right; float: right;"><a href="mysqli-stmt.close.html">mysqli_stmt::close</a></div>
 <div class="up"><a href="class.mysqli-stmt.html">mysqli_stmt</a></div>
 <div class="home"><a href="index.html">PHP Manual</a></div>
</div><hr /><div id="mysqli-stmt.bind-result" class="refentry">
 <div class="refnamediv">
  <h1 class="refname">mysqli_stmt::bind_result</h1>
  <h1 class="refname">mysqli_stmt_bind_result</h1>
  <p class="verinfo">(PHP 5)</p><p class="refpurpose"><span class="refname">mysqli_stmt::bind_result</span> -- <span class="refname">mysqli_stmt_bind_result</span> &mdash; <span class="dc-title">結果を保存するため、プリペアドステートメントに変数をバインドする</span></p>

 </div>

 <div class="refsect1 description" id="refsect1-mysqli-stmt.bind-result-description">
  <h3 class="title">説明</h3>
  <p class="para">オブジェクト指向型</p>
  <div class="methodsynopsis dc-description">
   <span class="type">bool</span> <span class="methodname"><strong>mysqli_stmt::bind_result</strong></span>
    ( <span class="methodparam"><span class="type"><a href="language.pseudo-types.html#language.types.mixed" class="type mixed">mixed</a></span> <code class="parameter reference">&$var1</code></span>
   [, <span class="methodparam"><span class="type"><a href="language.pseudo-types.html#language.types.mixed" class="type mixed">mixed</a></span> <code class="parameter reference">&$...</code></span>
  ] )</div>

  <p class="para rdfs-comment">手続き型</p>
  <div class="methodsynopsis dc-description">
   <span class="type">bool</span> <span class="methodname"><strong>mysqli_stmt_bind_result</strong></span>
    ( <span class="methodparam"><span class="type"><a href="class.mysqli-stmt.html" class="type mysqli_stmt">mysqli_stmt</a></span> <code class="parameter">$stmt</code></span>
   , <span class="methodparam"><span class="type"><a href="language.pseudo-types.html#language.types.mixed" class="type mixed">mixed</a></span> <code class="parameter reference">&$var1</code></span>
   [, <span class="methodparam"><span class="type"><a href="language.pseudo-types.html#language.types.mixed" class="type mixed">mixed</a></span> <code class="parameter reference">&$...</code></span>
  ] )</div>

  <p class="para rdfs-comment">
   結果セットのカラムを変数にバインドします。
  </p>
  <p class="para">
   データを取得するために
    <span class="function"><a href="mysqli-stmt.fetch.html" class="function">mysqli_stmt_fetch()</a></span> がコールされた場合、MySQL クライアント/
   サーバー プロトコルはバインドされたカラムのデータを
   <em><code class="parameter">var1, ...</code></em> に格納します。
  </p>
  <blockquote class="note"><p><strong class="note">注意</strong>: 
   <p class="para">
    すべてのカラムを、 <span class="function"><a href="mysqli-stmt.execute.html" class="function">mysqli_stmt_execute()</a></span>
    をコールしてから  <span class="function"><a href="mysqli-stmt.fetch.html" class="function">mysqli_stmt_fetch()</a></span>
    をコールするまでの間に
    バインドしておく必要があることに注意しましょう。カラムの型に
    応じて、バインド変数の型も対応する PHP の型に自動的に変換されます。
   </p>
   <p class="para">
    カラムのバインドや再バインドはいつでも可能で、たとえ結果セットを途中まで
    取得した後であっても可能です。新しくバインドした内容が効力を発揮するのは、
    次に  <span class="function"><a href="mysqli-stmt.fetch.html" class="function">mysqli_stmt_fetch()</a></span> がコールされたときからです。
   </p>
  </p></blockquote>
 </div>


 <div class="refsect1 parameters" id="refsect1-mysqli-stmt.bind-result-parameters">
  <h3 class="title">パラメータ</h3>
  <p class="para">
   <dl>

    <dt>
<span class="term"><em><code class="parameter">
stmt</code></em></span><dd>
<p class="para">手続き型のみ:
 <span class="function"><a href="mysqli.stmt-init.html" class="function">mysqli_stmt_init()</a></span> が返すステートメント ID。</p></dd>
</dt>

    <dt>

     <span class="term"><em><code class="parameter">var1</code></em></span>
     <dd>

      <p class="para">
       バインドする変数。
      </p>
     </dd>

    </dt>

   </dl>

  </p>
 </div>


 <div class="refsect1 returnvalues" id="refsect1-mysqli-stmt.bind-result-returnvalues">
  <h3 class="title">返り値</h3>
  <p class="para">
   成功した場合に <strong><code>TRUE</code></strong> を、失敗した場合に <strong><code>FALSE</code></strong> を返します。
  </p>
 </div>


 <div class="refsect1 examples" id="refsect1-mysqli-stmt.bind-result-examples">
  <h3 class="title">例</h3>
  <div class="example" id="example-1691">
   <p><strong>例1 オブジェクト指向型</strong></p>
   <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br />$mysqli&nbsp;</span><span style="color: #007700">=&nbsp;new&nbsp;</span><span style="color: #0000BB">mysqli</span><span style="color: #007700">(</span><span style="color: #DD0000">"localhost"</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">"my_user"</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">"my_password"</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">"world"</span><span style="color: #007700">);<br /><br />if&nbsp;(</span><span style="color: #0000BB">mysqli_connect_errno</span><span style="color: #007700">())&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">printf</span><span style="color: #007700">(</span><span style="color: #DD0000">"Connect&nbsp;failed:&nbsp;%s\n"</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">mysqli_connect_error</span><span style="color: #007700">());<br />&nbsp;&nbsp;&nbsp;&nbsp;exit();<br />}<br /><br /></span><span style="color: #FF8000">/*&nbsp;ステートメントを準備します&nbsp;*/<br /></span><span style="color: #007700">if&nbsp;(</span><span style="color: #0000BB">$stmt&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$mysqli</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">prepare</span><span style="color: #007700">(</span><span style="color: #DD0000">"SELECT&nbsp;Code,&nbsp;Name&nbsp;FROM&nbsp;Country&nbsp;ORDER&nbsp;BY&nbsp;Name&nbsp;LIMIT&nbsp;5"</span><span style="color: #007700">))&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$stmt</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">execute</span><span style="color: #007700">();<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">/*&nbsp;プリペアドステートメントに変数をバインドします&nbsp;*/<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$stmt</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">bind_result</span><span style="color: #007700">(</span><span style="color: #0000BB">$col1</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$col2</span><span style="color: #007700">);<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">/*&nbsp;値を取得します&nbsp;*/<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">while&nbsp;(</span><span style="color: #0000BB">$stmt</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">fetch</span><span style="color: #007700">())&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">printf</span><span style="color: #007700">(</span><span style="color: #DD0000">"%s&nbsp;%s\n"</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$col1</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$col2</span><span style="color: #007700">);<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">/*&nbsp;ステートメントを閉じます&nbsp;*/<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$stmt</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">close</span><span style="color: #007700">();<br />}<br /></span><span style="color: #FF8000">/*&nbsp;接続を閉じます&nbsp;*/<br /></span><span style="color: #0000BB">$mysqli</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">close</span><span style="color: #007700">();<br /><br /></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
   </div>

  </div>
  <div class="example" id="example-1692">
   <p><strong>例2 手続き型</strong></p>
   <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br />$link&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">mysqli_connect</span><span style="color: #007700">(</span><span style="color: #DD0000">"localhost"</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">"my_user"</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">"my_password"</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">"world"</span><span style="color: #007700">);<br /><br /></span><span style="color: #FF8000">/*&nbsp;接続状況をチェックします&nbsp;*/<br /></span><span style="color: #007700">if&nbsp;(!</span><span style="color: #0000BB">$link</span><span style="color: #007700">)&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">printf</span><span style="color: #007700">(</span><span style="color: #DD0000">"Connect&nbsp;failed:&nbsp;%s\n"</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">mysqli_connect_error</span><span style="color: #007700">());<br />&nbsp;&nbsp;&nbsp;&nbsp;exit();<br />}<br /><br /></span><span style="color: #FF8000">/*&nbsp;ステートメントを準備します&nbsp;*/<br /></span><span style="color: #007700">if&nbsp;(</span><span style="color: #0000BB">$stmt&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">mysqli_prepare</span><span style="color: #007700">(</span><span style="color: #0000BB">$link</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">"SELECT&nbsp;Code,&nbsp;Name&nbsp;FROM&nbsp;Country&nbsp;ORDER&nbsp;BY&nbsp;Name&nbsp;LIMIT&nbsp;5"</span><span style="color: #007700">))&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">mysqli_stmt_execute</span><span style="color: #007700">(</span><span style="color: #0000BB">$stmt</span><span style="color: #007700">);<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">/*&nbsp;プリペアドステートメントに変数をバインドします&nbsp;*/<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">mysqli_stmt_bind_result</span><span style="color: #007700">(</span><span style="color: #0000BB">$stmt</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$col1</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$col2</span><span style="color: #007700">);<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">/*&nbsp;値を取得します&nbsp;*/<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">while&nbsp;(</span><span style="color: #0000BB">mysqli_stmt_fetch</span><span style="color: #007700">(</span><span style="color: #0000BB">$stmt</span><span style="color: #007700">))&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">printf</span><span style="color: #007700">(</span><span style="color: #DD0000">"%s&nbsp;%s\n"</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$col1</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$col2</span><span style="color: #007700">);<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">/*&nbsp;ステートメントを閉じます&nbsp;*/<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">mysqli_stmt_close</span><span style="color: #007700">(</span><span style="color: #0000BB">$stmt</span><span style="color: #007700">);<br />}<br /><br /></span><span style="color: #FF8000">/*&nbsp;接続を閉じます&nbsp;*/<br /></span><span style="color: #0000BB">mysqli_close</span><span style="color: #007700">(</span><span style="color: #0000BB">$link</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
   </div>

   <div class="example-contents"><p>上の例の出力は以下となります。</p></div>
   <div class="example-contents screen">
<div class="cdata"><pre>
AFG Afghanistan
ALB Albania
DZA Algeria
ASM American Samoa
AND Andorra
</pre></div>
   </div>
  </div>
 </div>


 <div class="refsect1 seealso" id="refsect1-mysqli-stmt.bind-result-seealso">
  <h3 class="title">参考</h3>
  <p class="para">
   <ul class="simplelist">
    <li class="member"> <span class="function"><a href="mysqli-stmt.bind-param.html" class="function" rel="rdfs-seeAlso">mysqli_stmt_bind_param()</a> - プリペアドステートメントのパラメータに変数をバインドする</span></li>
    <li class="member"> <span class="function"><a href="mysqli-stmt.execute.html" class="function" rel="rdfs-seeAlso">mysqli_stmt_execute()</a> - プリペアドクエリを実行する</span></li>
    <li class="member"> <span class="function"><a href="mysqli-stmt.fetch.html" class="function" rel="rdfs-seeAlso">mysqli_stmt_fetch()</a> - プリペアドステートメントから結果を取得し、バインド変数に格納する</span></li>
    <li class="member"> <span class="function"><a href="mysqli.prepare.html" class="function" rel="rdfs-seeAlso">mysqli_prepare()</a> - 実行するための SQL ステートメントを準備する</span></li>
    <li class="member"> <span class="function"><a href="mysqli-stmt.prepare.html" class="function" rel="rdfs-seeAlso">mysqli_stmt_prepare()</a> - SQL ステートメントを実行するために準備する</span></li>
    <li class="member"> <span class="function"><a href="mysqli.stmt-init.html" class="function" rel="rdfs-seeAlso">mysqli_stmt_init()</a> - ステートメントを初期化し、mysqli_stmt_prepare で使用するオブジェクトを返す</span></li>
    <li class="member"> <span class="function"><a href="mysqli-stmt.errno.html" class="function" rel="rdfs-seeAlso">mysqli_stmt_errno()</a> - 直近のステートメントのコールに関するエラーコードを返す</span></li>
    <li class="member"> <span class="function"><a href="mysqli-stmt.error.html" class="function" rel="rdfs-seeAlso">mysqli_stmt_error()</a> - 直近のステートメントのエラー内容を文字列で返す</span></li>
   </ul>
  </p>
 </div>


</div><div id="usernotes">
 <div class="head">
  <h3 class="title">User Contributed Notes</h3>
 </div>
<div id="allnotes">  <a name="107595""></a>
  <div class="note">
   <strong class="user">timchampion dot NOSPAM at gmail dot com</strong>
   <a href="#107595" class="date">21-Feb-2012 04:29</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Just wanted to make sure that all were aware of get_result for those needing the result in array format.<br />
<br />
In the code sample, after execute(), perform a get_result() like this:<br />
<br />
<span class="default">&lt;?php<br />
<br />
</span><span class="comment">// ... this document's example code:<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$stmt</span><span class="keyword">-&gt;</span><span class="default">execute</span><span class="keyword">();<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">/* instead of bind_result: */<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$result </span><span class="keyword">= </span><span class="default">$stmt</span><span class="keyword">-&gt;</span><span class="default">get_result</span><span class="keyword">();<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">/* now you can fetch the results into an array - NICE */<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">while (</span><span class="default">$myrow </span><span class="keyword">= </span><span class="default">$result</span><span class="keyword">-&gt;</span><span class="default">fetch_assoc</span><span class="keyword">()) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">printf</span><span class="keyword">(</span><span class="string">"%s %s\n"</span><span class="keyword">, </span><span class="default">$myrow</span><span class="keyword">[</span><span class="string">'Code'</span><span class="keyword">], </span><span class="default">$myrow</span><span class="keyword">[</span><span class="string">'Name'</span><span class="keyword">]);<br />
&nbsp;&nbsp;&nbsp; }<br />
<br />
</span><span class="default">?&gt;<br />
</span><br />
This is much nicer when you have a dozen or more fields coming back from your query.&nbsp; Hope this helps.&nbsp; Also, as noted in the comments for get_result, it requires mysqlnd.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="105068""></a>
  <div class="note">
   <strong class="user">dev+php at alepe dot com</strong>
   <a href="#105068" class="date">26-Jul-2011 07:31</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
According to the above documentation: <br />
"Depending on column types bound variables can silently change to the corresponding PHP type. "<br />
<br />
if you specify a field as int (tinyint, mediumint, etc.) with zerofill property, it will be converted (silently) to PHP integer (erasing the leading zeros). In order to keep those leading zeros, one solution is to specify the field as decimal.<br />
<br />
Note that this only happens when using prepared statements and not when executing the query directly.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="104452""></a>
  <div class="note">
   <strong class="user">scragar at gmail dot com</strong>
   <a href="#104452" class="date">16-Jun-2011 09:02</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
To clarify for anyone having problems with arrays, PHP will automatically pass arrays as references, cloning the array if needed in the event of setting or unsetting a part of it, changing a referenced variable does not trigger cloning.<br />
<br />
This is done for efficiency, to clone an array containing this information you may either use a foreach loop, or set/unset a key. Techniques like array_values will also work provided you don't mind losing your keys.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="102179""></a>
  <div class="note">
   <strong class="user">nieprzeklinaj at gmail dot com</strong>
   <a href="#102179" class="date">01-Feb-2011 10:02</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I wrote a function that fetches all rows from a result set - either normal or prepared.<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">function </span><span class="default">fetch</span><span class="keyword">(</span><span class="default">$result</span><span class="keyword">)<br />
{&nbsp; &nbsp; <br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$array </span><span class="keyword">= array();<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; if(</span><span class="default">$result </span><span class="keyword">instanceof </span><span class="default">mysqli_stmt</span><span class="keyword">)<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$result</span><span class="keyword">-&gt;</span><span class="default">store_result</span><span class="keyword">();<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$variables </span><span class="keyword">= array();<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$data </span><span class="keyword">= array();<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$meta </span><span class="keyword">= </span><span class="default">$result</span><span class="keyword">-&gt;</span><span class="default">result_metadata</span><span class="keyword">();<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; while(</span><span class="default">$field </span><span class="keyword">= </span><span class="default">$meta</span><span class="keyword">-&gt;</span><span class="default">fetch_field</span><span class="keyword">())<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$variables</span><span class="keyword">[] = &amp;</span><span class="default">$data</span><span class="keyword">[</span><span class="default">$field</span><span class="keyword">-&gt;</span><span class="default">name</span><span class="keyword">]; </span><span class="comment">// pass by reference<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">call_user_func_array</span><span class="keyword">(array(</span><span class="default">$result</span><span class="keyword">, </span><span class="string">'bind_result'</span><span class="keyword">), </span><span class="default">$variables</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$i</span><span class="keyword">=</span><span class="default">0</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; while(</span><span class="default">$result</span><span class="keyword">-&gt;</span><span class="default">fetch</span><span class="keyword">())<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$array</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">] = array();<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; foreach(</span><span class="default">$data </span><span class="keyword">as </span><span class="default">$k</span><span class="keyword">=&gt;</span><span class="default">$v</span><span class="keyword">)<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$array</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">][</span><span class="default">$k</span><span class="keyword">] = </span><span class="default">$v</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$i</span><span class="keyword">++;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// don't know why, but when I tried $array[] = $data, I got the same one result in all rows<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">}<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; elseif(</span><span class="default">$result </span><span class="keyword">instanceof </span><span class="default">mysqli_result</span><span class="keyword">)<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; while(</span><span class="default">$row </span><span class="keyword">= </span><span class="default">$result</span><span class="keyword">-&gt;</span><span class="default">fetch_assoc</span><span class="keyword">())<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$array</span><span class="keyword">[] = </span><span class="default">$row</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; return </span><span class="default">$array</span><span class="keyword">;<br />
}<br />
</span><span class="default">?&gt;<br />
</span><br />
Simply call it passing a result set or executed statement and you'll get all rows fetched.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="101543""></a>
  <div class="note">
   <strong class="user">quano</strong>
   <a href="#101543" class="date">23-Dec-2010 01:19</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If I have a longtext field in the result, the whole page will go blank, without giving me any errors what so ever. This is because PHP _crashes_. I've spent an entire morning figuring this out.<br />
<br />
Apparently, if you have longtext present, you HAVE to call store_result before using bind_result.<br />
<br />
<a href="http://bugs.php.net/bug.php?id=47928" rel="nofollow" target="_blank">http://bugs.php.net/bug.php?id=47928</a></span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="99175""></a>
  <div class="note">
   <strong class="user">pcc at pccglobal dot com</strong>
   <a href="#99175" class="date">01-Aug-2010 04:06</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If done properly, 'call_user_func_array()' works to bind variables to a result of multiple columns including BLOB columns. <br />
<br />
EXAMPLE:<br />
<br />
<span class="default">&lt;?php<br />
$data </span><span class="keyword">= array() ; </span><span class="comment">// Array that accepts the data.<br />
</span><span class="default">$params </span><span class="keyword">= array() ; </span><span class="comment">// Parameter array passed to 'bind_result()'<br />
</span><span class="default">$column </span><span class="keyword">= array(</span><span class="string">"fidentity"</span><span class="keyword">, </span><span class="string">"fvarchar"</span><span class="keyword">, </span><span class="string">"fdate"</span><span class="keyword">, </span><span class="string">"ftinyblob"</span><span class="keyword">) ; </span><span class="comment">// The column names.<br />
</span><span class="keyword">foreach(</span><span class="default">$column </span><span class="keyword">as </span><span class="default">$col_name</span><span class="keyword">)<br />
{<br />
&nbsp; </span><span class="comment">// 'fetch()' will assign fetched value to the variable '$data[$col_name]'<br />
&nbsp; </span><span class="default">$params</span><span class="keyword">[] =&amp; </span><span class="default">$data</span><span class="keyword">[</span><span class="default">$col_name</span><span class="keyword">] ;<br />
}<br />
</span><span class="default">$res </span><span class="keyword">= </span><span class="default">call_user_func_array</span><span class="keyword">(array(</span><span class="default">$stmt</span><span class="keyword">, </span><span class="string">"bind_result"</span><span class="keyword">), </span><span class="default">$params</span><span class="keyword">) ;<br />
</span><span class="default">?&gt;<br />
</span><br />
Here's the complete example.<br />
WARNING: When using 'prepare' to prepare a statement to retrieve LOBs the method order matters.<br />
Also, method 'store_result()' must be called and be called in correct order.<br />
Failure to observe this causes PHP/MySQLi to crash or return an erroneous value.<br />
The proper procedure order is: prepare -&gt; execute -&gt; store_result -&gt; bind -&gt; fetch<br />
<br />
<span class="default">&lt;?php<br />
$database </span><span class="keyword">= </span><span class="string">"test" </span><span class="keyword">;<br />
</span><span class="default">$table </span><span class="keyword">= </span><span class="string">"test" </span><span class="keyword">;<br />
</span><span class="default">$column </span><span class="keyword">= array(</span><span class="string">"fidentity"</span><span class="keyword">, </span><span class="string">"fvarchar"</span><span class="keyword">, </span><span class="string">"fdate"</span><span class="keyword">, </span><span class="string">"ftinyblob"</span><span class="keyword">) ;<br />
</span><span class="default">$select_set </span><span class="keyword">= </span><span class="string">"`fidentity`, `fvarchar`, `fdate`, `ftinyblob`" </span><span class="keyword">;<br />
</span><span class="default">$mysqli </span><span class="keyword">= new </span><span class="default">mysqli</span><span class="keyword">(</span><span class="string">"localhost"</span><span class="keyword">, </span><span class="string">"root"</span><span class="keyword">, </span><span class="default">$password</span><span class="keyword">, </span><span class="default">$database</span><span class="keyword">);<br />
</span><span class="comment">// Proper procedure order: prepare -&gt; execute -&gt; store_result -&gt; bind -&gt; fetch<br />
</span><span class="default">$stmt </span><span class="keyword">= </span><span class="default">$mysqli</span><span class="keyword">-&gt;</span><span class="default">prepare</span><span class="keyword">(</span><span class="string">"SELECT </span><span class="default">$select_set</span><span class="string"> FROM `</span><span class="default">$table</span><span class="string">`"</span><span class="keyword">) ;<br />
</span><span class="default">$stmt</span><span class="keyword">-&gt;</span><span class="default">execute</span><span class="keyword">();<br />
</span><span class="default">$stmt</span><span class="keyword">-&gt;</span><span class="default">store_result</span><span class="keyword">(); <br />
</span><span class="default">$data </span><span class="keyword">= array() ; </span><span class="comment">// Array that accepts the data.<br />
</span><span class="default">$params </span><span class="keyword">= array() ; </span><span class="comment">// Parameter array passed to 'bind_result()'<br />
</span><span class="keyword">foreach(</span><span class="default">$column </span><span class="keyword">as </span><span class="default">$col_name</span><span class="keyword">)<br />
{<br />
&nbsp; </span><span class="comment">// Assign the fetched value to the variable '$data[$name]'<br />
&nbsp; </span><span class="default">$params</span><span class="keyword">[] =&amp; </span><span class="default">$data</span><span class="keyword">[</span><span class="default">$col_name</span><span class="keyword">] ;<br />
}<br />
</span><span class="default">$res </span><span class="keyword">= </span><span class="default">call_user_func_array</span><span class="keyword">(array(</span><span class="default">$stmt</span><span class="keyword">, </span><span class="string">"bind_result"</span><span class="keyword">), </span><span class="default">$params</span><span class="keyword">) ;<br />
if(! </span><span class="default">$res</span><span class="keyword">)<br />
{<br />
&nbsp; echo </span><span class="string">"bind_result() failed: " </span><span class="keyword">. </span><span class="default">$mysqli</span><span class="keyword">-&gt;</span><span class="default">error </span><span class="keyword">. </span><span class="string">"\n" </span><span class="keyword">;<br />
}<br />
else<br />
{<br />
&nbsp; </span><span class="default">$res </span><span class="keyword">= </span><span class="default">$stmt</span><span class="keyword">-&gt;</span><span class="default">fetch</span><span class="keyword">() ;<br />
&nbsp; if(</span><span class="default">$res</span><span class="keyword">)<br />
&nbsp; {<br />
&nbsp;&nbsp; &nbsp;&nbsp; echo </span><span class="string">"&lt;pre&gt;" </span><span class="keyword">. </span><span class="default">htmlentities</span><span class="keyword">(</span><span class="default">print_r</span><span class="keyword">(</span><span class="default">$data</span><span class="keyword">, </span><span class="default">true</span><span class="keyword">)) . </span><span class="string">"&lt;/pre&gt;\n" </span><span class="keyword">;<br />
&nbsp; }<br />
&nbsp; else<br />
&nbsp; {<br />
&nbsp;&nbsp;&nbsp; echo ((</span><span class="default">false </span><span class="keyword">!== </span><span class="default">$res</span><span class="keyword">) ? </span><span class="string">"End of data" </span><span class="keyword">: </span><span class="default">$stmt</span><span class="keyword">-&gt;</span><span class="default">error</span><span class="keyword">) . </span><span class="string">"\n" </span><span class="keyword">;<br />
&nbsp; }<br />
}<br />
</span><span class="default">$stmt</span><span class="keyword">-&gt;</span><span class="default">close</span><span class="keyword">() ;<br />
</span><span class="default">$mysqli</span><span class="keyword">-&gt;</span><span class="default">close</span><span class="keyword">() ;<br />
exit ;<br />
</span><span class="default">?&gt;<br />
</span><br />
The above example should output:<br />
Array (<br />
&nbsp; [fidentity] =&gt; 24<br />
&nbsp; [fvarchar] =&gt; the rain in spain<br />
&nbsp; [fdate] =&gt; 2010-07-31<br />
&nbsp; [ftinyblob] =&gt; GIF89a...(more BLOB data)<br />
)</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="98630""></a>
  <div class="note">
   <strong class="user">swissbob2 at yahoo dot co dot uk</strong>
   <a href="#98630" class="date">28-Jun-2010 01:08</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I discovered this one by accident; mysqli_stmt_bind_result overwrites an *existing* session variable of the same name (but doesn't create them).<br />
<br />
In other words,&nbsp; <br />
<br />
&nbsp;&nbsp;&nbsp; mysqli_stmt_bind_result($stmt, $col1, $col2);<br />
<br />
will overwrite session variables $_SESSION['col1'] and $_SESSION['col2'] if they exist, but will not create them if they don't.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="92505""></a>
  <div class="note">
   <strong class="user">uramihsayibok, gmail, com</strong>
   <a href="#92505" class="date">27-Jul-2009 10:35</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
A note to people to want to return an array of results - that is, an array of all the results from the query, not just one at a time.<br />
<br />
<span class="default">&lt;?php<br />
<br />
</span><span class="comment">// blah blah...<br />
</span><span class="default">call_user_func_array</span><span class="keyword">(array(</span><span class="default">$mysqli_stmt_object</span><span class="keyword">, </span><span class="string">"bind_result"</span><span class="keyword">), </span><span class="default">$byref_array_for_fields</span><span class="keyword">);<br />
<br />
</span><span class="default">$results </span><span class="keyword">= array();<br />
while (</span><span class="default">$mysqli_stmt_object</span><span class="keyword">-&gt;</span><span class="default">fetch</span><span class="keyword">()) {<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$results</span><span class="keyword">[] = </span><span class="default">$byref_array_for_fields</span><span class="keyword">;<br />
}<br />
<br />
</span><span class="default">?&gt;<br />
</span>This will NOT work. $results will have a bunch of arrays, but each one will have a reference to $byref.<br />
<br />
PHP is optimizing performance here: you aren't so much copying the $byref array into $results as you are *adding* it. That means $results will have a bunch of $byrefs - the same array repeated multiple times. (So what you see is that $results is all duplicates of the last item from the query.)<br />
<br />
hamidhossain (01-Sep-2008) shows how to get around that: inside the loop that fetches results you also have to loop through the list of fields, copying them as you go. In effect, copying everything individually.<br />
<br />
Personally, I'd rather use some kind of function that effectively duplicates an array than write my own code. Many of the built-in array functions don't work, apparently using references rather than copies, but a combination of array_map and create_function does.<br />
<br />
<span class="default">&lt;?php<br />
<br />
</span><span class="comment">// blah blah...<br />
</span><span class="default">call_user_func_array</span><span class="keyword">(array(</span><span class="default">$mysqli_stmt_object</span><span class="keyword">, </span><span class="string">"bind_result"</span><span class="keyword">), </span><span class="default">$byref_array_for_fields</span><span class="keyword">);<br />
<br />
</span><span class="comment">// returns a copy of a value<br />
</span><span class="default">$copy </span><span class="keyword">= </span><span class="default">create_function</span><span class="keyword">(</span><span class="string">'$a'</span><span class="keyword">, </span><span class="string">'return $a;'</span><span class="keyword">);<br />
<br />
</span><span class="default">$results </span><span class="keyword">= array();<br />
while (</span><span class="default">$mysqli_stmt_object</span><span class="keyword">-&gt;</span><span class="default">fetch</span><span class="keyword">()) {<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">// array_map will preserve keys when done here and this way<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$results</span><span class="keyword">[] = </span><span class="default">array_map</span><span class="keyword">(</span><span class="default">$copy</span><span class="keyword">, </span><span class="default">$byref_array_for_fields</span><span class="keyword">);<br />
}<br />
<br />
</span><span class="default">?&gt;<br />
</span><br />
All these problems would go away if they just implemented a fetch_assoc or even fetch_array for prepared statements...</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="92287""></a>
  <div class="note">
   <strong class="user">Miguel Hatrick</strong>
   <a href="#92287" class="date">17-Jul-2009 06:18</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Took some cool code from here and made a little class for those object oriented kind of guys<br />
<br />
used like this:<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="comment">// execute prepared statement<br />
</span><span class="default">$stmt</span><span class="keyword">-&gt;</span><span class="default">execute</span><span class="keyword">();<br />
</span><span class="default">$stmt</span><span class="keyword">-&gt;</span><span class="default">store_result</span><span class="keyword">();<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <br />
</span><span class="comment">//custom class :D bind to Statement Result mambo jambo!<br />
</span><span class="default">$sr </span><span class="keyword">= new </span><span class="default">Statement_Result</span><span class="keyword">(</span><span class="default">$stmt</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <br />
</span><span class="default">$stmt</span><span class="keyword">-&gt;</span><span class="default">fetch</span><span class="keyword">();<br />
</span><span class="default">printf</span><span class="keyword">(</span><span class="string">"ID: %d\n"</span><span class="keyword">, </span><span class="default">$sr</span><span class="keyword">-&gt;</span><span class="default">Get</span><span class="keyword">(</span><span class="string">'id'</span><span class="keyword">) );<br />
<br />
</span><span class="comment">/////////////////////////////////<br />
<br />
</span><span class="keyword">class </span><span class="default">Statement_Result<br />
</span><span class="keyword">{<br />
&nbsp;&nbsp;&nbsp; private </span><span class="default">$_bindVarsArray </span><span class="keyword">= array();<br />
&nbsp;&nbsp;&nbsp; private </span><span class="default">$_results </span><span class="keyword">= array();<br />
<br />
&nbsp;&nbsp;&nbsp; public function </span><span class="default">__construct</span><span class="keyword">(&amp;</span><span class="default">$stmt</span><span class="keyword">)<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$meta </span><span class="keyword">= </span><span class="default">$stmt</span><span class="keyword">-&gt;</span><span class="default">result_metadata</span><span class="keyword">();<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; while (</span><span class="default">$columnName </span><span class="keyword">= </span><span class="default">$meta</span><span class="keyword">-&gt;</span><span class="default">fetch_field</span><span class="keyword">())<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">_bindVarsArray</span><span class="keyword">[] = &amp;</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">_results</span><span class="keyword">[</span><span class="default">$columnName</span><span class="keyword">-&gt;</span><span class="default">name</span><span class="keyword">];<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">call_user_func_array</span><span class="keyword">(array(</span><span class="default">$stmt</span><span class="keyword">, </span><span class="string">'bind_result'</span><span class="keyword">), </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">_bindVarsArray</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$meta</span><span class="keyword">-&gt;</span><span class="default">close</span><span class="keyword">();<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; public function </span><span class="default">Get_Array</span><span class="keyword">()<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">_results</span><span class="keyword">;&nbsp; &nbsp; <br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; public function </span><span class="default">Get</span><span class="keyword">(</span><span class="default">$column_name</span><span class="keyword">)<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">_results</span><span class="keyword">[</span><span class="default">$column_name</span><span class="keyword">];<br />
&nbsp;&nbsp;&nbsp; }<br />
}<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="90507""></a>
  <div class="note">
   <strong class="user">atulkashyap1 at hotmail dot com</strong>
   <a href="#90507" class="date">25-Apr-2009 12:31</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
bind_ result can also be used to return an array of variables from a function,<br />
This took me a long time to figure out, so I would like to share this.<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">function </span><span class="default">extracting</span><span class="keyword">(){<br />
&nbsp; </span><span class="default">$query</span><span class="keyword">=</span><span class="string">"SELECT topic, detail, date, tags<br />
&nbsp;&nbsp;&nbsp; FROM updates<br />
&nbsp;&nbsp;&nbsp; ORDER BY date DESC<br />
&nbsp;&nbsp;&nbsp; LIMIT 5 "</span><span class="keyword">;<br />
&nbsp; if(</span><span class="default">$stmt </span><span class="keyword">= </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">conn</span><span class="keyword">-&gt;</span><span class="default">prepare</span><span class="keyword">(</span><span class="default">$query</span><span class="keyword">)) {<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$stmt</span><span class="keyword">-&gt;</span><span class="default">execute</span><span class="keyword">();<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$stmt</span><span class="keyword">-&gt;</span><span class="default">bind_result</span><span class="keyword">(</span><span class="default">$updates</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">],</span><span class="default">$updates</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">],</span><span class="default">$updates</span><span class="keyword">[</span><span class="default">2</span><span class="keyword">],</span><span class="default">$updates</span><span class="keyword">[</span><span class="default">3</span><span class="keyword">]);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$i</span><span class="keyword">=</span><span class="default">0</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; while(</span><span class="default">$stmt</span><span class="keyword">-&gt;</span><span class="default">fetch</span><span class="keyword">()){<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="default">$i</span><span class="keyword">++;<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="default">$name</span><span class="keyword">=</span><span class="string">'t'</span><span class="keyword">.</span><span class="default">$i</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp;&nbsp; $</span><span class="default">$name </span><span class="keyword">= array(</span><span class="default">$updates</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">],</span><span class="default">$updates</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">],</span><span class="default">$updates</span><span class="keyword">[</span><span class="default">2</span><span class="keyword">],</span><span class="default">$updates</span><span class="keyword">[</span><span class="default">3</span><span class="keyword">]);<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; return array(</span><span class="default">$t1</span><span class="keyword">,</span><span class="default">$t2</span><span class="keyword">,</span><span class="default">$t3</span><span class="keyword">,</span><span class="default">$t4</span><span class="keyword">,</span><span class="default">$t5</span><span class="keyword">,);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$stmt</span><span class="keyword">-&gt;</span><span class="default">close</span><span class="keyword">();<br />
&nbsp; }<br />
}<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="85470""></a>
  <div class="note">
   <strong class="user">hamidhossain at gmail dot com</strong>
   <a href="#85470" class="date">01-Sep-2008 04:07</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
lot of people don't like how bind_result works with prepared statements! it requires you to pass long list of parameters which will be loaded with column value when the function being called.<br />
<br />
To solve this, i used call_user_func_array function and result_metadata functions. which make easy and automatically returns an array of all columns results stored in an array with column names.<br />
<br />
please don't forget to change setting variables with your own credentials:<br />
<br />
<span class="default">&lt;?php<br />
$host </span><span class="keyword">= </span><span class="string">'localhost'</span><span class="keyword">;<br />
</span><span class="default">$user </span><span class="keyword">= </span><span class="string">'root'</span><span class="keyword">;<br />
</span><span class="default">$pass </span><span class="keyword">= </span><span class="string">'1234'</span><span class="keyword">;<br />
</span><span class="default">$data </span><span class="keyword">= </span><span class="string">'test'</span><span class="keyword">;<br />
<br />
</span><span class="default">$mysqli </span><span class="keyword">= new </span><span class="default">mysqli</span><span class="keyword">(</span><span class="default">$host</span><span class="keyword">, </span><span class="default">$user</span><span class="keyword">, </span><span class="default">$pass</span><span class="keyword">, </span><span class="default">$data</span><span class="keyword">);<br />
</span><span class="comment">/* check connection */<br />
</span><span class="keyword">if (</span><span class="default">mysqli_connect_errno</span><span class="keyword">()) {<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">printf</span><span class="keyword">(</span><span class="string">"Connect failed: %s\n"</span><span class="keyword">, </span><span class="default">mysqli_connect_error</span><span class="keyword">());<br />
&nbsp;&nbsp;&nbsp; exit();<br />
}<br />
<br />
if (</span><span class="default">$stmt </span><span class="keyword">= </span><span class="default">$mysqli</span><span class="keyword">-&gt;</span><span class="default">prepare</span><span class="keyword">(</span><span class="string">"SELECT * FROM sample WHERE t2 LIKE ?"</span><span class="keyword">)) {<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$tt2 </span><span class="keyword">= </span><span class="string">'%'</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$stmt</span><span class="keyword">-&gt;</span><span class="default">bind_param</span><span class="keyword">(</span><span class="string">"s"</span><span class="keyword">, </span><span class="default">$tt2</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$stmt</span><span class="keyword">-&gt;</span><span class="default">execute</span><span class="keyword">();<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$meta </span><span class="keyword">= </span><span class="default">$stmt</span><span class="keyword">-&gt;</span><span class="default">result_metadata</span><span class="keyword">();<br />
&nbsp;&nbsp;&nbsp; while (</span><span class="default">$field </span><span class="keyword">= </span><span class="default">$meta</span><span class="keyword">-&gt;</span><span class="default">fetch_field</span><span class="keyword">())<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$params</span><span class="keyword">[] = &amp;</span><span class="default">$row</span><span class="keyword">[</span><span class="default">$field</span><span class="keyword">-&gt;</span><span class="default">name</span><span class="keyword">];<br />
&nbsp;&nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">call_user_func_array</span><span class="keyword">(array(</span><span class="default">$stmt</span><span class="keyword">, </span><span class="string">'bind_result'</span><span class="keyword">), </span><span class="default">$params</span><span class="keyword">);<br />
<br />
&nbsp;&nbsp;&nbsp; while (</span><span class="default">$stmt</span><span class="keyword">-&gt;</span><span class="default">fetch</span><span class="keyword">()) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; foreach(</span><span class="default">$row </span><span class="keyword">as </span><span class="default">$key </span><span class="keyword">=&gt; </span><span class="default">$val</span><span class="keyword">)<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$c</span><span class="keyword">[</span><span class="default">$key</span><span class="keyword">] = </span><span class="default">$val</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$result</span><span class="keyword">[] = </span><span class="default">$c</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$stmt</span><span class="keyword">-&gt;</span><span class="default">close</span><span class="keyword">();<br />
}<br />
</span><span class="default">$mysqli</span><span class="keyword">-&gt;</span><span class="default">close</span><span class="keyword">();<br />
</span><span class="default">print_r</span><span class="keyword">(</span><span class="default">$result</span><span class="keyword">);<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="81350""></a>
  <div class="note">
   <strong class="user">bb at servertje dot nl</strong>
   <a href="#81350" class="date">24-Feb-2008 12:24</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Although inspired by an earlier post, this method could be added to any of your database objects. It's an object oriented implementation of an earlier post.<br />
<br />
The method returns an array with objects representing a row. Each property represents a column and its value.<br />
&nbsp;<br />
<span class="default">&lt;?php<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">private function </span><span class="default">getresult</span><span class="keyword">(</span><span class="default">$stmt</span><span class="keyword">)<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="default">$result </span><span class="keyword">= array();<br />
&nbsp;&nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="default">$metadata </span><span class="keyword">= </span><span class="default">$stmt</span><span class="keyword">-&gt;</span><span class="default">result_metadata</span><span class="keyword">();<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="default">$fields </span><span class="keyword">= </span><span class="default">$metadata</span><span class="keyword">-&gt;</span><span class="default">fetch_fields</span><span class="keyword">();<br />
<br />
&nbsp;&nbsp; &nbsp;&nbsp; for (;;)<br />
&nbsp;&nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$pointers </span><span class="keyword">= array();<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$row </span><span class="keyword">= new </span><span class="default">stdClass</span><span class="keyword">();<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$pointers</span><span class="keyword">[] = </span><span class="default">$stmt</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; foreach (</span><span class="default">$fields </span><span class="keyword">as </span><span class="default">$field</span><span class="keyword">)<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$fieldname </span><span class="keyword">= </span><span class="default">$field</span><span class="keyword">-&gt;</span><span class="default">name</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$pointers</span><span class="keyword">[] = &amp;</span><span class="default">$row</span><span class="keyword">-&gt;</span><span class="default">$fieldname</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">call_user_func_array</span><span class="keyword">(</span><span class="default">mysqli_stmt_bind_result</span><span class="keyword">, </span><span class="default">$pointers</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if (!</span><span class="default">$stmt</span><span class="keyword">-&gt;</span><span class="default">fetch</span><span class="keyword">())<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; break;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$result</span><span class="keyword">[] = </span><span class="default">$row</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="default">$metadata</span><span class="keyword">-&gt;</span><span class="default">free</span><span class="keyword">();<br />
&nbsp;&nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp;&nbsp; return </span><span class="default">$result</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="57943""></a>
  <div class="note">
   <strong class="user">thejkwhosaysni at gmail dot com</strong>
   <a href="#57943" class="date">19-Oct-2005 10:12</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I've created these functions which will act like mysqli_fetch_array() and mysqli_fetch_object() but work with bound results.<br />
<br />
<span class="default">&lt;?php<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">function </span><span class="default">fetch_object</span><span class="keyword">() {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$data </span><span class="keyword">= </span><span class="default">mysqli_stmt_result_metadata</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">stmt</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$count </span><span class="keyword">= </span><span class="default">1</span><span class="keyword">; </span><span class="comment">//start the count from 1. First value has to be a reference to stmt.<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$fieldnames</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">] = &amp;</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">stmt</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$obj </span><span class="keyword">= new </span><span class="default">stdClass</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; while (</span><span class="default">$field </span><span class="keyword">= </span><span class="default">mysqli_fetch_field</span><span class="keyword">(</span><span class="default">$data</span><span class="keyword">)) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$fn </span><span class="keyword">= </span><span class="default">$field</span><span class="keyword">-&gt;</span><span class="default">name</span><span class="keyword">; </span><span class="comment">//get all the feild names<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$fieldnames</span><span class="keyword">[</span><span class="default">$count</span><span class="keyword">] = &amp;</span><span class="default">$obj</span><span class="keyword">-&gt;</span><span class="default">$fn</span><span class="keyword">; </span><span class="comment">//load the fieldnames into an object..<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$count</span><span class="keyword">++;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">call_user_func_array</span><span class="keyword">(</span><span class="default">mysqli_stmt_bind_result</span><span class="keyword">, </span><span class="default">$fieldnames</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">mysqli_stmt_fetch</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">stmt</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">$obj</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp;&nbsp; function </span><span class="default">fetch_array</span><span class="keyword">() {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$data </span><span class="keyword">= </span><span class="default">mysqli_stmt_result_metadata</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">stmt</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$count </span><span class="keyword">= </span><span class="default">1</span><span class="keyword">; </span><span class="comment">//start the count from 1. First value has to be a reference to the stmt. because bind_param requires the link to $stmt as the first param.<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$fieldnames</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">] = &amp;</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">stmt</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; while (</span><span class="default">$field </span><span class="keyword">= </span><span class="default">mysqli_fetch_field</span><span class="keyword">(</span><span class="default">$data</span><span class="keyword">)) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$fieldnames</span><span class="keyword">[</span><span class="default">$count</span><span class="keyword">] = &amp;</span><span class="default">$array</span><span class="keyword">[</span><span class="default">$field</span><span class="keyword">-&gt;</span><span class="default">name</span><span class="keyword">]; </span><span class="comment">//load the fieldnames into an array.<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$count</span><span class="keyword">++;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">call_user_func_array</span><span class="keyword">(</span><span class="default">mysqli_stmt_bind_result</span><span class="keyword">, </span><span class="default">$fieldnames</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">mysqli_stmt_fetch</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">stmt</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">$array</span><span class="keyword">;<br />
<br />
&nbsp;&nbsp;&nbsp; }<br />
<br />
</span><span class="default">?&gt;<br />
</span><br />
Hope this helps some people, I was puzzled by this for a while.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="57564""></a>
  <div class="note">
   <strong class="user">andrey at php dot net</strong>
   <a href="#57564" class="date">07-Oct-2005 02:38</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If you select LOBs use the following order of execution or you risk mysqli allocating more memory that actually used<br />
<br />
1)prepare()<br />
2)execute()<br />
3)store_result()<br />
4)bind_result()<br />
<br />
If you skip 3) or exchange 3) and 4) then mysqli will allocate memory for the maximal length of the column which is 255 for tinyblob, 64k for blob(still ok), 16MByte for MEDIUMBLOB - quite a lot and 4G for LONGBLOB (good if you have so much memory). Queries which use this order a bit slower when there is a LOB but this is the price of not having memory exhaustion in seconds.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="51173""></a>
  <div class="note">
   <strong class="user">brad dot jackson at resiideo dot com</strong>
   <a href="#51173" class="date">22-Mar-2005 06:10</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
A potential problem exists in binding result parameters from a prepared statement which reference large datatypes like mediumblobs.&nbsp; One of our database tables contains a table of binary image data.&nbsp; Our largest image in this table is around 50Kb, but even so the column is typed as a mediumblob to allow for files larger than 64Kb.&nbsp; I spent a frustrating hour trying to figure out why mysqli_stmt_bind_result choked while trying to allocate 16MB of memory for what should have been at most a 50Kb result, until I realized the function is checking the column type first to find out how big a result _might_ be retrieved, and attempting to allocate that much memory to contain it.&nbsp; My solution was to use a more basic mysqli_result() query.&nbsp; Another option might have been to retype the image data column as blob (64Kb limit).</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
</div>
</div>
<hr /><div class="manualnavbar" style="text-align: center;">
 <div class="prev" style="text-align: left; float: left;"><a href="mysqli-stmt.bind-param.html">mysqli_stmt::bind_param</a></div>
 <div class="next" style="text-align: right; float: right;"><a href="mysqli-stmt.close.html">mysqli_stmt::close</a></div>
 <div class="up"><a href="class.mysqli-stmt.html">mysqli_stmt</a></div>
 <div class="home"><a href="index.html">PHP Manual</a></div>
</div></body></html>
