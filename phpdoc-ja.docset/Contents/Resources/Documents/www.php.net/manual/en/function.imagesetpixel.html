<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
 <head>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <title>点を生成する</title>
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <link media="all" rel="stylesheet" type="text/css" href="style.css"/>
 </head>
 <body class="docs"><div class="manualnavbar" style="text-align: center;">
 <div class="prev" style="text-align: left; float: left;"><a href="function.imagesetinterpolation.html">imagesetinterpolation</a></div>
 <div class="next" style="text-align: right; float: right;"><a href="function.imagesetstyle.html">imagesetstyle</a></div>
 <div class="up"><a href="ref.image.html">GD および Image 関数</a></div>
 <div class="home"><a href="index.html">PHP Manual</a></div>
</div><hr /><div id="function.imagesetpixel" class="refentry">
 <div class="refnamediv">
  <h1 class="refname">imagesetpixel</h1>
  <p class="verinfo">(PHP 4, PHP 5)</p><p class="refpurpose"><span class="refname">imagesetpixel</span> &mdash; <span class="dc-title">点を生成する</span></p>

 </div>
 <div class="refsect1 description" id="refsect1-function.imagesetpixel-description">
  <h3 class="title">説明</h3>
  <div class="methodsynopsis dc-description">
   <span class="type">bool</span> <span class="methodname"><strong>imagesetpixel</strong></span>
    ( <span class="methodparam"><span class="type">resource</span> <code class="parameter">$image</code></span>
   , <span class="methodparam"><span class="type">int</span> <code class="parameter">$x</code></span>
   , <span class="methodparam"><span class="type">int</span> <code class="parameter">$y</code></span>
   , <span class="methodparam"><span class="type">int</span> <code class="parameter">$color</code></span>
   )</div>

  <p class="para rdfs-comment">
    <span class="function"><strong>imagesetpixel()</strong></span> は、指定した座標にピクセルを描画します。
  </p>
 </div>

 <div class="refsect1 parameters" id="refsect1-function.imagesetpixel-parameters">
  <h3 class="title">パラメータ</h3>
  <p class="para">
   <dl>

    <dt>
<span class="term"><em><code class="parameter">
image</code></em></span><dd>
<p class="para"> <span class="function"><a href="function.imagecreatetruecolor.html" class="function">imagecreatetruecolor()</a></span>
のような画像作成関数が返す画像リソース。</p></dd>
</dt>

    <dt>

     <span class="term"><em><code class="parameter">x</code></em></span>
     <dd>

      <p class="para">
       x 座標。
      </p>
     </dd>

    </dt>

    <dt>

     <span class="term"><em><code class="parameter">y</code></em></span>
     <dd>

      <p class="para">
       y 座標。
      </p>
     </dd>

    </dt>

    <dt>

     <span class="term"><em><code class="parameter">color</code></em></span>
     <dd>

      <p class="para">
        <span class="function"><a href="function.imagecolorallocate.html" class="function">imagecolorallocate()</a></span>
       で作成した色 ID。
      </p>
     </dd>

    </dt>

   </dl>

  </p>
 </div>

 <div class="refsect1 returnvalues" id="refsect1-function.imagesetpixel-returnvalues">
  <h3 class="title">返り値</h3>
  <p class="para">
   成功した場合に <strong><code>TRUE</code></strong> を、失敗した場合に <strong><code>FALSE</code></strong> を返します。
  </p>
 </div>

 <div class="refsect1 examples" id="refsect1-function.imagesetpixel-examples">
  <h3 class="title">例</h3>
  <p class="para">
   <div class="example" id="example-3267">
    <p><strong>例1  <span class="function"><strong>imagesetpixel()</strong></span> の例</strong></p>
    <div class="example-contents"><p>
     A random drawing that ends with a regular picture.
    </p></div>
    <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br /><br />$x&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">200</span><span style="color: #007700">;<br /></span><span style="color: #0000BB">$y&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">200</span><span style="color: #007700">;<br /><br /></span><span style="color: #0000BB">$gd&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">imagecreatetruecolor</span><span style="color: #007700">(</span><span style="color: #0000BB">$x</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$y</span><span style="color: #007700">);<br />&nbsp;<br /></span><span style="color: #0000BB">$corners</span><span style="color: #007700">[</span><span style="color: #0000BB">0</span><span style="color: #007700">]&nbsp;=&nbsp;array(</span><span style="color: #DD0000">'x'&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #0000BB">100</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">'y'&nbsp;</span><span style="color: #007700">=&gt;&nbsp;&nbsp;</span><span style="color: #0000BB">10</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">$corners</span><span style="color: #007700">[</span><span style="color: #0000BB">1</span><span style="color: #007700">]&nbsp;=&nbsp;array(</span><span style="color: #DD0000">'x'&nbsp;</span><span style="color: #007700">=&gt;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">0</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">'y'&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #0000BB">190</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">$corners</span><span style="color: #007700">[</span><span style="color: #0000BB">2</span><span style="color: #007700">]&nbsp;=&nbsp;array(</span><span style="color: #DD0000">'x'&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #0000BB">200</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">'y'&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #0000BB">190</span><span style="color: #007700">);<br /><br /></span><span style="color: #0000BB">$red&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">imagecolorallocate</span><span style="color: #007700">(</span><span style="color: #0000BB">$gd</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">255</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">0</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">0</span><span style="color: #007700">);&nbsp;<br /><br />for&nbsp;(</span><span style="color: #0000BB">$i&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">0</span><span style="color: #007700">;&nbsp;</span><span style="color: #0000BB">$i&nbsp;</span><span style="color: #007700">&lt;&nbsp;</span><span style="color: #0000BB">100000</span><span style="color: #007700">;&nbsp;</span><span style="color: #0000BB">$i</span><span style="color: #007700">++)&nbsp;{<br />&nbsp;&nbsp;</span><span style="color: #0000BB">imagesetpixel</span><span style="color: #007700">(</span><span style="color: #0000BB">$gd</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">round</span><span style="color: #007700">(</span><span style="color: #0000BB">$x</span><span style="color: #007700">),</span><span style="color: #0000BB">round</span><span style="color: #007700">(</span><span style="color: #0000BB">$y</span><span style="color: #007700">),&nbsp;</span><span style="color: #0000BB">$red</span><span style="color: #007700">);<br />&nbsp;&nbsp;</span><span style="color: #0000BB">$a&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">rand</span><span style="color: #007700">(</span><span style="color: #0000BB">0</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">2</span><span style="color: #007700">);<br />&nbsp;&nbsp;</span><span style="color: #0000BB">$x&nbsp;</span><span style="color: #007700">=&nbsp;(</span><span style="color: #0000BB">$x&nbsp;</span><span style="color: #007700">+&nbsp;</span><span style="color: #0000BB">$corners</span><span style="color: #007700">[</span><span style="color: #0000BB">$a</span><span style="color: #007700">][</span><span style="color: #DD0000">'x'</span><span style="color: #007700">])&nbsp;/&nbsp;</span><span style="color: #0000BB">2</span><span style="color: #007700">;<br />&nbsp;&nbsp;</span><span style="color: #0000BB">$y&nbsp;</span><span style="color: #007700">=&nbsp;(</span><span style="color: #0000BB">$y&nbsp;</span><span style="color: #007700">+&nbsp;</span><span style="color: #0000BB">$corners</span><span style="color: #007700">[</span><span style="color: #0000BB">$a</span><span style="color: #007700">][</span><span style="color: #DD0000">'y'</span><span style="color: #007700">])&nbsp;/&nbsp;</span><span style="color: #0000BB">2</span><span style="color: #007700">;<br />}<br />&nbsp;<br /></span><span style="color: #0000BB">header</span><span style="color: #007700">(</span><span style="color: #DD0000">'Content-Type:&nbsp;image/png'</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">imagepng</span><span style="color: #007700">(</span><span style="color: #0000BB">$gd</span><span style="color: #007700">);<br /><br /></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
    </div>

    <div class="example-contents"><p>上の例の出力は、
たとえば以下のようになります。</p></div>
    <div class="mediaobject">
     
     <div class="imageobject">
      <img src="images/21009b70229598c6a80eef8b45bf282b-imagesetpixel.png" alt="出力例 : imagesetpixel()" width="200" height="200" />
     </div>
    </div>
   </div>
  </p>
 </div>

 <div class="refsect1 seealso" id="refsect1-function.imagesetpixel-seealso">
  <h3 class="title">参考</h3>
  <p class="para">
   <ul class="simplelist">
    <li class="member"> <span class="function"><a href="function.imagecreatetruecolor.html" class="function" rel="rdfs-seeAlso">imagecreatetruecolor()</a> - TrueColor イメージを新規に作成する</span></li>
    <li class="member"> <span class="function"><a href="function.imagecolorallocate.html" class="function" rel="rdfs-seeAlso">imagecolorallocate()</a> - 画像で使用する色を作成する</span></li>
    <li class="member"> <span class="function"><a href="function.imagecolorat.html" class="function" rel="rdfs-seeAlso">imagecolorat()</a> - ピクセルの色のインデックスを取得する</span></li>
   </ul>
  </p>
 </div>

</div><div id="usernotes">
 <div class="head">
  <h3 class="title">User Contributed Notes</h3>
 </div>
<div id="allnotes">  <a name="108517""></a>
  <div class="note">
   <strong class="user">guy032 at gmail dot com</strong>
   <a href="#108517" class="date">03-May-2012 03:57</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
making images with white (or close to white) background transprent<br />
<br />
&lt;?<br />
function FloodFill($im, $x, $y)<br />
{<br />
&nbsp;&nbsp;&nbsp; $rgb = imagecolorat($im, $x, $y);<br />
&nbsp;&nbsp;&nbsp; $r = ($rgb &gt;&gt; 16) &amp; 0xFF;<br />
&nbsp;&nbsp;&nbsp; $g = ($rgb &gt;&gt; 8) &amp; 0xFF;<br />
&nbsp;&nbsp;&nbsp; $b = $rgb &amp; 0xFF;<br />
&nbsp;<br />
&nbsp;&nbsp;&nbsp; $counter=0;<br />
&nbsp;&nbsp;&nbsp; $counter2=0;<br />
&nbsp;&nbsp;&nbsp; if($r &gt;= 245){ $counter++;}<br />
&nbsp;&nbsp;&nbsp; if($g &gt;= 245){ $counter++;}<br />
&nbsp;&nbsp;&nbsp; if($b &gt;= 245){ $counter++;}<br />
&nbsp;&nbsp;&nbsp; if($r &gt;= 240){ $counter2++;}<br />
&nbsp;&nbsp;&nbsp; if($g &gt;= 240){ $counter2++;}<br />
&nbsp;&nbsp;&nbsp; if($b &gt;= 240){ $counter2++;}<br />
<br />
&nbsp;&nbsp;&nbsp; if($counter &gt;= 1 &amp;&amp; $counter2 == 3){<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $background = imagecolorallocate($im, 180, 0, 255);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; imagesetpixel($im, $x, $y, $background);<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; FloodFill ($im, $x, $y+1);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; FloodFill ($im, $x+1, $y);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; FloodFill ($im, $x, $y-1);<br />
&nbsp;&nbsp;&nbsp; }<br />
}<br />
<br />
$src = $_GET["src"];<br />
$im = imagecreatefromjpeg($src);<br />
<br />
// Draw border <br />
$border = imagecolorallocate($im, 180, 0, 255);<br />
drawBorder($im, $border, 1); <br />
<br />
// Draw a border <br />
function drawBorder($im, $color, $thickness = 1) <br />
{ <br />
&nbsp;&nbsp;&nbsp; $x1 = 0; <br />
&nbsp;&nbsp;&nbsp; $y1 = 0; <br />
&nbsp;&nbsp;&nbsp; $x2 = ImageSX($im) - 1; <br />
&nbsp;&nbsp;&nbsp; $y2 = ImageSY($im) - 1; <br />
<br />
&nbsp;&nbsp;&nbsp; for($i = 0; $i &lt; $thickness; $i++) <br />
&nbsp;&nbsp;&nbsp; { <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; ImageRectangle($im, $x1++, $y1++, $x2--, $y2--, $color); <br />
&nbsp;&nbsp;&nbsp; } <br />
} <br />
<br />
$rgb = imagecolorat($im, 0, 0);<br />
FloodFill($im, 0, 0);<br />
$color = imagecolorallocate($im, 180, 0, 255);<br />
imagecolortransparent($im, $color);<br />
header("Content-type: image/png");<br />
imagepng($im);<br />
imagedestroy($im);<br />
?&gt;</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="97776""></a>
  <div class="note">
   <strong class="user">mail AT kkapsner DOT de</strong>
   <a href="#97776" class="date">07-May-2010 01:04</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
It IS posible to "delete" pixels from an image in PHP natively - the key-function is imageAlphaBlending:<br />
<span class="default">&lt;?php<br />
<br />
$image </span><span class="keyword">= </span><span class="default">imageCreateTrueColor</span><span class="keyword">(</span><span class="default">101</span><span class="keyword">, </span><span class="default">101</span><span class="keyword">);<br />
</span><span class="default">imageSaveAlpha</span><span class="keyword">(</span><span class="default">$image</span><span class="keyword">, </span><span class="default">true</span><span class="keyword">);<br />
<br />
</span><span class="comment"># draw a red cycle with alpha blending<br />
</span><span class="default">$red </span><span class="keyword">= </span><span class="default">imageColorAllocateAlpha</span><span class="keyword">(</span><span class="default">$image</span><span class="keyword">, </span><span class="default">255</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">30</span><span class="keyword">);<br />
</span><span class="default">imageFilledEllipse</span><span class="keyword">(</span><span class="default">$image</span><span class="keyword">, </span><span class="default">50</span><span class="keyword">, </span><span class="default">50</span><span class="keyword">, </span><span class="default">100</span><span class="keyword">, </span><span class="default">100</span><span class="keyword">, </span><span class="default">$red</span><span class="keyword">);<br />
<br />
</span><span class="comment"># disable alpha blending for deletion<br />
</span><span class="default">imageAlphaBlending</span><span class="keyword">(</span><span class="default">$image</span><span class="keyword">, </span><span class="default">false</span><span class="keyword">);<br />
<br />
</span><span class="comment"># paint with a complete opaque color<br />
</span><span class="default">$trans </span><span class="keyword">= </span><span class="default">imageColorAllocateAlpha</span><span class="keyword">(</span><span class="default">$image</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">127</span><span class="keyword">);<br />
<br />
</span><span class="comment"># you can clear every shape you like<br />
</span><span class="default">imageFilledRectangle</span><span class="keyword">(</span><span class="default">$image</span><span class="keyword">, </span><span class="default">30</span><span class="keyword">, </span><span class="default">30</span><span class="keyword">, </span><span class="default">70</span><span class="keyword">, </span><span class="default">70</span><span class="keyword">, </span><span class="default">$trans</span><span class="keyword">);<br />
<br />
</span><span class="comment"># enable alpha blending again<br />
</span><span class="default">imageAlphaBlending</span><span class="keyword">(</span><span class="default">$image</span><span class="keyword">, </span><span class="default">true</span><span class="keyword">);<br />
<br />
</span><span class="comment"># draw a green rectangle with alpha blending<br />
</span><span class="default">$green </span><span class="keyword">= </span><span class="default">imageColorAllocateAlpha</span><span class="keyword">(</span><span class="default">$image</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">255</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">40</span><span class="keyword">);<br />
</span><span class="default">imageFilledRectangle</span><span class="keyword">(</span><span class="default">$image</span><span class="keyword">, </span><span class="default">40</span><span class="keyword">, </span><span class="default">20</span><span class="keyword">, </span><span class="default">90</span><span class="keyword">, </span><span class="default">80</span><span class="keyword">, </span><span class="default">$green</span><span class="keyword">);<br />
<br />
</span><span class="default">header</span><span class="keyword">(</span><span class="string">"Content-Type: image/png"</span><span class="keyword">);<br />
</span><span class="default">imagePNG</span><span class="keyword">(</span><span class="default">$image</span><span class="keyword">);<br />
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="96283""></a>
  <div class="note">
   <strong class="user">cyberhorse at users dot sourceforge dot net</strong>
   <a href="#96283" class="date">18-Feb-2010 04:54</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Given an image $src and mask $mask, this applies the mask over the image, using different levels of transparency properly.<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">function </span><span class="default">image_mask</span><span class="keyword">(&amp;</span><span class="default">$src</span><span class="keyword">, &amp;</span><span class="default">$mask</span><span class="keyword">) {<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">imagesavealpha</span><span class="keyword">(</span><span class="default">$src</span><span class="keyword">, </span><span class="default">true</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">imagealphablending</span><span class="keyword">(</span><span class="default">$src</span><span class="keyword">, </span><span class="default">false</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">// scan image pixels<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">for (</span><span class="default">$x </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">; </span><span class="default">$x </span><span class="keyword">&lt; </span><span class="default">imagesx</span><span class="keyword">(</span><span class="default">$src</span><span class="keyword">); </span><span class="default">$x</span><span class="keyword">++) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; for (</span><span class="default">$y </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">; </span><span class="default">$y </span><span class="keyword">&lt; </span><span class="default">imagesy</span><span class="keyword">(</span><span class="default">$src</span><span class="keyword">); </span><span class="default">$y</span><span class="keyword">++) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$mask_pix </span><span class="keyword">= </span><span class="default">imagecolorat</span><span class="keyword">(</span><span class="default">$mask</span><span class="keyword">,</span><span class="default">$x</span><span class="keyword">,</span><span class="default">$y</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$mask_pix_color </span><span class="keyword">= </span><span class="default">imagecolorsforindex</span><span class="keyword">(</span><span class="default">$mask</span><span class="keyword">, </span><span class="default">$mask_pix</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">$mask_pix_color</span><span class="keyword">[</span><span class="string">'alpha'</span><span class="keyword">] &lt; </span><span class="default">127</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$src_pix </span><span class="keyword">= </span><span class="default">imagecolorat</span><span class="keyword">(</span><span class="default">$src</span><span class="keyword">,</span><span class="default">$x</span><span class="keyword">,</span><span class="default">$y</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$src_pix_array </span><span class="keyword">= </span><span class="default">imagecolorsforindex</span><span class="keyword">(</span><span class="default">$src</span><span class="keyword">, </span><span class="default">$src_pix</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">imagesetpixel</span><span class="keyword">(</span><span class="default">$src</span><span class="keyword">, </span><span class="default">$x</span><span class="keyword">, </span><span class="default">$y</span><span class="keyword">, </span><span class="default">imagecolorallocatealpha</span><span class="keyword">(</span><span class="default">$src</span><span class="keyword">, </span><span class="default">$src_pix_array</span><span class="keyword">[</span><span class="string">'red'</span><span class="keyword">], </span><span class="default">$src_pix_array</span><span class="keyword">[</span><span class="string">'green'</span><span class="keyword">], </span><span class="default">$src_pix_array</span><span class="keyword">[</span><span class="string">'blue'</span><span class="keyword">], </span><span class="default">127 </span><span class="keyword">- </span><span class="default">$mask_pix_color</span><span class="keyword">[</span><span class="string">'alpha'</span><span class="keyword">]));<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; }<br />
}<br />
</span><span class="default">?&gt;<br />
</span><br />
If your mask is reversed, change 127 - $mask_pix_color['alpha'] with just $mask_pix_color['alpha']</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="93223""></a>
  <div class="note">
   <strong class="user">caffinated</strong>
   <a href="#93223" class="date">29-Aug-2009 02:21</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Want to have some fun with this function?&nbsp; How about edge detection! (ported from <a href="http://bitecode.co.uk/2008/07/edge-detection-in-python/" rel="nofollow" target="_blank">http://bitecode.co.uk/2008/07/edge-detection-in-python/</a>)<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">function </span><span class="default">edge</span><span class="keyword">(</span><span class="default">$input</span><span class="keyword">, </span><span class="default">$output</span><span class="keyword">)<br />
{<br />
&nbsp; </span><span class="default">$in_im </span><span class="keyword">= </span><span class="default">imageCreateFromJpeg</span><span class="keyword">(</span><span class="default">$input</span><span class="keyword">);<br />
&nbsp; </span><span class="default">$gx </span><span class="keyword">= array(array(-</span><span class="default">1</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">1</span><span class="keyword">), array(-</span><span class="default">2</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">2</span><span class="keyword">), array(-</span><span class="default">1</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">1</span><span class="keyword">));<br />
&nbsp; </span><span class="default">$gy </span><span class="keyword">= array(array(-</span><span class="default">1</span><span class="keyword">, -</span><span class="default">2</span><span class="keyword">, -</span><span class="default">1</span><span class="keyword">), array(</span><span class="default">0</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">), array(</span><span class="default">1</span><span class="keyword">, </span><span class="default">2</span><span class="keyword">, </span><span class="default">1</span><span class="keyword">));<br />
&nbsp; </span><span class="default">$x </span><span class="keyword">= </span><span class="default">imagesx</span><span class="keyword">(</span><span class="default">$in_im</span><span class="keyword">);<br />
&nbsp; </span><span class="default">$y </span><span class="keyword">= </span><span class="default">imagesy</span><span class="keyword">(</span><span class="default">$in_im</span><span class="keyword">);<br />
&nbsp; </span><span class="default">$out_im </span><span class="keyword">= </span><span class="default">imagecreatetruecolor</span><span class="keyword">(</span><span class="default">$x</span><span class="keyword">, </span><span class="default">$y</span><span class="keyword">);<br />
&nbsp; </span><span class="default">$colors </span><span class="keyword">= array(</span><span class="default">255 </span><span class="keyword">=&gt; </span><span class="default">imagecolorallocate</span><span class="keyword">(</span><span class="default">$out_im</span><span class="keyword">, </span><span class="default">255</span><span class="keyword">, </span><span class="default">255</span><span class="keyword">, </span><span class="default">255</span><span class="keyword">));<br />
&nbsp; for (</span><span class="default">$row </span><span class="keyword">= </span><span class="default">1</span><span class="keyword">; </span><span class="default">$row </span><span class="keyword">&lt; </span><span class="default">$x</span><span class="keyword">; </span><span class="default">$row</span><span class="keyword">++)<br />
&nbsp; {<br />
&nbsp;&nbsp;&nbsp; for (</span><span class="default">$col </span><span class="keyword">= </span><span class="default">1</span><span class="keyword">; </span><span class="default">$col </span><span class="keyword">&lt; </span><span class="default">$y</span><span class="keyword">; </span><span class="default">$col</span><span class="keyword">++)<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="default">$eyedropper </span><span class="keyword">=</span><span class="default">imagecolorat</span><span class="keyword">(</span><span class="default">$in_im</span><span class="keyword">, </span><span class="default">$x</span><span class="keyword">, </span><span class="default">$y</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="default">$color </span><span class="keyword">=</span><span class="default">imagecolorsforindex</span><span class="keyword">(</span><span class="default">$in_im</span><span class="keyword">, </span><span class="default">$eyedropper</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="default">$pxval </span><span class="keyword">= (</span><span class="default">$color</span><span class="keyword">[</span><span class="string">'red'</span><span class="keyword">] + </span><span class="default">$color</span><span class="keyword">[</span><span class="string">'green'</span><span class="keyword">] + </span><span class="default">$color</span><span class="keyword">[</span><span class="string">'blue'</span><span class="keyword">]) / </span><span class="default">3</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="default">$pixel_gx </span><span class="keyword">= </span><span class="default">$pixel_gy </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp;&nbsp; for (</span><span class="default">$i </span><span class="keyword">= -</span><span class="default">1</span><span class="keyword">; </span><span class="default">$i </span><span class="keyword">&lt; </span><span class="default">2</span><span class="keyword">; </span><span class="default">$i</span><span class="keyword">++)<br />
&nbsp;&nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; for (</span><span class="default">$j </span><span class="keyword">= -</span><span class="default">1</span><span class="keyword">; </span><span class="default">$j </span><span class="keyword">&lt; </span><span class="default">2</span><span class="keyword">; </span><span class="default">$j</span><span class="keyword">++)<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$eyedropper </span><span class="keyword">=</span><span class="default">imagecolorat</span><span class="keyword">(</span><span class="default">$in_im</span><span class="keyword">, </span><span class="default">$row</span><span class="keyword">+</span><span class="default">$i</span><span class="keyword">, </span><span class="default">$col</span><span class="keyword">+</span><span class="default">$j</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$color </span><span class="keyword">=</span><span class="default">imagecolorsforindex</span><span class="keyword">(</span><span class="default">$in_im</span><span class="keyword">, </span><span class="default">$eyedropper</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$val </span><span class="keyword">= (</span><span class="default">$color</span><span class="keyword">[</span><span class="string">'red'</span><span class="keyword">] + </span><span class="default">$color</span><span class="keyword">[</span><span class="string">'green'</span><span class="keyword">] + </span><span class="default">$color</span><span class="keyword">[</span><span class="string">'blue'</span><span class="keyword">]) / </span><span class="default">3</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$pixel_gx </span><span class="keyword">+= </span><span class="default">$gx</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">+</span><span class="default">1</span><span class="keyword">][</span><span class="default">$j</span><span class="keyword">+</span><span class="default">1</span><span class="keyword">] * </span><span class="default">$val</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$pixel_gy </span><span class="keyword">+= </span><span class="default">$gy</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">+</span><span class="default">1</span><span class="keyword">][</span><span class="default">$j</span><span class="keyword">+</span><span class="default">1</span><span class="keyword">] * </span><span class="default">$val</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="default">$pixel </span><span class="keyword">= </span><span class="default">sqrt</span><span class="keyword">(</span><span class="default">$pixel_gx </span><span class="keyword">* </span><span class="default">$pixel_gx </span><span class="keyword">+ </span><span class="default">$pixel_gy </span><span class="keyword">* </span><span class="default">$pixel_gy</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="default">$pixel </span><span class="keyword">= </span><span class="default">abs</span><span class="keyword">(</span><span class="default">255 </span><span class="keyword">- (int)</span><span class="default">$pixel</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp;&nbsp; if (!isset(</span><span class="default">$colors</span><span class="keyword">[</span><span class="default">$pixel</span><span class="keyword">])) </span><span class="default">$colors</span><span class="keyword">[</span><span class="default">$pixel</span><span class="keyword">] = </span><span class="default">imagecolorallocate</span><span class="keyword">(</span><span class="default">$out_im</span><span class="keyword">, </span><span class="default">$pixel</span><span class="keyword">, </span><span class="default">$pixel</span><span class="keyword">, </span><span class="default">$pixel</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="default">imageSetPixel</span><span class="keyword">(</span><span class="default">$out_im</span><span class="keyword">, </span><span class="default">$row</span><span class="keyword">, </span><span class="default">$col</span><span class="keyword">, </span><span class="default">$colors</span><span class="keyword">[</span><span class="default">$pixel</span><span class="keyword">]);<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp; }<br />
&nbsp; </span><span class="default">imagejpeg</span><span class="keyword">(</span><span class="default">$out_im</span><span class="keyword">,</span><span class="default">$output</span><span class="keyword">, </span><span class="default">75</span><span class="keyword">);<br />
}<br />
<br />
</span><span class="default">edge</span><span class="keyword">(</span><span class="string">'input.jpg'</span><span class="keyword">, </span><span class="string">'output.jpg'</span><span class="keyword">);<br />
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="92944""></a>
  <div class="note">
   <strong class="user">aelitadelarobia at gmail dot com</strong>
   <a href="#92944" class="date">15-Aug-2009 09:56</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
another gradient example that can do horizontal or vertical gradients<br />
<br />
<span class="default">&lt;?php<br />
$width</span><span class="keyword">=</span><span class="default">$_GET</span><span class="keyword">[</span><span class="string">'width'</span><span class="keyword">];<br />
</span><span class="default">$height</span><span class="keyword">=</span><span class="default">$_GET</span><span class="keyword">[</span><span class="string">'height'</span><span class="keyword">];<br />
</span><span class="default">$starts</span><span class="keyword">=</span><span class="default">explode</span><span class="keyword">(</span><span class="string">","</span><span class="keyword">,</span><span class="default">$_GET</span><span class="keyword">[</span><span class="string">'startcolor'</span><span class="keyword">]);<br />
</span><span class="default">$ends</span><span class="keyword">=</span><span class="default">explode</span><span class="keyword">(</span><span class="string">","</span><span class="keyword">,</span><span class="default">$_GET</span><span class="keyword">[</span><span class="string">'endcolor'</span><span class="keyword">]);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$rstart</span><span class="keyword">=</span><span class="default">$starts</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">];<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$gstart</span><span class="keyword">=</span><span class="default">$starts</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">];<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$bstart</span><span class="keyword">=</span><span class="default">$starts</span><span class="keyword">[</span><span class="default">2</span><span class="keyword">];<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$rend</span><span class="keyword">=</span><span class="default">$ends</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">];<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$gend</span><span class="keyword">=</span><span class="default">$ends</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">];<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$bend</span><span class="keyword">=</span><span class="default">$ends</span><span class="keyword">[</span><span class="default">2</span><span class="keyword">];<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$r</span><span class="keyword">=</span><span class="default">$rstart</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$g</span><span class="keyword">=</span><span class="default">$gstart</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$b</span><span class="keyword">=</span><span class="default">$bstart</span><span class="keyword">;<br />
</span><span class="default">$bigger</span><span class="keyword">=</span><span class="default">imagecreatetruecolor</span><span class="keyword">(</span><span class="default">$width</span><span class="keyword">,</span><span class="default">$height</span><span class="keyword">);<br />
for (</span><span class="default">$y</span><span class="keyword">=</span><span class="default">0</span><span class="keyword">;</span><span class="default">$y</span><span class="keyword">&lt;=</span><span class="default">265</span><span class="keyword">;</span><span class="default">$y</span><span class="keyword">++) {<br />
&nbsp;&nbsp;&nbsp; if (</span><span class="default">$mode </span><span class="keyword">== </span><span class="string">'horiz'</span><span class="keyword">) { </span><span class="comment">//if doing a horizontal gradient, reset to the starting color every row<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$r</span><span class="keyword">=</span><span class="default">$rstart</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$g</span><span class="keyword">=</span><span class="default">$gstart</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$b</span><span class="keyword">=</span><span class="default">$bstart</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; for (</span><span class="default">$x</span><span class="keyword">=</span><span class="default">0</span><span class="keyword">;</span><span class="default">$x</span><span class="keyword">&lt;=</span><span class="default">464</span><span class="keyword">;</span><span class="default">$x</span><span class="keyword">++) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">imagesetpixel</span><span class="keyword">(</span><span class="default">$bigger</span><span class="keyword">,</span><span class="default">$x</span><span class="keyword">,</span><span class="default">$y</span><span class="keyword">,</span><span class="default">imagecolorallocate</span><span class="keyword">(</span><span class="default">$bigger</span><span class="keyword">,</span><span class="default">$r</span><span class="keyword">,</span><span class="default">$g</span><span class="keyword">,</span><span class="default">$b</span><span class="keyword">));<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">$mode</span><span class="keyword">==</span><span class="string">"horiz"</span><span class="keyword">) {&nbsp; &nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">$r </span><span class="keyword">!= </span><span class="default">$rend</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$r</span><span class="keyword">=</span><span class="default">$r</span><span class="keyword">+((</span><span class="default">$rend</span><span class="keyword">-</span><span class="default">$rstart</span><span class="keyword">)/</span><span class="default">$width</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">$g </span><span class="keyword">!= </span><span class="default">$gend</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$g</span><span class="keyword">=</span><span class="default">$g</span><span class="keyword">+((</span><span class="default">$gend</span><span class="keyword">-</span><span class="default">$gstart</span><span class="keyword">)/</span><span class="default">$width</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">$b </span><span class="keyword">!= </span><span class="default">$bend</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$b</span><span class="keyword">=</span><span class="default">$b</span><span class="keyword">+((</span><span class="default">$bend</span><span class="keyword">-</span><span class="default">$bstart</span><span class="keyword">)/</span><span class="default">$width</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; if (</span><span class="default">$mode </span><span class="keyword">== </span><span class="string">"vert"</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">$r </span><span class="keyword">!= </span><span class="default">$rend</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$r</span><span class="keyword">=</span><span class="default">$r</span><span class="keyword">+((</span><span class="default">$rend</span><span class="keyword">-</span><span class="default">$rstart</span><span class="keyword">)/</span><span class="default">$height</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">$g </span><span class="keyword">!= </span><span class="default">$gend</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$g</span><span class="keyword">=</span><span class="default">$g</span><span class="keyword">+((</span><span class="default">$gend</span><span class="keyword">-</span><span class="default">$gstart</span><span class="keyword">)/</span><span class="default">$height</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">$b </span><span class="keyword">!= </span><span class="default">$bend</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$b</span><span class="keyword">=</span><span class="default">$b</span><span class="keyword">+((</span><span class="default">$bend</span><span class="keyword">-</span><span class="default">$bstart</span><span class="keyword">)/</span><span class="default">$height</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; }<br />
}<br />
</span><span class="default">header</span><span class="keyword">(</span><span class="string">"Content-type: image/jpeg"</span><span class="keyword">);<br />
</span><span class="default">header</span><span class="keyword">(</span><span class="string">'Content-Disposition: inline; filename="gradient.jpg"'</span><span class="keyword">);<br />
<br />
</span><span class="default">imagejpeg</span><span class="keyword">(</span><span class="default">$bigger</span><span class="keyword">,</span><span class="default">NULL</span><span class="keyword">,</span><span class="default">99</span><span class="keyword">);<br />
</span><span class="default">imagedestroy</span><span class="keyword">(</span><span class="default">$bigger</span><span class="keyword">);<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="89189""></a>
  <div class="note">
   <strong class="user">CPHaxer</strong>
   <a href="#89189" class="date">25-Feb-2009 10:35</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Sorry for the long intro of my function, but i just want to tell how it works and - how silly sometimes the ideas are to make such functions. Have fun ;D<br />
<br />
<span class="default">&lt;?php<br />
<br />
&nbsp; </span><span class="comment">//@FunctionName:&nbsp; &nbsp; drawPlot<br />
&nbsp; //@Parameters:&nbsp; &nbsp; &nbsp; drawPlot(img &amp;$image, int $red, int $green, int $blue, int $x, int $y)<br />
&nbsp; //<br />
&nbsp; //&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; img $image<br />
&nbsp; //&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; The Image it will draw on. The Image will be modified; there is no return value.<br />
&nbsp; //<br />
&nbsp; //&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; int $red, int $green, int $blue<br />
&nbsp; //&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; The Colorvalues to draw with<br />
&nbsp; //<br />
&nbsp; //&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; int $x, int $y<br />
&nbsp; //&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; The Location to draw the Plot.<br />
&nbsp; //&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; And this is the Mainpart, because $x and $y<br />
&nbsp; //&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; NEED NOT be rounded!<br />
&nbsp; //&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; If you want to make a Plot at [253.643891, 482];<br />
&nbsp; //&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; It will draw the Plot there. Exact at the Coordinates.<br />
&nbsp; //&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; You could use this to make smooth lines.<br />
&nbsp; //&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; They have rational Coordinates, too.<br />
&nbsp; //<br />
&nbsp; //@Author:&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Alexander Rath (*Feb 9th, 1996 ; 13 Years old)<br />
&nbsp; //<br />
&nbsp; //@Idea:&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; We have in Math Geometrie now. And as the only Computerfreak<br />
&nbsp; //&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; In the class, i asked me: "How would it be, to mirror something<br />
&nbsp; //&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; At a NOT FLAT LINE."<br />
&nbsp; //&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; So I started thinking about it. First i tought about degresses - Nah!<br />
&nbsp; //&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Then i saw:<br />
&nbsp; //&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; A point to mirror, has the SHORTEST way to the Line;<br />
&nbsp; //&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; so i just needed to make the result smooth.<br />
&nbsp; //&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Unlike the other ways to draw pixels.<br />
&nbsp; //&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ~I started developing this:<br />
&nbsp; // PS: Sorry for bad english ( I am german )<br />
<br />
&nbsp; //Lets create a TrueColor Image Resource<br />
&nbsp; </span><span class="default">$image </span><span class="keyword">= </span><span class="default">imagecreatetruecolor</span><span class="keyword">(</span><span class="default">640</span><span class="keyword">, </span><span class="default">480</span><span class="keyword">);<br />
&nbsp; <br />
&nbsp; </span><span class="comment">//Lets make it Alpha<br />
&nbsp; </span><span class="default">imagealphablending</span><span class="keyword">(</span><span class="default">$image</span><span class="keyword">, </span><span class="default">true</span><span class="keyword">);<br />
&nbsp; </span><span class="default">imagesavealpha</span><span class="keyword">(</span><span class="default">$image</span><span class="keyword">, </span><span class="default">true</span><span class="keyword">);<br />
&nbsp; <br />
&nbsp; </span><span class="comment">//...with White Background to draw on.<br />
&nbsp; </span><span class="default">imagefilledrectangle</span><span class="keyword">(</span><span class="default">$image</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">640</span><span class="keyword">, </span><span class="default">480</span><span class="keyword">, </span><span class="default">imagecolorallocate</span><span class="keyword">(</span><span class="default">$image</span><span class="keyword">, </span><span class="default">255</span><span class="keyword">, </span><span class="default">255</span><span class="keyword">, </span><span class="default">255</span><span class="keyword">));<br />
&nbsp; <br />
&nbsp; </span><span class="comment">//This is my little "Example"-Script<br />
&nbsp; </span><span class="keyword">for(</span><span class="default">$x </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">; </span><span class="default">$x </span><span class="keyword">&lt;= </span><span class="default">640</span><span class="keyword">; </span><span class="default">$x </span><span class="keyword">= </span><span class="default">$x </span><span class="keyword">+ </span><span class="default">0.01</span><span class="keyword">) {<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$y </span><span class="keyword">= </span><span class="default">$x </span><span class="keyword">/ (</span><span class="default">tan</span><span class="keyword">(</span><span class="default">$x</span><span class="keyword">) + </span><span class="default">1</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">drawPlot</span><span class="keyword">(</span><span class="default">$image</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">$x</span><span class="keyword">, </span><span class="default">$y</span><span class="keyword">);<br />
&nbsp; }<br />
&nbsp; <br />
&nbsp; </span><span class="default">header</span><span class="keyword">(</span><span class="string">"Content-type: image/png"</span><span class="keyword">);<br />
&nbsp; </span><span class="default">imagepng</span><span class="keyword">(</span><span class="default">$image</span><span class="keyword">);<br />
&nbsp; <br />
&nbsp; function </span><span class="default">drawPlot</span><span class="keyword">(&amp;</span><span class="default">$func_image</span><span class="keyword">, </span><span class="default">$func_red</span><span class="keyword">, </span><span class="default">$func_green</span><span class="keyword">, </span><span class="default">$func_blue</span><span class="keyword">, </span><span class="default">$func_x</span><span class="keyword">, </span><span class="default">$func_y</span><span class="keyword">) {<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$func_Right </span><span class="keyword">= </span><span class="default">$func_x </span><span class="keyword">- </span><span class="default">floor</span><span class="keyword">(</span><span class="default">$func_x</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="default">$func_Left </span><span class="keyword">= </span><span class="default">1 </span><span class="keyword">- </span><span class="default">$func_Right</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="default">$func_Bottom </span><span class="keyword">= </span><span class="default">$func_y </span><span class="keyword">- </span><span class="default">floor</span><span class="keyword">(</span><span class="default">$func_y</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="default">$func_Top </span><span class="keyword">= </span><span class="default">1 </span><span class="keyword">- </span><span class="default">$func_Bottom</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$func_RightAlpha </span><span class="keyword">= </span><span class="default">$func_Right </span><span class="keyword">* </span><span class="default">127</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$func_LeftAlpha </span><span class="keyword">= </span><span class="default">$func_Left </span><span class="keyword">* </span><span class="default">127</span><span class="keyword">;<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$func_LeftTop </span><span class="keyword">= </span><span class="default">$func_LeftAlpha </span><span class="keyword">* </span><span class="default">$func_Top</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$func_RightTop </span><span class="keyword">= </span><span class="default">$func_RightAlpha </span><span class="keyword">* </span><span class="default">$func_Top</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$func_LeftBottom </span><span class="keyword">= </span><span class="default">$func_LeftAlpha </span><span class="keyword">* </span><span class="default">$func_Bottom</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$func_RightBottom </span><span class="keyword">= </span><span class="default">$func_RightAlpha </span><span class="keyword">* </span><span class="default">$func_Bottom</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$func_x </span><span class="keyword">= </span><span class="default">floor</span><span class="keyword">(</span><span class="default">$func_x</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$func_y </span><span class="keyword">= </span><span class="default">floor</span><span class="keyword">(</span><span class="default">$func_y</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; </span><span class="default">imagesetpixel</span><span class="keyword">(</span><span class="default">$func_image</span><span class="keyword">, </span><span class="default">$func_x</span><span class="keyword">, </span><span class="default">$func_y</span><span class="keyword">, </span><span class="default">imagecolorallocatealpha</span><span class="keyword">(</span><span class="default">$func_image</span><span class="keyword">, </span><span class="default">$func_red</span><span class="keyword">, </span><span class="default">$func_green</span><span class="keyword">, </span><span class="default">$func_blue</span><span class="keyword">, </span><span class="default">127 </span><span class="keyword">- </span><span class="default">$func_LeftTop</span><span class="keyword">));<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">imagesetpixel</span><span class="keyword">(</span><span class="default">$func_image</span><span class="keyword">, </span><span class="default">$func_x </span><span class="keyword">+ </span><span class="default">1</span><span class="keyword">, </span><span class="default">$func_y</span><span class="keyword">, </span><span class="default">imagecolorallocatealpha</span><span class="keyword">(</span><span class="default">$func_image</span><span class="keyword">, </span><span class="default">$func_red</span><span class="keyword">, </span><span class="default">$func_green</span><span class="keyword">, </span><span class="default">$func_blue</span><span class="keyword">, </span><span class="default">127 </span><span class="keyword">- </span><span class="default">$func_RightTop</span><span class="keyword">));<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">imagesetpixel</span><span class="keyword">(</span><span class="default">$func_image</span><span class="keyword">, </span><span class="default">$func_x </span><span class="keyword">+ </span><span class="default">1</span><span class="keyword">, </span><span class="default">$func_y </span><span class="keyword">+ </span><span class="default">1</span><span class="keyword">, </span><span class="default">imagecolorallocatealpha</span><span class="keyword">(</span><span class="default">$func_image</span><span class="keyword">, </span><span class="default">$func_red</span><span class="keyword">, </span><span class="default">$func_green</span><span class="keyword">, </span><span class="default">$func_blue</span><span class="keyword">, </span><span class="default">127 </span><span class="keyword">- </span><span class="default">$func_RightBottom</span><span class="keyword">));<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">imagesetpixel</span><span class="keyword">(</span><span class="default">$func_image</span><span class="keyword">, </span><span class="default">$func_x</span><span class="keyword">, </span><span class="default">$func_y </span><span class="keyword">+ </span><span class="default">1</span><span class="keyword">, </span><span class="default">imagecolorallocatealpha</span><span class="keyword">(</span><span class="default">$func_image</span><span class="keyword">, </span><span class="default">$func_red</span><span class="keyword">, </span><span class="default">$func_green</span><span class="keyword">, </span><span class="default">$func_blue</span><span class="keyword">, </span><span class="default">127 </span><span class="keyword">- </span><span class="default">$func_LeftBottom</span><span class="keyword">));<br />
&nbsp; }<br />
&nbsp; <br />
</span><span class="default">?&gt;<br />
</span><br />
Have fun ;D</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="87763""></a>
  <div class="note">
   <strong class="user">Scott Evernden (doctor3d at gmail)</strong>
   <a href="#87763" class="date">20-Dec-2008 02:00</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Re: imagecreatefromtga() .. I just did some testing with what I think are valid Targa-24 and Targa-32 bit images, and modified the inner logic as follows:<br />
<br />
<span class="default">&lt;?php<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">if (</span><span class="default">$bytes_per_pixel </span><span class="keyword">== </span><span class="default">2</span><span class="keyword">)&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="comment">// TARGA 16 - ARRRRRGG GGGBBBBB<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">{<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$word </span><span class="keyword">= </span><span class="default">fileint</span><span class="keyword">(</span><span class="default">$data</span><span class="keyword">, </span><span class="default">$pointer</span><span class="keyword">, </span><span class="default">2</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$r </span><span class="keyword">= (</span><span class="default">$word </span><span class="keyword">&amp; </span><span class="default">0x7C00</span><span class="keyword">) &gt;&gt; </span><span class="default">7</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$g </span><span class="keyword">= (</span><span class="default">$word </span><span class="keyword">&amp; </span><span class="default">0x03E0</span><span class="keyword">) &gt;&gt; </span><span class="default">2</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$b </span><span class="keyword">= (</span><span class="default">$word </span><span class="keyword">&amp; </span><span class="default">0x001F</span><span class="keyword">) &lt;&lt; </span><span class="default">3</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$a </span><span class="keyword">= (</span><span class="default">$word </span><span class="keyword">&amp; </span><span class="default">0x8000</span><span class="keyword">) ? </span><span class="default">127 </span><span class="keyword">: </span><span class="default">0</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$color </span><span class="keyword">= </span><span class="default">imagecolorallocatealpha</span><span class="keyword">(</span><span class="default">$image</span><span class="keyword">, </span><span class="default">$r</span><span class="keyword">, </span><span class="default">$g</span><span class="keyword">, </span><span class="default">$b</span><span class="keyword">, </span><span class="default">$a</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">imagesetpixel</span><span class="keyword">(</span><span class="default">$image</span><span class="keyword">, </span><span class="default">$x</span><span class="keyword">, </span><span class="default">$y</span><span class="keyword">, </span><span class="default">$color</span><span class="keyword">);&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; else if (</span><span class="default">$bytes_per_pixel </span><span class="keyword">== </span><span class="default">3</span><span class="keyword">)&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="comment">// TARGA 24 - BBBBBBBB GGGGGGGG RRRRRRRR<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">{<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$r </span><span class="keyword">= </span><span class="default">fileint</span><span class="keyword">(</span><span class="default">$data</span><span class="keyword">, </span><span class="default">$pointer</span><span class="keyword">, </span><span class="default">1</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$b </span><span class="keyword">= </span><span class="default">fileint</span><span class="keyword">(</span><span class="default">$data</span><span class="keyword">, </span><span class="default">$pointer</span><span class="keyword">+</span><span class="default">1</span><span class="keyword">, </span><span class="default">1</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$g </span><span class="keyword">= </span><span class="default">fileint</span><span class="keyword">(</span><span class="default">$data</span><span class="keyword">, </span><span class="default">$pointer</span><span class="keyword">+</span><span class="default">2</span><span class="keyword">, </span><span class="default">1</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$color </span><span class="keyword">= </span><span class="default">imagecolorallocate</span><span class="keyword">(</span><span class="default">$image</span><span class="keyword">, </span><span class="default">$r</span><span class="keyword">, </span><span class="default">$g</span><span class="keyword">, </span><span class="default">$b</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">imagesetpixel</span><span class="keyword">(</span><span class="default">$image</span><span class="keyword">, </span><span class="default">$x</span><span class="keyword">, </span><span class="default">$y</span><span class="keyword">, </span><span class="default">$color</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; else if (</span><span class="default">$bytes_per_pixel </span><span class="keyword">== </span><span class="default">4</span><span class="keyword">)&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="comment">// TARGA 32 - BBBBBBBB GGGGGGGG RRRRRRRR AAAAAAAA<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">{<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$b </span><span class="keyword">= </span><span class="default">fileint</span><span class="keyword">(</span><span class="default">$data</span><span class="keyword">, </span><span class="default">$pointer</span><span class="keyword">, </span><span class="default">1</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$g </span><span class="keyword">= </span><span class="default">fileint</span><span class="keyword">(</span><span class="default">$data</span><span class="keyword">, </span><span class="default">$pointer</span><span class="keyword">+</span><span class="default">1</span><span class="keyword">, </span><span class="default">1</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$r </span><span class="keyword">= </span><span class="default">fileint</span><span class="keyword">(</span><span class="default">$data</span><span class="keyword">, </span><span class="default">$pointer</span><span class="keyword">+</span><span class="default">2</span><span class="keyword">, </span><span class="default">1</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$a </span><span class="keyword">= (</span><span class="default">255 </span><span class="keyword">- </span><span class="default">fileint</span><span class="keyword">(</span><span class="default">$data</span><span class="keyword">, </span><span class="default">$pointer</span><span class="keyword">+</span><span class="default">3</span><span class="keyword">, </span><span class="default">1</span><span class="keyword">)) &gt;&gt; </span><span class="default">1</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$color </span><span class="keyword">= </span><span class="default">imagecolorallocatealpha</span><span class="keyword">(</span><span class="default">$image</span><span class="keyword">, </span><span class="default">$r</span><span class="keyword">, </span><span class="default">$g</span><span class="keyword">, </span><span class="default">$b</span><span class="keyword">, </span><span class="default">$a</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">imagesetpixel</span><span class="keyword">(</span><span class="default">$image</span><span class="keyword">, </span><span class="default">$x</span><span class="keyword">, </span><span class="default">$y</span><span class="keyword">, </span><span class="default">$color</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
</span><span class="default">?&gt;<br />
</span><br />
The red and blue tint issue seems to be fixed by this...</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="87651""></a>
  <div class="note">
   <strong class="user">mm</strong>
   <a href="#87651" class="date">15-Dec-2008 03:30</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
@ Scott Evernden<br />
<br />
Scott, your function works great for uncompressed TGA image files, except the results for TGA 32 with alpha don't come out right, at least in my tests. If the alpha is all white, the resulting image comes out with a red tint. If black, the resulting image has a blue tint. I don't know how to make it just ignore the alpha, but that would be handy...</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="84479""></a>
  <div class="note">
   <strong class="user">Anonymous</strong>
   <a href="#84479" class="date">16-Jul-2008 06:41</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
This snippet creates a gradient images depending on the value of RGB components. Gradients allow your page to have a shadow effect.<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">try{<br />
&nbsp;&nbsp; if(!</span><span class="default">$image</span><span class="keyword">=</span><span class="default">imagecreatetruecolor</span><span class="keyword">(</span><span class="default">50</span><span class="keyword">,</span><span class="default">10</span><span class="keyword">)){<br />
&nbsp;&nbsp; &nbsp; throw new </span><span class="default">Exception</span><span class="keyword">(</span><span class="string">'Error creating image'</span><span class="keyword">);<br />
&nbsp;&nbsp; }<br />
&nbsp;&nbsp; <br />
&nbsp;&nbsp; for(</span><span class="default">$y</span><span class="keyword">=</span><span class="default">0</span><span class="keyword">;</span><span class="default">$y</span><span class="keyword">&lt;</span><span class="default">10</span><span class="keyword">;++</span><span class="default">$y</span><span class="keyword">)<br />
&nbsp;&nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="default">$color</span><span class="keyword">=</span><span class="default">imagecolorallocate</span><span class="keyword">(</span><span class="default">$image</span><span class="keyword">, </span><span class="default">75</span><span class="keyword">+(</span><span class="default">$y</span><span class="keyword">*</span><span class="default">5</span><span class="keyword">),</span><span class="default">75</span><span class="keyword">+(</span><span class="default">$y</span><span class="keyword">*</span><span class="default">11</span><span class="keyword">),</span><span class="default">75</span><span class="keyword">+(</span><span class="default">$y</span><span class="keyword">*</span><span class="default">9</span><span class="keyword">));<br />
&nbsp;&nbsp; &nbsp;&nbsp; for(</span><span class="default">$x</span><span class="keyword">=</span><span class="default">0</span><span class="keyword">;</span><span class="default">$x</span><span class="keyword">&lt;</span><span class="default">50</span><span class="keyword">;++</span><span class="default">$x</span><span class="keyword">)<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">imagesetpixel</span><span class="keyword">(</span><span class="default">$image</span><span class="keyword">,</span><span class="default">$x</span><span class="keyword">,</span><span class="default">$y</span><span class="keyword">,</span><span class="default">$color</span><span class="keyword">); <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; }<br />
&nbsp;&nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; <br />
&nbsp;&nbsp; </span><span class="comment">//header("Content-type: image/jpeg");<br />
&nbsp;&nbsp; </span><span class="default">imagejpeg</span><span class="keyword">(</span><span class="default">$image</span><span class="keyword">,</span><span class="string">'footerShadow.jpg'</span><span class="keyword">);<br />
&nbsp;&nbsp; </span><span class="comment">// free memory<br />
&nbsp;&nbsp; </span><span class="default">imagedestroy</span><span class="keyword">(</span><span class="default">$image</span><span class="keyword">);<br />
&nbsp;&nbsp; <br />
}<br />
catch(</span><span class="default">Exception $e</span><span class="keyword">){<br />
&nbsp;&nbsp; echo </span><span class="default">$e</span><span class="keyword">-&gt;</span><span class="default">getMessage</span><span class="keyword">();<br />
&nbsp;&nbsp; exit();<br />
}<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="82901""></a>
  <div class="note">
   <strong class="user">Scott Evernden (doctor3d at gmail)</strong>
   <a href="#82901" class="date">01-May-2008 12:44</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
My last note doesn't do alpha properly, so make the following change to the appropriate lines:<br />
<br />
$r = ($word &amp; 0x7C00) &gt;&gt; 7;<br />
$g = ($word &amp; 0x03E0) &gt;&gt; 2;<br />
$b = ($word &amp; 0x001F) &lt;&lt; 3;<br />
$a = ($word &amp; 0x8000) ? 127 : 0;<br />
$color = imagecolorallocatealpha($image, $r, $g, $b, $a);<br />
imagesetpixel($image, $x, $y, $color);</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="82799""></a>
  <div class="note">
   <strong class="user">Scott Evernden (doctor3d at gmail)</strong>
   <a href="#82799" class="date">26-Apr-2008 03:25</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
here's my version of imagecreatefromtga() that's been tested to work for targa 16 .. adapted from offering by zehao dot chang at gmail dot com<br />
<br />
function imagecreatefromtga($filename)<br />
{<br />
&nbsp;&nbsp;&nbsp; $data = file_get_contents($filename);<br />
&nbsp; <br />
&nbsp;&nbsp;&nbsp; // Extract header information<br />
&nbsp;&nbsp;&nbsp; $string_length = fileint($data, 1, 1);<br />
&nbsp;&nbsp;&nbsp; $data_type = fileint($data, 2, 1);<br />
&nbsp;&nbsp;&nbsp; $width = fileint($data, 12, 2);<br />
&nbsp;&nbsp;&nbsp; $height = fileint($data, 14, 2);<br />
&nbsp;&nbsp;&nbsp; $bits_per_pixel = fileint($data, 16, 1);<br />
<br />
&nbsp;&nbsp;&nbsp; $bytes_per_pixel = (int) $bits_per_pixel / 8;<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; // Currently only supporting RGB Data type<br />
&nbsp;&nbsp;&nbsp; switch ($data_type)&nbsp; &nbsp; &nbsp; &nbsp; // Header information taken from <a href="http://astronomy.swin.edu.au/~pbourke/dataformats/tga/" rel="nofollow" target="_blank">http://astronomy.swin.edu.au/~pbourke/dataformats/tga/</a><br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; case 2:&nbsp; &nbsp;&nbsp; // Uncompressed RGB image<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; break;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; case 0:&nbsp; &nbsp;&nbsp; // No attached image data<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; case 1:&nbsp; &nbsp;&nbsp; // Uncompressed color-mapped image<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; case 3:&nbsp; &nbsp;&nbsp; // Uncompressed black and white image<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; case 9:&nbsp; &nbsp;&nbsp; // Runlength encoded color-mapped image<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; case 10:&nbsp; &nbsp; // Runlength encoded RGB image<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; case 11:&nbsp; &nbsp; // Compressed black and white image<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; case 32:&nbsp; &nbsp; // Compressed color-mapped data, using Huffman, Delta, and runlength encoding<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; case 33:&nbsp; &nbsp; // Compressed color-mapped data, using Huffman, Delta, and runlength encoding.&nbsp; 4-pass quadtree-type process<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; default:<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return NULL;&nbsp; &nbsp; // No support for any of these types<br />
&nbsp;&nbsp;&nbsp; }&nbsp; &nbsp; <br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; // Compute things we need from the header information<br />
&nbsp;&nbsp;&nbsp; $pointer = 18 + $string_length;<br />
&nbsp;&nbsp;&nbsp; $x = 0;&nbsp; $y = $height - 1;<br />
&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; $image = imagecreatetruecolor($width, $height);<br />
<br />
&nbsp;&nbsp;&nbsp; while ($pointer &lt; strlen($data))<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if ($bytes_per_pixel == 2)&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; // TARGA 16 - ARRRRRGG GGGBBBBB<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $word = fileint($data, $pointer, 2);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $r = ($word &amp; 0x7C00) &gt;&gt; 10;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $g = ($word &amp; 0x03E0) &gt;&gt; 5;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $b = ($word &amp; 0x001F);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; imagesetpixel($image, $x, $y, $r &lt;&lt; 19 | $g &lt;&lt; 11 | $b &lt;&lt; 3);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; else if ($bytes_per_pixel == 3)&nbsp; &nbsp; &nbsp; &nbsp; // TARGA 24 - RRRRRRRR GGGGGGGG BBBBBBBB<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; imagesetpixel($image, $x, $y, fileint($data, $pointer, 3));<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; else if ($bytes_per_pixel == 4)&nbsp; &nbsp; &nbsp; &nbsp; // TARGA 32 - AAAAAAAA RRRRRRRR GGGGGGGG BBBBBBBB<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; imagesetpixel($image, $x, $y, fileint($data, $pointer + 1, 3));<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if (++$x == $width)<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $y--;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $x = 0;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; $pointer += $bytes_per_pixel;<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp; <br />
&nbsp;&nbsp;&nbsp; return $image;<br />
}<br />
<br />
function fileint($data, $pos, $len)<br />
{<br />
&nbsp;&nbsp;&nbsp; return base_convert(bin2hex(strrev(substr($data, $pos, $len))), 16, 10);<br />
}</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="74488""></a>
  <div class="note">
   <strong class="user">Gusts Kaksis</strong>
   <a href="#74488" class="date">13-Apr-2007 04:29</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
This code generate a simple colortable - not a very acurate one (it would be good to define fade of color - more fading)<br />
<br />
<span class="default">&lt;?php<br />
set_time_limit</span><span class="keyword">(</span><span class="default">200</span><span class="keyword">);<br />
</span><span class="comment">/*<br />
Custommize this to see some nice changes:<br />
*/<br />
</span><span class="default">$width </span><span class="keyword">= </span><span class="default">360</span><span class="keyword">;&nbsp;&nbsp; </span><span class="comment">// degrees<br />
</span><span class="default">$height </span><span class="keyword">= </span><span class="default">18</span><span class="keyword">;&nbsp;&nbsp; </span><span class="comment">// byte<br />
</span><span class="default">$offset </span><span class="keyword">= -</span><span class="default">60</span><span class="keyword">;&nbsp; &nbsp; </span><span class="comment">// offset of color hue<br />
<br />
/*<br />
Main programm:<br />
Here comes transformations - width to degrees and height to intesity<br />
*/<br />
</span><span class="default">$w2deg </span><span class="keyword">= </span><span class="default">$width</span><span class="keyword">/</span><span class="default">360</span><span class="keyword">;<br />
</span><span class="default">$h2byte </span><span class="keyword">= </span><span class="default">$height</span><span class="keyword">/</span><span class="default">255</span><span class="keyword">;<br />
</span><span class="default">$byte2deg </span><span class="keyword">= </span><span class="default">255</span><span class="keyword">/</span><span class="default">360</span><span class="keyword">;<br />
</span><span class="default">$im </span><span class="keyword">= </span><span class="default">imagecreatetruecolor</span><span class="keyword">(</span><span class="default">$width</span><span class="keyword">,</span><span class="default">$height</span><span class="keyword">);<br />
for (</span><span class="default">$x </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">; </span><span class="default">$x </span><span class="keyword">&lt; </span><span class="default">$width</span><span class="keyword">; </span><span class="default">$x </span><span class="keyword">++){<br />
&nbsp; </span><span class="comment">/*<br />
&nbsp; Transform X to degrees<br />
&nbsp; */<br />
&nbsp; </span><span class="default">$x_pos </span><span class="keyword">= </span><span class="default">$x</span><span class="keyword">/</span><span class="default">$w2deg</span><span class="keyword">;<br />
&nbsp; </span><span class="comment">/*<br />
&nbsp; Intensity position (where max intensity is 255) on 360 degree scale.<br />
&nbsp; 0 = red<br />
&nbsp; 1 = green<br />
&nbsp; 2 = blue<br />
&nbsp; */<br />
&nbsp; </span><span class="default">$rgb_pos</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">] = </span><span class="default">sin</span><span class="keyword">(</span><span class="default">deg2rad</span><span class="keyword">(</span><span class="default">$x_pos</span><span class="keyword">) - </span><span class="default">deg2rad</span><span class="keyword">(</span><span class="default">$offset </span><span class="keyword">+ </span><span class="default">0</span><span class="keyword">));<br />
&nbsp; </span><span class="default">$rgb_pos</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">] = </span><span class="default">sin</span><span class="keyword">(</span><span class="default">deg2rad</span><span class="keyword">(</span><span class="default">$x_pos</span><span class="keyword">) - </span><span class="default">deg2rad</span><span class="keyword">(</span><span class="default">$offset </span><span class="keyword">+ </span><span class="default">120</span><span class="keyword">));<br />
&nbsp; </span><span class="default">$rgb_pos</span><span class="keyword">[</span><span class="default">2</span><span class="keyword">] = </span><span class="default">sin</span><span class="keyword">(</span><span class="default">deg2rad</span><span class="keyword">(</span><span class="default">$x_pos</span><span class="keyword">) - </span><span class="default">deg2rad</span><span class="keyword">(</span><span class="default">$offset </span><span class="keyword">+ </span><span class="default">240</span><span class="keyword">));<br />
&nbsp; </span><span class="comment">/*<br />
&nbsp; Calculate intesity at current point 0 - 255<br />
&nbsp; */<br />
&nbsp; </span><span class="default">$rgb_col</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">] = </span><span class="default">127 </span><span class="keyword">+ </span><span class="default">127 </span><span class="keyword">* </span><span class="default">$rgb_pos</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">];<br />
&nbsp; </span><span class="default">$rgb_col</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">] = </span><span class="default">127 </span><span class="keyword">+ </span><span class="default">127 </span><span class="keyword">* </span><span class="default">$rgb_pos</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">];<br />
&nbsp; </span><span class="default">$rgb_col</span><span class="keyword">[</span><span class="default">2</span><span class="keyword">] = </span><span class="default">127 </span><span class="keyword">+ </span><span class="default">127 </span><span class="keyword">* </span><span class="default">$rgb_pos</span><span class="keyword">[</span><span class="default">2</span><span class="keyword">];<br />
<br />
&nbsp; </span><span class="comment">/*<br />
&nbsp; White -&gt; color -&gt; Black loop<br />
&nbsp; */<br />
&nbsp; </span><span class="keyword">for (</span><span class="default">$y </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">; </span><span class="default">$y </span><span class="keyword">&lt; </span><span class="default">$height</span><span class="keyword">; </span><span class="default">$y </span><span class="keyword">++){<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">/*<br />
&nbsp;&nbsp;&nbsp; Transform Y to intensity (-255 to 255)<br />
&nbsp;&nbsp;&nbsp; */<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$y_pos </span><span class="keyword">= -</span><span class="default">255 </span><span class="keyword">+ (</span><span class="default">$y</span><span class="keyword">/</span><span class="default">$h2byte</span><span class="keyword">) * </span><span class="default">2</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$rgb_out</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">] = </span><span class="default">$rgb_col</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">] - </span><span class="default">$y_pos</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$rgb_out</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">] = </span><span class="default">$rgb_col</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">] - </span><span class="default">$y_pos</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$rgb_out</span><span class="keyword">[</span><span class="default">2</span><span class="keyword">] = </span><span class="default">$rgb_col</span><span class="keyword">[</span><span class="default">2</span><span class="keyword">] - </span><span class="default">$y_pos</span><span class="keyword">;<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">/*<br />
&nbsp;&nbsp;&nbsp; If we go over 255 or under 0 we normalize it<br />
&nbsp;&nbsp;&nbsp; */<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">foreach(</span><span class="default">$rgb_out </span><span class="keyword">as </span><span class="default">$key </span><span class="keyword">=&gt; </span><span class="default">$col</span><span class="keyword">){<br />
&nbsp;&nbsp; &nbsp;&nbsp; if (</span><span class="default">$col </span><span class="keyword">&gt; </span><span class="default">255</span><span class="keyword">){<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$rgb_out</span><span class="keyword">[</span><span class="default">$key</span><span class="keyword">] = </span><span class="default">255</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp;&nbsp; } else if (</span><span class="default">$col </span><span class="keyword">&lt; </span><span class="default">0</span><span class="keyword">){<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$rgb_out</span><span class="keyword">[</span><span class="default">$key</span><span class="keyword">] = </span><span class="default">0</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">/*<br />
&nbsp;&nbsp;&nbsp; Put a pixel<br />
&nbsp;&nbsp;&nbsp; */<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$col </span><span class="keyword">= </span><span class="default">imagecolorallocate</span><span class="keyword">(</span><span class="default">$im</span><span class="keyword">,</span><span class="default">$rgb_out</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">],</span><span class="default">$rgb_out</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">],</span><span class="default">$rgb_out</span><span class="keyword">[</span><span class="default">2</span><span class="keyword">]);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">imagesetpixel</span><span class="keyword">(</span><span class="default">$im</span><span class="keyword">,</span><span class="default">$x</span><span class="keyword">,</span><span class="default">$y</span><span class="keyword">,</span><span class="default">$col</span><span class="keyword">);<br />
&nbsp; }<br />
}<br />
</span><span class="comment">/*<br />
Test output<br />
*/<br />
</span><span class="default">imagejpeg</span><span class="keyword">(</span><span class="default">$im</span><span class="keyword">,</span><span class="string">'colortable.jpg'</span><span class="keyword">);<br />
echo </span><span class="string">'&lt;img src="colortable.jpg"&gt;'</span><span class="keyword">;<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="64069""></a>
  <div class="note">
   <strong class="user">zehao dot chang at gmail dot com</strong>
   <a href="#64069" class="date">06-Apr-2006 10:00</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Here's my stab at the imagecreatefromtga function. I used code from send at mail dot 2aj dot net and others below as a basis, and added support for targa 16, targa 24 and targa 32. However, I only support uncompressed RBG data type as that's the only one I need. (I removed the return_array feature since you can simply use imagesx() and imagesy() to get the image size).<br />
<br />
Please note that I have not tested this with a targa 16 since I don't have one handy at the moment.<br />
<br />
<span class="default">&lt;?php<br />
<br />
</span><span class="keyword">function </span><span class="default">imagecreatefromtga</span><span class="keyword">( </span><span class="default">$filename </span><span class="keyword">)<br />
{<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$handle </span><span class="keyword">= </span><span class="default">fopen</span><span class="keyword">( </span><span class="default">$filename</span><span class="keyword">, </span><span class="string">'rb' </span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$data </span><span class="keyword">= </span><span class="default">fread</span><span class="keyword">( </span><span class="default">$handle</span><span class="keyword">, </span><span class="default">filesize</span><span class="keyword">( </span><span class="default">$filename </span><span class="keyword">) );<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">fclose</span><span class="keyword">( </span><span class="default">$handle </span><span class="keyword">);<br />
&nbsp; <br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">// Extract header information<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$string_length </span><span class="keyword">= </span><span class="default">base_convert</span><span class="keyword">( </span><span class="default">bin2hex</span><span class="keyword">( </span><span class="default">substr</span><span class="keyword">(</span><span class="default">$data</span><span class="keyword">,</span><span class="default">1</span><span class="keyword">,</span><span class="default">1</span><span class="keyword">) ), </span><span class="default">16</span><span class="keyword">, </span><span class="default">10 </span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$data_type </span><span class="keyword">= </span><span class="default">base_convert</span><span class="keyword">( </span><span class="default">bin2hex</span><span class="keyword">( </span><span class="default">substr</span><span class="keyword">(</span><span class="default">$data</span><span class="keyword">,</span><span class="default">2</span><span class="keyword">,</span><span class="default">1</span><span class="keyword">) ), </span><span class="default">16</span><span class="keyword">, </span><span class="default">10 </span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$width </span><span class="keyword">= </span><span class="default">base_convert</span><span class="keyword">( </span><span class="default">bin2hex</span><span class="keyword">( </span><span class="default">strrev</span><span class="keyword">( </span><span class="default">substr</span><span class="keyword">(</span><span class="default">$data</span><span class="keyword">,</span><span class="default">12</span><span class="keyword">,</span><span class="default">2</span><span class="keyword">) ) ), </span><span class="default">16</span><span class="keyword">, </span><span class="default">10 </span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$height </span><span class="keyword">= </span><span class="default">base_convert</span><span class="keyword">( </span><span class="default">bin2hex</span><span class="keyword">( </span><span class="default">strrev</span><span class="keyword">( </span><span class="default">substr</span><span class="keyword">(</span><span class="default">$data</span><span class="keyword">,</span><span class="default">14</span><span class="keyword">,</span><span class="default">2</span><span class="keyword">) ) ), </span><span class="default">16</span><span class="keyword">, </span><span class="default">10 </span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$bits_per_pixel </span><span class="keyword">= </span><span class="default">base_convert</span><span class="keyword">( </span><span class="default">bin2hex</span><span class="keyword">( </span><span class="default">substr</span><span class="keyword">(</span><span class="default">$data</span><span class="keyword">,</span><span class="default">16</span><span class="keyword">,</span><span class="default">1</span><span class="keyword">) ), </span><span class="default">16</span><span class="keyword">, </span><span class="default">10 </span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">// Currenly I'm only supporting RGB Data type<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">switch( </span><span class="default">$data_type </span><span class="keyword">)&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="comment">// Header information taken from <a href="http://astronomy.swin.edu.au/~pbourke/dataformats/tga/" rel="nofollow" target="_blank">http://astronomy.swin.edu.au/~pbourke/dataformats/tga/</a><br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">{<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; case </span><span class="default">2</span><span class="keyword">:&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="comment">// Uncompressed RGB image<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">break;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; case </span><span class="default">0</span><span class="keyword">:&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="comment">// No attached image data<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">case </span><span class="default">1</span><span class="keyword">:&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="comment">// Uncompressed color-mapped image<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">case </span><span class="default">3</span><span class="keyword">:&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="comment">// Uncompressed black and white image<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">case </span><span class="default">9</span><span class="keyword">:&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="comment">// Runlength encoded color-mapped image<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">case </span><span class="default">10</span><span class="keyword">:&nbsp; &nbsp; </span><span class="comment">// Runlength encoded RGB image<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">case </span><span class="default">11</span><span class="keyword">:&nbsp; &nbsp; </span><span class="comment">// Compressed black and white image<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">case </span><span class="default">32</span><span class="keyword">:&nbsp; &nbsp; </span><span class="comment">// Compressed color-mapped data, using Huffman, Delta, and runlength encoding<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">case </span><span class="default">33</span><span class="keyword">:&nbsp; &nbsp; </span><span class="comment">// Compressed color-mapped data, using Huffman, Delta, and runlength encoding.&nbsp; 4-pass quadtree-type process<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">default:<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">NULL</span><span class="keyword">;&nbsp; &nbsp; </span><span class="comment">// No support for any of these types<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">}&nbsp; &nbsp; <br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">// Compute things we need from the header information<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$pointer </span><span class="keyword">= </span><span class="default">18 </span><span class="keyword">+ </span><span class="default">$string_length</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$bytes_per_pixel </span><span class="keyword">= (int) </span><span class="default">$bits_per_pixel</span><span class="keyword">/</span><span class="default">8</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$x </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">;&nbsp; </span><span class="default">$y </span><span class="keyword">= </span><span class="default">$height</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$image </span><span class="keyword">= </span><span class="default">imagecreatetruecolor</span><span class="keyword">(</span><span class="default">$width</span><span class="keyword">, </span><span class="default">$height</span><span class="keyword">);<br />
<br />
&nbsp;&nbsp;&nbsp; while ( </span><span class="default">$pointer </span><span class="keyword">&lt; </span><span class="default">strlen</span><span class="keyword">(</span><span class="default">$data</span><span class="keyword">) )<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if( </span><span class="default">$bytes_per_pixel </span><span class="keyword">== </span><span class="default">2 </span><span class="keyword">)&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="comment">// TARGA 16 - ARRRRRGG GGGBBBBB<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">{<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$low_byte </span><span class="keyword">= </span><span class="default">bin2hex</span><span class="keyword">( </span><span class="default">strrev</span><span class="keyword">( </span><span class="default">substr</span><span class="keyword">(</span><span class="default">$data</span><span class="keyword">, </span><span class="default">$pointer</span><span class="keyword">, </span><span class="default">$bytes_per_pixel</span><span class="keyword">)));<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$high_byte </span><span class="keyword">= </span><span class="default">bin2hex</span><span class="keyword">( </span><span class="default">strrev</span><span class="keyword">( </span><span class="default">substr</span><span class="keyword">(</span><span class="default">$data</span><span class="keyword">, </span><span class="default">$pointer</span><span class="keyword">, </span><span class="default">$bytes_per_pixel</span><span class="keyword">)));<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$r </span><span class="keyword">= </span><span class="default">base_convert</span><span class="keyword">( (</span><span class="default">$high_byte </span><span class="keyword">&amp; </span><span class="default">0x7C</span><span class="keyword">)&gt;&gt;</span><span class="default">2</span><span class="keyword">, </span><span class="default">16</span><span class="keyword">, </span><span class="default">10</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$g </span><span class="keyword">= </span><span class="default">base_convert</span><span class="keyword">( ((</span><span class="default">$high_byte </span><span class="keyword">&amp; </span><span class="default">0x03</span><span class="keyword">)&lt;&lt;</span><span class="default">3</span><span class="keyword">) | ((</span><span class="default">$low_byte </span><span class="keyword">&amp; </span><span class="default">0xE0</span><span class="keyword">)&gt;&gt;</span><span class="default">5</span><span class="keyword">), </span><span class="default">16</span><span class="keyword">, </span><span class="default">10</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$b </span><span class="keyword">= </span><span class="default">base_convert</span><span class="keyword">( </span><span class="default">$low_byte </span><span class="keyword">&amp; </span><span class="default">0x1F</span><span class="keyword">, </span><span class="default">16</span><span class="keyword">, </span><span class="default">10</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">imagesetpixel</span><span class="keyword">( </span><span class="default">$image</span><span class="keyword">, </span><span class="default">$x</span><span class="keyword">, </span><span class="default">$y</span><span class="keyword">, </span><span class="default">$r</span><span class="keyword">&lt;&lt;</span><span class="default">16 </span><span class="keyword">| </span><span class="default">$g</span><span class="keyword">&lt;&lt;</span><span class="default">8 </span><span class="keyword">| </span><span class="default">$b</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; else if( </span><span class="default">$bytes_per_pixel </span><span class="keyword">== </span><span class="default">3 </span><span class="keyword">)&nbsp; &nbsp; </span><span class="comment">// TARGA 24 - RRRRRRRR GGGGGGGG BBBBBBBB<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">{<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">imagesetpixel</span><span class="keyword">( </span><span class="default">$image</span><span class="keyword">, </span><span class="default">$x</span><span class="keyword">, </span><span class="default">$y</span><span class="keyword">, </span><span class="default">base_convert</span><span class="keyword">( </span><span class="default">bin2hex</span><span class="keyword">( </span><span class="default">strrev</span><span class="keyword">( </span><span class="default">substr</span><span class="keyword">(</span><span class="default">$data</span><span class="keyword">, </span><span class="default">$pointer</span><span class="keyword">, </span><span class="default">$bytes_per_pixel</span><span class="keyword">))), </span><span class="default">16</span><span class="keyword">, </span><span class="default">10</span><span class="keyword">));<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; else if( </span><span class="default">$bytes_per_pixel </span><span class="keyword">== </span><span class="default">4 </span><span class="keyword">)&nbsp; &nbsp; </span><span class="comment">// TARGA 32 - AAAAAAAA RRRRRRRR GGGGGGGG BBBBBBBB<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">{<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">imagesetpixel</span><span class="keyword">( </span><span class="default">$image</span><span class="keyword">, </span><span class="default">$x</span><span class="keyword">, </span><span class="default">$y</span><span class="keyword">, </span><span class="default">base_convert</span><span class="keyword">( </span><span class="default">bin2hex</span><span class="keyword">( </span><span class="default">strrev</span><span class="keyword">( </span><span class="default">substr</span><span class="keyword">(</span><span class="default">$data</span><span class="keyword">, </span><span class="default">$pointer</span><span class="keyword">, </span><span class="default">$bytes_per_pixel</span><span class="keyword">-</span><span class="default">1</span><span class="keyword">))), </span><span class="default">16</span><span class="keyword">, </span><span class="default">10</span><span class="keyword">));<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if(++</span><span class="default">$x </span><span class="keyword">== </span><span class="default">$width</span><span class="keyword">)<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$y</span><span class="keyword">--;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$x</span><span class="keyword">=</span><span class="default">0</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; </span><span class="default">$pointer </span><span class="keyword">+= </span><span class="default">$bytes_per_pixel</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp; <br />
&nbsp;&nbsp;&nbsp; return </span><span class="default">$image</span><span class="keyword">;<br />
}<br />
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="59261""></a>
  <div class="note">
   <strong class="user">T. Dekker</strong>
   <a href="#59261" class="date">30-Nov-2005 11:53</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
In reply to weitheism at gmail.com:<br />
<br />
You should probably have used ImageAlphaBlending($image, false); in your early attempts. This way any paint/fill operation replaces the alpha value of the destination.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="56249""></a>
  <div class="note">
   <strong class="user">Brian Vaughn [php at boynamedbri dot com]</strong>
   <a href="#56249" class="date">28-Aug-2005 09:00</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I looked, but was unable to find any example code to watermark an image with a watermark that contained alpha transparency. So the following class does just that. As a parameter, it takes 2 image objects: the main image, and the watermark image (which can be a gif, png, whatever) - and optionally, an alpha setting (0-100% alpha for the watermark image). It then creates and returns a new image with the alpha-transparent watermark imposed, center-aligned, over the larger image.<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">class </span><span class="default">watermark</span><span class="keyword">{<br />
<br />
&nbsp;&nbsp;&nbsp; function </span><span class="default">create_watermark</span><span class="keyword">( </span><span class="default">$dst_img</span><span class="keyword">, </span><span class="default">$watermark_img</span><span class="keyword">, </span><span class="default">$alpha </span><span class="keyword">= </span><span class="default">100 </span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$alpha&nbsp; &nbsp; </span><span class="keyword">/= </span><span class="default">100</span><span class="keyword">;&nbsp; &nbsp; </span><span class="comment"># convert 0-100% user-friendly alpha to decimal<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; # calculate our images dimensions<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$dst_img_w&nbsp; &nbsp; </span><span class="keyword">= </span><span class="default">imagesx</span><span class="keyword">( </span><span class="default">$dst_img </span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$dst_img_h&nbsp; &nbsp; </span><span class="keyword">= </span><span class="default">imagesy</span><span class="keyword">( </span><span class="default">$dst_img </span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$watermark_img_w&nbsp; &nbsp; </span><span class="keyword">= </span><span class="default">imagesx</span><span class="keyword">( </span><span class="default">$watermark_img </span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$watermark_img_h&nbsp; &nbsp; </span><span class="keyword">= </span><span class="default">imagesy</span><span class="keyword">( </span><span class="default">$watermark_img </span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment"># create new image to hold merged changes<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$return_img&nbsp; &nbsp; </span><span class="keyword">= </span><span class="default">imagecreatetruecolor</span><span class="keyword">( </span><span class="default">$dst_img_w</span><span class="keyword">, </span><span class="default">$dst_img_h </span><span class="keyword">);<br />
</span><span class="comment">#&nbsp; &nbsp; &nbsp; &nbsp; $return_img&nbsp; &nbsp; = imagecreate( $dst_img_w, $dst_img_h );<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; # determine center position coordinates<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$dst_img_min_x&nbsp; &nbsp; </span><span class="keyword">= </span><span class="default">floor</span><span class="keyword">( ( </span><span class="default">$dst_img_w </span><span class="keyword">/ </span><span class="default">2 </span><span class="keyword">) - ( </span><span class="default">$watermark_img_w </span><span class="keyword">/ </span><span class="default">2 </span><span class="keyword">) );<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$dst_img_max_x&nbsp; &nbsp; </span><span class="keyword">= </span><span class="default">ceil</span><span class="keyword">( ( </span><span class="default">$dst_img_w </span><span class="keyword">/ </span><span class="default">2 </span><span class="keyword">) + ( </span><span class="default">$watermark_img_w </span><span class="keyword">/ </span><span class="default">2 </span><span class="keyword">) );<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$dst_img_min_y&nbsp; &nbsp; </span><span class="keyword">= </span><span class="default">floor</span><span class="keyword">( ( </span><span class="default">$dst_img_h </span><span class="keyword">/ </span><span class="default">2 </span><span class="keyword">) - ( </span><span class="default">$watermark_img_h </span><span class="keyword">/ </span><span class="default">2 </span><span class="keyword">) );<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$dst_img_max_y&nbsp; &nbsp; </span><span class="keyword">= </span><span class="default">ceil</span><span class="keyword">( ( </span><span class="default">$dst_img_h </span><span class="keyword">/ </span><span class="default">2 </span><span class="keyword">) + ( </span><span class="default">$watermark_img_h </span><span class="keyword">/ </span><span class="default">2 </span><span class="keyword">) );<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment"># walk through main image<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">for( </span><span class="default">$y </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">; </span><span class="default">$y </span><span class="keyword">&lt; </span><span class="default">$dst_img_h</span><span class="keyword">; </span><span class="default">$y</span><span class="keyword">++ ) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; for( </span><span class="default">$x </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">; </span><span class="default">$x </span><span class="keyword">&lt; </span><span class="default">$dst_img_w</span><span class="keyword">; </span><span class="default">$x</span><span class="keyword">++ ) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$return_color&nbsp; &nbsp; </span><span class="keyword">= </span><span class="default">NULL</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment"># determine the correct pixel location within our watermark<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$watermark_x&nbsp; &nbsp; </span><span class="keyword">= </span><span class="default">$x </span><span class="keyword">- </span><span class="default">$dst_img_min_x</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$watermark_y&nbsp; &nbsp; </span><span class="keyword">= </span><span class="default">$y </span><span class="keyword">- </span><span class="default">$dst_img_min_y</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment"># fetch color information for both of our images<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$dst_rgb </span><span class="keyword">= </span><span class="default">imagecolorsforindex</span><span class="keyword">( </span><span class="default">$dst_img</span><span class="keyword">, </span><span class="default">imagecolorat</span><span class="keyword">( </span><span class="default">$dst_img</span><span class="keyword">, </span><span class="default">$x</span><span class="keyword">, </span><span class="default">$y </span><span class="keyword">) );<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment"># if our watermark has a non-transparent value at this pixel intersection<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; # and we're still within the bounds of the watermark image<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">if (&nbsp; &nbsp; </span><span class="default">$watermark_x </span><span class="keyword">&gt;= </span><span class="default">0 </span><span class="keyword">&amp;&amp; </span><span class="default">$watermark_x </span><span class="keyword">&lt; </span><span class="default">$watermark_img_w </span><span class="keyword">&amp;&amp;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$watermark_y </span><span class="keyword">&gt;= </span><span class="default">0 </span><span class="keyword">&amp;&amp; </span><span class="default">$watermark_y </span><span class="keyword">&lt; </span><span class="default">$watermark_img_h </span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$watermark_rbg </span><span class="keyword">= </span><span class="default">imagecolorsforindex</span><span class="keyword">( </span><span class="default">$watermark_img</span><span class="keyword">, </span><span class="default">imagecolorat</span><span class="keyword">( </span><span class="default">$watermark_img</span><span class="keyword">, </span><span class="default">$watermark_x</span><span class="keyword">, </span><span class="default">$watermark_y </span><span class="keyword">) );<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment"># using image alpha, and user specified alpha, calculate average<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$watermark_alpha&nbsp; &nbsp; </span><span class="keyword">= </span><span class="default">round</span><span class="keyword">( ( ( </span><span class="default">127 </span><span class="keyword">- </span><span class="default">$watermark_rbg</span><span class="keyword">[</span><span class="string">'alpha'</span><span class="keyword">] ) / </span><span class="default">127 </span><span class="keyword">), </span><span class="default">2 </span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$watermark_alpha&nbsp; &nbsp; </span><span class="keyword">= </span><span class="default">$watermark_alpha </span><span class="keyword">* </span><span class="default">$alpha</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment"># calculate the color 'average' between the two - taking into account the specified alpha level<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$avg_red&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="keyword">= </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">get_ave_color</span><span class="keyword">( </span><span class="default">$dst_rgb</span><span class="keyword">[</span><span class="string">'red'</span><span class="keyword">],&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$watermark_rbg</span><span class="keyword">[</span><span class="string">'red'</span><span class="keyword">],&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$watermark_alpha </span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$avg_green&nbsp; &nbsp; </span><span class="keyword">= </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">get_ave_color</span><span class="keyword">( </span><span class="default">$dst_rgb</span><span class="keyword">[</span><span class="string">'green'</span><span class="keyword">],&nbsp; &nbsp; </span><span class="default">$watermark_rbg</span><span class="keyword">[</span><span class="string">'green'</span><span class="keyword">],&nbsp; &nbsp; </span><span class="default">$watermark_alpha </span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$avg_blue&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="keyword">= </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">get_ave_color</span><span class="keyword">( </span><span class="default">$dst_rgb</span><span class="keyword">[</span><span class="string">'blue'</span><span class="keyword">],&nbsp; &nbsp; </span><span class="default">$watermark_rbg</span><span class="keyword">[</span><span class="string">'blue'</span><span class="keyword">],&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$watermark_alpha </span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment"># calculate a color index value using the average RGB values we've determined<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$return_color&nbsp; &nbsp; </span><span class="keyword">= </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">imagegetcolor</span><span class="keyword">( </span><span class="default">$return_img</span><span class="keyword">, </span><span class="default">$avg_red</span><span class="keyword">, </span><span class="default">$avg_green</span><span class="keyword">, </span><span class="default">$avg_blue </span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment"># if we're not dealing with an average color here, then let's just copy over the main color<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">} else {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$return_color&nbsp; &nbsp; </span><span class="keyword">= </span><span class="default">imagecolorat</span><span class="keyword">( </span><span class="default">$dst_img</span><span class="keyword">, </span><span class="default">$x</span><span class="keyword">, </span><span class="default">$y </span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; } </span><span class="comment"># END if watermark<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; # draw the appropriate color onto the return image<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">imagesetpixel</span><span class="keyword">( </span><span class="default">$return_img</span><span class="keyword">, </span><span class="default">$x</span><span class="keyword">, </span><span class="default">$y</span><span class="keyword">, </span><span class="default">$return_color </span><span class="keyword">);<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; } </span><span class="comment"># END for each X pixel<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">} </span><span class="comment"># END for each Y pixel<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; # return the resulting, watermarked image for display<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">return </span><span class="default">$return_img</span><span class="keyword">;<br />
<br />
&nbsp;&nbsp;&nbsp; } </span><span class="comment"># END create_watermark()<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; # average two colors given an alpha<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">function </span><span class="default">get_ave_color</span><span class="keyword">( </span><span class="default">$color_a</span><span class="keyword">, </span><span class="default">$color_b</span><span class="keyword">, </span><span class="default">$alpha </span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">round</span><span class="keyword">( ( ( </span><span class="default">$color_a </span><span class="keyword">* ( </span><span class="default">1 </span><span class="keyword">- </span><span class="default">$alpha </span><span class="keyword">) ) + ( </span><span class="default">$color_b&nbsp; &nbsp; </span><span class="keyword">* </span><span class="default">$alpha </span><span class="keyword">) ) );<br />
&nbsp;&nbsp;&nbsp; } </span><span class="comment"># END get_ave_color()<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; # return closest pallette-color match for RGB values<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">function </span><span class="default">imagegetcolor</span><span class="keyword">(</span><span class="default">$im</span><span class="keyword">, </span><span class="default">$r</span><span class="keyword">, </span><span class="default">$g</span><span class="keyword">, </span><span class="default">$b</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$c</span><span class="keyword">=</span><span class="default">imagecolorexact</span><span class="keyword">(</span><span class="default">$im</span><span class="keyword">, </span><span class="default">$r</span><span class="keyword">, </span><span class="default">$g</span><span class="keyword">, </span><span class="default">$b</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">$c</span><span class="keyword">!=-</span><span class="default">1</span><span class="keyword">) return </span><span class="default">$c</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$c</span><span class="keyword">=</span><span class="default">imagecolorallocate</span><span class="keyword">(</span><span class="default">$im</span><span class="keyword">, </span><span class="default">$r</span><span class="keyword">, </span><span class="default">$g</span><span class="keyword">, </span><span class="default">$b</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">$c</span><span class="keyword">!=-</span><span class="default">1</span><span class="keyword">) return </span><span class="default">$c</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">imagecolorclosest</span><span class="keyword">(</span><span class="default">$im</span><span class="keyword">, </span><span class="default">$r</span><span class="keyword">, </span><span class="default">$g</span><span class="keyword">, </span><span class="default">$b</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; } </span><span class="comment"># EBD imagegetcolor()<br />
<br />
</span><span class="keyword">} </span><span class="comment"># END watermark API<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="55607""></a>
  <div class="note">
   <strong class="user">weitheism at gmail.com</strong>
   <a href="#55607" class="date">08-Aug-2005 09:22</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I was looking for a way to actually DELETE pixels or squares or parts of an image from an image resource, and at first I thought imagesetpixel would do the trick. Unfortunately, it merely paints over that one pixel, and as far as I knew, php didn't have any native way of deleting sections out of your image - so this little method should take care of deleting rectangular parts of your pictures!<br />
<br />
function deleteRectangle(&amp;$oldImage,$leftX,$leftY,$rightX,$rightY)<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; // Since php has no native way of delete parts of images<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; // We have to divide the image into four different parts and then copy them manually to a new<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; // image<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $xSize = imagesx($oldImage);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $ySize = imagesy($oldImage);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; // Divides the image into four sections to copy<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $imagesection = array();<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $imagesection[] = array(0,0,$leftX,$ySize);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $imagesection[] = array($leftX,0,$rightX+1,$leftY);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $imagesection[] = array($leftX,$rightY+1,$rightX+1,$ySize);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $imagesection[] = array($rightX+1,0,$xSize,$ySize);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; // Create the new, copied image<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $newImage = imagecreatetruecolor($xSize,$ySize);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; // Vital for transparency<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; imagesavealpha($newImage,true);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; // Fills the background a transparent color<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $transparentBackground = imagecolorallocatealpha($newImage,255,255,255,127);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; imagefill($newImage,0,0,$transparentBackground);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; // Copies each of the four imagesections into their respective old positions<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; for($i = 0;$i&lt;count($imagesection);$i++)<br />
imagecopyresampled($newImage,$oldImage, $imagesection[$i][0],$imagesection[$i][1], $imagesection[$i][0],$imagesection[$i][1], $imagesection[$i][2]-$imagesection[$i][0], $imagesection[$i][3]-$imagesection[$i][1], $imagesection[$i][2]-$imagesection[$i][0], $imagesection[$i][3]-$imagesection[$i][1]);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; // Alternately you can cycle through each pixel in an image and see if that pixel is an the area<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; // but that could be more intensive<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; imagedestroy($oldImage);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; // Sets the old image equal to the new, cleared image<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $oldImage = $newImage;<br />
&nbsp;&nbsp;&nbsp; }<br />
<br />
It was made with a transparent background in mind, but you could easily change that by changeing imagecreatetruecolor to imagecreate and deleting the code that deals with transparency. Hope it helps!</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="54744""></a>
  <div class="note">
   <strong class="user">d [AT] sprid [DOT] de</strong>
   <a href="#54744" class="date">14-Jul-2005 11:28</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
This code does generate a RGB-cube (with or without borders). Because its only rendering the visible pixels its clearly fast (approx 1 up to 2 seconds). With changing the $order-variable you can see the cube from different perspectives. Entering double or tribble values (like rrg or ggg) will give you other specs of single channels. Send any sugestions to my email.<br />
<br />
<span class="default">&lt;?php<br />
$borders </span><span class="keyword">= </span><span class="default">true</span><span class="keyword">;<br />
</span><span class="default">$order&nbsp;&nbsp; </span><span class="keyword">= </span><span class="string">'rgb'</span><span class="keyword">;<br />
<br />
</span><span class="default">set_time_limit</span><span class="keyword">(</span><span class="default">0</span><span class="keyword">);<br />
</span><span class="default">$img </span><span class="keyword">= </span><span class="default">imageCreateTrueColor</span><span class="keyword">(</span><span class="default">510</span><span class="keyword">, </span><span class="default">510</span><span class="keyword">);<br />
<br />
</span><span class="default">$bg </span><span class="keyword">= </span><span class="default">imageColorAllocate</span><span class="keyword">(</span><span class="default">$img</span><span class="keyword">, </span><span class="default">255</span><span class="keyword">, </span><span class="default">255</span><span class="keyword">, </span><span class="default">255</span><span class="keyword">);<br />
</span><span class="default">$black </span><span class="keyword">= </span><span class="default">imageColorAllocate</span><span class="keyword">(</span><span class="default">$img</span><span class="keyword">, </span><span class="default">255</span><span class="keyword">, </span><span class="default">255</span><span class="keyword">, </span><span class="default">255</span><span class="keyword">);<br />
<br />
for (</span><span class="default">$r</span><span class="keyword">=</span><span class="default">0</span><span class="keyword">; </span><span class="default">$r</span><span class="keyword">&lt;</span><span class="default">256</span><span class="keyword">; </span><span class="default">$r</span><span class="keyword">++) {<br />
&nbsp; for (</span><span class="default">$g</span><span class="keyword">=</span><span class="default">0</span><span class="keyword">; </span><span class="default">$g</span><span class="keyword">&lt;</span><span class="default">256</span><span class="keyword">; </span><span class="default">$g</span><span class="keyword">++) {<br />
&nbsp;&nbsp;&nbsp; for (</span><span class="default">$b</span><span class="keyword">=</span><span class="default">0</span><span class="keyword">; </span><span class="default">$b</span><span class="keyword">&lt;</span><span class="default">256</span><span class="keyword">; </span><span class="default">$b</span><span class="keyword">++) {<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="default">$rN </span><span class="keyword">= ${</span><span class="default">$order</span><span class="keyword">{</span><span class="default">0</span><span class="keyword">}};<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="default">$gN </span><span class="keyword">= ${</span><span class="default">$order</span><span class="keyword">{</span><span class="default">1</span><span class="keyword">}};<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="default">$bN </span><span class="keyword">= ${</span><span class="default">$order</span><span class="keyword">{</span><span class="default">2</span><span class="keyword">}};<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="default">$col </span><span class="keyword">= </span><span class="default">imageColorAllocate</span><span class="keyword">(</span><span class="default">$img</span><span class="keyword">, </span><span class="default">$rN</span><span class="keyword">, </span><span class="default">$gN</span><span class="keyword">, </span><span class="default">$bN</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="default">imagesetpixel</span><span class="keyword">(</span><span class="default">$img</span><span class="keyword">, </span><span class="default">$b</span><span class="keyword">+(</span><span class="default">$r</span><span class="keyword">*</span><span class="default">0.5</span><span class="keyword">)+(</span><span class="default">255</span><span class="keyword">/</span><span class="default">4</span><span class="keyword">), </span><span class="default">$g</span><span class="keyword">+(</span><span class="default">$r</span><span class="keyword">*</span><span class="default">0.5</span><span class="keyword">)+(</span><span class="default">255</span><span class="keyword">/</span><span class="default">4</span><span class="keyword">), </span><span class="default">$col</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp;&nbsp; if (</span><span class="default">$r </span><span class="keyword">&lt; </span><span class="default">255 </span><span class="keyword">&amp;&amp; </span><span class="default">$g </span><span class="keyword">&gt; </span><span class="default">0</span><span class="keyword">) break;<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp; }<br />
&nbsp; <br />
&nbsp; if (</span><span class="default">$borders</span><span class="keyword">) {<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">imagesetpixel</span><span class="keyword">(</span><span class="default">$img</span><span class="keyword">, (</span><span class="default">$r</span><span class="keyword">*</span><span class="default">0.5</span><span class="keyword">+(</span><span class="default">255</span><span class="keyword">/</span><span class="default">4</span><span class="keyword">)), (</span><span class="default">$r</span><span class="keyword">*</span><span class="default">0.5</span><span class="keyword">)+(</span><span class="default">255</span><span class="keyword">/</span><span class="default">4</span><span class="keyword">),&nbsp; &nbsp;&nbsp; </span><span class="default">$black</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">imagesetpixel</span><span class="keyword">(</span><span class="default">$img</span><span class="keyword">, (</span><span class="default">$r</span><span class="keyword">*</span><span class="default">0.5</span><span class="keyword">)+</span><span class="default">255</span><span class="keyword">+(</span><span class="default">255</span><span class="keyword">/</span><span class="default">4</span><span class="keyword">), (</span><span class="default">$r</span><span class="keyword">*</span><span class="default">0.5</span><span class="keyword">)+(</span><span class="default">255</span><span class="keyword">/</span><span class="default">4</span><span class="keyword">), </span><span class="default">$black</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">imagesetpixel</span><span class="keyword">(</span><span class="default">$img</span><span class="keyword">, (</span><span class="default">$r</span><span class="keyword">*</span><span class="default">0.5</span><span class="keyword">)+(</span><span class="default">255</span><span class="keyword">/</span><span class="default">4</span><span class="keyword">), (</span><span class="default">$r</span><span class="keyword">*</span><span class="default">0.5</span><span class="keyword">)+</span><span class="default">255</span><span class="keyword">+(</span><span class="default">255</span><span class="keyword">/</span><span class="default">4</span><span class="keyword">), </span><span class="default">$black</span><span class="keyword">);<br />
&nbsp; }<br />
}<br />
<br />
if (</span><span class="default">$borders</span><span class="keyword">) {<br />
&nbsp; </span><span class="default">imageline</span><span class="keyword">(</span><span class="default">$img</span><span class="keyword">, </span><span class="default">255</span><span class="keyword">/</span><span class="default">4</span><span class="keyword">, </span><span class="default">255</span><span class="keyword">/</span><span class="default">4</span><span class="keyword">, </span><span class="default">255</span><span class="keyword">+(</span><span class="default">255</span><span class="keyword">/</span><span class="default">4</span><span class="keyword">), </span><span class="default">255</span><span class="keyword">/</span><span class="default">4</span><span class="keyword">, </span><span class="default">$black</span><span class="keyword">);<br />
&nbsp; </span><span class="default">imageline</span><span class="keyword">(</span><span class="default">$img</span><span class="keyword">, </span><span class="default">255</span><span class="keyword">/</span><span class="default">4</span><span class="keyword">, </span><span class="default">255</span><span class="keyword">/</span><span class="default">4</span><span class="keyword">, </span><span class="default">255</span><span class="keyword">/</span><span class="default">4</span><span class="keyword">, </span><span class="default">255</span><span class="keyword">+(</span><span class="default">255</span><span class="keyword">/</span><span class="default">4</span><span class="keyword">), </span><span class="default">$black</span><span class="keyword">);<br />
&nbsp; </span><span class="default">imageline</span><span class="keyword">(</span><span class="default">$img</span><span class="keyword">, </span><span class="default">255</span><span class="keyword">*</span><span class="default">0.5</span><span class="keyword">+(</span><span class="default">255</span><span class="keyword">/</span><span class="default">4</span><span class="keyword">), </span><span class="default">255</span><span class="keyword">*</span><span class="default">0.5</span><span class="keyword">+(</span><span class="default">255</span><span class="keyword">/</span><span class="default">4</span><span class="keyword">), </span><span class="default">255</span><span class="keyword">*</span><span class="default">0.5</span><span class="keyword">+(</span><span class="default">255</span><span class="keyword">/</span><span class="default">4</span><span class="keyword">), </span><span class="default">255</span><span class="keyword">*</span><span class="default">0.5 </span><span class="keyword">+ </span><span class="default">509</span><span class="keyword">*</span><span class="default">0.5</span><span class="keyword">+(</span><span class="default">255</span><span class="keyword">/</span><span class="default">4</span><span class="keyword">), </span><span class="default">$black</span><span class="keyword">);<br />
&nbsp; </span><span class="default">imageline</span><span class="keyword">(</span><span class="default">$img</span><span class="keyword">, </span><span class="default">255</span><span class="keyword">*</span><span class="default">0.5</span><span class="keyword">+(</span><span class="default">255</span><span class="keyword">/</span><span class="default">4</span><span class="keyword">), </span><span class="default">255</span><span class="keyword">*</span><span class="default">0.5</span><span class="keyword">+(</span><span class="default">255</span><span class="keyword">/</span><span class="default">4</span><span class="keyword">), </span><span class="default">255</span><span class="keyword">*</span><span class="default">0.5 </span><span class="keyword">+ </span><span class="default">509</span><span class="keyword">*</span><span class="default">0.5</span><span class="keyword">+(</span><span class="default">255</span><span class="keyword">/</span><span class="default">4</span><span class="keyword">), </span><span class="default">255</span><span class="keyword">*</span><span class="default">0.5</span><span class="keyword">+(</span><span class="default">255</span><span class="keyword">/</span><span class="default">4</span><span class="keyword">), </span><span class="default">$black</span><span class="keyword">);<br />
&nbsp; </span><span class="default">imageline</span><span class="keyword">(</span><span class="default">$img</span><span class="keyword">, </span><span class="default">255</span><span class="keyword">*</span><span class="default">0.5</span><span class="keyword">+(</span><span class="default">255</span><span class="keyword">/</span><span class="default">4</span><span class="keyword">), </span><span class="default">255</span><span class="keyword">*</span><span class="default">0.5 </span><span class="keyword">+ </span><span class="default">509</span><span class="keyword">*</span><span class="default">0.5</span><span class="keyword">+(</span><span class="default">255</span><span class="keyword">/</span><span class="default">4</span><span class="keyword">), </span><span class="default">255</span><span class="keyword">*</span><span class="default">0.5 </span><span class="keyword">+ </span><span class="default">509</span><span class="keyword">*</span><span class="default">0.5</span><span class="keyword">+(</span><span class="default">255</span><span class="keyword">/</span><span class="default">4</span><span class="keyword">), </span><span class="default">255</span><span class="keyword">*</span><span class="default">0.5 </span><span class="keyword">+ </span><span class="default">509</span><span class="keyword">*</span><span class="default">0.5</span><span class="keyword">+(</span><span class="default">255</span><span class="keyword">/</span><span class="default">4</span><span class="keyword">), </span><span class="default">$black</span><span class="keyword">);<br />
&nbsp; </span><span class="default">imageline</span><span class="keyword">(</span><span class="default">$img</span><span class="keyword">, </span><span class="default">255</span><span class="keyword">*</span><span class="default">0.5 </span><span class="keyword">+ </span><span class="default">509</span><span class="keyword">*</span><span class="default">0.5</span><span class="keyword">+(</span><span class="default">255</span><span class="keyword">/</span><span class="default">4</span><span class="keyword">), </span><span class="default">255</span><span class="keyword">*</span><span class="default">0.5</span><span class="keyword">+(</span><span class="default">255</span><span class="keyword">/</span><span class="default">4</span><span class="keyword">), </span><span class="default">255</span><span class="keyword">*</span><span class="default">0.5 </span><span class="keyword">+ </span><span class="default">509</span><span class="keyword">*</span><span class="default">0.5</span><span class="keyword">+(</span><span class="default">255</span><span class="keyword">/</span><span class="default">4</span><span class="keyword">), </span><span class="default">255</span><span class="keyword">*</span><span class="default">0.5 </span><span class="keyword">+ </span><span class="default">509</span><span class="keyword">*</span><span class="default">0.5</span><span class="keyword">+(</span><span class="default">255</span><span class="keyword">/</span><span class="default">4</span><span class="keyword">), </span><span class="default">$black</span><span class="keyword">);<br />
}<br />
<br />
</span><span class="default">header</span><span class="keyword">(</span><span class="string">"Content-Type: image/png"</span><span class="keyword">);<br />
</span><span class="default">imagepng</span><span class="keyword">(</span><span class="default">$img</span><span class="keyword">);<br />
</span><span class="default">imagedestroy</span><span class="keyword">(</span><span class="default">$img</span><span class="keyword">);<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="53112""></a>
  <div class="note">
   <strong class="user">bpgordon at gmail dot com</strong>
   <a href="#53112" class="date">24-May-2005 12:18</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
This code converts a block of text to an image so that each character in the block defines one pixel in the image and each line in the block (delimited by \n's) builds one whole row of pixels in the image.<br />
Usage: Place a 0 to create a white pixel. Place a 1 to create a black pixel.<br />
Example: Entering the following digits (including the line breaks) will create a 3x3 square with a 1-pixel white border.<br />
00000<br />
01110<br />
01110<br />
01110<br />
00000<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">if (isset(</span><span class="default">$_POST</span><span class="keyword">[</span><span class="string">"sendtxt"</span><span class="keyword">])) {<br />
</span><span class="default">header</span><span class="keyword">(</span><span class="string">"Content-type: image/png"</span><span class="keyword">);<br />
</span><span class="default">$splitted </span><span class="keyword">= </span><span class="default">explode</span><span class="keyword">(</span><span class="string">"\n"</span><span class="keyword">, </span><span class="default">$_POST</span><span class="keyword">[</span><span class="string">"sendtxt"</span><span class="keyword">]);<br />
foreach (</span><span class="default">$splitted </span><span class="keyword">as </span><span class="default">$tcurkey </span><span class="keyword">=&gt; </span><span class="default">$curval</span><span class="keyword">) </span><span class="default">$tsplitted</span><span class="keyword">[</span><span class="default">$tcurkey</span><span class="keyword">] = </span><span class="default">rtrim</span><span class="keyword">(</span><span class="default">$curval</span><span class="keyword">);<br />
</span><span class="default">$splitted </span><span class="keyword">= </span><span class="default">$tsplitted</span><span class="keyword">; </span><span class="comment">//referencing isn't working for some reason...<br />
</span><span class="default">$image </span><span class="keyword">= </span><span class="default">imagecreate</span><span class="keyword">(</span><span class="default">strlen</span><span class="keyword">(</span><span class="default">$splitted</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">]), </span><span class="default">count</span><span class="keyword">(</span><span class="default">$splitted</span><span class="keyword">));<br />
</span><span class="default">$white </span><span class="keyword">= </span><span class="default">imagecolorallocate</span><span class="keyword">(</span><span class="default">$image</span><span class="keyword">, </span><span class="default">0xFF</span><span class="keyword">, </span><span class="default">0xFF</span><span class="keyword">, </span><span class="default">0xFF</span><span class="keyword">); </span><span class="comment">// don't delete this line<br />
</span><span class="default">$black </span><span class="keyword">= </span><span class="default">imagecolorallocate</span><span class="keyword">(</span><span class="default">$image</span><span class="keyword">, </span><span class="default">0x00</span><span class="keyword">, </span><span class="default">0x00</span><span class="keyword">, </span><span class="default">0x00</span><span class="keyword">);<br />
foreach(</span><span class="default">$splitted </span><span class="keyword">as </span><span class="default">$curkey </span><span class="keyword">=&gt; </span><span class="default">$opelement</span><span class="keyword">) {<br />
</span><span class="default">$subsplitten </span><span class="keyword">= </span><span class="default">preg_split</span><span class="keyword">(</span><span class="string">"//"</span><span class="keyword">, </span><span class="default">$opelement</span><span class="keyword">);<br />
foreach(</span><span class="default">$subsplitten </span><span class="keyword">as </span><span class="default">$subcurkey </span><span class="keyword">=&gt; </span><span class="default">$subopelement</span><span class="keyword">) {<br />
if (</span><span class="default">$subopelement </span><span class="keyword">== </span><span class="string">"1" </span><span class="keyword">|| </span><span class="default">$subopelement </span><span class="keyword">== </span><span class="string">"."</span><span class="keyword">) </span><span class="default">imagesetpixel</span><span class="keyword">(</span><span class="default">$image</span><span class="keyword">, </span><span class="default">$subcurkey</span><span class="keyword">-</span><span class="default">1</span><span class="keyword">, </span><span class="default">$curkey</span><span class="keyword">, </span><span class="default">$black</span><span class="keyword">);<br />
}<br />
}<br />
</span><span class="default">imagepng</span><span class="keyword">(</span><span class="default">$image</span><span class="keyword">);<br />
</span><span class="default">imagedestroy</span><span class="keyword">(</span><span class="default">$image</span><span class="keyword">);<br />
} else {<br />
echo &lt;&lt;&lt;end<br />
</span><span class="string">&lt;table width="1" border="0"&gt;&lt;td&gt;<br />
&lt;form method="post" action="#"&gt;<br />
&lt;textarea cols="30" rows="7" name="sendtxt"&gt;&lt;/textarea&gt;&lt;br&gt;<br />
&lt;input type="submit" value="render"&gt;<br />
&lt;/form&gt;&lt;/td&gt;&lt;/table&gt;<br />
end; }<br />
?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="46275""></a>
  <div class="note">
   <strong class="user">odin&lt;spam inside(C)&gt;dtdm.org</strong>
   <a href="#46275" class="date">05-Oct-2004 02:36</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Just a simple implementation of the Bresenham algorythm (educational purpose....)<br />
<br />
You can find more about this and many other tutorials for gfx there: <a href="http://brand107.home.comcast.net/pc-gpe/" rel="nofollow" target="_blank">http://brand107.home.comcast.net/pc-gpe/</a><br />
<br />
<span class="default">&lt;?php<br />
<br />
</span><span class="comment">/****************************************************<br />
&nbsp;&nbsp; &nbsp; Bresenham Line Algorythm PHP/GD implementation&nbsp; <br />
****************************************************/<br />
</span><span class="keyword">function </span><span class="default">line</span><span class="keyword">(</span><span class="default">$im</span><span class="keyword">,</span><span class="default">$x1</span><span class="keyword">,</span><span class="default">$y1</span><span class="keyword">,</span><span class="default">$x2</span><span class="keyword">,</span><span class="default">$y2</span><span class="keyword">,</span><span class="default">$color</span><span class="keyword">){<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$deltax</span><span class="keyword">=</span><span class="default">abs</span><span class="keyword">(</span><span class="default">$x2</span><span class="keyword">-</span><span class="default">$x1</span><span class="keyword">); <br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$deltay</span><span class="keyword">=</span><span class="default">abs</span><span class="keyword">(</span><span class="default">$y2</span><span class="keyword">-</span><span class="default">$y1</span><span class="keyword">);<br />
<br />
&nbsp;&nbsp;&nbsp; if (</span><span class="default">$deltax</span><span class="keyword">&gt;</span><span class="default">$deltay</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; </span><span class="default">$numpixels</span><span class="keyword">=</span><span class="default">$deltax</span><span class="keyword">+</span><span class="default">1</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; </span><span class="default">$d</span><span class="keyword">=(</span><span class="default">2</span><span class="keyword">*</span><span class="default">$deltay</span><span class="keyword">)-</span><span class="default">$deltax</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; </span><span class="default">$dinc1</span><span class="keyword">=</span><span class="default">$deltay </span><span class="keyword">&lt;&lt; </span><span class="default">1</span><span class="keyword">; </span><span class="default">$dinc2</span><span class="keyword">=(</span><span class="default">$deltay</span><span class="keyword">-</span><span class="default">$deltax</span><span class="keyword">) &lt;&lt; </span><span class="default">1</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; </span><span class="default">$xinc1</span><span class="keyword">=</span><span class="default">1</span><span class="keyword">; </span><span class="default">$xinc2</span><span class="keyword">=</span><span class="default">1</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; </span><span class="default">$yinc1</span><span class="keyword">=</span><span class="default">0</span><span class="keyword">; </span><span class="default">$yinc2</span><span class="keyword">=</span><span class="default">1</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; } else {<br />
&nbsp;&nbsp; &nbsp; </span><span class="default">$numpixels</span><span class="keyword">=</span><span class="default">$deltay</span><span class="keyword">+</span><span class="default">1</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; </span><span class="default">$d</span><span class="keyword">=(</span><span class="default">2</span><span class="keyword">*</span><span class="default">$deltax</span><span class="keyword">)-</span><span class="default">$deltay</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; </span><span class="default">$dinc1</span><span class="keyword">=</span><span class="default">$deltax </span><span class="keyword">&lt;&lt; </span><span class="default">1</span><span class="keyword">; </span><span class="default">$dinc2</span><span class="keyword">=(</span><span class="default">$deltax</span><span class="keyword">-</span><span class="default">$deltay</span><span class="keyword">)&lt;&lt;</span><span class="default">1</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; </span><span class="default">$xinc1</span><span class="keyword">=</span><span class="default">0</span><span class="keyword">; </span><span class="default">$xinc2</span><span class="keyword">=</span><span class="default">1</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; </span><span class="default">$yinc1</span><span class="keyword">=</span><span class="default">1</span><span class="keyword">; </span><span class="default">$yinc2</span><span class="keyword">=</span><span class="default">1</span><span class="keyword">; <br />
&nbsp;&nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp;&nbsp; if (</span><span class="default">$x1</span><span class="keyword">&gt;</span><span class="default">$x2</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; </span><span class="default">$xinc1</span><span class="keyword">=-</span><span class="default">$xinc1</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; </span><span class="default">$xinc2</span><span class="keyword">=-</span><span class="default">$xinc2</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; } <br />
<br />
&nbsp;&nbsp;&nbsp; if (</span><span class="default">$y1</span><span class="keyword">&gt;</span><span class="default">$y2</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; </span><span class="default">$yinc1</span><span class="keyword">=-</span><span class="default">$yinc1</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; </span><span class="default">$yinc2</span><span class="keyword">=-</span><span class="default">$yinc2</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$x</span><span class="keyword">=</span><span class="default">$x1</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$y</span><span class="keyword">=</span><span class="default">$y1</span><span class="keyword">;<br />
<br />
&nbsp;&nbsp;&nbsp; for (</span><span class="default">$i</span><span class="keyword">=</span><span class="default">0</span><span class="keyword">;</span><span class="default">$i</span><span class="keyword">&lt;</span><span class="default">$numpixels</span><span class="keyword">;</span><span class="default">$i</span><span class="keyword">++) {<br />
&nbsp;&nbsp; &nbsp; </span><span class="default">imagesetpixel</span><span class="keyword">(</span><span class="default">$im</span><span class="keyword">,</span><span class="default">$x</span><span class="keyword">,</span><span class="default">$y</span><span class="keyword">,</span><span class="default">$color</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; if (</span><span class="default">$d</span><span class="keyword">&lt;</span><span class="default">0</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="default">$d</span><span class="keyword">+=</span><span class="default">$dinc1</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="default">$x</span><span class="keyword">+=</span><span class="default">$xinc1</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="default">$y</span><span class="keyword">+=</span><span class="default">$yinc1</span><span class="keyword">; <br />
&nbsp;&nbsp; &nbsp; } else {<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="default">$d</span><span class="keyword">+=</span><span class="default">$dinc2</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="default">$x</span><span class="keyword">+=</span><span class="default">$xinc2</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="default">$y</span><span class="keyword">+=</span><span class="default">$yinc2</span><span class="keyword">; <br />
&nbsp;&nbsp; &nbsp; }<br />
&nbsp;&nbsp;&nbsp; }<br />
return ;<br />
}<br />
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="45043""></a>
  <div class="note">
   <strong class="user">richard at mf2fm dot co dot uk</strong>
   <a href="#45043" class="date">24-Aug-2004 11:06</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Here is a function that takes an image ($im) and returns it with the contrast maximised...<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">function </span><span class="default">contrast</span><span class="keyword">(</span><span class="default">$im</span><span class="keyword">) {<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$brightness</span><span class="keyword">=</span><span class="default">0</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$maxb</span><span class="keyword">=</span><span class="default">0</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$minb</span><span class="keyword">=</span><span class="default">255</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$imagesize</span><span class="keyword">=</span><span class="default">getimagesize</span><span class="keyword">(</span><span class="default">$im</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$w</span><span class="keyword">=</span><span class="default">$imagesize</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">];<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$h</span><span class="keyword">=</span><span class="default">$imagesize</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">];<br />
&nbsp;&nbsp;&nbsp; for (</span><span class="default">$x</span><span class="keyword">=</span><span class="default">0</span><span class="keyword">; </span><span class="default">$x</span><span class="keyword">&lt;</span><span class="default">$w</span><span class="keyword">; </span><span class="default">$x</span><span class="keyword">++) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; for (</span><span class="default">$y</span><span class="keyword">=</span><span class="default">0</span><span class="keyword">; </span><span class="default">$y</span><span class="keyword">&lt;</span><span class="default">$h</span><span class="keyword">; </span><span class="default">$y</span><span class="keyword">++) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$rgb</span><span class="keyword">=</span><span class="default">imagecolorat</span><span class="keyword">(</span><span class="default">$im</span><span class="keyword">, </span><span class="default">$x</span><span class="keyword">, </span><span class="default">$y</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$rgb</span><span class="keyword">=</span><span class="default">imagecolorsforindex</span><span class="keyword">(</span><span class="default">$im</span><span class="keyword">, </span><span class="default">$rgb</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$grey</span><span class="keyword">=</span><span class="default">0.2125</span><span class="keyword">*</span><span class="default">$rgb</span><span class="keyword">[</span><span class="string">'red'</span><span class="keyword">]+<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">0.7154</span><span class="keyword">*</span><span class="default">$rgb</span><span class="keyword">[</span><span class="string">'green'</span><span class="keyword">]+<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">0.0721</span><span class="keyword">*</span><span class="default">$rgb</span><span class="keyword">[</span><span class="string">'blue'</span><span class="keyword">]; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$brightness</span><span class="keyword">+=</span><span class="default">$grey</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">$grey</span><span class="keyword">&gt;</span><span class="default">$maxb</span><span class="keyword">) </span><span class="default">$maxb</span><span class="keyword">=</span><span class="default">$grey</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">$grey</span><span class="keyword">&lt;</span><span class="default">$minb</span><span class="keyword">) </span><span class="default">$minb</span><span class="keyword">=</span><span class="default">$grey</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$brightness</span><span class="keyword">=</span><span class="default">$brightness</span><span class="keyword">/(</span><span class="default">$w</span><span class="keyword">*</span><span class="default">$h</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$minb</span><span class="keyword">=</span><span class="default">$brightness</span><span class="keyword">/(</span><span class="default">$brightness</span><span class="keyword">-</span><span class="default">$minb</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$maxb</span><span class="keyword">=(</span><span class="default">255</span><span class="keyword">-</span><span class="default">$brightness</span><span class="keyword">)/(</span><span class="default">$maxb</span><span class="keyword">-</span><span class="default">$brightness</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$contrast</span><span class="keyword">=</span><span class="default">min</span><span class="keyword">(</span><span class="default">$minb</span><span class="keyword">, </span><span class="default">$maxb</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; for (</span><span class="default">$x</span><span class="keyword">=</span><span class="default">0</span><span class="keyword">; </span><span class="default">$x</span><span class="keyword">&lt;</span><span class="default">$w</span><span class="keyword">; </span><span class="default">$x</span><span class="keyword">++) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; for (</span><span class="default">$y</span><span class="keyword">=</span><span class="default">0</span><span class="keyword">; </span><span class="default">$y</span><span class="keyword">&lt;</span><span class="default">$h</span><span class="keyword">; </span><span class="default">$y</span><span class="keyword">++) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$rgb</span><span class="keyword">=</span><span class="default">imagecolorat</span><span class="keyword">(</span><span class="default">$im</span><span class="keyword">, </span><span class="default">$x</span><span class="keyword">, </span><span class="default">$y</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$rgb</span><span class="keyword">=</span><span class="default">imagecolorsforindex</span><span class="keyword">(</span><span class="default">$im</span><span class="keyword">, </span><span class="default">$rgb</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">imagesetpixel</span><span class="keyword">(</span><span class="default">$im</span><span class="keyword">, </span><span class="default">$x</span><span class="keyword">, </span><span class="default">$y</span><span class="keyword">,<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">65536</span><span class="keyword">*</span><span class="default">floor</span><span class="keyword">(</span><span class="default">min</span><span class="keyword">(</span><span class="default">$rgb</span><span class="keyword">[</span><span class="string">'red'</span><span class="keyword">]*</span><span class="default">$contrast</span><span class="keyword">, </span><span class="default">255</span><span class="keyword">))+<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">256</span><span class="keyword">*</span><span class="default">floor</span><span class="keyword">(</span><span class="default">min</span><span class="keyword">(</span><span class="default">$rgb</span><span class="keyword">[</span><span class="string">'green'</span><span class="keyword">]*</span><span class="default">$contrast</span><span class="keyword">, </span><span class="default">255</span><span class="keyword">))+<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">floor</span><span class="keyword">(</span><span class="default">min</span><span class="keyword">(</span><span class="default">$rgb</span><span class="keyword">[</span><span class="string">'blue'</span><span class="keyword">]*</span><span class="default">$contrast</span><span class="keyword">, </span><span class="default">255</span><span class="keyword">)));<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; return (</span><span class="default">$im</span><span class="keyword">);<br />
}<br />
</span><span class="default">?&gt;<br />
</span><br />
An example of usage might be:<br />
<span class="default">&lt;?php<br />
$imagefile</span><span class="keyword">=</span><span class="string">"/path/filename"</span><span class="keyword">;<br />
</span><span class="default">$image</span><span class="keyword">=</span><span class="default">imagecreatefromjpeg</span><span class="keyword">(</span><span class="default">$imagefile</span><span class="keyword">);<br />
</span><span class="default">$image</span><span class="keyword">=</span><span class="default">contrast</span><span class="keyword">(</span><span class="default">$image</span><span class="keyword">);<br />
</span><span class="default">imagejpeg</span><span class="keyword">(</span><span class="default">$image</span><span class="keyword">, </span><span class="default">$imagefile</span><span class="keyword">);<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="35767""></a>
  <div class="note">
   <strong class="user">chris at drunkenpirates dot co dot uk</strong>
   <a href="#35767" class="date">14-Sep-2003 02:50</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
<span class="default">&lt;?php<br />
<br />
</span><span class="comment">/*<br />
An example combining the use of ImageColorAllocate, Imagesetpixel, Imagecopyresized and some basic Trig<br />
<br />
By chris@drunkenpirates.co.uk<br />
<br />
*/<br />
<br />
</span><span class="default">Header</span><span class="keyword">(</span><span class="string">"Content-type: image/png"</span><span class="keyword">);<br />
<br />
</span><span class="default">$height </span><span class="keyword">= </span><span class="default">128</span><span class="keyword">;<br />
</span><span class="default">$width </span><span class="keyword">= </span><span class="default">128</span><span class="keyword">;<br />
<br />
</span><span class="default">$imA </span><span class="keyword">= </span><span class="default">ImageCreate</span><span class="keyword">(</span><span class="default">$width</span><span class="keyword">, </span><span class="default">$height</span><span class="keyword">);<br />
</span><span class="default">$imB </span><span class="keyword">= </span><span class="default">ImageCreate</span><span class="keyword">(</span><span class="default">$width</span><span class="keyword">*</span><span class="default">4</span><span class="keyword">, </span><span class="default">$height</span><span class="keyword">*</span><span class="default">4</span><span class="keyword">);<br />
</span><span class="default">$bckA </span><span class="keyword">= </span><span class="default">ImageColorAllocate</span><span class="keyword">(</span><span class="default">$imA</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">);<br />
</span><span class="default">$bckB </span><span class="keyword">= </span><span class="default">ImageColorAllocate</span><span class="keyword">(</span><span class="default">$imB</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">);<br />
<br />
</span><span class="comment">//GENERATE GRAY SCALE PALLETE<br />
<br />
</span><span class="keyword">for(</span><span class="default">$c</span><span class="keyword">=</span><span class="default">0</span><span class="keyword">;</span><span class="default">$c</span><span class="keyword">&lt;</span><span class="default">256</span><span class="keyword">;</span><span class="default">$c</span><span class="keyword">++){<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">ImageColorAllocate</span><span class="keyword">(</span><span class="default">$imA</span><span class="keyword">, </span><span class="default">$c</span><span class="keyword">, </span><span class="default">$c</span><span class="keyword">, </span><span class="default">$c</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
<br />
</span><span class="comment">//PRODUCE DATA<br />
<br />
</span><span class="default">$m</span><span class="keyword">=</span><span class="default">rand</span><span class="keyword">(</span><span class="default">0</span><span class="keyword">,</span><span class="default">10</span><span class="keyword">);<br />
for(</span><span class="default">$c</span><span class="keyword">=</span><span class="default">0</span><span class="keyword">;</span><span class="default">$c</span><span class="keyword">&lt;</span><span class="default">128</span><span class="keyword">;</span><span class="default">$c</span><span class="keyword">++){<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$s</span><span class="keyword">=&nbsp; (</span><span class="default">sin</span><span class="keyword">( </span><span class="default">deg2rad</span><span class="keyword">(</span><span class="default">$c</span><span class="keyword">*</span><span class="default">360</span><span class="keyword">*</span><span class="default">$m</span><span class="keyword">/</span><span class="default">128</span><span class="keyword">) )+</span><span class="default">1</span><span class="keyword">)*</span><span class="default">127</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$col_arr</span><span class="keyword">[</span><span class="default">$c</span><span class="keyword">]=</span><span class="default">$s</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
for(</span><span class="default">$y</span><span class="keyword">=</span><span class="default">0</span><span class="keyword">;</span><span class="default">$y</span><span class="keyword">&lt;</span><span class="default">$height</span><span class="keyword">;</span><span class="default">$y</span><span class="keyword">++){<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; for(</span><span class="default">$x</span><span class="keyword">=</span><span class="default">0</span><span class="keyword">;</span><span class="default">$x</span><span class="keyword">&lt;</span><span class="default">$width</span><span class="keyword">;</span><span class="default">$x</span><span class="keyword">++){<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$imgA</span><span class="keyword">[</span><span class="default">$x</span><span class="keyword">][</span><span class="default">$y</span><span class="keyword">]=</span><span class="default">$col_arr</span><span class="keyword">[</span><span class="default">$x</span><span class="keyword">];<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
for(</span><span class="default">$y</span><span class="keyword">=</span><span class="default">0</span><span class="keyword">;</span><span class="default">$y</span><span class="keyword">&lt;</span><span class="default">$height</span><span class="keyword">;</span><span class="default">$y</span><span class="keyword">++){<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; for(</span><span class="default">$x</span><span class="keyword">=</span><span class="default">0</span><span class="keyword">;</span><span class="default">$x</span><span class="keyword">&lt;</span><span class="default">$width</span><span class="keyword">;</span><span class="default">$x</span><span class="keyword">++){<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$imgB</span><span class="keyword">[</span><span class="default">$x</span><span class="keyword">][</span><span class="default">$y</span><span class="keyword">]=</span><span class="default">$col_arr</span><span class="keyword">[</span><span class="default">$y</span><span class="keyword">];<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
<br />
</span><span class="comment">//SET PIXELS<br />
<br />
</span><span class="keyword">for(</span><span class="default">$y</span><span class="keyword">=</span><span class="default">0</span><span class="keyword">;</span><span class="default">$y</span><span class="keyword">&lt;</span><span class="default">$height</span><span class="keyword">;</span><span class="default">$y</span><span class="keyword">++){<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; for(</span><span class="default">$x</span><span class="keyword">=</span><span class="default">0</span><span class="keyword">;</span><span class="default">$x</span><span class="keyword">&lt;</span><span class="default">$width</span><span class="keyword">;</span><span class="default">$x</span><span class="keyword">++){<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$imgC</span><span class="keyword">[</span><span class="default">$x</span><span class="keyword">][</span><span class="default">$y</span><span class="keyword">]=</span><span class="default">$imgA</span><span class="keyword">[</span><span class="default">$x</span><span class="keyword">][</span><span class="default">$y</span><span class="keyword">]+</span><span class="default">$imgB</span><span class="keyword">[</span><span class="default">$x</span><span class="keyword">][</span><span class="default">$y</span><span class="keyword">];<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$s</span><span class="keyword">=</span><span class="default">$imgC</span><span class="keyword">[</span><span class="default">$x</span><span class="keyword">][</span><span class="default">$y</span><span class="keyword">]/</span><span class="default">2</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">Imagesetpixel</span><span class="keyword">(</span><span class="default">$imA</span><span class="keyword">,</span><span class="default">$x</span><span class="keyword">,</span><span class="default">$y</span><span class="keyword">,</span><span class="default">$s</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
<br />
</span><span class="comment">//RESIZE IMAGE FOR DISPLAY<br />
<br />
</span><span class="default">Imagecopyresized </span><span class="keyword">(</span><span class="default">$imB</span><span class="keyword">, </span><span class="default">$imA</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">$width</span><span class="keyword">*</span><span class="default">4</span><span class="keyword">, </span><span class="default">$height</span><span class="keyword">*</span><span class="default">4</span><span class="keyword">, </span><span class="default">$width</span><span class="keyword">, </span><span class="default">$width</span><span class="keyword">);<br />
</span><span class="default">ImagePNG</span><span class="keyword">(</span><span class="default">$imB</span><span class="keyword">);<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="21922""></a>
  <div class="note">
   <strong class="user">dino at nordmark dot dk</strong>
   <a href="#21922" class="date">31-May-2002 01:28</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
The example above diden't work, because of some errors.<br />
This should work and it's also faster because there is only one 512*512 loop. (but it is still very slow)<br />
<br />
&lt;?<br />
$filename="lena.raw";<br />
$width=512;<br />
$height=512;<br />
$fp=fopen($filename, "r");<br />
$contents=fread($fp,filesize($filename));<br />
fclose($fp);<br />
<br />
$image=imagecreate($width,$height);<br />
<br />
// create greyscale palette because the image is limited to 256 colors<br />
for ($i=0;$i&lt;256;$i++){ ImageColorAllocate($image,$i,$i,$i);}<br />
<br />
// This is slow, but probably the only way<br />
for ($i=0;$i&lt;512;$i++){<br />
&nbsp;&nbsp; for ($j=0;$j&lt;512;$j++){&nbsp; &nbsp; <br />
&nbsp;&nbsp; imagesetpixel ($image,$i,$j,ord($contents[$i+$j*512]));<br />
&nbsp;&nbsp; }<br />
}<br />
<br />
imagepng($image,"result.png");<br />
imagedestroy($image);<br />
<br />
echo "&lt;img src=result.png&gt;&lt;/img&gt;";<br />
?&gt;<br />
<br />
--<br />
<br />
Dino Patti</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
</div>
</div>
<hr /><div class="manualnavbar" style="text-align: center;">
 <div class="prev" style="text-align: left; float: left;"><a href="function.imagesetinterpolation.html">imagesetinterpolation</a></div>
 <div class="next" style="text-align: right; float: right;"><a href="function.imagesetstyle.html">imagesetstyle</a></div>
 <div class="up"><a href="ref.image.html">GD および Image 関数</a></div>
 <div class="home"><a href="index.html">PHP Manual</a></div>
</div></body></html>
