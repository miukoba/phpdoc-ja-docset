<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
 <head>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <title>ネットワーク 関数</title>
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <link media="all" rel="stylesheet" type="text/css" href="style.css"/>
 </head>
 <body class="docs"><div class="manualnavbar" style="text-align: center;">
 <div class="prev" style="text-align: left; float: left;"><a href="network.constants.html">定義済み定数</a></div>
 <div class="next" style="text-align: right; float: right;"><a href="function.checkdnsrr.html">checkdnsrr</a></div>
 <div class="up"><a href="book.network.html">ネットワーク</a></div>
 <div class="home"><a href="index.html">PHP Manual</a></div>
</div><hr /><div id="ref.network" class="reference">
 <h1 class="title">ネットワーク 関数</h1>

 







































































































































































































































































<h2>目次</h2><ul class="chunklist chunklist_reference"><li><a href="function.checkdnsrr.html">checkdnsrr</a> — 指定したインターネットホスト名もしくは IP アドレスに対応する DNS レコードを検索する</li><li><a href="function.closelog.html">closelog</a> — システムログへの接続を閉じる</li><li><a href="function.define-syslog-variables.html">define_syslog_variables</a> — syslog に関係する全ての定数を初期化する</li><li><a href="function.dns-check-record.html">dns_check_record</a> — checkdnsrr のエイリアス</li><li><a href="function.dns-get-mx.html">dns_get_mx</a> — getmxrr のエイリアス</li><li><a href="function.dns-get-record.html">dns_get_record</a> — ホスト名に関連する DNS リソースレコードを取得する</li><li><a href="function.fsockopen.html">fsockopen</a> — インターネット接続もしくは Unix ドメインソケット接続をオープンする</li><li><a href="function.gethostbyaddr.html">gethostbyaddr</a> — 指定した IP アドレスに対応するインターネットホスト名を取得する</li><li><a href="function.gethostbyname.html">gethostbyname</a> — インターネットホスト名に対応するIPv4アドレスを取得する</li><li><a href="function.gethostbynamel.html">gethostbynamel</a> — 指定したインターネットホスト名に対応するIPv4アドレスのリストを取得する</li><li><a href="function.gethostname.html">gethostname</a> — ホスト名を取得する</li><li><a href="function.getmxrr.html">getmxrr</a> — 指定したインターネットホスト名に対応する MX レコードを取得する</li><li><a href="function.getprotobyname.html">getprotobyname</a> — プロトコル名のプロトコル番号を得る</li><li><a href="function.getprotobynumber.html">getprotobynumber</a> — プロトコル番号が指すプロトコル名を取得する</li><li><a href="function.getservbyname.html">getservbyname</a> — インターネットサービスおよびプロトコルが関連するポート番号を取得する</li><li><a href="function.getservbyport.html">getservbyport</a> — ポートおよびプロトコルに対応するインターネットサービスを得る</li><li><a href="function.header-register-callback.html">header_register_callback</a> — ヘッダ用の関数を登録する</li><li><a href="function.header-remove.html">header_remove</a> — 以前に設定したHTTPヘッダを削除する</li><li><a href="function.header.html">header</a> — 生の HTTP ヘッダを送信する</li><li><a href="function.headers-list.html">headers_list</a> — 送信した (もしくは送信される予定の) レスポンスヘッダの一覧を返す</li><li><a href="function.headers-sent.html">headers_sent</a> — ヘッダが既に送信されているかどうかを調べる</li><li><a href="function.http-response-code.html">http_response_code</a> — HTTP レスポンスコードを取得または設定</li><li><a href="function.inet-ntop.html">inet_ntop</a> — パックされたインターネットアドレスを、人間が読める形式に変換する</li><li><a href="function.inet-pton.html">inet_pton</a> — 人間が読める形式の IP アドレスを、パックされた in_addr 形式に変換する</li><li><a href="function.ip2long.html">ip2long</a> — ドット表記の (IPv4) IP アドレスを、適切なアドレスに変換する</li><li><a href="function.long2ip.html">long2ip</a> — (IPv4) インターネットアドレスをインターネット標準ドット表記に変換する</li><li><a href="function.openlog.html">openlog</a> — システムのロガーへの接続をオープンする</li><li><a href="function.pfsockopen.html">pfsockopen</a> — 持続的な Internet または Unix ドメインソケット接続をオープンする</li><li><a href="function.setcookie.html">setcookie</a> — クッキーを送信する</li><li><a href="function.setrawcookie.html">setrawcookie</a> — 値を URL エンコードせずにクッキーを送信する</li><li><a href="function.socket-get-status.html">socket_get_status</a> — stream_get_meta_data のエイリアス</li><li><a href="function.socket-set-blocking.html">socket_set_blocking</a> — stream_set_blocking のエイリアス</li><li><a href="function.socket-set-timeout.html">socket_set_timeout</a> — stream_set_timeout のエイリアス</li><li><a href="function.syslog.html">syslog</a> — システムログのメッセージを生成する</li></ul>
</div>
<div id="usernotes">
 <div class="head">
  <h3 class="title">User Contributed Notes</h3>
 </div>
<div id="allnotes">  <a name="75922""></a>
  <div class="note">
   <strong class="user">David GASTALDIN</strong>
   <a href="#75922" class="date">21-Jun-2007 05:12</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Here a IP-Range to CIDRs function that I wrote for the purpose of filling my Postfix client.cidr with ripe-ncc data to block spamming from useless countries. Strcmp functions are meant to work around the silly PHP string comparison which inevitably tries compare strings as numbers when possible. I'll make no comment about that fact ... bit I have to bite my tong hard :<br />
<br />
function PlageVersCIDRs($ip_min, $ip_max) {<br />
&nbsp;&nbsp;&nbsp; $cidrs = array();<br />
&nbsp;&nbsp;&nbsp; $ip_min_bin = sprintf('%032b', $ip_min);<br />
&nbsp;&nbsp;&nbsp; $ip_max_bin = sprintf('%032b', $ip_max);<br />
&nbsp;&nbsp;&nbsp; $ip_cour_bin = $ip_min_bin;<br />
&nbsp;&nbsp;&nbsp; while (strcmp($ip_cour_bin, $ip_max_bin) &lt;= 0) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $lng_reseau = 32;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $ip_reseau_bin = $ip_cour_bin;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; while (($ip_cour_bin[$lng_reseau - 1] == '0') &amp;&amp; (strcmp(substr_replace($ip_reseau_bin, '1', $lng_reseau - 1, 1), $ip_max_bin) &lt;= 0)) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $ip_reseau_bin[$lng_reseau - 1] = '1';<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $lng_reseau--;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $cidrs[] = long2ip(bindec($ip_cour_bin)).'/'.$lng_reseau;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $ip_cour_bin = sprintf('%032b', bindec($ip_reseau_bin) + 1);<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; return $cidrs;<br />
}</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="74656""></a>
  <div class="note">
   <strong class="user">claudiu at cnixs dot com</strong>
   <a href="#74656" class="date">22-Apr-2007 11:52</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
A simple and very fast function to check against CIDR.<br />
<br />
Your previous examples are too complicated and involves a lot of functions call.<br />
<br />
Here it is (only with arithmetic operators and call only to ip2long () and split() ):<br />
<span class="default">&lt;?php<br />
&nbsp; </span><span class="keyword">function </span><span class="default">ipCIDRCheck </span><span class="keyword">(</span><span class="default">$IP</span><span class="keyword">, </span><span class="default">$CIDR</span><span class="keyword">) {<br />
&nbsp;&nbsp;&nbsp; list (</span><span class="default">$net</span><span class="keyword">, </span><span class="default">$mask</span><span class="keyword">) = </span><span class="default">split </span><span class="keyword">(</span><span class="string">"/"</span><span class="keyword">, </span><span class="default">$CIDR</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$ip_net </span><span class="keyword">= </span><span class="default">ip2long </span><span class="keyword">(</span><span class="default">$net</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$ip_mask </span><span class="keyword">= ~((</span><span class="default">1 </span><span class="keyword">&lt;&lt; (</span><span class="default">32 </span><span class="keyword">- </span><span class="default">$mask</span><span class="keyword">)) - </span><span class="default">1</span><span class="keyword">);<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$ip_ip </span><span class="keyword">= </span><span class="default">ip2long </span><span class="keyword">(</span><span class="default">$IP</span><span class="keyword">);<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$ip_ip_net </span><span class="keyword">= </span><span class="default">$ip_ip </span><span class="keyword">&amp; </span><span class="default">$ip_mask</span><span class="keyword">;<br />
<br />
&nbsp;&nbsp;&nbsp; return (</span><span class="default">$ip_ip_net </span><span class="keyword">== </span><span class="default">$ip_net</span><span class="keyword">);<br />
&nbsp; }<br />
</span><span class="default">?&gt;<br />
</span>call example: <span class="default">&lt;?php </span><span class="keyword">echo </span><span class="default">ipCheck </span><span class="keyword">(</span><span class="string">"192.168.1.23"</span><span class="keyword">, </span><span class="string">"192.168.1.0/24"</span><span class="keyword">); </span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="64152""></a>
  <div class="note">
   <strong class="user">dand at ddchosting.com</strong>
   <a href="#64152" class="date">08-Apr-2006 11:28</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
When I was working on a project I ran into this problem with redirecting. My solution is as follows:<br />
header("Refresh: 5; url=../main/main.php?".session_id()."");<br />
<br />
This allowed me to pass the session_id() which is used throughout site to make sure user has loged in. <br />
I hope this helps!</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="55230""></a>
  <div class="note">
   <strong class="user">metator at netcabo dot pt</strong>
   <a href="#55230" class="date">28-Jul-2005 05:22</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Regarding samuele's note:<br />
<br />
You can get faster code if you apply directly what happens in&nbsp; network devices, such as routers. If you AND (logic operation) the remote ip against the local netmask the result will be the network ip if the remote ip is from the local network. Example:<br />
<br />
&nbsp;&nbsp;&nbsp; 192.168.0.16 = 11000000.10101000.00000000.00010000<br />
&amp; 255.255.255.0 = 11111111.11111111.11111111.00000000<br />
--------------------------------------------------------------<br />
&nbsp;&nbsp; 192.168.0.0 = 11000000.10101000.00000000.00000000<br />
<br />
And now the code. My example uses a html form where you place the values you want to test:<br />
<br />
&lt;HTML&gt;&lt;HEAD&gt;&lt;TITLE&gt;Check IP&lt;/TITLE&gt;<br />
&lt;/HEAD&gt;&lt;BODY&gt;<br />
&nbsp;&nbsp;&nbsp; &lt;form action="<span class="default">&lt;?php </span><span class="keyword">echo </span><span class="default">$_SERVER</span><span class="keyword">[</span><span class="string">'PHP_SELF'</span><span class="keyword">]; </span><span class="default">?&gt;</span>" method="POST"&gt;<br />
<br />
Hope you find this useful.<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; IP to check: &lt;input type="text" name="ip"&gt; &lt;br&gt;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; Local network ip: &lt;input type="text" name="net"&gt; &lt;br&gt;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; Local netmask: &lt;input type="text" name="mask"&gt; &lt;br&gt;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; &lt;input type="submit" name="check" value="Check it!"&gt;<br />
&nbsp;&nbsp;&nbsp; &lt;/form&gt;<br />
&nbsp;&nbsp;&nbsp; <span class="default">&lt;?php<br />
<br />
</span><span class="comment">/**<br />
&nbsp;* @param string $ip IP to check in dotted decimal format<br />
&nbsp;* @param string $net Network IP in dotted decimal format<br />
&nbsp;* @param string $mask Netmask in dotted decimal format<br />
&nbsp;* @returns true if the ip belongs to the network, false otherwise<br />
&nbsp;**/<br />
</span><span class="keyword">function </span><span class="default">isIPIn</span><span class="keyword">(</span><span class="default">$ip</span><span class="keyword">, </span><span class="default">$net</span><span class="keyword">, </span><span class="default">$mask</span><span class="keyword">) {<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">//doesn't check for the return value of ip2long<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$ip </span><span class="keyword">= </span><span class="default">ip2long</span><span class="keyword">(</span><span class="default">$_POST</span><span class="keyword">[</span><span class="string">'ip'</span><span class="keyword">]);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$rede </span><span class="keyword">= </span><span class="default">ip2long</span><span class="keyword">(</span><span class="default">$_POST</span><span class="keyword">[</span><span class="string">'net'</span><span class="keyword">]);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$mask </span><span class="keyword">= </span><span class="default">ip2long</span><span class="keyword">(</span><span class="default">$_POST</span><span class="keyword">[</span><span class="string">'mask'</span><span class="keyword">]);<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">//AND <br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$res </span><span class="keyword">= </span><span class="default">$ip </span><span class="keyword">&amp; </span><span class="default">$mask</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; return (</span><span class="default">$res </span><span class="keyword">== </span><span class="default">$rede</span><span class="keyword">);<br />
}<br />
<br />
if (isset(</span><span class="default">$_POST</span><span class="keyword">[</span><span class="string">'check'</span><span class="keyword">])) {<br />
&nbsp;&nbsp; &nbsp; echo </span><span class="default">isIPIn</span><span class="keyword">(</span><span class="default">$_POST</span><span class="keyword">[</span><span class="string">'ip'</span><span class="keyword">], </span><span class="default">$_POST</span><span class="keyword">[</span><span class="string">'net'</span><span class="keyword">], </span><span class="default">$_POST</span><span class="keyword">[</span><span class="string">'mask'</span><span class="keyword">]) ? </span><span class="string">"IP IN."</span><span class="keyword">: </span><span class="string">"IP OUT."</span><span class="keyword">;<br />
}<br />
&nbsp;</span><span class="default">?&gt;<br />
</span>&lt;/BODY&gt;&lt;HTML&gt;</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="50337""></a>
  <div class="note">
   <strong class="user">nexxer at rogers dot com</strong>
   <a href="#50337" class="date">25-Feb-2005 02:16</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
In Trevor Hemsley's translation of the perl range2cidr function, the <br />
<br />
while ($end &gt; $start) <br />
<br />
condition should be<br />
<br />
while ($end &gt;= $start)<br />
<br />
otherwise it won't work for /32s, ie if you feed range2cidr("1.2.3.4", "1.2.3.4").<br />
<br />
-- nex</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="37753""></a>
  <div class="note">
   <strong class="user">samuele at norsam dot org</strong>
   <a href="#37753" class="date">25-Nov-2003 06:01</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
To find if an IP is in a net/mask (very fast):<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">function </span><span class="default">isIPIn</span><span class="keyword">(</span><span class="default">$ip</span><span class="keyword">,</span><span class="default">$net</span><span class="keyword">,</span><span class="default">$mask</span><span class="keyword">) {<br />
&nbsp;&nbsp; </span><span class="default">$lnet</span><span class="keyword">=</span><span class="default">ip2long</span><span class="keyword">(</span><span class="default">$net</span><span class="keyword">);<br />
&nbsp;&nbsp; </span><span class="default">$lip</span><span class="keyword">=</span><span class="default">ip2long</span><span class="keyword">(</span><span class="default">$ip</span><span class="keyword">);<br />
&nbsp;&nbsp; </span><span class="default">$binnet</span><span class="keyword">=</span><span class="default">str_pad</span><span class="keyword">( </span><span class="default">decbin</span><span class="keyword">(</span><span class="default">$lnet</span><span class="keyword">),</span><span class="default">32</span><span class="keyword">,</span><span class="string">"0"</span><span class="keyword">,</span><span class="string">"STR_PAD_LEFT" </span><span class="keyword">);<br />
&nbsp;&nbsp; </span><span class="default">$firstpart</span><span class="keyword">=</span><span class="default">substr</span><span class="keyword">(</span><span class="default">$binnet</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">,</span><span class="default">$mask</span><span class="keyword">);<br />
&nbsp;&nbsp; </span><span class="default">$binip</span><span class="keyword">=</span><span class="default">str_pad</span><span class="keyword">( </span><span class="default">decbin</span><span class="keyword">(</span><span class="default">$lip</span><span class="keyword">),</span><span class="default">32</span><span class="keyword">,</span><span class="string">"0"</span><span class="keyword">,</span><span class="string">"STR_PAD_LEFT" </span><span class="keyword">);<br />
&nbsp;&nbsp; </span><span class="default">$firstip</span><span class="keyword">=</span><span class="default">substr</span><span class="keyword">(</span><span class="default">$binip</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">,</span><span class="default">$mask</span><span class="keyword">);<br />
&nbsp;&nbsp; return(</span><span class="default">strcmp</span><span class="keyword">(</span><span class="default">$firstpart</span><span class="keyword">,</span><span class="default">$firstip</span><span class="keyword">)==</span><span class="default">0</span><span class="keyword">);<br />
&nbsp;&nbsp; }<br />
</span><span class="default">?&gt;<br />
</span><br />
This function can be compacted, avoiding some variable settings, but the function will not be too clear to read...<br />
Example code, used to made a kind of location service network-based:<br />
<br />
<span class="default">&lt;?php<br />
$n </span><span class="keyword">= array ( </span><span class="string">"192.168.0.0/16"&nbsp;&nbsp; </span><span class="keyword">=&gt; </span><span class="string">"TUSCANY"</span><span class="keyword">,<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="string">"192.168.1.0/24"&nbsp;&nbsp; </span><span class="keyword">=&gt; </span><span class="string">"- Florence"</span><span class="keyword">,<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="string">"192.168.2.0/24"&nbsp;&nbsp; </span><span class="keyword">=&gt; </span><span class="string">"- Pisa"</span><span class="keyword">,<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="string">"192.168.3.0/24"&nbsp;&nbsp; </span><span class="keyword">=&gt; </span><span class="string">"- Siena"</span><span class="keyword">,<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="string">"192.168.64.0/21" </span><span class="keyword">=&gt; </span><span class="string">"- Tuscan Archipelago"</span><span class="keyword">,<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="string">"192.168.64.0/23" </span><span class="keyword">=&gt; </span><span class="string">"--- Elba Island"</span><span class="keyword">,<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="string">"192.168.66.0/24" </span><span class="keyword">=&gt; </span><span class="string">"--- Capraia Island"</span><span class="keyword">,<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="string">"192.168.67.0/24" </span><span class="keyword">=&gt; </span><span class="string">"--- Giannutri Island"</span><span class="keyword">);<br />
<br />
</span><span class="comment">// Normally you should use the following line<br />
</span><span class="default">$myip </span><span class="keyword">= </span><span class="default">$HTTP_SERVER_VARS</span><span class="keyword">[</span><span class="string">'REMOTE_ADDR'</span><span class="keyword">];<br />
</span><span class="comment">// This is first example: returns Tuscany/Pisa<br />
</span><span class="default">$myip </span><span class="keyword">= </span><span class="string">"192.168.2.33"</span><span class="keyword">;<br />
</span><span class="comment">// This is second example: returns Tuscany/T.Arch./Elba<br />
</span><span class="default">$myip </span><span class="keyword">= </span><span class="string">"192.168.65.34"</span><span class="keyword">;<br />
<br />
echo </span><span class="string">"Your position:&lt;br /&gt;\n"</span><span class="keyword">;<br />
foreach ( </span><span class="default">$n </span><span class="keyword">as </span><span class="default">$k</span><span class="keyword">=&gt;</span><span class="default">$v </span><span class="keyword">) {<br />
&nbsp;&nbsp; list(</span><span class="default">$net</span><span class="keyword">,</span><span class="default">$mask</span><span class="keyword">)=</span><span class="default">split</span><span class="keyword">(</span><span class="string">"/"</span><span class="keyword">,</span><span class="default">$k</span><span class="keyword">);<br />
&nbsp;&nbsp; if (</span><span class="default">isIPIn</span><span class="keyword">(</span><span class="default">$myip</span><span class="keyword">,</span><span class="default">$net</span><span class="keyword">,</span><span class="default">$mask</span><span class="keyword">)) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; echo </span><span class="default">$n</span><span class="keyword">[</span><span class="default">$k</span><span class="keyword">].</span><span class="string">"&lt;br /&gt;\n"</span><span class="keyword">; }<br />
&nbsp;&nbsp; }<br />
</span><span class="default">?&gt;<br />
</span><br />
and so on...</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="34797""></a>
  <div class="note">
   <strong class="user">anderson at piq dot com dot br</strong>
   <a href="#34797" class="date">07-Aug-2003 07:10</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If you want to get the interface of an IP, based on the local route table, use this.<br />
<br />
function GetIfaceforIP($user_ip)<br />
{<br />
&nbsp;&nbsp;&nbsp; $route = "/bin/netstat -rn";<br />
<br />
&nbsp;&nbsp;&nbsp; exec($route, $aoutput);<br />
&nbsp;&nbsp;&nbsp; foreach($aoutput as $key =&gt; $line)<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if($key &gt; 1)<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $line = ereg_replace("[[:space:]]+",",",$line);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; list($network, $gateway, $mask, $flags, $mss, $window, $irtt, $iface) = explode(",", $line)<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if((ip2long($user_ip) &amp; ip2long($mask)) == ip2long($network))<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return $iface;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; }<br />
}</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="30910""></a>
  <div class="note">
   
   <a href="#30910" class="date">03-Apr-2003 05:11</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Alternative cidr_conv function - a little easier to follow<br />
<br />
function cidr_conv($cidr_address) {<br />
&nbsp; $first = substr($cidr_address, 0, strpos($cidr_address, "/"));<br />
&nbsp; $netmask = substr(strstr($cidr_address, "/"), 1);<br />
<br />
&nbsp; $first_bin = str_pad(decbin(ip2long($first)), 32, "0", STR_PAD_LEFT);<br />
&nbsp; $netmask_bin = str_pad(str_repeat("1", (integer)$netmask), 32, "0", STR_PAD_RIGHT);<br />
&nbsp; <br />
&nbsp; for ($i = 0; $i &lt; 32; $i++) {<br />
&nbsp;&nbsp;&nbsp; if ($netmask_bin[$i] == "1") <br />
&nbsp;&nbsp; &nbsp;&nbsp; $last_bin .= $first_bin[$i];<br />
&nbsp;&nbsp;&nbsp; else<br />
&nbsp;&nbsp; &nbsp;&nbsp; $last_bin .= "1";<br />
&nbsp; }<br />
<br />
&nbsp; $last = long2ip(bindec($last_bin));<br />
<br />
&nbsp; return "$first - $last";<br />
}</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="26063""></a>
  <div class="note">
   <strong class="user">trevor-hemsley at nospam dot dial dot pipex dot com</strong>
   <a href="#26063" class="date">16-Oct-2002 08:53</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Previous example of IP range to CIDR list does not cope with ranges as well as the perl Net::Netmask range2cidrlist() function. In PHP this looks like<br />
<br />
&lt;?<br />
function imask($this)<br />
{<br />
// use base_convert not dechex because dechex is broken and returns 0x80000000 instead of 0xffffffff<br />
return base_convert((pow(2,32) - pow(2, (32-$this)))), 10, 16);<br />
}<br />
<br />
function imaxblock($ibase, $tbit)<br />
{<br />
while ($tbit &gt; 0)<br />
{<br />
$im = hexdec(imask($tbit-1));<br />
$imand = $ibase &amp; $im;<br />
if ($imand != $ibase)<br />
{<br />
break;<br />
}<br />
$tbit--;<br />
}<br />
return $tbit;<br />
}<br />
<br />
function range2cidrlist($istart, $iend)<br />
{<br />
// this function returns an array of cidr lists that map the range given<br />
$s = explode(".", $istart);<br />
// PHP ip2long does not handle leading zeros on IP addresses! 172.016 comes back as 172.14, seems to be treated as octal!<br />
$start = "";<br />
$dot = "";<br />
while (list($key,$val) = each($s))<br />
{<br />
$start = sprintf("%s%s%d",$start,$dot,$val);<br />
$dot = ".";<br />
}<br />
$end = "";<br />
$dot = "";<br />
$e = explode(".",$iend);<br />
while (list($key,$val) = each($e))<br />
{<br />
$end = sprintf("%s%s%d",$end,$dot,$val);<br />
$dot = ".";<br />
}<br />
$start = ip2long($start);<br />
$end = ip2long($end);<br />
$result = array();<br />
while ($end &gt; $start)<br />
{<br />
$maxsize = imaxblock($start,32);<br />
$x = log($end - $start + 1)/log(2);<br />
$maxdiff = floor(32 - floor($x));<br />
$ip = long2ip($start);<br />
if ($maxsize &lt; $maxdiff)<br />
{<br />
$maxsize = $maxdiff;<br />
}<br />
array_push($result,"$ip/$maxsize");<br />
$start += pow(2, (32-$maxsize));<br />
}<br />
return $result;<br />
}<br />
?&gt;</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="25958""></a>
  <div class="note">
   <strong class="user">philippe-at-cyberabuse.org</strong>
   <a href="#25958" class="date">13-Oct-2002 12:49</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
... and this one will do the opposite (o return NULL for invalid netblocks) :<br />
<br />
1.0.0.0 1.0.255.255 -&gt; 1.0.0.0/16<br />
1.0.0.0 1.3.255.255 -&gt; 1.0.0.0/14<br />
192.168.0.0 192.168.0.255 -&gt; 192.168.0.0/24<br />
<br />
function ip2cidr($ip_start,$ip_end) {<br />
if(long2ip(ip2long($ip_start))!=$ip_start or long2ip(ip2long($ip_end))!=$ip_end) return NULL; <br />
$ipl_start=(int)ip2long($ip_start);<br />
$ipl_end=(int)ip2long($ip_end);<br />
if($ipl_start&gt;0 &amp;&amp; $ipl_end&lt;0) $delta=($ipl_end+4294967296)-$ipl_start;<br />
else $delta=$ipl_end-$ipl_start;<br />
$netmask=str_pad(decbin($delta),32,"0","STR_PAD_LEFT");<br />
if(ip2long($ip_start)==0 &amp;&amp; substr_count($netmask,"1")==32) return "0.0.0.0/0";<br />
if($delta&lt;0 or ($delta&gt;0 &amp;&amp; $delta%2==0)) return NULL;<br />
for($mask=0;$mask&lt;32;$mask++) if($netmask[$mask]==1) break;<br />
if(substr_count($netmask,"0")!=$mask) return NULL;<br />
return "$ip_start/$mask";<br />
}</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="17580""></a>
  <div class="note">
   <strong class="user">philippe-at-cyberabuse.org</strong>
   <a href="#17580" class="date">15-Dec-2001 04:46</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
PHP miss CIDR functions.<br />
<br />
This one will convert a CIDR like this:<br />
0.0.0.0/16 -&gt; 0.0.0.0 - 0.0.255.255<br />
127.0/16 -&gt; 127.0.0.0 - 127.0.255.255<br />
etc...<br />
<br />
function cidrconv($net) {<br />
$start=strtok($net,"/");<br />
$n=3-substr_count($net, ".");<br />
if ($n&gt;0) { for ($i=$n;$i&gt;0;$i--) $start.=".0"; }<br />
$bits1=str_pad(decbin(ip2long($start)),32,"0","STR_PAD_LEFT");<br />
$net=pow(2,(32-substr(strstr($net,"/"),1)))-1;<br />
$bits2=str_pad(decbin($net),32,"0","STR_PAD_LEFT");<br />
for ($i=0;$i&lt;32;$i++) {<br />
if ($bits1[$i]==$bits2[$i]) $final.=$bits1[$i];<br />
if ($bits1[$i]==1 and $bits2[$i]==0) $final.=$bits1[$i];<br />
if ($bits1[$i]==0 and $bits2[$i]==1) $final.=$bits2[$i];<br />
}<br />
return $start." - ".long2ip(bindec($final));<br />
}</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
</div>
</div>
<hr /><div class="manualnavbar" style="text-align: center;">
 <div class="prev" style="text-align: left; float: left;"><a href="network.constants.html">定義済み定数</a></div>
 <div class="next" style="text-align: right; float: right;"><a href="function.checkdnsrr.html">checkdnsrr</a></div>
 <div class="up"><a href="book.network.html">ネットワーク</a></div>
 <div class="home"><a href="index.html">PHP Manual</a></div>
</div></body></html>
