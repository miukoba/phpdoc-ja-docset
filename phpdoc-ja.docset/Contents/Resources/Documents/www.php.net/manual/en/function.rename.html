<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
 <head>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <title>ファイルをリネームする</title>
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <link media="all" rel="stylesheet" type="text/css" href="style.css"/>
 </head>
 <body class="docs"><div class="manualnavbar" style="text-align: center;">
 <div class="prev" style="text-align: left; float: left;"><a href="function.realpath.html">realpath</a></div>
 <div class="next" style="text-align: right; float: right;"><a href="function.rewind.html">rewind</a></div>
 <div class="up"><a href="ref.filesystem.html">ファイルシステム 関数</a></div>
 <div class="home"><a href="index.html">PHP Manual</a></div>
</div><hr /><div id="function.rename" class="refentry">
 <div class="refnamediv">
  <h1 class="refname">rename</h1>
  <p class="verinfo">(PHP 4, PHP 5)</p><p class="refpurpose"><span class="refname">rename</span> &mdash; <span class="dc-title">ファイルをリネームする</span></p>

 </div>
 
 <div class="refsect1 description" id="refsect1-function.rename-description">
  <h3 class="title">説明</h3>
  <div class="methodsynopsis dc-description">
   <span class="type">bool</span> <span class="methodname"><strong>rename</strong></span>
    ( <span class="methodparam"><span class="type">string</span> <code class="parameter">$oldname</code></span>
   , <span class="methodparam"><span class="type">string</span> <code class="parameter">$newname</code></span>
   [, <span class="methodparam"><span class="type">resource</span> <code class="parameter">$context</code></span>
  ] )</div>

  <p class="para rdfs-comment">
   <em><code class="parameter">oldname</code></em> を
   <em><code class="parameter">newname</code></em> にリネームし、必要ならディレクトリを移動しようと試みます。
   <em><code class="parameter">newname</code></em> が存在する場合は、上書きします。
  </p>
 </div>


 <div class="refsect1 parameters" id="refsect1-function.rename-parameters">
  <h3 class="title">パラメータ</h3>
  <p class="para">
   <dl>

    <dt>

     <span class="term"><em><code class="parameter">oldname</code></em></span>
     <dd>

      <p class="para">
      </p>
      <blockquote class="note"><p><strong class="note">注意</strong>: 
       <p class="para">
        変更前の名前。
        <em><code class="parameter">oldname</code></em> で使用されるラッパーは、
        <em><code class="parameter">newname</code></em> で使用するラッパーと適合
        <em class="emphasis">している必要があります</em> 。
       </p>
      </p></blockquote>
     </dd>

    </dt>

    <dt>

     <span class="term"><em><code class="parameter">newname</code></em></span>
     <dd>

      <p class="para">
       変更後の名前。
      </p>
     </dd>

    </dt>

    <dt>

     <span class="term"><em><code class="parameter">context</code></em></span>
     <dd>

      <blockquote class="note"><p><strong class="note">注意</strong>: <span class="simpara">コンテキストのサポートは、
PHP 5.0.0 で追加されました。<em>contexts</em> の説明に関しては、
<a href="book.stream.html" class="xref">ストリーム</a> を参照してください。</span></p></blockquote>
     </dd>

    </dt>

   </dl>

  </p>
 </div>


 <div class="refsect1 returnvalues" id="refsect1-function.rename-returnvalues">
  <h3 class="title">返り値</h3>
  <p class="para">
   成功した場合に <strong><code>TRUE</code></strong> を、失敗した場合に <strong><code>FALSE</code></strong> を返します。
  </p>
 </div>


 <div class="refsect1 changelog" id="refsect1-function.rename-changelog">
  <h3 class="title">変更履歴</h3>
  <p class="para">
   <table class="doctable informaltable">
    
     <thead>
      <tr>
       <th>バージョン</th>
       <th>説明</th>
      </tr>

     </thead>

     <tbody class="tbody">
      <tr>
       <td>5.3.1</td>
       <td>
         <span class="function"><strong>rename()</strong></span> は
        Windows で別のドライブにリネームできるようになりました。
       </td>
      </tr>

      <tr>
       <td>5.0.0</td>
       <td>
         <span class="function"><strong>rename()</strong></span> は
        <em class="emphasis">いくつかの</em> URL ラッパーを併用することができるようになりました。
         <span class="function"><strong>rename()</strong></span> をサポートしているラッパーの一覧については、
        <a href="wrappers.html" class="xref">サポートするプロトコル/ラッパー</a> を参照ください。
       </td>
      </tr>

      <tr>
       <td>4.3.3</td>
       <td>
         <span class="function"><strong>rename()</strong></span> は *nix ベースシステムで
        パーティション越しにファイル名を変更できるようになりました。
        適切なパーミッションが保持されます。
        移動先のファイルシステムで <em>chown()</em>
        あるいは <em>chmod()</em> といったシステムコールが実行できない場合
        (移動先のファイルシステムが FAT である場合など)
        は警告が発生します。
       </td>
      </tr>

     </tbody>
    
   </table>

  </p>
 </div>


 <div class="refsect1 examples" id="refsect1-function.rename-examples">
  <h3 class="title">例</h3>
  <p class="para">
   <div class="example" id="example-2419">
    <p><strong>例1  <span class="function"><strong>rename()</strong></span> の例</strong></p>
    <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br />rename</span><span style="color: #007700">(</span><span style="color: #DD0000">"/tmp/tmp_file.txt"</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">"/home/user/login/docs/my_file.txt"</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
    </div>

   </div>
  </p>
 </div>


 <div class="refsect1 seealso" id="refsect1-function.rename-seealso">
  <h3 class="title">参考</h3>
  <p class="para">
   <ul class="simplelist">
    <li class="member"> <span class="function"><a href="function.copy.html" class="function" rel="rdfs-seeAlso">copy()</a> - ファイルをコピーする</span></li>
    <li class="member"> <span class="function"><a href="function.unlink.html" class="function" rel="rdfs-seeAlso">unlink()</a> - ファイルを削除する</span></li>
    <li class="member"> <span class="function"><a href="function.move-uploaded-file.html" class="function" rel="rdfs-seeAlso">move_uploaded_file()</a> - アップロードされたファイルを新しい位置に移動する</span></li>
   </ul>
  </p>
 </div>


</div><div id="usernotes">
 <div class="head">
  <h3 class="title">User Contributed Notes</h3>
 </div>
<div id="allnotes">  <a name="113649""></a>
  <div class="note">
   <strong class="user">wasserwirbel at gmail dot com</strong>
   <a href="#113649" class="date">10-Nov-2013 03:20</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Interesting to note that if you are trying to rename a file within a folder adding a slash in front of the folder (even if the folder is in the root of your server) will not work.<br />
<br />
in other words, if you have the folder "tmp" in your server's root:<br />
<br />
<span class="default">&lt;?php<br />
rename</span><span class="keyword">(</span><span class="string">"/tmp/tmp_file.txt"</span><span class="keyword">, </span><span class="string">"/tmp/my_file.txt"</span><span class="keyword">); </span><span class="comment">// will not work<br />
<br />
</span><span class="default">rename</span><span class="keyword">(</span><span class="string">"tmp/tmp_file.txt"</span><span class="keyword">, </span><span class="string">"tmp/my_file.txt"</span><span class="keyword">); </span><span class="comment">// WILL work!<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="111603""></a>
  <div class="note">
   <strong class="user">bcag2 at free dot fr</strong>
   <a href="#111603" class="date">08-Mar-2013 12:39</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
on windows (XP, vista, 7...) <a href="http://fr.wikipedia.org/wiki/Windows-1252" rel="nofollow" target="_blank">http://fr.wikipedia.org/wiki/Windows-1252</a>", if your file name contains accent, it doesn't work basically. So use iconv function to convert from utf-8 to cp1252 as bellow : <br />
<span class="default">&lt;?php<br />
&nbsp;<br />
$nomfichierinitial</span><span class="keyword">=</span><span class="default">iconv</span><span class="keyword">(</span><span class="string">"UTF-8"</span><span class="keyword">, </span><span class="string">"CP1252"</span><span class="keyword">, </span><span class="string">"C:\\wamp\\www\\tést.txt"</span><span class="keyword">);<br />
</span><span class="default">$nomfichierfinal</span><span class="keyword">=</span><span class="string">"C:\\wamp\\www\\test.txt"</span><span class="keyword">;<br />
</span><span class="default">rename</span><span class="keyword">(</span><span class="default">$nomfichierinitial</span><span class="keyword">, </span><span class="default">$nomfichierfinal</span><span class="keyword">);<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="111566""></a>
  <div class="note">
   <strong class="user">Anonymous</strong>
   <a href="#111566" class="date">05-Mar-2013 07:55</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I could not get this to work at first, then saw that I was using a site url constant ahead of my target folder/filename. After re-reading the example I changed my constant to a filesystem type, like <span class="default">&lt;?php rename</span><span class="keyword">( </span><span class="default">old_filename</span><span class="keyword">.</span><span class="default">ext</span><span class="keyword">, </span><span class="default">$_SERVER</span><span class="keyword">[</span><span class="string">'DOCUMENT_ROOT'</span><span class="keyword">]</span><span class="string">"/target/folder/my_new_filename.ext"</span><span class="keyword">); </span><span class="default">?&gt;</span> and it worked like a charm.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="111381""></a>
  <div class="note">
   <strong class="user">asdf at NOSPAM dot serverwg dot net</strong>
   <a href="#111381" class="date">14-Feb-2013 09:17</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
a simpler code for changing file extentions of multiple files in your working directory.<br />
<br />
#!/usr/bin/php<br />
<span class="default">&lt;?php<br />
</span><span class="comment">//What?&nbsp; &nbsp; &nbsp; &nbsp; Quick CLI-tool to rename the file extensions of multiple files (in working directory) matching the pattern.<br />
//Author?&nbsp; &nbsp; &nbsp; ZuZi<br />
//Date?&nbsp; &nbsp; &nbsp; &nbsp; 2013/02/14<br />
</span><span class="keyword">if(</span><span class="default">$argv</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">] &amp;&amp; </span><span class="default">$argv</span><span class="keyword">[</span><span class="default">2</span><span class="keyword">]){<br />
&nbsp;&nbsp;&nbsp; foreach (</span><span class="default">glob</span><span class="keyword">(</span><span class="string">"*.</span><span class="default">$argv</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">]</span><span class="string">"</span><span class="keyword">) as </span><span class="default">$filename</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; echo (</span><span class="string">"change </span><span class="default">$filename</span><span class="string"> to "</span><span class="keyword">.</span><span class="default">substr</span><span class="keyword">(</span><span class="default">$filename</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">,-(</span><span class="default">strlen</span><span class="keyword">(</span><span class="default">$argv</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">]))).</span><span class="string">"</span><span class="default">$argv</span><span class="keyword">[</span><span class="default">2</span><span class="keyword">]</span><span class="string">\n"</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">rename</span><span class="keyword">(</span><span class="string">"</span><span class="default">$filename</span><span class="string">"</span><span class="keyword">, </span><span class="default">substr</span><span class="keyword">(</span><span class="default">$filename</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">,-(</span><span class="default">strlen</span><span class="keyword">(</span><span class="default">$argv</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">]))).</span><span class="string">"</span><span class="default">$argv</span><span class="keyword">[</span><span class="default">2</span><span class="keyword">]</span><span class="string">"</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; }<br />
}else<br />
exit(</span><span class="string">"\nERROR: ARGUMENTS MISSING!\n\nChanges the extension of all files matching &lt;source&gt; to &lt;target&gt;, in working directory.\n<br />
usage:&nbsp; &nbsp; changeFileType source target \n\n"</span><span class="keyword">);<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="102274""></a>
  <div class="note">
   <strong class="user">Martin Pelletier</strong>
   <a href="#102274" class="date">05-Feb-2011 07:01</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
rename() is working on Linux/UNIX but not working on Windows on a directory containing a file formerly opened within the same script. The problem persists even after properly closing the file and flushing the buffer.<br />
<br />
<span class="default">&lt;?php<br />
$fp </span><span class="keyword">= </span><span class="default">fopen </span><span class="keyword">(</span><span class="string">"./dir/ex.txt" </span><span class="keyword">, </span><span class="string">"r+"</span><span class="keyword">);<br />
</span><span class="default">$text </span><span class="keyword">= </span><span class="default">fread</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">, </span><span class="default">filesize</span><span class="keyword">(</span><span class="string">"../dir/ex.txt"</span><span class="keyword">));<br />
</span><span class="default">ftruncate</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">);<br />
</span><span class="default">$text2 </span><span class="keyword">= </span><span class="string">"some value"</span><span class="keyword">;<br />
</span><span class="default">fwrite </span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">,&nbsp; </span><span class="default">$text2 </span><span class="keyword">);<br />
</span><span class="default">fflush</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">);<br />
</span><span class="default">fclose </span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">);<br />
if (</span><span class="default">is_resource</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">))<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">fclose</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">);<br />
</span><span class="default">rename </span><span class="keyword">(</span><span class="string">"./dir"</span><span class="keyword">, </span><span class="string">".dir2"</span><span class="keyword">); </span><span class="comment">// will give a «permission denied» error<br />
</span><span class="default">?&gt;<br />
</span><br />
Strangely it seem that the rename command is&nbsp; executed BEFORE the handle closing on Windows.<br />
<br />
Inserting a sleep() command before the renaming cures the problem.<br />
<br />
<span class="default">&lt;?php<br />
$fp </span><span class="keyword">= </span><span class="default">fopen </span><span class="keyword">(</span><span class="string">"./dir/ex.txt" </span><span class="keyword">, </span><span class="string">"r+"</span><span class="keyword">);<br />
</span><span class="default">$text </span><span class="keyword">= </span><span class="default">fread</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">, </span><span class="default">filesize</span><span class="keyword">(</span><span class="string">"../dir/ex.txt"</span><span class="keyword">));<br />
</span><span class="default">ftruncate</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">);<br />
</span><span class="default">$text2 </span><span class="keyword">= </span><span class="string">"some value"</span><span class="keyword">;<br />
</span><span class="default">fwrite </span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">,&nbsp; </span><span class="default">$text2 </span><span class="keyword">);<br />
</span><span class="default">fflush</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">);<br />
</span><span class="default">fclose </span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">);<br />
if (</span><span class="default">is_resource</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">))<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">fclose</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">);<br />
</span><span class="default">sleep</span><span class="keyword">(</span><span class="default">1</span><span class="keyword">);&nbsp; &nbsp; </span><span class="comment">// this does the trick<br />
</span><span class="default">rename </span><span class="keyword">(</span><span class="string">"./dir"</span><span class="keyword">, </span><span class="string">".dir2"</span><span class="keyword">); </span><span class="comment">//no error <br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="97347""></a>
  <div class="note">
   <strong class="user">andrew at 21cv dot co dot uk</strong>
   <a href="#97347" class="date">15-Apr-2010 02:19</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Code first, then explanation.<br />
<br />
<span class="default">&lt;?php<br />
<br />
&nbsp;rename </span><span class="keyword">(</span><span class="string">"/folder/file.ext"</span><span class="keyword">, </span><span class="string">"newfile.ext"</span><span class="keyword">);<br />
<br />
</span><span class="default">?&gt;<br />
</span><br />
That doesn't rename the file within the folder, as you might assume, instead, it moves the file to whatever the PHP working directory is... Chances are you'll not find it in your FTP tree. Instead, use the following:<br />
<br />
<span class="default">&lt;?php<br />
<br />
&nbsp;rename </span><span class="keyword">(</span><span class="string">"/folder/file.ext"</span><span class="keyword">, </span><span class="string">"/folder/newfile.ext"</span><span class="keyword">);<br />
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="97262""></a>
  <div class="note">
   <strong class="user">Morteza</strong>
   <a href="#97262" class="date">10-Apr-2010 09:04</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
This code renames all&nbsp; files and folders in a specific directory to lower case: <br />
<br />
<span class="default">&lt;?php<br />
$path </span><span class="keyword">= </span><span class="string">"my_doc"</span><span class="keyword">;<br />
<br />
function </span><span class="default">getDirectory</span><span class="keyword">( </span><span class="default">$path </span><span class="keyword">= </span><span class="string">'.'</span><span class="keyword">, </span><span class="default">$level </span><span class="keyword">= </span><span class="default">0 </span><span class="keyword">){<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$ignore </span><span class="keyword">= array( </span><span class="string">'cgi-bin'</span><span class="keyword">, </span><span class="string">'.'</span><span class="keyword">, </span><span class="string">'..' </span><span class="keyword">);<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$dh </span><span class="keyword">= @</span><span class="default">opendir</span><span class="keyword">( </span><span class="default">$path </span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; while( </span><span class="default">false </span><span class="keyword">!== ( </span><span class="default">$file </span><span class="keyword">= </span><span class="default">readdir</span><span class="keyword">( </span><span class="default">$dh </span><span class="keyword">) ) )<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if( !</span><span class="default">in_array</span><span class="keyword">( </span><span class="default">$file</span><span class="keyword">, </span><span class="default">$ignore </span><span class="keyword">) )<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$spaces </span><span class="keyword">= </span><span class="default">str_repeat</span><span class="keyword">( </span><span class="string">'&amp;nbsp;'</span><span class="keyword">, ( </span><span class="default">$level </span><span class="keyword">* </span><span class="default">4 </span><span class="keyword">) );<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if( </span><span class="default">is_dir</span><span class="keyword">( </span><span class="string">"</span><span class="default">$path</span><span class="string">/</span><span class="default">$file</span><span class="string">" </span><span class="keyword">) )<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; echo </span><span class="string">"&lt;strong&gt;</span><span class="default">$spaces</span><span class="string"> </span><span class="default">$file</span><span class="string">&lt;/strong&gt;&lt;br /&gt;"</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">rename</span><span class="keyword">(</span><span class="default">$path</span><span class="keyword">.</span><span class="string">"\\"</span><span class="keyword">.</span><span class="default">$file</span><span class="keyword">, </span><span class="default">strtolower</span><span class="keyword">(</span><span class="default">$path</span><span class="keyword">.</span><span class="string">"\\"</span><span class="keyword">.</span><span class="default">$file</span><span class="keyword">));<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">getDirectory</span><span class="keyword">( </span><span class="string">"</span><span class="default">$path</span><span class="string">/</span><span class="default">$file</span><span class="string">"</span><span class="keyword">, (</span><span class="default">$level</span><span class="keyword">+</span><span class="default">1</span><span class="keyword">) );<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; } <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; else {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; echo </span><span class="string">"</span><span class="default">$spaces</span><span class="string"> </span><span class="default">$file</span><span class="string">&lt;br /&gt;"</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">rename</span><span class="keyword">(</span><span class="default">$path</span><span class="keyword">.</span><span class="string">"\\"</span><span class="keyword">.</span><span class="default">$file</span><span class="keyword">, </span><span class="default">strtolower</span><span class="keyword">(</span><span class="default">$path</span><span class="keyword">.</span><span class="string">"\\"</span><span class="keyword">.</span><span class="default">$file</span><span class="keyword">));<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">closedir</span><span class="keyword">( </span><span class="default">$dh </span><span class="keyword">);<br />
} <br />
<br />
</span><span class="default">getDirectory</span><span class="keyword">( </span><span class="default">$path </span><span class="keyword">, </span><span class="default">0 </span><span class="keyword">)<br />
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="92575""></a>
  <div class="note">
   <strong class="user">pcdinh at phpvietnam dot net</strong>
   <a href="#92575" class="date">30-Jul-2009 06:10</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
For those who are still confused about the behavior of rename() in Linux and Windows (Windows XP) when target destination exists:<br />
<br />
I have tested rename($oldName, $targetName) in PHP 5.3.0 and PHP 5.2.9 on both OS and find that if a file named $targetName does exist before, it will be overwritten with the content of $oldName</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="91994""></a>
  <div class="note">
   <strong class="user">php-page at mailfilter dot com dot ar</strong>
   <a href="#91994" class="date">04-Jul-2009 06:06</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
In Windows, on FAT32, rename will fail with "bad file descriptor" if the underlying short (8.3) file name of the file to rename is the same as the new file name. For example, attempting to rename "Oxygène.m3u" to "Oxygene.m3u" will fail if the 8.3 name of "Oxygène.m3u" is "OXYGENE.M3U" (which is very likely), as Windows will take both names as belonging to the same file. To solve this you must first rename the file to an intermediate name and then rename it to the intended name. To see the short (8.3) file names in a directory you can type DIR /X on a cmd box.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="90025""></a>
  <div class="note">
   <strong class="user">andrew at iwebsolutions dot co dot uk</strong>
   <a href="#90025" class="date">02-Apr-2009 10:36</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Note that this WILL NOT WORK if trying to rename a directory to a network share.<br />
<br />
e.g.<br />
rename('/home/user/me/dir1', '/mnt/shares/nfsmount/dir2') <br />
<br />
will create a file called 'dir2' on the share and not a directory.<br />
<br />
This caught me out and my (quickest) solution was to use an exec and mv command:<br />
<br />
<span class="default">&lt;?php<br />
$cmd </span><span class="keyword">= </span><span class="string">'mv "/home/user/me/dir1" "/mnt/shares/nfsmount/dir2"'</span><span class="keyword">;<br />
</span><span class="default">exec</span><span class="keyword">(</span><span class="default">$cmd</span><span class="keyword">, </span><span class="default">$output</span><span class="keyword">, </span><span class="default">$return_val</span><span class="keyword">);<br />
<br />
if (</span><span class="default">$return_val </span><span class="keyword">== </span><span class="default">0</span><span class="keyword">) {<br />
&nbsp;&nbsp; echo </span><span class="string">"success"</span><span class="keyword">;<br />
} else {<br />
&nbsp;&nbsp; echo </span><span class="string">"failed"</span><span class="keyword">;<br />
}<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="88081""></a>
  <div class="note">
   <strong class="user">brent at brenthugh dot com</strong>
   <a href="#88081" class="date">09-Jan-2009 07:31</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
This is an update to the code provided by dev at islam-soft dot com, which renames all files in a directory with a given extension to have a different extension.<br />
<br />
I updated four things: Most important, added a check to make sure the extension matched ONLY the end of the filename (the original caused me a number of headaches when it started matching things in the middle of filenames instead of at the end where a proper extension belongs), 2nd added some feedback about what is going on, if you choose verbose mode=TRUE, 3rd added the "testing" parameter so you can do a test run before committing for real, 4th added an error message if a rename fails.<br />
<br />
parameter 1 :&nbsp; the directory name<br />
parameter 2 :&nbsp; the first extension which we want to replace<br />
parameter 3 :&nbsp; the new extension of files<br />
parameter 4 :&nbsp; verbose? (true/false)<br />
parameter 5 :&nbsp; testing? (true/false)--if true, won't actually rename anything; if you do verbose=TRUE and testing=TRUE you can see what will happen before committing to it with testing=FALSE.<br />
<br />
Return is the number of files renamed.<br />
<br />
for a simple usage call the function :<br />
changeext('my/directory', 'html', 'php',&nbsp; false, false);<br />
<br />
This changes every file name with extension html&nbsp; into php&nbsp; in the directory&nbsp; my/directory<br />
<br />
<span class="default">&lt;?PHP<br />
<br />
</span><span class="comment">//changes files in $directory with extension $ext1 to have extension $ext2<br />
//note that if file.ext2 already exists it will simply be over-written<br />
</span><span class="keyword">function </span><span class="default">changeext</span><span class="keyword">(</span><span class="default">$directory</span><span class="keyword">, </span><span class="default">$ext1</span><span class="keyword">, </span><span class="default">$ext2</span><span class="keyword">, </span><span class="default">$verbose </span><span class="keyword">= </span><span class="default">false</span><span class="keyword">, </span><span class="default">$testing</span><span class="keyword">=</span><span class="default">true</span><span class="keyword">) {<br />
&nbsp; if (</span><span class="default">$verbose </span><span class="keyword">&amp;&amp; </span><span class="default">$testing</span><span class="keyword">) { echo </span><span class="string">"Testing only . . . &lt;br /&gt;"</span><span class="keyword">;}<br />
&nbsp; </span><span class="default">$num </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">;<br />
&nbsp; if(</span><span class="default">$curdir </span><span class="keyword">= </span><span class="default">opendir</span><span class="keyword">(</span><span class="default">$directory</span><span class="keyword">)) {<br />
&nbsp;&nbsp; if (</span><span class="default">$verbose</span><span class="keyword">) echo </span><span class="string">"Opening </span><span class="default">$directory</span><span class="string"> . . .&lt;br /&gt;"</span><span class="keyword">;<br />
&nbsp;&nbsp; while(</span><span class="default">$file </span><span class="keyword">= </span><span class="default">readdir</span><span class="keyword">(</span><span class="default">$curdir</span><span class="keyword">)) {<br />
&nbsp;&nbsp; &nbsp; if(</span><span class="default">$file </span><span class="keyword">!= </span><span class="string">'.' </span><span class="keyword">&amp;&amp; </span><span class="default">$file </span><span class="keyword">!= </span><span class="string">'..'</span><span class="keyword">) {<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp; </span><span class="default">$srcfile </span><span class="keyword">= </span><span class="default">$directory </span><span class="keyword">. </span><span class="string">'/' </span><span class="keyword">. </span><span class="default">$file</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; </span><span class="default">$string&nbsp; </span><span class="keyword">= </span><span class="string">"</span><span class="default">$file</span><span class="string">"</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; </span><span class="default">$str&nbsp; &nbsp;&nbsp; </span><span class="keyword">= </span><span class="default">strlen</span><span class="keyword">(</span><span class="default">$ext1</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; </span><span class="default">$str</span><span class="keyword">++;<br />
&nbsp;&nbsp; &nbsp; &nbsp; </span><span class="default">$newfile </span><span class="keyword">= </span><span class="default">substr</span><span class="keyword">(</span><span class="default">$string</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, -</span><span class="default">$str</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; </span><span class="default">$newfile </span><span class="keyword">= </span><span class="default">$newfile</span><span class="keyword">.</span><span class="string">'.'</span><span class="keyword">.</span><span class="default">$ext2</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; </span><span class="default">$dstfile </span><span class="keyword">= </span><span class="default">$directory </span><span class="keyword">. </span><span class="string">'/' </span><span class="keyword">. </span><span class="default">$newfile</span><span class="keyword">;<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp; if (</span><span class="default">eregi</span><span class="keyword">(</span><span class="string">"\.</span><span class="default">$ext1</span><span class="string">"</span><span class="keyword">. </span><span class="string">'$' </span><span class="keyword">,</span><span class="default">$file</span><span class="keyword">)) { </span><span class="comment"># Look at only files with a pre-defined extension, '$' ensures the ext is only at they end of the filename<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; //I think the next two lines are unnecessary but they <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; //don't hurt anything so I'm leaving them<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$fileHand </span><span class="keyword">= </span><span class="default">fopen</span><span class="keyword">(</span><span class="default">$srcfile</span><span class="keyword">, </span><span class="string">'r'</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">fclose</span><span class="keyword">(</span><span class="default">$fileHand</span><span class="keyword">);<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; if (!</span><span class="default">$testing</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$result</span><span class="keyword">=</span><span class="default">rename</span><span class="keyword">(</span><span class="default">$srcfile</span><span class="keyword">, </span><span class="default">$dstfile </span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if (!</span><span class="default">$result</span><span class="keyword">) echo </span><span class="string">"ERROR renaming </span><span class="default">$srcfile</span><span class="string"> -&gt; </span><span class="default">$dstfile</span><span class="string">&lt;br /&gt;"</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; <br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; if (</span><span class="default">$verbose</span><span class="keyword">) echo </span><span class="string">"</span><span class="default">$srcfile</span><span class="string"> -&gt; </span><span class="default">$dstfile</span><span class="string">&lt;br /&gt;"</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; }<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp; if(</span><span class="default">is_dir</span><span class="keyword">(</span><span class="default">$srcfile</span><span class="keyword">)) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$num </span><span class="keyword">+= </span><span class="default">changeext</span><span class="keyword">(</span><span class="default">$srcfile</span><span class="keyword">, </span><span class="default">$ext1</span><span class="keyword">, </span><span class="default">$ext2</span><span class="keyword">, </span><span class="default">$verbose</span><span class="keyword">, </span><span class="default">$testing</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; }<br />
&nbsp;&nbsp; &nbsp; }<br />
&nbsp;&nbsp; }<br />
&nbsp;&nbsp; </span><span class="default">closedir</span><span class="keyword">(</span><span class="default">$curdir</span><span class="keyword">);<br />
&nbsp; }<br />
&nbsp; return </span><span class="default">$num</span><span class="keyword">;<br />
}<br />
<br />
</span><span class="default">$testing</span><span class="keyword">=</span><span class="default">true</span><span class="keyword">;<br />
</span><span class="default">$verbose</span><span class="keyword">=</span><span class="default">true</span><span class="keyword">;<br />
<br />
</span><span class="comment">//example usages, first run with $testing set to false, then change $testing to true to do them for real:<br />
//changeext('your/directory', 'php', 'html', $verbose,&nbsp; $testing);<br />
//changeext('your/directory', 'html', 'php',&nbsp; $verbose, $testing);</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="86168""></a>
  <div class="note">
   <strong class="user">garagod at gmail dot com</strong>
   <a href="#86168" class="date">06-Oct-2008 07:36</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
When I'm using unlink() or rename() with a SSH2.SFTP wrapper, both functions always return FALSE (but without a warning) even on success.<br />
<br />
Example:<br />
<br />
$connection = ssh2_connect(SERVER_NAME, PORT);<br />
ssh2_auth_password($connection, USERNAME, PASSWORD);<br />
$sftp = ssh2_sftp($connection);<br />
<br />
unlink("ssh2.s<a href="ftp://$sftp/" rel="nofollow" target="_blank">ftp://$sftp/</a>" . REMOTE_DIRECTORY . FILENAME); // returns FALSE on success and on failure<br />
<br />
rename("ssh2.s<a href="ftp://$sftp/" rel="nofollow" target="_blank">ftp://$sftp/</a>" . REMOTE_DIRECTORY . OLD_FILENAME, "ssh2.s<a href="ftp://$sftp/" rel="nofollow" target="_blank">ftp://$sftp/</a>" . REMOTE_DIRECTORY . NEW_FILENAME); // returns FALSE on success and on failure</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="84290""></a>
  <div class="note">
   <strong class="user">Whooptydoo</strong>
   <a href="#84290" class="date">08-Jul-2008 06:11</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If by any chance you end up with something equivalent to this:<br />
<br />
<span class="default">&lt;?php<br />
rename</span><span class="keyword">(</span><span class="string">'/foo/bar'</span><span class="keyword">,</span><span class="string">'/foo/bar'</span><span class="keyword">);<br />
</span><span class="default">?&gt;<br />
</span><br />
It returns true. It's not documented.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="80897""></a>
  <div class="note">
   <strong class="user">treshugart at gmail dot com</strong>
   <a href="#80897" class="date">06-Feb-2008 02:09</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
This might be a similar problem to what happened to:<br />
<br />
jmalinsky at gmail dot com<br />
10-Dec-2005 08:41<br />
<br />
Apparently rename() will fail on filenames that are too large and emit an E_WARNING. <br />
<br />
I was using rename() 'batch-move' a bunch of images. These files were lost in translation; in other words: deleted. One file, however, was moved but the filename was truncated. Weird. Why one or two files while the rest were deleted. This was being attempted on a Windows box.<br />
<br />
I hope this helps anyone. If anyone has an explanation please feel free to email me. But if you're one of those idiots who *thinks* they're better than everyone and you *think* you know everything, don't bother.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="72310""></a>
  <div class="note">
   <strong class="user">jeppe at bundsgaard dot net</strong>
   <a href="#72310" class="date">12-Jan-2007 10:50</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Until recently you could end the dirname your wanted to rename to with a slash:<br />
<br />
rename("mydir/my2nddir/","mydir/my3nddir/")<br />
<br />
But now it doesn't work (php warns that it is unable to access mydir/my3nddir/).<br />
<br />
So always leave out a final slash in your dirname:<br />
<br />
rename("mydir/my2nddir","mydir/my3nddir")<br />
<br />
The same goes for mkdir().</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="72163""></a>
  <div class="note">
   <strong class="user">dev at islam-soft dot com</strong>
   <a href="#72163" class="date">05-Jan-2007 01:52</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
- rename extension of files <br />
<br />
changeext($directory, $ext1, $ext2, $verbose)<br />
<br />
i wrote this function to rename the extention of some files in a folder and sub-folders inside it ..<br />
<br />
parameter 1 :&nbsp; the directory name <br />
parameter 2 :&nbsp; the first extention wich we want to replace<br />
parameter 3 :&nbsp; the new extention of files <br />
<br />
for a simple usage call the function : <br />
changeext('dir', 'html', 'php',&nbsp; 'false');<br />
<br />
to change evry file name with extention html&nbsp; into php&nbsp; in the directory&nbsp; dir<br />
<br />
<span class="default">&lt;?php<br />
<br />
</span><span class="keyword">function </span><span class="default">changeext</span><span class="keyword">(</span><span class="default">$directory</span><span class="keyword">, </span><span class="default">$ext1</span><span class="keyword">, </span><span class="default">$ext2</span><span class="keyword">, </span><span class="default">$verbose </span><span class="keyword">= </span><span class="default">false</span><span class="keyword">) {<br />
&nbsp; </span><span class="default">$num </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">;<br />
&nbsp; if(</span><span class="default">$curdir </span><span class="keyword">= </span><span class="default">opendir</span><span class="keyword">(</span><span class="default">$directory</span><span class="keyword">)) {<br />
&nbsp;&nbsp; while(</span><span class="default">$file </span><span class="keyword">= </span><span class="default">readdir</span><span class="keyword">(</span><span class="default">$curdir</span><span class="keyword">)) {<br />
&nbsp;&nbsp; &nbsp; if(</span><span class="default">$file </span><span class="keyword">!= </span><span class="string">'.' </span><span class="keyword">&amp;&amp; </span><span class="default">$file </span><span class="keyword">!= </span><span class="string">'..'</span><span class="keyword">) {<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp; </span><span class="default">$srcfile </span><span class="keyword">= </span><span class="default">$directory </span><span class="keyword">. </span><span class="string">'/' </span><span class="keyword">. </span><span class="default">$file</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; </span><span class="default">$string&nbsp; </span><span class="keyword">= </span><span class="string">"</span><span class="default">$file</span><span class="string">"</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; </span><span class="default">$str&nbsp; &nbsp;&nbsp; </span><span class="keyword">= </span><span class="default">strlen</span><span class="keyword">(</span><span class="default">$ext1</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; </span><span class="default">$str</span><span class="keyword">++;<br />
&nbsp;&nbsp; &nbsp; &nbsp; </span><span class="default">$newfile </span><span class="keyword">= </span><span class="default">substr</span><span class="keyword">(</span><span class="default">$string</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, -</span><span class="default">$str</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; </span><span class="default">$newfile </span><span class="keyword">= </span><span class="default">$newfile</span><span class="keyword">.</span><span class="string">'.'</span><span class="keyword">.</span><span class="default">$ext2</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; </span><span class="default">$dstfile </span><span class="keyword">= </span><span class="default">$directory </span><span class="keyword">. </span><span class="string">'/' </span><span class="keyword">. </span><span class="default">$newfile</span><span class="keyword">;<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp; if (</span><span class="default">eregi</span><span class="keyword">(</span><span class="string">"\.</span><span class="default">$ext1</span><span class="string">"</span><span class="keyword">,</span><span class="default">$file</span><span class="keyword">)) { </span><span class="comment"># Look at only files with a pre-defined extension<br />
&nbsp;&nbsp; &nbsp; &nbsp; </span><span class="default">$fileHand </span><span class="keyword">= </span><span class="default">fopen</span><span class="keyword">(</span><span class="default">$srcfile</span><span class="keyword">, </span><span class="string">'r'</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; </span><span class="default">fclose</span><span class="keyword">(</span><span class="default">$fileHand</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; </span><span class="default">rename</span><span class="keyword">(</span><span class="default">$srcfile</span><span class="keyword">, </span><span class="default">$dstfile </span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; }<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp; if(</span><span class="default">is_dir</span><span class="keyword">(</span><span class="default">$srcfile</span><span class="keyword">)) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$num </span><span class="keyword">+= </span><span class="default">changeext</span><span class="keyword">(</span><span class="default">$srcfile</span><span class="keyword">, </span><span class="default">$ext1</span><span class="keyword">, </span><span class="default">$ext2</span><span class="keyword">, </span><span class="default">$verbose</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; }<br />
&nbsp;&nbsp; &nbsp; }<br />
&nbsp;&nbsp; }<br />
&nbsp;&nbsp; </span><span class="default">closedir</span><span class="keyword">(</span><span class="default">$curdir</span><span class="keyword">);<br />
&nbsp; }<br />
&nbsp; return </span><span class="default">$num</span><span class="keyword">;<br />
}<br />
<br />
</span><span class="default">changeext</span><span class="keyword">(</span><span class="string">'dir'</span><span class="keyword">, </span><span class="string">'html'</span><span class="keyword">, </span><span class="string">'php'</span><span class="keyword">,&nbsp; </span><span class="string">'false'</span><span class="keyword">);<br />
<br />
</span><span class="default">?&gt;<br />
</span><br />
to remove the extention of files , just leave the parameter $ext2 blank ''</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="70905""></a>
  <div class="note">
   <strong class="user">Eric (Themepark.com)</strong>
   <a href="#70905" class="date">03-Nov-2006 07:31</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
This was a fun one-- on Win XP, rename throws a "permission deined" if you try to rename across volumes.. i.e. rename("c:\windows\temp\x.txt", "g:\destination") will fail.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="70639""></a>
  <div class="note">
   <strong class="user">David Thole (root at thedarktrumpet.com)</strong>
   <a href="#70639" class="date">22-Oct-2006 09:20</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
As of PHP 5.1.4 compiled on a mac, using rename with spaces one should just use the space.&nbsp;&nbsp; Take for example:<br />
<br />
rename("/tmp/somefile.tar", "/mnt/laptop storage/somefile.tar");<br />
<br />
If you use the backslash, like if you were cd-ing to the directory, rename will fail.&nbsp; Example:<br />
<br />
rename("/tmp/somefile.tar", "/mnt/laptop\ storage/somefile.tar");<br />
<br />
While not really a bug, it did confuse me for a little bit while working on a backup script.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="68704""></a>
  <div class="note">
   <strong class="user">PHP at Drarok dot com</strong>
   <a href="#68704" class="date">08-Aug-2006 10:57</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
As described from the unlink() page:<br />
You have to release any handles to the file before you can rename it (True on Windows, at least).<br />
This will NOT work, you'll receive permission denied errors:<br />
<span class="default">&lt;?php<br />
&nbsp;&nbsp;&nbsp; $fileHand </span><span class="keyword">= </span><span class="default">fopen</span><span class="keyword">(</span><span class="string">'tempFile.txt'</span><span class="keyword">, </span><span class="string">'r'</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">rename</span><span class="keyword">( </span><span class="string">'tempFile.txt'</span><span class="keyword">, </span><span class="string">'tempFile2.txt' </span><span class="keyword">); </span><span class="comment">// Permission Denied!<br />
</span><span class="default">?&gt;<br />
</span><br />
Simply close the handle to fix this:<br />
<span class="default">&lt;?php<br />
&nbsp;&nbsp;&nbsp; $fileHand </span><span class="keyword">= </span><span class="default">fopen</span><span class="keyword">(</span><span class="string">'tempFile.txt'</span><span class="keyword">, </span><span class="string">'r'</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">fclose</span><span class="keyword">(</span><span class="default">$fileHand</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">rename</span><span class="keyword">( </span><span class="string">'tempFile.txt'</span><span class="keyword">, </span><span class="string">'tempFile2.txt' </span><span class="keyword">);<br />
</span><span class="default">?&gt;<br />
</span><br />
This has me scratching my head for some time, as the handle was opened at the top of a marge function, and the rename was at the bottom.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="61152""></a>
  <div class="note">
   <strong class="user">bobbfwed at comcast dot net</strong>
   <a href="#61152" class="date">26-Jan-2006 09:30</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I have programmed a really nice program that remotely lets you manage files as if you have direct access to them (<a href="http://sourceforge.net/projects/filemanage/" rel="nofollow" target="_blank">http://sourceforge.net/projects/filemanage/</a>). I have a bunch of really handy functions to do just about anything to files or directories. In it I just finished redevloping the directory move function to utilize PHP's rename() since it is way more efficient than a copy/delete process. It goes through (recursivly) and renames all the files to a new location instead of copying them. It recreates the directory structure in the new location. It also allows you to overwrite the existing files, or not.<br />
Here is the function I made; it will likely need tweaking to work as a standalone script, since it relies of variables set by my program (eg: loc1 -- which dynamically changes in my program):<br />
<br />
<span class="default">&lt;?PHP<br />
&nbsp; </span><span class="comment">// loc1 is the path on the computer to the base directory that may be moved<br />
</span><span class="default">define</span><span class="keyword">(</span><span class="string">'loc1'</span><span class="keyword">, </span><span class="string">'C:/Program Files/Apache Group/Apache/htdocs'</span><span class="keyword">, </span><span class="default">true</span><span class="keyword">);<br />
<br />
&nbsp; </span><span class="comment">// move a directory and all subdirectories and files (recursive)<br />
&nbsp; // void dirmv( str 'source directory', str 'destination directory' [, bool 'overwrite existing files' [, str 'location within the directory (for recurse)']] )<br />
</span><span class="keyword">function </span><span class="default">dirmv</span><span class="keyword">(</span><span class="default">$source</span><span class="keyword">, </span><span class="default">$dest</span><span class="keyword">, </span><span class="default">$overwrite </span><span class="keyword">= </span><span class="default">false</span><span class="keyword">, </span><span class="default">$funcloc </span><span class="keyword">= </span><span class="default">NULL</span><span class="keyword">){<br />
<br />
&nbsp; if(</span><span class="default">is_null</span><span class="keyword">(</span><span class="default">$funcloc</span><span class="keyword">)){<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$dest </span><span class="keyword">.= </span><span class="string">'/' </span><span class="keyword">. </span><span class="default">strrev</span><span class="keyword">(</span><span class="default">substr</span><span class="keyword">(</span><span class="default">strrev</span><span class="keyword">(</span><span class="default">$source</span><span class="keyword">), </span><span class="default">0</span><span class="keyword">, </span><span class="default">strpos</span><span class="keyword">(</span><span class="default">strrev</span><span class="keyword">(</span><span class="default">$source</span><span class="keyword">), </span><span class="string">'/'</span><span class="keyword">)));<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$funcloc </span><span class="keyword">= </span><span class="string">'/'</span><span class="keyword">;<br />
&nbsp; }<br />
<br />
&nbsp; if(!</span><span class="default">is_dir</span><span class="keyword">(</span><span class="default">loc1 </span><span class="keyword">. </span><span class="default">$dest </span><span class="keyword">. </span><span class="default">$funcloc</span><span class="keyword">))<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">mkdir</span><span class="keyword">(</span><span class="default">loc1 </span><span class="keyword">. </span><span class="default">$dest </span><span class="keyword">. </span><span class="default">$funcloc</span><span class="keyword">); </span><span class="comment">// make subdirectory before subdirectory is copied<br />
<br />
&nbsp; </span><span class="keyword">if(</span><span class="default">$handle </span><span class="keyword">= </span><span class="default">opendir</span><span class="keyword">(</span><span class="default">loc1 </span><span class="keyword">. </span><span class="default">$source </span><span class="keyword">. </span><span class="default">$funcloc</span><span class="keyword">)){ </span><span class="comment">// if the folder exploration is sucsessful, continue<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">while(</span><span class="default">false </span><span class="keyword">!== (</span><span class="default">$file </span><span class="keyword">= </span><span class="default">readdir</span><span class="keyword">(</span><span class="default">$handle</span><span class="keyword">))){ </span><span class="comment">// as long as storing the next file to $file is successful, continue<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="keyword">if(</span><span class="default">$file </span><span class="keyword">!= </span><span class="string">'.' </span><span class="keyword">&amp;&amp; </span><span class="default">$file </span><span class="keyword">!= </span><span class="string">'..'</span><span class="keyword">){<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$path&nbsp; </span><span class="keyword">= </span><span class="default">$source </span><span class="keyword">. </span><span class="default">$funcloc </span><span class="keyword">. </span><span class="default">$file</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$path2 </span><span class="keyword">= </span><span class="default">$dest </span><span class="keyword">. </span><span class="default">$funcloc </span><span class="keyword">. </span><span class="default">$file</span><span class="keyword">;<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if(</span><span class="default">is_file</span><span class="keyword">(</span><span class="default">loc1 </span><span class="keyword">. </span><span class="default">$path</span><span class="keyword">)){<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if(!</span><span class="default">is_file</span><span class="keyword">(</span><span class="default">loc1 </span><span class="keyword">. </span><span class="default">$path2</span><span class="keyword">)){<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if(!@</span><span class="default">rename</span><span class="keyword">(</span><span class="default">loc1 </span><span class="keyword">. </span><span class="default">$path</span><span class="keyword">, </span><span class="default">loc1 </span><span class="keyword">. </span><span class="default">$path2</span><span class="keyword">)){<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; echo </span><span class="string">'&lt;font color="red"&gt;File ('</span><span class="keyword">.</span><span class="default">$path</span><span class="keyword">.</span><span class="string">') could not be moved, likely a permissions problem.&lt;/font&gt;'</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; } elseif(</span><span class="default">$overwrite</span><span class="keyword">){<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if(!@</span><span class="default">unlink</span><span class="keyword">(</span><span class="default">loc1 </span><span class="keyword">. </span><span class="default">$path2</span><span class="keyword">)){<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; echo </span><span class="string">'Unable to overwrite file ("'</span><span class="keyword">.</span><span class="default">$path2</span><span class="keyword">.</span><span class="string">'"), likely to be a permissions problem.'</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; } else<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if(!@</span><span class="default">rename</span><span class="keyword">(</span><span class="default">loc1 </span><span class="keyword">. </span><span class="default">$path</span><span class="keyword">, </span><span class="default">loc1 </span><span class="keyword">. </span><span class="default">$path2</span><span class="keyword">)){<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; echo </span><span class="string">'&lt;font color="red"&gt;File ('</span><span class="keyword">.</span><span class="default">$path</span><span class="keyword">.</span><span class="string">') could not be moved while overwritting, likely a permissions problem.&lt;/font&gt;'</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; } elseif(</span><span class="default">is_dir</span><span class="keyword">(</span><span class="default">loc1 </span><span class="keyword">. </span><span class="default">$path</span><span class="keyword">)){<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">dirmv</span><span class="keyword">(</span><span class="default">$source</span><span class="keyword">, </span><span class="default">$dest</span><span class="keyword">, </span><span class="default">$overwrite</span><span class="keyword">, </span><span class="default">$funcloc </span><span class="keyword">. </span><span class="default">$file </span><span class="keyword">. </span><span class="string">'/'</span><span class="keyword">); </span><span class="comment">//recurse!<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">rmdir</span><span class="keyword">(</span><span class="default">loc1 </span><span class="keyword">. </span><span class="default">$path</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">closedir</span><span class="keyword">(</span><span class="default">$handle</span><span class="keyword">);<br />
&nbsp; }<br />
} </span><span class="comment">// end of dirmv()<br />
</span><span class="default">?&gt;<br />
</span><br />
This new function will be in 0.9.7 (the next release of File Manage) which should release sometime early February.<br />
Hope this helps some people.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="60906""></a>
  <div class="note">
   <strong class="user">php at froghh dot de</strong>
   <a href="#60906" class="date">20-Jan-2006 12:00</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Remark for "php at stock-consulting dot com"'s note:<br />
This depends on the operating system.<br />
On windows-systems you can't rename a file to an existing destination (ok, with tools you can - but they unlink the exisiting one before).</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="60341""></a>
  <div class="note">
   <strong class="user">php at stock-consulting dot com</strong>
   <a href="#60341" class="date">04-Jan-2006 11:36</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
rename() fails with PHP4 and PHP5 under Windows if the destination file exists, regardless of file permission settings. I now use a function similar to that of ddoyle [at] canadalawbook [dot] ca, which first tries rename(), checks if it returned FALSE and then uses copy()/unlink() if it failed.<br />
<br />
However, copy() is, unlike rename(), NOT useable for "atomic updates". Another process may actually access the destination file while copy() is working. In such a case, the other process with perceive the file as empty or with incomplete content ("half written").</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="59864""></a>
  <div class="note">
   <strong class="user">php-public at macfreek dot nl</strong>
   <a href="#59864" class="date">18-Dec-2005 08:33</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
It is unclear what encoding the arguments of rename should have; For PHP 4.3, on a HFS+ filesystems, rename() did not handle UTF-8 strings, and returned an error.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="59570""></a>
  <div class="note">
   <strong class="user">jmalinsky at gmail dot com</strong>
   <a href="#59570" class="date">09-Dec-2005 10:41</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
On WinXP/PHP 5+, not only does rename()&nbsp; not follow the *nix rename as noted below, but other things (do not) happen.&nbsp; If you're trying to rename a directory, files within the directory will NOT be present in the renamed directory, though sub-directories WILL be present.&nbsp; Ultra-strange.&nbsp; And as noted, your 'old' directory will remain on the server totally intact, which can be very confusing.<br />
<br />
To try and rename a folder on XP via PHP, I wound up using a workaround: first i used the copydirr() function posted by makarenkoa at ukrpost dot net on the "copy" page of the online manual to copy all folders and files within the original directory to the new one... and then to delete the original directory (and all files/folders beneath it), i used the delDir() function corrected by czambran at gmail dot com on the "rmdir" page of the online manual.&nbsp; Why didn't I use unlink()?&nbsp; Because, unlink does NOT work on Windows systems either (and even if it did work, its not recursive without extra coding).<br />
<br />
So, all in all, rename() is pretty much a useless function if you are intending to rename a folder on an XP box.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="56772""></a>
  <div class="note">
   <strong class="user">tbrillon at gmail dot com</strong>
   <a href="#56772" class="date">14-Sep-2005 10:27</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I needed to move a file to another folder regardless if that file existed in the target already so I wrote a small piece to append a unique number to each file.<br />
<br />
$rem = $_GET['file'];<br />
$ticket = uniqid(rand(), true);<br />
<br />
rename("$rem", "www/home/storefile/$ticket$rem");<br />
<br />
the output looks like this - 6881432893ad4925a1.70147481filename.txt<br />
<br />
This also helps if you want different versions of the file stored.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="56576""></a>
  <div class="note">
   <strong class="user">ddoyle [at] canadalawbook [dot] ca</strong>
   <a href="#56576" class="date">08-Sep-2005 12:35</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
rename() definitely does not follow the *nix rename convention on WinXP with PHP 5.&nbsp; If the $newname exists, it will return FALSE and $oldname and $newname will remain in their original state.&nbsp; You can do something like this instead:<br />
<br />
function rename_win($oldfile,$newfile) {<br />
&nbsp;&nbsp; if (!rename($oldfile,$newfile)) {<br />
&nbsp;&nbsp; &nbsp;&nbsp; if (copy ($oldfile,$newfile)) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; unlink($oldfile);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; return TRUE;<br />
&nbsp;&nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp;&nbsp; return FALSE;<br />
&nbsp;&nbsp; }<br />
&nbsp;&nbsp; return TRUE;<br />
}</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="55733""></a>
  <div class="note">
   <strong class="user">tomfelker at gmail dot com</strong>
   <a href="#55733" class="date">11-Aug-2005 11:51</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Actually, I'm pretty sure that rename follows the convention of *nix rename(2) in overwriting the destination if it exists atomically (meaning that no other process will see the destination cease to exist, even for an instant).&nbsp; This is useful because it allows you to build a file as a temp file, then rename it to where you want it to be, and nobody sees the file when it's half done.<br />
<br />
Probably rename($old, $new) with an existing new was caused by permission problems.&nbsp; I bet the other problems you had were the result of not calling clearstatcache(), which can cause PHP to act like a file exists though it has since been deleted.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="53291""></a>
  <div class="note">
   <strong class="user">JRog</strong>
   <a href="#53291" class="date">27-May-2005 08:44</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
To anyone wondering, rename($old, $new) returns FALSE if $new already exists.&nbsp; My script called for overwriting the file if it existed so I did this:<br />
<br />
if(file_exists($new)) { unlink($new); }<br />
$ok = rename($old, $new);<br />
<br />
This did not work as expected.&nbsp; If $new actually existed then it worked fine.&nbsp; That is the file found at path $new was deleted and replaced with the file found at path $old.&nbsp; However, if $new did NOT exist then the result was the file at&nbsp; path $old vanished into oblivion.&nbsp; After debugging a bit, it seems that rename() was getting executed before the if-statement.&nbsp; So rename() moved $old to $new, THEN the if-statement evaluated to true and deleted the file I just moved.&nbsp; Anyway, this fixed it:<br />
<br />
if(file_exists($new)) { <br />
&nbsp;&nbsp;&nbsp; unlink($new);<br />
&nbsp;&nbsp;&nbsp; $ok = rename($old, $new);<br />
} else { $ok = rename($old, $new); }<br />
<br />
Very strange ... I hope this helps somebody</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="37425""></a>
  <div class="note">
   <strong class="user">sophie at sitadelle dot com</strong>
   <a href="#37425" class="date">14-Nov-2003 05:22</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Hello!<br />
For unix/linux users: it is usefull to know that if you use rename() for a directory, the new one will be created with the current umask!</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="18896""></a>
  <div class="note">
   <strong class="user">blujay</strong>
   <a href="#18896" class="date">08-Feb-2002 10:32</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
You can always chdir() to the parent directory of what you're renaming, and rename the directory or file directly.&nbsp; For example:<br />
<br />
$oldWD = getcwd();<br />
chdir($dirWhereRenameeIs);<br />
rename($oldFilename, $newFilename);<br />
chdir($oldWD);</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="13416""></a>
  <div class="note">
   <strong class="user">pearcec at commnav dot com</strong>
   <a href="#13416" class="date">15-Jun-2001 10:17</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If you rename one directory to another where the second directory exists as an empty directory it will not complain.<br />
<br />
Not what I expected.<br />
<br />
[pearcec@abe tmp]$ mkdir test1<br />
[pearcec@abe tmp]$ mkdir test2<br />
[pearcec@abe tmp]$ touch test1/test<br />
[pearcec@abe tmp]$ php<br />
<span class="default">&lt;?php<br />
rename</span><span class="keyword">(</span><span class="string">"test1"</span><span class="keyword">,</span><span class="string">"test2"</span><span class="keyword">);<br />
</span><span class="default">?&gt;<br />
</span>X-Powered-By: PHP/4.0.5<br />
Content-type: text/html<br />
<br />
[pearcec@abe tmp]$ ls -al<br />
total 12<br />
drwxr-xr-x&nbsp; &nbsp; 3 pearcec&nbsp; commnav&nbsp; &nbsp; &nbsp; 4096 Jun 15 13:17 .<br />
drwxr-xr-x&nbsp;&nbsp; 18 pearcec&nbsp; commnav&nbsp; &nbsp; &nbsp; 4096 Jun 15 13:15 ..<br />
drwxr-xr-x&nbsp; &nbsp; 2 pearcec&nbsp; commnav&nbsp; &nbsp; &nbsp; 4096 Jun 15 13:16 test2<br />
[pearcec@abe tmp]$ ls -la test2/<br />
total 8<br />
drwxr-xr-x&nbsp; &nbsp; 2 pearcec&nbsp; commnav&nbsp; &nbsp; &nbsp; 4096 Jun 15 13:16 .<br />
drwxr-xr-x&nbsp; &nbsp; 3 pearcec&nbsp; commnav&nbsp; &nbsp; &nbsp; 4096 Jun 15 13:17 ..<br />
-rw-r--r--&nbsp; &nbsp; 1 pearcec&nbsp; commnav&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; 0 Jun 15 13:16 test<br />
[pearcec@abe tmp]$</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="2430""></a>
  <div class="note">
   <strong class="user">michael-nospam at sal dot mik dot hyperlink dot net dot au</strong>
   <a href="#2430" class="date">25-Nov-1999 08:43</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Note, that on Unix, a rename is a beautiful way of getting atomic updates to files.<br />
<br />
Just copy the old contents (if necessary), and write the new contents into a new file, then rename over the original file.<br />
<br />
Any processes reading from the file will continue to do so, any processes trying to open the file while you're writing to it will get the old file (because you'll be writing to a temp file), and there is no "intermediate" time between there being a file, and there not being a file (or there being half a file).<br />
<br />
Oh, and this only works if you have the temp file and the destination file on the same filesystem (eg. partition/hard-disk).</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
</div>
</div>
<hr /><div class="manualnavbar" style="text-align: center;">
 <div class="prev" style="text-align: left; float: left;"><a href="function.realpath.html">realpath</a></div>
 <div class="next" style="text-align: right; float: right;"><a href="function.rewind.html">rewind</a></div>
 <div class="up"><a href="ref.filesystem.html">ファイルシステム 関数</a></div>
 <div class="home"><a href="index.html">PHP Manual</a></div>
</div></body></html>
