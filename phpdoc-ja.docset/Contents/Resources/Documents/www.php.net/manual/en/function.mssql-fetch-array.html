<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
 <head>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <title>連想配列・数値添字配列・あるいはその両方で結果の行を取得する</title>
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <link media="all" rel="stylesheet" type="text/css" href="style.css"/>
 </head>
 <body class="docs"><div class="manualnavbar" style="text-align: center;">
 <div class="prev" style="text-align: left; float: left;"><a href="function.mssql-execute.html">mssql_execute</a></div>
 <div class="next" style="text-align: right; float: right;"><a href="function.mssql-fetch-assoc.html">mssql_fetch_assoc</a></div>
 <div class="up"><a href="ref.mssql.html">Mssql 関数</a></div>
 <div class="home"><a href="index.html">PHP Manual</a></div>
</div><hr /><div id="function.mssql-fetch-array" class="refentry">
 <div class="refnamediv">
  <h1 class="refname">mssql_fetch_array</h1>
  <p class="verinfo">(PHP 4, PHP 5, PECL odbtp &gt;= 1.1.1)</p><p class="refpurpose"><span class="refname">mssql_fetch_array</span> &mdash; <span class="dc-title">連想配列・数値添字配列・あるいはその両方で結果の行を取得する</span></p>

 </div>
 
 <div class="refsect1 description" id="refsect1-function.mssql-fetch-array-description">
  <h3 class="title">説明</h3>
  <div class="methodsynopsis dc-description">
   <span class="type">array</span> <span class="methodname"><strong>mssql_fetch_array</strong></span>
    ( <span class="methodparam"><span class="type">resource</span> <code class="parameter">$result</code></span>
   [, <span class="methodparam"><span class="type">int</span> <code class="parameter">$result_type</code><span class="initializer"> = MSSQL_BOTH</span></span>
  ] )</div>

  <p class="para rdfs-comment">
    <span class="function"><strong>mssql_fetch_array()</strong></span> は、
    <span class="function"><a href="function.mssql-fetch-row.html" class="function">mssql_fetch_row()</a></span> の拡張版です。
   この関数は、結果の配列に数値インデックスにデータを保持するのに加えて、
   フィールド名をキーとしてデータを連想配列にも保存します。
  </p>
  <p class="para">
   機能がかなり増えているにもかかわらず、 <span class="function"><strong>mssql_fetch_array()</strong></span> は
    <span class="function"><a href="function.mssql-fetch-row.html" class="function">mssql_fetch_row()</a></span> よりもそれほど遅くはないということを強調しておきます。
  </p>
 </div>


 <div class="refsect1 parameters" id="refsect1-function.mssql-fetch-array-parameters">
  <h3 class="title">パラメータ</h3>
  <p class="para">
   <dl>

    <dt>

     <span class="term"><em><code class="parameter">result</code></em></span>
     <dd>

      <p class="para">
       処理対象となる結果リソース。これは
        <span class="function"><a href="function.mssql-query.html" class="function">mssql_query()</a></span> のコールによって取得します。
      </p>
     </dd>

    </dt>

    <dt>

     <span class="term"><em><code class="parameter">result_type</code></em></span>
     <dd>

      <p class="para">
       取得する配列の形式。定数で、以下のいずれかの値となります。
       <strong><code>MSSQL_ASSOC</code></strong>、
       <strong><code>MSSQL_NUM</code></strong> あるいは
       <strong><code>MSSQL_BOTH</code></strong>。
      </p>
     </dd>

    </dt>

   </dl>

  </p>
 </div>


 <div class="refsect1 returnvalues" id="refsect1-function.mssql-fetch-array-returnvalues">
  <h3 class="title">返り値</h3>
  <p class="para">
   取得された行に対応する配列、行がもうない場合に <strong><code>FALSE</code></strong> を返します。
  </p>
 </div>


 <div class="refsect1 examples" id="refsect1-function.mssql-fetch-array-examples">
  <h3 class="title">例</h3>
  <p class="para">
   <div class="example" id="example-1524">
    <p><strong>例1  <span class="function"><strong>mssql_fetch_array()</strong></span> の例</strong></p>
    <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br /></span><span style="color: #FF8000">//&nbsp;select&nbsp;クエリを&nbsp;MSSQL&nbsp;に送信します<br /></span><span style="color: #0000BB">$query&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">mssql_query</span><span style="color: #007700">(</span><span style="color: #DD0000">'SELECT&nbsp;[username],&nbsp;[name]&nbsp;FROM&nbsp;[php].[dbo].[userlist]'</span><span style="color: #007700">);<br /><br /></span><span style="color: #FF8000">//&nbsp;レコードがあるかどうかを調べます<br /></span><span style="color: #007700">if&nbsp;(!</span><span style="color: #0000BB">mssql_num_rows</span><span style="color: #007700">(</span><span style="color: #0000BB">$query</span><span style="color: #007700">))&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;echo&nbsp;</span><span style="color: #DD0000">'No&nbsp;records&nbsp;found'</span><span style="color: #007700">;<br />}&nbsp;else&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">//&nbsp;次のコードは、これと同じ意味です<br />&nbsp;&nbsp;&nbsp;&nbsp;//<br />&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;while&nbsp;($row&nbsp;=&nbsp;mssql_fetch_row($query))&nbsp;{<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">while&nbsp;(</span><span style="color: #0000BB">$row&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">mssql_fetch_array</span><span style="color: #007700">(</span><span style="color: #0000BB">$query</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">MSSQL_NUM</span><span style="color: #007700">))&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">//&nbsp;...<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">}<br />}<br /><br /></span><span style="color: #FF8000">//&nbsp;結果を開放します<br /></span><span style="color: #0000BB">mssql_free_result</span><span style="color: #007700">(</span><span style="color: #0000BB">$query</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
    </div>

   </div>
  </p>
 </div>


 <div class="refsect1 notes" id="refsect1-function.mssql-fetch-array-notes">
  <h3 class="title">注意</h3>
  <blockquote class="note"><p><strong class="note">注意</strong>: <span class="simpara">この関数により返されるフィー
ルド名は <em class="emphasis">大文字小文字を区別</em> します。</span></p></blockquote>
  <blockquote class="note"><p><strong class="note">注意</strong>: <span class="simpara">この関数は、
NULL フィールドに PHPの <strong><code>NULL</code></strong> 値を設定します。</span></p></blockquote>
 </div>


 <div class="refsect1 seealso" id="refsect1-function.mssql-fetch-array-seealso">
  <h3 class="title">参考</h3>
  <p class="para">
   <ul class="simplelist">
    <li class="member"> <span class="function"><a href="function.mssql-fetch-row.html" class="function" rel="rdfs-seeAlso">mssql_fetch_row()</a> - 配列として行を取得する</span></li>
   </ul>
  </p>
 </div>


</div><div id="usernotes">
 <div class="head">
  <h3 class="title">User Contributed Notes</h3>
 </div>
<div id="allnotes">  <a name="84556""></a>
  <div class="note">
   <strong class="user">php at bricology dot com</strong>
   <a href="#84556" class="date">18-Jul-2008 06:08</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I just spent a few hours trying to get ntext data with this function, CASTing and CONVERTing every which way, and scouring the 'net. Nothing worked, I just got a NULL.<br />
<br />
Then on a whim I tried it with mssql_fetch_row instead, and that DOES work.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="80076""></a>
  <div class="note">
   <strong class="user">chu61 dot tw at gmail dot com</strong>
   <a href="#80076" class="date">28-Dec-2007 02:20</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
To write Unicode (nvarchar) to SQL2000/2005 use PHP<br />
用PHP在SQL Server 存取Unicode資料<br />
----------------------------------------------<br />
<br />
Let's assume, we have following data table, that allows us to store unicode values (using UCS-2 encoding):<br />
<br />
&nbsp;&nbsp;&nbsp; create table mytable&nbsp; &nbsp; (<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; myfield nvarchar (100) null<br />
&nbsp;&nbsp;&nbsp; );<br />
<br />
Below is the code to work with:<br />
<br />
<span class="default">&lt;?php<br />
&nbsp;&nbsp;&nbsp; $link </span><span class="keyword">= </span><span class="default">mssql_connect</span><span class="keyword">(</span><span class="string">'dbhost'</span><span class="keyword">, </span><span class="string">'username'</span><span class="keyword">, </span><span class="string">'password'</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">mssql_select_db</span><span class="keyword">(</span><span class="string">'database'</span><span class="keyword">, </span><span class="default">$link</span><span class="keyword">);<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">// sending data to database<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$utf8 </span><span class="keyword">= </span><span class="string">'some unicode UTF-8 data'</span><span class="keyword">;&nbsp; </span><span class="comment">// some Greek text for example ;)<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$ucs2 </span><span class="keyword">= </span><span class="default">iconv</span><span class="keyword">(</span><span class="string">'UTF-8'</span><span class="keyword">, </span><span class="string">'UCS-2LE'</span><span class="keyword">, </span><span class="default">$utf8</span><span class="keyword">);<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">// converting UCS-2 string into "binary" hexadecimal form<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$arr </span><span class="keyword">= </span><span class="default">unpack</span><span class="keyword">(</span><span class="string">'H*hex'</span><span class="keyword">, </span><span class="default">$ucs2</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$hex </span><span class="keyword">= </span><span class="string">"0x</span><span class="keyword">{</span><span class="default">$arr</span><span class="keyword">[</span><span class="string">'hex'</span><span class="keyword">]}</span><span class="string">"</span><span class="keyword">;<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">// IMPORTANT!<br />
&nbsp;&nbsp;&nbsp; // please note that value must be passed without apostrophes<br />
&nbsp;&nbsp;&nbsp; // it should be "... values(0x0123456789ABCEF) ...", not "... values('0x0123456789ABCEF') ..."<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">mssql_query</span><span class="keyword">(</span><span class="string">"insert into mytable (myfield) values (</span><span class="keyword">{</span><span class="default">$hex</span><span class="keyword">}</span><span class="string">)"</span><span class="keyword">, </span><span class="default">$link</span><span class="keyword">);<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">// retrieving data from database<br />
&nbsp;&nbsp;&nbsp; // IMPORTANT!<br />
&nbsp;&nbsp;&nbsp; // please note that "varbinary" expects number of bytes<br />
&nbsp;&nbsp;&nbsp; // in this example it must be 200 (bytes), while size of field is 100 (UCS-2 chars)<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$result </span><span class="keyword">= </span><span class="default">mssql_query</span><span class="keyword">(</span><span class="string">"select convert(varbinary(200), myfield) from mytable"</span><span class="keyword">, </span><span class="default">$link</span><span class="keyword">);<br />
<br />
&nbsp;&nbsp;&nbsp; while ((</span><span class="default">$row </span><span class="keyword">= </span><span class="default">mssql_fetch_array</span><span class="keyword">(</span><span class="default">$result</span><span class="keyword">, </span><span class="default">MSSQL_BOTH</span><span class="keyword">))) <br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// we get data in UCS-2<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; // I use UTF-8 in my project, so I encode it back<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">echo(</span><span class="default">iconv</span><span class="keyword">(</span><span class="string">'UCS-2LE'</span><span class="keyword">, </span><span class="string">'UTF-8'</span><span class="keyword">, </span><span class="default">$row</span><span class="keyword">[</span><span class="string">'myfield'</span><span class="keyword">]));<br />
&nbsp;&nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">mssql_free_result</span><span class="keyword">(</span><span class="default">$result</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">mssql_close</span><span class="keyword">(</span><span class="default">$link</span><span class="keyword">);<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="77156""></a>
  <div class="note">
   <strong class="user">blood - demon at gmx dot net</strong>
   <a href="#77156" class="date">17-Aug-2007 11:22</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Note that if you fetch varchar fields larger than 255 letters the result will be cut off at 255 letters. <br />
<br />
To prevent this you have to do a CONVERT(TEXT,data_field) for this fields in your select clause.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="76217""></a>
  <div class="note">
   <strong class="user">Bryan</strong>
   <a href="#76217" class="date">05-Jul-2007 06:05</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Calling this function with the option second parameter is causing a "Wrong parameter count" message. If you run into this problem, you can get the same effect by calling different functions:<br />
<br />
mssql_fetch_array: MSSQL_BOTH<br />
mssql_fetch_assoc: MSSQL_ASSOC<br />
mssql_fetch_row: MSSQL_NUM</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="57938""></a>
  <div class="note">
   <strong class="user">admin at talente dot ro</strong>
   <a href="#57938" class="date">19-Oct-2005 05:36</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
There is any option like skip or go next ! I am using a while clause inside:<br />
&nbsp; While ($row=mysql_fetch_array($result))<br />
&nbsp;&nbsp;&nbsp; while ($row["Brand_name"]=$gr){<br />
&nbsp;&nbsp; &nbsp; ....<br />
So I am printing different TD from classes and when I finish cycling the fields I want to "skip" to next record !</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="54497""></a>
  <div class="note">
   <strong class="user">gillis dot phpmanual at no-spam-for-megillis dot fi</strong>
   <a href="#54497" class="date">06-Jul-2005 10:19</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Allthough probably obvious to people who have used the functions available to other databases it during writing is not present in this entry that result type can be entered as MSSQL_ASSOC or MSSQL_NUM, and the default value when nothing entered being MSSQL_BOTH<br />
<br />
//Gillis Danielsen</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="46870""></a>
  <div class="note">
   <strong class="user">archwisp at gmail dot com</strong>
   <a href="#46870" class="date">26-Oct-2004 04:44</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
In response to my last post:<br />
<br />
After further testing, it appears as though the null column bug only affects windows installations. On my linux installation using freetds-0.61.2, the function behaves properly. It must exist either in the php_mssql.dll or the Microsoft connection libraries. And since I use this functionality through ASP as well (which uses the Microsoft connection libraries), it would lead me to believe that it's an issue within the php_mssql.dll.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="46854""></a>
  <div class="note">
   <strong class="user">archwisp at gmail dot com</strong>
   <a href="#46854" class="date">25-Oct-2004 11:28</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
[Editor's Note: NULLs *are* distinguishable from 0.&nbsp; See the manual section on comparison operators. ]<br />
<br />
microsoft sql 2000 server<br />
php running on windows 2000<br />
<br />
Using the $row = mssql_fetch_array($result)<br />
<br />
A null value will return 0, this is a problem if you are using 0 and some identifier for a value.&nbsp; you should convert all nulls to something like -1 or "NO VALUE"<br />
<br />
******<br />
<br />
After extensive testing, the above statements both seem to be true. You *can* distinguish between 0 and null values in PHP; however, the mssql_fetch_array function does not set null colums to the php NULL value. <br />
<br />
if ($row['Null_Column'] === 0) { print('pass'); }<br />
<br />
A null column passes the above test. Seems to be a bug in the function.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="40189""></a>
  <div class="note">
   <strong class="user">Derek Ethier</strong>
   <a href="#40189" class="date">25-Feb-2004 12:06</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
The array_walk function is also useful for stripping the whitespace returned in an mssql_query.<br />
<br />
function modify_field(&amp;$array) {<br />
&nbsp;&nbsp;&nbsp; $array = trim($array);<br />
}<br />
<br />
$query = "select * from dbo.table where value = '0'";<br />
$result = mssql_query($query) or die;<br />
<br />
while ($row = mssql_fetch_array($result)) {<br />
&nbsp;&nbsp;&nbsp; // This will call the above function.<br />
&nbsp;&nbsp;&nbsp; array_walk($row, 'modify_field'); <br />
&nbsp;&nbsp;&nbsp; array_push($eventresults, $row);<br />
}<br />
<br />
An added benefit is that you can expand the modify_field function to handled unexpected returned column data.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="39302""></a>
  <div class="note">
   <strong class="user">hackajar matt yahoo trot com</strong>
   <a href="#39302" class="date">24-Jan-2004 12:11</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
from php-dev mailing list article - <br />
#26012 [Bgs]: mssql_fetch_array <br />
<br />
"Previously mssql data was always rtrimed, however that's wrong because it modifies the original data. This caused a problem for people who needed those trailing space. Ultimately, the job of database extension is to fetch the data as is (like other db extensions already do) and not to mangle it in any way."<br />
<br />
moving from &lt;4.3.4 to a higher version you will have this now:<br />
<br />
$query = "Select dumb_spaces from dbo.table where weak_sause = 'true'";<br />
$result = mssql_query($query) or die("Spicy Sause! Query = $query");<br />
<br />
while($line = mssql_fetch_array($result, MSSQL_ASSOC) {<br />
&nbsp;&nbsp; &nbsp; foreach($line as $bs_trim) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; //Trim whitespace from end of query<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $bs_trim = rtrim($bs_trim);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; echo "Clean!".$bs_trim;<br />
&nbsp;&nbsp; &nbsp; }<br />
}</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="33422""></a>
  <div class="note">
   <strong class="user">herriedm at yahoo dot com</strong>
   <a href="#33422" class="date">25-Jun-2003 06:21</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
[Editor's Note: NULLs *are* distinguishable from 0.&nbsp; See the manual section on comparison operators. ]<br />
<br />
microsoft sql 2000 server<br />
php running on windows 2000<br />
<br />
Using the $row = mssql_fetch_array($result)<br />
<br />
A null value will return 0, this is a problem if you are using 0 and some identifier for a value.&nbsp; you should convert all nulls to something like -1 or "NO VALUE"</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="28514""></a>
  <div class="note">
   <strong class="user">flatcable2000 at yahoo dot com</strong>
   <a href="#28514" class="date">15-Jan-2003 06:22</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Apparently php 4.0.6 does not support the second parameter. When used the error sounds<br />
"Wrong parameter count for mssql_fetch_array"</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="28370""></a>
  <div class="note">
   <strong class="user">shaver at qspeed dot com</strong>
   <a href="#28370" class="date">10-Jan-2003 11:08</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Note that the second parameter is the same as the msql version of this function (<a href="http://www.php.net/manual/en/function.msql-fetch-array.php" rel="nofollow" target="_blank">http://www.php.net/manual/en/function.msql-fetch-array.php</a>) with the constants (MSQL_ASSOC, MSQL_NUM, and MSQL_BOTH) changing to MSSQL_.<br />
<br />
Also note that if you don't specify this parameter you'll get both the numbers and column names, which can cause some frustration.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="22062""></a>
  <div class="note">
   <strong class="user">ask at manniac dot de</strong>
   <a href="#22062" class="date">05-Jun-2002 03:13</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
It seems that this function creates arrays wich keys can not be longer than 30 chars. So when you're having a DB-field like "this_is_a_very_long_db_field_name"<br />
its array-key is cut off after 30 chars and you will have to access the value with<br />
rs["this_is_a_very_long_db_field_n"]</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
</div>
</div>
<hr /><div class="manualnavbar" style="text-align: center;">
 <div class="prev" style="text-align: left; float: left;"><a href="function.mssql-execute.html">mssql_execute</a></div>
 <div class="next" style="text-align: right; float: right;"><a href="function.mssql-fetch-assoc.html">mssql_fetch_assoc</a></div>
 <div class="up"><a href="ref.mssql.html">Mssql 関数</a></div>
 <div class="home"><a href="index.html">PHP Manual</a></div>
</div></body></html>
