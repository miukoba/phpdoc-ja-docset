<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
 <head>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <title>W32api 関数</title>
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <link media="all" rel="stylesheet" type="text/css" href="style.css"/>
 </head>
 <body class="docs"><div class="manualnavbar" style="text-align: center;">
 <div class="prev" style="text-align: left; float: left;"><a href="w32api.examples-uptime.html">w32api の例</a></div>
 <div class="next" style="text-align: right; float: right;"><a href="function.w32api-deftype.html">w32api_deftype</a></div>
 <div class="up"><a href="book.w32api.html">W32api</a></div>
 <div class="home"><a href="index.html">PHP Manual</a></div>
</div><hr /><div id="ref.w32api" class="reference">
 <h1 class="title">W32api 関数</h1>

 









































<h2>目次</h2><ul class="chunklist chunklist_reference"><li><a href="function.w32api-deftype.html">w32api_deftype</a> — 他の w32api_functions で使用するために型を定義する</li><li><a href="function.w32api-init-dtype.html">w32api_init_dtype</a> — データ型 typename のインスタンスを作成し、そこに渡された値を代入する</li><li><a href="function.w32api-invoke-function.html">w32api_invoke_function</a> — 関数名の後ろに指定された引数を指定し、関数 funcname を実行する</li><li><a href="function.w32api-register-function.html">w32api_register_function</a> — ライブラリの関数 function_name を PHP に登録する</li><li><a href="function.w32api-set-call-method.html">w32api_set_call_method</a> — 使用するコール方式を設定する</li></ul>
</div>
<div id="usernotes">
 <div class="head">
  <h3 class="title">User Contributed Notes</h3>
 </div>
<div id="allnotes">  <a name="78114""></a>
  <div class="note">
   <strong class="user">sk89q</strong>
   <a href="#78114" class="date">28-Sep-2007 08:14</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
The only way I've been able to call Win32 API functions with PHP5 has been through COM and DynamicWrapper.<br />
<br />
Get DynamicWrapper at:<br />
<a href="http://ourworld.compuserve.com/homepages/Guenter_Born/" rel="nofollow" target="_blank">http://ourworld.compuserve.com/homepages/Guenter_Born/</a><br />
WSHBazaar/WSHDynaCall.htm<br />
(remove new line)<br />
<br />
Here's an example to play a beep sound with your computer speaker:<br />
<span class="default">&lt;?php<br />
$com </span><span class="keyword">= new </span><span class="default">COM</span><span class="keyword">(</span><span class="string">"DynamicWrapper"</span><span class="keyword">);<br />
</span><span class="default">$com</span><span class="keyword">-&gt;</span><span class="default">Register</span><span class="keyword">(</span><span class="string">"KERNEL32.DLL"</span><span class="keyword">, </span><span class="string">"Beep"</span><span class="keyword">, </span><span class="string">"i=ll"</span><span class="keyword">, </span><span class="string">"f=s"</span><span class="keyword">, </span><span class="string">"r=l"</span><span class="keyword">);<br />
</span><span class="default">$com</span><span class="keyword">-&gt;</span><span class="default">Beep</span><span class="keyword">(</span><span class="default">5000</span><span class="keyword">, </span><span class="default">100</span><span class="keyword">);<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="50053""></a>
  <div class="note">
   <strong class="user">MagicalTux at FF dot st</strong>
   <a href="#50053" class="date">16-Feb-2005 05:10</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Answer to the note posted by me at nullflux dot com (see below)<br />
<br />
The Win32 API *does* work in other versions of PHP than between 4.2.0 and 4.2.3. However the documented functions are not available. You will have to use the "win32" class to access functions. For an example, read Philip Soeberg's post just below.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="42480""></a>
  <div class="note">
   <strong class="user">chris at ramsoft dot biz</strong>
   <a href="#42480" class="date">18-May-2004 08:46</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
The win32 support appears to be pretty flaky in php. This of course is to be expected with an experimental extension. That being said, if you are having trouble using the win32 functionality you may want to look into creating a PHP extension instead.<br />
<br />
We were having some problems interfacing PHP with a 3rd party dll. As such we created an extension which wraps the interface with the aforementioned dll. The solution was surprisingly quick and painless.<br />
Because we use Delphi primarily we found the following extremely useful and easy to use. <a href="http://users.chello.be/ws36637/php4delphi.html#download" rel="nofollow" target="_blank">http://users.chello.be/ws36637/php4delphi.html#download</a><br />
<br />
more info here:<br />
<a href="http://php.us.themoes.org/manual/en/zend.creating.php" rel="nofollow" target="_blank">http://php.us.themoes.org/manual/en/zend.creating.php</a></span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="41697""></a>
  <div class="note">
   <strong class="user">me at nullflux dot com</strong>
   <a href="#41697" class="date">20-Apr-2004 01:27</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
The w32api extension -does not- work on versions of php that are not between 4.2.0 and 4.2.3. This is mentioned on the individual function's manual pages, but not on the extension's main page. Perhaps I'm just missing something, but if you want to interact with the Win32 API via PHP you have to use an outdated version, or just not bother with it at all.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="39181""></a>
  <div class="note">
   <strong class="user">Philip Soeberg</strong>
   <a href="#39181" class="date">20-Jan-2004 05:09</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
In response to post by Jan Kleinsorge.<br />
<br />
To get the proper windows system uptime, one should use the Performance Monitoring system... GetTickCount is limited to 49.7 days, as the result is a dword.<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">if (!</span><span class="default">dl</span><span class="keyword">(</span><span class="string">"php_w32api.dll"</span><span class="keyword">)) {<br />
&nbsp; echo </span><span class="string">"Unable to load php_w32api.dll"</span><span class="keyword">;<br />
&nbsp; exit;<br />
}<br />
<br />
</span><span class="default">$api </span><span class="keyword">= new </span><span class="default">win32</span><span class="keyword">;<br />
</span><span class="default">$api</span><span class="keyword">-&gt;</span><span class="default">registerfunction</span><span class="keyword">(</span><span class="string">"bool QueryPerformanceCounter (float &amp;lpPerformanceCount) From kernel32.dll"</span><span class="keyword">);<br />
</span><span class="default">$api</span><span class="keyword">-&gt;</span><span class="default">registerfunction</span><span class="keyword">(</span><span class="string">"bool QueryPerformanceFrequency (float &amp;lpPerformanceFrequency) From kernel32.dll"</span><span class="keyword">);<br />
<br />
</span><span class="default">$api</span><span class="keyword">-&gt;</span><span class="default">QueryPerformanceCounter</span><span class="keyword">(</span><span class="default">$a</span><span class="keyword">);<br />
</span><span class="default">$api</span><span class="keyword">-&gt;</span><span class="default">QueryPerformanceFrequency</span><span class="keyword">(</span><span class="default">$b</span><span class="keyword">);<br />
</span><span class="default">$c </span><span class="keyword">= </span><span class="default">$a</span><span class="keyword">/</span><span class="default">$b</span><span class="keyword">;<br />
</span><span class="default">$days </span><span class="keyword">= </span><span class="default">floor</span><span class="keyword">(</span><span class="default">$c </span><span class="keyword">/ </span><span class="default">86400</span><span class="keyword">);<br />
echo </span><span class="default">gmstrftime</span><span class="keyword">(</span><span class="string">"System uptime is </span><span class="default">$days</span><span class="string"> Days, %H Hr, %M Min, %S Sec&lt;br&gt;"</span><span class="keyword">, </span><span class="default">$c</span><span class="keyword">);<br />
</span><span class="default">?&gt;<br />
</span><br />
The above snippet will return the true uptime for an unlimited time for a windows OS. (Disregarding the fact that windows needs reboot every 10 days or so :))<br />
A tiny dange though is the lack of 64bit variable types in php.. (the "float &amp;lpPerformanceCount" should be "long long &amp;lpPerformanceCount") .. Nevertheless.. It works :)<br />
<br />
Philip S.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="38690""></a>
  <div class="note">
   <strong class="user">Jan Kleinsorge</strong>
   <a href="#38690" class="date">03-Jan-2004 02:55</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Or google for "win32.hlp". Almost every API-function is listed in there.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="35216""></a>
  <div class="note">
   
   <a href="#35216" class="date">23-Aug-2003 10:42</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
The small, unofficial documentation is now available here <a href="http://wobster.mynnga.de/w32api.txt ." rel="nofollow" target="_blank">http://wobster.mynnga.de/w32api.txt .</a><br />
The old link from the post above is dead.<br />
<br />
Note that the W32API doesn't seem to be under development anymore. E-Mails to the author stayed unanswered.<br />
If you really have to use it, just some hints here: There are often problems concerning Apache webservers. This extension doesn't seem to work with mod_php.<br />
I used the API on IIS5 with PHP as CGI. Additionally the IUSR_&lt;hostname&gt; (that's the user IIS runs php.exe by default) might need additional rights to be able to call certain API-functions.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="33496""></a>
  <div class="note">
   <strong class="user">silver_dragoon77 at hotmail dot com</strong>
   <a href="#33496" class="date">27-Jun-2003 09:03</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
hi<br />
<br />
for phpgtk users, who might want to add some sound to their apps, here is the code, assuming ding.wav is in the script's directory<br />
<br />
$api = new win32;<br />
$api-&gt;registerfunction("long sndPlaySound (string a, int b) From winmm.dll");<br />
$api-&gt;sndPlaySound("ding.wav", 0);<br />
<br />
you can use the big win32.hlp file containing the win32 api reference to get some other multimedia functions<br />
<br />
regards</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="30826""></a>
  <div class="note">
   <strong class="user">wobble at gmx dot de</strong>
   <a href="#30826" class="date">31-Mar-2003 10:09</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I played a bit around with the W32API. Here is some code that actually works with the current release of W32API.<br />
The interface changed completely, so all documentation about this extension is out-dated. While the old release<br />
just implemented "plain" functions, the current version offers a class to handle all the API-related operations. <br />
Additionally, functions are now registered using a SQL-like language with a single string.<br />
<br />
<span class="default">&lt;?php<br />
<br />
$api </span><span class="keyword">= new </span><span class="default">win32</span><span class="keyword">;<br />
<br />
</span><span class="comment">/*<br />
&nbsp;&nbsp; &nbsp; BOOL GetUserName(<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; LPTSTR lpBuffer,&nbsp; &nbsp; // address of name buffer<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; LPDWORD nSize&nbsp; &nbsp; &nbsp;&nbsp; // address of size of name buffer<br />
&nbsp;&nbsp; &nbsp; );<br />
&nbsp;&nbsp;&nbsp; Returns the current thread's username<br />
&nbsp;&nbsp;&nbsp; "&amp;" passes argument as "refrence" not as "copy"<br />
*/<br />
</span><span class="default">$api</span><span class="keyword">-&gt;</span><span class="default">registerfunction</span><span class="keyword">(</span><span class="string">"long GetUserName (string &amp;a, int &amp;b) From advapi32.dll"</span><span class="keyword">);<br />
<br />
</span><span class="comment">/*<br />
&nbsp;&nbsp;&nbsp; DWORD GetTickCount(VOID)<br />
&nbsp;&nbsp;&nbsp; Returns the ms the OS is running<br />
*/<br />
</span><span class="default">$api</span><span class="keyword">-&gt;</span><span class="default">registerfunction</span><span class="keyword">(</span><span class="string">"long GetTickCount () From Kernel32.dll"</span><span class="keyword">);<br />
<br />
</span><span class="default">$len </span><span class="keyword">= </span><span class="default">255</span><span class="keyword">;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// set the length your variable should have<br />
</span><span class="default">$name </span><span class="keyword">= </span><span class="default">str_repeat</span><span class="keyword">(</span><span class="string">"\0"</span><span class="keyword">, </span><span class="default">$len</span><span class="keyword">); </span><span class="comment">// prepare an empty string<br />
</span><span class="keyword">if (</span><span class="default">$api</span><span class="keyword">-&gt;</span><span class="default">GetUserName</span><span class="keyword">(</span><span class="default">$name</span><span class="keyword">, </span><span class="default">$len</span><span class="keyword">) == </span><span class="default">0</span><span class="keyword">)<br />
{<br />
&nbsp;&nbsp;&nbsp; die(</span><span class="string">"failed"</span><span class="keyword">);<br />
}<br />
<br />
if (!(</span><span class="default">$time </span><span class="keyword">= </span><span class="default">$api</span><span class="keyword">-&gt;</span><span class="default">GetTickCount</span><span class="keyword">()))<br />
{<br />
&nbsp;&nbsp;&nbsp; die(</span><span class="string">"failed"</span><span class="keyword">);<br />
}<br />
<br />
echo </span><span class="string">"Username: </span><span class="default">$name</span><span class="string">&lt;br&gt;\nSystemtime: </span><span class="default">$time</span><span class="string">&lt;br&gt;\n"</span><span class="keyword">;<br />
<br />
</span><span class="default">?&gt;<br />
</span><br />
GOOD LUCK !!<br />
<br />
Jan Kleinsorge</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="24079""></a>
  <div class="note">
   <strong class="user">arunasphp at anm dot org</strong>
   <a href="#24079" class="date">06-Aug-2002 10:32</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
In order to use most (perhaps all?) of the win32 API while running with a web server you have to give the server service permission to interact with the desktop.&nbsp; This is especially noticeable with the given example, where the script will try to display message boxes on the server's display.<br />
<br />
Keep in mind, however, that you should think hard about the consequences of letting a web server interact with your desktop, especially if you're not the only one using the web server.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
</div>
</div>
<hr /><div class="manualnavbar" style="text-align: center;">
 <div class="prev" style="text-align: left; float: left;"><a href="w32api.examples-uptime.html">w32api の例</a></div>
 <div class="next" style="text-align: right; float: right;"><a href="function.w32api-deftype.html">w32api_deftype</a></div>
 <div class="up"><a href="book.w32api.html">W32api</a></div>
 <div class="home"><a href="index.html">PHP Manual</a></div>
</div></body></html>
