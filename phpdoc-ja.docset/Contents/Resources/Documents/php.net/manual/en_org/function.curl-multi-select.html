<html><!-- Mirrored from php.net/manual/en/function.curl-multi-select.php by HTTrack Website Copier/3.x [XR&CO'2013], Thu, 28 Aug 2014 16:40:52 GMT --><!-- Added by HTTrack --><head><meta http-equiv="content-type" content="text/html;charset=utf-8"><!-- /Added by HTTrack -->


  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0"> 

  <title>curl_multi_select</title>

 <link rel="shortcut icon" href="../../favicon.ico">
 <link rel="search" type="application/opensearchdescription+xml" href="http://php.net/phpnetimprovedsearch.src" title="Add PHP.net search">
 <link rel="alternate" type="application/atom+xml" href="http://php.net/releases/feed.php" title="PHP Release feed">
 <link rel="alternate" type="application/atom+xml" href="http://php.net/feed.atom" title="PHP: Hypertext Preprocessor">

 <link rel="canonical" href="function.curl-multi-select.html">
 <link rel="shorturl" href="http://php.net/curl-multi-select">
 <link rel="alternate" href="http://php.net/curl-multi-select" hreflang="x-default">

 <link rel="contents" href="index-2.html">
 <link rel="index" href="ref.curl.html">
 <link rel="prev" href="function.curl-multi-remove-handle.html">
 <link rel="next" href="function.curl-multi-setopt.html">

 <link rel="alternate" href="function.curl-multi-select.html" hreflang="en">
 <link rel="alternate" href="http://php.net/manual/pt_BR/function.curl-multi-select.php" hreflang="pt_BR">
 <link rel="alternate" href="http://php.net/manual/zh/function.curl-multi-select.php" hreflang="zh">
 <link rel="alternate" href="http://php.net/manual/fr/function.curl-multi-select.php" hreflang="fr">
 <link rel="alternate" href="http://php.net/manual/de/function.curl-multi-select.php" hreflang="de">
 <link rel="alternate" href="http://php.net/manual/it/function.curl-multi-select.php" hreflang="it">
 <link rel="alternate" href="http://php.net/manual/ja/function.curl-multi-select.php" hreflang="ja">
 <link rel="alternate" href="http://php.net/manual/ro/function.curl-multi-select.php" hreflang="ro">
 <link rel="alternate" href="http://php.net/manual/ru/function.curl-multi-select.php" hreflang="ru">
 <link rel="alternate" href="http://php.net/manual/es/function.curl-multi-select.php" hreflang="es">
 <link rel="alternate" href="http://php.net/manual/tr/function.curl-multi-select.php" hreflang="tr">

<link rel="stylesheet" type="text/css" href="../../cached8fe1.css?t=1401250819&amp;f=/fonts/Fira/fira.css" media="screen">
<link rel="stylesheet" type="text/css" href="../../cached4b8d.css?t=1404368420&amp;f=/fonts/Font-Awesome/css/fontello.css" media="screen">
<link rel="stylesheet" type="text/css" href="../../cached5065.css?t=1403329232&amp;f=/styles/theme-base.css" media="screen">
<link rel="stylesheet" type="text/css" href="../../cachedc78d.css?t=1401249623&amp;f=/styles/theme-medium.css" media="screen">

 <!--[if lte IE 7]>
 <link rel="stylesheet" type="text/css" href="http://php.net/styles/workarounds.ie7.css" media="screen">
 <![endif]-->

 <!--[if lte IE 8]>
 <script type="text/javascript">
  window.brokenIE = true;
 </script>
 <![endif]-->

 <!--[if lte IE 9]>
 <link rel="stylesheet" type="text/css" href="http://php.net/styles/workarounds.ie9.css" media="screen">
 <![endif]-->

 <!--[if IE]>
 <script type="text/javascript" src="http://php.net/js/ext/html5.js"></script>
 <![endif]-->

 <base>

</head>
<body class="docs " style="">


<div class="headsup"><a href="http://php.net/index.php#id2014-08-28-1">PHP 5.6.0 released</a></div>
<nav id="trick"><div><dl>
<dt><a href="getting-started.html">Getting Started</a></dt>
	<dd><a href="introduction.html">Introduction</a></dd>
	<dd><a href="tutorial.html">A simple tutorial</a></dd>
<dt><a href="langref.html">Language Reference</a></dt>
	<dd><a href="language.basic-syntax.html">Basic syntax</a></dd>
	<dd><a href="language.types.html">Types</a></dd>
	<dd><a href="language.variables.html">Variables</a></dd>
	<dd><a href="language.constants.html">Constants</a></dd>
	<dd><a href="language.expressions.html">Expressions</a></dd>
	<dd><a href="language.operators.html">Operators</a></dd>
	<dd><a href="language.control-structures.html">Control Structures</a></dd>
	<dd><a href="language.functions.html">Functions</a></dd>
	<dd><a href="language.oop5.html">Classes and Objects</a></dd>
	<dd><a href="language.namespaces.html">Namespaces</a></dd>
	<dd><a href="language.exceptions.html">Exceptions</a></dd>
	<dd><a href="language.generators.html">Generators</a></dd>
	<dd><a href="language.references.html">References Explained</a></dd>
	<dd><a href="reserved.variables.html">Predefined Variables</a></dd>
	<dd><a href="reserved.exceptions.html">Predefined Exceptions</a></dd>
	<dd><a href="reserved.interfaces.html">Predefined Interfaces and Classes</a></dd>
	<dd><a href="context.html">Context options and parameters</a></dd>
	<dd><a href="wrappers.html">Supported Protocols and Wrappers</a></dd>
</dl>
<dl>
<dt><a href="security.html">Security</a></dt>
	<dd><a href="security.intro.html">Introduction</a></dd>
	<dd><a href="security.general.html">General considerations</a></dd>
	<dd><a href="security.cgi-bin.html">Installed as CGI binary</a></dd>
	<dd><a href="security.apache.html">Installed as an Apache module</a></dd>
	<dd><a href="security.filesystem.html">Filesystem Security</a></dd>
	<dd><a href="security.database.html">Database Security</a></dd>
	<dd><a href="security.errors.html">Error Reporting</a></dd>
	<dd><a href="security.globals.html">Using Register Globals</a></dd>
	<dd><a href="security.variables.html">User Submitted Data</a></dd>
	<dd><a href="security.magicquotes.html">Magic Quotes</a></dd>
	<dd><a href="security.hiding.html">Hiding PHP</a></dd>
	<dd><a href="security.current.html">Keeping Current</a></dd>
<dt><a href="features.html">Features</a></dt>
	<dd><a href="features.http-auth.html">HTTP authentication with PHP</a></dd>
	<dd><a href="features.cookies.html">Cookies</a></dd>
	<dd><a href="features.sessions.html">Sessions</a></dd>
	<dd><a href="features.xforms.html">Dealing with XForms</a></dd>
	<dd><a href="features.file-upload.html">Handling file uploads</a></dd>
	<dd><a href="features.remote-files.html">Using remote files</a></dd>
	<dd><a href="features.connection-handling.html">Connection handling</a></dd>
	<dd><a href="features.persistent-connections.html">Persistent Database Connections</a></dd>
	<dd><a href="features.safe-mode.html">Safe Mode</a></dd>
	<dd><a href="features.commandline.html">Command line usage</a></dd>
	<dd><a href="features.gc.html">Garbage Collection</a></dd>
	<dd><a href="features.dtrace.html">DTrace Dynamic Tracing</a></dd>
</dl>
<dl>
<dt><a href="funcref.html">Function Reference</a></dt>
	<dd><a href="refs.basic.php.html">Affecting PHP's Behaviour</a></dd>
	<dd><a href="refs.utilspec.audio.html">Audio Formats Manipulation</a></dd>
	<dd><a href="refs.remote.auth.html">Authentication Services</a></dd>
	<dd><a href="refs.utilspec.cmdline.html">Command Line Specific Extensions</a></dd>
	<dd><a href="refs.compression.html">Compression and Archive Extensions</a></dd>
	<dd><a href="refs.creditcard.html">Credit Card Processing</a></dd>
	<dd><a href="refs.crypto.html">Cryptography Extensions</a></dd>
	<dd><a href="refs.database.html">Database Extensions</a></dd>
	<dd><a href="refs.calendar.html">Date and Time Related Extensions</a></dd>
	<dd><a href="refs.fileprocess.file.html">File System Related Extensions</a></dd>
	<dd><a href="refs.international.html">Human Language and Character Encoding Support</a></dd>
	<dd><a href="refs.utilspec.image.html">Image Processing and Generation</a></dd>
	<dd><a href="refs.remote.mail.html">Mail Related Extensions</a></dd>
	<dd><a href="refs.math.html">Mathematical Extensions</a></dd>
	<dd><a href="refs.utilspec.nontext.html">Non-Text MIME Output</a></dd>
	<dd><a href="refs.fileprocess.process.html">Process Control Extensions</a></dd>
	<dd><a href="refs.basic.other.html">Other Basic Extensions</a></dd>
	<dd><a href="refs.remote.other.html">Other Services</a></dd>
	<dd><a href="refs.search.html">Search Engine Extensions</a></dd>
	<dd><a href="refs.utilspec.server.html">Server Specific Extensions</a></dd>
	<dd><a href="refs.basic.session.html">Session Extensions</a></dd>
	<dd><a href="refs.basic.text.html">Text Processing</a></dd>
	<dd><a href="refs.basic.vartype.html">Variable and Type Related Extensions</a></dd>
	<dd><a href="refs.webservice.html">Web Services</a></dd>
	<dd><a href="refs.utilspec.windows.html">Windows Only Extensions</a></dd>
	<dd><a href="refs.xml.html">XML Manipulation</a></dd>
</dl>
<dl>
<dt>Keyboard Shortcuts</dt><dt>?</dt>
<dd>This help</dd>
<dt>j</dt>
<dd>Next menu item</dd>
<dt>k</dt>
<dd>Previous menu item</dd>
<dt>g p</dt>
<dd>Previous man page</dd>
<dt>g n</dt>
<dd>Next man page</dd>
<dt>G</dt>
<dd>Scroll to bottom</dd>
<dt>g g</dt>
<dd>Scroll to top</dd>
<dt>g h</dt>
<dd>Goto homepage</dd>
<dt>g s</dt>
<dd>Goto search<br>(current page)</dd>
<dt>/</dt>
<dd>Focus search box</dd>
</dl></div></nav>
<div id="goto">
    <div class="search">
         <div class="text"></div>
         <div class="results"><ul></ul></div>
   </div>
</div>

  <div id="breadcrumbs" class="row-fluid">
          
              
        <ul class="breadcrumbs-container">
            <li><a href="index-2.html">PHP Manual</a></li>      <li><a href="funcref.html">Function Reference</a></li>      <li><a href="refs.remote.other.html">Other Services</a></li>      <li><a href="book.curl.html">cURL</a></li>      <li><a href="ref.curl.html">cURL Functions</a></li>    </ul>
  </div>




<div id="layout">
  <section id="layout-content">
  <div id="function.curl-multi-select" class="refentry">
 <div class="refnamediv">
  <h1 class="refname">curl_multi_select</h1>
  <p class="verinfo">(PHP 5)</p><p class="refpurpose"><span class="refname">curl_multi_select</span> â€” <span class="dc-title">Wait for activity on any curl_multi connection</span></p>

 </div>
 
 <div class="refsect1 description" id="refsect1-function.curl-multi-select-description">
  <h3 class="title">Description</h3>
  <div class="methodsynopsis dc-description">
   <span class="type">int</span> <span class="methodname"><strong>curl_multi_select</strong></span>
    ( <span class="methodparam"><span class="type">resource</span> <code class="parameter">$mh</code></span>
   [, <span class="methodparam"><span class="type">float</span> <code class="parameter">$timeout</code><span class="initializer"> = 1.0</span></span>
  ] )</div>

  <p class="para rdfs-comment">
    Blocks until there is activity on any of the curl_multi connections.
  </p>

 </div>


 <div class="refsect1 parameters" id="refsect1-function.curl-multi-select-parameters">
  <h3 class="title">Parameters</h3>
  <p class="para">
   </p><dl>

    <dt>
<code class="parameter">mh</code>
</dt>
<dd>
<p class="para">A cURL multi handle returned by
<span class="function"><a href="function.curl-multi-init.html" class="function">curl_multi_init()</a></span>.</p></dd>

    
     <dt>
<code class="parameter">timeout</code></dt>

     <dd>

      <p class="para">
       Time, in seconds, to wait for a response.
      </p>
     </dd>

    
   </dl>

  <p></p>
 </div>

 
 <div class="refsect1 returnvalues" id="refsect1-function.curl-multi-select-returnvalues">
  <h3 class="title">Return Values</h3>
  <p class="para">
   On success, returns the number of descriptors contained in 
   the descriptor sets.  On failure, this function will return -1 on a select failure or timeout (from the underlying select system call).
  </p>
 </div>


 <div class="refsect1 seealso" id="refsect1-function.curl-multi-select-seealso">
  <h3 class="title">See Also</h3>
  <p class="para">
   </p><ul class="simplelist">
    <li class="member"><span class="function"><a href="function.curl-multi-init.html" class="function" rel="rdfs-seeAlso">curl_multi_init()</a> - Returns a new cURL multi handle</span></li>
   </ul>
  <p></p>
 </div>


</div>
<section id="usernotes">
 <div class="head"><h3 class="title">User Contributed Notes</h3></div><div id="allnotes">
  <div class="note" id="108928">  
  <a class="name">
  <strong class="user"><em>vigo dot von dot harrach at gmx dot de</em></strong></a><div class="date" title="2012-06-06 10:53"><strong>2 years ago</strong></div>
  <div class="text" id="Hcom108928">
<div class="phpcode"><code><span class="html">
curl_multi_select($mh, $timeout) simply blocks for $timeout seconds while curl_multi_exec() returns CURLM_CALL_MULTI_PERFORM. Otherwise, it works as intended, and blocks until at least one connection has completed or $timeout seconds, whatever happens first.
<br>
<br>For that reason, curl_multi_exec() should always be wrapped:
<br>
<br><span class="default">&lt;?php
<br>&nbsp; </span><span class="keyword">function </span><span class="default">full_curl_multi_exec</span><span class="keyword">(</span><span class="default">$mh</span><span class="keyword">, &amp;</span><span class="default">$still_running</span><span class="keyword">) {
<br>&nbsp; &nbsp; do {
<br>&nbsp; &nbsp; &nbsp; </span><span class="default">$rv </span><span class="keyword">= </span><span class="default">curl_multi_exec</span><span class="keyword">(</span><span class="default">$mh</span><span class="keyword">, </span><span class="default">$still_running</span><span class="keyword">);
<br>&nbsp; &nbsp; } while (</span><span class="default">$rv </span><span class="keyword">== </span><span class="default">CURLM_CALL_MULTI_PERFORM</span><span class="keyword">);
<br>&nbsp; &nbsp; return </span><span class="default">$rv</span><span class="keyword">;
<br>&nbsp; }
<br></span><span class="default">?&gt;
<br></span>
<br>With that, the core of "multi" processing becomes (ignoring error handling for brevity):
<br>
<br><span class="default">&lt;?php
<br>&nbsp; full_curl_multi_exec</span><span class="keyword">(</span><span class="default">$mh</span><span class="keyword">, </span><span class="default">$still_running</span><span class="keyword">); </span><span class="comment">// start requests
<br>&nbsp; </span><span class="keyword">do { </span><span class="comment">// "wait for completion"-loop
<br>&nbsp; &nbsp; </span><span class="default">curl_multi_select</span><span class="keyword">(</span><span class="default">$mh</span><span class="keyword">); </span><span class="comment">// non-busy (!) wait for state change
<br>&nbsp; &nbsp; </span><span class="default">full_curl_multi_exec</span><span class="keyword">(</span><span class="default">$mh</span><span class="keyword">, </span><span class="default">$still_running</span><span class="keyword">); </span><span class="comment">// get new state
<br>&nbsp; &nbsp; </span><span class="keyword">while (</span><span class="default">$info </span><span class="keyword">= </span><span class="default">curl_multi_info_read</span><span class="keyword">(</span><span class="default">$mh</span><span class="keyword">)) {
<br>&nbsp; &nbsp; &nbsp; </span><span class="comment">// process completed request (e.g. curl_multi_getcontent($info['handle']))
<br>&nbsp; &nbsp; </span><span class="keyword">}
<br>&nbsp; } while (</span><span class="default">$still_running</span><span class="keyword">);
<br></span><span class="default">?&gt;
<br></span>
<br>Note that after starting requests, retrieval is done in the background - one of the better shots at parallel processing in PHP.</span>
</code></div>
  </div>
 </div>
  <div class="note" id="110869">  
  <a class="name">
  <strong class="user"><em>Alex Palmer</em></strong></a><div class="date" title="2012-12-17 04:08"><strong>1 year ago</strong></div>
  <div class="text" id="Hcom110869">
<div class="phpcode"><code><span class="html">
On php 5.3.18+ be aware that curl_multi_select() may return -1 forever until you call curl_multi_exec().<br>See https://bugs.php.net/bug.php?id=63411 for more information.</span>
</code></div>
  </div>
 </div>
  <div class="note" id="85010">  
  <a class="name">
  <strong class="user"><em>public at grik dot net</em></strong></a><div class="date" title="2008-08-10 06:38"><strong>6 years ago</strong></div>
  <div class="text" id="Hcom85010">
<div class="phpcode"><code><span class="html">
This function blocks the calling process until there is activity on any of the connections opened by the curl_multi interface, or until the timeout period has expired. <br>In other words, it waits for data to be received in the opened connections.<br><br>Internally it fetches socket pointers with "curl_multi_fdset()" and runs the "select()" C function.<br>It returns in 3 cases:<br>1. Activity is detected on any socket;<br>2. Timeout has ended (second parameter);<br>3. Process received any signal (#man kill).<br><br>The function returns an integer:<br>* In case of activity it returns a number, usually 1.<br>I suppose, it returns the number of connections with activity detected.<br>* If timeout expires it returns 0<br>* In case of error it returns -1<br><br>Thanks for attention, hope this helps.</span>
</code></div>
  </div>
 </div>
  <div class="note" id="115381">  
  <a class="name">
  <strong class="user"><em>nevil85 at gmail dot com</em></strong></a><div class="date" title="2014-07-15 04:06"><strong>1 month ago</strong></div>
  <div class="text" id="Hcom115381">
<div class="phpcode"><code><span class="html">
Even after so many distro releases, in PHP v5.5.9 and libcurl v7.35.0, curl_multi_select still returns -1. The only work around here is to wait and proceed like nothing ever happened. You have to determine the "wait" required here. <br><br>In my application a very small interval like usleep(1) worked. For example:<br><br><span class="default">&lt;?php<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="comment">// While we're still active, execute curl<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$active </span><span class="keyword">= </span><span class="default">null</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; do {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$mrc </span><span class="keyword">= </span><span class="default">curl_multi_exec</span><span class="keyword">(</span><span class="default">$multi</span><span class="keyword">, </span><span class="default">$active</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; } while (</span><span class="default">$mrc </span><span class="keyword">== </span><span class="default">CURLM_CALL_MULTI_PERFORM</span><span class="keyword">);<br>&nbsp; &nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; while (</span><span class="default">$active </span><span class="keyword">&amp;&amp; </span><span class="default">$mrc </span><span class="keyword">== </span><span class="default">CURLM_OK</span><span class="keyword">) {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="comment">// Wait for activity on any curl-connection<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="keyword">if (</span><span class="default">curl_multi_select</span><span class="keyword">(</span><span class="default">$multi</span><span class="keyword">) == -</span><span class="default">1</span><span class="keyword">) {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">usleep</span><span class="keyword">(</span><span class="default">1</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br>&nbsp; &nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="comment">// Continue to exec until curl is ready to<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; // give us more data<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="keyword">do {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$mrc </span><span class="keyword">= </span><span class="default">curl_multi_exec</span><span class="keyword">(</span><span class="default">$multi</span><span class="keyword">, </span><span class="default">$active</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; } while (</span><span class="default">$mrc </span><span class="keyword">== </span><span class="default">CURLM_CALL_MULTI_PERFORM</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; }<br></span><span class="default">?&gt;<br></span><br>Internally php curl_multi_select uses libcurl curl_multi_fdset function and its libcurl documentation says :<br><a rel="nofollow" target="_blank">http://curl.haxx.se/libcurl/c/curl_multi_fdset.html</a><br><br>"When libcurl returns -1 in max_fd, it is because libcurl currently does something that isn't possible for your application to monitor with a socket and unfortunately you can then not know exactly when the current action is completed using select(). When max_fd returns with -1, you need to wait a while and then proceed and call curl_multi_perform anyway. How long to wait? I would suggest 100 milliseconds at least, but you may want to test it out in your own particular conditions to find a suitable value. <br><br>When doing select(), you should use curl_multi_timeout to figure out how long to wait for action."<br><br>Untill PHP implements curl_multi_timeout() we have to play with our application and determine the "wait".</span>
</code></div>
  </div>
 </div>
  <div class="note" id="113355">  
  <a class="name">
  <strong class="user"><em>Anonymous</em></strong></a><div class="date" title="2013-09-30 08:55"><strong>10 months ago</strong></div>
  <div class="text" id="Hcom113355">
<div class="phpcode"><code><span class="html">
In 5.3.9+, curl_multi_select always returns -1. If this is your case, just wait a bit and then proceed like nothing ever happened:<br><span class="default">&lt;?php<br></span><span class="keyword">do {&nbsp; <br>&nbsp; &nbsp; </span><span class="default">$mrc </span><span class="keyword">= </span><span class="default">curl_multi_exec</span><span class="keyword">(</span><span class="default">$multi</span><span class="keyword">, </span><span class="default">$active</span><span class="keyword">);&nbsp; <br>} while (</span><span class="default">$mrc </span><span class="keyword">== </span><span class="default">CURLM_CALL_MULTI_PERFORM</span><span class="keyword">);&nbsp; <br>&nbsp; &nbsp; <br>while (</span><span class="default">$active </span><span class="keyword">&amp;&amp; </span><span class="default">$mrc </span><span class="keyword">== </span><span class="default">CURLM_OK</span><span class="keyword">) {<br>&nbsp; &nbsp; </span><span class="comment">//check for results and execute until everything is done<br><br>&nbsp; &nbsp; </span><span class="keyword">if (</span><span class="default">curl_multi_select</span><span class="keyword">(</span><span class="default">$multi</span><span class="keyword">) == -</span><span class="default">1</span><span class="keyword">) {<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="comment">//if it returns -1, wait a bit, but go forward anyways!<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">usleep</span><span class="keyword">(</span><span class="default">100</span><span class="keyword">); <br>&nbsp; &nbsp; }<br>&nbsp; &nbsp; <br>&nbsp; &nbsp; </span><span class="comment">//do something with the return values<br>&nbsp; &nbsp; </span><span class="keyword">while((</span><span class="default">$info </span><span class="keyword">= </span><span class="default">curl_multi_info_read</span><span class="keyword">(</span><span class="default">$multi</span><span class="keyword">)) !== </span><span class="default">false</span><span class="keyword">){<br>&nbsp; &nbsp; &nbsp; &nbsp; if (</span><span class="default">$info</span><span class="keyword">[</span><span class="string">"result"</span><span class="keyword">] == </span><span class="default">CURLE_OK</span><span class="keyword">){<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$content </span><span class="keyword">= </span><span class="default">curl_multi_getcontent</span><span class="keyword">(</span><span class="default">$info</span><span class="keyword">[</span><span class="string">"handle"</span><span class="keyword">]);<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">do_something</span><span class="keyword">(</span><span class="default">$content</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; }<br>&nbsp; &nbsp; }<br>&nbsp; &nbsp; do {&nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$mrc </span><span class="keyword">= </span><span class="default">curl_multi_exec</span><span class="keyword">(</span><span class="default">$multi</span><span class="keyword">, </span><span class="default">$active</span><span class="keyword">);&nbsp; <br>&nbsp; &nbsp; } while (</span><span class="default">$mrc </span><span class="keyword">== </span><span class="default">CURLM_CALL_MULTI_PERFORM</span><span class="keyword">);&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br>}<br></span><span class="default">?&gt;</span>
</span>
</code></div>
  </div>
 </div>
  <div class="note" id="115054">  
  <a class="name">
  <strong class="user"><em>xxavalanchexx at gmail dot com</em></strong></a><div class="date" title="2014-05-20 12:13"><strong>3 months ago</strong></div>
  <div class="text" id="Hcom115054">
<div class="phpcode"><code><span class="html">
According to https://bugs.php.net/bug.php?id=61141:<br><br>On Windows setups using libcurl version 7.24 or later (which seems to correspond to PHP 5.3.10 or later), you may find that this always returns -1. This is, apparently, not strictly a bug: according to the libcurl documentation, you should add your own sleep if curl_multi_select returns -1.<br><br>For example:<br><span class="default">&lt;?php<br></span><span class="comment">/* setup $mh */<br><br></span><span class="default">$active </span><span class="keyword">= </span><span class="default">null</span><span class="keyword">;<br>do {<br>&nbsp; &nbsp; </span><span class="default">$mrc </span><span class="keyword">= </span><span class="default">curl_multi_exec</span><span class="keyword">(</span><span class="default">$mh</span><span class="keyword">, </span><span class="default">$active</span><span class="keyword">);<br>} while (</span><span class="default">$mrc </span><span class="keyword">== </span><span class="default">CURLM_CALL_MULTI_PERFORM</span><span class="keyword">);<br><br>while (</span><span class="default">$active </span><span class="keyword">&amp;&amp; </span><span class="default">$mrc </span><span class="keyword">== </span><span class="default">CURLM_OK</span><span class="keyword">) {<br>&nbsp; &nbsp; if (</span><span class="default">curl_multi_select</span><span class="keyword">(</span><span class="default">$mh</span><span class="keyword">) == -</span><span class="default">1</span><span class="keyword">) {<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">usleep</span><span class="keyword">(</span><span class="default">100</span><span class="keyword">);<br>&nbsp; &nbsp; }<br>&nbsp; &nbsp; do {<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$mrc </span><span class="keyword">= </span><span class="default">curl_multi_exec</span><span class="keyword">(</span><span class="default">$mh</span><span class="keyword">, </span><span class="default">$active</span><span class="keyword">);<br>&nbsp; &nbsp; } while (</span><span class="default">$mrc </span><span class="keyword">== </span><span class="default">CURLM_CALL_MULTI_PERFORM</span><span class="keyword">);<br>}<br><br></span><span class="comment">/* close $mh */<br></span><span class="default">?&gt;</span>
</span>
</code></div>
  </div>
 </div>
  <div class="note" id="99052">  
  <a class="name">
  <strong class="user"><em>Anonymous</em></strong></a><div class="date" title="2010-07-24 08:33"><strong>4 years ago</strong></div>
  <div class="text" id="Hcom99052">
<div class="phpcode"><code><span class="html">
Since the docs are still lacking, here's an example of how to use the function. The following code will keep checking all active threads until one of them returns the HTTP 200 Ok status code, or simply end. On success, it will return the URL that worked.<br><br><span class="default">&lt;?php<br>$running</span><span class="keyword">=</span><span class="default">null</span><span class="keyword">;<br>do {<br>&nbsp; &nbsp; </span><span class="default">curl_multi_exec</span><span class="keyword">(</span><span class="default">$mh</span><span class="keyword">,</span><span class="default">$running</span><span class="keyword">);<br>&nbsp; &nbsp; </span><span class="default">$ready</span><span class="keyword">=</span><span class="default">curl_multi_select</span><span class="keyword">(</span><span class="default">$mh</span><span class="keyword">); </span><span class="comment">// this will pause the loop<br>&nbsp; &nbsp; </span><span class="keyword">if(</span><span class="default">$ready</span><span class="keyword">&gt;</span><span class="default">0</span><span class="keyword">){<br>&nbsp; &nbsp; &nbsp; &nbsp; while(</span><span class="default">$info</span><span class="keyword">=</span><span class="default">curl_multi_info_read</span><span class="keyword">(</span><span class="default">$mh</span><span class="keyword">)){<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$status</span><span class="keyword">=</span><span class="default">curl_getinfo</span><span class="keyword">(</span><span class="default">$info</span><span class="keyword">[</span><span class="string">'handle'</span><span class="keyword">],</span><span class="default">CURLINFO_HTTP_CODE</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if(</span><span class="default">$status</span><span class="keyword">==</span><span class="default">200</span><span class="keyword">){<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$successUrl</span><span class="keyword">=</span><span class="default">curl_getinfo</span><span class="keyword">(</span><span class="default">$info</span><span class="keyword">[</span><span class="string">'handle'</span><span class="keyword">],</span><span class="default">CURLINFO_EFFECTIVE_URL</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; break </span><span class="default">2</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br>&nbsp; &nbsp; &nbsp; &nbsp; }<br>&nbsp; &nbsp; }<br>} while (</span><span class="default">$running</span><span class="keyword">&gt;</span><span class="default">0 </span><span class="keyword">&amp;&amp; </span><span class="default">$ready</span><span class="keyword">!=-</span><span class="default">1</span><span class="keyword">);<br></span><span class="default">?&gt;<br></span><br>The question for the $ready variable is, if it will return the value before or after the timeout has occurred. From my tests it appears that it will return the value immediately, and only then pause the execution. That's because it's always zero the first time through the loop, even if the time limit is as high as 10sec. I've expected it to wait and only then return the value so that came unexpected to me.<br><br>As stated by someone else, it also doesn't seem to return the overall count of threads in the handle, but only that of the currently active ones.</span>
</code></div>
  </div>
 </div></div>

 
</section>    </section><!-- layout-content -->
        


  </div><!-- layout -->
         
  

    
 <!-- External and third party libraries. -->
 







<a id="toTop" href="javascript:;"><span id="toTopHover"></span><img width="40" height="40" alt="To Top" src="../../images/to-top%402x.png"></a>



<!-- Mirrored from php.net/manual/en/function.curl-multi-select.php by HTTrack Website Copier/3.x [XR&CO'2013], Thu, 28 Aug 2014 16:40:52 GMT -->


</body></html>