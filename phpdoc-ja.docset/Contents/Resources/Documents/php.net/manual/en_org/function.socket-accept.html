<html><!-- Mirrored from php.net/manual/en/function.socket-accept.php by HTTrack Website Copier/3.x [XR&CO'2013], Thu, 28 Aug 2014 16:46:15 GMT --><!-- Added by HTTrack --><head><meta http-equiv="content-type" content="text/html;charset=utf-8"><!-- /Added by HTTrack -->


  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0"> 

  <title>socket_accept</title>

 <link rel="shortcut icon" href="../../favicon.ico">
 <link rel="search" type="application/opensearchdescription+xml" href="http://php.net/phpnetimprovedsearch.src" title="Add PHP.net search">
 <link rel="alternate" type="application/atom+xml" href="http://php.net/releases/feed.php" title="PHP Release feed">
 <link rel="alternate" type="application/atom+xml" href="http://php.net/feed.atom" title="PHP: Hypertext Preprocessor">

 <link rel="canonical" href="function.socket-accept.html">
 <link rel="shorturl" href="http://php.net/socket-accept">
 <link rel="alternate" href="http://php.net/socket-accept" hreflang="x-default">

 <link rel="contents" href="index-2.html">
 <link rel="index" href="ref.sockets.html">
 <link rel="prev" href="ref.sockets.html">
 <link rel="next" href="function.socket-bind.html">

 <link rel="alternate" href="function.socket-accept.html" hreflang="en">
 <link rel="alternate" href="http://php.net/manual/pt_BR/function.socket-accept.php" hreflang="pt_BR">
 <link rel="alternate" href="http://php.net/manual/zh/function.socket-accept.php" hreflang="zh">
 <link rel="alternate" href="http://php.net/manual/fr/function.socket-accept.php" hreflang="fr">
 <link rel="alternate" href="http://php.net/manual/de/function.socket-accept.php" hreflang="de">
 <link rel="alternate" href="http://php.net/manual/it/function.socket-accept.php" hreflang="it">
 <link rel="alternate" href="http://php.net/manual/ja/function.socket-accept.php" hreflang="ja">
 <link rel="alternate" href="http://php.net/manual/ro/function.socket-accept.php" hreflang="ro">
 <link rel="alternate" href="http://php.net/manual/ru/function.socket-accept.php" hreflang="ru">
 <link rel="alternate" href="http://php.net/manual/es/function.socket-accept.php" hreflang="es">
 <link rel="alternate" href="http://php.net/manual/tr/function.socket-accept.php" hreflang="tr">

<link rel="stylesheet" type="text/css" href="../../cached8fe1.css?t=1401250819&amp;f=/fonts/Fira/fira.css" media="screen">
<link rel="stylesheet" type="text/css" href="../../cached4b8d.css?t=1404368420&amp;f=/fonts/Font-Awesome/css/fontello.css" media="screen">
<link rel="stylesheet" type="text/css" href="../../cached5065.css?t=1403329232&amp;f=/styles/theme-base.css" media="screen">
<link rel="stylesheet" type="text/css" href="../../cachedc78d.css?t=1401249623&amp;f=/styles/theme-medium.css" media="screen">

 <!--[if lte IE 7]>
 <link rel="stylesheet" type="text/css" href="http://php.net/styles/workarounds.ie7.css" media="screen">
 <![endif]-->

 <!--[if lte IE 8]>
 <script type="text/javascript">
  window.brokenIE = true;
 </script>
 <![endif]-->

 <!--[if lte IE 9]>
 <link rel="stylesheet" type="text/css" href="http://php.net/styles/workarounds.ie9.css" media="screen">
 <![endif]-->

 <!--[if IE]>
 <script type="text/javascript" src="http://php.net/js/ext/html5.js"></script>
 <![endif]-->

 <base>

</head>
<body class="docs " style="">


<div class="headsup"><a href="http://php.net/index.php#id2014-08-28-1">PHP 5.6.0 released</a></div>
<nav id="trick"><div><dl>
<dt><a href="getting-started.html">Getting Started</a></dt>
	<dd><a href="introduction.html">Introduction</a></dd>
	<dd><a href="tutorial.html">A simple tutorial</a></dd>
<dt><a href="langref.html">Language Reference</a></dt>
	<dd><a href="language.basic-syntax.html">Basic syntax</a></dd>
	<dd><a href="language.types.html">Types</a></dd>
	<dd><a href="language.variables.html">Variables</a></dd>
	<dd><a href="language.constants.html">Constants</a></dd>
	<dd><a href="language.expressions.html">Expressions</a></dd>
	<dd><a href="language.operators.html">Operators</a></dd>
	<dd><a href="language.control-structures.html">Control Structures</a></dd>
	<dd><a href="language.functions.html">Functions</a></dd>
	<dd><a href="language.oop5.html">Classes and Objects</a></dd>
	<dd><a href="language.namespaces.html">Namespaces</a></dd>
	<dd><a href="language.exceptions.html">Exceptions</a></dd>
	<dd><a href="language.generators.html">Generators</a></dd>
	<dd><a href="language.references.html">References Explained</a></dd>
	<dd><a href="reserved.variables.html">Predefined Variables</a></dd>
	<dd><a href="reserved.exceptions.html">Predefined Exceptions</a></dd>
	<dd><a href="reserved.interfaces.html">Predefined Interfaces and Classes</a></dd>
	<dd><a href="context.html">Context options and parameters</a></dd>
	<dd><a href="wrappers.html">Supported Protocols and Wrappers</a></dd>
</dl>
<dl>
<dt><a href="security.html">Security</a></dt>
	<dd><a href="security.intro.html">Introduction</a></dd>
	<dd><a href="security.general.html">General considerations</a></dd>
	<dd><a href="security.cgi-bin.html">Installed as CGI binary</a></dd>
	<dd><a href="security.apache.html">Installed as an Apache module</a></dd>
	<dd><a href="security.filesystem.html">Filesystem Security</a></dd>
	<dd><a href="security.database.html">Database Security</a></dd>
	<dd><a href="security.errors.html">Error Reporting</a></dd>
	<dd><a href="security.globals.html">Using Register Globals</a></dd>
	<dd><a href="security.variables.html">User Submitted Data</a></dd>
	<dd><a href="security.magicquotes.html">Magic Quotes</a></dd>
	<dd><a href="security.hiding.html">Hiding PHP</a></dd>
	<dd><a href="security.current.html">Keeping Current</a></dd>
<dt><a href="features.html">Features</a></dt>
	<dd><a href="features.http-auth.html">HTTP authentication with PHP</a></dd>
	<dd><a href="features.cookies.html">Cookies</a></dd>
	<dd><a href="features.sessions.html">Sessions</a></dd>
	<dd><a href="features.xforms.html">Dealing with XForms</a></dd>
	<dd><a href="features.file-upload.html">Handling file uploads</a></dd>
	<dd><a href="features.remote-files.html">Using remote files</a></dd>
	<dd><a href="features.connection-handling.html">Connection handling</a></dd>
	<dd><a href="features.persistent-connections.html">Persistent Database Connections</a></dd>
	<dd><a href="features.safe-mode.html">Safe Mode</a></dd>
	<dd><a href="features.commandline.html">Command line usage</a></dd>
	<dd><a href="features.gc.html">Garbage Collection</a></dd>
	<dd><a href="features.dtrace.html">DTrace Dynamic Tracing</a></dd>
</dl>
<dl>
<dt><a href="funcref.html">Function Reference</a></dt>
	<dd><a href="refs.basic.php.html">Affecting PHP's Behaviour</a></dd>
	<dd><a href="refs.utilspec.audio.html">Audio Formats Manipulation</a></dd>
	<dd><a href="refs.remote.auth.html">Authentication Services</a></dd>
	<dd><a href="refs.utilspec.cmdline.html">Command Line Specific Extensions</a></dd>
	<dd><a href="refs.compression.html">Compression and Archive Extensions</a></dd>
	<dd><a href="refs.creditcard.html">Credit Card Processing</a></dd>
	<dd><a href="refs.crypto.html">Cryptography Extensions</a></dd>
	<dd><a href="refs.database.html">Database Extensions</a></dd>
	<dd><a href="refs.calendar.html">Date and Time Related Extensions</a></dd>
	<dd><a href="refs.fileprocess.file.html">File System Related Extensions</a></dd>
	<dd><a href="refs.international.html">Human Language and Character Encoding Support</a></dd>
	<dd><a href="refs.utilspec.image.html">Image Processing and Generation</a></dd>
	<dd><a href="refs.remote.mail.html">Mail Related Extensions</a></dd>
	<dd><a href="refs.math.html">Mathematical Extensions</a></dd>
	<dd><a href="refs.utilspec.nontext.html">Non-Text MIME Output</a></dd>
	<dd><a href="refs.fileprocess.process.html">Process Control Extensions</a></dd>
	<dd><a href="refs.basic.other.html">Other Basic Extensions</a></dd>
	<dd><a href="refs.remote.other.html">Other Services</a></dd>
	<dd><a href="refs.search.html">Search Engine Extensions</a></dd>
	<dd><a href="refs.utilspec.server.html">Server Specific Extensions</a></dd>
	<dd><a href="refs.basic.session.html">Session Extensions</a></dd>
	<dd><a href="refs.basic.text.html">Text Processing</a></dd>
	<dd><a href="refs.basic.vartype.html">Variable and Type Related Extensions</a></dd>
	<dd><a href="refs.webservice.html">Web Services</a></dd>
	<dd><a href="refs.utilspec.windows.html">Windows Only Extensions</a></dd>
	<dd><a href="refs.xml.html">XML Manipulation</a></dd>
</dl>
<dl>
<dt>Keyboard Shortcuts</dt><dt>?</dt>
<dd>This help</dd>
<dt>j</dt>
<dd>Next menu item</dd>
<dt>k</dt>
<dd>Previous menu item</dd>
<dt>g p</dt>
<dd>Previous man page</dd>
<dt>g n</dt>
<dd>Next man page</dd>
<dt>G</dt>
<dd>Scroll to bottom</dd>
<dt>g g</dt>
<dd>Scroll to top</dd>
<dt>g h</dt>
<dd>Goto homepage</dd>
<dt>g s</dt>
<dd>Goto search<br>(current page)</dd>
<dt>/</dt>
<dd>Focus search box</dd>
</dl></div></nav>
<div id="goto">
    <div class="search">
         <div class="text"></div>
         <div class="results"><ul></ul></div>
   </div>
</div>

  <div id="breadcrumbs" class="row-fluid">
          
              
        <ul class="breadcrumbs-container">
            <li><a href="index-2.html">PHP Manual</a></li>      <li><a href="funcref.html">Function Reference</a></li>      <li><a href="refs.remote.other.html">Other Services</a></li>      <li><a href="book.sockets.html">Sockets</a></li>      <li><a href="ref.sockets.html">Socket Functions</a></li>    </ul>
  </div>




<div id="layout">
  <section id="layout-content">
  <div id="function.socket-accept" class="refentry">
 <div class="refnamediv">
  <h1 class="refname">socket_accept</h1>
  <p class="verinfo">(PHP 4 &gt;= 4.1.0, PHP 5)</p><p class="refpurpose"><span class="refname">socket_accept</span> â€” <span class="dc-title">Accepts a connection on a socket</span></p>

 </div>
 
 <div class="refsect1 description" id="refsect1-function.socket-accept-description">
  <h3 class="title">Description</h3>
  <div class="methodsynopsis dc-description">
   <span class="type">resource</span> <span class="methodname"><strong>socket_accept</strong></span>
    ( <span class="methodparam"><span class="type">resource</span> <code class="parameter">$socket</code></span>
   )</div>

  <p class="para rdfs-comment">
   After the socket <code class="parameter">socket</code> has been created
   using <span class="function"><a href="function.socket-create.html" class="function">socket_create()</a></span>, bound to a name with
   <span class="function"><a href="function.socket-bind.html" class="function">socket_bind()</a></span>, and told to listen for connections
   with <span class="function"><a href="function.socket-listen.html" class="function">socket_listen()</a></span>, this function will accept
   incoming connections on that socket. Once a successful connection
   is made, a new socket resource is returned, which may be used
   for communication. If there are multiple connections queued on
   the socket, the first will be used. If there are no pending
   connections, <span class="function"><strong>socket_accept()</strong></span> will block until
   a connection becomes present. If <code class="parameter">socket</code>
   has been made non-blocking using
   <span class="function"><a href="function.socket-set-blocking.html" class="function">socket_set_blocking()</a></span> or
   <span class="function"><a href="function.socket-set-nonblock.html" class="function">socket_set_nonblock()</a></span>, <strong><code>FALSE</code></strong> will be returned.
  </p>
  <p class="para">
   The socket resource returned by
   <span class="function"><strong>socket_accept()</strong></span> may not be used to accept new
   connections. The original listening socket
   <code class="parameter">socket</code>, however, remains open and may be
   reused.
  </p>
 </div>


 <div class="refsect1 parameters" id="refsect1-function.socket-accept-parameters">
  <h3 class="title">Parameters</h3>
  <p class="para">
   </p><dl>

    
     <dt>
<code class="parameter">socket</code></dt>

     <dd>

      <p class="para">
       A valid socket resource created with <span class="function"><a href="function.socket-create.html" class="function">socket_create()</a></span>.
      </p>
     </dd>

    
   </dl>

  <p></p>
 </div>


 <div class="refsect1 returnvalues" id="refsect1-function.socket-accept-returnvalues">
  <h3 class="title">Return Values</h3>
  <p class="para">
   Returns a new socket resource on success, or <strong><code>FALSE</code></strong> on error. The actual
   error code can be retrieved by calling
   <span class="function"><a href="function.socket-last-error.html" class="function">socket_last_error()</a></span>. This error code may be passed to
   <span class="function"><a href="function.socket-strerror.html" class="function">socket_strerror()</a></span> to get a textual explanation of the
   error.
  </p>
 </div>


 <div class="refsect1 seealso" id="refsect1-function.socket-accept-seealso">
  <h3 class="title">See Also</h3>
  <p class="para">
   </p><ul class="simplelist">
    <li class="member"><span class="function"><a href="function.socket-connect.html" class="function" rel="rdfs-seeAlso">socket_connect()</a> - Initiates a connection on a socket</span></li>
    <li class="member"><span class="function"><a href="function.socket-listen.html" class="function" rel="rdfs-seeAlso">socket_listen()</a> - Listens for a connection on a socket</span></li>
    <li class="member"><span class="function"><a href="function.socket-create.html" class="function" rel="rdfs-seeAlso">socket_create()</a> - Create a socket (endpoint for communication)</span></li>
    <li class="member"><span class="function"><a href="function.socket-bind.html" class="function" rel="rdfs-seeAlso">socket_bind()</a> - Binds a name to a socket</span></li>
    <li class="member"><span class="function"><a href="function.socket-strerror.html" class="function" rel="rdfs-seeAlso">socket_strerror()</a> - Return a string describing a socket error</span></li>
   </ul>
  <p></p>
 </div>


</div>
<section id="usernotes">
 <div class="head"><h3 class="title">User Contributed Notes</h3></div><div id="allnotes">
  <div class="note" id="80691">  
  <a class="name">
  <strong class="user"><em>lars at opdenkamp dot eu</em></strong></a><div class="date" title="2008-01-29 04:35"><strong>6 years ago</strong></div>
  <div class="text" id="Hcom80691">
<div class="phpcode"><code><span class="html">
If you want to make a daemon process that forks on each client connection, you'll find out that there's a bug in PHP. The child processes send SIGCHLD to their parent when they exit but the parent can't handle signals while it's waiting for socket_accept (blocking).
<br>
<br>Here is a piece of code that makes a non-blocking forking server.
<br>
<br>#!/usr/bin/php -q
<br><span class="default">&lt;?php
<br></span><span class="comment">/**
<br>&nbsp; * Listens for requests and forks on each connection
<br>&nbsp; */
<br>
<br></span><span class="default">$__server_listening </span><span class="keyword">= </span><span class="default">true</span><span class="keyword">;
<br>
<br></span><span class="default">error_reporting</span><span class="keyword">(</span><span class="default">E_ALL</span><span class="keyword">);
<br></span><span class="default">set_time_limit</span><span class="keyword">(</span><span class="default">0</span><span class="keyword">);
<br></span><span class="default">ob_implicit_flush</span><span class="keyword">();
<br>declare(</span><span class="default">ticks </span><span class="keyword">= </span><span class="default">1</span><span class="keyword">);
<br>
<br></span><span class="default">become_daemon</span><span class="keyword">();
<br>
<br></span><span class="comment">/* nobody/nogroup, change to your host's uid/gid of the non-priv user */
<br></span><span class="default">change_identity</span><span class="keyword">(</span><span class="default">65534</span><span class="keyword">, </span><span class="default">65534</span><span class="keyword">);
<br>
<br></span><span class="comment">/* handle signals */
<br></span><span class="default">pcntl_signal</span><span class="keyword">(</span><span class="default">SIGTERM</span><span class="keyword">, </span><span class="string">'sig_handler'</span><span class="keyword">);
<br></span><span class="default">pcntl_signal</span><span class="keyword">(</span><span class="default">SIGINT</span><span class="keyword">, </span><span class="string">'sig_handler'</span><span class="keyword">);
<br></span><span class="default">pcntl_signal</span><span class="keyword">(</span><span class="default">SIGCHLD</span><span class="keyword">, </span><span class="string">'sig_handler'</span><span class="keyword">);
<br>
<br></span><span class="comment">/* change this to your own host / port */
<br></span><span class="default">server_loop</span><span class="keyword">(</span><span class="string">"127.0.0.1"</span><span class="keyword">, </span><span class="default">1234</span><span class="keyword">);
<br>
<br></span><span class="comment">/**
<br>&nbsp; * Change the identity to a non-priv user
<br>&nbsp; */
<br></span><span class="keyword">function </span><span class="default">change_identity</span><span class="keyword">( </span><span class="default">$uid</span><span class="keyword">, </span><span class="default">$gid </span><span class="keyword">)
<br>{
<br>&nbsp; &nbsp; if( !</span><span class="default">posix_setgid</span><span class="keyword">( </span><span class="default">$gid </span><span class="keyword">) )
<br>&nbsp; &nbsp; {
<br>&nbsp; &nbsp; &nbsp; &nbsp; print </span><span class="string">"Unable to setgid to " </span><span class="keyword">. </span><span class="default">$gid </span><span class="keyword">. </span><span class="string">"!\n"</span><span class="keyword">;
<br>&nbsp; &nbsp; &nbsp; &nbsp; exit;
<br>&nbsp; &nbsp; }
<br>
<br>&nbsp; &nbsp; if( !</span><span class="default">posix_setuid</span><span class="keyword">( </span><span class="default">$uid </span><span class="keyword">) )
<br>&nbsp; &nbsp; {
<br>&nbsp; &nbsp; &nbsp; &nbsp; print </span><span class="string">"Unable to setuid to " </span><span class="keyword">. </span><span class="default">$uid </span><span class="keyword">. </span><span class="string">"!\n"</span><span class="keyword">;
<br>&nbsp; &nbsp; &nbsp; &nbsp; exit;
<br>&nbsp; &nbsp; }
<br>}
<br>
<br></span><span class="comment">/**
<br>&nbsp; * Creates a server socket and listens for incoming client connections
<br>&nbsp; * @param string $address The address to listen on
<br>&nbsp; * @param int $port The port to listen on
<br>&nbsp; */
<br></span><span class="keyword">function </span><span class="default">server_loop</span><span class="keyword">(</span><span class="default">$address</span><span class="keyword">, </span><span class="default">$port</span><span class="keyword">)
<br>{
<br>&nbsp; &nbsp; GLOBAL </span><span class="default">$__server_listening</span><span class="keyword">;
<br>
<br>&nbsp; &nbsp; if((</span><span class="default">$sock </span><span class="keyword">= </span><span class="default">socket_create</span><span class="keyword">(</span><span class="default">AF_INET</span><span class="keyword">, </span><span class="default">SOCK_STREAM</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">)) &lt; </span><span class="default">0</span><span class="keyword">)
<br>&nbsp; &nbsp; {
<br>&nbsp; &nbsp; &nbsp; &nbsp; echo </span><span class="string">"failed to create socket: "</span><span class="keyword">.</span><span class="default">socket_strerror</span><span class="keyword">(</span><span class="default">$sock</span><span class="keyword">).</span><span class="string">"\n"</span><span class="keyword">;
<br>&nbsp; &nbsp; &nbsp; &nbsp; exit();
<br>&nbsp; &nbsp; }
<br>
<br>&nbsp; &nbsp; if((</span><span class="default">$ret </span><span class="keyword">= </span><span class="default">socket_bind</span><span class="keyword">(</span><span class="default">$sock</span><span class="keyword">, </span><span class="default">$address</span><span class="keyword">, </span><span class="default">$port</span><span class="keyword">)) &lt; </span><span class="default">0</span><span class="keyword">)
<br>&nbsp; &nbsp; {
<br>&nbsp; &nbsp; &nbsp; &nbsp; echo </span><span class="string">"failed to bind socket: "</span><span class="keyword">.</span><span class="default">socket_strerror</span><span class="keyword">(</span><span class="default">$ret</span><span class="keyword">).</span><span class="string">"\n"</span><span class="keyword">;
<br>&nbsp; &nbsp; &nbsp; &nbsp; exit();
<br>&nbsp; &nbsp; }
<br>
<br>&nbsp; &nbsp; if( ( </span><span class="default">$ret </span><span class="keyword">= </span><span class="default">socket_listen</span><span class="keyword">( </span><span class="default">$sock</span><span class="keyword">, </span><span class="default">0 </span><span class="keyword">) ) &lt; </span><span class="default">0 </span><span class="keyword">)
<br>&nbsp; &nbsp; {
<br>&nbsp; &nbsp; &nbsp; &nbsp; echo </span><span class="string">"failed to listen to socket: "</span><span class="keyword">.</span><span class="default">socket_strerror</span><span class="keyword">(</span><span class="default">$ret</span><span class="keyword">).</span><span class="string">"\n"</span><span class="keyword">;
<br>&nbsp; &nbsp; &nbsp; &nbsp; exit();
<br>&nbsp; &nbsp; }
<br>
<br>&nbsp; &nbsp; </span><span class="default">socket_set_nonblock</span><span class="keyword">(</span><span class="default">$sock</span><span class="keyword">);
<br>&nbsp; &nbsp; 
<br>&nbsp; &nbsp; echo </span><span class="string">"waiting for clients to connect\n"</span><span class="keyword">;
<br>
<br>&nbsp; &nbsp; while (</span><span class="default">$__server_listening</span><span class="keyword">)
<br>&nbsp; &nbsp; {
<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$connection </span><span class="keyword">= @</span><span class="default">socket_accept</span><span class="keyword">(</span><span class="default">$sock</span><span class="keyword">);
<br>&nbsp; &nbsp; &nbsp; &nbsp; if (</span><span class="default">$connection </span><span class="keyword">=== </span><span class="default">false</span><span class="keyword">)
<br>&nbsp; &nbsp; &nbsp; &nbsp; {
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">usleep</span><span class="keyword">(</span><span class="default">100</span><span class="keyword">);
<br>&nbsp; &nbsp; &nbsp; &nbsp; }elseif (</span><span class="default">$connection </span><span class="keyword">&gt; </span><span class="default">0</span><span class="keyword">)
<br>&nbsp; &nbsp; &nbsp; &nbsp; {
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">handle_client</span><span class="keyword">(</span><span class="default">$sock</span><span class="keyword">, </span><span class="default">$connection</span><span class="keyword">);
<br>&nbsp; &nbsp; &nbsp; &nbsp; }else
<br>&nbsp; &nbsp; &nbsp; &nbsp; {
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; echo </span><span class="string">"error: "</span><span class="keyword">.</span><span class="default">socket_strerror</span><span class="keyword">(</span><span class="default">$connection</span><span class="keyword">);
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; die;
<br>&nbsp; &nbsp; &nbsp; &nbsp; }
<br>&nbsp; &nbsp; }
<br>}
<br>
<br></span><span class="comment">/**
<br>&nbsp; * Signal handler
<br>&nbsp; */
<br></span><span class="keyword">function </span><span class="default">sig_handler</span><span class="keyword">(</span><span class="default">$sig</span><span class="keyword">)
<br>{
<br>&nbsp; &nbsp; switch(</span><span class="default">$sig</span><span class="keyword">)
<br>&nbsp; &nbsp; {
<br>&nbsp; &nbsp; &nbsp; &nbsp; case </span><span class="default">SIGTERM</span><span class="keyword">:
<br>&nbsp; &nbsp; &nbsp; &nbsp; case </span><span class="default">SIGINT</span><span class="keyword">:
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; exit();
<br>&nbsp; &nbsp; &nbsp; &nbsp; break;
<br>
<br>&nbsp; &nbsp; &nbsp; &nbsp; case </span><span class="default">SIGCHLD</span><span class="keyword">:
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">pcntl_waitpid</span><span class="keyword">(-</span><span class="default">1</span><span class="keyword">, </span><span class="default">$status</span><span class="keyword">);
<br>&nbsp; &nbsp; &nbsp; &nbsp; break;
<br>&nbsp; &nbsp; }
<br>}
<br>
<br></span><span class="comment">/** 
<br>&nbsp; * Handle a new client connection
<br>&nbsp; */
<br></span><span class="keyword">function </span><span class="default">handle_client</span><span class="keyword">(</span><span class="default">$ssock</span><span class="keyword">, </span><span class="default">$csock</span><span class="keyword">)
<br>{
<br>&nbsp; &nbsp; GLOBAL </span><span class="default">$__server_listening</span><span class="keyword">;
<br>
<br>&nbsp; &nbsp; </span><span class="default">$pid </span><span class="keyword">= </span><span class="default">pcntl_fork</span><span class="keyword">();
<br>
<br>&nbsp; &nbsp; if (</span><span class="default">$pid </span><span class="keyword">== -</span><span class="default">1</span><span class="keyword">)
<br>&nbsp; &nbsp; {
<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="comment">/* fork failed */
<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="keyword">echo </span><span class="string">"fork failure!\n"</span><span class="keyword">;
<br>&nbsp; &nbsp; &nbsp; &nbsp; die;
<br>&nbsp; &nbsp; }elseif (</span><span class="default">$pid </span><span class="keyword">== </span><span class="default">0</span><span class="keyword">)
<br>&nbsp; &nbsp; {
<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="comment">/* child process */
<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$__server_listening </span><span class="keyword">= </span><span class="default">false</span><span class="keyword">;
<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">socket_close</span><span class="keyword">(</span><span class="default">$ssock</span><span class="keyword">);
<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">interact</span><span class="keyword">(</span><span class="default">$csock</span><span class="keyword">);
<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">socket_close</span><span class="keyword">(</span><span class="default">$csock</span><span class="keyword">);
<br>&nbsp; &nbsp; }else
<br>&nbsp; &nbsp; {
<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">socket_close</span><span class="keyword">(</span><span class="default">$csock</span><span class="keyword">);
<br>&nbsp; &nbsp; }
<br>}
<br>
<br>function </span><span class="default">interact</span><span class="keyword">(</span><span class="default">$socket</span><span class="keyword">)
<br>{
<br>&nbsp; &nbsp; </span><span class="comment">/* TALK TO YOUR CLIENT */
<br></span><span class="keyword">}
<br>
<br></span><span class="comment">/**
<br>&nbsp; * Become a daemon by forking and closing the parent
<br>&nbsp; */
<br></span><span class="keyword">function </span><span class="default">become_daemon</span><span class="keyword">()
<br>{
<br>&nbsp; &nbsp; </span><span class="default">$pid </span><span class="keyword">= </span><span class="default">pcntl_fork</span><span class="keyword">();
<br>&nbsp; &nbsp; 
<br>&nbsp; &nbsp; if (</span><span class="default">$pid </span><span class="keyword">== -</span><span class="default">1</span><span class="keyword">)
<br>&nbsp; &nbsp; {
<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="comment">/* fork failed */
<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="keyword">echo </span><span class="string">"fork failure!\n"</span><span class="keyword">;
<br>&nbsp; &nbsp; &nbsp; &nbsp; exit();
<br>&nbsp; &nbsp; }elseif (</span><span class="default">$pid</span><span class="keyword">)
<br>&nbsp; &nbsp; {
<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="comment">/* close the parent */
<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="keyword">exit();
<br>&nbsp; &nbsp; }else
<br>&nbsp; &nbsp; {
<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="comment">/* child becomes our daemon */
<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">posix_setsid</span><span class="keyword">();
<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">chdir</span><span class="keyword">(</span><span class="string">'/'</span><span class="keyword">);
<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">umask</span><span class="keyword">(</span><span class="default">0</span><span class="keyword">);
<br>&nbsp; &nbsp; &nbsp; &nbsp; return </span><span class="default">posix_getpid</span><span class="keyword">();
<br>
<br>&nbsp; &nbsp; }
<br>}
<br>
<br></span><span class="default">?&gt;</span>
</span>
</code></div>
  </div>
 </div>
  <div class="note" id="82618">  
  <a class="name">
  <strong class="user"><em>Boylett</em></strong></a><div class="date" title="2008-04-18 09:01"><strong>6 years ago</strong></div>
  <div class="text" id="Hcom82618">
<div class="phpcode"><code><span class="html">
If you want to have multiple clients on a server you will have to use non blocking.<br><br><span class="default">&lt;?php<br><br>$clients </span><span class="keyword">= array();<br></span><span class="default">$socket </span><span class="keyword">= </span><span class="default">socket_create</span><span class="keyword">(</span><span class="default">AF_INET</span><span class="keyword">,</span><span class="default">SOCK_STREAM</span><span class="keyword">,</span><span class="default">SOL_TCP</span><span class="keyword">);<br></span><span class="default">socket_bind</span><span class="keyword">(</span><span class="default">$socket</span><span class="keyword">,</span><span class="string">'127.0.0.1'</span><span class="keyword">,</span><span class="default">$port</span><span class="keyword">);<br></span><span class="default">socket_listen</span><span class="keyword">(</span><span class="default">$socket</span><span class="keyword">);<br></span><span class="default">socket_set_nonblock</span><span class="keyword">(</span><span class="default">$socket</span><span class="keyword">);<br><br>while(</span><span class="default">true</span><span class="keyword">)<br>{<br>&nbsp; &nbsp; if((</span><span class="default">$newc </span><span class="keyword">= </span><span class="default">socket_accept</span><span class="keyword">(</span><span class="default">$socket</span><span class="keyword">)) !== </span><span class="default">false</span><span class="keyword">)<br>&nbsp; &nbsp; {<br>&nbsp; &nbsp; &nbsp; &nbsp; echo </span><span class="string">"Client </span><span class="default">$newc</span><span class="string"> has connected\n"</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$clients</span><span class="keyword">[] = </span><span class="default">$newc</span><span class="keyword">;<br>&nbsp; &nbsp; }<br>}<br><br></span><span class="default">?&gt;</span>
</span>
</code></div>
  </div>
 </div>
  <div class="note" id="75289">  
  <a class="name">
  <strong class="user"><em>gmkarl at gmail dot com</em></strong></a><div class="date" title="2007-05-22 09:15"><strong>7 years ago</strong></div>
  <div class="text" id="Hcom75289">
<div class="phpcode"><code><span class="html">
Be aware signal handler functions set with pcntl_signal are not called while a socket is blocking waiting for a connection; the signal is absorbed silently and the handler called when a connection is made.</span>
</code></div>
  </div>
 </div>
  <div class="note" id="115047">  
  <a class="name">
  <strong class="user"><em>mightyplow at gmail dot com</em></strong></a><div class="date" title="2014-05-18 02:47"><strong>3 months ago</strong></div>
  <div class="text" id="Hcom115047">
<div class="phpcode"><code><span class="html">
In order to make many clients connectable to the server, you have to set the accepted socket also to non-blocking. Otherwise the accepted connection will block further incoming connections.<br><br>while (true) {<br>&nbsp; &nbsp; $newSock = @socket_accept($sock);<br><br>&nbsp; &nbsp; if ($newSock) {<br>&nbsp; &nbsp; &nbsp; &nbsp; echo 'client connected';<br><br>&nbsp; &nbsp; &nbsp; &nbsp; socket_set_nonblock($newSock);<br>&nbsp; &nbsp; }<br>}</span>
</code></div>
  </div>
 </div>
  <div class="note" id="38198">  
  <a class="name">
  <strong class="user"><em>Greg MacLellan</em></strong></a><div class="date" title="2003-12-11 12:49"><strong>10 years ago</strong></div>
  <div class="text" id="Hcom38198">
<div class="phpcode"><code><span class="html">
The socket returned by this resource will be non-blocking, regardless of what the listening socket is set to. This is actually true for all FCNTL modifiers.</span>
</code></div>
  </div>
 </div>
  <div class="note" id="52876">  
  <a class="name">
  <strong class="user"><em>simon at 180solutions dot com</em></strong></a><div class="date" title="2005-05-16 08:11"><strong>9 years ago</strong></div>
  <div class="text" id="Hcom52876">
<div class="phpcode"><code><span class="html">
&gt;Accepting a connection using php-sockets:<br>&gt;<br>&gt;$fd = socket_create(AF_INET, SOCK_STREAM, 6 /* OR &gt;getprotobyname("TCP")*/);<br>&gt;<br>&gt;$PORT = 5000;<br>&gt;<br>&gt;socket_bind($fd, "0.0.0.0", $PORT);<br>&gt;<br>&gt;while(true)<br>&gt;{<br>&gt;$remote_fd = socket_accept($fd);<br>&gt;<br>&gt;remote_socket_client_handle($remote_fd);<br>&gt;<br>&gt;}<br>&gt;<br>&gt;It is simple!<br><br>This example doesn't work. You have to call socket_listen($fd) after your bind in order to accept incoming connections.<br><br>Simon</span>
</code></div>
  </div>
 </div></div>

 
</section>    </section><!-- layout-content -->
        


  </div><!-- layout -->
         
  

    
 <!-- External and third party libraries. -->
 







<a id="toTop" href="javascript:;"><span id="toTopHover"></span><img width="40" height="40" alt="To Top" src="../../images/to-top%402x.png"></a>



<!-- Mirrored from php.net/manual/en/function.socket-accept.php by HTTrack Website Copier/3.x [XR&CO'2013], Thu, 28 Aug 2014 16:46:16 GMT -->


</body></html>