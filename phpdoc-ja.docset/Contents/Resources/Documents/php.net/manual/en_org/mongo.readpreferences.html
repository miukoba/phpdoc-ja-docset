<html><!-- Mirrored from php.net/manual/en/mongo.readpreferences.php by HTTrack Website Copier/3.x [XR&CO'2013], Thu, 28 Aug 2014 16:59:22 GMT --><!-- Added by HTTrack --><head><meta http-equiv="content-type" content="text/html;charset=utf-8"><!-- /Added by HTTrack -->


  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0"> 

  <title>Read Preferences</title>

 <link rel="shortcut icon" href="../../favicon.ico">
 <link rel="search" type="application/opensearchdescription+xml" href="http://php.net/phpnetimprovedsearch.src" title="Add PHP.net search">
 <link rel="alternate" type="application/atom+xml" href="http://php.net/releases/feed.php" title="PHP Release feed">
 <link rel="alternate" type="application/atom+xml" href="http://php.net/feed.atom" title="PHP: Hypertext Preprocessor">

 <link rel="canonical" href="mongo.readpreferences.html">
 <link rel="shorturl" href="mongo.readpreferences.html">
 <link rel="alternate" href="mongo.readpreferences.html" hreflang="x-default">

 <link rel="contents" href="index-2.html">
 <link rel="index" href="mongo.manual.html">
 <link rel="prev" href="mongo.tutorial.indexes.html">
 <link rel="next" href="mongo.writeconcerns.html">

 <link rel="alternate" href="mongo.readpreferences.html" hreflang="en">
 <link rel="alternate" href="http://php.net/manual/pt_BR/mongo.readpreferences.php" hreflang="pt_BR">
 <link rel="alternate" href="http://php.net/manual/zh/mongo.readpreferences.php" hreflang="zh">
 <link rel="alternate" href="http://php.net/manual/fr/mongo.readpreferences.php" hreflang="fr">
 <link rel="alternate" href="http://php.net/manual/de/mongo.readpreferences.php" hreflang="de">
 <link rel="alternate" href="http://php.net/manual/it/mongo.readpreferences.php" hreflang="it">
 <link rel="alternate" href="http://php.net/manual/ja/mongo.readpreferences.php" hreflang="ja">
 <link rel="alternate" href="http://php.net/manual/ro/mongo.readpreferences.php" hreflang="ro">
 <link rel="alternate" href="http://php.net/manual/ru/mongo.readpreferences.php" hreflang="ru">
 <link rel="alternate" href="http://php.net/manual/es/mongo.readpreferences.php" hreflang="es">
 <link rel="alternate" href="http://php.net/manual/tr/mongo.readpreferences.php" hreflang="tr">

<link rel="stylesheet" type="text/css" href="../../cached8fe1.css?t=1401250819&amp;f=/fonts/Fira/fira.css" media="screen">
<link rel="stylesheet" type="text/css" href="../../cached4b8d.css?t=1404368420&amp;f=/fonts/Font-Awesome/css/fontello.css" media="screen">
<link rel="stylesheet" type="text/css" href="../../cached5065.css?t=1403329232&amp;f=/styles/theme-base.css" media="screen">
<link rel="stylesheet" type="text/css" href="../../cachedc78d.css?t=1401249623&amp;f=/styles/theme-medium.css" media="screen">

 <!--[if lte IE 7]>
 <link rel="stylesheet" type="text/css" href="http://php.net/styles/workarounds.ie7.css" media="screen">
 <![endif]-->

 <!--[if lte IE 8]>
 <script type="text/javascript">
  window.brokenIE = true;
 </script>
 <![endif]-->

 <!--[if lte IE 9]>
 <link rel="stylesheet" type="text/css" href="http://php.net/styles/workarounds.ie9.css" media="screen">
 <![endif]-->

 <!--[if IE]>
 <script type="text/javascript" src="http://php.net/js/ext/html5.js"></script>
 <![endif]-->

 <base>

</head>
<body class="docs " style="">


<div class="headsup"><a href="http://php.net/index.php#id2014-08-28-1">PHP 5.6.0 released</a></div>
<nav id="trick"><div><dl>
<dt><a href="getting-started.html">Getting Started</a></dt>
	<dd><a href="introduction.html">Introduction</a></dd>
	<dd><a href="tutorial.html">A simple tutorial</a></dd>
<dt><a href="langref.html">Language Reference</a></dt>
	<dd><a href="language.basic-syntax.html">Basic syntax</a></dd>
	<dd><a href="language.types.html">Types</a></dd>
	<dd><a href="language.variables.html">Variables</a></dd>
	<dd><a href="language.constants.html">Constants</a></dd>
	<dd><a href="language.expressions.html">Expressions</a></dd>
	<dd><a href="language.operators.html">Operators</a></dd>
	<dd><a href="language.control-structures.html">Control Structures</a></dd>
	<dd><a href="language.functions.html">Functions</a></dd>
	<dd><a href="language.oop5.html">Classes and Objects</a></dd>
	<dd><a href="language.namespaces.html">Namespaces</a></dd>
	<dd><a href="language.exceptions.html">Exceptions</a></dd>
	<dd><a href="language.generators.html">Generators</a></dd>
	<dd><a href="language.references.html">References Explained</a></dd>
	<dd><a href="reserved.variables.html">Predefined Variables</a></dd>
	<dd><a href="reserved.exceptions.html">Predefined Exceptions</a></dd>
	<dd><a href="reserved.interfaces.html">Predefined Interfaces and Classes</a></dd>
	<dd><a href="context.html">Context options and parameters</a></dd>
	<dd><a href="wrappers.html">Supported Protocols and Wrappers</a></dd>
</dl>
<dl>
<dt><a href="security.html">Security</a></dt>
	<dd><a href="security.intro.html">Introduction</a></dd>
	<dd><a href="security.general.html">General considerations</a></dd>
	<dd><a href="security.cgi-bin.html">Installed as CGI binary</a></dd>
	<dd><a href="security.apache.html">Installed as an Apache module</a></dd>
	<dd><a href="security.filesystem.html">Filesystem Security</a></dd>
	<dd><a href="security.database.html">Database Security</a></dd>
	<dd><a href="security.errors.html">Error Reporting</a></dd>
	<dd><a href="security.globals.html">Using Register Globals</a></dd>
	<dd><a href="security.variables.html">User Submitted Data</a></dd>
	<dd><a href="security.magicquotes.html">Magic Quotes</a></dd>
	<dd><a href="security.hiding.html">Hiding PHP</a></dd>
	<dd><a href="security.current.html">Keeping Current</a></dd>
<dt><a href="features.html">Features</a></dt>
	<dd><a href="features.http-auth.html">HTTP authentication with PHP</a></dd>
	<dd><a href="features.cookies.html">Cookies</a></dd>
	<dd><a href="features.sessions.html">Sessions</a></dd>
	<dd><a href="features.xforms.html">Dealing with XForms</a></dd>
	<dd><a href="features.file-upload.html">Handling file uploads</a></dd>
	<dd><a href="features.remote-files.html">Using remote files</a></dd>
	<dd><a href="features.connection-handling.html">Connection handling</a></dd>
	<dd><a href="features.persistent-connections.html">Persistent Database Connections</a></dd>
	<dd><a href="features.safe-mode.html">Safe Mode</a></dd>
	<dd><a href="features.commandline.html">Command line usage</a></dd>
	<dd><a href="features.gc.html">Garbage Collection</a></dd>
	<dd><a href="features.dtrace.html">DTrace Dynamic Tracing</a></dd>
</dl>
<dl>
<dt><a href="funcref.html">Function Reference</a></dt>
	<dd><a href="refs.basic.php.html">Affecting PHP's Behaviour</a></dd>
	<dd><a href="refs.utilspec.audio.html">Audio Formats Manipulation</a></dd>
	<dd><a href="refs.remote.auth.html">Authentication Services</a></dd>
	<dd><a href="refs.utilspec.cmdline.html">Command Line Specific Extensions</a></dd>
	<dd><a href="refs.compression.html">Compression and Archive Extensions</a></dd>
	<dd><a href="refs.creditcard.html">Credit Card Processing</a></dd>
	<dd><a href="refs.crypto.html">Cryptography Extensions</a></dd>
	<dd><a href="refs.database.html">Database Extensions</a></dd>
	<dd><a href="refs.calendar.html">Date and Time Related Extensions</a></dd>
	<dd><a href="refs.fileprocess.file.html">File System Related Extensions</a></dd>
	<dd><a href="refs.international.html">Human Language and Character Encoding Support</a></dd>
	<dd><a href="refs.utilspec.image.html">Image Processing and Generation</a></dd>
	<dd><a href="refs.remote.mail.html">Mail Related Extensions</a></dd>
	<dd><a href="refs.math.html">Mathematical Extensions</a></dd>
	<dd><a href="refs.utilspec.nontext.html">Non-Text MIME Output</a></dd>
	<dd><a href="refs.fileprocess.process.html">Process Control Extensions</a></dd>
	<dd><a href="refs.basic.other.html">Other Basic Extensions</a></dd>
	<dd><a href="refs.remote.other.html">Other Services</a></dd>
	<dd><a href="refs.search.html">Search Engine Extensions</a></dd>
	<dd><a href="refs.utilspec.server.html">Server Specific Extensions</a></dd>
	<dd><a href="refs.basic.session.html">Session Extensions</a></dd>
	<dd><a href="refs.basic.text.html">Text Processing</a></dd>
	<dd><a href="refs.basic.vartype.html">Variable and Type Related Extensions</a></dd>
	<dd><a href="refs.webservice.html">Web Services</a></dd>
	<dd><a href="refs.utilspec.windows.html">Windows Only Extensions</a></dd>
	<dd><a href="refs.xml.html">XML Manipulation</a></dd>
</dl>
<dl>
<dt>Keyboard Shortcuts</dt><dt>?</dt>
<dd>This help</dd>
<dt>j</dt>
<dd>Next menu item</dd>
<dt>k</dt>
<dd>Previous menu item</dd>
<dt>g p</dt>
<dd>Previous man page</dd>
<dt>g n</dt>
<dd>Next man page</dd>
<dt>G</dt>
<dd>Scroll to bottom</dd>
<dt>g g</dt>
<dd>Scroll to top</dd>
<dt>g h</dt>
<dd>Goto homepage</dd>
<dt>g s</dt>
<dd>Goto search<br>(current page)</dd>
<dt>/</dt>
<dd>Focus search box</dd>
</dl></div></nav>
<div id="goto">
    <div class="search">
         <div class="text"></div>
         <div class="results"><ul></ul></div>
   </div>
</div>

  <div id="breadcrumbs" class="row-fluid">
          
              
        <ul class="breadcrumbs-container">
            <li><a href="index-2.html">PHP Manual</a></li>      <li><a href="funcref.html">Function Reference</a></li>      <li><a href="refs.database.html">Database Extensions</a></li>      <li><a href="refs.database.vendors.html">Vendor Specific Database Extensions</a></li>      <li><a href="book.mongo.html">Mongo</a></li>      <li><a href="mongo.manual.html">Manual</a></li>    </ul>
  </div>




<div id="layout">
  <section id="layout-content">
  <div id="mongo.readpreferences" class="chapter">
 <h1>Read Preferences</h1>

 <p class="para">
  MongoDB 2.2 and version 1.3.0 of the driver add support for 
  <a href="http://docs.mongodb.org/manual/core/read-preference/" class="link external">Â»&nbsp;read preferences</a>,
  which allow control over how queries are directed to mongod instances in a
  replica set environment. Read preferences may be specified on either a
  per-connection, per-database, or per-collection basis. Preferences defined
  at a higher level
  will be inherited by default (e.g. <a href="class.mongocollection.html" class="classname">MongoCollection</a> will
  inherit read preferences defined on the corresponding
  <a href="class.mongodb.html" class="classname">MongoDB</a> instance).
 </p>
 <p class="para">
  Read preferences are specified with a combination of modes and tag sets. Modes
  determine how mongod instances are prioritized, while
  <a href="http://docs.mongodb.org/manual/tutorial/configure-replica-set-tag-sets/" class="link external">Â»&nbsp;tag sets</a> specify criteria
  for eligible mongod instances. Mongod instances are only eligible if they
  are within a 15ms difference in ping time from the nearest mongod instance.
 </p>
 <div class="simplesect">
  <h3 class="title">Read Preference Modes</h3>
  <div class="warning"><strong class="warning">Warning</strong>
   <p class="para">
    All read preference modes except <em>MongoClient::RP_PRIMARY</em>
    may return stale data as secondaries replicate operations from the primary
    with some delay. Ensure that your application can tolerate stale data if you
    choose to use a mode other than <em>MongoClient::RP_PRIMARY</em>.
   </p>
  </div>
  <ul class="itemizedlist">
   <li class="listitem">
    <p class="para">
     <em>MongoClient::RP_PRIMARY</em>
    </p>
    <p class="para">
     All read operations use only the current replica set primary. This is the
     default. If the primary is unavailable, read operations will produce an
     exception.
    </p>
    <p class="para">
     This mode is incompatible with use of tag sets. Specifying a tag set with
     <em>MongoClient::RP_PRIMARY</em> will result in an exception.
    </p>
   </li>
   <li class="listitem">
    <p class="para">
     <em>MongoClient::RP_PRIMARY_PREFERRED</em>
    </p>
    <p class="para">
     In most situations, operations read from the primary member of the set.
     However, if the primary is unavailable, as is the case during failover
     situations, operations read from secondary members.
    </p>
    <p class="para">
     When the read preference includes a tag set, the client reads first from
     the primary, if available, and then from secondaries that match the
     specified tags. If no secondaries have matching tags, the read operation
     will produce an exception.
    </p>
    <div class="warning"><strong class="warning">Warning</strong>
     <p class="para">
      Version 2.2 of mongos added full support for read preferences. When
      connecting to older mongos instances,
      <em>MongoClient::RP_PRIMARY_PREFERRED</em> will send queries to
      secondaries.
     </p>
    </div>
   </li>
   <li class="listitem">
    <p class="para">
     <em>MongoClient::RP_SECONDARY</em>
    </p>
    <p class="para">
     Operations read only from the secondary members of the set. If no
     secondaries are available, read operations will produce an exception.
    </p>
    <p class="para">
     Most sets have at least one secondary, but there are situations where
     there may be no available secondary. For example, a set with a primary, a
     secondary, and an arbiter may not have any secondaries if a member is in
     recovering state or unavailable.
    </p>
    <p class="para">
     When the read preference includes a tag set, the client attempts to find
     secondary members that match the specified tag set and directs reads to a
     random secondary from among the nearest group. If no secondaries have
     matching tags, the read operation will produce an exception.
    </p>
   </li>
   <li class="listitem">
    <p class="para">
     <em>MongoClient::RP_SECONDARY_PREFERRED</em>
    </p>
    <p class="para">
     In most situations, operations read from secondary members, but in
     situations where the set consists of a single primary with no other
     members, the read operation will use the set's primary.
    </p>
    <p class="para">
     When the read preference includes a tag set, the client attempts to find a
     secondary member that matches the specified tag set and directs reads to a
     random secondary from among the nearest group. If no secondaries have
     matching tags, the read operation will produce an exception.
    </p>
   </li>
   <li class="listitem">
    <p class="para">
     <em>MongoClient::RP_NEAREST</em>
    </p>
    <p class="para">
     The driver reads from a <em class="emphasis">random</em> member of the set
     that has a ping time that is less than 15ms slower than the member with
     the lowest ping time. Reads in the
     <em>MongoClient::RP_NEAREST</em> mode do not consider the
     member's type and may read from both primaries and secondaries.
    </p>
    <p class="para">
     Set this mode to minimize the effect of network latency on read operations
     without preference for current or stale data.
    </p>
    <p class="para">
     If you specify a tag set, the client attempts to find a member
     that matches the specified tag set and directs reads to a random node
     from among the nearest group.
    </p>
    <blockquote class="note"><p><strong class="note">Note</strong>: 
     </p><p class="para">
      All operations read from the nearest member of the replica set that
      matches the specified read preference mode. The
      <em>MongoClient::RP_NEAREST</em> mode prefers low latency reads
      over a member's primary or secondary status.
     </p>
    <p></p></blockquote>
   </li>
  </ul>
 </div>
 <div class="simplesect">
  <h3 class="title">Tag Sets</h3>
  <p class="para">
   <a href="http://docs.mongodb.org/manual/tutorial/configure-replica-set-tag-sets/" class="link external">Â»&nbsp;Tag sets</a> allow you to
   specify criteria so that your application can target read operations to
   specific members, based on custom parameters. Tag sets make it possible to
   ensure that read operations target members in a particular data center or
   target mongod instances designated for a particular class of operations, such
   as reporting or analytics.
  </p>
  <p class="para">
   You can specify tag sets with the following read preference modes:
  </p>
  <ul class="itemizedlist">
   <li class="listitem">
    <p class="para">
     <em>MongoClient::RP_PRIMARY_PREFERRED</em>
    </p>
   </li>
   <li class="listitem">
    <p class="para">
     <em>MongoClient::RP_SECONDARY</em>
    </p>
   </li>
   <li class="listitem">
    <p class="para">
     <em>MongoClient::RP_SECONDARY_PREFERRED</em>
    </p>
   </li>
   <li class="listitem">
    <p class="para">
     <em>MongoClient::RP_NEAREST</em>
    </p>
   </li>
  </ul>
  <p class="para">
   You cannot specify tag sets with the
   <em>MongoClient::RP_PRIMARY</em> read preference mode. Tags apply
   only when selecting a secondary member of a set, except for the when in the
   nearest mode.
  </p>
 </div>
 <div class="simplesect">
  <h3 class="title">Specifying Read Preferences</h3>
  <p class="para">
   Read preferences may be specified in either the connection URI provided to
   <span class="function"><a href="mongoclient.construct.html" class="function">MongoClient::__construct()</a></span>, which uses a query string
   syntax, or via setter methods on the core classes, which use an array syntax
   for tag sets.
  </p>
  <p class="para">
   When specifying read preference modes in a query string, the tag sets for
   the <em>readPreferenceTags</em> value should be a comma-delimited
   sequence of colon-delimited key/value pairs.
  </p>
  <blockquote class="note"><p><strong class="note">Note</strong>: 
   </p><p class="para">
    Each tag set defined in the query string will use the
    <em>readPreferenceTags</em> name. Unlike how PHP might handle URL
    query strings, successive values for <em>readPreferenceTags</em>
    will not overwrite each other. The driver will collect tag sets in the order
    they appear in the query string.
   </p>
  <p></p></blockquote>
  <div class="warning"><strong class="warning">Warning</strong>
   <p class="para">
    If the driver cannot find a matching tag set the read will fail!  It is
    your responsibility of providing suitable fallback, such as an empty
    <em>readPreferenceTags</em> value to fallback to "no tag set
    preference".
   </p>
  </div>
  <p class="para">
   </p><div class="example" id="example-1416">
    <p><strong>Example #1 Connection URI read preferences with query string syntax</strong></p>
    <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br></span><span style="color: #FF8000">//&nbsp;Prefer&nbsp;the&nbsp;nearest&nbsp;server&nbsp;with&nbsp;no&nbsp;tag&nbsp;preference<br></span><span style="color: #0000BB">$uri&nbsp;&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #DD0000">'mongodb://rs1.example.com,rs2.example.com/'</span><span style="color: #007700">;<br></span><span style="color: #0000BB">$uri&nbsp;</span><span style="color: #007700">.=&nbsp;</span><span style="color: #DD0000">'?readPreference=nearest'</span><span style="color: #007700">;<br></span><span style="color: #0000BB">$m&nbsp;</span><span style="color: #007700">=&nbsp;new&nbsp;</span><span style="color: #0000BB">MongoClient</span><span style="color: #007700">(</span><span style="color: #0000BB">$uri</span><span style="color: #007700">,&nbsp;array(</span><span style="color: #DD0000">'replicaSet'&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #DD0000">'rs'</span><span style="color: #007700">));<br><br></span><span style="color: #FF8000">//&nbsp;Pick&nbsp;the&nbsp;nearest&nbsp;server&nbsp;in&nbsp;the&nbsp;"east"&nbsp;data&nbsp;center<br></span><span style="color: #0000BB">$uri&nbsp;&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #DD0000">'mongodb://rs1.example.com,rs2.example.com/'</span><span style="color: #007700">;<br></span><span style="color: #0000BB">$uri&nbsp;</span><span style="color: #007700">.=&nbsp;</span><span style="color: #DD0000">'?readPreference=nearest'</span><span style="color: #007700">;<br></span><span style="color: #0000BB">$uri&nbsp;</span><span style="color: #007700">.=&nbsp;</span><span style="color: #DD0000">'&amp;readPreferenceTags=dc:east'</span><span style="color: #007700">;<br></span><span style="color: #0000BB">$m&nbsp;</span><span style="color: #007700">=&nbsp;new&nbsp;</span><span style="color: #0000BB">MongoClient</span><span style="color: #007700">(</span><span style="color: #0000BB">$uri</span><span style="color: #007700">,&nbsp;array(</span><span style="color: #DD0000">'replicaSet'&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #DD0000">'rs'</span><span style="color: #007700">));<br><br></span><span style="color: #FF8000">//&nbsp;Prefer&nbsp;the&nbsp;nearest&nbsp;server&nbsp;in&nbsp;the&nbsp;"east"&nbsp;data&nbsp;center&nbsp;also&nbsp;used&nbsp;for&nbsp;reporting,<br>//&nbsp;but&nbsp;fall&nbsp;back&nbsp;to&nbsp;a&nbsp;server&nbsp;in&nbsp;the&nbsp;"west"&nbsp;data&nbsp;center<br></span><span style="color: #0000BB">$uri&nbsp;&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #DD0000">'mongodb://rs1.example.com,rs2.example.com/'</span><span style="color: #007700">;<br></span><span style="color: #0000BB">$uri&nbsp;</span><span style="color: #007700">.=&nbsp;</span><span style="color: #DD0000">'?readPreference=nearest'</span><span style="color: #007700">;<br></span><span style="color: #0000BB">$uri&nbsp;</span><span style="color: #007700">.=&nbsp;</span><span style="color: #DD0000">'&amp;readPreferenceTags=dc:east,use:reporting'</span><span style="color: #007700">;<br></span><span style="color: #0000BB">$uri&nbsp;</span><span style="color: #007700">.=&nbsp;</span><span style="color: #DD0000">'&amp;readPreferenceTags=dc:west'</span><span style="color: #007700">;<br></span><span style="color: #0000BB">$m&nbsp;</span><span style="color: #007700">=&nbsp;new&nbsp;</span><span style="color: #0000BB">MongoClient</span><span style="color: #007700">(</span><span style="color: #0000BB">$uri</span><span style="color: #007700">,&nbsp;array(</span><span style="color: #DD0000">'replicaSet'&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #DD0000">'rs'</span><span style="color: #007700">));<br><br></span><span style="color: #FF8000">//&nbsp;Prefer&nbsp;the&nbsp;nearest&nbsp;server&nbsp;in&nbsp;the&nbsp;"east"&nbsp;data&nbsp;center,&nbsp;then&nbsp;a&nbsp;server&nbsp;in&nbsp;the<br>//&nbsp;"west"&nbsp;data&nbsp;center,&nbsp;and&nbsp;finally&nbsp;fall&nbsp;back&nbsp;to&nbsp;no&nbsp;tag&nbsp;set&nbsp;preference<br></span><span style="color: #0000BB">$uri&nbsp;&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #DD0000">'mongodb://rs1.example.com,rs2.example.com/'</span><span style="color: #007700">;<br></span><span style="color: #0000BB">$uri&nbsp;</span><span style="color: #007700">.=&nbsp;</span><span style="color: #DD0000">'?readPreference=nearest'</span><span style="color: #007700">;<br></span><span style="color: #0000BB">$uri&nbsp;</span><span style="color: #007700">.=&nbsp;</span><span style="color: #DD0000">'&amp;readPreferenceTags=dc:east'</span><span style="color: #007700">;<br></span><span style="color: #0000BB">$uri&nbsp;</span><span style="color: #007700">.=&nbsp;</span><span style="color: #DD0000">'&amp;readPreferenceTags=dc:west'</span><span style="color: #007700">;<br></span><span style="color: #0000BB">$uri&nbsp;</span><span style="color: #007700">.=&nbsp;</span><span style="color: #DD0000">'&amp;readPreferenceTags='</span><span style="color: #007700">;<br></span><span style="color: #0000BB">$m&nbsp;</span><span style="color: #007700">=&nbsp;new&nbsp;</span><span style="color: #0000BB">MongoClient</span><span style="color: #007700">(</span><span style="color: #0000BB">$uri</span><span style="color: #007700">,&nbsp;array(</span><span style="color: #DD0000">'replicaSet'&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #DD0000">'rs'</span><span style="color: #007700">));<br></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
    </div>

   </div>
  <p></p>
  <p class="para">
   </p><div class="example" id="example-1417">
    <p><strong>Example #2 Setting read preferences with array syntax for tag sets</strong></p>
    <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br><br>$m&nbsp;</span><span style="color: #007700">=&nbsp;new&nbsp;</span><span style="color: #0000BB">MongoClient</span><span style="color: #007700">(</span><span style="color: #DD0000">'mongodb://rs1.example.com,rs2.example.com'</span><span style="color: #007700">,&nbsp;array(<br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #DD0000">'replicaSet'&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #DD0000">'rs'</span><span style="color: #007700">,<br>));<br><br></span><span style="color: #FF8000">//&nbsp;Prefer&nbsp;the&nbsp;nearest&nbsp;server&nbsp;with&nbsp;no&nbsp;tag&nbsp;preference<br></span><span style="color: #0000BB">$m</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">setReadPreference</span><span style="color: #007700">(</span><span style="color: #0000BB">MongoClient</span><span style="color: #007700">::</span><span style="color: #0000BB">RP_NEAREST</span><span style="color: #007700">,&nbsp;array());<br><br></span><span style="color: #FF8000">//&nbsp;Pick&nbsp;the&nbsp;nearest&nbsp;server&nbsp;in&nbsp;the&nbsp;"east"&nbsp;data&nbsp;center<br></span><span style="color: #0000BB">$m</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">setReadPreference</span><span style="color: #007700">(</span><span style="color: #0000BB">MongoClient</span><span style="color: #007700">::</span><span style="color: #0000BB">RP_NEAREST</span><span style="color: #007700">,&nbsp;array(<br>&nbsp;&nbsp;&nbsp;&nbsp;array(</span><span style="color: #DD0000">'dc'&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #DD0000">'east'</span><span style="color: #007700">),<br>));<br><br></span><span style="color: #FF8000">//&nbsp;Prefer&nbsp;the&nbsp;nearest&nbsp;server&nbsp;in&nbsp;the&nbsp;"east"&nbsp;data&nbsp;center&nbsp;also&nbsp;used&nbsp;for&nbsp;reporting,<br>//&nbsp;but&nbsp;fall&nbsp;back&nbsp;to&nbsp;a&nbsp;server&nbsp;in&nbsp;the&nbsp;"west"&nbsp;data&nbsp;center<br></span><span style="color: #0000BB">$m</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">setReadPreference</span><span style="color: #007700">(</span><span style="color: #0000BB">MongoClient</span><span style="color: #007700">::</span><span style="color: #0000BB">RP_NEAREST</span><span style="color: #007700">,&nbsp;array(<br>&nbsp;&nbsp;&nbsp;&nbsp;array(</span><span style="color: #DD0000">'dc'&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #DD0000">'east'</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">'use'&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #DD0000">'reporting'</span><span style="color: #007700">),<br>&nbsp;&nbsp;&nbsp;&nbsp;array(</span><span style="color: #DD0000">'dc'&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #DD0000">'west'</span><span style="color: #007700">),<br>));<br><br></span><span style="color: #FF8000">//&nbsp;Prefer&nbsp;the&nbsp;nearest&nbsp;server&nbsp;in&nbsp;the&nbsp;"east"&nbsp;data&nbsp;center,&nbsp;then&nbsp;a&nbsp;server&nbsp;in&nbsp;the<br>//&nbsp;"west"&nbsp;data&nbsp;center,&nbsp;and&nbsp;finally&nbsp;fall&nbsp;back&nbsp;to&nbsp;no&nbsp;tag&nbsp;set&nbsp;preference<br></span><span style="color: #0000BB">$m</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">setReadPreference</span><span style="color: #007700">(</span><span style="color: #0000BB">MongoClient</span><span style="color: #007700">::</span><span style="color: #0000BB">RP_NEAREST</span><span style="color: #007700">,&nbsp;array(<br>&nbsp;&nbsp;&nbsp;&nbsp;array(</span><span style="color: #DD0000">'dc'&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #DD0000">'east'</span><span style="color: #007700">),<br>&nbsp;&nbsp;&nbsp;&nbsp;array(</span><span style="color: #DD0000">'dc'&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #DD0000">'west'</span><span style="color: #007700">),<br>&nbsp;&nbsp;&nbsp;&nbsp;array(),<br>));<br></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
    </div>

   </div>
  <p></p>
 </div>
</div>

<section id="usernotes">
 <div class="head"><h3 class="title">User Contributed Notes</h3></div>
 <div class="note">There are no user contributed notes for this page.</div></section>    </section><!-- layout-content -->
        


  </div><!-- layout -->
         
  

    
 <!-- External and third party libraries. -->
 







<a id="toTop" href="javascript:;"><span id="toTopHover"></span><img width="40" height="40" alt="To Top" src="../../images/to-top%402x.png"></a>



<!-- Mirrored from php.net/manual/en/mongo.readpreferences.php by HTTrack Website Copier/3.x [XR&CO'2013], Thu, 28 Aug 2014 16:59:23 GMT -->


</body></html>