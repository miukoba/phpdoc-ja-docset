<html><!-- Mirrored from php.net/manual/en/function.ssh2-shell.php by HTTrack Website Copier/3.x [XR&CO'2013], Thu, 28 Aug 2014 16:46:44 GMT --><!-- Added by HTTrack --><head><meta http-equiv="content-type" content="text/html;charset=utf-8"><!-- /Added by HTTrack -->


  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0"> 

  <title>ssh2_shell</title>

 <link rel="shortcut icon" href="../../favicon.ico">
 <link rel="search" type="application/opensearchdescription+xml" href="http://php.net/phpnetimprovedsearch.src" title="Add PHP.net search">
 <link rel="alternate" type="application/atom+xml" href="http://php.net/releases/feed.php" title="PHP Release feed">
 <link rel="alternate" type="application/atom+xml" href="http://php.net/feed.atom" title="PHP: Hypertext Preprocessor">

 <link rel="canonical" href="function.ssh2-shell.html">
 <link rel="shorturl" href="http://php.net/ssh2-shell">
 <link rel="alternate" href="http://php.net/ssh2-shell" hreflang="x-default">

 <link rel="contents" href="index-2.html">
 <link rel="index" href="ref.ssh2.html">
 <link rel="prev" href="function.ssh2-sftp.html">
 <link rel="next" href="function.ssh2-tunnel.html">

 <link rel="alternate" href="function.ssh2-shell.html" hreflang="en">
 <link rel="alternate" href="http://php.net/manual/pt_BR/function.ssh2-shell.php" hreflang="pt_BR">
 <link rel="alternate" href="http://php.net/manual/zh/function.ssh2-shell.php" hreflang="zh">
 <link rel="alternate" href="http://php.net/manual/fr/function.ssh2-shell.php" hreflang="fr">
 <link rel="alternate" href="http://php.net/manual/de/function.ssh2-shell.php" hreflang="de">
 <link rel="alternate" href="http://php.net/manual/it/function.ssh2-shell.php" hreflang="it">
 <link rel="alternate" href="http://php.net/manual/ja/function.ssh2-shell.php" hreflang="ja">
 <link rel="alternate" href="http://php.net/manual/ro/function.ssh2-shell.php" hreflang="ro">
 <link rel="alternate" href="http://php.net/manual/ru/function.ssh2-shell.php" hreflang="ru">
 <link rel="alternate" href="http://php.net/manual/es/function.ssh2-shell.php" hreflang="es">
 <link rel="alternate" href="http://php.net/manual/tr/function.ssh2-shell.php" hreflang="tr">

<link rel="stylesheet" type="text/css" href="../../cached8fe1.css?t=1401250819&amp;f=/fonts/Fira/fira.css" media="screen">
<link rel="stylesheet" type="text/css" href="../../cached4b8d.css?t=1404368420&amp;f=/fonts/Font-Awesome/css/fontello.css" media="screen">
<link rel="stylesheet" type="text/css" href="../../cached5065.css?t=1403329232&amp;f=/styles/theme-base.css" media="screen">
<link rel="stylesheet" type="text/css" href="../../cachedc78d.css?t=1401249623&amp;f=/styles/theme-medium.css" media="screen">

 <!--[if lte IE 7]>
 <link rel="stylesheet" type="text/css" href="http://php.net/styles/workarounds.ie7.css" media="screen">
 <![endif]-->

 <!--[if lte IE 8]>
 <script type="text/javascript">
  window.brokenIE = true;
 </script>
 <![endif]-->

 <!--[if lte IE 9]>
 <link rel="stylesheet" type="text/css" href="http://php.net/styles/workarounds.ie9.css" media="screen">
 <![endif]-->

 <!--[if IE]>
 <script type="text/javascript" src="http://php.net/js/ext/html5.js"></script>
 <![endif]-->

 <base>

</head>
<body class="docs " style="">


<div class="headsup"><a href="http://php.net/index.php#id2014-08-28-1">PHP 5.6.0 released</a></div>
<nav id="trick"><div><dl>
<dt><a href="getting-started.html">Getting Started</a></dt>
	<dd><a href="introduction.html">Introduction</a></dd>
	<dd><a href="tutorial.html">A simple tutorial</a></dd>
<dt><a href="langref.html">Language Reference</a></dt>
	<dd><a href="language.basic-syntax.html">Basic syntax</a></dd>
	<dd><a href="language.types.html">Types</a></dd>
	<dd><a href="language.variables.html">Variables</a></dd>
	<dd><a href="language.constants.html">Constants</a></dd>
	<dd><a href="language.expressions.html">Expressions</a></dd>
	<dd><a href="language.operators.html">Operators</a></dd>
	<dd><a href="language.control-structures.html">Control Structures</a></dd>
	<dd><a href="language.functions.html">Functions</a></dd>
	<dd><a href="language.oop5.html">Classes and Objects</a></dd>
	<dd><a href="language.namespaces.html">Namespaces</a></dd>
	<dd><a href="language.exceptions.html">Exceptions</a></dd>
	<dd><a href="language.generators.html">Generators</a></dd>
	<dd><a href="language.references.html">References Explained</a></dd>
	<dd><a href="reserved.variables.html">Predefined Variables</a></dd>
	<dd><a href="reserved.exceptions.html">Predefined Exceptions</a></dd>
	<dd><a href="reserved.interfaces.html">Predefined Interfaces and Classes</a></dd>
	<dd><a href="context.html">Context options and parameters</a></dd>
	<dd><a href="wrappers.html">Supported Protocols and Wrappers</a></dd>
</dl>
<dl>
<dt><a href="security.html">Security</a></dt>
	<dd><a href="security.intro.html">Introduction</a></dd>
	<dd><a href="security.general.html">General considerations</a></dd>
	<dd><a href="security.cgi-bin.html">Installed as CGI binary</a></dd>
	<dd><a href="security.apache.html">Installed as an Apache module</a></dd>
	<dd><a href="security.filesystem.html">Filesystem Security</a></dd>
	<dd><a href="security.database.html">Database Security</a></dd>
	<dd><a href="security.errors.html">Error Reporting</a></dd>
	<dd><a href="security.globals.html">Using Register Globals</a></dd>
	<dd><a href="security.variables.html">User Submitted Data</a></dd>
	<dd><a href="security.magicquotes.html">Magic Quotes</a></dd>
	<dd><a href="security.hiding.html">Hiding PHP</a></dd>
	<dd><a href="security.current.html">Keeping Current</a></dd>
<dt><a href="features.html">Features</a></dt>
	<dd><a href="features.http-auth.html">HTTP authentication with PHP</a></dd>
	<dd><a href="features.cookies.html">Cookies</a></dd>
	<dd><a href="features.sessions.html">Sessions</a></dd>
	<dd><a href="features.xforms.html">Dealing with XForms</a></dd>
	<dd><a href="features.file-upload.html">Handling file uploads</a></dd>
	<dd><a href="features.remote-files.html">Using remote files</a></dd>
	<dd><a href="features.connection-handling.html">Connection handling</a></dd>
	<dd><a href="features.persistent-connections.html">Persistent Database Connections</a></dd>
	<dd><a href="features.safe-mode.html">Safe Mode</a></dd>
	<dd><a href="features.commandline.html">Command line usage</a></dd>
	<dd><a href="features.gc.html">Garbage Collection</a></dd>
	<dd><a href="features.dtrace.html">DTrace Dynamic Tracing</a></dd>
</dl>
<dl>
<dt><a href="funcref.html">Function Reference</a></dt>
	<dd><a href="refs.basic.php.html">Affecting PHP's Behaviour</a></dd>
	<dd><a href="refs.utilspec.audio.html">Audio Formats Manipulation</a></dd>
	<dd><a href="refs.remote.auth.html">Authentication Services</a></dd>
	<dd><a href="refs.utilspec.cmdline.html">Command Line Specific Extensions</a></dd>
	<dd><a href="refs.compression.html">Compression and Archive Extensions</a></dd>
	<dd><a href="refs.creditcard.html">Credit Card Processing</a></dd>
	<dd><a href="refs.crypto.html">Cryptography Extensions</a></dd>
	<dd><a href="refs.database.html">Database Extensions</a></dd>
	<dd><a href="refs.calendar.html">Date and Time Related Extensions</a></dd>
	<dd><a href="refs.fileprocess.file.html">File System Related Extensions</a></dd>
	<dd><a href="refs.international.html">Human Language and Character Encoding Support</a></dd>
	<dd><a href="refs.utilspec.image.html">Image Processing and Generation</a></dd>
	<dd><a href="refs.remote.mail.html">Mail Related Extensions</a></dd>
	<dd><a href="refs.math.html">Mathematical Extensions</a></dd>
	<dd><a href="refs.utilspec.nontext.html">Non-Text MIME Output</a></dd>
	<dd><a href="refs.fileprocess.process.html">Process Control Extensions</a></dd>
	<dd><a href="refs.basic.other.html">Other Basic Extensions</a></dd>
	<dd><a href="refs.remote.other.html">Other Services</a></dd>
	<dd><a href="refs.search.html">Search Engine Extensions</a></dd>
	<dd><a href="refs.utilspec.server.html">Server Specific Extensions</a></dd>
	<dd><a href="refs.basic.session.html">Session Extensions</a></dd>
	<dd><a href="refs.basic.text.html">Text Processing</a></dd>
	<dd><a href="refs.basic.vartype.html">Variable and Type Related Extensions</a></dd>
	<dd><a href="refs.webservice.html">Web Services</a></dd>
	<dd><a href="refs.utilspec.windows.html">Windows Only Extensions</a></dd>
	<dd><a href="refs.xml.html">XML Manipulation</a></dd>
</dl>
<dl>
<dt>Keyboard Shortcuts</dt><dt>?</dt>
<dd>This help</dd>
<dt>j</dt>
<dd>Next menu item</dd>
<dt>k</dt>
<dd>Previous menu item</dd>
<dt>g p</dt>
<dd>Previous man page</dd>
<dt>g n</dt>
<dd>Next man page</dd>
<dt>G</dt>
<dd>Scroll to bottom</dd>
<dt>g g</dt>
<dd>Scroll to top</dd>
<dt>g h</dt>
<dd>Goto homepage</dd>
<dt>g s</dt>
<dd>Goto search<br>(current page)</dd>
<dt>/</dt>
<dd>Focus search box</dd>
</dl></div></nav>
<div id="goto">
    <div class="search">
         <div class="text"></div>
         <div class="results"><ul></ul></div>
   </div>
</div>

  <div id="breadcrumbs" class="row-fluid">
          
              
        <ul class="breadcrumbs-container">
            <li><a href="index-2.html">PHP Manual</a></li>      <li><a href="funcref.html">Function Reference</a></li>      <li><a href="refs.remote.other.html">Other Services</a></li>      <li><a href="book.ssh2.html">SSH2</a></li>      <li><a href="ref.ssh2.html">SSH2 Functions</a></li>    </ul>
  </div>




<div id="layout">
  <section id="layout-content">
  <div id="function.ssh2-shell" class="refentry">
 <div class="refnamediv">
  <h1 class="refname">ssh2_shell</h1>
  <p class="verinfo">(PECL ssh2 &gt;= 0.9.0)</p><p class="refpurpose"><span class="refname">ssh2_shell</span> â€” <span class="dc-title">Request an interactive shell</span></p>

 </div>
 
 <div class="refsect1 description" id="refsect1-function.ssh2-shell-description">
  <h3 class="title">Description</h3>
  <div class="methodsynopsis dc-description">
   <span class="type">resource</span> <span class="methodname"><strong>ssh2_shell</strong></span>
    ( <span class="methodparam"><span class="type">resource</span> <code class="parameter">$session</code></span>
   [, <span class="methodparam"><span class="type">string</span> <code class="parameter">$term_type</code><span class="initializer"> = "vanilla"</span></span>
   [, <span class="methodparam"><span class="type">array</span> <code class="parameter">$env</code></span>
   [, <span class="methodparam"><span class="type">int</span> <code class="parameter">$width</code><span class="initializer"> = 80</span></span>
   [, <span class="methodparam"><span class="type">int</span> <code class="parameter">$height</code><span class="initializer"> = 25</span></span>
   [, <span class="methodparam"><span class="type">int</span> <code class="parameter">$width_height_type</code><span class="initializer"> = SSH2_TERM_UNIT_CHARS</span></span>
  ]]]]] )</div>

  <p class="para rdfs-comment">
   Open a shell at the remote end and allocate a stream for it.
  </p>
 </div>


 <div class="refsect1 parameters" id="refsect1-function.ssh2-shell-parameters">
  <h3 class="title">Parameters</h3>
  <p class="para">
   </p><dl>

    
     <dt>
<code class="parameter">session</code></dt>

     <dd>

      <p class="para">
       An SSH connection link identifier, obtained from a call to
       <span class="function"><a href="function.ssh2-connect.html" class="function">ssh2_connect()</a></span>.
      </p>
     </dd>

    
    
     <dt>
<code class="parameter">term_type</code></dt>

     <dd>

      <p class="para">
       <code class="parameter">term_type</code> should correspond to one of the
       entries in the target system's <em>/etc/termcap</em> file.
      </p>
     </dd>

    
    
     <dt>
<code class="parameter">env</code></dt>

     <dd>

      <p class="para">
       <code class="parameter">env</code> may be passed as an associative array of
       name/value pairs to set in the target environment.
      </p>
     </dd>

    
    
     <dt>
<code class="parameter">width</code></dt>

     <dd>

      <p class="para">
       Width of the virtual terminal.
      </p>
     </dd>

    
    
     <dt>
<code class="parameter">height</code></dt>

     <dd>

      <p class="para">
       Height of the virtual terminal.
      </p>
     </dd>

    
    
     <dt>
<code class="parameter">width_height_type</code></dt>

     <dd>

      <p class="para">
       <code class="parameter">width_height_type</code> should be one of
       <strong><code>SSH2_TERM_UNIT_CHARS</code></strong> or
       <strong><code>SSH2_TERM_UNIT_PIXELS</code></strong>.
      </p>
     </dd>

    
   </dl>

  <p></p>
 </div>


 <div class="refsect1 returnvalues" id="refsect1-function.ssh2-shell-returnvalues">
  <h3 class="title">Return Values</h3>
  <p class="para">
   
  </p>
 </div>


 <div class="refsect1 examples" id="refsect1-function.ssh2-shell-examples">
  <h3 class="title">Examples</h3>
  <p class="para">
   </p><div class="example" id="example-4744">
    <p><strong>Example #1 Executing a command</strong></p>
    <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br>$connection&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">ssh2_connect</span><span style="color: #007700">(</span><span style="color: #DD0000">'shell.example.com'</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">22</span><span style="color: #007700">);<br></span><span style="color: #0000BB">ssh2_auth_password</span><span style="color: #007700">(</span><span style="color: #0000BB">$connection</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">'username'</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">'password'</span><span style="color: #007700">);<br><br></span><span style="color: #0000BB">$stream&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">ssh2_shell</span><span style="color: #007700">(</span><span style="color: #0000BB">$connection</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">'vt102'</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">null</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">80</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">24</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">SSH2_TERM_UNIT_CHARS</span><span style="color: #007700">);<br></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
    </div>

   </div>
  <p></p>
 </div>


 <div class="refsect1 seealso" id="refsect1-function.ssh2-shell-seealso">
  <h3 class="title">See Also</h3>
  <p class="para">
   </p><ul class="simplelist">
    <li class="member"><span class="function"><a href="function.ssh2-exec.html" class="function" rel="rdfs-seeAlso">ssh2_exec()</a> - Execute a command on a remote server</span></li>
    <li class="member"><span class="function"><a href="function.ssh2-tunnel.html" class="function" rel="rdfs-seeAlso">ssh2_tunnel()</a> - Open a tunnel through a remote server</span></li>
    <li class="member"><span class="function"><a href="function.ssh2-fetch-stream.html" class="function" rel="rdfs-seeAlso">ssh2_fetch_stream()</a> - Fetch an extended data stream</span></li>
   </ul>
  <p></p>
 </div>


</div>
<section id="usernotes">
 <div class="head"><h3 class="title">User Contributed Notes</h3></div><div id="allnotes">
  <div class="note" id="76389">  
  <a class="name">
  <strong class="user"><em>josh at hydril dot com</em></strong></a><div class="date" title="2007-07-12 04:49"><strong>7 years ago</strong></div>
  <div class="text" id="Hcom76389">
<div class="phpcode"><code><span class="html">
To run a shell script with all the variables that you would have when logged in interactively add bash -l or sh --login infront of your command.&nbsp; The script I use creates a shell script, copies the script to the box with ssh2_scp_send, then executes the script with ssh2_exec.&nbsp; Hope this helps somebody.<br><br><span class="default">&lt;?php<br><br></span><span class="comment">//Example<br><br></span><span class="default">$script1 </span><span class="keyword">= </span><span class="string">"bash -l /etc/rc.d/rc.httpd restart"</span><span class="keyword">;<br><br></span><span class="default">$connection </span><span class="keyword">= </span><span class="default">ssh2_connect</span><span class="keyword">(</span><span class="string">'shell.example.com'</span><span class="keyword">, </span><span class="default">22</span><span class="keyword">);<br></span><span class="default">ssh2_auth_password</span><span class="keyword">(</span><span class="default">$connection</span><span class="keyword">, </span><span class="string">'username'</span><span class="keyword">, </span><span class="string">'password'</span><span class="keyword">);<br><br></span><span class="default">$stream </span><span class="keyword">= </span><span class="default">ssh2_exec</span><span class="keyword">(</span><span class="default">$connection</span><span class="keyword">, </span><span class="default">$script1</span><span class="keyword">);<br></span><span class="default">?&gt;</span>
</span>
</code></div>
  </div>
 </div>
  <div class="note" id="49976">  
  <a class="name">
  <strong class="user"><em>suri at suribala dot com</em></strong></a><div class="date" title="2005-02-14 05:03"><strong>9 years ago</strong></div>
  <div class="text" id="Hcom49976">
<div class="phpcode"><code><span class="html">
Using ssh_exec, one could execute only one command at a time. However, ssh_shell, offers greater flexibility.
<br>
<br>Here is an example:
<br>
<br><span class="default">&lt;?php
<br>
<br>$con</span><span class="keyword">=</span><span class="default">ssh2_connect</span><span class="keyword">(</span><span class="string">'192.168.0.1'</span><span class="keyword">, </span><span class="default">22</span><span class="keyword">);
<br></span><span class="default">ssh2_auth_password</span><span class="keyword">(</span><span class="default">$con</span><span class="keyword">, </span><span class="string">"user"</span><span class="keyword">, </span><span class="string">"password"</span><span class="keyword">);
<br></span><span class="default">$shell</span><span class="keyword">=</span><span class="default">ssh2_shell</span><span class="keyword">(</span><span class="default">$con</span><span class="keyword">, </span><span class="string">'xterm'</span><span class="keyword">);
<br></span><span class="default">fwrite</span><span class="keyword">( </span><span class="default">$shell</span><span class="keyword">, </span><span class="string">"cd /dir_one\n"</span><span class="keyword">);
<br></span><span class="default">fwrite</span><span class="keyword">( </span><span class="default">$shell</span><span class="keyword">, </span><span class="string">"ls -la\n"</span><span class="keyword">);
<br></span><span class="default">fwrite</span><span class="keyword">( </span><span class="default">$shell</span><span class="keyword">, </span><span class="string">"cd /dir_two\n"</span><span class="keyword">);
<br></span><span class="default">fwrite</span><span class="keyword">( </span><span class="default">$shell</span><span class="keyword">, </span><span class="string">"ls -la\n"</span><span class="keyword">);
<br>
<br></span><span class="default">?&gt;
<br></span>
<br>Thanks Sara for your implementation and your help !</span>
</code></div>
  </div>
 </div>
  <div class="note" id="82931">  
  <a class="name">
  <strong class="user"><em>stefanov at uk dot ibm dot com</em></strong></a><div class="date" title="2008-05-02 08:26"><strong>6 years ago</strong></div>
  <div class="text" id="Hcom82931">
<div class="phpcode"><code><span class="html">
Do not use \n to end the command. Some server will fail to process. Use always the standard for PHP end of line: PHP_EOL<br><br>'suri at suribala dot com"'s example should be modified as follows (also change the double quotes to single, for better performance):<br><br><span class="default">&lt;?php<br><br>$con</span><span class="keyword">=</span><span class="default">ssh2_connect</span><span class="keyword">(</span><span class="string">'192.168.0.1'</span><span class="keyword">, </span><span class="default">22</span><span class="keyword">);<br></span><span class="default">ssh2_auth_password</span><span class="keyword">(</span><span class="default">$con</span><span class="keyword">, </span><span class="string">'user'</span><span class="keyword">, </span><span class="string">'password'</span><span class="keyword">);<br></span><span class="default">$shell</span><span class="keyword">=</span><span class="default">ssh2_shell</span><span class="keyword">(</span><span class="default">$con</span><span class="keyword">, </span><span class="string">'xterm'</span><span class="keyword">);<br></span><span class="default">fwrite</span><span class="keyword">( </span><span class="default">$shell</span><span class="keyword">, </span><span class="string">'cd /dir_one;'</span><span class="keyword">.</span><span class="default">PHP_EOL</span><span class="keyword">);<br></span><span class="default">fwrite</span><span class="keyword">( </span><span class="default">$shell</span><span class="keyword">, </span><span class="string">'ls -la;'</span><span class="keyword">.</span><span class="default">PHP_EOL</span><span class="keyword">);<br></span><span class="default">fwrite</span><span class="keyword">( </span><span class="default">$shell</span><span class="keyword">, </span><span class="string">'cd /dir_two;'</span><span class="keyword">.</span><span class="default">PHP_EOL</span><span class="keyword">);<br></span><span class="default">fwrite</span><span class="keyword">( </span><span class="default">$shell</span><span class="keyword">, </span><span class="string">'ls -la;'</span><span class="keyword">.</span><span class="default">PHP_EOL</span><span class="keyword">);<br><br></span><span class="default">?&gt;<br></span><br>Cheers,<br><br>Pimmy</span>
</code></div>
  </div>
 </div>
  <div class="note" id="114815">  
  <a class="name">
  <strong class="user"><em>tuxedobob at mac dot com</em></strong></a><div class="date" title="2014-04-08 08:37"><strong>4 months ago</strong></div>
  <div class="text" id="Hcom114815">
<div class="phpcode"><code><span class="html">
Keep in mind that when using ssh2_shell, the remote system's EOL may not be the same as PHP's EOL, so it may not be safe to use PHP_EOL. The native EOL for Windows is \r\n, while Unix is typically merely \n, and classic Mac for some reason is \r.<br><br>If you're running PHP on Windows (\r\n) and sshing into a Unix box (\n) you're going to end up sending extra lines. My experience so far is that it just acts as though you typed nothing, which may cause issues with password prompts.<br><br>Oh, and \n\r? Don't do that. Nobody does that.</span>
</code></div>
  </div>
 </div>
  <div class="note" id="76276">  
  <a class="name">
  <strong class="user"><em>vgopu1 at gmail dot com</em></strong></a><div class="date" title="2007-07-09 01:17"><strong>7 years ago</strong></div>
  <div class="text" id="Hcom76276">
<div class="phpcode"><code><span class="html">
Hi,<br><br>we could also use shell_exec to execute multiple related commands<br>separated by semicolon (;).<br><br> And I figured out&nbsp; problem that sometimes arise related to the execution of complex java c/c++ programs. All we need to do is to set the required environment variables. I have a environment variable in .bash_profile. This variable would be set when I log into my account normally through shell. But when we use ssh2_connect(), the environment variables in the .bash_profile are not set, all we need to do is export the required environment variables with shell_exec();<br><br>example:<br><br>$conn = ssh2_connect($ipaddress);<br>ssh2_auth_password($conn,$username,$passwd);<br>$cmd1="/path/to/program1";<br>$cmd2="/path/to/program2";<br>$env1="export Variable_name1=path1";<br>$env2="export Variable_name2=path2" <br>$stream = ssh2_exec($connection,"$env1; $env2; $cmd1; $cmd2");//this would execute all the //commands and return <br>// stream <br>stream_set_blocking($stream, true);<br>while($o=fgets($stream)){<br>echo $o.'&lt;br&gt;';<br>}<br><br>...<br>...<br><br>Thanks,<br>Vikram Gopu .<br>http:\\my.lsu.edu/vgopu1</span>
</code></div>
  </div>
 </div>
  <div class="note" id="73299">  
  <a class="name">
  <strong class="user"><em>johnes at netsite dot com dot br</em></strong></a><div class="date" title="2007-02-16 09:27"><strong>7 years ago</strong></div>
  <div class="text" id="Hcom73299">
<div class="phpcode"><code><span class="html">
Instead of using sleep(1) try using usleep(350000). If not, you will need to spend much time unnecessary. In my scripts, I tried to use usleep(250000), but it's too short and brought some problems. usleep(300000) worked, but only to garantee use 350000. ;)</span>
</code></div>
  </div>
 </div>
  <div class="note" id="71832">  
  <a class="name">
  <strong class="user"><em>galvao at galvao dot eti dot br</em></strong></a><div class="date" title="2006-12-18 09:03"><strong>7 years ago</strong></div>
  <div class="text" id="Hcom71832">
<div class="phpcode"><code><span class="html">
In response to webmaster at spectreanime dot com:<br><br>"For some obscur reasons, just after ur command, u need to make a sleep to be sure, that the command has reached the server and is running"<br><br>Actually what you must do is set the blocking of the string to true, so it waits until the server sends data to the STDOUT before echoing it. <br><br>So, instead of:<br><br>sleep(1);<br><br>Just do:<br><br>stream_set_blocking($stdio, true);<br><br>Best regards,</span>
</code></div>
  </div>
 </div>
  <div class="note" id="53645">  
  <a class="name">
  <strong class="user"><em>webmaster at spectreanime dot com</em></strong></a><div class="date" title="2005-06-08 01:38"><strong>9 years ago</strong></div>
  <div class="text" id="Hcom53645">
<div class="phpcode"><code><span class="html">
// Connection to SSH server<br>&nbsp; &nbsp; &nbsp; &nbsp; echo "Connexion SSH ";<br>&nbsp; &nbsp; &nbsp; &nbsp; if (!($resource=@ssh2_connect("192.168.0.1"))) {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; echo "[FAILED]&lt;br /&gt;";<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; exit(1);<br>&nbsp; &nbsp; &nbsp; &nbsp; }<br>&nbsp; &nbsp; &nbsp; &nbsp; echo "[OK]&lt;br /&gt;";<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; // Authentification by login/passwd<br>&nbsp; &nbsp; &nbsp; &nbsp; echo "Authentification ";<br>&nbsp; &nbsp; &nbsp; &nbsp; if (!@ssh2_auth_password($resource,"root","your_password")) {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; echo "[FAILED]&lt;br /&gt;";<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; exit(1);<br>&nbsp; &nbsp; &nbsp; &nbsp; }<br>&nbsp; &nbsp; &nbsp; &nbsp; echo "[OK]&lt;br /&gt;";<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; // We need a shell<br>&nbsp; &nbsp; &nbsp; &nbsp; echo "Shell stdio ";<br>&nbsp; &nbsp; &nbsp; &nbsp; if (!($stdio = @ssh2_shell($resource,"xterm"))) {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; echo "[FAILED]&lt;br /&gt;";<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; exit(1);<br>&nbsp; &nbsp; &nbsp; &nbsp; }<br>&nbsp; &nbsp; &nbsp; &nbsp; echo "[OK]&lt;br /&gt;";<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; // Execution of any command<br>&nbsp; &nbsp; &nbsp; &nbsp; // Be careful to add an '\n' at the&nbsp; end of the command<br>&nbsp; &nbsp; &nbsp; &nbsp; $command = "/bin/ls /tmp\n";<br>&nbsp; &nbsp; &nbsp; &nbsp; fwrite($stdio,$command);<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; // IMPORTANT<br>&nbsp; &nbsp; &nbsp; &nbsp; // For some obscur reasons, just after ur command, u need to make a sleep to be sure, that the command has reached the server and is running<br>&nbsp; &nbsp; &nbsp; &nbsp; sleep(1);<br>&nbsp; &nbsp; &nbsp; &nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; // Then u can fetch the stream to see what happens on stdio<br>&nbsp; &nbsp; &nbsp; &nbsp; while($line = fgets($stdio)) {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; flush();<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; echo $line."&lt;br /&gt;";<br>&nbsp; &nbsp; &nbsp; &nbsp; }<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; // It's always cleaner to close all stream<br>&nbsp; &nbsp; &nbsp; &nbsp; fclose($stdio);<br><br>I truly hope i'll help someone :)</span>
</code></div>
  </div>
 </div>
  <div class="note" id="101793">  
  <a class="name">
  <strong class="user"><em>tsschulz at gmx dot net</em></strong></a><div class="date" title="2011-01-11 08:07"><strong>3 years ago</strong></div>
  <div class="text" id="Hcom101793">
<div class="phpcode"><code><span class="html">
In my case the ssh2_shell doesn't work every time. There were many problems:<br>- If I use stream_get_contents, the command(s) never executed<br>- with while ($buf = fgets...) the loop never stops<br>- without sleep(1) before stream_set_blocking, the command wasn't execute every time. Anyone knows why?<br>That's what I made, and it works - but I think it isn't what it should be:<br><span class="default">&lt;?php<br>&nbsp; &nbsp; &nbsp; &nbsp; $strCommand </span><span class="keyword">= </span><span class="string">'tar -C /path/to/extract -xjf /path/from/file.tar.bz2'</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$sshStream </span><span class="keyword">= </span><span class="default">ssh2_shell</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">sshSession</span><span class="keyword">, </span><span class="string">'xterm'</span><span class="keyword">, </span><span class="default">null</span><span class="keyword">, </span><span class="default">120</span><span class="keyword">, </span><span class="default">24</span><span class="keyword">, </span><span class="default">SSH2_TERM_UNIT_CHARS</span><span class="keyword">); <br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">fwrite</span><span class="keyword">(</span><span class="default">$sshStream</span><span class="keyword">, </span><span class="default">$strCommand </span><span class="keyword">. </span><span class="default">PHP_EOL</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">sleep</span><span class="keyword">(</span><span class="default">1</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">stream_set_blocking</span><span class="keyword">(</span><span class="default">$sshStream</span><span class="keyword">, </span><span class="default">true</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$sshUntarRetval </span><span class="keyword">= </span><span class="string">""</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; while (</span><span class="default">$buf </span><span class="keyword">= </span><span class="default">fgets</span><span class="keyword">(</span><span class="default">$sshStream</span><span class="keyword">,</span><span class="default">4096</span><span class="keyword">)) {<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">flush</span><span class="keyword">();<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$sshUntarRetval </span><span class="keyword">.= </span><span class="default">$buf</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if (</span><span class="default">strpos</span><span class="keyword">(</span><span class="default">$buf</span><span class="keyword">, </span><span class="string">'tar -C'</span><span class="keyword">) !== </span><span class="default">false</span><span class="keyword">)<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; break;<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br>&nbsp; &nbsp; &nbsp; &nbsp; }<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">fclose</span><span class="keyword">(</span><span class="default">$sshStream</span><span class="keyword">);<br></span><span class="default">?&gt;</span>
</span>
</code></div>
  </div>
 </div></div>

 
</section>    </section><!-- layout-content -->
        


  </div><!-- layout -->
         
  

    
 <!-- External and third party libraries. -->
 







<a id="toTop" href="javascript:;"><span id="toTopHover"></span><img width="40" height="40" alt="To Top" src="../../images/to-top%402x.png"></a>



<!-- Mirrored from php.net/manual/en/function.ssh2-shell.php by HTTrack Website Copier/3.x [XR&CO'2013], Thu, 28 Aug 2014 16:46:44 GMT -->


</body></html>