<html><!-- Mirrored from php.net/manual/en/function.mcrypt-module-open.php by HTTrack Website Copier/3.x [XR&CO'2013], Thu, 28 Aug 2014 16:16:51 GMT --><!-- Added by HTTrack --><head><meta http-equiv="content-type" content="text/html;charset=utf-8"><!-- /Added by HTTrack -->


  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0"> 

  <title>mcrypt_module_open</title>

 <link rel="shortcut icon" href="../../favicon.ico">
 <link rel="search" type="application/opensearchdescription+xml" href="http://php.net/phpnetimprovedsearch.src" title="Add PHP.net search">
 <link rel="alternate" type="application/atom+xml" href="http://php.net/releases/feed.php" title="PHP Release feed">
 <link rel="alternate" type="application/atom+xml" href="http://php.net/feed.atom" title="PHP: Hypertext Preprocessor">

 <link rel="canonical" href="function.mcrypt-module-open.html">
 <link rel="shorturl" href="http://php.net/mcrypt-module-open">
 <link rel="alternate" href="http://php.net/mcrypt-module-open" hreflang="x-default">

 <link rel="contents" href="index-2.html">
 <link rel="index" href="ref.mcrypt.html">
 <link rel="prev" href="function.mcrypt-module-is-block-mode.html">
 <link rel="next" href="function.mcrypt-module-self-test.html">

 <link rel="alternate" href="function.mcrypt-module-open.html" hreflang="en">
 <link rel="alternate" href="http://php.net/manual/pt_BR/function.mcrypt-module-open.php" hreflang="pt_BR">
 <link rel="alternate" href="http://php.net/manual/zh/function.mcrypt-module-open.php" hreflang="zh">
 <link rel="alternate" href="http://php.net/manual/fr/function.mcrypt-module-open.php" hreflang="fr">
 <link rel="alternate" href="http://php.net/manual/de/function.mcrypt-module-open.php" hreflang="de">
 <link rel="alternate" href="http://php.net/manual/it/function.mcrypt-module-open.php" hreflang="it">
 <link rel="alternate" href="http://php.net/manual/ja/function.mcrypt-module-open.php" hreflang="ja">
 <link rel="alternate" href="http://php.net/manual/ro/function.mcrypt-module-open.php" hreflang="ro">
 <link rel="alternate" href="http://php.net/manual/ru/function.mcrypt-module-open.php" hreflang="ru">
 <link rel="alternate" href="http://php.net/manual/es/function.mcrypt-module-open.php" hreflang="es">
 <link rel="alternate" href="http://php.net/manual/tr/function.mcrypt-module-open.php" hreflang="tr">

<link rel="stylesheet" type="text/css" href="../../cached8fe1.css?t=1401250819&amp;f=/fonts/Fira/fira.css" media="screen">
<link rel="stylesheet" type="text/css" href="../../cached4b8d.css?t=1404368420&amp;f=/fonts/Font-Awesome/css/fontello.css" media="screen">
<link rel="stylesheet" type="text/css" href="../../cached5065.css?t=1403329232&amp;f=/styles/theme-base.css" media="screen">
<link rel="stylesheet" type="text/css" href="../../cachedc78d.css?t=1401249623&amp;f=/styles/theme-medium.css" media="screen">

 <!--[if lte IE 7]>
 <link rel="stylesheet" type="text/css" href="http://php.net/styles/workarounds.ie7.css" media="screen">
 <![endif]-->

 <!--[if lte IE 8]>
 <script type="text/javascript">
  window.brokenIE = true;
 </script>
 <![endif]-->

 <!--[if lte IE 9]>
 <link rel="stylesheet" type="text/css" href="http://php.net/styles/workarounds.ie9.css" media="screen">
 <![endif]-->

 <!--[if IE]>
 <script type="text/javascript" src="http://php.net/js/ext/html5.js"></script>
 <![endif]-->

 <base>

</head>
<body class="docs " style="">


<div class="headsup"><a href="http://php.net/index.php#id2014-08-28-1">PHP 5.6.0 released</a></div>
<nav id="trick"><div><dl>
<dt><a href="getting-started.html">Getting Started</a></dt>
	<dd><a href="introduction.html">Introduction</a></dd>
	<dd><a href="tutorial.html">A simple tutorial</a></dd>
<dt><a href="langref.html">Language Reference</a></dt>
	<dd><a href="language.basic-syntax.html">Basic syntax</a></dd>
	<dd><a href="language.types.html">Types</a></dd>
	<dd><a href="language.variables.html">Variables</a></dd>
	<dd><a href="language.constants.html">Constants</a></dd>
	<dd><a href="language.expressions.html">Expressions</a></dd>
	<dd><a href="language.operators.html">Operators</a></dd>
	<dd><a href="language.control-structures.html">Control Structures</a></dd>
	<dd><a href="language.functions.html">Functions</a></dd>
	<dd><a href="language.oop5.html">Classes and Objects</a></dd>
	<dd><a href="language.namespaces.html">Namespaces</a></dd>
	<dd><a href="language.exceptions.html">Exceptions</a></dd>
	<dd><a href="language.generators.html">Generators</a></dd>
	<dd><a href="language.references.html">References Explained</a></dd>
	<dd><a href="reserved.variables.html">Predefined Variables</a></dd>
	<dd><a href="reserved.exceptions.html">Predefined Exceptions</a></dd>
	<dd><a href="reserved.interfaces.html">Predefined Interfaces and Classes</a></dd>
	<dd><a href="context.html">Context options and parameters</a></dd>
	<dd><a href="wrappers.html">Supported Protocols and Wrappers</a></dd>
</dl>
<dl>
<dt><a href="security.html">Security</a></dt>
	<dd><a href="security.intro.html">Introduction</a></dd>
	<dd><a href="security.general.html">General considerations</a></dd>
	<dd><a href="security.cgi-bin.html">Installed as CGI binary</a></dd>
	<dd><a href="security.apache.html">Installed as an Apache module</a></dd>
	<dd><a href="security.filesystem.html">Filesystem Security</a></dd>
	<dd><a href="security.database.html">Database Security</a></dd>
	<dd><a href="security.errors.html">Error Reporting</a></dd>
	<dd><a href="security.globals.html">Using Register Globals</a></dd>
	<dd><a href="security.variables.html">User Submitted Data</a></dd>
	<dd><a href="security.magicquotes.html">Magic Quotes</a></dd>
	<dd><a href="security.hiding.html">Hiding PHP</a></dd>
	<dd><a href="security.current.html">Keeping Current</a></dd>
<dt><a href="features.html">Features</a></dt>
	<dd><a href="features.http-auth.html">HTTP authentication with PHP</a></dd>
	<dd><a href="features.cookies.html">Cookies</a></dd>
	<dd><a href="features.sessions.html">Sessions</a></dd>
	<dd><a href="features.xforms.html">Dealing with XForms</a></dd>
	<dd><a href="features.file-upload.html">Handling file uploads</a></dd>
	<dd><a href="features.remote-files.html">Using remote files</a></dd>
	<dd><a href="features.connection-handling.html">Connection handling</a></dd>
	<dd><a href="features.persistent-connections.html">Persistent Database Connections</a></dd>
	<dd><a href="features.safe-mode.html">Safe Mode</a></dd>
	<dd><a href="features.commandline.html">Command line usage</a></dd>
	<dd><a href="features.gc.html">Garbage Collection</a></dd>
	<dd><a href="features.dtrace.html">DTrace Dynamic Tracing</a></dd>
</dl>
<dl>
<dt><a href="funcref.html">Function Reference</a></dt>
	<dd><a href="refs.basic.php.html">Affecting PHP's Behaviour</a></dd>
	<dd><a href="refs.utilspec.audio.html">Audio Formats Manipulation</a></dd>
	<dd><a href="refs.remote.auth.html">Authentication Services</a></dd>
	<dd><a href="refs.utilspec.cmdline.html">Command Line Specific Extensions</a></dd>
	<dd><a href="refs.compression.html">Compression and Archive Extensions</a></dd>
	<dd><a href="refs.creditcard.html">Credit Card Processing</a></dd>
	<dd><a href="refs.crypto.html">Cryptography Extensions</a></dd>
	<dd><a href="refs.database.html">Database Extensions</a></dd>
	<dd><a href="refs.calendar.html">Date and Time Related Extensions</a></dd>
	<dd><a href="refs.fileprocess.file.html">File System Related Extensions</a></dd>
	<dd><a href="refs.international.html">Human Language and Character Encoding Support</a></dd>
	<dd><a href="refs.utilspec.image.html">Image Processing and Generation</a></dd>
	<dd><a href="refs.remote.mail.html">Mail Related Extensions</a></dd>
	<dd><a href="refs.math.html">Mathematical Extensions</a></dd>
	<dd><a href="refs.utilspec.nontext.html">Non-Text MIME Output</a></dd>
	<dd><a href="refs.fileprocess.process.html">Process Control Extensions</a></dd>
	<dd><a href="refs.basic.other.html">Other Basic Extensions</a></dd>
	<dd><a href="refs.remote.other.html">Other Services</a></dd>
	<dd><a href="refs.search.html">Search Engine Extensions</a></dd>
	<dd><a href="refs.utilspec.server.html">Server Specific Extensions</a></dd>
	<dd><a href="refs.basic.session.html">Session Extensions</a></dd>
	<dd><a href="refs.basic.text.html">Text Processing</a></dd>
	<dd><a href="refs.basic.vartype.html">Variable and Type Related Extensions</a></dd>
	<dd><a href="refs.webservice.html">Web Services</a></dd>
	<dd><a href="refs.utilspec.windows.html">Windows Only Extensions</a></dd>
	<dd><a href="refs.xml.html">XML Manipulation</a></dd>
</dl>
<dl>
<dt>Keyboard Shortcuts</dt><dt>?</dt>
<dd>This help</dd>
<dt>j</dt>
<dd>Next menu item</dd>
<dt>k</dt>
<dd>Previous menu item</dd>
<dt>g p</dt>
<dd>Previous man page</dd>
<dt>g n</dt>
<dd>Next man page</dd>
<dt>G</dt>
<dd>Scroll to bottom</dd>
<dt>g g</dt>
<dd>Scroll to top</dd>
<dt>g h</dt>
<dd>Goto homepage</dd>
<dt>g s</dt>
<dd>Goto search<br>(current page)</dd>
<dt>/</dt>
<dd>Focus search box</dd>
</dl></div></nav>
<div id="goto">
    <div class="search">
         <div class="text"></div>
         <div class="results"><ul></ul></div>
   </div>
</div>

  <div id="breadcrumbs" class="row-fluid">
          
              
        <ul class="breadcrumbs-container">
            <li><a href="index-2.html">PHP Manual</a></li>      <li><a href="funcref.html">Function Reference</a></li>      <li><a href="refs.crypto.html">Cryptography Extensions</a></li>      <li><a href="book.mcrypt.html">Mcrypt</a></li>      <li><a href="ref.mcrypt.html">Mcrypt Functions</a></li>    </ul>
  </div>




<div id="layout">
  <section id="layout-content">
  <div id="function.mcrypt-module-open" class="refentry">
 <div class="refnamediv">
  <h1 class="refname">mcrypt_module_open</h1>
  <p class="verinfo">(PHP 4 &gt;= 4.0.2, PHP 5)</p><p class="refpurpose"><span class="refname">mcrypt_module_open</span> â€” <span class="dc-title">Opens the module of the algorithm and the mode to be used</span></p>

 </div>

 <div class="refsect1 description" id="refsect1-function.mcrypt-module-open-description">
  <h3 class="title">Description</h3>
  <div class="methodsynopsis dc-description">
   <span class="type">resource</span> <span class="methodname"><strong>mcrypt_module_open</strong></span>
    ( <span class="methodparam"><span class="type">string</span> <code class="parameter">$algorithm</code></span>
   , <span class="methodparam"><span class="type">string</span> <code class="parameter">$algorithm_directory</code></span>
   , <span class="methodparam"><span class="type">string</span> <code class="parameter">$mode</code></span>
   , <span class="methodparam"><span class="type">string</span> <code class="parameter">$mode_directory</code></span>
   )</div>

  <p class="para rdfs-comment">
   This function opens the module of the algorithm and the mode to be used.
   The name of the algorithm is specified in algorithm, e.g. <em>"twofish"</em> or is
   one of the <strong><code>MCRYPT_ciphername</code></strong> constants.  The module is closed by calling
   <span class="function"><a href="function.mcrypt-module-close.html" class="function">mcrypt_module_close()</a></span>.
  </p>
 </div>


 <div class="refsect1 parameters" id="refsect1-function.mcrypt-module-open-parameters">
  <h3 class="title">Parameters</h3>
  <p class="para">
   </p><dl>

    
     <dt>
<code class="parameter">algorithm</code></dt>

     <dd>

      <p class="para">One of the <strong><code>MCRYPT_ciphername</code></strong> constants, or the name of the algorithm as string.</p>
     </dd>

    
    
     <dt>
<code class="parameter">algorithm_directory</code></dt>

     <dd>

      <p class="para">
       The <code class="parameter">algorithm_directory</code> parameter is used to locate
       the encryption module. When you supply a directory name, it is used.  When
       you set it to an empty string (<em>""</em>), the value set by the
       <em>mcrypt.algorithms_dir</em> <var class="filename">php.ini</var> directive is used. When
       it is not set, the default directory that is used is the one that was compiled
       into libmcrypt (usually <var class="filename">/usr/local/lib/libmcrypt</var>).
      </p>
     </dd>

    
    
     <dt>
<code class="parameter">mode</code></dt>

     <dd>

      <p class="para">One of the <strong><code>MCRYPT_MODE_modename</code></strong> constants, or one of the following strings: "ecb", "cbc", "cfb", "ofb", "nofb" or "stream".</p>
     </dd>

    
    
     <dt>
<code class="parameter">mode_directory</code></dt>

     <dd>

      <p class="para">
       The <code class="parameter">mode_directory</code> parameter is used to locate
       the encryption module. When you supply a directory name, it is used.  When
       you set it to an empty string (<em>""</em>), the value set by the
       <em>mcrypt.modes_dir</em> <var class="filename">php.ini</var> directive is used. When
       it is not set, the default directory that is used is the one that was compiled-in
       into libmcrypt (usually <var class="filename">/usr/local/lib/libmcrypt</var>).
      </p>
     </dd>

    
   </dl>

  <p></p>
 </div>


 <div class="refsect1 returnvalues" id="refsect1-function.mcrypt-module-open-returnvalues">
  <h3 class="title">Return Values</h3>
  <p class="para">
   Normally it returns an encryption descriptor, or <strong><code>FALSE</code></strong> on error.
  </p>
 </div>


 <div class="refsect1 examples" id="refsect1-function.mcrypt-module-open-examples">
  <h3 class="title">Examples</h3>
  <p class="para">
   </p><div class="example" id="example-888">
    <p><strong>Example #1 <span class="function"><strong>mcrypt_module_open()</strong></span> Examples</strong></p>
    <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br>&nbsp;&nbsp;&nbsp;&nbsp;$td&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">mcrypt_module_open</span><span style="color: #007700">(</span><span style="color: #0000BB">MCRYPT_DES</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">''</span><span style="color: #007700">,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">MCRYPT_MODE_ECB</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">'/usr/lib/mcrypt-modes'</span><span style="color: #007700">);<br><br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$td&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">mcrypt_module_open</span><span style="color: #007700">(</span><span style="color: #DD0000">'rijndael-256'</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">''</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">'ofb'</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">''</span><span style="color: #007700">);<br></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
    </div>

   </div>
  <p></p>
  <p class="para">
   The first line in the example above will try to open the <em>DES</em> cipher from
   the default directory and the <em>ECB</em> mode from the directory
   <var class="filename">/usr/lib/mcrypt-modes</var>. The second example uses
   strings as name for the cipher and mode, this only works when the
   extension is linked against libmcrypt 2.4.x or 2.5.x.
  </p>

  <p class="para">
   </p><div class="example" id="example-889">
    <p><strong>Example #2 Using <span class="function"><strong>mcrypt_module_open()</strong></span> in encryption</strong></p>
    <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">/*&nbsp;Open&nbsp;the&nbsp;cipher&nbsp;*/<br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$td&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">mcrypt_module_open</span><span style="color: #007700">(</span><span style="color: #DD0000">'rijndael-256'</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">''</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">'ofb'</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">''</span><span style="color: #007700">);<br><br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">/*&nbsp;Create&nbsp;the&nbsp;IV&nbsp;and&nbsp;determine&nbsp;the&nbsp;keysize&nbsp;length,&nbsp;use&nbsp;MCRYPT_RAND<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;on&nbsp;Windows&nbsp;instead&nbsp;*/<br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$iv&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">mcrypt_create_iv</span><span style="color: #007700">(</span><span style="color: #0000BB">mcrypt_enc_get_iv_size</span><span style="color: #007700">(</span><span style="color: #0000BB">$td</span><span style="color: #007700">),&nbsp;</span><span style="color: #0000BB">MCRYPT_DEV_RANDOM</span><span style="color: #007700">);<br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$ks&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">mcrypt_enc_get_key_size</span><span style="color: #007700">(</span><span style="color: #0000BB">$td</span><span style="color: #007700">);<br><br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">/*&nbsp;Create&nbsp;key&nbsp;*/<br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$key&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">substr</span><span style="color: #007700">(</span><span style="color: #0000BB">md5</span><span style="color: #007700">(</span><span style="color: #DD0000">'very&nbsp;secret&nbsp;key'</span><span style="color: #007700">),&nbsp;</span><span style="color: #0000BB">0</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$ks</span><span style="color: #007700">);<br><br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">/*&nbsp;Intialize&nbsp;encryption&nbsp;*/<br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">mcrypt_generic_init</span><span style="color: #007700">(</span><span style="color: #0000BB">$td</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$key</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$iv</span><span style="color: #007700">);<br><br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">/*&nbsp;Encrypt&nbsp;data&nbsp;*/<br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$encrypted&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">mcrypt_generic</span><span style="color: #007700">(</span><span style="color: #0000BB">$td</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">'This&nbsp;is&nbsp;very&nbsp;important&nbsp;data'</span><span style="color: #007700">);<br><br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">/*&nbsp;Terminate&nbsp;encryption&nbsp;handler&nbsp;*/<br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">mcrypt_generic_deinit</span><span style="color: #007700">(</span><span style="color: #0000BB">$td</span><span style="color: #007700">);<br><br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">/*&nbsp;Initialize&nbsp;encryption&nbsp;module&nbsp;for&nbsp;decryption&nbsp;*/<br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">mcrypt_generic_init</span><span style="color: #007700">(</span><span style="color: #0000BB">$td</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$key</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$iv</span><span style="color: #007700">);<br><br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">/*&nbsp;Decrypt&nbsp;encrypted&nbsp;string&nbsp;*/<br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$decrypted&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">mdecrypt_generic</span><span style="color: #007700">(</span><span style="color: #0000BB">$td</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$encrypted</span><span style="color: #007700">);<br><br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">/*&nbsp;Terminate&nbsp;decryption&nbsp;handle&nbsp;and&nbsp;close&nbsp;module&nbsp;*/<br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">mcrypt_generic_deinit</span><span style="color: #007700">(</span><span style="color: #0000BB">$td</span><span style="color: #007700">);<br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">mcrypt_module_close</span><span style="color: #007700">(</span><span style="color: #0000BB">$td</span><span style="color: #007700">);<br><br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">/*&nbsp;Show&nbsp;string&nbsp;*/<br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">echo&nbsp;</span><span style="color: #0000BB">trim</span><span style="color: #007700">(</span><span style="color: #0000BB">$decrypted</span><span style="color: #007700">)&nbsp;.&nbsp;</span><span style="color: #DD0000">"\n"</span><span style="color: #007700">;<br></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
    </div>

   </div>
  <p></p>
 </div>


 <div class="refsect1 seealso" id="refsect1-function.mcrypt-module-open-seealso">
  <h3 class="title">See Also</h3>
  <p class="para">
   </p><ul class="simplelist">
    <li class="member"><span class="function"><a href="function.mcrypt-module-close.html" class="function" rel="rdfs-seeAlso">mcrypt_module_close()</a> - Closes the mcrypt module</span></li>
    <li class="member"><span class="function"><a href="function.mcrypt-generic.html" class="function" rel="rdfs-seeAlso">mcrypt_generic()</a> - This function encrypts data</span></li>
    <li class="member"><span class="function"><a href="function.mdecrypt-generic.html" class="function" rel="rdfs-seeAlso">mdecrypt_generic()</a> - Decrypts data</span></li>
    <li class="member"><span class="function"><a href="function.mcrypt-generic-init.html" class="function" rel="rdfs-seeAlso">mcrypt_generic_init()</a> - This function initializes all buffers needed for encryption</span></li>
    <li class="member"><span class="function"><a href="function.mcrypt-generic-deinit.html" class="function" rel="rdfs-seeAlso">mcrypt_generic_deinit()</a> - This function deinitializes an encryption module</span></li>
   </ul>
  <p></p>
 </div>

</div>
<section id="usernotes">
 <div class="head"><h3 class="title">User Contributed Notes</h3></div><div id="allnotes">
  <div class="note" id="79135">  
  <a class="name">
  <strong class="user"><em>dinamic at gmail dot com</em></strong></a><div class="date" title="2007-11-13 03:05"><strong>6 years ago</strong></div>
  <div class="text" id="Hcom79135">
<div class="phpcode"><code><span class="html">
Also it should be pointed that md5() and/or sha1() should not be used while forming your key for the mcrypt. This is so because hex encoding uses a set of only 16 characters [0-9a-f], which is equivalent to 4 bits, and thus halve the strength of your encryption: 4 x 32 = 128-bit.<br><br>I have re-wrote the example shown, so here is my suggestion to get real 256-bit encryption:<br><br><span class="default">&lt;?php<br>$key1 </span><span class="keyword">= </span><span class="string">"this is a secret key"</span><span class="keyword">;<br></span><span class="default">$key2 </span><span class="keyword">= </span><span class="string">"this is the second secret key"</span><span class="keyword">;<br></span><span class="default">$input </span><span class="keyword">= </span><span class="string">"Let us meet at 9 o'clock at the secret place."</span><span class="keyword">;<br></span><span class="default">$length </span><span class="keyword">= </span><span class="default">strlen</span><span class="keyword">(</span><span class="default">$input</span><span class="keyword">);<br><br>&nbsp; &nbsp; </span><span class="comment">/* Open the cipher */<br>&nbsp; &nbsp; </span><span class="default">$td </span><span class="keyword">= </span><span class="default">mcrypt_module_open</span><span class="keyword">(</span><span class="string">'rijndael-256'</span><span class="keyword">, </span><span class="string">''</span><span class="keyword">, </span><span class="string">'cbc'</span><span class="keyword">, </span><span class="string">''</span><span class="keyword">);<br><br>&nbsp; &nbsp; </span><span class="comment">/* Create the IV and determine the keysize length, use MCRYPT_RAND<br>&nbsp; &nbsp;&nbsp; * on Windows instead */<br>&nbsp; &nbsp; </span><span class="default">$iv </span><span class="keyword">= </span><span class="default">mcrypt_create_iv</span><span class="keyword">(</span><span class="default">mcrypt_enc_get_iv_size</span><span class="keyword">(</span><span class="default">$td</span><span class="keyword">), </span><span class="default">MCRYPT_RAND</span><span class="keyword">);<br>&nbsp; &nbsp; </span><span class="default">$ks </span><span class="keyword">= </span><span class="default">mcrypt_enc_get_key_size</span><span class="keyword">(</span><span class="default">$td</span><span class="keyword">);<br><br>&nbsp; &nbsp; </span><span class="comment">/* Create key */<br>&nbsp; &nbsp; </span><span class="default">$key1 </span><span class="keyword">= </span><span class="default">md5</span><span class="keyword">(</span><span class="default">$key1</span><span class="keyword">);<br>&nbsp; &nbsp; </span><span class="default">$key2 </span><span class="keyword">= </span><span class="default">md5</span><span class="keyword">(</span><span class="default">$key2</span><span class="keyword">);<br><br>&nbsp; &nbsp; </span><span class="default">$key </span><span class="keyword">= </span><span class="default">substr</span><span class="keyword">(</span><span class="default">$key1</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">$ks</span><span class="keyword">/</span><span class="default">2</span><span class="keyword">) . </span><span class="default">substr</span><span class="keyword">(</span><span class="default">strtoupper</span><span class="keyword">(</span><span class="default">$key2</span><span class="keyword">), (</span><span class="default">round</span><span class="keyword">(</span><span class="default">strlen</span><span class="keyword">(</span><span class="default">$key2</span><span class="keyword">) / </span><span class="default">2</span><span class="keyword">)), </span><span class="default">$ks</span><span class="keyword">/</span><span class="default">2</span><span class="keyword">);<br><br>&nbsp; &nbsp; </span><span class="default">$key </span><span class="keyword">= </span><span class="default">substr</span><span class="keyword">(</span><span class="default">$key</span><span class="keyword">.</span><span class="default">$key1</span><span class="keyword">.</span><span class="default">$key2</span><span class="keyword">.</span><span class="default">strtoupper</span><span class="keyword">(</span><span class="default">$key1</span><span class="keyword">),</span><span class="default">0</span><span class="keyword">,</span><span class="default">$ks</span><span class="keyword">);<br><br>&nbsp; &nbsp; </span><span class="comment">/* Intialize encryption */<br>&nbsp; &nbsp; </span><span class="default">mcrypt_generic_init</span><span class="keyword">(</span><span class="default">$td</span><span class="keyword">, </span><span class="default">$key</span><span class="keyword">, </span><span class="default">$iv</span><span class="keyword">);<br><br>&nbsp; &nbsp; </span><span class="comment">/* Encrypt data */<br>&nbsp; &nbsp; </span><span class="default">$encrypted </span><span class="keyword">= </span><span class="default">mcrypt_generic</span><span class="keyword">(</span><span class="default">$td</span><span class="keyword">, </span><span class="default">$input</span><span class="keyword">);<br><br>&nbsp; &nbsp; </span><span class="comment">/* Terminate encryption handler */<br>&nbsp; &nbsp; </span><span class="default">mcrypt_generic_deinit</span><span class="keyword">(</span><span class="default">$td</span><span class="keyword">);<br><br>&nbsp; &nbsp; </span><span class="comment">/* Initialize encryption module for decryption */<br>&nbsp; &nbsp; </span><span class="default">mcrypt_generic_init</span><span class="keyword">(</span><span class="default">$td</span><span class="keyword">, </span><span class="default">$key</span><span class="keyword">, </span><span class="default">$iv</span><span class="keyword">);<br><br>&nbsp; &nbsp; </span><span class="comment">/* Decrypt encrypted string */<br>&nbsp; &nbsp; </span><span class="default">$decrypted </span><span class="keyword">= </span><span class="default">mdecrypt_generic</span><span class="keyword">(</span><span class="default">$td</span><span class="keyword">, </span><span class="default">$encrypted</span><span class="keyword">);<br><br>&nbsp; &nbsp; </span><span class="comment">/* Terminate decryption handle and close module */<br>&nbsp; &nbsp; </span><span class="default">mcrypt_generic_deinit</span><span class="keyword">(</span><span class="default">$td</span><span class="keyword">);<br>&nbsp; &nbsp; </span><span class="default">mcrypt_module_close</span><span class="keyword">(</span><span class="default">$td</span><span class="keyword">);<br><br>&nbsp; &nbsp; </span><span class="comment">/* Show string */<br>&nbsp; &nbsp; </span><span class="keyword">echo </span><span class="string">"Text: "</span><span class="keyword">.</span><span class="default">substr</span><span class="keyword">(</span><span class="default">$decrypted</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">,</span><span class="default">$length</span><span class="keyword">) . </span><span class="string">"&lt;br&gt;"</span><span class="keyword">;<br>&nbsp; &nbsp; echo </span><span class="string">"Encoded: "</span><span class="keyword">.</span><span class="default">$encrypted </span><span class="keyword">.</span><span class="string">"&lt;br&gt;"</span><span class="keyword">;<br>&nbsp; &nbsp; echo </span><span class="string">"&lt;br&gt;key1: </span><span class="default">$key1</span><span class="string"> &lt;br&gt;key2: </span><span class="default">$key2</span><span class="string">&lt;br&gt;created key: </span><span class="default">$key</span><span class="string">"</span><span class="keyword">;<br></span><span class="default">?&gt;</span>
</span>
</code></div>
  </div>
 </div>
  <div class="note" id="110495">  
  <a class="name">
  <strong class="user"><em>Mark</em></strong></a><div class="date" title="2012-10-29 02:11"><strong>1 year ago</strong></div>
  <div class="text" id="Hcom110495">
<div class="phpcode"><code><span class="html">
for errors like<br>' mcrypt_module_open(): Could not open encryption module in '<br><br>Make sure you're using the right name. The page giving the list of ciphers is NOT the right way to say each cipher (shown here <a rel="nofollow" target="_blank">http://www.php.net/manual/en/mcrypt.ciphers.php</a>).<br><br>In order to see what ones are supported, try phpinfo(); and look under mcrypt to find something like this<br><br>mcrypt support =&gt; enabled<br>mcrypt_filter support =&gt; enabled<br>Version =&gt; 2.5.8<br>Api No =&gt; 20021217<br>Supported ciphers =&gt; cast-128 gost rijndael-128 twofish arcfour cast-256 loki97 rijndael-192 saferplus wake blowfish-compat des rijndael-256<br> serpent xtea blowfish enigma rc2 tripledes <br>Supported modes =&gt; cbc cfb ctr ecb ncfb nofb ofb stream</span>
</code></div>
  </div>
 </div>
  <div class="note" id="92339">  
  <a class="name">
  <strong class="user"><em>lehmann*at*arcor-so.net</em></strong></a><div class="date" title="2009-07-20 08:10"><strong>5 years ago</strong></div>
  <div class="text" id="Hcom92339">
<div class="phpcode"><code><span class="html">
Keep in mind that the mcrypt functions do not implement padding like e.g. pkcs#5. This causes the problem with zero bytes at the end and the sting cannot be correctly decoded in other environments.<br><br>For an example how to add pkcs 5 padding, see ref.mcrypt.php</span>
</code></div>
  </div>
 </div>
  <div class="note" id="89937">  
  <a class="name">
  <strong class="user"><em>royconejo</em></strong></a><div class="date" title="2009-03-29 09:01"><strong>5 years ago</strong></div>
  <div class="text" id="Hcom89937">
<div class="phpcode"><code><span class="html">
about the previous comments on hex formatting and capitalization as a way to improve the key:<br><br>this would seem pretty obvious, but it is a choice to be limited to only hex characters ([0-9a-z]); you can get the original RAW output from md5() or sha1() and not the default readable hex formatting.<br><br>the result of a raw output will be 16 o 20 (depending on the hash function being used) series of chars in the range 0-255. way better than [0-9a-z] and even [0-9a-zA-Z].<br><br>16 or 20 is generally lower than the maximum key lenght ($ks in the example), but you can append two or more keys together:<br><br><span class="default">&lt;?php<br>$human_key1 </span><span class="keyword">= </span><span class="string">'something very secret'</span><span class="keyword">;<br></span><span class="default">$human_key2 </span><span class="keyword">= </span><span class="string">'something else very secret'</span><span class="keyword">;<br><br></span><span class="comment">// 40 bytes binary key using two "human readable" keys and sha1.<br></span><span class="default">$bigger_binary_key </span><span class="keyword">= </span><span class="default">sha1</span><span class="keyword">(</span><span class="default">$human_key1</span><span class="keyword">, </span><span class="default">true</span><span class="keyword">) . </span><span class="default">sha1</span><span class="keyword">(</span><span class="default">$human_key2</span><span class="keyword">, </span><span class="default">true</span><span class="keyword">);<br><br></span><span class="comment">// then just use it as you would (extract taken from the example)<br></span><span class="default">$key </span><span class="keyword">= </span><span class="default">substr</span><span class="keyword">(</span><span class="default">$bigger_binary_key</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">$ks</span><span class="keyword">);<br></span><span class="default">?&gt;<br></span><br>... or you can automatically split one large "human key" into two or more parts, hash those parts with sha1 (raw output!) and merge them together again (in original order or rearrange, salt, transform them as you like) to get a binary key of 40, 60, 80 or more chars depending on the number of parts the secret key has been splitted =)</span>
</code></div>
  </div>
 </div>
  <div class="note" id="84517">  
  <a class="name">
  <strong class="user"><em>ash</em></strong></a><div class="date" title="2008-07-17 03:07"><strong>6 years ago</strong></div>
  <div class="text" id="Hcom84517">
<div class="phpcode"><code><span class="html">
A slight improvement of dinamic's function to create a key:<br><br>I think the weak point is that capitals are always used in the same part of the string. The following code capitalizes random characters of the string, making the key less predictable:<br><br><span class="default">&lt;?php<br>$key </span><span class="keyword">= </span><span class="default">substr</span><span class="keyword">(</span><span class="default">$key1</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">$ks</span><span class="keyword">/</span><span class="default">2</span><span class="keyword">) . </span><span class="default">substr</span><span class="keyword">(</span><span class="default">$key2</span><span class="keyword">, (</span><span class="default">round</span><span class="keyword">(</span><span class="default">strlen</span><span class="keyword">(</span><span class="default">$key2</span><span class="keyword">) / </span><span class="default">2</span><span class="keyword">)), </span><span class="default">$ks</span><span class="keyword">/</span><span class="default">2</span><span class="keyword">);<br></span><span class="default">$key </span><span class="keyword">= </span><span class="default">substr</span><span class="keyword">(</span><span class="default">$key</span><span class="keyword">.</span><span class="default">$key1</span><span class="keyword">.</span><span class="default">$key2</span><span class="keyword">.</span><span class="default">$key1</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">,</span><span class="default">$ks</span><span class="keyword">);<br><br></span><span class="default">$buffer </span><span class="keyword">= </span><span class="default">str_split</span><span class="keyword">(</span><span class="default">$key</span><span class="keyword">);<br><br></span><span class="default">$limit </span><span class="keyword">= </span><span class="default">count</span><span class="keyword">(</span><span class="default">$buffer</span><span class="keyword">)-</span><span class="default">1</span><span class="keyword">;<br></span><span class="default">srand</span><span class="keyword">((float)</span><span class="default">microtime</span><span class="keyword">() * </span><span class="default">1000000</span><span class="keyword">);<br><br></span><span class="default">$end </span><span class="keyword">= </span><span class="default">rand</span><span class="keyword">(</span><span class="default">0</span><span class="keyword">, </span><span class="default">$limit</span><span class="keyword">);<br></span><span class="default">$a </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">;<br><br></span><span class="comment">// replace random chars with capitals<br></span><span class="keyword">while (</span><span class="default">$a </span><span class="keyword">&lt; </span><span class="default">$end</span><span class="keyword">) {&nbsp; &nbsp; <br>&nbsp; &nbsp; list(</span><span class="default">$usec</span><span class="keyword">, </span><span class="default">$sec</span><span class="keyword">) = </span><span class="default">explode</span><span class="keyword">(</span><span class="string">' '</span><span class="keyword">, </span><span class="default">microtime</span><span class="keyword">());<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$seed </span><span class="keyword">= ((float)</span><span class="default">$sec</span><span class="keyword">) + ((float) </span><span class="default">$usec </span><span class="keyword">* </span><span class="default">100000</span><span class="keyword">);<br>&nbsp; &nbsp; </span><span class="default">mt_srand</span><span class="keyword">(</span><span class="default">$seed</span><span class="keyword">);<br>&nbsp; &nbsp; <br>&nbsp; &nbsp; </span><span class="default">$index </span><span class="keyword">= </span><span class="default">mt_rand</span><span class="keyword">(</span><span class="default">0</span><span class="keyword">,</span><span class="default">$limit</span><span class="keyword">);<br>&nbsp; &nbsp; <br>&nbsp; &nbsp; </span><span class="default">$buffer</span><span class="keyword">[</span><span class="default">$index</span><span class="keyword">] = </span><span class="default">strtoupper</span><span class="keyword">(</span><span class="default">$buffer</span><span class="keyword">[</span><span class="default">$index</span><span class="keyword">]);<br>&nbsp; &nbsp; </span><span class="default">$a</span><span class="keyword">++;<br>}<br><br></span><span class="default">$key </span><span class="keyword">= </span><span class="default">join</span><span class="keyword">(</span><span class="string">''</span><span class="keyword">, </span><span class="default">$buffer</span><span class="keyword">);<br></span><span class="default">?&gt;</span>
</span>
</code></div>
  </div>
 </div>
  <div class="note" id="34611">  
  <a class="name"><strong class="user"><em>Anonymous</em></strong></a><div class="date" title="2003-07-31 08:14"><strong>11 years ago</strong></div>
  <div class="text" id="Hcom34611">
<div class="phpcode"><code><span class="html">
Doing a trim($decrypted) will remove the null padding that may occur as a result of decryption.<br><br>The problem is if you're encrypting something like a MSWord document which can commonly end with nulls. The result $decrypted will be smaller than the original cleartext - which will then fail to open in MSOffice.<br><br>To get around this, make sure you store the length of the original cleartext, and when you decrypt it, do:<br><br>$decrypted = substr(mdecrypt_generic($td, $encrypted), 0, $originalLength);</span>
</code></div>
  </div>
 </div></div>

 
</section>    </section><!-- layout-content -->
        


  </div><!-- layout -->
         
  

    
 <!-- External and third party libraries. -->
 







<a id="toTop" href="javascript:;"><span id="toTopHover"></span><img width="40" height="40" alt="To Top" src="../../images/to-top%402x.png"></a>



<!-- Mirrored from php.net/manual/en/function.mcrypt-module-open.php by HTTrack Website Copier/3.x [XR&CO'2013], Thu, 28 Aug 2014 16:16:52 GMT -->


</body></html>