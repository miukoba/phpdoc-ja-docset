<html><!-- Mirrored from php.net/manual/en/function.mysql-real-escape-string.php by HTTrack Website Copier/3.x [XR&CO'2013], Thu, 28 Aug 2014 15:54:49 GMT --><!-- Added by HTTrack --><head><meta http-equiv="content-type" content="text/html;charset=utf-8"><!-- /Added by HTTrack -->


  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0"> 

  <title>mysql_real_escape_string</title>

 <link rel="shortcut icon" href="../../favicon.ico">
 <link rel="search" type="application/opensearchdescription+xml" href="http://php.net/phpnetimprovedsearch.src" title="Add PHP.net search">
 <link rel="alternate" type="application/atom+xml" href="http://php.net/releases/feed.php" title="PHP Release feed">
 <link rel="alternate" type="application/atom+xml" href="http://php.net/feed.atom" title="PHP: Hypertext Preprocessor">

 <link rel="canonical" href="function.mysql-real-escape-string.html">
 <link rel="shorturl" href="http://php.net/mysql-real-escape-string">
 <link rel="alternate" href="http://php.net/mysql-real-escape-string" hreflang="x-default">

 <link rel="contents" href="index-2.html">
 <link rel="index" href="ref.mysql.html">
 <link rel="prev" href="function.mysql-query.html">
 <link rel="next" href="function.mysql-result.html">

 <link rel="alternate" href="function.mysql-real-escape-string.html" hreflang="en">
 <link rel="alternate" href="http://php.net/manual/pt_BR/function.mysql-real-escape-string.php" hreflang="pt_BR">
 <link rel="alternate" href="http://php.net/manual/zh/function.mysql-real-escape-string.php" hreflang="zh">
 <link rel="alternate" href="http://php.net/manual/fr/function.mysql-real-escape-string.php" hreflang="fr">
 <link rel="alternate" href="http://php.net/manual/de/function.mysql-real-escape-string.php" hreflang="de">
 <link rel="alternate" href="http://php.net/manual/it/function.mysql-real-escape-string.php" hreflang="it">
 <link rel="alternate" href="http://php.net/manual/ja/function.mysql-real-escape-string.php" hreflang="ja">
 <link rel="alternate" href="http://php.net/manual/ro/function.mysql-real-escape-string.php" hreflang="ro">
 <link rel="alternate" href="http://php.net/manual/ru/function.mysql-real-escape-string.php" hreflang="ru">
 <link rel="alternate" href="http://php.net/manual/es/function.mysql-real-escape-string.php" hreflang="es">
 <link rel="alternate" href="http://php.net/manual/tr/function.mysql-real-escape-string.php" hreflang="tr">

<link rel="stylesheet" type="text/css" href="../../cached8fe1.css?t=1401250819&amp;f=/fonts/Fira/fira.css" media="screen">
<link rel="stylesheet" type="text/css" href="../../cached4b8d.css?t=1404368420&amp;f=/fonts/Font-Awesome/css/fontello.css" media="screen">
<link rel="stylesheet" type="text/css" href="../../cached5065.css?t=1403329232&amp;f=/styles/theme-base.css" media="screen">
<link rel="stylesheet" type="text/css" href="../../cachedc78d.css?t=1401249623&amp;f=/styles/theme-medium.css" media="screen">

 <!--[if lte IE 7]>
 <link rel="stylesheet" type="text/css" href="http://php.net/styles/workarounds.ie7.css" media="screen">
 <![endif]-->

 <!--[if lte IE 8]>
 <script type="text/javascript">
  window.brokenIE = true;
 </script>
 <![endif]-->

 <!--[if lte IE 9]>
 <link rel="stylesheet" type="text/css" href="http://php.net/styles/workarounds.ie9.css" media="screen">
 <![endif]-->

 <!--[if IE]>
 <script type="text/javascript" src="http://php.net/js/ext/html5.js"></script>
 <![endif]-->

 <base>

</head>
<body class="docs " style="">


<div class="headsup"><a href="http://php.net/index.php#id2014-08-28-1">PHP 5.6.0 released</a></div>
<nav id="trick"><div><dl>
<dt><a href="getting-started.html">Getting Started</a></dt>
	<dd><a href="introduction.html">Introduction</a></dd>
	<dd><a href="tutorial.html">A simple tutorial</a></dd>
<dt><a href="langref.html">Language Reference</a></dt>
	<dd><a href="language.basic-syntax.html">Basic syntax</a></dd>
	<dd><a href="language.types.html">Types</a></dd>
	<dd><a href="language.variables.html">Variables</a></dd>
	<dd><a href="language.constants.html">Constants</a></dd>
	<dd><a href="language.expressions.html">Expressions</a></dd>
	<dd><a href="language.operators.html">Operators</a></dd>
	<dd><a href="language.control-structures.html">Control Structures</a></dd>
	<dd><a href="language.functions.html">Functions</a></dd>
	<dd><a href="language.oop5.html">Classes and Objects</a></dd>
	<dd><a href="language.namespaces.html">Namespaces</a></dd>
	<dd><a href="language.exceptions.html">Exceptions</a></dd>
	<dd><a href="language.generators.html">Generators</a></dd>
	<dd><a href="language.references.html">References Explained</a></dd>
	<dd><a href="reserved.variables.html">Predefined Variables</a></dd>
	<dd><a href="reserved.exceptions.html">Predefined Exceptions</a></dd>
	<dd><a href="reserved.interfaces.html">Predefined Interfaces and Classes</a></dd>
	<dd><a href="context.html">Context options and parameters</a></dd>
	<dd><a href="wrappers.html">Supported Protocols and Wrappers</a></dd>
</dl>
<dl>
<dt><a href="security.html">Security</a></dt>
	<dd><a href="security.intro.html">Introduction</a></dd>
	<dd><a href="security.general.html">General considerations</a></dd>
	<dd><a href="security.cgi-bin.html">Installed as CGI binary</a></dd>
	<dd><a href="security.apache.html">Installed as an Apache module</a></dd>
	<dd><a href="security.filesystem.html">Filesystem Security</a></dd>
	<dd><a href="security.database.html">Database Security</a></dd>
	<dd><a href="security.errors.html">Error Reporting</a></dd>
	<dd><a href="security.globals.html">Using Register Globals</a></dd>
	<dd><a href="security.variables.html">User Submitted Data</a></dd>
	<dd><a href="security.magicquotes.html">Magic Quotes</a></dd>
	<dd><a href="security.hiding.html">Hiding PHP</a></dd>
	<dd><a href="security.current.html">Keeping Current</a></dd>
<dt><a href="features.html">Features</a></dt>
	<dd><a href="features.http-auth.html">HTTP authentication with PHP</a></dd>
	<dd><a href="features.cookies.html">Cookies</a></dd>
	<dd><a href="features.sessions.html">Sessions</a></dd>
	<dd><a href="features.xforms.html">Dealing with XForms</a></dd>
	<dd><a href="features.file-upload.html">Handling file uploads</a></dd>
	<dd><a href="features.remote-files.html">Using remote files</a></dd>
	<dd><a href="features.connection-handling.html">Connection handling</a></dd>
	<dd><a href="features.persistent-connections.html">Persistent Database Connections</a></dd>
	<dd><a href="features.safe-mode.html">Safe Mode</a></dd>
	<dd><a href="features.commandline.html">Command line usage</a></dd>
	<dd><a href="features.gc.html">Garbage Collection</a></dd>
	<dd><a href="features.dtrace.html">DTrace Dynamic Tracing</a></dd>
</dl>
<dl>
<dt><a href="funcref.html">Function Reference</a></dt>
	<dd><a href="refs.basic.php.html">Affecting PHP's Behaviour</a></dd>
	<dd><a href="refs.utilspec.audio.html">Audio Formats Manipulation</a></dd>
	<dd><a href="refs.remote.auth.html">Authentication Services</a></dd>
	<dd><a href="refs.utilspec.cmdline.html">Command Line Specific Extensions</a></dd>
	<dd><a href="refs.compression.html">Compression and Archive Extensions</a></dd>
	<dd><a href="refs.creditcard.html">Credit Card Processing</a></dd>
	<dd><a href="refs.crypto.html">Cryptography Extensions</a></dd>
	<dd><a href="refs.database.html">Database Extensions</a></dd>
	<dd><a href="refs.calendar.html">Date and Time Related Extensions</a></dd>
	<dd><a href="refs.fileprocess.file.html">File System Related Extensions</a></dd>
	<dd><a href="refs.international.html">Human Language and Character Encoding Support</a></dd>
	<dd><a href="refs.utilspec.image.html">Image Processing and Generation</a></dd>
	<dd><a href="refs.remote.mail.html">Mail Related Extensions</a></dd>
	<dd><a href="refs.math.html">Mathematical Extensions</a></dd>
	<dd><a href="refs.utilspec.nontext.html">Non-Text MIME Output</a></dd>
	<dd><a href="refs.fileprocess.process.html">Process Control Extensions</a></dd>
	<dd><a href="refs.basic.other.html">Other Basic Extensions</a></dd>
	<dd><a href="refs.remote.other.html">Other Services</a></dd>
	<dd><a href="refs.search.html">Search Engine Extensions</a></dd>
	<dd><a href="refs.utilspec.server.html">Server Specific Extensions</a></dd>
	<dd><a href="refs.basic.session.html">Session Extensions</a></dd>
	<dd><a href="refs.basic.text.html">Text Processing</a></dd>
	<dd><a href="refs.basic.vartype.html">Variable and Type Related Extensions</a></dd>
	<dd><a href="refs.webservice.html">Web Services</a></dd>
	<dd><a href="refs.utilspec.windows.html">Windows Only Extensions</a></dd>
	<dd><a href="refs.xml.html">XML Manipulation</a></dd>
</dl>
<dl>
<dt>Keyboard Shortcuts</dt><dt>?</dt>
<dd>This help</dd>
<dt>j</dt>
<dd>Next menu item</dd>
<dt>k</dt>
<dd>Previous menu item</dd>
<dt>g p</dt>
<dd>Previous man page</dd>
<dt>g n</dt>
<dd>Next man page</dd>
<dt>G</dt>
<dd>Scroll to bottom</dd>
<dt>g g</dt>
<dd>Scroll to top</dd>
<dt>g h</dt>
<dd>Goto homepage</dd>
<dt>g s</dt>
<dd>Goto search<br>(current page)</dd>
<dt>/</dt>
<dd>Focus search box</dd>
</dl></div></nav>
<div id="goto">
    <div class="search">
         <div class="text"></div>
         <div class="results"><ul></ul></div>
   </div>
</div>

  <div id="breadcrumbs" class="row-fluid">
          
              
        <ul class="breadcrumbs-container">
            <li><a href="index-2.html">PHP Manual</a></li>      <li><a href="funcref.html">Function Reference</a></li>      <li><a href="refs.database.html">Database Extensions</a></li>      <li><a href="refs.database.vendors.html">Vendor Specific Database Extensions</a></li>      <li><a href="set.mysqlinfo.html">MySQL</a></li>      <li><a href="book.mysql.html">Mysql</a></li>      <li><a href="ref.mysql.html">MySQL Functions</a></li>    </ul>
  </div>




<div id="layout">
  <section id="layout-content">
  <div id="function.mysql-real-escape-string" class="refentry">
 <div class="refnamediv">
  <h1 class="refname">mysql_real_escape_string</h1>
  <p class="verinfo">(PHP 4 &gt;= 4.3.0, PHP 5)</p><p class="refpurpose"><span class="refname">mysql_real_escape_string</span> â€” <span class="dc-title">Escapes special characters in a string for use in an SQL statement</span></p>

 </div>

 <div id="function.mysql-real-escape-string-refsynopsisdiv">
  <div class="warning"><strong class="warning">Warning</strong>
   <p class="para">This extension is deprecated as of PHP 5.5.0, and will be removed in the future.
Instead, the <a href="book.mysqli.html" class="link">MySQLi</a> or <a href="ref.pdo-mysql.html" class="link">PDO_MySQL</a> extension should be used.
See also <a href="mysqlinfo.api.choosing.html" class="link">MySQL: choosing an API</a> guide and
<a href="faq.databases.html#faq.databases.mysql.deprecated" class="link">related FAQ</a> for more information. 
Alternatives to this function include:</p>
   <ul class="simplelist">
    <li class="member"><span class="function"><a href="mysqli.real-escape-string.html" class="function">mysqli_real_escape_string()</a></span></li>
    <li class="member"><span class="methodname"><a href="pdo.quote.html" class="methodname">PDO::quote()</a></span></li>
   </ul>
  </div>
 </div>

 <div class="refsect1 description" id="refsect1-function.mysql-real-escape-string-description">
  <h3 class="title">Description</h3>
  <div class="methodsynopsis dc-description">
   <span class="type">string</span> <span class="methodname"><strong>mysql_real_escape_string</strong></span>
    ( <span class="methodparam"><span class="type">string</span> <code class="parameter">$unescaped_string</code></span>
   [, <span class="methodparam"><span class="type">resource</span> <code class="parameter">$link_identifier</code><span class="initializer"> = NULL</span></span>
  ] )</div>

  <p class="para rdfs-comment">
   Escapes special characters in the <code class="parameter">unescaped_string</code>, 
   taking into account the current character set of the connection so that it 
   is safe to place it in a <span class="function"><a href="function.mysql-query.html" class="function">mysql_query()</a></span>. If binary data 
   is to be inserted, this function must be used.
  </p>
  <p class="para">
   <span class="function"><strong>mysql_real_escape_string()</strong></span> calls MySQL's library function
   mysql_real_escape_string, which prepends backslashes to the following characters:
   <em>\x00</em>, <em>\n</em>,
   <em>\r</em>, <em>\</em>, <em>'</em>,
   <em>"</em> and <em>\x1a</em>.
  </p>
  <p class="para">
   This function must always (with few exceptions) be used to make data
   safe before sending a query to MySQL.
  </p>
  
  <div class="caution"><strong class="caution">Caution</strong>
   <h1 class="title">Security: the default character set</h1>
   <p class="para">
    The character set must be set either at the server level, or with
    the API function <span class="function"><a href="function.mysql-set-charset.html" class="function">mysql_set_charset()</a></span> for it to affect
    <span class="function"><strong>mysql_real_escape_string()</strong></span>. See the concepts section
    on <a href="mysqlinfo.concepts.charset.html" class="link">character sets</a> for
    more information.
   </p>
  </div>
 </div>


 <div class="refsect1 parameters" id="refsect1-function.mysql-real-escape-string-parameters">
  <h3 class="title">Parameters</h3>
  <p class="para">
   </p><dl>

    
     <dt>
<code class="parameter">unescaped_string</code></dt>

     <dd>

      <p class="para">
       The string that is to be escaped.
      </p>
     </dd>

    
    <dt>
<code class="parameter">
link_identifier</code></dt>
<dd>
<p class="para">The MySQL connection. If the
link identifier is not specified, the last link opened by
<span class="function"><a href="function.mysql-connect.html" class="function">mysql_connect()</a></span> is assumed. If no such link is found, it
will try to create one as if <span class="function"><a href="function.mysql-connect.html" class="function">mysql_connect()</a></span> was called
with no arguments. If no connection is found or established, an
<strong><code>E_WARNING</code></strong> level error is generated.</p></dd>


   </dl>

  <p></p>
 </div>


 <div class="refsect1 returnvalues" id="refsect1-function.mysql-real-escape-string-returnvalues">
  <h3 class="title">Return Values</h3>
  <p class="para">
   Returns the escaped string, or <strong><code>FALSE</code></strong> on error.
  </p>
 </div>


 <div class="refsect1 examples" id="refsect1-function.mysql-real-escape-string-examples">
  <h3 class="title">Examples</h3>
  <p class="para">
   </p><div class="example" id="example-1690">
    <p><strong>Example #1 Simple <span class="function"><strong>mysql_real_escape_string()</strong></span> example</strong></p>
    <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br></span><span style="color: #FF8000">//&nbsp;Connect<br></span><span style="color: #0000BB">$link&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">mysql_connect</span><span style="color: #007700">(</span><span style="color: #DD0000">'mysql_host'</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">'mysql_user'</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">'mysql_password'</span><span style="color: #007700">)<br>&nbsp;&nbsp;&nbsp;&nbsp;OR&nbsp;die(</span><span style="color: #0000BB">mysql_error</span><span style="color: #007700">());<br><br></span><span style="color: #FF8000">//&nbsp;Query<br></span><span style="color: #0000BB">$query&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">sprintf</span><span style="color: #007700">(</span><span style="color: #DD0000">"SELECT&nbsp;*&nbsp;FROM&nbsp;users&nbsp;WHERE&nbsp;user='%s'&nbsp;AND&nbsp;password='%s'"</span><span style="color: #007700">,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">mysql_real_escape_string</span><span style="color: #007700">(</span><span style="color: #0000BB">$user</span><span style="color: #007700">),<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">mysql_real_escape_string</span><span style="color: #007700">(</span><span style="color: #0000BB">$password</span><span style="color: #007700">));<br></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
    </div>

   </div>
  <p></p>
  <p class="para">
   </p><div class="example" id="example-1691">
    <p><strong>Example #2 An example SQL Injection Attack</strong></p>
    <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br></span><span style="color: #FF8000">//&nbsp;We&nbsp;didn't&nbsp;check&nbsp;$_POST['password'],&nbsp;it&nbsp;could&nbsp;be&nbsp;anything&nbsp;the&nbsp;user&nbsp;wanted!&nbsp;For&nbsp;example:<br></span><span style="color: #0000BB">$_POST</span><span style="color: #007700">[</span><span style="color: #DD0000">'username'</span><span style="color: #007700">]&nbsp;=&nbsp;</span><span style="color: #DD0000">'aidan'</span><span style="color: #007700">;<br></span><span style="color: #0000BB">$_POST</span><span style="color: #007700">[</span><span style="color: #DD0000">'password'</span><span style="color: #007700">]&nbsp;=&nbsp;</span><span style="color: #DD0000">"'&nbsp;OR&nbsp;''='"</span><span style="color: #007700">;<br><br></span><span style="color: #FF8000">//&nbsp;Query&nbsp;database&nbsp;to&nbsp;check&nbsp;if&nbsp;there&nbsp;are&nbsp;any&nbsp;matching&nbsp;users<br></span><span style="color: #0000BB">$query&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #DD0000">"SELECT&nbsp;*&nbsp;FROM&nbsp;users&nbsp;WHERE&nbsp;user='</span><span style="color: #007700">{</span><span style="color: #0000BB">$_POST</span><span style="color: #007700">[</span><span style="color: #DD0000">'username'</span><span style="color: #007700">]}</span><span style="color: #DD0000">'&nbsp;AND&nbsp;password='</span><span style="color: #007700">{</span><span style="color: #0000BB">$_POST</span><span style="color: #007700">[</span><span style="color: #DD0000">'password'</span><span style="color: #007700">]}</span><span style="color: #DD0000">'"</span><span style="color: #007700">;<br></span><span style="color: #0000BB">mysql_query</span><span style="color: #007700">(</span><span style="color: #0000BB">$query</span><span style="color: #007700">);<br><br></span><span style="color: #FF8000">//&nbsp;This&nbsp;means&nbsp;the&nbsp;query&nbsp;sent&nbsp;to&nbsp;MySQL&nbsp;would&nbsp;be:<br></span><span style="color: #007700">echo&nbsp;</span><span style="color: #0000BB">$query</span><span style="color: #007700">;<br></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
    </div>

     <div class="example-contents"><p>
      The query sent to MySQL:
     </p></div>
    <div class="example-contents screen">
<div class="cdata"><pre>SELECT * FROM users WHERE user='aidan' AND password='' OR ''=''
</pre></div>
    </div>
    <div class="example-contents"><p>
     This would allow anyone to log in without a valid password.
    </p></div>
   </div>
  <p></p>
 </div>


 <div class="refsect1 notes" id="refsect1-function.mysql-real-escape-string-notes">
  <h3 class="title">Notes</h3>
  <blockquote class="note"><p><strong class="note">Note</strong>: 
   </p><p class="para">
    A MySQL connection is required before using 
    <span class="function"><strong>mysql_real_escape_string()</strong></span> otherwise an error of
    level <strong><code>E_WARNING</code></strong> is generated, and <strong><code>FALSE</code></strong> is 
    returned. If <code class="parameter">link_identifier</code> isn't defined, the
    last MySQL connection is used.
   </p>
  <p></p></blockquote>
  <blockquote class="note"><p><strong class="note">Note</strong>: 
   </p><p class="para">
    If <a href="info.configuration.html#ini.magic-quotes-gpc" class="link">magic_quotes_gpc</a> is enabled,
    first apply <span class="function"><a href="function.stripslashes.html" class="function">stripslashes()</a></span> to the data. Using this function
    on data which has already been escaped will escape the data twice.
   </p>
  <p></p></blockquote>
  <blockquote class="note"><p><strong class="note">Note</strong>: 
   </p><p class="para">
    If this function is not used to escape data, the query is vulnerable to
    <a href="security.database.sql-injection.html" class="link">SQL Injection Attacks</a>.
   </p>
  <p></p></blockquote>
  <blockquote class="note"><p><strong class="note">Note</strong>: 
   <span class="simpara">
    <span class="function"><strong>mysql_real_escape_string()</strong></span> does not escape
    <em>%</em> and <em>_</em>. These are wildcards in
    MySQL if combined with <em>LIKE</em>, <em>GRANT</em>,
    or <em>REVOKE</em>.
   </span>
  </p></blockquote>
 </div>


 <div class="refsect1 seealso" id="refsect1-function.mysql-real-escape-string-seealso">
  <h3 class="title">See Also</h3>
  <p class="para">
   </p><ul class="simplelist">
    <li class="member"><span class="function"><a href="function.mysql-set-charset.html" class="function" rel="rdfs-seeAlso">mysql_set_charset()</a> - Sets the client character set</span></li>
    <li class="member"><span class="function"><a href="function.mysql-client-encoding.html" class="function" rel="rdfs-seeAlso">mysql_client_encoding()</a> - Returns the name of the character set</span></li>
    <li class="member"><span class="function"><a href="function.addslashes.html" class="function" rel="rdfs-seeAlso">addslashes()</a> - Quote string with slashes</span></li>
    <li class="member"><span class="function"><a href="function.stripslashes.html" class="function" rel="rdfs-seeAlso">stripslashes()</a> - Un-quotes a quoted string</span></li>
    <li class="member">The <a href="info.configuration.html#ini.magic-quotes-gpc" class="link">magic_quotes_gpc</a> directive</li>
    <li class="member">The <a href="info.configuration.html#ini.magic-quotes-runtime" class="link">magic_quotes_runtime</a> directive</li>
   </ul>
  <p></p>
 </div>

</div>
<section id="usernotes">
 <div class="head"><h3 class="title">User Contributed Notes</h3></div><div id="allnotes">
  <div class="note" id="101248">  
  <a class="name">
  <strong class="user"><em>feedr</em></strong></a><div class="date" title="2010-12-05 08:38"><strong>3 years ago</strong></div>
  <div class="text" id="Hcom101248">
<div class="phpcode"><code><span class="html">
Just a little function which mimics the original mysql_real_escape_string but which doesn't need an active mysql connection. Could be implemented as a static function in a database class. Hope it helps someone.
<br>
<br><span class="default">&lt;?php
<br></span><span class="keyword">function </span><span class="default">mysql_escape_mimic</span><span class="keyword">(</span><span class="default">$inp</span><span class="keyword">) {
<br>&nbsp; &nbsp; if(</span><span class="default">is_array</span><span class="keyword">(</span><span class="default">$inp</span><span class="keyword">))
<br>&nbsp; &nbsp; &nbsp; &nbsp; return </span><span class="default">array_map</span><span class="keyword">(</span><span class="default">__METHOD__</span><span class="keyword">, </span><span class="default">$inp</span><span class="keyword">);
<br>
<br>&nbsp; &nbsp; if(!empty(</span><span class="default">$inp</span><span class="keyword">) &amp;&amp; </span><span class="default">is_string</span><span class="keyword">(</span><span class="default">$inp</span><span class="keyword">)) {
<br>&nbsp; &nbsp; &nbsp; &nbsp; return </span><span class="default">str_replace</span><span class="keyword">(array(</span><span class="string">'\\'</span><span class="keyword">, </span><span class="string">"\0"</span><span class="keyword">, </span><span class="string">"\n"</span><span class="keyword">, </span><span class="string">"\r"</span><span class="keyword">, </span><span class="string">"'"</span><span class="keyword">, </span><span class="string">'"'</span><span class="keyword">, </span><span class="string">"\x1a"</span><span class="keyword">), array(</span><span class="string">'\\\\'</span><span class="keyword">, </span><span class="string">'\\0'</span><span class="keyword">, </span><span class="string">'\\n'</span><span class="keyword">, </span><span class="string">'\\r'</span><span class="keyword">, </span><span class="string">"\\'"</span><span class="keyword">, </span><span class="string">'\\"'</span><span class="keyword">, </span><span class="string">'\\Z'</span><span class="keyword">), </span><span class="default">$inp</span><span class="keyword">);
<br>&nbsp; &nbsp; }
<br>
<br>&nbsp; &nbsp; return </span><span class="default">$inp</span><span class="keyword">;
<br>}
<br></span><span class="default">?&gt;</span>
</span>
</code></div>
  </div>
 </div>
  <div class="note" id="108125">  
  <a class="name">
  <strong class="user"><em>Walter Tross</em></strong></a><div class="date" title="2012-03-30 02:20"><strong>2 years ago</strong></div>
  <div class="text" id="Hcom108125">
<div class="phpcode"><code><span class="html">
For further information:<br><a rel="nofollow" target="_blank">http://dev.mysql.com/doc/refman/5.5/en/mysql-real-escape-string.html</a><br>(replace your MySQL version in the URL)</span>
</code></div>
  </div>
 </div>
  <div class="note" id="91504">  
  <a class="name">
  <strong class="user"><em>info at saturnprods dot com</em></strong></a><div class="date" title="2009-06-13 12:37"><strong>5 years ago</strong></div>
  <div class="text" id="Hcom91504">
<div class="phpcode"><code><span class="html">
I always use this function so I don't have to retype over and over the mysql_real_escape_string function.
<br>
<br><span class="default">&lt;?php
<br></span><span class="keyword">function </span><span class="default">safe</span><span class="keyword">(</span><span class="default">$value</span><span class="keyword">){
<br>&nbsp;&nbsp; return </span><span class="default">mysql_real_escape_string</span><span class="keyword">(</span><span class="default">$value</span><span class="keyword">);
<br>}
<br></span><span class="default">?&gt;
<br></span>
<br>Then, when I am using my code, I simply use:
<br>
<br><span class="default">&lt;?php
<br>$name </span><span class="keyword">= </span><span class="default">safe</span><span class="keyword">(</span><span class="default">$_POST</span><span class="keyword">[</span><span class="string">"name"</span><span class="keyword">]);
<br></span><span class="default">$password </span><span class="keyword">= </span><span class="default">safe</span><span class="keyword">(</span><span class="default">$_POST</span><span class="keyword">[</span><span class="string">"password"</span><span class="keyword">]);
<br></span><span class="default">?&gt;</span>
</span>
</code></div>
  </div>
 </div>
  <div class="note" id="107101">  
  <a class="name">
  <strong class="user"><em>ovoznyak at gmail dot com</em></strong></a><div class="date" title="2012-01-07 03:25"><strong>2 years ago</strong></div>
  <div class="text" id="Hcom107101">
<div class="phpcode"><code><span class="html">
Function safe_string_escape($str) above is not properly working when $str is numeric (not string).<br><br>For example, when call them as safe_string_escape((int) 12), it returns empty string. At the same time mysql_real_escape_string() returns 12.<br><br>So, it is safe to add $str = (string) $str; in the begin of function.</span>
</code></div>
  </div>
 </div>
  <div class="note" id="66836">  
  <a class="name">
  <strong class="user"><em>nicolas</em></strong></a><div class="date" title="2006-05-30 01:38"><strong>8 years ago</strong></div>
  <div class="text" id="Hcom66836">
<div class="phpcode"><code><span class="html">
Note that mysql_real_escape_string doesn't prepend backslashes to \x00, \n, \r, and and \x1a as mentionned in the documentation, but actually replaces the character with a MySQL acceptable representation for queries (e.g. \n is replaced with the '\n' litteral). (\, ', and " are escaped as documented) This doesn't change how you should use this function, but I think it's good to know.</span>
</code></div>
  </div>
 </div>
  <div class="note" id="102168">  
  <a class="name">
  <strong class="user"><em>stefan dot van dot beusekom at gmail dot com</em></strong></a><div class="date" title="2011-01-31 05:36"><strong>3 years ago</strong></div>
  <div class="text" id="Hcom102168">
<div class="phpcode"><code><span class="html">
Following is a recursive function that makes all the strings it finds safe for data entry. If the underlying value is an array, it will loop through that array as well, to inifity. So any array depth is allowed. This might come in handy when dealing with sessions, posts, gets or whatnot arrays, where you immediately want to make use of the data without having to filter the data first.<br><br><span class="default">&lt;?php<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="comment">/*<br>&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; * Created by: Stefan van Beusekom<br>&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; * Created on: 31-01-2011<br>&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; * Description: A method that ensures safe data entry, and accepts either strings or arrays. If the array is multidimensional, <br>&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; *&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; it will recursively loop through the array and make all points of data safe for entry.<br>&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; * parameters: string or array;<br>&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; * return: string or array;<br>&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; */<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="keyword">public function </span><span class="default">filterParameters</span><span class="keyword">(</span><span class="default">$array</span><span class="keyword">) {<br>&nbsp; &nbsp; &nbsp; &nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="comment">// Check if the parameter is an array<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="keyword">if(</span><span class="default">is_array</span><span class="keyword">(</span><span class="default">$array</span><span class="keyword">)) {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="comment">// Loop through the initial dimension<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="keyword">foreach(</span><span class="default">$array </span><span class="keyword">as </span><span class="default">$key </span><span class="keyword">=&gt; </span><span class="default">$value</span><span class="keyword">) {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="comment">// Check if any nodes are arrays themselves<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="keyword">if(</span><span class="default">is_array</span><span class="keyword">(</span><span class="default">$array</span><span class="keyword">[</span><span class="default">$key</span><span class="keyword">]))<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="comment">// If they are, let the function call itself over that particular node<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$array</span><span class="keyword">[</span><span class="default">$key</span><span class="keyword">] = </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">filterParameters</span><span class="keyword">(</span><span class="default">$array</span><span class="keyword">[</span><span class="default">$key</span><span class="keyword">]);<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="comment">// Check if the nodes are strings<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="keyword">if(</span><span class="default">is_string</span><span class="keyword">(</span><span class="default">$array</span><span class="keyword">[</span><span class="default">$key</span><span class="keyword">]))<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="comment">// If they are, perform the real escape function over the selected node<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$array</span><span class="keyword">[</span><span class="default">$key</span><span class="keyword">] = </span><span class="default">mysql_real_escape_string</span><span class="keyword">(</span><span class="default">$array</span><span class="keyword">[</span><span class="default">$key</span><span class="keyword">]);<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="comment">// Check if the parameter is a string<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="keyword">if(</span><span class="default">is_string</span><span class="keyword">(</span><span class="default">$array</span><span class="keyword">))<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="comment">// If it is, perform a&nbsp; mysql_real_escape_string on the parameter<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$array </span><span class="keyword">= </span><span class="default">mysql_real_escape_string</span><span class="keyword">(</span><span class="default">$array</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="comment">// Return the filtered result<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="keyword">return </span><span class="default">$array</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; }<br><br></span><span class="default">?&gt;</span>
</span>
</code></div>
  </div>
 </div>
  <div class="note" id="107499">  
  <a class="name">
  <strong class="user"><em>jeff at lindenlab dot com</em></strong></a><div class="date" title="2012-02-14 01:35"><strong>2 years ago</strong></div>
  <div class="text" id="Hcom107499">
<div class="phpcode"><code><span class="html">
Yes, this means that you have to start a connection before you can escape data... you can't escape the data first, and then use it to build your SQL, and then connect.&nbsp; <br><br>Be aware of this when you're designing objects and architecture.</span>
</code></div>
  </div>
 </div>
  <div class="note" id="95009">  
  <a class="name">
  <strong class="user"><em>strata_ranger at hotmail dot com</em></strong></a><div class="date" title="2009-12-08 11:17"><strong>4 years ago</strong></div>
  <div class="text" id="Hcom95009">
<div class="phpcode"><code><span class="html">
There's an interesting quirk in the example #2 about SQL injection:&nbsp; AND takes priority over OR, so the injected query actually executes as WHERE (user='aidan' AND password='') OR ''='', so instead of returning a database record corresponding to an arbitrary username (in this case 'aidan'), it would actually return ALL database records.&nbsp; In no particular order.&nbsp; So an attacker might be able to log in as any account, but not necessarily with any control over which account it is.<br><br>Of course a potential attacker could simply modify their parameters to target specific users of interest:<br><br><span class="default">&lt;?php<br><br></span><span class="comment">// E.g. attacker's values<br></span><span class="default">$_POST</span><span class="keyword">[</span><span class="string">'username'</span><span class="keyword">] = </span><span class="string">''</span><span class="keyword">;<br></span><span class="default">$_POST</span><span class="keyword">[</span><span class="string">'password'</span><span class="keyword">] = </span><span class="string">"' OR user = 'administrator' AND '' = '"</span><span class="keyword">;<br><br></span><span class="comment">// Malformed query<br></span><span class="default">$query </span><span class="keyword">= </span><span class="string">"SELECT * FROM users WHERE user='</span><span class="default">$_POST</span><span class="keyword">[</span><span class="default">username</span><span class="keyword">]</span><span class="string">' AND password='</span><span class="default">$_POST</span><span class="keyword">[</span><span class="default">password</span><span class="keyword">]</span><span class="string">'"</span><span class="keyword">;<br><br>echo </span><span class="default">$query</span><span class="keyword">;<br><br></span><span class="comment">// The query sent to MySQL would read:<br>// SELECT * FROM users WHERE user='' AND password='' OR user='administrator' AND ''='';<br>// which would allow anyone to gain access to the account named 'administrator'<br><br></span><span class="default">?&gt;</span>
</span>
</code></div>
  </div>
 </div>
  <div class="note" id="110413">  
  <a class="name">
  <strong class="user"><em>sam at numbsafari dot com</em></strong></a><div class="date" title="2012-10-19 05:33"><strong>1 year ago</strong></div>
  <div class="text" id="Hcom110413">
<div class="phpcode"><code><span class="html">
No discussion of escaping is complete without telling everyone that you should basically never use external input to generate interpreted code. This goes for SQL statements, or anything you would call any sort of "eval" function on.
<br>
<br>So, instead of using this terribly broken function, use parametric prepared statements instead.
<br>
<br>Honestly, using user provided data to compose SQL statements should be considered professional negligence and you should be held accountable by your employer or client for not using parametric prepared statements.
<br>
<br>What does that mean?
<br>
<br>It means instead of building a SQL statement like this:
<br>
<br>"INSERT INTO X (A) VALUES(".$_POST["a"].")"
<br>
<br>You should use mysqli's prepare() function (<a rel="nofollow" target="_blank">http://php.net/manual/en/mysqli.prepare.php</a>) to execute a statement that looks like this:
<br>
<br>"INSERT INTO X (A) VALUES(?)"
<br>
<br>NB: This doesn't mean you should never generate dynamic SQL statements. What it means is that you should never use user-provided data to generate those statements. Any user-provided data should be passed through as parameters to the statement after it has been prepared.
<br>
<br>So, for example, if you are building up a little framework and want to do an insert to a table based on the request URI, it's in your best interest to not take the $_SERVER['REQUEST_URI'] value (or any part of it) and directly concatenate that with your query. Instead,&nbsp; you should parse out the portion of the $_SERVER['REQUEST_URI'] value that you want, and map that through some kind of function or associative array to a non-user provided value. If the mapping produces no value, you know that something is wrong with the user provided data.
<br>
<br>Failing to follow this has been the cause of a number of SQL-injection problems in the Ruby On Rails framework, even though it uses parametric prepared statements. This is how GitHub was hacked at one point. So, no language is immune to this problem. That's why this is a general best practice and not something specific to PHP and why you should REALLY adopt it.
<br>
<br>Also, you should still do some kind of validation of the data provided by users, even when using parametric prepared statements. This is because that user-provided data will often become part of some generated HTML, and you want to ensure that the user provided data isn't going to cause security problems in the browser.</span>
</code></div>
  </div>
 </div>
  <div class="note" id="97933">  
  <a class="name">
  <strong class="user"><em>manixrock -~- gmail ~-~ com</em></strong></a><div class="date" title="2010-05-16 04:07"><strong>4 years ago</strong></div>
  <div class="text" id="Hcom97933">
<div class="phpcode"><code><span class="html">
I've come up with an easy way to more easily escape things in an sql query. The simpler things are, the lower the chance that you'll forget to escape something. I use a helper class:<br><br><span class="default">&lt;?php<br></span><span class="keyword">class </span><span class="default">MysqlStringEscaper<br></span><span class="keyword">{<br>&nbsp; &nbsp; function </span><span class="default">__get</span><span class="keyword">(</span><span class="default">$value</span><span class="keyword">)<br>&nbsp; &nbsp; {<br>&nbsp; &nbsp; &nbsp; &nbsp; return </span><span class="default">mysql_real_escape_string</span><span class="keyword">(</span><span class="default">$value</span><span class="keyword">);<br>&nbsp; &nbsp; }<br>}<br></span><span class="default">$str </span><span class="keyword">= new </span><span class="default">MysqlStringEscaper</span><span class="keyword">;<br></span><span class="default">?&gt;<br></span><br>then whenever I run a query I can simply do:<br><br><span class="default">&lt;?php<br>mysql_query</span><span class="keyword">(</span><span class="string">"SELECT * FROM users WHERE name LIKE '</span><span class="keyword">{</span><span class="default">$str</span><span class="keyword">-&gt;</span><span class="default">$name</span><span class="keyword">}</span><span class="string">' LIMIT 10"</span><span class="keyword">);<br></span><span class="default">?&gt;<br></span><br>This way it's easy to see what the variable is escaped as (other instances like $int or $list could be implemented), it's inline and it only changes the variable when it's inserted into the query.</span>
</code></div>
  </div>
 </div>
  <div class="note" id="111995">  
  <a class="name">
  <strong class="user"><em>dinho19sp at gmail dot com</em></strong></a><div class="date" title="2013-04-19 10:48"><strong>1 year ago</strong></div>
  <div class="text" id="Hcom111995">
<div class="phpcode"><code><span class="html">
I use de form very simply on $ _REQUEST [], and I have no problems<br><br>&nbsp; function objSqlRequest($StringVar){<br>&nbsp; &nbsp; &nbsp; &nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; if(isset($_REQUEST[$StringVar])){<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $StringVar =&nbsp; $_REQUEST[$StringVar];<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; }<br>&nbsp; &nbsp; &nbsp; &nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; return mysql_real_escape_string(trim($StringVar));<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <br>&nbsp; &nbsp; }</span>
</code></div>
  </div>
 </div>
  <div class="note" id="89851">  
  <a class="name">
  <strong class="user"><em>kendsnyder at gmail dot com</em></strong></a><div class="date" title="2009-03-25 01:07"><strong>5 years ago</strong></div>
  <div class="text" id="Hcom89851">
<div class="phpcode"><code><span class="html">
<span class="default">&lt;?php<br><br></span><span class="comment">// Here is a simple named binding function for queries that makes SQL more readable:<br>// $sql = "SELECT * FROM users WHERE user = :user AND password = :password";<br>// mysql_bind($sql, array('user' =&gt; $user, 'password' =&gt; $password));<br>// mysql_query($sql);<br><br></span><span class="keyword">function </span><span class="default">mysql_bind</span><span class="keyword">(&amp;</span><span class="default">$sql</span><span class="keyword">, </span><span class="default">$vals</span><span class="keyword">) {<br>&nbsp; &nbsp; foreach (</span><span class="default">$vals </span><span class="keyword">as </span><span class="default">$name </span><span class="keyword">=&gt; </span><span class="default">$val</span><span class="keyword">) {<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$sql </span><span class="keyword">= </span><span class="default">str_replace</span><span class="keyword">(</span><span class="string">":</span><span class="default">$name</span><span class="string">"</span><span class="keyword">, </span><span class="string">"'" </span><span class="keyword">. </span><span class="default">mysql_real_escape_string</span><span class="keyword">(</span><span class="default">$val</span><span class="keyword">) . </span><span class="string">"'"</span><span class="keyword">, </span><span class="default">$sql</span><span class="keyword">);<br>&nbsp; &nbsp; }<br>}<br><br></span><span class="default">?&gt;</span>
</span>
</code></div>
  </div>
 </div>
  <div class="note" id="100854">  
  <a class="name">
  <strong class="user"><em>Anonymous</em></strong></a><div class="date" title="2010-11-10 09:44"><strong>3 years ago</strong></div>
  <div class="text" id="Hcom100854">
<div class="phpcode"><code><span class="html">
calling this function twice, or on a string for which quotes have already been escaped, causes the quotes to be escaped twice.An example is where we have to check for magic_quotes_gpc&nbsp; before calling mysql_escape_string to sanitize the inputs.
<br>
<br>The following function can be used to escape singe and double quotes in a string with out the risk of escaping quotes twice.This function&nbsp; escapes a quote, only if it hasn't already been escaped.
<br>
<br><span class="default">&lt;?php
<br></span><span class="keyword">function </span><span class="default">safe_string_escape</span><span class="keyword">(</span><span class="default">$str</span><span class="keyword">)
<br>{
<br>&nbsp;&nbsp; </span><span class="default">$len</span><span class="keyword">=</span><span class="default">strlen</span><span class="keyword">(</span><span class="default">$str</span><span class="keyword">);
<br>&nbsp; &nbsp; </span><span class="default">$escapeCount</span><span class="keyword">=</span><span class="default">0</span><span class="keyword">;
<br>&nbsp; &nbsp; </span><span class="default">$targetString</span><span class="keyword">=</span><span class="string">''</span><span class="keyword">;
<br>&nbsp; &nbsp; for(</span><span class="default">$offset</span><span class="keyword">=</span><span class="default">0</span><span class="keyword">;</span><span class="default">$offset</span><span class="keyword">&lt;</span><span class="default">$len</span><span class="keyword">;</span><span class="default">$offset</span><span class="keyword">++) {
<br>&nbsp; &nbsp; &nbsp; &nbsp; switch(</span><span class="default">$c</span><span class="keyword">=</span><span class="default">$str</span><span class="keyword">{</span><span class="default">$offset</span><span class="keyword">}) {
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; case </span><span class="string">"'"</span><span class="keyword">:
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="comment">// Escapes this quote only if its not preceded by an unescaped backslash
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="keyword">if(</span><span class="default">$escapeCount </span><span class="keyword">% </span><span class="default">2 </span><span class="keyword">== </span><span class="default">0</span><span class="keyword">) </span><span class="default">$targetString</span><span class="keyword">.=</span><span class="string">"\\"</span><span class="keyword">;
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$escapeCount</span><span class="keyword">=</span><span class="default">0</span><span class="keyword">;
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$targetString</span><span class="keyword">.=</span><span class="default">$c</span><span class="keyword">;
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; break;
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; case </span><span class="string">'"'</span><span class="keyword">:
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="comment">// Escapes this quote only if its not preceded by an unescaped backslash
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="keyword">if(</span><span class="default">$escapeCount </span><span class="keyword">% </span><span class="default">2 </span><span class="keyword">== </span><span class="default">0</span><span class="keyword">) </span><span class="default">$targetString</span><span class="keyword">.=</span><span class="string">"\\"</span><span class="keyword">;
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$escapeCount</span><span class="keyword">=</span><span class="default">0</span><span class="keyword">;
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$targetString</span><span class="keyword">.=</span><span class="default">$c</span><span class="keyword">;
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; break;
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; case </span><span class="string">'\\'</span><span class="keyword">:
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$escapeCount</span><span class="keyword">++;
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$targetString</span><span class="keyword">.=</span><span class="default">$c</span><span class="keyword">;
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; break;
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; default:
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$escapeCount</span><span class="keyword">=</span><span class="default">0</span><span class="keyword">;
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$targetString</span><span class="keyword">.=</span><span class="default">$c</span><span class="keyword">;
<br>&nbsp; &nbsp; &nbsp; &nbsp; }
<br>&nbsp; &nbsp; }
<br>&nbsp; &nbsp; return </span><span class="default">$targetString</span><span class="keyword">;
<br>}
<br>echo </span><span class="default">safe_string_escape</span><span class="keyword">(</span><span class="string">"asda'sda\'dsad\"sadasd'"</span><span class="keyword">);
<br></span><span class="default">?&gt;
<br></span>
<br>above code echoes 
<br>
<br>asda\'sda\'dsad\"sadasd\'
<br>
<br>You can see that the second single quote wasnt escaped again..</span>
</code></div>
  </div>
 </div>
  <div class="note" id="105264">  
  <a class="name">
  <strong class="user"><em>upadrian at gmail dot com</em></strong></a><div class="date" title="2011-08-05 10:28"><strong>3 years ago</strong></div>
  <div class="text" id="Hcom105264">
<div class="phpcode"><code><span class="html">
<span class="default">&lt;?php<br></span><span class="comment">/**<br> * @author upadrian@gmail.com<br> * Simplified version for array escape using mysql_real_escape_string<br> * for db store. Key names are not escaped beacuse i don't plain to <br> * include in a sql. <br> * <br>*/<br><br></span><span class="keyword">function </span><span class="default">mres</span><span class="keyword">(</span><span class="default">$q</span><span class="keyword">) {<br>&nbsp; &nbsp; if(</span><span class="default">is_array</span><span class="keyword">(</span><span class="default">$q</span><span class="keyword">)) <br>&nbsp; &nbsp; &nbsp; &nbsp; foreach(</span><span class="default">$q </span><span class="keyword">as </span><span class="default">$k </span><span class="keyword">=&gt; </span><span class="default">$v</span><span class="keyword">) <br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$q</span><span class="keyword">[</span><span class="default">$k</span><span class="keyword">] = </span><span class="default">mres</span><span class="keyword">(</span><span class="default">$v</span><span class="keyword">); </span><span class="comment">//recursive<br>&nbsp; &nbsp; </span><span class="keyword">elseif(</span><span class="default">is_string</span><span class="keyword">(</span><span class="default">$q</span><span class="keyword">))<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$q </span><span class="keyword">= </span><span class="default">mysql_real_escape_string</span><span class="keyword">(</span><span class="default">$q</span><span class="keyword">);<br>&nbsp; &nbsp; return </span><span class="default">$q</span><span class="keyword">;<br>}<br><br></span><span class="default">?&gt;</span>
</span>
</code></div>
  </div>
 </div>
  <div class="note" id="112479">  
  <a class="name">
  <strong class="user"><em>mahdi</em></strong></a><div class="date" title="2013-06-20 04:15"><strong>1 year ago</strong></div>
  <div class="text" id="Hcom112479">
<div class="phpcode"><code><span class="html">
function clean($str) {<br> $cleaned = strip_tags($str);<br> $cleaned = htmlspecialchars(mysql_real_escape_string($cleaned));<br> <br> return $cleaned;}</span>
</code></div>
  </div>
 </div>
  <div class="note" id="96405">  
  <a class="name">
  <strong class="user"><em>gustavo639 at gmail dot com</em></strong></a><div class="date" title="2010-02-25 07:17"><strong>4 years ago</strong></div>
  <div class="text" id="Hcom96405">
<div class="phpcode"><code><span class="html">
I use:
<br>
<br><span class="default">&lt;?php
<br></span><span class="keyword">public static function </span><span class="default">escaparParametros</span><span class="keyword">(){
<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$numParametros </span><span class="keyword">= </span><span class="default">func_num_args</span><span class="keyword">();
<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$parametros </span><span class="keyword">= </span><span class="default">func_get_args</span><span class="keyword">();
<br>
<br>&nbsp; &nbsp; &nbsp; &nbsp; for (</span><span class="default">$i </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">; </span><span class="default">$i </span><span class="keyword">&lt; </span><span class="default">$numParametros</span><span class="keyword">; </span><span class="default">$i</span><span class="keyword">++){
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$parametros</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">] = </span><span class="default">mysql_real_escape_string</span><span class="keyword">(</span><span class="default">$parametros</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">]);
<br>&nbsp; &nbsp; &nbsp; &nbsp; }
<br>
<br>&nbsp; &nbsp; &nbsp; &nbsp; return </span><span class="default">$parametros</span><span class="keyword">;
<br>&nbsp; &nbsp; }
<br></span><span class="default">?&gt;</span>
</span>
</code></div>
  </div>
 </div>
  <div class="note" id="96391">  
  <a class="name">
  <strong class="user"><em>root at aeze dot ru</em></strong></a><div class="date" title="2010-02-24 09:42"><strong>4 years ago</strong></div>
  <div class="text" id="Hcom96391">
<div class="phpcode"><code><span class="html">
Here my simple but very effective function for safe mysql queries.
<br>
<br><span class="default">&lt;?php
<br></span><span class="comment">/**
<br>* USAGE: mysql_safe( string $query [, array $params ] )
<br>* $query - SQL query WITHOUT any user-entered parameters. Replace parameters with "?"
<br>*&nbsp; &nbsp;&nbsp; e.g. $query = "SELECT date from history WHERE login = ?"
<br>* $params - array of parameters
<br>*
<br>* Example:
<br>*&nbsp; &nbsp; mysql_safe( "SELECT secret FROM db WHERE login = ?", array($login) );&nbsp; &nbsp; # one parameter
<br>*&nbsp; &nbsp; mysql_safe( "SELECT secret FROM db WHERE login = ? AND password = ?", array($login, $password) );&nbsp; &nbsp; # multiple parameters
<br>* That will result safe query to MySQL with escaped $login and $password.
<br>**/
<br></span><span class="keyword">function </span><span class="default">mysql_safe</span><span class="keyword">(</span><span class="default">$query</span><span class="keyword">,</span><span class="default">$params</span><span class="keyword">=</span><span class="default">false</span><span class="keyword">) {
<br>&nbsp; &nbsp; if (</span><span class="default">$params</span><span class="keyword">) {
<br>&nbsp; &nbsp; &nbsp; &nbsp; foreach (</span><span class="default">$params </span><span class="keyword">as &amp;</span><span class="default">$v</span><span class="keyword">) { </span><span class="default">$v </span><span class="keyword">= </span><span class="default">mysql_real_escape_string</span><span class="keyword">(</span><span class="default">$v</span><span class="keyword">); }&nbsp; &nbsp; </span><span class="comment"># Escaping parameters
<br>&nbsp; &nbsp; &nbsp; &nbsp; # str_replace - replacing ? -&gt; %s. %s is ugly in raw sql query
<br>&nbsp; &nbsp; &nbsp; &nbsp; # vsprintf - replacing all %s to parameters
<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$sql_query </span><span class="keyword">= </span><span class="default">vsprintf</span><span class="keyword">( </span><span class="default">str_replace</span><span class="keyword">(</span><span class="string">"?"</span><span class="keyword">,</span><span class="string">"'%s'"</span><span class="keyword">,</span><span class="default">$query</span><span class="keyword">), </span><span class="default">$params </span><span class="keyword">);&nbsp; &nbsp; 
<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$sql_query </span><span class="keyword">= </span><span class="default">mysql_query</span><span class="keyword">(</span><span class="default">$sql_query</span><span class="keyword">);&nbsp; &nbsp; </span><span class="comment"># Perfoming escaped query
<br>&nbsp; &nbsp; </span><span class="keyword">} else {
<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$sql_query </span><span class="keyword">= </span><span class="default">mysql_query</span><span class="keyword">(</span><span class="default">$query</span><span class="keyword">);&nbsp; &nbsp; </span><span class="comment"># If no params...
<br>&nbsp; &nbsp; </span><span class="keyword">}
<br>
<br>&nbsp; &nbsp; return (</span><span class="default">$sql_query</span><span class="keyword">);
<br>}
<br></span><span class="default">?&gt;</span>
</span>
</code></div>
  </div>
 </div>
  <div class="note" id="99945">  
  <a class="name">
  <strong class="user"><em>anonymous at host dot com</em></strong></a><div class="date" title="2010-09-16 02:28"><strong>3 years ago</strong></div>
  <div class="text" id="Hcom99945">
<div class="phpcode"><code><span class="html">
You can also use the escape function in a manner as shown in the snapshot out of my own browsertools class:
<br>
<br><span class="default">&lt;?php
<br></span><span class="comment">//
<br>// MySQL Database connection
<br>//
<br></span><span class="keyword">public function </span><span class="default">mysqlConnect</span><span class="keyword">(</span><span class="default">$host</span><span class="keyword">, </span><span class="default">$user</span><span class="keyword">, </span><span class="default">$password</span><span class="keyword">, </span><span class="default">$database</span><span class="keyword">) {
<br>&nbsp; &nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">mysql </span><span class="keyword">= </span><span class="default">mysql_connect</span><span class="keyword">(</span><span class="default">$host</span><span class="keyword">, </span><span class="default">$user</span><span class="keyword">, </span><span class="default">$password</span><span class="keyword">);
<br>&nbsp; &nbsp; if (!</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">mysql</span><span class="keyword">) die(</span><span class="default">mysql_error</span><span class="keyword">());
<br>&nbsp; &nbsp; </span><span class="default">mysql_select_db</span><span class="keyword">(</span><span class="default">$database</span><span class="keyword">, </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">mysql</span><span class="keyword">);
<br>}
<br>
<br></span><span class="comment">//
<br>// MySQL Query
<br>// usage:
<br>//&nbsp; &nbsp; $query such as "SELECT * FROM users WHERE nick = '%s' AND pass = '%s'"
<br>//&nbsp; &nbsp; &nbsp; where %s are the placeholders for the parameters
<br>// call:
<br>//&nbsp; &nbsp; $__-&gt;mysqlQuery( $query, arg0, arg1, arg2, ... )
<br>// description:
<br>//&nbsp; &nbsp; The parameters given to the function are escaped through mysql_real_escape_string(),
<br>//&nbsp; &nbsp; merged with the query and then given to the mysql_query function.
<br>// returns:
<br>//&nbsp; &nbsp; Array of lines returned by the MySQL Database
<br>//
<br></span><span class="keyword">public function </span><span class="default">mysqlQuery</span><span class="keyword">(</span><span class="default">$query</span><span class="keyword">) {
<br>&nbsp; &nbsp; </span><span class="default">$numParams </span><span class="keyword">= </span><span class="default">func_num_args</span><span class="keyword">();
<br>&nbsp; &nbsp; </span><span class="default">$params </span><span class="keyword">= </span><span class="default">func_get_args</span><span class="keyword">();
<br>&nbsp; &nbsp; 
<br>&nbsp; &nbsp; if (</span><span class="default">$numParams </span><span class="keyword">&gt; </span><span class="default">1</span><span class="keyword">) {
<br>&nbsp; &nbsp; &nbsp; &nbsp; for (</span><span class="default">$i </span><span class="keyword">= </span><span class="default">1</span><span class="keyword">; </span><span class="default">$i </span><span class="keyword">&lt; </span><span class="default">$numParams</span><span class="keyword">; </span><span class="default">$i</span><span class="keyword">++){
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$params</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">] = </span><span class="default">mysql_real_escape_string</span><span class="keyword">(</span><span class="default">$params</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">]);
<br>&nbsp; &nbsp; &nbsp; &nbsp; }
<br>&nbsp; &nbsp; &nbsp; &nbsp; 
<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$query </span><span class="keyword">= </span><span class="default">call_user_func_array</span><span class="keyword">(</span><span class="string">'sprintf'</span><span class="keyword">, </span><span class="default">$params</span><span class="keyword">);
<br>&nbsp; &nbsp; }
<br>&nbsp; &nbsp; 
<br>&nbsp; &nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">result </span><span class="keyword">= </span><span class="default">mysql_query</span><span class="keyword">(</span><span class="default">$query</span><span class="keyword">, </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">mysql</span><span class="keyword">);
<br>&nbsp; &nbsp; if (!</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">result</span><span class="keyword">) die(</span><span class="default">mysql_error</span><span class="keyword">());
<br>&nbsp; &nbsp; </span><span class="default">$ret </span><span class="keyword">= array();
<br>&nbsp; &nbsp; while (</span><span class="default">$row </span><span class="keyword">= </span><span class="default">mysql_fetch_assoc</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">result</span><span class="keyword">)) {
<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$ret</span><span class="keyword">[] = </span><span class="default">$row</span><span class="keyword">;
<br>&nbsp; &nbsp; }
<br>&nbsp; &nbsp; </span><span class="default">mysql_free_result</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">result</span><span class="keyword">);
<br>&nbsp; &nbsp; return </span><span class="default">$ret</span><span class="keyword">;
<br>}
<br></span><span class="default">?&gt;</span>
</span>
</code></div>
  </div>
 </div>
  <div class="note" id="99878">  
  <a class="name">
  <strong class="user"><em>paralescuoctavian at gmail dot com</em></strong></a><div class="date" title="2010-09-12 05:28"><strong>3 years ago</strong></div>
  <div class="text" id="Hcom99878">
<div class="phpcode"><code><span class="html">
Also don't forget to escape $_COOKIE array before quering the database. In firefox you can edit cookies and insert and inject harmful sql queries.
<br>
<br><span class="default">&lt;?php
<br>&nbsp; </span><span class="keyword">foreach (</span><span class="default">$_COOKIE </span><span class="keyword">as </span><span class="default">$key </span><span class="keyword">=&gt; </span><span class="default">$value</span><span class="keyword">) {
<br>&nbsp; &nbsp; if(</span><span class="default">get_magic_quotes_gpc</span><span class="keyword">()) </span><span class="default">$_COOKIE</span><span class="keyword">[</span><span class="default">$key</span><span class="keyword">]=</span><span class="default">stripslashes</span><span class="keyword">(</span><span class="default">$value</span><span class="keyword">);
<br>&nbsp; &nbsp; </span><span class="default">$_COOKIE</span><span class="keyword">[</span><span class="default">$key</span><span class="keyword">] = </span><span class="default">mysql_real_escape_string</span><span class="keyword">(</span><span class="default">$value</span><span class="keyword">);
<br>&nbsp; }
<br></span><span class="default">?&gt;</span>
</span>
</code></div>
  </div>
 </div>
  <div class="note" id="98506">  
  <a class="name">
  <strong class="user"><em>adelbenzarti at yahoo dot fr</em></strong></a><div class="date" title="2010-06-19 03:05"><strong>4 years ago</strong></div>
  <div class="text" id="Hcom98506">
<div class="phpcode"><code><span class="html">
The function mysql_real_escape_string helps the developer to insert data without having troubles in the process or having risks of SQL Injection.<br>You can develop a similar function :<br><span class="default">&lt;?php<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="keyword">function </span><span class="default">escape</span><span class="keyword">(</span><span class="default">$str</span><span class="keyword">)<br>&nbsp; &nbsp; &nbsp; &nbsp; {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$search</span><span class="keyword">=array(</span><span class="string">"\\"</span><span class="keyword">,</span><span class="string">"\0"</span><span class="keyword">,</span><span class="string">"\n"</span><span class="keyword">,</span><span class="string">"\r"</span><span class="keyword">,</span><span class="string">"\x1a"</span><span class="keyword">,</span><span class="string">"'"</span><span class="keyword">,</span><span class="string">'"'</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$replace</span><span class="keyword">=array(</span><span class="string">"\\\\"</span><span class="keyword">,</span><span class="string">"\\0"</span><span class="keyword">,</span><span class="string">"\\n"</span><span class="keyword">,</span><span class="string">"\\r"</span><span class="keyword">,</span><span class="string">"\Z"</span><span class="keyword">,</span><span class="string">"\'"</span><span class="keyword">,</span><span class="string">'\"'</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; return </span><span class="default">str_replace</span><span class="keyword">(</span><span class="default">$search</span><span class="keyword">,</span><span class="default">$replace</span><span class="keyword">,</span><span class="default">$str</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; }<br></span><span class="default">?&gt;</span>
</span>
</code></div>
  </div>
 </div>
  <div class="note" id="95915">  
  <a class="name">
  <strong class="user"><em>presto dot dk at gmail dot com</em></strong></a><div class="date" title="2010-01-28 07:05"><strong>4 years ago</strong></div>
  <div class="text" id="Hcom95915">
<div class="phpcode"><code><span class="html">
If you want to make sure that the ID you're using to do a query is a number, use sprint() of (int) or intval(), but don't use mysql_real_escape_string.<br><br>There is no difference between ISO-8859-1's number 10 and UTF-8's number 10.</span>
</code></div>
  </div>
 </div>
  <div class="note" id="92649">  
  <a class="name">
  <strong class="user"><em>Anonymous</em></strong></a><div class="date" title="2009-08-02 03:45"><strong>5 years ago</strong></div>
  <div class="text" id="Hcom92649">
<div class="phpcode"><code><span class="html">
I use the following code in my database connection include file (which is of course called at the start of every page that needs to do some SQL)...
<br>Therefore, all POST and GET vars are automatically escaped before being used anywhere in SQL statements.
<br>
<br><span class="default">&lt;?php
<br>&nbsp; </span><span class="comment">//This stops SQL Injection in POST vars
<br>&nbsp; </span><span class="keyword">foreach (</span><span class="default">$_POST </span><span class="keyword">as </span><span class="default">$key </span><span class="keyword">=&gt; </span><span class="default">$value</span><span class="keyword">) {
<br>&nbsp; &nbsp; </span><span class="default">$_POST</span><span class="keyword">[</span><span class="default">$key</span><span class="keyword">] = </span><span class="default">mysql_real_escape_string</span><span class="keyword">(</span><span class="default">$value</span><span class="keyword">);
<br>&nbsp; }
<br>
<br>&nbsp; </span><span class="comment">//This stops SQL Injection in GET vars
<br>&nbsp; </span><span class="keyword">foreach (</span><span class="default">$_GET </span><span class="keyword">as </span><span class="default">$key </span><span class="keyword">=&gt; </span><span class="default">$value</span><span class="keyword">) {
<br>&nbsp; &nbsp; </span><span class="default">$_GET</span><span class="keyword">[</span><span class="default">$key</span><span class="keyword">] = </span><span class="default">mysql_real_escape_string</span><span class="keyword">(</span><span class="default">$value</span><span class="keyword">);
<br>&nbsp; }
<br></span><span class="default">?&gt;</span>
</span>
</code></div>
  </div>
 </div>
  <div class="note" id="92493">  
  <a class="name">
  <strong class="user"><em>plgs at ozemail dot com dot au</em></strong></a><div class="date" title="2009-07-27 01:05"><strong>5 years ago</strong></div>
  <div class="text" id="Hcom92493">
<div class="phpcode"><code><span class="html">
Don't forget that if you're using Mysqli (ie, the "improved" Mysql extension) then you need to use the corresponding mysqli function mysqli_real_escape_string().&nbsp; The parameter order is also different.</span>
</code></div>
  </div>
 </div>
  <div class="note" id="92184">  
  <a class="name">
  <strong class="user"><em>Anonymous</em></strong></a><div class="date" title="2009-07-13 08:30"><strong>5 years ago</strong></div>
  <div class="text" id="Hcom92184">
<div class="phpcode"><code><span class="html">
It is because you swapped $key and $item:<br><br>Just change this:<br><span class="default">&lt;?php<br>&nbsp; </span><span class="keyword">function </span><span class="default">mysql_safe </span><span class="keyword">( </span><span class="default">$item</span><span class="keyword">, </span><span class="default">$key</span><span class="keyword">, </span><span class="default">$type </span><span class="keyword">)<br>&nbsp; </span><span class="default">?&gt;<br></span><br>To: <br><br><span class="default">&lt;?php <br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="keyword">function </span><span class="default">mysql_safe </span><span class="keyword">( </span><span class="default">$key</span><span class="keyword">, </span><span class="default">$item</span><span class="keyword">, </span><span class="default">$type </span><span class="keyword">)<br></span><span class="default">?&gt;<br></span><br>And it will work as expected.</span>
</code></div>
  </div>
 </div>
  <div class="note" id="92159">  
  <a class="name">
  <strong class="user"><em>isaacs dot brian dot c at gmail dot com</em></strong></a><div class="date" title="2009-07-11 11:06"><strong>5 years ago</strong></div>
  <div class="text" id="Hcom92159">
<div class="phpcode"><code><span class="html">
I had wanted to see the merits of dynamically and "automatically" applying mysql_real_escape_string() to $_GET and $_POST as arrays rather than manually each time I would type up a query. I used array_walk_recursive() to call my function "mysql_safe" to apply mysql_real_escape_string() to each key of the $_GET and $_POST arrays.
<br>
<br>My function is part of a class, and it is called each time I connect to the database to perform a query:
<br>
<br><span class="default">&lt;?php
<br></span><span class="keyword">class </span><span class="default">MyClass </span><span class="keyword">{
<br>&nbsp; &nbsp; &nbsp; &nbsp; function </span><span class="default">mysql_safe </span><span class="keyword">( </span><span class="default">$key</span><span class="keyword">, </span><span class="default">$item</span><span class="keyword">, </span><span class="default">$type </span><span class="keyword">)
<br>&nbsp; &nbsp; &nbsp; &nbsp; {
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; switch( </span><span class="default">$type </span><span class="keyword">)
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; case </span><span class="string">'get'</span><span class="keyword">: 
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if( </span><span class="default">count</span><span class="keyword">( </span><span class="default">$_GET </span><span class="keyword">) &gt; </span><span class="default">0 </span><span class="keyword">)
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$_GET</span><span class="keyword">[</span><span class="default">$item</span><span class="keyword">] = </span><span class="default">mysql_real_escape_string</span><span class="keyword">( </span><span class="default">$key </span><span class="keyword">); 
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; break;
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; case </span><span class="string">'post'</span><span class="keyword">: 
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if( </span><span class="default">count</span><span class="keyword">( </span><span class="default">$_POST </span><span class="keyword">) &gt; </span><span class="default">0 </span><span class="keyword">)
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$_POST</span><span class="keyword">[</span><span class="default">$item</span><span class="keyword">] = </span><span class="default">mysql_real_escape_string</span><span class="keyword">( </span><span class="default">$key </span><span class="keyword">);
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; break;
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }
<br>&nbsp; &nbsp; &nbsp; &nbsp; }
<br>&nbsp; &nbsp; &nbsp; &nbsp; 
<br>&nbsp; &nbsp; &nbsp; &nbsp; function </span><span class="default">safe_get </span><span class="keyword">( )
<br>&nbsp; &nbsp; &nbsp; &nbsp; {
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="comment">#Flag to only run function once&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="keyword">if( </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">get_flag </span><span class="keyword">== </span><span class="default">true </span><span class="keyword">) { return </span><span class="default">true</span><span class="keyword">; }
<br>
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">array_walk_recursive</span><span class="keyword">( </span><span class="default">$_GET</span><span class="keyword">, array( </span><span class="default">$this</span><span class="keyword">, </span><span class="string">'mysql_safe' </span><span class="keyword">), </span><span class="string">'get' </span><span class="keyword">);
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">array_walk_recursive</span><span class="keyword">( </span><span class="default">$_POST</span><span class="keyword">, array( </span><span class="default">$this</span><span class="keyword">, </span><span class="string">'mysql_safe' </span><span class="keyword">), </span><span class="string">'post' </span><span class="keyword">);
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">get_flag </span><span class="keyword">= </span><span class="default">true</span><span class="keyword">;
<br>&nbsp; &nbsp; &nbsp; &nbsp; }
<br>}
<br></span><span class="default">?&gt;
<br></span>
<br>However, after using this function, I find that it does indeed work, it also creates new $_GET and $_POST values in which $item and $key are swapped. So I end up with $_GET[$item] = $key, as well as $_GET[$key] = $item. I have not yet determined if this is due to the actual coding itself, or my particular method of implementation.
<br>
<br>[EDIT BY danbrown AT php DOT net: Contains a bugfix by "Anonymous" on 13-JUL-09 to reorder the user function parameters.]</span>
</code></div>
  </div>
 </div>
  <div class="note" id="69452">  
  <a class="name">
  <strong class="user"><em>brian dot folts at gmail dot com</em></strong></a><div class="date" title="2006-09-06 09:25"><strong>7 years ago</strong></div>
  <div class="text" id="Hcom69452">
<div class="phpcode"><code><span class="html">
mysql_real_escape_string is a bit annoying when you need to do it over an array.
<br>
<br><span class="default">&lt;?php
<br></span><span class="keyword">function </span><span class="default">mysql_real_escape_array</span><span class="keyword">(</span><span class="default">$t</span><span class="keyword">){
<br>&nbsp; &nbsp; return </span><span class="default">array_map</span><span class="keyword">(</span><span class="string">"mysql_real_escape_string"</span><span class="keyword">,</span><span class="default">$t</span><span class="keyword">);
<br>}
<br></span><span class="default">?&gt;
<br></span>
<br>this one just mysql_real_escape's the whole array.
<br>
<br>ex) <span class="default">&lt;?php $_POST</span><span class="keyword">=</span><span class="default">mysql_real_escape_array</span><span class="keyword">(</span><span class="default">$_POST</span><span class="keyword">); </span><span class="default">?&gt;
<br></span>
<br>and then you dont have to worry about forgetting to do this.</span>
</code></div>
  </div>
 </div>
  <div class="note" id="77388">  
  <a class="name">
  <strong class="user"><em>user at NOSPAM dot example dot com</em></strong></a><div class="date" title="2007-08-27 05:16"><strong>7 years ago</strong></div>
  <div class="text" id="Hcom77388">
<div class="phpcode"><code><span class="html">
if you're doing a mysql wildcard query with
<br>LIKE, GRANT, or REVOKE
<br>you may use addcslashes to escape the string:
<br>
<br><span class="default">&lt;?php
<br>$param </span><span class="keyword">= </span><span class="default">mysql_real_escape_string</span><span class="keyword">(</span><span class="default">$param</span><span class="keyword">);
<br></span><span class="default">$param </span><span class="keyword">= </span><span class="default">addcslashes</span><span class="keyword">(</span><span class="default">$param</span><span class="keyword">, </span><span class="string">'%_'</span><span class="keyword">);
<br></span><span class="default">?&gt;</span>
</span>
</code></div>
  </div>
 </div>
  <div class="note" id="68221">  
  <a class="name">
  <strong class="user"><em>kael dot shipman at DONTSPAMIT! dot gmail dot com</em></strong></a><div class="date" title="2006-07-18 01:19"><strong>8 years ago</strong></div>
  <div class="text" id="Hcom68221">
<div class="phpcode"><code><span class="html">
It seems to me that you could avoid many hassels by loading valid database values into an array at the beginning of the script, then instead of using user input to query the database directly, use it to query the array you've created. For example:<br><br><span class="default">&lt;?php<br></span><span class="comment">//you still have to query safely, so always use cleanup functions like eric256's<br></span><span class="default">$categories </span><span class="keyword">= </span><span class="default">sql_query</span><span class="keyword">(</span><span class="string">"select catName from categories where pageID = ?"</span><span class="keyword">,</span><span class="default">$_GET</span><span class="keyword">[</span><span class="string">'pageID'</span><span class="keyword">]);<br>while (</span><span class="default">$cts </span><span class="keyword">= @</span><span class="default">mysql_fetch_row</span><span class="keyword">(</span><span class="default">$categories</span><span class="keyword">)) {<br> </span><span class="comment">//making $cts both the name and the value of the array variable makes it easier to check for in the future.<br> //obviously, this naming system wouldn't work for a multidimensional array<br> </span><span class="default">$cat_ar</span><span class="keyword">[</span><span class="default">$cts</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">]] = </span><span class="default">$cts</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">];<br>}<br>...<br><br></span><span class="comment">//user selects sorting criteria<br>//this would be from a query string like '?cats[]=cha&amp;cats[]=fah&amp;cats[]=lah&amp;cats[]=badValue...', etc.<br></span><span class="default">$cats </span><span class="keyword">= </span><span class="default">$_GET</span><span class="keyword">[</span><span class="string">'cats'</span><span class="keyword">];<br><br></span><span class="comment">//verify that values exist in database before building sorting query<br></span><span class="keyword">foreach(</span><span class="default">$cats </span><span class="keyword">as </span><span class="default">$c</span><span class="keyword">) {<br> if (</span><span class="default">$cat_ar</span><span class="keyword">[</span><span class="default">$c</span><span class="keyword">]) { </span><span class="comment">//instead of in_array(); maybe I'm just lazy... (see above note)<br>&nbsp; </span><span class="default">$cats1</span><span class="keyword">[] = </span><span class="string">"'"</span><span class="keyword">.</span><span class="default">mysql_real_escape_string</span><span class="keyword">(</span><span class="default">$c</span><span class="keyword">).</span><span class="string">"'"</span><span class="keyword">;<br> }<br>}<br></span><span class="default">$cats </span><span class="keyword">= </span><span class="default">$cats1</span><span class="keyword">;<br></span><span class="comment">//$cats now contains the filtered and escaped values of the query string<br><br></span><span class="default">$cat_query </span><span class="keyword">= </span><span class="string">'&amp;&amp; (category_name = \''</span><span class="keyword">.</span><span class="default">implode</span><span class="keyword">(</span><span class="string">' || category_name = \''</span><span class="keyword">,</span><span class="default">$cats</span><span class="keyword">).</span><span class="string">'\')'</span><span class="keyword">;<br></span><span class="comment">//build a sql query insert<br>//$cat_query is now "&amp;&amp; (category_name = 'cha' || category_name = 'fah' || category_name = 'lah')" - badValue has been removed<br>//since all values have already been verified and escaped, you can simply use them in a query<br>//however, since $pageID hasn't been cleaned for this query, you still have to use your cleaning function<br></span><span class="default">$items </span><span class="keyword">= </span><span class="default">sql_query</span><span class="keyword">(</span><span class="string">"SELECT * FROM items i, categories c WHERE i.catID = c.catID &amp;&amp; pageID = ? </span><span class="default">$cat_query</span><span class="string">"</span><span class="keyword">, </span><span class="default">$pageID</span><span class="keyword">);</span>
</span>
</code></div>
  </div>
 </div>
  <div class="note" id="107529">  
  <a class="name">
  <strong class="user"><em>Ortreum</em></strong></a><div class="date" title="2012-02-15 05:35"><strong>2 years ago</strong></div>
  <div class="text" id="Hcom107529">
<div class="phpcode"><code><span class="html">
This small function walks through a complete array without a "normal" loop and convert all potentially "bad" inputs like $_POST and $_GET to mysql conform strings.
<br>
<br><span class="default">&lt;?php
<br></span><span class="keyword">function </span><span class="default">db_conform</span><span class="keyword">(</span><span class="default">$s</span><span class="keyword">)
<br>{
<br>&nbsp; &nbsp; if (!</span><span class="default">is_array</span><span class="keyword">(</span><span class="default">$s</span><span class="keyword">)) </span><span class="default">mysql_real_escape_string</span><span class="keyword">(</span><span class="default">$s</span><span class="keyword">);
<br>&nbsp; &nbsp; function </span><span class="default">db_conform_array_callback</span><span class="keyword">(&amp;</span><span class="default">$item</span><span class="keyword">, </span><span class="default">$key</span><span class="keyword">) { echo </span><span class="default">$key</span><span class="keyword">; </span><span class="default">$item </span><span class="keyword">= </span><span class="default">db_conform</span><span class="keyword">(</span><span class="default">$item</span><span class="keyword">); }
<br>&nbsp; &nbsp; </span><span class="default">array_walk</span><span class="keyword">(</span><span class="default">$s</span><span class="keyword">, </span><span class="string">'db_conform_array_callback'</span><span class="keyword">);
<br>&nbsp; &nbsp; return </span><span class="default">$s</span><span class="keyword">;
<br>}
<br>
<br></span><span class="default">$_POST </span><span class="keyword">= </span><span class="default">db_conform</span><span class="keyword">(</span><span class="default">$_POST</span><span class="keyword">);
<br></span><span class="default">?&gt;</span>
</span>
</code></div>
  </div>
 </div>
  <div class="note" id="106035">  
  <a class="name">
  <strong class="user"><em>Anonymous</em></strong></a><div class="date" title="2011-10-04 03:34"><strong>2 years ago</strong></div>
  <div class="text" id="Hcom106035">
<div class="phpcode"><code><span class="html">
If you try to escape a string which contains signs such as â€™ or " and it doesnt work, check your website/file charset! Maybe it is NOT utf-8 ;)</span>
</code></div>
  </div>
 </div>
  <div class="note" id="100458">  
  <a class="name">
  <strong class="user"><em>m-t at live dot fr</em></strong></a><div class="date" title="2010-10-17 09:30"><strong>3 years ago</strong></div>
  <div class="text" id="Hcom100458">
<div class="phpcode"><code><span class="html">
You should use mysql_real_escape_string only before inserting the data into your table, otherwise you could just use this function :<br><br>function reverse_escape($str)<br>{<br>&nbsp; $search=array("\\\\","\\0","\\n","\\r","\Z","\'",'\"');<br>&nbsp; $replace=array("\\","\0","\n","\r","\x1a","'",'"');<br>&nbsp; return str_replace($search,$replace,$str);<br>}</span>
</code></div>
  </div>
 </div>
  <div class="note" id="82015">  
  <a class="name">
  <strong class="user"><em>Bastiaan Welmers</em></strong></a><div class="date" title="2008-03-24 11:46"><strong>6 years ago</strong></div>
  <div class="text" id="Hcom82015">
<div class="phpcode"><code><span class="html">
This function won't help you when inserting binary data, to me it will get mallformed into the database. Probably UTF-8 combinations will be translated by this function or somewhere else when inserting data when running mysql in UTF-8 mode.<br><br>A better way to insert binary data is to transfer it to hexadecimal notation like this example:<br><br><span class="default">&lt;?php<br>$string </span><span class="keyword">= </span><span class="default">$_REQUEST</span><span class="keyword">[</span><span class="string">'string'</span><span class="keyword">];<br></span><span class="default">$binary </span><span class="keyword">= </span><span class="default">file_get_contents</span><span class="keyword">(</span><span class="default">$_FILE</span><span class="keyword">[</span><span class="string">'file'</span><span class="keyword">][</span><span class="string">'tmp_name'</span><span class="keyword">]);<br><br></span><span class="default">$string </span><span class="keyword">= </span><span class="default">mysql_real_escape_string</span><span class="keyword">(</span><span class="default">$string</span><span class="keyword">);<br></span><span class="default">$binary_hex </span><span class="keyword">= </span><span class="default">bin2hex</span><span class="keyword">(</span><span class="default">$binary</span><span class="keyword">);<br><br></span><span class="default">$query </span><span class="keyword">= </span><span class="string">"INSERT INTO `table` (`key`, `string`, `binary`, `other`) VALUES (NULL, '</span><span class="default">$string</span><span class="string">', 0x</span><span class="default">$binary_hex</span><span class="string">, '</span><span class="default">$other</span><span class="string">')"</span><span class="keyword">;<br><br></span><span class="default">?&gt;</span>
</span>
</code></div>
  </div>
 </div>
  <div class="note" id="80053">  
  <a class="name">
  <strong class="user"><em>matthijs at yourmediafactory dot com</em></strong></a><div class="date" title="2007-12-27 01:49"><strong>6 years ago</strong></div>
  <div class="text" id="Hcom80053">
<div class="phpcode"><code><span class="html">
In response to Michael D - DigitalGemstones.com: <br><br>Check the example again: sprintf(%d) already does the int conversion for you, so it's both perfectly save as well as more elegant than manually casting.</span>
</code></div>
  </div>
 </div>
  <div class="note" id="81530">  
  <a class="name">
  <strong class="user"><em>Anonymous</em></strong></a><div class="date" title="2008-03-02 10:57"><strong>6 years ago</strong></div>
  <div class="text" id="Hcom81530">
<div class="phpcode"><code><span class="html">
My escape function:
<br>
<br>Automatically adds quotes (unless $quotes is false), but only for strings. Null values are converted to mysql keyword "null", booleans are converted to 1 or 0, and numbers are left alone. Also can escape a single variable or recursively escape an array of unlimited depth.
<br>
<br><span class="default">&lt;?php
<br></span><span class="keyword">function </span><span class="default">db_escape</span><span class="keyword">(</span><span class="default">$values</span><span class="keyword">, </span><span class="default">$quotes </span><span class="keyword">= </span><span class="default">true</span><span class="keyword">) {
<br>&nbsp; &nbsp; if (</span><span class="default">is_array</span><span class="keyword">(</span><span class="default">$values</span><span class="keyword">)) {
<br>&nbsp; &nbsp; &nbsp; &nbsp; foreach (</span><span class="default">$values </span><span class="keyword">as </span><span class="default">$key </span><span class="keyword">=&gt; </span><span class="default">$value</span><span class="keyword">) {
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$values</span><span class="keyword">[</span><span class="default">$key</span><span class="keyword">] = </span><span class="default">db_escape</span><span class="keyword">(</span><span class="default">$value</span><span class="keyword">, </span><span class="default">$quotes</span><span class="keyword">);
<br>&nbsp; &nbsp; &nbsp; &nbsp; }
<br>&nbsp; &nbsp; }
<br>&nbsp; &nbsp; else if (</span><span class="default">$values </span><span class="keyword">=== </span><span class="default">null</span><span class="keyword">) {
<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$values </span><span class="keyword">= </span><span class="string">'NULL'</span><span class="keyword">;
<br>&nbsp; &nbsp; }
<br>&nbsp; &nbsp; else if (</span><span class="default">is_bool</span><span class="keyword">(</span><span class="default">$values</span><span class="keyword">)) {
<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$values </span><span class="keyword">= </span><span class="default">$values </span><span class="keyword">? </span><span class="default">1 </span><span class="keyword">: </span><span class="default">0</span><span class="keyword">;
<br>&nbsp; &nbsp; }
<br>&nbsp; &nbsp; else if (!</span><span class="default">is_numeric</span><span class="keyword">(</span><span class="default">$values</span><span class="keyword">)) {
<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$values </span><span class="keyword">= </span><span class="default">mysql_real_escape_string</span><span class="keyword">(</span><span class="default">$values</span><span class="keyword">);
<br>&nbsp; &nbsp; &nbsp; &nbsp; if (</span><span class="default">$quotes</span><span class="keyword">) {
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$values </span><span class="keyword">= </span><span class="string">'"' </span><span class="keyword">. </span><span class="default">$values </span><span class="keyword">. </span><span class="string">'"'</span><span class="keyword">;
<br>&nbsp; &nbsp; &nbsp; &nbsp; }
<br>&nbsp; &nbsp; }
<br>&nbsp; &nbsp; return </span><span class="default">$values</span><span class="keyword">;
<br>}
<br></span><span class="default">?&gt;</span>
</span>
</code></div>
  </div>
 </div></div>

 
</section>    </section><!-- layout-content -->
        


  </div><!-- layout -->
         
  

    
 <!-- External and third party libraries. -->
 







<a id="toTop" href="javascript:;"><span id="toTopHover"></span><img width="40" height="40" alt="To Top" src="../../images/to-top%402x.png"></a>



<!-- Mirrored from php.net/manual/en/function.mysql-real-escape-string.php by HTTrack Website Copier/3.x [XR&CO'2013], Thu, 28 Aug 2014 15:54:49 GMT -->


</body></html>