<html><!-- Mirrored from php.net/manual/en/function.posix-setuid.php by HTTrack Website Copier/3.x [XR&CO'2013], Thu, 28 Aug 2014 16:35:58 GMT --><!-- Added by HTTrack --><head><meta http-equiv="content-type" content="text/html;charset=utf-8"><!-- /Added by HTTrack -->


  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0"> 

  <title>posix_setuid</title>

 <link rel="shortcut icon" href="../../favicon.ico">
 <link rel="search" type="application/opensearchdescription+xml" href="http://php.net/phpnetimprovedsearch.src" title="Add PHP.net search">
 <link rel="alternate" type="application/atom+xml" href="http://php.net/releases/feed.php" title="PHP Release feed">
 <link rel="alternate" type="application/atom+xml" href="http://php.net/feed.atom" title="PHP: Hypertext Preprocessor">

 <link rel="canonical" href="function.posix-setuid.html">
 <link rel="shorturl" href="http://php.net/posix-setuid">
 <link rel="alternate" href="http://php.net/posix-setuid" hreflang="x-default">

 <link rel="contents" href="index-2.html">
 <link rel="index" href="ref.posix.html">
 <link rel="prev" href="function.posix-setsid.html">
 <link rel="next" href="function.posix-strerror.html">

 <link rel="alternate" href="function.posix-setuid.html" hreflang="en">
 <link rel="alternate" href="http://php.net/manual/pt_BR/function.posix-setuid.php" hreflang="pt_BR">
 <link rel="alternate" href="http://php.net/manual/zh/function.posix-setuid.php" hreflang="zh">
 <link rel="alternate" href="http://php.net/manual/fr/function.posix-setuid.php" hreflang="fr">
 <link rel="alternate" href="http://php.net/manual/de/function.posix-setuid.php" hreflang="de">
 <link rel="alternate" href="http://php.net/manual/it/function.posix-setuid.php" hreflang="it">
 <link rel="alternate" href="http://php.net/manual/ja/function.posix-setuid.php" hreflang="ja">
 <link rel="alternate" href="http://php.net/manual/ro/function.posix-setuid.php" hreflang="ro">
 <link rel="alternate" href="http://php.net/manual/ru/function.posix-setuid.php" hreflang="ru">
 <link rel="alternate" href="http://php.net/manual/es/function.posix-setuid.php" hreflang="es">
 <link rel="alternate" href="http://php.net/manual/tr/function.posix-setuid.php" hreflang="tr">

<link rel="stylesheet" type="text/css" href="../../cached8fe1.css?t=1401250819&amp;f=/fonts/Fira/fira.css" media="screen">
<link rel="stylesheet" type="text/css" href="../../cached4b8d.css?t=1404368420&amp;f=/fonts/Font-Awesome/css/fontello.css" media="screen">
<link rel="stylesheet" type="text/css" href="../../cached5065.css?t=1403329232&amp;f=/styles/theme-base.css" media="screen">
<link rel="stylesheet" type="text/css" href="../../cachedc78d.css?t=1401249623&amp;f=/styles/theme-medium.css" media="screen">

 <!--[if lte IE 7]>
 <link rel="stylesheet" type="text/css" href="http://php.net/styles/workarounds.ie7.css" media="screen">
 <![endif]-->

 <!--[if lte IE 8]>
 <script type="text/javascript">
  window.brokenIE = true;
 </script>
 <![endif]-->

 <!--[if lte IE 9]>
 <link rel="stylesheet" type="text/css" href="http://php.net/styles/workarounds.ie9.css" media="screen">
 <![endif]-->

 <!--[if IE]>
 <script type="text/javascript" src="http://php.net/js/ext/html5.js"></script>
 <![endif]-->

 <base>

</head>
<body class="docs " style="">


<div class="headsup"><a href="http://php.net/index.php#id2014-08-28-1">PHP 5.6.0 released</a></div>
<nav id="trick"><div><dl>
<dt><a href="getting-started.html">Getting Started</a></dt>
	<dd><a href="introduction.html">Introduction</a></dd>
	<dd><a href="tutorial.html">A simple tutorial</a></dd>
<dt><a href="langref.html">Language Reference</a></dt>
	<dd><a href="language.basic-syntax.html">Basic syntax</a></dd>
	<dd><a href="language.types.html">Types</a></dd>
	<dd><a href="language.variables.html">Variables</a></dd>
	<dd><a href="language.constants.html">Constants</a></dd>
	<dd><a href="language.expressions.html">Expressions</a></dd>
	<dd><a href="language.operators.html">Operators</a></dd>
	<dd><a href="language.control-structures.html">Control Structures</a></dd>
	<dd><a href="language.functions.html">Functions</a></dd>
	<dd><a href="language.oop5.html">Classes and Objects</a></dd>
	<dd><a href="language.namespaces.html">Namespaces</a></dd>
	<dd><a href="language.exceptions.html">Exceptions</a></dd>
	<dd><a href="language.generators.html">Generators</a></dd>
	<dd><a href="language.references.html">References Explained</a></dd>
	<dd><a href="reserved.variables.html">Predefined Variables</a></dd>
	<dd><a href="reserved.exceptions.html">Predefined Exceptions</a></dd>
	<dd><a href="reserved.interfaces.html">Predefined Interfaces and Classes</a></dd>
	<dd><a href="context.html">Context options and parameters</a></dd>
	<dd><a href="wrappers.html">Supported Protocols and Wrappers</a></dd>
</dl>
<dl>
<dt><a href="security.html">Security</a></dt>
	<dd><a href="security.intro.html">Introduction</a></dd>
	<dd><a href="security.general.html">General considerations</a></dd>
	<dd><a href="security.cgi-bin.html">Installed as CGI binary</a></dd>
	<dd><a href="security.apache.html">Installed as an Apache module</a></dd>
	<dd><a href="security.filesystem.html">Filesystem Security</a></dd>
	<dd><a href="security.database.html">Database Security</a></dd>
	<dd><a href="security.errors.html">Error Reporting</a></dd>
	<dd><a href="security.globals.html">Using Register Globals</a></dd>
	<dd><a href="security.variables.html">User Submitted Data</a></dd>
	<dd><a href="security.magicquotes.html">Magic Quotes</a></dd>
	<dd><a href="security.hiding.html">Hiding PHP</a></dd>
	<dd><a href="security.current.html">Keeping Current</a></dd>
<dt><a href="features.html">Features</a></dt>
	<dd><a href="features.http-auth.html">HTTP authentication with PHP</a></dd>
	<dd><a href="features.cookies.html">Cookies</a></dd>
	<dd><a href="features.sessions.html">Sessions</a></dd>
	<dd><a href="features.xforms.html">Dealing with XForms</a></dd>
	<dd><a href="features.file-upload.html">Handling file uploads</a></dd>
	<dd><a href="features.remote-files.html">Using remote files</a></dd>
	<dd><a href="features.connection-handling.html">Connection handling</a></dd>
	<dd><a href="features.persistent-connections.html">Persistent Database Connections</a></dd>
	<dd><a href="features.safe-mode.html">Safe Mode</a></dd>
	<dd><a href="features.commandline.html">Command line usage</a></dd>
	<dd><a href="features.gc.html">Garbage Collection</a></dd>
	<dd><a href="features.dtrace.html">DTrace Dynamic Tracing</a></dd>
</dl>
<dl>
<dt><a href="funcref.html">Function Reference</a></dt>
	<dd><a href="refs.basic.php.html">Affecting PHP's Behaviour</a></dd>
	<dd><a href="refs.utilspec.audio.html">Audio Formats Manipulation</a></dd>
	<dd><a href="refs.remote.auth.html">Authentication Services</a></dd>
	<dd><a href="refs.utilspec.cmdline.html">Command Line Specific Extensions</a></dd>
	<dd><a href="refs.compression.html">Compression and Archive Extensions</a></dd>
	<dd><a href="refs.creditcard.html">Credit Card Processing</a></dd>
	<dd><a href="refs.crypto.html">Cryptography Extensions</a></dd>
	<dd><a href="refs.database.html">Database Extensions</a></dd>
	<dd><a href="refs.calendar.html">Date and Time Related Extensions</a></dd>
	<dd><a href="refs.fileprocess.file.html">File System Related Extensions</a></dd>
	<dd><a href="refs.international.html">Human Language and Character Encoding Support</a></dd>
	<dd><a href="refs.utilspec.image.html">Image Processing and Generation</a></dd>
	<dd><a href="refs.remote.mail.html">Mail Related Extensions</a></dd>
	<dd><a href="refs.math.html">Mathematical Extensions</a></dd>
	<dd><a href="refs.utilspec.nontext.html">Non-Text MIME Output</a></dd>
	<dd><a href="refs.fileprocess.process.html">Process Control Extensions</a></dd>
	<dd><a href="refs.basic.other.html">Other Basic Extensions</a></dd>
	<dd><a href="refs.remote.other.html">Other Services</a></dd>
	<dd><a href="refs.search.html">Search Engine Extensions</a></dd>
	<dd><a href="refs.utilspec.server.html">Server Specific Extensions</a></dd>
	<dd><a href="refs.basic.session.html">Session Extensions</a></dd>
	<dd><a href="refs.basic.text.html">Text Processing</a></dd>
	<dd><a href="refs.basic.vartype.html">Variable and Type Related Extensions</a></dd>
	<dd><a href="refs.webservice.html">Web Services</a></dd>
	<dd><a href="refs.utilspec.windows.html">Windows Only Extensions</a></dd>
	<dd><a href="refs.xml.html">XML Manipulation</a></dd>
</dl>
<dl>
<dt>Keyboard Shortcuts</dt><dt>?</dt>
<dd>This help</dd>
<dt>j</dt>
<dd>Next menu item</dd>
<dt>k</dt>
<dd>Previous menu item</dd>
<dt>g p</dt>
<dd>Previous man page</dd>
<dt>g n</dt>
<dd>Next man page</dd>
<dt>G</dt>
<dd>Scroll to bottom</dd>
<dt>g g</dt>
<dd>Scroll to top</dd>
<dt>g h</dt>
<dd>Goto homepage</dd>
<dt>g s</dt>
<dd>Goto search<br>(current page)</dd>
<dt>/</dt>
<dd>Focus search box</dd>
</dl></div></nav>
<div id="goto">
    <div class="search">
         <div class="text"></div>
         <div class="results"><ul></ul></div>
   </div>
</div>

  <div id="breadcrumbs" class="row-fluid">
          
              
        <ul class="breadcrumbs-container">
            <li><a href="index-2.html">PHP Manual</a></li>      <li><a href="funcref.html">Function Reference</a></li>      <li><a href="refs.fileprocess.process.html">Process Control Extensions</a></li>      <li><a href="book.posix.html">POSIX</a></li>      <li><a href="ref.posix.html">POSIX Functions</a></li>    </ul>
  </div>




<div id="layout">
  <section id="layout-content">
  <div id="function.posix-setuid" class="refentry">
 <div class="refnamediv">
  <h1 class="refname">posix_setuid</h1>
  <p class="verinfo">(PHP 4, PHP 5)</p><p class="refpurpose"><span class="refname">posix_setuid</span> â€” <span class="dc-title">Set the UID of the current process</span></p>

 </div>
 
 <div class="refsect1 description" id="refsect1-function.posix-setuid-description">
  <h3 class="title">Description</h3>
  <div class="methodsynopsis dc-description">
   <span class="type">bool</span> <span class="methodname"><strong>posix_setuid</strong></span>
    ( <span class="methodparam"><span class="type">int</span> <code class="parameter">$uid</code></span>
   )</div>

  <p class="para rdfs-comment">
   Set the real user ID of the current process. This is a privileged
   function that needs appropriate privileges (usually root) on
   the system to be able to perform this function.
  </p>
 </div>


 <div class="refsect1 parameters" id="refsect1-function.posix-setuid-parameters">
  <h3 class="title">Parameters</h3>
  <p class="para">
   </p><dl>

    
     <dt>
<code class="parameter">uid</code></dt>

     <dd>

      <p class="para">
       The user id.
      </p>
     </dd>

    
   </dl>

  <p></p>
 </div>


 <div class="refsect1 returnvalues" id="refsect1-function.posix-setuid-returnvalues">
  <h3 class="title">Return Values</h3>
  <p class="para">
   Returns <strong><code>TRUE</code></strong> on success or <strong><code>FALSE</code></strong> on failure.
  </p>
 </div>


 <div class="refsect1 examples" id="refsect1-function.posix-setuid-examples">
  <h3 class="title">Examples</h3>
  <p class="para">
   </p><div class="example" id="example-3768">
    <p><strong>Example #1 <span class="function"><strong>posix_setuid()</strong></span> example</strong></p>
    <div class="example-contents"><p>This example will show the current user id and then set
     it to a different value.</p></div>
    <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br></span><span style="color: #007700">echo&nbsp;</span><span style="color: #0000BB">posix_getuid</span><span style="color: #007700">().</span><span style="color: #DD0000">"\n"</span><span style="color: #007700">;&nbsp;</span><span style="color: #FF8000">//10001<br></span><span style="color: #007700">echo&nbsp;</span><span style="color: #0000BB">posix_geteuid</span><span style="color: #007700">().</span><span style="color: #DD0000">"\n"</span><span style="color: #007700">;&nbsp;</span><span style="color: #FF8000">//10001<br></span><span style="color: #0000BB">posix_setuid</span><span style="color: #007700">(</span><span style="color: #0000BB">10000</span><span style="color: #007700">);<br>echo&nbsp;</span><span style="color: #0000BB">posix_getuid</span><span style="color: #007700">().</span><span style="color: #DD0000">"\n"</span><span style="color: #007700">;&nbsp;</span><span style="color: #FF8000">//10000<br></span><span style="color: #007700">echo&nbsp;</span><span style="color: #0000BB">posix_geteuid</span><span style="color: #007700">().</span><span style="color: #DD0000">"\n"</span><span style="color: #007700">;&nbsp;</span><span style="color: #FF8000">//10000<br></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
    </div>

   </div>
  <p></p>
 </div>


 <div class="refsect1 seealso" id="refsect1-function.posix-setuid-seealso">
  <h3 class="title">See Also</h3>
  <p class="para">
   </p><ul class="simplelist">
    <li class="member"><span class="function"><a href="function.posix-setgid.html" class="function" rel="rdfs-seeAlso">posix_setgid()</a> - Set the GID of the current process</span></li>
    <li class="member"><span class="function"><a href="function.posix-seteuid.html" class="function" rel="rdfs-seeAlso">posix_seteuid()</a> - Set the effective UID of the current process</span></li>
    <li class="member"><span class="function"><a href="function.posix-getuid.html" class="function" rel="rdfs-seeAlso">posix_getuid()</a> - Return the real user ID of the current process</span></li>
    <li class="member"><span class="function"><a href="function.posix-geteuid.html" class="function" rel="rdfs-seeAlso">posix_geteuid()</a> - Return the effective user ID of the current process</span></li>
   </ul>
  <p></p>
 </div>


</div>
<section id="usernotes">
 <div class="head"><h3 class="title">User Contributed Notes</h3></div><div id="allnotes">
  <div class="note" id="73113">  
  <a class="name">
  <strong class="user"><em>TheWanderer</em></strong></a><div class="date" title="2007-02-09 04:16"><strong>7 years ago</strong></div>
  <div class="text" id="Hcom73113">
<div class="phpcode"><code><span class="html">
On many UNIX systems (tested on Debian GNU/Linux), SUID is disabled for scripts and works only for binaries. If you need to setuid, you must use a wrapper binary that runs setuid() php script. Here's an example:<br><br>$ nano suexec.cpp<br>#include &lt;stdlib&gt;<br>using namespace std;<br>int main()<br>{<br>system("php /home/php/php_user.php");<br>return 0;<br>}<br><br>$ g++ -o suexec suexec.cpp<br>$ sudo chown root:root suexec<br>$ sudo chmod 4755 root<br><br>Then we create short PHP script to set process uid (you should already know how to do this). Don't even try to experiment with auto_prepend_file in php.ini, it doesn't work as expected.</span>
</code></div>
  </div>
 </div>
  <div class="note" id="115069">  
  <a class="name">
  <strong class="user"><em>Leigh</em></strong></a><div class="date" title="2014-05-22 02:08"><strong>3 months ago</strong></div>
  <div class="text" id="Hcom115069">
<div class="phpcode"><code><span class="html">
Note that on unix, if your target user does not have a valid shell, some php functions (eg: tempnam) will not work correctly:<br><br>$ grep www-data /etc/passwd<br>www-data:x:33:33:www-data:/var/www:/usr/sbin/nologin<br><br>$ cat test.php <br>#!/usr/bin/php -q<br><span class="default">&lt;?php<br>&nbsp; &nbsp; $info</span><span class="keyword">=</span><span class="default">posix_getpwnam</span><span class="keyword">(</span><span class="string">"www-data"</span><span class="keyword">);<br>&nbsp; &nbsp; </span><span class="default">$id</span><span class="keyword">=</span><span class="default">$info</span><span class="keyword">[</span><span class="string">"uid"</span><span class="keyword">];<br><br>&nbsp; &nbsp; </span><span class="default">$file</span><span class="keyword">=</span><span class="default">tempnam</span><span class="keyword">(</span><span class="string">"/tmp"</span><span class="keyword">,</span><span class="string">"something"</span><span class="keyword">);<br>&nbsp; &nbsp; print </span><span class="string">"PRE SetUID: </span><span class="default">$file</span><span class="string">\n"</span><span class="keyword">;<br><br>&nbsp; &nbsp; </span><span class="default">$SETUID</span><span class="keyword">=</span><span class="default">posix_setuid</span><span class="keyword">(</span><span class="default">$id</span><span class="keyword">);<br><br>&nbsp; &nbsp; </span><span class="default">$file</span><span class="keyword">=</span><span class="default">tempnam</span><span class="keyword">(</span><span class="string">"/tmp"</span><span class="keyword">,</span><span class="string">"something"</span><span class="keyword">);<br>&nbsp; &nbsp; print </span><span class="string">"POST SetUID: </span><span class="default">$file</span><span class="string">\n"</span><span class="keyword">;<br></span><span class="default">?&gt;<br></span><br>$ sudo ./test.php <br>PRE SetUID: /tmp/somethingrsb1qZ<br>POST SetUID:</span>
</code></div>
  </div>
 </div>
  <div class="note" id="78554">  
  <a class="name">
  <strong class="user"><em>fm at farhad.ca</em></strong></a><div class="date" title="2007-10-17 03:44"><strong>6 years ago</strong></div>
  <div class="text" id="Hcom78554">
<div class="phpcode"><code><span class="html">
When you do a posix_setuid from root to some other users you will not have access to files owned by root according to their permissions. For instance if you change owner of the process and still need to open a file for read or write with 600 permission owned by root you will receive a permission denied.<br>There are some ways to do this (i.e. a unix socket or tcp daemon etc), but probably the most easiest way is:<br><br>Open the file before changing ownership of process, save the file pointer in a global variable and use it after changing ownership. <br><br>For example assume /root/test_file is a file owned by root:root and have a permission of 600 and you are running this script under root. This code will not work:<br><br><span class="default">&lt;?php<br></span><span class="comment">// Change ownership of process to nobody<br></span><span class="default">posix_setgid</span><span class="keyword">(</span><span class="default">99</span><span class="keyword">);<br></span><span class="default">posix_setuid</span><span class="keyword">(</span><span class="default">99</span><span class="keyword">);<br><br></span><span class="default">$fd </span><span class="keyword">= </span><span class="default">fopen</span><span class="keyword">(</span><span class="string">'/root/test_file'</span><span class="keyword">,</span><span class="string">'a'</span><span class="keyword">);<br></span><span class="default">fwrite</span><span class="keyword">(</span><span class="default">$fd</span><span class="keyword">,</span><span class="string">"some test strings"</span><span class="keyword">);<br></span><span class="default">fclose</span><span class="keyword">();<br><br></span><span class="default">?&gt;<br></span><br>But this one will work:<br><br><span class="default">&lt;?php<br>$fd </span><span class="keyword">= </span><span class="default">fopen</span><span class="keyword">(</span><span class="string">'/root/test_file'</span><span class="keyword">,</span><span class="string">'a'</span><span class="keyword">);<br><br></span><span class="comment">// Change ownership of process to nobody<br></span><span class="default">posix_setgid</span><span class="keyword">(</span><span class="default">99</span><span class="keyword">);<br></span><span class="default">posix_setuid</span><span class="keyword">(</span><span class="default">99</span><span class="keyword">);<br><br></span><span class="default">fwrite</span><span class="keyword">(</span><span class="default">$fd</span><span class="keyword">,</span><span class="string">"some test strings"</span><span class="keyword">);<br></span><span class="default">fclose</span><span class="keyword">();<br><br></span><span class="default">?&gt;<br></span><br>Hope this helps some one.<br><br>[Tested on CentOS 5 - Linux 2.6.x - PHP 5.2.x]</span>
</code></div>
  </div>
 </div>
  <div class="note" id="74747">  
  <a class="name">
  <strong class="user"><em>reuben @ nospam me</em></strong></a><div class="date" title="2007-04-25 06:25"><strong>7 years ago</strong></div>
  <div class="text" id="Hcom74747">
<div class="phpcode"><code><span class="html">
In response to a note above that advocated the user of system() in a setuid program written in C, this is generally a bad idea for security.&nbsp; <br><br>You should use the standard library calls like execl() instead because system() can be manipulated to execute the wrong thing using the SHELL, IFS and possibly other variables.</span>
</code></div>
  </div>
 </div>
  <div class="note" id="68493">  
  <a class="name">
  <strong class="user"><em>hpaul/at/abo/dot/fi</em></strong></a><div class="date" title="2006-07-29 11:56"><strong>8 years ago</strong></div>
  <div class="text" id="Hcom68493">
<div class="phpcode"><code><span class="html">
It seems like this function returns true if you try to change uid to the already active user - even if you aren't root.<br><br>Should save you one if-statement in some cases.</span>
</code></div>
  </div>
 </div>
  <div class="note" id="37289">  
  <a class="name">
  <strong class="user"><em>rjmooney at syr dot edu</em></strong></a><div class="date" title="2003-11-09 03:40"><strong>10 years ago</strong></div>
  <div class="text" id="Hcom37289">
<div class="phpcode"><code><span class="html">
For simple operations, you can easily create a privilege-separation mechanism to perform commands that require elevated privileges.<br><br>For example, in creating a document repository, I had the need to provide access to certain directory and file operations based on a user's login name.&nbsp; It's unrealistic and unsecure to provide the web server access to all of the directories that the user may need to access, so I created a setuid() script to perform the required operations for me.<br><br>An exerpt from the code demonstrates this:<br><br>&lt;?<br><br>//<br>// main.php<br>//<br><br>// Perform a privileged stat()<br>function privsep_stat($path)<br>{<br>&nbsp; &nbsp; &nbsp; &nbsp; // Call the privilege separation program, ask for a stat of the specified path<br>&nbsp; &nbsp; &nbsp; &nbsp; $serialized_result = exec("/path/to/privsep.php stat " . $path, $oa, $return_code);<br>&nbsp; &nbsp; &nbsp; &nbsp; if ($return_code != 0)<br>&nbsp; &nbsp; &nbsp; &nbsp; {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; return false;<br>&nbsp; &nbsp; &nbsp; &nbsp; }<br><br>&nbsp; &nbsp; &nbsp; &nbsp; // Return the unserialized object<br>&nbsp; &nbsp; &nbsp; &nbsp; return unserialize($serialized_result);<br>}<br><br>// Get file statistics on a file we don't have access to as the web server user<br>$st = privsep_stat("/private_directory/private_file");<br>print_r($st);<br><br>?&gt;<br><br>privsep.php looks like this:<br><br>#!/usr/local/bin/php<br>&lt;?<br><br>//<br>// privsep.php<br>//<br><br>// Don't allow this script to be run from the web<br>if (isset($_SERVER['REQUEST_METHOD']))<br>{<br>&nbsp; &nbsp; print "&lt;br&gt;This program is not intended to be run directly from the WWW.\n";<br>&nbsp; &nbsp; return 1;<br>}<br><br>// TODO: add your argument validation here<br><br>// A stat was requested<br>if ($argv[1] == "stat")<br>{<br>&nbsp; &nbsp; // Reset the stat() cache<br>&nbsp; &nbsp; clearstatcache();<br><br>&nbsp; &nbsp; // Original user ID<br>&nbsp; &nbsp; $original_uid = posix_get_uid();<br><br>&nbsp; &nbsp; // Set our real user ID to root<br>&nbsp; &nbsp; $success = posix_setuid(0);<br>&nbsp; &nbsp; if (!$success)<br>&nbsp; &nbsp; {<br>&nbsp; &nbsp; &nbsp; &nbsp; print "Error: Cannot setuid().\n";<br>&nbsp; &nbsp; &nbsp; &nbsp; return 1;<br>&nbsp; &nbsp; }<br><br>&nbsp; &nbsp; // Store the file statistics<br>&nbsp; &nbsp; $st = stat($argv[2]);<br><br>&nbsp; &nbsp; // Drop the real UID back to the calling user ID<br>&nbsp; &nbsp; $success = posix_setuid($original_uid); <br>&nbsp; &nbsp; if (!$success)<br>&nbsp; &nbsp; {<br>&nbsp; &nbsp; &nbsp; &nbsp; print "Error: Cannot setuid().\n";<br>&nbsp; &nbsp; &nbsp; &nbsp; return 1;<br>&nbsp; &nbsp; }<br><br>&nbsp; &nbsp; // Drop the effective UID as well<br>&nbsp; &nbsp; $success = posix_seteuid($original_uid); <br>&nbsp; &nbsp; if (!$success)<br>&nbsp; &nbsp; {<br>&nbsp; &nbsp; &nbsp; &nbsp; print "Error: Cannot seteuid().\n";<br>&nbsp; &nbsp; &nbsp; &nbsp; return 1;<br>&nbsp; &nbsp; }<br><br>&nbsp; &nbsp; // Serialize the result and print it<br>&nbsp; &nbsp; $result = serialize($st);<br>&nbsp; &nbsp; print $result;<br><br>&nbsp; &nbsp; // Success!<br>&nbsp; &nbsp; return 0;<br>}<br>?&gt;<br><br>Finally, privsep.php's permissions are configured like this:<br><br># chown root:wheel privsep.php<br># chmod 4755 privsep.php<br><br>And look like this:<br><br>-rwsr-xr-x&nbsp; 1 root&nbsp; &nbsp; &nbsp; wheel&nbsp; &nbsp;&nbsp; 1000 Nov&nbsp; 1 00:00 privsep.php<br><br>It's probably wise to keep privsep.php out of your document root to help mitigate any successful attack. <br><br>This method can be extended for other functions.&nbsp; Use at your own risk.</span>
</code></div>
  </div>
 </div>
  <div class="note" id="23983">  
  <a class="name">
  <strong class="user"><em>simon at dont-spam-me-pleease dot simonster dot com</em></strong></a><div class="date" title="2002-08-02 03:53"><strong>12 years ago</strong></div>
  <div class="text" id="Hcom23983">
<div class="phpcode"><code><span class="html">
Here's some Perl code to run a PHP script setuid. Just put it into a CGI, make that CGI setuid and executable, then call the CGI where you would usually call the PHP script.<br><br>#!/usr/local/bin/perl<br><br># Perl wrapper to execute a PHP script setuid<br># ï¿½2002 Simon Kornblith<br># Requires PHP CGI<br><br># Make UID = EUID (so that PHP can run system()s and execs() setuid)<br>$&lt; = $&gt;;<br># Set this to the path, so that we can't get poisoned<br>$ENV{'PATH'} = "/home/httpd/cgi-bin/ssl/admin";&nbsp; &nbsp; &nbsp; <br># Open the PHP script (must start with !#/usr/local/bin/php or similar and<br># be executable<br>open(STDOUT, "| /home/httpd/cgi-bin/ssl/admin/new.php");<br># Write STDIN to PHP script <br>print while &lt;STDIN&gt;;</span>
</code></div>
  </div>
 </div></div>

 
</section>    </section><!-- layout-content -->
        


  </div><!-- layout -->
         
  

    
 <!-- External and third party libraries. -->
 







<a id="toTop" href="javascript:;"><span id="toTopHover"></span><img width="40" height="40" alt="To Top" src="../../images/to-top%402x.png"></a>



<!-- Mirrored from php.net/manual/en/function.posix-setuid.php by HTTrack Website Copier/3.x [XR&CO'2013], Thu, 28 Aug 2014 16:35:58 GMT -->


</body></html>