<html><!-- Mirrored from php.net/manual/en/function.getmypid.php by HTTrack Website Copier/3.x [XR&CO'2013], Thu, 28 Aug 2014 16:09:01 GMT --><!-- Added by HTTrack --><head><meta http-equiv="content-type" content="text/html;charset=utf-8"><!-- /Added by HTTrack -->


  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0"> 

  <title>getmypid</title>

 <link rel="shortcut icon" href="../../favicon.ico">
 <link rel="search" type="application/opensearchdescription+xml" href="http://php.net/phpnetimprovedsearch.src" title="Add PHP.net search">
 <link rel="alternate" type="application/atom+xml" href="http://php.net/releases/feed.php" title="PHP Release feed">
 <link rel="alternate" type="application/atom+xml" href="http://php.net/feed.atom" title="PHP: Hypertext Preprocessor">

 <link rel="canonical" href="function.getmypid.html">
 <link rel="shorturl" href="http://php.net/getmypid">
 <link rel="alternate" href="http://php.net/getmypid" hreflang="x-default">

 <link rel="contents" href="index-2.html">
 <link rel="index" href="ref.info.html">
 <link rel="prev" href="function.getmyinode.html">
 <link rel="next" href="function.getmyuid.html">

 <link rel="alternate" href="function.getmypid.html" hreflang="en">
 <link rel="alternate" href="http://php.net/manual/pt_BR/function.getmypid.php" hreflang="pt_BR">
 <link rel="alternate" href="http://php.net/manual/zh/function.getmypid.php" hreflang="zh">
 <link rel="alternate" href="http://php.net/manual/fr/function.getmypid.php" hreflang="fr">
 <link rel="alternate" href="http://php.net/manual/de/function.getmypid.php" hreflang="de">
 <link rel="alternate" href="http://php.net/manual/it/function.getmypid.php" hreflang="it">
 <link rel="alternate" href="http://php.net/manual/ja/function.getmypid.php" hreflang="ja">
 <link rel="alternate" href="http://php.net/manual/ro/function.getmypid.php" hreflang="ro">
 <link rel="alternate" href="http://php.net/manual/ru/function.getmypid.php" hreflang="ru">
 <link rel="alternate" href="http://php.net/manual/es/function.getmypid.php" hreflang="es">
 <link rel="alternate" href="http://php.net/manual/tr/function.getmypid.php" hreflang="tr">

<link rel="stylesheet" type="text/css" href="../../cached8fe1.css?t=1401250819&amp;f=/fonts/Fira/fira.css" media="screen">
<link rel="stylesheet" type="text/css" href="../../cached4b8d.css?t=1404368420&amp;f=/fonts/Font-Awesome/css/fontello.css" media="screen">
<link rel="stylesheet" type="text/css" href="../../cached5065.css?t=1403329232&amp;f=/styles/theme-base.css" media="screen">
<link rel="stylesheet" type="text/css" href="../../cachedc78d.css?t=1401249623&amp;f=/styles/theme-medium.css" media="screen">

 <!--[if lte IE 7]>
 <link rel="stylesheet" type="text/css" href="http://php.net/styles/workarounds.ie7.css" media="screen">
 <![endif]-->

 <!--[if lte IE 8]>
 <script type="text/javascript">
  window.brokenIE = true;
 </script>
 <![endif]-->

 <!--[if lte IE 9]>
 <link rel="stylesheet" type="text/css" href="http://php.net/styles/workarounds.ie9.css" media="screen">
 <![endif]-->

 <!--[if IE]>
 <script type="text/javascript" src="http://php.net/js/ext/html5.js"></script>
 <![endif]-->

 <base>

</head>
<body class="docs " style="">


<div class="headsup"><a href="http://php.net/index.php#id2014-08-28-1">PHP 5.6.0 released</a></div>
<nav id="trick"><div><dl>
<dt><a href="getting-started.html">Getting Started</a></dt>
	<dd><a href="introduction.html">Introduction</a></dd>
	<dd><a href="tutorial.html">A simple tutorial</a></dd>
<dt><a href="langref.html">Language Reference</a></dt>
	<dd><a href="language.basic-syntax.html">Basic syntax</a></dd>
	<dd><a href="language.types.html">Types</a></dd>
	<dd><a href="language.variables.html">Variables</a></dd>
	<dd><a href="language.constants.html">Constants</a></dd>
	<dd><a href="language.expressions.html">Expressions</a></dd>
	<dd><a href="language.operators.html">Operators</a></dd>
	<dd><a href="language.control-structures.html">Control Structures</a></dd>
	<dd><a href="language.functions.html">Functions</a></dd>
	<dd><a href="language.oop5.html">Classes and Objects</a></dd>
	<dd><a href="language.namespaces.html">Namespaces</a></dd>
	<dd><a href="language.exceptions.html">Exceptions</a></dd>
	<dd><a href="language.generators.html">Generators</a></dd>
	<dd><a href="language.references.html">References Explained</a></dd>
	<dd><a href="reserved.variables.html">Predefined Variables</a></dd>
	<dd><a href="reserved.exceptions.html">Predefined Exceptions</a></dd>
	<dd><a href="reserved.interfaces.html">Predefined Interfaces and Classes</a></dd>
	<dd><a href="context.html">Context options and parameters</a></dd>
	<dd><a href="wrappers.html">Supported Protocols and Wrappers</a></dd>
</dl>
<dl>
<dt><a href="security.html">Security</a></dt>
	<dd><a href="security.intro.html">Introduction</a></dd>
	<dd><a href="security.general.html">General considerations</a></dd>
	<dd><a href="security.cgi-bin.html">Installed as CGI binary</a></dd>
	<dd><a href="security.apache.html">Installed as an Apache module</a></dd>
	<dd><a href="security.filesystem.html">Filesystem Security</a></dd>
	<dd><a href="security.database.html">Database Security</a></dd>
	<dd><a href="security.errors.html">Error Reporting</a></dd>
	<dd><a href="security.globals.html">Using Register Globals</a></dd>
	<dd><a href="security.variables.html">User Submitted Data</a></dd>
	<dd><a href="security.magicquotes.html">Magic Quotes</a></dd>
	<dd><a href="security.hiding.html">Hiding PHP</a></dd>
	<dd><a href="security.current.html">Keeping Current</a></dd>
<dt><a href="features.html">Features</a></dt>
	<dd><a href="features.http-auth.html">HTTP authentication with PHP</a></dd>
	<dd><a href="features.cookies.html">Cookies</a></dd>
	<dd><a href="features.sessions.html">Sessions</a></dd>
	<dd><a href="features.xforms.html">Dealing with XForms</a></dd>
	<dd><a href="features.file-upload.html">Handling file uploads</a></dd>
	<dd><a href="features.remote-files.html">Using remote files</a></dd>
	<dd><a href="features.connection-handling.html">Connection handling</a></dd>
	<dd><a href="features.persistent-connections.html">Persistent Database Connections</a></dd>
	<dd><a href="features.safe-mode.html">Safe Mode</a></dd>
	<dd><a href="features.commandline.html">Command line usage</a></dd>
	<dd><a href="features.gc.html">Garbage Collection</a></dd>
	<dd><a href="features.dtrace.html">DTrace Dynamic Tracing</a></dd>
</dl>
<dl>
<dt><a href="funcref.html">Function Reference</a></dt>
	<dd><a href="refs.basic.php.html">Affecting PHP's Behaviour</a></dd>
	<dd><a href="refs.utilspec.audio.html">Audio Formats Manipulation</a></dd>
	<dd><a href="refs.remote.auth.html">Authentication Services</a></dd>
	<dd><a href="refs.utilspec.cmdline.html">Command Line Specific Extensions</a></dd>
	<dd><a href="refs.compression.html">Compression and Archive Extensions</a></dd>
	<dd><a href="refs.creditcard.html">Credit Card Processing</a></dd>
	<dd><a href="refs.crypto.html">Cryptography Extensions</a></dd>
	<dd><a href="refs.database.html">Database Extensions</a></dd>
	<dd><a href="refs.calendar.html">Date and Time Related Extensions</a></dd>
	<dd><a href="refs.fileprocess.file.html">File System Related Extensions</a></dd>
	<dd><a href="refs.international.html">Human Language and Character Encoding Support</a></dd>
	<dd><a href="refs.utilspec.image.html">Image Processing and Generation</a></dd>
	<dd><a href="refs.remote.mail.html">Mail Related Extensions</a></dd>
	<dd><a href="refs.math.html">Mathematical Extensions</a></dd>
	<dd><a href="refs.utilspec.nontext.html">Non-Text MIME Output</a></dd>
	<dd><a href="refs.fileprocess.process.html">Process Control Extensions</a></dd>
	<dd><a href="refs.basic.other.html">Other Basic Extensions</a></dd>
	<dd><a href="refs.remote.other.html">Other Services</a></dd>
	<dd><a href="refs.search.html">Search Engine Extensions</a></dd>
	<dd><a href="refs.utilspec.server.html">Server Specific Extensions</a></dd>
	<dd><a href="refs.basic.session.html">Session Extensions</a></dd>
	<dd><a href="refs.basic.text.html">Text Processing</a></dd>
	<dd><a href="refs.basic.vartype.html">Variable and Type Related Extensions</a></dd>
	<dd><a href="refs.webservice.html">Web Services</a></dd>
	<dd><a href="refs.utilspec.windows.html">Windows Only Extensions</a></dd>
	<dd><a href="refs.xml.html">XML Manipulation</a></dd>
</dl>
<dl>
<dt>Keyboard Shortcuts</dt><dt>?</dt>
<dd>This help</dd>
<dt>j</dt>
<dd>Next menu item</dd>
<dt>k</dt>
<dd>Previous menu item</dd>
<dt>g p</dt>
<dd>Previous man page</dd>
<dt>g n</dt>
<dd>Next man page</dd>
<dt>G</dt>
<dd>Scroll to bottom</dd>
<dt>g g</dt>
<dd>Scroll to top</dd>
<dt>g h</dt>
<dd>Goto homepage</dd>
<dt>g s</dt>
<dd>Goto search<br>(current page)</dd>
<dt>/</dt>
<dd>Focus search box</dd>
</dl></div></nav>
<div id="goto">
    <div class="search">
         <div class="text"></div>
         <div class="results"><ul></ul></div>
   </div>
</div>

  <div id="breadcrumbs" class="row-fluid">
          
              
        <ul class="breadcrumbs-container">
            <li><a href="index-2.html">PHP Manual</a></li>      <li><a href="funcref.html">Function Reference</a></li>      <li><a href="refs.basic.php.html">Affecting PHP's Behaviour</a></li>      <li><a href="book.info.html">PHP Options/Info</a></li>      <li><a href="ref.info.html">PHP Options/Info Functions</a></li>    </ul>
  </div>




<div id="layout">
  <section id="layout-content">
  <div id="function.getmypid" class="refentry">
 <div class="refnamediv">
  <h1 class="refname">getmypid</h1>
  <p class="verinfo">(PHP 4, PHP 5)</p><p class="refpurpose"><span class="refname">getmypid</span> â€” <span class="dc-title">Gets PHP's process ID</span></p>

 </div>
 
 <div class="refsect1 description" id="refsect1-function.getmypid-description">
  <h3 class="title">Description</h3>
  <div class="methodsynopsis dc-description">
   <span class="type">int</span> <span class="methodname"><strong>getmypid</strong></span>
    ( <span class="methodparam">void</span>
   )</div>

  <p class="para rdfs-comment">
   Gets the current PHP process ID.
  </p>
 </div>


 <div class="refsect1 returnvalues" id="refsect1-function.getmypid-returnvalues">
  <h3 class="title">Return Values</h3>
  <p class="para">
   Returns the current PHP process ID, or <strong><code>FALSE</code></strong> on error.
  </p>
 </div>


 <div class="refsect1 notes" id="refsect1-function.getmypid-notes">
  <h3 class="title">Notes</h3>
  <div class="warning"><strong class="warning">Warning</strong>
   <p class="para">
    Process IDs are not unique, thus they are a weak entropy
    source. We recommend against relying on pids in
    security-dependent contexts.
   </p>
  </div>
 </div>


 <div class="refsect1 seealso" id="refsect1-function.getmypid-seealso">
  <h3 class="title">See Also</h3>
  <p class="para">
   </p><ul class="simplelist">
    <li class="member"><span class="function"><a href="function.getmygid.html" class="function" rel="rdfs-seeAlso">getmygid()</a> - Get PHP script owner's GID</span></li>
    <li class="member"><span class="function"><a href="function.getmyuid.html" class="function" rel="rdfs-seeAlso">getmyuid()</a> - Gets PHP script owner's UID</span></li>
    <li class="member"><span class="function"><a href="function.get-current-user.html" class="function" rel="rdfs-seeAlso">get_current_user()</a> - Gets the name of the owner of the current PHP script</span></li>
    <li class="member"><span class="function"><a href="function.getmyinode.html" class="function" rel="rdfs-seeAlso">getmyinode()</a> - Gets the inode of the current script</span></li>
    <li class="member"><span class="function"><a href="function.getlastmod.html" class="function" rel="rdfs-seeAlso">getlastmod()</a> - Gets time of last page modification</span></li>
   </ul>
  <p></p>
 </div>


</div>
<section id="usernotes">
 <div class="head"><h3 class="title">User Contributed Notes</h3></div><div id="allnotes">
  <div class="note" id="112782">  
  <a class="name">
  <strong class="user"><em>Radu Cristescu</em></strong></a><div class="date" title="2013-07-22 06:44"><strong>1 year ago</strong></div>
  <div class="text" id="Hcom112782">
<div class="phpcode"><code><span class="html">
The lock-file mechanism in Kevin Trass's note is incorrect because it is subject to race conditions.<br><br>For locks you need an atomic way of verifying if a lock file exists and creating it if it doesn't exist. Between file_exists and file_put_contents, another process could be faster than us to write the lock.<br><br>The only filesystem operation that matches the above requirements that I know of is symlink().<br><br>Thus, if you need a lock-file mechanism, here's the code. This won't work on a system without /proc (so there go Windows, BSD, OS X, and possibly others), but it can be adapted to work around that deficiency (say, by linking to your pid file like in my script, then operating through the symlink like in Kevin's solution).<br><br>#!/usr/bin/php<br><span class="default">&lt;?php<br><br>define</span><span class="keyword">(</span><span class="string">'LOCK_FILE'</span><span class="keyword">, </span><span class="string">"/var/run/" </span><span class="keyword">. </span><span class="default">basename</span><span class="keyword">(</span><span class="default">$argv</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">], </span><span class="string">".php"</span><span class="keyword">) . </span><span class="string">".lock"</span><span class="keyword">);<br><br>if (!</span><span class="default">tryLock</span><span class="keyword">())<br>&nbsp; &nbsp; die(</span><span class="string">"Already running.\n"</span><span class="keyword">);<br><br></span><span class="comment"># remove the lock on exit (Control+C doesn't count as 'exit'?)<br></span><span class="default">register_shutdown_function</span><span class="keyword">(</span><span class="string">'unlink'</span><span class="keyword">, </span><span class="default">LOCK_FILE</span><span class="keyword">);<br><br></span><span class="comment"># The rest of your script goes here....<br></span><span class="keyword">echo </span><span class="string">"Hello world!\n"</span><span class="keyword">;<br></span><span class="default">sleep</span><span class="keyword">(</span><span class="default">30</span><span class="keyword">);<br><br>exit(</span><span class="default">0</span><span class="keyword">);<br><br>function </span><span class="default">tryLock</span><span class="keyword">()<br>{<br>&nbsp; &nbsp; </span><span class="comment"># If lock file exists, check if stale.&nbsp; If exists and is not stale, return TRUE<br>&nbsp; &nbsp; # Else, create lock file and return FALSE.<br><br>&nbsp; &nbsp; </span><span class="keyword">if (@</span><span class="default">symlink</span><span class="keyword">(</span><span class="string">"/proc/" </span><span class="keyword">. </span><span class="default">getmypid</span><span class="keyword">(), </span><span class="default">LOCK_FILE</span><span class="keyword">) !== </span><span class="default">FALSE</span><span class="keyword">) </span><span class="comment"># the @ in front of 'symlink' is to suppress the NOTICE you get if the LOCK_FILE exists<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="keyword">return </span><span class="default">true</span><span class="keyword">;<br><br>&nbsp; &nbsp; </span><span class="comment"># link already exists<br>&nbsp; &nbsp; # check if it's stale<br>&nbsp; &nbsp; </span><span class="keyword">if (</span><span class="default">is_link</span><span class="keyword">(</span><span class="default">LOCK_FILE</span><span class="keyword">) &amp;&amp; !</span><span class="default">is_dir</span><span class="keyword">(</span><span class="default">LOCK_FILE</span><span class="keyword">))<br>&nbsp; &nbsp; {<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">unlink</span><span class="keyword">(</span><span class="default">LOCK_FILE</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="comment"># try to lock again<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="keyword">return </span><span class="default">tryLock</span><span class="keyword">();<br>&nbsp; &nbsp; }<br><br>&nbsp; &nbsp; return </span><span class="default">false</span><span class="keyword">;<br>}<br></span><span class="default">?&gt;</span>
</span>
</code></div>
  </div>
 </div>
  <div class="note" id="93753">  
  <a class="name">
  <strong class="user"><em>Kevin Traas (ktraas- at -gmail dot com)</em></strong></a><div class="date" title="2009-09-25 01:51"><strong>4 years ago</strong></div>
  <div class="text" id="Hcom93753">
<div class="phpcode"><code><span class="html">
Looking to create a lock-file mechanism for a cmd-line script?
<br>
<br>Enjoy!
<br>
<br>#!/usr/bin/php
<br><span class="default">&lt;?php
<br>
<br>define</span><span class="keyword">( </span><span class="string">'LOCK_FILE'</span><span class="keyword">, </span><span class="string">"/var/run/"</span><span class="keyword">.</span><span class="default">basename</span><span class="keyword">( </span><span class="default">$argv</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">], </span><span class="string">".php" </span><span class="keyword">).</span><span class="string">".lock" </span><span class="keyword">);
<br>if( </span><span class="default">isLocked</span><span class="keyword">() ) die( </span><span class="string">"Already running.\n" </span><span class="keyword">);
<br>
<br></span><span class="comment"># The rest of your script goes here....
<br></span><span class="keyword">echo </span><span class="string">"Hello world!\n"</span><span class="keyword">;
<br></span><span class="default">sleep</span><span class="keyword">(</span><span class="default">30</span><span class="keyword">);
<br>
<br></span><span class="default">unlink</span><span class="keyword">( </span><span class="default">LOCK_FILE </span><span class="keyword">);
<br>exit(</span><span class="default">0</span><span class="keyword">);
<br>
<br>function </span><span class="default">isLocked</span><span class="keyword">()
<br>{
<br>&nbsp; &nbsp; </span><span class="comment"># If lock file exists, check if stale.&nbsp; If exists and is not stale, return TRUE
<br>&nbsp; &nbsp; # Else, create lock file and return FALSE.
<br>
<br>&nbsp; &nbsp; </span><span class="keyword">if( </span><span class="default">file_exists</span><span class="keyword">( </span><span class="default">LOCK_FILE </span><span class="keyword">) )
<br>&nbsp; &nbsp; {
<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="comment"># check if it's stale
<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$lockingPID </span><span class="keyword">= </span><span class="default">trim</span><span class="keyword">( </span><span class="default">file_get_contents</span><span class="keyword">( </span><span class="default">LOCK_FILE </span><span class="keyword">) );
<br>
<br>&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment"># Get all active PIDs.
<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$pids </span><span class="keyword">= </span><span class="default">explode</span><span class="keyword">( </span><span class="string">"\n"</span><span class="keyword">, </span><span class="default">trim</span><span class="keyword">( `</span><span class="string">ps -e | awk '{print $1}'</span><span class="keyword">` ) );
<br>
<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="comment"># If PID is still active, return true
<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="keyword">if( </span><span class="default">in_array</span><span class="keyword">( </span><span class="default">$lockingPID</span><span class="keyword">, </span><span class="default">$pids </span><span class="keyword">) )&nbsp; return </span><span class="default">true</span><span class="keyword">;
<br>
<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="comment"># Lock-file is stale, so kill it.&nbsp; Then move on to re-creating it.
<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="keyword">echo </span><span class="string">"Removing stale lock file.\n"</span><span class="keyword">;
<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">unlink</span><span class="keyword">( </span><span class="default">LOCK_FILE </span><span class="keyword">);
<br>&nbsp; &nbsp; }
<br>&nbsp; &nbsp; 
<br>&nbsp; &nbsp; </span><span class="default">file_put_contents</span><span class="keyword">( </span><span class="default">LOCK_FILE</span><span class="keyword">, </span><span class="default">getmypid</span><span class="keyword">() . </span><span class="string">"\n" </span><span class="keyword">);
<br>&nbsp; &nbsp; return </span><span class="default">false</span><span class="keyword">;
<br>
<br>}
<br></span><span class="default">?&gt;</span>
</span>
</code></div>
  </div>
 </div>
  <div class="note" id="36859">  
  <a class="name">
  <strong class="user"><em>brooke at jump dot net</em></strong></a><div class="date" title="2003-10-24 05:49"><strong>10 years ago</strong></div>
  <div class="text" id="Hcom36859">
<div class="phpcode"><code><span class="html">
One good use for this is deciding on a concurrency-safe temporary file or directory name. You can be assured that no two processes on the same server have the same PID, so this is enough to avoid collisions. For example:
<br>
<br><span class="default">&lt;?php
<br>$tmpfile </span><span class="keyword">= </span><span class="string">"/tmp/foo_"</span><span class="keyword">.</span><span class="default">getmypid</span><span class="keyword">();
<br></span><span class="comment">// Use $tmpfile...
<br>// Use $tmpfile...
<br>// Use $tmpfile...
<br></span><span class="default">unlink </span><span class="keyword">(</span><span class="default">$tmpfile</span><span class="keyword">);
<br></span><span class="default">?&gt;
<br></span>
<br>If you are sharing /tmp over the network (which is odd....) then you can, of course, mix in the PHP server's IP address.</span>
</code></div>
  </div>
 </div>
  <div class="note" id="59889">  
  <a class="name">
  <strong class="user"><em>kroczu at interia dot pl</em></strong></a><div class="date" title="2005-12-19 04:59"><strong>8 years ago</strong></div>
  <div class="text" id="Hcom59889">
<div class="phpcode"><code><span class="html">
<span class="default">&lt;?php
<br></span><span class="comment">/*
<br>
<br>mixed getpidinfo(mixed pid [, string system_ps_command_options])
<br>
<br>this function gets PID-info from system ps command and return it in useful assoc-array,
<br>or return false and trigger warning if PID doesn't exists
<br>
<br>$pidifo=getpidinfo(12345);
<br>
<br>print_r($pidifo);
<br>
<br>Array
<br>(
<br>&nbsp; &nbsp; [USER] =&gt; user
<br>&nbsp; &nbsp; [PID] =&gt; 12345
<br>&nbsp; &nbsp; [%CPU] =&gt; 0.0
<br>&nbsp; &nbsp; [%MEM] =&gt; 0.0
<br>&nbsp; &nbsp; [VSZ] =&gt; 1720
<br>&nbsp; &nbsp; [RSS] =&gt; 8
<br>&nbsp; &nbsp; [TT] =&gt; ??
<br>&nbsp; &nbsp; [STAT] =&gt; Is
<br>&nbsp; &nbsp; [STARTED] =&gt; 6:00PM
<br>&nbsp; &nbsp; [TIME] =&gt; 0:00.01
<br>&nbsp; &nbsp; [COMMAND] =&gt; php someproces.php &gt; logfile
<br>)
<br>
<br>*/
<br>
<br>//////////////////////////////////////////////
<br>
<br></span><span class="keyword">function </span><span class="default">getpidinfo</span><span class="keyword">(</span><span class="default">$pid</span><span class="keyword">, </span><span class="default">$ps_opt</span><span class="keyword">=</span><span class="string">"aux"</span><span class="keyword">){
<br>
<br>&nbsp;&nbsp; </span><span class="default">$ps</span><span class="keyword">=</span><span class="default">shell_exec</span><span class="keyword">(</span><span class="string">"ps "</span><span class="keyword">.</span><span class="default">$ps_opt</span><span class="keyword">.</span><span class="string">"p "</span><span class="keyword">.</span><span class="default">$pid</span><span class="keyword">);
<br>&nbsp;&nbsp; </span><span class="default">$ps</span><span class="keyword">=</span><span class="default">explode</span><span class="keyword">(</span><span class="string">"\n"</span><span class="keyword">, </span><span class="default">$ps</span><span class="keyword">);
<br>&nbsp;&nbsp; 
<br>&nbsp;&nbsp; if(</span><span class="default">count</span><span class="keyword">(</span><span class="default">$ps</span><span class="keyword">)&lt;</span><span class="default">2</span><span class="keyword">){
<br>&nbsp; &nbsp; &nbsp; </span><span class="default">trigger_error</span><span class="keyword">(</span><span class="string">"PID "</span><span class="keyword">.</span><span class="default">$pid</span><span class="keyword">.</span><span class="string">" doesn't exists"</span><span class="keyword">, </span><span class="default">E_USER_WARNING</span><span class="keyword">);
<br>&nbsp; &nbsp; &nbsp; return </span><span class="default">false</span><span class="keyword">;
<br>&nbsp;&nbsp; }
<br>
<br>&nbsp;&nbsp; foreach(</span><span class="default">$ps </span><span class="keyword">as </span><span class="default">$key</span><span class="keyword">=&gt;</span><span class="default">$val</span><span class="keyword">){
<br>&nbsp; &nbsp; &nbsp; </span><span class="default">$ps</span><span class="keyword">[</span><span class="default">$key</span><span class="keyword">]=</span><span class="default">explode</span><span class="keyword">(</span><span class="string">" "</span><span class="keyword">, </span><span class="default">ereg_replace</span><span class="keyword">(</span><span class="string">" +"</span><span class="keyword">, </span><span class="string">" "</span><span class="keyword">, </span><span class="default">trim</span><span class="keyword">(</span><span class="default">$ps</span><span class="keyword">[</span><span class="default">$key</span><span class="keyword">])));
<br>&nbsp;&nbsp; }
<br>
<br>&nbsp;&nbsp; foreach(</span><span class="default">$ps</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">] as </span><span class="default">$key</span><span class="keyword">=&gt;</span><span class="default">$val</span><span class="keyword">){
<br>&nbsp; &nbsp; &nbsp; </span><span class="default">$pidinfo</span><span class="keyword">[</span><span class="default">$val</span><span class="keyword">] = </span><span class="default">$ps</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">][</span><span class="default">$key</span><span class="keyword">];
<br>&nbsp; &nbsp; &nbsp; unset(</span><span class="default">$ps</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">][</span><span class="default">$key</span><span class="keyword">]);
<br>&nbsp;&nbsp; }
<br>&nbsp;&nbsp; 
<br>&nbsp;&nbsp; if(</span><span class="default">is_array</span><span class="keyword">(</span><span class="default">$ps</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">])){
<br>&nbsp; &nbsp; &nbsp; </span><span class="default">$pidinfo</span><span class="keyword">[</span><span class="default">$val</span><span class="keyword">].=</span><span class="string">" "</span><span class="keyword">.</span><span class="default">implode</span><span class="keyword">(</span><span class="string">" "</span><span class="keyword">, </span><span class="default">$ps</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">]);
<br>&nbsp;&nbsp; }
<br>&nbsp;&nbsp; return </span><span class="default">$pidinfo</span><span class="keyword">;
<br>}
<br>
<br></span><span class="default">?&gt;</span>
</span>
</code></div>
  </div>
 </div>
  <div class="note" id="104275">  
  <a class="name">
  <strong class="user"><em>wouter99999 at gmail dot com</em></strong></a><div class="date" title="2011-06-05 03:03"><strong>3 years ago</strong></div>
  <div class="text" id="Hcom104275">
<div class="phpcode"><code><span class="html">
On windows, ps is not available. Instead, to view a list of running processes, you can use exec('tasklist'); To kill processes you can use exec('taskkill); Enter taskkill /? for more information.</span>
</code></div>
  </div>
 </div>
  <div class="note" id="96007">  
  <a class="name">
  <strong class="user"><em>gabe at fijiwebdesign dot com</em></strong></a><div class="date" title="2010-02-02 09:53"><strong>4 years ago</strong></div>
  <div class="text" id="Hcom96007">
<div class="phpcode"><code><span class="html">
Based on what james at voodoo dot co dot uk said, but modified for CLI scripts (ie: there is no $_SERVER). <br><br><span class="default">&lt;?php<br><br></span><span class="comment">/**<br> * Check for a current process by filename<br> * @param $file[optional] Filename<br> * @return Boolean<br> */<br></span><span class="keyword">function </span><span class="default">processExists</span><span class="keyword">(</span><span class="default">$file </span><span class="keyword">= </span><span class="default">false</span><span class="keyword">) {<br><br>&nbsp; &nbsp; </span><span class="default">$exists&nbsp; &nbsp;&nbsp; </span><span class="keyword">= </span><span class="default">false</span><span class="keyword">;<br>&nbsp; &nbsp; </span><span class="default">$file&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">= </span><span class="default">$file </span><span class="keyword">? </span><span class="default">$file </span><span class="keyword">: </span><span class="default">__FILE__</span><span class="keyword">;<br><br>&nbsp; &nbsp; </span><span class="comment">// Check if file is in process list<br>&nbsp; &nbsp; </span><span class="default">exec</span><span class="keyword">(</span><span class="string">"ps -C </span><span class="default">$file</span><span class="string"> -o pid="</span><span class="keyword">, </span><span class="default">$pids</span><span class="keyword">);<br>&nbsp; &nbsp; if (</span><span class="default">count</span><span class="keyword">(</span><span class="default">$pids</span><span class="keyword">) &gt; </span><span class="default">1</span><span class="keyword">) {<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$exists </span><span class="keyword">= </span><span class="default">true</span><span class="keyword">;<br>&nbsp; &nbsp; }<br>&nbsp; &nbsp; return </span><span class="default">$exists</span><span class="keyword">;<br>}<br><br></span><span class="default">?&gt;</span>
</span>
</code></div>
  </div>
 </div>
  <div class="note" id="113055">  
  <a class="name">
  <strong class="user"><em>brospam at gmail dot com</em></strong></a><div class="date" title="2013-08-23 10:19"><strong>1 year ago</strong></div>
  <div class="text" id="Hcom113055">
<div class="phpcode"><code><span class="html">
My lockfile system<br><br><span class="default">&lt;?php<br></span><span class="keyword">function </span><span class="default">isLocked</span><span class="keyword">(){<br>&nbsp; &nbsp; if(</span><span class="default">file_exists</span><span class="keyword">(</span><span class="default">LOCK_FILE</span><span class="keyword">)) {<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$lockingPID </span><span class="keyword">= </span><span class="default">trim</span><span class="keyword">(</span><span class="default">file_get_contents</span><span class="keyword">(</span><span class="default">LOCK_FILE</span><span class="keyword">)); <br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$test</span><span class="keyword">=</span><span class="default">trim</span><span class="keyword">(`</span><span class="string">ps -p </span><span class="default">$lockingPID</span><span class="string"> -o pid=</span><span class="keyword">`);<br>&nbsp; &nbsp; &nbsp; &nbsp; if(!empty(</span><span class="default">$test</span><span class="keyword">)) return </span><span class="default">true</span><span class="keyword">; <br>&nbsp; &nbsp; &nbsp; &nbsp; echo </span><span class="string">"Removing stale lock file.\n"</span><span class="keyword">; <br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">unlink</span><span class="keyword">(</span><span class="default">LOCK_FILE</span><span class="keyword">);<br>&nbsp; &nbsp; }<br>&nbsp; &nbsp; </span><span class="default">file_put_contents</span><span class="keyword">(</span><span class="default">LOCK_FILE</span><span class="keyword">, </span><span class="default">getmypid</span><span class="keyword">().</span><span class="string">"\n"</span><span class="keyword">); <br>&nbsp; &nbsp; return </span><span class="default">false</span><span class="keyword">;<br>}<br></span><span class="default">?&gt;</span>
</span>
</code></div>
  </div>
 </div>
  <div class="note" id="107022">  
  <a class="name">
  <strong class="user"><em>pdc at example dot com</em></strong></a><div class="date" title="2011-12-29 12:50"><strong>2 years ago</strong></div>
  <div class="text" id="Hcom107022">
<div class="phpcode"><code><span class="html">
Here is how you'd use exec on a posix system to accomplish counting processes quickly.
<br>
<br>I want to know how many processes are running with 'update.php' in the command:
<br>
<br>ps aux|grep "[u]pdate.php"|wc -l
<br>
<br>(the trick of using [u]pdate.php instead of update.php makes sure that the grep command itself is not matched).&nbsp; Be sure to use quotes in the command, or it won't work either.
<br>
<br>So, the code:
<br>
<br><span class="default">&lt;?php
<br></span><span class="keyword">function </span><span class="default">countProcesses</span><span class="keyword">(</span><span class="default">$scriptName</span><span class="keyword">)
<br>{
<br>&nbsp; &nbsp; </span><span class="comment">// ps aux|grep "[u]pdate.php"|wc -l
<br>&nbsp; &nbsp; </span><span class="default">$first&nbsp; &nbsp; </span><span class="keyword">=&nbsp; &nbsp; </span><span class="default">substr</span><span class="keyword">(</span><span class="default">$scriptName</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">1</span><span class="keyword">);
<br>&nbsp; &nbsp; </span><span class="default">$rest&nbsp; &nbsp; </span><span class="keyword">=&nbsp; &nbsp; </span><span class="default">substr</span><span class="keyword">(</span><span class="default">$scriptName</span><span class="keyword">, </span><span class="default">1</span><span class="keyword">);
<br>&nbsp; &nbsp; 
<br>&nbsp; &nbsp; </span><span class="default">$name&nbsp; &nbsp; </span><span class="keyword">=&nbsp; &nbsp; </span><span class="string">'"['</span><span class="keyword">.</span><span class="default">$first</span><span class="keyword">.</span><span class="string">']'</span><span class="keyword">.</span><span class="default">$rest</span><span class="keyword">.</span><span class="string">'"'</span><span class="keyword">;
<br>&nbsp; &nbsp; </span><span class="default">$cmd&nbsp; &nbsp; </span><span class="keyword">=&nbsp; &nbsp; </span><span class="string">"ps aux | grep </span><span class="default">$name</span><span class="string"> | wc -l"</span><span class="keyword">;
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
<br>&nbsp; &nbsp; </span><span class="default">$result&nbsp; &nbsp; </span><span class="keyword">=&nbsp; &nbsp; </span><span class="default">exec</span><span class="keyword">(</span><span class="default">$cmd</span><span class="keyword">);
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
<br>&nbsp; &nbsp; return </span><span class="default">$result</span><span class="keyword">;
<br>}
<br></span><span class="default">?&gt;</span>
</span>
</code></div>
  </div>
 </div>
  <div class="note" id="103807">  
  <a class="name">
  <strong class="user"><em>Robert Mays Jr</em></strong></a><div class="date" title="2011-05-04 09:39"><strong>3 years ago</strong></div>
  <div class="text" id="Hcom103807">
<div class="phpcode"><code><span class="html">
All of the examples above require you to have shell command execution turned on- this example uses only PHP functions and should work on any system (posix is included by default)-<br><br>the key is posix_getsid which will return FALSE if the processes does not exist.<br><br><span class="default">&lt;?php <br>$lockfile </span><span class="keyword">= </span><span class="default">sys_get_temp_dir</span><span class="keyword">() . </span><span class="string">'/myScript.lock'</span><span class="keyword">; <br></span><span class="default">$pid </span><span class="keyword">= </span><span class="default">file_get_contents</span><span class="keyword">(</span><span class="default">$lockfile</span><span class="keyword">); <br>if (</span><span class="default">posix_getsid</span><span class="keyword">(</span><span class="default">$pid</span><span class="keyword">) === </span><span class="default">false</span><span class="keyword">) { <br>&nbsp;&nbsp; print </span><span class="string">"process has died! restarting...\n"</span><span class="keyword">; <br>&nbsp;&nbsp; </span><span class="default">file_put_contents</span><span class="keyword">(</span><span class="default">$lockfile</span><span class="keyword">, </span><span class="default">getmypid</span><span class="keyword">()); </span><span class="comment">// create lockfile <br></span><span class="keyword">} else { <br>&nbsp;&nbsp; print </span><span class="string">"PID is still alive! can not run twice!\n"</span><span class="keyword">; <br>&nbsp;&nbsp; exit; <br>} <br></span><span class="default">?&gt;</span> <br><br>:-) perfect if you need to make sure a cron job or shell script has ended before it can be started again.<br><br>This works across users- if the cron job is started as 'root' your 'web user' can see if the process is still alive (useful for system status pages)</span>
</code></div>
  </div>
 </div>
  <div class="note" id="94531">  
  <a class="name">
  <strong class="user"><em>Erickson Reyes ercbluemonday at yahoo dot com</em></strong></a><div class="date" title="2009-11-10 05:01"><strong>4 years ago</strong></div>
  <div class="text" id="Hcom94531">
<div class="phpcode"><code><span class="html">
We also had this challenge in our company to prevent a php script in a cron job from overlapping each other. <br><br>We made this solution<br><br><span class="default">&lt;?php<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="comment">// Initialize variables<br>&nbsp; &nbsp; </span><span class="default">$found&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">;<br>&nbsp; &nbsp; </span><span class="default">$file&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">= </span><span class="default">basename</span><span class="keyword">(</span><span class="default">__FILE__</span><span class="keyword">);<br>&nbsp; &nbsp; </span><span class="default">$commands&nbsp; &nbsp; </span><span class="keyword">= array();<br><br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="comment">// Get running processes.<br>&nbsp; &nbsp; </span><span class="default">exec</span><span class="keyword">(</span><span class="string">"ps w"</span><span class="keyword">, </span><span class="default">$commands</span><span class="keyword">);<br><br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="comment">// If processes are found<br>&nbsp; &nbsp; </span><span class="keyword">if (</span><span class="default">count</span><span class="keyword">(</span><span class="default">$commands</span><span class="keyword">) &gt; </span><span class="default">0</span><span class="keyword">) {<br><br>&nbsp; &nbsp; &nbsp; &nbsp; foreach (</span><span class="default">$commands </span><span class="keyword">as </span><span class="default">$command</span><span class="keyword">) {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if (</span><span class="default">strpos</span><span class="keyword">(</span><span class="default">$command</span><span class="keyword">, </span><span class="default">$file</span><span class="keyword">) === </span><span class="default">false</span><span class="keyword">) {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// Do nothin'<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="keyword">}<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; else {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// Let's count how many times the file is found.<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$found</span><span class="keyword">++;<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br>&nbsp; &nbsp; &nbsp; &nbsp; }<br>&nbsp; &nbsp; }<br><br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="comment">// If the instance of the file is found more than once.<br>&nbsp; &nbsp; </span><span class="keyword">if (</span><span class="default">$found </span><span class="keyword">&gt; </span><span class="default">1</span><span class="keyword">) {<br>&nbsp; &nbsp; &nbsp; &nbsp; echo </span><span class="string">"Another process is running.\n"</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; die();<br>&nbsp; &nbsp; }<br><br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="comment">/**<br>&nbsp; &nbsp; &nbsp; &nbsp; * <br>&nbsp; &nbsp; &nbsp; &nbsp; * Regular process here...<br>&nbsp; &nbsp; &nbsp; &nbsp; * <br>&nbsp; &nbsp; &nbsp; &nbsp; */<br></span><span class="default">?&gt;</span>
</span>
</code></div>
  </div>
 </div>
  <div class="note" id="51148">  
  <a class="name">
  <strong class="user"><em>Pure-PHP</em></strong></a><div class="date" title="2005-03-21 02:26"><strong>9 years ago</strong></div>
  <div class="text" id="Hcom51148">
<div class="phpcode"><code><span class="html">
You can use this function also to avoid more than one instance of your app.<br><br>You can also use this class.<br><a rel="nofollow" target="_blank">http://www.pure-php.de/node/20</a><br><br>Usage:<br><br><span class="default">&lt;?php<br><br>inlude</span><span class="keyword">(</span><span class="string">"ProcessHandler.class.php"</span><span class="keyword">);<br><br>if(</span><span class="default">ProcessHandler</span><span class="keyword">::</span><span class="default">isActive</span><span class="keyword">()){<br>&nbsp;&nbsp; die(</span><span class="string">"Already running!\n"</span><span class="keyword">;);<br>}else{<br>&nbsp;&nbsp; </span><span class="default">ProcessHandler</span><span class="keyword">::</span><span class="default">activate</span><span class="keyword">();<br>&nbsp;&nbsp; </span><span class="comment">//run my app<br></span><span class="keyword">}<br><br></span><span class="default">?&gt;</span>
</span>
</code></div>
  </div>
 </div>
  <div class="note" id="109333">  
  <a class="name">
  <strong class="user"><em>eight_hf at live dot fr</em></strong></a><div class="date" title="2012-07-07 12:19"><strong>2 years ago</strong></div>
  <div class="text" id="Hcom109333">
<div class="phpcode"><code><span class="html">
On Linux you can check if a process is still running by verifying if the PID exists in the /proc directory :<br><br><span class="default">&lt;?php<br></span><span class="keyword">if(</span><span class="default">file_exists</span><span class="keyword">(</span><span class="string">'/proc/'</span><span class="keyword">.</span><span class="default">$pid</span><span class="keyword">))<br>{<br>&nbsp; &nbsp; echo </span><span class="string">'The process is still running.'</span><span class="keyword">;<br>}<br></span><span class="default">?&gt;</span>
</span>
</code></div>
  </div>
 </div>
  <div class="note" id="95303">  
  <a class="name">
  <strong class="user"><em>james at voodoo dot co dot uk</em></strong></a><div class="date" title="2009-12-25 01:50"><strong>4 years ago</strong></div>
  <div class="text" id="Hcom95303">
<div class="phpcode"><code><span class="html">
The 'ps' command has an option that can make filtering for a specific process more efficient.&nbsp; Using this the work of looking for matching processes can be made neater:<br><br><span class="default">&lt;?php<br>&nbsp; &nbsp; </span><span class="comment">/*<br>&nbsp; &nbsp; Return an array of the pids of the processes that are running for the specific command<br>&nbsp; &nbsp; e.g.<br>&nbsp; &nbsp; &nbsp; &nbsp; returnPids('myprocess.php');<br>&nbsp; &nbsp; */<br>&nbsp; &nbsp; </span><span class="keyword">function </span><span class="default">returnPids</span><span class="keyword">(</span><span class="default">$command</span><span class="keyword">) {<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">exec</span><span class="keyword">(</span><span class="string">"ps -C </span><span class="default">$command</span><span class="string"> -o pid="</span><span class="keyword">,</span><span class="default">$pids</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; foreach (</span><span class="default">$pids </span><span class="keyword">as </span><span class="default">$key</span><span class="keyword">=&gt;</span><span class="default">$value</span><span class="keyword">) </span><span class="default">$pids</span><span class="keyword">[</span><span class="default">$key</span><span class="keyword">]=</span><span class="default">trim</span><span class="keyword">(</span><span class="default">$value</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; return </span><span class="default">$pids</span><span class="keyword">;<br>&nbsp; &nbsp; }&nbsp; &nbsp; <br><br>&nbsp; &nbsp; </span><span class="comment">/*<br>&nbsp; &nbsp; Returns an array of the pids for processes that are like me, i.e. my program running<br>&nbsp; &nbsp; */<br>&nbsp; &nbsp; </span><span class="keyword">function </span><span class="default">returnMyPids</span><span class="keyword">() {<br>&nbsp; &nbsp; &nbsp; &nbsp; return </span><span class="default">returnPids</span><span class="keyword">(</span><span class="default">basename</span><span class="keyword">(</span><span class="default">$_SERVER</span><span class="keyword">[</span><span class="string">"SCRIPT_NAME"</span><span class="keyword">]));<br>&nbsp; &nbsp; }<br></span><span class="default">?&gt;<br></span><br>e.g. to bomb out if I'm running already<br><br>if (count(returnMyPids())&gt;1) exit;</span>
</code></div>
  </div>
 </div></div>

 
</section>    </section><!-- layout-content -->
        


  </div><!-- layout -->
         
  

    
 <!-- External and third party libraries. -->
 







<a id="toTop" href="javascript:;"><span id="toTopHover"></span><img width="40" height="40" alt="To Top" src="../../images/to-top%402x.png"></a>



<!-- Mirrored from php.net/manual/en/function.getmypid.php by HTTrack Website Copier/3.x [XR&CO'2013], Thu, 28 Aug 2014 16:09:01 GMT -->


</body></html>