<html><!-- Mirrored from php.net/manual/en/function.fseek.php by HTTrack Website Copier/3.x [XR&CO'2013], Thu, 28 Aug 2014 16:04:28 GMT --><!-- Added by HTTrack --><head><meta http-equiv="content-type" content="text/html;charset=utf-8"><!-- /Added by HTTrack -->


  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0"> 

  <title>fseek</title>

 <link rel="shortcut icon" href="../../favicon.ico">
 <link rel="search" type="application/opensearchdescription+xml" href="http://php.net/phpnetimprovedsearch.src" title="Add PHP.net search">
 <link rel="alternate" type="application/atom+xml" href="http://php.net/releases/feed.php" title="PHP Release feed">
 <link rel="alternate" type="application/atom+xml" href="http://php.net/feed.atom" title="PHP: Hypertext Preprocessor">

 <link rel="canonical" href="function.fseek.html">
 <link rel="shorturl" href="http://php.net/fseek">
 <link rel="alternate" href="http://php.net/fseek" hreflang="x-default">

 <link rel="contents" href="index-2.html">
 <link rel="index" href="ref.filesystem.html">
 <link rel="prev" href="function.fscanf.html">
 <link rel="next" href="function.fstat.html">

 <link rel="alternate" href="function.fseek.html" hreflang="en">
 <link rel="alternate" href="http://php.net/manual/pt_BR/function.fseek.php" hreflang="pt_BR">
 <link rel="alternate" href="http://php.net/manual/zh/function.fseek.php" hreflang="zh">
 <link rel="alternate" href="http://php.net/manual/fr/function.fseek.php" hreflang="fr">
 <link rel="alternate" href="http://php.net/manual/de/function.fseek.php" hreflang="de">
 <link rel="alternate" href="http://php.net/manual/it/function.fseek.php" hreflang="it">
 <link rel="alternate" href="http://php.net/manual/ja/function.fseek.php" hreflang="ja">
 <link rel="alternate" href="http://php.net/manual/ro/function.fseek.php" hreflang="ro">
 <link rel="alternate" href="http://php.net/manual/ru/function.fseek.php" hreflang="ru">
 <link rel="alternate" href="http://php.net/manual/es/function.fseek.php" hreflang="es">
 <link rel="alternate" href="http://php.net/manual/tr/function.fseek.php" hreflang="tr">

<link rel="stylesheet" type="text/css" href="../../cached8fe1.css?t=1401250819&amp;f=/fonts/Fira/fira.css" media="screen">
<link rel="stylesheet" type="text/css" href="../../cached4b8d.css?t=1404368420&amp;f=/fonts/Font-Awesome/css/fontello.css" media="screen">
<link rel="stylesheet" type="text/css" href="../../cached5065.css?t=1403329232&amp;f=/styles/theme-base.css" media="screen">
<link rel="stylesheet" type="text/css" href="../../cachedc78d.css?t=1401249623&amp;f=/styles/theme-medium.css" media="screen">

 <!--[if lte IE 7]>
 <link rel="stylesheet" type="text/css" href="http://php.net/styles/workarounds.ie7.css" media="screen">
 <![endif]-->

 <!--[if lte IE 8]>
 <script type="text/javascript">
  window.brokenIE = true;
 </script>
 <![endif]-->

 <!--[if lte IE 9]>
 <link rel="stylesheet" type="text/css" href="http://php.net/styles/workarounds.ie9.css" media="screen">
 <![endif]-->

 <!--[if IE]>
 <script type="text/javascript" src="http://php.net/js/ext/html5.js"></script>
 <![endif]-->

 <base>

</head>
<body class="docs " style="">


<div class="headsup"><a href="http://php.net/index.php#id2014-08-28-1">PHP 5.6.0 released</a></div>
<nav id="trick"><div><dl>
<dt><a href="getting-started.html">Getting Started</a></dt>
	<dd><a href="introduction.html">Introduction</a></dd>
	<dd><a href="tutorial.html">A simple tutorial</a></dd>
<dt><a href="langref.html">Language Reference</a></dt>
	<dd><a href="language.basic-syntax.html">Basic syntax</a></dd>
	<dd><a href="language.types.html">Types</a></dd>
	<dd><a href="language.variables.html">Variables</a></dd>
	<dd><a href="language.constants.html">Constants</a></dd>
	<dd><a href="language.expressions.html">Expressions</a></dd>
	<dd><a href="language.operators.html">Operators</a></dd>
	<dd><a href="language.control-structures.html">Control Structures</a></dd>
	<dd><a href="language.functions.html">Functions</a></dd>
	<dd><a href="language.oop5.html">Classes and Objects</a></dd>
	<dd><a href="language.namespaces.html">Namespaces</a></dd>
	<dd><a href="language.exceptions.html">Exceptions</a></dd>
	<dd><a href="language.generators.html">Generators</a></dd>
	<dd><a href="language.references.html">References Explained</a></dd>
	<dd><a href="reserved.variables.html">Predefined Variables</a></dd>
	<dd><a href="reserved.exceptions.html">Predefined Exceptions</a></dd>
	<dd><a href="reserved.interfaces.html">Predefined Interfaces and Classes</a></dd>
	<dd><a href="context.html">Context options and parameters</a></dd>
	<dd><a href="wrappers.html">Supported Protocols and Wrappers</a></dd>
</dl>
<dl>
<dt><a href="security.html">Security</a></dt>
	<dd><a href="security.intro.html">Introduction</a></dd>
	<dd><a href="security.general.html">General considerations</a></dd>
	<dd><a href="security.cgi-bin.html">Installed as CGI binary</a></dd>
	<dd><a href="security.apache.html">Installed as an Apache module</a></dd>
	<dd><a href="security.filesystem.html">Filesystem Security</a></dd>
	<dd><a href="security.database.html">Database Security</a></dd>
	<dd><a href="security.errors.html">Error Reporting</a></dd>
	<dd><a href="security.globals.html">Using Register Globals</a></dd>
	<dd><a href="security.variables.html">User Submitted Data</a></dd>
	<dd><a href="security.magicquotes.html">Magic Quotes</a></dd>
	<dd><a href="security.hiding.html">Hiding PHP</a></dd>
	<dd><a href="security.current.html">Keeping Current</a></dd>
<dt><a href="features.html">Features</a></dt>
	<dd><a href="features.http-auth.html">HTTP authentication with PHP</a></dd>
	<dd><a href="features.cookies.html">Cookies</a></dd>
	<dd><a href="features.sessions.html">Sessions</a></dd>
	<dd><a href="features.xforms.html">Dealing with XForms</a></dd>
	<dd><a href="features.file-upload.html">Handling file uploads</a></dd>
	<dd><a href="features.remote-files.html">Using remote files</a></dd>
	<dd><a href="features.connection-handling.html">Connection handling</a></dd>
	<dd><a href="features.persistent-connections.html">Persistent Database Connections</a></dd>
	<dd><a href="features.safe-mode.html">Safe Mode</a></dd>
	<dd><a href="features.commandline.html">Command line usage</a></dd>
	<dd><a href="features.gc.html">Garbage Collection</a></dd>
	<dd><a href="features.dtrace.html">DTrace Dynamic Tracing</a></dd>
</dl>
<dl>
<dt><a href="funcref.html">Function Reference</a></dt>
	<dd><a href="refs.basic.php.html">Affecting PHP's Behaviour</a></dd>
	<dd><a href="refs.utilspec.audio.html">Audio Formats Manipulation</a></dd>
	<dd><a href="refs.remote.auth.html">Authentication Services</a></dd>
	<dd><a href="refs.utilspec.cmdline.html">Command Line Specific Extensions</a></dd>
	<dd><a href="refs.compression.html">Compression and Archive Extensions</a></dd>
	<dd><a href="refs.creditcard.html">Credit Card Processing</a></dd>
	<dd><a href="refs.crypto.html">Cryptography Extensions</a></dd>
	<dd><a href="refs.database.html">Database Extensions</a></dd>
	<dd><a href="refs.calendar.html">Date and Time Related Extensions</a></dd>
	<dd><a href="refs.fileprocess.file.html">File System Related Extensions</a></dd>
	<dd><a href="refs.international.html">Human Language and Character Encoding Support</a></dd>
	<dd><a href="refs.utilspec.image.html">Image Processing and Generation</a></dd>
	<dd><a href="refs.remote.mail.html">Mail Related Extensions</a></dd>
	<dd><a href="refs.math.html">Mathematical Extensions</a></dd>
	<dd><a href="refs.utilspec.nontext.html">Non-Text MIME Output</a></dd>
	<dd><a href="refs.fileprocess.process.html">Process Control Extensions</a></dd>
	<dd><a href="refs.basic.other.html">Other Basic Extensions</a></dd>
	<dd><a href="refs.remote.other.html">Other Services</a></dd>
	<dd><a href="refs.search.html">Search Engine Extensions</a></dd>
	<dd><a href="refs.utilspec.server.html">Server Specific Extensions</a></dd>
	<dd><a href="refs.basic.session.html">Session Extensions</a></dd>
	<dd><a href="refs.basic.text.html">Text Processing</a></dd>
	<dd><a href="refs.basic.vartype.html">Variable and Type Related Extensions</a></dd>
	<dd><a href="refs.webservice.html">Web Services</a></dd>
	<dd><a href="refs.utilspec.windows.html">Windows Only Extensions</a></dd>
	<dd><a href="refs.xml.html">XML Manipulation</a></dd>
</dl>
<dl>
<dt>Keyboard Shortcuts</dt><dt>?</dt>
<dd>This help</dd>
<dt>j</dt>
<dd>Next menu item</dd>
<dt>k</dt>
<dd>Previous menu item</dd>
<dt>g p</dt>
<dd>Previous man page</dd>
<dt>g n</dt>
<dd>Next man page</dd>
<dt>G</dt>
<dd>Scroll to bottom</dd>
<dt>g g</dt>
<dd>Scroll to top</dd>
<dt>g h</dt>
<dd>Goto homepage</dd>
<dt>g s</dt>
<dd>Goto search<br>(current page)</dd>
<dt>/</dt>
<dd>Focus search box</dd>
</dl></div></nav>
<div id="goto">
    <div class="search">
         <div class="text"></div>
         <div class="results"><ul></ul></div>
   </div>
</div>

  <div id="breadcrumbs" class="row-fluid">
          
              
        <ul class="breadcrumbs-container">
            <li><a href="index-2.html">PHP Manual</a></li>      <li><a href="funcref.html">Function Reference</a></li>      <li><a href="refs.fileprocess.file.html">File System Related Extensions</a></li>      <li><a href="book.filesystem.html">Filesystem</a></li>      <li><a href="ref.filesystem.html">Filesystem Functions</a></li>    </ul>
  </div>




<div id="layout">
  <section id="layout-content">
  <div id="function.fseek" class="refentry">
 <div class="refnamediv">
  <h1 class="refname">fseek</h1>
  <p class="verinfo">(PHP 4, PHP 5)</p><p class="refpurpose"><span class="refname">fseek</span> â€” <span class="dc-title">Seeks on a file pointer</span></p>

 </div>
 
 <div class="refsect1 description" id="refsect1-function.fseek-description">
  <h3 class="title">Description</h3>
  <div class="methodsynopsis dc-description">
   <span class="type">int</span> <span class="methodname"><strong>fseek</strong></span>
    ( <span class="methodparam"><span class="type">resource</span> <code class="parameter">$handle</code></span>
   , <span class="methodparam"><span class="type">int</span> <code class="parameter">$offset</code></span>
   [, <span class="methodparam"><span class="type">int</span> <code class="parameter">$whence</code><span class="initializer"> = SEEK_SET</span></span>
  ] )</div>

  <p class="para rdfs-comment">
   Sets the file position indicator for the file referenced by
   <code class="parameter">handle</code>. The new position, measured in bytes
   from the beginning of the file, is obtained by adding
   <code class="parameter">offset</code> to the position specified by
   <code class="parameter">whence</code>.
  </p>
  <p class="para">
   In general, it is allowed to seek past the end-of-file; if data is then
   written, reads in any unwritten region between the end-of-file and the
   sought position will yield bytes with value 0. However, certain streams
   may not support this behavior, especially when they have an underlying
   fixed size storage.
  </p>
 </div>


 <div class="refsect1 parameters" id="refsect1-function.fseek-parameters">
  <h3 class="title">Parameters</h3>
  <p class="para">
   </p><dl>

    
     <dt>
<code class="parameter">handle</code></dt>

     <dd>

      <p class="para">A file system pointer <span class="type"><a href="language.types.resource.html" class="type resource">resource</a></span>
that is typically created using <span class="function"><a href="function.fopen.html" class="function">fopen()</a></span>.</p>
     </dd>

    
    
     <dt>
<code class="parameter">offset</code></dt>

     <dd>

      <p class="para">
       The offset.
      </p>
      <p class="para">
       To move to a position before the end-of-file, you need to pass
       a negative value in <code class="parameter">offset</code> and
       set <code class="parameter">whence</code>
       to <strong><code>SEEK_END</code></strong>.
      </p>
     </dd>

    
    
     <dt>
<code class="parameter">whence</code></dt>

     <dd>

      <p class="para">
       <code class="parameter">whence</code> values are:
       </p><ul class="simplelist">
        <li class="member"><strong><code>SEEK_SET</code></strong> - Set position equal to <code class="parameter">offset</code> bytes.</li>
        <li class="member"><strong><code>SEEK_CUR</code></strong> - Set position to current location plus <code class="parameter">offset</code>.</li>
        <li class="member"><strong><code>SEEK_END</code></strong> - Set position to end-of-file plus <code class="parameter">offset</code>.</li>
       </ul>
      <p></p>
     </dd>

    
   </dl>

  <p></p>
 </div>


 <div class="refsect1 returnvalues" id="refsect1-function.fseek-returnvalues">
  <h3 class="title">Return Values</h3>
  <p class="para">
   Upon success, returns 0; otherwise, returns -1.
  </p>
 </div>


 <div class="refsect1 examples" id="refsect1-function.fseek-examples">
  <h3 class="title">Examples</h3>
  <p class="para">
   </p><div class="example" id="example-2487">
    <p><strong>Example #1 <span class="function"><strong>fseek()</strong></span> example</strong></p>
    <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br><br>$fp&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">fopen</span><span style="color: #007700">(</span><span style="color: #DD0000">'somefile.txt'</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">'r'</span><span style="color: #007700">);<br><br></span><span style="color: #FF8000">//&nbsp;read&nbsp;some&nbsp;data<br></span><span style="color: #0000BB">$data&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">fgets</span><span style="color: #007700">(</span><span style="color: #0000BB">$fp</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">4096</span><span style="color: #007700">);<br><br></span><span style="color: #FF8000">//&nbsp;move&nbsp;back&nbsp;to&nbsp;the&nbsp;beginning&nbsp;of&nbsp;the&nbsp;file<br>//&nbsp;same&nbsp;as&nbsp;rewind($fp);<br></span><span style="color: #0000BB">fseek</span><span style="color: #007700">(</span><span style="color: #0000BB">$fp</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">0</span><span style="color: #007700">);<br><br></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
    </div>

   </div>
  <p></p>
 </div>


 <div class="refsect1 notes" id="refsect1-function.fseek-notes">
  <h3 class="title">Notes</h3>
  <blockquote class="note"><p><strong class="note">Note</strong>: 
   </p><p class="para">
    If you have opened the file in append (<em>a</em> or
    <em>a+</em>) mode, any data you write to the file will always be
    appended, regardless of the file position, and the result of calling
    <span class="function"><strong>fseek()</strong></span> will be undefined.
   </p>
  <p></p></blockquote>
  <blockquote class="note"><p><strong class="note">Note</strong>: 
   </p><p class="para">
    Not all streams support seeking. For those that do not support seeking,
    forward seeking from the current position is accomplished by reading
    and discarding data; other forms of seeking will fail.
   </p>
  <p></p></blockquote>
 </div>


 <div class="refsect1 seealso" id="refsect1-function.fseek-seealso">
  <h3 class="title">See Also</h3>
  <p class="para">
   </p><ul class="simplelist">
    <li class="member"><span class="function"><a href="function.ftell.html" class="function" rel="rdfs-seeAlso">ftell()</a> - Returns the current position of the file read/write pointer</span></li>
    <li class="member"><span class="function"><a href="function.rewind.html" class="function" rel="rdfs-seeAlso">rewind()</a> - Rewind the position of a file pointer</span></li>
   </ul>
  <p></p>
 </div>


</div>
<section id="usernotes">
 <div class="head"><h3 class="title">User Contributed Notes</h3></div><div id="allnotes">
  <div class="note" id="81450">  
  <a class="name">
  <strong class="user"><em>seeker at example com</em></strong></a><div class="date" title="2008-02-28 08:40"><strong>6 years ago</strong></div>
  <div class="text" id="Hcom81450">
<div class="phpcode"><code><span class="html">
JUST TO QUOTE AND POINT THIS OUT:<br><br>!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!<br>3. if you're using fseek() to write data to a file, remember to open the file in "r+" <br>mode, example:<br><br>&nbsp; $fp=fopen($filename,"r+");<br><br>DON'T open the file in mode "a" (for append), because it puts<br> the file pointer at the end of the file and doesn't let you <br>fseek earlier positions in the file (it didn't for me!). Also, <br>don't open the file in mode "w" -- although this puts you at <br>the beginning of the file -- because it wipes out all data in <br>the file. <br><br>!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!<br><br>Took me half a day to figure :/</span>
</code></div>
  </div>
 </div>
  <div class="note" id="102994">  
  <a class="name">
  <strong class="user"><em>Anonymous</em></strong></a><div class="date" title="2011-03-18 06:56"><strong>3 years ago</strong></div>
  <div class="text" id="Hcom102994">
<div class="phpcode"><code><span class="html">
The official docs indicate that not all streams are seekable.<br>You can try to seek anyway and handle failure:<br><br><span class="default">&lt;?php<br></span><span class="keyword">if (</span><span class="default">fseek</span><span class="keyword">(</span><span class="default">$stream</span><span class="keyword">, </span><span class="default">$offset</span><span class="keyword">, </span><span class="default">SEEK_CUR</span><span class="keyword">) === -</span><span class="default">1</span><span class="keyword">) {<br>&nbsp; </span><span class="comment">// whatever<br></span><span class="keyword">} <br></span><span class="default">?&gt;<br></span><br>Or, you can use the stream_get_meta_data function:<br><a rel="nofollow" target="_blank">http://php.net/stream_get_meta_data</a><br><br><span class="default">&lt;?php <br></span><span class="keyword">function </span><span class="default">fseekable</span><span class="keyword">(</span><span class="default">$stream</span><span class="keyword">) {<br>&nbsp; </span><span class="default">$meta </span><span class="keyword">= </span><span class="default">stream_get_meta_data</span><span class="keyword">(</span><span class="default">$stream</span><span class="keyword">);<br>&nbsp; return </span><span class="default">$meta</span><span class="keyword">[</span><span class="string">'seekable'</span><span class="keyword">];<br>}<br></span><span class="default">?&gt;</span>
</span>
</code></div>
  </div>
 </div>
  <div class="note" id="49992">  
  <a class="name">
  <strong class="user"><em>Lutz ( l_broedel at gmx dot net )</em></strong></a><div class="date" title="2005-02-14 02:25"><strong>9 years ago</strong></div>
  <div class="text" id="Hcom49992">
<div class="phpcode"><code><span class="html">
Based on the function below, provided by info at o08 dot com (thanks), the following should enable you to read a single line from a file, identified by the line number (starting with 1):<br><br>&lt;?<br>&nbsp; &nbsp; function readLine ($linenum,$fh) {<br>&nbsp; &nbsp; &nbsp; &nbsp; $line = fgets ($fh, 4096);<br>&nbsp; &nbsp; &nbsp; &nbsp; $pos = -1;<br>&nbsp; &nbsp; &nbsp; &nbsp; $i = 0;<br><br>&nbsp; &nbsp; &nbsp; &nbsp; while (!feof($fh) &amp;&amp; $i&lt;($linenum-1)) {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $char = fgetc($fh);<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if ($char != "\n" &amp;&amp; $char != "\r") {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; fseek($fh, $pos, SEEK_SET);<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $pos ++;<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; else $i ++; <br>&nbsp; &nbsp; &nbsp; &nbsp; }<br>&nbsp; &nbsp; &nbsp; &nbsp; $line = fgets($fh);<br>&nbsp; &nbsp; &nbsp; &nbsp; return $line;<br>&nbsp; &nbsp; } //readLine()<br>?&gt;</span>
</code></div>
  </div>
 </div>
  <div class="note" id="112647">  
  <a class="name">
  <strong class="user"><em>me at php dot net</em></strong></a><div class="date" title="2013-07-09 09:14"><strong>1 year ago</strong></div>
  <div class="text" id="Hcom112647">
<div class="phpcode"><code><span class="html">
how to read BIG files using fseek (above 2GB+, upto any size like 4GB+, 100GB+, 100 terabyes+, any file size, 100 petabytes, max limit is php_float_max ) ?<br><br>// seek / set file pointer to 50 GB<br>my_fseek($fp, floatval(50000000000),1);<br><br>function my_fseek($fp,$pos,$first=0) {<br><br>// set to 0 pos initially, one-time<br>if($first) fseek($fp,0,SEEK_SET);<br><br>// get pos float value<br>$pos=floatval($pos);<br><br> // within limits, use normal fseek<br>if($pos&lt;=PHP_INT_MAX)<br>&nbsp; fseek($fp,$pos,SEEK_CUR);<br> // out of limits, use recursive fseek<br>else {<br>&nbsp; fseek($fp,PHP_INT_MAX,SEEK_CUR);<br>&nbsp; $pos -= PHP_INT_MAX;<br>&nbsp; my_fseek($fp,$pos);<br>}<br><br>}<br><br>hope this helps.</span>
</code></div>
  </div>
 </div>
  <div class="note" id="111690">  
  <a class="name">
  <strong class="user"><em>lorenzo dot stanco at gmail dot com</em></strong></a><div class="date" title="2013-03-17 06:38"><strong>1 year ago</strong></div>
  <div class="text" id="Hcom111690">
<div class="phpcode"><code><span class="html">
I want to give my contribution about the "read last lines from a file" topic. I've done some researches (starting from here, really) and run many tests for different algorithms and scenarios, and came up with this:<br><br>What is the best way in PHP to read last lines from a file?<br><a rel="nofollow" target="_blank">http://stackoverflow.com/a/15025877/995958</a><br><br>In that mini-article I tried to analyze all different methods and their performance over different files.<br><br>Hope it helps.</span>
</code></div>
  </div>
 </div>
  <div class="note" id="86517">  
  <a class="name">
  <strong class="user"><em>ben at nullcreations dot net</em></strong></a><div class="date" title="2008-10-22 02:38"><strong>5 years ago</strong></div>
  <div class="text" id="Hcom86517">
<div class="phpcode"><code><span class="html">
easier tail() function for php:
<br>
<br><span class="default">&lt;?php
<br></span><span class="keyword">function </span><span class="default">tail</span><span class="keyword">(</span><span class="default">$file</span><span class="keyword">, </span><span class="default">$num_to_get</span><span class="keyword">=</span><span class="default">10</span><span class="keyword">)
<br>{
<br>&nbsp; </span><span class="default">$fp </span><span class="keyword">= </span><span class="default">fopen</span><span class="keyword">(</span><span class="default">$file</span><span class="keyword">, </span><span class="string">'r'</span><span class="keyword">);
<br>&nbsp; </span><span class="default">$position </span><span class="keyword">= </span><span class="default">filesize</span><span class="keyword">(</span><span class="default">$file</span><span class="keyword">);
<br>&nbsp; </span><span class="default">fseek</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">, </span><span class="default">$position</span><span class="keyword">-</span><span class="default">1</span><span class="keyword">);
<br>&nbsp; </span><span class="default">$chunklen </span><span class="keyword">= </span><span class="default">4096</span><span class="keyword">;
<br>&nbsp; while(</span><span class="default">$position </span><span class="keyword">&gt;= </span><span class="default">0</span><span class="keyword">)
<br>&nbsp; {
<br>&nbsp; &nbsp; </span><span class="default">$position </span><span class="keyword">= </span><span class="default">$position </span><span class="keyword">- </span><span class="default">$chunklen</span><span class="keyword">;
<br>&nbsp; &nbsp; if (</span><span class="default">$position </span><span class="keyword">&lt; </span><span class="default">0</span><span class="keyword">) { </span><span class="default">$chunklen </span><span class="keyword">= </span><span class="default">abs</span><span class="keyword">(</span><span class="default">$position</span><span class="keyword">); </span><span class="default">$position</span><span class="keyword">=</span><span class="default">0</span><span class="keyword">;}
<br>&nbsp; &nbsp; </span><span class="default">fseek</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">, </span><span class="default">$position</span><span class="keyword">);
<br>&nbsp; &nbsp; </span><span class="default">$data </span><span class="keyword">= </span><span class="default">fread</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">, </span><span class="default">$chunklen</span><span class="keyword">). </span><span class="default">$data</span><span class="keyword">;
<br>&nbsp; &nbsp; if (</span><span class="default">substr_count</span><span class="keyword">(</span><span class="default">$data</span><span class="keyword">, </span><span class="string">"\n"</span><span class="keyword">) &gt;= </span><span class="default">$num_to_get </span><span class="keyword">+ </span><span class="default">1</span><span class="keyword">)
<br>&nbsp; &nbsp; {
<br>&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">preg_match</span><span class="keyword">(</span><span class="string">"!(.*?\n){"</span><span class="keyword">.(</span><span class="default">$num_to_get</span><span class="keyword">-</span><span class="default">1</span><span class="keyword">).</span><span class="string">"}$!"</span><span class="keyword">, </span><span class="default">$data</span><span class="keyword">, </span><span class="default">$match</span><span class="keyword">);
<br>&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">$match</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">];
<br>&nbsp; &nbsp; }
<br>&nbsp; }
<br>&nbsp; </span><span class="default">fclose</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">);
<br>&nbsp; return </span><span class="default">$data</span><span class="keyword">;
<br>}
<br></span><span class="default">?&gt;</span>
</span>
</code></div>
  </div>
 </div>
  <div class="note" id="114396">  
  <a class="name">
  <strong class="user"><em>lexica98 at gmail dot com</em></strong></a><div class="date" title="2014-02-15 05:23"><strong>6 months ago</strong></div>
  <div class="text" id="Hcom114396">
<div class="phpcode"><code><span class="html">
Opening the file in a+ mode doesn't work with fseek either, unfortunately. If you want a file created and then want be able to go to any position in the file, you'll have to use append mode when opening the file, then close it, then open it again in r+.</span>
</code></div>
  </div>
 </div>
  <div class="note" id="25250">  
  <a class="name"><strong class="user"><em>Anonymous</em></strong></a><div class="date" title="2002-09-16 01:25"><strong>11 years ago</strong></div>
  <div class="text" id="Hcom25250">
<div class="phpcode"><code><span class="html">
Don't use filesize() on files that may be accessed and updated by parallel processes or threads (as the filesize() return value is maintained in a cache).<br>Instead lock the opened file and use fseek($fp,0,SEEK_END) and ftell($fp) to get the actual filesize if you need to perform a fread() call to read the whole file...</span>
</code></div>
  </div>
 </div>
  <div class="note" id="106594">  
  <a class="name">
  <strong class="user"><em>Anonymous</em></strong></a><div class="date" title="2011-11-21 07:43"><strong>2 years ago</strong></div>
  <div class="text" id="Hcom106594">
<div class="phpcode"><code><span class="html">
I needed to stream a txt file (here big xml file) to get nodes blockwise. I couldn't find a shorter way. So i did write this class.<br><br>Function: streams a complete file and returns the content between two search strings with their search strings (multi byte safe)<br><br>Hope it helps anyone.<br><br>PS: It lacks any boolean checks / exception handling for non existing files / read errors.<br><br><span class="default">&lt;?php<br></span><span class="comment">/**<br> * Reads txt-files blockwise<br> * Usage:<br>&nbsp; &nbsp; $c_streamFileTxt = new streamFileTxt;<br>&nbsp; &nbsp; $_args = array(<br><br>&nbsp; &nbsp; &nbsp; &nbsp; 'file' =&gt; 'temporary.xml',<br>&nbsp; &nbsp; &nbsp; &nbsp; 'start_string' =&gt; '&lt;Product&gt;',<br>&nbsp; &nbsp; &nbsp; &nbsp; 'stop_string' =&gt; '&lt;/Product&gt;',<br>&nbsp; &nbsp; &nbsp; &nbsp; 'block_size' =&gt; '8192'<br>&nbsp; &nbsp; );<br>&nbsp; &nbsp; <br>&nbsp; &nbsp; $c_streamFileTxt-&gt;setArgs($_args);<br><br>&nbsp; &nbsp; while ($txt_block = $c_streamFileTxt-&gt;getNextBlock())<br>&nbsp; &nbsp; {<br>&nbsp; &nbsp; &nbsp; &nbsp; // use $txt_block for something<br>&nbsp; &nbsp; }<br> */<br><br></span><span class="keyword">class </span><span class="default">streamFileTxt<br></span><span class="keyword">{<br>&nbsp; &nbsp; private </span><span class="default">$handle</span><span class="keyword">;<br>&nbsp; &nbsp; private </span><span class="default">$file</span><span class="keyword">;<br>&nbsp; &nbsp; private </span><span class="default">$file_offset</span><span class="keyword">;<br>&nbsp; &nbsp; private </span><span class="default">$block</span><span class="keyword">;<br>&nbsp; &nbsp; private </span><span class="default">$start_string</span><span class="keyword">;<br>&nbsp; &nbsp; private </span><span class="default">$stop_string</span><span class="keyword">;<br>&nbsp; &nbsp; private </span><span class="default">$block_size</span><span class="keyword">;<br><br>&nbsp; &nbsp; </span><span class="comment">/**<br>&nbsp; &nbsp;&nbsp; * Sett class arguments<br>&nbsp; &nbsp;&nbsp; * @param array $_args<br>&nbsp; &nbsp;&nbsp; */<br>&nbsp; &nbsp; </span><span class="keyword">public function </span><span class="default">setArgs</span><span class="keyword">(</span><span class="default">$_args</span><span class="keyword">)<br>&nbsp; &nbsp; {<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">file </span><span class="keyword">= </span><span class="default">$_args</span><span class="keyword">[</span><span class="string">'file'</span><span class="keyword">];<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">start_string </span><span class="keyword">= </span><span class="default">$_args</span><span class="keyword">[</span><span class="string">'start_string'</span><span class="keyword">];<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">stop_string </span><span class="keyword">= </span><span class="default">$_args</span><span class="keyword">[</span><span class="string">'stop_string'</span><span class="keyword">];<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">block_size </span><span class="keyword">= </span><span class="default">$_args</span><span class="keyword">[</span><span class="string">'block_size'</span><span class="keyword">];<br>&nbsp; &nbsp; }<br><br>&nbsp; &nbsp; </span><span class="comment">/**<br>&nbsp; &nbsp;&nbsp; * Get next textblock within a file<br>&nbsp; &nbsp;&nbsp; * @param void<br>&nbsp; &nbsp;&nbsp; * @return string $textblock<br>&nbsp; &nbsp;&nbsp; */<br>&nbsp; &nbsp; </span><span class="keyword">public function </span><span class="default">getNextBlock</span><span class="keyword">()<br>&nbsp; &nbsp; {<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">openFile</span><span class="keyword">();<br><br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">fseek</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">handle</span><span class="keyword">, </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">file_offset</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$start_string_found </span><span class="keyword">= </span><span class="default">false</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$stop_string_found </span><span class="keyword">= </span><span class="default">false</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; while (!</span><span class="default">feof</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">handle</span><span class="keyword">))<br>&nbsp; &nbsp; &nbsp; &nbsp; {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$txt_block </span><span class="keyword">= </span><span class="default">fread</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">handle</span><span class="keyword">, </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">block_size</span><span class="keyword">);<br><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if (!</span><span class="default">$start_string_found</span><span class="keyword">) </span><span class="comment">// while not start start snippet found<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="keyword">{<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$strpos </span><span class="keyword">= </span><span class="default">mb_strpos</span><span class="keyword">(</span><span class="default">$txt_block</span><span class="keyword">, </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">start_string</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if (</span><span class="default">$strpos </span><span class="keyword">!== </span><span class="default">false</span><span class="keyword">)<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="comment">// cut of first left chunk<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$txt_block </span><span class="keyword">= </span><span class="default">mb_substr</span><span class="keyword">(</span><span class="default">$txt_block</span><span class="keyword">, </span><span class="default">$strpos</span><span class="keyword">, </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">block_size</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$start_string_found </span><span class="keyword">= </span><span class="default">true</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if (</span><span class="default">$start_string_found </span><span class="keyword">&amp;&amp; !</span><span class="default">$stop_string_found</span><span class="keyword">) </span><span class="comment">// start snipped found, looking for stop snippet<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="keyword">{ <br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$strpos </span><span class="keyword">= </span><span class="default">mb_strpos</span><span class="keyword">(</span><span class="default">$txt_block</span><span class="keyword">, </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">stop_string</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if (</span><span class="default">$strpos </span><span class="keyword">!== </span><span class="default">false</span><span class="keyword">)<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$removed_block_size </span><span class="keyword">= </span><span class="default">mb_strlen</span><span class="keyword">(</span><span class="default">$txt_block</span><span class="keyword">) - </span><span class="default">$strpos</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$txt_block </span><span class="keyword">= </span><span class="default">mb_substr</span><span class="keyword">(</span><span class="default">$txt_block</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">$strpos </span><span class="keyword">+ </span><span class="default">mb_strlen</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">stop_string</span><span class="keyword">)); <br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$stop_string_found </span><span class="keyword">= </span><span class="default">true</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">setFileOffset</span><span class="keyword">(</span><span class="default">$removed_block_size</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if (</span><span class="default">$stop_string_found</span><span class="keyword">) </span><span class="comment">// stop-snippet found, keep file offset, return <br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="keyword">{<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">closeFile</span><span class="keyword">();<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; return </span><span class="default">$txt_block</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br>&nbsp; &nbsp; &nbsp; &nbsp; }<br><br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">closeFile</span><span class="keyword">();<br>&nbsp; &nbsp; &nbsp; &nbsp; return </span><span class="default">false</span><span class="keyword">;<br>&nbsp; &nbsp; }<br>&nbsp; &nbsp; <br>&nbsp; &nbsp; </span><span class="comment">/**<br>&nbsp; &nbsp;&nbsp; * Set current file offset and consider the removed block size<br>&nbsp; &nbsp;&nbsp; * current file position = current file offset - removed block size<br>&nbsp; &nbsp;&nbsp; * @param int $removed_block_size<br>&nbsp; &nbsp;&nbsp; */<br>&nbsp; &nbsp; </span><span class="keyword">private function </span><span class="default">setFileOffset</span><span class="keyword">(</span><span class="default">$removed_block_size</span><span class="keyword">)<br>&nbsp; &nbsp; {<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">file_offset </span><span class="keyword">= </span><span class="default">ftell</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">handle</span><span class="keyword">) - </span><span class="default">$removed_block_size</span><span class="keyword">;<br>&nbsp; &nbsp; }<br>&nbsp; &nbsp; <br>&nbsp; &nbsp; </span><span class="comment">/**<br>&nbsp; &nbsp;&nbsp; * close current file<br>&nbsp; &nbsp;&nbsp; * @param void<br>&nbsp; &nbsp;&nbsp; * @return void<br>&nbsp; &nbsp;&nbsp; */<br>&nbsp; &nbsp; </span><span class="keyword">private function </span><span class="default">openFile</span><span class="keyword">()<br>&nbsp; &nbsp; {<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">handle </span><span class="keyword">= </span><span class="default">fopen</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">file</span><span class="keyword">, </span><span class="string">'r'</span><span class="keyword">);<br>&nbsp; &nbsp; }<br>&nbsp; &nbsp; <br>&nbsp; &nbsp; </span><span class="comment">/**<br>&nbsp; &nbsp;&nbsp; * open file<br>&nbsp; &nbsp;&nbsp; * @param void<br>&nbsp; &nbsp;&nbsp; * @return void<br>&nbsp; &nbsp;&nbsp; */<br>&nbsp; &nbsp; </span><span class="keyword">private function </span><span class="default">closeFile</span><span class="keyword">()<br>&nbsp; &nbsp; {<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">fclose</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">handle</span><span class="keyword">);<br>&nbsp; &nbsp; }<br>}</span>
</span>
</code></div>
  </div>
 </div>
  <div class="note" id="106336">  
  <a class="name">
  <strong class="user"><em>kavoshgar3 at gmail dot com</em></strong></a><div class="date" title="2011-10-28 09:06"><strong>2 years ago</strong></div>
  <div class="text" id="Hcom106336">
<div class="phpcode"><code><span class="html">
sometimes we want read file from last line to beginning of file.I use the following.<br><span class="default">&lt;?php<br></span><span class="keyword">function </span><span class="default">read_backward_line</span><span class="keyword">(</span><span class="default">$filename</span><span class="keyword">, </span><span class="default">$lines</span><span class="keyword">, </span><span class="default">$revers </span><span class="keyword">= </span><span class="default">false</span><span class="keyword">)<br>{<br>&nbsp; &nbsp; </span><span class="default">$offset </span><span class="keyword">= -</span><span class="default">1</span><span class="keyword">;<br>&nbsp; &nbsp; </span><span class="default">$c </span><span class="keyword">= </span><span class="string">''</span><span class="keyword">;<br>&nbsp; &nbsp; </span><span class="default">$read </span><span class="keyword">= </span><span class="string">''</span><span class="keyword">;<br>&nbsp; &nbsp; </span><span class="default">$i </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">;<br>&nbsp; &nbsp; </span><span class="default">$fp </span><span class="keyword">= @</span><span class="default">fopen</span><span class="keyword">(</span><span class="default">$filename</span><span class="keyword">, </span><span class="string">"r"</span><span class="keyword">);<br>&nbsp; &nbsp; while( </span><span class="default">$lines </span><span class="keyword">&amp;&amp; </span><span class="default">fseek</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">, </span><span class="default">$offset</span><span class="keyword">, </span><span class="default">SEEK_END</span><span class="keyword">) &gt;= </span><span class="default">0 </span><span class="keyword">) {<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$c </span><span class="keyword">= </span><span class="default">fgetc</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; if(</span><span class="default">$c </span><span class="keyword">== </span><span class="string">"\n" </span><span class="keyword">|| </span><span class="default">$c </span><span class="keyword">== </span><span class="string">"\r"</span><span class="keyword">){<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$lines</span><span class="keyword">--;<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if( </span><span class="default">$revers </span><span class="keyword">){<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$read</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">] = </span><span class="default">strrev</span><span class="keyword">(</span><span class="default">$read</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">]);<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$i</span><span class="keyword">++;<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br>&nbsp; &nbsp; &nbsp; &nbsp; }<br>&nbsp; &nbsp; &nbsp; &nbsp; if( </span><span class="default">$revers </span><span class="keyword">) </span><span class="default">$read</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">] .= </span><span class="default">$c</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; else </span><span class="default">$read </span><span class="keyword">.= </span><span class="default">$c</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$offset</span><span class="keyword">--;<br>&nbsp; &nbsp; }<br>&nbsp; &nbsp; </span><span class="default">fclose </span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">);<br>&nbsp; &nbsp; if( </span><span class="default">$revers </span><span class="keyword">){<br>&nbsp; &nbsp; &nbsp; &nbsp; if(</span><span class="default">$read</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">] == </span><span class="string">"\n" </span><span class="keyword">|| </span><span class="default">$read</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">] == </span><span class="string">"\r"</span><span class="keyword">)<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">array_pop</span><span class="keyword">(</span><span class="default">$read</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; else </span><span class="default">$read</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">] = </span><span class="default">strrev</span><span class="keyword">(</span><span class="default">$read</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">]);<br>&nbsp; &nbsp; &nbsp; &nbsp; return </span><span class="default">implode</span><span class="keyword">(</span><span class="string">''</span><span class="keyword">,</span><span class="default">$read</span><span class="keyword">);<br>&nbsp; &nbsp; }<br>&nbsp; &nbsp; return </span><span class="default">strrev</span><span class="keyword">(</span><span class="default">rtrim</span><span class="keyword">(</span><span class="default">$read</span><span class="keyword">,</span><span class="string">"\n\r"</span><span class="keyword">));<br>}<br></span><span class="comment">//if $revers=false function return-&gt;<br>//line 1000: i am line of 1000<br>//line 1001: and i am line of 1001<br>//line 1002: and i am last line<br>//but if $revers=true function return-&gt;<br>//line 1002: and i am last line<br>//line 1001: and i am line of 1001<br>//line 1000: i am line of 1000<br></span><span class="default">?&gt;<br></span>Enjoy! Mail me if it works!&nbsp; ;-)</span>
</code></div>
  </div>
 </div>
  <div class="note" id="99038">  
  <a class="name">
  <strong class="user"><em>necudeco at gmail dot com</em></strong></a><div class="date" title="2010-07-23 10:31"><strong>4 years ago</strong></div>
  <div class="text" id="Hcom99038">
<div class="phpcode"><code><span class="html">
This a tail php script example for windows system.<br><br><span class="default">&lt;?php<br>$n </span><span class="keyword">= ( isset(</span><span class="default">$_REQUEST</span><span class="keyword">[</span><span class="string">'n'</span><span class="keyword">]) == </span><span class="default">true </span><span class="keyword">)? </span><span class="default">$_REQUEST</span><span class="keyword">[</span><span class="string">'n'</span><span class="keyword">]:</span><span class="default">20</span><span class="keyword">;<br><br></span><span class="default">$offset </span><span class="keyword">= -</span><span class="default">$n </span><span class="keyword">* </span><span class="default">120</span><span class="keyword">;<br><br></span><span class="default">$rs </span><span class="keyword">= </span><span class="default">fopen</span><span class="keyword">(</span><span class="string">'C:/wamp/logs/apache_error.log'</span><span class="keyword">,</span><span class="string">'r'</span><span class="keyword">);<br>if ( </span><span class="default">$rs </span><span class="keyword">=== </span><span class="default">false </span><span class="keyword">)<br>&nbsp; &nbsp; die(</span><span class="string">"No se pudo abrir el archivo de log"</span><span class="keyword">);<br><br></span><span class="default">fseek</span><span class="keyword">(</span><span class="default">$rs</span><span class="keyword">,</span><span class="default">$offset</span><span class="keyword">,</span><span class="default">SEEK_END</span><span class="keyword">);<br><br></span><span class="default">fgets</span><span class="keyword">(</span><span class="default">$rs</span><span class="keyword">);<br>while(!</span><span class="default">feof</span><span class="keyword">(</span><span class="default">$rs</span><span class="keyword">))<br>{<br>&nbsp; &nbsp; </span><span class="default">$buffer </span><span class="keyword">= </span><span class="default">fgets</span><span class="keyword">(</span><span class="default">$rs</span><span class="keyword">);<br>&nbsp; &nbsp; echo </span><span class="default">$buffer</span><span class="keyword">;<br>&nbsp; &nbsp; echo </span><span class="string">"&lt;hr /&gt;"</span><span class="keyword">;<br>}<br><br></span><span class="default">fclose</span><span class="keyword">(</span><span class="default">$rs</span><span class="keyword">);<br></span><span class="default">?&gt;</span>
</span>
</code></div>
  </div>
 </div>
  <div class="note" id="92406">  
  <a class="name">
  <strong class="user"><em>steve at studio831 dot com</em></strong></a><div class="date" title="2009-07-23 01:49"><strong>5 years ago</strong></div>
  <div class="text" id="Hcom92406">
<div class="phpcode"><code><span class="html">
Modified @ben's function to work for files larger than PHP_INT_MAX bytes.
<br>
<br><span class="default">&lt;?php
<br></span><span class="keyword">function </span><span class="default">longTail</span><span class="keyword">(</span><span class="default">$file</span><span class="keyword">, </span><span class="default">$numLines </span><span class="keyword">= </span><span class="default">100</span><span class="keyword">)
<br>{
<br>&nbsp; &nbsp; </span><span class="default">$fp </span><span class="keyword">= </span><span class="default">fopen</span><span class="keyword">(</span><span class="default">$file</span><span class="keyword">, </span><span class="string">"r"</span><span class="keyword">);
<br>&nbsp; &nbsp; </span><span class="default">$chunk </span><span class="keyword">= </span><span class="default">4096</span><span class="keyword">;
<br>&nbsp; &nbsp; </span><span class="default">$fs </span><span class="keyword">= </span><span class="default">sprintf</span><span class="keyword">(</span><span class="string">"%u"</span><span class="keyword">, </span><span class="default">filesize</span><span class="keyword">(</span><span class="default">$file</span><span class="keyword">));
<br>&nbsp; &nbsp; </span><span class="default">$max </span><span class="keyword">= (</span><span class="default">intval</span><span class="keyword">(</span><span class="default">$fs</span><span class="keyword">) == </span><span class="default">PHP_INT_MAX</span><span class="keyword">) ? </span><span class="default">PHP_INT_MAX </span><span class="keyword">: </span><span class="default">filesize</span><span class="keyword">(</span><span class="default">$file</span><span class="keyword">);
<br>
<br>&nbsp; &nbsp; for (</span><span class="default">$len </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">; </span><span class="default">$len </span><span class="keyword">&lt; </span><span class="default">$max</span><span class="keyword">; </span><span class="default">$len </span><span class="keyword">+= </span><span class="default">$chunk</span><span class="keyword">) {
<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$seekSize </span><span class="keyword">= (</span><span class="default">$max </span><span class="keyword">- </span><span class="default">$len </span><span class="keyword">&gt; </span><span class="default">$chunk</span><span class="keyword">) ? </span><span class="default">$chunk </span><span class="keyword">: </span><span class="default">$max </span><span class="keyword">- </span><span class="default">$len</span><span class="keyword">;
<br>
<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">fseek</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">, (</span><span class="default">$len </span><span class="keyword">+ </span><span class="default">$seekSize</span><span class="keyword">) * -</span><span class="default">1</span><span class="keyword">, </span><span class="default">SEEK_END</span><span class="keyword">);
<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$data </span><span class="keyword">= </span><span class="default">fread</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">, </span><span class="default">$seekSize</span><span class="keyword">) . </span><span class="default">$data</span><span class="keyword">;
<br>
<br>&nbsp; &nbsp; &nbsp; &nbsp; if (</span><span class="default">substr_count</span><span class="keyword">(</span><span class="default">$data</span><span class="keyword">, </span><span class="string">"\n"</span><span class="keyword">) &gt;= </span><span class="default">$numLines </span><span class="keyword">+ </span><span class="default">1</span><span class="keyword">) {
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">preg_match</span><span class="keyword">(</span><span class="string">"!(.*?\n){"</span><span class="keyword">.(</span><span class="default">$numLines</span><span class="keyword">).</span><span class="string">"}$!"</span><span class="keyword">, </span><span class="default">$data</span><span class="keyword">, </span><span class="default">$match</span><span class="keyword">);
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">fclose</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">);
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; return </span><span class="default">$match</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">];
<br>&nbsp; &nbsp; &nbsp; &nbsp; }
<br>&nbsp; &nbsp; }
<br>&nbsp; &nbsp; </span><span class="default">fclose</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">);
<br>&nbsp; &nbsp; return </span><span class="default">$data</span><span class="keyword">;
<br>}
<br></span><span class="default">?&gt;</span>
</span>
</code></div>
  </div>
 </div>
  <div class="note" id="90450">  
  <a class="name">
  <strong class="user"><em>Tom Pittlik</em></strong></a><div class="date" title="2009-04-23 12:32"><strong>5 years ago</strong></div>
  <div class="text" id="Hcom90450">
<div class="phpcode"><code><span class="html">
The tail example functions below will return a PHP memory limit error when trying to open large files. Since tail is convenient for opening large logs, here is a function that lets you (provided you have permission):
<br>
<br><span class="default">&lt;?php
<br>
<br></span><span class="keyword">function </span><span class="default">unix_tail</span><span class="keyword">(</span><span class="default">$lines</span><span class="keyword">,</span><span class="default">$file</span><span class="keyword">)
<br>{
<br>&nbsp; &nbsp; </span><span class="default">shell_exec</span><span class="keyword">(</span><span class="string">"tail -n </span><span class="default">$lines</span><span class="string"> </span><span class="default">$file</span><span class="string"> &gt; /tmp/phptail_</span><span class="default">$file</span><span class="string">"</span><span class="keyword">);
<br>&nbsp; &nbsp; </span><span class="default">$output </span><span class="keyword">= </span><span class="default">file_get_contents</span><span class="keyword">(</span><span class="string">"/tmp/phptail_</span><span class="default">$file</span><span class="string">"</span><span class="keyword">);
<br>&nbsp; &nbsp; </span><span class="default">unlink</span><span class="keyword">(</span><span class="string">"/tmp/phptail_</span><span class="default">$file</span><span class="string">"</span><span class="keyword">);
<br>&nbsp; &nbsp; return </span><span class="default">$output</span><span class="keyword">;
<br>}
<br>
<br></span><span class="default">?&gt;</span>
</span>
</code></div>
  </div>
 </div>
  <div class="note" id="82469">  
  <a class="name">
  <strong class="user"><em>Anonymous</em></strong></a><div class="date" title="2008-04-11 10:45"><strong>6 years ago</strong></div>
  <div class="text" id="Hcom82469">
<div class="phpcode"><code><span class="html">
To:seeker at example com<br>Be careful, though. <br>You can freely position you pointer if you open a file in (r+) mode, but it will "overwrite" the data, not "append it".<br><br>Tested this:<br><br><span class="default">&lt;?php<br></span><span class="comment">// file.txt content:<br>// "You can contribute your notes to the PHP manual from the comfort of your browser!"<br><br></span><span class="default">$handler </span><span class="keyword">= </span><span class="default">fopen</span><span class="keyword">(</span><span class="string">"file.txt"</span><span class="keyword">, </span><span class="string">"r+"</span><span class="keyword">);<br></span><span class="default">fseek</span><span class="keyword">(</span><span class="default">$handler</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">);<br></span><span class="default">fwrite</span><span class="keyword">(</span><span class="default">$handler</span><span class="keyword">, </span><span class="string">"want to add this"</span><span class="keyword">);<br></span><span class="default">?&gt;<br></span>New contents of the file.txt will be like this:<br>"want to add thiste your notes to the PHP manual from the comfort of your browser!".<br><br>If you really want to append at the beginning, you have to first get all the contents, save it, clear the file, put the new contents and append the saved contents at the end.</span>
</code></div>
  </div>
 </div>
  <div class="note" id="73503">  
  <a class="name">
  <strong class="user"><em>mhinks at gmail dot com</em></strong></a><div class="date" title="2007-02-26 11:38"><strong>7 years ago</strong></div>
  <div class="text" id="Hcom73503">
<div class="phpcode"><code><span class="html">
Here's a function I wrote to binary search for a line of text within a file, particularly useful when the file is too large to read into memory at once and you want a faster search than linear.<br><br>function binary_search_in_file($filename, $search) {<br><br>&nbsp; &nbsp; //Open the file<br>&nbsp; &nbsp; $fp = fopen($filename, 'r');<br><br>&nbsp; &nbsp; //Seek to the end<br>&nbsp; &nbsp; fseek($fp, 0, SEEK_END);<br><br>&nbsp; &nbsp; //Get the max value<br>&nbsp; &nbsp; $high = ftell($fp);<br>&nbsp; &nbsp; <br>&nbsp; &nbsp; //Set the low value<br>&nbsp; &nbsp; $low = 0;<br><br>&nbsp; &nbsp; while ($low &lt;= $high) { <br>&nbsp; &nbsp; &nbsp; &nbsp; $mid = floor(($low + $high) / 2);&nbsp; // C floors for you<br><br>&nbsp; &nbsp; &nbsp; &nbsp; //Seek to half way through<br>&nbsp; &nbsp; &nbsp; &nbsp; fseek($fp, $mid);<br><br>&nbsp; &nbsp; &nbsp; &nbsp; if($mid != 0){<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; //Read a line to move to eol<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $line = fgets($fp);<br>&nbsp; &nbsp; &nbsp; &nbsp; }<br>&nbsp; &nbsp; &nbsp; &nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; //Read a line to get data<br>&nbsp; &nbsp; &nbsp; &nbsp; $line = fgets($fp);<br>&nbsp; &nbsp; &nbsp; &nbsp; <br><br>&nbsp; &nbsp; &nbsp; &nbsp; if ($line == $search) {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; fclose($fp);<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; return $line;<br>&nbsp; &nbsp; &nbsp; &nbsp; }<br>&nbsp; &nbsp; &nbsp; &nbsp; else {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if ($search &lt; $line) {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $high = $mid - 1;<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; else {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $low = $mid + 1;<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br>&nbsp; &nbsp; &nbsp; &nbsp; }<br>&nbsp; &nbsp; }<br><br>&nbsp; &nbsp; //Close the pointer<br>&nbsp; &nbsp; fclose($fp);<br><br>&nbsp; &nbsp; return FALSE;<br><br>}</span>
</code></div>
  </div>
 </div>
  <div class="note" id="69008">  
  <a class="name">
  <strong class="user"><em>marc dot roe at gmail dot com</em></strong></a><div class="date" title="2006-08-19 09:38"><strong>8 years ago</strong></div>
  <div class="text" id="Hcom69008">
<div class="phpcode"><code><span class="html">
I tried to improve and modify (mail at ulf-kosack dot de)'s function. Actually it is very fast, i.e. requires much less time than to get the last five, ten or whatever lines of a file using file() ore file_get_contents().<br><br>function read_file($file, $lines)<br>{<br>&nbsp; &nbsp; &nbsp;&nbsp; $handle = fopen($file, "r");<br>&nbsp; &nbsp; &nbsp;&nbsp; $linecounter = $lines;<br>&nbsp; &nbsp; &nbsp;&nbsp; $pos = -2;<br>&nbsp; &nbsp; &nbsp;&nbsp; $beginning = false;<br>&nbsp; &nbsp; &nbsp;&nbsp; $text = array();<br>&nbsp; &nbsp; &nbsp;&nbsp; while ($linecounter &gt; 0) {<br>&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $t = " ";<br>&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; while ($t != "\n") {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if(fseek($handle, $pos, SEEK_END) == -1) {<br>$beginning = true; break; }<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $t = fgetc($handle);<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $pos --;<br>&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br>&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $linecounter --;<br>&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if($beginning) rewind($handle);<br>&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $text[$lines-$linecounter-1] = fgets($handle);<br>&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if($beginning break;<br>&nbsp; &nbsp; &nbsp;&nbsp; }<br>&nbsp; &nbsp; &nbsp;&nbsp; fclose ($handle);<br>&nbsp; &nbsp; &nbsp;&nbsp; return array_reverse($text); // array_reverse is optional: you can also just return the $text array which consists of the file's lines. <br>}<br><br>The good thing now is, that you don't get an error when your requesting more lines than the file contains. In this case the function will just return the whole file content.</span>
</code></div>
  </div>
 </div>
  <div class="note" id="66727">  
  <a class="name">
  <strong class="user"><em>mail at ulf-kosack dot de</em></strong></a><div class="date" title="2006-05-27 10:44"><strong>8 years ago</strong></div>
  <div class="text" id="Hcom66727">
<div class="phpcode"><code><span class="html">
Here a little extension for the code of ekow.<br>If you want to read more than one line and more than one file. Some times the last five ore ten lines are interesting in.<br><br>You only have to submit a array with filenames and optionally a number of lines you want to read.<br><br><span class="default">&lt;?php<br>&nbsp; </span><span class="keyword">function </span><span class="default">read_logfiles</span><span class="keyword">(</span><span class="default">$files</span><span class="keyword">, </span><span class="default">$lines</span><span class="keyword">=</span><span class="default">5</span><span class="keyword">) <br>&nbsp; { <br>&nbsp; &nbsp; foreach(</span><span class="default">$files </span><span class="keyword">as </span><span class="default">$file_num </span><span class="keyword">=&gt; </span><span class="default">$file</span><span class="keyword">) {<br>&nbsp; &nbsp; &nbsp; if (</span><span class="default">file_exists </span><span class="keyword">(</span><span class="default">$file</span><span class="keyword">) ) {<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$handle </span><span class="keyword">= </span><span class="default">fopen</span><span class="keyword">(</span><span class="default">$file</span><span class="keyword">, </span><span class="string">"r"</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$linecounter </span><span class="keyword">= </span><span class="default">$lines</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$pos </span><span class="keyword">= -</span><span class="default">2</span><span class="keyword">; <br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$t </span><span class="keyword">= </span><span class="string">" "</span><span class="keyword">;&nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$text</span><span class="keyword">[</span><span class="default">$file_num</span><span class="keyword">] = </span><span class="string">""</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; while (</span><span class="default">$linecounter </span><span class="keyword">&gt; </span><span class="default">0</span><span class="keyword">) {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; while (</span><span class="default">$t </span><span class="keyword">!= </span><span class="string">"\n"</span><span class="keyword">) {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">fseek</span><span class="keyword">(</span><span class="default">$handle</span><span class="keyword">, </span><span class="default">$pos</span><span class="keyword">, </span><span class="default">SEEK_END</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$t </span><span class="keyword">= </span><span class="default">fgetc</span><span class="keyword">(</span><span class="default">$handle</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$pos </span><span class="keyword">--;<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$t </span><span class="keyword">= </span><span class="string">" "</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$text</span><span class="keyword">[</span><span class="default">$file_num</span><span class="keyword">] .= </span><span class="default">fgets</span><span class="keyword">(</span><span class="default">$handle</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$linecounter </span><span class="keyword">--;<br>&nbsp; &nbsp; &nbsp; &nbsp; }<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">fclose </span><span class="keyword">(</span><span class="default">$handle</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; } else {<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$text</span><span class="keyword">[</span><span class="default">$file_num</span><span class="keyword">] = </span><span class="string">"The file doesn't exist."</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; }<br>&nbsp; &nbsp; }<br>&nbsp; &nbsp; <br>&nbsp; &nbsp; return </span><span class="default">$text</span><span class="keyword">;<br></span><span class="default">?&gt;</span>
</span>
</code></div>
  </div>
 </div>
  <div class="note" id="59619">  
  <a class="name">
  <strong class="user"><em>ekow[at]te.ugm.ac.id</em></strong></a><div class="date" title="2005-12-11 05:22"><strong>8 years ago</strong></div>
  <div class="text" id="Hcom59619">
<div class="phpcode"><code><span class="html">
A little correction for code to read last line from chenganeyou at eyou dot com.<br>$linenumber = sizeof($file)-1;<br>should be<br>$linenumber = sizeof($contents)-1;<br>because sizeof will count array element, not file size.<br><span class="default">&lt;?php<br></span><span class="keyword">function </span><span class="default">readlastline</span><span class="keyword">(</span><span class="default">$file</span><span class="keyword">)<br>{<br>&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$linecontent </span><span class="keyword">= </span><span class="string">" "</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$contents </span><span class="keyword">= </span><span class="default">file</span><span class="keyword">(</span><span class="default">$file</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$linenumber </span><span class="keyword">= </span><span class="default">sizeof</span><span class="keyword">(</span><span class="default">$contents</span><span class="keyword">)-</span><span class="default">1</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$linecontet </span><span class="keyword">= </span><span class="default">$contents</span><span class="keyword">[</span><span class="default">$linenumber</span><span class="keyword">];<br>&nbsp; &nbsp; &nbsp;&nbsp; unset(</span><span class="default">$contents</span><span class="keyword">,</span><span class="default">$linenumber</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">$linecontent</span><span class="keyword">;<br>}<br></span><span class="default">?&gt;</span>
</span>
</code></div>
  </div>
 </div>
  <div class="note" id="54199">  
  <a class="name">
  <strong class="user"><em>chenganeyou at eyou dot com</em></strong></a><div class="date" title="2005-06-27 01:35"><strong>9 years ago</strong></div>
  <div class="text" id="Hcom54199">
<div class="phpcode"><code><span class="html">
I use the following codes to read the last line of a file.<br>Compared to jim at lfchosting dot com, it should be more efficient.<br><br><span class="default">&lt;?php<br></span><span class="keyword">function </span><span class="default">readlastline</span><span class="keyword">(</span><span class="default">$file</span><span class="keyword">)<br>{<br>&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$linecontent </span><span class="keyword">= </span><span class="string">" "</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$contents </span><span class="keyword">= </span><span class="default">file</span><span class="keyword">(</span><span class="default">$file</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$linenumber </span><span class="keyword">= </span><span class="default">sizeof</span><span class="keyword">(</span><span class="default">$file</span><span class="keyword">)-</span><span class="default">1</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$linecontet </span><span class="keyword">= </span><span class="default">$contents</span><span class="keyword">[</span><span class="default">$linenumber</span><span class="keyword">];<br>&nbsp; &nbsp; &nbsp;&nbsp; unset(</span><span class="default">$contents</span><span class="keyword">,</span><span class="default">$linenumber</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">$linecontent</span><span class="keyword">;<br>}<br></span><span class="default">?&gt;</span>
</span>
</code></div>
  </div>
 </div>
  <div class="note" id="53220">  
  <a class="name">
  <strong class="user"><em>phil at NOSPAM dot blisswebhosting dot com</em></strong></a><div class="date" title="2005-05-25 08:43"><strong>9 years ago</strong></div>
  <div class="text" id="Hcom53220">
<div class="phpcode"><code><span class="html">
In order to read a text file from end-&gt;beginning e.g display the most recent contents of a log file first.&nbsp; I use the following.<br><br>It basically just uses fseek to find the end of the file, ftell to find the byte count for a counter, then iterates backwards through the file using fgetc to test for the newline charater.<br><br>$i=0 ;<br>$lines=500 ;<br>$fp = fopen($log,"r") ;<br>if(is_resource($fp)){<br>&nbsp; &nbsp; fseek($fp,0,SEEK_END) ;<br>&nbsp; &nbsp; $a = ftell($fp) ;<br>&nbsp; &nbsp; while($i &lt;= $lines){<br>&nbsp; &nbsp; &nbsp; &nbsp; if(fgetc($fp) == "\n"){<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; echo (fgets($fp));<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $i++ ;<br>&nbsp; &nbsp; &nbsp; &nbsp; }<br>&nbsp; &nbsp; fseek($fp,$a) ;<br>&nbsp; &nbsp; $a-- ;<br>&nbsp; &nbsp; }<br>}</span>
</code></div>
  </div>
 </div>
  <div class="note" id="52929">  
  <a class="name">
  <strong class="user"><em>alan at peaceconstitution.com</em></strong></a><div class="date" title="2005-05-17 06:03"><strong>9 years ago</strong></div>
  <div class="text" id="Hcom52929">
<div class="phpcode"><code><span class="html">
Thanks to Dan, whose above comment provided a key to solve the issue of how to append to a file. <br>&nbsp; &nbsp;&nbsp; After, using phpinfo(); I made sure my installation of PHP had the requisite settings mentioned in the text to the manual entry for fopen(), I was puzzled as to why my use of fopen() with the append option 'a' (append option) didn't work. Then I&nbsp; read a comment contributed to Appendix L (<a rel="nofollow" target="_blank">http://us2.php.net/manual/en/wrappers.php</a>) that the append option 'a' for fopen() doesn't work as expected. The writer suggested using the 'w' option instead, which I found did work. But the 'w' option (write option) overwrites everything in the file.<br>&nbsp; &nbsp;&nbsp; The question remained how to accomplish appending. Following Dan's suggestion about the 'r+' option, I tried this, which works fine:<br>&nbsp; &nbsp; &nbsp;&nbsp; $string = "Message to write to log";<br>&nbsp; &nbsp; &nbsp;&nbsp; $filehandle = fopen ("/home/name/sqllogs/phpsqlerr.txt", 'r+');<br>&nbsp; &nbsp; fseek ( $filehandle,0, SEEK_END);<br>&nbsp; &nbsp; fwrite ( $filehandle, $string."\n" );<br>&nbsp; &nbsp; fclose ($filehandle);</span>
</code></div>
  </div>
 </div>
  <div class="note" id="115516">  
  <a class="name">
  <strong class="user"><em>synnus at gmail dot com</em></strong></a><div class="date" title="2014-08-07 03:54"><strong>20 days ago</strong></div>
  <div class="text" id="Hcom115516">
<div class="phpcode"><code><span class="html">
Write Dummy File 4GB in Php 32bits (X86)<br>if you want write more GB File (&gt;4GB), use Php(X64) .<br>this file is created in 0.0041329860687256 second<br><br>CreatFileDummy('data_test.txt',4294967296);<br><br>FUNCTION CreatFileDummy($file_name,$size) {&nbsp; &nbsp; <br>// 32bits 4&nbsp;294&nbsp;967&nbsp;296 bytes MAX Size <br>&nbsp; &nbsp; $f = fopen($file_name, 'wb');<br>&nbsp; &nbsp; if($size &gt;= 1000000000)&nbsp; {<br>&nbsp; &nbsp; &nbsp; &nbsp; $z = ($size / 1000000000);&nbsp; &nbsp; &nbsp; &nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; if (is_float($z))&nbsp; { <br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $z = round($z,0);<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; fseek($f, ( $size - ($z * 1000000000) -1 ), SEEK_END);<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; fwrite($f, "\0");<br>&nbsp; &nbsp; &nbsp; &nbsp; }&nbsp; &nbsp; &nbsp; &nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; while(--$z &gt; -1) {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; fseek($f, 999999999, SEEK_END);<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; fwrite($f, "\0");<br>&nbsp; &nbsp; &nbsp; &nbsp; }<br>&nbsp; &nbsp; } <br>&nbsp; &nbsp; else {<br>&nbsp; &nbsp; &nbsp; &nbsp; fseek($f, $size - 1, SEEK_END);<br>&nbsp; &nbsp; &nbsp; &nbsp; fwrite($f, "\0");<br>&nbsp; &nbsp; }<br>&nbsp; &nbsp; fclose($f);<br><br>Return true;<br>}<br><br>Synx</span>
</code></div>
  </div>
 </div>
  <div class="note" id="37147">  
  <a class="name">
  <strong class="user"><em>jim at lfchosting dot com</em></strong></a><div class="date" title="2003-11-04 06:03"><strong>10 years ago</strong></div>
  <div class="text" id="Hcom37147">
<div class="phpcode"><code><span class="html">
Here is a function that returns the last line of a file.&nbsp; This should be quicker than reading the whole file till you get to the last line.&nbsp; If you want to speed it up a bit, you can set the $pos = some number that is just greater than the line length.&nbsp; The files I was dealing with were various lengths, so this worked for me.
<br>
<br><span class="default">&lt;?php
<br></span><span class="keyword">function </span><span class="default">readlastline</span><span class="keyword">(</span><span class="default">$file</span><span class="keyword">)
<br>{
<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$fp </span><span class="keyword">= @</span><span class="default">fopen</span><span class="keyword">(</span><span class="default">$file</span><span class="keyword">, </span><span class="string">"r"</span><span class="keyword">);
<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$pos </span><span class="keyword">= -</span><span class="default">1</span><span class="keyword">;
<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$t </span><span class="keyword">= </span><span class="string">" "</span><span class="keyword">;
<br>&nbsp; &nbsp; &nbsp; &nbsp; while (</span><span class="default">$t </span><span class="keyword">!= </span><span class="string">"\n"</span><span class="keyword">) {
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">fseek</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">, </span><span class="default">$pos</span><span class="keyword">, </span><span class="default">SEEK_END</span><span class="keyword">);
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$t </span><span class="keyword">= </span><span class="default">fgetc</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">);
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$pos </span><span class="keyword">= </span><span class="default">$pos </span><span class="keyword">- </span><span class="default">1</span><span class="keyword">;
<br>&nbsp; &nbsp; &nbsp; &nbsp; }
<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$t </span><span class="keyword">= </span><span class="default">fgets</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">);
<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">fclose</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">);
<br>&nbsp; &nbsp; &nbsp; &nbsp; return </span><span class="default">$t</span><span class="keyword">;
<br>}
<br></span><span class="default">?&gt;</span>
</span>
</code></div>
  </div>
 </div>
  <div class="note" id="69000">  
  <a class="name">
  <strong class="user"><em>lucky at somnius dot com dot ar</em></strong></a><div class="date" title="2006-08-18 05:35"><strong>8 years ago</strong></div>
  <div class="text" id="Hcom69000">
<div class="phpcode"><code><span class="html">
Jim's (jim at lfchosting dot com) code for the last-line issue is perfect if the file is not empty, or moreover if it has more than one line. However if the file you're using cotains no new-line character at all (i.e. it is empty or it's got one line and only one) the while loop will stuck indefinitely.<br><br>I know this script is meant for big files which would always contain at least several lines, but it would be clever to make the script error-proof.<br><br>Thus, here's a little modification to his code.<br><br><span class="default">&lt;?php<br></span><span class="keyword">function </span><span class="default">readLastLine </span><span class="keyword">(</span><span class="default">$file</span><span class="keyword">) {<br>&nbsp; &nbsp; </span><span class="default">$fp </span><span class="keyword">= @</span><span class="default">fopen</span><span class="keyword">(</span><span class="default">$file</span><span class="keyword">, </span><span class="string">"r"</span><span class="keyword">);<br><br>&nbsp; &nbsp; </span><span class="default">$pos </span><span class="keyword">= -</span><span class="default">1</span><span class="keyword">;<br>&nbsp; &nbsp; </span><span class="default">$t </span><span class="keyword">= </span><span class="string">" "</span><span class="keyword">;<br>&nbsp; &nbsp; while (</span><span class="default">$t </span><span class="keyword">!= </span><span class="string">"\n"</span><span class="keyword">) {<br>&nbsp; &nbsp; &nbsp; &nbsp; if (!</span><span class="default">fseek</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">, </span><span class="default">$pos</span><span class="keyword">, </span><span class="default">SEEK_END</span><span class="keyword">)) { </span><span class="comment">// *** - fseek returns 0 if successfull, and -1 if it has no succes as in seeking a byte outside the file's range<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$t </span><span class="keyword">= </span><span class="default">fgetc</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$pos </span><span class="keyword">= </span><span class="default">$pos </span><span class="keyword">- </span><span class="default">1</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; } else { </span><span class="comment">// ***<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">rewind</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">); </span><span class="comment">// ***<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="keyword">break; </span><span class="comment">// ***<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="keyword">} </span><span class="comment">// ***<br>&nbsp; &nbsp; </span><span class="keyword">}<br>&nbsp; &nbsp; </span><span class="default">$t </span><span class="keyword">= </span><span class="default">fgets</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">);<br>&nbsp; &nbsp; </span><span class="default">fclose</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">);<br>&nbsp; &nbsp; return </span><span class="default">$t</span><span class="keyword">;<br>}<br></span><span class="default">?&gt;<br></span><br>Lines added and/or modified have been marked with "// ***". I hope this helps!<br><br>Regards!</span>
</code></div>
  </div>
 </div></div>

 
</section>    </section><!-- layout-content -->
        


  </div><!-- layout -->
         
  

    
 <!-- External and third party libraries. -->
 







<a id="toTop" href="javascript:;"><span id="toTopHover"></span><img width="40" height="40" alt="To Top" src="../../images/to-top%402x.png"></a>



<!-- Mirrored from php.net/manual/en/function.fseek.php by HTTrack Website Copier/3.x [XR&CO'2013], Thu, 28 Aug 2014 16:04:29 GMT -->


</body></html>