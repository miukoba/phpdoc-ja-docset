<html><!-- Mirrored from php.net/manual/en/function.getmxrr.php by HTTrack Website Copier/3.x [XR&CO'2013], Thu, 28 Aug 2014 16:05:42 GMT --><!-- Added by HTTrack --><head><meta http-equiv="content-type" content="text/html;charset=utf-8"><!-- /Added by HTTrack -->


  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0"> 

  <title>getmxrr</title>

 <link rel="shortcut icon" href="../../favicon.ico">
 <link rel="search" type="application/opensearchdescription+xml" href="http://php.net/phpnetimprovedsearch.src" title="Add PHP.net search">
 <link rel="alternate" type="application/atom+xml" href="http://php.net/releases/feed.php" title="PHP Release feed">
 <link rel="alternate" type="application/atom+xml" href="http://php.net/feed.atom" title="PHP: Hypertext Preprocessor">

 <link rel="canonical" href="function.getmxrr.html">
 <link rel="shorturl" href="http://php.net/getmxrr">
 <link rel="alternate" href="http://php.net/getmxrr" hreflang="x-default">

 <link rel="contents" href="index-2.html">
 <link rel="index" href="ref.network.html">
 <link rel="prev" href="function.gethostname.html">
 <link rel="next" href="function.getprotobyname.html">

 <link rel="alternate" href="function.getmxrr.html" hreflang="en">
 <link rel="alternate" href="http://php.net/manual/pt_BR/function.getmxrr.php" hreflang="pt_BR">
 <link rel="alternate" href="http://php.net/manual/zh/function.getmxrr.php" hreflang="zh">
 <link rel="alternate" href="http://php.net/manual/fr/function.getmxrr.php" hreflang="fr">
 <link rel="alternate" href="http://php.net/manual/de/function.getmxrr.php" hreflang="de">
 <link rel="alternate" href="http://php.net/manual/it/function.getmxrr.php" hreflang="it">
 <link rel="alternate" href="http://php.net/manual/ja/function.getmxrr.php" hreflang="ja">
 <link rel="alternate" href="http://php.net/manual/ro/function.getmxrr.php" hreflang="ro">
 <link rel="alternate" href="http://php.net/manual/ru/function.getmxrr.php" hreflang="ru">
 <link rel="alternate" href="http://php.net/manual/es/function.getmxrr.php" hreflang="es">
 <link rel="alternate" href="http://php.net/manual/tr/function.getmxrr.php" hreflang="tr">

<link rel="stylesheet" type="text/css" href="../../cached8fe1.css?t=1401250819&amp;f=/fonts/Fira/fira.css" media="screen">
<link rel="stylesheet" type="text/css" href="../../cached4b8d.css?t=1404368420&amp;f=/fonts/Font-Awesome/css/fontello.css" media="screen">
<link rel="stylesheet" type="text/css" href="../../cached5065.css?t=1403329232&amp;f=/styles/theme-base.css" media="screen">
<link rel="stylesheet" type="text/css" href="../../cachedc78d.css?t=1401249623&amp;f=/styles/theme-medium.css" media="screen">

 <!--[if lte IE 7]>
 <link rel="stylesheet" type="text/css" href="http://php.net/styles/workarounds.ie7.css" media="screen">
 <![endif]-->

 <!--[if lte IE 8]>
 <script type="text/javascript">
  window.brokenIE = true;
 </script>
 <![endif]-->

 <!--[if lte IE 9]>
 <link rel="stylesheet" type="text/css" href="http://php.net/styles/workarounds.ie9.css" media="screen">
 <![endif]-->

 <!--[if IE]>
 <script type="text/javascript" src="http://php.net/js/ext/html5.js"></script>
 <![endif]-->

 <base>

</head>
<body class="docs " style="">


<div class="headsup"><a href="http://php.net/index.php#id2014-08-28-1">PHP 5.6.0 released</a></div>
<nav id="trick"><div><dl>
<dt><a href="getting-started.html">Getting Started</a></dt>
	<dd><a href="introduction.html">Introduction</a></dd>
	<dd><a href="tutorial.html">A simple tutorial</a></dd>
<dt><a href="langref.html">Language Reference</a></dt>
	<dd><a href="language.basic-syntax.html">Basic syntax</a></dd>
	<dd><a href="language.types.html">Types</a></dd>
	<dd><a href="language.variables.html">Variables</a></dd>
	<dd><a href="language.constants.html">Constants</a></dd>
	<dd><a href="language.expressions.html">Expressions</a></dd>
	<dd><a href="language.operators.html">Operators</a></dd>
	<dd><a href="language.control-structures.html">Control Structures</a></dd>
	<dd><a href="language.functions.html">Functions</a></dd>
	<dd><a href="language.oop5.html">Classes and Objects</a></dd>
	<dd><a href="language.namespaces.html">Namespaces</a></dd>
	<dd><a href="language.exceptions.html">Exceptions</a></dd>
	<dd><a href="language.generators.html">Generators</a></dd>
	<dd><a href="language.references.html">References Explained</a></dd>
	<dd><a href="reserved.variables.html">Predefined Variables</a></dd>
	<dd><a href="reserved.exceptions.html">Predefined Exceptions</a></dd>
	<dd><a href="reserved.interfaces.html">Predefined Interfaces and Classes</a></dd>
	<dd><a href="context.html">Context options and parameters</a></dd>
	<dd><a href="wrappers.html">Supported Protocols and Wrappers</a></dd>
</dl>
<dl>
<dt><a href="security.html">Security</a></dt>
	<dd><a href="security.intro.html">Introduction</a></dd>
	<dd><a href="security.general.html">General considerations</a></dd>
	<dd><a href="security.cgi-bin.html">Installed as CGI binary</a></dd>
	<dd><a href="security.apache.html">Installed as an Apache module</a></dd>
	<dd><a href="security.filesystem.html">Filesystem Security</a></dd>
	<dd><a href="security.database.html">Database Security</a></dd>
	<dd><a href="security.errors.html">Error Reporting</a></dd>
	<dd><a href="security.globals.html">Using Register Globals</a></dd>
	<dd><a href="security.variables.html">User Submitted Data</a></dd>
	<dd><a href="security.magicquotes.html">Magic Quotes</a></dd>
	<dd><a href="security.hiding.html">Hiding PHP</a></dd>
	<dd><a href="security.current.html">Keeping Current</a></dd>
<dt><a href="features.html">Features</a></dt>
	<dd><a href="features.http-auth.html">HTTP authentication with PHP</a></dd>
	<dd><a href="features.cookies.html">Cookies</a></dd>
	<dd><a href="features.sessions.html">Sessions</a></dd>
	<dd><a href="features.xforms.html">Dealing with XForms</a></dd>
	<dd><a href="features.file-upload.html">Handling file uploads</a></dd>
	<dd><a href="features.remote-files.html">Using remote files</a></dd>
	<dd><a href="features.connection-handling.html">Connection handling</a></dd>
	<dd><a href="features.persistent-connections.html">Persistent Database Connections</a></dd>
	<dd><a href="features.safe-mode.html">Safe Mode</a></dd>
	<dd><a href="features.commandline.html">Command line usage</a></dd>
	<dd><a href="features.gc.html">Garbage Collection</a></dd>
	<dd><a href="features.dtrace.html">DTrace Dynamic Tracing</a></dd>
</dl>
<dl>
<dt><a href="funcref.html">Function Reference</a></dt>
	<dd><a href="refs.basic.php.html">Affecting PHP's Behaviour</a></dd>
	<dd><a href="refs.utilspec.audio.html">Audio Formats Manipulation</a></dd>
	<dd><a href="refs.remote.auth.html">Authentication Services</a></dd>
	<dd><a href="refs.utilspec.cmdline.html">Command Line Specific Extensions</a></dd>
	<dd><a href="refs.compression.html">Compression and Archive Extensions</a></dd>
	<dd><a href="refs.creditcard.html">Credit Card Processing</a></dd>
	<dd><a href="refs.crypto.html">Cryptography Extensions</a></dd>
	<dd><a href="refs.database.html">Database Extensions</a></dd>
	<dd><a href="refs.calendar.html">Date and Time Related Extensions</a></dd>
	<dd><a href="refs.fileprocess.file.html">File System Related Extensions</a></dd>
	<dd><a href="refs.international.html">Human Language and Character Encoding Support</a></dd>
	<dd><a href="refs.utilspec.image.html">Image Processing and Generation</a></dd>
	<dd><a href="refs.remote.mail.html">Mail Related Extensions</a></dd>
	<dd><a href="refs.math.html">Mathematical Extensions</a></dd>
	<dd><a href="refs.utilspec.nontext.html">Non-Text MIME Output</a></dd>
	<dd><a href="refs.fileprocess.process.html">Process Control Extensions</a></dd>
	<dd><a href="refs.basic.other.html">Other Basic Extensions</a></dd>
	<dd><a href="refs.remote.other.html">Other Services</a></dd>
	<dd><a href="refs.search.html">Search Engine Extensions</a></dd>
	<dd><a href="refs.utilspec.server.html">Server Specific Extensions</a></dd>
	<dd><a href="refs.basic.session.html">Session Extensions</a></dd>
	<dd><a href="refs.basic.text.html">Text Processing</a></dd>
	<dd><a href="refs.basic.vartype.html">Variable and Type Related Extensions</a></dd>
	<dd><a href="refs.webservice.html">Web Services</a></dd>
	<dd><a href="refs.utilspec.windows.html">Windows Only Extensions</a></dd>
	<dd><a href="refs.xml.html">XML Manipulation</a></dd>
</dl>
<dl>
<dt>Keyboard Shortcuts</dt><dt>?</dt>
<dd>This help</dd>
<dt>j</dt>
<dd>Next menu item</dd>
<dt>k</dt>
<dd>Previous menu item</dd>
<dt>g p</dt>
<dd>Previous man page</dd>
<dt>g n</dt>
<dd>Next man page</dd>
<dt>G</dt>
<dd>Scroll to bottom</dd>
<dt>g g</dt>
<dd>Scroll to top</dd>
<dt>g h</dt>
<dd>Goto homepage</dd>
<dt>g s</dt>
<dd>Goto search<br>(current page)</dd>
<dt>/</dt>
<dd>Focus search box</dd>
</dl></div></nav>
<div id="goto">
    <div class="search">
         <div class="text"></div>
         <div class="results"><ul></ul></div>
   </div>
</div>

  <div id="breadcrumbs" class="row-fluid">
          
              
        <ul class="breadcrumbs-container">
            <li><a href="index-2.html">PHP Manual</a></li>      <li><a href="funcref.html">Function Reference</a></li>      <li><a href="refs.remote.other.html">Other Services</a></li>      <li><a href="book.network.html">Network</a></li>      <li><a href="ref.network.html">Network Functions</a></li>    </ul>
  </div>




<div id="layout">
  <section id="layout-content">
  <div id="function.getmxrr" class="refentry">
 <div class="refnamediv">
  <h1 class="refname">getmxrr</h1>
  <p class="verinfo">(PHP 4, PHP 5)</p><p class="refpurpose"><span class="refname">getmxrr</span> — <span class="dc-title">Get MX records corresponding to a given Internet host name</span></p>

 </div>
 
 <div class="refsect1 description" id="refsect1-function.getmxrr-description">
  <h3 class="title">Description</h3>
  <div class="methodsynopsis dc-description">
   <span class="type">bool</span> <span class="methodname"><strong>getmxrr</strong></span>
    ( <span class="methodparam"><span class="type">string</span> <code class="parameter">$hostname</code></span>
   , <span class="methodparam"><span class="type">array</span> <code class="parameter reference">&amp;$mxhosts</code></span>
   [, <span class="methodparam"><span class="type">array</span> <code class="parameter reference">&amp;$weight</code></span>
  ] )</div>

  <p class="para rdfs-comment">
   Searches DNS for MX records corresponding to 
   <code class="parameter">hostname</code>. 
  </p>
 </div>


 <div class="refsect1 parameters" id="refsect1-function.getmxrr-parameters">
  <h3 class="title">Parameters</h3>
  <p class="para">
   </p><dl>

    
     <dt>
<code class="parameter">hostname</code></dt>

     <dd>

      <p class="para">
       The Internet host name.
      </p>
     </dd>

    
    
     <dt>
<code class="parameter">mxhosts</code></dt>

     <dd>

      <p class="para">
       A list of the MX records found is placed into the array
       <code class="parameter">mxhosts</code>. 
      </p>
     </dd>

    
    
     <dt>
<code class="parameter">weight</code></dt>

     <dd>

      <p class="para">
       If the <code class="parameter">weight</code> array is given, it will be filled
       with the weight information gathered.
      </p>
     </dd>

    
   </dl>

  <p></p>
 </div>


 <div class="refsect1 returnvalues" id="refsect1-function.getmxrr-returnvalues">
  <h3 class="title">Return Values</h3>
  <p class="para">
   Returns <strong><code>TRUE</code></strong> if any records are found; returns <strong><code>FALSE</code></strong> if no records
   were found or if an error occurred.
  </p>
 </div>


 <div class="refsect1 changelog" id="refsect1-function.getmxrr-changelog">
  <h3 class="title">Changelog</h3>
  <p class="para">
   </p><table class="doctable informaltable">
    
     <thead>
      <tr>
       <th>Version</th>
       <th>Description</th>
      </tr>

     </thead>

     <tbody class="tbody">
      <tr>
       <td>5.3.0</td>
       <td>
         This function is now available on Windows platforms.
       </td>
      </tr>

     </tbody>
    
   </table>

  <p></p>
 </div>


 <div class="refsect1 notes" id="refsect1-function.getmxrr-notes">
  <h3 class="title">Notes</h3>
  <blockquote class="note"><p><strong class="note">Note</strong>: 
   </p><p class="para">
    This function should not be used for the purposes of address
    verification.  Only the mailexchangers found in DNS are returned,
    however, according to <a href="http://www.faqs.org/rfcs/rfc2821" class="link external">»&nbsp;RFC 2821</a>
    when no mail exchangers are listed, <code class="parameter">hostname</code>
    itself should be used as the only mail exchanger with a priority of
    <em>0</em>.
   </p>
  <p></p></blockquote>
  <blockquote class="note"><p><strong class="note">Note</strong>: 
   </p><p class="para">
    For compatibility with Windows before this was implemented, then try the
    <a href="http://pear.php.net/" class="link external">»&nbsp;PEAR</a> class
    <a href="http://pear.php.net/package/Net_DNS" class="link external">»&nbsp;Net_DNS</a>.
   </p>
  <p></p></blockquote>
 </div>


 <div class="refsect1 seealso" id="refsect1-function.getmxrr-seealso">
  <h3 class="title">See Also</h3>
  <p class="para">
   </p><ul class="simplelist">
    <li class="member"><span class="function"><a href="function.checkdnsrr.html" class="function" rel="rdfs-seeAlso">checkdnsrr()</a> - Check DNS records corresponding to a given Internet host name or IP address</span></li>
    <li class="member"><span class="function"><a href="function.dns-get-record.html" class="function" rel="rdfs-seeAlso">dns_get_record()</a> - Fetch DNS Resource Records associated with a hostname</span></li>
    <li class="member"><span class="function"><a href="function.gethostbyname.html" class="function" rel="rdfs-seeAlso">gethostbyname()</a> - Get the IPv4 address corresponding to a given Internet host name</span></li>
    <li class="member"><span class="function"><a href="function.gethostbynamel.html" class="function" rel="rdfs-seeAlso">gethostbynamel()</a> - Get a list of IPv4 addresses corresponding to a given Internet host
   name</span></li>
    <li class="member"><span class="function"><a href="function.gethostbyaddr.html" class="function" rel="rdfs-seeAlso">gethostbyaddr()</a> - Get the Internet host name corresponding to a given IP address</span></li>
    <li class="member">the <em>named(8)</em> manual page</li>
   </ul>
  <p></p>
 </div>


</div>
<section id="usernotes">
 <div class="head"><h3 class="title">User Contributed Notes</h3></div><div id="allnotes">
  <div class="note" id="103123">  
  <a class="name">
  <strong class="user"><em>Robert Imhoff</em></strong></a><div class="date" title="2011-03-27 06:21"><strong>3 years ago</strong></div>
  <div class="text" id="Hcom103123">
<div class="phpcode"><code><span class="html">
I tried using getmxrr() to validate the domain portion of email addresses in enquiry submission forms, and there is a curious effect with some top-level domains when checking non-existant domains.<br><br>With sdlkfjsdl.com, since the domain does not exist, getmxrr() returns false, as expected, and the returned mxhosts array is empty.<br><br>But with sdlkfjsdl.gov, getmxrr() returns true,&nbsp; and the returned mxhosts array contains one element: NULL<br><br>With sdlkfjsdl.org, getmxrr() returns true,&nbsp; and the returned mxhosts array contains one element: '0.0.0.0'<br><br>With sdlkfjsdl.co.uk, getmxrr()&nbsp; returns true and supplies one MX record: uk-net-wildcard-null-mx.centralnic.net<br><br>So to validate the email domain, it would seem one has to check the returned mxhosts array to exclude the possibility of mxhosts being returned as NULL, 0.0.0.0 and wildcard ...</span>
</code></div>
  </div>
 </div>
  <div class="note" id="69869">  
  <a class="name">
  <strong class="user"><em>MagicalTux at ooKoo dot org</em></strong></a><div class="date" title="2006-09-24 07:59"><strong>7 years ago</strong></div>
  <div class="text" id="Hcom69869">
<div class="phpcode"><code><span class="html">
If you want to use getmxrr on windows, be careful as choward AT fast DOT net DOT NO SPAM PLZ's function has a security flaw.<br><br>It passes its argument to an external command without escaping it. If you don't validate the input, someone may manage to run nasty things on your system.<br><br>Here's a fixed version (just added escapeshellarg())<br><br><span class="default">&lt;?php<br></span><span class="keyword">function </span><span class="default">getmxrr</span><span class="keyword">(</span><span class="default">$hostname</span><span class="keyword">, &amp;</span><span class="default">$mxhosts</span><span class="keyword">)<br>{<br>&nbsp; &nbsp; </span><span class="default">$mxhosts </span><span class="keyword">= array();<br>&nbsp; &nbsp; </span><span class="default">exec</span><span class="keyword">(</span><span class="string">'%SYSTEMDIRECTORY%\\nslookup.exe -q=mx '</span><span class="keyword">.</span><span class="default">escapeshellarg</span><span class="keyword">(</span><span class="default">$hostname</span><span class="keyword">), </span><span class="default">$result_arr</span><span class="keyword">);<br>&nbsp; &nbsp; foreach(</span><span class="default">$result_arr </span><span class="keyword">as </span><span class="default">$line</span><span class="keyword">)<br>&nbsp; &nbsp; {<br>&nbsp; &nbsp; &nbsp; if (</span><span class="default">preg_match</span><span class="keyword">(</span><span class="string">"/.*mail exchanger = (.*)/"</span><span class="keyword">, </span><span class="default">$line</span><span class="keyword">, </span><span class="default">$matches</span><span class="keyword">))<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$mxhosts</span><span class="keyword">[] = </span><span class="default">$matches</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">];<br>&nbsp; &nbsp; }<br>&nbsp; &nbsp; return( </span><span class="default">count</span><span class="keyword">(</span><span class="default">$mxhosts</span><span class="keyword">) &gt; </span><span class="default">0 </span><span class="keyword">);<br>}</span><span class="comment">//--End of workaround<br><br>//test..<br></span><span class="default">getmxrr</span><span class="keyword">(</span><span class="string">'yahoo.com'</span><span class="keyword">, </span><span class="default">$mxhosts</span><span class="keyword">);<br></span><span class="default">print_r</span><span class="keyword">(</span><span class="default">$mxhosts</span><span class="keyword">);<br></span><span class="default">?&gt;<br></span><br>This way you'll avoid a lot of nasty things ;)</span>
</code></div>
  </div>
 </div>
  <div class="note" id="88033">  
  <a class="name">
  <strong class="user"><em>php [spat] hm2k.org</em></strong></a><div class="date" title="2009-01-06 02:18"><strong>5 years ago</strong></div>
  <div class="text" id="Hcom88033">
<div class="phpcode"><code><span class="html">
I decided to have a bash at this after doing a bit of research...<br><br><span class="default">&lt;?php<br><br></span><span class="comment">// getmxrr() support for Windows by HM2K &lt;php [spat] hm2k.org&gt;<br></span><span class="keyword">function </span><span class="default">win_getmxrr</span><span class="keyword">(</span><span class="default">$hostname</span><span class="keyword">, &amp;</span><span class="default">$mxhosts</span><span class="keyword">, &amp;</span><span class="default">$mxweight</span><span class="keyword">=</span><span class="default">false</span><span class="keyword">) {<br>&nbsp; &nbsp; if (</span><span class="default">strtoupper</span><span class="keyword">(</span><span class="default">substr</span><span class="keyword">(</span><span class="default">PHP_OS</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">3</span><span class="keyword">)) != </span><span class="string">'WIN'</span><span class="keyword">) return;<br>&nbsp; &nbsp; if (!</span><span class="default">is_array </span><span class="keyword">(</span><span class="default">$mxhosts</span><span class="keyword">) ) </span><span class="default">$mxhosts </span><span class="keyword">= array();<br>&nbsp; &nbsp; if (empty(</span><span class="default">$hostname</span><span class="keyword">)) return;<br>&nbsp; &nbsp; </span><span class="default">$exec</span><span class="keyword">=</span><span class="string">'nslookup -type=MX '</span><span class="keyword">.</span><span class="default">escapeshellarg</span><span class="keyword">(</span><span class="default">$hostname</span><span class="keyword">);<br>&nbsp; &nbsp; @</span><span class="default">exec</span><span class="keyword">(</span><span class="default">$exec</span><span class="keyword">, </span><span class="default">$output</span><span class="keyword">);<br>&nbsp; &nbsp; if (empty(</span><span class="default">$output</span><span class="keyword">)) return;<br>&nbsp; &nbsp; </span><span class="default">$i</span><span class="keyword">=-</span><span class="default">1</span><span class="keyword">;<br>&nbsp; &nbsp; foreach (</span><span class="default">$output </span><span class="keyword">as </span><span class="default">$line</span><span class="keyword">) {<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$i</span><span class="keyword">++;<br>&nbsp; &nbsp; &nbsp; &nbsp; if (</span><span class="default">preg_match</span><span class="keyword">(</span><span class="string">"/^</span><span class="default">$hostname</span><span class="string">\tMX preference = ([0-9]+), mail exchanger = (.+)$/i"</span><span class="keyword">, </span><span class="default">$line</span><span class="keyword">, </span><span class="default">$parts</span><span class="keyword">)) {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$mxweight</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">] = </span><span class="default">trim</span><span class="keyword">(</span><span class="default">$parts</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">]);<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$mxhosts</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">] = </span><span class="default">trim</span><span class="keyword">(</span><span class="default">$parts</span><span class="keyword">[</span><span class="default">2</span><span class="keyword">]);<br>&nbsp; &nbsp; &nbsp; &nbsp; }<br>&nbsp; &nbsp; &nbsp; &nbsp; if (</span><span class="default">preg_match</span><span class="keyword">(</span><span class="string">'/responsible mail addr = (.+)$/i'</span><span class="keyword">, </span><span class="default">$line</span><span class="keyword">, </span><span class="default">$parts</span><span class="keyword">)) {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$mxweight</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">] = </span><span class="default">$i</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$mxhosts</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">] = </span><span class="default">trim</span><span class="keyword">(</span><span class="default">$parts</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">]);<br>&nbsp; &nbsp; &nbsp; &nbsp; }<br>&nbsp; &nbsp; }<br>&nbsp; &nbsp; return (</span><span class="default">$i</span><span class="keyword">!=-</span><span class="default">1</span><span class="keyword">);<br>}<br><br></span><span class="comment">// Define<br></span><span class="keyword">if (!</span><span class="default">function_exists</span><span class="keyword">(</span><span class="string">'getmxrr'</span><span class="keyword">)) {<br>&nbsp; &nbsp; function </span><span class="default">getmxrr</span><span class="keyword">(</span><span class="default">$hostname</span><span class="keyword">, &amp;</span><span class="default">$mxhosts</span><span class="keyword">, &amp;</span><span class="default">$mxweight</span><span class="keyword">=</span><span class="default">false</span><span class="keyword">) {<br>&nbsp; &nbsp; &nbsp; &nbsp; return </span><span class="default">win_getmxrr</span><span class="keyword">(</span><span class="default">$hostname</span><span class="keyword">, </span><span class="default">$mxhosts</span><span class="keyword">, </span><span class="default">$mxweight</span><span class="keyword">);<br>&nbsp; &nbsp; }<br>}<br><br></span><span class="comment">/* example */<br><br></span><span class="default">$domain</span><span class="keyword">=</span><span class="string">'php.net'</span><span class="keyword">;<br>echo </span><span class="string">"&lt;pre&gt;"</span><span class="keyword">;<br></span><span class="default">getmxrr</span><span class="keyword">(</span><span class="default">$domain</span><span class="keyword">,</span><span class="default">$mxhosts</span><span class="keyword">,</span><span class="default">$mxweight</span><span class="keyword">);<br></span><span class="default">print_r</span><span class="keyword">(</span><span class="default">$mxhosts</span><span class="keyword">);<br></span><span class="default">print_r</span><span class="keyword">(</span><span class="default">$mxweight</span><span class="keyword">);<br><br></span><span class="default">?&gt;</span>
</span>
</code></div>
  </div>
 </div>
  <div class="note" id="64117">  
  <a class="name">
  <strong class="user"><em>Lennart Poot(www.twing.nl)</em></strong></a><div class="date" title="2006-04-07 12:23"><strong>8 years ago</strong></div>
  <div class="text" id="Hcom64117">
<div class="phpcode"><code><span class="html">
This script validates an e-mail adress using getmxrr and fsockopen<br><br>1. it validates the syntax of the address.<br>2. get MX records by hostname<br>3. connect mail server and verify mailbox(using smtp command RCTP TO:&lt;email&gt;)<br><br>When the function "validate_email([email])" fails connecting the mail server with the highest priority in the MX record it will continue with the second mail server and so on..<br><br>The function "validate_email([email])" returns 0 when it failes one the 3 steps above, it will return 1 otherwise<br><br>Grtz Lennart Poot<br><br>&lt;?<br>function validate_email($email){<br>&nbsp;&nbsp; $mailparts=explode("@",$email);<br>&nbsp;&nbsp; $hostname = $mailparts[1];<br><br>&nbsp;&nbsp; // validate email address syntax<br>&nbsp;&nbsp; $exp = "^[a-z\'0-9]+([._-][a-z\'0-9]+)*@([a-z0-9]+([._-][a-z0-9]+))+$";<br>&nbsp;&nbsp; $b_valid_syntax=eregi($exp, $email);<br><br>&nbsp;&nbsp; // get mx addresses by getmxrr<br>&nbsp;&nbsp; $b_mx_avail=getmxrr( $hostname, $mx_records, $mx_weight );<br>&nbsp;&nbsp; $b_server_found=0;<br><br>&nbsp;&nbsp; if($b_valid_syntax &amp;&amp; $b_mx_avail){<br>&nbsp; &nbsp;&nbsp; // copy mx records and weight into array $mxs<br>&nbsp; &nbsp;&nbsp; $mxs=array();<br><br>&nbsp; &nbsp;&nbsp; for($i=0;$i&lt;count($mx_records);$i++){<br>&nbsp; &nbsp; &nbsp;&nbsp; $mxs[$mx_weight[$i]]=$mx_records[$i];<br>&nbsp; &nbsp;&nbsp; }<br><br>&nbsp; &nbsp;&nbsp; // sort array mxs to get servers with highest prio<br>&nbsp; &nbsp;&nbsp; ksort ($mxs, SORT_NUMERIC );<br>&nbsp; &nbsp;&nbsp; reset ($mxs);<br><br>&nbsp; &nbsp;&nbsp; while (list ($mx_weight, $mx_host) = each ($mxs) ) {<br>&nbsp; &nbsp; &nbsp;&nbsp; if($b_server_found == 0){<br><br>&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; //try connection on port 25<br>&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $fp = @fsockopen($mx_host,25, $errno, $errstr, 2);<br>&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if($fp){<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $ms_resp="";<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; // say HELO to mailserver<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $ms_resp.=send_command($fp, "HELO microsoft.com");<br><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; // initialize sending mail <br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $ms_resp.=send_command($fp, "MAIL FROM:&lt;support@microsoft.com&gt;");<br><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; // try receipent address, will return 250 when ok..<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $rcpt_text=send_command($fp, "RCPT TO:&lt;".$email."&gt;");<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $ms_resp.=$rcpt_text;<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if(substr( $rcpt_text, 0, 3) == "250")<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $b_server_found=1;<br><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; // quit mail server connection<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $ms_resp.=send_command($fp, "QUIT");<br><br>&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; fclose($fp);<br><br>&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br><br>&nbsp; &nbsp; &nbsp;&nbsp; }<br>&nbsp; &nbsp; }<br>&nbsp; }<br>&nbsp; return $b_server_found;<br>}<br><br>function send_command($fp, $out){<br><br>&nbsp; fwrite($fp, $out . "\r\n");<br>&nbsp; return get_data($fp);<br>}<br><br>function get_data($fp){<br>&nbsp; $s="";<br>&nbsp; stream_set_timeout($fp, 2);<br><br>&nbsp; for($i=0;$i&lt;2;$i++)<br>&nbsp; &nbsp; $s.=fgets($fp, 1024);<br><br>&nbsp; return $s;<br>}<br><br>// support windows platforms<br>if (!function_exists ('getmxrr') ) {<br>&nbsp; function getmxrr($hostname, &amp;$mxhosts, &amp;$mxweight) {<br>&nbsp; &nbsp; if (!is_array ($mxhosts) ) {<br>&nbsp; &nbsp; &nbsp; $mxhosts = array ();<br>&nbsp; &nbsp; }<br><br>&nbsp; &nbsp; if (!empty ($hostname) ) {<br>&nbsp; &nbsp; &nbsp; $output = "";<br>&nbsp; &nbsp; &nbsp; @exec ("nslookup.exe -type=MX $hostname.", $output);<br>&nbsp; &nbsp; &nbsp; $imx=-1;<br><br>&nbsp; &nbsp; &nbsp; foreach ($output as $line) {<br>&nbsp; &nbsp; &nbsp; &nbsp; $imx++;<br>&nbsp; &nbsp; &nbsp; &nbsp; $parts = "";<br>&nbsp; &nbsp; &nbsp; &nbsp; if (preg_match ("/^$hostname\tMX preference = ([0-9]+), mail exchanger = (.*)$/", $line, $parts) ) {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $mxweight[$imx] = $parts[1];<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $mxhosts[$imx] = $parts[2];<br>&nbsp; &nbsp; &nbsp; &nbsp; }<br>&nbsp; &nbsp; &nbsp; }<br>&nbsp; &nbsp; &nbsp; return ($imx!=-1);<br>&nbsp; &nbsp; }<br>&nbsp; &nbsp; return false;<br>&nbsp; }<br>}<br><br>?&gt;</span>
</code></div>
  </div>
 </div>
  <div class="note" id="79782">  
  <a class="name">
  <strong class="user"><em>TZ at inpetho dot net</em></strong></a><div class="date" title="2007-12-12 10:35"><strong>6 years ago</strong></div>
  <div class="text" id="Hcom79782">
<div class="phpcode"><code><span class="html">
If greylisting is installed on the mx host then he send a "451 4.7.1 Please try again later"<br><br>My code fragment:<br><br><span class="default">&lt;?php<br></span><span class="comment">//...<br></span><span class="keyword">foreach (</span><span class="default">$mx_records </span><span class="keyword">as </span><span class="default">$mx_host</span><span class="keyword">) {<br>&nbsp; &nbsp; </span><span class="default">$code </span><span class="keyword">= </span><span class="default">CheckMX</span><span class="keyword">(</span><span class="default">$mx_host</span><span class="keyword">, </span><span class="default">$eMail</span><span class="keyword">);<br>&nbsp; &nbsp; if (</span><span class="default">$code </span><span class="keyword">== </span><span class="default">0</span><span class="keyword">)&nbsp; &nbsp; continue; </span><span class="comment">// host not found<br>&nbsp; &nbsp; </span><span class="keyword">if (</span><span class="default">$code </span><span class="keyword">== </span><span class="default">451</span><span class="keyword">)&nbsp; &nbsp; </span><span class="default">$code </span><span class="keyword">= </span><span class="default">CheckMX</span><span class="keyword">(</span><span class="default">$mx_host</span><span class="keyword">, </span><span class="default">$eMail</span><span class="keyword">); </span><span class="comment">// Greylisting<br>&nbsp; &nbsp; </span><span class="keyword">if (</span><span class="default">$code </span><span class="keyword">== </span><span class="default">250</span><span class="keyword">)&nbsp; &nbsp; {<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$ok </span><span class="keyword">= </span><span class="default">true</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; break;<br>&nbsp; &nbsp; }<br>}<br></span><span class="comment">//...<br><br></span><span class="keyword">function </span><span class="default">CheckMX</span><span class="keyword">(</span><span class="default">$mx_host</span><span class="keyword">, </span><span class="default">$eMail</span><span class="keyword">)<br>{<br>&nbsp; &nbsp; </span><span class="default">$code </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">;<br>&nbsp; &nbsp; </span><span class="default">$fp </span><span class="keyword">= @</span><span class="default">fsockopen</span><span class="keyword">(</span><span class="default">$mx_host</span><span class="keyword">, </span><span class="default">25</span><span class="keyword">, </span><span class="default">$errno</span><span class="keyword">, </span><span class="default">$errstr</span><span class="keyword">, </span><span class="default">2</span><span class="keyword">);<br>&nbsp; &nbsp; if (</span><span class="default">$fp</span><span class="keyword">)&nbsp; &nbsp; {<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">send_command</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">, </span><span class="string">'HELO microsoft.com'</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">send_command</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">, </span><span class="string">'MAIL FROM:&lt;support@microsoft.com&gt;'</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$erg </span><span class="keyword">= </span><span class="default">send_command</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">, </span><span class="string">'RCPT TO:&lt;'</span><span class="keyword">.</span><span class="default">$eMail</span><span class="keyword">.</span><span class="string">'&gt;'</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">fclose</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$code </span><span class="keyword">= </span><span class="default">intval</span><span class="keyword">(</span><span class="default">substr</span><span class="keyword">(</span><span class="default">$erg</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">3</span><span class="keyword">));<br>&nbsp; &nbsp; }<br>&nbsp; &nbsp; return </span><span class="default">$code</span><span class="keyword">;<br>}<br></span><span class="comment">//...<br></span><span class="default">?&gt;</span>
</span>
</code></div>
  </div>
 </div>
  <div class="note" id="77751">  
  <a class="name">
  <strong class="user"><em>Jay</em></strong></a><div class="date" title="2007-09-11 04:10"><strong>6 years ago</strong></div>
  <div class="text" id="Hcom77751">
<div class="phpcode"><code><span class="html">
As stated, some of the code listed below will have trouble with multiple equal weights, such as if you query gmail.com. The following code will prevent that by switching the key/values.<br><br><span class="default">&lt;?php<br><br></span><span class="comment">// Get the records<br></span><span class="default">getmxrr</span><span class="keyword">(</span><span class="string">"gmail.com"</span><span class="keyword">, </span><span class="default">$mx_records</span><span class="keyword">, </span><span class="default">$mx_weight</span><span class="keyword">);<br><br></span><span class="comment">// Put the records together in a array we can sort<br></span><span class="keyword">for(</span><span class="default">$i</span><span class="keyword">=</span><span class="default">0</span><span class="keyword">;</span><span class="default">$i</span><span class="keyword">&lt;</span><span class="default">count</span><span class="keyword">(</span><span class="default">$mx_records</span><span class="keyword">);</span><span class="default">$i</span><span class="keyword">++){<br>&nbsp; &nbsp; </span><span class="default">$mxs</span><span class="keyword">[</span><span class="default">$mx_records</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">]] = </span><span class="default">$mx_weight</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">];<br>}<br><br></span><span class="comment">// Sort them<br></span><span class="default">asort </span><span class="keyword">(</span><span class="default">$mxs</span><span class="keyword">);<br><br></span><span class="comment">// Since the keys actually hold the data we want, just put those in an array, called records&nbsp; &nbsp;&nbsp; <br></span><span class="default">$records </span><span class="keyword">= </span><span class="default">array_keys</span><span class="keyword">(</span><span class="default">$mxs</span><span class="keyword">);<br><br></span><span class="comment">// Simply echoes all the stuff in the records array&nbsp; &nbsp;&nbsp; <br></span><span class="keyword">for(</span><span class="default">$i </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">; </span><span class="default">$i </span><span class="keyword">&lt; </span><span class="default">count</span><span class="keyword">(</span><span class="default">$records</span><span class="keyword">); </span><span class="default">$i</span><span class="keyword">++){<br>&nbsp; &nbsp; echo </span><span class="default">$records</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">];<br>&nbsp; &nbsp; echo </span><span class="string">'&lt;br&gt;'</span><span class="keyword">;<br>}<br><br></span><span class="default">?&gt;<br></span><br>If you wanted to get the weight, you would use "array_values($mxs);" instead of "array_keys($mxs);".<br><br>Hope this helps some people.</span>
</code></div>
  </div>
 </div>
  <div class="note" id="70575">  
  <a class="name">
  <strong class="user"><em>tomhutter at web dot de</em></strong></a><div class="date" title="2006-10-20 12:50"><strong>7 years ago</strong></div>
  <div class="text" id="Hcom70575">
<div class="phpcode"><code><span class="html">
Leonardt's code fails with multiple mx records with the same wight. You can easily change this by switching keys and values in the mxs array:<br><br>&nbsp; &nbsp;&nbsp; for($i=0;$i&lt;count($mx_records);$i++){<br>&nbsp; &nbsp; &nbsp;&nbsp; $mxs[$mx_records[$i]] = $mx_weight[$i];<br>&nbsp; &nbsp;&nbsp; }<br><br>&nbsp; &nbsp;&nbsp; arsort ($mxs );<br>&nbsp; &nbsp;&nbsp; reset ($mxs);<br><br>&nbsp; &nbsp; while (list ($mx_host, $mx_weight) = each ($mxs) ) {<br><br>cheers <br><br>Tom</span>
</code></div>
  </div>
 </div>
  <div class="note" id="70401">  
  <a class="name">
  <strong class="user"><em>php dot net at oitc dot com</em></strong></a><div class="date" title="2006-10-14 05:28"><strong>7 years ago</strong></div>
  <div class="text" id="Hcom70401">
<div class="phpcode"><code><span class="html">
This function has some strange side effects when dealing with aliases...<br><br>My function:<br><br>&nbsp; &nbsp; &nbsp; &nbsp; if (getmxrr($fqdn, $mx_records, $mx_weight)) {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; // copy mx records and weight into array $mxs<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; // ignore multiple mx's at the same weight<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; for ($i = 0; $i &lt; count($mx_records); $i++) {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $mxs[$mx_weight[$i]] = $mx_records[$i];<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; // sort array mxs to get servers with highest priority<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ksort ($mxs, SORT_NUMERIC);<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; reset ($mxs);<br>&nbsp; &nbsp; &nbsp; &nbsp; } else {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; // No MX so use A<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $mxs[0]= $fqdn;<br>&nbsp; &nbsp; &nbsp; &nbsp; }<br><br>fails because a $fqdn containing an alias returns a true yet on return both $mx_records and $mx_weight contain nothing!<br><br>The solution until this gets fixed is to replace if (getmxrr($fqdn, $mx_records, $mx_weight)) with<br><br>&nbsp; &nbsp; &nbsp; &nbsp; // Handle aliases etc.<br>&nbsp; &nbsp; &nbsp; &nbsp; if ($result = getmxrr($fqdn, $mx_records, $mx_weight)) {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if(!isset($mx_records) || (count($mx_records) == 0)) $result = false;<br>&nbsp; &nbsp; &nbsp; &nbsp; }<br>&nbsp; &nbsp; &nbsp; &nbsp; // Process MXs<br>&nbsp; &nbsp; &nbsp; &nbsp; if ($result) {<br><br>Hope this helps others....&nbsp; Tom</span>
</code></div>
  </div>
 </div>
  <div class="note" id="56359">  
  <a class="name"><strong class="user"><em>Anonymous</em></strong></a><div class="date" title="2005-08-31 08:16"><strong>8 years ago</strong></div>
  <div class="text" id="Hcom56359">
<div class="phpcode"><code><span class="html">
nice function for validating email-adresses! Take care on "register globals" paramter.<br><br><a rel="nofollow" target="_blank">http://www.zend.com/zend/spotlight/ev12apr.php</a></span>
</code></div>
  </div>
 </div>
  <div class="note" id="53182">  
  <a class="name">
  <strong class="user"><em>richard dot quadling at bandvulc dot co dot uk</em></strong></a><div class="date" title="2005-05-25 02:04"><strong>9 years ago</strong></div>
  <div class="text" id="Hcom53182">
<div class="phpcode"><code><span class="html">
Windows alternative for getmxrr without the need for PEAR.
<br>
<br><span class="default">&lt;?php
<br>define</span><span class="keyword">(</span><span class="string">'DEFAULT_GATEWAY'</span><span class="keyword">, </span><span class="string">'nnn.nnn.nnn.nnn'</span><span class="keyword">);
<br>if (!</span><span class="default">function_exists</span><span class="keyword">(</span><span class="string">'getmxrr'</span><span class="keyword">))
<br>&nbsp; &nbsp; {
<br>&nbsp; &nbsp; </span><span class="comment">/*
<br>&nbsp; &nbsp; &nbsp; &nbsp; This function is a replacement for the missing Windows function getmxrr.
<br>&nbsp; &nbsp; &nbsp; &nbsp; 
<br>&nbsp; &nbsp; &nbsp; &nbsp; The parameters are the same as those for the normal getmxrr function.
<br>&nbsp; &nbsp; &nbsp; &nbsp; 
<br>&nbsp; &nbsp; &nbsp; &nbsp; The steps this function takes are :
<br>&nbsp; &nbsp; &nbsp; &nbsp; 
<br>&nbsp; &nbsp; &nbsp; &nbsp; 1 - Use NSLOOKUP.EXE to get the MX records for the supplied Host.
<br>&nbsp; &nbsp; &nbsp; &nbsp; 2 - Use regular expressions to extract the mail servers and the preference.
<br>&nbsp; &nbsp; &nbsp; &nbsp; 3 - Sort the results by preference.
<br>&nbsp; &nbsp; &nbsp; &nbsp; 4 - Set the return arrays.
<br>&nbsp; &nbsp; &nbsp; &nbsp; 5 - Return true or false.
<br>&nbsp; &nbsp; */
<br>&nbsp; &nbsp; </span><span class="keyword">function </span><span class="default">getmxrr</span><span class="keyword">(</span><span class="default">$s_HostName</span><span class="keyword">, array &amp;</span><span class="default">$a_MXHosts </span><span class="keyword">= </span><span class="default">NULL</span><span class="keyword">, array &amp;</span><span class="default">$a_Weights </span><span class="keyword">= </span><span class="default">NULL</span><span class="keyword">)
<br>&nbsp; &nbsp; &nbsp; &nbsp; {
<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="comment">// Simulate all the required network activity by executing windows' NSLOOKUP.
<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$s_NSLookup </span><span class="keyword">= </span><span class="default">shell_exec</span><span class="keyword">(</span><span class="string">"nslookup -q=mx </span><span class="keyword">{</span><span class="default">$s_HostName</span><span class="keyword">}</span><span class="string"> 2&gt;nul"</span><span class="keyword">);
<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">preg_match_all</span><span class="keyword">(</span><span class="string">"'^.*MX preference = (\d{1,10}), mail exchanger = (.*)$'simU"</span><span class="keyword">, </span><span class="default">$s_NSLookup</span><span class="keyword">, </span><span class="default">$a_MXMatches</span><span class="keyword">);
<br>
<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="comment">// If there is something to return ...
<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="keyword">if (</span><span class="default">count</span><span class="keyword">(</span><span class="default">$a_MXMatches</span><span class="keyword">[</span><span class="default">2</span><span class="keyword">]) &gt; </span><span class="default">0</span><span class="keyword">)
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="comment">// Produce output arrays if they have been requested.
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$i_ArgCount </span><span class="keyword">= </span><span class="default">func_num_args</span><span class="keyword">();
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if (</span><span class="default">$i_ArgCount </span><span class="keyword">&gt; </span><span class="default">1</span><span class="keyword">)
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">array_multisort</span><span class="keyword">(</span><span class="default">$a_MXMatches</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">], </span><span class="default">$a_MXMatches</span><span class="keyword">[</span><span class="default">2</span><span class="keyword">]);
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; switch (</span><span class="default">$i_ArgCount</span><span class="keyword">)
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; case </span><span class="default">3 </span><span class="keyword">:
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$a_Weights </span><span class="keyword">= </span><span class="default">$a_MXMatches</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">];
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; case </span><span class="default">2 </span><span class="keyword">:
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$a_MXHosts </span><span class="keyword">= </span><span class="default">$a_MXMatches</span><span class="keyword">[</span><span class="default">2</span><span class="keyword">];
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; return </span><span class="default">True</span><span class="keyword">;
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }
<br>&nbsp; &nbsp; &nbsp; &nbsp; else
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; return </span><span class="default">False</span><span class="keyword">;
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }
<br>&nbsp; &nbsp; &nbsp; &nbsp; }
<br>&nbsp; &nbsp; }
<br></span><span class="default">?&gt;
<br></span>
<br>You will need to know your default gateway (either it's IP address or its name).
<br>
<br>To do this, run the program IPCONFIG /ALL at a cmd prompt and look for the Default Gateway.
<br>
<br>Then replace the 'nnn.nnn.nnn.nnn' with the address.
<br>
<br>Richard.</span>
</code></div>
  </div>
 </div>
  <div class="note" id="49290">  
  <a class="name">
  <strong class="user"><em>rune dot heggtveit at devzone dot progative dot com</em></strong></a><div class="date" title="2005-01-23 01:02"><strong>9 years ago</strong></div>
  <div class="text" id="Hcom49290">
<div class="phpcode"><code><span class="html">
An other way to do mx-lookup on a windows platform.<br>Rewrote this from an other class i wrote for DNS lookup - so it might be a bit messy - but hope you get the idea.<br><br>Big thanks to the rfc community.<br><br><span class="default">&lt;?php<br><br></span><span class="keyword">class </span><span class="default">mxlookup<br></span><span class="keyword">{<br>&nbsp; &nbsp; &nbsp; var </span><span class="default">$dns_socket </span><span class="keyword">= </span><span class="default">NULL</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; var </span><span class="default">$QNAME </span><span class="keyword">= </span><span class="string">""</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; var </span><span class="default">$dns_packet</span><span class="keyword">= </span><span class="default">NULL</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; var </span><span class="default">$ANCOUNT </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; var </span><span class="default">$cIx </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; var </span><span class="default">$dns_repl_domain</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; var </span><span class="default">$arrMX </span><span class="keyword">= array();<br><br>&nbsp; &nbsp; &nbsp; function </span><span class="default">mxlookup</span><span class="keyword">(</span><span class="default">$domain</span><span class="keyword">, </span><span class="default">$dns</span><span class="keyword">=</span><span class="string">"192.168.2.1"</span><span class="keyword">)<br>&nbsp; &nbsp; &nbsp; {<br>&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">QNAME</span><span class="keyword">(</span><span class="default">$domain</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">pack_dns_packet</span><span class="keyword">();<br>&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$dns_socket </span><span class="keyword">= </span><span class="default">fsockopen</span><span class="keyword">(</span><span class="string">"udp://</span><span class="default">$dns</span><span class="string">"</span><span class="keyword">, </span><span class="default">53</span><span class="keyword">);<br><br>&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">fwrite</span><span class="keyword">(</span><span class="default">$dns_socket</span><span class="keyword">,</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">dns_packet</span><span class="keyword">,</span><span class="default">strlen</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">dns_packet</span><span class="keyword">));<br>&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">dns_reply&nbsp; </span><span class="keyword">= </span><span class="default">fread</span><span class="keyword">(</span><span class="default">$dns_socket</span><span class="keyword">,</span><span class="default">1</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$bytes </span><span class="keyword">= </span><span class="default">stream_get_meta_data</span><span class="keyword">(</span><span class="default">$dns_socket</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">dns_reply </span><span class="keyword">.= </span><span class="default">fread</span><span class="keyword">(</span><span class="default">$dns_socket</span><span class="keyword">,</span><span class="default">$bytes</span><span class="keyword">[</span><span class="string">'unread_bytes'</span><span class="keyword">]);<br>&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">fclose</span><span class="keyword">(</span><span class="default">$dns_socket</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">cIx</span><span class="keyword">=</span><span class="default">6</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">ANCOUNT&nbsp;&nbsp; </span><span class="keyword">= </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">gord</span><span class="keyword">(</span><span class="default">2</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">cIx</span><span class="keyword">+=</span><span class="default">4</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">parse_data</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">dns_repl_domain</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">cIx</span><span class="keyword">+=</span><span class="default">7</span><span class="keyword">;<br><br>&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; for(</span><span class="default">$ic</span><span class="keyword">=</span><span class="default">1</span><span class="keyword">;</span><span class="default">$ic</span><span class="keyword">&lt;=</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">ANCOUNT</span><span class="keyword">;</span><span class="default">$ic</span><span class="keyword">++)<br>&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$QTYPE </span><span class="keyword">= </span><span class="default">ord</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">gdi</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">cIx</span><span class="keyword">));<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if(</span><span class="default">$QTYPE</span><span class="keyword">!==</span><span class="default">15</span><span class="keyword">){print(</span><span class="string">"[MX Record not returned]"</span><span class="keyword">); die();}<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">cIx</span><span class="keyword">+=</span><span class="default">9</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$mxPref </span><span class="keyword">= </span><span class="default">ord</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">gdi</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">cIx</span><span class="keyword">));<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">parse_data</span><span class="keyword">(</span><span class="default">$curmx</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">arrMX</span><span class="keyword">[] = array(</span><span class="string">"MX_Pref" </span><span class="keyword">=&gt; </span><span class="default">$mxPref</span><span class="keyword">, </span><span class="string">"MX" </span><span class="keyword">=&gt; </span><span class="default">$curmx</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">cIx</span><span class="keyword">+=</span><span class="default">3</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br>&nbsp; &nbsp; &nbsp; }<br><br>&nbsp; &nbsp; &nbsp; function </span><span class="default">parse_data</span><span class="keyword">(&amp;</span><span class="default">$retval</span><span class="keyword">)<br>&nbsp; &nbsp; &nbsp; {<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$arName </span><span class="keyword">= array();<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$byte </span><span class="keyword">= </span><span class="default">ord</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">gdi</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">cIx</span><span class="keyword">));<br>&nbsp; &nbsp; &nbsp; &nbsp; while(</span><span class="default">$byte</span><span class="keyword">!==</span><span class="default">0</span><span class="keyword">)<br>&nbsp; &nbsp; &nbsp; &nbsp; {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if(</span><span class="default">$byte</span><span class="keyword">==</span><span class="default">192</span><span class="keyword">) </span><span class="comment">//compressed<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="keyword">{<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$tmpIx </span><span class="keyword">= </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">cIx</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">cIx </span><span class="keyword">= </span><span class="default">ord</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">gdi</span><span class="keyword">(</span><span class="default">$cIx</span><span class="keyword">));<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$tmpName </span><span class="keyword">= </span><span class="default">$retval</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">parse_data</span><span class="keyword">(</span><span class="default">$tmpName</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$retval</span><span class="keyword">=</span><span class="default">$retval</span><span class="keyword">.</span><span class="string">"."</span><span class="keyword">.</span><span class="default">$tmpName</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">cIx </span><span class="keyword">= </span><span class="default">$tmpIx</span><span class="keyword">+</span><span class="default">1</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; return;<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$retval</span><span class="keyword">=</span><span class="string">""</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$bCount </span><span class="keyword">= </span><span class="default">$byte</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; for(</span><span class="default">$b</span><span class="keyword">=</span><span class="default">0</span><span class="keyword">;</span><span class="default">$b</span><span class="keyword">&lt;</span><span class="default">$bCount</span><span class="keyword">;</span><span class="default">$b</span><span class="keyword">++)<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$retval </span><span class="keyword">.= </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">gdi</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">cIx</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$arName</span><span class="keyword">[]=</span><span class="default">$retval</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$byte </span><span class="keyword">= </span><span class="default">ord</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">gdi</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">cIx</span><span class="keyword">));<br>&nbsp; &nbsp; &nbsp;&nbsp; }<br>&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$retval</span><span class="keyword">=</span><span class="default">join</span><span class="keyword">(</span><span class="string">"."</span><span class="keyword">,</span><span class="default">$arName</span><span class="keyword">);<br>&nbsp; &nbsp;&nbsp; }<br><br>&nbsp; &nbsp;&nbsp; function </span><span class="default">gdi</span><span class="keyword">(&amp;</span><span class="default">$cIx</span><span class="keyword">,</span><span class="default">$bytes</span><span class="keyword">=</span><span class="default">1</span><span class="keyword">)<br>&nbsp; &nbsp;&nbsp; {<br>&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">cIx</span><span class="keyword">++;<br>&nbsp; &nbsp; &nbsp;&nbsp; return(</span><span class="default">substr</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">dns_reply</span><span class="keyword">, </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">cIx</span><span class="keyword">-</span><span class="default">1</span><span class="keyword">, </span><span class="default">$bytes</span><span class="keyword">));<br>&nbsp; &nbsp;&nbsp; }<br><br>&nbsp; &nbsp; &nbsp; function </span><span class="default">QNAME</span><span class="keyword">(</span><span class="default">$domain</span><span class="keyword">)<br>&nbsp; &nbsp; &nbsp; {<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$dot_pos </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">; </span><span class="default">$temp </span><span class="keyword">= </span><span class="string">""</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; while(</span><span class="default">$dot_pos</span><span class="keyword">=</span><span class="default">strpos</span><span class="keyword">(</span><span class="default">$domain</span><span class="keyword">,</span><span class="string">"."</span><span class="keyword">))<br>&nbsp; &nbsp; &nbsp; &nbsp; {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$temp&nbsp;&nbsp; </span><span class="keyword">= </span><span class="default">substr</span><span class="keyword">(</span><span class="default">$domain</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">,</span><span class="default">$dot_pos</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$domain </span><span class="keyword">= </span><span class="default">substr</span><span class="keyword">(</span><span class="default">$domain</span><span class="keyword">,</span><span class="default">$dot_pos</span><span class="keyword">+</span><span class="default">1</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">QNAME </span><span class="keyword">.= </span><span class="default">chr</span><span class="keyword">(</span><span class="default">strlen</span><span class="keyword">(</span><span class="default">$temp</span><span class="keyword">)).</span><span class="default">$temp</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; }<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">QNAME </span><span class="keyword">.= </span><span class="default">chr</span><span class="keyword">(</span><span class="default">strlen</span><span class="keyword">(</span><span class="default">$domain</span><span class="keyword">)).</span><span class="default">$domain</span><span class="keyword">.</span><span class="default">chr</span><span class="keyword">(</span><span class="default">0</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; }<br><br>&nbsp; &nbsp; &nbsp; function </span><span class="default">gord</span><span class="keyword">(</span><span class="default">$ln</span><span class="keyword">=</span><span class="default">1</span><span class="keyword">)<br>&nbsp; &nbsp; &nbsp; {<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$reply</span><span class="keyword">=</span><span class="string">""</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; for(</span><span class="default">$i</span><span class="keyword">=</span><span class="default">0</span><span class="keyword">;</span><span class="default">$i</span><span class="keyword">&lt;</span><span class="default">$ln</span><span class="keyword">;</span><span class="default">$i</span><span class="keyword">++){<br>&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$reply</span><span class="keyword">.=</span><span class="default">ord</span><span class="keyword">(</span><span class="default">substr</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">dns_reply</span><span class="keyword">,</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">cIx</span><span class="keyword">,</span><span class="default">1</span><span class="keyword">));<br>&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">cIx</span><span class="keyword">++;<br>&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br><br>&nbsp; &nbsp; &nbsp; &nbsp; return </span><span class="default">$reply</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; }<br><br>&nbsp; &nbsp; &nbsp; function </span><span class="default">pack_dns_packet</span><span class="keyword">()<br>&nbsp; &nbsp; &nbsp; {<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">dns_packet </span><span class="keyword">= </span><span class="default">chr</span><span class="keyword">(</span><span class="default">0</span><span class="keyword">).</span><span class="default">chr</span><span class="keyword">(</span><span class="default">1</span><span class="keyword">).<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">chr</span><span class="keyword">(</span><span class="default">1</span><span class="keyword">).</span><span class="default">chr</span><span class="keyword">(</span><span class="default">0</span><span class="keyword">).<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">chr</span><span class="keyword">(</span><span class="default">0</span><span class="keyword">).</span><span class="default">chr</span><span class="keyword">(</span><span class="default">1</span><span class="keyword">).<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">chr</span><span class="keyword">(</span><span class="default">0</span><span class="keyword">).</span><span class="default">chr</span><span class="keyword">(</span><span class="default">0</span><span class="keyword">).<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">chr</span><span class="keyword">(</span><span class="default">0</span><span class="keyword">).</span><span class="default">chr</span><span class="keyword">(</span><span class="default">0</span><span class="keyword">).<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">chr</span><span class="keyword">(</span><span class="default">0</span><span class="keyword">).</span><span class="default">chr</span><span class="keyword">(</span><span class="default">0</span><span class="keyword">).<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">QNAME</span><span class="keyword">.<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">chr</span><span class="keyword">(</span><span class="default">0</span><span class="keyword">).</span><span class="default">chr</span><span class="keyword">(</span><span class="default">15</span><span class="keyword">).<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">chr</span><span class="keyword">(</span><span class="default">0</span><span class="keyword">).</span><span class="default">chr</span><span class="keyword">(</span><span class="default">1</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; }<br><br>}<br><br></span><span class="default">?&gt;<br></span><br><span class="default">&lt;?php<br><br></span><span class="comment">/* Exampe of use: */<br></span><span class="default">$mx </span><span class="keyword">= new </span><span class="default">mxlookup</span><span class="keyword">(</span><span class="string">"php.net"</span><span class="keyword">);<br><br>print </span><span class="default">$mx</span><span class="keyword">-&gt;</span><span class="default">ANCOUNT</span><span class="keyword">.</span><span class="string">" MX Records\n"</span><span class="keyword">;<br>print </span><span class="string">"Records returned for "</span><span class="keyword">.</span><span class="default">$mx</span><span class="keyword">-&gt;</span><span class="default">dns_repl_domain</span><span class="keyword">.</span><span class="string">":\n&lt;pre&gt;"</span><span class="keyword">;<br></span><span class="default">print_r</span><span class="keyword">(</span><span class="default">$mx</span><span class="keyword">-&gt;</span><span class="default">arrMX</span><span class="keyword">);<br><br></span><span class="default">?&gt;<br></span><br>Return:<br><br>02 MX Records Records returned for php.net:<br><br>Array<br>(<br>&nbsp; &nbsp; [0] =&gt; Array<br>&nbsp; &nbsp; &nbsp; &nbsp; (<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; [MX_Pref] =&gt; 15<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; [MX] =&gt; smtp.osuosl.org<br>&nbsp; &nbsp; &nbsp; &nbsp; )<br><br>&nbsp; &nbsp; [1] =&gt; Array<br>&nbsp; &nbsp; &nbsp; &nbsp; (<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; [MX_Pref] =&gt; 5<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; [MX] =&gt; osu1.php.net<br>&nbsp; &nbsp; &nbsp; &nbsp; )<br><br>)</span>
</code></div>
  </div>
 </div>
  <div class="note" id="48673">  
  <a class="name">
  <strong class="user"><em>siclawrence at gmail dot com</em></strong></a><div class="date" title="2005-01-04 06:43"><strong>9 years ago</strong></div>
  <div class="text" id="Hcom48673">
<div class="phpcode"><code><span class="html">
This code replicates online tools that let you check if an email address is valid. First it checks if the email format is correct, then looks up and prints the mx records. All nicely formatted with fancy words that in the end prints whether the email address valid or invalid.<br><br><span class="default">&lt;?php<br>$email </span><span class="keyword">= </span><span class="string">"email@domain.com"</span><span class="keyword">;<br><br>print(</span><span class="string">"Checking: </span><span class="default">$email</span><span class="string">&lt;br&gt;"</span><span class="keyword">);<br><br>if (</span><span class="default">eregi</span><span class="keyword">(</span><span class="string">"^[_a-z0-9-]+(\.[_a-z0-9-]+)*@[a-z0-9-]+(\.[a-z0-9-]+)+$"</span><span class="keyword">, </span><span class="default">$email</span><span class="keyword">)) {<br><br>&nbsp; &nbsp; print(</span><span class="string">"Format Test: PASSED&lt;br&gt;"</span><span class="keyword">);<br>&nbsp; &nbsp; print(</span><span class="string">"Online host verification Test...&lt;br&gt;&lt;br&gt;"</span><span class="keyword">);<br>&nbsp; &nbsp; print(</span><span class="string">"MX Records for: </span><span class="default">$email</span><span class="string">&lt;br&gt;"</span><span class="keyword">);<br>&nbsp; &nbsp; <br>&nbsp; &nbsp; list(</span><span class="default">$alias</span><span class="keyword">, </span><span class="default">$domain</span><span class="keyword">) = </span><span class="default">split</span><span class="keyword">(</span><span class="string">"@"</span><span class="keyword">, </span><span class="default">$email</span><span class="keyword">); <br>&nbsp; &nbsp; <br>&nbsp; &nbsp; if (</span><span class="default">checkdnsrr</span><span class="keyword">(</span><span class="default">$domain</span><span class="keyword">, </span><span class="string">"MX"</span><span class="keyword">)) {<br>&nbsp; &nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">getmxrr</span><span class="keyword">(</span><span class="default">$domain</span><span class="keyword">, </span><span class="default">$mxhosts</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; foreach(</span><span class="default">$mxhosts </span><span class="keyword">as </span><span class="default">$mxKey </span><span class="keyword">=&gt; </span><span class="default">$mxValue</span><span class="keyword">){<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; print(</span><span class="string">"&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;</span><span class="default">$mxValue</span><span class="string">&lt;br&gt;"</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; }<br>&nbsp; &nbsp; &nbsp; &nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; print(</span><span class="string">"Online host verification Test: PASSED&lt;br&gt;&lt;br&gt;"</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; print(</span><span class="string">"Email Status: VALID"</span><span class="keyword">);<br>&nbsp; &nbsp; <br>&nbsp; &nbsp; } else {<br>&nbsp; &nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; print(</span><span class="string">"&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;No records found.&lt;br&gt;"</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; print(</span><span class="string">"Online host verification Test: FAILED&lt;br&gt;&lt;br&gt;"</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; print(</span><span class="string">"Email Status: INVALID"</span><span class="keyword">);<br>&nbsp; &nbsp; <br>&nbsp; &nbsp; }<br><br>} else {<br><br>&nbsp; &nbsp; print(</span><span class="string">"Format Test: FAILED&lt;br&gt;&lt;br&gt;"</span><span class="keyword">);<br>&nbsp; &nbsp; print(</span><span class="string">"Invalid email address provided.&lt;br&gt;&lt;br&gt;"</span><span class="keyword">);<br>&nbsp; &nbsp; print(</span><span class="string">"Email Status: INVALID"</span><span class="keyword">);<br>&nbsp; &nbsp; <br>}<br></span><span class="default">?&gt;</span>
</span>
</code></div>
  </div>
 </div>
  <div class="note" id="42396">  
  <a class="name">
  <strong class="user"><em>zorlac_man at hotmail dot com</em></strong></a><div class="date" title="2004-05-14 12:15"><strong>10 years ago</strong></div>
  <div class="text" id="Hcom42396">
<div class="phpcode"><code><span class="html">
For some reason this and the other DNS lookup functions seem to be really slow on my Linux box. I've checked several things and have no explanation.<br><br>As a work-around, I gave in and just used a system call to dig:<br><br><span class="default">&lt;?php<br>CheckMX</span><span class="keyword">(</span><span class="string">"fakedomain.org"</span><span class="keyword">);<br></span><span class="default">CheckMX</span><span class="keyword">(</span><span class="string">"hotmail.com"</span><span class="keyword">);<br><br>function </span><span class="default">CheckMX</span><span class="keyword">(</span><span class="default">$domain</span><span class="keyword">) {<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">exec</span><span class="keyword">(</span><span class="string">"dig +short MX " </span><span class="keyword">. </span><span class="default">escapeshellarg</span><span class="keyword">(</span><span class="default">$domain</span><span class="keyword">),</span><span class="default">$ips</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; if(</span><span class="default">$ips</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">] == </span><span class="string">""</span><span class="keyword">) {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; print </span><span class="string">"MX record found for </span><span class="default">$domain</span><span class="string"> not found!\n"</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; return </span><span class="default">FALSE</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; }<br>&nbsp; &nbsp; &nbsp; &nbsp; print </span><span class="string">"MX Record for </span><span class="default">$domain</span><span class="string"> found\n"</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; return </span><span class="default">TRUE</span><span class="keyword">;<br>}<br></span><span class="default">?&gt;<br></span><br>Output:<br><br>MX record found for fakedomain.org not found!<br>MX Record for hotmail.com found<br><br>As someone else pointed out, it is prudent to check to see if the TLD has an IP address if the MX record is not found.</span>
</code></div>
  </div>
 </div>
  <div class="note" id="40236">  
  <a class="name">
  <strong class="user"><em>ng4rrjanbiah at rediffmail dot com</em></strong></a><div class="date" title="2004-02-26 03:11"><strong>10 years ago</strong></div>
  <div class="text" id="Hcom40236">
<div class="phpcode"><code><span class="html">
Here is a better workaround for Windows platform. Tested on Windows XP. Highly impressed by "geoffbrisbine A T y a h o o DOT c o m"'s idea of nslookup usage.<br><br><span class="default">&lt;?php<br></span><span class="keyword">function </span><span class="default">getmxrr</span><span class="keyword">(</span><span class="default">$hostname</span><span class="keyword">, &amp;</span><span class="default">$mxhosts</span><span class="keyword">)<br>{<br>&nbsp;&nbsp; </span><span class="default">$mxhosts </span><span class="keyword">= array();<br>&nbsp;&nbsp; </span><span class="default">exec</span><span class="keyword">(</span><span class="string">'nslookup -type=mx '</span><span class="keyword">.</span><span class="default">$hostname</span><span class="keyword">, </span><span class="default">$result_arr</span><span class="keyword">);<br>&nbsp;&nbsp; foreach(</span><span class="default">$result_arr </span><span class="keyword">as </span><span class="default">$line</span><span class="keyword">) <br>&nbsp; &nbsp; {<br>&nbsp; &nbsp; &nbsp; if (</span><span class="default">preg_match</span><span class="keyword">(</span><span class="string">"/.*mail exchanger = (.*)/"</span><span class="keyword">, </span><span class="default">$line</span><span class="keyword">, </span><span class="default">$matches</span><span class="keyword">)) <br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$mxhosts</span><span class="keyword">[] = </span><span class="default">$matches</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">];<br>&nbsp; &nbsp; }<br>&nbsp;&nbsp; return( </span><span class="default">count</span><span class="keyword">(</span><span class="default">$mxhosts</span><span class="keyword">) &gt; </span><span class="default">0 </span><span class="keyword">);<br>}</span><span class="comment">//--End of workaround<br><br>//test..<br></span><span class="keyword">echo </span><span class="default">getmxrr</span><span class="keyword">(</span><span class="string">'yahoo.com'</span><span class="keyword">, </span><span class="default">$mxhosts</span><span class="keyword">);<br></span><span class="default">print_r</span><span class="keyword">(</span><span class="default">$mxhosts</span><span class="keyword">);<br></span><span class="default">?&gt;<br></span><br>HTH,<br>R. Rajesh Jeba Anbiah</span>
</code></div>
  </div>
 </div>
  <div class="note" id="25472">  
  <a class="name">
  <strong class="user"><em>geoffbrisbine A T  y a h o o  DOT  c o m</em></strong></a><div class="date" title="2002-09-24 09:39"><strong>11 years ago</strong></div>
  <div class="text" id="Hcom25472">
<div class="phpcode"><code><span class="html">
I was pretty disappointed that the Win32 build of PHP doesn't incorporate getmxrr so, since I'm a naive newbie, I decided to hack together my own (and I stress hack).&nbsp; This has been tested on Win 2000 and Win XP.&nbsp; There's no reason this shouldn't work on Win NT but it will not work on Win 9x (you need the nslookup command).&nbsp; It will finish with the array $mx that will be a multidimensional array with the MX preference, host name and ip address. You can do a print_r ( $mx ) to see what it looks like.<br><br>-----------------------------------------------<br><br><span class="default">&lt;?php<br>$command </span><span class="keyword">= </span><span class="string">"nslookup -type=mx yahoo.com"</span><span class="keyword">;<br></span><span class="default">exec </span><span class="keyword">( </span><span class="default">$command</span><span class="keyword">, </span><span class="default">$result </span><span class="keyword">);<br>&nbsp; &nbsp; <br></span><span class="default">$i </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">;<br>while ( list ( </span><span class="default">$key</span><span class="keyword">, </span><span class="default">$value </span><span class="keyword">) = </span><span class="default">each </span><span class="keyword">( </span><span class="default">$result </span><span class="keyword">) ) {<br>&nbsp; &nbsp; if ( </span><span class="default">strstr </span><span class="keyword">( </span><span class="default">$value</span><span class="keyword">, </span><span class="string">"mail exchanger" </span><span class="keyword">) ) { </span><span class="default">$nslookup</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">] = </span><span class="default">$value</span><span class="keyword">; </span><span class="default">$i</span><span class="keyword">++; }<br>}<br>&nbsp; &nbsp; <br>while ( list ( </span><span class="default">$key</span><span class="keyword">, </span><span class="default">$value </span><span class="keyword">) = </span><span class="default">each </span><span class="keyword">( </span><span class="default">$nslookup </span><span class="keyword">) ) {<br>&nbsp; &nbsp; </span><span class="default">$temp </span><span class="keyword">= </span><span class="default">explode </span><span class="keyword">( </span><span class="string">" "</span><span class="keyword">, </span><span class="default">$value </span><span class="keyword">);<br>&nbsp; &nbsp; </span><span class="default">$mx</span><span class="keyword">[</span><span class="default">$key</span><span class="keyword">][</span><span class="default">0</span><span class="keyword">] = </span><span class="default">$temp</span><span class="keyword">[</span><span class="default">3</span><span class="keyword">];<br>&nbsp; &nbsp; </span><span class="default">$mx</span><span class="keyword">[</span><span class="default">$key</span><span class="keyword">][</span><span class="default">1</span><span class="keyword">] = </span><span class="default">$temp</span><span class="keyword">[</span><span class="default">7</span><span class="keyword">];<br>&nbsp; &nbsp; </span><span class="default">$mx</span><span class="keyword">[</span><span class="default">$key</span><span class="keyword">][</span><span class="default">2</span><span class="keyword">] = </span><span class="default">gethostbyname </span><span class="keyword">( </span><span class="default">$temp</span><span class="keyword">[</span><span class="default">7</span><span class="keyword">] );<br>}<br><br>&nbsp; &nbsp; </span><span class="default">array_multisort </span><span class="keyword">( </span><span class="default">$mx </span><span class="keyword">);<br></span><span class="default">?&gt;</span>
</span>
</code></div>
  </div>
 </div>
  <div class="note" id="10675">  
  <a class="name">
  <strong class="user"><em>paul at start dot co dot uk</em></strong></a><div class="date" title="2001-01-16 12:48"><strong>13 years ago</strong></div>
  <div class="text" id="Hcom10675">
<div class="phpcode"><code><span class="html">
Prevent your dns server from 'creating' a valid host name by appending the local domain to incomplete emails by appending to the domain a&nbsp; trailing . both in the pattern match and mx checks:
<br>
<br><span class="default">&lt;?php
<br></span><span class="keyword">if (</span><span class="default">eregi</span><span class="keyword">(</span><span class="string">"^[0-9a-z_]([-_.]?[0-9a-z])*@[0-9a-z][-.0-9a-z]*\\.[a-z]{2,3}[.]?$"</span><span class="keyword">, </span><span class="default">$string</span><span class="keyword">, </span><span class="default">$check</span><span class="keyword">)) { 
<br>&nbsp; &nbsp; </span><span class="default">$host </span><span class="keyword">= </span><span class="default">substr</span><span class="keyword">(</span><span class="default">strstr</span><span class="keyword">(</span><span class="default">$check</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">], </span><span class="string">'@'</span><span class="keyword">), </span><span class="default">1</span><span class="keyword">).</span><span class="string">"."</span><span class="keyword">; 
<br>&nbsp; &nbsp; if ( </span><span class="default">getmxrr</span><span class="keyword">(</span><span class="default">$host</span><span class="keyword">, </span><span class="default">$validate_email_temp</span><span class="keyword">) ) 
<br>&nbsp; &nbsp; &nbsp; &nbsp; return </span><span class="default">TRUE</span><span class="keyword">; 
<br>&nbsp; &nbsp; </span><span class="comment">// THIS WILL CATCH DNSs THAT ARE NOT MX. 
<br>&nbsp; &nbsp; </span><span class="keyword">if(</span><span class="default">checkdnsrr</span><span class="keyword">(</span><span class="default">$host</span><span class="keyword">,</span><span class="string">"ANY"</span><span class="keyword">))
<br>&nbsp; &nbsp; &nbsp; &nbsp; return </span><span class="default">TRUE</span><span class="keyword">; 
<br>}
<br></span><span class="default">?&gt;</span>
</span>
</code></div>
  </div>
 </div>
  <div class="note" id="61773">  
  <a class="name">
  <strong class="user"><em>off at NOSPAM dot abwesend dot de</em></strong></a><div class="date" title="2006-02-11 07:18"><strong>8 years ago</strong></div>
  <div class="text" id="Hcom61773">
<div class="phpcode"><code><span class="html">
Concerning the message by 'rolf at rowi dot net' (do a check on a address containing a subdomain) we could use:<br><br>$email = 'abc@etpc01.trier.fh-rpl.de';<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br>$strDot&nbsp; &nbsp; &nbsp; = '.';<br>$strAfterAt&nbsp; = substr(strstr($email, '@'), 1);<br>$chunks&nbsp; &nbsp; &nbsp; = explode($strDot, $strAfterAt);<br>$cntChunks&nbsp;&nbsp; = count($chunks) - 1;<br><br>$strDomain = $chunks[($cntChunks-1)] . $strDot . $chunks[$cntChunks];<br><br>if (!getmxrr( $strDomain, $mxhosts )) {<br>&nbsp; &nbsp; echo 'Mailserver not found';<br>}<br><br>// $strDomain is set to 'fh-rpl.de';</span>
</code></div>
  </div>
 </div>
  <div class="note" id="49251">  
  <a class="name">
  <strong class="user"><em>rolf at rowi dot net</em></strong></a><div class="date" title="2005-01-21 06:36"><strong>9 years ago</strong></div>
  <div class="text" id="Hcom49251">
<div class="phpcode"><code><span class="html">
Be aware that not just user@example.com ist a valid address, also user@subnet.example.com is valid (but maybe less common). Just got into trouble with this check...<br><br>Rolf</span>
</code></div>
  </div>
 </div>
  <div class="note" id="62745">  
  <a class="name">
  <strong class="user"><em>jeff at pzenix dot com</em></strong></a><div class="date" title="2006-03-08 09:58"><strong>8 years ago</strong></div>
  <div class="text" id="Hcom62745">
<div class="phpcode"><code><span class="html">
I should point out that the below example won't work with some domains (.co.uk, .org.uk, .net.uk for example) because it assumes (possibly incorrectly) that the format is [ DOMAIN ].[ EXT ].</span>
</code></div>
  </div>
 </div></div>

 
</section>    </section><!-- layout-content -->
        


  </div><!-- layout -->
         
  

    
 <!-- External and third party libraries. -->
 







<a id="toTop" href="javascript:;"><span id="toTopHover"></span><img width="40" height="40" alt="To Top" src="../../images/to-top%402x.png"></a>



<!-- Mirrored from php.net/manual/en/function.getmxrr.php by HTTrack Website Copier/3.x [XR&CO'2013], Thu, 28 Aug 2014 16:05:43 GMT -->


</body></html>