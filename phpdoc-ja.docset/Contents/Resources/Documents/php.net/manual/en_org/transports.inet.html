<html><!-- Mirrored from php.net/manual/en/transports.inet.php by HTTrack Website Copier/3.x [XR&CO'2013], Thu, 28 Aug 2014 15:55:44 GMT --><!-- Added by HTTrack --><head><meta http-equiv="content-type" content="text/html;charset=utf-8"><!-- /Added by HTTrack -->


  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0"> 

  <title>Internet Domain: TCP, UDP, SSL, and TLS</title>

 <link rel="shortcut icon" href="../../favicon.ico">
 <link rel="search" type="application/opensearchdescription+xml" href="http://php.net/phpnetimprovedsearch.src" title="Add PHP.net search">
 <link rel="alternate" type="application/atom+xml" href="http://php.net/releases/feed.php" title="PHP Release feed">
 <link rel="alternate" type="application/atom+xml" href="http://php.net/feed.atom" title="PHP: Hypertext Preprocessor">

 <link rel="canonical" href="transports.inet.html">
 <link rel="shorturl" href="transports.inet.html">
 <link rel="alternate" href="transports.inet.html" hreflang="x-default">

 <link rel="contents" href="index-2.html">
 <link rel="index" href="transports.html">
 <link rel="prev" href="transports.html">
 <link rel="next" href="transports.unix.html">

 <link rel="alternate" href="transports.inet.html" hreflang="en">
 <link rel="alternate" href="http://php.net/manual/pt_BR/transports.inet.php" hreflang="pt_BR">
 <link rel="alternate" href="http://php.net/manual/zh/transports.inet.php" hreflang="zh">
 <link rel="alternate" href="http://php.net/manual/fr/transports.inet.php" hreflang="fr">
 <link rel="alternate" href="http://php.net/manual/de/transports.inet.php" hreflang="de">
 <link rel="alternate" href="http://php.net/manual/it/transports.inet.php" hreflang="it">
 <link rel="alternate" href="http://php.net/manual/ja/transports.inet.php" hreflang="ja">
 <link rel="alternate" href="http://php.net/manual/ro/transports.inet.php" hreflang="ro">
 <link rel="alternate" href="http://php.net/manual/ru/transports.inet.php" hreflang="ru">
 <link rel="alternate" href="http://php.net/manual/es/transports.inet.php" hreflang="es">
 <link rel="alternate" href="http://php.net/manual/tr/transports.inet.php" hreflang="tr">

<link rel="stylesheet" type="text/css" href="../../cached8fe1.css?t=1401250819&amp;f=/fonts/Fira/fira.css" media="screen">
<link rel="stylesheet" type="text/css" href="../../cached4b8d.css?t=1404368420&amp;f=/fonts/Font-Awesome/css/fontello.css" media="screen">
<link rel="stylesheet" type="text/css" href="../../cached5065.css?t=1403329232&amp;f=/styles/theme-base.css" media="screen">
<link rel="stylesheet" type="text/css" href="../../cachedc78d.css?t=1401249623&amp;f=/styles/theme-medium.css" media="screen">

 <!--[if lte IE 7]>
 <link rel="stylesheet" type="text/css" href="http://php.net/styles/workarounds.ie7.css" media="screen">
 <![endif]-->

 <!--[if lte IE 8]>
 <script type="text/javascript">
  window.brokenIE = true;
 </script>
 <![endif]-->

 <!--[if lte IE 9]>
 <link rel="stylesheet" type="text/css" href="http://php.net/styles/workarounds.ie9.css" media="screen">
 <![endif]-->

 <!--[if IE]>
 <script type="text/javascript" src="http://php.net/js/ext/html5.js"></script>
 <![endif]-->

 <base>

</head>
<body class="docs " style="">


<div class="headsup"><a href="http://php.net/index.php#id2014-08-28-1">PHP 5.6.0 released</a></div>
<nav id="trick"><div><dl>
<dt><a href="getting-started.html">Getting Started</a></dt>
	<dd><a href="introduction.html">Introduction</a></dd>
	<dd><a href="tutorial.html">A simple tutorial</a></dd>
<dt><a href="langref.html">Language Reference</a></dt>
	<dd><a href="language.basic-syntax.html">Basic syntax</a></dd>
	<dd><a href="language.types.html">Types</a></dd>
	<dd><a href="language.variables.html">Variables</a></dd>
	<dd><a href="language.constants.html">Constants</a></dd>
	<dd><a href="language.expressions.html">Expressions</a></dd>
	<dd><a href="language.operators.html">Operators</a></dd>
	<dd><a href="language.control-structures.html">Control Structures</a></dd>
	<dd><a href="language.functions.html">Functions</a></dd>
	<dd><a href="language.oop5.html">Classes and Objects</a></dd>
	<dd><a href="language.namespaces.html">Namespaces</a></dd>
	<dd><a href="language.exceptions.html">Exceptions</a></dd>
	<dd><a href="language.generators.html">Generators</a></dd>
	<dd><a href="language.references.html">References Explained</a></dd>
	<dd><a href="reserved.variables.html">Predefined Variables</a></dd>
	<dd><a href="reserved.exceptions.html">Predefined Exceptions</a></dd>
	<dd><a href="reserved.interfaces.html">Predefined Interfaces and Classes</a></dd>
	<dd><a href="context.html">Context options and parameters</a></dd>
	<dd><a href="wrappers.html">Supported Protocols and Wrappers</a></dd>
</dl>
<dl>
<dt><a href="security.html">Security</a></dt>
	<dd><a href="security.intro.html">Introduction</a></dd>
	<dd><a href="security.general.html">General considerations</a></dd>
	<dd><a href="security.cgi-bin.html">Installed as CGI binary</a></dd>
	<dd><a href="security.apache.html">Installed as an Apache module</a></dd>
	<dd><a href="security.filesystem.html">Filesystem Security</a></dd>
	<dd><a href="security.database.html">Database Security</a></dd>
	<dd><a href="security.errors.html">Error Reporting</a></dd>
	<dd><a href="security.globals.html">Using Register Globals</a></dd>
	<dd><a href="security.variables.html">User Submitted Data</a></dd>
	<dd><a href="security.magicquotes.html">Magic Quotes</a></dd>
	<dd><a href="security.hiding.html">Hiding PHP</a></dd>
	<dd><a href="security.current.html">Keeping Current</a></dd>
<dt><a href="features.html">Features</a></dt>
	<dd><a href="features.http-auth.html">HTTP authentication with PHP</a></dd>
	<dd><a href="features.cookies.html">Cookies</a></dd>
	<dd><a href="features.sessions.html">Sessions</a></dd>
	<dd><a href="features.xforms.html">Dealing with XForms</a></dd>
	<dd><a href="features.file-upload.html">Handling file uploads</a></dd>
	<dd><a href="features.remote-files.html">Using remote files</a></dd>
	<dd><a href="features.connection-handling.html">Connection handling</a></dd>
	<dd><a href="features.persistent-connections.html">Persistent Database Connections</a></dd>
	<dd><a href="features.safe-mode.html">Safe Mode</a></dd>
	<dd><a href="features.commandline.html">Command line usage</a></dd>
	<dd><a href="features.gc.html">Garbage Collection</a></dd>
	<dd><a href="features.dtrace.html">DTrace Dynamic Tracing</a></dd>
</dl>
<dl>
<dt><a href="funcref.html">Function Reference</a></dt>
	<dd><a href="refs.basic.php.html">Affecting PHP's Behaviour</a></dd>
	<dd><a href="refs.utilspec.audio.html">Audio Formats Manipulation</a></dd>
	<dd><a href="refs.remote.auth.html">Authentication Services</a></dd>
	<dd><a href="refs.utilspec.cmdline.html">Command Line Specific Extensions</a></dd>
	<dd><a href="refs.compression.html">Compression and Archive Extensions</a></dd>
	<dd><a href="refs.creditcard.html">Credit Card Processing</a></dd>
	<dd><a href="refs.crypto.html">Cryptography Extensions</a></dd>
	<dd><a href="refs.database.html">Database Extensions</a></dd>
	<dd><a href="refs.calendar.html">Date and Time Related Extensions</a></dd>
	<dd><a href="refs.fileprocess.file.html">File System Related Extensions</a></dd>
	<dd><a href="refs.international.html">Human Language and Character Encoding Support</a></dd>
	<dd><a href="refs.utilspec.image.html">Image Processing and Generation</a></dd>
	<dd><a href="refs.remote.mail.html">Mail Related Extensions</a></dd>
	<dd><a href="refs.math.html">Mathematical Extensions</a></dd>
	<dd><a href="refs.utilspec.nontext.html">Non-Text MIME Output</a></dd>
	<dd><a href="refs.fileprocess.process.html">Process Control Extensions</a></dd>
	<dd><a href="refs.basic.other.html">Other Basic Extensions</a></dd>
	<dd><a href="refs.remote.other.html">Other Services</a></dd>
	<dd><a href="refs.search.html">Search Engine Extensions</a></dd>
	<dd><a href="refs.utilspec.server.html">Server Specific Extensions</a></dd>
	<dd><a href="refs.basic.session.html">Session Extensions</a></dd>
	<dd><a href="refs.basic.text.html">Text Processing</a></dd>
	<dd><a href="refs.basic.vartype.html">Variable and Type Related Extensions</a></dd>
	<dd><a href="refs.webservice.html">Web Services</a></dd>
	<dd><a href="refs.utilspec.windows.html">Windows Only Extensions</a></dd>
	<dd><a href="refs.xml.html">XML Manipulation</a></dd>
</dl>
<dl>
<dt>Keyboard Shortcuts</dt><dt>?</dt>
<dd>This help</dd>
<dt>j</dt>
<dd>Next menu item</dd>
<dt>k</dt>
<dd>Previous menu item</dd>
<dt>g p</dt>
<dd>Previous man page</dd>
<dt>g n</dt>
<dd>Next man page</dd>
<dt>G</dt>
<dd>Scroll to bottom</dd>
<dt>g g</dt>
<dd>Scroll to top</dd>
<dt>g h</dt>
<dd>Goto homepage</dd>
<dt>g s</dt>
<dd>Goto search<br>(current page)</dd>
<dt>/</dt>
<dd>Focus search box</dd>
</dl></div></nav>
<div id="goto">
    <div class="search">
         <div class="text"></div>
         <div class="results"><ul></ul></div>
   </div>
</div>

  <div id="breadcrumbs" class="row-fluid">
          
              
        <ul class="breadcrumbs-container">
            <li><a href="index-2.html">PHP Manual</a></li>      <li><a href="appendices.html">Appendices</a></li>      <li><a href="transports.html">List of Supported Socket Transports</a></li>    </ul>
  </div>




<div id="layout">
  <section id="layout-content">
  <div id="transports.inet" class="section">
  <h2 class="title">Internet Domain: TCP, UDP, SSL, and TLS</h2>
  <p class="simpara">
   PHP 4, PHP 5.
   <em>ssl://</em> &amp; <em>tls://</em> since PHP 4.3.0
   <em>sslv2://</em> &amp; <em>sslv3://</em> since PHP 5.0.2
  </p>

  <blockquote class="note"><p><strong class="note">Note</strong>: 
   <span class="simpara">
    If no transport is specified, <em>tcp://</em> will be assumed.
   </span>
  </p></blockquote>

  <ul class="itemizedlist">
   <li class="listitem"><span class="simpara"><em>127.0.0.1</em></span></li>
   <li class="listitem"><span class="simpara"><em>fe80::1</em></span></li>
   <li class="listitem"><span class="simpara"><em>www.example.com</em></span></li>
   <li class="listitem"><span class="simpara"><em>tcp://127.0.0.1</em></span></li>
   <li class="listitem"><span class="simpara"><em>tcp://fe80::1</em></span></li>
   <li class="listitem"><span class="simpara"><em>tcp://www.example.com</em></span></li>
   <li class="listitem"><span class="simpara"><em>udp://www.example.com</em></span></li>
   <li class="listitem"><span class="simpara"><em>ssl://www.example.com</em></span></li>
   <li class="listitem"><span class="simpara"><em>sslv2://www.example.com</em></span></li>
   <li class="listitem"><span class="simpara"><em>sslv3://www.example.com</em></span></li>
   <li class="listitem"><span class="simpara"><em>tls://www.example.com</em></span></li>
  </ul>

  <p class="simpara">
   Internet Domain sockets expect a port number in addition
   to a target address.  In the case of <span class="function"><a href="function.fsockopen.html" class="function">fsockopen()</a></span>
   this is specified in a second parameter and therefore does
   not impact the formatting of transport URL.  With
   <span class="function"><a href="function.stream-socket-client.html" class="function">stream_socket_client()</a></span> and related functions
   as with traditional URLs however, the port number is specified
   as a suffix of the transport URL delimited by a colon.
  </p>

  <ul class="itemizedlist">
   <li class="listitem"><span class="simpara"><em>tcp://127.0.0.1:80</em></span></li>
   <li class="listitem"><span class="simpara"><em>tcp://[fe80::1]:80</em></span></li>
   <li class="listitem"><span class="simpara"><em>tcp://www.example.com:80</em></span></li>
  </ul>

  <blockquote class="note"><p><strong class="note">Note</strong>: 
   <strong>IPv6 numeric addresses with port numbers</strong><br>
   <span class="simpara">
    In the second example above, while the IPv4 and hostname
    examples are left untouched apart from the addition of 
    their colon and portnumber, the IPv6 address is wrapped in
    square brackets: <em>[fe80::1]</em>.  This is to
    distinguish between the colons used in an IPv6 address and
    the colon used to delimit the portnumber.
   </span>
  </p></blockquote>

  <p class="simpara">
   The <em>ssl://</em> and <em>tls://</em> transports 
   (available only when openssl support is compiled into PHP) are extensions 
   of the <em>tcp://</em> transport which include SSL encryption.
   Since PHP 4.3.0 OpenSSL support must be statically 
   compiled into PHP, since PHP 5.0.0
   it may be compiled as a module or statically.
  </p>

  <p class="simpara">
   <em>ssl://</em> will attempt to negotiate an SSL V2,
   or SSL V3 connection depending on the capabilities and preferences
   of the remote host.  <em>sslv2://</em> and 
   <em>sslv3://</em> will select the SSL V2 or SSL V3
   protocol explicitly.
  </p>
 </div>
<section id="usernotes">
 <div class="head"><h3 class="title">User Contributed Notes</h3></div><div id="allnotes">
  <div class="note" id="113244">  
  <a class="name">
  <strong class="user"><em>christian at lantian dot eu</em></strong></a><div class="date" title="2013-09-17 12:46"><strong>11 months ago</strong></div>
  <div class="text" id="Hcom113244">
<div class="phpcode"><code><span class="html">
@pablo dot livardo&nbsp; :&nbsp; I think that the problem you found is caused by the difference between the client/server encryption methods used.<br><br>The 465 port is used for SMTPS, and the server starts the encryption immediately it receives your connection. So, your code will work.<br><br>The 587 port is used for Submission (MSA or Mail Submission Agent) which works like the port 25. The server accepts your connection and doesn't activate the encryption. If you want an encrypted connection on the port 587, you must connect on it without encryption, you must start to dialog with the server (with EHLO) and after that you must ask the server to start the encrypted connection using the STARTTLS command. The server starts the encryption and now you can start as well the encryption on your client. <br><br>So, in few words, you can not use : <br><br><span class="default">&lt;?php $fp </span><span class="keyword">= </span><span class="default">fsockopen</span><span class="keyword">(</span><span class="string">"tls://mail.example.com"</span><span class="keyword">, </span><span class="default">587</span><span class="keyword">, </span><span class="default">$errno</span><span class="keyword">, </span><span class="default">$errstr</span><span class="keyword">);&nbsp; </span><span class="default">?&gt;</span>&nbsp; <br><br>but you can use:<br><br> <span class="default">&lt;?php $fp </span><span class="keyword">= </span><span class="default">stream_socket_client</span><span class="keyword">(</span><span class="string">"mail.example.com:587"</span><span class="keyword">, </span><span class="default">$errno</span><span class="keyword">, </span><span class="default">$errstr</span><span class="keyword">); </span><span class="default">?&gt;</span>&nbsp; <br><br>and after you send the STARTTLS command, you can enable the crypto:<br><br><span class="default">&lt;?php stream_socket_enable_crypto</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">, </span><span class="default">true</span><span class="keyword">, </span><span class="default">STREAM_CRYPTO_METHOD_SSLv23_CLIENT</span><span class="keyword">); </span><span class="default">?&gt;<br></span><br>P.S. My previous note on this page was totally wrong, so I ask the php.net admin to remove it.<br><br>:)</span>
</code></div>
  </div>
 </div>
  <div class="note" id="99503">  
  <a class="name">
  <strong class="user"><em>stefan at example dot com</em></strong></a><div class="date" title="2010-08-20 05:42"><strong>4 years ago</strong></div>
  <div class="text" id="Hcom99503">
<div class="phpcode"><code><span class="html">
Actually, PHP is very able to start with an unencrypted connection and then switch to an encrypted one - refer to <a rel="nofollow" target="_blank">http://php.net/stream_socket_enable_crypto</a> .</span>
</code></div>
  </div>
 </div>
  <div class="note" id="95022">  
  <a class="name">
  <strong class="user"><em>pablo dot livardo at gmail dot com</em></strong></a><div class="date" title="2009-12-09 09:56"><strong>4 years ago</strong></div>
  <div class="text" id="Hcom95022">
<div class="phpcode"><code><span class="html">
I've been having a problem with a TLS connection.
<br>
<br><span class="default">&lt;?php
<br>$fp </span><span class="keyword">= </span><span class="default">fsockopen</span><span class="keyword">(</span><span class="string">"tls://mail.example.com"</span><span class="keyword">, </span><span class="default">587</span><span class="keyword">, </span><span class="default">$errno</span><span class="keyword">, </span><span class="default">$errstr</span><span class="keyword">);
<br></span><span class="default">?&gt;
<br></span>
<br>Which gives me an error of:
<br>
<br>SSL operation failed with code 1. OpenSSL Error messages: error:1408F10B:SSL routines:SSL3_GET_RECORD:wrong version number
<br>
<br>I believe this is caused by PHP not being able to start with an unencrypted connection and then switch to encryption even though the functionality is built into OpenSSL.
<br>
<br>For Google Mail users you can avoid this by using port 465 instead of 587.</span>
</code></div>
  </div>
 </div>
  <div class="note" id="113239">  
  <a class="name">
  <strong class="user"><em>christian at lantian dot eu</em></strong></a><div class="date" title="2013-09-16 08:17"><strong>11 months ago</strong></div>
  <div class="text" id="Hcom113239">
<div class="phpcode"><code><span class="html">
@pablo dot livardo&nbsp; :&nbsp; I think that the problem you found is caused by the difference between the client/server encryption methods used.<br><br>You tried to access the port 587 using TLS encryption, but the server uses the SSLv3 encryption on this port.<br><br>You can communicate with the Google server on port 465 because on this port the communication is encrypted using TLS and your client is configured to recognize the TLS.<br><br>So, if you want to connect on the Google server over the port 587, you simply must write:<br><br><span class="default">&lt;?php <br>$fp </span><span class="keyword">= </span><span class="default">fsockopen</span><span class="keyword">(</span><span class="string">"ssl://mail.example.com"</span><span class="keyword">, </span><span class="default">587</span><span class="keyword">, </span><span class="default">$errno</span><span class="keyword">, </span><span class="default">$errstr</span><span class="keyword">); <br></span><span class="default">?&gt;</span> <br><br>instead of:<br><br><span class="default">&lt;?php <br>$fp </span><span class="keyword">= </span><span class="default">fsockopen</span><span class="keyword">(</span><span class="string">"tls://mail.example.com"</span><span class="keyword">, </span><span class="default">587</span><span class="keyword">, </span><span class="default">$errno</span><span class="keyword">, </span><span class="default">$errstr</span><span class="keyword">); <br></span><span class="default">?&gt;</span> <br><br>:)</span>
</code></div>
  </div>
 </div></div>

 
</section>    </section><!-- layout-content -->
        


  </div><!-- layout -->
         
  

    
 <!-- External and third party libraries. -->
 







<a id="toTop" href="javascript:;"><span id="toTopHover"></span><img width="40" height="40" alt="To Top" src="../../images/to-top%402x.png"></a>



<!-- Mirrored from php.net/manual/en/transports.inet.php by HTTrack Website Copier/3.x [XR&CO'2013], Thu, 28 Aug 2014 15:55:44 GMT -->


</body></html>