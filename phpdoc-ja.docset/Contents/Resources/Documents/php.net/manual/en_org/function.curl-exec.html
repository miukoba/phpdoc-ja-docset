<html><!-- Mirrored from php.net/manual/en/function.curl-exec.php by HTTrack Website Copier/3.x [XR&CO'2013], Thu, 28 Aug 2014 15:59:22 GMT --><!-- Added by HTTrack --><head><meta http-equiv="content-type" content="text/html;charset=utf-8"><!-- /Added by HTTrack -->


  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0"> 

  <title>curl_exec</title>

 <link rel="shortcut icon" href="../../favicon.ico">
 <link rel="search" type="application/opensearchdescription+xml" href="http://php.net/phpnetimprovedsearch.src" title="Add PHP.net search">
 <link rel="alternate" type="application/atom+xml" href="http://php.net/releases/feed.php" title="PHP Release feed">
 <link rel="alternate" type="application/atom+xml" href="http://php.net/feed.atom" title="PHP: Hypertext Preprocessor">

 <link rel="canonical" href="function.curl-exec.html">
 <link rel="shorturl" href="http://php.net/curl-exec">
 <link rel="alternate" href="http://php.net/curl-exec" hreflang="x-default">

 <link rel="contents" href="index-2.html">
 <link rel="index" href="ref.curl.html">
 <link rel="prev" href="function.curl-escape.html">
 <link rel="next" href="function.curl-file-create.html">

 <link rel="alternate" href="function.curl-exec.html" hreflang="en">
 <link rel="alternate" href="http://php.net/manual/pt_BR/function.curl-exec.php" hreflang="pt_BR">
 <link rel="alternate" href="http://php.net/manual/zh/function.curl-exec.php" hreflang="zh">
 <link rel="alternate" href="http://php.net/manual/fr/function.curl-exec.php" hreflang="fr">
 <link rel="alternate" href="http://php.net/manual/de/function.curl-exec.php" hreflang="de">
 <link rel="alternate" href="http://php.net/manual/it/function.curl-exec.php" hreflang="it">
 <link rel="alternate" href="http://php.net/manual/ja/function.curl-exec.php" hreflang="ja">
 <link rel="alternate" href="http://php.net/manual/ro/function.curl-exec.php" hreflang="ro">
 <link rel="alternate" href="http://php.net/manual/ru/function.curl-exec.php" hreflang="ru">
 <link rel="alternate" href="http://php.net/manual/es/function.curl-exec.php" hreflang="es">
 <link rel="alternate" href="http://php.net/manual/tr/function.curl-exec.php" hreflang="tr">

<link rel="stylesheet" type="text/css" href="../../cached8fe1.css?t=1401250819&amp;f=/fonts/Fira/fira.css" media="screen">
<link rel="stylesheet" type="text/css" href="../../cached4b8d.css?t=1404368420&amp;f=/fonts/Font-Awesome/css/fontello.css" media="screen">
<link rel="stylesheet" type="text/css" href="../../cached5065.css?t=1403329232&amp;f=/styles/theme-base.css" media="screen">
<link rel="stylesheet" type="text/css" href="../../cachedc78d.css?t=1401249623&amp;f=/styles/theme-medium.css" media="screen">

 <!--[if lte IE 7]>
 <link rel="stylesheet" type="text/css" href="http://php.net/styles/workarounds.ie7.css" media="screen">
 <![endif]-->

 <!--[if lte IE 8]>
 <script type="text/javascript">
  window.brokenIE = true;
 </script>
 <![endif]-->

 <!--[if lte IE 9]>
 <link rel="stylesheet" type="text/css" href="http://php.net/styles/workarounds.ie9.css" media="screen">
 <![endif]-->

 <!--[if IE]>
 <script type="text/javascript" src="http://php.net/js/ext/html5.js"></script>
 <![endif]-->

 <base>

</head>
<body class="docs " style="">


<div class="headsup"><a href="http://php.net/index.php#id2014-08-28-1">PHP 5.6.0 released</a></div>
<nav id="trick"><div><dl>
<dt><a href="getting-started.html">Getting Started</a></dt>
	<dd><a href="introduction.html">Introduction</a></dd>
	<dd><a href="tutorial.html">A simple tutorial</a></dd>
<dt><a href="langref.html">Language Reference</a></dt>
	<dd><a href="language.basic-syntax.html">Basic syntax</a></dd>
	<dd><a href="language.types.html">Types</a></dd>
	<dd><a href="language.variables.html">Variables</a></dd>
	<dd><a href="language.constants.html">Constants</a></dd>
	<dd><a href="language.expressions.html">Expressions</a></dd>
	<dd><a href="language.operators.html">Operators</a></dd>
	<dd><a href="language.control-structures.html">Control Structures</a></dd>
	<dd><a href="language.functions.html">Functions</a></dd>
	<dd><a href="language.oop5.html">Classes and Objects</a></dd>
	<dd><a href="language.namespaces.html">Namespaces</a></dd>
	<dd><a href="language.exceptions.html">Exceptions</a></dd>
	<dd><a href="language.generators.html">Generators</a></dd>
	<dd><a href="language.references.html">References Explained</a></dd>
	<dd><a href="reserved.variables.html">Predefined Variables</a></dd>
	<dd><a href="reserved.exceptions.html">Predefined Exceptions</a></dd>
	<dd><a href="reserved.interfaces.html">Predefined Interfaces and Classes</a></dd>
	<dd><a href="context.html">Context options and parameters</a></dd>
	<dd><a href="wrappers.html">Supported Protocols and Wrappers</a></dd>
</dl>
<dl>
<dt><a href="security.html">Security</a></dt>
	<dd><a href="security.intro.html">Introduction</a></dd>
	<dd><a href="security.general.html">General considerations</a></dd>
	<dd><a href="security.cgi-bin.html">Installed as CGI binary</a></dd>
	<dd><a href="security.apache.html">Installed as an Apache module</a></dd>
	<dd><a href="security.filesystem.html">Filesystem Security</a></dd>
	<dd><a href="security.database.html">Database Security</a></dd>
	<dd><a href="security.errors.html">Error Reporting</a></dd>
	<dd><a href="security.globals.html">Using Register Globals</a></dd>
	<dd><a href="security.variables.html">User Submitted Data</a></dd>
	<dd><a href="security.magicquotes.html">Magic Quotes</a></dd>
	<dd><a href="security.hiding.html">Hiding PHP</a></dd>
	<dd><a href="security.current.html">Keeping Current</a></dd>
<dt><a href="features.html">Features</a></dt>
	<dd><a href="features.http-auth.html">HTTP authentication with PHP</a></dd>
	<dd><a href="features.cookies.html">Cookies</a></dd>
	<dd><a href="features.sessions.html">Sessions</a></dd>
	<dd><a href="features.xforms.html">Dealing with XForms</a></dd>
	<dd><a href="features.file-upload.html">Handling file uploads</a></dd>
	<dd><a href="features.remote-files.html">Using remote files</a></dd>
	<dd><a href="features.connection-handling.html">Connection handling</a></dd>
	<dd><a href="features.persistent-connections.html">Persistent Database Connections</a></dd>
	<dd><a href="features.safe-mode.html">Safe Mode</a></dd>
	<dd><a href="features.commandline.html">Command line usage</a></dd>
	<dd><a href="features.gc.html">Garbage Collection</a></dd>
	<dd><a href="features.dtrace.html">DTrace Dynamic Tracing</a></dd>
</dl>
<dl>
<dt><a href="funcref.html">Function Reference</a></dt>
	<dd><a href="refs.basic.php.html">Affecting PHP's Behaviour</a></dd>
	<dd><a href="refs.utilspec.audio.html">Audio Formats Manipulation</a></dd>
	<dd><a href="refs.remote.auth.html">Authentication Services</a></dd>
	<dd><a href="refs.utilspec.cmdline.html">Command Line Specific Extensions</a></dd>
	<dd><a href="refs.compression.html">Compression and Archive Extensions</a></dd>
	<dd><a href="refs.creditcard.html">Credit Card Processing</a></dd>
	<dd><a href="refs.crypto.html">Cryptography Extensions</a></dd>
	<dd><a href="refs.database.html">Database Extensions</a></dd>
	<dd><a href="refs.calendar.html">Date and Time Related Extensions</a></dd>
	<dd><a href="refs.fileprocess.file.html">File System Related Extensions</a></dd>
	<dd><a href="refs.international.html">Human Language and Character Encoding Support</a></dd>
	<dd><a href="refs.utilspec.image.html">Image Processing and Generation</a></dd>
	<dd><a href="refs.remote.mail.html">Mail Related Extensions</a></dd>
	<dd><a href="refs.math.html">Mathematical Extensions</a></dd>
	<dd><a href="refs.utilspec.nontext.html">Non-Text MIME Output</a></dd>
	<dd><a href="refs.fileprocess.process.html">Process Control Extensions</a></dd>
	<dd><a href="refs.basic.other.html">Other Basic Extensions</a></dd>
	<dd><a href="refs.remote.other.html">Other Services</a></dd>
	<dd><a href="refs.search.html">Search Engine Extensions</a></dd>
	<dd><a href="refs.utilspec.server.html">Server Specific Extensions</a></dd>
	<dd><a href="refs.basic.session.html">Session Extensions</a></dd>
	<dd><a href="refs.basic.text.html">Text Processing</a></dd>
	<dd><a href="refs.basic.vartype.html">Variable and Type Related Extensions</a></dd>
	<dd><a href="refs.webservice.html">Web Services</a></dd>
	<dd><a href="refs.utilspec.windows.html">Windows Only Extensions</a></dd>
	<dd><a href="refs.xml.html">XML Manipulation</a></dd>
</dl>
<dl>
<dt>Keyboard Shortcuts</dt><dt>?</dt>
<dd>This help</dd>
<dt>j</dt>
<dd>Next menu item</dd>
<dt>k</dt>
<dd>Previous menu item</dd>
<dt>g p</dt>
<dd>Previous man page</dd>
<dt>g n</dt>
<dd>Next man page</dd>
<dt>G</dt>
<dd>Scroll to bottom</dd>
<dt>g g</dt>
<dd>Scroll to top</dd>
<dt>g h</dt>
<dd>Goto homepage</dd>
<dt>g s</dt>
<dd>Goto search<br>(current page)</dd>
<dt>/</dt>
<dd>Focus search box</dd>
</dl></div></nav>
<div id="goto">
    <div class="search">
         <div class="text"></div>
         <div class="results"><ul></ul></div>
   </div>
</div>

  <div id="breadcrumbs" class="row-fluid">
          
              
        <ul class="breadcrumbs-container">
            <li><a href="index-2.html">PHP Manual</a></li>      <li><a href="funcref.html">Function Reference</a></li>      <li><a href="refs.remote.other.html">Other Services</a></li>      <li><a href="book.curl.html">cURL</a></li>      <li><a href="ref.curl.html">cURL Functions</a></li>    </ul>
  </div>




<div id="layout">
  <section id="layout-content">
  <div id="function.curl-exec" class="refentry">
 <div class="refnamediv">
  <h1 class="refname">curl_exec</h1>
  <p class="verinfo">(PHP 4 &gt;= 4.0.2, PHP 5)</p><p class="refpurpose"><span class="refname">curl_exec</span> â€” <span class="dc-title">Perform a cURL session</span></p>

 </div>

 <div class="refsect1 description" id="refsect1-function.curl-exec-description">
  <h3 class="title">Description</h3>
  <div class="methodsynopsis dc-description">
   <span class="type"><a href="language.pseudo-types.html#language.types.mixed" class="type mixed">mixed</a></span> <span class="methodname"><strong>curl_exec</strong></span>
    ( <span class="methodparam"><span class="type">resource</span> <code class="parameter">$ch</code></span>
   )</div>

  <p class="para rdfs-comment">
   Execute the given cURL session.
  </p>
  <p class="para">
   This function should be called after initializing a cURL session and all
   the options for the session are set. 
  </p>
 </div>


 <div class="refsect1 parameters" id="refsect1-function.curl-exec-parameters">
  <h3 class="title">Parameters</h3>
  <p class="para">
   </p><dl>

    <dt>
<code class="parameter">ch</code>
</dt>
<dd>
<p class="para">A cURL handle returned by
<span class="function"><a href="function.curl-init.html" class="function">curl_init()</a></span>.</p></dd>

   </dl>

  <p></p>
 </div>


 <div class="refsect1 returnvalues" id="refsect1-function.curl-exec-returnvalues">
  <h3 class="title">Return Values</h3>
  <p class="para">
   Returns <strong><code>TRUE</code></strong> on success or <strong><code>FALSE</code></strong> on failure. However, if the <strong><code>CURLOPT_RETURNTRANSFER</code></strong>
   option is <a href="function.curl-setopt.html" class="link">set</a>, it will return
   the result on success, <strong><code>FALSE</code></strong> on failure.
  </p>
 </div>

   
 <div class="refsect1 examples" id="refsect1-function.curl-exec-examples">
  <h3 class="title">Examples</h3>
  <p class="para">
   </p><div class="example" id="example-4326">
    <p><strong>Example #1 Fetching a web page</strong></p>
    <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br></span><span style="color: #FF8000">//&nbsp;create&nbsp;a&nbsp;new&nbsp;cURL&nbsp;resource<br></span><span style="color: #0000BB">$ch&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">curl_init</span><span style="color: #007700">();<br><br></span><span style="color: #FF8000">//&nbsp;set&nbsp;URL&nbsp;and&nbsp;other&nbsp;appropriate&nbsp;options<br></span><span style="color: #0000BB">curl_setopt</span><span style="color: #007700">(</span><span style="color: #0000BB">$ch</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">CURLOPT_URL</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">"http://www.example.com/"</span><span style="color: #007700">);<br></span><span style="color: #0000BB">curl_setopt</span><span style="color: #007700">(</span><span style="color: #0000BB">$ch</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">CURLOPT_HEADER</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">0</span><span style="color: #007700">);<br><br></span><span style="color: #FF8000">//&nbsp;grab&nbsp;URL&nbsp;and&nbsp;pass&nbsp;it&nbsp;to&nbsp;the&nbsp;browser<br></span><span style="color: #0000BB">curl_exec</span><span style="color: #007700">(</span><span style="color: #0000BB">$ch</span><span style="color: #007700">);<br><br></span><span style="color: #FF8000">//&nbsp;close&nbsp;cURL&nbsp;resource,&nbsp;and&nbsp;free&nbsp;up&nbsp;system&nbsp;resources<br></span><span style="color: #0000BB">curl_close</span><span style="color: #007700">(</span><span style="color: #0000BB">$ch</span><span style="color: #007700">);<br></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
    </div>

   </div>
  <p></p>
 </div>

 
 <div class="refsect1 seealso" id="refsect1-function.curl-exec-seealso">
  <h3 class="title">See Also</h3>
  <p class="para">
   </p><ul class="simplelist">
    <li class="member"><span class="function"><a href="function.curl-multi-exec.html" class="function" rel="rdfs-seeAlso">curl_multi_exec()</a> - Run the sub-connections of the current cURL handle</span></li>
   </ul>
  <p></p>
 </div>


</div>
<section id="usernotes">
 <div class="head"><h3 class="title">User Contributed Notes</h3></div><div id="allnotes">
  <div class="note" id="98628">  
  <a class="name">
  <strong class="user"><em>David from Code2Design.com</em></strong></a><div class="date" title="2010-06-27 07:44"><strong>4 years ago</strong></div>
  <div class="text" id="Hcom98628">
<div class="phpcode"><code><span class="html">
Just in case anyone is looking for a a couple of simple functions [to help automate cURL processes for POST and GET queries] I thought I'd post these.
<br>
<br><span class="default">&lt;?php
<br>
<br></span><span class="comment">/**
<br> * Send a POST requst using cURL
<br> * @param string $url to request
<br> * @param array $post values to send
<br> * @param array $options for cURL
<br> * @return string
<br> */
<br></span><span class="keyword">function </span><span class="default">curl_post</span><span class="keyword">(</span><span class="default">$url</span><span class="keyword">, array </span><span class="default">$post </span><span class="keyword">= </span><span class="default">NULL</span><span class="keyword">, array </span><span class="default">$options </span><span class="keyword">= array())
<br>{
<br>&nbsp; &nbsp; </span><span class="default">$defaults </span><span class="keyword">= array(
<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">CURLOPT_POST </span><span class="keyword">=&gt; </span><span class="default">1</span><span class="keyword">,
<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">CURLOPT_HEADER </span><span class="keyword">=&gt; </span><span class="default">0</span><span class="keyword">,
<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">CURLOPT_URL </span><span class="keyword">=&gt; </span><span class="default">$url</span><span class="keyword">,
<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">CURLOPT_FRESH_CONNECT </span><span class="keyword">=&gt; </span><span class="default">1</span><span class="keyword">,
<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">CURLOPT_RETURNTRANSFER </span><span class="keyword">=&gt; </span><span class="default">1</span><span class="keyword">,
<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">CURLOPT_FORBID_REUSE </span><span class="keyword">=&gt; </span><span class="default">1</span><span class="keyword">,
<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">CURLOPT_TIMEOUT </span><span class="keyword">=&gt; </span><span class="default">4</span><span class="keyword">,
<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">CURLOPT_POSTFIELDS </span><span class="keyword">=&gt; </span><span class="default">http_build_query</span><span class="keyword">(</span><span class="default">$post</span><span class="keyword">)
<br>&nbsp; &nbsp; );
<br>
<br>&nbsp; &nbsp; </span><span class="default">$ch </span><span class="keyword">= </span><span class="default">curl_init</span><span class="keyword">();
<br>&nbsp; &nbsp; </span><span class="default">curl_setopt_array</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">, (</span><span class="default">$options </span><span class="keyword">+ </span><span class="default">$defaults</span><span class="keyword">));
<br>&nbsp; &nbsp; if( ! </span><span class="default">$result </span><span class="keyword">= </span><span class="default">curl_exec</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">))
<br>&nbsp; &nbsp; {
<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">trigger_error</span><span class="keyword">(</span><span class="default">curl_error</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">));
<br>&nbsp; &nbsp; }
<br>&nbsp; &nbsp; </span><span class="default">curl_close</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">);
<br>&nbsp; &nbsp; return </span><span class="default">$result</span><span class="keyword">;
<br>}
<br>
<br></span><span class="comment">/**
<br> * Send a GET requst using cURL
<br> * @param string $url to request
<br> * @param array $get values to send
<br> * @param array $options for cURL
<br> * @return string
<br> */
<br></span><span class="keyword">function </span><span class="default">curl_get</span><span class="keyword">(</span><span class="default">$url</span><span class="keyword">, array </span><span class="default">$get </span><span class="keyword">= </span><span class="default">NULL</span><span class="keyword">, array </span><span class="default">$options </span><span class="keyword">= array())
<br>{&nbsp; &nbsp; 
<br>&nbsp; &nbsp; </span><span class="default">$defaults </span><span class="keyword">= array(
<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">CURLOPT_URL </span><span class="keyword">=&gt; </span><span class="default">$url</span><span class="keyword">. (</span><span class="default">strpos</span><span class="keyword">(</span><span class="default">$url</span><span class="keyword">, </span><span class="string">'?'</span><span class="keyword">) === </span><span class="default">FALSE </span><span class="keyword">? </span><span class="string">'?' </span><span class="keyword">: </span><span class="string">''</span><span class="keyword">). </span><span class="default">http_build_query</span><span class="keyword">(</span><span class="default">$get</span><span class="keyword">),
<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">CURLOPT_HEADER </span><span class="keyword">=&gt; </span><span class="default">0</span><span class="keyword">,
<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">CURLOPT_RETURNTRANSFER </span><span class="keyword">=&gt; </span><span class="default">TRUE</span><span class="keyword">,
<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">CURLOPT_TIMEOUT </span><span class="keyword">=&gt; </span><span class="default">4
<br>&nbsp; &nbsp; </span><span class="keyword">);
<br>&nbsp; &nbsp; 
<br>&nbsp; &nbsp; </span><span class="default">$ch </span><span class="keyword">= </span><span class="default">curl_init</span><span class="keyword">();
<br>&nbsp; &nbsp; </span><span class="default">curl_setopt_array</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">, (</span><span class="default">$options </span><span class="keyword">+ </span><span class="default">$defaults</span><span class="keyword">));
<br>&nbsp; &nbsp; if( ! </span><span class="default">$result </span><span class="keyword">= </span><span class="default">curl_exec</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">))
<br>&nbsp; &nbsp; {
<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">trigger_error</span><span class="keyword">(</span><span class="default">curl_error</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">));
<br>&nbsp; &nbsp; }
<br>&nbsp; &nbsp; </span><span class="default">curl_close</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">);
<br>&nbsp; &nbsp; return </span><span class="default">$result</span><span class="keyword">;
<br>}
<br></span><span class="default">?&gt;</span>
</span>
</code></div>
  </div>
 </div>
  <div class="note" id="80442">  
  <a class="name">
  <strong class="user"><em>roman dot ivasyuk at gmail dot com</em></strong></a><div class="date" title="2008-01-16 04:11"><strong>6 years ago</strong></div>
  <div class="text" id="Hcom80442">
<div class="phpcode"><code><span class="html">
<span class="default">&lt;?php<br></span><span class="keyword">class </span><span class="default">CurlRequest<br></span><span class="keyword">{<br>&nbsp; &nbsp; private </span><span class="default">$ch</span><span class="keyword">;<br>&nbsp; &nbsp; </span><span class="comment">/**<br>&nbsp; &nbsp;&nbsp; * Init curl session<br>&nbsp; &nbsp;&nbsp; * <br>&nbsp; &nbsp;&nbsp; * $params = array('url' =&gt; '',<br>&nbsp; &nbsp;&nbsp; *&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 'host' =&gt; '',<br>&nbsp; &nbsp;&nbsp; *&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; 'header' =&gt; '',<br>&nbsp; &nbsp;&nbsp; *&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; 'method' =&gt; '',<br>&nbsp; &nbsp;&nbsp; *&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; 'referer' =&gt; '',<br>&nbsp; &nbsp;&nbsp; *&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; 'cookie' =&gt; '',<br>&nbsp; &nbsp;&nbsp; *&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; 'post_fields' =&gt; '',<br>&nbsp; &nbsp;&nbsp; *&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ['login' =&gt; '',]<br>&nbsp; &nbsp;&nbsp; *&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ['password' =&gt; '',]&nbsp; &nbsp; &nbsp; <br>&nbsp; &nbsp;&nbsp; *&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; 'timeout' =&gt; 0<br>&nbsp; &nbsp;&nbsp; *&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; );<br>&nbsp; &nbsp;&nbsp; */&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br>&nbsp; &nbsp; </span><span class="keyword">public function </span><span class="default">init</span><span class="keyword">(</span><span class="default">$params</span><span class="keyword">)<br>&nbsp; &nbsp; {<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">ch </span><span class="keyword">= </span><span class="default">curl_init</span><span class="keyword">();<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$user_agent </span><span class="keyword">= </span><span class="string">'Mozilla/5.0 (Windows; U; <br>Windows NT 5.1; ru; rv:1.8.0.9) Gecko/20061206 Firefox/1.5.0.9'</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$header </span><span class="keyword">= array(<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="string">"Accept: text/xml,application/xml,application/xhtml+xml,<br>text/html;q=0.9,text/plain;q=0.8,image/png,*/*;q=0.5"</span><span class="keyword">,<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="string">"Accept-Language: ru-ru,ru;q=0.7,en-us;q=0.5,en;q=0.3"</span><span class="keyword">,<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="string">"Accept-Charset: windows-1251,utf-8;q=0.7,*;q=0.7"</span><span class="keyword">,<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="string">"Keep-Alive: 300"</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; if (isset(</span><span class="default">$params</span><span class="keyword">[</span><span class="string">'host'</span><span class="keyword">]) &amp;&amp; </span><span class="default">$params</span><span class="keyword">[</span><span class="string">'host'</span><span class="keyword">])&nbsp; &nbsp; &nbsp; </span><span class="default">$header</span><span class="keyword">[]=</span><span class="string">"Host: "</span><span class="keyword">.</span><span class="default">$host</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; if (isset(</span><span class="default">$params</span><span class="keyword">[</span><span class="string">'header'</span><span class="keyword">]) &amp;&amp; </span><span class="default">$params</span><span class="keyword">[</span><span class="string">'header'</span><span class="keyword">]) </span><span class="default">$header</span><span class="keyword">[]=</span><span class="default">$params</span><span class="keyword">[</span><span class="string">'header'</span><span class="keyword">];<br>&nbsp; &nbsp; &nbsp; &nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; @</span><span class="default">curl_setopt </span><span class="keyword">( </span><span class="default">$this </span><span class="keyword">-&gt; </span><span class="default">ch </span><span class="keyword">, </span><span class="default">CURLOPT_RETURNTRANSFER </span><span class="keyword">, </span><span class="default">1 </span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; @</span><span class="default">curl_setopt </span><span class="keyword">( </span><span class="default">$this </span><span class="keyword">-&gt; </span><span class="default">ch </span><span class="keyword">, </span><span class="default">CURLOPT_VERBOSE </span><span class="keyword">, </span><span class="default">1 </span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; @</span><span class="default">curl_setopt </span><span class="keyword">( </span><span class="default">$this </span><span class="keyword">-&gt; </span><span class="default">ch </span><span class="keyword">, </span><span class="default">CURLOPT_HEADER </span><span class="keyword">, </span><span class="default">1 </span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; if (</span><span class="default">$params</span><span class="keyword">[</span><span class="string">'method'</span><span class="keyword">] == </span><span class="string">"HEAD"</span><span class="keyword">) @</span><span class="default">curl_setopt</span><span class="keyword">(</span><span class="default">$this </span><span class="keyword">-&gt; </span><span class="default">ch</span><span class="keyword">,</span><span class="default">CURLOPT_NOBODY</span><span class="keyword">,</span><span class="default">1</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; @</span><span class="default">curl_setopt </span><span class="keyword">( </span><span class="default">$this </span><span class="keyword">-&gt; </span><span class="default">ch</span><span class="keyword">, </span><span class="default">CURLOPT_FOLLOWLOCATION</span><span class="keyword">, </span><span class="default">1</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; @</span><span class="default">curl_setopt </span><span class="keyword">( </span><span class="default">$this </span><span class="keyword">-&gt; </span><span class="default">ch </span><span class="keyword">, </span><span class="default">CURLOPT_HTTPHEADER</span><span class="keyword">, </span><span class="default">$header </span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; if (</span><span class="default">$params</span><span class="keyword">[</span><span class="string">'referer'</span><span class="keyword">])&nbsp; &nbsp; @</span><span class="default">curl_setopt </span><span class="keyword">(</span><span class="default">$this </span><span class="keyword">-&gt; </span><span class="default">ch </span><span class="keyword">, </span><span class="default">CURLOPT_REFERER</span><span class="keyword">, </span><span class="default">$params</span><span class="keyword">[</span><span class="string">'referer'</span><span class="keyword">] );<br>&nbsp; &nbsp; &nbsp; &nbsp; @</span><span class="default">curl_setopt </span><span class="keyword">( </span><span class="default">$this </span><span class="keyword">-&gt; </span><span class="default">ch </span><span class="keyword">, </span><span class="default">CURLOPT_USERAGENT</span><span class="keyword">, </span><span class="default">$user_agent</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; if (</span><span class="default">$params</span><span class="keyword">[</span><span class="string">'cookie'</span><span class="keyword">])&nbsp; &nbsp; @</span><span class="default">curl_setopt </span><span class="keyword">(</span><span class="default">$this </span><span class="keyword">-&gt; </span><span class="default">ch </span><span class="keyword">, </span><span class="default">CURLOPT_COOKIE</span><span class="keyword">, </span><span class="default">$params</span><span class="keyword">[</span><span class="string">'cookie'</span><span class="keyword">]);<br><br>&nbsp; &nbsp; &nbsp; &nbsp; if ( </span><span class="default">$params</span><span class="keyword">[</span><span class="string">'method'</span><span class="keyword">] == </span><span class="string">"POST" </span><span class="keyword">)<br>&nbsp; &nbsp; &nbsp; &nbsp; {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">curl_setopt</span><span class="keyword">( </span><span class="default">$this </span><span class="keyword">-&gt; </span><span class="default">ch</span><span class="keyword">, </span><span class="default">CURLOPT_POST</span><span class="keyword">, </span><span class="default">true </span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">curl_setopt</span><span class="keyword">( </span><span class="default">$this </span><span class="keyword">-&gt; </span><span class="default">ch</span><span class="keyword">, </span><span class="default">CURLOPT_POSTFIELDS</span><span class="keyword">, </span><span class="default">$params</span><span class="keyword">[</span><span class="string">'post_fields'</span><span class="keyword">] );<br>&nbsp; &nbsp; &nbsp; &nbsp; }<br>&nbsp; &nbsp; &nbsp; &nbsp; @</span><span class="default">curl_setopt</span><span class="keyword">( </span><span class="default">$this </span><span class="keyword">-&gt; </span><span class="default">ch</span><span class="keyword">, </span><span class="default">CURLOPT_URL</span><span class="keyword">, </span><span class="default">$params</span><span class="keyword">[</span><span class="string">'url'</span><span class="keyword">]);<br>&nbsp; &nbsp; &nbsp; &nbsp; @</span><span class="default">curl_setopt </span><span class="keyword">( </span><span class="default">$this </span><span class="keyword">-&gt; </span><span class="default">ch </span><span class="keyword">, </span><span class="default">CURLOPT_SSL_VERIFYPEER</span><span class="keyword">, </span><span class="default">0 </span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; @</span><span class="default">curl_setopt </span><span class="keyword">( </span><span class="default">$this </span><span class="keyword">-&gt; </span><span class="default">ch </span><span class="keyword">, </span><span class="default">CURLOPT_SSL_VERIFYHOST</span><span class="keyword">, </span><span class="default">0 </span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; if (isset(</span><span class="default">$params</span><span class="keyword">[</span><span class="string">'login'</span><span class="keyword">]) &amp; isset(</span><span class="default">$params</span><span class="keyword">[</span><span class="string">'password'</span><span class="keyword">]))<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; @</span><span class="default">curl_setopt</span><span class="keyword">(</span><span class="default">$this </span><span class="keyword">-&gt; </span><span class="default">ch </span><span class="keyword">, </span><span class="default">CURLOPT_USERPWD</span><span class="keyword">,</span><span class="default">$params</span><span class="keyword">[</span><span class="string">'login'</span><span class="keyword">].</span><span class="string">':'</span><span class="keyword">.</span><span class="default">$params</span><span class="keyword">[</span><span class="string">'password'</span><span class="keyword">]);<br>&nbsp; &nbsp; &nbsp; &nbsp; @</span><span class="default">curl_setopt </span><span class="keyword">( </span><span class="default">$this </span><span class="keyword">-&gt; </span><span class="default">ch </span><span class="keyword">, </span><span class="default">CURLOPT_TIMEOUT</span><span class="keyword">, </span><span class="default">$params</span><span class="keyword">[</span><span class="string">'timeout'</span><span class="keyword">]);<br>&nbsp; &nbsp; }<br>&nbsp; &nbsp; <br>&nbsp; &nbsp; </span><span class="comment">/**<br>&nbsp; &nbsp;&nbsp; * Make curl request<br>&nbsp; &nbsp;&nbsp; *<br>&nbsp; &nbsp;&nbsp; * @return array&nbsp; 'header','body','curl_error','http_code','last_url'<br>&nbsp; &nbsp;&nbsp; */<br>&nbsp; &nbsp; </span><span class="keyword">public function </span><span class="default">exec</span><span class="keyword">()<br>&nbsp; &nbsp; {<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$response </span><span class="keyword">= </span><span class="default">curl_exec</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">ch</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$error </span><span class="keyword">= </span><span class="default">curl_error</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">ch</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$result </span><span class="keyword">= array( </span><span class="string">'header' </span><span class="keyword">=&gt; </span><span class="string">''</span><span class="keyword">, <br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="string">'body' </span><span class="keyword">=&gt; </span><span class="string">''</span><span class="keyword">, <br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="string">'curl_error' </span><span class="keyword">=&gt; </span><span class="string">''</span><span class="keyword">, <br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="string">'http_code' </span><span class="keyword">=&gt; </span><span class="string">''</span><span class="keyword">,<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="string">'last_url' </span><span class="keyword">=&gt; </span><span class="string">''</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; if ( </span><span class="default">$error </span><span class="keyword">!= </span><span class="string">"" </span><span class="keyword">)<br>&nbsp; &nbsp; &nbsp; &nbsp; {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$result</span><span class="keyword">[</span><span class="string">'curl_error'</span><span class="keyword">] = </span><span class="default">$error</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; return </span><span class="default">$result</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; }<br>&nbsp; &nbsp; &nbsp; &nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$header_size </span><span class="keyword">= </span><span class="default">curl_getinfo</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">ch</span><span class="keyword">,</span><span class="default">CURLINFO_HEADER_SIZE</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$result</span><span class="keyword">[</span><span class="string">'header'</span><span class="keyword">] = </span><span class="default">substr</span><span class="keyword">(</span><span class="default">$response</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">$header_size</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$result</span><span class="keyword">[</span><span class="string">'body'</span><span class="keyword">] = </span><span class="default">substr</span><span class="keyword">( </span><span class="default">$response</span><span class="keyword">, </span><span class="default">$header_size </span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$result</span><span class="keyword">[</span><span class="string">'http_code'</span><span class="keyword">] = </span><span class="default">curl_getinfo</span><span class="keyword">(</span><span class="default">$this </span><span class="keyword">-&gt; </span><span class="default">ch</span><span class="keyword">,</span><span class="default">CURLINFO_HTTP_CODE</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$result</span><span class="keyword">[</span><span class="string">'last_url'</span><span class="keyword">] = </span><span class="default">curl_getinfo</span><span class="keyword">(</span><span class="default">$this </span><span class="keyword">-&gt; </span><span class="default">ch</span><span class="keyword">,</span><span class="default">CURLINFO_EFFECTIVE_URL</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; return </span><span class="default">$result</span><span class="keyword">;<br>&nbsp; &nbsp; }<br>}<br></span><span class="default">?&gt;<br></span><br>Example of use:<br><span class="default">&lt;?php<br></span><span class="keyword">..........<br>try<br>&nbsp; &nbsp; &nbsp; &nbsp; {&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$params </span><span class="keyword">= array(</span><span class="string">'url' </span><span class="keyword">=&gt; </span><span class="string">'<a rel="nofollow" target="_blank">http://www.google.com</a>'</span><span class="keyword">,<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="string">'host' </span><span class="keyword">=&gt; </span><span class="string">''</span><span class="keyword">,<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="string">'header' </span><span class="keyword">=&gt; </span><span class="string">''</span><span class="keyword">,<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="string">'method' </span><span class="keyword">=&gt; </span><span class="string">'GET'</span><span class="keyword">, </span><span class="comment">// 'POST','HEAD'<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="string">'referer' </span><span class="keyword">=&gt; </span><span class="string">''</span><span class="keyword">,<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="string">'cookie' </span><span class="keyword">=&gt; </span><span class="string">''</span><span class="keyword">,<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="string">'post_fields' </span><span class="keyword">=&gt; </span><span class="string">''</span><span class="keyword">, </span><span class="comment">// 'var1=value&amp;var2=value<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="string">'timeout' </span><span class="keyword">=&gt; </span><span class="default">20<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">curl</span><span class="keyword">-&gt;</span><span class="default">init</span><span class="keyword">(</span><span class="default">$params</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$result </span><span class="keyword">= </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">curl</span><span class="keyword">-&gt;</span><span class="default">exec</span><span class="keyword">();<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if (</span><span class="default">$result</span><span class="keyword">[</span><span class="string">'curl_error'</span><span class="keyword">])&nbsp; &nbsp; throw new </span><span class="default">Exception</span><span class="keyword">(</span><span class="default">$result</span><span class="keyword">[</span><span class="string">'curl_error'</span><span class="keyword">]);<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if (</span><span class="default">$result</span><span class="keyword">[</span><span class="string">'http_code'</span><span class="keyword">]!=</span><span class="string">'200'</span><span class="keyword">)&nbsp; &nbsp; throw new </span><span class="default">Exception</span><span class="keyword">(</span><span class="string">"HTTP Code = "</span><span class="keyword">.</span><span class="default">$result</span><span class="keyword">[</span><span class="string">'http_code'</span><span class="keyword">]);<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if (!</span><span class="default">$result</span><span class="keyword">[</span><span class="string">'body'</span><span class="keyword">])&nbsp; &nbsp; &nbsp; &nbsp; throw new </span><span class="default">Exception</span><span class="keyword">(</span><span class="string">"Body of file is empty"</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ...............<br>&nbsp; &nbsp; &nbsp; &nbsp; }<br>&nbsp; &nbsp; &nbsp; &nbsp; catch (</span><span class="default">Exception $e</span><span class="keyword">)<br>&nbsp; &nbsp; &nbsp; &nbsp; {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; echo </span><span class="default">$e</span><span class="keyword">-&gt;</span><span class="default">getMessage</span><span class="keyword">();<br>&nbsp; &nbsp; &nbsp; &nbsp; }<br></span><span class="default">?&gt;</span>
</span>
</code></div>
  </div>
 </div>
  <div class="note" id="31582">  
  <a class="name">
  <strong class="user"><em>nagyp at hunaxon dot hu</em></strong></a><div class="date" title="2003-04-26 05:22"><strong>11 years ago</strong></div>
  <div class="text" id="Hcom31582">
<div class="phpcode"><code><span class="html">
fyi:<br>It returns false if there's an error while executing the curl session, no matter how CURLOPT_RETURNTRANSFER is set.</span>
</code></div>
  </div>
 </div>
  <div class="note" id="19497">  
  <a class="name">
  <strong class="user"><em>ppruett at webengr dot com</em></strong></a><div class="date" title="2002-02-28 07:06"><strong>12 years ago</strong></div>
  <div class="text" id="Hcom19497">
<div class="phpcode"><code><span class="html">
fyi - if you are having problems getting a
<br>webpage to display in your webpage with 
<br>curl_setopt(CURLOPT_RETURNTRANSFER, 1);
<br>due to version bugginess perhaps, 
<br>you may can use output control functions
<br>like this to show a web page
<br>inside your webpage:
<br>
<br>&lt;html&gt;&lt;head&gt;&lt;title&gt;whatever&lt;/title&gt;&lt;/head&gt;
<br>&lt;body&gt;
<br><span class="default">&lt;script language="php"&gt;
<br>$ch </span><span class="keyword">= </span><span class="default">curl_init</span><span class="keyword">(</span><span class="string">"<a rel="nofollow" target="_blank">http://www.cocoavillage.com/</a>"</span><span class="keyword">);
<br></span><span class="comment">// use output buffering instead of returntransfer -itmaybebuggy
<br></span><span class="default">ob_start</span><span class="keyword">();
<br></span><span class="default">curl_exec</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">); 
<br></span><span class="default">curl_close</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">); 
<br></span><span class="default">$retrievedhtml </span><span class="keyword">= </span><span class="default">ob_get_contents</span><span class="keyword">();
<br></span><span class="default">ob_end_clean</span><span class="keyword">();
<br></span><span class="comment">// if you intend to print this page with meta tags, better clear out any expiration tag
<br>//&nbsp; &nbsp; $result = preg_replace('/(?s)&lt;meta http-equiv="Expires"[^&gt;]*&gt;/i', '', $retrievedhtml);
<br>// for now I just want what is between the body tags so need
<br>// somehow cut the header footer&nbsp; &nbsp;&nbsp; 
<br></span><span class="default">$bodyandend </span><span class="keyword">= </span><span class="default">stristr</span><span class="keyword">(</span><span class="default">$retrievedhtml</span><span class="keyword">,</span><span class="string">"&lt;body"</span><span class="keyword">);
<br></span><span class="comment">// not needed- $positionstartbodystring = strlen($retrievedhtml)-strlen($bodyandend);
<br></span><span class="default">$positionendstartbodytag </span><span class="keyword">= </span><span class="default">strpos</span><span class="keyword">(</span><span class="default">$bodyandend</span><span class="keyword">,</span><span class="string">"&gt;"</span><span class="keyword">) + </span><span class="default">1</span><span class="keyword">;
<br></span><span class="comment">// got to change all to lowercase temporarily 
<br>// because end body may be upperlowercasemix
<br>// to bad strirstr does not exist
<br></span><span class="default">$temptofindposition</span><span class="keyword">=</span><span class="default">strtolower</span><span class="keyword">(</span><span class="default">$bodyandend</span><span class="keyword">);
<br></span><span class="default">$positionendendbodytag</span><span class="keyword">=</span><span class="default">strpos</span><span class="keyword">(</span><span class="default">$temptofindposition</span><span class="keyword">,</span><span class="string">"&lt;/body"</span><span class="keyword">);
<br></span><span class="comment">//now to get the endbetween body tags
<br></span><span class="default">$grabbedbody</span><span class="keyword">=</span><span class="default">substr</span><span class="keyword">(</span><span class="default">$bodyandend</span><span class="keyword">,
<br>&nbsp; &nbsp;&nbsp; </span><span class="default">$positionendstartbodytag</span><span class="keyword">,
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$positionendendbodytag</span><span class="keyword">); 
<br></span><span class="comment">//be sure to fix syntax broke by display on phpwebsite... like above line
<br></span><span class="keyword">print(</span><span class="string">"</span><span class="default">$grabbedbody</span><span class="string">"</span><span class="keyword">);
<br></span><span class="default">&lt;/script&gt;
<br></span>&lt;/body&gt;&lt;/html&gt;
<br>
<br>tada</span>
</code></div>
  </div>
 </div>
  <div class="note" id="115089">  
  <a class="name">
  <strong class="user"><em>hablutzel1 at gmail dot com</em></strong></a><div class="date" title="2014-05-24 05:04"><strong>3 months ago</strong></div>
  <div class="text" id="Hcom115089">
<div class="phpcode"><code><span class="html">
Be always aware that CURLOPT_SSL_VERIFYPEER set to FALSE or 0 should never be used for production as it makes the link inmediately vulnerable to man-in-the-middle attack, still you can use it during development, but I would suggest that only if you KNOW what are you doing, otherwise spend some more time making requests to HTTPS sites work without resorting to set that option to FALSE or 0.</span>
</code></div>
  </div>
 </div>
  <div class="note" id="77058">  
  <a class="name">
  <strong class="user"><em>test at test dot com</em></strong></a><div class="date" title="2007-08-13 06:43"><strong>7 years ago</strong></div>
  <div class="text" id="Hcom77058">
<div class="phpcode"><code><span class="html">
If you see a "0" at the end of the output, you might want to switch to HTTP/1.0:<br><br>curl_setopt($ch, CURLOPT_HTTP_VERSION, 1.0);</span>
</code></div>
  </div>
 </div>
  <div class="note" id="102396">  
  <a class="name">
  <strong class="user"><em>tolas777 at gmail dot com</em></strong></a><div class="date" title="2011-02-11 08:27"><strong>3 years ago</strong></div>
  <div class="text" id="Hcom102396">
<div class="phpcode"><code><span class="html">
I was having a problem, for almost a week, of curl_exec() freezing/hanging when I made a request with it to a page that spends over an hour converting a large video file, and only afterwards sends control-data back to the calling script.<br><br>I'm using windows 7, WampServer-2.1d-64.exe, PHP 5.3.4, libcurl-7.21.3.<br><br>Here's the final solution;<br><br>On Fri, Feb 11, 2011 at 1:32 PM, Daniel Stenberg &lt;daniel-of-haxx.se&gt; wrote:<br>&gt; On Fri, 11 Feb 2011, Tolas Anon wrote:<br>&gt;<br>&gt;&gt;&gt; It is also very easy for an application to enable the options as I've<br>&gt;&gt;&gt; shown.<br>&gt;&gt;<br>&gt;&gt; Just not for the platforms i use, apparently.. :(<br>&gt;<br>&gt; Why not? A quick search for "tcp keepalive windows" shows this:<br>&gt; <a rel="nofollow" target="_blank">http://msdn.microsoft.com/en-us/library/ms819735.aspx</a><br><br>This fixed my problem in the simple test AND in my application!<br>No need to send keep-alive bytes on the text/html level either.<br><br>I just added the "KeepAliveTime" setting with windows 7 regedit.exe in<br>HKEY_LOCAL_MACHINE/SYSTEM/CurrentControlSet/services/Tcpip, as a<br>REG_DWORD value, set it to decimal 25000 (so 25 seconds), rebooted,<br>and it all works as i want it now..<br><br>Note that windows registry entries key names are case-sensitive, wrong<br>casing and they'll be deleted on restart.<br><br>Lots of thanks, Daniel. I would've never solved this on my own..<br><br>------------------------------------------------------<br>(now useless) details at:<br><br><a rel="nofollow" target="_blank">http://curl.haxx.se/mail/lib-2011-02/0101.html</a><br><br><a rel="nofollow" target="_blank">http://readlist.com/lists/lists.php.net/php-general/16/81195.html</a></span>
</code></div>
  </div>
 </div>
  <div class="note" id="96174">  
  <a class="name">
  <strong class="user"><em>ivanargulo at  NOSPAM gmail dot com</em></strong></a><div class="date" title="2010-02-12 03:41"><strong>4 years ago</strong></div>
  <div class="text" id="Hcom96174">
<div class="phpcode"><code><span class="html">
If having problems with special chars or entities (like Ã¡, Ã¤, Ã , etc.), using the ISO encode, just decode the values given with the function utf8_decode().<br><br>For example:<br><br>The returned string is the following:<br><br>&lt;xml&gt;&lt;name&gt;IvÃƒÂ¡n&lt;/name&gt;&lt;/xml&gt;<br><br>Using utf8_decode, the result in ISO is<br><br>&lt;xml&gt;&lt;name&gt;IvÃ¡n&lt;/name&gt;&lt;/xml&gt;</span>
</code></div>
  </div>
 </div>
  <div class="note" id="92580">  
  <a class="name">
  <strong class="user"><em>petermiller1986[nospam] at gmail dot com</em></strong></a><div class="date" title="2009-07-30 01:57"><strong>5 years ago</strong></div>
  <div class="text" id="Hcom92580">
<div class="phpcode"><code><span class="html">
so far i have not come across any code or library file that will<br>extract cookie information from a http header, so i've written<br>one.<br><br>there are two files:<br>file1.php - acts as server and sets the cookies<br>file2.php - acts as browser and retrieves the cookies set by file1<br><br>/*****file1.php****/<br><span class="default">&lt;?php<br></span><span class="comment">/*set 3 cookies at the end of the execution of this script*/<br><br></span><span class="default">setcookie</span><span class="keyword">(</span><span class="string">"cookie1"</span><span class="keyword">,</span><span class="string">"cookie 1 data"</span><span class="keyword">, </span><span class="default">time</span><span class="keyword">() - </span><span class="default">123123</span><span class="keyword">);<br></span><span class="default">setcookie</span><span class="keyword">(</span><span class="string">"cookie2"</span><span class="keyword">,</span><span class="string">"cookie 2 data"</span><span class="keyword">, </span><span class="default">time</span><span class="keyword">() + </span><span class="default">54326</span><span class="keyword">);<br></span><span class="default">setcookie</span><span class="keyword">(</span><span class="string">"cookie3"</span><span class="keyword">,</span><span class="string">"cookie 3 data"</span><span class="keyword">, </span><span class="default">time</span><span class="keyword">());<br></span><span class="default">?&gt;<br></span>/****end file1.php**/<br><br>/*****file2.php****/<br><span class="default">&lt;?php<br>$url </span><span class="keyword">= </span><span class="string">"<a rel="nofollow" target="_blank">http://[host][uri]/file1.php</a>"</span><span class="keyword">; </span><span class="comment">/*insert desired host and<br>uri*/<br></span><span class="default">$browser_id </span><span class="keyword">= </span><span class="string">"some crazy browser"</span><span class="keyword">;<br></span><span class="default">$curl_handle </span><span class="keyword">= </span><span class="default">curl_init</span><span class="keyword">();<br></span><span class="default">$options </span><span class="keyword">= array<br>(<br>&nbsp; &nbsp; </span><span class="default">CURLOPT_URL</span><span class="keyword">=&gt;</span><span class="default">$url</span><span class="keyword">,<br>&nbsp; &nbsp; </span><span class="default">CURLOPT_HEADER</span><span class="keyword">=&gt;</span><span class="default">true</span><span class="keyword">,<br>&nbsp; &nbsp; </span><span class="default">CURLOPT_RETURNTRANSFER</span><span class="keyword">=&gt;</span><span class="default">true</span><span class="keyword">,<br>&nbsp; &nbsp; </span><span class="default">CURLOPT_FOLLOWLOCATION</span><span class="keyword">=&gt;</span><span class="default">true</span><span class="keyword">,<br>&nbsp; &nbsp; </span><span class="default">CURLOPT_USERAGENT</span><span class="keyword">=&gt;</span><span class="default">$browser_id<br></span><span class="keyword">);<br></span><span class="default">curl_setopt_array</span><span class="keyword">(</span><span class="default">$curl_handle</span><span class="keyword">,</span><span class="default">$options</span><span class="keyword">);<br></span><span class="default">$server_output </span><span class="keyword">= </span><span class="default">curl_exec</span><span class="keyword">(</span><span class="default">$curl_handle</span><span class="keyword">);<br></span><span class="default">curl_close</span><span class="keyword">(</span><span class="default">$curl_handle</span><span class="keyword">);<br><br></span><span class="comment">/*construct the http search pattern for cookies*/<br></span><span class="default">$pattern&nbsp; </span><span class="keyword">= </span><span class="string">"/Set-Cookie:"</span><span class="keyword">;<br></span><span class="default">$pattern </span><span class="keyword">.= </span><span class="string">"(?P&lt;name&gt;.*?)=(?P&lt;value&gt;.*?); "</span><span class="keyword">;<br></span><span class="default">$pattern </span><span class="keyword">.= </span><span class="string">"expires=(?P&lt;expiry_dayname&gt;\w+), "</span><span class="keyword">;<br></span><span class="default">$pattern </span><span class="keyword">.= </span><span class="string">"(?P&lt;expiry_day&gt;\d+)-<br>(?P&lt;expiry_month&gt;\w+)-(?P&lt;expiry_year&gt;\d+) "</span><span class="keyword">;<br></span><span class="default">$pattern </span><span class="keyword">.= </span><span class="string">"(?P&lt;expiry_hour&gt;\d+):<br>(?P&lt;expiry_minute&gt;\d+):(?P&lt;expiry_second&gt;\d+) "</span><span class="keyword">;<br></span><span class="default">$pattern </span><span class="keyword">.= </span><span class="string">"(?P&lt;expiry_zone&gt;\w+)/"</span><span class="keyword">;<br></span><span class="default">preg_match_all</span><span class="keyword">(</span><span class="default">$pattern</span><span class="keyword">,</span><span class="default">$server_output</span><span class="keyword">,</span><span class="default">$matches</span><span class="keyword">);<br><br></span><span class="default">$table_string </span><span class="keyword">= </span><span class="string">"<br>&lt;h1&gt;cookie information table&lt;/h1&gt;<br>&lt;table border='1'&gt;<br>&nbsp; &nbsp; &lt;tr&gt;<br>&nbsp; &nbsp; &nbsp; &nbsp; &lt;td&gt;cookie name&lt;/td&gt;<br>&nbsp; &nbsp; &nbsp; &nbsp; &lt;td&gt;value&lt;/td&gt;<br>&nbsp; &nbsp; &nbsp; &nbsp; &lt;td&gt;expiry day&lt;/td&gt;<br>&nbsp; &nbsp; &nbsp; &nbsp; &lt;td&gt;expiry date&lt;/td&gt;<br>&nbsp; &nbsp; &nbsp; &nbsp; &lt;td&gt;expiry time&lt;/td&gt;<br>&nbsp; &nbsp; &nbsp; &nbsp; &lt;td&gt;expiry timezone&lt;/td&gt;<br>&nbsp; &nbsp; &lt;/tr&gt;<br>"</span><span class="keyword">;<br></span><span class="default">$i</span><span class="keyword">=</span><span class="default">0</span><span class="keyword">;<br>foreach(</span><span class="default">$matches</span><span class="keyword">[</span><span class="default">name</span><span class="keyword">] as </span><span class="default">$cookie_name</span><span class="keyword">)<br>{<br>&nbsp; &nbsp; </span><span class="default">$table_string </span><span class="keyword">.= </span><span class="string">"<br>&nbsp; &nbsp; &lt;tr&gt;<br>&nbsp; &nbsp; &nbsp; &nbsp; &lt;td&gt;</span><span class="default">$cookie_name</span><span class="string">&lt;/td&gt;<br><br>&nbsp; &nbsp; &nbsp; &nbsp; &lt;td&gt;</span><span class="keyword">{</span><span class="default">$matches</span><span class="keyword">[</span><span class="default">value</span><span class="keyword">][</span><span class="default">$i</span><span class="keyword">]}</span><span class="string">&lt;/td&gt;<br><br>&nbsp; &nbsp; &nbsp; &nbsp; &lt;td&gt;</span><span class="keyword">{</span><span class="default">$matches</span><span class="keyword">[</span><span class="default">expiry_dayname</span><span class="keyword">][</span><span class="default">$i</span><span class="keyword">]}</span><span class="string">&lt;/td&gt;<br><br>&nbsp; &nbsp; &nbsp; &nbsp; &lt;td&gt;</span><span class="keyword">{</span><span class="default">$matches</span><span class="keyword">[</span><span class="default">expiry_day</span><span class="keyword">][</span><span class="default">$i</span><span class="keyword">]}</span><span class="string">-<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="keyword">{</span><span class="default">$matches</span><span class="keyword">[</span><span class="default">expiry_month</span><span class="keyword">][</span><span class="default">$i</span><span class="keyword">]}</span><span class="string">-<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="keyword">{</span><span class="default">$matches</span><span class="keyword">[</span><span class="default">expiry_year</span><span class="keyword">][</span><span class="default">$i</span><span class="keyword">]}</span><span class="string">&lt;/td&gt;<br><br>&nbsp; &nbsp; &nbsp; &nbsp; &lt;td&gt;</span><span class="keyword">{</span><span class="default">$matches</span><span class="keyword">[</span><span class="default">expiry_hour</span><span class="keyword">][</span><span class="default">$i</span><span class="keyword">]}</span><span class="string">:<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="keyword">{</span><span class="default">$matches</span><span class="keyword">[</span><span class="default">expiry_minute</span><span class="keyword">][</span><span class="default">$i</span><span class="keyword">]}</span><span class="string">:<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="keyword">{</span><span class="default">$matches</span><span class="keyword">[</span><span class="default">expiry_second</span><span class="keyword">][</span><span class="default">$i</span><span class="keyword">]}</span><span class="string">&lt;/td&gt;<br><br>&nbsp; &nbsp; &nbsp; &nbsp; &lt;td&gt;</span><span class="keyword">{</span><span class="default">$matches</span><span class="keyword">[</span><span class="default">expiry_zone</span><span class="keyword">][</span><span class="default">$i</span><span class="keyword">]}</span><span class="string">&lt;/td&gt;<br>&nbsp; &nbsp; &lt;/tr&gt;<br>&nbsp; &nbsp; "</span><span class="keyword">;<br>&nbsp; &nbsp; </span><span class="default">$i</span><span class="keyword">++;<br>}<br></span><span class="default">$table_string </span><span class="keyword">.= </span><span class="string">"&lt;/table&gt;"</span><span class="keyword">;<br>echo </span><span class="default">$table_string</span><span class="keyword">;<br></span><span class="default">?&gt;<br></span>/****end file2.php**/<br><br>i based this code on the following http header:<br>(obtained by going: echo $server_output; in file2.php)<br><br>HTTP/1.1 200 OK Date: Thu, 30 Jul 2009 07:10:07 GMT<br>Server: Apache/2.2.11 (Win32) DAV/2 mod_ssl/2.2.11<br>OpenSSL/0.9.8i PHP/5.2.9 X-Powered-By: PHP/5.2.9<br>Set-Cookie: cookie1=cookie+1+data; expires=Wed,<br>29-Jul-2009 03:23:27 GMT Set-Cookie<br>cookie2=cookie+2+data; expires=Wed, 29-Jul-2009 03:23:27<br>GMT Set-Cookie: cookie3=cookie+3+data; expires=Wed,<br>29-Jul-2009 03:23:27 GMT Content-Length: 196<br>Content-Type: text/html<br><br>if your header differs from this one then $pattern in file2.php<br>will need to be modified accordingly. hopefully this code will save<br>you a lot of time though!</span>
</code></div>
  </div>
 </div>
  <div class="note" id="87015">  
  <a class="name">
  <strong class="user"><em>Mark Omohundro, ajamyajax.com</em></strong></a><div class="date" title="2008-11-14 10:09"><strong>5 years ago</strong></div>
  <div class="text" id="Hcom87015">
<div class="phpcode"><code><span class="html">
Just a simple curl_exec() example with a twist: I use the familiar http response status code returned from curl_getinfo() to put either data, or a custom error message + curl_error() into a single string.&nbsp; I find this useful when the response ends up in a &lt;div&gt; or &lt;span&gt; tag.<br><br><span class="default">&lt;?php<br>curl_setopt</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">, </span><span class="default">CURLOPT_URL</span><span class="keyword">, </span><span class="default">$url</span><span class="keyword">);<br></span><span class="default">curl_setopt</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">, </span><span class="default">CURLOPT_RETURNTRANSFER</span><span class="keyword">, </span><span class="default">true</span><span class="keyword">);<br>...<br><br></span><span class="default">$output </span><span class="keyword">= </span><span class="default">curl_exec</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">);<br></span><span class="default">$info </span><span class="keyword">= </span><span class="default">curl_getinfo</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">);<br><br>if (</span><span class="default">$output </span><span class="keyword">=== </span><span class="default">false </span><span class="keyword">|| </span><span class="default">$info</span><span class="keyword">[</span><span class="string">'http_code'</span><span class="keyword">] != </span><span class="default">200</span><span class="keyword">) {<br>&nbsp; </span><span class="default">$output </span><span class="keyword">= </span><span class="string">"No cURL data returned for </span><span class="default">$url</span><span class="string"> ["</span><span class="keyword">. </span><span class="default">$info</span><span class="keyword">[</span><span class="string">'http_code'</span><span class="keyword">]. </span><span class="string">"]"</span><span class="keyword">;<br>&nbsp; if (</span><span class="default">curl_error</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">))<br>&nbsp; &nbsp; </span><span class="default">$output </span><span class="keyword">.= </span><span class="string">"\n"</span><span class="keyword">. </span><span class="default">curl_error</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">);<br>&nbsp; }<br>else {<br>&nbsp; </span><span class="comment">// 'OK' status; format $output data if necessary here:<br>&nbsp; </span><span class="keyword">...<br>}<br></span><span class="comment">// then return or display the single string $output<br></span><span class="default">?&gt;</span>
</span>
</code></div>
  </div>
 </div>
  <div class="note" id="84774">  
  <a class="name">
  <strong class="user"><em>lmshad at wp dot pl dot foo dot bar</em></strong></a><div class="date" title="2008-07-29 10:14"><strong>6 years ago</strong></div>
  <div class="text" id="Hcom84774">
<div class="phpcode"><code><span class="html">
example:<br>&nbsp;&nbsp; echo CurlTool::fetchContent('www.onet.pl');<br>&nbsp;&nbsp; CurlTool::downloadFile('<a rel="nofollow" target="_blank">http://download.gadu-gadu.pl/gg77.exe</a>', 'c:/');<br><br><span class="default">&lt;?php<br>error_reporting</span><span class="keyword">(</span><span class="default">E_STRICT </span><span class="keyword">| </span><span class="default">E_ALL</span><span class="keyword">);<br>class </span><span class="default">CurlTool </span><span class="keyword">{<br>&nbsp; &nbsp; public static </span><span class="default">$userAgents </span><span class="keyword">= array(<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="string">'FireFox3' </span><span class="keyword">=&gt; </span><span class="string">'Mozilla/5.0 (Windows; U; Windows NT 5.1; pl; rv:1.9) Gecko/2008052906 Firefox/3.0'</span><span class="keyword">,<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="string">'GoogleBot' </span><span class="keyword">=&gt; </span><span class="string">'Mozilla/5.0 (compatible; Googlebot/2.1; +<a rel="nofollow" target="_blank">http://www.google.com/bot.html</a>)'</span><span class="keyword">,<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="string">'IE7' </span><span class="keyword">=&gt; </span><span class="string">'Mozilla/4.0 (compatible; MSIE 7.0; Windows NT 6.0)'</span><span class="keyword">,<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="string">'Netscape' </span><span class="keyword">=&gt; </span><span class="string">'Mozilla/4.8 [en] (Windows NT 6.0; U)'</span><span class="keyword">,<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="string">'Opera' </span><span class="keyword">=&gt; </span><span class="string">'Opera/9.25 (Windows NT 6.0; U; en)'<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="keyword">); <br>&nbsp; &nbsp; public static </span><span class="default">$options </span><span class="keyword">= array(<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">CURLOPT_USERAGENT </span><span class="keyword">=&gt; </span><span class="string">'Mozilla/5.0 (Windows; U; Windows NT 5.1; pl; rv:1.9) Gecko/2008052906 Firefox/3.0'</span><span class="keyword">,<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">CURLOPT_AUTOREFERER </span><span class="keyword">=&gt; </span><span class="default">true</span><span class="keyword">,<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">CURLOPT_COOKIEFILE </span><span class="keyword">=&gt; </span><span class="string">''</span><span class="keyword">,<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">CURLOPT_FOLLOWLOCATION </span><span class="keyword">=&gt; </span><span class="default">true<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br>&nbsp; &nbsp; private static </span><span class="default">$proxyServers </span><span class="keyword">= array();<br>&nbsp; &nbsp; private static </span><span class="default">$proxyCount </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">;<br>&nbsp; &nbsp; private static </span><span class="default">$currentProxyIndex </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; <br>&nbsp; &nbsp; public static function </span><span class="default">addProxyServer</span><span class="keyword">(</span><span class="default">$url</span><span class="keyword">) {<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">self</span><span class="keyword">::</span><span class="default">$proxyServers</span><span class="keyword">[] = </span><span class="default">$url</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; ++</span><span class="default">self</span><span class="keyword">::</span><span class="default">$proxyCount</span><span class="keyword">;&nbsp; &nbsp; <br>&nbsp; &nbsp; }<br>&nbsp; &nbsp; <br>&nbsp; &nbsp; public static function </span><span class="default">fetchContent</span><span class="keyword">(</span><span class="default">$url</span><span class="keyword">, </span><span class="default">$verbose </span><span class="keyword">= </span><span class="default">false</span><span class="keyword">) {<br>&nbsp; &nbsp; &nbsp; &nbsp; if ((</span><span class="default">$curl </span><span class="keyword">= </span><span class="default">curl_init</span><span class="keyword">(</span><span class="default">$url</span><span class="keyword">)) == </span><span class="default">false</span><span class="keyword">) {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; throw new </span><span class="default">Exception</span><span class="keyword">(</span><span class="string">"curl_init error for url </span><span class="default">$url</span><span class="string">."</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; }<br>&nbsp; &nbsp; &nbsp; &nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; if (</span><span class="default">self</span><span class="keyword">::</span><span class="default">$proxyCount </span><span class="keyword">&gt; </span><span class="default">0</span><span class="keyword">) {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$proxy </span><span class="keyword">= </span><span class="default">self</span><span class="keyword">::</span><span class="default">$proxyServers</span><span class="keyword">[</span><span class="default">self</span><span class="keyword">::</span><span class="default">$currentProxyIndex</span><span class="keyword">++ % </span><span class="default">self</span><span class="keyword">::</span><span class="default">$proxyCount</span><span class="keyword">];<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">curl_setopt</span><span class="keyword">(</span><span class="default">$curl</span><span class="keyword">, </span><span class="default">CURLOPT_PROXY</span><span class="keyword">, </span><span class="default">$proxy</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if (</span><span class="default">$verbose </span><span class="keyword">=== </span><span class="default">true</span><span class="keyword">) {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; echo </span><span class="string">"Reading </span><span class="default">$url</span><span class="string"> [Proxy: </span><span class="default">$proxy</span><span class="string">] ... "</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br>&nbsp; &nbsp; &nbsp; &nbsp; } else if (</span><span class="default">$verbose </span><span class="keyword">=== </span><span class="default">true</span><span class="keyword">) {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; echo </span><span class="string">"Reading </span><span class="default">$url</span><span class="string"> ... "</span><span class="keyword">;&nbsp; &nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; }<br>&nbsp; &nbsp; &nbsp; &nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">curl_setopt</span><span class="keyword">(</span><span class="default">$curl</span><span class="keyword">, </span><span class="default">CURLOPT_RETURNTRANSFER</span><span class="keyword">, </span><span class="default">true</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">curl_setopt_array</span><span class="keyword">(</span><span class="default">$curl</span><span class="keyword">, </span><span class="default">self</span><span class="keyword">::</span><span class="default">$options</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$content </span><span class="keyword">= </span><span class="default">curl_exec</span><span class="keyword">(</span><span class="default">$curl</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; if (</span><span class="default">$content </span><span class="keyword">=== </span><span class="default">false</span><span class="keyword">) {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; throw new </span><span class="default">Exception</span><span class="keyword">(</span><span class="string">"curl_exec error for url </span><span class="default">$url</span><span class="string">."</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; }<br>&nbsp; &nbsp; &nbsp; &nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">curl_close</span><span class="keyword">(</span><span class="default">$curl</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; if (</span><span class="default">$verbose </span><span class="keyword">=== </span><span class="default">true</span><span class="keyword">) {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; echo </span><span class="string">"Done.\n"</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; }<br>&nbsp; &nbsp; &nbsp; &nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$content </span><span class="keyword">= </span><span class="default">preg_replace</span><span class="keyword">(</span><span class="string">'#\n+#'</span><span class="keyword">, </span><span class="string">' '</span><span class="keyword">, </span><span class="default">$content</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$content </span><span class="keyword">= </span><span class="default">preg_replace</span><span class="keyword">(</span><span class="string">'#\s+#'</span><span class="keyword">, </span><span class="string">' '</span><span class="keyword">, </span><span class="default">$content</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; return </span><span class="default">$content</span><span class="keyword">;<br>&nbsp; &nbsp; }<br>&nbsp; &nbsp; <br>&nbsp; &nbsp; public static function </span><span class="default">downloadFile</span><span class="keyword">(</span><span class="default">$url</span><span class="keyword">, </span><span class="default">$fileName</span><span class="keyword">, </span><span class="default">$verbose </span><span class="keyword">= </span><span class="default">false</span><span class="keyword">) {<br>&nbsp; &nbsp; &nbsp; &nbsp; if ((</span><span class="default">$curl </span><span class="keyword">= </span><span class="default">curl_init</span><span class="keyword">(</span><span class="default">$url</span><span class="keyword">)) == </span><span class="default">false</span><span class="keyword">) {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; throw new </span><span class="default">Exception</span><span class="keyword">(</span><span class="string">"curl_init error for url </span><span class="default">$url</span><span class="string">."</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; }<br>&nbsp; &nbsp; &nbsp; &nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; if (</span><span class="default">self</span><span class="keyword">::</span><span class="default">$proxyCount </span><span class="keyword">&gt; </span><span class="default">0</span><span class="keyword">) {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$proxy </span><span class="keyword">= </span><span class="default">self</span><span class="keyword">::</span><span class="default">$proxyServers</span><span class="keyword">[</span><span class="default">self</span><span class="keyword">::</span><span class="default">$currentProxyIndex</span><span class="keyword">++ % </span><span class="default">self</span><span class="keyword">::</span><span class="default">$proxyCount</span><span class="keyword">];<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">curl_setopt</span><span class="keyword">(</span><span class="default">$curl</span><span class="keyword">, </span><span class="default">CURLOPT_PROXY</span><span class="keyword">, </span><span class="default">$proxy</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if (</span><span class="default">$verbose </span><span class="keyword">=== </span><span class="default">true</span><span class="keyword">) {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; echo </span><span class="string">"Downloading </span><span class="default">$url</span><span class="string"> [Proxy: </span><span class="default">$proxy</span><span class="string">] ... "</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br>&nbsp; &nbsp; &nbsp; &nbsp; } else if (</span><span class="default">$verbose </span><span class="keyword">=== </span><span class="default">true</span><span class="keyword">) {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; echo </span><span class="string">"Downloading </span><span class="default">$url</span><span class="string"> ... "</span><span class="keyword">;&nbsp; &nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; }<br>&nbsp; &nbsp; &nbsp; &nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">curl_setopt_array</span><span class="keyword">(</span><span class="default">$curl</span><span class="keyword">, </span><span class="default">self</span><span class="keyword">::</span><span class="default">$options</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; if (</span><span class="default">substr</span><span class="keyword">(</span><span class="default">$fileName</span><span class="keyword">, -</span><span class="default">1</span><span class="keyword">) == </span><span class="string">'/'</span><span class="keyword">) {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$targetDir </span><span class="keyword">= </span><span class="default">$fileName</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$fileName </span><span class="keyword">= </span><span class="default">tempnam</span><span class="keyword">(</span><span class="default">sys_get_temp_dir</span><span class="keyword">(), </span><span class="string">'c_'</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; }<br>&nbsp; &nbsp; &nbsp; &nbsp; if ((</span><span class="default">$fp </span><span class="keyword">= </span><span class="default">fopen</span><span class="keyword">(</span><span class="default">$fileName</span><span class="keyword">, </span><span class="string">"wb"</span><span class="keyword">)) === </span><span class="default">false</span><span class="keyword">) {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; throw new </span><span class="default">Exception</span><span class="keyword">(</span><span class="string">"fopen error for filename </span><span class="default">$fileName</span><span class="string">"</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; }<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">curl_setopt</span><span class="keyword">(</span><span class="default">$curl</span><span class="keyword">, </span><span class="default">CURLOPT_FILE</span><span class="keyword">, </span><span class="default">$fp</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">curl_setopt</span><span class="keyword">(</span><span class="default">$curl</span><span class="keyword">, </span><span class="default">CURLOPT_BINARYTRANSFER</span><span class="keyword">, </span><span class="default">true</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; if (</span><span class="default">curl_exec</span><span class="keyword">(</span><span class="default">$curl</span><span class="keyword">) === </span><span class="default">false</span><span class="keyword">) {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">fclose</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">unlink</span><span class="keyword">(</span><span class="default">$fileName</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; throw new </span><span class="default">Exception</span><span class="keyword">(</span><span class="string">"curl_exec error for url </span><span class="default">$url</span><span class="string">."</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; } elseif (isset(</span><span class="default">$targetDir</span><span class="keyword">)) {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$eurl </span><span class="keyword">= </span><span class="default">curl_getinfo</span><span class="keyword">(</span><span class="default">$curl</span><span class="keyword">, </span><span class="default">CURLINFO_EFFECTIVE_URL</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">preg_match</span><span class="keyword">(</span><span class="string">'#^.*/(.+)$#'</span><span class="keyword">, </span><span class="default">$eurl</span><span class="keyword">, </span><span class="default">$match</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">fclose</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">rename</span><span class="keyword">(</span><span class="default">$fileName</span><span class="keyword">, </span><span class="string">"</span><span class="default">$targetDir</span><span class="keyword">{</span><span class="default">$match</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">]}</span><span class="string">"</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$fileName </span><span class="keyword">= </span><span class="string">"</span><span class="default">$targetDir</span><span class="keyword">{</span><span class="default">$match</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">]}</span><span class="string">"</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; } else {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">fclose</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; }<br>&nbsp; &nbsp; &nbsp; &nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">curl_close</span><span class="keyword">(</span><span class="default">$curl</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; if (</span><span class="default">$verbose </span><span class="keyword">=== </span><span class="default">true</span><span class="keyword">) {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; echo </span><span class="string">"Done.\n"</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; }<br>&nbsp; &nbsp; &nbsp; &nbsp; return </span><span class="default">$fileName</span><span class="keyword">;<br>&nbsp; &nbsp; }&nbsp; &nbsp; <br>}<br></span><span class="default">?&gt;</span>
</span>
</code></div>
  </div>
 </div>
  <div class="note" id="83676">  
  <a class="name">
  <strong class="user"><em>alan at forsyth dot cz</em></strong></a><div class="date" title="2008-06-06 03:59"><strong>6 years ago</strong></div>
  <div class="text" id="Hcom83676">
<div class="phpcode"><code><span class="html">
Great class Roman - just one fix:<br><br>Replace the following line:<br><span class="default">&lt;?php<br></span><span class="keyword">if (isset(</span><span class="default">$params</span><span class="keyword">[</span><span class="string">'host'</span><span class="keyword">]) &amp;&amp; </span><span class="default">$params</span><span class="keyword">[</span><span class="string">'host'</span><span class="keyword">])&nbsp; &nbsp; &nbsp; </span><span class="default">$header</span><span class="keyword">[]=</span><span class="string">"Host: "</span><span class="keyword">.</span><span class="default">$host</span><span class="keyword">;<br></span><span class="default">?&gt;<br></span><br>with this:<br><span class="default">&lt;?php<br></span><span class="keyword">if (isset(</span><span class="default">$params</span><span class="keyword">[</span><span class="string">'host'</span><span class="keyword">]) &amp;&amp; </span><span class="default">$params</span><span class="keyword">[</span><span class="string">'host'</span><span class="keyword">])&nbsp; &nbsp; &nbsp; </span><span class="default">$header</span><span class="keyword">[]=</span><span class="string">"Host: " </span><span class="keyword">. </span><span class="default">$params</span><span class="keyword">[</span><span class="string">'host'</span><span class="keyword">];<br></span><span class="default">?&gt;<br></span><br>CURL automatically creates the host parameter (since it is required for HTTP/1.1 requests), so you don't need to set it. But if you created a custom host parameter, the above bug would cause a '400 Bad Request' response due to invalid host specified.<br><br>Also when copying and pasting the class code, make sure that no line breaks occur (for example in the $header and $user_agent definitions etc.). It will still be valid PHP, but the HTTP request will not be valid, and you may get a '400 Bad Request' response from the server.<br><br>It took me a little playing around with an HTTP Sniffer before I finally got an HTTP POST request fully working!<br><br>Thanks,<br>Alan</span>
</code></div>
  </div>
 </div>
  <div class="note" id="113876">  
  <a class="name">
  <strong class="user"><em>Manu Manjunath</em></strong></a><div class="date" title="2013-12-12 01:24"><strong>8 months ago</strong></div>
  <div class="text" id="Hcom113876">
<div class="phpcode"><code><span class="html">
If you want to get contents of a page through HTTP GET or POST,&nbsp; you can write a small function like below.<br><br><span class="default">&lt;?php<br></span><span class="comment">/**<br> * Read entire contents of a URL in a string<br> * @param string $url URL to fetch data from<br> * @param mixed $params Parameters to the URL, typically an array. In case of POST, can be a string<br> * @param string $method HTTP method - can be 'GET' (default) or 'POST'<br> * @return mixed Contents of the webpage. Returns &lt;i&gt;false&lt;/i&gt; in case of failure.<br> */<br></span><span class="keyword">function </span><span class="default">url_get_contents</span><span class="keyword">(</span><span class="default">$url</span><span class="keyword">, </span><span class="default">$params </span><span class="keyword">= </span><span class="default">null</span><span class="keyword">, </span><span class="default">$method </span><span class="keyword">= </span><span class="string">'GET'</span><span class="keyword">) {<br>&nbsp; &nbsp; </span><span class="default">$contents </span><span class="keyword">= </span><span class="default">false</span><span class="keyword">;<br>&nbsp; &nbsp; if (!</span><span class="default">in_array</span><span class="keyword">(</span><span class="default">$method</span><span class="keyword">, array(</span><span class="string">'GET'</span><span class="keyword">, </span><span class="string">'POST'</span><span class="keyword">))) {<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">error_log</span><span class="keyword">(</span><span class="default">__FUNCTION__ </span><span class="keyword">. </span><span class="string">": Unknown method '</span><span class="default">$method</span><span class="string">'"</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; return </span><span class="default">false</span><span class="keyword">;<br>&nbsp; &nbsp; }<br>&nbsp; &nbsp; if (</span><span class="default">$method </span><span class="keyword">== </span><span class="string">'GET'</span><span class="keyword">) {<br>&nbsp; &nbsp; &nbsp; &nbsp; if (</span><span class="default">is_array</span><span class="keyword">(</span><span class="default">$params</span><span class="keyword">) &amp;&amp; </span><span class="default">count</span><span class="keyword">(</span><span class="default">$params</span><span class="keyword">) &gt; </span><span class="default">0</span><span class="keyword">) {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if (</span><span class="default">$params </span><span class="keyword">=== </span><span class="default">array_values</span><span class="keyword">(</span><span class="default">$params</span><span class="keyword">)) {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">error_log</span><span class="keyword">(</span><span class="default">__FUNCTION__ </span><span class="keyword">. </span><span class="string">": Numerical array recieved for argument '\$params' (assoc array expected)"</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; return </span><span class="default">false</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; else {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$url </span><span class="keyword">.= </span><span class="string">'?' </span><span class="keyword">. </span><span class="default">http_build_query</span><span class="keyword">(</span><span class="default">$params</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br>&nbsp; &nbsp; &nbsp; &nbsp; }<br>&nbsp; &nbsp; &nbsp; &nbsp; elseif (!</span><span class="default">is_null</span><span class="keyword">(</span><span class="default">$params</span><span class="keyword">)) {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">error_log</span><span class="keyword">(</span><span class="default">__FUNCTION__ </span><span class="keyword">. </span><span class="string">": If you're making a GET request, argument \$params must be null or assoc array."</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; return </span><span class="default">false</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; }<br>&nbsp; &nbsp; }<br>&nbsp; &nbsp; </span><span class="default">$ch </span><span class="keyword">= </span><span class="default">curl_init</span><span class="keyword">(</span><span class="default">$url</span><span class="keyword">);<br>&nbsp; &nbsp; if (</span><span class="default">$ch </span><span class="keyword">!== </span><span class="default">false</span><span class="keyword">) {<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">curl_setopt_array</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">, array(<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">CURLOPT_HEADER </span><span class="keyword">=&gt; </span><span class="default">false</span><span class="keyword">,<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">CURLOPT_RETURNTRANSFER </span><span class="keyword">=&gt; </span><span class="default">true</span><span class="keyword">,<br>&nbsp; &nbsp; &nbsp; &nbsp; ));<br>&nbsp; &nbsp; &nbsp; &nbsp; if (</span><span class="default">$method </span><span class="keyword">== </span><span class="string">'POST'</span><span class="keyword">) {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">curl_setopt</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">, </span><span class="default">CURLOPT_POST</span><span class="keyword">, </span><span class="default">true</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if (</span><span class="default">is_string</span><span class="keyword">(</span><span class="default">$params</span><span class="keyword">) || </span><span class="default">is_array</span><span class="keyword">(</span><span class="default">$params</span><span class="keyword">)) {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">curl_setopt</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">, </span><span class="default">CURLOPT_POSTFIELDS</span><span class="keyword">, </span><span class="default">$params</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; else {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">error_log</span><span class="keyword">(</span><span class="default">__FUNCTION__ </span><span class="keyword">. </span><span class="string">": Argument \$params should be an array of parameters or (if you want to send raw data) a string"</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; return </span><span class="default">false</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br>&nbsp; &nbsp; &nbsp; &nbsp; }<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$contents </span><span class="keyword">= </span><span class="default">curl_exec</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">curl_close</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">);<br>&nbsp; &nbsp; }<br>&nbsp; &nbsp; return </span><span class="default">$contents</span><span class="keyword">;<br>}</span>
</span>
</code></div>
  </div>
 </div>
  <div class="note" id="79572">  
  <a class="name">
  <strong class="user"><em>me at lawrencemok dot com</em></strong></a><div class="date" title="2007-12-03 11:52"><strong>6 years ago</strong></div>
  <div class="text" id="Hcom79572">
<div class="phpcode"><code><span class="html">
Note that when you use CURL to POST things....e.g:<br><br>curl_setopt($ch, CURLOPT_POSTFIELDS, "string=This is a string"); <br><br>The data part (e.g. "This is a string") inside the 3rd parameter should be applied with urlencode()<br><br>Otherwise, if you intend to send a string like "%2F", you will end up with a "/" on the receiving end, which can cause troubles. (e.g. serialize() data cannot be unserialize() becase of the change in string length).</span>
</code></div>
  </div>
 </div>
  <div class="note" id="77167">  
  <a class="name">
  <strong class="user"><em>shanto at ultimawebsolutions dot com</em></strong></a><div class="date" title="2007-08-17 09:01"><strong>7 years ago</strong></div>
  <div class="text" id="Hcom77167">
<div class="phpcode"><code><span class="html">
A function to retrieve the status code of an HTTP request using CURL:<br><br>&nbsp; &nbsp; function getHttpResponseCode($url)<br>&nbsp; &nbsp; {<br>&nbsp; &nbsp; &nbsp; &nbsp; $ch = @curl_init($url);<br>&nbsp; &nbsp; &nbsp; &nbsp; @curl_setopt($ch, CURLOPT_HEADER, TRUE);<br>&nbsp; &nbsp; &nbsp; &nbsp; @curl_setopt($ch, CURLOPT_NOBODY, TRUE);<br>&nbsp; &nbsp; &nbsp; &nbsp; @curl_setopt($ch, CURLOPT_FOLLOWLOCATION, FALSE);<br>&nbsp; &nbsp; &nbsp; &nbsp; @curl_setopt($ch, CURLOPT_RETURNTRANSFER, TRUE);<br>&nbsp; &nbsp; &nbsp; &nbsp; $status = array();<br>&nbsp; &nbsp; &nbsp; &nbsp; $response = @curl_exec($ch);<br>&nbsp; &nbsp; &nbsp; &nbsp; preg_match('/HTTP\/.* ([0-9]+) .*/', $response, $status);<br>&nbsp; &nbsp; &nbsp; &nbsp; return $status[1];<br>&nbsp; &nbsp; }</span>
</code></div>
  </div>
 </div>
  <div class="note" id="70198">  
  <a class="name">
  <strong class="user"><em>lukasl at ackleymedia dot com</em></strong></a><div class="date" title="2006-10-06 07:52"><strong>7 years ago</strong></div>
  <div class="text" id="Hcom70198">
<div class="phpcode"><code><span class="html">
Thank you for sharing this.&nbsp; I was wondering why my result was 1.<br><br>To get around this in a safe way, this is how I check if the result is valid.<br><br>$ch = curl_init(); /// initialize a cURL session <br>curl_setopt ($ch, CURLOPT_RETURNTRANSFER, true);<br>$xmlResponse = curl_exec ($ch);<br>curl_close ($ch);<br><br>if (!is_string($xmlResponse) || !strlen($xmlResponse)) {<br>&nbsp; &nbsp; return $this-&gt;_set_error( "Failure Contacting Server" );<br>} else {<br>&nbsp; &nbsp; return $xmlResponse;<br>}</span>
</code></div>
  </div>
 </div>
  <div class="note" id="70123">  
  <a class="name"><strong class="user"><em>Anonymous</em></strong></a><div class="date" title="2006-10-04 01:41"><strong>7 years ago</strong></div>
  <div class="text" id="Hcom70123">
<div class="phpcode"><code><span class="html">
Be careful when using curl_exec() and the CURLOPT_RETURNTRANSFER option. According to the manual and assorted documentation:<br>Set CURLOPT_RETURNTRANSFER to TRUE to return the transfer as a string of the return value of curl_exec() instead of outputting it out directly.<br><br>When retrieving a document with no content (ie. 0 byte file), curl_exec() will return bool(true), not an empty string. I've not seen any mention of this in the manual.<br><br>Example code to reproduce this:<br><span class="default">&lt;?php<br><br>&nbsp; &nbsp; </span><span class="comment">// fictional URL to an existing file with no data in it (ie. 0 byte file)<br>&nbsp; &nbsp; </span><span class="default">$url </span><span class="keyword">= </span><span class="string">'<a rel="nofollow" target="_blank">http://www.example.com/empty_file.txt</a>'</span><span class="keyword">;<br><br>&nbsp; &nbsp; </span><span class="default">$curl </span><span class="keyword">= </span><span class="default">curl_init</span><span class="keyword">();<br>&nbsp; &nbsp; <br>&nbsp; &nbsp; </span><span class="default">curl_setopt</span><span class="keyword">(</span><span class="default">$curl</span><span class="keyword">, </span><span class="default">CURLOPT_URL</span><span class="keyword">, </span><span class="default">$url</span><span class="keyword">);<br>&nbsp; &nbsp; </span><span class="default">curl_setopt</span><span class="keyword">(</span><span class="default">$curl</span><span class="keyword">, </span><span class="default">CURLOPT_RETURNTRANSFER</span><span class="keyword">, </span><span class="default">true</span><span class="keyword">);<br>&nbsp; &nbsp; </span><span class="default">curl_setopt</span><span class="keyword">(</span><span class="default">$curl</span><span class="keyword">, </span><span class="default">CURLOPT_HEADER</span><span class="keyword">, </span><span class="default">false</span><span class="keyword">);<br><br>&nbsp; &nbsp; </span><span class="comment">// execute and return string (this should be an empty string '')<br>&nbsp; &nbsp; </span><span class="default">$str </span><span class="keyword">= </span><span class="default">curl_exec</span><span class="keyword">(</span><span class="default">$curl</span><span class="keyword">);<br><br>&nbsp; &nbsp; </span><span class="default">curl_close</span><span class="keyword">(</span><span class="default">$curl</span><span class="keyword">);<br><br>&nbsp; &nbsp; </span><span class="comment">// the value of $str is actually bool(true), not empty string ''<br>&nbsp; &nbsp; </span><span class="default">var_dump</span><span class="keyword">(</span><span class="default">$str</span><span class="keyword">);<br><br></span><span class="default">?&gt;</span>
</span>
</code></div>
  </div>
 </div>
  <div class="note" id="50734">  
  <a class="name">
  <strong class="user"><em></em></strong></a><div class="date" title="2005-03-08 06:12"><strong>9 years ago</strong></div>
  <div class="text" id="Hcom50734">
<div class="phpcode"><code><span class="html">
If you've got problems with curl_exec not working, you should rather check curl_errno and curl_error than using commandline curl, like so:<br><br>(since this is easier, and also allows you to check for errors runtime, which is a vital part of any well-design piece of code. ;)<br><br><span class="default">&lt;?php<br>$creq </span><span class="keyword">= </span><span class="default">curl_init</span><span class="keyword">();<br></span><span class="default">curl_setopt</span><span class="keyword">(</span><span class="default">$creq</span><span class="keyword">, </span><span class="default">CURLOPT_URL</span><span class="keyword">, </span><span class="string">"<a rel="nofollow" target="_blank">http://www.foo.internal</a>"</span><span class="keyword">);<br></span><span class="default">curl_exec</span><span class="keyword">(</span><span class="default">$creq</span><span class="keyword">);<br><br></span><span class="comment">/* To quote curl_errno documentation:<br>&nbsp; &nbsp;&nbsp; Returns the error number for the last cURL operation on the resource ch, or 0 (zero) if no error occurred. */<br></span><span class="keyword">if (</span><span class="default">curl_errno</span><span class="keyword">(</span><span class="default">$creq</span><span class="keyword">)) {<br>&nbsp; &nbsp; print </span><span class="default">curl_error</span><span class="keyword">(</span><span class="default">$creq</span><span class="keyword">);<br>} else {<br>&nbsp; &nbsp; </span><span class="default">curl_close</span><span class="keyword">(</span><span class="default">$creq</span><span class="keyword">);<br>}<br></span><span class="default">?&gt;</span>
</span>
</code></div>
  </div>
 </div>
  <div class="note" id="33582">  
  <a class="name">
  <strong class="user"><em>sybren at thirdtower dot com</em></strong></a><div class="date" title="2003-07-01 07:00"><strong>11 years ago</strong></div>
  <div class="text" id="Hcom33582">
<div class="phpcode"><code><span class="html">
If you see a "0" at the end of the output, you might want to switch to HTTP/1.0:<br><br>curl_setopt($ch, CURLOPT_HTTP_VERSION, 1.0);</span>
</code></div>
  </div>
 </div>
  <div class="note" id="20998">  
  <a class="name">
  <strong class="user"><em>colins at infofind dot com</em></strong></a><div class="date" title="2002-04-24 04:42"><strong>12 years ago</strong></div>
  <div class="text" id="Hcom20998">
<div class="phpcode"><code><span class="html">
Checking the source, curl_exec seems to return FALSE on failure, TRUE on success (unless CURLOPT_RETURNTRANSFER is set 1, and then it returns the returned data).</span>
</code></div>
  </div>
 </div>
  <div class="note" id="109653">  
  <a class="name">
  <strong class="user"><em>bertram dot pereira at gmail dot com</em></strong></a><div class="date" title="2012-08-05 11:48"><strong>2 years ago</strong></div>
  <div class="text" id="Hcom109653">
<div class="phpcode"><code><span class="html">
There will be times when you need to get the response from curl_exec and capture the transfer - this is not very well documented but you can do so with the CURLOPT_RETURNTRANSFER Option <br><br>curl_setopt($ch, CURLOPT_RETURNTRANSFER, TRUE); <br><br>Bert</span>
</code></div>
  </div>
 </div>
  <div class="note" id="13020">  
  <a class="name">
  <strong class="user"><em>csaba at alum dot mit dot edu</em></strong></a><div class="date" title="2001-05-22 01:06"><strong>13 years ago</strong></div>
  <div class="text" id="Hcom13020">
<div class="phpcode"><code><span class="html">
If you retrieve a web page and print it (so you can see it in your browser), and the page has an expiration, this expiration now applies to MyProgram.php and next time your program/page is called, even if it's grabbing a different web page, it will show what it just displayed.&nbsp; In Netscape you can get rid of this by going into Edit, Options, Advanced, Cache, and clear out the Disk Cache.&nbsp; But this is really annoying after short order.&nbsp; The following prevents the above scenario:
<br>
<br><span class="default">&lt;?php
<br></span><span class="keyword">function </span><span class="default">GetCurlPage </span><span class="keyword">(</span><span class="default">$pageSpec</span><span class="keyword">) {
<br>&nbsp; &nbsp; </span><span class="default">$ch </span><span class="keyword">= </span><span class="default">curl_init</span><span class="keyword">(</span><span class="default">$pageSpec</span><span class="keyword">);
<br>&nbsp; &nbsp; </span><span class="default">curl_setopt</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">, </span><span class="default">CURLOPT_RETURNTRANSFER</span><span class="keyword">, </span><span class="default">1</span><span class="keyword">);
<br>&nbsp; &nbsp; </span><span class="default">$tmp </span><span class="keyword">= </span><span class="default">curl_exec </span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">); 
<br>&nbsp; &nbsp; </span><span class="default">curl_close </span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">); 
<br></span><span class="comment">// if you intend to print this page, better clear out expiration tag
<br>&nbsp; &nbsp; </span><span class="default">$tmp </span><span class="keyword">= </span><span class="default">preg_replace</span><span class="keyword">(</span><span class="string">'/(?s)&lt;meta http-equiv="Expires"[^&gt;]*&gt;/i'</span><span class="keyword">, </span><span class="string">''</span><span class="keyword">, </span><span class="default">$tmp</span><span class="keyword">);
<br>&nbsp; &nbsp; return </span><span class="default">$tmp</span><span class="keyword">;
<br>}
<br></span><span class="default">?&gt;</span>
</span>
</code></div>
  </div>
 </div></div>

 
</section>    </section><!-- layout-content -->
        


  </div><!-- layout -->
         
  

    
 <!-- External and third party libraries. -->
 







<a id="toTop" href="javascript:;"><span id="toTopHover"></span><img width="40" height="40" alt="To Top" src="../../images/to-top%402x.png"></a>



<!-- Mirrored from php.net/manual/en/function.curl-exec.php by HTTrack Website Copier/3.x [XR&CO'2013], Thu, 28 Aug 2014 15:59:23 GMT -->


</body></html>