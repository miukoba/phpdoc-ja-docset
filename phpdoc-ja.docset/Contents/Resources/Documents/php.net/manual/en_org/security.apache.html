<html><!-- Mirrored from php.net/manual/en/security.apache.php by HTTrack Website Copier/3.x [XR&CO'2013], Thu, 28 Aug 2014 15:20:53 GMT --><!-- Added by HTTrack --><head><meta http-equiv="content-type" content="text/html;charset=utf-8"><!-- /Added by HTTrack -->


  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0"> 

  <title>Installed as an Apache module</title>

 <link rel="shortcut icon" href="../../favicon.ico">
 <link rel="search" type="application/opensearchdescription+xml" href="http://php.net/phpnetimprovedsearch.src" title="Add PHP.net search">
 <link rel="alternate" type="application/atom+xml" href="http://php.net/releases/feed.php" title="PHP Release feed">
 <link rel="alternate" type="application/atom+xml" href="http://php.net/feed.atom" title="PHP: Hypertext Preprocessor">

 <link rel="canonical" href="security.apache.html">
 <link rel="shorturl" href="security.apache.html">
 <link rel="alternate" href="security.apache.html" hreflang="x-default">

 <link rel="contents" href="index-2.html">
 <link rel="index" href="security.html">
 <link rel="prev" href="security.cgi-bin.shell.html">
 <link rel="next" href="security.filesystem.html">

 <link rel="alternate" href="security.apache.html" hreflang="en">
 <link rel="alternate" href="http://php.net/manual/pt_BR/security.apache.php" hreflang="pt_BR">
 <link rel="alternate" href="http://php.net/manual/zh/security.apache.php" hreflang="zh">
 <link rel="alternate" href="http://php.net/manual/fr/security.apache.php" hreflang="fr">
 <link rel="alternate" href="http://php.net/manual/de/security.apache.php" hreflang="de">
 <link rel="alternate" href="http://php.net/manual/it/security.apache.php" hreflang="it">
 <link rel="alternate" href="http://php.net/manual/ja/security.apache.php" hreflang="ja">
 <link rel="alternate" href="http://php.net/manual/ro/security.apache.php" hreflang="ro">
 <link rel="alternate" href="http://php.net/manual/ru/security.apache.php" hreflang="ru">
 <link rel="alternate" href="http://php.net/manual/es/security.apache.php" hreflang="es">
 <link rel="alternate" href="http://php.net/manual/tr/security.apache.php" hreflang="tr">

<link rel="stylesheet" type="text/css" href="../../cached8fe1.css?t=1401250819&amp;f=/fonts/Fira/fira.css" media="screen">
<link rel="stylesheet" type="text/css" href="../../cached4b8d.css?t=1404368420&amp;f=/fonts/Font-Awesome/css/fontello.css" media="screen">
<link rel="stylesheet" type="text/css" href="../../cached5065.css?t=1403329232&amp;f=/styles/theme-base.css" media="screen">
<link rel="stylesheet" type="text/css" href="../../cachedc78d.css?t=1401249623&amp;f=/styles/theme-medium.css" media="screen">

 <!--[if lte IE 7]>
 <link rel="stylesheet" type="text/css" href="http://php.net/styles/workarounds.ie7.css" media="screen">
 <![endif]-->

 <!--[if lte IE 8]>
 <script type="text/javascript">
  window.brokenIE = true;
 </script>
 <![endif]-->

 <!--[if lte IE 9]>
 <link rel="stylesheet" type="text/css" href="http://php.net/styles/workarounds.ie9.css" media="screen">
 <![endif]-->

 <!--[if IE]>
 <script type="text/javascript" src="http://php.net/js/ext/html5.js"></script>
 <![endif]-->

 <base>

</head>
<body class="docs " style="">


<div class="headsup"><a href="http://php.net/index.php#id2014-08-28-1">PHP 5.6.0 released</a></div>
<nav id="trick"><div><dl>
<dt><a href="getting-started.html">Getting Started</a></dt>
	<dd><a href="introduction.html">Introduction</a></dd>
	<dd><a href="tutorial.html">A simple tutorial</a></dd>
<dt><a href="langref.html">Language Reference</a></dt>
	<dd><a href="language.basic-syntax.html">Basic syntax</a></dd>
	<dd><a href="language.types.html">Types</a></dd>
	<dd><a href="language.variables.html">Variables</a></dd>
	<dd><a href="language.constants.html">Constants</a></dd>
	<dd><a href="language.expressions.html">Expressions</a></dd>
	<dd><a href="language.operators.html">Operators</a></dd>
	<dd><a href="language.control-structures.html">Control Structures</a></dd>
	<dd><a href="language.functions.html">Functions</a></dd>
	<dd><a href="language.oop5.html">Classes and Objects</a></dd>
	<dd><a href="language.namespaces.html">Namespaces</a></dd>
	<dd><a href="language.exceptions.html">Exceptions</a></dd>
	<dd><a href="language.generators.html">Generators</a></dd>
	<dd><a href="language.references.html">References Explained</a></dd>
	<dd><a href="reserved.variables.html">Predefined Variables</a></dd>
	<dd><a href="reserved.exceptions.html">Predefined Exceptions</a></dd>
	<dd><a href="reserved.interfaces.html">Predefined Interfaces and Classes</a></dd>
	<dd><a href="context.html">Context options and parameters</a></dd>
	<dd><a href="wrappers.html">Supported Protocols and Wrappers</a></dd>
</dl>
<dl>
<dt><a href="security.html">Security</a></dt>
	<dd><a href="security.intro.html">Introduction</a></dd>
	<dd><a href="security.general.html">General considerations</a></dd>
	<dd><a href="security.cgi-bin.html">Installed as CGI binary</a></dd>
	<dd><a href="security.apache.html">Installed as an Apache module</a></dd>
	<dd><a href="security.filesystem.html">Filesystem Security</a></dd>
	<dd><a href="security.database.html">Database Security</a></dd>
	<dd><a href="security.errors.html">Error Reporting</a></dd>
	<dd><a href="security.globals.html">Using Register Globals</a></dd>
	<dd><a href="security.variables.html">User Submitted Data</a></dd>
	<dd><a href="security.magicquotes.html">Magic Quotes</a></dd>
	<dd><a href="security.hiding.html">Hiding PHP</a></dd>
	<dd><a href="security.current.html">Keeping Current</a></dd>
<dt><a href="features.html">Features</a></dt>
	<dd><a href="features.http-auth.html">HTTP authentication with PHP</a></dd>
	<dd><a href="features.cookies.html">Cookies</a></dd>
	<dd><a href="features.sessions.html">Sessions</a></dd>
	<dd><a href="features.xforms.html">Dealing with XForms</a></dd>
	<dd><a href="features.file-upload.html">Handling file uploads</a></dd>
	<dd><a href="features.remote-files.html">Using remote files</a></dd>
	<dd><a href="features.connection-handling.html">Connection handling</a></dd>
	<dd><a href="features.persistent-connections.html">Persistent Database Connections</a></dd>
	<dd><a href="features.safe-mode.html">Safe Mode</a></dd>
	<dd><a href="features.commandline.html">Command line usage</a></dd>
	<dd><a href="features.gc.html">Garbage Collection</a></dd>
	<dd><a href="features.dtrace.html">DTrace Dynamic Tracing</a></dd>
</dl>
<dl>
<dt><a href="funcref.html">Function Reference</a></dt>
	<dd><a href="refs.basic.php.html">Affecting PHP's Behaviour</a></dd>
	<dd><a href="refs.utilspec.audio.html">Audio Formats Manipulation</a></dd>
	<dd><a href="refs.remote.auth.html">Authentication Services</a></dd>
	<dd><a href="refs.utilspec.cmdline.html">Command Line Specific Extensions</a></dd>
	<dd><a href="refs.compression.html">Compression and Archive Extensions</a></dd>
	<dd><a href="refs.creditcard.html">Credit Card Processing</a></dd>
	<dd><a href="refs.crypto.html">Cryptography Extensions</a></dd>
	<dd><a href="refs.database.html">Database Extensions</a></dd>
	<dd><a href="refs.calendar.html">Date and Time Related Extensions</a></dd>
	<dd><a href="refs.fileprocess.file.html">File System Related Extensions</a></dd>
	<dd><a href="refs.international.html">Human Language and Character Encoding Support</a></dd>
	<dd><a href="refs.utilspec.image.html">Image Processing and Generation</a></dd>
	<dd><a href="refs.remote.mail.html">Mail Related Extensions</a></dd>
	<dd><a href="refs.math.html">Mathematical Extensions</a></dd>
	<dd><a href="refs.utilspec.nontext.html">Non-Text MIME Output</a></dd>
	<dd><a href="refs.fileprocess.process.html">Process Control Extensions</a></dd>
	<dd><a href="refs.basic.other.html">Other Basic Extensions</a></dd>
	<dd><a href="refs.remote.other.html">Other Services</a></dd>
	<dd><a href="refs.search.html">Search Engine Extensions</a></dd>
	<dd><a href="refs.utilspec.server.html">Server Specific Extensions</a></dd>
	<dd><a href="refs.basic.session.html">Session Extensions</a></dd>
	<dd><a href="refs.basic.text.html">Text Processing</a></dd>
	<dd><a href="refs.basic.vartype.html">Variable and Type Related Extensions</a></dd>
	<dd><a href="refs.webservice.html">Web Services</a></dd>
	<dd><a href="refs.utilspec.windows.html">Windows Only Extensions</a></dd>
	<dd><a href="refs.xml.html">XML Manipulation</a></dd>
</dl>
<dl>
<dt>Keyboard Shortcuts</dt><dt>?</dt>
<dd>This help</dd>
<dt>j</dt>
<dd>Next menu item</dd>
<dt>k</dt>
<dd>Previous menu item</dd>
<dt>g p</dt>
<dd>Previous man page</dd>
<dt>g n</dt>
<dd>Next man page</dd>
<dt>G</dt>
<dd>Scroll to bottom</dd>
<dt>g g</dt>
<dd>Scroll to top</dd>
<dt>g h</dt>
<dd>Goto homepage</dd>
<dt>g s</dt>
<dd>Goto search<br>(current page)</dd>
<dt>/</dt>
<dd>Focus search box</dd>
</dl></div></nav>
<div id="goto">
    <div class="search">
         <div class="text"></div>
         <div class="results"><ul></ul></div>
   </div>
</div>

  <div id="breadcrumbs" class="row-fluid">
          
              
        <ul class="breadcrumbs-container">
            <li><a href="index-2.html">PHP Manual</a></li>      <li><a href="security.html">Security</a></li>    </ul>
  </div>




<div id="layout">
  <section id="layout-content">
  <div id="security.apache" class="chapter">
   <h1>Installed as an Apache module</h1>

   <p class="simpara">
    When <acronym title="PHP: Hypertext Preprocessor">PHP</acronym> is used as an Apache module it inherits Apache's user
    permissions (typically those of the "nobody" user). This has several
    impacts on security and authorization. For example, if you are using
    <acronym title="PHP: Hypertext Preprocessor">PHP</acronym> to access a database, unless that database has built-in access
    control, you will have to make the database accessible to the
    "nobody" user. This means a malicious script could access and modify
    the database, even without a username and password. It's entirely
    possible that a web spider could stumble across a database
    administrator's web page, and drop all of your databases. You can
    protect against this with Apache authorization, or you can design
    your own access model using LDAP, <var class="filename">.htaccess</var> files, etc. and include
    that code as part of your <acronym title="PHP: Hypertext Preprocessor">PHP</acronym> scripts.
   </p>
   <p class="simpara">
    Often, once security is established to the point where the <acronym title="PHP: Hypertext Preprocessor">PHP</acronym> user
    (in this case, the apache user) has very little risk attached to it,
    it is discovered that <acronym title="PHP: Hypertext Preprocessor">PHP</acronym> is now prevented from writing any files
    to user directories. Or perhaps it has been prevented from accessing
    or changing databases. It has equally been secured from writing
    good and bad files, or entering good and bad database transactions.
   </p>
   <p class="simpara">
    A frequent security mistake made at this point is to allow apache
    root permissions, or to escalate apache's abilities in some other
    way.
   </p>
   <p class="simpara">
    Escalating the Apache user's permissions to root is extremely
    dangerous and may compromise the entire system, so sudo'ing,
    chroot'ing, or otherwise running as root should not be considered by
    those who are not security professionals.
   </p>
   <p class="simpara">
    There are some simpler solutions. By using
    <a href="ini.core.html#ini.open-basedir" class="link">open_basedir</a> you can control and restrict what
    directories are allowed to be used for <acronym title="PHP: Hypertext Preprocessor">PHP</acronym>. You can also set up
    apache-only areas, to restrict all web based activity to non-user,
    or non-system, files.
   </p>
  </div>

<section id="usernotes">
 <div class="head"><h3 class="title">User Contributed Notes</h3></div><div id="allnotes">
  <div class="note" id="24152">  
  <a class="name">
  <strong class="user"><em>daniel dot eckl at gmx dot de</em></strong></a><div class="date" title="2002-08-08 04:16"><strong>12 years ago</strong></div>
  <div class="text" id="Hcom24152">
<div class="phpcode"><code><span class="html">
There is a better solution than starting every virtual host in a seperate instance, which is wasting ressources.<br><br>You can set open_basedir dynamically for every virtual host you have, so every PHP script on a virtual host is jailed to its document root.<br><br>Example:<br>&lt;VirtualHost www.example.com&gt;<br>&nbsp; ServerName www.example.com<br>&nbsp; DocumentRoot /www-home/example.com<br>[...]<br>&nbsp; &lt;Location /&gt;<br>&nbsp; &nbsp; php_admin_value open_basedir&nbsp; &nbsp;&nbsp; \ "/www-home/example.com/:/usr/lib/php/"<br>&nbsp; &lt;/Location&gt;<br>&lt;/VirtualHost&gt;<br><br>If you set safe_mode on, then the script can only use binaries in given directories (make a special dir only with the binaries your customers may use).<br><br>Now no user of a virtual host can read/write/modify the data of another user on your machine.<br><br>Windseeker</span>
</code></div>
  </div>
 </div>
  <div class="note" id="107654">  
  <a class="name">
  <strong class="user"><em>bk 2 at me dot com</em></strong></a><div class="date" title="2012-02-24 05:17"><strong>2 years ago</strong></div>
  <div class="text" id="Hcom107654">
<div class="phpcode"><code><span class="html">
doc_root already limits apache/php script folder locations.<br><br>open_basedir is better used to restrict script access to folders<br>which do NOT contain scripts. Can be a sub-folder of doc_root as in php doc example doc_root/tmp, but better yet in a separate folder tree, like ~user/open_basedir_root/. Harmful scripts could modify other scripts if doc_root (or include_path) and open_basedir overlap.<br>If apache/php can't browse scripts in open_basedir, even if malicious scripts uploaded more bad scripts there, they won't be browse-able (executable). <br><br>One should also note that the many shell execute functions are effectively a way to bypass open_basedir limits, and such functions should be disabled if security demands strict folder access control. Harmful scripts can do the unix/windows version of "delete */*/*/*" if allowed to execute native os shell commands via those functions. OS Shell commands could similarly bypass redirect restrictions and upload file restrictions by just brute force copying files into the doc_root tree. It would be nice if they could be disabled as a group or class of functions, but it is still possible to disable them one by one if needed for security.<br><br>PS. currently there is a bug whereby the documented setting of open_basedir to docroot/tmp will not work if any include or require statements are done. Right now include will fail if the included php file is not in BOTH the open_basedir tree and the doc_root+include_path trees. Which is the opposite of safe.<br>This means by any included php file must be in open_basedir, so is vulnerable to harmful scripts and php viruses like Injektor.</span>
</code></div>
  </div>
 </div>
  <div class="note" id="57321">  
  <a class="name">
  <strong class="user"><em>Kibab</em></strong></a><div class="date" title="2005-09-30 06:56"><strong>8 years ago</strong></div>
  <div class="text" id="Hcom57321">
<div class="phpcode"><code><span class="html">
I'm running Windows version of Apache with php as module. System is Windows XP Service Pack 2 on NTFS filesystem. To avoid potential security problems, I've set Apache to run under NT AUTHORITY\Network Service account, and there is only one directory, named Content, with Full Access for this account. Other directories are either not accessible at all or with readonly permissions (like %systemroot%)... So, even if Apache will be broken, nothing would happen to entire system, because that account doesn't have admin privilegies :)</span>
</code></div>
  </div>
 </div>
  <div class="note" id="85091">  
  <a class="name">
  <strong class="user"><em>Vikanich</em></strong></a><div class="date" title="2008-08-14 04:41"><strong>6 years ago</strong></div>
  <div class="text" id="Hcom85091">
<div class="phpcode"><code><span class="html">
Big thanks to "daniel dot eckl at gmx dot de" but i have to change his config, because it doesn't work (may be wrong syntax).<br>I have add only this string to VirtualHost config and it works.<br>php_admin_value open_basedir&nbsp; /www/site1/<br>Now all php scripts are locked in the directory.</span>
</code></div>
  </div>
 </div></div>

 
</section>    </section><!-- layout-content -->
        


  </div><!-- layout -->
         
  

    
 <!-- External and third party libraries. -->
 







<a id="toTop" href="javascript:;"><span id="toTopHover"></span><img width="40" height="40" alt="To Top" src="../../images/to-top%402x.png"></a>



<!-- Mirrored from php.net/manual/en/security.apache.php by HTTrack Website Copier/3.x [XR&CO'2013], Thu, 28 Aug 2014 15:20:54 GMT -->


</body></html>