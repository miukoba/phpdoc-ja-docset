<html><!-- Mirrored from php.net/manual/en/book.openssl.php by HTTrack Website Copier/3.x [XR&CO'2013], Thu, 28 Aug 2014 15:32:07 GMT --><!-- Added by HTTrack --><head><meta http-equiv="content-type" content="text/html;charset=utf-8"><!-- /Added by HTTrack -->


  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0"> 

  <title>OpenSSL</title>

 <link rel="shortcut icon" href="../../favicon.ico">
 <link rel="search" type="application/opensearchdescription+xml" href="http://php.net/phpnetimprovedsearch.src" title="Add PHP.net search">
 <link rel="alternate" type="application/atom+xml" href="http://php.net/releases/feed.php" title="PHP Release feed">
 <link rel="alternate" type="application/atom+xml" href="http://php.net/feed.atom" title="PHP: Hypertext Preprocessor">

 <link rel="canonical" href="book.openssl.html">
 <link rel="shorturl" href="http://php.net/openssl">
 <link rel="alternate" href="http://php.net/openssl" hreflang="x-default">

 <link rel="contents" href="index-2.html">
 <link rel="index" href="refs.crypto.html">
 <link rel="prev" href="function.mhash.html">
 <link rel="next" href="intro.openssl.html">

 <link rel="alternate" href="book.openssl.html" hreflang="en">
 <link rel="alternate" href="http://php.net/manual/pt_BR/book.openssl.php" hreflang="pt_BR">
 <link rel="alternate" href="http://php.net/manual/zh/book.openssl.php" hreflang="zh">
 <link rel="alternate" href="http://php.net/manual/fr/book.openssl.php" hreflang="fr">
 <link rel="alternate" href="http://php.net/manual/de/book.openssl.php" hreflang="de">
 <link rel="alternate" href="http://php.net/manual/it/book.openssl.php" hreflang="it">
 <link rel="alternate" href="http://php.net/manual/ja/book.openssl.php" hreflang="ja">
 <link rel="alternate" href="http://php.net/manual/ro/book.openssl.php" hreflang="ro">
 <link rel="alternate" href="http://php.net/manual/ru/book.openssl.php" hreflang="ru">
 <link rel="alternate" href="http://php.net/manual/es/book.openssl.php" hreflang="es">
 <link rel="alternate" href="http://php.net/manual/tr/book.openssl.php" hreflang="tr">

<link rel="stylesheet" type="text/css" href="../../cached8fe1.css?t=1401250819&amp;f=/fonts/Fira/fira.css" media="screen">
<link rel="stylesheet" type="text/css" href="../../cached4b8d.css?t=1404368420&amp;f=/fonts/Font-Awesome/css/fontello.css" media="screen">
<link rel="stylesheet" type="text/css" href="../../cached5065.css?t=1403329232&amp;f=/styles/theme-base.css" media="screen">
<link rel="stylesheet" type="text/css" href="../../cachedc78d.css?t=1401249623&amp;f=/styles/theme-medium.css" media="screen">

 <!--[if lte IE 7]>
 <link rel="stylesheet" type="text/css" href="http://php.net/styles/workarounds.ie7.css" media="screen">
 <![endif]-->

 <!--[if lte IE 8]>
 <script type="text/javascript">
  window.brokenIE = true;
 </script>
 <![endif]-->

 <!--[if lte IE 9]>
 <link rel="stylesheet" type="text/css" href="http://php.net/styles/workarounds.ie9.css" media="screen">
 <![endif]-->

 <!--[if IE]>
 <script type="text/javascript" src="http://php.net/js/ext/html5.js"></script>
 <![endif]-->

 <base>

</head>
<body class="docs " style="">


<div class="headsup"><a href="http://php.net/index.php#id2014-08-28-1">PHP 5.6.0 released</a></div>
<nav id="trick"><div><dl>
<dt><a href="getting-started.html">Getting Started</a></dt>
	<dd><a href="introduction.html">Introduction</a></dd>
	<dd><a href="tutorial.html">A simple tutorial</a></dd>
<dt><a href="langref.html">Language Reference</a></dt>
	<dd><a href="language.basic-syntax.html">Basic syntax</a></dd>
	<dd><a href="language.types.html">Types</a></dd>
	<dd><a href="language.variables.html">Variables</a></dd>
	<dd><a href="language.constants.html">Constants</a></dd>
	<dd><a href="language.expressions.html">Expressions</a></dd>
	<dd><a href="language.operators.html">Operators</a></dd>
	<dd><a href="language.control-structures.html">Control Structures</a></dd>
	<dd><a href="language.functions.html">Functions</a></dd>
	<dd><a href="language.oop5.html">Classes and Objects</a></dd>
	<dd><a href="language.namespaces.html">Namespaces</a></dd>
	<dd><a href="language.exceptions.html">Exceptions</a></dd>
	<dd><a href="language.generators.html">Generators</a></dd>
	<dd><a href="language.references.html">References Explained</a></dd>
	<dd><a href="reserved.variables.html">Predefined Variables</a></dd>
	<dd><a href="reserved.exceptions.html">Predefined Exceptions</a></dd>
	<dd><a href="reserved.interfaces.html">Predefined Interfaces and Classes</a></dd>
	<dd><a href="context.html">Context options and parameters</a></dd>
	<dd><a href="wrappers.html">Supported Protocols and Wrappers</a></dd>
</dl>
<dl>
<dt><a href="security.html">Security</a></dt>
	<dd><a href="security.intro.html">Introduction</a></dd>
	<dd><a href="security.general.html">General considerations</a></dd>
	<dd><a href="security.cgi-bin.html">Installed as CGI binary</a></dd>
	<dd><a href="security.apache.html">Installed as an Apache module</a></dd>
	<dd><a href="security.filesystem.html">Filesystem Security</a></dd>
	<dd><a href="security.database.html">Database Security</a></dd>
	<dd><a href="security.errors.html">Error Reporting</a></dd>
	<dd><a href="security.globals.html">Using Register Globals</a></dd>
	<dd><a href="security.variables.html">User Submitted Data</a></dd>
	<dd><a href="security.magicquotes.html">Magic Quotes</a></dd>
	<dd><a href="security.hiding.html">Hiding PHP</a></dd>
	<dd><a href="security.current.html">Keeping Current</a></dd>
<dt><a href="features.html">Features</a></dt>
	<dd><a href="features.http-auth.html">HTTP authentication with PHP</a></dd>
	<dd><a href="features.cookies.html">Cookies</a></dd>
	<dd><a href="features.sessions.html">Sessions</a></dd>
	<dd><a href="features.xforms.html">Dealing with XForms</a></dd>
	<dd><a href="features.file-upload.html">Handling file uploads</a></dd>
	<dd><a href="features.remote-files.html">Using remote files</a></dd>
	<dd><a href="features.connection-handling.html">Connection handling</a></dd>
	<dd><a href="features.persistent-connections.html">Persistent Database Connections</a></dd>
	<dd><a href="features.safe-mode.html">Safe Mode</a></dd>
	<dd><a href="features.commandline.html">Command line usage</a></dd>
	<dd><a href="features.gc.html">Garbage Collection</a></dd>
	<dd><a href="features.dtrace.html">DTrace Dynamic Tracing</a></dd>
</dl>
<dl>
<dt><a href="funcref.html">Function Reference</a></dt>
	<dd><a href="refs.basic.php.html">Affecting PHP's Behaviour</a></dd>
	<dd><a href="refs.utilspec.audio.html">Audio Formats Manipulation</a></dd>
	<dd><a href="refs.remote.auth.html">Authentication Services</a></dd>
	<dd><a href="refs.utilspec.cmdline.html">Command Line Specific Extensions</a></dd>
	<dd><a href="refs.compression.html">Compression and Archive Extensions</a></dd>
	<dd><a href="refs.creditcard.html">Credit Card Processing</a></dd>
	<dd><a href="refs.crypto.html">Cryptography Extensions</a></dd>
	<dd><a href="refs.database.html">Database Extensions</a></dd>
	<dd><a href="refs.calendar.html">Date and Time Related Extensions</a></dd>
	<dd><a href="refs.fileprocess.file.html">File System Related Extensions</a></dd>
	<dd><a href="refs.international.html">Human Language and Character Encoding Support</a></dd>
	<dd><a href="refs.utilspec.image.html">Image Processing and Generation</a></dd>
	<dd><a href="refs.remote.mail.html">Mail Related Extensions</a></dd>
	<dd><a href="refs.math.html">Mathematical Extensions</a></dd>
	<dd><a href="refs.utilspec.nontext.html">Non-Text MIME Output</a></dd>
	<dd><a href="refs.fileprocess.process.html">Process Control Extensions</a></dd>
	<dd><a href="refs.basic.other.html">Other Basic Extensions</a></dd>
	<dd><a href="refs.remote.other.html">Other Services</a></dd>
	<dd><a href="refs.search.html">Search Engine Extensions</a></dd>
	<dd><a href="refs.utilspec.server.html">Server Specific Extensions</a></dd>
	<dd><a href="refs.basic.session.html">Session Extensions</a></dd>
	<dd><a href="refs.basic.text.html">Text Processing</a></dd>
	<dd><a href="refs.basic.vartype.html">Variable and Type Related Extensions</a></dd>
	<dd><a href="refs.webservice.html">Web Services</a></dd>
	<dd><a href="refs.utilspec.windows.html">Windows Only Extensions</a></dd>
	<dd><a href="refs.xml.html">XML Manipulation</a></dd>
</dl>
<dl>
<dt>Keyboard Shortcuts</dt><dt>?</dt>
<dd>This help</dd>
<dt>j</dt>
<dd>Next menu item</dd>
<dt>k</dt>
<dd>Previous menu item</dd>
<dt>g p</dt>
<dd>Previous man page</dd>
<dt>g n</dt>
<dd>Next man page</dd>
<dt>G</dt>
<dd>Scroll to bottom</dd>
<dt>g g</dt>
<dd>Scroll to top</dd>
<dt>g h</dt>
<dd>Goto homepage</dd>
<dt>g s</dt>
<dd>Goto search<br>(current page)</dd>
<dt>/</dt>
<dd>Focus search box</dd>
</dl></div></nav>
<div id="goto">
    <div class="search">
         <div class="text"></div>
         <div class="results"><ul></ul></div>
   </div>
</div>

  <div id="breadcrumbs" class="row-fluid">
          
              
        <ul class="breadcrumbs-container">
            <li><a href="index-2.html">PHP Manual</a></li>      <li><a href="funcref.html">Function Reference</a></li>      <li><a href="refs.crypto.html">Cryptography Extensions</a></li>    </ul>
  </div>




<div id="layout">
  <section id="layout-content">
  <div id="book.openssl" class="book">
 
 <h1 class="title">OpenSSL</h1>
 
 
 
 
 
 







 






 







 


 




 








<ul class="chunklist chunklist_book"><li><a href="intro.openssl.html">Introduction</a></li><li><a href="openssl.setup.html">Installing/Configuring</a><ul class="chunklist chunklist_book chunklist_children"><li><a href="openssl.requirements.html">Requirements</a></li><li><a href="openssl.installation.html">Installation</a></li><li><a href="openssl.configuration.html">Runtime Configuration</a></li><li><a href="openssl.resources.html">Resource Types</a></li></ul></li><li><a href="openssl.constants.html">Predefined Constants</a><ul class="chunklist chunklist_book chunklist_children"><li><a href="openssl.purpose-check.html">Purpose checking flags</a></li><li><a href="openssl.padding.html">Padding flags for asymmetric encryption</a></li><li><a href="openssl.key-types.html">Key types</a></li><li><a href="openssl.pkcs7.flags.html">PKCS7 Flags/Constants</a></li><li><a href="openssl.signature-algos.html">Signature Algorithms</a></li><li><a href="openssl.ciphers.html">Ciphers</a></li><li><a href="openssl.constversion.html">Version constants</a></li><li><a href="openssl.constsni.html">Server Name Indication constants</a></li></ul></li><li><a href="openssl.certparams.html">Key/Certificate parameters</a></li><li><a href="openssl.cert.verification.html">Certificate Verification</a></li><li><a href="ref.openssl.html">OpenSSL Functions</a><ul class="chunklist chunklist_book chunklist_children"><li><a href="function.openssl-cipher-iv-length.html">openssl_cipher_iv_length</a> — Gets the cipher iv length</li><li><a href="function.openssl-csr-export-to-file.html">openssl_csr_export_to_file</a> — Exports a CSR to a file</li><li><a href="function.openssl-csr-export.html">openssl_csr_export</a> — Exports a CSR as a string</li><li><a href="function.openssl-csr-get-public-key.html">openssl_csr_get_public_key</a> — Returns the public key of a CERT</li><li><a href="function.openssl-csr-get-subject.html">openssl_csr_get_subject</a> — Returns the subject of a CERT</li><li><a href="function.openssl-csr-new.html">openssl_csr_new</a> — Generates a CSR</li><li><a href="function.openssl-csr-sign.html">openssl_csr_sign</a> — Sign a CSR with another certificate (or itself) and generate a certificate</li><li><a href="function.openssl-decrypt.html">openssl_decrypt</a> — Decrypts data</li><li><a href="function.openssl-dh-compute-key.html">openssl_dh_compute_key</a> — Computes shared secret for public value of remote DH key and local DH key</li><li><a href="function.openssl-digest.html">openssl_digest</a> — Computes a digest</li><li><a href="function.openssl-encrypt.html">openssl_encrypt</a> — Encrypts data</li><li><a href="function.openssl-error-string.html">openssl_error_string</a> — Return openSSL error message</li><li><a href="function.openssl-free-key.html">openssl_free_key</a> — Free key resource</li><li><a href="function.openssl-get-cert-locations.html">openssl_get_cert_locations</a> — Retrieve the available certificate locations</li><li><a href="function.openssl-get-cipher-methods.html">openssl_get_cipher_methods</a> — Gets available cipher methods</li><li><a href="function.openssl-get-md-methods.html">openssl_get_md_methods</a> — Gets available digest methods</li><li><a href="function.openssl-get-privatekey.html">openssl_get_privatekey</a> — Alias of openssl_pkey_get_private</li><li><a href="function.openssl-get-publickey.html">openssl_get_publickey</a> — Alias of openssl_pkey_get_public</li><li><a href="function.openssl-open.html">openssl_open</a> — Open sealed data</li><li><a href="function.openssl-pbkdf2.html">openssl_pbkdf2</a> — Generates a PKCS5 v2 PBKDF2 string, defaults to SHA-1</li><li><a href="function.openssl-pkcs12-export-to-file.html">openssl_pkcs12_export_to_file</a> — Exports a PKCS#12 Compatible Certificate Store File</li><li><a href="function.openssl-pkcs12-export.html">openssl_pkcs12_export</a> — Exports a PKCS#12 Compatible Certificate Store File to variable.</li><li><a href="function.openssl-pkcs12-read.html">openssl_pkcs12_read</a> — Parse a PKCS#12 Certificate Store into an array</li><li><a href="function.openssl-pkcs7-decrypt.html">openssl_pkcs7_decrypt</a> — Decrypts an S/MIME encrypted message</li><li><a href="function.openssl-pkcs7-encrypt.html">openssl_pkcs7_encrypt</a> — Encrypt an S/MIME message</li><li><a href="function.openssl-pkcs7-sign.html">openssl_pkcs7_sign</a> — Sign an S/MIME message</li><li><a href="function.openssl-pkcs7-verify.html">openssl_pkcs7_verify</a> — Verifies the signature of an S/MIME signed message</li><li><a href="function.openssl-pkey-export-to-file.html">openssl_pkey_export_to_file</a> — Gets an exportable representation of a key into a file</li><li><a href="function.openssl-pkey-export.html">openssl_pkey_export</a> — Gets an exportable representation of a key into a string</li><li><a href="function.openssl-pkey-free.html">openssl_pkey_free</a> — Frees a private key</li><li><a href="function.openssl-pkey-get-details.html">openssl_pkey_get_details</a> — Returns an array with the key details</li><li><a href="function.openssl-pkey-get-private.html">openssl_pkey_get_private</a> — Get a private key</li><li><a href="function.openssl-pkey-get-public.html">openssl_pkey_get_public</a> — Extract public key from certificate and prepare it for use</li><li><a href="function.openssl-pkey-new.html">openssl_pkey_new</a> — Generates a new private key</li><li><a href="function.openssl-private-decrypt.html">openssl_private_decrypt</a> — Decrypts data with private key</li><li><a href="function.openssl-private-encrypt.html">openssl_private_encrypt</a> — Encrypts data with private key</li><li><a href="function.openssl-public-decrypt.html">openssl_public_decrypt</a> — Decrypts data with public key</li><li><a href="function.openssl-public-encrypt.html">openssl_public_encrypt</a> — Encrypts data with public key</li><li><a href="function.openssl-random-pseudo-bytes.html">openssl_random_pseudo_bytes</a> — Generate a pseudo-random string of bytes</li><li><a href="function.openssl-seal.html">openssl_seal</a> — Seal (encrypt) data</li><li><a href="function.openssl-sign.html">openssl_sign</a> — Generate signature</li><li><a href="function.openssl-spki-export-challenge.html">openssl_spki_export_challenge</a> — Exports the challenge assoicated with a signed public key and challenge</li><li><a href="function.openssl-spki-export.html">openssl_spki_export</a> — Exports a valid PEM formatted public key signed public key and challenge</li><li><a href="function.openssl-spki-new.html">openssl_spki_new</a> — Generate a new signed public key and challenge</li><li><a href="function.openssl-spki-verify.html">openssl_spki_verify</a> — Verifies a signed public key and challenge</li><li><a href="function.openssl-verify.html">openssl_verify</a> — Verify signature</li><li><a href="function.openssl-x509-check-private-key.html">openssl_x509_check_private_key</a> — Checks if a private key corresponds to a certificate</li><li><a href="function.openssl-x509-checkpurpose.html">openssl_x509_checkpurpose</a> — Verifies if a certificate can be used for a particular purpose</li><li><a href="function.openssl-x509-export-to-file.html">openssl_x509_export_to_file</a> — Exports a certificate to file</li><li><a href="function.openssl-x509-export.html">openssl_x509_export</a> — Exports a certificate as a string</li><li><a href="function.openssl-x509-fingerprint.html">openssl_x509_fingerprint</a> — Calculates the fingerprint, or digest, of a given X.509 certificate</li><li><a href="function.openssl-x509-free.html">openssl_x509_free</a> — Free certificate resource</li><li><a href="function.openssl-x509-parse.html">openssl_x509_parse</a> — Parse an X509 certificate and return the information as an array</li><li><a href="function.openssl-x509-read.html">openssl_x509_read</a> — Parse an X.509 certificate and return a resource identifier for
  it</li></ul></li></ul></div>
<section id="usernotes">
 <div class="head"><h3 class="title">User Contributed Notes</h3></div><div id="allnotes">
  <div class="note" id="91210">  
  <a class="name">
  <strong class="user"><em>bdh dot hall at gmail dot com</em></strong></a><div class="date" title="2009-05-29 03:18"><strong>5 years ago</strong></div>
  <div class="text" id="Hcom91210">
<div class="phpcode"><code><span class="html">
I was having a heck of a time finding help on making asynchronous encryption/decryption using private key/public key systems working, and I had to have it for creating a credit card module that uses recurring billing.<br><br>You'd be a fool to use normal, 'synchronous' or two-way encryption for this, so the whole mcrypt library won't help.<br><br>But, it turns out OpenSSL is extremely easy to use...yet it is so sparsely documented that it seems it would be incredibly hard.<br><br>So I share my day of hacking with you - I hope you find it helpful!<br><br><span class="default">&lt;?php<br><br></span><span class="keyword">if (isset(</span><span class="default">$_SERVER</span><span class="keyword">[</span><span class="string">'HTTPS'</span><span class="keyword">]) )<br>{<br>&nbsp; &nbsp; echo </span><span class="string">"SECURE: This page is being accessed through a secure connection.&lt;br&gt;&lt;br&gt;"</span><span class="keyword">;<br>}<br>else<br>{<br>&nbsp; &nbsp; echo </span><span class="string">"UNSECURE: This page is being access through an unsecure connection.&lt;br&gt;&lt;br&gt;"</span><span class="keyword">;<br>}<br><br></span><span class="comment">// Create the keypair<br></span><span class="default">$res</span><span class="keyword">=</span><span class="default">openssl_pkey_new</span><span class="keyword">();<br><br></span><span class="comment">// Get private key<br></span><span class="default">openssl_pkey_export</span><span class="keyword">(</span><span class="default">$res</span><span class="keyword">, </span><span class="default">$privatekey</span><span class="keyword">);<br><br></span><span class="comment">// Get public key<br></span><span class="default">$publickey</span><span class="keyword">=</span><span class="default">openssl_pkey_get_details</span><span class="keyword">(</span><span class="default">$res</span><span class="keyword">);<br></span><span class="default">$publickey</span><span class="keyword">=</span><span class="default">$publickey</span><span class="keyword">[</span><span class="string">"key"</span><span class="keyword">];<br><br>echo </span><span class="string">"Private Key:&lt;BR&gt;</span><span class="default">$privatekey</span><span class="string">&lt;br&gt;&lt;br&gt;Public Key:&lt;BR&gt;</span><span class="default">$publickey</span><span class="string">&lt;BR&gt;&lt;BR&gt;"</span><span class="keyword">;<br><br></span><span class="default">$cleartext </span><span class="keyword">= </span><span class="string">'1234 5678 9012 3456'</span><span class="keyword">;<br><br>echo </span><span class="string">"Clear text:&lt;br&gt;</span><span class="default">$cleartext</span><span class="string">&lt;BR&gt;&lt;BR&gt;"</span><span class="keyword">;<br><br></span><span class="default">openssl_public_encrypt</span><span class="keyword">(</span><span class="default">$cleartext</span><span class="keyword">, </span><span class="default">$crypttext</span><span class="keyword">, </span><span class="default">$publickey</span><span class="keyword">);<br><br>echo </span><span class="string">"Crypt text:&lt;br&gt;</span><span class="default">$crypttext</span><span class="string">&lt;BR&gt;&lt;BR&gt;"</span><span class="keyword">;<br><br></span><span class="default">openssl_private_decrypt</span><span class="keyword">(</span><span class="default">$crypttext</span><span class="keyword">, </span><span class="default">$decrypted</span><span class="keyword">, </span><span class="default">$privatekey</span><span class="keyword">);<br><br>echo </span><span class="string">"Decrypted text:&lt;BR&gt;</span><span class="default">$decrypted</span><span class="string">&lt;br&gt;&lt;br&gt;"</span><span class="keyword">;<br></span><span class="default">?&gt;<br></span><br>Many thanks to other contributors in the docs for making this less painful.<br><br>Note that you will want to use these sorts of functions to generate a key ONCE - save your privatekey offline for decryption, and put your public key in your scripts/configuration file. If your data is compromised you don't care about the encrypted stuff or the public key, it's only the private key and cleartext that really matter.<br><br>Good luck!</span>
</code></div>
  </div>
 </div>
  <div class="note" id="85444">  
  <a class="name">
  <strong class="user"><em>koen dot thomeer at pubmed dot be</em></strong></a><div class="date" title="2008-08-31 10:27"><strong>5 years ago</strong></div>
  <div class="text" id="Hcom85444">
<div class="phpcode"><code><span class="html">
For checking the status of a client certificate using OCSP, you can use this script:<br><br><span class="default">&lt;?php<br></span><span class="comment">// User variables:<br></span><span class="default">$dir </span><span class="keyword">= </span><span class="string">'/path/to/temp/'</span><span class="keyword">; </span><span class="comment">// Directory where apache has access to (chmod 777).<br></span><span class="default">$RootCA </span><span class="keyword">= </span><span class="string">'/path/to/Root.cer'</span><span class="keyword">; </span><span class="comment">// Points to the Root CA in PEM format.<br></span><span class="default">$OCSPUrl </span><span class="keyword">= </span><span class="string">'<a rel="nofollow" target="_blank">http://ocsp.url</a>'</span><span class="keyword">; </span><span class="comment">//Points to the OCSP URL<br>// Script:<br></span><span class="default">$a </span><span class="keyword">= </span><span class="default">rand</span><span class="keyword">(</span><span class="default">1000</span><span class="keyword">,</span><span class="default">99999</span><span class="keyword">); </span><span class="comment">// Needed if you expect more page clicks in one second!<br></span><span class="default">file_put_contents</span><span class="keyword">(</span><span class="default">$dir</span><span class="keyword">.</span><span class="default">$a</span><span class="keyword">.</span><span class="string">'cert_i.pem'</span><span class="keyword">, </span><span class="default">$_SERVER</span><span class="keyword">[</span><span class="string">'SSL_CLIENT_CERT_CHAIN_0'</span><span class="keyword">]); </span><span class="comment">// Issuer certificate.<br></span><span class="default">file_put_contents</span><span class="keyword">(</span><span class="default">$dir</span><span class="keyword">.</span><span class="default">$a</span><span class="keyword">.</span><span class="string">'cert_c.pem'</span><span class="keyword">, </span><span class="default">$_SERVER</span><span class="keyword">[</span><span class="string">'SSL_CLIENT_CERT'</span><span class="keyword">]); </span><span class="comment">// Client (authentication) certificate.<br></span><span class="default">$output </span><span class="keyword">= </span><span class="default">shell_exec</span><span class="keyword">(</span><span class="string">'openssl ocsp -CAfile '</span><span class="keyword">.</span><span class="default">$RootCA</span><span class="keyword">.</span><span class="string">' -issuer '</span><span class="keyword">.</span><span class="default">$dir</span><span class="keyword">.</span><span class="default">$a</span><span class="keyword">.</span><span class="string">'cert_i.pem -cert '</span><span class="keyword">.</span><span class="default">$dir</span><span class="keyword">.</span><span class="default">$a</span><span class="keyword">.</span><span class="string">'cert_c.pem -url '</span><span class="keyword">.</span><span class="default">$OCSPUrl</span><span class="keyword">);<br></span><span class="default">$output2 </span><span class="keyword">= </span><span class="default">preg_split</span><span class="keyword">(</span><span class="string">'/[\r\n]/'</span><span class="keyword">, </span><span class="default">$output</span><span class="keyword">);<br></span><span class="default">$output3 </span><span class="keyword">= </span><span class="default">preg_split</span><span class="keyword">(</span><span class="string">'/: /'</span><span class="keyword">, </span><span class="default">$output2</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">]);<br></span><span class="default">$ocsp </span><span class="keyword">= </span><span class="default">$output3</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">];<br>echo </span><span class="string">"OCSP status: "</span><span class="keyword">.</span><span class="default">$ocsp</span><span class="keyword">; </span><span class="comment">// will be "good", "revoked", or "unknown"<br></span><span class="default">unlink</span><span class="keyword">(</span><span class="default">$dir</span><span class="keyword">.</span><span class="default">$a</span><span class="keyword">.</span><span class="string">'cert_i.pem'</span><span class="keyword">);<br></span><span class="default">unlink</span><span class="keyword">(</span><span class="default">$dir</span><span class="keyword">.</span><span class="default">$a</span><span class="keyword">.</span><span class="string">'cert_c.pem'</span><span class="keyword">);<br></span><span class="default">?&gt;<br></span><br>It can be ameliorated, but it's just a beginning!<br><br>Normally, you can extract the ocsp url from the client certificate. Also, an OCSP request contains only the hash of the issuer name, the hash of the issuer's key, and the serial number of the client certificate. All three can be extracted directly from the client certificate.</span>
</code></div>
  </div>
 </div>
  <div class="note" id="93946">  
  <a class="name">
  <strong class="user"><em>Anonymous</em></strong></a><div class="date" title="2009-10-07 05:28"><strong>4 years ago</strong></div>
  <div class="text" id="Hcom93946">
<div class="phpcode"><code><span class="html">
OpenSSL creates asynchronous key pairs, however I wanted to have the private key something that was human-memorizable. With the standard keys generated, this is not possible. How I achieved it was to use two types of encryption.
<br>
<br>After generating a key pair with OpenSSL, the public key can be stored in plain text format. I then encrypted the private key itself using regular mcrypt with the human-memorizable key of my choice and converted it to ACSII using base64_encode. Then to get the private key back, I just decrypted it with mcrypt. This way I could store the encrypted private key on the server without worrying about having things stored unencrypted.
<br>
<br>Of course, this will only be as good as your human-memorizable key is and can potentially reduce the security of your script if you choose something simple or don't use salts.</span>
</code></div>
  </div>
 </div></div>

 
</section>    </section><!-- layout-content -->
        


  </div><!-- layout -->
         
  

    
 <!-- External and third party libraries. -->
 







<a id="toTop" href="javascript:;"><span id="toTopHover"></span><img width="40" height="40" alt="To Top" src="../../images/to-top%402x.png"></a>



<!-- Mirrored from php.net/manual/en/book.openssl.php by HTTrack Website Copier/3.x [XR&CO'2013], Thu, 28 Aug 2014 15:32:13 GMT -->


</body></html>