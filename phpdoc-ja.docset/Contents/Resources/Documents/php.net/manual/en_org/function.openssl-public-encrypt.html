<html><!-- Mirrored from php.net/manual/en/function.openssl-public-encrypt.php by HTTrack Website Copier/3.x [XR&CO'2013], Thu, 28 Aug 2014 16:17:11 GMT --><!-- Added by HTTrack --><head><meta http-equiv="content-type" content="text/html;charset=utf-8"><!-- /Added by HTTrack -->


  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0"> 

  <title>openssl_public_encrypt</title>

 <link rel="shortcut icon" href="../../favicon.ico">
 <link rel="search" type="application/opensearchdescription+xml" href="http://php.net/phpnetimprovedsearch.src" title="Add PHP.net search">
 <link rel="alternate" type="application/atom+xml" href="http://php.net/releases/feed.php" title="PHP Release feed">
 <link rel="alternate" type="application/atom+xml" href="http://php.net/feed.atom" title="PHP: Hypertext Preprocessor">

 <link rel="canonical" href="function.openssl-public-encrypt.html">
 <link rel="shorturl" href="http://php.net/openssl-public-encrypt">
 <link rel="alternate" href="http://php.net/openssl-public-encrypt" hreflang="x-default">

 <link rel="contents" href="index-2.html">
 <link rel="index" href="ref.openssl.html">
 <link rel="prev" href="function.openssl-public-decrypt.html">
 <link rel="next" href="function.openssl-random-pseudo-bytes.html">

 <link rel="alternate" href="function.openssl-public-encrypt.html" hreflang="en">
 <link rel="alternate" href="http://php.net/manual/pt_BR/function.openssl-public-encrypt.php" hreflang="pt_BR">
 <link rel="alternate" href="http://php.net/manual/zh/function.openssl-public-encrypt.php" hreflang="zh">
 <link rel="alternate" href="http://php.net/manual/fr/function.openssl-public-encrypt.php" hreflang="fr">
 <link rel="alternate" href="http://php.net/manual/de/function.openssl-public-encrypt.php" hreflang="de">
 <link rel="alternate" href="http://php.net/manual/it/function.openssl-public-encrypt.php" hreflang="it">
 <link rel="alternate" href="http://php.net/manual/ja/function.openssl-public-encrypt.php" hreflang="ja">
 <link rel="alternate" href="http://php.net/manual/ro/function.openssl-public-encrypt.php" hreflang="ro">
 <link rel="alternate" href="http://php.net/manual/ru/function.openssl-public-encrypt.php" hreflang="ru">
 <link rel="alternate" href="http://php.net/manual/es/function.openssl-public-encrypt.php" hreflang="es">
 <link rel="alternate" href="http://php.net/manual/tr/function.openssl-public-encrypt.php" hreflang="tr">

<link rel="stylesheet" type="text/css" href="../../cached8fe1.css?t=1401250819&amp;f=/fonts/Fira/fira.css" media="screen">
<link rel="stylesheet" type="text/css" href="../../cached4b8d.css?t=1404368420&amp;f=/fonts/Font-Awesome/css/fontello.css" media="screen">
<link rel="stylesheet" type="text/css" href="../../cached5065.css?t=1403329232&amp;f=/styles/theme-base.css" media="screen">
<link rel="stylesheet" type="text/css" href="../../cachedc78d.css?t=1401249623&amp;f=/styles/theme-medium.css" media="screen">

 <!--[if lte IE 7]>
 <link rel="stylesheet" type="text/css" href="http://php.net/styles/workarounds.ie7.css" media="screen">
 <![endif]-->

 <!--[if lte IE 8]>
 <script type="text/javascript">
  window.brokenIE = true;
 </script>
 <![endif]-->

 <!--[if lte IE 9]>
 <link rel="stylesheet" type="text/css" href="http://php.net/styles/workarounds.ie9.css" media="screen">
 <![endif]-->

 <!--[if IE]>
 <script type="text/javascript" src="http://php.net/js/ext/html5.js"></script>
 <![endif]-->

 <base>

</head>
<body class="docs " style="">


<div class="headsup"><a href="http://php.net/index.php#id2014-08-28-1">PHP 5.6.0 released</a></div>
<nav id="trick"><div><dl>
<dt><a href="getting-started.html">Getting Started</a></dt>
	<dd><a href="introduction.html">Introduction</a></dd>
	<dd><a href="tutorial.html">A simple tutorial</a></dd>
<dt><a href="langref.html">Language Reference</a></dt>
	<dd><a href="language.basic-syntax.html">Basic syntax</a></dd>
	<dd><a href="language.types.html">Types</a></dd>
	<dd><a href="language.variables.html">Variables</a></dd>
	<dd><a href="language.constants.html">Constants</a></dd>
	<dd><a href="language.expressions.html">Expressions</a></dd>
	<dd><a href="language.operators.html">Operators</a></dd>
	<dd><a href="language.control-structures.html">Control Structures</a></dd>
	<dd><a href="language.functions.html">Functions</a></dd>
	<dd><a href="language.oop5.html">Classes and Objects</a></dd>
	<dd><a href="language.namespaces.html">Namespaces</a></dd>
	<dd><a href="language.exceptions.html">Exceptions</a></dd>
	<dd><a href="language.generators.html">Generators</a></dd>
	<dd><a href="language.references.html">References Explained</a></dd>
	<dd><a href="reserved.variables.html">Predefined Variables</a></dd>
	<dd><a href="reserved.exceptions.html">Predefined Exceptions</a></dd>
	<dd><a href="reserved.interfaces.html">Predefined Interfaces and Classes</a></dd>
	<dd><a href="context.html">Context options and parameters</a></dd>
	<dd><a href="wrappers.html">Supported Protocols and Wrappers</a></dd>
</dl>
<dl>
<dt><a href="security.html">Security</a></dt>
	<dd><a href="security.intro.html">Introduction</a></dd>
	<dd><a href="security.general.html">General considerations</a></dd>
	<dd><a href="security.cgi-bin.html">Installed as CGI binary</a></dd>
	<dd><a href="security.apache.html">Installed as an Apache module</a></dd>
	<dd><a href="security.filesystem.html">Filesystem Security</a></dd>
	<dd><a href="security.database.html">Database Security</a></dd>
	<dd><a href="security.errors.html">Error Reporting</a></dd>
	<dd><a href="security.globals.html">Using Register Globals</a></dd>
	<dd><a href="security.variables.html">User Submitted Data</a></dd>
	<dd><a href="security.magicquotes.html">Magic Quotes</a></dd>
	<dd><a href="security.hiding.html">Hiding PHP</a></dd>
	<dd><a href="security.current.html">Keeping Current</a></dd>
<dt><a href="features.html">Features</a></dt>
	<dd><a href="features.http-auth.html">HTTP authentication with PHP</a></dd>
	<dd><a href="features.cookies.html">Cookies</a></dd>
	<dd><a href="features.sessions.html">Sessions</a></dd>
	<dd><a href="features.xforms.html">Dealing with XForms</a></dd>
	<dd><a href="features.file-upload.html">Handling file uploads</a></dd>
	<dd><a href="features.remote-files.html">Using remote files</a></dd>
	<dd><a href="features.connection-handling.html">Connection handling</a></dd>
	<dd><a href="features.persistent-connections.html">Persistent Database Connections</a></dd>
	<dd><a href="features.safe-mode.html">Safe Mode</a></dd>
	<dd><a href="features.commandline.html">Command line usage</a></dd>
	<dd><a href="features.gc.html">Garbage Collection</a></dd>
	<dd><a href="features.dtrace.html">DTrace Dynamic Tracing</a></dd>
</dl>
<dl>
<dt><a href="funcref.html">Function Reference</a></dt>
	<dd><a href="refs.basic.php.html">Affecting PHP's Behaviour</a></dd>
	<dd><a href="refs.utilspec.audio.html">Audio Formats Manipulation</a></dd>
	<dd><a href="refs.remote.auth.html">Authentication Services</a></dd>
	<dd><a href="refs.utilspec.cmdline.html">Command Line Specific Extensions</a></dd>
	<dd><a href="refs.compression.html">Compression and Archive Extensions</a></dd>
	<dd><a href="refs.creditcard.html">Credit Card Processing</a></dd>
	<dd><a href="refs.crypto.html">Cryptography Extensions</a></dd>
	<dd><a href="refs.database.html">Database Extensions</a></dd>
	<dd><a href="refs.calendar.html">Date and Time Related Extensions</a></dd>
	<dd><a href="refs.fileprocess.file.html">File System Related Extensions</a></dd>
	<dd><a href="refs.international.html">Human Language and Character Encoding Support</a></dd>
	<dd><a href="refs.utilspec.image.html">Image Processing and Generation</a></dd>
	<dd><a href="refs.remote.mail.html">Mail Related Extensions</a></dd>
	<dd><a href="refs.math.html">Mathematical Extensions</a></dd>
	<dd><a href="refs.utilspec.nontext.html">Non-Text MIME Output</a></dd>
	<dd><a href="refs.fileprocess.process.html">Process Control Extensions</a></dd>
	<dd><a href="refs.basic.other.html">Other Basic Extensions</a></dd>
	<dd><a href="refs.remote.other.html">Other Services</a></dd>
	<dd><a href="refs.search.html">Search Engine Extensions</a></dd>
	<dd><a href="refs.utilspec.server.html">Server Specific Extensions</a></dd>
	<dd><a href="refs.basic.session.html">Session Extensions</a></dd>
	<dd><a href="refs.basic.text.html">Text Processing</a></dd>
	<dd><a href="refs.basic.vartype.html">Variable and Type Related Extensions</a></dd>
	<dd><a href="refs.webservice.html">Web Services</a></dd>
	<dd><a href="refs.utilspec.windows.html">Windows Only Extensions</a></dd>
	<dd><a href="refs.xml.html">XML Manipulation</a></dd>
</dl>
<dl>
<dt>Keyboard Shortcuts</dt><dt>?</dt>
<dd>This help</dd>
<dt>j</dt>
<dd>Next menu item</dd>
<dt>k</dt>
<dd>Previous menu item</dd>
<dt>g p</dt>
<dd>Previous man page</dd>
<dt>g n</dt>
<dd>Next man page</dd>
<dt>G</dt>
<dd>Scroll to bottom</dd>
<dt>g g</dt>
<dd>Scroll to top</dd>
<dt>g h</dt>
<dd>Goto homepage</dd>
<dt>g s</dt>
<dd>Goto search<br>(current page)</dd>
<dt>/</dt>
<dd>Focus search box</dd>
</dl></div></nav>
<div id="goto">
    <div class="search">
         <div class="text"></div>
         <div class="results"><ul></ul></div>
   </div>
</div>

  <div id="breadcrumbs" class="row-fluid">
          
              
        <ul class="breadcrumbs-container">
            <li><a href="index-2.html">PHP Manual</a></li>      <li><a href="funcref.html">Function Reference</a></li>      <li><a href="refs.crypto.html">Cryptography Extensions</a></li>      <li><a href="book.openssl.html">OpenSSL</a></li>      <li><a href="ref.openssl.html">OpenSSL Functions</a></li>    </ul>
  </div>




<div id="layout">
  <section id="layout-content">
  <div id="function.openssl-public-encrypt" class="refentry">
 <div class="refnamediv">
  <h1 class="refname">openssl_public_encrypt</h1>
  <p class="verinfo">(PHP 4 &gt;= 4.0.6, PHP 5)</p><p class="refpurpose"><span class="refname">openssl_public_encrypt</span> â€” <span class="dc-title">Encrypts data with public key </span></p>

 </div>
 
 <div class="refsect1 description" id="refsect1-function.openssl-public-encrypt-description">
  <h3 class="title">Description</h3>
  <div class="methodsynopsis dc-description">
   <span class="type">bool</span> <span class="methodname"><strong>openssl_public_encrypt</strong></span>
    ( <span class="methodparam"><span class="type">string</span> <code class="parameter">$data</code></span>
   , <span class="methodparam"><span class="type">string</span> <code class="parameter reference">&amp;$crypted</code></span>
   , <span class="methodparam"><span class="type"><a href="language.pseudo-types.html#language.types.mixed" class="type mixed">mixed</a></span> <code class="parameter">$key</code></span>
   [, <span class="methodparam"><span class="type">int</span> <code class="parameter">$padding</code><span class="initializer"> = OPENSSL_PKCS1_PADDING</span></span>
  ] )</div>

  <p class="para rdfs-comment">
   <span class="function"><strong>openssl_public_encrypt()</strong></span> encrypts <code class="parameter">data</code>
   with public <code class="parameter">key</code> and stores the result into
   <code class="parameter">crypted</code>. Encrypted data can be decrypted via
   <span class="function"><a href="function.openssl-private-decrypt.html" class="function">openssl_private_decrypt()</a></span>. 
  </p>
  <p class="para">
   This function can be used e.g. to encrypt message which can be then read
   only by owner of the private key. It can be also used to store secure data
   in database.
  </p>
 </div>


 <div class="refsect1 parameters" id="refsect1-function.openssl-public-encrypt-parameters">
  <h3 class="title">Parameters</h3>
  <p class="para">
   </p><dl>

    
     <dt>
<code class="parameter">data</code></dt>

     <dd>

      <p class="para">
      </p>
     </dd>

    
    
     <dt>
<code class="parameter">crypted</code></dt>

     <dd>

      <p class="para">
       This will hold the result of the encryption.
      </p>
     </dd>

    
    
     <dt>
<code class="parameter">key</code></dt>

     <dd>

      <p class="para">
       The public key.
      </p>
     </dd>

    
    
     <dt>
<code class="parameter">padding</code></dt>

     <dd>

      <p class="para">
       <code class="parameter">padding</code> can be one of
       <strong><code>OPENSSL_PKCS1_PADDING</code></strong>,
       <strong><code>OPENSSL_SSLV23_PADDING</code></strong>,
       <strong><code>OPENSSL_PKCS1_OAEP_PADDING</code></strong>,
       <strong><code>OPENSSL_NO_PADDING</code></strong>.
      </p>
     </dd>

    
   </dl>

  <p></p>
 </div>


 <div class="refsect1 returnvalues" id="refsect1-function.openssl-public-encrypt-returnvalues">
  <h3 class="title">Return Values</h3>
  <p class="para">
   Returns <strong><code>TRUE</code></strong> on success or <strong><code>FALSE</code></strong> on failure.
  </p>
 </div>


 <div class="refsect1 seealso" id="refsect1-function.openssl-public-encrypt-seealso">
  <h3 class="title">See Also</h3>
  <p class="para">
   </p><ul class="simplelist">
    <li class="member"><span class="function"><a href="function.openssl-private-encrypt.html" class="function" rel="rdfs-seeAlso">openssl_private_encrypt()</a> - Encrypts data with private key</span></li>
    <li class="member"><span class="function"><a href="function.openssl-private-decrypt.html" class="function" rel="rdfs-seeAlso">openssl_private_decrypt()</a> - Decrypts data with private key</span></li>
   </ul>
  <p></p>
 </div>


</div>
<section id="usernotes">
 <div class="head"><h3 class="title">User Contributed Notes</h3></div><div id="allnotes">
  <div class="note" id="104420">  
  <a class="name">
  <strong class="user"><em>ppostma1</em></strong></a><div class="date" title="2011-06-14 12:09"><strong>3 years ago</strong></div>
  <div class="text" id="Hcom104420">
<div class="phpcode"><code><span class="html">
The confusion most have seems to be on "mixed $key"
<br>
<br>The $key is explained in, and mostly the same as the parameter of <a rel="nofollow" target="_blank">http://www.php.net/manual/en/function.openssl-pkey-get-public.php</a>
<br>
<br>It can take the resource $key returned from openssl_pkey_get_public() OR find the value is text and passes the text to openssl_pkey_get_public() to get a valid resource.
<br>
<br>To better break down rstinnett's example:
<br>(and where the flaw is)
<br>
<br><span class="default">&lt;?php
<br></span><span class="keyword">function </span><span class="default">EncryptData</span><span class="keyword">(</span><span class="default">$source</span><span class="keyword">)
<br>{
<br>&nbsp; </span><span class="default">$fp</span><span class="keyword">=</span><span class="default">fopen</span><span class="keyword">(</span><span class="string">"/etc/httpd/conf/ssl.crt/server.crt"</span><span class="keyword">,</span><span class="string">"r"</span><span class="keyword">);
<br>&nbsp; </span><span class="default">$pub_key_string</span><span class="keyword">=</span><span class="default">fread</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">,</span><span class="default">8192</span><span class="keyword">);
<br>&nbsp; </span><span class="default">fclose</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">);
<br>&nbsp; </span><span class="default">openssl_get_publickey</span><span class="keyword">(</span><span class="default">$pub_key</span><span class="keyword">);
<br>
<br>&nbsp; </span><span class="default">openssl_public_encrypt</span><span class="keyword">(</span><span class="default">$source</span><span class="keyword">,</span><span class="default">$crypttext</span><span class="keyword">,</span><span class="default">$pub_key_string</span><span class="keyword">);
<br>&nbsp; </span><span class="comment">/*this simply passes the string contents of pub_key_string back to be decoded*/
<br>&nbsp; </span><span class="keyword">return(</span><span class="default">base64_encode</span><span class="keyword">(</span><span class="default">$crypttext</span><span class="keyword">));
<br>}
<br></span><span class="default">?&gt;
<br></span>
<br>is more efficient:
<br>
<br><span class="default">&lt;?php
<br></span><span class="keyword">function </span><span class="default">EncryptData</span><span class="keyword">(</span><span class="default">$source</span><span class="keyword">)
<br>{
<br>&nbsp; </span><span class="default">$fp</span><span class="keyword">=</span><span class="default">fopen</span><span class="keyword">(</span><span class="string">"/etc/httpd/conf/ssl.crt/server.crt"</span><span class="keyword">,</span><span class="string">"r"</span><span class="keyword">);
<br>&nbsp; </span><span class="default">$pub_key_string</span><span class="keyword">=</span><span class="default">fread</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">,</span><span class="default">8192</span><span class="keyword">);
<br>&nbsp; </span><span class="default">fclose</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">);
<br>&nbsp; </span><span class="default">$key_resource </span><span class="keyword">= </span><span class="default">openssl_get_publickey</span><span class="keyword">(</span><span class="default">$pub_key</span><span class="keyword">);
<br>
<br>&nbsp; </span><span class="default">openssl_public_encrypt</span><span class="keyword">(</span><span class="default">$source</span><span class="keyword">,</span><span class="default">$crypttext</span><span class="keyword">, </span><span class="default">$key_resource </span><span class="keyword">);
<br>&nbsp; </span><span class="comment">/*uses the already existing key resource*/
<br>&nbsp; </span><span class="keyword">return(</span><span class="default">base64_encode</span><span class="keyword">(</span><span class="default">$crypttext</span><span class="keyword">));
<br>}
<br></span><span class="default">?&gt;
<br></span>
<br>shorter:
<br>
<br><span class="default">&lt;?php
<br></span><span class="keyword">function </span><span class="default">EncryptData</span><span class="keyword">(</span><span class="default">$source</span><span class="keyword">)
<br>{
<br>&nbsp; </span><span class="default">$fp</span><span class="keyword">=</span><span class="default">fopen</span><span class="keyword">(</span><span class="string">"/etc/httpd/conf/ssl.crt/server.crt"</span><span class="keyword">,</span><span class="string">"r"</span><span class="keyword">);
<br>&nbsp; </span><span class="default">$pub_key</span><span class="keyword">=</span><span class="default">fread</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">,</span><span class="default">8192</span><span class="keyword">);
<br>&nbsp; </span><span class="default">fclose</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">);
<br>
<br>&nbsp; </span><span class="default">openssl_public_encrypt</span><span class="keyword">(</span><span class="default">$source</span><span class="keyword">,</span><span class="default">$crypttext</span><span class="keyword">, </span><span class="default">$pub_key </span><span class="keyword">);
<br>
<br>&nbsp; return(</span><span class="default">base64_encode</span><span class="keyword">(</span><span class="default">$crypttext</span><span class="keyword">));
<br>}
<br></span><span class="default">?&gt;</span>
</span>
</code></div>
  </div>
 </div>
  <div class="note" id="55901">  
  <a class="name">
  <strong class="user"><em>Thomas Horsten</em></strong></a><div class="date" title="2005-08-16 04:21"><strong>9 years ago</strong></div>
  <div class="text" id="Hcom55901">
<div class="phpcode"><code><span class="html">
chsnyder writes that the data is limited to 936 bits in his implementation.<br><br>Actually, it has nothing to do with RSA being CPU intensive, RAM or anything of the sort.<br><br>Basically when you encrypt something using an RSA key (whether public or private), the encrypted value must be smaller than the key (due to the maths used to do the actual encryption). So if you have a 1024-bit key, in theory you could encrypt any 1023-bit value (or a 1024-bit value smaller than the key) with that key.<br><br>However, the PKCS#1 standard, which OpenSSL uses, specifies a padding scheme (so you can encrypt smaller quantities without losing security), and that padding scheme takes a minimum of 11 bytes (it will be longer if the value you're encrypting is smaller). So the highest number of bits you can encrypt with a 1024-bit key is 936 bits because of this (unless you disable the padding by adding the OPENSSL_NO_PADDING flag, in which case you can go up to 1023-1024 bits). With a 2048-bit key it's 1960 bits instead.<br><br>But as chsnyder correctly wrote, the normal application of a public key encryption algorithm is to store a key or a hash of the data you want to respectively encrypt or sign. A hash is typically 128-256 bits (the PHP sha1() function returns a 160 bit hash). And an AES key is 128 to 256 bits. So either of those will comfortably fit inside a single RSA encryption.</span>
</code></div>
  </div>
 </div>
  <div class="note" id="95307">  
  <a class="name">
  <strong class="user"><em>public at grik dot net</em></strong></a><div class="date" title="2009-12-25 10:10"><strong>4 years ago</strong></div>
  <div class="text" id="Hcom95307">
<div class="phpcode"><code><span class="html">
openssl_private_encrypt() has a low limit for the length of the data it can encrypt due to the nature of the algorithm.<br><br>To encrypt the larger data you can use openssl_encrypt() with a random password (like sha1(microtime(true))), and encrypt the password with openssl_public_encrypt().<br>This way the data can be encrypted with a public key and decrypted with the private one.</span>
</code></div>
  </div>
 </div>
  <div class="note" id="31311">  
  <a class="name">
  <strong class="user"><em>lonewolf at greyskydesigns dot com</em></strong></a><div class="date" title="2003-04-16 10:28"><strong>11 years ago</strong></div>
  <div class="text" id="Hcom31311">
<div class="phpcode"><code><span class="html">
Easy way:<br><br><span class="default">&lt;?php<br><br>$publicKey </span><span class="keyword">= </span><span class="string">"file://path/to/public/key-crt.pem"</span><span class="keyword">;<br></span><span class="default">$plaintext </span><span class="keyword">= </span><span class="string">"String to encrypt"</span><span class="keyword">;<br><br></span><span class="default">openssl_public_encrypt</span><span class="keyword">(</span><span class="default">$plaintext</span><span class="keyword">, </span><span class="default">$encrypted</span><span class="keyword">, </span><span class="default">$publicKey</span><span class="keyword">);<br><br>echo </span><span class="default">$encrypted</span><span class="keyword">;&nbsp;&nbsp; </span><span class="comment">//encrypted string<br><br></span><span class="default">?&gt;</span>
</span>
</code></div>
  </div>
 </div>
  <div class="note" id="115138">  
  <a class="name">
  <strong class="user"><em>AoK</em></strong></a><div class="date" title="2014-06-02 03:16"><strong>2 months ago</strong></div>
  <div class="text" id="Hcom115138">
<div class="phpcode"><code><span class="html">
Very important to recognize the maximum size $data string constraint and its relation to SSL bit size as pointed out by others.&nbsp; Before I addressed the maximum size limit through blocking the data, I was receiving these types of errors from openssl_error_string():<br>- error:0906D06C:PEM routines:PEM_read_bio:no start line&nbsp; OR<br>- error:0E06D06C:configuration file routines:NCONF_get_string:no value<br>Using a key (sha512, OPENSSL_KEYTYPE_RSA) with 2048 bits, I had a maximum message size of 245 bytes and 4096 bits yielded a max size of 502 bytes.&nbsp; So if you change your key size later, in particular if you reduce the size of it, be aware it affects your maximum encryption length.</span>
</code></div>
  </div>
 </div>
  <div class="note" id="56449">  
  <a class="name">
  <strong class="user"><em>adrian</em></strong></a><div class="date" title="2005-09-02 02:53"><strong>8 years ago</strong></div>
  <div class="text" id="Hcom56449">
<div class="phpcode"><code><span class="html">
T. Horsten explained the size limits on raw encryption. Here are two functions to encrypt/decrypt larger data when you can't use the envelope functions:<br><br>function ssl_encrypt($source,$type,$key){<br>//Assumes 1024 bit key and encrypts in chunks.<br><br>$maxlength=117;<br>$output='';<br>while($source){<br>&nbsp; $input= substr($source,0,$maxlength);<br>&nbsp; $source=substr($source,$maxlength);<br>&nbsp; if($type=='private'){<br>&nbsp; &nbsp; $ok= openssl_private_encrypt($input,$encrypted,$key);<br>&nbsp; }else{<br>&nbsp; &nbsp; $ok= openssl_public_encrypt($input,$encrypted,$key);<br>&nbsp; }<br>&nbsp; &nbsp; &nbsp; &nbsp; <br>&nbsp; $output.=$encrypted;<br>}<br>return $output;<br>}<br><br>function ssl_decrypt($source,$type,$key){<br>// The raw PHP decryption functions appear to work<br>// on 128 Byte chunks. So this decrypts long text<br>// encrypted with ssl_encrypt().<br><br>$maxlength=128;<br>$output='';<br>while($source){<br>&nbsp; $input= substr($source,0,$maxlength);<br>&nbsp; $source=substr($source,$maxlength);<br>&nbsp; if($type=='private'){<br>&nbsp; &nbsp; $ok= openssl_private_decrypt($input,$out,$key);<br>&nbsp; }else{<br>&nbsp; &nbsp; $ok= openssl_public_decrypt($input,$out,$key);<br>&nbsp; }<br>&nbsp; &nbsp; &nbsp; &nbsp; <br>&nbsp; $output.=$out;<br>}<br>return $output;<br><br>}</span>
</code></div>
  </div>
 </div>
  <div class="note" id="54320">  
  <a class="name">
  <strong class="user"><em>kenashkov at gmail dot com</em></strong></a><div class="date" title="2005-06-30 05:04"><strong>9 years ago</strong></div>
  <div class="text" id="Hcom54320">
<div class="phpcode"><code><span class="html">
The encrypted data can be stored in MySQL without use of base64. It must be properly escaped with mysql_real_escape_string(), and then saved to BLOB column. (In fact - this function must be used every time when you insert binary data in MySQL).</span>
</code></div>
  </div>
 </div>
  <div class="note" id="46321">  
  <a class="name">
  <strong class="user"><em>rstinnett at bfmhconsulting dot com</em></strong></a><div class="date" title="2004-10-06 06:37"><strong>9 years ago</strong></div>
  <div class="text" id="Hcom46321">
<div class="phpcode"><code><span class="html">
To store the encrypted data in a MySQL database, you first have to encode the data so it can safely be written. You can use a blob type for this, but it can make SELECTs really nasty. The easiest way I have found to do this is with base64_encode and base64_decode. The following example using code from a previous example and split into encrypt and decrypt functions.<br><br>function EncryptData($source)<br>{<br>&nbsp; $fp=fopen("/etc/httpd/conf/ssl.crt/server.crt","r");<br>&nbsp; $pub_key=fread($fp,8192);<br>&nbsp; fclose($fp);<br>&nbsp; openssl_get_publickey($pub_key);<br>&nbsp; /*<br>&nbsp;&nbsp; * NOTE:&nbsp; Here you use the $pub_key value (converted, I guess)<br>&nbsp;&nbsp; */<br>&nbsp; openssl_public_encrypt($source,$crypttext,$pub_key);<br>&nbsp; return(base64_encode($crypttext));<br>}<br><br>function DecryptData($source)<br>{<br>&nbsp; #print("number : $number");<br>&nbsp; $fp=fopen("/etc/httpd/conf/ssl.key/server.key","r");<br>&nbsp; $priv_key=fread($fp,8192);<br>&nbsp; fclose($fp);<br>&nbsp; // $passphrase is required if your key is encoded (suggested)<br>&nbsp; $res = openssl_get_privatekey($priv_key,$passphrase);<br>&nbsp; /*<br>&nbsp;&nbsp; * NOTE:&nbsp; Here you use the returned resource value<br>&nbsp;&nbsp; */<br>&nbsp; $decoded_source = base64_decode($source);<br>&nbsp; openssl_private_decrypt($decoded_source,$newsource,$res);<br>&nbsp; return($newsource);<br>}<br><br>Just use the return values to store the encrypted data or display the decrypted data.</span>
</code></div>
  </div>
 </div>
  <div class="note" id="30313">  
  <a class="name">
  <strong class="user"><em>webmaster at costarica-travelinfo dot com</em></strong></a><div class="date" title="2003-03-13 02:51"><strong>11 years ago</strong></div>
  <div class="text" id="Hcom30313">
<div class="phpcode"><code><span class="html">
This example worked for me:<br><br>RedHat 7.2 / php 4.2.2 / Apache 1.3.7<br><br>// STEP 1: Encryption with Public Key (you will need Private Key to decrypt - see step2).<br><br>$string="Some Important Data";<br>$fp=fopen ("cert.pem","r");<br>$pub_key=fread ($fp,8192);<br>fclose($fp);<br>$PK="";<br>$PK=openssl_get_publickey($pub_key);<br>if (!$PK) {<br>&nbsp; &nbsp; echo "Cannot get public key";<br>}<br>$finaltext="";<br>openssl_public_encrypt($string,$finaltext,$PK);<br>if (!empty($finaltext)) {<br>&nbsp; &nbsp; openssl_free_key($PK);<br>&nbsp; &nbsp; echo "Encryption OK!";<br>}else{<br>&nbsp; &nbsp; echo "Cannot Encrypt";<br>}<br><br>// STEP 2: Decription (Using Private Key)<br><br>$fp=fopen ("pk.pem","r");<br>$priv_key2=fread ($fp,8192);<br>fclose($fp);<br>$PK2=openssl_get_privatekey($priv_key2);<br>$Crypted=openssl_private_decrypt($Data,$Decrypted,$PK2);<br>if (!$Crypted) {<br>&nbsp; &nbsp; $MSG.="&lt;p class='error'&gt;Cannot Decrypt ($CCID).&lt;/p&gt;";<br>}else{<br>&nbsp; &nbsp; echo "Decrypted Data: " . $Decrypted;<br>}</span>
</code></div>
  </div>
 </div>
  <div class="note" id="98927">  
  <a class="name">
  <strong class="user"><em>Mark Seecof</em></strong></a><div class="date" title="2010-07-16 12:37"><strong>4 years ago</strong></div>
  <div class="text" id="Hcom98927">
<div class="phpcode"><code><span class="html">
If you need a message key, obtain it from the openssl_random_pseudo_bytes() function.<br><br>DO NOT just hash the current time-- an attacker will guess any such key very easily (he'll just hash a bunch of likely time values and try them until he finds the right one.&nbsp; The attacker can generate and test many millions of candidate hashes every minute using an ordinary PC).</span>
</code></div>
  </div>
 </div>
  <div class="note" id="50145">  
  <a class="name">
  <strong class="user"><em>chsnyder at gmail dot com</em></strong></a><div class="date" title="2005-02-19 09:18"><strong>9 years ago</strong></div>
  <div class="text" id="Hcom50145">
<div class="phpcode"><code><span class="html">
In comment below, Jeff says the input to this function is limited to "about 50 characters". On my PHP5 build, the limit is 117 characters (936 bits, strange number).<br><br>That's because public key encryption is CPU intensive, and meant to be used on short values. The idea is to use this function to encrypt a secret key that is in turn used to encrypt data using a more efficient algorithm, such as RC4 or TripleDES. The recipient uses their private key to decrypt the secret, and can then decrypt the data.<br><br>The openssl_seal() and openssl_open() functions do this internally, and are very well documented. You should probably use them instead.</span>
</code></div>
  </div>
 </div>
  <div class="note" id="47333">  
  <a class="name">
  <strong class="user"><em>pigo at ms5 dot url dot com dot tw</em></strong></a><div class="date" title="2004-11-11 12:33"><strong>9 years ago</strong></div>
  <div class="text" id="Hcom47333">
<div class="phpcode"><code><span class="html">
openssl_public_encrypt and openssl_private_encrypt can't encrypt large data . so I write a class . this class can encrypt large data and decrypt.<br><br>look url : <a rel="nofollow" target="_blank">http://pigo.pigo.idv.tw/opensslcrypt.phps</a></span>
</code></div>
  </div>
 </div>
  <div class="note" id="42286">  
  <a class="name">
  <strong class="user"><em>Jeff</em></strong></a><div class="date" title="2004-05-11 12:18"><strong>10 years ago</strong></div>
  <div class="text" id="Hcom42286">
<div class="phpcode"><code><span class="html">
I figured it out.&nbsp; This function is not intended for general encryption and decryption.&nbsp; For that, you want openssl_seal() and openssl_open().</span>
</code></div>
  </div>
 </div>
  <div class="note" id="42259">  
  <a class="name">
  <strong class="user"><em>Jeff</em></strong></a><div class="date" title="2004-05-10 02:15"><strong>10 years ago</strong></div>
  <div class="text" id="Hcom42259">
<div class="phpcode"><code><span class="html">
It looks like there is a limit on the size of the string to be encrypted: about 50 characters.<br><br>This is due to the fact that the implementation allocates an output buffer of size EVP_PKEY_size(pkey), which is totally arbitrary and unrelated to the size of the input.&nbsp; Also, it's not using a cipher envelope approach.&nbsp; It's just RSAing the input string.</span>
</code></div>
  </div>
 </div>
  <div class="note" id="19725">  
  <a class="name">
  <strong class="user"><em>wfredkNOSPAM at L5DevelopmentNOSPAM dot com</em></strong></a><div class="date" title="2002-03-08 03:56"><strong>12 years ago</strong></div>
  <div class="text" id="Hcom19725">
<div class="phpcode"><code><span class="html">
Encrypt using public key, decrypt using private key.<br><br>Use this to store stuff in your database: Unless someone<br>has your private key, the database contents are useless.<br><br>Also, use this for sending to a specific individual:&nbsp; Get<br>their public key, encrypt the message, only they can use<br>their private key to decode it.<br><br><span class="default">&lt;?php<br></span><span class="keyword">echo </span><span class="string">"Source: </span><span class="default">$source</span><span class="string">"</span><span class="keyword">;<br></span><span class="default">$fp</span><span class="keyword">=</span><span class="default">fopen </span><span class="keyword">(</span><span class="string">"/path/to/certificate.crt"</span><span class="keyword">,</span><span class="string">"r"</span><span class="keyword">);<br></span><span class="default">$pub_key</span><span class="keyword">=</span><span class="default">fread</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">,</span><span class="default">8192</span><span class="keyword">);<br></span><span class="default">fclose</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">);<br></span><span class="default">openssl_get_publickey</span><span class="keyword">(</span><span class="default">$pub_key</span><span class="keyword">);<br></span><span class="comment">/*<br> * NOTE:&nbsp; Here you use the $pub_key value (converted, I guess)<br> */<br></span><span class="default">openssl_public_encrypt</span><span class="keyword">(</span><span class="default">$source</span><span class="keyword">,</span><span class="default">$crypttext</span><span class="keyword">,</span><span class="default">$pub_key</span><span class="keyword">);<br>echo </span><span class="string">"String crypted: </span><span class="default">$crypttext</span><span class="string">"</span><span class="keyword">;<br><br></span><span class="default">$fp</span><span class="keyword">=</span><span class="default">fopen</span><span class="keyword">(</span><span class="string">"/path/to/private.key"</span><span class="keyword">,</span><span class="string">"r"</span><span class="keyword">);<br></span><span class="default">$priv_key</span><span class="keyword">=</span><span class="default">fread</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">,</span><span class="default">8192</span><span class="keyword">);<br></span><span class="default">fclose</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">);<br></span><span class="comment">// $passphrase is required if your key is encoded (suggested)<br></span><span class="default">$res </span><span class="keyword">= </span><span class="default">openssl_get_privatekey</span><span class="keyword">(</span><span class="default">$priv_key</span><span class="keyword">,</span><span class="default">$passphrase</span><span class="keyword">);<br></span><span class="comment">/*<br> * NOTE:&nbsp; Here you use the returned resource value<br> */<br></span><span class="default">openssl_private_decrypt</span><span class="keyword">(</span><span class="default">$crypttext</span><span class="keyword">,</span><span class="default">$newsource</span><span class="keyword">,</span><span class="default">$res</span><span class="keyword">);<br>echo </span><span class="string">"String decrypt : </span><span class="default">$newsource</span><span class="string">"</span><span class="keyword">;<br></span><span class="default">?&gt;</span>
</span>
</code></div>
  </div>
 </div>
  <div class="note" id="25810">  
  <a class="name">
  <strong class="user"><em>hromi at kyberia dot sk</em></strong></a><div class="date" title="2002-10-07 10:31"><strong>11 years ago</strong></div>
  <div class="text" id="Hcom25810">
<div class="phpcode"><code><span class="html">
function description is wrong, you have to switch crypttext and text if you want it to work<br>this is correct:<br>bool openssl_public_encrypt ( string crypted, string data, mixed key [, int padding])</span>
</code></div>
  </div>
 </div>
  <div class="note" id="104567">  
  <a class="name">
  <strong class="user"><em>sumadhuracool at gmail dot com</em></strong></a><div class="date" title="2011-06-23 04:22"><strong>3 years ago</strong></div>
  <div class="text" id="Hcom104567">
<div class="phpcode"><code><span class="html">
length of the data &lt; length of the private key ..so i divided the message while taking it,put a ":::".then again encrpt it. look at the pgm to get an idea about this..
<br>
<br><span class="default">&lt;?php
<br>&nbsp; &nbsp; </span><span class="keyword">class </span><span class="default">cry
<br>&nbsp; &nbsp; </span><span class="keyword">{
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="comment"># generate a 1024 bit rsa private key, ask for a passphrase to encrypt it and save to file
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; //openssl genrsa -des3 -out /path/to/privatekey 1024
<br> 
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; # generate the public key for the private key and save to file
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; //openssl rsa -in /path/to/privatekey -pubout -out /path/to/publickey
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; //programatically using php-openssll
<br>
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; //This will call while registration
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="keyword">function </span><span class="default">gen_cert</span><span class="keyword">(</span><span class="default">$userid</span><span class="keyword">)
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$dn </span><span class="keyword">= array(</span><span class="string">"countryName" </span><span class="keyword">=&gt; </span><span class="string">'XX'</span><span class="keyword">, </span><span class="string">"stateOrProvinceName" </span><span class="keyword">=&gt; </span><span class="string">'State'</span><span class="keyword">, </span><span class="string">"localityName" </span><span class="keyword">=&gt; </span><span class="string">'SomewhereCity'</span><span class="keyword">, </span><span class="string">"organizationName" </span><span class="keyword">=&gt;</span><span class="string">'MySelf'</span><span class="keyword">, </span><span class="string">"organizationalUnitName" </span><span class="keyword">=&gt; </span><span class="string">'Whatever'</span><span class="keyword">, </span><span class="string">"commonName" </span><span class="keyword">=&gt; </span><span class="string">'mySelf'</span><span class="keyword">, </span><span class="string">"emailAddress" </span><span class="keyword">=&gt; </span><span class="string">'user@example.com'</span><span class="keyword">);
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="comment">//Passphrase can be taken during registration 
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; //Here its initialized to 1234 for sample&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$privkeypass </span><span class="keyword">= </span><span class="string">'root'</span><span class="keyword">;
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$numberofdays </span><span class="keyword">= </span><span class="default">365</span><span class="keyword">;
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="comment">//RSA encryption and 1024 bits length
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$privkey </span><span class="keyword">= </span><span class="default">openssl_pkey_new</span><span class="keyword">(array(</span><span class="string">'private_key_bits' </span><span class="keyword">=&gt; </span><span class="default">1024</span><span class="keyword">,</span><span class="string">'private_key_type' </span><span class="keyword">=&gt; </span><span class="default">OPENSSL_KEYTYPE_RSA</span><span class="keyword">));
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$csr </span><span class="keyword">= </span><span class="default">openssl_csr_new</span><span class="keyword">(</span><span class="default">$dn</span><span class="keyword">, </span><span class="default">$privkey</span><span class="keyword">);
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$sscert </span><span class="keyword">= </span><span class="default">openssl_csr_sign</span><span class="keyword">(</span><span class="default">$csr</span><span class="keyword">, </span><span class="default">null</span><span class="keyword">, </span><span class="default">$privkey</span><span class="keyword">, </span><span class="default">$numberofdays</span><span class="keyword">);
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">openssl_x509_export</span><span class="keyword">(</span><span class="default">$sscert</span><span class="keyword">, </span><span class="default">$publickey</span><span class="keyword">);
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">openssl_pkey_export</span><span class="keyword">(</span><span class="default">$privkey</span><span class="keyword">, </span><span class="default">$privatekey</span><span class="keyword">, </span><span class="default">$privkeypass</span><span class="keyword">);
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">openssl_csr_export</span><span class="keyword">(</span><span class="default">$csr</span><span class="keyword">, </span><span class="default">$csrStr</span><span class="keyword">);
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="comment">//Generated keys are stored into files
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$fp</span><span class="keyword">=</span><span class="default">fopen</span><span class="keyword">(</span><span class="string">"../PKI/private/</span><span class="default">$userid</span><span class="string">.key"</span><span class="keyword">,</span><span class="string">"w"</span><span class="keyword">);
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">fwrite</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">,</span><span class="default">$privatekey</span><span class="keyword">);
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">fclose</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">); 
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$fp</span><span class="keyword">=</span><span class="default">fopen</span><span class="keyword">(</span><span class="string">"../PKI/public/</span><span class="default">$userid</span><span class="string">.crt"</span><span class="keyword">,</span><span class="string">"w"</span><span class="keyword">);
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">fwrite</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">,</span><span class="default">$publickey</span><span class="keyword">);
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">fclose</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">);&nbsp; &nbsp; &nbsp; &nbsp; 
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="comment">//Encryption with public key
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="keyword">function </span><span class="default">encrypt</span><span class="keyword">(</span><span class="default">$source</span><span class="keyword">,</span><span class="default">$rc</span><span class="keyword">)
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="comment">//path holds the certificate path present in the system&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$path</span><span class="keyword">=</span><span class="string">"../PKI/public/server.crt"</span><span class="keyword">;
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$fp</span><span class="keyword">=</span><span class="default">fopen</span><span class="keyword">(</span><span class="default">$path</span><span class="keyword">,</span><span class="string">"r"</span><span class="keyword">);
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$pub_key</span><span class="keyword">=</span><span class="default">fread</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">,</span><span class="default">8192</span><span class="keyword">);
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">fclose</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">);
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">openssl_get_publickey</span><span class="keyword">(</span><span class="default">$pub_key</span><span class="keyword">);
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="comment">//$source='';
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; //$source="sumanth ahoiadodakjaksdsa;ldadkkllksdalkalsdl;asld;ls sumanthasddddddddddddddddddddddddddddddddfsdfsffdfsdfsumanth";
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$j</span><span class="keyword">=</span><span class="default">0</span><span class="keyword">;
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$x</span><span class="keyword">=</span><span class="default">strlen</span><span class="keyword">(</span><span class="default">$source</span><span class="keyword">)/</span><span class="default">10</span><span class="keyword">;
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$y</span><span class="keyword">=</span><span class="default">floor</span><span class="keyword">(</span><span class="default">$x</span><span class="keyword">);
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; for(</span><span class="default">$i</span><span class="keyword">=</span><span class="default">0</span><span class="keyword">;</span><span class="default">$i</span><span class="keyword">&lt;</span><span class="default">$y</span><span class="keyword">;</span><span class="default">$i</span><span class="keyword">++)
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$crypttext</span><span class="keyword">=</span><span class="string">''</span><span class="keyword">;
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">openssl_public_encrypt</span><span class="keyword">(</span><span class="default">substr</span><span class="keyword">(</span><span class="default">$source</span><span class="keyword">,</span><span class="default">$j</span><span class="keyword">,</span><span class="default">10</span><span class="keyword">),</span><span class="default">$crypttext</span><span class="keyword">,</span><span class="default">$pub_key</span><span class="keyword">);</span><span class="default">$j</span><span class="keyword">=</span><span class="default">$j</span><span class="keyword">+</span><span class="default">10</span><span class="keyword">;
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$crt</span><span class="keyword">.=</span><span class="default">$crypttext</span><span class="keyword">;
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$crt</span><span class="keyword">.=</span><span class="string">":::"</span><span class="keyword">;
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if((</span><span class="default">strlen</span><span class="keyword">(</span><span class="default">$source</span><span class="keyword">)%</span><span class="default">10</span><span class="keyword">)&gt;</span><span class="default">0</span><span class="keyword">)
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">openssl_public_encrypt</span><span class="keyword">(</span><span class="default">substr</span><span class="keyword">(</span><span class="default">$source</span><span class="keyword">,</span><span class="default">$j</span><span class="keyword">),</span><span class="default">$crypttext</span><span class="keyword">,</span><span class="default">$pub_key</span><span class="keyword">);
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$crt</span><span class="keyword">.=</span><span class="default">$crypttext</span><span class="keyword">;
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }&nbsp; &nbsp; 
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; return(</span><span class="default">$crt</span><span class="keyword">);
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="comment">//Decryption with private key
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="keyword">function </span><span class="default">decrypt</span><span class="keyword">(</span><span class="default">$crypttext</span><span class="keyword">,</span><span class="default">$userid</span><span class="keyword">)
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$passphrase</span><span class="keyword">=</span><span class="string">"root"</span><span class="keyword">;
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$path</span><span class="keyword">=</span><span class="string">"../PKI/private/server.key"</span><span class="keyword">;
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$fpp1</span><span class="keyword">=</span><span class="default">fopen</span><span class="keyword">(</span><span class="default">$path</span><span class="keyword">,</span><span class="string">"r"</span><span class="keyword">);
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$priv_key</span><span class="keyword">=</span><span class="default">fread</span><span class="keyword">(</span><span class="default">$fpp1</span><span class="keyword">,</span><span class="default">8192</span><span class="keyword">);
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">fclose</span><span class="keyword">(</span><span class="default">$fpp1</span><span class="keyword">);
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$res1</span><span class="keyword">= </span><span class="default">openssl_get_privatekey</span><span class="keyword">(</span><span class="default">$priv_key</span><span class="keyword">,</span><span class="default">$passphrase</span><span class="keyword">);
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$tt</span><span class="keyword">=</span><span class="default">explode</span><span class="keyword">(</span><span class="string">":::"</span><span class="keyword">,</span><span class="default">$crypttext</span><span class="keyword">);
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$cnt</span><span class="keyword">=</span><span class="default">count</span><span class="keyword">(</span><span class="default">$tt</span><span class="keyword">);
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$i</span><span class="keyword">=</span><span class="default">0</span><span class="keyword">;
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; while(</span><span class="default">$i</span><span class="keyword">&lt;</span><span class="default">$cnt</span><span class="keyword">)
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">openssl_private_decrypt</span><span class="keyword">(</span><span class="default">$tt</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">],</span><span class="default">$str1</span><span class="keyword">,</span><span class="default">$res1</span><span class="keyword">);
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$str</span><span class="keyword">.=</span><span class="default">$str1</span><span class="keyword">;
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$i</span><span class="keyword">++;
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; return </span><span class="default">$str</span><span class="keyword">;&nbsp; &nbsp; &nbsp; 
<br>&nbsp; &nbsp; &nbsp; &nbsp; }
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; function </span><span class="default">sign</span><span class="keyword">(</span><span class="default">$source</span><span class="keyword">,</span><span class="default">$rc</span><span class="keyword">)
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$has</span><span class="keyword">=</span><span class="default">sha1</span><span class="keyword">(</span><span class="default">$source</span><span class="keyword">);
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$source</span><span class="keyword">.=</span><span class="string">"::"</span><span class="keyword">;
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$source</span><span class="keyword">.=</span><span class="default">$has</span><span class="keyword">;
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$path</span><span class="keyword">=</span><span class="string">"../PKI/public/</span><span class="default">$rc</span><span class="string">.crt"</span><span class="keyword">;
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$fp</span><span class="keyword">=</span><span class="default">fopen</span><span class="keyword">(</span><span class="default">$path</span><span class="keyword">,</span><span class="string">"r"</span><span class="keyword">);
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$pub_key</span><span class="keyword">=</span><span class="default">fread</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">,</span><span class="default">8192</span><span class="keyword">);
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">fclose</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">);
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">openssl_get_publickey</span><span class="keyword">(</span><span class="default">$pub_key</span><span class="keyword">);
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">openssl_public_encrypt</span><span class="keyword">(</span><span class="default">$source</span><span class="keyword">,</span><span class="default">$mese</span><span class="keyword">,</span><span class="default">$pub_key</span><span class="keyword">);
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; return </span><span class="default">$mese</span><span class="keyword">;
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; function </span><span class="default">verify</span><span class="keyword">(</span><span class="default">$crypttext</span><span class="keyword">,</span><span class="default">$userid</span><span class="keyword">)
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$passphrase</span><span class="keyword">=</span><span class="string">"root"</span><span class="keyword">;
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$path</span><span class="keyword">=</span><span class="string">"../PKI/private/</span><span class="default">$userid</span><span class="string">.key"</span><span class="keyword">;
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$fpp1</span><span class="keyword">=</span><span class="default">fopen</span><span class="keyword">(</span><span class="default">$path</span><span class="keyword">,</span><span class="string">"r"</span><span class="keyword">);
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$priv_key</span><span class="keyword">=</span><span class="default">fread</span><span class="keyword">(</span><span class="default">$fpp1</span><span class="keyword">,</span><span class="default">8192</span><span class="keyword">);
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">fclose</span><span class="keyword">(</span><span class="default">$fpp1</span><span class="keyword">);
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$res1</span><span class="keyword">= </span><span class="default">openssl_get_privatekey</span><span class="keyword">(</span><span class="default">$priv_key</span><span class="keyword">,</span><span class="default">$passphrase</span><span class="keyword">);
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">openssl_private_decrypt</span><span class="keyword">(</span><span class="default">$crypttext</span><span class="keyword">,</span><span class="default">$has1</span><span class="keyword">,</span><span class="default">$res1</span><span class="keyword">);
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; list(</span><span class="default">$c1</span><span class="keyword">,</span><span class="default">$c2</span><span class="keyword">)=</span><span class="default">split</span><span class="keyword">(</span><span class="string">"::"</span><span class="keyword">,</span><span class="default">$has1</span><span class="keyword">);
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$has</span><span class="keyword">=</span><span class="default">sha1</span><span class="keyword">(</span><span class="default">$c1</span><span class="keyword">);
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if(</span><span class="default">$has</span><span class="keyword">==</span><span class="default">$c2</span><span class="keyword">)
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$message</span><span class="keyword">=</span><span class="default">$c1</span><span class="keyword">;
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; return </span><span class="default">$message</span><span class="keyword">;
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; 
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }
<br>
<br>&nbsp; &nbsp; }
<br></span><span class="default">?&gt;</span>
</span>
</code></div>
  </div>
 </div></div>

 
</section>    </section><!-- layout-content -->
        


  </div><!-- layout -->
         
  

    
 <!-- External and third party libraries. -->
 







<a id="toTop" href="javascript:;"><span id="toTopHover"></span><img width="40" height="40" alt="To Top" src="../../images/to-top%402x.png"></a>



<!-- Mirrored from php.net/manual/en/function.openssl-public-encrypt.php by HTTrack Website Copier/3.x [XR&CO'2013], Thu, 28 Aug 2014 16:17:11 GMT -->


</body></html>