<html><!-- Mirrored from php.net/manual/en/function.gethostbyaddr.php by HTTrack Website Copier/3.x [XR&CO'2013], Thu, 28 Aug 2014 16:06:57 GMT --><!-- Added by HTTrack --><head><meta http-equiv="content-type" content="text/html;charset=utf-8"><!-- /Added by HTTrack -->


  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0"> 

  <title>gethostbyaddr</title>

 <link rel="shortcut icon" href="../../favicon.ico">
 <link rel="search" type="application/opensearchdescription+xml" href="http://php.net/phpnetimprovedsearch.src" title="Add PHP.net search">
 <link rel="alternate" type="application/atom+xml" href="http://php.net/releases/feed.php" title="PHP Release feed">
 <link rel="alternate" type="application/atom+xml" href="http://php.net/feed.atom" title="PHP: Hypertext Preprocessor">

 <link rel="canonical" href="function.gethostbyaddr.html">
 <link rel="shorturl" href="http://php.net/gethostbyaddr">
 <link rel="alternate" href="http://php.net/gethostbyaddr" hreflang="x-default">

 <link rel="contents" href="index-2.html">
 <link rel="index" href="ref.network.html">
 <link rel="prev" href="function.fsockopen.html">
 <link rel="next" href="function.gethostbyname.html">

 <link rel="alternate" href="function.gethostbyaddr.html" hreflang="en">
 <link rel="alternate" href="http://php.net/manual/pt_BR/function.gethostbyaddr.php" hreflang="pt_BR">
 <link rel="alternate" href="http://php.net/manual/zh/function.gethostbyaddr.php" hreflang="zh">
 <link rel="alternate" href="http://php.net/manual/fr/function.gethostbyaddr.php" hreflang="fr">
 <link rel="alternate" href="http://php.net/manual/de/function.gethostbyaddr.php" hreflang="de">
 <link rel="alternate" href="http://php.net/manual/it/function.gethostbyaddr.php" hreflang="it">
 <link rel="alternate" href="http://php.net/manual/ja/function.gethostbyaddr.php" hreflang="ja">
 <link rel="alternate" href="http://php.net/manual/ro/function.gethostbyaddr.php" hreflang="ro">
 <link rel="alternate" href="http://php.net/manual/ru/function.gethostbyaddr.php" hreflang="ru">
 <link rel="alternate" href="http://php.net/manual/es/function.gethostbyaddr.php" hreflang="es">
 <link rel="alternate" href="http://php.net/manual/tr/function.gethostbyaddr.php" hreflang="tr">

<link rel="stylesheet" type="text/css" href="../../cached8fe1.css?t=1401250819&amp;f=/fonts/Fira/fira.css" media="screen">
<link rel="stylesheet" type="text/css" href="../../cached4b8d.css?t=1404368420&amp;f=/fonts/Font-Awesome/css/fontello.css" media="screen">
<link rel="stylesheet" type="text/css" href="../../cached5065.css?t=1403329232&amp;f=/styles/theme-base.css" media="screen">
<link rel="stylesheet" type="text/css" href="../../cachedc78d.css?t=1401249623&amp;f=/styles/theme-medium.css" media="screen">

 <!--[if lte IE 7]>
 <link rel="stylesheet" type="text/css" href="http://php.net/styles/workarounds.ie7.css" media="screen">
 <![endif]-->

 <!--[if lte IE 8]>
 <script type="text/javascript">
  window.brokenIE = true;
 </script>
 <![endif]-->

 <!--[if lte IE 9]>
 <link rel="stylesheet" type="text/css" href="http://php.net/styles/workarounds.ie9.css" media="screen">
 <![endif]-->

 <!--[if IE]>
 <script type="text/javascript" src="http://php.net/js/ext/html5.js"></script>
 <![endif]-->

 <base>

</head>
<body class="docs " style="">


<div class="headsup"><a href="http://php.net/index.php#id2014-08-28-1">PHP 5.6.0 released</a></div>
<nav id="trick"><div><dl>
<dt><a href="getting-started.html">Getting Started</a></dt>
	<dd><a href="introduction.html">Introduction</a></dd>
	<dd><a href="tutorial.html">A simple tutorial</a></dd>
<dt><a href="langref.html">Language Reference</a></dt>
	<dd><a href="language.basic-syntax.html">Basic syntax</a></dd>
	<dd><a href="language.types.html">Types</a></dd>
	<dd><a href="language.variables.html">Variables</a></dd>
	<dd><a href="language.constants.html">Constants</a></dd>
	<dd><a href="language.expressions.html">Expressions</a></dd>
	<dd><a href="language.operators.html">Operators</a></dd>
	<dd><a href="language.control-structures.html">Control Structures</a></dd>
	<dd><a href="language.functions.html">Functions</a></dd>
	<dd><a href="language.oop5.html">Classes and Objects</a></dd>
	<dd><a href="language.namespaces.html">Namespaces</a></dd>
	<dd><a href="language.exceptions.html">Exceptions</a></dd>
	<dd><a href="language.generators.html">Generators</a></dd>
	<dd><a href="language.references.html">References Explained</a></dd>
	<dd><a href="reserved.variables.html">Predefined Variables</a></dd>
	<dd><a href="reserved.exceptions.html">Predefined Exceptions</a></dd>
	<dd><a href="reserved.interfaces.html">Predefined Interfaces and Classes</a></dd>
	<dd><a href="context.html">Context options and parameters</a></dd>
	<dd><a href="wrappers.html">Supported Protocols and Wrappers</a></dd>
</dl>
<dl>
<dt><a href="security.html">Security</a></dt>
	<dd><a href="security.intro.html">Introduction</a></dd>
	<dd><a href="security.general.html">General considerations</a></dd>
	<dd><a href="security.cgi-bin.html">Installed as CGI binary</a></dd>
	<dd><a href="security.apache.html">Installed as an Apache module</a></dd>
	<dd><a href="security.filesystem.html">Filesystem Security</a></dd>
	<dd><a href="security.database.html">Database Security</a></dd>
	<dd><a href="security.errors.html">Error Reporting</a></dd>
	<dd><a href="security.globals.html">Using Register Globals</a></dd>
	<dd><a href="security.variables.html">User Submitted Data</a></dd>
	<dd><a href="security.magicquotes.html">Magic Quotes</a></dd>
	<dd><a href="security.hiding.html">Hiding PHP</a></dd>
	<dd><a href="security.current.html">Keeping Current</a></dd>
<dt><a href="features.html">Features</a></dt>
	<dd><a href="features.http-auth.html">HTTP authentication with PHP</a></dd>
	<dd><a href="features.cookies.html">Cookies</a></dd>
	<dd><a href="features.sessions.html">Sessions</a></dd>
	<dd><a href="features.xforms.html">Dealing with XForms</a></dd>
	<dd><a href="features.file-upload.html">Handling file uploads</a></dd>
	<dd><a href="features.remote-files.html">Using remote files</a></dd>
	<dd><a href="features.connection-handling.html">Connection handling</a></dd>
	<dd><a href="features.persistent-connections.html">Persistent Database Connections</a></dd>
	<dd><a href="features.safe-mode.html">Safe Mode</a></dd>
	<dd><a href="features.commandline.html">Command line usage</a></dd>
	<dd><a href="features.gc.html">Garbage Collection</a></dd>
	<dd><a href="features.dtrace.html">DTrace Dynamic Tracing</a></dd>
</dl>
<dl>
<dt><a href="funcref.html">Function Reference</a></dt>
	<dd><a href="refs.basic.php.html">Affecting PHP's Behaviour</a></dd>
	<dd><a href="refs.utilspec.audio.html">Audio Formats Manipulation</a></dd>
	<dd><a href="refs.remote.auth.html">Authentication Services</a></dd>
	<dd><a href="refs.utilspec.cmdline.html">Command Line Specific Extensions</a></dd>
	<dd><a href="refs.compression.html">Compression and Archive Extensions</a></dd>
	<dd><a href="refs.creditcard.html">Credit Card Processing</a></dd>
	<dd><a href="refs.crypto.html">Cryptography Extensions</a></dd>
	<dd><a href="refs.database.html">Database Extensions</a></dd>
	<dd><a href="refs.calendar.html">Date and Time Related Extensions</a></dd>
	<dd><a href="refs.fileprocess.file.html">File System Related Extensions</a></dd>
	<dd><a href="refs.international.html">Human Language and Character Encoding Support</a></dd>
	<dd><a href="refs.utilspec.image.html">Image Processing and Generation</a></dd>
	<dd><a href="refs.remote.mail.html">Mail Related Extensions</a></dd>
	<dd><a href="refs.math.html">Mathematical Extensions</a></dd>
	<dd><a href="refs.utilspec.nontext.html">Non-Text MIME Output</a></dd>
	<dd><a href="refs.fileprocess.process.html">Process Control Extensions</a></dd>
	<dd><a href="refs.basic.other.html">Other Basic Extensions</a></dd>
	<dd><a href="refs.remote.other.html">Other Services</a></dd>
	<dd><a href="refs.search.html">Search Engine Extensions</a></dd>
	<dd><a href="refs.utilspec.server.html">Server Specific Extensions</a></dd>
	<dd><a href="refs.basic.session.html">Session Extensions</a></dd>
	<dd><a href="refs.basic.text.html">Text Processing</a></dd>
	<dd><a href="refs.basic.vartype.html">Variable and Type Related Extensions</a></dd>
	<dd><a href="refs.webservice.html">Web Services</a></dd>
	<dd><a href="refs.utilspec.windows.html">Windows Only Extensions</a></dd>
	<dd><a href="refs.xml.html">XML Manipulation</a></dd>
</dl>
<dl>
<dt>Keyboard Shortcuts</dt><dt>?</dt>
<dd>This help</dd>
<dt>j</dt>
<dd>Next menu item</dd>
<dt>k</dt>
<dd>Previous menu item</dd>
<dt>g p</dt>
<dd>Previous man page</dd>
<dt>g n</dt>
<dd>Next man page</dd>
<dt>G</dt>
<dd>Scroll to bottom</dd>
<dt>g g</dt>
<dd>Scroll to top</dd>
<dt>g h</dt>
<dd>Goto homepage</dd>
<dt>g s</dt>
<dd>Goto search<br>(current page)</dd>
<dt>/</dt>
<dd>Focus search box</dd>
</dl></div></nav>
<div id="goto">
    <div class="search">
         <div class="text"></div>
         <div class="results"><ul></ul></div>
   </div>
</div>

  <div id="breadcrumbs" class="row-fluid">
          
              
        <ul class="breadcrumbs-container">
            <li><a href="index-2.html">PHP Manual</a></li>      <li><a href="funcref.html">Function Reference</a></li>      <li><a href="refs.remote.other.html">Other Services</a></li>      <li><a href="book.network.html">Network</a></li>      <li><a href="ref.network.html">Network Functions</a></li>    </ul>
  </div>




<div id="layout">
  <section id="layout-content">
  <div id="function.gethostbyaddr" class="refentry">
 <div class="refnamediv">
  <h1 class="refname">gethostbyaddr</h1>
  <p class="verinfo">(PHP 4, PHP 5)</p><p class="refpurpose"><span class="refname">gethostbyaddr</span> â€” <span class="dc-title">
   Get the Internet host name corresponding to a given IP address
  </span></p>

 </div>
 <div class="refsect1 description" id="refsect1-function.gethostbyaddr-description">
  <h3 class="title">Description</h3>
  <div class="methodsynopsis dc-description">
   <span class="type">string</span> <span class="methodname"><strong>gethostbyaddr</strong></span>
    ( <span class="methodparam"><span class="type">string</span> <code class="parameter">$ip_address</code></span>
   )</div>

  <p class="para rdfs-comment">
   Returns the host name of the Internet host specified by
   <code class="parameter">ip_address</code>.
  </p>
 </div>


 <div class="refsect1 parameters" id="refsect1-function.gethostbyaddr-parameters">
  <h3 class="title">Parameters</h3>
  <p class="para">
   </p><dl>

    
     <dt>
<code class="parameter">ip_address</code></dt>

     <dd>

      <p class="para">
       The host IP address.
      </p>
     </dd>

    
   </dl>

  <p></p>
 </div>


 <div class="refsect1 returnvalues" id="refsect1-function.gethostbyaddr-returnvalues">
  <h3 class="title">Return Values</h3>
  <p class="para">
   Returns the host name on success, the unmodified <code class="parameter">ip_address</code>
   on failure, or <strong><code>FALSE</code></strong> on malformed input.
  </p>
 </div>


 <div class="refsect1 examples" id="refsect1-function.gethostbyaddr-examples">
  <h3 class="title">Examples</h3>
  <p class="para">
   </p><div class="example" id="example-4588">
    <p><strong>Example #1 A simple <span class="function"><strong>gethostbyaddr()</strong></span> example</strong></p>
    <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br>$hostname&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">gethostbyaddr</span><span style="color: #007700">(</span><span style="color: #0000BB">$_SERVER</span><span style="color: #007700">[</span><span style="color: #DD0000">'REMOTE_ADDR'</span><span style="color: #007700">]);<br><br>echo&nbsp;</span><span style="color: #0000BB">$hostname</span><span style="color: #007700">;<br></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
    </div>

   </div>
  <p></p>
 </div>


 <div class="refsect1 seealso" id="refsect1-function.gethostbyaddr-seealso">
  <h3 class="title">See Also</h3>
  <p class="para">
   </p><ul class="simplelist">
    <li class="member"><span class="function"><a href="function.gethostbyname.html" class="function" rel="rdfs-seeAlso">gethostbyname()</a> - Get the IPv4 address corresponding to a given Internet host name</span></li>
    <li class="member"><span class="function"><a href="function.gethostbynamel.html" class="function" rel="rdfs-seeAlso">gethostbynamel()</a> - Get a list of IPv4 addresses corresponding to a given Internet host
   name</span></li>
   </ul>
  <p></p>
 </div>


</div>
<section id="usernotes">
 <div class="head"><h3 class="title">User Contributed Notes</h3></div><div id="allnotes">
  <div class="note" id="26696">  
  <a class="name">
  <strong class="user"><em>lukevb_at_iafrica.com</em></strong></a><div class="date" title="2002-11-09 02:43"><strong>11 years ago</strong></div>
  <div class="text" id="Hcom26696">
<div class="phpcode"><code><span class="html">
Sometimes when using $_SERVER['HTTP_X_FORWARDED_FOR'] OR $_SERVER['REMOTE_ADDR'] more than 1 IP address is returned, for example '155.240.132.261, 196.250.25.120'. When this string is passed as an argument for gethostbyaddr() PHP gives the following error: Warning: Address is not a valid IPv4 or IPv6 address in... <br><br>To work around this I use the following code to extract the first IP address from the string and discard the rest. (If you wish to use the other IPs they will be in the other elements of the $ips array).<br><br>if (strstr($remoteIP, ', ')) {<br>&nbsp; &nbsp; $ips = explode(', ', $remoteIP);<br>&nbsp; &nbsp; $remoteIP = $ips[0];<br>}<br><br>Hope this helps someone :)</span>
</code></div>
  </div>
 </div>
  <div class="note" id="62449">  
  <a class="name">
  <strong class="user"><em>oryan at zareste dot com</em></strong></a><div class="date" title="2006-02-28 03:17"><strong>8 years ago</strong></div>
  <div class="text" id="Hcom62449">
<div class="phpcode"><code><span class="html">
If all else fails, but you have shell access, Unix/Linux servers can use this for a timeout response:<br><br>shell_exec('host -W 2 0.0.0.0');<br><br>Where 0.0.0.0 is of course the IP, and '2' is the number of seconds for the timeout.&nbsp; This returns a more detailed string of info, with some additional text which might vary depending on the system, so if you want a string with the hostname and nothing else, you'll have to do some substring cutting.&nbsp; There should be an equivalent of 'host' for Windows users to execute, but it isn't my platform.</span>
</code></div>
  </div>
 </div>
  <div class="note" id="46869">  
  <a class="name">
  <strong class="user"><em>king dot macro at gmail dot com</em></strong></a><div class="date" title="2004-10-26 07:28"><strong>9 years ago</strong></div>
  <div class="text" id="Hcom46869">
<div class="phpcode"><code><span class="html">
The problem of broken DNS servers was causing me a problem because i had a page for user statistics that required around 20 reverse dns lookups to be done, and even as many as 5/6 of them being broken was causing a huge delay in loading the page. so i wrote a function that uses a UDP socket to talk directly to the DNS server (instead of going via the normal gethostbyaddr function) this let me set a timeout.<br><br>The only requirement is that your DNS server must be able to do recursive lookups, it wont go to other DNS servers if its told to... and of course you need to know your DNS servers IP address :-)<br><br>&lt;?<br>function gethostbyaddr_timeout($ip, $dns, $timeout=1000)<br>{<br>&nbsp; &nbsp; // random transaction number (for routers etc to get the reply back)<br>&nbsp; &nbsp; $data = rand(0, 99);<br>&nbsp; &nbsp; // trim it to 2 bytes<br>&nbsp; &nbsp; $data = substr($data, 0, 2);<br>&nbsp; &nbsp; // request header<br>&nbsp; &nbsp; $data .= "\1\0\0\1\0\0\0\0\0\0";<br>&nbsp; &nbsp; // split IP up<br>&nbsp; &nbsp; $bits = explode(".", $ip);<br>&nbsp; &nbsp; // error checking<br>&nbsp; &nbsp; if (count($bits) != 4) return "ERROR";<br>&nbsp; &nbsp; // there is probably a better way to do this bit...<br>&nbsp; &nbsp; // loop through each segment<br>&nbsp; &nbsp; for ($x=3; $x&gt;=0; $x--)<br>&nbsp; &nbsp; {<br>&nbsp; &nbsp; &nbsp; &nbsp; // needs a byte to indicate the length of each segment of the request<br>&nbsp; &nbsp; &nbsp; &nbsp; switch (strlen($bits[$x]))<br>&nbsp; &nbsp; &nbsp; &nbsp; {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; case 1: // 1 byte long segment<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $data .= "\1"; break;<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; case 2: // 2 byte long segment<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $data .= "\2"; break;<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; case 3: // 3 byte long segment<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $data .= "\3"; break;<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; default: // segment is too big, invalid IP<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; return "INVALID";<br>&nbsp; &nbsp; &nbsp; &nbsp; }<br>&nbsp; &nbsp; &nbsp; &nbsp; // and the segment itself<br>&nbsp; &nbsp; &nbsp; &nbsp; $data .= $bits[$x];<br>&nbsp; &nbsp; }<br>&nbsp; &nbsp; // and the final bit of the request<br>&nbsp; &nbsp; $data .= "\7in-addr\4arpa\0\0\x0C\0\1";<br>&nbsp; &nbsp; // create UDP socket<br>&nbsp; &nbsp; $handle = @fsockopen("udp://$dns", 53);<br>&nbsp; &nbsp; // send our request (and store request size so we can cheat later)<br>&nbsp; &nbsp; $requestsize=@fwrite($handle, $data);<br><br>&nbsp; &nbsp; @socket_set_timeout($handle, $timeout - $timeout%1000, $timeout%1000);<br>&nbsp; &nbsp; // hope we get a reply<br>&nbsp; &nbsp; $response = @fread($handle, 1000);<br>&nbsp; &nbsp; @fclose($handle);<br>&nbsp; &nbsp; if ($response == "")<br>&nbsp; &nbsp; &nbsp; &nbsp; return $ip;<br>&nbsp; &nbsp; // find the response type<br>&nbsp; &nbsp; $type = @unpack("s", substr($response, $requestsize+2));<br>&nbsp; &nbsp; if ($type[1] == 0x0C00)&nbsp; // answer<br>&nbsp; &nbsp; {<br>&nbsp; &nbsp; &nbsp; &nbsp; // set up our variables<br>&nbsp; &nbsp; &nbsp; &nbsp; $host="";<br>&nbsp; &nbsp; &nbsp; &nbsp; $len = 0;<br>&nbsp; &nbsp; &nbsp; &nbsp; // set our pointer at the beginning of the hostname<br>&nbsp; &nbsp; &nbsp; &nbsp; // uses the request size from earlier rather than work it out<br>&nbsp; &nbsp; &nbsp; &nbsp; $position=$requestsize+12;<br>&nbsp; &nbsp; &nbsp; &nbsp; // reconstruct hostname<br>&nbsp; &nbsp; &nbsp; &nbsp; do<br>&nbsp; &nbsp; &nbsp; &nbsp; {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; // get segment size<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $len = unpack("c", substr($response, $position));<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; // null terminated string, so length 0 = finished<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if ($len[1] == 0)<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; // return the hostname, without the trailing .<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; return substr($host, 0, strlen($host) -1);<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; // add segment to our host<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $host .= substr($response, $position+1, $len[1]) . ".";<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; // move pointer on to the next segment<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $position += $len[1] + 1;<br>&nbsp; &nbsp; &nbsp; &nbsp; }<br>&nbsp; &nbsp; &nbsp; &nbsp; while ($len != 0);<br>&nbsp; &nbsp; &nbsp; &nbsp; // error - return the hostname we constructed (without the . on the end)<br>&nbsp; &nbsp; &nbsp; &nbsp; return $ip;<br>&nbsp; &nbsp; }<br>&nbsp; &nbsp; return $ip;<br>}<br>?&gt;<br><br>This could be expanded quite a bit and improved but it works and i've seen quite a few people trying various methods to achieve something like this so i decided to post it here. on most servers it should also be more efficient than other methods such as calling nslookup because it doesn't need to run external programs<br><br>Note: I'm more a C person than a PHP person, so just ignore it if anything hasn't been done the *recomended* way :-)</span>
</code></div>
  </div>
 </div>
  <div class="note" id="99648">  
  <a class="name">
  <strong class="user"><em>Stuart Macdonald</em></strong></a><div class="date" title="2010-08-28 05:07"><strong>4 years ago</strong></div>
  <div class="text" id="Hcom99648">
<div class="phpcode"><code><span class="html">
Here's a simple function that uses Dig to obtain the hostname for a given IP address. If no hostname can be found it returns the IP again.<br><br>Works only on linux / unix, or whatever other platform with dig installed as a command line utility.<br><br><span class="default">&lt;?php<br>&nbsp; &nbsp; </span><span class="keyword">function </span><span class="default">tryGetHost</span><span class="keyword">(</span><span class="default">$ip</span><span class="keyword">)<br>&nbsp; &nbsp; {<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$string </span><span class="keyword">= </span><span class="string">''</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">exec</span><span class="keyword">(</span><span class="string">"dig +short -x </span><span class="default">$ip</span><span class="string"> 2&gt;&amp;1"</span><span class="keyword">, </span><span class="default">$output</span><span class="keyword">, </span><span class="default">$retval</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; if (</span><span class="default">$retval </span><span class="keyword">!= </span><span class="default">0</span><span class="keyword">)<br>&nbsp; &nbsp; &nbsp; &nbsp; { <br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="comment">// there was an error performing the command<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="keyword">} <br>&nbsp; &nbsp; &nbsp; &nbsp; else <br>&nbsp; &nbsp; &nbsp; &nbsp; {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$x</span><span class="keyword">=</span><span class="default">0</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; while (</span><span class="default">$x </span><span class="keyword">&lt; (</span><span class="default">sizeof</span><span class="keyword">(</span><span class="default">$output</span><span class="keyword">)))<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$string</span><span class="keyword">.= </span><span class="default">$output</span><span class="keyword">[</span><span class="default">$x</span><span class="keyword">];<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$x</span><span class="keyword">++;<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br>&nbsp; &nbsp; &nbsp; &nbsp; }<br>&nbsp; &nbsp; &nbsp; &nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; if (empty(</span><span class="default">$string</span><span class="keyword">))<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$string </span><span class="keyword">= </span><span class="default">$ip</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; else </span><span class="comment">//remove the trailing dot<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$string </span><span class="keyword">= </span><span class="default">substr</span><span class="keyword">(</span><span class="default">$string</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, -</span><span class="default">1</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; return </span><span class="default">$string</span><span class="keyword">;<br>&nbsp; &nbsp; }<br></span><span class="default">?&gt;</span>
</span>
</code></div>
  </div>
 </div>
  <div class="note" id="57553">  
  <a class="name">
  <strong class="user"><em>tom</em></strong></a><div class="date" title="2005-10-07 01:14"><strong>8 years ago</strong></div>
  <div class="text" id="Hcom57553">
<div class="phpcode"><code><span class="html">
Be careful with the usage of this function - it will slow down a server to a crawl if called a lot and the slowness won't be reflected in any of the obvious places, like CPU usage, apache requests, SQL etc. When you do use it make a special note of where!</span>
</code></div>
  </div>
 </div>
  <div class="note" id="34598">  
  <a class="name">
  <strong class="user"><em>grimNOSPAMtraffic at hotNOSPAMmail dot com</em></strong></a><div class="date" title="2003-07-31 02:31"><strong>11 years ago</strong></div>
  <div class="text" id="Hcom34598">
<div class="phpcode"><code><span class="html">
If you have found the host of the ip, the shortest way to cut it not to display the full hostname to the public would be:<br><br>$host = substr($host, strpos($host, ".") + 1);<br><br>P.S. strpos() can also be easily used if you want to put "*" for every simbol you ommit, like so:<br><br>$os = strpos($host, ".");<br>$host = substr($host, $os);<br>$host = str_repeat("*", $os) . $host;<br><br>--McTrafik</span>
</code></div>
  </div>
 </div>
  <div class="note" id="10608">  
  <a class="name">
  <strong class="user"><em>andy at occ dot nu</em></strong></a><div class="date" title="2001-01-12 06:48"><strong>13 years ago</strong></div>
  <div class="text" id="Hcom10608">
<div class="phpcode"><code><span class="html">
if the user is sitting behind a proxy server, you can do this;
<br>
<br>&lt;?
<br>&nbsp; &nbsp; if ($HTTP_SERVER_VARS["HTTP_X_FORWARDED_FOR"] != ""){
<br>&nbsp; &nbsp; &nbsp; &nbsp; $IP = $HTTP_SERVER_VARS["HTTP_X_FORWARDED_FOR"];
<br>&nbsp; &nbsp; &nbsp; &nbsp; $proxy = $HTTP_SERVER_VARS["REMOTE_ADDR"];
<br>&nbsp; &nbsp; &nbsp; &nbsp; $host = @gethostbyaddr($HTTP_SERVER_VARS["HTTP_X_FORWARDED_FOR"]);
<br>&nbsp; &nbsp; }else{
<br>&nbsp; &nbsp; &nbsp; &nbsp; $IP = $HTTP_SERVER_VARS["REMOTE_ADDR"];
<br>&nbsp; &nbsp; &nbsp; &nbsp; $host = @gethostbyaddr($HTTP_SERVER_VARS["REMOTE_ADDR"]);
<br>&nbsp; &nbsp; }
<br>?&gt;
<br>
<br>ps; i use $HTTP_SERVER_VARS["something"] instead of just $something;
<br>you can get most of the $HTTP_SERVER_VARS by just using there $something equivalent, see the manual for that (preserved variables)</span>
</code></div>
  </div>
 </div>
  <div class="note" id="105566">  
  <a class="name">
  <strong class="user"><em>Mark in Sussex</em></strong></a><div class="date" title="2011-08-28 11:21"><strong>3 years ago</strong></div>
  <div class="text" id="Hcom105566">
<div class="phpcode"><code><span class="html">
If you use gethostbyaddr() with a bad IP address then it will send an error message to the error log.
<br>If you don't want your error log file getting too big then first check that the IP address is valid.
<br>
<br>In the following example I first check if the IP number starts with a number,
<br>if not then don't use gethostbyaddr('..')
<br>
<br><span class="default">&lt;?php
<br>&nbsp; $IP </span><span class="keyword">= </span><span class="string">"BadValue.123.123.123"</span><span class="keyword">;
<br>&nbsp; if(</span><span class="default">intval</span><span class="keyword">(</span><span class="default">$IP</span><span class="keyword">)&gt;</span><span class="default">0</span><span class="keyword">){
<br>&nbsp; &nbsp; </span><span class="default">$ServerIP </span><span class="keyword">= </span><span class="default">gethostbyaddr</span><span class="keyword">(</span><span class="default">$IP</span><span class="keyword">);
<br>&nbsp; } else {
<br>&nbsp; &nbsp; </span><span class="default">$ServerIP </span><span class="keyword">= </span><span class="default">$IP</span><span class="keyword">; </span><span class="comment">// A bad address.
<br>&nbsp; </span><span class="keyword">}
<br></span><span class="default">?&gt;</span>
</span>
</code></div>
  </div>
 </div>
  <div class="note" id="101820">  
  <a class="name">
  <strong class="user"><em>james at trnxs dot net</em></strong></a><div class="date" title="2011-01-12 12:45"><strong>3 years ago</strong></div>
  <div class="text" id="Hcom101820">
<div class="phpcode"><code><span class="html">
You should be careful in the use of $_SERVER['HTTP_X_FORWARDED_FOR'], as I discovered, once using Amazon AWS's Elastic Load Balancer's, this value may be a comma separated list of IP addresses and will thusly not compare as conceived in almost every example I have seen posted by users in the comments.</span>
</code></div>
  </div>
 </div>
  <div class="note" id="100105">  
  <a class="name">
  <strong class="user"><em>dhjdhj at gmail dot com</em></strong></a><div class="date" title="2010-09-25 06:58"><strong>3 years ago</strong></div>
  <div class="text" id="Hcom100105">
<div class="phpcode"><code><span class="html">
I have observed that there are problems with all approaches that use the existence of an IP address to verify that the name being looked up actually exists.<br><br>If you're using opendns, then a request to a non-existent server returns an IP address anyway, the address being one for an opendns server. This is process is presumably in place so that errant URLs in browser requests take you to a "legitimate" page, i.e, the openDNS website where they can notify you of a problem.<br><br>Unfortunately, that mechanism seems to occur for ANY non-existent hostname. Appending a single period to the hostname does not seem to help.</span>
</code></div>
  </div>
 </div>
  <div class="note" id="94386">  
  <a class="name">
  <strong class="user"><em>marco[DOT]ceppi[@T]seacrow[DOT]org</em></strong></a><div class="date" title="2009-11-01 07:24"><strong>4 years ago</strong></div>
  <div class="text" id="Hcom94386">
<div class="phpcode"><code><span class="html">
Anonymous has a good point (though I don't agree with pushing to execution to shell unless I have to. However this is a faster example (explode then loop is a little too intensive for a simple check)<br><br><span class="default">&lt;?php<br></span><span class="keyword">function </span><span class="default">gethost </span><span class="keyword">(</span><span class="default">$ip</span><span class="keyword">)<br>{<br>&nbsp; &nbsp; </span><span class="comment">//Make sure the input is not going to do anything unexpected<br>&nbsp; &nbsp; //IPs must be in the form x.x.x.x with each x as a number<br>&nbsp; &nbsp; <br>&nbsp; &nbsp; </span><span class="keyword">if( </span><span class="default">preg_match</span><span class="keyword">(</span><span class="string">'/^(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]\d|\d)(?:[.]<br>(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]\d|\d)){3}$/'</span><span class="keyword">, </span><span class="default">$ip</span><span class="keyword">) )<br>&nbsp; &nbsp; {<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$host </span><span class="keyword">= `</span><span class="string">host </span><span class="default">$ip</span><span class="keyword">`;<br>&nbsp; &nbsp; &nbsp; &nbsp; return ((</span><span class="default">$host </span><span class="keyword">? </span><span class="default">end </span><span class="keyword">( </span><span class="default">explode </span><span class="keyword">(</span><span class="string">' '</span><span class="keyword">, </span><span class="default">$host</span><span class="keyword">)) : </span><span class="default">$ip</span><span class="keyword">));<br>&nbsp; &nbsp; }<br>&nbsp; &nbsp; else<br>&nbsp; &nbsp; {<br>&nbsp; &nbsp; &nbsp; &nbsp; return </span><span class="default">false</span><span class="keyword">;<br>&nbsp; &nbsp; }<br>}<br></span><span class="default">?&gt;<br></span><br>Though to be honest I would use:<br><br><span class="default">&lt;?php<br></span><span class="keyword">function </span><span class="default">gethost </span><span class="keyword">(</span><span class="default">$ip</span><span class="keyword">)<br>{<br>&nbsp; &nbsp; return ( </span><span class="default">preg_match</span><span class="keyword">(</span><span class="string">'/^(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]\d|\d)(?:[.]<br>(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]\d|\d)){3}$/'</span><span class="keyword">, </span><span class="default">$ip</span><span class="keyword">) ) ? </span><span class="default">gethostbyaddr</span><span class="keyword">(</span><span class="default">$ip</span><span class="keyword">) : </span><span class="default">false</span><span class="keyword">;<br>}<br></span><span class="default">?&gt;</span>
</span>
</code></div>
  </div>
 </div>
  <div class="note" id="86496">  
  <a class="name">
  <strong class="user"><em>webmaster at askapache dot com</em></strong></a><div class="date" title="2008-10-22 01:57"><strong>5 years ago</strong></div>
  <div class="text" id="Hcom86496">
<div class="phpcode"><code><span class="html">
Here is a simple function I compiled from user-notes that works great.. any improvements?
<br>
<br><span class="default">&lt;?php
<br></span><span class="keyword">function </span><span class="default">get_ip</span><span class="keyword">( </span><span class="default">$host </span><span class="keyword">){
<br>&nbsp; </span><span class="default">$hostip </span><span class="keyword">= @</span><span class="default">gethostbyname</span><span class="keyword">( </span><span class="default">$host </span><span class="keyword">);
<br>&nbsp; </span><span class="default">$ip </span><span class="keyword">= ( </span><span class="default">$hostip </span><span class="keyword">== </span><span class="default">$host </span><span class="keyword">) ? </span><span class="default">$host </span><span class="keyword">: </span><span class="default">long2ip</span><span class="keyword">( </span><span class="default">ip2long</span><span class="keyword">( </span><span class="default">$hostip </span><span class="keyword">) );
<br>&nbsp; </span><span class="comment">//echo sprintf("Resolved %s to %s", $host, $ip);
<br>&nbsp; </span><span class="keyword">return </span><span class="default">$ip</span><span class="keyword">;
<br>}
<br></span><span class="default">?&gt;</span>
</span>
</code></div>
  </div>
 </div>
  <div class="note" id="83654">  
  <a class="name">
  <strong class="user"><em>robbakAgmail_com</em></strong></a><div class="date" title="2008-06-05 11:19"><strong>6 years ago</strong></div>
  <div class="text" id="Hcom83654">
<div class="phpcode"><code><span class="html">
it appears that gethostbyname() fails if the domain name contains unicode. Example:<br><br> $ host 10.10.10.128<br>128.10.10.10.in-addr.arpa domain name pointer PC-de-S\130bastien.flexi.robbak.com.<br> $ php&nbsp;&nbsp; <br><span class="default">&lt;?php </span><span class="keyword">echo </span><span class="default">gethostbyaddr</span><span class="keyword">( </span><span class="string">'10.10.10.128' </span><span class="keyword">); </span><span class="default">?&gt;<br></span>10.10.10.128<br><br>gethostbyaddr is listed as unicode compatable in version 6, so a fix may be in the works.</span>
</code></div>
  </div>
 </div>
  <div class="note" id="79887">  
  <a class="name">
  <strong class="user"><em>billyblue</em></strong></a><div class="date" title="2007-12-17 08:12"><strong>6 years ago</strong></div>
  <div class="text" id="Hcom79887">
<div class="phpcode"><code><span class="html">
I just spent a dickens of a time trying to figure out why my gethostbyaddr's were simply failing halfway through.<br><br>I'm returning a log of page visits, and with each new IP, I wanted to pull the hostname of the IP. On each report page, I'm pulling 500 lines from my Db, but only maybe 25 IPs on average. Sometimes this report would generate in under 15 seconds, other times it would fail with a connection reset.<br><br>It turns out that several of the IPs in my Db looked like this: x.255.x.x. gethostbyaddr really hates that and simply dies when it reaches one of these IPs.<br><br>For my case, I purged the Db and prevented the logging of IPs that contain 255.</span>
</code></div>
  </div>
 </div>
  <div class="note" id="51820">  
  <a class="name">
  <strong class="user"><em>reinhard at ess dot co dot at</em></strong></a><div class="date" title="2005-04-12 02:27"><strong>9 years ago</strong></div>
  <div class="text" id="Hcom51820">
<div class="phpcode"><code><span class="html">
tried out some of the examples below, but no one worked for me.<br>(<br>"host" returns something if domain-name wasn't found<br>"gethostbyaddr" has a too long&nbsp; timeout when it fails<br>"the udp-example" returns some strange characters...<br>)<br>so i have changed the "host"-example a little bit. hope someone can need it. (maybe with little changes like without error-description)<br><br>&lt;?<br>function gethost($ip)<br>{<br>&nbsp;&nbsp; $host = `host $ip`;<br>&nbsp;&nbsp; $host=end(explode(' ',$host));<br>&nbsp;&nbsp; $host=substr($host,0,strlen($host)-2);<br>&nbsp;&nbsp; $chk=split("\(",$host);<br>&nbsp;&nbsp; if($chk[1]) return $ip." (".$chk[1].")";<br>&nbsp;&nbsp; else return $host;<br>}<br>?&gt;</span>
</code></div>
  </div>
 </div>
  <div class="note" id="40788">  
  <a class="name">
  <strong class="user"><em>Matt AKA Junkie</em></strong></a><div class="date" title="2004-03-14 08:29"><strong>10 years ago</strong></div>
  <div class="text" id="Hcom40788">
<div class="phpcode"><code><span class="html">
Going through numerous tests, the following results are concluded:<br><br>&lt;?<br>// If you're using a server on Windows, this is faster<br>function getisp($ip='') {<br>&nbsp;&nbsp; if ($ip=='') $ip = $_SERVER['REMOTE_ADDR'];<br>&nbsp;&nbsp; $longisp = @gethostbyaddr($ip);<br>&nbsp;&nbsp; $isp = explode('.', $longisp);<br>&nbsp;&nbsp; $isp = array_reverse($isp);<br>&nbsp;&nbsp; $tmp = $isp[1];<br>&nbsp;&nbsp; if (preg_match("/\&lt;(org?|com?|net)\&gt;/i", $tmp)) {<br>&nbsp; &nbsp; &nbsp;&nbsp; $myisp = $isp[2].'.'.$isp[1].'.'.$isp[0];<br>&nbsp;&nbsp; } else {<br>&nbsp; &nbsp; &nbsp;&nbsp; $myisp = $isp[1].'.'.$isp[0];<br>&nbsp;&nbsp; }<br>&nbsp;&nbsp; if (preg_match("/[0-9]{1,3}\.[0-9]{1,3}/", $myisp))<br>&nbsp; &nbsp; &nbsp; return 'ISP lookup failed.';<br>&nbsp;&nbsp; return $myisp;<br>}<br><br>// If your server is on a *nix system, this is faster<br>function gethost ($ip) {<br> $host = `host $ip`;<br> return (($host ? end ( explode (' ', $host)) : $ip));<br>}<br><br>// be warned, however, that gethost() will issue a warning<br>// if safe mode is on with the use of backticked variables<br><br>?&gt;</span>
</code></div>
  </div>
 </div>
  <div class="note" id="40770">  
  <a class="name">
  <strong class="user"><em>webmaster at script-tease dot net</em></strong></a><div class="date" title="2004-03-14 04:37"><strong>10 years ago</strong></div>
  <div class="text" id="Hcom40770">
<div class="phpcode"><code><span class="html">
gethostbyaddr() tends to lag on various systems for whatever reason. Here are two functions that should prove their worth speedwise.<br><br><span class="default">&lt;?php<br></span><span class="comment">// For Linux...<br><br></span><span class="keyword">function </span><span class="default">gethost </span><span class="keyword">(</span><span class="default">$ip</span><span class="keyword">) {<br> </span><span class="default">$host </span><span class="keyword">= `</span><span class="string">host </span><span class="default">$ip</span><span class="keyword">`;<br> return ((</span><span class="default">$host </span><span class="keyword">? </span><span class="default">end </span><span class="keyword">( </span><span class="default">explode </span><span class="keyword">(</span><span class="string">' '</span><span class="keyword">, </span><span class="default">$host</span><span class="keyword">)) : </span><span class="default">$ip</span><span class="keyword">));<br>}<br><br></span><span class="comment">// For Win32...<br><br></span><span class="keyword">function </span><span class="default">nslookup </span><span class="keyword">(</span><span class="default">$ip</span><span class="keyword">) {<br> </span><span class="default">$host </span><span class="keyword">= </span><span class="default">split</span><span class="keyword">(</span><span class="string">'Name:'</span><span class="keyword">,`</span><span class="string">nslookup </span><span class="default">$ip</span><span class="keyword">`);<br> return ( </span><span class="default">trim </span><span class="keyword">(isset(</span><span class="default">$host</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">]) ? </span><span class="default">str_replace </span><span class="keyword">(</span><span class="string">"\n"</span><span class="keyword">.</span><span class="string">'Address:&nbsp; '</span><span class="keyword">.</span><span class="default">$ip</span><span class="keyword">, </span><span class="string">''</span><span class="keyword">, </span><span class="default">$host</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">]) : </span><span class="default">$ip</span><span class="keyword">));<br>}<br></span><span class="default">?&gt;<br></span><br>Pretty basic, but it should get the job done.</span>
</code></div>
  </div>
 </div>
  <div class="note" id="40343">  
  <a class="name">
  <strong class="user"><em>Matt AKA Junkie</em></strong></a><div class="date" title="2004-02-29 04:11"><strong>10 years ago</strong></div>
  <div class="text" id="Hcom40343">
<div class="phpcode"><code><span class="html">
Since my little ISP thing isn't globally acceptable, here's an update.<br><br>&lt;?<br>function getisp($ip='') {<br>&nbsp; &nbsp; if ($ip=='') $ip = $_SERVER['REMOTE_ADDR'];<br>&nbsp; &nbsp; $longisp = @gethostbyaddr($ip);<br>&nbsp; &nbsp; $isp = explode('.', $longisp);<br>&nbsp; &nbsp; $isp = array_reverse($isp);<br>&nbsp; &nbsp; $tmp = $isp[1];<br>&nbsp; &nbsp; if (preg_match("/\&lt;(org?|com?|net)\&gt;/i", $tmp)) {<br>&nbsp; &nbsp; &nbsp; &nbsp; $myisp = $isp[2].'.'.$isp[1].'.'.$isp[0];<br>&nbsp; &nbsp; } else {<br>&nbsp; &nbsp; &nbsp; &nbsp; $myisp = $isp[1].'.'.$isp[0];<br>&nbsp; &nbsp; }<br>&nbsp; &nbsp; preg_match("/[0-9]{1,3}\.[0-9]{1,3}/", $myisp) ? return 'ISP lookup failed.' : return $myisp;<br>}<br>?&gt;</span>
</code></div>
  </div>
 </div>
  <div class="note" id="31635">  
  <a class="name">
  <strong class="user"><em>www.ad-rotator.com</em></strong></a><div class="date" title="2003-04-28 04:06"><strong>11 years ago</strong></div>
  <div class="text" id="Hcom31635">
<div class="phpcode"><code><span class="html">
For ad-rotator.com, we need to do a lot of IP lookups, gethostbyaddr is very easy get timed-out and the script stucks there forever. Here is a fail-safe alternative, 1 sec max for timeout per IP.<br><br>function ar_gethostbyaddr($ip) {<br>&nbsp; $output = `host -W 1 $ip`;<br>&nbsp; if (ereg('.*pointer ([A-Za-z0-9.-]+)\..*',$output,$regs)) {<br>&nbsp; &nbsp; return $regs[1]; <br>&nbsp; }<br>&nbsp; return $ip;<br>}</span>
</code></div>
  </div>
 </div>
  <div class="note" id="31150">  
  <a class="name">
  <strong class="user"><em>jz at NOSPAM dot nplu dot kiev dot ua</em></strong></a><div class="date" title="2003-04-11 03:59"><strong>11 years ago</strong></div>
  <div class="text" id="Hcom31150">
<div class="phpcode"><code><span class="html">
Just to fun that gethostbyadd() returns server machine name known in LAN rather then its DNS if I try to call it against my own host (from workstation), whether it would local (behind the proxy) or global (of proxy itself) IP or just loop 127.0.0.1.<br><br>And thus you can get LAN names of other workstations by its intranet IPs (I mean smth like 192.168.0.???)<br><br>Fun :)</span>
</code></div>
  </div>
 </div>
  <div class="note" id="30543">  
  <a class="name">
  <strong class="user"><em>kriek at jonkriek dot com</em></strong></a><div class="date" title="2003-03-21 08:39"><strong>11 years ago</strong></div>
  <div class="text" id="Hcom30543">
<div class="phpcode"><code><span class="html">
In response to god at weaponzero dot f2s dot com: I found this much easier to write.<br><br><span class="default">&lt;?php<br>&nbsp; &nbsp; $ip </span><span class="keyword">= </span><span class="default">$_SERVER</span><span class="keyword">[</span><span class="string">'REMOTE_ADDR'</span><span class="keyword">];<br>&nbsp; &nbsp; </span><span class="default">$fullhost </span><span class="keyword">= </span><span class="default">gethostbyaddr</span><span class="keyword">(</span><span class="default">$ip</span><span class="keyword">);<br>&nbsp; &nbsp; </span><span class="default">$host </span><span class="keyword">= </span><span class="default">preg_replace</span><span class="keyword">(</span><span class="string">"/^[^.]+./"</span><span class="keyword">, </span><span class="string">"*."</span><span class="keyword">, </span><span class="default">$fullhost</span><span class="keyword">);<br></span><span class="default">?&gt;<br></span><br>IP address <span class="default">&lt;?=$ip?&gt;</span> | Host: <span class="default">&lt;?=$host?&gt;<br></span><br>You can still protect the IP of your visitors and only show the hostname or show them both.</span>
</code></div>
  </div>
 </div>
  <div class="note" id="26641">  
  <a class="name">
  <strong class="user"><em>abe at abe2k dot net</em></strong></a><div class="date" title="2002-11-07 06:32"><strong>11 years ago</strong></div>
  <div class="text" id="Hcom26641">
<div class="phpcode"><code><span class="html">
gethostbyaddr() doesn't seem to be able to resolve ip6.int<br>(ipv6) adresses, so I made a function that can, and works<br>just like the normal gethostbyaddr().<br><br>You need dig and ipv6calc, dig should come with most<br>distributions, if not, install bind from <a rel="nofollow" target="_blank">http://www.isc.org.</a><br>ipv6calc can be found at <a rel="nofollow" target="_blank">http://www.bieringer.de/linux/IPv6/ipv6calc/index.html.</a><br><br> function gethostbyaddr6($ip6) {<br>&nbsp; $ipv6calc = "/bin/ipv6calc";<br>&nbsp; $dig = "/usr/bin/dig";<br>&nbsp; $file = popen($ipv6calc." --in ipv6addr --out revnibbles.int ".escapeshellarg($ip6), r);<br>&nbsp; $ip = fread($file, 128);<br>&nbsp; pclose($file);<br>&nbsp; if ((substr($ip, 0, 5) == "Error") || (!$ip)) return "Address is not a valid IPv6 address";<br>&nbsp; $file = popen($dig." ptr ".$ip, r);&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br>&nbsp;&nbsp; while (!feof ($file)) {<br>&nbsp; &nbsp; $buffer = fgets($file, 128);<br>&nbsp; &nbsp; if (substr($buffer, 0, 1) == ";") continue;<br>&nbsp; &nbsp; $buffer = explode(" ", $buffer);<br>&nbsp; &nbsp; if ($buffer[3] == "PTR") {<br>&nbsp; &nbsp;&nbsp; $host = substr(trim($buffer[4]), 0, -1);<br>&nbsp; &nbsp;&nbsp; pclose($file);<br>&nbsp; &nbsp;&nbsp; return $host;<br>&nbsp; &nbsp; }<br>&nbsp;&nbsp; }<br>&nbsp; pclose($file);<br>&nbsp; return $ip6;<br> }<br><br> echo gethostbyaddr6($_SERVER[REMOTE_ADDR]);</span>
</code></div>
  </div>
 </div>
  <div class="note" id="25608">  
  <a class="name">
  <strong class="user"><em>dominique at vdx dot nl</em></strong></a><div class="date" title="2002-09-30 05:14"><strong>11 years ago</strong></div>
  <div class="text" id="Hcom25608">
<div class="phpcode"><code><span class="html">
To convert an IP to a numeric value, just use the ip2long (...) function.<br><br>Vice versa; use: long2ip (...)</span>
</code></div>
  </div>
 </div>
  <div class="note" id="25373">  
  <a class="name">
  <strong class="user"><em>pulstar at mail dot com</em></strong></a><div class="date" title="2002-09-20 02:59"><strong>11 years ago</strong></div>
  <div class="text" id="Hcom25373">
<div class="phpcode"><code><span class="html">
If you need to store an IP addresses in a database, you can convert and store it in an INT type column (4 bytes). The functions below can convert IP addresses to its integer decimal value and vice-versa.<br><br>function ip2dec($ipaddr) {<br>&nbsp; $base=explode(".",$ipaddr);<br>&nbsp; $decimal=(double) $base[0]*16777216;<br>&nbsp; $decimal+=$base[1]*65536;<br>&nbsp; $decimal+=$base[2]*256;<br>&nbsp; $decimal+=$base[3];<br>&nbsp; if($decimal&gt;2147483647) {<br>&nbsp; &nbsp; $decimal-=4294967296;<br>&nbsp; }<br>&nbsp; return (int) $decimal;<br>}<br><br>function dec2ip($dec) {<br>&nbsp; if($dec&lt;0) {<br>&nbsp; &nbsp; $dec=(double) 4294967296+$dec;<br>&nbsp; }<br>&nbsp; if($dec&gt;16777215) {<br>&nbsp; &nbsp; $ip=$dec-(intval($dec/256)*256);<br>&nbsp; &nbsp; $dec=(double) intval($dec/256);<br>&nbsp; } else $ip="0";<br>&nbsp; if($dec&gt;65535) {<br>&nbsp; &nbsp; $ip=($dec-(intval($dec/256)*256)).".".$ip;<br>&nbsp; &nbsp; $dec=(double) intval($dec/256);<br>&nbsp; } else $ip="0.".$ip;<br>&nbsp; if($dec&gt;255) {<br>&nbsp; &nbsp; $ip=($dec-(intval($dec/256)*256)).".".$ip;<br>&nbsp; &nbsp; $dec=(double) intval($dec/256);<br>&nbsp; } else $ip="0.".$ip;<br>&nbsp; $ip=$dec.".".$ip;<br>&nbsp; return (string) $ip;<br>}</span>
</code></div>
  </div>
 </div>
  <div class="note" id="25226">  
  <a class="name">
  <strong class="user"><em>alexey at ozerov dot de</em></strong></a><div class="date" title="2002-09-15 10:15"><strong>11 years ago</strong></div>
  <div class="text" id="Hcom25226">
<div class="phpcode"><code><span class="html">
This function seems to be very slow on IIS 4.0 Server (Win32). I use system call to NSLOOKUP instead to get PC-Hostname:
<br>
<br>unset ($execoutput);
<br>exec ("nslookup $IPAdresse 2&gt;nul",$execoutput,$nslookstatus);
<br>if (isset ($execoutput[3]) &amp;&amp; ereg ("^Name: *([A-Za-z0-9]{2,})\.",$execoutput[3],$regs)) 
<br>$nslookname=strtoupper($regs[1]);
<br>else $nslookname="Unknown";
<br>
<br>Note by members: This is not portable to Windows platforms. so you would be better to stay with our function.</span>
</code></div>
  </div>
 </div>
  <div class="note" id="25091">  
  <a class="name">
  <strong class="user"><em>stephane at metacites dot net</em></strong></a><div class="date" title="2002-09-10 07:17"><strong>11 years ago</strong></div>
  <div class="text" id="Hcom25091">
<div class="phpcode"><code><span class="html">
gethostbyaddr_with_cache()<br><br>As someone truely said upper in the forum, some unresolved addresses may slow down your script to the point it times out.<br><br>Althought I had thought gethostbyaddr() would use some kind of cache, it doesn't seem to when the IP is unresolved (at least on my win machine).<br><br>So, I've coded a little gethostbyaddr_with_cache() function that will greatly speed your page if you have many gethostbyaddr() to perform on the same page.<br><br>function gethostbyaddr_with_cache($a) {<br>&nbsp; global $dns_cache;<br>&nbsp; if ($dns_cache[$a]) {<br>&nbsp; &nbsp; return $dns_cache[$a];<br>&nbsp; &nbsp; } else {<br>&nbsp; &nbsp; $temp = gethostbyaddr($a);<br>&nbsp; &nbsp; $dns_cache[$a] = $temp;<br>&nbsp; &nbsp; return $temp;<br>&nbsp; }<br>&nbsp; &nbsp; }</span>
</code></div>
  </div>
 </div>
  <div class="note" id="24245">  
  <a class="name">
  <strong class="user"><em>inny at core dot fetchnet dot org</em></strong></a><div class="date" title="2002-08-10 09:58"><strong>12 years ago</strong></div>
  <div class="text" id="Hcom24245">
<div class="phpcode"><code><span class="html">
Turning on the HostnameLookup function on in the apache configuration file will severely increase the loading times of all the pages serviced by the httpd-server.<br>It's mostly a better idea to just use gethostbyaddr($REMOTE_ADDR); instead of $REMOTE_HOST if you turned HostnameLookups On, unless you want the hostnames specified in apache's log file...</span>
</code></div>
  </div>
 </div>
  <div class="note" id="23346">  
  <a class="name">
  <strong class="user"><em>ven  at  PragaKhan dot com</em></strong></a><div class="date" title="2002-07-16 03:55"><strong>12 years ago</strong></div>
  <div class="text" id="Hcom23346">
<div class="phpcode"><code><span class="html">
$REMOTE_HOST or $_SERVER['REMOTE_HOST'] will give you the reversed ip IF apache is setup to do hostname lookups.<br><br>HostnameLookups On</span>
</code></div>
  </div>
 </div>
  <div class="note" id="21870">  
  <a class="name">
  <strong class="user"><em>elpmille at indiana dot edu</em></strong></a><div class="date" title="2002-05-30 12:26"><strong>12 years ago</strong></div>
  <div class="text" id="Hcom21870">
<div class="phpcode"><code><span class="html">
I previously used something very similar to what god@weaponzero.f2s.com posted but found it to be quite tedious for getting the 'nicehost'. This method below is a lot cleaner, and it also works for numeric addresses.<br><br>function nicehost($host) {<br>&nbsp; &nbsp; if (ereg('^([0-9]{1,3}\.){3}[0-9]{1,3}$', $host)) {<br>&nbsp; &nbsp; &nbsp; &nbsp; return(ereg_replace('\.[0-9]{1,3}$', '.*', $host));<br>&nbsp; &nbsp; } else {<br>&nbsp; &nbsp; &nbsp; &nbsp; return(ereg_replace('^.{' . strpos($host, '.') . '}', '*', $host));<br>&nbsp; &nbsp; }<br>}</span>
</code></div>
  </div>
 </div>
  <div class="note" id="21551">  
  <a class="name">
  <strong class="user"><em>nothanks at nospam dot com</em></strong></a><div class="date" title="2002-05-16 03:30"><strong>12 years ago</strong></div>
  <div class="text" id="Hcom21551">
<div class="phpcode"><code><span class="html">
This is also very useful if you'd like to ban these annoying people that keep spamming your forums. It requires a clever use of mySql but can be great:<br><br>First, make a table for the bans, then make the query:<br><br>"SELECT banReason from tBans where '". gethostbyaddr($REMOTE_ADDR) ."' LIKE banMask"<br><br>If your results aren't null it means his host matched a banMask in your DB, so you can redirect him with header() to a banned.php page and prevent him from accessing any content on your page!</span>
</code></div>
  </div>
 </div>
  <div class="note" id="13291">  
  <a class="name">
  <strong class="user"><em>phalkon at nospam dot home dot com</em></strong></a><div class="date" title="2001-06-08 03:58"><strong>13 years ago</strong></div>
  <div class="text" id="Hcom13291">
<div class="phpcode"><code><span class="html">
Be cautious when looking up many hostnames.&nbsp; If your DNS server is slow to respond, you may have to pump up your Max execution time for your scripts, otherwise, it will timeout.&nbsp; I found that even 3 unresolvable hosts can cause a 30 second delay in processing.</span>
</code></div>
  </div>
 </div></div>

 
</section>    </section><!-- layout-content -->
        


  </div><!-- layout -->
         
  

    
 <!-- External and third party libraries. -->
 







<a id="toTop" href="javascript:;"><span id="toTopHover"></span><img width="40" height="40" alt="To Top" src="../../images/to-top%402x.png"></a>



<!-- Mirrored from php.net/manual/en/function.gethostbyaddr.php by HTTrack Website Copier/3.x [XR&CO'2013], Thu, 28 Aug 2014 16:06:57 GMT -->


</body></html>