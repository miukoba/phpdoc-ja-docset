<html><!-- Mirrored from php.net/manual/en/function.ldap-connect.php by HTTrack Website Copier/3.x [XR&CO'2013], Thu, 28 Aug 2014 16:02:03 GMT --><!-- Added by HTTrack --><head><meta http-equiv="content-type" content="text/html;charset=utf-8"><!-- /Added by HTTrack -->


  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0"> 

  <title>ldap_connect</title>

 <link rel="shortcut icon" href="../../favicon.ico">
 <link rel="search" type="application/opensearchdescription+xml" href="http://php.net/phpnetimprovedsearch.src" title="Add PHP.net search">
 <link rel="alternate" type="application/atom+xml" href="http://php.net/releases/feed.php" title="PHP Release feed">
 <link rel="alternate" type="application/atom+xml" href="http://php.net/feed.atom" title="PHP: Hypertext Preprocessor">

 <link rel="canonical" href="function.ldap-connect.html">
 <link rel="shorturl" href="http://php.net/ldap-connect">
 <link rel="alternate" href="http://php.net/ldap-connect" hreflang="x-default">

 <link rel="contents" href="index-2.html">
 <link rel="index" href="ref.ldap.html">
 <link rel="prev" href="function.ldap-compare.html">
 <link rel="next" href="function.ldap-control-paged-result-response.html">

 <link rel="alternate" href="function.ldap-connect.html" hreflang="en">
 <link rel="alternate" href="http://php.net/manual/pt_BR/function.ldap-connect.php" hreflang="pt_BR">
 <link rel="alternate" href="http://php.net/manual/zh/function.ldap-connect.php" hreflang="zh">
 <link rel="alternate" href="http://php.net/manual/fr/function.ldap-connect.php" hreflang="fr">
 <link rel="alternate" href="http://php.net/manual/de/function.ldap-connect.php" hreflang="de">
 <link rel="alternate" href="http://php.net/manual/it/function.ldap-connect.php" hreflang="it">
 <link rel="alternate" href="http://php.net/manual/ja/function.ldap-connect.php" hreflang="ja">
 <link rel="alternate" href="http://php.net/manual/ro/function.ldap-connect.php" hreflang="ro">
 <link rel="alternate" href="http://php.net/manual/ru/function.ldap-connect.php" hreflang="ru">
 <link rel="alternate" href="http://php.net/manual/es/function.ldap-connect.php" hreflang="es">
 <link rel="alternate" href="http://php.net/manual/tr/function.ldap-connect.php" hreflang="tr">

<link rel="stylesheet" type="text/css" href="../../cached8fe1.css?t=1401250819&amp;f=/fonts/Fira/fira.css" media="screen">
<link rel="stylesheet" type="text/css" href="../../cached4b8d.css?t=1404368420&amp;f=/fonts/Font-Awesome/css/fontello.css" media="screen">
<link rel="stylesheet" type="text/css" href="../../cached5065.css?t=1403329232&amp;f=/styles/theme-base.css" media="screen">
<link rel="stylesheet" type="text/css" href="../../cachedc78d.css?t=1401249623&amp;f=/styles/theme-medium.css" media="screen">

 <!--[if lte IE 7]>
 <link rel="stylesheet" type="text/css" href="http://php.net/styles/workarounds.ie7.css" media="screen">
 <![endif]-->

 <!--[if lte IE 8]>
 <script type="text/javascript">
  window.brokenIE = true;
 </script>
 <![endif]-->

 <!--[if lte IE 9]>
 <link rel="stylesheet" type="text/css" href="http://php.net/styles/workarounds.ie9.css" media="screen">
 <![endif]-->

 <!--[if IE]>
 <script type="text/javascript" src="http://php.net/js/ext/html5.js"></script>
 <![endif]-->

 <base>

</head>
<body class="docs " style="">


<div class="headsup"><a href="http://php.net/index.php#id2014-08-28-1">PHP 5.6.0 released</a></div>
<nav id="trick"><div><dl>
<dt><a href="getting-started.html">Getting Started</a></dt>
	<dd><a href="introduction.html">Introduction</a></dd>
	<dd><a href="tutorial.html">A simple tutorial</a></dd>
<dt><a href="langref.html">Language Reference</a></dt>
	<dd><a href="language.basic-syntax.html">Basic syntax</a></dd>
	<dd><a href="language.types.html">Types</a></dd>
	<dd><a href="language.variables.html">Variables</a></dd>
	<dd><a href="language.constants.html">Constants</a></dd>
	<dd><a href="language.expressions.html">Expressions</a></dd>
	<dd><a href="language.operators.html">Operators</a></dd>
	<dd><a href="language.control-structures.html">Control Structures</a></dd>
	<dd><a href="language.functions.html">Functions</a></dd>
	<dd><a href="language.oop5.html">Classes and Objects</a></dd>
	<dd><a href="language.namespaces.html">Namespaces</a></dd>
	<dd><a href="language.exceptions.html">Exceptions</a></dd>
	<dd><a href="language.generators.html">Generators</a></dd>
	<dd><a href="language.references.html">References Explained</a></dd>
	<dd><a href="reserved.variables.html">Predefined Variables</a></dd>
	<dd><a href="reserved.exceptions.html">Predefined Exceptions</a></dd>
	<dd><a href="reserved.interfaces.html">Predefined Interfaces and Classes</a></dd>
	<dd><a href="context.html">Context options and parameters</a></dd>
	<dd><a href="wrappers.html">Supported Protocols and Wrappers</a></dd>
</dl>
<dl>
<dt><a href="security.html">Security</a></dt>
	<dd><a href="security.intro.html">Introduction</a></dd>
	<dd><a href="security.general.html">General considerations</a></dd>
	<dd><a href="security.cgi-bin.html">Installed as CGI binary</a></dd>
	<dd><a href="security.apache.html">Installed as an Apache module</a></dd>
	<dd><a href="security.filesystem.html">Filesystem Security</a></dd>
	<dd><a href="security.database.html">Database Security</a></dd>
	<dd><a href="security.errors.html">Error Reporting</a></dd>
	<dd><a href="security.globals.html">Using Register Globals</a></dd>
	<dd><a href="security.variables.html">User Submitted Data</a></dd>
	<dd><a href="security.magicquotes.html">Magic Quotes</a></dd>
	<dd><a href="security.hiding.html">Hiding PHP</a></dd>
	<dd><a href="security.current.html">Keeping Current</a></dd>
<dt><a href="features.html">Features</a></dt>
	<dd><a href="features.http-auth.html">HTTP authentication with PHP</a></dd>
	<dd><a href="features.cookies.html">Cookies</a></dd>
	<dd><a href="features.sessions.html">Sessions</a></dd>
	<dd><a href="features.xforms.html">Dealing with XForms</a></dd>
	<dd><a href="features.file-upload.html">Handling file uploads</a></dd>
	<dd><a href="features.remote-files.html">Using remote files</a></dd>
	<dd><a href="features.connection-handling.html">Connection handling</a></dd>
	<dd><a href="features.persistent-connections.html">Persistent Database Connections</a></dd>
	<dd><a href="features.safe-mode.html">Safe Mode</a></dd>
	<dd><a href="features.commandline.html">Command line usage</a></dd>
	<dd><a href="features.gc.html">Garbage Collection</a></dd>
	<dd><a href="features.dtrace.html">DTrace Dynamic Tracing</a></dd>
</dl>
<dl>
<dt><a href="funcref.html">Function Reference</a></dt>
	<dd><a href="refs.basic.php.html">Affecting PHP's Behaviour</a></dd>
	<dd><a href="refs.utilspec.audio.html">Audio Formats Manipulation</a></dd>
	<dd><a href="refs.remote.auth.html">Authentication Services</a></dd>
	<dd><a href="refs.utilspec.cmdline.html">Command Line Specific Extensions</a></dd>
	<dd><a href="refs.compression.html">Compression and Archive Extensions</a></dd>
	<dd><a href="refs.creditcard.html">Credit Card Processing</a></dd>
	<dd><a href="refs.crypto.html">Cryptography Extensions</a></dd>
	<dd><a href="refs.database.html">Database Extensions</a></dd>
	<dd><a href="refs.calendar.html">Date and Time Related Extensions</a></dd>
	<dd><a href="refs.fileprocess.file.html">File System Related Extensions</a></dd>
	<dd><a href="refs.international.html">Human Language and Character Encoding Support</a></dd>
	<dd><a href="refs.utilspec.image.html">Image Processing and Generation</a></dd>
	<dd><a href="refs.remote.mail.html">Mail Related Extensions</a></dd>
	<dd><a href="refs.math.html">Mathematical Extensions</a></dd>
	<dd><a href="refs.utilspec.nontext.html">Non-Text MIME Output</a></dd>
	<dd><a href="refs.fileprocess.process.html">Process Control Extensions</a></dd>
	<dd><a href="refs.basic.other.html">Other Basic Extensions</a></dd>
	<dd><a href="refs.remote.other.html">Other Services</a></dd>
	<dd><a href="refs.search.html">Search Engine Extensions</a></dd>
	<dd><a href="refs.utilspec.server.html">Server Specific Extensions</a></dd>
	<dd><a href="refs.basic.session.html">Session Extensions</a></dd>
	<dd><a href="refs.basic.text.html">Text Processing</a></dd>
	<dd><a href="refs.basic.vartype.html">Variable and Type Related Extensions</a></dd>
	<dd><a href="refs.webservice.html">Web Services</a></dd>
	<dd><a href="refs.utilspec.windows.html">Windows Only Extensions</a></dd>
	<dd><a href="refs.xml.html">XML Manipulation</a></dd>
</dl>
<dl>
<dt>Keyboard Shortcuts</dt><dt>?</dt>
<dd>This help</dd>
<dt>j</dt>
<dd>Next menu item</dd>
<dt>k</dt>
<dd>Previous menu item</dd>
<dt>g p</dt>
<dd>Previous man page</dd>
<dt>g n</dt>
<dd>Next man page</dd>
<dt>G</dt>
<dd>Scroll to bottom</dd>
<dt>g g</dt>
<dd>Scroll to top</dd>
<dt>g h</dt>
<dd>Goto homepage</dd>
<dt>g s</dt>
<dd>Goto search<br>(current page)</dd>
<dt>/</dt>
<dd>Focus search box</dd>
</dl></div></nav>
<div id="goto">
    <div class="search">
         <div class="text"></div>
         <div class="results"><ul></ul></div>
   </div>
</div>

  <div id="breadcrumbs" class="row-fluid">
          
              
        <ul class="breadcrumbs-container">
            <li><a href="index-2.html">PHP Manual</a></li>      <li><a href="funcref.html">Function Reference</a></li>      <li><a href="refs.remote.other.html">Other Services</a></li>      <li><a href="book.ldap.html">LDAP</a></li>      <li><a href="ref.ldap.html">LDAP Functions</a></li>    </ul>
  </div>




<div id="layout">
  <section id="layout-content">
  <div id="function.ldap-connect" class="refentry">
 <div class="refnamediv">
  <h1 class="refname">ldap_connect</h1>
  <p class="verinfo">(PHP 4, PHP 5)</p><p class="refpurpose"><span class="refname">ldap_connect</span> â€” <span class="dc-title">Connect to an LDAP server</span></p>

 </div>
 
 <div class="refsect1 description" id="refsect1-function.ldap-connect-description">
  <h3 class="title">Description</h3>
  <div class="methodsynopsis dc-description">
   <span class="type">resource</span> <span class="methodname"><strong>ldap_connect</strong></span>
    ([ <span class="methodparam"><span class="type">string</span> <code class="parameter">$hostname</code><span class="initializer"> = <strong><code>NULL</code></strong></span></span>
   [, <span class="methodparam"><span class="type">int</span> <code class="parameter">$port</code><span class="initializer"> = 389</span></span>
  ]] )</div>

  <p class="para rdfs-comment">
   Establishes a connection to a LDAP server on a specified
   <code class="parameter">hostname</code> and <code class="parameter">port</code>.
  </p>
 </div>


 <div class="refsect1 parameters" id="refsect1-function.ldap-connect-parameters">
  <h3 class="title">Parameters</h3>
  <p class="para">
   </p><dl>

    
     <dt>
<code class="parameter">hostname</code></dt>

     <dd>

      <p class="para">
       If you are using OpenLDAP 2.x.x you can specify a URL instead of the
       hostname. To use LDAP with SSL, compile OpenLDAP 2.x.x with SSL
       support, configure PHP with SSL, and set this parameter as  
       <em>ldaps://hostname/</em>.
      </p>
     </dd>

    
    
     <dt>
<code class="parameter">port</code></dt>

     <dd>

      <p class="para">
       The port to connect to. Not used when using URLs.
      </p>
     </dd>

    
   </dl>

  <p></p>
 </div>


 <div class="refsect1 returnvalues" id="refsect1-function.ldap-connect-returnvalues">
  <h3 class="title">Return Values</h3>
  <p class="para">
   Returns a positive LDAP link identifier on success, or <strong><code>FALSE</code></strong> on error.
   When OpenLDAP 2.x.x is used, <span class="function"><strong>ldap_connect()</strong></span> will always
   return a <span class="type"><a href="language.types.resource.html" class="type resource">resource</a></span> as it does not actually connect but just
   initializes the connecting parameters.  The actual connect happens with
   the next calls to ldap_* funcs, usually with
   <span class="function"><a href="function.ldap-bind.html" class="function">ldap_bind()</a></span>.
  </p>
  <p class="para">
   If no arguments are specified then the link identifier of the already
   opened link will be returned.
  </p>
 </div>


 <div class="refsect1 examples" id="refsect1-function.ldap-connect-examples">
  <h3 class="title">Examples</h3>
  <p class="para">
   </p><div class="example" id="example-4498">
    <p><strong>Example #1 Example of connecting to LDAP server.</strong></p>
    <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br><br></span><span style="color: #FF8000">//&nbsp;LDAP&nbsp;variables<br></span><span style="color: #0000BB">$ldaphost&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #DD0000">"ldap.example.com"</span><span style="color: #007700">;&nbsp;&nbsp;</span><span style="color: #FF8000">//&nbsp;your&nbsp;ldap&nbsp;servers<br></span><span style="color: #0000BB">$ldapport&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">389</span><span style="color: #007700">;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">//&nbsp;your&nbsp;ldap&nbsp;server's&nbsp;port&nbsp;number<br><br>//&nbsp;Connecting&nbsp;to&nbsp;LDAP<br></span><span style="color: #0000BB">$ldapconn&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">ldap_connect</span><span style="color: #007700">(</span><span style="color: #0000BB">$ldaphost</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$ldapport</span><span style="color: #007700">)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;or&nbsp;die(</span><span style="color: #DD0000">"Could&nbsp;not&nbsp;connect&nbsp;to&nbsp;</span><span style="color: #0000BB">$ldaphost</span><span style="color: #DD0000">"</span><span style="color: #007700">);<br><br></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
    </div>

   </div>
   <div class="example" id="example-4499">
    <p><strong>Example #2 Example of connecting securely to LDAP server.</strong></p>
    <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br><br></span><span style="color: #FF8000">//&nbsp;make&nbsp;sure&nbsp;your&nbsp;host&nbsp;is&nbsp;the&nbsp;correct&nbsp;one<br>//&nbsp;that&nbsp;you&nbsp;issued&nbsp;your&nbsp;secure&nbsp;certificate&nbsp;to<br></span><span style="color: #0000BB">$ldaphost&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #DD0000">"ldaps://ldap.example.com/"</span><span style="color: #007700">;<br><br></span><span style="color: #FF8000">//&nbsp;Connecting&nbsp;to&nbsp;LDAP<br></span><span style="color: #0000BB">$ldapconn&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">ldap_connect</span><span style="color: #007700">(</span><span style="color: #0000BB">$ldaphost</span><span style="color: #007700">)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;or&nbsp;die(</span><span style="color: #DD0000">"Could&nbsp;not&nbsp;connect&nbsp;to&nbsp;</span><span style="color: #007700">{</span><span style="color: #0000BB">$ldaphost</span><span style="color: #007700">}</span><span style="color: #DD0000">"</span><span style="color: #007700">);<br><br></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
    </div>

   </div>
  <p></p>
 </div>


 <div class="refsect1 seealso" id="refsect1-function.ldap-connect-seealso">
  <h3 class="title">See Also</h3>
  <p class="para">
   </p><ul class="simplelist">
    <li class="member"><span class="function"><a href="function.ldap-bind.html" class="function" rel="rdfs-seeAlso">ldap_bind()</a> - Bind to LDAP directory</span></li>
   </ul>
  <p></p>
 </div>


</div>
<section id="usernotes">
 <div class="head"><h3 class="title">User Contributed Notes</h3></div><div id="allnotes">
  <div class="note" id="23654">  
  <a class="name">
  <strong class="user"><em>avel at noc uoa gr</em></strong></a><div class="date" title="2002-07-24 07:05"><strong>12 years ago</strong></div>
  <div class="text" id="Hcom23654">
<div class="phpcode"><code><span class="html">
Note that hostname can be a space-separated list of LDAP host names. This is very useful for failover; if the first ldap host is down, ldap_connect will ask the second LDAP host. Of course, you _must_ have LDAP replicates before doing this. :) Read the LDAP API documentation for more information.
<br>
<br>This can also be useful, apart from failover, for LDAP load balancing. Just use a random generator function that will return a different space-separated list every time. This is because the first host in the list is always tried first.
<br>
<br>Be careful when doing LDAP writes; be sure to always connect to your master host when you are about to modify the database, so that the replicates will get the changes as expected.
<br>
<br>Alexandros Vellis</span>
</code></div>
  </div>
 </div>
  <div class="note" id="36156">  
  <a class="name">
  <strong class="user"><em>Andrew (a.whyte at cqu.edu.au)</em></strong></a><div class="date" title="2003-09-29 12:15"><strong>10 years ago</strong></div>
  <div class="text" id="Hcom36156">
<div class="phpcode"><code><span class="html">
To be able to make modifications to Active Directory via the LDAP connector you must bind to the LDAP service over SSL. Otherwise Active Directory provides a mostly readonly connection. You cannot add objects or modify certain properties without LDAPS, e.g. passwords can only be changed using LDAPS connections to Active Directory.<br><br>Therefore, for those wishing to securely connect to Active Directory, from a Unix host using PHP+OpenLDAP+OpenSSL I spent some time getting this going myself, and came across a few gotcha's. Hope this proves fruitfull for others like me when you couldn't find answers out there.<br><br>Make sure you compile OpenLDAP with OpenSSL support, and that you compile PHP with OpenLDAP and OpenSSL.<br><br>This provides PHP with what it needs to make use of ldaps:// connections.<br><br>Configure OpenSSL:<br><br>Extract your Root CA certificate from Active Directory, this is achived through the use of Certificate Services, a startard component of Windows 2000 Server, but may not be installed by default, (The usual Add/Remove Software method will work here). I extracted this in Base64 not DER format.<br><br>Place the extracted CAcert into the certs folder for openssl. (e.g. /usr/local/ssl/certs) and setup the hashed symlinks. This is easily done by simply running:<br><br>&nbsp; /usr/local/ssl/bin/c_rehash<br><br>Once this is done you can test it is worked by running:<br><br>&nbsp; /usr/local/ssl/bin/openssl verify -verbose -CApath /usr/local/ssl/certs /tmp/exported_cacert.pem<br><br>(Should return: OK).<br><br>Configure OpenLDAP:<br><br>Add the following to your ldap.conf file.<br>(found as /usr/local/openldap/etc/openldap/ldap.conf)<br><br>&nbsp; #--begin--<br><br>&nbsp; # Instruct client to NOT request a server's cert.<br>&nbsp; TLS_REQCERT never<br><br>&nbsp; # Define location of CA Cert<br>&nbsp; TLS_CACERT /usr/local/ssl/certs/AD_CA_CERT.pem<br>&nbsp; TLS_CACERTDIR /usr/local/ssl/certs<br><br>&nbsp; #--end--<br><br>You also need to place those same settings in a file within the Apache Web user homedir called .ldaprc<br><br>&nbsp; e.g.:<br>&nbsp; <br>&nbsp; cp /usr/local/openldap/etc/openldap/ldap.conf ~www/.ldaprc )<br><br>You can then test that you're able to establish a LDAPS connection to Active Directory from the OpenLDAP command tools:<br><br>&nbsp; /usr/local/openldap/bin/ldapsearch -H "ldaps://adserver.ad.com"<br><br>This should return some output in extended LDIF format and will indicate no matching objects, but it proves the connection works.<br><br>The name of the server you're connecting to is important. If they server name you specify in the "ldaps://" URI does not match the name of the server in it's certificate, it will complain like so:<br><br>&nbsp; ldap_bind: Can't contact LDAP server (81)<br>&nbsp; &nbsp; &nbsp; &nbsp; additional info: TLS: hostname does not match CN in peer certificate<br><br>Once you've gotten the ldapsearch tool working correctly PHP should work also.<br><br>One important gotcha however is that the Web user must be able to locate it's HOME folder. You must check that Apache is providing a HOME variable set to the Web users home directory, so that php can locate the .ldaprc file and the settings contained within. This may well be different between Unix variants but it is such a simple and stupid thing if you miss it and it causes you grief. Simply use a SetEnv directive in Apache's httpd.conf:<br><br>&nbsp; SetEnv HOME /usr/local/www<br><br>With all that done, you can now code up a simple connect function:<br><br>&nbsp; function connect_AD()<br>&nbsp; {<br>&nbsp; &nbsp; $ldap_server = "ldaps://adserver.ad.com" ;<br>&nbsp; &nbsp; $ldap_user&nbsp;&nbsp; = "CN=web service account,OU=Service Accounts,DC=ad,DC=com" ;<br>&nbsp; &nbsp; $ldap_pass&nbsp;&nbsp; = "password" ;<br><br>&nbsp; &nbsp; $ad = ldap_connect($ldap_server) ;<br>&nbsp; &nbsp; ldap_set_option($ad, LDAP_OPT_PROTOCOL_VERSION, 3) ;<br>&nbsp; &nbsp; $bound = ldap_bind($ad, $ldap_user, $ldap_pass);<br><br>&nbsp; &nbsp; return $ad ;<br>&nbsp; }<br><br>Optionally you can avoid the URI style server string and use something like ldap_connect("adserver.ad.com", 636) ;&nbsp; But work fine with Active Directory servers.<br><br>Hope this proves usefull.</span>
</code></div>
  </div>
 </div>
  <div class="note" id="109829">  
  <a class="name">
  <strong class="user"><em>ac dot russell at live dot com</em></strong></a><div class="date" title="2012-08-24 06:47"><strong>2 years ago</strong></div>
  <div class="text" id="Hcom109829">
<div class="phpcode"><code><span class="html">
In order to connect to an ldap server via ssl I needed to use a certificate. For this to work the ldap admin sent me a .der file which I put into /etc/openldap/cacerts. <br>&nbsp; &nbsp; cp ldap-server.der /etc/openldap/cacerts<br>That directory must be chmod 755. Then the following entries had to be in /etc/openldap/ldap.conf <br>&nbsp; &nbsp; TLS_REQCERT&nbsp;&nbsp; never&nbsp; <br>&nbsp; &nbsp; TLS_CACERTDIR /etc/openldap/cacerts<br>"TLS_REQCERT never" should only be required if there is a self-signed certificate in the certificate chain.</span>
</code></div>
  </div>
 </div>
  <div class="note" id="90303">  
  <a class="name">
  <strong class="user"><em>csnyder at fcny dot org</em></strong></a><div class="date" title="2009-04-15 09:35"><strong>5 years ago</strong></div>
  <div class="text" id="Hcom90303">
<div class="phpcode"><code><span class="html">
It bears repeating (and the examples should probably be updated) that ldap_connect() doesn't actually test the connection to the specified ldap server. This is important if you're trying to build failover into your ldap-based authentication routine.
<br>
<br>The only way to test the connection is to actually call ldap_bind( $ds, $username, $password ). But if that fails, is it because you have the wrong username/password or is it because the connection is down? As far as I can see there isn't any way to tell.
<br>
<br>It seems that if ldap_bind() fails against your primary server, you have no choice but to try ldap_bind() with the same credentials against the backup. And yet, if your organization limits failed login attempts, a single bad password counts as two failed login attempts. Not good.
<br>
<br>One possible workaround is to try an anonymous bind first:
<br>
<br><span class="default">&lt;?php
<br></span><span class="comment">// connect to primary
<br></span><span class="default">$ds </span><span class="keyword">= </span><span class="default">ldap_connect</span><span class="keyword">( </span><span class="string">'ldap://10.0.0.7/' </span><span class="keyword">);
<br></span><span class="comment">// note: $ds is always a resource even if primary is down
<br>
<br>// try anonymous login to test connection
<br></span><span class="default">$anon </span><span class="keyword">= @</span><span class="default">ldap_bind</span><span class="keyword">( </span><span class="default">$ds </span><span class="keyword">);
<br>if ( !</span><span class="default">$anon </span><span class="keyword">) {
<br>&nbsp; &nbsp; </span><span class="comment">// test failed, connect to failover host
<br>&nbsp; &nbsp; </span><span class="default">$ds </span><span class="keyword">= </span><span class="default">ldap_connect</span><span class="keyword">( </span><span class="string">'ldap://10.0.0.8/' </span><span class="keyword">);
<br>}
<br>else {
<br>&nbsp; &nbsp; </span><span class="comment">// test passed, unbind anonymous and reconnect to primary
<br>&nbsp; &nbsp; </span><span class="default">ldap_unbind</span><span class="keyword">( </span><span class="default">$ds </span><span class="keyword">);
<br>&nbsp; &nbsp; </span><span class="default">$ds </span><span class="keyword">= </span><span class="default">ldap_connect</span><span class="keyword">( </span><span class="string">'ldap://10.0.0.7/' </span><span class="keyword">);
<br>}
<br>
<br></span><span class="comment">// now try a real login
<br></span><span class="default">$login </span><span class="keyword">= @</span><span class="default">ldap_bind</span><span class="keyword">( </span><span class="default">$ds</span><span class="keyword">, </span><span class="default">$username</span><span class="keyword">, </span><span class="default">$password </span><span class="keyword">);
<br></span><span class="default">?&gt;
<br></span>
<br>Note that this workaround relies on anonymous login being enabled, which may not always be the case. It's a little sad that there is no other way to test the connection. Hopefully this can be remedied in some future implementation of ldap_connect().</span>
</code></div>
  </div>
 </div>
  <div class="note" id="73691">  
  <a class="name">
  <strong class="user"><em>allie  at  lsu  dot  edu</em></strong></a><div class="date" title="2007-03-06 02:23"><strong>7 years ago</strong></div>
  <div class="text" id="Hcom73691">
<div class="phpcode"><code><span class="html">
I sure do wish there was some way I could get this information out to all programmers in the world about binding and searching MS AD.&nbsp; This is the second time I was bit by the "I need to search the entire tree" problem.<br><br>For php (and apache auth_ldap ) you need to specify port 3268 when you want to search the entire tree.&nbsp; Otherwise it will spit out the partial results error.<br><br>ldap_connect($server,3268);<br><br>I'm just fortunate enough to have won this same battle with apache searching the whole directory.&nbsp; When I noticed our php application failing auth's for users, I was immediately able to fix the problem by adding this port specification (and the ldap_set_option($ldapserver, LDAP_OPT_REFERRALS, 0)&nbsp; option).<br><br>I really hope this helps someone else before they pull all their hair out.&nbsp; I know I miss mine.</span>
</code></div>
  </div>
 </div>
  <div class="note" id="103372">  
  <a class="name">
  <strong class="user"><em>verikono</em></strong></a><div class="date" title="2011-04-11 01:33"><strong>3 years ago</strong></div>
  <div class="text" id="Hcom103372">
<div class="phpcode"><code><span class="html">
PHP:LDAP does not support persistent connections.</span>
</code></div>
  </div>
 </div>
  <div class="note" id="93317">  
  <a class="name">
  <strong class="user"><em>mharting at micahtek dot com</em></strong></a><div class="date" title="2009-09-02 01:35"><strong>4 years ago</strong></div>
  <div class="text" id="Hcom93317">
<div class="phpcode"><code><span class="html">
An addition to trying to setup failover. After doing the ldap_connect, do the ldap_bind.&nbsp; If ldap_bind fails, use the command ldap_errno to get the error number.&nbsp; If the error number is 81, that represents the server is down.&nbsp; That is the only time we do a failover to our backup ldap server.<br><br>Another thing to consider is the error could be 49, then do<br>ldap_get_option($this-&gt;ds,LDAP_OPT_ERROR_NUMBER,$optErrorNumber);. This will return extended data and if the data code in that is 532 or 773, the bind failure will be caused by the password being expired and requiring a password update before the bind will succeed.</span>
</code></div>
  </div>
 </div>
  <div class="note" id="88508">  
  <a class="name">
  <strong class="user"><em>peter dot burden at gmail dot com</em></strong></a><div class="date" title="2009-01-27 04:40"><strong>5 years ago</strong></div>
  <div class="text" id="Hcom88508">
<div class="phpcode"><code><span class="html">
The host name parameter can be a space separated list of host names. This means that the LDAP code will talk to a backup server if the main server is not operational. There will be a delay while the code times out trying to talk to the main server but things will still work. This is particularly useful with a typical Microsoft Active Directory setup of primary and backup domain controllers.<br><span class="default">&lt;?php<br>$ldaphost </span><span class="keyword">= </span><span class="string">"192.168.0.100 192.168.0.101"</span><span class="keyword">;<br></span><span class="default">$ldapconn </span><span class="keyword">= </span><span class="default">ldap_connect</span><span class="keyword">(</span><span class="default">$ldaphost</span><span class="keyword">);<br></span><span class="default">?&gt;</span>
</span>
</code></div>
  </div>
 </div>
  <div class="note" id="82918">  
  <a class="name">
  <strong class="user"><em>geigers at binghamton dot edu</em></strong></a><div class="date" title="2008-05-01 01:04"><strong>6 years ago</strong></div>
  <div class="text" id="Hcom82918">
<div class="phpcode"><code><span class="html">
If you have oci8 and are trying to use openldap for ldap you *may* run into a problem.&nbsp; I have an Oracle database that I connect to from apache.&nbsp; Oracle also has ldap libs which were taking precedence over the openldap libs.&nbsp; This would cause a seg fault when calling ldap_connect with a uri style connect string; e.g. ldap_connect("ldaps://myldapserver.host");<br><br>After using gdb to debug a core dump and a lot of googling I found that the solution was to add an env-var to apachectl startup.<br><br>I am using Apache 2.2.8 with PHP 5.2.5 on RHEL.&nbsp; I added:<br><br>LD_PRELOAD=/path/to/libldap.so<br>export LD_PRELOAD<br><br>in /usr/sbin/envvars which is read when apachectl starts.&nbsp; You can read more on this here: <a rel="nofollow" target="_blank">http://www.mail-archive.com/php-bugs@lists.php.net/msg02201.html</a><br><br>Scott Geiger</span>
</code></div>
  </div>
 </div>
  <div class="note" id="81427">  
  <a class="name">
  <strong class="user"><em>bleathem at gmail dot com</em></strong></a><div class="date" title="2008-02-27 02:30"><strong>6 years ago</strong></div>
  <div class="text" id="Hcom81427">
<div class="phpcode"><code><span class="html">
Everyone is posting about getting ldaps:// working in a WAMP/AD stack, I had a tough time finding how to get it going in RHEL 5.1 (w/ all stock rpms).&nbsp; Good old strace did the trick and helped me find the problem...<br><br>Turns out php was looking for the CA file in /etc/pki/CA, and I didn't have the correct permissions on the folder.&nbsp; chmod'ing it to 755 solved my "Can't contact LDAP server" message.</span>
</code></div>
  </div>
 </div>
  <div class="note" id="74941">  
  <a class="name">
  <strong class="user"><em>vandervoord at planet dot nl</em></strong></a><div class="date" title="2007-05-05 06:22"><strong>7 years ago</strong></div>
  <div class="text" id="Hcom74941">
<div class="phpcode"><code><span class="html">
The previous note concerning searching the whole AD tree works fully. Though you must be sure that the server you're authenticating/searching is a Global Catalog server. If not, connecting and binding will fail. Usually there is at least one Global Catalog server in your domain, so if the connect fails try another server it will work. The reason it works is that the Global Catalog server searches the whole domain as where the domain catalog only searches a given OU, offcourse this opposes a security threat as well :)...</span>
</code></div>
  </div>
 </div>
  <div class="note" id="69807">  
  <a class="name">
  <strong class="user"><em>elsint at yahoo dot com</em></strong></a><div class="date" title="2006-09-21 01:48"><strong>7 years ago</strong></div>
  <div class="text" id="Hcom69807">
<div class="phpcode"><code><span class="html">
Be careful about the certificate's permission if you are using Windows.<br><br>Set certificates' permissions for everyone to Read and Read&amp;Execute or you may get binding errors because of this.</span>
</code></div>
  </div>
 </div>
  <div class="note" id="52253">  
  <a class="name">
  <strong class="user"><em>nigelf at esp dot co dot uk</em></strong></a><div class="date" title="2005-04-26 03:58"><strong>9 years ago</strong></div>
  <div class="text" id="Hcom52253">
<div class="phpcode"><code><span class="html">
As mentioned above, openLDAP will always return a resource, even if the server name isn't valid.&nbsp; <br><br>If you then bind with errors suppressed (@ldap_bind) and it fails, it's not obvious what caused the failure (ie: connection or credentials).&nbsp; As the bind doesn't return a resource you can't get the last error from ldap_error etc. either.<br><br>If you display just a message about login failure to the user they may get frustrated re-typing a valid username/password when it's the connection that's at fault.</span>
</code></div>
  </div>
 </div>
  <div class="note" id="46054">  
  <a class="name">
  <strong class="user"><em>blizzards at libero dot it</em></strong></a><div class="date" title="2004-09-28 03:23"><strong>9 years ago</strong></div>
  <div class="text" id="Hcom46054">
<div class="phpcode"><code><span class="html">
To complete questions about how to connect to a LDAP ACTIVE DIRECTORY 2000/2003 server with SASL on port 636, you can refer to prevous notes, and the following directives:<br><br>A)Create CA certificates from AD;<br>B)Export in .pem (DER) format;<br>C)Install OPENSSL,CYRUS SASL,OPENLDAP,KERBEROS 5;<br>D)Copy exported AD ca cert into openssl certs dir on your unix system;<br>E)Reash with c_reash command;<br>F)Get a kerberos ticket form AD for your user;<br>G)Compile PHP with SSL and LDAP support;<br>H)Test with ldapsearch -D &lt;binddn&gt; -W -H ldaps://ad.secure.com:636 -x<br><br>If all works right, create your php script.<br><br>Note: For writing parameters to AD you need to renew ticket each 10 hours or less (AD default lifetime ticket), for reading pourpose you can maintain expired ticket.<br>When querying a windows 2000/2003 AD you MUST use only SASL and not TLS (non supported).</span>
</code></div>
  </div>
 </div>
  <div class="note" id="20984">  
  <a class="name"><strong class="user"><em>Anonymous</em></strong></a><div class="date" title="2002-04-24 09:28"><strong>12 years ago</strong></div>
  <div class="text" id="Hcom20984">
<div class="phpcode"><code><span class="html">
A resource ID is always returned when using URLs for the host parameter<br>even if the host does not exist.<br><br>"When using an URI to describe the connection, the (open)ldap library<br>only parses the url and checks if it's valid, _no connection_ is<br>established in that case."<br>-mfischer@php.net<br><a rel="nofollow" target="_blank">http://bugs.php.net/bug.php?id=15637</a></span>
</code></div>
  </div>
 </div>
  <div class="note" id="96660">  
  <a class="name">
  <strong class="user"><em>miki at qex dot cz</em></strong></a><div class="date" title="2010-03-10 04:51"><strong>4 years ago</strong></div>
  <div class="text" id="Hcom96660">
<div class="phpcode"><code><span class="html">
I had terrible problems with "Unable to bind to server: Invalid credentials" error - everything seemed to be OK (login/pwd used in other apps).
<br>Solved by adding domain to login (instead "username" I used "username@example.com").</span>
</code></div>
  </div>
 </div>
  <div class="note" id="54082">  
  <a class="name">
  <strong class="user"><em>Srivathsa M</em></strong></a><div class="date" title="2005-06-23 03:28"><strong>9 years ago</strong></div>
  <div class="text" id="Hcom54082">
<div class="phpcode"><code><span class="html">
Using LDAP over SSL on NetWare:<br><br>1. Copy the server certificates to sys:/php5/cert directory. This location is configurable in php.ini file.<br><br>2. Use "ldaps://" prefix for host name argument or a value of 636 for port number argument in ldap_connect call.<br><br>For more details, visit, NetWare specific PHP documentation at <a rel="nofollow" target="_blank">http://developer.novell.com/ndk/doc/php/index.html</a></span>
</code></div>
  </div>
 </div>
  <div class="note" id="58473">  
  <a class="name">
  <strong class="user"><em>baroque at citromail dot hu</em></strong></a><div class="date" title="2005-11-05 01:20"><strong>8 years ago</strong></div>
  <div class="text" id="Hcom58473">
<div class="phpcode"><code><span class="html">
This code sample shows how to connect and bind to eDirectory in PHP using LDAP for Netware.<br><br><span class="default">&lt;?php<br><br>$server</span><span class="keyword">=</span><span class="string">'137.65.138.159'</span><span class="keyword">;<br></span><span class="default">$admin</span><span class="keyword">=</span><span class="string">'cn=admin,o=novell'</span><span class="keyword">;<br></span><span class="default">$passwd</span><span class="keyword">=</span><span class="string">'novell'</span><span class="keyword">;<br><br></span><span class="default">$ds</span><span class="keyword">=</span><span class="default">ldap_connect</span><span class="keyword">(</span><span class="default">$server</span><span class="keyword">);&nbsp; </span><span class="comment">// assuming the LDAP server is on this host<br><br></span><span class="keyword">if (</span><span class="default">$ds</span><span class="keyword">) {<br>&nbsp; &nbsp; </span><span class="comment">// bind with appropriate dn to give update access<br>&nbsp; &nbsp; </span><span class="default">$r</span><span class="keyword">=</span><span class="default">ldap_bind</span><span class="keyword">(</span><span class="default">$ds</span><span class="keyword">, </span><span class="default">$admin</span><span class="keyword">, </span><span class="default">$passwd</span><span class="keyword">);<br>&nbsp; &nbsp; if(!</span><span class="default">$r</span><span class="keyword">) die(</span><span class="string">"ldap_bind failed&lt;br&gt;"</span><span class="keyword">);<br><br>&nbsp; &nbsp; echo </span><span class="string">"ldap_bind success"</span><span class="keyword">;<br>&nbsp; &nbsp; </span><span class="default">ldap_close</span><span class="keyword">(</span><span class="default">$ds</span><span class="keyword">);<br>} else {<br>&nbsp; &nbsp; echo </span><span class="string">"Unable to connect to LDAP server"</span><span class="keyword">; <br>}<br></span><span class="default">?&gt;</span>
</span>
</code></div>
  </div>
 </div>
  <div class="note" id="75571">  
  <a class="name">
  <strong class="user"><em>andreas dot a dot sandberg at gmail dot com</em></strong></a><div class="date" title="2007-06-05 05:28"><strong>7 years ago</strong></div>
  <div class="text" id="Hcom75571">
<div class="phpcode"><code><span class="html">
Be careful when using ldap_connect with the sun client libraries that come bundled with solaris.&nbsp;&nbsp; When specifyng the host with the ldap protocol, my connection failed and it took me a good day to trouble shoot.&nbsp; ie. ldap_connect("ldap://somwhere.com");&nbsp; Just remove the 'ldap://' and specify the host.&nbsp;&nbsp; This was on Solaris 10 sparc.</span>
</code></div>
  </div>
 </div></div>

 
</section>    </section><!-- layout-content -->
        


  </div><!-- layout -->
         
  

    
 <!-- External and third party libraries. -->
 







<a id="toTop" href="javascript:;"><span id="toTopHover"></span><img width="40" height="40" alt="To Top" src="../../images/to-top%402x.png"></a>



<!-- Mirrored from php.net/manual/en/function.ldap-connect.php by HTTrack Website Copier/3.x [XR&CO'2013], Thu, 28 Aug 2014 16:02:03 GMT -->


</body></html>