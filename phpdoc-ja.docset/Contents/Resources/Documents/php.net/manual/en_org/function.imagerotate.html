<html><!-- Mirrored from php.net/manual/en/function.imagerotate.php by HTTrack Website Copier/3.x [XR&CO'2013], Thu, 28 Aug 2014 16:00:43 GMT --><!-- Added by HTTrack --><head><meta http-equiv="content-type" content="text/html;charset=utf-8"><!-- /Added by HTTrack -->


  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0"> 

  <title>imagerotate</title>

 <link rel="shortcut icon" href="../../favicon.ico">
 <link rel="search" type="application/opensearchdescription+xml" href="http://php.net/phpnetimprovedsearch.src" title="Add PHP.net search">
 <link rel="alternate" type="application/atom+xml" href="http://php.net/releases/feed.php" title="PHP Release feed">
 <link rel="alternate" type="application/atom+xml" href="http://php.net/feed.atom" title="PHP: Hypertext Preprocessor">

 <link rel="canonical" href="function.imagerotate.html">
 <link rel="shorturl" href="http://php.net/imagerotate">
 <link rel="alternate" href="http://php.net/imagerotate" hreflang="x-default">

 <link rel="contents" href="index-2.html">
 <link rel="index" href="ref.image.html">
 <link rel="prev" href="function.imagerectangle.html">
 <link rel="next" href="function.imagesavealpha.html">

 <link rel="alternate" href="function.imagerotate.html" hreflang="en">
 <link rel="alternate" href="http://php.net/manual/pt_BR/function.imagerotate.php" hreflang="pt_BR">
 <link rel="alternate" href="http://php.net/manual/zh/function.imagerotate.php" hreflang="zh">
 <link rel="alternate" href="http://php.net/manual/fr/function.imagerotate.php" hreflang="fr">
 <link rel="alternate" href="http://php.net/manual/de/function.imagerotate.php" hreflang="de">
 <link rel="alternate" href="http://php.net/manual/it/function.imagerotate.php" hreflang="it">
 <link rel="alternate" href="http://php.net/manual/ja/function.imagerotate.php" hreflang="ja">
 <link rel="alternate" href="http://php.net/manual/ro/function.imagerotate.php" hreflang="ro">
 <link rel="alternate" href="http://php.net/manual/ru/function.imagerotate.php" hreflang="ru">
 <link rel="alternate" href="http://php.net/manual/es/function.imagerotate.php" hreflang="es">
 <link rel="alternate" href="http://php.net/manual/tr/function.imagerotate.php" hreflang="tr">

<link rel="stylesheet" type="text/css" href="../../cached8fe1.css?t=1401250819&amp;f=/fonts/Fira/fira.css" media="screen">
<link rel="stylesheet" type="text/css" href="../../cached4b8d.css?t=1404368420&amp;f=/fonts/Font-Awesome/css/fontello.css" media="screen">
<link rel="stylesheet" type="text/css" href="../../cached5065.css?t=1403329232&amp;f=/styles/theme-base.css" media="screen">
<link rel="stylesheet" type="text/css" href="../../cachedc78d.css?t=1401249623&amp;f=/styles/theme-medium.css" media="screen">

 <!--[if lte IE 7]>
 <link rel="stylesheet" type="text/css" href="http://php.net/styles/workarounds.ie7.css" media="screen">
 <![endif]-->

 <!--[if lte IE 8]>
 <script type="text/javascript">
  window.brokenIE = true;
 </script>
 <![endif]-->

 <!--[if lte IE 9]>
 <link rel="stylesheet" type="text/css" href="http://php.net/styles/workarounds.ie9.css" media="screen">
 <![endif]-->

 <!--[if IE]>
 <script type="text/javascript" src="http://php.net/js/ext/html5.js"></script>
 <![endif]-->

 <base>

</head>
<body class="docs " style="">


<div class="headsup"><a href="http://php.net/index.php#id2014-08-28-1">PHP 5.6.0 released</a></div>
<nav id="trick"><div><dl>
<dt><a href="getting-started.html">Getting Started</a></dt>
	<dd><a href="introduction.html">Introduction</a></dd>
	<dd><a href="tutorial.html">A simple tutorial</a></dd>
<dt><a href="langref.html">Language Reference</a></dt>
	<dd><a href="language.basic-syntax.html">Basic syntax</a></dd>
	<dd><a href="language.types.html">Types</a></dd>
	<dd><a href="language.variables.html">Variables</a></dd>
	<dd><a href="language.constants.html">Constants</a></dd>
	<dd><a href="language.expressions.html">Expressions</a></dd>
	<dd><a href="language.operators.html">Operators</a></dd>
	<dd><a href="language.control-structures.html">Control Structures</a></dd>
	<dd><a href="language.functions.html">Functions</a></dd>
	<dd><a href="language.oop5.html">Classes and Objects</a></dd>
	<dd><a href="language.namespaces.html">Namespaces</a></dd>
	<dd><a href="language.exceptions.html">Exceptions</a></dd>
	<dd><a href="language.generators.html">Generators</a></dd>
	<dd><a href="language.references.html">References Explained</a></dd>
	<dd><a href="reserved.variables.html">Predefined Variables</a></dd>
	<dd><a href="reserved.exceptions.html">Predefined Exceptions</a></dd>
	<dd><a href="reserved.interfaces.html">Predefined Interfaces and Classes</a></dd>
	<dd><a href="context.html">Context options and parameters</a></dd>
	<dd><a href="wrappers.html">Supported Protocols and Wrappers</a></dd>
</dl>
<dl>
<dt><a href="security.html">Security</a></dt>
	<dd><a href="security.intro.html">Introduction</a></dd>
	<dd><a href="security.general.html">General considerations</a></dd>
	<dd><a href="security.cgi-bin.html">Installed as CGI binary</a></dd>
	<dd><a href="security.apache.html">Installed as an Apache module</a></dd>
	<dd><a href="security.filesystem.html">Filesystem Security</a></dd>
	<dd><a href="security.database.html">Database Security</a></dd>
	<dd><a href="security.errors.html">Error Reporting</a></dd>
	<dd><a href="security.globals.html">Using Register Globals</a></dd>
	<dd><a href="security.variables.html">User Submitted Data</a></dd>
	<dd><a href="security.magicquotes.html">Magic Quotes</a></dd>
	<dd><a href="security.hiding.html">Hiding PHP</a></dd>
	<dd><a href="security.current.html">Keeping Current</a></dd>
<dt><a href="features.html">Features</a></dt>
	<dd><a href="features.http-auth.html">HTTP authentication with PHP</a></dd>
	<dd><a href="features.cookies.html">Cookies</a></dd>
	<dd><a href="features.sessions.html">Sessions</a></dd>
	<dd><a href="features.xforms.html">Dealing with XForms</a></dd>
	<dd><a href="features.file-upload.html">Handling file uploads</a></dd>
	<dd><a href="features.remote-files.html">Using remote files</a></dd>
	<dd><a href="features.connection-handling.html">Connection handling</a></dd>
	<dd><a href="features.persistent-connections.html">Persistent Database Connections</a></dd>
	<dd><a href="features.safe-mode.html">Safe Mode</a></dd>
	<dd><a href="features.commandline.html">Command line usage</a></dd>
	<dd><a href="features.gc.html">Garbage Collection</a></dd>
	<dd><a href="features.dtrace.html">DTrace Dynamic Tracing</a></dd>
</dl>
<dl>
<dt><a href="funcref.html">Function Reference</a></dt>
	<dd><a href="refs.basic.php.html">Affecting PHP's Behaviour</a></dd>
	<dd><a href="refs.utilspec.audio.html">Audio Formats Manipulation</a></dd>
	<dd><a href="refs.remote.auth.html">Authentication Services</a></dd>
	<dd><a href="refs.utilspec.cmdline.html">Command Line Specific Extensions</a></dd>
	<dd><a href="refs.compression.html">Compression and Archive Extensions</a></dd>
	<dd><a href="refs.creditcard.html">Credit Card Processing</a></dd>
	<dd><a href="refs.crypto.html">Cryptography Extensions</a></dd>
	<dd><a href="refs.database.html">Database Extensions</a></dd>
	<dd><a href="refs.calendar.html">Date and Time Related Extensions</a></dd>
	<dd><a href="refs.fileprocess.file.html">File System Related Extensions</a></dd>
	<dd><a href="refs.international.html">Human Language and Character Encoding Support</a></dd>
	<dd><a href="refs.utilspec.image.html">Image Processing and Generation</a></dd>
	<dd><a href="refs.remote.mail.html">Mail Related Extensions</a></dd>
	<dd><a href="refs.math.html">Mathematical Extensions</a></dd>
	<dd><a href="refs.utilspec.nontext.html">Non-Text MIME Output</a></dd>
	<dd><a href="refs.fileprocess.process.html">Process Control Extensions</a></dd>
	<dd><a href="refs.basic.other.html">Other Basic Extensions</a></dd>
	<dd><a href="refs.remote.other.html">Other Services</a></dd>
	<dd><a href="refs.search.html">Search Engine Extensions</a></dd>
	<dd><a href="refs.utilspec.server.html">Server Specific Extensions</a></dd>
	<dd><a href="refs.basic.session.html">Session Extensions</a></dd>
	<dd><a href="refs.basic.text.html">Text Processing</a></dd>
	<dd><a href="refs.basic.vartype.html">Variable and Type Related Extensions</a></dd>
	<dd><a href="refs.webservice.html">Web Services</a></dd>
	<dd><a href="refs.utilspec.windows.html">Windows Only Extensions</a></dd>
	<dd><a href="refs.xml.html">XML Manipulation</a></dd>
</dl>
<dl>
<dt>Keyboard Shortcuts</dt><dt>?</dt>
<dd>This help</dd>
<dt>j</dt>
<dd>Next menu item</dd>
<dt>k</dt>
<dd>Previous menu item</dd>
<dt>g p</dt>
<dd>Previous man page</dd>
<dt>g n</dt>
<dd>Next man page</dd>
<dt>G</dt>
<dd>Scroll to bottom</dd>
<dt>g g</dt>
<dd>Scroll to top</dd>
<dt>g h</dt>
<dd>Goto homepage</dd>
<dt>g s</dt>
<dd>Goto search<br>(current page)</dd>
<dt>/</dt>
<dd>Focus search box</dd>
</dl></div></nav>
<div id="goto">
    <div class="search">
         <div class="text"></div>
         <div class="results"><ul></ul></div>
   </div>
</div>

  <div id="breadcrumbs" class="row-fluid">
          
              
        <ul class="breadcrumbs-container">
            <li><a href="index-2.html">PHP Manual</a></li>      <li><a href="funcref.html">Function Reference</a></li>      <li><a href="refs.utilspec.image.html">Image Processing and Generation</a></li>      <li><a href="book.image.html">GD</a></li>      <li><a href="ref.image.html">GD and Image Functions</a></li>    </ul>
  </div>




<div id="layout">
  <section id="layout-content">
  <div id="function.imagerotate" class="refentry">
 <div class="refnamediv">
  <h1 class="refname">imagerotate</h1>
  <p class="verinfo">(PHP 4 &gt;= 4.3.0, PHP 5)</p><p class="refpurpose"><span class="refname">imagerotate</span> â€” <span class="dc-title">Rotate an image with a given angle</span></p>

 </div>
 <div class="refsect1 description" id="refsect1-function.imagerotate-description">
  <h3 class="title">Description</h3>
  <div class="methodsynopsis dc-description">
   <span class="type">resource</span> <span class="methodname"><strong>imagerotate</strong></span>
    ( <span class="methodparam"><span class="type">resource</span> <code class="parameter">$image</code></span>
   , <span class="methodparam"><span class="type">float</span> <code class="parameter">$angle</code></span>
   , <span class="methodparam"><span class="type">int</span> <code class="parameter">$bgd_color</code></span>
   [, <span class="methodparam"><span class="type">int</span> <code class="parameter">$ignore_transparent</code><span class="initializer"> = 0</span></span>
  ] )</div>

  <p class="para rdfs-comment">
   Rotates the <code class="parameter">image</code> image using the given
   <code class="parameter">angle</code> in degrees. 
  </p>
  <p class="para">
   The center of rotation is the center of the image, and the rotated
   image may have different dimensions than the original image.
  </p>
 </div>

 <div class="refsect1 parameters" id="refsect1-function.imagerotate-parameters">
  <h3 class="title">Parameters</h3>
  <p class="para">
   </p><dl>

    <dt>
<code class="parameter">
image</code></dt>
<dd>
<p class="para">An image resource, returned by one of the image creation functions,
such as <span class="function"><a href="function.imagecreatetruecolor.html" class="function">imagecreatetruecolor()</a></span>.</p></dd>

    
     <dt>
<code class="parameter">angle</code></dt>

     <dd>

      <p class="para">
       Rotation angle, in degrees. The rotation angle is interpreted as the
       number of degrees to rotate the image anticlockwise.
      </p>
     </dd>

    
    
     <dt>
<code class="parameter">bgd_color</code></dt>

     <dd>

      <p class="para">
       Specifies the color of the uncovered zone after the rotation
      </p>
     </dd>

    
    
     <dt>
<code class="parameter">ignore_transparent</code></dt>

     <dd>

      <p class="para">
       If set and non-zero, transparent colors are ignored (otherwise kept).
      </p>
     </dd>

    
   </dl>

  <p></p>
 </div>

 <div class="refsect1 returnvalues" id="refsect1-function.imagerotate-returnvalues">
  <h3 class="title">Return Values</h3>
  <p class="para">
   Returns an image resource for the rotated image,  or <strong><code>FALSE</code></strong> on failure.
  </p>
 </div>

 <div class="refsect1 changelog" id="refsect1-function.imagerotate-changelog">
  <h3 class="title">Changelog</h3>
  <p class="para">
   </p><table class="doctable informaltable">
    
     <thead>
      <tr>
       <th>Version</th>
       <th>Description</th>
      </tr>

     </thead>

     <tbody class="tbody">
      <tr>
       <td>5.5.0</td>
       <td>
        This function is now affected by the interpolation method set by the 
        <span class="function"><a href="function.imagesetinterpolation.html" class="function">imagesetinterpolation()</a></span> function.
       </td>
      </tr>

      <tr>
       <td>5.1.0</td>
       <td>
        <code class="parameter">ignore_transparent</code> was added.
       </td>
      </tr>

     </tbody>
    
   </table>

  <p></p>
 </div>

 <div class="refsect1 examples" id="refsect1-function.imagerotate-examples">
  <h3 class="title">Examples</h3>
  <p class="para">
   </p><div class="example" id="example-3366">
    <p><strong>Example #1 Rotate an image 180 degrees</strong></p>
    <div class="example-contents"><p>
     This example rotates an image 180 degrees - upside down.
    </p></div>
    <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br></span><span style="color: #FF8000">//&nbsp;File&nbsp;and&nbsp;rotation<br></span><span style="color: #0000BB">$filename&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #DD0000">'test.jpg'</span><span style="color: #007700">;<br></span><span style="color: #0000BB">$degrees&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">180</span><span style="color: #007700">;<br><br></span><span style="color: #FF8000">//&nbsp;Content&nbsp;type<br></span><span style="color: #0000BB">header</span><span style="color: #007700">(</span><span style="color: #DD0000">'Content-type:&nbsp;image/jpeg'</span><span style="color: #007700">);<br><br></span><span style="color: #FF8000">//&nbsp;Load<br></span><span style="color: #0000BB">$source&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">imagecreatefromjpeg</span><span style="color: #007700">(</span><span style="color: #0000BB">$filename</span><span style="color: #007700">);<br><br></span><span style="color: #FF8000">//&nbsp;Rotate<br></span><span style="color: #0000BB">$rotate&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">imagerotate</span><span style="color: #007700">(</span><span style="color: #0000BB">$source</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$degrees</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">0</span><span style="color: #007700">);<br><br></span><span style="color: #FF8000">//&nbsp;Output<br></span><span style="color: #0000BB">imagejpeg</span><span style="color: #007700">(</span><span style="color: #0000BB">$rotate</span><span style="color: #007700">);<br><br></span><span style="color: #FF8000">//&nbsp;Free&nbsp;the&nbsp;memory<br></span><span style="color: #0000BB">imagedestroy</span><span style="color: #007700">(</span><span style="color: #0000BB">$source</span><span style="color: #007700">);<br></span><span style="color: #0000BB">imagedestroy</span><span style="color: #007700">(</span><span style="color: #0000BB">$rotate</span><span style="color: #007700">);<br></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
    </div>

    <div class="example-contents"><p>The above example will output
something similar to:</p></div>
    <div class="mediaobject">
     
     <div class="imageobject">
      <img src="images/21009b70229598c6a80eef8b45bf282b-imagerotate.jpg" alt="Output of example : Rotate an image 180 degrees" width="95" height="51">
     </div>
    </div>
   </div>
  <p></p>
 </div>

 <div class="refsect1 notes" id="refsect1-function.imagerotate-notes">
  <h3 class="title">Notes</h3>
  <blockquote class="note"><p><strong class="note">Note</strong>: </p><p class="para">This function is affected by the interpolation method set by <span class="function"><a href="function.imagesetinterpolation.html" class="function">imagesetinterpolation()</a></span>.</p><p></p></blockquote>
 </div>

 <div class="refsect1 seealso" id="refsect1-function.imagerotate-seealso">
  <h3 class="title">See Also</h3>
  <p class="para">
   </p><ul class="simplelist">
    <li class="member"><span class="function"><a href="function.imagesetinterpolation.html" class="function" rel="rdfs-seeAlso">imagesetinterpolation()</a> - Set the interpolation method</span></li>
   </ul>
  <p></p>
 </div>

</div>
<section id="usernotes">
 <div class="head"><h3 class="title">User Contributed Notes</h3></div><div id="allnotes">
  <div class="note" id="109432">  
  <a class="name">
  <strong class="user"><em>meisterix at gmx dot com</em></strong></a><div class="date" title="2012-07-16 09:24"><strong>2 years ago</strong></div>
  <div class="text" id="Hcom109432">
<div class="phpcode"><code><span class="html">
After some INet searches and personal try-and-failures I succeed to rotate PNG images with preserving alpha channel transparency (semi transparency).<br><br><span class="default">&lt;?php<br>&nbsp; &nbsp; $filename </span><span class="keyword">= </span><span class="string">'YourFile.png'</span><span class="keyword">;<br>&nbsp; &nbsp; </span><span class="default">$rotang </span><span class="keyword">= </span><span class="default">20</span><span class="keyword">; </span><span class="comment">// Rotation angle<br>&nbsp; &nbsp; </span><span class="default">$source </span><span class="keyword">= </span><span class="default">imagecreatefrompng</span><span class="keyword">(</span><span class="default">$filename</span><span class="keyword">) or die(</span><span class="string">'Error opening file '</span><span class="keyword">.</span><span class="default">$filename</span><span class="keyword">);<br>&nbsp; &nbsp; </span><span class="default">imagealphablending</span><span class="keyword">(</span><span class="default">$source</span><span class="keyword">, </span><span class="default">false</span><span class="keyword">);<br>&nbsp; &nbsp; </span><span class="default">imagesavealpha</span><span class="keyword">(</span><span class="default">$source</span><span class="keyword">, </span><span class="default">true</span><span class="keyword">);<br><br>&nbsp; &nbsp; </span><span class="default">$rotation </span><span class="keyword">= </span><span class="default">imagerotate</span><span class="keyword">(</span><span class="default">$source</span><span class="keyword">, </span><span class="default">$rotang</span><span class="keyword">, </span><span class="default">imageColorAllocateAlpha</span><span class="keyword">(</span><span class="default">$source</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">127</span><span class="keyword">));<br>&nbsp; &nbsp; </span><span class="default">imagealphablending</span><span class="keyword">(</span><span class="default">$rotation</span><span class="keyword">, </span><span class="default">false</span><span class="keyword">);<br>&nbsp; &nbsp; </span><span class="default">imagesavealpha</span><span class="keyword">(</span><span class="default">$rotation</span><span class="keyword">, </span><span class="default">true</span><span class="keyword">);<br><br>&nbsp; &nbsp; </span><span class="default">header</span><span class="keyword">(</span><span class="string">'Content-type: image/png'</span><span class="keyword">);<br>&nbsp; &nbsp; </span><span class="default">imagepng</span><span class="keyword">(</span><span class="default">$rotation</span><span class="keyword">);<br>&nbsp; &nbsp; </span><span class="default">imagedestroy</span><span class="keyword">(</span><span class="default">$source</span><span class="keyword">);<br>&nbsp; &nbsp; </span><span class="default">imagedestroy</span><span class="keyword">(</span><span class="default">$rotation</span><span class="keyword">);<br></span><span class="default">?&gt;</span>
</span>
</code></div>
  </div>
 </div>
  <div class="note" id="103029">  
  <a class="name">
  <strong class="user"><em>kraeh at gmx dot net</em></strong></a><div class="date" title="2011-03-21 09:02"><strong>3 years ago</strong></div>
  <div class="text" id="Hcom103029">
<div class="phpcode"><code><span class="html">
I had a problem with a png image containing transparent colors, but found a solution that works for me.
<br>So i thought i might share it:
<br>
<br><span class="default">&lt;?php
<br>$angle</span><span class="keyword">=</span><span class="default">45</span><span class="keyword">;
<br></span><span class="default">$im</span><span class="keyword">=</span><span class="default">imagerotate</span><span class="keyword">(</span><span class="default">$im</span><span class="keyword">, </span><span class="default">$angle</span><span class="keyword">, -</span><span class="default">1</span><span class="keyword">);
<br></span><span class="default">imagealphablending</span><span class="keyword">(</span><span class="default">$im</span><span class="keyword">, </span><span class="default">true</span><span class="keyword">);
<br></span><span class="default">imagesavealpha</span><span class="keyword">(</span><span class="default">$im</span><span class="keyword">, </span><span class="default">true</span><span class="keyword">);
<br></span><span class="default">?&gt;</span>
</span>
</code></div>
  </div>
 </div>
  <div class="note" id="99591">  
  <a class="name">
  <strong class="user"><em>xavtak at gmail dot com</em></strong></a><div class="date" title="2010-08-25 08:38"><strong>4 years ago</strong></div>
  <div class="text" id="Hcom99591">
<div class="phpcode"><code><span class="html">
I've benchmarked three methods described here for rotating an image.<br><br>I used a 1600 x 1200 jpeg picture that was duplicated ten times on the disk. I looped through them to apply a CW rotation using either method.<br><br>First algorithm (the "imagesetpixel" algorithm):<br><span class="default">&lt;?php<br></span><span class="keyword">function </span><span class="default">CWRotation</span><span class="keyword">(</span><span class="default">$image</span><span class="keyword">)<br>{<br>&nbsp; &nbsp; </span><span class="default">$w </span><span class="keyword">= </span><span class="default">imagesx</span><span class="keyword">(</span><span class="default">$image</span><span class="keyword">);<br>&nbsp; &nbsp; </span><span class="default">$h </span><span class="keyword">= </span><span class="default">imagesy</span><span class="keyword">(</span><span class="default">$image</span><span class="keyword">);<br>&nbsp; &nbsp; </span><span class="default">$result </span><span class="keyword">= @</span><span class="default">imagecreatetruecolor</span><span class="keyword">(</span><span class="default">$h</span><span class="keyword">, </span><span class="default">$w</span><span class="keyword">);<br>&nbsp; &nbsp; if(</span><span class="default">$result</span><span class="keyword">)<br>&nbsp; &nbsp; {<br>&nbsp; &nbsp; &nbsp; &nbsp; for (</span><span class="default">$i </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">; </span><span class="default">$i </span><span class="keyword">&lt; </span><span class="default">$w</span><span class="keyword">; </span><span class="default">$i</span><span class="keyword">++)<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; for (</span><span class="default">$j </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">; </span><span class="default">$j </span><span class="keyword">&lt; </span><span class="default">$h</span><span class="keyword">; </span><span class="default">$j</span><span class="keyword">++)<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$ref </span><span class="keyword">= </span><span class="default">imagecolorat</span><span class="keyword">(</span><span class="default">$image</span><span class="keyword">, </span><span class="default">$i</span><span class="keyword">, </span><span class="default">$j</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">imagesetpixel</span><span class="keyword">(</span><span class="default">$result</span><span class="keyword">, (</span><span class="default">$h </span><span class="keyword">- </span><span class="default">1</span><span class="keyword">) - </span><span class="default">$j</span><span class="keyword">, </span><span class="default">$i</span><span class="keyword">, </span><span class="default">$ref</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br>&nbsp; &nbsp; }<br>&nbsp; &nbsp; return </span><span class="default">$result</span><span class="keyword">;<br>}<br></span><span class="default">?&gt;<br></span><br>Second algorithm (the "imagecopy" algorithm):<br><span class="default">&lt;?php<br></span><span class="keyword">function </span><span class="default">CWRotation</span><span class="keyword">(</span><span class="default">$image</span><span class="keyword">)<br>{<br>&nbsp; &nbsp; </span><span class="default">$w </span><span class="keyword">= </span><span class="default">imagesx</span><span class="keyword">(</span><span class="default">$image</span><span class="keyword">);<br>&nbsp; &nbsp; </span><span class="default">$h </span><span class="keyword">= </span><span class="default">imagesy</span><span class="keyword">(</span><span class="default">$image</span><span class="keyword">);<br>&nbsp; &nbsp; </span><span class="default">$result </span><span class="keyword">= @</span><span class="default">imagecreatetruecolor</span><span class="keyword">(</span><span class="default">$h</span><span class="keyword">, </span><span class="default">$w</span><span class="keyword">);<br>&nbsp; &nbsp; if(</span><span class="default">$result</span><span class="keyword">)<br>&nbsp; &nbsp; {<br>&nbsp; &nbsp; &nbsp; &nbsp; for (</span><span class="default">$i </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">; </span><span class="default">$i </span><span class="keyword">&lt; </span><span class="default">$w</span><span class="keyword">; </span><span class="default">$i</span><span class="keyword">++)<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; for (</span><span class="default">$j </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">; </span><span class="default">$j </span><span class="keyword">&lt; </span><span class="default">$h</span><span class="keyword">; </span><span class="default">$j</span><span class="keyword">++)<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">imagecopy</span><span class="keyword">(</span><span class="default">$result</span><span class="keyword">, </span><span class="default">$image</span><span class="keyword">, (</span><span class="default">$h </span><span class="keyword">- </span><span class="default">1</span><span class="keyword">) - </span><span class="default">$j</span><span class="keyword">, </span><span class="default">$i</span><span class="keyword">, </span><span class="default">$i</span><span class="keyword">, </span><span class="default">$j</span><span class="keyword">, </span><span class="default">1</span><span class="keyword">, </span><span class="default">1</span><span class="keyword">);<br>&nbsp; &nbsp; }<br>&nbsp; &nbsp; return </span><span class="default">$result</span><span class="keyword">;<br>}<br></span><span class="default">?&gt;<br></span><br>Third algorithm (the "imagerotate" algorithm):<br><span class="default">&lt;?php<br></span><span class="keyword">function </span><span class="default">CWRotation</span><span class="keyword">(</span><span class="default">$image</span><span class="keyword">)<br>{<br>&nbsp; &nbsp; return </span><span class="default">imagerotate</span><span class="keyword">(</span><span class="default">$image</span><span class="keyword">, </span><span class="default">270</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">);<br>}<br></span><span class="default">?&gt;<br></span><br>In each step of the loop, the image is loaded, rotated then a copy is written on the disk.<br><br>Here are the results:<br>imagesetpixel algorithm: the 10 pictures were processed in 29 seconds<br>imagecopy algorithm: the 10 pictures were processed in 26 seconds<br>imagerotate algorithm: the 10 pictures were processed in 2 seconds (no typo here)<br><br>Writing the pictures on the disk allowed me to control the results. Every resulting picture was the same (tested with winmerge).<br><br>Conclusion: imagerotate is way faster than other "home-made" algorithms.<br>I ran the tests several times to see if the difference between imagesetpixel and imagecopy was introduced by my computer's independent activity, but I always got that 10% difference.<br><br>Note: the picture I used was taken from a camera, so no transparency was involved.<br>I ran the tests on Windows XP using PHP Version 5.3.0</span>
</code></div>
  </div>
 </div>
  <div class="note" id="107043">  
  <a class="name">
  <strong class="user"><em>henzeberkheij at gmail dot com</em></strong></a><div class="date" title="2012-01-01 02:27"><strong>2 years ago</strong></div>
  <div class="text" id="Hcom107043">
<div class="phpcode"><code><span class="html">
Keep in mind this function rotates counterclockwise.&nbsp; if you want to go 90 degrees clockwise, you have to tell imagerotate to go 270 degrees counter-clockwise.<br><br>$angle = 360-$angle;</span>
</code></div>
  </div>
 </div>
  <div class="note" id="105957">  
  <a class="name">
  <strong class="user"><em>Sam Yong - hellclanner at live dot com</em></strong></a><div class="date" title="2011-09-27 06:20"><strong>2 years ago</strong></div>
  <div class="text" id="Hcom105957">
<div class="phpcode"><code><span class="html">
Note that the image resource returned from the imagerotate() function is an entirely different image resource from your original one.<br><br><span class="default">&lt;?php<br><br>$res </span><span class="keyword">= </span><span class="default">imagecreatetruecolor</span><span class="keyword">(</span><span class="default">100</span><span class="keyword">, </span><span class="default">200</span><span class="keyword">);<br></span><span class="default">$res2 </span><span class="keyword">= </span><span class="default">imagerotate</span><span class="keyword">(</span><span class="default">$res</span><span class="keyword">, </span><span class="default">90</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">);<br></span><span class="default">var_dump</span><span class="keyword">(</span><span class="default">$res</span><span class="keyword">, </span><span class="default">$res2</span><span class="keyword">);<br><br></span><span class="default">?&gt;<br></span><br>This will output:<br><br>resource(2, gd)<br>resource(3, gd)</span>
</code></div>
  </div>
 </div>
  <div class="note" id="101251">  
  <a class="name">
  <strong class="user"><em>superzouz at hotmail dot com</em></strong></a><div class="date" title="2010-12-05 11:30"><strong>3 years ago</strong></div>
  <div class="text" id="Hcom101251">
<div class="phpcode"><code><span class="html">
If you're having trouble rotating images through this function, please note that you can rotate images through CSS. As imagerotate() seems to remove image transparency, I resorted to CSS rotate. Here is an example of CSS code that should work across most browsers:<br><br>img.rotated90 {<br>&nbsp; &nbsp; /* CSS3 then proprietary code */<br>&nbsp; &nbsp; rotation: 90deg;<br>&nbsp; &nbsp; -webkit-transform: rotate(90deg);<br>&nbsp; &nbsp; -moz-transform: rotate(90deg);<br>&nbsp; &nbsp; filter: progid:DXImageTransform.Microsoft.BasicImage(rotation=1);<br>}</span>
</code></div>
  </div>
 </div>
  <div class="note" id="96563">  
  <a class="name">
  <strong class="user"><em>kmrohe at letsco dot de</em></strong></a><div class="date" title="2010-03-05 03:00"><strong>4 years ago</strong></div>
  <div class="text" id="Hcom96563">
<div class="phpcode"><code><span class="html">
As an alternative to the GD rotateImage() function, this is an easy way to rotate images by 90 degrees ccw *without* loosing transparency:<br><br><span class="default">&lt;?php<br><br>&nbsp; </span><span class="keyword">function </span><span class="default">rotateImage</span><span class="keyword">(</span><span class="default">$image</span><span class="keyword">) {<br>&nbsp; &nbsp; &nbsp; </span><span class="default">$width </span><span class="keyword">= </span><span class="default">imagesx</span><span class="keyword">(</span><span class="default">$image</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; </span><span class="default">$height </span><span class="keyword">= </span><span class="default">imagesy</span><span class="keyword">(</span><span class="default">$image</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; </span><span class="default">$newImage</span><span class="keyword">= </span><span class="default">imagecreatetruecolor</span><span class="keyword">(</span><span class="default">$height</span><span class="keyword">, </span><span class="default">$width</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; </span><span class="default">imagealphablending</span><span class="keyword">(</span><span class="default">$newImage</span><span class="keyword">, </span><span class="default">false</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; </span><span class="default">imagesavealpha</span><span class="keyword">(</span><span class="default">$newImage</span><span class="keyword">, </span><span class="default">true</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; for(</span><span class="default">$w</span><span class="keyword">=</span><span class="default">0</span><span class="keyword">; </span><span class="default">$w</span><span class="keyword">&lt;</span><span class="default">$width</span><span class="keyword">; </span><span class="default">$w</span><span class="keyword">++)<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; for(</span><span class="default">$h</span><span class="keyword">=</span><span class="default">0</span><span class="keyword">; </span><span class="default">$h</span><span class="keyword">&lt;</span><span class="default">$height</span><span class="keyword">; </span><span class="default">$h</span><span class="keyword">++) {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$ref </span><span class="keyword">= </span><span class="default">imagecolorat</span><span class="keyword">(</span><span class="default">$image</span><span class="keyword">, </span><span class="default">$w</span><span class="keyword">, </span><span class="default">$h</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">imagesetpixel</span><span class="keyword">(</span><span class="default">$newImage</span><span class="keyword">, </span><span class="default">$h</span><span class="keyword">, (</span><span class="default">$width</span><span class="keyword">-</span><span class="default">1</span><span class="keyword">)-</span><span class="default">$w</span><span class="keyword">, </span><span class="default">$ref</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br>&nbsp; &nbsp; &nbsp; return </span><span class="default">$newImage</span><span class="keyword">;<br>&nbsp; }<br><br></span><span class="default">?&gt;</span>
</span>
</code></div>
  </div>
 </div>
  <div class="note" id="95749">  
  <a class="name">
  <strong class="user"><em>edwins at xs4all dot net</em></strong></a><div class="date" title="2010-01-20 01:34"><strong>4 years ago</strong></div>
  <div class="text" id="Hcom95749">
<div class="phpcode"><code><span class="html">
This function apparently contains a memory leak. Because of this, it was kept out of the GD library that comes with Ubuntu (and I assume other OS'es, too).<br><br>So, If you are running Ubuntu and wonder why you get "Call to undefined function imagerotate()" even though you seemingly have the correct GD lib installed, this is why. Use the alternative supplied by beau at dragonflydevelopment dot com instead. It works flawlessly (for angles in steps of 90 degrees).<br><br>On a side-note, some other GD image functions (unfortunately, the more interesting ones) suffer from the same problem and are kept out of the Ubuntu distribution as well.</span>
</code></div>
  </div>
 </div>
  <div class="note" id="93692">  
  <a class="name">
  <strong class="user"><em>beau at dragonflydevelopment dot com</em></strong></a><div class="date" title="2009-09-23 02:13"><strong>4 years ago</strong></div>
  <div class="text" id="Hcom93692">
<div class="phpcode"><code><span class="html">
I believe the rotateImage function below is incorrect. The 180 rotation was actually doing a vertical mirror instead of rotating 180 degrees. The change was $i to $width - $i.<br><br><span class="default">&lt;?php<br></span><span class="keyword">function </span><span class="default">rotateImage</span><span class="keyword">(</span><span class="default">$img</span><span class="keyword">, </span><span class="default">$rotation</span><span class="keyword">) {<br>&nbsp; </span><span class="default">$width </span><span class="keyword">= </span><span class="default">imagesx</span><span class="keyword">(</span><span class="default">$img</span><span class="keyword">);<br>&nbsp; </span><span class="default">$height </span><span class="keyword">= </span><span class="default">imagesy</span><span class="keyword">(</span><span class="default">$img</span><span class="keyword">);<br>&nbsp; switch(</span><span class="default">$rotation</span><span class="keyword">) {<br>&nbsp; &nbsp; case </span><span class="default">90</span><span class="keyword">: </span><span class="default">$newimg</span><span class="keyword">= @</span><span class="default">imagecreatetruecolor</span><span class="keyword">(</span><span class="default">$height </span><span class="keyword">, </span><span class="default">$width </span><span class="keyword">);break;<br>&nbsp; &nbsp; case </span><span class="default">180</span><span class="keyword">: </span><span class="default">$newimg</span><span class="keyword">= @</span><span class="default">imagecreatetruecolor</span><span class="keyword">(</span><span class="default">$width </span><span class="keyword">, </span><span class="default">$height </span><span class="keyword">);break;<br>&nbsp; &nbsp; case </span><span class="default">270</span><span class="keyword">: </span><span class="default">$newimg</span><span class="keyword">= @</span><span class="default">imagecreatetruecolor</span><span class="keyword">(</span><span class="default">$height </span><span class="keyword">, </span><span class="default">$width </span><span class="keyword">);break;<br>&nbsp; &nbsp; case </span><span class="default">0</span><span class="keyword">: return </span><span class="default">$img</span><span class="keyword">;break;<br>&nbsp; &nbsp; case </span><span class="default">360</span><span class="keyword">: return </span><span class="default">$img</span><span class="keyword">;break;<br>&nbsp; }<br>&nbsp; if(</span><span class="default">$newimg</span><span class="keyword">) { <br>&nbsp; &nbsp; for(</span><span class="default">$i </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">;</span><span class="default">$i </span><span class="keyword">&lt; </span><span class="default">$width </span><span class="keyword">; </span><span class="default">$i</span><span class="keyword">++) { <br>&nbsp; &nbsp; &nbsp; for(</span><span class="default">$j </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">;</span><span class="default">$j </span><span class="keyword">&lt; </span><span class="default">$height </span><span class="keyword">; </span><span class="default">$j</span><span class="keyword">++) {<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$reference </span><span class="keyword">= </span><span class="default">imagecolorat</span><span class="keyword">(</span><span class="default">$img</span><span class="keyword">,</span><span class="default">$i</span><span class="keyword">,</span><span class="default">$j</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; switch(</span><span class="default">$rotation</span><span class="keyword">) {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; case </span><span class="default">90</span><span class="keyword">: if(!@</span><span class="default">imagesetpixel</span><span class="keyword">(</span><span class="default">$newimg</span><span class="keyword">, (</span><span class="default">$height </span><span class="keyword">- </span><span class="default">1</span><span class="keyword">) - </span><span class="default">$j</span><span class="keyword">, </span><span class="default">$i</span><span class="keyword">, </span><span class="default">$reference </span><span class="keyword">)){return </span><span class="default">false</span><span class="keyword">;}break;<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; case </span><span class="default">180</span><span class="keyword">: if(!@</span><span class="default">imagesetpixel</span><span class="keyword">(</span><span class="default">$newimg</span><span class="keyword">, </span><span class="default">$width </span><span class="keyword">- </span><span class="default">$i</span><span class="keyword">, (</span><span class="default">$height </span><span class="keyword">- </span><span class="default">1</span><span class="keyword">) - </span><span class="default">$j</span><span class="keyword">, </span><span class="default">$reference </span><span class="keyword">)){return </span><span class="default">false</span><span class="keyword">;}break;<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; case </span><span class="default">270</span><span class="keyword">: if(!@</span><span class="default">imagesetpixel</span><span class="keyword">(</span><span class="default">$newimg</span><span class="keyword">, </span><span class="default">$j</span><span class="keyword">, </span><span class="default">$width </span><span class="keyword">- </span><span class="default">$i</span><span class="keyword">, </span><span class="default">$reference </span><span class="keyword">)){return </span><span class="default">false</span><span class="keyword">;}break;<br>&nbsp; &nbsp; &nbsp; &nbsp; }<br>&nbsp; &nbsp; &nbsp; } <br>&nbsp; &nbsp; } return </span><span class="default">$newimg</span><span class="keyword">; <br>&nbsp; } <br>&nbsp; return </span><span class="default">false</span><span class="keyword">;<br>}<br></span><span class="default">?&gt;<br></span><br>you can call it this way:<br><span class="default">&lt;?php<br>$img </span><span class="keyword">= </span><span class="default">rotateImage</span><span class="keyword">(</span><span class="default">$imagetorotate</span><span class="keyword">,</span><span class="string">"degrees"</span><span class="keyword">);<br></span><span class="default">?&gt;</span>
</span>
</code></div>
  </div>
 </div>
  <div class="note" id="93153">  
  <a class="name">
  <strong class="user"><em>dev at imglib dot endofinternet dot net</em></strong></a><div class="date" title="2009-08-25 03:15"><strong>5 years ago</strong></div>
  <div class="text" id="Hcom93153">
<div class="phpcode"><code><span class="html">
And you can add a transparent background to you png image by change the <br><span class="default">&lt;?php<br>&nbsp; &nbsp; </span><span class="keyword">if (</span><span class="default">$ignore_transparent </span><span class="keyword">== </span><span class="default">0</span><span class="keyword">) {<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">imagefill</span><span class="keyword">(</span><span class="default">$destimg</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">imagecolorallocatealpha</span><span class="keyword">(</span><span class="default">$destimg</span><span class="keyword">, </span><span class="default">255</span><span class="keyword">,</span><span class="default">255</span><span class="keyword">, </span><span class="default">255</span><span class="keyword">, </span><span class="default">127</span><span class="keyword">));<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">imagesavealpha</span><span class="keyword">(</span><span class="default">$destimg</span><span class="keyword">, </span><span class="default">true</span><span class="keyword">);<br>&nbsp; &nbsp; }<br></span><span class="default">?&gt;<br></span>to<br><span class="default">&lt;?php<br>&nbsp; &nbsp; </span><span class="keyword">if (</span><span class="default">$ignore_transparent </span><span class="keyword">== </span><span class="default">0</span><span class="keyword">) {<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$temp </span><span class="keyword">= </span><span class="default">imagecolorallocatealpha</span><span class="keyword">(</span><span class="default">$destimg</span><span class="keyword">, </span><span class="default">255</span><span class="keyword">,</span><span class="default">255</span><span class="keyword">, </span><span class="default">255</span><span class="keyword">, </span><span class="default">127</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">imagefill</span><span class="keyword">(</span><span class="default">$destimg</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">$temp</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="comment">//if set the default color or white or magic pink then use transparent color<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="keyword">if ( (</span><span class="default">$bgcolor </span><span class="keyword">== </span><span class="default">0</span><span class="keyword">) || (</span><span class="default">$bgcolor </span><span class="keyword">== </span><span class="default">16777215</span><span class="keyword">) || (</span><span class="default">$bgcolor </span><span class="keyword">== </span><span class="default">16711935</span><span class="keyword">) )&nbsp; {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$bgcolor </span><span class="keyword">= </span><span class="default">$temp</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; }<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">imagesavealpha</span><span class="keyword">(</span><span class="default">$destimg</span><span class="keyword">, </span><span class="default">true</span><span class="keyword">);<br>&nbsp; &nbsp; }<br></span><span class="default">?&gt;</span>
</span>
</code></div>
  </div>
 </div>
  <div class="note" id="92794">  
  <a class="name">
  <strong class="user"><em>sjef at bosman dot fr</em></strong></a><div class="date" title="2009-08-09 09:28"><strong>5 years ago</strong></div>
  <div class="text" id="Hcom92794">
<div class="phpcode"><code><span class="html">
I wanted to draw a transparent GIF-image and show it on a page, at an angle specified in the URL:
<br>&lt;img src="image.php?angle=90" type="image/gif"&gt;
<br>
<br>I used the native imagerotate() but at angles of 90, 180, etc. the old background colour would become non-transparent. Apparently, there's a bug somewhere in GD, and has been for ages.
<br>
<br>My solution below:
<br>
<br><span class="default">&lt;?php
<br>$height </span><span class="keyword">= </span><span class="default">100</span><span class="keyword">;
<br></span><span class="default">$width </span><span class="keyword">= </span><span class="default">100</span><span class="keyword">;
<br></span><span class="default">$lsize</span><span class="keyword">= </span><span class="default">$width</span><span class="keyword">/</span><span class="default">2</span><span class="keyword">;
<br></span><span class="default">$angle</span><span class="keyword">= </span><span class="default">$_GET</span><span class="keyword">[</span><span class="string">"angle"</span><span class="keyword">];
<br>
<br></span><span class="comment">// avoid the bug:
<br></span><span class="keyword">if((</span><span class="default">$angle</span><span class="keyword">%</span><span class="default">90</span><span class="keyword">)==</span><span class="default">0</span><span class="keyword">)
<br>&nbsp; </span><span class="default">$angle</span><span class="keyword">+= </span><span class="default">0.001</span><span class="keyword">;
<br>
<br></span><span class="default">$image_p </span><span class="keyword">= </span><span class="default">imagecreatetruecolor</span><span class="keyword">(</span><span class="default">$width</span><span class="keyword">, </span><span class="default">$height</span><span class="keyword">);
<br></span><span class="default">$trans </span><span class="keyword">= </span><span class="default">imagecolorallocate</span><span class="keyword">(</span><span class="default">$image_p</span><span class="keyword">, </span><span class="default">254</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">);
<br></span><span class="default">imagefill</span><span class="keyword">(</span><span class="default">$image_p</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">$trans</span><span class="keyword">);
<br></span><span class="default">imagecolortransparent</span><span class="keyword">(</span><span class="default">$image_p</span><span class="keyword">, </span><span class="default">$trans</span><span class="keyword">);
<br>
<br></span><span class="default">$black </span><span class="keyword">= </span><span class="default">imagecolorallocate</span><span class="keyword">(</span><span class="default">$image_p</span><span class="keyword">, </span><span class="default">1</span><span class="keyword">, </span><span class="default">1</span><span class="keyword">, </span><span class="default">1</span><span class="keyword">);
<br></span><span class="default">$red </span><span class="keyword">= </span><span class="default">imagecolorallocate</span><span class="keyword">(</span><span class="default">$image_p</span><span class="keyword">, </span><span class="default">255</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">);
<br></span><span class="default">$white </span><span class="keyword">= </span><span class="default">imagecolorallocate</span><span class="keyword">(</span><span class="default">$image_p</span><span class="keyword">, </span><span class="default">255</span><span class="keyword">, </span><span class="default">255</span><span class="keyword">, </span><span class="default">255</span><span class="keyword">);
<br>
<br></span><span class="comment">// draw something here
<br></span><span class="default">imageline</span><span class="keyword">(</span><span class="default">$image_p</span><span class="keyword">, </span><span class="default">3</span><span class="keyword">, </span><span class="default">$lsize</span><span class="keyword">, </span><span class="default">$lsize</span><span class="keyword">/</span><span class="default">2</span><span class="keyword">, </span><span class="default">$lsize</span><span class="keyword">, </span><span class="default">$black</span><span class="keyword">);
<br>
<br></span><span class="default">$image_r</span><span class="keyword">= </span><span class="default">imagerotate</span><span class="keyword">(</span><span class="default">$image_p</span><span class="keyword">, -</span><span class="default">$angle</span><span class="keyword">, </span><span class="default">$trans</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">); 
<br></span><span class="default">$w</span><span class="keyword">= </span><span class="default">imagesx</span><span class="keyword">(</span><span class="default">$image_r</span><span class="keyword">);
<br></span><span class="default">$h</span><span class="keyword">= </span><span class="default">imagesy</span><span class="keyword">(</span><span class="default">$image_r</span><span class="keyword">);
<br></span><span class="default">$image_s </span><span class="keyword">= </span><span class="default">imagecreatetruecolor</span><span class="keyword">(</span><span class="default">$width</span><span class="keyword">, </span><span class="default">$height</span><span class="keyword">);
<br></span><span class="default">imagecopyresized</span><span class="keyword">(</span><span class="default">$image_s</span><span class="keyword">, </span><span class="default">$image_r</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, (</span><span class="default">$w</span><span class="keyword">-</span><span class="default">$width</span><span class="keyword">)/</span><span class="default">2</span><span class="keyword">, (</span><span class="default">$h</span><span class="keyword">-</span><span class="default">$height</span><span class="keyword">)/</span><span class="default">2</span><span class="keyword">, </span><span class="default">$width</span><span class="keyword">, </span><span class="default">$height</span><span class="keyword">, </span><span class="default">$width</span><span class="keyword">, </span><span class="default">$height</span><span class="keyword">);
<br></span><span class="default">$trans </span><span class="keyword">= </span><span class="default">imagecolorallocate</span><span class="keyword">(</span><span class="default">$image_s</span><span class="keyword">, </span><span class="default">254</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">);
<br></span><span class="default">imagecolortransparent</span><span class="keyword">(</span><span class="default">$image_s</span><span class="keyword">, </span><span class="default">$trans</span><span class="keyword">);
<br></span><span class="default">imagegif</span><span class="keyword">(</span><span class="default">$image_s</span><span class="keyword">);
<br></span><span class="default">?&gt;</span>
</span>
</code></div>
  </div>
 </div>
  <div class="note" id="91803">  
  <a class="name">
  <strong class="user"><em>Anonymous</em></strong></a><div class="date" title="2009-06-25 05:32"><strong>5 years ago</strong></div>
  <div class="text" id="Hcom91803">
<div class="phpcode"><code><span class="html">
Sorry, the previous class contains an error, the original image after the rotation 1px move on and get the unwanted "border".<br><br>After a careful reading of the local debate, I am using the tip from Dave Richards wrote a new function. With its images can be rotated only 90 Â° (default), 180 Â° and 270 Â°, but one rarely needs more ...<br><br>The function returns False, or rotated image <br><span class="default">&lt;?php<br></span><span class="keyword">if(!</span><span class="default">function_exists</span><span class="keyword">(</span><span class="string">"imagerotate"</span><span class="keyword">)) {<br>&nbsp; &nbsp; function </span><span class="default">imagerotate</span><span class="keyword">(</span><span class="default">$srcImg</span><span class="keyword">, </span><span class="default">$angle</span><span class="keyword">, </span><span class="default">$bgcolor</span><span class="keyword">, </span><span class="default">$ignore_transparent </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">) {<br>&nbsp; &nbsp; &nbsp; &nbsp; return </span><span class="default">rotateImage</span><span class="keyword">(</span><span class="default">$srcImg</span><span class="keyword">, </span><span class="default">$angle</span><span class="keyword">);<br>&nbsp; &nbsp; }<br>}<br><br>function </span><span class="default">rotateImage</span><span class="keyword">(</span><span class="default">$img1</span><span class="keyword">, </span><span class="default">$rec</span><span class="keyword">) {<br>&nbsp; &nbsp; </span><span class="default">$wid </span><span class="keyword">= </span><span class="default">imagesx</span><span class="keyword">(</span><span class="default">$img1</span><span class="keyword">);<br>&nbsp; &nbsp; </span><span class="default">$hei </span><span class="keyword">= </span><span class="default">imagesy</span><span class="keyword">(</span><span class="default">$img1</span><span class="keyword">);<br>&nbsp; &nbsp; switch(</span><span class="default">$rec</span><span class="keyword">) {<br>&nbsp; &nbsp; &nbsp; &nbsp; case </span><span class="default">270</span><span class="keyword">:<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$img2 </span><span class="keyword">= @</span><span class="default">imagecreatetruecolor</span><span class="keyword">(</span><span class="default">$hei</span><span class="keyword">, </span><span class="default">$wid</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; break;<br>&nbsp; &nbsp; &nbsp; &nbsp; case </span><span class="default">180</span><span class="keyword">:<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$img2 </span><span class="keyword">= @</span><span class="default">imagecreatetruecolor</span><span class="keyword">(</span><span class="default">$wid</span><span class="keyword">, </span><span class="default">$hei</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; break;<br>&nbsp; &nbsp; &nbsp; &nbsp; default :<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$img2 </span><span class="keyword">= @</span><span class="default">imagecreatetruecolor</span><span class="keyword">(</span><span class="default">$hei</span><span class="keyword">, </span><span class="default">$wid</span><span class="keyword">);<br>&nbsp; &nbsp; }<br>&nbsp; &nbsp; if(</span><span class="default">$img2</span><span class="keyword">) {<br>&nbsp; &nbsp; &nbsp; &nbsp; for(</span><span class="default">$i </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">;</span><span class="default">$i </span><span class="keyword">&lt; </span><span class="default">$wid</span><span class="keyword">; </span><span class="default">$i</span><span class="keyword">++) {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; for(</span><span class="default">$j </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">;</span><span class="default">$j </span><span class="keyword">&lt; </span><span class="default">$hei</span><span class="keyword">; </span><span class="default">$j</span><span class="keyword">++) {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$ref </span><span class="keyword">= </span><span class="default">imagecolorat</span><span class="keyword">(</span><span class="default">$img1</span><span class="keyword">,</span><span class="default">$i</span><span class="keyword">,</span><span class="default">$j</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; switch(</span><span class="default">$rec</span><span class="keyword">) {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; case </span><span class="default">270</span><span class="keyword">:<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if(!@</span><span class="default">imagesetpixel</span><span class="keyword">(</span><span class="default">$img2</span><span class="keyword">, (</span><span class="default">$hei </span><span class="keyword">- </span><span class="default">1</span><span class="keyword">) - </span><span class="default">$j</span><span class="keyword">, </span><span class="default">$i</span><span class="keyword">, </span><span class="default">$ref</span><span class="keyword">)){<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; return </span><span class="default">false</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; break;<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; case </span><span class="default">180</span><span class="keyword">:<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if(!@</span><span class="default">imagesetpixel</span><span class="keyword">(</span><span class="default">$img2</span><span class="keyword">, </span><span class="default">$i</span><span class="keyword">, (</span><span class="default">$hei </span><span class="keyword">- </span><span class="default">1</span><span class="keyword">) - </span><span class="default">$j</span><span class="keyword">, </span><span class="default">$ref</span><span class="keyword">)) {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; return </span><span class="default">false</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; break;<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; default:<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if(!@</span><span class="default">imagesetpixel</span><span class="keyword">(</span><span class="default">$img2</span><span class="keyword">, </span><span class="default">$j</span><span class="keyword">, (</span><span class="default">$wid </span><span class="keyword">- </span><span class="default">1</span><span class="keyword">) - </span><span class="default">$i</span><span class="keyword">, </span><span class="default">$ref</span><span class="keyword">)) {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; return </span><span class="default">false</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br>&nbsp; &nbsp; &nbsp; &nbsp; }<br>&nbsp; &nbsp; &nbsp; &nbsp; return </span><span class="default">$img2</span><span class="keyword">;<br>&nbsp; &nbsp; }<br>&nbsp; &nbsp; return </span><span class="default">false</span><span class="keyword">;<br>}<br></span><span class="default">?&gt;<br></span><br>Petr</span>
</code></div>
  </div>
 </div>
  <div class="note" id="91761">  
  <a class="name">
  <strong class="user"><em>Mike Knoop</em></strong></a><div class="date" title="2009-06-24 02:25"><strong>5 years ago</strong></div>
  <div class="text" id="Hcom91761">
<div class="phpcode"><code><span class="html">
Don't be tricked into thinking this function will rotate the image resource handle in-place. While the documentation currently doesn't specify and return values, I've found the following return values to be true:<br><br>"Returns an image resource identifier on success, FALSE on errors. "<br><br>Simply make sure you're doing something like...<br><span class="default">&lt;?php<br>$rotated_img </span><span class="keyword">= </span><span class="default">imagerotate</span><span class="keyword">(</span><span class="default">$src_img</span><span class="keyword">, </span><span class="default">45</span><span class="keyword">, </span><span class="default">$color</span><span class="keyword">)<br></span><span class="default">?&gt;<br></span><br>-Mike</span>
</code></div>
  </div>
 </div>
  <div class="note" id="91709">  
  <a class="name">
  <strong class="user"><em>krteczek01 at gmail dot com</em></strong></a><div class="date" title="2009-06-23 03:21"><strong>5 years ago</strong></div>
  <div class="text" id="Hcom91709">
<div class="phpcode"><code><span class="html">
Hi, I've rewrote function to class with static methods. Advantage of this solution is ability to be called several times during script execution.<br><br><span class="default">&lt;?php<br></span><span class="comment">/*<br>&nbsp; &nbsp; Unfinished imagerotate replacement. ignore_transparent is, well, ignored. :)<br>&nbsp; &nbsp; Also, should have some standard functions for 90, 180 and 270 degrees, since they are quite<br>&nbsp; &nbsp; easy to implement faster.<br>*/<br><br></span><span class="keyword">if(!</span><span class="default">function_exists</span><span class="keyword">(</span><span class="string">"imagerotate"</span><span class="keyword">)) {<br>&nbsp; &nbsp; function </span><span class="default">imagerotate</span><span class="keyword">(&amp;</span><span class="default">$srcImg</span><span class="keyword">, </span><span class="default">$angle</span><span class="keyword">, </span><span class="default">$bgcolor</span><span class="keyword">, </span><span class="default">$ignore_transparent </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">) {<br>&nbsp; &nbsp; &nbsp; &nbsp; return </span><span class="default">imagerotateEquivalent</span><span class="keyword">::</span><span class="default">rotate</span><span class="keyword">(&amp;</span><span class="default">$srcImg</span><span class="keyword">, </span><span class="default">$angle</span><span class="keyword">, </span><span class="default">$bgcolor</span><span class="keyword">, </span><span class="default">$ignore_transparent</span><span class="keyword">);<br>&nbsp; &nbsp; }<br>}<br><br>class </span><span class="default">imagerotateEquivalent </span><span class="keyword">{<br><br>&nbsp; &nbsp; static private function </span><span class="default">rotateX</span><span class="keyword">(</span><span class="default">$x</span><span class="keyword">, </span><span class="default">$y</span><span class="keyword">, </span><span class="default">$theta</span><span class="keyword">){<br>&nbsp; &nbsp; &nbsp; &nbsp; return </span><span class="default">$x </span><span class="keyword">* </span><span class="default">cos</span><span class="keyword">(</span><span class="default">$theta</span><span class="keyword">) - </span><span class="default">$y </span><span class="keyword">* </span><span class="default">sin</span><span class="keyword">(</span><span class="default">$theta</span><span class="keyword">);<br>&nbsp; &nbsp; }<br><br>&nbsp; &nbsp; static private function </span><span class="default">rotateY</span><span class="keyword">(</span><span class="default">$x</span><span class="keyword">, </span><span class="default">$y</span><span class="keyword">, </span><span class="default">$theta</span><span class="keyword">){<br>&nbsp; &nbsp; &nbsp; &nbsp; return </span><span class="default">$x </span><span class="keyword">* </span><span class="default">sin</span><span class="keyword">(</span><span class="default">$theta</span><span class="keyword">) + </span><span class="default">$y </span><span class="keyword">* </span><span class="default">cos</span><span class="keyword">(</span><span class="default">$theta</span><span class="keyword">);<br>&nbsp; &nbsp; }<br><br>&nbsp; &nbsp; public static function </span><span class="default">rotate</span><span class="keyword">(&amp;</span><span class="default">$srcImg</span><span class="keyword">, </span><span class="default">$angle</span><span class="keyword">, </span><span class="default">$bgcolor</span><span class="keyword">, </span><span class="default">$ignore_transparent </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">) {<br>&nbsp; &nbsp; &nbsp; &nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$srcw </span><span class="keyword">= </span><span class="default">imagesx</span><span class="keyword">(</span><span class="default">$srcImg</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$srch </span><span class="keyword">= </span><span class="default">imagesy</span><span class="keyword">(</span><span class="default">$srcImg</span><span class="keyword">);<br><br>&nbsp; &nbsp; &nbsp; &nbsp; if(</span><span class="default">$angle </span><span class="keyword">== </span><span class="default">0</span><span class="keyword">) return </span><span class="default">$srcImg</span><span class="keyword">;<br><br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="comment">// Convert the angle to radians<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$theta </span><span class="keyword">= </span><span class="default">deg2rad </span><span class="keyword">(</span><span class="default">$angle</span><span class="keyword">);<br><br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="comment">// Calculate the width of the destination image.<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$temp </span><span class="keyword">= array (&nbsp; &nbsp; </span><span class="default">self</span><span class="keyword">::</span><span class="default">rotateX</span><span class="keyword">(</span><span class="default">0</span><span class="keyword">,&nbsp; &nbsp;&nbsp; </span><span class="default">0</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">-</span><span class="default">$theta</span><span class="keyword">),<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">self</span><span class="keyword">::</span><span class="default">rotateX</span><span class="keyword">(</span><span class="default">$srcw</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">-</span><span class="default">$theta</span><span class="keyword">),<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">self</span><span class="keyword">::</span><span class="default">rotateX</span><span class="keyword">(</span><span class="default">0</span><span class="keyword">,&nbsp; &nbsp;&nbsp; </span><span class="default">$srch</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">-</span><span class="default">$theta</span><span class="keyword">),<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">self</span><span class="keyword">::</span><span class="default">rotateX</span><span class="keyword">(</span><span class="default">$srcw</span><span class="keyword">, </span><span class="default">$srch</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">-</span><span class="default">$theta</span><span class="keyword">)<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; );<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$minX </span><span class="keyword">= </span><span class="default">floor</span><span class="keyword">(</span><span class="default">min</span><span class="keyword">(</span><span class="default">$temp</span><span class="keyword">));<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$maxX </span><span class="keyword">= </span><span class="default">ceil</span><span class="keyword">(</span><span class="default">max</span><span class="keyword">(</span><span class="default">$temp</span><span class="keyword">));<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$width </span><span class="keyword">= </span><span class="default">$maxX </span><span class="keyword">- </span><span class="default">$minX</span><span class="keyword">;<br><br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="comment">// Calculate the height of the destination image.<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$temp </span><span class="keyword">= array (&nbsp; &nbsp; </span><span class="default">self</span><span class="keyword">::</span><span class="default">rotateY</span><span class="keyword">(</span><span class="default">0</span><span class="keyword">,&nbsp; &nbsp;&nbsp; </span><span class="default">0</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">-</span><span class="default">$theta</span><span class="keyword">),<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">self</span><span class="keyword">::</span><span class="default">rotateY</span><span class="keyword">(</span><span class="default">$srcw</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">-</span><span class="default">$theta</span><span class="keyword">),<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">self</span><span class="keyword">::</span><span class="default">rotateY</span><span class="keyword">(</span><span class="default">0</span><span class="keyword">,&nbsp; &nbsp;&nbsp; </span><span class="default">$srch</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">-</span><span class="default">$theta</span><span class="keyword">),<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">self</span><span class="keyword">::</span><span class="default">rotateY</span><span class="keyword">(</span><span class="default">$srcw</span><span class="keyword">, </span><span class="default">$srch</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">-</span><span class="default">$theta</span><span class="keyword">)<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; );<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$minY </span><span class="keyword">= </span><span class="default">floor</span><span class="keyword">(</span><span class="default">min</span><span class="keyword">(</span><span class="default">$temp</span><span class="keyword">));<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$maxY </span><span class="keyword">= </span><span class="default">ceil</span><span class="keyword">(</span><span class="default">max</span><span class="keyword">(</span><span class="default">$temp</span><span class="keyword">));<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$height </span><span class="keyword">= </span><span class="default">$maxY </span><span class="keyword">- </span><span class="default">$minY</span><span class="keyword">;<br><br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$destimg </span><span class="keyword">= </span><span class="default">imagecreatetruecolor</span><span class="keyword">(</span><span class="default">$width</span><span class="keyword">, </span><span class="default">$height</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">imagefill</span><span class="keyword">(</span><span class="default">$destimg</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">imagecolorallocate</span><span class="keyword">(</span><span class="default">$destimg</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">,</span><span class="default">255</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">));<br><br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="comment">// sets all pixels in the new image<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="keyword">for(</span><span class="default">$x</span><span class="keyword">=</span><span class="default">$minX</span><span class="keyword">;</span><span class="default">$x</span><span class="keyword">&lt;</span><span class="default">$maxX</span><span class="keyword">;</span><span class="default">$x</span><span class="keyword">++) {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; for(</span><span class="default">$y</span><span class="keyword">=</span><span class="default">$minY</span><span class="keyword">;</span><span class="default">$y</span><span class="keyword">&lt;</span><span class="default">$maxY</span><span class="keyword">;</span><span class="default">$y</span><span class="keyword">++)<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="comment">// fetch corresponding pixel from the source image<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$srcX </span><span class="keyword">= </span><span class="default">round</span><span class="keyword">(</span><span class="default">self</span><span class="keyword">::</span><span class="default">rotateX</span><span class="keyword">(</span><span class="default">$x</span><span class="keyword">, </span><span class="default">$y</span><span class="keyword">, </span><span class="default">$theta</span><span class="keyword">));<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$srcY </span><span class="keyword">= </span><span class="default">round</span><span class="keyword">(</span><span class="default">self</span><span class="keyword">::</span><span class="default">rotateY</span><span class="keyword">(</span><span class="default">$x</span><span class="keyword">, </span><span class="default">$y</span><span class="keyword">, </span><span class="default">$theta</span><span class="keyword">));<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if(</span><span class="default">$srcX </span><span class="keyword">&gt;= </span><span class="default">0 </span><span class="keyword">&amp;&amp; </span><span class="default">$srcX </span><span class="keyword">&lt; </span><span class="default">$srcw </span><span class="keyword">&amp;&amp; </span><span class="default">$srcY </span><span class="keyword">&gt;= </span><span class="default">0 </span><span class="keyword">&amp;&amp; </span><span class="default">$srcY </span><span class="keyword">&lt; </span><span class="default">$srch</span><span class="keyword">)<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$color </span><span class="keyword">= </span><span class="default">imagecolorat</span><span class="keyword">(</span><span class="default">$srcImg</span><span class="keyword">, </span><span class="default">$srcX</span><span class="keyword">, </span><span class="default">$srcY </span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; else<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$color </span><span class="keyword">= </span><span class="default">$bgcolor</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">imagesetpixel</span><span class="keyword">(</span><span class="default">$destimg</span><span class="keyword">, </span><span class="default">$x</span><span class="keyword">-</span><span class="default">$minX</span><span class="keyword">, </span><span class="default">$y</span><span class="keyword">-</span><span class="default">$minY</span><span class="keyword">, </span><span class="default">$color</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br>&nbsp; &nbsp; &nbsp; &nbsp; }<br>&nbsp; &nbsp; &nbsp; &nbsp; return </span><span class="default">$destimg</span><span class="keyword">;<br>&nbsp; &nbsp; }<br>}<br><br></span><span class="default">?&gt;</span>
</span>
</code></div>
  </div>
 </div>
  <div class="note" id="91505">  
  <a class="name">
  <strong class="user"><em>anon at here dot com</em></strong></a><div class="date" title="2009-06-13 01:00"><strong>5 years ago</strong></div>
  <div class="text" id="Hcom91505">
<div class="phpcode"><code><span class="html">
I was quite surprised to see that no one had done any working rotate function. And since I needed one for my web hotel, I whipped this one up. Someone might want to expand it so that it matches imagerotate.<br><br>Also, does imagerotate really rotate things counter clockwise? Otherwise this should also be changed.<br><br><span class="default">&lt;?php<br></span><span class="keyword">if(!</span><span class="default">function_exists</span><span class="keyword">(</span><span class="string">"imagerotate"</span><span class="keyword">)) {<br>&nbsp; &nbsp; function </span><span class="default">imagerotate</span><span class="keyword">(&amp;</span><span class="default">$srcImg</span><span class="keyword">, </span><span class="default">$angle</span><span class="keyword">, </span><span class="default">$bgcolor</span><span class="keyword">, </span><span class="default">$ignore_transparent </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">) {<br>&nbsp; &nbsp; &nbsp; &nbsp; return </span><span class="default">imagerotateEquivalent</span><span class="keyword">(&amp;</span><span class="default">$srcImg</span><span class="keyword">, </span><span class="default">$angle</span><span class="keyword">, </span><span class="default">$bgcolor</span><span class="keyword">, </span><span class="default">$ignore_transparent</span><span class="keyword">);<br>&nbsp; &nbsp; }<br>}<br><br></span><span class="comment">/*<br>&nbsp; &nbsp; Unfinished imagerotate replacement. ignore_transparent is, well, ignored. :)<br>&nbsp; &nbsp; Also, should have some standard functions for 90, 180 and 270 degrees, since they are quite <br>&nbsp; &nbsp; easy to implement faster.<br>*/<br></span><span class="keyword">function </span><span class="default">imagerotateEquivalent</span><span class="keyword">(&amp;</span><span class="default">$srcImg</span><span class="keyword">, </span><span class="default">$angle</span><span class="keyword">, </span><span class="default">$bgcolor</span><span class="keyword">, </span><span class="default">$ignore_transparent </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">) <br>{<br>&nbsp; &nbsp; function </span><span class="default">rotateX</span><span class="keyword">(</span><span class="default">$x</span><span class="keyword">, </span><span class="default">$y</span><span class="keyword">, </span><span class="default">$theta</span><span class="keyword">){<br>&nbsp; &nbsp; &nbsp; &nbsp; return </span><span class="default">$x </span><span class="keyword">* </span><span class="default">cos</span><span class="keyword">(</span><span class="default">$theta</span><span class="keyword">) - </span><span class="default">$y </span><span class="keyword">* </span><span class="default">sin</span><span class="keyword">(</span><span class="default">$theta</span><span class="keyword">);<br>&nbsp; &nbsp; }<br>&nbsp; &nbsp; function </span><span class="default">rotateY</span><span class="keyword">(</span><span class="default">$x</span><span class="keyword">, </span><span class="default">$y</span><span class="keyword">, </span><span class="default">$theta</span><span class="keyword">){<br>&nbsp; &nbsp; &nbsp; &nbsp; return </span><span class="default">$x </span><span class="keyword">* </span><span class="default">sin</span><span class="keyword">(</span><span class="default">$theta</span><span class="keyword">) + </span><span class="default">$y </span><span class="keyword">* </span><span class="default">cos</span><span class="keyword">(</span><span class="default">$theta</span><span class="keyword">);<br>&nbsp; &nbsp; }<br>&nbsp; &nbsp; <br>&nbsp; &nbsp; </span><span class="default">$srcw </span><span class="keyword">= </span><span class="default">imagesx</span><span class="keyword">(</span><span class="default">$srcImg</span><span class="keyword">);<br>&nbsp; &nbsp; </span><span class="default">$srch </span><span class="keyword">= </span><span class="default">imagesy</span><span class="keyword">(</span><span class="default">$srcImg</span><span class="keyword">);<br>&nbsp; <br>&nbsp; &nbsp; if(</span><span class="default">$angle </span><span class="keyword">== </span><span class="default">0</span><span class="keyword">) return </span><span class="default">$srcImg</span><span class="keyword">;<br>&nbsp; &nbsp; <br>&nbsp; &nbsp; </span><span class="comment">// Convert the angle to radians<br>&nbsp; &nbsp; </span><span class="default">$theta </span><span class="keyword">= </span><span class="default">deg2rad </span><span class="keyword">(</span><span class="default">$angle</span><span class="keyword">);<br><br>&nbsp; &nbsp; <br>&nbsp; &nbsp; </span><span class="comment">// Calculate the width of the destination image.<br>&nbsp; &nbsp; </span><span class="default">$temp </span><span class="keyword">= array (&nbsp; &nbsp; </span><span class="default">rotateX</span><span class="keyword">(</span><span class="default">0</span><span class="keyword">,&nbsp; &nbsp;&nbsp; </span><span class="default">0</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">-</span><span class="default">$theta</span><span class="keyword">),<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">rotateX</span><span class="keyword">(</span><span class="default">$srcw</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">-</span><span class="default">$theta</span><span class="keyword">),<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">rotateX</span><span class="keyword">(</span><span class="default">0</span><span class="keyword">,&nbsp; &nbsp;&nbsp; </span><span class="default">$srch</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">-</span><span class="default">$theta</span><span class="keyword">),<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">rotateX</span><span class="keyword">(</span><span class="default">$srcw</span><span class="keyword">, </span><span class="default">$srch</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">-</span><span class="default">$theta</span><span class="keyword">)<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; );<br>&nbsp; &nbsp; </span><span class="default">$minX </span><span class="keyword">= </span><span class="default">floor</span><span class="keyword">(</span><span class="default">min</span><span class="keyword">(</span><span class="default">$temp</span><span class="keyword">));<br>&nbsp; &nbsp; </span><span class="default">$maxX </span><span class="keyword">= </span><span class="default">ceil</span><span class="keyword">(</span><span class="default">max</span><span class="keyword">(</span><span class="default">$temp</span><span class="keyword">));<br>&nbsp; &nbsp; </span><span class="default">$width </span><span class="keyword">= </span><span class="default">$maxX </span><span class="keyword">- </span><span class="default">$minX</span><span class="keyword">;<br>&nbsp; &nbsp; <br>&nbsp; &nbsp; </span><span class="comment">// Calculate the height of the destination image.<br>&nbsp; &nbsp; </span><span class="default">$temp </span><span class="keyword">= array (&nbsp; &nbsp; </span><span class="default">rotateY</span><span class="keyword">(</span><span class="default">0</span><span class="keyword">,&nbsp; &nbsp;&nbsp; </span><span class="default">0</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">-</span><span class="default">$theta</span><span class="keyword">),<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">rotateY</span><span class="keyword">(</span><span class="default">$srcw</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">-</span><span class="default">$theta</span><span class="keyword">),<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">rotateY</span><span class="keyword">(</span><span class="default">0</span><span class="keyword">,&nbsp; &nbsp;&nbsp; </span><span class="default">$srch</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">-</span><span class="default">$theta</span><span class="keyword">),<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">rotateY</span><span class="keyword">(</span><span class="default">$srcw</span><span class="keyword">, </span><span class="default">$srch</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">-</span><span class="default">$theta</span><span class="keyword">)<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; );<br>&nbsp; &nbsp; </span><span class="default">$minY </span><span class="keyword">= </span><span class="default">floor</span><span class="keyword">(</span><span class="default">min</span><span class="keyword">(</span><span class="default">$temp</span><span class="keyword">));<br>&nbsp; &nbsp; </span><span class="default">$maxY </span><span class="keyword">= </span><span class="default">ceil</span><span class="keyword">(</span><span class="default">max</span><span class="keyword">(</span><span class="default">$temp</span><span class="keyword">));<br>&nbsp; &nbsp; </span><span class="default">$height </span><span class="keyword">= </span><span class="default">$maxY </span><span class="keyword">- </span><span class="default">$minY</span><span class="keyword">;<br>&nbsp; &nbsp; <br>&nbsp; &nbsp; </span><span class="default">$destimg </span><span class="keyword">= </span><span class="default">imagecreatetruecolor</span><span class="keyword">(</span><span class="default">$width</span><span class="keyword">, </span><span class="default">$height</span><span class="keyword">);<br>&nbsp; &nbsp; </span><span class="default">imagefill</span><span class="keyword">(</span><span class="default">$destimg</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">imagecolorallocate</span><span class="keyword">(</span><span class="default">$destimg</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">,</span><span class="default">255</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">));<br><br>&nbsp; &nbsp; </span><span class="comment">// sets all pixels in the new image<br>&nbsp; &nbsp; </span><span class="keyword">for(</span><span class="default">$x</span><span class="keyword">=</span><span class="default">$minX</span><span class="keyword">;</span><span class="default">$x</span><span class="keyword">&lt;</span><span class="default">$maxX</span><span class="keyword">;</span><span class="default">$x</span><span class="keyword">++) {<br>&nbsp; &nbsp; &nbsp; &nbsp; for(</span><span class="default">$y</span><span class="keyword">=</span><span class="default">$minY</span><span class="keyword">;</span><span class="default">$y</span><span class="keyword">&lt;</span><span class="default">$maxY</span><span class="keyword">;</span><span class="default">$y</span><span class="keyword">++) <br>&nbsp; &nbsp; &nbsp; &nbsp; {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="comment">// fetch corresponding pixel from the source image<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$srcX </span><span class="keyword">= </span><span class="default">round</span><span class="keyword">(</span><span class="default">rotateX</span><span class="keyword">(</span><span class="default">$x</span><span class="keyword">, </span><span class="default">$y</span><span class="keyword">, </span><span class="default">$theta</span><span class="keyword">));<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$srcY </span><span class="keyword">= </span><span class="default">round</span><span class="keyword">(</span><span class="default">rotateY</span><span class="keyword">(</span><span class="default">$x</span><span class="keyword">, </span><span class="default">$y</span><span class="keyword">, </span><span class="default">$theta</span><span class="keyword">));<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if(</span><span class="default">$srcX </span><span class="keyword">&gt;= </span><span class="default">0 </span><span class="keyword">&amp;&amp; </span><span class="default">$srcX </span><span class="keyword">&lt; </span><span class="default">$srcw </span><span class="keyword">&amp;&amp; </span><span class="default">$srcY </span><span class="keyword">&gt;= </span><span class="default">0 </span><span class="keyword">&amp;&amp; </span><span class="default">$srcY </span><span class="keyword">&lt; </span><span class="default">$srch</span><span class="keyword">)<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$color </span><span class="keyword">= </span><span class="default">imagecolorat</span><span class="keyword">(</span><span class="default">$srcImg</span><span class="keyword">, </span><span class="default">$srcX</span><span class="keyword">, </span><span class="default">$srcY </span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; else<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$color </span><span class="keyword">= </span><span class="default">$bgcolor</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">imagesetpixel</span><span class="keyword">(</span><span class="default">$destimg</span><span class="keyword">, </span><span class="default">$x</span><span class="keyword">-</span><span class="default">$minX</span><span class="keyword">, </span><span class="default">$y</span><span class="keyword">-</span><span class="default">$minY</span><span class="keyword">, </span><span class="default">$color</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; }<br>&nbsp; &nbsp; }<br>&nbsp; &nbsp; <br>&nbsp; &nbsp; return </span><span class="default">$destimg</span><span class="keyword">;<br>}<br></span><span class="default">?&gt;</span>
</span>
</code></div>
  </div>
 </div>
  <div class="note" id="90350">  
  <a class="name">
  <strong class="user"><em>dave dot richards at gmail dot com</em></strong></a><div class="date" title="2009-04-17 04:47"><strong>5 years ago</strong></div>
  <div class="text" id="Hcom90350">
<div class="phpcode"><code><span class="html">
There is a slight mistake in the previous post by Kae Cyphet.<br><br>When setting the pixels of the new image the co-ordinates have to occasionally use the width ($wid) and height ($hei). These values must be reduced by 1 as the co-ordinates start at 0 (Not 1) so they only go up to $wid - 1 and $hei - 1 (Not $wid and $hei).<br><br>Here's an example of the first function to show this:<br><br><span class="default">&lt;?php<br></span><span class="keyword">function </span><span class="default">rotate_right90</span><span class="keyword">(</span><span class="default">$im</span><span class="keyword">)<br>{<br> </span><span class="default">$wid </span><span class="keyword">= </span><span class="default">imagesx</span><span class="keyword">(</span><span class="default">$im</span><span class="keyword">);<br> </span><span class="default">$hei </span><span class="keyword">= </span><span class="default">imagesy</span><span class="keyword">(</span><span class="default">$im</span><span class="keyword">);<br> </span><span class="default">$im2 </span><span class="keyword">= </span><span class="default">imagecreatetruecolor</span><span class="keyword">(</span><span class="default">$hei</span><span class="keyword">,</span><span class="default">$wid</span><span class="keyword">);<br><br> for(</span><span class="default">$i </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">;</span><span class="default">$i </span><span class="keyword">&lt; </span><span class="default">$wid</span><span class="keyword">; </span><span class="default">$i</span><span class="keyword">++)<br> {<br>&nbsp; for(</span><span class="default">$j </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">;</span><span class="default">$j </span><span class="keyword">&lt; </span><span class="default">$hei</span><span class="keyword">; </span><span class="default">$j</span><span class="keyword">++)<br>&nbsp; {<br>&nbsp;&nbsp; </span><span class="default">$ref </span><span class="keyword">= </span><span class="default">imagecolorat</span><span class="keyword">(</span><span class="default">$im</span><span class="keyword">,</span><span class="default">$i</span><span class="keyword">,</span><span class="default">$j</span><span class="keyword">);<br>&nbsp;&nbsp; </span><span class="default">imagesetpixel</span><span class="keyword">(</span><span class="default">$im2</span><span class="keyword">,(</span><span class="default">$hei </span><span class="keyword">- </span><span class="default">1</span><span class="keyword">) - </span><span class="default">$j</span><span class="keyword">,</span><span class="default">$i</span><span class="keyword">,</span><span class="default">$ref</span><span class="keyword">);<br>&nbsp; }<br> }<br> return </span><span class="default">$im2</span><span class="keyword">;<br>}<br></span><span class="default">?&gt;<br></span><br>Other than that very useful functions!</span>
</code></div>
  </div>
 </div>
  <div class="note" id="88436">  
  <a class="name">
  <strong class="user"><em>Kae Cyphet</em></strong></a><div class="date" title="2009-01-23 01:50"><strong>5 years ago</strong></div>
  <div class="text" id="Hcom88436">
<div class="phpcode"><code><span class="html">
To solve that annoying problem of having to install a pre-compiled version of GD just to get imagerotate working.<br><br>here is an open source solution.<br>uses the standard stuff included in php when you uncomment 'extension=php_gd2.dll' in the php.ini file and there ya go!<br><br>Useage:<br><span class="default">&lt;?php<br>$im </span><span class="keyword">= </span><span class="default">imagecreatefromjpeg</span><span class="keyword">(</span><span class="string">'test.jpg'</span><span class="keyword">);<br><br></span><span class="default">header</span><span class="keyword">(</span><span class="string">'Content-type: image/jpg'</span><span class="keyword">);<br></span><span class="default">imagejpeg</span><span class="keyword">(</span><span class="default">rotate_right90</span><span class="keyword">(</span><span class="default">$im</span><span class="keyword">));<br><br></span><span class="default">imagedestroy</span><span class="keyword">(</span><span class="default">$im</span><span class="keyword">);<br></span><span class="default">?&gt;<br></span><br>'=================================<br><br><span class="default">&lt;?php<br></span><span class="keyword">function </span><span class="default">rotate_right90</span><span class="keyword">(</span><span class="default">$im</span><span class="keyword">)<br>{<br> </span><span class="default">$wid </span><span class="keyword">= </span><span class="default">imagesx</span><span class="keyword">(</span><span class="default">$im</span><span class="keyword">);<br> </span><span class="default">$hei </span><span class="keyword">= </span><span class="default">imagesy</span><span class="keyword">(</span><span class="default">$im</span><span class="keyword">);<br> </span><span class="default">$im2 </span><span class="keyword">= </span><span class="default">imagecreatetruecolor</span><span class="keyword">(</span><span class="default">$hei</span><span class="keyword">,</span><span class="default">$wid</span><span class="keyword">);<br><br> for(</span><span class="default">$i </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">;</span><span class="default">$i </span><span class="keyword">&lt; </span><span class="default">$wid</span><span class="keyword">; </span><span class="default">$i</span><span class="keyword">++)<br> {<br>&nbsp; for(</span><span class="default">$j </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">;</span><span class="default">$j </span><span class="keyword">&lt; </span><span class="default">$hei</span><span class="keyword">; </span><span class="default">$j</span><span class="keyword">++)<br>&nbsp; {<br>&nbsp;&nbsp; </span><span class="default">$ref </span><span class="keyword">= </span><span class="default">imagecolorat</span><span class="keyword">(</span><span class="default">$im</span><span class="keyword">,</span><span class="default">$i</span><span class="keyword">,</span><span class="default">$j</span><span class="keyword">);<br>&nbsp;&nbsp; </span><span class="default">imagesetpixel</span><span class="keyword">(</span><span class="default">$im2</span><span class="keyword">,</span><span class="default">$hei </span><span class="keyword">- </span><span class="default">$j</span><span class="keyword">,</span><span class="default">$i</span><span class="keyword">,</span><span class="default">$ref</span><span class="keyword">);<br>&nbsp; }<br> }<br> return </span><span class="default">$im2</span><span class="keyword">;<br>}<br><br>function </span><span class="default">rotate_left90</span><span class="keyword">(</span><span class="default">$im</span><span class="keyword">)<br>{<br> </span><span class="default">$wid </span><span class="keyword">= </span><span class="default">imagesx</span><span class="keyword">(</span><span class="default">$im</span><span class="keyword">);<br> </span><span class="default">$hei </span><span class="keyword">= </span><span class="default">imagesy</span><span class="keyword">(</span><span class="default">$im</span><span class="keyword">);<br> </span><span class="default">$im2 </span><span class="keyword">= </span><span class="default">imagecreatetruecolor</span><span class="keyword">(</span><span class="default">$hei</span><span class="keyword">,</span><span class="default">$wid</span><span class="keyword">);<br><br> for(</span><span class="default">$i </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">;</span><span class="default">$i </span><span class="keyword">&lt; </span><span class="default">$wid</span><span class="keyword">; </span><span class="default">$i</span><span class="keyword">++)<br> {<br>&nbsp; for(</span><span class="default">$j </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">;</span><span class="default">$j </span><span class="keyword">&lt; </span><span class="default">$hei</span><span class="keyword">; </span><span class="default">$j</span><span class="keyword">++)<br>&nbsp; {<br>&nbsp;&nbsp; </span><span class="default">$ref </span><span class="keyword">= </span><span class="default">imagecolorat</span><span class="keyword">(</span><span class="default">$im</span><span class="keyword">,</span><span class="default">$i</span><span class="keyword">,</span><span class="default">$j</span><span class="keyword">);<br>&nbsp;&nbsp; </span><span class="default">imagesetpixel</span><span class="keyword">(</span><span class="default">$im2</span><span class="keyword">,</span><span class="default">$j</span><span class="keyword">, </span><span class="default">$wid </span><span class="keyword">- </span><span class="default">$i</span><span class="keyword">,</span><span class="default">$ref</span><span class="keyword">);<br>&nbsp; }<br> }<br> return </span><span class="default">$im2</span><span class="keyword">;<br>}<br><br>function </span><span class="default">mirror</span><span class="keyword">(</span><span class="default">$im</span><span class="keyword">)<br>{<br> </span><span class="default">$wid </span><span class="keyword">= </span><span class="default">imagesx</span><span class="keyword">(</span><span class="default">$im</span><span class="keyword">);<br> </span><span class="default">$hei </span><span class="keyword">= </span><span class="default">imagesy</span><span class="keyword">(</span><span class="default">$im</span><span class="keyword">);<br> </span><span class="default">$im2 </span><span class="keyword">= </span><span class="default">imagecreatetruecolor</span><span class="keyword">(</span><span class="default">$wid</span><span class="keyword">,</span><span class="default">$hei</span><span class="keyword">);<br><br> for(</span><span class="default">$i </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">;</span><span class="default">$i </span><span class="keyword">&lt; </span><span class="default">$wid</span><span class="keyword">; </span><span class="default">$i</span><span class="keyword">++)<br> {<br>&nbsp; for(</span><span class="default">$j </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">;</span><span class="default">$j </span><span class="keyword">&lt; </span><span class="default">$hei</span><span class="keyword">; </span><span class="default">$j</span><span class="keyword">++)<br>&nbsp; {<br>&nbsp;&nbsp; </span><span class="default">$ref </span><span class="keyword">= </span><span class="default">imagecolorat</span><span class="keyword">(</span><span class="default">$im</span><span class="keyword">,</span><span class="default">$i</span><span class="keyword">,</span><span class="default">$j</span><span class="keyword">);<br>&nbsp;&nbsp; </span><span class="default">imagesetpixel</span><span class="keyword">(</span><span class="default">$im2</span><span class="keyword">,</span><span class="default">$wid </span><span class="keyword">- </span><span class="default">$i</span><span class="keyword">,</span><span class="default">$j</span><span class="keyword">,</span><span class="default">$ref</span><span class="keyword">);<br>&nbsp; }<br> }<br> return </span><span class="default">$im2</span><span class="keyword">;<br>}<br><br>function </span><span class="default">flip</span><span class="keyword">(</span><span class="default">$im</span><span class="keyword">)<br>{<br> </span><span class="default">$wid </span><span class="keyword">= </span><span class="default">imagesx</span><span class="keyword">(</span><span class="default">$im</span><span class="keyword">);<br> </span><span class="default">$hei </span><span class="keyword">= </span><span class="default">imagesy</span><span class="keyword">(</span><span class="default">$im</span><span class="keyword">);<br> </span><span class="default">$im2 </span><span class="keyword">= </span><span class="default">imagecreatetruecolor</span><span class="keyword">(</span><span class="default">$wid</span><span class="keyword">,</span><span class="default">$hei</span><span class="keyword">);<br><br> for(</span><span class="default">$i </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">;</span><span class="default">$i </span><span class="keyword">&lt; </span><span class="default">$wid</span><span class="keyword">; </span><span class="default">$i</span><span class="keyword">++)<br> {<br>&nbsp; for(</span><span class="default">$j </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">;</span><span class="default">$j </span><span class="keyword">&lt; </span><span class="default">$hei</span><span class="keyword">; </span><span class="default">$j</span><span class="keyword">++)<br>&nbsp; {<br>&nbsp;&nbsp; </span><span class="default">$ref </span><span class="keyword">= </span><span class="default">imagecolorat</span><span class="keyword">(</span><span class="default">$im</span><span class="keyword">,</span><span class="default">$i</span><span class="keyword">,</span><span class="default">$j</span><span class="keyword">);<br>&nbsp;&nbsp; </span><span class="default">imagesetpixel</span><span class="keyword">(</span><span class="default">$im2</span><span class="keyword">,</span><span class="default">$i</span><span class="keyword">,</span><span class="default">$hei </span><span class="keyword">- </span><span class="default">$j</span><span class="keyword">,</span><span class="default">$ref</span><span class="keyword">);<br>&nbsp; }<br> }<br> return </span><span class="default">$im2</span><span class="keyword">;<br>}<br></span><span class="default">?&gt;</span>
</span>
</code></div>
  </div>
 </div>
  <div class="note" id="87363">  
  <a class="name">
  <strong class="user"><em>joseluis at pellicer dot org</em></strong></a><div class="date" title="2008-12-01 08:14"><strong>5 years ago</strong></div>
  <div class="text" id="Hcom87363">
<div class="phpcode"><code><span class="html">
About that rotating function by david at horizon-nigh not working, I found the bug.<br>I noticed that the x1 and y1 where not used, so, in the loop through every pixel and transform it, change<br><br>$x2 = $x * cos($theta) - $y * sin($theta);<br>$y2 = $x * sin($theta) + $y * cos($theta);<br><br>to:<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <br>$x2 = $x1 * cos($theta) - $y1 * sin($theta);<br>$y2 = $x1 * sin($theta) + $y1 * cos($theta);</span>
</code></div>
  </div>
 </div>
  <div class="note" id="86986">  
  <a class="name">
  <strong class="user"><em>fernando_empresarial at ig dot com dot br</em></strong></a><div class="date" title="2008-11-13 04:52"><strong>5 years ago</strong></div>
  <div class="text" id="Hcom86986">
<div class="phpcode"><code><span class="html">
<span class="default">&lt;?php
<br>$urlImage </span><span class="keyword">= </span><span class="string">"images/image.png"</span><span class="keyword">;
<br></span><span class="default">$urlNewImage </span><span class="keyword">= </span><span class="string">"images/imageNew.png"</span><span class="keyword">;
<br>&nbsp; &nbsp; 
<br></span><span class="default">$src_img </span><span class="keyword">= </span><span class="default">imagecreatefrompng</span><span class="keyword">(</span><span class="default">$urlImage</span><span class="keyword">);
<br></span><span class="default">$originalX </span><span class="keyword">= </span><span class="default">imagesx</span><span class="keyword">(</span><span class="default">$src_img</span><span class="keyword">);
<br></span><span class="default">$originalY </span><span class="keyword">= </span><span class="default">imagesy</span><span class="keyword">(</span><span class="default">$src_img</span><span class="keyword">);
<br></span><span class="default">$dst_img </span><span class="keyword">= </span><span class="default">imagecreatetruecolor</span><span class="keyword">(</span><span class="default">640</span><span class="keyword">,</span><span class="default">480</span><span class="keyword">);
<br>
<br>&nbsp; &nbsp; 
<br></span><span class="default">$imageRotate </span><span class="keyword">= </span><span class="default">imagerotate</span><span class="keyword">(</span><span class="default">$src_img</span><span class="keyword">,</span><span class="default">20</span><span class="keyword">,-</span><span class="default">1</span><span class="keyword">);
<br>&nbsp; &nbsp; &nbsp; &nbsp; 
<br></span><span class="default">imagepng</span><span class="keyword">(</span><span class="default">$imageRotate</span><span class="keyword">,</span><span class="default">$urlNewImage</span><span class="keyword">);
<br></span><span class="default">imagedestroy</span><span class="keyword">(</span><span class="default">$dst_img</span><span class="keyword">); 
<br></span><span class="default">imagedestroy</span><span class="keyword">(</span><span class="default">$src_img</span><span class="keyword">);
<br></span><span class="default">?&gt;</span>
</span>
</code></div>
  </div>
 </div>
  <div class="note" id="86075">  
  <a class="name">
  <strong class="user"><em>foi02 at cartefoi dot net</em></strong></a><div class="date" title="2008-10-01 07:50"><strong>5 years ago</strong></div>
  <div class="text" id="Hcom86075">
<div class="phpcode"><code><span class="html">
For those who are looking for the GD library for Ubuntu, I let a copy on my server:&nbsp; <a rel="nofollow" target="_blank">http://www.cartefoi.net/compl_compl_2.php</a><br>It was pretty hard to find, somebody gaveme his. Thanks a lot to him (message up).</span>
</code></div>
  </div>
 </div>
  <div class="note" id="85847">  
  <a class="name">
  <strong class="user"><em>Bert Vandeghinste</em></strong></a><div class="date" title="2008-09-20 07:17"><strong>5 years ago</strong></div>
  <div class="text" id="Hcom85847">
<div class="phpcode"><code><span class="html">
I'm now using david's code with these changes to get a transparent effect.
<br>
<br>I exec convert 2 times:
<br>
<br><span class="default">&lt;?php
<br>exec</span><span class="keyword">( </span><span class="default">$imagick </span><span class="keyword">. </span><span class="string">' -background \'#555555\' -rotate ' </span><span class="keyword">. </span><span class="default">$angle </span><span class="keyword">. </span><span class="string">' ' </span><span class="keyword">. </span><span class="default">$file1 </span><span class="keyword">. </span><span class="string">' ' </span><span class="keyword">. </span><span class="default">$file2 </span><span class="keyword">);
<br></span><span class="default">exec</span><span class="keyword">( </span><span class="default">$imagick </span><span class="keyword">. </span><span class="string">' -transparent \'#555555\' -transparent-color \'#555555\' ' </span><span class="keyword">. </span><span class="default">$file2 </span><span class="keyword">. </span><span class="string">' ' </span><span class="keyword">. </span><span class="default">$file3 </span><span class="keyword">);
<br></span><span class="default">?&gt;
<br></span>
<br>and then use this after I rotated $output:
<br><span class="default">&lt;?php imagecolortransparent</span><span class="keyword">(</span><span class="default">$output</span><span class="keyword">, </span><span class="default">imagecolorallocatealpha</span><span class="keyword">(</span><span class="default">$output</span><span class="keyword">, </span><span class="default">85</span><span class="keyword">, </span><span class="default">85</span><span class="keyword">, </span><span class="default">85</span><span class="keyword">, </span><span class="default">127</span><span class="keyword">)); </span><span class="default">?&gt;</span>
</span>
</code></div>
  </div>
 </div>
  <div class="note" id="85700">  
  <a class="name">
  <strong class="user"><em>david at horizon-nigh dot org</em></strong></a><div class="date" title="2008-09-12 09:06"><strong>5 years ago</strong></div>
  <div class="text" id="Hcom85700">
<div class="phpcode"><code><span class="html">
I couldn't get the replacements from 'the dot thawk' or 'pilot' to work for some reason, so here's my own replacement. It uses ImageMagick; binary must be installed, and you may need to modify the search path. (I didn't use PHP's ImageMagick support for my own reasons.)<br><br><span class="default">&lt;?php<br>&nbsp; &nbsp; </span><span class="comment">/**<br>&nbsp; &nbsp;&nbsp; * imagerotate()<br>&nbsp; &nbsp;&nbsp; * Debian php5-gd packages do not include imagerotate() due to some convoluted reason.<br>&nbsp; &nbsp;&nbsp; *<br>&nbsp; &nbsp;&nbsp; * @param int $angle - same as PHP builtin function<br>&nbsp; &nbsp;&nbsp; * @param $bgd_color - not implemented, apparently always #FFFFFF<br>&nbsp; &nbsp;&nbsp; *<br>&nbsp; &nbsp;&nbsp; * @return same as PHP builtin function<br>&nbsp; &nbsp;&nbsp; */<br>&nbsp; &nbsp; </span><span class="keyword">if ( !</span><span class="default">function_exists</span><span class="keyword">( </span><span class="string">'imagerotate' </span><span class="keyword">) ) {<br><br>&nbsp; &nbsp; &nbsp; &nbsp; function </span><span class="default">imagerotate</span><span class="keyword">( </span><span class="default">$source_image</span><span class="keyword">, </span><span class="default">$angle</span><span class="keyword">, </span><span class="default">$bgd_color </span><span class="keyword">) {<br><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$angle </span><span class="keyword">= </span><span class="default">360</span><span class="keyword">-</span><span class="default">$angle</span><span class="keyword">; </span><span class="comment">// GD rotates CCW, imagick rotates CW<br><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="keyword">foreach ( array( </span><span class="string">'/usr/bin'</span><span class="keyword">, </span><span class="string">'/usr/local/bin'</span><span class="keyword">, </span><span class="string">'/opt/local/bin'</span><span class="keyword">, </span><span class="string">'/sw/bin' </span><span class="keyword">) as </span><span class="default">$path </span><span class="keyword">) {<br><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if ( </span><span class="default">file_exists</span><span class="keyword">( </span><span class="default">$path </span><span class="keyword">. </span><span class="string">'/convert' </span><span class="keyword">) ) {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$imagick </span><span class="keyword">= </span><span class="default">$path </span><span class="keyword">. </span><span class="string">'/convert'</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if ( </span><span class="default">$path </span><span class="keyword">== </span><span class="string">'/opt/local/bin' </span><span class="keyword">) {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$imagick </span><span class="keyword">= </span><span class="string">'DYLD_LIBRARY_PATH="" ' </span><span class="keyword">. </span><span class="default">$imagick</span><span class="keyword">; </span><span class="comment">// some kind of conflict with MacPorts and MAMP<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="keyword">}<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; break;<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if ( !isset( </span><span class="default">$imagick </span><span class="keyword">) ) {<br><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="comment">//trigger_error( 'imagerotate(): could not find imagemagick binary, original image returned', E_USER_WARNING );<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="keyword">return </span><span class="default">$source_image</span><span class="keyword">;<br><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$file1 </span><span class="keyword">= </span><span class="string">'/tmp/imagick_' </span><span class="keyword">. </span><span class="default">rand</span><span class="keyword">( </span><span class="default">10000</span><span class="keyword">,</span><span class="default">99999 </span><span class="keyword">) . </span><span class="string">'.png'</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$file2 </span><span class="keyword">= </span><span class="string">'/tmp/imagick_' </span><span class="keyword">. </span><span class="default">rand</span><span class="keyword">( </span><span class="default">10000</span><span class="keyword">,</span><span class="default">99999 </span><span class="keyword">) . </span><span class="string">'.png'</span><span class="keyword">;<br><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if ( @</span><span class="default">imagepng</span><span class="keyword">( </span><span class="default">$source_image</span><span class="keyword">, </span><span class="default">$file1 </span><span class="keyword">) ) {<br><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">exec</span><span class="keyword">( </span><span class="default">$imagick </span><span class="keyword">. </span><span class="string">' -rotate ' </span><span class="keyword">. </span><span class="default">$angle </span><span class="keyword">. </span><span class="string">' ' </span><span class="keyword">. </span><span class="default">$file1 </span><span class="keyword">. </span><span class="string">' ' </span><span class="keyword">. </span><span class="default">$file2 </span><span class="keyword">);<br><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if ( </span><span class="default">file_exists</span><span class="keyword">( </span><span class="default">$file2 </span><span class="keyword">) ) {<br><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$new_image </span><span class="keyword">= </span><span class="default">imagecreatefrompng</span><span class="keyword">( </span><span class="default">$file2 </span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">unlink</span><span class="keyword">( </span><span class="default">$file1 </span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">unlink</span><span class="keyword">( </span><span class="default">$file2 </span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; return </span><span class="default">$new_image</span><span class="keyword">;<br><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; } else {<br><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="comment">//trigger_error( 'imagerotate(): imagemagick conversion failed, original image returned', E_USER_WARNING );<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="keyword">return </span><span class="default">$source_image</span><span class="keyword">;<br><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; } else {<br><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="comment">//trigger_error( 'imagerotate(): could not write to ' . $file1 . ', original image returned', E_USER_WARNING );<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="keyword">return </span><span class="default">$source_image</span><span class="keyword">;<br><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br><br>&nbsp; &nbsp; &nbsp; &nbsp; }<br><br>&nbsp; &nbsp; }<br></span><span class="default">?&gt;</span>
</span>
</code></div>
  </div>
 </div>
  <div class="note" id="85329">  
  <a class="name">
  <strong class="user"><em>AJenbo</em></strong></a><div class="date" title="2008-08-26 01:45"><strong>6 years ago</strong></div>
  <div class="text" id="Hcom85329">
<div class="phpcode"><code><span class="html">
I modified cbl25's function to allow it to rotate an image either clock wise or counter clock wise.<br><br><span class="default">&lt;?php<br></span><span class="keyword">function </span><span class="default">rotateImage</span><span class="keyword">(</span><span class="default">$image</span><span class="keyword">, </span><span class="default">$direction</span><span class="keyword">) {<br>&nbsp; &nbsp; </span><span class="default">$direction </span><span class="keyword">= </span><span class="default">strtolower</span><span class="keyword">(</span><span class="default">$direction</span><span class="keyword">);<br>&nbsp; &nbsp; </span><span class="default">$degrees </span><span class="keyword">= </span><span class="default">$direction </span><span class="keyword">== </span><span class="string">'cw' </span><span class="keyword">? </span><span class="default">270 </span><span class="keyword">: (</span><span class="default">$direction </span><span class="keyword">== </span><span class="string">'ccw' </span><span class="keyword">? </span><span class="default">90 </span><span class="keyword">: </span><span class="default">NULL</span><span class="keyword">); <br>&nbsp; &nbsp; if(!</span><span class="default">$degrees</span><span class="keyword">)<br>&nbsp; &nbsp; &nbsp; &nbsp; return </span><span class="default">$image</span><span class="keyword">;<br>&nbsp; &nbsp; </span><span class="default">$width </span><span class="keyword">= </span><span class="default">imagesx</span><span class="keyword">(</span><span class="default">$image</span><span class="keyword">);<br>&nbsp; &nbsp; </span><span class="default">$height </span><span class="keyword">= </span><span class="default">imagesy</span><span class="keyword">(</span><span class="default">$image</span><span class="keyword">);<br>&nbsp; &nbsp; </span><span class="default">$side </span><span class="keyword">= </span><span class="default">$width </span><span class="keyword">&gt; </span><span class="default">$height </span><span class="keyword">? </span><span class="default">$width </span><span class="keyword">: </span><span class="default">$height</span><span class="keyword">;<br>&nbsp; &nbsp; </span><span class="default">$imageSquare </span><span class="keyword">= </span><span class="default">imagecreatetruecolor</span><span class="keyword">(</span><span class="default">$side</span><span class="keyword">, </span><span class="default">$side</span><span class="keyword">);<br>&nbsp; &nbsp; </span><span class="default">imagecopy</span><span class="keyword">(</span><span class="default">$imageSquare</span><span class="keyword">, </span><span class="default">$image</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">$width</span><span class="keyword">, </span><span class="default">$height</span><span class="keyword">);<br>&nbsp; &nbsp; </span><span class="default">imagedestroy</span><span class="keyword">(</span><span class="default">$image</span><span class="keyword">);<br>&nbsp; &nbsp; </span><span class="default">$imageSquare </span><span class="keyword">= </span><span class="default">imagerotate</span><span class="keyword">(</span><span class="default">$imageSquare</span><span class="keyword">, </span><span class="default">$degrees</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, -</span><span class="default">1</span><span class="keyword">);<br>&nbsp; &nbsp; </span><span class="default">$image </span><span class="keyword">= </span><span class="default">imagecreatetruecolor</span><span class="keyword">(</span><span class="default">$height</span><span class="keyword">, </span><span class="default">$width</span><span class="keyword">);<br>&nbsp; &nbsp; </span><span class="default">$x </span><span class="keyword">= </span><span class="default">$degrees </span><span class="keyword">== </span><span class="default">90 </span><span class="keyword">? </span><span class="default">0 </span><span class="keyword">: (</span><span class="default">$height </span><span class="keyword">&gt; </span><span class="default">$width </span><span class="keyword">? </span><span class="default">0 </span><span class="keyword">: (</span><span class="default">$side </span><span class="keyword">- </span><span class="default">$height</span><span class="keyword">));<br>&nbsp; &nbsp; </span><span class="default">$y </span><span class="keyword">= </span><span class="default">$degrees </span><span class="keyword">== </span><span class="default">270 </span><span class="keyword">? </span><span class="default">0 </span><span class="keyword">: (</span><span class="default">$height </span><span class="keyword">&lt; </span><span class="default">$width </span><span class="keyword">? </span><span class="default">0 </span><span class="keyword">: (</span><span class="default">$side </span><span class="keyword">- </span><span class="default">$width</span><span class="keyword">));<br>&nbsp; &nbsp; </span><span class="default">imagecopy</span><span class="keyword">(</span><span class="default">$image</span><span class="keyword">, </span><span class="default">$imageSquare</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">$x</span><span class="keyword">, </span><span class="default">$y</span><span class="keyword">, </span><span class="default">$height</span><span class="keyword">, </span><span class="default">$width</span><span class="keyword">);<br>&nbsp; &nbsp; </span><span class="default">imagedestroy</span><span class="keyword">(</span><span class="default">$imageSquare</span><span class="keyword">);<br>&nbsp; &nbsp; return </span><span class="default">$image</span><span class="keyword">;<br>}<br><br></span><span class="comment">//Usage<br></span><span class="default">$image </span><span class="keyword">= </span><span class="default">rotateImage</span><span class="keyword">(</span><span class="default">$image</span><span class="keyword">, </span><span class="string">'cw'</span><span class="keyword">);<br></span><span class="default">$image </span><span class="keyword">= </span><span class="default">rotateImage</span><span class="keyword">(</span><span class="default">$image</span><span class="keyword">, </span><span class="string">'ccw'</span><span class="keyword">);<br></span><span class="default">?&gt;</span>
</span>
</code></div>
  </div>
 </div>
  <div class="note" id="85187">  
  <a class="name">
  <strong class="user"><em>cbl25</em></strong></a><div class="date" title="2008-08-19 07:29"><strong>6 years ago</strong></div>
  <div class="text" id="Hcom85187">
<div class="phpcode"><code><span class="html">
Here is a simple function to rotate a non-square image 90 degrees clockwise.
<br>
<br><span class="default">&lt;?php
<br></span><span class="keyword">function </span><span class="default">rotateImage</span><span class="keyword">(</span><span class="default">$imageResource</span><span class="keyword">)
<br>{
<br>&nbsp; &nbsp; </span><span class="default">$width </span><span class="keyword">= </span><span class="default">imagesx</span><span class="keyword">(</span><span class="default">$imageResource</span><span class="keyword">);
<br>&nbsp; &nbsp; </span><span class="default">$height </span><span class="keyword">= </span><span class="default">imagesy</span><span class="keyword">(</span><span class="default">$imageResource</span><span class="keyword">);
<br>&nbsp; &nbsp; </span><span class="default">$side </span><span class="keyword">= </span><span class="default">$width </span><span class="keyword">&gt; </span><span class="default">$height </span><span class="keyword">? </span><span class="default">$width </span><span class="keyword">: </span><span class="default">$height</span><span class="keyword">;
<br>&nbsp; &nbsp; </span><span class="default">$squareImage </span><span class="keyword">= </span><span class="default">imagecreatetruecolor</span><span class="keyword">(</span><span class="default">$side</span><span class="keyword">, </span><span class="default">$side</span><span class="keyword">);
<br>&nbsp; &nbsp; </span><span class="default">imagecopy</span><span class="keyword">(</span><span class="default">$squareImage</span><span class="keyword">,</span><span class="default">$imageResource</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">,</span><span class="default">$width</span><span class="keyword">,</span><span class="default">$height</span><span class="keyword">);
<br>&nbsp; &nbsp; </span><span class="default">$squareImage </span><span class="keyword">= </span><span class="default">imagerotate</span><span class="keyword">(</span><span class="default">$squareImage</span><span class="keyword">,</span><span class="default">270</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">,-</span><span class="default">1</span><span class="keyword">);
<br>&nbsp; &nbsp; </span><span class="default">$imageResource </span><span class="keyword">= </span><span class="default">imagecreatetruecolor</span><span class="keyword">(</span><span class="default">$height</span><span class="keyword">, </span><span class="default">$width</span><span class="keyword">);
<br>&nbsp; &nbsp; </span><span class="default">$x </span><span class="keyword">= </span><span class="default">$height </span><span class="keyword">&gt; </span><span class="default">$width </span><span class="keyword">? </span><span class="default">0 </span><span class="keyword">: </span><span class="default">$side </span><span class="keyword">- </span><span class="default">$height</span><span class="keyword">;
<br>&nbsp; &nbsp; </span><span class="default">imagecopy</span><span class="keyword">(</span><span class="default">$imageResource</span><span class="keyword">,</span><span class="default">$squareImage</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">,</span><span class="default">$x</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">,</span><span class="default">$height</span><span class="keyword">,</span><span class="default">$width</span><span class="keyword">);
<br>&nbsp; &nbsp; return </span><span class="default">$imageResource</span><span class="keyword">;
<br>}
<br></span><span class="default">?&gt;</span>
</span>
</code></div>
  </div>
 </div>
  <div class="note" id="84490">  
  <a class="name">
  <strong class="user"><em>the dot thawk+phpnet at gmail dot com</em></strong></a><div class="date" title="2008-07-16 08:44"><strong>6 years ago</strong></div>
  <div class="text" id="Hcom84490">
<div class="phpcode"><code><span class="html">
In response to pilot at myupb dot com on 31-May-2008 02:23<br>---<br><br>I am not sure why you would be defining your own PI, instead of using the built-in constant, and why you do the degrees to radian conversion manually. There might be a speed issue, however here is the exact same code with that small difference.<br><br><span class="default">&lt;?php<br></span><span class="keyword">if(!</span><span class="default">function_exists</span><span class="keyword">(</span><span class="string">"imagerotate"</span><span class="keyword">)) {<br>&nbsp; &nbsp; function </span><span class="default">imagerotate</span><span class="keyword">(&amp;</span><span class="default">$srcImg</span><span class="keyword">, </span><span class="default">$angle</span><span class="keyword">, </span><span class="default">$transparentColor </span><span class="keyword">= </span><span class="default">null</span><span class="keyword">) {<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$srcw </span><span class="keyword">= </span><span class="default">imagesx</span><span class="keyword">(</span><span class="default">$srcImg</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$srch </span><span class="keyword">= </span><span class="default">imagesy</span><span class="keyword">(</span><span class="default">$srcImg</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp;&nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; if(</span><span class="default">$angle </span><span class="keyword">== </span><span class="default">0</span><span class="keyword">) return </span><span class="default">$srcImg</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp;&nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="comment">// Convert the angle to radians<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$theta </span><span class="keyword">= </span><span class="default">deg2rad </span><span class="keyword">(</span><span class="default">$angle</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp;&nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="comment">// Get the origin (center) of the image<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$originx </span><span class="keyword">= </span><span class="default">$srcw </span><span class="keyword">/ </span><span class="default">2</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$originy </span><span class="keyword">= </span><span class="default">$srch </span><span class="keyword">/ </span><span class="default">2</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp;&nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="comment">// The pixels array for the new image<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$pixels </span><span class="keyword">= array();<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$minx </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$maxx </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$miny </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$maxy </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$dstw </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$dsth </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp;&nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="comment">// Loop through every pixel and transform it<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="keyword">for(</span><span class="default">$x</span><span class="keyword">=</span><span class="default">0</span><span class="keyword">;</span><span class="default">$x</span><span class="keyword">&lt;</span><span class="default">$srcw</span><span class="keyword">;</span><span class="default">$x</span><span class="keyword">++) {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; for(</span><span class="default">$y</span><span class="keyword">=</span><span class="default">0</span><span class="keyword">;</span><span class="default">$y</span><span class="keyword">&lt;</span><span class="default">$srch</span><span class="keyword">;</span><span class="default">$y</span><span class="keyword">++) {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; list(</span><span class="default">$x1</span><span class="keyword">, </span><span class="default">$y1</span><span class="keyword">) = </span><span class="default">translateCoordinate</span><span class="keyword">(</span><span class="default">$originx</span><span class="keyword">, </span><span class="default">$originy</span><span class="keyword">, </span><span class="default">$x</span><span class="keyword">, </span><span class="default">$y</span><span class="keyword">, </span><span class="default">false</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$x2 </span><span class="keyword">= </span><span class="default">$x </span><span class="keyword">* </span><span class="default">cos</span><span class="keyword">(</span><span class="default">$theta</span><span class="keyword">) - </span><span class="default">$y </span><span class="keyword">* </span><span class="default">sin</span><span class="keyword">(</span><span class="default">$theta</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$y2 </span><span class="keyword">= </span><span class="default">$x </span><span class="keyword">* </span><span class="default">sin</span><span class="keyword">(</span><span class="default">$theta</span><span class="keyword">) + </span><span class="default">$y </span><span class="keyword">* </span><span class="default">cos</span><span class="keyword">(</span><span class="default">$theta</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="comment">// Store the pixel color<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$pixels</span><span class="keyword">[] = array(</span><span class="default">$x2</span><span class="keyword">, </span><span class="default">$y2</span><span class="keyword">, </span><span class="default">imagecolorat</span><span class="keyword">(</span><span class="default">$srcImg</span><span class="keyword">, </span><span class="default">$x</span><span class="keyword">, </span><span class="default">$y</span><span class="keyword">));<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="comment">// Check our boundaries<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="keyword">if(</span><span class="default">$x2 </span><span class="keyword">&gt; </span><span class="default">$maxx</span><span class="keyword">) </span><span class="default">$maxx </span><span class="keyword">= </span><span class="default">$x2</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if(</span><span class="default">$x2 </span><span class="keyword">&lt; </span><span class="default">$minx</span><span class="keyword">) </span><span class="default">$minx </span><span class="keyword">= </span><span class="default">$x2</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if(</span><span class="default">$y2 </span><span class="keyword">&gt; </span><span class="default">$maxy</span><span class="keyword">) </span><span class="default">$maxy </span><span class="keyword">= </span><span class="default">$y2</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if(</span><span class="default">$y2 </span><span class="keyword">&lt; </span><span class="default">$miny</span><span class="keyword">) </span><span class="default">$miny </span><span class="keyword">= </span><span class="default">$y2</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br>&nbsp; &nbsp; &nbsp; &nbsp; }<br>&nbsp; &nbsp; &nbsp;&nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="comment">// Determine the new image size<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$dstw </span><span class="keyword">= </span><span class="default">$maxx </span><span class="keyword">- </span><span class="default">$minx </span><span class="keyword">+ </span><span class="default">1</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$dsth </span><span class="keyword">= </span><span class="default">$maxy </span><span class="keyword">- </span><span class="default">$miny </span><span class="keyword">+ </span><span class="default">1</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp;&nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="comment">// Create our new image<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$dstImg </span><span class="keyword">= </span><span class="default">imagecreatetruecolor</span><span class="keyword">(</span><span class="default">$dstw</span><span class="keyword">, </span><span class="default">$dsth</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp;&nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="comment">// Fill the background with our transparent color<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="keyword">if(</span><span class="default">$transparentColor </span><span class="keyword">== </span><span class="default">null</span><span class="keyword">) </span><span class="default">$transparentColor </span><span class="keyword">= </span><span class="default">imagecolorallocate</span><span class="keyword">(</span><span class="default">$dstImg</span><span class="keyword">, </span><span class="default">1</span><span class="keyword">, </span><span class="default">2</span><span class="keyword">, </span><span class="default">3</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">imagecolortransparent</span><span class="keyword">(</span><span class="default">$dstImg</span><span class="keyword">, </span><span class="default">$transparentColor</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">imagefilledrectangle</span><span class="keyword">(</span><span class="default">$dstImg</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">$dstw </span><span class="keyword">+ </span><span class="default">1</span><span class="keyword">, </span><span class="default">$dsth </span><span class="keyword">+ </span><span class="default">1</span><span class="keyword">, </span><span class="default">$transparentColor</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp;&nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="comment">// Get the new origin<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$neworiginx </span><span class="keyword">= -</span><span class="default">$minx</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$neworiginy </span><span class="keyword">= -</span><span class="default">$miny</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp;&nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="comment">// Fill in the pixels<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="keyword">foreach(</span><span class="default">$pixels </span><span class="keyword">as </span><span class="default">$data</span><span class="keyword">) {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; list(</span><span class="default">$x</span><span class="keyword">, </span><span class="default">$y</span><span class="keyword">, </span><span class="default">$color</span><span class="keyword">) = </span><span class="default">$data</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; list(</span><span class="default">$newx</span><span class="keyword">, </span><span class="default">$newy</span><span class="keyword">) = </span><span class="default">translateCoordinate</span><span class="keyword">(</span><span class="default">$neworiginx</span><span class="keyword">, </span><span class="default">$neworiginy</span><span class="keyword">, </span><span class="default">$x</span><span class="keyword">, </span><span class="default">$y</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">imagesetpixel</span><span class="keyword">(</span><span class="default">$dstImg</span><span class="keyword">, </span><span class="default">$newx</span><span class="keyword">, </span><span class="default">$newy</span><span class="keyword">, </span><span class="default">$color</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; }<br>&nbsp; &nbsp; &nbsp;&nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; return </span><span class="default">$dstImg</span><span class="keyword">;<br>&nbsp; &nbsp; }<br>&nbsp;&nbsp; <br>&nbsp; &nbsp; </span><span class="comment">/**<br>&nbsp; &nbsp;&nbsp; * Translates from mathematical coordinate system to computer coordinate system using<br>&nbsp; &nbsp;&nbsp; * origin coordinates from the computer system or visa versa<br>&nbsp; &nbsp;&nbsp; *<br>&nbsp; &nbsp;&nbsp; * @param int $originx<br>&nbsp; &nbsp;&nbsp; * @param int $originy<br>&nbsp; &nbsp;&nbsp; * @param int $x<br>&nbsp; &nbsp;&nbsp; * @param int $y<br>&nbsp; &nbsp;&nbsp; * @param bool $toComp<br>&nbsp; &nbsp;&nbsp; * @return array(int $x, int $y)<br>&nbsp; &nbsp;&nbsp; */<br>&nbsp; &nbsp; </span><span class="keyword">function </span><span class="default">translateCoordinate</span><span class="keyword">(</span><span class="default">$originx</span><span class="keyword">, </span><span class="default">$originy</span><span class="keyword">, </span><span class="default">$x</span><span class="keyword">, </span><span class="default">$y</span><span class="keyword">, </span><span class="default">$toComp</span><span class="keyword">=</span><span class="default">true</span><span class="keyword">) {<br>&nbsp; &nbsp; &nbsp; &nbsp; if(</span><span class="default">$toComp</span><span class="keyword">) {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$newx </span><span class="keyword">= </span><span class="default">$originx </span><span class="keyword">+ </span><span class="default">$x</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$newy </span><span class="keyword">= </span><span class="default">$originy </span><span class="keyword">- </span><span class="default">$y</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; } else {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$newx </span><span class="keyword">= </span><span class="default">$x </span><span class="keyword">- </span><span class="default">$originx</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$newy </span><span class="keyword">= </span><span class="default">$originy </span><span class="keyword">- </span><span class="default">$y</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; }<br>&nbsp; &nbsp; &nbsp;&nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; return array(</span><span class="default">$newx</span><span class="keyword">, </span><span class="default">$newy</span><span class="keyword">);<br>&nbsp; &nbsp; }<br>}<br></span><span class="default">?&gt;</span>
</span>
</code></div>
  </div>
 </div>
  <div class="note" id="83547">  
  <a class="name">
  <strong class="user"><em>pilot at myupb dot com</em></strong></a><div class="date" title="2008-05-30 05:23"><strong>6 years ago</strong></div>
  <div class="text" id="Hcom83547">
<div class="phpcode"><code><span class="html">
Shortly after posting I was informed about a very nice algorithm for calculating the new pixel position for a rotation and thought it would be a nice improvement. Hopes this helps anyone needing a full implementation.<br><br>Note: I tested the function on a 3Mb photo and it seemed to work perfectly with no quality loss.<br><br><span class="default">&lt;?php<br></span><span class="keyword">if(!</span><span class="default">function_exists</span><span class="keyword">(</span><span class="string">"imagerotate"</span><span class="keyword">)) {<br>&nbsp; &nbsp; function </span><span class="default">imagerotate</span><span class="keyword">(&amp;</span><span class="default">$srcImg</span><span class="keyword">, </span><span class="default">$angle</span><span class="keyword">, </span><span class="default">$transparentColor </span><span class="keyword">= </span><span class="default">null</span><span class="keyword">) {<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$srcw </span><span class="keyword">= </span><span class="default">imagesx</span><span class="keyword">(</span><span class="default">$srcImg</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$srch </span><span class="keyword">= </span><span class="default">imagesy</span><span class="keyword">(</span><span class="default">$srcImg</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; if(</span><span class="default">$angle </span><span class="keyword">== </span><span class="default">0</span><span class="keyword">) return </span><span class="default">$srcImg</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="comment">// Convert the angle to radians<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$pi </span><span class="keyword">= </span><span class="default">3.141592654</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$theta </span><span class="keyword">= </span><span class="default">$angle </span><span class="keyword">* </span><span class="default">$pi </span><span class="keyword">/ </span><span class="default">180</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="comment">// Get the origin (center) of the image<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$originx </span><span class="keyword">= </span><span class="default">$srcw </span><span class="keyword">/ </span><span class="default">2</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$originy </span><span class="keyword">= </span><span class="default">$srch </span><span class="keyword">/ </span><span class="default">2</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="comment">// The pixels array for the new image<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$pixels </span><span class="keyword">= array();<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$minx </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$maxx </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$miny </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$maxy </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$dstw </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$dsth </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="comment">// Loop through every pixel and transform it<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="keyword">for(</span><span class="default">$x</span><span class="keyword">=</span><span class="default">0</span><span class="keyword">;</span><span class="default">$x</span><span class="keyword">&lt;</span><span class="default">$srcw</span><span class="keyword">;</span><span class="default">$x</span><span class="keyword">++) {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; for(</span><span class="default">$y</span><span class="keyword">=</span><span class="default">0</span><span class="keyword">;</span><span class="default">$y</span><span class="keyword">&lt;</span><span class="default">$srch</span><span class="keyword">;</span><span class="default">$y</span><span class="keyword">++) {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; list(</span><span class="default">$x1</span><span class="keyword">, </span><span class="default">$y1</span><span class="keyword">) = </span><span class="default">translateCoordinate</span><span class="keyword">(</span><span class="default">$originx</span><span class="keyword">, </span><span class="default">$originy</span><span class="keyword">, </span><span class="default">$x</span><span class="keyword">, </span><span class="default">$y</span><span class="keyword">, </span><span class="default">false</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$x2 </span><span class="keyword">= </span><span class="default">$x </span><span class="keyword">* </span><span class="default">cos</span><span class="keyword">(</span><span class="default">$theta</span><span class="keyword">) - </span><span class="default">$y </span><span class="keyword">* </span><span class="default">sin</span><span class="keyword">(</span><span class="default">$theta</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$y2 </span><span class="keyword">= </span><span class="default">$x </span><span class="keyword">* </span><span class="default">sin</span><span class="keyword">(</span><span class="default">$theta</span><span class="keyword">) + </span><span class="default">$y </span><span class="keyword">* </span><span class="default">cos</span><span class="keyword">(</span><span class="default">$theta</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="comment">// Store the pixel color<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$pixels</span><span class="keyword">[] = array(</span><span class="default">$x2</span><span class="keyword">, </span><span class="default">$y2</span><span class="keyword">, </span><span class="default">imagecolorat</span><span class="keyword">(</span><span class="default">$srcImg</span><span class="keyword">, </span><span class="default">$x</span><span class="keyword">, </span><span class="default">$y</span><span class="keyword">));<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="comment">// Check our boundaries<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="keyword">if(</span><span class="default">$x2 </span><span class="keyword">&gt; </span><span class="default">$maxx</span><span class="keyword">) </span><span class="default">$maxx </span><span class="keyword">= </span><span class="default">$x2</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if(</span><span class="default">$x2 </span><span class="keyword">&lt; </span><span class="default">$minx</span><span class="keyword">) </span><span class="default">$minx </span><span class="keyword">= </span><span class="default">$x2</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if(</span><span class="default">$y2 </span><span class="keyword">&gt; </span><span class="default">$maxy</span><span class="keyword">) </span><span class="default">$maxy </span><span class="keyword">= </span><span class="default">$y2</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if(</span><span class="default">$y2 </span><span class="keyword">&lt; </span><span class="default">$miny</span><span class="keyword">) </span><span class="default">$miny </span><span class="keyword">= </span><span class="default">$y2</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br>&nbsp; &nbsp; &nbsp; &nbsp; }<br>&nbsp; &nbsp; &nbsp; &nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="comment">// Determine the new image size<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$dstw </span><span class="keyword">= </span><span class="default">$maxx </span><span class="keyword">- </span><span class="default">$minx </span><span class="keyword">+ </span><span class="default">1</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$dsth </span><span class="keyword">= </span><span class="default">$maxy </span><span class="keyword">- </span><span class="default">$miny </span><span class="keyword">+ </span><span class="default">1</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="comment">// Create our new image<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$dstImg </span><span class="keyword">= </span><span class="default">imagecreatetruecolor</span><span class="keyword">(</span><span class="default">$dstw</span><span class="keyword">, </span><span class="default">$dsth</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="comment">// Fill the background with our transparent color<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="keyword">if(</span><span class="default">$transparentColor </span><span class="keyword">== </span><span class="default">null</span><span class="keyword">) </span><span class="default">$transparentColor </span><span class="keyword">= </span><span class="default">imagecolorallocate</span><span class="keyword">(</span><span class="default">$dstImg</span><span class="keyword">, </span><span class="default">1</span><span class="keyword">, </span><span class="default">2</span><span class="keyword">, </span><span class="default">3</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">imagecolortransparent</span><span class="keyword">(</span><span class="default">$dstImg</span><span class="keyword">, </span><span class="default">$transparentColor</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">imagefilledrectangle</span><span class="keyword">(</span><span class="default">$dstImg</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">$dstw </span><span class="keyword">+ </span><span class="default">1</span><span class="keyword">, </span><span class="default">$dsth </span><span class="keyword">+ </span><span class="default">1</span><span class="keyword">, </span><span class="default">$transparentColor</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="comment">// Get the new origin<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$neworiginx </span><span class="keyword">= -</span><span class="default">$minx</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$neworiginy </span><span class="keyword">= -</span><span class="default">$miny</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="comment">// Fill in the pixels<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="keyword">foreach(</span><span class="default">$pixels </span><span class="keyword">as </span><span class="default">$data</span><span class="keyword">) {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; list(</span><span class="default">$x</span><span class="keyword">, </span><span class="default">$y</span><span class="keyword">, </span><span class="default">$color</span><span class="keyword">) = </span><span class="default">$data</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; list(</span><span class="default">$newx</span><span class="keyword">, </span><span class="default">$newy</span><span class="keyword">) = </span><span class="default">translateCoordinate</span><span class="keyword">(</span><span class="default">$neworiginx</span><span class="keyword">, </span><span class="default">$neworiginy</span><span class="keyword">, </span><span class="default">$x</span><span class="keyword">, </span><span class="default">$y</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">imagesetpixel</span><span class="keyword">(</span><span class="default">$dstImg</span><span class="keyword">, </span><span class="default">$newx</span><span class="keyword">, </span><span class="default">$newy</span><span class="keyword">, </span><span class="default">$color</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; }<br>&nbsp; &nbsp; &nbsp; &nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; return </span><span class="default">$dstImg</span><span class="keyword">;<br>&nbsp; &nbsp; }<br>&nbsp; &nbsp; <br>&nbsp; &nbsp; </span><span class="comment">/**<br>&nbsp; &nbsp;&nbsp; * Translates from mathematical coordinate system to computer coordinate system using<br>&nbsp; &nbsp;&nbsp; * origin coordinates from the computer system or visa versa<br>&nbsp; &nbsp;&nbsp; *<br>&nbsp; &nbsp;&nbsp; * @param int $originx<br>&nbsp; &nbsp;&nbsp; * @param int $originy<br>&nbsp; &nbsp;&nbsp; * @param int $x<br>&nbsp; &nbsp;&nbsp; * @param int $y<br>&nbsp; &nbsp;&nbsp; * @param bool $toComp<br>&nbsp; &nbsp;&nbsp; * @return array(int $x, int $y)<br>&nbsp; &nbsp;&nbsp; */<br>&nbsp; &nbsp; </span><span class="keyword">function </span><span class="default">translateCoordinate</span><span class="keyword">(</span><span class="default">$originx</span><span class="keyword">, </span><span class="default">$originy</span><span class="keyword">, </span><span class="default">$x</span><span class="keyword">, </span><span class="default">$y</span><span class="keyword">, </span><span class="default">$toComp</span><span class="keyword">=</span><span class="default">true</span><span class="keyword">) {<br>&nbsp; &nbsp; &nbsp; &nbsp; if(</span><span class="default">$toComp</span><span class="keyword">) {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$newx </span><span class="keyword">= </span><span class="default">$originx </span><span class="keyword">+ </span><span class="default">$x</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$newy </span><span class="keyword">= </span><span class="default">$originy </span><span class="keyword">- </span><span class="default">$y</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; } else {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$newx </span><span class="keyword">= </span><span class="default">$x </span><span class="keyword">- </span><span class="default">$originx</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$newy </span><span class="keyword">= </span><span class="default">$originy </span><span class="keyword">- </span><span class="default">$y</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; }<br>&nbsp; &nbsp; &nbsp; &nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; return array(</span><span class="default">$newx</span><span class="keyword">, </span><span class="default">$newy</span><span class="keyword">);<br>&nbsp; &nbsp; }<br>}<br></span><span class="default">?&gt;</span>
</span>
</code></div>
  </div>
 </div>
  <div class="note" id="83530">  
  <a class="name">
  <strong class="user"><em>pilot at myupb dot com</em></strong></a><div class="date" title="2008-05-30 07:33"><strong>6 years ago</strong></div>
  <div class="text" id="Hcom83530">
<div class="phpcode"><code><span class="html">
Thanks to the people who contributed the code for the 90 180 and 270 rotations. I needed a full implementation however so I wrote one. By no mean do I think this is the best way of doing it, I just whipped this together for myself. Seems to work good for me.
<br>
<br>Note: I didn't want the image to be shrunk when rotating so this implementation will keep the size of the original image but just rotate it.
<br>
<br><span class="default">&lt;?php
<br></span><span class="keyword">if(!</span><span class="default">function_exists</span><span class="keyword">(</span><span class="string">"imagerotate"</span><span class="keyword">)) {
<br>&nbsp; &nbsp; function </span><span class="default">imagerotate</span><span class="keyword">(&amp;</span><span class="default">$srcImg</span><span class="keyword">, </span><span class="default">$angle</span><span class="keyword">, </span><span class="default">$transparentColor </span><span class="keyword">= </span><span class="default">null</span><span class="keyword">) {
<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$srcw </span><span class="keyword">= </span><span class="default">imagesx</span><span class="keyword">(</span><span class="default">$srcImg</span><span class="keyword">);
<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$srch </span><span class="keyword">= </span><span class="default">imagesy</span><span class="keyword">(</span><span class="default">$srcImg</span><span class="keyword">);
<br>&nbsp; &nbsp; &nbsp; &nbsp; 
<br>&nbsp; &nbsp; &nbsp; &nbsp; if(</span><span class="default">$angle </span><span class="keyword">== </span><span class="default">0</span><span class="keyword">) return </span><span class="default">$srcImg</span><span class="keyword">;
<br>&nbsp; &nbsp; &nbsp; &nbsp; 
<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="comment">// Convert the angle to radians
<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$pi </span><span class="keyword">= </span><span class="default">3.141592654</span><span class="keyword">;
<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$theta </span><span class="keyword">= </span><span class="default">$angle </span><span class="keyword">* </span><span class="default">$pi </span><span class="keyword">/ </span><span class="default">180</span><span class="keyword">;
<br>&nbsp; &nbsp; &nbsp; &nbsp; 
<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="comment">// Get the origin (center) of the image
<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$originx </span><span class="keyword">= </span><span class="default">$srcw </span><span class="keyword">/ </span><span class="default">2</span><span class="keyword">;
<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$originy </span><span class="keyword">= </span><span class="default">$srch </span><span class="keyword">/ </span><span class="default">2</span><span class="keyword">;
<br>&nbsp; &nbsp; &nbsp; &nbsp; 
<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="comment">// The pixels array for the new image
<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$pixels </span><span class="keyword">= array();
<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$minx </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">;
<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$maxx </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">;
<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$miny </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">;
<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$maxy </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">;
<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$dstw </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">;
<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$dsth </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">;
<br>&nbsp; &nbsp; &nbsp; &nbsp; 
<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="comment">// Loop through every pixel and transform it
<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="keyword">for(</span><span class="default">$x</span><span class="keyword">=</span><span class="default">0</span><span class="keyword">;</span><span class="default">$x</span><span class="keyword">&lt;</span><span class="default">$srcw</span><span class="keyword">;</span><span class="default">$x</span><span class="keyword">++) {
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; for(</span><span class="default">$y</span><span class="keyword">=</span><span class="default">0</span><span class="keyword">;</span><span class="default">$y</span><span class="keyword">&lt;</span><span class="default">$srch</span><span class="keyword">;</span><span class="default">$y</span><span class="keyword">++) {
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; list(</span><span class="default">$x1</span><span class="keyword">, </span><span class="default">$y1</span><span class="keyword">) = </span><span class="default">translateCoordinate</span><span class="keyword">(</span><span class="default">$originx</span><span class="keyword">, </span><span class="default">$originy</span><span class="keyword">, </span><span class="default">$x</span><span class="keyword">, </span><span class="default">$y</span><span class="keyword">, </span><span class="default">false</span><span class="keyword">);
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$theta1 </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">;
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$noTranslate </span><span class="keyword">= </span><span class="default">false</span><span class="keyword">;
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="comment">// Determine the angle of original point
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="keyword">if(</span><span class="default">$x1 </span><span class="keyword">&gt; </span><span class="default">0 </span><span class="keyword">&amp;&amp; </span><span class="default">$y1 </span><span class="keyword">&gt; </span><span class="default">0</span><span class="keyword">) {
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="comment">// Quadrant 1
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$theta1 </span><span class="keyword">= </span><span class="default">atan</span><span class="keyword">(</span><span class="default">$y1</span><span class="keyword">/</span><span class="default">$x1</span><span class="keyword">);
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; } elseif(</span><span class="default">$x1 </span><span class="keyword">&lt; </span><span class="default">0 </span><span class="keyword">&amp;&amp; </span><span class="default">$y1 </span><span class="keyword">&gt; </span><span class="default">0</span><span class="keyword">) {
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="comment">// Quadrant 2
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$theta1 </span><span class="keyword">= </span><span class="default">$pi </span><span class="keyword">- </span><span class="default">atan</span><span class="keyword">(</span><span class="default">$y1</span><span class="keyword">/</span><span class="default">abs</span><span class="keyword">(</span><span class="default">$x1</span><span class="keyword">));
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; } elseif(</span><span class="default">$x1 </span><span class="keyword">&lt; </span><span class="default">0 </span><span class="keyword">&amp;&amp; </span><span class="default">$y1 </span><span class="keyword">&lt; </span><span class="default">0</span><span class="keyword">) {
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="comment">// Quadrant 3
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$theta1 </span><span class="keyword">= </span><span class="default">$pi </span><span class="keyword">+ </span><span class="default">atan</span><span class="keyword">(</span><span class="default">$y1</span><span class="keyword">/</span><span class="default">$x1</span><span class="keyword">);
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; } elseif(</span><span class="default">$x1 </span><span class="keyword">&gt; </span><span class="default">0 </span><span class="keyword">&amp;&amp; </span><span class="default">$y1 </span><span class="keyword">&lt; </span><span class="default">0</span><span class="keyword">) {
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="comment">// Quadrant 4
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$theta1 </span><span class="keyword">= </span><span class="default">2 </span><span class="keyword">* </span><span class="default">$pi </span><span class="keyword">- </span><span class="default">atan</span><span class="keyword">(</span><span class="default">abs</span><span class="keyword">(</span><span class="default">$y1</span><span class="keyword">)/</span><span class="default">$x1</span><span class="keyword">);
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; } elseif(</span><span class="default">$x1 </span><span class="keyword">== </span><span class="default">0 </span><span class="keyword">&amp;&amp; </span><span class="default">$y1 </span><span class="keyword">&gt; </span><span class="default">0</span><span class="keyword">) {
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$theta1 </span><span class="keyword">= </span><span class="default">$pi </span><span class="keyword">/ </span><span class="default">2</span><span class="keyword">;
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; } elseif(</span><span class="default">$x1 </span><span class="keyword">== </span><span class="default">0 </span><span class="keyword">&amp;&amp; </span><span class="default">$y1 </span><span class="keyword">&lt; </span><span class="default">0</span><span class="keyword">) {
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$theta1 </span><span class="keyword">= </span><span class="default">3 </span><span class="keyword">* </span><span class="default">$pi </span><span class="keyword">/ </span><span class="default">2</span><span class="keyword">;
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; } elseif(</span><span class="default">$x1 </span><span class="keyword">&gt; </span><span class="default">0 </span><span class="keyword">&amp;&amp; </span><span class="default">$y1 </span><span class="keyword">== </span><span class="default">0</span><span class="keyword">) {
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$theta1 </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">;
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; } elseif(</span><span class="default">$x1 </span><span class="keyword">&lt; </span><span class="default">0 </span><span class="keyword">&amp;&amp; </span><span class="default">$y1 </span><span class="keyword">== </span><span class="default">0</span><span class="keyword">) {
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$theta1 </span><span class="keyword">= </span><span class="default">$pi</span><span class="keyword">;
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; } else {
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="comment">// Only case left should be $x1 == 0 &amp;&amp; $y1 == 0
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$noTranslate </span><span class="keyword">= </span><span class="default">true</span><span class="keyword">;
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="comment">// Translate the position
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="keyword">if(!</span><span class="default">$noTranslate</span><span class="keyword">) {
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="comment">// Calculate the new angle
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$theta2 </span><span class="keyword">= </span><span class="default">$theta1 </span><span class="keyword">+ </span><span class="default">$theta</span><span class="keyword">;
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="comment">// Make sure theta2 is in between 0 - 2pi
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="keyword">while(</span><span class="default">$theta2 </span><span class="keyword">&lt; </span><span class="default">0</span><span class="keyword">) </span><span class="default">$theta2 </span><span class="keyword">+= </span><span class="default">2 </span><span class="keyword">* </span><span class="default">$pi</span><span class="keyword">;
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; while(</span><span class="default">$theta2 </span><span class="keyword">&gt; (</span><span class="default">2 </span><span class="keyword">* </span><span class="default">$pi</span><span class="keyword">)) </span><span class="default">$theta2 </span><span class="keyword">-= </span><span class="default">2 </span><span class="keyword">* </span><span class="default">$pi</span><span class="keyword">;
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$radius </span><span class="keyword">= </span><span class="default">sqrt</span><span class="keyword">(</span><span class="default">$x1</span><span class="keyword">*</span><span class="default">$x1 </span><span class="keyword">+ </span><span class="default">$y1</span><span class="keyword">*</span><span class="default">$y1</span><span class="keyword">);
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$x2 </span><span class="keyword">= (</span><span class="default">$radius </span><span class="keyword">* </span><span class="default">cos</span><span class="keyword">(</span><span class="default">$theta2</span><span class="keyword">));
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$y2 </span><span class="keyword">= (</span><span class="default">$radius </span><span class="keyword">* </span><span class="default">sin</span><span class="keyword">(</span><span class="default">$theta2</span><span class="keyword">));
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; } else {
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$x2 </span><span class="keyword">= </span><span class="default">$x1</span><span class="keyword">;
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$y2 </span><span class="keyword">= </span><span class="default">$y1</span><span class="keyword">;
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="comment">// Store the pixel color
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$pixels</span><span class="keyword">[] = array(</span><span class="default">$x2</span><span class="keyword">, </span><span class="default">$y2</span><span class="keyword">, </span><span class="default">imagecolorat</span><span class="keyword">(</span><span class="default">$srcImg</span><span class="keyword">, </span><span class="default">$x</span><span class="keyword">, </span><span class="default">$y</span><span class="keyword">));
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="comment">// Check our boundaries
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="keyword">if(</span><span class="default">$x2 </span><span class="keyword">&gt; </span><span class="default">$maxx</span><span class="keyword">) </span><span class="default">$maxx </span><span class="keyword">= </span><span class="default">$x2</span><span class="keyword">;
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if(</span><span class="default">$x2 </span><span class="keyword">&lt; </span><span class="default">$minx</span><span class="keyword">) </span><span class="default">$minx </span><span class="keyword">= </span><span class="default">$x2</span><span class="keyword">;
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if(</span><span class="default">$y2 </span><span class="keyword">&gt; </span><span class="default">$maxy</span><span class="keyword">) </span><span class="default">$maxy </span><span class="keyword">= </span><span class="default">$y2</span><span class="keyword">;
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if(</span><span class="default">$y2 </span><span class="keyword">&lt; </span><span class="default">$miny</span><span class="keyword">) </span><span class="default">$miny </span><span class="keyword">= </span><span class="default">$y2</span><span class="keyword">;
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }
<br>&nbsp; &nbsp; &nbsp; &nbsp; }
<br>&nbsp; &nbsp; &nbsp; &nbsp; 
<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="comment">// Determine the new image size
<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$dstw </span><span class="keyword">= </span><span class="default">$maxx </span><span class="keyword">- </span><span class="default">$minx </span><span class="keyword">+ </span><span class="default">1</span><span class="keyword">;
<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$dsth </span><span class="keyword">= </span><span class="default">$maxy </span><span class="keyword">- </span><span class="default">$miny </span><span class="keyword">+ </span><span class="default">1</span><span class="keyword">;
<br>&nbsp; &nbsp; &nbsp; &nbsp; 
<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="comment">// Create our new image
<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$dstImg </span><span class="keyword">= </span><span class="default">imagecreatetruecolor</span><span class="keyword">(</span><span class="default">$dstw</span><span class="keyword">, </span><span class="default">$dsth</span><span class="keyword">);
<br>&nbsp; &nbsp; &nbsp; &nbsp; 
<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="comment">// Fill the background with our transparent color
<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="keyword">if(</span><span class="default">$transparentColor </span><span class="keyword">== </span><span class="default">null</span><span class="keyword">) </span><span class="default">$transparentColor </span><span class="keyword">= </span><span class="default">imagecolorallocate</span><span class="keyword">(</span><span class="default">$dstImg</span><span class="keyword">, </span><span class="default">1</span><span class="keyword">, </span><span class="default">2</span><span class="keyword">, </span><span class="default">3</span><span class="keyword">);
<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">imagecolortransparent</span><span class="keyword">(</span><span class="default">$dstImg</span><span class="keyword">, </span><span class="default">$transparentColor</span><span class="keyword">);
<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">imagefilledrectangle</span><span class="keyword">(</span><span class="default">$dstImg</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">$dstw </span><span class="keyword">+ </span><span class="default">1</span><span class="keyword">, </span><span class="default">$dsth </span><span class="keyword">+ </span><span class="default">1</span><span class="keyword">, </span><span class="default">$transparentColor</span><span class="keyword">);
<br>&nbsp; &nbsp; &nbsp; &nbsp; 
<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="comment">// Get the new origin
<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$neworiginx </span><span class="keyword">= -</span><span class="default">$minx</span><span class="keyword">;
<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$neworiginy </span><span class="keyword">= -</span><span class="default">$miny</span><span class="keyword">;
<br>&nbsp; &nbsp; &nbsp; &nbsp; 
<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="comment">// Fill in the pixels
<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="keyword">foreach(</span><span class="default">$pixels </span><span class="keyword">as </span><span class="default">$data</span><span class="keyword">) {
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; list(</span><span class="default">$x</span><span class="keyword">, </span><span class="default">$y</span><span class="keyword">, </span><span class="default">$color</span><span class="keyword">) = </span><span class="default">$data</span><span class="keyword">;
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; list(</span><span class="default">$newx</span><span class="keyword">, </span><span class="default">$newy</span><span class="keyword">) = </span><span class="default">translateCoordinate</span><span class="keyword">(</span><span class="default">$neworiginx</span><span class="keyword">, </span><span class="default">$neworiginy</span><span class="keyword">, </span><span class="default">$x</span><span class="keyword">, </span><span class="default">$y</span><span class="keyword">);
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">imagesetpixel</span><span class="keyword">(</span><span class="default">$dstImg</span><span class="keyword">, </span><span class="default">$newx</span><span class="keyword">, </span><span class="default">$newy</span><span class="keyword">, </span><span class="default">$color</span><span class="keyword">);
<br>&nbsp; &nbsp; &nbsp; &nbsp; }
<br>&nbsp; &nbsp; &nbsp; &nbsp; 
<br>&nbsp; &nbsp; &nbsp; &nbsp; return </span><span class="default">$dstImg</span><span class="keyword">;
<br>&nbsp; &nbsp; }
<br>&nbsp; &nbsp; 
<br>&nbsp; &nbsp; </span><span class="comment">/**
<br>&nbsp; &nbsp;&nbsp; * Translates from mathematical coordinate system to computer coordinate system using
<br>&nbsp; &nbsp;&nbsp; * origin coordinates from the computer system or visa versa
<br>&nbsp; &nbsp;&nbsp; *
<br>&nbsp; &nbsp;&nbsp; * @param int $originx
<br>&nbsp; &nbsp;&nbsp; * @param int $originy
<br>&nbsp; &nbsp;&nbsp; * @param int $x
<br>&nbsp; &nbsp;&nbsp; * @param int $y
<br>&nbsp; &nbsp;&nbsp; * @param bool $toComp
<br>&nbsp; &nbsp;&nbsp; * @return array(int $x, int $y)
<br>&nbsp; &nbsp;&nbsp; */
<br>&nbsp; &nbsp; </span><span class="keyword">function </span><span class="default">translateCoordinate</span><span class="keyword">(</span><span class="default">$originx</span><span class="keyword">, </span><span class="default">$originy</span><span class="keyword">, </span><span class="default">$x</span><span class="keyword">, </span><span class="default">$y</span><span class="keyword">, </span><span class="default">$toComp</span><span class="keyword">=</span><span class="default">true</span><span class="keyword">) {
<br>&nbsp; &nbsp; &nbsp; &nbsp; if(</span><span class="default">$toComp</span><span class="keyword">) {
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$newx </span><span class="keyword">= </span><span class="default">$originx </span><span class="keyword">+ </span><span class="default">$x</span><span class="keyword">;
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$newy </span><span class="keyword">= </span><span class="default">$originy </span><span class="keyword">- </span><span class="default">$y</span><span class="keyword">;
<br>&nbsp; &nbsp; &nbsp; &nbsp; } else {
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$newx </span><span class="keyword">= </span><span class="default">$x </span><span class="keyword">- </span><span class="default">$originx</span><span class="keyword">;
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$newy </span><span class="keyword">= </span><span class="default">$originy </span><span class="keyword">- </span><span class="default">$y</span><span class="keyword">;
<br>&nbsp; &nbsp; &nbsp; &nbsp; }
<br>&nbsp; &nbsp; &nbsp; &nbsp; 
<br>&nbsp; &nbsp; &nbsp; &nbsp; return array(</span><span class="default">$newx</span><span class="keyword">, </span><span class="default">$newy</span><span class="keyword">);
<br>&nbsp; &nbsp; }
<br>}
<br></span><span class="default">?&gt;</span>
</span>
</code></div>
  </div>
 </div>
  <div class="note" id="82201">  
  <a class="name">
  <strong class="user"><em>achilles</em></strong></a><div class="date" title="2008-03-31 02:02"><strong>6 years ago</strong></div>
  <div class="text" id="Hcom82201">
<div class="phpcode"><code><span class="html">
otimized integration from 23-Feb-2007 04:21<br>just put it anywhere you like to use imagerotate with 90, 180, 270 degrees.<br><span class="default">&lt;?php<br></span><span class="keyword">if(!</span><span class="default">function_exists</span><span class="keyword">(</span><span class="string">"imagerotate"</span><span class="keyword">)) {<br>&nbsp; &nbsp; function </span><span class="default">imagerotate</span><span class="keyword">(</span><span class="default">$src_img</span><span class="keyword">, </span><span class="default">$angle</span><span class="keyword">) {<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$src_x </span><span class="keyword">= </span><span class="default">imagesx</span><span class="keyword">(</span><span class="default">$src_img</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$src_y </span><span class="keyword">= </span><span class="default">imagesy</span><span class="keyword">(</span><span class="default">$src_img</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; if (</span><span class="default">$angle </span><span class="keyword">== </span><span class="default">180</span><span class="keyword">) {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$dest_x </span><span class="keyword">= </span><span class="default">$src_x</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$dest_y </span><span class="keyword">= </span><span class="default">$src_y</span><span class="keyword">; }<br>&nbsp; &nbsp; &nbsp; &nbsp; elseif (</span><span class="default">$src_x </span><span class="keyword">&lt;= </span><span class="default">$src_y</span><span class="keyword">) {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$dest_x </span><span class="keyword">= </span><span class="default">$src_y</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$dest_y </span><span class="keyword">= </span><span class="default">$src_x</span><span class="keyword">; }<br>&nbsp; &nbsp; &nbsp; &nbsp; elseif (</span><span class="default">$src_x </span><span class="keyword">&gt;= </span><span class="default">$src_y</span><span class="keyword">) {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$dest_x </span><span class="keyword">= </span><span class="default">$src_y</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$dest_y </span><span class="keyword">= </span><span class="default">$src_x</span><span class="keyword">; }<br>&nbsp; &nbsp; &nbsp; &nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$rotate</span><span class="keyword">=</span><span class="default">imagecreatetruecolor</span><span class="keyword">(</span><span class="default">$dest_x</span><span class="keyword">,</span><span class="default">$dest_y</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">imagealphablending</span><span class="keyword">(</span><span class="default">$rotate</span><span class="keyword">, </span><span class="default">false</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; switch (</span><span class="default">$angle</span><span class="keyword">) {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; case </span><span class="default">270</span><span class="keyword">:<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; for (</span><span class="default">$y </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">; </span><span class="default">$y </span><span class="keyword">&lt; (</span><span class="default">$src_y</span><span class="keyword">); </span><span class="default">$y</span><span class="keyword">++) {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; for (</span><span class="default">$x </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">; </span><span class="default">$x </span><span class="keyword">&lt; (</span><span class="default">$src_x</span><span class="keyword">); </span><span class="default">$x</span><span class="keyword">++) {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$color </span><span class="keyword">= </span><span class="default">imagecolorat</span><span class="keyword">(</span><span class="default">$src_img</span><span class="keyword">, </span><span class="default">$x</span><span class="keyword">, </span><span class="default">$y</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">imagesetpixel</span><span class="keyword">(</span><span class="default">$rotate</span><span class="keyword">, </span><span class="default">$dest_x </span><span class="keyword">- </span><span class="default">$y </span><span class="keyword">- </span><span class="default">1</span><span class="keyword">, </span><span class="default">$x</span><span class="keyword">, </span><span class="default">$color</span><span class="keyword">); }}<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; break;<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; case </span><span class="default">90</span><span class="keyword">:<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; for (</span><span class="default">$y </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">; </span><span class="default">$y </span><span class="keyword">&lt; (</span><span class="default">$src_y</span><span class="keyword">); </span><span class="default">$y</span><span class="keyword">++) {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; for (</span><span class="default">$x </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">; </span><span class="default">$x </span><span class="keyword">&lt; (</span><span class="default">$src_x</span><span class="keyword">); </span><span class="default">$x</span><span class="keyword">++) {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$color </span><span class="keyword">= </span><span class="default">imagecolorat</span><span class="keyword">(</span><span class="default">$src_img</span><span class="keyword">, </span><span class="default">$x</span><span class="keyword">, </span><span class="default">$y</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">imagesetpixel</span><span class="keyword">(</span><span class="default">$rotate</span><span class="keyword">, </span><span class="default">$y</span><span class="keyword">, </span><span class="default">$dest_y </span><span class="keyword">- </span><span class="default">$x </span><span class="keyword">- </span><span class="default">1</span><span class="keyword">, </span><span class="default">$color</span><span class="keyword">); }}<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; break;<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; case </span><span class="default">180</span><span class="keyword">:<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; for (</span><span class="default">$y </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">; </span><span class="default">$y </span><span class="keyword">&lt; (</span><span class="default">$src_y</span><span class="keyword">); </span><span class="default">$y</span><span class="keyword">++) {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; for (</span><span class="default">$x </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">; </span><span class="default">$x </span><span class="keyword">&lt; (</span><span class="default">$src_x</span><span class="keyword">); </span><span class="default">$x</span><span class="keyword">++) {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$color </span><span class="keyword">= </span><span class="default">imagecolorat</span><span class="keyword">(</span><span class="default">$src_img</span><span class="keyword">, </span><span class="default">$x</span><span class="keyword">, </span><span class="default">$y</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">imagesetpixel</span><span class="keyword">(</span><span class="default">$rotate</span><span class="keyword">, </span><span class="default">$dest_x </span><span class="keyword">- </span><span class="default">$x </span><span class="keyword">- </span><span class="default">1</span><span class="keyword">, </span><span class="default">$dest_y </span><span class="keyword">- </span><span class="default">$y </span><span class="keyword">- </span><span class="default">1</span><span class="keyword">, </span><span class="default">$color</span><span class="keyword">); }}<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; break;<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; default: </span><span class="default">$rotate </span><span class="keyword">= </span><span class="default">$src_img</span><span class="keyword">; }<br>&nbsp; &nbsp; &nbsp; &nbsp; return </span><span class="default">$rotate</span><span class="keyword">; }}<br></span><span class="default">?&gt;</span>
</span>
</code></div>
  </div>
 </div>
  <div class="note" id="77033">  
  <a class="name">
  <strong class="user"><em>qrgames at NOSPAMTYrushyo dot com</em></strong></a><div class="date" title="2007-08-11 04:06"><strong>7 years ago</strong></div>
  <div class="text" id="Hcom77033">
<div class="phpcode"><code><span class="html">
imagerotate seems to be very fussy about handling transparency when copymerging onto another image. You can use the GD library's other transparency features to cover up the fact imagerotate gets it wrong HOWEVER it will only work if the top-left corner of the image is transparent at all rotations, so make the image a little bigger than it needs to be. This has been tested with png32 but does not work entirely for png8, as a phenomena creates noise around the rotated image.<br><br><span class="default">&lt;?php<br><br>$imgImage </span><span class="keyword">= </span><span class="default">imagecreatefrompng</span><span class="keyword">(</span><span class="string">"image.png"</span><span class="keyword">);<br></span><span class="default">$colBlack </span><span class="keyword">= </span><span class="default">imagecolorallocate</span><span class="keyword">(</span><span class="default">$imgImage</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">);<br></span><span class="default">$imgImage </span><span class="keyword">= </span><span class="default">imagerotate</span><span class="keyword">(</span><span class="default">$imgImage</span><span class="keyword">, </span><span class="default">360 </span><span class="keyword">- </span><span class="default">$intHeading</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">);<br></span><span class="default">imagefill</span><span class="keyword">(</span><span class="default">$imgImage</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">$colBlack</span><span class="keyword">);<br></span><span class="default">imagecolortransparent</span><span class="keyword">(</span><span class="default">$imgImage</span><span class="keyword">, </span><span class="default">$colBlack</span><span class="keyword">);<br></span><span class="default">imagecopymerge</span><span class="keyword">(</span><span class="default">$imgOriginalImage </span><span class="keyword">, </span><span class="default">$imgImage</span><span class="keyword">, </span><span class="default">$intX</span><span class="keyword">, </span><span class="default">$intY</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">$intHeight</span><span class="keyword">, </span><span class="default">$intWidth</span><span class="keyword">, </span><span class="default">100</span><span class="keyword">);<br></span><span class="default">imagedestroy</span><span class="keyword">(</span><span class="default">$imgImage</span><span class="keyword">);<br><br></span><span class="default">?&gt;<br></span><br>Note. $intHeading is in degrees clockwise :)</span>
</code></div>
  </div>
 </div>
  <div class="note" id="73446">  
  <a class="name">
  <strong class="user"><em>Thomaschaaf</em></strong></a><div class="date" title="2007-02-23 07:21"><strong>7 years ago</strong></div>
  <div class="text" id="Hcom73446">
<div class="phpcode"><code><span class="html">
<span class="default">&lt;?php
<br></span><span class="keyword">function </span><span class="default">rotate</span><span class="keyword">(</span><span class="default">$degrees</span><span class="keyword">)
<br>&nbsp; &nbsp; {
<br>&nbsp; &nbsp; &nbsp; &nbsp; if(</span><span class="default">function_exists</span><span class="keyword">(</span><span class="string">"imagerotate"</span><span class="keyword">))
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">image </span><span class="keyword">= </span><span class="default">imagerotate</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">image</span><span class="keyword">, </span><span class="default">$degrees</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">);
<br>&nbsp; &nbsp; &nbsp; &nbsp; else
<br>&nbsp; &nbsp; &nbsp; &nbsp; {
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; function </span><span class="default">imagerotate</span><span class="keyword">(</span><span class="default">$src_img</span><span class="keyword">, </span><span class="default">$angle</span><span class="keyword">) 
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$src_x </span><span class="keyword">= </span><span class="default">imagesx</span><span class="keyword">(</span><span class="default">$src_img</span><span class="keyword">);
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$src_y </span><span class="keyword">= </span><span class="default">imagesy</span><span class="keyword">(</span><span class="default">$src_img</span><span class="keyword">);
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if (</span><span class="default">$angle </span><span class="keyword">== </span><span class="default">180</span><span class="keyword">)
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$dest_x </span><span class="keyword">= </span><span class="default">$src_x</span><span class="keyword">;
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$dest_y </span><span class="keyword">= </span><span class="default">$src_y</span><span class="keyword">;
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; } 
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; elseif (</span><span class="default">$src_x </span><span class="keyword">&lt;= </span><span class="default">$src_y</span><span class="keyword">) 
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$dest_x </span><span class="keyword">= </span><span class="default">$src_y</span><span class="keyword">;
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$dest_y </span><span class="keyword">= </span><span class="default">$src_x</span><span class="keyword">;
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; } 
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; elseif (</span><span class="default">$src_x </span><span class="keyword">&gt;= </span><span class="default">$src_y</span><span class="keyword">)&nbsp; 
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$dest_x </span><span class="keyword">= </span><span class="default">$src_y</span><span class="keyword">;
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$dest_y </span><span class="keyword">= </span><span class="default">$src_x</span><span class="keyword">;
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$rotate</span><span class="keyword">=</span><span class="default">imagecreatetruecolor</span><span class="keyword">(</span><span class="default">$dest_x</span><span class="keyword">,</span><span class="default">$dest_y</span><span class="keyword">);
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">imagealphablending</span><span class="keyword">(</span><span class="default">$rotate</span><span class="keyword">, </span><span class="default">false</span><span class="keyword">);
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; switch (</span><span class="default">$angle</span><span class="keyword">) 
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; case </span><span class="default">270</span><span class="keyword">:
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; for (</span><span class="default">$y </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">; </span><span class="default">$y </span><span class="keyword">&lt; (</span><span class="default">$src_y</span><span class="keyword">); </span><span class="default">$y</span><span class="keyword">++) 
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; for (</span><span class="default">$x </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">; </span><span class="default">$x </span><span class="keyword">&lt; (</span><span class="default">$src_x</span><span class="keyword">); </span><span class="default">$x</span><span class="keyword">++) 
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$color </span><span class="keyword">= </span><span class="default">imagecolorat</span><span class="keyword">(</span><span class="default">$src_img</span><span class="keyword">, </span><span class="default">$x</span><span class="keyword">, </span><span class="default">$y</span><span class="keyword">);
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">imagesetpixel</span><span class="keyword">(</span><span class="default">$rotate</span><span class="keyword">, </span><span class="default">$dest_x </span><span class="keyword">- </span><span class="default">$y </span><span class="keyword">- </span><span class="default">1</span><span class="keyword">, </span><span class="default">$x</span><span class="keyword">, </span><span class="default">$color</span><span class="keyword">);
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; break;
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; case </span><span class="default">90</span><span class="keyword">:
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; for (</span><span class="default">$y </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">; </span><span class="default">$y </span><span class="keyword">&lt; (</span><span class="default">$src_y</span><span class="keyword">); </span><span class="default">$y</span><span class="keyword">++) 
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; for (</span><span class="default">$x </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">; </span><span class="default">$x </span><span class="keyword">&lt; (</span><span class="default">$src_x</span><span class="keyword">); </span><span class="default">$x</span><span class="keyword">++) 
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$color </span><span class="keyword">= </span><span class="default">imagecolorat</span><span class="keyword">(</span><span class="default">$src_img</span><span class="keyword">, </span><span class="default">$x</span><span class="keyword">, </span><span class="default">$y</span><span class="keyword">);
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">imagesetpixel</span><span class="keyword">(</span><span class="default">$rotate</span><span class="keyword">, </span><span class="default">$y</span><span class="keyword">, </span><span class="default">$dest_y </span><span class="keyword">- </span><span class="default">$x </span><span class="keyword">- </span><span class="default">1</span><span class="keyword">, </span><span class="default">$color</span><span class="keyword">);
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; break;
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; case </span><span class="default">180</span><span class="keyword">:
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; for (</span><span class="default">$y </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">; </span><span class="default">$y </span><span class="keyword">&lt; (</span><span class="default">$src_y</span><span class="keyword">); </span><span class="default">$y</span><span class="keyword">++) 
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; for (</span><span class="default">$x </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">; </span><span class="default">$x </span><span class="keyword">&lt; (</span><span class="default">$src_x</span><span class="keyword">); </span><span class="default">$x</span><span class="keyword">++) 
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$color </span><span class="keyword">= </span><span class="default">imagecolorat</span><span class="keyword">(</span><span class="default">$src_img</span><span class="keyword">, </span><span class="default">$x</span><span class="keyword">, </span><span class="default">$y</span><span class="keyword">);
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">imagesetpixel</span><span class="keyword">(</span><span class="default">$rotate</span><span class="keyword">, </span><span class="default">$dest_x </span><span class="keyword">- </span><span class="default">$x </span><span class="keyword">- </span><span class="default">1</span><span class="keyword">, </span><span class="default">$dest_y </span><span class="keyword">- </span><span class="default">$y </span><span class="keyword">- </span><span class="default">1</span><span class="keyword">, </span><span class="default">$color</span><span class="keyword">);
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; break;
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; default: </span><span class="default">$rotate </span><span class="keyword">= </span><span class="default">$src_img</span><span class="keyword">;
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; };
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; return </span><span class="default">$rotate</span><span class="keyword">;
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">image </span><span class="keyword">= </span><span class="default">imagerotate</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">image</span><span class="keyword">, </span><span class="default">$degrees</span><span class="keyword">);
<br>&nbsp; &nbsp; &nbsp; &nbsp; }
<br>&nbsp; &nbsp; }
<br></span><span class="default">?&gt;</span>
</span>
</code></div>
  </div>
 </div>
  <div class="note" id="69668">  
  <a class="name">
  <strong class="user"><em>m dot quinton at gmail dot com</em></strong></a><div class="date" title="2006-09-14 09:30"><strong>7 years ago</strong></div>
  <div class="text" id="Hcom69668">
<div class="phpcode"><code><span class="html">
with large file, where imagerotate is missing, you can use, when possible "convert" command from ImageMagick. Here is a sample script.<br><br><span class="default">&lt;?php<br><br>error_reporting</span><span class="keyword">(</span><span class="default">E_ALL</span><span class="keyword">);<br><br></span><span class="default">header</span><span class="keyword">(</span><span class="string">"Content-type: image/png"</span><span class="keyword">);<br><br></span><span class="default">$file </span><span class="keyword">= </span><span class="string">'images/test/imgp2498.jpg'</span><span class="keyword">;<br><br></span><span class="default">image_rotate_with_convert</span><span class="keyword">(</span><span class="default">$file</span><span class="keyword">, </span><span class="default">90</span><span class="keyword">);<br><br>function </span><span class="default">image_rotate_with_convert</span><span class="keyword">(</span><span class="default">$file</span><span class="keyword">, </span><span class="default">$angle</span><span class="keyword">){<br>&nbsp; &nbsp; </span><span class="default">passthru</span><span class="keyword">(</span><span class="string">"convert -rotate </span><span class="default">$angle</span><span class="string"> </span><span class="default">$file</span><span class="string"> -"</span><span class="keyword">);<br>}<br><br></span><span class="default">?&gt;</span>
</span>
</code></div>
  </div>
 </div>
  <div class="note" id="50487">  
  <a class="name">
  <strong class="user"><em>wulff at fyens dot dk</em></strong></a><div class="date" title="2005-03-01 01:22"><strong>9 years ago</strong></div>
  <div class="text" id="Hcom50487">
<div class="phpcode"><code><span class="html">
I liked the rotateImageBicubic function implemented by darren at lucidtone dot com. But it just snipped off the parts of the image that were outside the original image.<br><br>I fixed this, even though I admit that my solution is a bit naive. But it might come in handy for somebody.<br><br>Also his bicubic implementation was broken on my machine so I left it out, if you need it just copy and paste it from above.<br><br><span class="default">&lt;?php<br><br></span><span class="comment">// $src_img - a GD image resource<br>// $angle - degrees to rotate clockwise, in degrees<br>// returns a GD image resource<br>// USAGE:<br>// $im = imagecreatefrompng('test.png');<br>// $im = imagerotate($im, 15);<br>// header('Content-type: image/png');<br>// imagepng($im);<br></span><span class="keyword">function </span><span class="default">imageRotate</span><span class="keyword">(</span><span class="default">$src_img</span><span class="keyword">, </span><span class="default">$angle</span><span class="keyword">, </span><span class="default">$bicubic</span><span class="keyword">=</span><span class="default">false</span><span class="keyword">) {<br>&nbsp; <br>&nbsp;&nbsp; </span><span class="comment">// convert degrees to radians<br>&nbsp;&nbsp; </span><span class="default">$angle </span><span class="keyword">= </span><span class="default">$angle </span><span class="keyword">+ </span><span class="default">180</span><span class="keyword">;<br>&nbsp;&nbsp; </span><span class="default">$angle </span><span class="keyword">= </span><span class="default">deg2rad</span><span class="keyword">(</span><span class="default">$angle</span><span class="keyword">);<br>&nbsp; <br>&nbsp;&nbsp; </span><span class="default">$src_x </span><span class="keyword">= </span><span class="default">imagesx</span><span class="keyword">(</span><span class="default">$src_img</span><span class="keyword">);<br>&nbsp;&nbsp; </span><span class="default">$src_y </span><span class="keyword">= </span><span class="default">imagesy</span><span class="keyword">(</span><span class="default">$src_img</span><span class="keyword">);<br>&nbsp; <br>&nbsp;&nbsp; </span><span class="default">$center_x </span><span class="keyword">= </span><span class="default">floor</span><span class="keyword">(</span><span class="default">$src_x</span><span class="keyword">/</span><span class="default">2</span><span class="keyword">);<br>&nbsp;&nbsp; </span><span class="default">$center_y </span><span class="keyword">= </span><span class="default">floor</span><span class="keyword">(</span><span class="default">$src_y</span><span class="keyword">/</span><span class="default">2</span><span class="keyword">);<br><br>&nbsp;&nbsp; </span><span class="default">$cosangle </span><span class="keyword">= </span><span class="default">cos</span><span class="keyword">(</span><span class="default">$angle</span><span class="keyword">);<br>&nbsp;&nbsp; </span><span class="default">$sinangle </span><span class="keyword">= </span><span class="default">sin</span><span class="keyword">(</span><span class="default">$angle</span><span class="keyword">);<br><br>&nbsp;&nbsp; </span><span class="default">$corners</span><span class="keyword">=array(array(</span><span class="default">0</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">), array(</span><span class="default">$src_x</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">), array(</span><span class="default">$src_x</span><span class="keyword">,</span><span class="default">$src_y</span><span class="keyword">), array(</span><span class="default">0</span><span class="keyword">,</span><span class="default">$src_y</span><span class="keyword">));<br><br>&nbsp;&nbsp; foreach(</span><span class="default">$corners </span><span class="keyword">as </span><span class="default">$key</span><span class="keyword">=&gt;</span><span class="default">$value</span><span class="keyword">) {<br>&nbsp; &nbsp;&nbsp; </span><span class="default">$value</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">]-=</span><span class="default">$center_x</span><span class="keyword">;&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="comment">//Translate coords to center for rotation<br>&nbsp; &nbsp;&nbsp; </span><span class="default">$value</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">]-=</span><span class="default">$center_y</span><span class="keyword">;<br>&nbsp; &nbsp;&nbsp; </span><span class="default">$temp</span><span class="keyword">=array();<br>&nbsp; &nbsp;&nbsp; </span><span class="default">$temp</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">]=</span><span class="default">$value</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">]*</span><span class="default">$cosangle</span><span class="keyword">+</span><span class="default">$value</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">]*</span><span class="default">$sinangle</span><span class="keyword">;<br>&nbsp; &nbsp;&nbsp; </span><span class="default">$temp</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">]=</span><span class="default">$value</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">]*</span><span class="default">$cosangle</span><span class="keyword">-</span><span class="default">$value</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">]*</span><span class="default">$sinangle</span><span class="keyword">;<br>&nbsp; &nbsp;&nbsp; </span><span class="default">$corners</span><span class="keyword">[</span><span class="default">$key</span><span class="keyword">]=</span><span class="default">$temp</span><span class="keyword">;&nbsp; &nbsp; <br>&nbsp;&nbsp; }<br>&nbsp;&nbsp; <br>&nbsp;&nbsp; </span><span class="default">$min_x</span><span class="keyword">=</span><span class="default">1000000000000000</span><span class="keyword">;<br>&nbsp;&nbsp; </span><span class="default">$max_x</span><span class="keyword">=-</span><span class="default">1000000000000000</span><span class="keyword">;<br>&nbsp;&nbsp; </span><span class="default">$min_y</span><span class="keyword">=</span><span class="default">1000000000000000</span><span class="keyword">;<br>&nbsp;&nbsp; </span><span class="default">$max_y</span><span class="keyword">=-</span><span class="default">1000000000000000</span><span class="keyword">;<br>&nbsp;&nbsp; <br>&nbsp;&nbsp; foreach(</span><span class="default">$corners </span><span class="keyword">as </span><span class="default">$key </span><span class="keyword">=&gt; </span><span class="default">$value</span><span class="keyword">) {<br>&nbsp; &nbsp;&nbsp; if(</span><span class="default">$value</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">]&lt;</span><span class="default">$min_x</span><span class="keyword">)<br>&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$min_x</span><span class="keyword">=</span><span class="default">$value</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">];<br>&nbsp; &nbsp;&nbsp; if(</span><span class="default">$value</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">]&gt;</span><span class="default">$max_x</span><span class="keyword">)<br>&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$max_x</span><span class="keyword">=</span><span class="default">$value</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">];<br>&nbsp;&nbsp; <br>&nbsp; &nbsp;&nbsp; if(</span><span class="default">$value</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">]&lt;</span><span class="default">$min_y</span><span class="keyword">)<br>&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$min_y</span><span class="keyword">=</span><span class="default">$value</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">];<br>&nbsp; &nbsp;&nbsp; if(</span><span class="default">$value</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">]&gt;</span><span class="default">$max_y</span><span class="keyword">)<br>&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$max_y</span><span class="keyword">=</span><span class="default">$value</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">];<br>&nbsp;&nbsp; }<br><br>&nbsp;&nbsp; </span><span class="default">$rotate_width</span><span class="keyword">=</span><span class="default">round</span><span class="keyword">(</span><span class="default">$max_x</span><span class="keyword">-</span><span class="default">$min_x</span><span class="keyword">);<br>&nbsp;&nbsp; </span><span class="default">$rotate_height</span><span class="keyword">=</span><span class="default">round</span><span class="keyword">(</span><span class="default">$max_y</span><span class="keyword">-</span><span class="default">$min_y</span><span class="keyword">);<br><br>&nbsp;&nbsp; </span><span class="default">$rotate</span><span class="keyword">=</span><span class="default">imagecreatetruecolor</span><span class="keyword">(</span><span class="default">$rotate_width</span><span class="keyword">,</span><span class="default">$rotate_height</span><span class="keyword">);<br>&nbsp;&nbsp; </span><span class="default">imagealphablending</span><span class="keyword">(</span><span class="default">$rotate</span><span class="keyword">, </span><span class="default">false</span><span class="keyword">);<br>&nbsp;&nbsp; </span><span class="default">imagesavealpha</span><span class="keyword">(</span><span class="default">$rotate</span><span class="keyword">, </span><span class="default">true</span><span class="keyword">);<br><br>&nbsp;&nbsp; </span><span class="comment">//Reset center to center of our image<br>&nbsp;&nbsp; </span><span class="default">$newcenter_x </span><span class="keyword">= (</span><span class="default">$rotate_width</span><span class="keyword">)/</span><span class="default">2</span><span class="keyword">;<br>&nbsp;&nbsp; </span><span class="default">$newcenter_y </span><span class="keyword">= (</span><span class="default">$rotate_height</span><span class="keyword">)/</span><span class="default">2</span><span class="keyword">;<br><br>&nbsp;&nbsp; for (</span><span class="default">$y </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">; </span><span class="default">$y </span><span class="keyword">&lt; (</span><span class="default">$rotate_height</span><span class="keyword">); </span><span class="default">$y</span><span class="keyword">++) {<br>&nbsp; &nbsp;&nbsp; for (</span><span class="default">$x </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">; </span><span class="default">$x </span><span class="keyword">&lt; (</span><span class="default">$rotate_width</span><span class="keyword">); </span><span class="default">$x</span><span class="keyword">++) {<br>&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// rotate...<br>&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$old_x </span><span class="keyword">= </span><span class="default">round</span><span class="keyword">(((</span><span class="default">$newcenter_x</span><span class="keyword">-</span><span class="default">$x</span><span class="keyword">) * </span><span class="default">$cosangle </span><span class="keyword">+ (</span><span class="default">$newcenter_y</span><span class="keyword">-</span><span class="default">$y</span><span class="keyword">) * </span><span class="default">$sinangle</span><span class="keyword">))<br>&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; + </span><span class="default">$center_x</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$old_y </span><span class="keyword">= </span><span class="default">round</span><span class="keyword">(((</span><span class="default">$newcenter_y</span><span class="keyword">-</span><span class="default">$y</span><span class="keyword">) * </span><span class="default">$cosangle </span><span class="keyword">- (</span><span class="default">$newcenter_x</span><span class="keyword">-</span><span class="default">$x</span><span class="keyword">) * </span><span class="default">$sinangle</span><span class="keyword">))<br>&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; + </span><span class="default">$center_y</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; <br>&nbsp; &nbsp; &nbsp;&nbsp; if ( </span><span class="default">$old_x </span><span class="keyword">&gt;= </span><span class="default">0 </span><span class="keyword">&amp;&amp; </span><span class="default">$old_x </span><span class="keyword">&lt; </span><span class="default">$src_x<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">&amp;&amp; </span><span class="default">$old_y </span><span class="keyword">&gt;= </span><span class="default">0 </span><span class="keyword">&amp;&amp; </span><span class="default">$old_y </span><span class="keyword">&lt; </span><span class="default">$src_y </span><span class="keyword">) {<br><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$color </span><span class="keyword">= </span><span class="default">imagecolorat</span><span class="keyword">(</span><span class="default">$src_img</span><span class="keyword">, </span><span class="default">$old_x</span><span class="keyword">, </span><span class="default">$old_y</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp;&nbsp; } else {<br>&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// this line sets the background colour<br>&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$color </span><span class="keyword">= </span><span class="default">imagecolorallocatealpha</span><span class="keyword">(</span><span class="default">$src_img</span><span class="keyword">, </span><span class="default">255</span><span class="keyword">, </span><span class="default">255</span><span class="keyword">, </span><span class="default">255</span><span class="keyword">, </span><span class="default">127</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp;&nbsp; }<br>&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">imagesetpixel</span><span class="keyword">(</span><span class="default">$rotate</span><span class="keyword">, </span><span class="default">$x</span><span class="keyword">, </span><span class="default">$y</span><span class="keyword">, </span><span class="default">$color</span><span class="keyword">);<br>&nbsp; &nbsp;&nbsp; }<br>&nbsp;&nbsp; }<br>&nbsp;&nbsp; <br>&nbsp; return(</span><span class="default">$rotate</span><span class="keyword">);<br>}<br><br></span><span class="default">?&gt;</span>
</span>
</code></div>
  </div>
 </div>
  <div class="note" id="48725">  
  <a class="name">
  <strong class="user"><em>Borszczuk</em></strong></a><div class="date" title="2005-01-05 05:21"><strong>9 years ago</strong></div>
  <div class="text" id="Hcom48725">
<div class="phpcode"><code><span class="html">
Here's a function that implements right angle (multiplicity of 90 degs - 90, 180, 270) rotation if you need one but lacks native imagerotate() or you don't want non-square images to be scaled down as with imagerotate(). As you probably noticed it's not self contained function, as 180 rotation is handled by ImageFlip() function to gain the performance. The ImageFlip() function used is published here: <a rel="nofollow" target="_blank">http://php.net/imagecopy</a> in the comment of mine placed on&nbsp; 05-Jan-2005 04:30
<br>
<br>Please note: that in case of 0 degrees rotation handle to imgSrc is returned which may lead to problems if you imagedestroy() it undonditionaly. To solve that you shall add imagecopy($imgDest, $imgSrc, 0,0, 0,0,$srcX, $srcY)&nbsp; in proper place which I have intentionally ommited to save memory resources
<br>
<br><span class="default">&lt;?php
<br>
<br></span><span class="comment">// $imgSrc - GD image handle of source image
<br>// $angle - angle of rotation. Needs to be positive integer
<br>// angle shall be 0,90,180,270, but if you give other it
<br>// will be rouned to nearest right angle (i.e. 52-&gt;90 degs,
<br>// 96-&gt;90 degs)
<br>// returns GD image handle of rotated image.
<br></span><span class="keyword">function </span><span class="default">ImageRotateRightAngle</span><span class="keyword">( </span><span class="default">$imgSrc</span><span class="keyword">, </span><span class="default">$angle </span><span class="keyword">)
<br>{
<br>&nbsp; &nbsp; </span><span class="comment">// ensuring we got really RightAngle (if not we choose the closest one)
<br>&nbsp; &nbsp; </span><span class="default">$angle </span><span class="keyword">= </span><span class="default">min</span><span class="keyword">( ( (int)((</span><span class="default">$angle</span><span class="keyword">+</span><span class="default">45</span><span class="keyword">) / </span><span class="default">90</span><span class="keyword">) * </span><span class="default">90</span><span class="keyword">), </span><span class="default">270 </span><span class="keyword">);
<br>
<br>&nbsp; &nbsp; </span><span class="comment">// no need to fight
<br>&nbsp; &nbsp; </span><span class="keyword">if( </span><span class="default">$angle </span><span class="keyword">== </span><span class="default">0 </span><span class="keyword">)
<br>&nbsp; &nbsp; &nbsp; &nbsp; return( </span><span class="default">$imgSrc </span><span class="keyword">);
<br>
<br>&nbsp; &nbsp; </span><span class="comment">// dimenstion of source image
<br>&nbsp; &nbsp; </span><span class="default">$srcX </span><span class="keyword">= </span><span class="default">imagesx</span><span class="keyword">( </span><span class="default">$imgSrc </span><span class="keyword">);
<br>&nbsp; &nbsp; </span><span class="default">$srcY </span><span class="keyword">= </span><span class="default">imagesy</span><span class="keyword">( </span><span class="default">$imgSrc </span><span class="keyword">);
<br>
<br>&nbsp; &nbsp; switch( </span><span class="default">$angle </span><span class="keyword">)
<br>&nbsp; &nbsp; &nbsp; &nbsp; {
<br>&nbsp; &nbsp; &nbsp; &nbsp; case </span><span class="default">90</span><span class="keyword">:
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$imgDest </span><span class="keyword">= </span><span class="default">imagecreatetruecolor</span><span class="keyword">( </span><span class="default">$srcY</span><span class="keyword">, </span><span class="default">$srcX </span><span class="keyword">);
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; for( </span><span class="default">$x</span><span class="keyword">=</span><span class="default">0</span><span class="keyword">; </span><span class="default">$x</span><span class="keyword">&lt;</span><span class="default">$srcX</span><span class="keyword">; </span><span class="default">$x</span><span class="keyword">++ )
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; for( </span><span class="default">$y</span><span class="keyword">=</span><span class="default">0</span><span class="keyword">; </span><span class="default">$y</span><span class="keyword">&lt;</span><span class="default">$srcY</span><span class="keyword">; </span><span class="default">$y</span><span class="keyword">++ )
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">imagecopy</span><span class="keyword">(</span><span class="default">$imgDest</span><span class="keyword">, </span><span class="default">$imgSrc</span><span class="keyword">, </span><span class="default">$srcY</span><span class="keyword">-</span><span class="default">$y</span><span class="keyword">-</span><span class="default">1</span><span class="keyword">, </span><span class="default">$x</span><span class="keyword">, </span><span class="default">$x</span><span class="keyword">, </span><span class="default">$y</span><span class="keyword">, </span><span class="default">1</span><span class="keyword">, </span><span class="default">1</span><span class="keyword">);
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; break;
<br>
<br>&nbsp; &nbsp; &nbsp; &nbsp; case </span><span class="default">180</span><span class="keyword">:
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$imgDest </span><span class="keyword">= </span><span class="default">ImageFlip</span><span class="keyword">( </span><span class="default">$imgSrc</span><span class="keyword">, </span><span class="default">IMAGE_FLIP_BOTH </span><span class="keyword">);
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; break;
<br>
<br>&nbsp; &nbsp; &nbsp; &nbsp; case </span><span class="default">270</span><span class="keyword">:
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$imgDest </span><span class="keyword">= </span><span class="default">imagecreatetruecolor</span><span class="keyword">( </span><span class="default">$srcY</span><span class="keyword">, </span><span class="default">$srcX </span><span class="keyword">);
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; for( </span><span class="default">$x</span><span class="keyword">=</span><span class="default">0</span><span class="keyword">; </span><span class="default">$x</span><span class="keyword">&lt;</span><span class="default">$srcX</span><span class="keyword">; </span><span class="default">$x</span><span class="keyword">++ )
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; for( </span><span class="default">$y</span><span class="keyword">=</span><span class="default">0</span><span class="keyword">; </span><span class="default">$y</span><span class="keyword">&lt;</span><span class="default">$srcY</span><span class="keyword">; </span><span class="default">$y</span><span class="keyword">++ )
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">imagecopy</span><span class="keyword">(</span><span class="default">$imgDest</span><span class="keyword">, </span><span class="default">$imgSrc</span><span class="keyword">, </span><span class="default">$y</span><span class="keyword">, </span><span class="default">$srcX</span><span class="keyword">-</span><span class="default">$x</span><span class="keyword">-</span><span class="default">1</span><span class="keyword">, </span><span class="default">$x</span><span class="keyword">, </span><span class="default">$y</span><span class="keyword">, </span><span class="default">1</span><span class="keyword">, </span><span class="default">1</span><span class="keyword">);
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; break;
<br>&nbsp; &nbsp; &nbsp; &nbsp; }
<br>
<br>&nbsp; &nbsp; return( </span><span class="default">$imgDest </span><span class="keyword">);
<br>}
<br></span><span class="default">?&gt;</span>
</span>
</code></div>
  </div>
 </div>
  <div class="note" id="47985">  
  <a class="name">
  <strong class="user"><em>darren at lucidtone dot com</em></strong></a><div class="date" title="2004-12-07 08:43"><strong>9 years ago</strong></div>
  <div class="text" id="Hcom47985">
<div class="phpcode"><code><span class="html">
Here's a neat function for those of us who don't have imagerotate() on our servers.&nbsp; It's based on a comment from ron at korving dot demon dot nl on the manual page for imagecopyresampled.
<br>
<br>I'm still not 100% on coping with transparency, but this function seems to cope okay.&nbsp; It doesn't resize to fit within bounds, it just rotates and you lose anything outside the image box.&nbsp; 
<br>
<br>The bicubic mode is slooow.
<br>
<br>If you want to be able to change the background colour, pass in a colour and use it where indicated.&nbsp; The line I used just sets it transparent.
<br>
<br><span class="default">&lt;?php
<br></span><span class="comment">// $src_img - a GD image resource
<br>// $angle - degrees to rotate clockwise, in degrees
<br>// returns a GD image resource
<br>// USAGE:
<br>// $im = imagecreatefrompng('test.png');
<br>// $im = imagerotate($im, 15);
<br>// header('Content-type: image/png');
<br>// imagepng($im);
<br></span><span class="keyword">function </span><span class="default">imageRotateBicubic</span><span class="keyword">(</span><span class="default">$src_img</span><span class="keyword">, </span><span class="default">$angle</span><span class="keyword">, </span><span class="default">$bicubic</span><span class="keyword">=</span><span class="default">false</span><span class="keyword">) {
<br>&nbsp; &nbsp; 
<br>&nbsp; &nbsp; </span><span class="comment">// convert degrees to radians
<br>&nbsp; &nbsp; </span><span class="default">$angle </span><span class="keyword">= </span><span class="default">$angle </span><span class="keyword">+ </span><span class="default">180</span><span class="keyword">;
<br>&nbsp; &nbsp; </span><span class="default">$angle </span><span class="keyword">= </span><span class="default">deg2rad</span><span class="keyword">(</span><span class="default">$angle</span><span class="keyword">);
<br>&nbsp; &nbsp; 
<br>&nbsp; &nbsp; </span><span class="default">$src_x </span><span class="keyword">= </span><span class="default">imagesx</span><span class="keyword">(</span><span class="default">$src_img</span><span class="keyword">);
<br>&nbsp; &nbsp; </span><span class="default">$src_y </span><span class="keyword">= </span><span class="default">imagesy</span><span class="keyword">(</span><span class="default">$src_img</span><span class="keyword">);
<br>&nbsp; &nbsp; 
<br>&nbsp; &nbsp; </span><span class="default">$center_x </span><span class="keyword">= </span><span class="default">floor</span><span class="keyword">(</span><span class="default">$src_x</span><span class="keyword">/</span><span class="default">2</span><span class="keyword">);
<br>&nbsp; &nbsp; </span><span class="default">$center_y </span><span class="keyword">= </span><span class="default">floor</span><span class="keyword">(</span><span class="default">$src_y</span><span class="keyword">/</span><span class="default">2</span><span class="keyword">);
<br>&nbsp; &nbsp; 
<br>&nbsp; &nbsp; </span><span class="default">$rotate </span><span class="keyword">= </span><span class="default">imagecreatetruecolor</span><span class="keyword">(</span><span class="default">$src_x</span><span class="keyword">, </span><span class="default">$src_y</span><span class="keyword">);
<br>&nbsp; &nbsp; </span><span class="default">imagealphablending</span><span class="keyword">(</span><span class="default">$rotate</span><span class="keyword">, </span><span class="default">false</span><span class="keyword">);
<br>&nbsp; &nbsp; </span><span class="default">imagesavealpha</span><span class="keyword">(</span><span class="default">$rotate</span><span class="keyword">, </span><span class="default">true</span><span class="keyword">);
<br>
<br>&nbsp; &nbsp; </span><span class="default">$cosangle </span><span class="keyword">= </span><span class="default">cos</span><span class="keyword">(</span><span class="default">$angle</span><span class="keyword">);
<br>&nbsp; &nbsp; </span><span class="default">$sinangle </span><span class="keyword">= </span><span class="default">sin</span><span class="keyword">(</span><span class="default">$angle</span><span class="keyword">);
<br>&nbsp; &nbsp; 
<br>&nbsp; &nbsp; for (</span><span class="default">$y </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">; </span><span class="default">$y </span><span class="keyword">&lt; </span><span class="default">$src_y</span><span class="keyword">; </span><span class="default">$y</span><span class="keyword">++) {
<br>&nbsp; &nbsp; &nbsp; for (</span><span class="default">$x </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">; </span><span class="default">$x </span><span class="keyword">&lt; </span><span class="default">$src_x</span><span class="keyword">; </span><span class="default">$x</span><span class="keyword">++) {
<br>&nbsp; &nbsp; </span><span class="comment">// rotate...
<br>&nbsp; &nbsp; </span><span class="default">$old_x </span><span class="keyword">= ((</span><span class="default">$center_x</span><span class="keyword">-</span><span class="default">$x</span><span class="keyword">) * </span><span class="default">$cosangle </span><span class="keyword">+ (</span><span class="default">$center_y</span><span class="keyword">-</span><span class="default">$y</span><span class="keyword">) * </span><span class="default">$sinangle</span><span class="keyword">)
<br>&nbsp; &nbsp; &nbsp; + </span><span class="default">$center_x</span><span class="keyword">;
<br>&nbsp; &nbsp; </span><span class="default">$old_y </span><span class="keyword">= ((</span><span class="default">$center_y</span><span class="keyword">-</span><span class="default">$y</span><span class="keyword">) * </span><span class="default">$cosangle </span><span class="keyword">- (</span><span class="default">$center_x</span><span class="keyword">-</span><span class="default">$x</span><span class="keyword">) * </span><span class="default">$sinangle</span><span class="keyword">)
<br>&nbsp; &nbsp; &nbsp; + </span><span class="default">$center_y</span><span class="keyword">;
<br>&nbsp; &nbsp; 
<br>&nbsp; &nbsp; if ( </span><span class="default">$old_x </span><span class="keyword">&gt;= </span><span class="default">0 </span><span class="keyword">&amp;&amp; </span><span class="default">$old_x </span><span class="keyword">&lt; </span><span class="default">$src_x
<br>&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">&amp;&amp; </span><span class="default">$old_y </span><span class="keyword">&gt;= </span><span class="default">0 </span><span class="keyword">&amp;&amp; </span><span class="default">$old_y </span><span class="keyword">&lt; </span><span class="default">$src_y </span><span class="keyword">) {
<br>&nbsp; &nbsp; &nbsp; if (</span><span class="default">$bicubic </span><span class="keyword">== </span><span class="default">true</span><span class="keyword">) {
<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$sY&nbsp; </span><span class="keyword">= </span><span class="default">$old_y </span><span class="keyword">+ </span><span class="default">1</span><span class="keyword">;
<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$siY&nbsp; </span><span class="keyword">= </span><span class="default">$old_y</span><span class="keyword">;
<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$siY2 </span><span class="keyword">= </span><span class="default">$old_y </span><span class="keyword">- </span><span class="default">1</span><span class="keyword">;
<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$sX&nbsp; </span><span class="keyword">= </span><span class="default">$old_x </span><span class="keyword">+ </span><span class="default">1</span><span class="keyword">;
<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$siX&nbsp; </span><span class="keyword">= </span><span class="default">$old_x</span><span class="keyword">;
<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$siX2 </span><span class="keyword">= </span><span class="default">$old_x </span><span class="keyword">- </span><span class="default">1</span><span class="keyword">;
<br>&nbsp; &nbsp; &nbsp; &nbsp; 
<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$c1 </span><span class="keyword">= </span><span class="default">imagecolorsforindex</span><span class="keyword">(</span><span class="default">$src_img</span><span class="keyword">, </span><span class="default">imagecolorat</span><span class="keyword">(</span><span class="default">$src_img</span><span class="keyword">, </span><span class="default">$siX</span><span class="keyword">, </span><span class="default">$siY2</span><span class="keyword">));
<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$c2 </span><span class="keyword">= </span><span class="default">imagecolorsforindex</span><span class="keyword">(</span><span class="default">$src_img</span><span class="keyword">, </span><span class="default">imagecolorat</span><span class="keyword">(</span><span class="default">$src_img</span><span class="keyword">, </span><span class="default">$siX</span><span class="keyword">, </span><span class="default">$siY</span><span class="keyword">));
<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$c3 </span><span class="keyword">= </span><span class="default">imagecolorsforindex</span><span class="keyword">(</span><span class="default">$src_img</span><span class="keyword">, </span><span class="default">imagecolorat</span><span class="keyword">(</span><span class="default">$src_img</span><span class="keyword">, </span><span class="default">$siX2</span><span class="keyword">, </span><span class="default">$siY2</span><span class="keyword">));
<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$c4 </span><span class="keyword">= </span><span class="default">imagecolorsforindex</span><span class="keyword">(</span><span class="default">$src_img</span><span class="keyword">, </span><span class="default">imagecolorat</span><span class="keyword">(</span><span class="default">$src_img</span><span class="keyword">, </span><span class="default">$siX2</span><span class="keyword">, </span><span class="default">$siY</span><span class="keyword">));
<br>&nbsp; &nbsp; &nbsp; &nbsp; 
<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$r </span><span class="keyword">= (</span><span class="default">$c1</span><span class="keyword">[</span><span class="string">'red'</span><span class="keyword">]&nbsp; + </span><span class="default">$c2</span><span class="keyword">[</span><span class="string">'red'</span><span class="keyword">]&nbsp; + </span><span class="default">$c3</span><span class="keyword">[</span><span class="string">'red'</span><span class="keyword">]&nbsp; + </span><span class="default">$c4</span><span class="keyword">[</span><span class="string">'red'</span><span class="keyword">]&nbsp; ) &lt;&lt; </span><span class="default">14</span><span class="keyword">;
<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$g </span><span class="keyword">= (</span><span class="default">$c1</span><span class="keyword">[</span><span class="string">'green'</span><span class="keyword">] + </span><span class="default">$c2</span><span class="keyword">[</span><span class="string">'green'</span><span class="keyword">] + </span><span class="default">$c3</span><span class="keyword">[</span><span class="string">'green'</span><span class="keyword">] + </span><span class="default">$c4</span><span class="keyword">[</span><span class="string">'green'</span><span class="keyword">]) &lt;&lt; </span><span class="default">6</span><span class="keyword">;
<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$b </span><span class="keyword">= (</span><span class="default">$c1</span><span class="keyword">[</span><span class="string">'blue'</span><span class="keyword">]&nbsp; + </span><span class="default">$c2</span><span class="keyword">[</span><span class="string">'blue'</span><span class="keyword">]&nbsp; + </span><span class="default">$c3</span><span class="keyword">[</span><span class="string">'blue'</span><span class="keyword">]&nbsp; + </span><span class="default">$c4</span><span class="keyword">[</span><span class="string">'blue'</span><span class="keyword">] ) &gt;&gt; </span><span class="default">2</span><span class="keyword">;
<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$a </span><span class="keyword">= (</span><span class="default">$c1</span><span class="keyword">[</span><span class="string">'alpha'</span><span class="keyword">]&nbsp; + </span><span class="default">$c2</span><span class="keyword">[</span><span class="string">'alpha'</span><span class="keyword">]&nbsp; + </span><span class="default">$c3</span><span class="keyword">[</span><span class="string">'alpha'</span><span class="keyword">]&nbsp; + </span><span class="default">$c4</span><span class="keyword">[</span><span class="string">'alpha'</span><span class="keyword">] ) &gt;&gt; </span><span class="default">2</span><span class="keyword">;
<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$color </span><span class="keyword">= </span><span class="default">imagecolorallocatealpha</span><span class="keyword">(</span><span class="default">$src_img</span><span class="keyword">, </span><span class="default">$r</span><span class="keyword">,</span><span class="default">$g</span><span class="keyword">,</span><span class="default">$b</span><span class="keyword">,</span><span class="default">$a</span><span class="keyword">);
<br>&nbsp; &nbsp; &nbsp; } else {
<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$color </span><span class="keyword">= </span><span class="default">imagecolorat</span><span class="keyword">(</span><span class="default">$src_img</span><span class="keyword">, </span><span class="default">$old_x</span><span class="keyword">, </span><span class="default">$old_y</span><span class="keyword">);
<br>&nbsp; &nbsp; &nbsp; }
<br>&nbsp; &nbsp; } else {
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="comment">// this line sets the background colour
<br>&nbsp; &nbsp; &nbsp; </span><span class="default">$color </span><span class="keyword">= </span><span class="default">imagecolorallocatealpha</span><span class="keyword">(</span><span class="default">$src_img</span><span class="keyword">, </span><span class="default">255</span><span class="keyword">, </span><span class="default">255</span><span class="keyword">, </span><span class="default">255</span><span class="keyword">, </span><span class="default">127</span><span class="keyword">);
<br>&nbsp; &nbsp; }
<br>&nbsp; &nbsp; </span><span class="default">imagesetpixel</span><span class="keyword">(</span><span class="default">$rotate</span><span class="keyword">, </span><span class="default">$x</span><span class="keyword">, </span><span class="default">$y</span><span class="keyword">, </span><span class="default">$color</span><span class="keyword">);
<br>&nbsp; &nbsp; &nbsp; }
<br>&nbsp; &nbsp; }
<br>&nbsp; &nbsp; return </span><span class="default">$rotate</span><span class="keyword">;
<br>}
<br></span><span class="default">?&gt;</span>
</span>
</code></div>
  </div>
 </div>
  <div class="note" id="46338">  
  <a class="name">
  <strong class="user"><em>jon at driestone dot com</em></strong></a><div class="date" title="2004-10-07 08:42"><strong>9 years ago</strong></div>
  <div class="text" id="Hcom46338">
<div class="phpcode"><code><span class="html">
imagerotate does not preserve the alpha channel, so if you want to rotate a PNG you need to get 
<br>creative. I don't see any command to retrieve the alpha information from an image (as far as 
<br>I could see,) so you'll have to do a bit of manual labor before hand. In my case I created a 
<br>second PNG file with the alpha saved as RGB data and manually "copied" the data from source 
<br>to destination:
<br>
<br><span class="default">&lt;?php
<br>&nbsp; &nbsp; </span><span class="keyword">function </span><span class="default">alpha_rotate</span><span class="keyword">(</span><span class="default">$dst</span><span class="keyword">,</span><span class="default">$src</span><span class="keyword">,</span><span class="default">$rotate</span><span class="keyword">,</span><span class="default">$offsetX</span><span class="keyword">,</span><span class="default">$offsetY</span><span class="keyword">){
<br>
<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$top </span><span class="keyword">= </span><span class="default">imagecreatefrompng</span><span class="keyword">(</span><span class="string">"image_processing/shadow.png"</span><span class="keyword">);
<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$top_alpha </span><span class="keyword">= </span><span class="default">imagecreatefrompng</span><span class="keyword">(</span><span class="string">"image_processing/shadow_alpha.png"</span><span class="keyword">);
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">imagecopyresampled</span><span class="keyword">(</span><span class="default">$top</span><span class="keyword">,</span><span class="default">$src</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">,</span><span class="default">100</span><span class="keyword">,</span><span class="default">100</span><span class="keyword">,</span><span class="default">100</span><span class="keyword">,</span><span class="default">100</span><span class="keyword">);
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$top </span><span class="keyword">= </span><span class="default">imagerotate</span><span class="keyword">(</span><span class="default">$top</span><span class="keyword">,</span><span class="default">$rotate</span><span class="keyword">,</span><span class="default">0x000000</span><span class="keyword">);
<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$top_alpha </span><span class="keyword">= </span><span class="default">imagerotate</span><span class="keyword">(</span><span class="default">$top_alpha</span><span class="keyword">,</span><span class="default">$rotate</span><span class="keyword">,</span><span class="default">0x000000</span><span class="keyword">);
<br>&nbsp; &nbsp; 
<br>&nbsp; &nbsp; 
<br>&nbsp; &nbsp; &nbsp; &nbsp; for (</span><span class="default">$theX</span><span class="keyword">=</span><span class="default">0</span><span class="keyword">;</span><span class="default">$theX</span><span class="keyword">&lt;</span><span class="default">imagesx</span><span class="keyword">(</span><span class="default">$top</span><span class="keyword">);</span><span class="default">$theX</span><span class="keyword">++){
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; for (</span><span class="default">$theY</span><span class="keyword">=</span><span class="default">0</span><span class="keyword">;</span><span class="default">$theY</span><span class="keyword">&lt;</span><span class="default">imagesy</span><span class="keyword">(</span><span class="default">$top</span><span class="keyword">);</span><span class="default">$theY</span><span class="keyword">++){
<br>&nbsp; &nbsp; 
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$rgb </span><span class="keyword">= </span><span class="default">imagecolorat</span><span class="keyword">(</span><span class="default">$top</span><span class="keyword">,</span><span class="default">$theX</span><span class="keyword">,</span><span class="default">$theY</span><span class="keyword">);
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$r </span><span class="keyword">= (</span><span class="default">$rgb </span><span class="keyword">&gt;&gt; </span><span class="default">16</span><span class="keyword">) &amp; </span><span class="default">0xFF</span><span class="keyword">;
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$g </span><span class="keyword">= (</span><span class="default">$rgb </span><span class="keyword">&gt;&gt; </span><span class="default">8</span><span class="keyword">) &amp; </span><span class="default">0xFF</span><span class="keyword">;
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$b </span><span class="keyword">= </span><span class="default">$rgb </span><span class="keyword">&amp; </span><span class="default">0xFF</span><span class="keyword">;
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$rgb </span><span class="keyword">= </span><span class="default">imagecolorat</span><span class="keyword">(</span><span class="default">$top_alpha</span><span class="keyword">,</span><span class="default">$theX</span><span class="keyword">,</span><span class="default">$theY</span><span class="keyword">);
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$a </span><span class="keyword">= </span><span class="default">$rgb </span><span class="keyword">&amp; </span><span class="default">0xFF</span><span class="keyword">;
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$a </span><span class="keyword">= </span><span class="default">127</span><span class="keyword">-</span><span class="default">floor</span><span class="keyword">(</span><span class="default">$a</span><span class="keyword">/</span><span class="default">2</span><span class="keyword">);
<br>
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$myColor </span><span class="keyword">= </span><span class="default">imagecolorallocatealpha</span><span class="keyword">(</span><span class="default">$top</span><span class="keyword">,</span><span class="default">$r</span><span class="keyword">,</span><span class="default">$g</span><span class="keyword">,</span><span class="default">$b</span><span class="keyword">,</span><span class="default">$a</span><span class="keyword">);
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">imagesetpixel</span><span class="keyword">(</span><span class="default">$dst</span><span class="keyword">,(</span><span class="default">$theX</span><span class="keyword">+</span><span class="default">$offsetX</span><span class="keyword">),(</span><span class="default">$theY</span><span class="keyword">+</span><span class="default">$offsetY</span><span class="keyword">),</span><span class="default">$myColor</span><span class="keyword">);&nbsp; &nbsp; 
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }
<br>&nbsp; &nbsp; &nbsp; &nbsp; }
<br>&nbsp; &nbsp; }
<br></span><span class="default">?&gt;</span>
</span>
</code></div>
  </div>
 </div>
  <div class="note" id="46244">  
  <a class="name">
  <strong class="user"><em>christoph (at) raketenbasis (dot) de</em></strong></a><div class="date" title="2004-10-04 12:41"><strong>9 years ago</strong></div>
  <div class="text" id="Hcom46244">
<div class="phpcode"><code><span class="html">
The default direction of imageRotate() is counter clockwise. Heres a little function which solves the problem.<br><br><span class="default">&lt;?php<br><br>&nbsp; &nbsp; </span><span class="keyword">function </span><span class="default">rotate</span><span class="keyword">(&amp;</span><span class="default">$image_source</span><span class="keyword">, </span><span class="default">$rotate_value</span><span class="keyword">, </span><span class="default">$rotate_clockwise </span><span class="keyword">= </span><span class="default">true</span><span class="keyword">) {<br>&nbsp; &nbsp; &nbsp; &nbsp; if(</span><span class="default">$rotate_clockwise </span><span class="keyword">== </span><span class="default">true</span><span class="keyword">) {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$rotate_value </span><span class="keyword">= </span><span class="default">360 </span><span class="keyword">- </span><span class="default">$rotate_value</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; }<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$image_source </span><span class="keyword">= </span><span class="default">imageRotate</span><span class="keyword">(</span><span class="default">$image_source</span><span class="keyword">, </span><span class="default">$rotate_value</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">);<br>&nbsp; &nbsp; }<br>&nbsp; &nbsp; <br></span><span class="default">?&gt;</span>
</span>
</code></div>
  </div>
 </div>
  <div class="note" id="99631">  
  <a class="name">
  <strong class="user"><em>Leo</em></strong></a><div class="date" title="2010-08-27 06:32"><strong>4 years ago</strong></div>
  <div class="text" id="Hcom99631">
<div class="phpcode"><code><span class="html">
// angle in degrees, clockwise, allowed values from 0 to 360 degrees<br>&nbsp; &nbsp; function rotateImage ($image, $angle)<br>&nbsp; &nbsp; {<br>&nbsp; &nbsp; &nbsp; &nbsp; if ( ($angle &lt; 0) || ($angle &gt; 360) )<br>&nbsp; &nbsp; &nbsp; &nbsp; {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; exit ("Error, angle passed out of range: [0,360]");<br>&nbsp; &nbsp; &nbsp; &nbsp; }<br>&nbsp; &nbsp; &nbsp; &nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; $width&nbsp; &nbsp; = imagesx ($image);<br>&nbsp; &nbsp; &nbsp; &nbsp; $height&nbsp; &nbsp; = imagesy ($image);<br>&nbsp; &nbsp; &nbsp; &nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; $dstImage = imagecreatetruecolor ($width, $height);<br>&nbsp; &nbsp; &nbsp; &nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; if ( ($angle == 0) || ($angle == 360) )<br>&nbsp; &nbsp; &nbsp; &nbsp; {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; // Just copy image to output:<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; imagecopy ($dstImage, $image, 0, 0, 0, 0, $width, $height);<br>&nbsp; &nbsp; &nbsp; &nbsp; }<br>&nbsp; &nbsp; &nbsp; &nbsp; else<br>&nbsp; &nbsp; &nbsp; &nbsp; {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $centerX = floor ($width / 2);<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $centerY = floor ($height / 2);<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; // Run on all pixels of the destination image and fill them:<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; for ($dstImageX = 0; $dstImageX &lt; $width; $dstImageX++)<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; for ($dstImageY = 0; $dstImageY &lt; $height; $dstImageY++)<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; // Calculate pixel coordinate in coordinate system centered at the image center:<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $x = $dstImageX - $centerX;<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $y = $centerY - $dstImageY;<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if ( ($x == 0) &amp;&amp; ($y == 0) )<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; // We are in the image center, this pixel should be copied as is:<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $srcImageX = $x;<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $srcImageY = $y;<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; else<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $r = sqrt ($x * $x + $y * $y); // radius - absolute distance of the current point from image center<br><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $curAngle = asin ($y / $r); // angle of the current point [rad]<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if ($x &lt; 0)<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $curAngle = pi () - $curAngle;<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $newAngle = $curAngle + $angle * pi () / 180; // new angle [rad]<br><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; // Calculate new point coordinates (after rotation) in coordinate system at image center<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $newXRel = floor ($r * cos ($newAngle));<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $newYRel = floor ($r * sin ($newAngle));<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; // Convert to image absolute coordinates<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $srcImageX = $newXRel + $centerX;<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $srcImageY = $centerY - $newYRel;<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $pixelColor = imagecolorat&nbsp; ($image, $srcImageX, $srcImageY); // get source pixel color<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; imagesetpixel ($dstImage, $dstImageX, $dstImageY, $pixelColor); // write destination pixel<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br>&nbsp; &nbsp; &nbsp; &nbsp; }<br>&nbsp; &nbsp; &nbsp; &nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; return $dstImage;<br>&nbsp; &nbsp; }</span>
</code></div>
  </div>
 </div>
  <div class="note" id="96333">  
  <a class="name">
  <strong class="user"><em>c kelley at ca - cycleworks dot com</em></strong></a><div class="date" title="2010-02-20 02:59"><strong>4 years ago</strong></div>
  <div class="text" id="Hcom96333">
<div class="phpcode"><code><span class="html">
Note, of the rotate functions below, only beau's worked for me. Not sure if it is because of my source image, but upon rotating, the background became blue. <br><br>The code snippet below is what I used to prepare UPS shipping labels. The UPS xml api will return a base64 encoded gif, but it is sideways, so as to print on the top half of a 8.5x11 "letter" page. We are saving it in a database and sending it to a label printer, so needed it rotated...<br><br>The other code further down didn't make the background blue, however it did make the image leave the canvas by about 50%. Additionally, the imagecolorallocate() function has an example describing how to set the background color. That didn't work for me. Even though the blue BG is #0000ff, using that code didn't work, I had to use the transparent trick below. <br><br>The GD image functions may be in their infancy, however are a great reminder to me how powerful php is! Also, ubuntu apache users will need to apt-get install php5-gd to get the gd functions.<br><br><span class="default">&lt;?php<br>&nbsp; &nbsp; &nbsp; &nbsp; $image</span><span class="keyword">=</span><span class="default">imagecreatefromgif</span><span class="keyword">( </span><span class="string">'data://text/plain;base64,'</span><span class="keyword">.</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">shipmentLabelGraphicImage </span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$image</span><span class="keyword">=</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">rotateImage</span><span class="keyword">(</span><span class="default">$image</span><span class="keyword">, </span><span class="default">90</span><span class="keyword">); </span><span class="comment">// Note: rotateImage turns our background to blue!<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$blue </span><span class="keyword">= </span><span class="default">imagecolorallocate</span><span class="keyword">(</span><span class="default">$image</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">255</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">imagecolortransparent</span><span class="keyword">(</span><span class="default">$image</span><span class="keyword">, </span><span class="default">$blue</span><span class="keyword">);&nbsp; &nbsp; </span><span class="comment">// make blue transparent, so image isn't goofy<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">imagepng</span><span class="keyword">(</span><span class="default">$image</span><span class="keyword">,</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">shipmentTrackingNumber</span><span class="keyword">.</span><span class="string">".png"</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; echo </span><span class="string">'&lt;P&gt;&lt;img src="'</span><span class="keyword">.</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">shipmentTrackingNumber</span><span class="keyword">.</span><span class="string">'.png"&gt;&lt;/P&gt;'</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">imagedestroy</span><span class="keyword">(</span><span class="default">$image</span><span class="keyword">);<br></span><span class="default">?&gt;</span>
</span>
</code></div>
  </div>
 </div>
  <div class="note" id="93636">  
  <a class="name">
  <strong class="user"><em>ewald at dutchvisual dot nl</em></strong></a><div class="date" title="2009-09-20 04:35"><strong>4 years ago</strong></div>
  <div class="text" id="Hcom93636">
<div class="phpcode"><code><span class="html">
This function will rotate the image. The image will be resampled completely.<br><br><span class="default">&lt;?php<br></span><span class="keyword">function </span><span class="default">rotateImage</span><span class="keyword">(</span><span class="default">$img</span><span class="keyword">, </span><span class="default">$rotation</span><span class="keyword">) {<br>&nbsp; </span><span class="default">$width </span><span class="keyword">= </span><span class="default">imagesx</span><span class="keyword">(</span><span class="default">$img</span><span class="keyword">);<br>&nbsp; </span><span class="default">$height </span><span class="keyword">= </span><span class="default">imagesy</span><span class="keyword">(</span><span class="default">$img</span><span class="keyword">);<br>&nbsp; switch(</span><span class="default">$rotation</span><span class="keyword">) {<br>&nbsp; &nbsp; case </span><span class="default">90</span><span class="keyword">: </span><span class="default">$newimg</span><span class="keyword">= @</span><span class="default">imagecreatetruecolor</span><span class="keyword">(</span><span class="default">$height </span><span class="keyword">, </span><span class="default">$width </span><span class="keyword">);break;<br>&nbsp; &nbsp; case </span><span class="default">180</span><span class="keyword">: </span><span class="default">$newimg</span><span class="keyword">= @</span><span class="default">imagecreatetruecolor</span><span class="keyword">(</span><span class="default">$width </span><span class="keyword">, </span><span class="default">$height </span><span class="keyword">);break;<br>&nbsp; &nbsp; case </span><span class="default">270</span><span class="keyword">: </span><span class="default">$newimg</span><span class="keyword">= @</span><span class="default">imagecreatetruecolor</span><span class="keyword">(</span><span class="default">$height </span><span class="keyword">, </span><span class="default">$width </span><span class="keyword">);break;<br>&nbsp; &nbsp; case </span><span class="default">0</span><span class="keyword">: return </span><span class="default">$img</span><span class="keyword">;break;<br>&nbsp; &nbsp; case </span><span class="default">360</span><span class="keyword">: return </span><span class="default">$img</span><span class="keyword">;break;<br>&nbsp; }<br>&nbsp; if(</span><span class="default">$newimg</span><span class="keyword">) { <br>&nbsp; &nbsp; for(</span><span class="default">$i </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">;</span><span class="default">$i </span><span class="keyword">&lt; </span><span class="default">$width </span><span class="keyword">; </span><span class="default">$i</span><span class="keyword">++) { <br>&nbsp; &nbsp; &nbsp; for(</span><span class="default">$j </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">;</span><span class="default">$j </span><span class="keyword">&lt; </span><span class="default">$height </span><span class="keyword">; </span><span class="default">$j</span><span class="keyword">++) {<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$reference </span><span class="keyword">= </span><span class="default">imagecolorat</span><span class="keyword">(</span><span class="default">$img</span><span class="keyword">,</span><span class="default">$i</span><span class="keyword">,</span><span class="default">$j</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; switch(</span><span class="default">$rotation</span><span class="keyword">) {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; case </span><span class="default">90</span><span class="keyword">: if(!@</span><span class="default">imagesetpixel</span><span class="keyword">(</span><span class="default">$newimg</span><span class="keyword">, (</span><span class="default">$height </span><span class="keyword">- </span><span class="default">1</span><span class="keyword">) - </span><span class="default">$j</span><span class="keyword">, </span><span class="default">$i</span><span class="keyword">, </span><span class="default">$reference </span><span class="keyword">)){return </span><span class="default">false</span><span class="keyword">;}break;<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; case </span><span class="default">180</span><span class="keyword">: if(!@</span><span class="default">imagesetpixel</span><span class="keyword">(</span><span class="default">$newimg</span><span class="keyword">, </span><span class="default">$i</span><span class="keyword">, (</span><span class="default">$height </span><span class="keyword">- </span><span class="default">1</span><span class="keyword">) - </span><span class="default">$j</span><span class="keyword">, </span><span class="default">$reference </span><span class="keyword">)){return </span><span class="default">false</span><span class="keyword">;}break;<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; case </span><span class="default">270</span><span class="keyword">: if(!@</span><span class="default">imagesetpixel</span><span class="keyword">(</span><span class="default">$newimg</span><span class="keyword">, </span><span class="default">$j</span><span class="keyword">, </span><span class="default">$width </span><span class="keyword">- </span><span class="default">$i</span><span class="keyword">, </span><span class="default">$reference </span><span class="keyword">)){return </span><span class="default">false</span><span class="keyword">;}break;<br>&nbsp; &nbsp; &nbsp; &nbsp; }<br>&nbsp; &nbsp; &nbsp; } <br>&nbsp; &nbsp; } return </span><span class="default">$newimg</span><span class="keyword">; <br>&nbsp; } <br>&nbsp; return </span><span class="default">false</span><span class="keyword">;<br>}<br></span><span class="default">?&gt;<br></span><br>you can call it this way:<br><span class="default">&lt;?php<br>$img </span><span class="keyword">= </span><span class="default">rotateImage</span><span class="keyword">(</span><span class="default">$imagetorotate</span><span class="keyword">,</span><span class="string">"degrees"</span><span class="keyword">);<br></span><span class="default">?&gt;</span>
</span>
</code></div>
  </div>
 </div>
  <div class="note" id="92430">  
  <a class="name">
  <strong class="user"><em>gglockner AT NOSPAMdwaffler DOT com</em></strong></a><div class="date" title="2009-07-23 12:36"><strong>5 years ago</strong></div>
  <div class="text" id="Hcom92430">
<div class="phpcode"><code><span class="html">
If you're going to do a rotation by hand instead of using the imagerotate function, you can use the imagecopy function to copy a single pixel instead of determining the pixel color and setting the pixel.&nbsp; Not only is this shorter and cleaner, but it also works with images that are not truecolor (on my system, imagecolorat fails with an image that is not truecolor).</span>
</code></div>
  </div>
 </div>
  <div class="note" id="92286">  
  <a class="name">
  <strong class="user"><em>jeprubio</em></strong></a><div class="date" title="2009-07-17 08:52"><strong>5 years ago</strong></div>
  <div class="text" id="Hcom92286">
<div class="phpcode"><code><span class="html">
hi,<br>if you have a image with transparent color in previous function "function rotateImage($img1, $rec)"<br>just before "return $img2;" you have to do:<br>imagecolortransparent($img2, imagecolorallocate($img2, 0, 0, 0));<br>Best regards</span>
</code></div>
  </div>
 </div>
  <div class="note" id="57226">  
  <a class="name">
  <strong class="user"><em>simon_nuttall at hotmail dot com</em></strong></a><div class="date" title="2005-09-27 10:06"><strong>8 years ago</strong></div>
  <div class="text" id="Hcom57226">
<div class="phpcode"><code><span class="html">
The following is potentially useful. It extracts the central largest circle of an image into a square of specified size, and optionally rotates it. The rest of the square is made transparent, so useful for drawing over other images. I've named it after binocular effect because on some old TV shows whenever they show someone looking through binoculars the screen shows a big circular image with black edges.<br><br><span class="default">&lt;?php<br><br></span><span class="keyword">function </span><span class="default">image_binocular_effect</span><span class="keyword">(</span><span class="default">$src</span><span class="keyword">, </span><span class="default">$bearing</span><span class="keyword">, </span><span class="default">$out_square</span><span class="keyword">) {<br> </span><span class="comment">// the source image is resampled to fit within the specified square, and rotated clockwise by bearing.<br> // the largest circle within the image is retained, the rest made transparent.<br> </span><span class="default">$out </span><span class="keyword">= </span><span class="default">imagecreatetruecolor</span><span class="keyword">(</span><span class="default">$out_square</span><span class="keyword">, </span><span class="default">$out_square</span><span class="keyword">);<br> </span><span class="default">$width</span><span class="keyword">=</span><span class="default">imagesx</span><span class="keyword">(</span><span class="default">$src</span><span class="keyword">);<br> </span><span class="default">$height</span><span class="keyword">=</span><span class="default">imagesy</span><span class="keyword">(</span><span class="default">$src</span><span class="keyword">);<br> </span><span class="default">$square</span><span class="keyword">=</span><span class="default">min</span><span class="keyword">(</span><span class="default">$width</span><span class="keyword">, </span><span class="default">$height</span><span class="keyword">);<br> </span><span class="default">imagecopyresampled</span><span class="keyword">(</span><span class="default">$out</span><span class="keyword">, </span><span class="default">$src</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, (</span><span class="default">$width </span><span class="keyword">- </span><span class="default">$square</span><span class="keyword">)/</span><span class="default">2 </span><span class="keyword">, (</span><span class="default">$height </span><span class="keyword">- </span><span class="default">$square</span><span class="keyword">)/</span><span class="default">2</span><span class="keyword">, </span><span class="default">$out_square</span><span class="keyword">, </span><span class="default">$out_square</span><span class="keyword">, </span><span class="default">$square</span><span class="keyword">, </span><span class="default">$square</span><span class="keyword">);<br><br> </span><span class="default">$mask </span><span class="keyword">= </span><span class="default">imagecreatetruecolor</span><span class="keyword">(</span><span class="default">$out_square</span><span class="keyword">, </span><span class="default">$out_square</span><span class="keyword">);<br> </span><span class="default">$black </span><span class="keyword">= </span><span class="default">ImageColorAllocate </span><span class="keyword">(</span><span class="default">$mask</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">);<br> </span><span class="default">$white </span><span class="keyword">= </span><span class="default">ImageColorAllocate </span><span class="keyword">(</span><span class="default">$mask</span><span class="keyword">, </span><span class="default">255</span><span class="keyword">, </span><span class="default">255</span><span class="keyword">, </span><span class="default">255</span><span class="keyword">);<br> </span><span class="default">imagefilledrectangle</span><span class="keyword">(</span><span class="default">$mask </span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">$out_square</span><span class="keyword">, </span><span class="default">$out_square</span><span class="keyword">, </span><span class="default">$white</span><span class="keyword">);<br> </span><span class="default">$centrexy</span><span class="keyword">=</span><span class="default">$out_square </span><span class="keyword">/ </span><span class="default">2</span><span class="keyword">;<br> </span><span class="default">imagefilledellipse</span><span class="keyword">(</span><span class="default">$mask</span><span class="keyword">, </span><span class="default">$centrexy</span><span class="keyword">, </span><span class="default">$centrexy</span><span class="keyword">, </span><span class="default">$out_square</span><span class="keyword">, </span><span class="default">$out_square</span><span class="keyword">, </span><span class="default">$black</span><span class="keyword">);<br> </span><span class="default">ImageColorTransparent</span><span class="keyword">(</span><span class="default">$mask</span><span class="keyword">, </span><span class="default">$black</span><span class="keyword">);<br> </span><span class="default">imagecopymerge</span><span class="keyword">(</span><span class="default">$out</span><span class="keyword">, </span><span class="default">$mask</span><span class="keyword">,&nbsp; </span><span class="default">0</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">$out_square</span><span class="keyword">, </span><span class="default">$out_square</span><span class="keyword">, </span><span class="default">100</span><span class="keyword">);<br> if (</span><span class="default">$bearing </span><span class="keyword">!= </span><span class="default">0</span><span class="keyword">) {<br>&nbsp; </span><span class="default">$rotated_img</span><span class="keyword">=</span><span class="default">imagerotate</span><span class="keyword">(</span><span class="default">$out </span><span class="keyword">, </span><span class="default">360</span><span class="keyword">-</span><span class="default">$bearing</span><span class="keyword">, </span><span class="default">$white</span><span class="keyword">);<br>&nbsp; </span><span class="comment">// take off only the rotated width<br>&nbsp; </span><span class="default">$rotated_map_width </span><span class="keyword">= </span><span class="default">imagesx</span><span class="keyword">(</span><span class="default">$rotated_img</span><span class="keyword">);<br>&nbsp; </span><span class="default">$rotated_map_height </span><span class="keyword">= </span><span class="default">imagesy</span><span class="keyword">(</span><span class="default">$rotated_img</span><span class="keyword">);<br>&nbsp; </span><span class="default">imagecopy</span><span class="keyword">(</span><span class="default">$out</span><span class="keyword">, </span><span class="default">$rotated_img</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, (</span><span class="default">$rotated_map_width </span><span class="keyword">- </span><span class="default">$out_square</span><span class="keyword">) / </span><span class="default">2</span><span class="keyword">, (</span><span class="default">$rotated_map_height </span><span class="keyword">- </span><span class="default">$out_square</span><span class="keyword">) / </span><span class="default">2</span><span class="keyword">, </span><span class="default">$out_square</span><span class="keyword">, </span><span class="default">$out_square</span><span class="keyword">);<br>&nbsp; }<br> </span><span class="default">ImageColorTransparent</span><span class="keyword">(</span><span class="default">$out</span><span class="keyword">, </span><span class="default">$white</span><span class="keyword">);<br> return </span><span class="default">$out</span><span class="keyword">;<br>}<br><br></span><span class="comment">// Create a sample image to demonstrate the effect, but looks much better on real photos.<br><br></span><span class="default">$src </span><span class="keyword">= </span><span class="default">imagecreatetruecolor</span><span class="keyword">(</span><span class="default">200</span><span class="keyword">, </span><span class="default">50</span><span class="keyword">);<br></span><span class="default">imagefilledrectangle</span><span class="keyword">(</span><span class="default">$src</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">200</span><span class="keyword">, </span><span class="default">50</span><span class="keyword">, </span><span class="default">imagecolorallocate</span><span class="keyword">(</span><span class="default">$src</span><span class="keyword">, </span><span class="default">255</span><span class="keyword">, </span><span class="default">255</span><span class="keyword">, </span><span class="default">255</span><span class="keyword">));<br></span><span class="default">ImageString</span><span class="keyword">(</span><span class="default">$src</span><span class="keyword">, </span><span class="default">3</span><span class="keyword">, </span><span class="default">10</span><span class="keyword">, </span><span class="default">10</span><span class="keyword">, </span><span class="string">"This is a sample image to illustrate the binocular effect"</span><span class="keyword">, </span><span class="default">imagecolorallocate</span><span class="keyword">(</span><span class="default">$im</span><span class="keyword">, </span><span class="default">192</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">));<br></span><span class="default">$img</span><span class="keyword">=</span><span class="default">image_binocular_effect</span><span class="keyword">(</span><span class="default">$src</span><span class="keyword">, </span><span class="default">72</span><span class="keyword">, </span><span class="default">50</span><span class="keyword">);<br></span><span class="default">ImagePNG</span><span class="keyword">(</span><span class="default">$img</span><span class="keyword">,</span><span class="string">"test.png"</span><span class="keyword">);<br><br></span><span class="default">?&gt;</span>
</span>
</code></div>
  </div>
 </div></div>

 
</section>    </section><!-- layout-content -->
        


  </div><!-- layout -->
         
  

    
 <!-- External and third party libraries. -->
 







<a id="toTop" href="javascript:;"><span id="toTopHover"></span><img width="40" height="40" alt="To Top" src="../../images/to-top%402x.png"></a>



<!-- Mirrored from php.net/manual/en/function.imagerotate.php by HTTrack Website Copier/3.x [XR&CO'2013], Thu, 28 Aug 2014 16:00:44 GMT -->


</body></html>