<html><!-- Mirrored from php.net/manual/en/function.set-time-limit.php by HTTrack Website Copier/3.x [XR&CO'2013], Thu, 28 Aug 2014 15:29:33 GMT --><!-- Added by HTTrack --><head><meta http-equiv="content-type" content="text/html;charset=utf-8"><!-- /Added by HTTrack -->


  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0"> 

  <title>set_time_limit</title>

 <link rel="shortcut icon" href="../../favicon.ico">
 <link rel="search" type="application/opensearchdescription+xml" href="http://php.net/phpnetimprovedsearch.src" title="Add PHP.net search">
 <link rel="alternate" type="application/atom+xml" href="http://php.net/releases/feed.php" title="PHP Release feed">
 <link rel="alternate" type="application/atom+xml" href="http://php.net/feed.atom" title="PHP: Hypertext Preprocessor">

 <link rel="canonical" href="function.set-time-limit.html">
 <link rel="shorturl" href="http://php.net/set-time-limit">
 <link rel="alternate" href="http://php.net/set-time-limit" hreflang="x-default">

 <link rel="contents" href="index-2.html">
 <link rel="index" href="ref.info.html">
 <link rel="prev" href="function.set-magic-quotes-runtime.html">
 <link rel="next" href="function.sys-get-temp-dir.html">

 <link rel="alternate" href="function.set-time-limit.html" hreflang="en">
 <link rel="alternate" href="http://php.net/manual/pt_BR/function.set-time-limit.php" hreflang="pt_BR">
 <link rel="alternate" href="http://php.net/manual/zh/function.set-time-limit.php" hreflang="zh">
 <link rel="alternate" href="http://php.net/manual/fr/function.set-time-limit.php" hreflang="fr">
 <link rel="alternate" href="http://php.net/manual/de/function.set-time-limit.php" hreflang="de">
 <link rel="alternate" href="http://php.net/manual/it/function.set-time-limit.php" hreflang="it">
 <link rel="alternate" href="http://php.net/manual/ja/function.set-time-limit.php" hreflang="ja">
 <link rel="alternate" href="http://php.net/manual/ro/function.set-time-limit.php" hreflang="ro">
 <link rel="alternate" href="http://php.net/manual/ru/function.set-time-limit.php" hreflang="ru">
 <link rel="alternate" href="http://php.net/manual/es/function.set-time-limit.php" hreflang="es">
 <link rel="alternate" href="http://php.net/manual/tr/function.set-time-limit.php" hreflang="tr">

<link rel="stylesheet" type="text/css" href="../../cached8fe1.css?t=1401250819&amp;f=/fonts/Fira/fira.css" media="screen">
<link rel="stylesheet" type="text/css" href="../../cached4b8d.css?t=1404368420&amp;f=/fonts/Font-Awesome/css/fontello.css" media="screen">
<link rel="stylesheet" type="text/css" href="../../cached5065.css?t=1403329232&amp;f=/styles/theme-base.css" media="screen">
<link rel="stylesheet" type="text/css" href="../../cachedc78d.css?t=1401249623&amp;f=/styles/theme-medium.css" media="screen">

 <!--[if lte IE 7]>
 <link rel="stylesheet" type="text/css" href="http://php.net/styles/workarounds.ie7.css" media="screen">
 <![endif]-->

 <!--[if lte IE 8]>
 <script type="text/javascript">
  window.brokenIE = true;
 </script>
 <![endif]-->

 <!--[if lte IE 9]>
 <link rel="stylesheet" type="text/css" href="http://php.net/styles/workarounds.ie9.css" media="screen">
 <![endif]-->

 <!--[if IE]>
 <script type="text/javascript" src="http://php.net/js/ext/html5.js"></script>
 <![endif]-->

 <base>

</head>
<body class="docs " style="">


<div class="headsup"><a href="http://php.net/index.php#id2014-08-28-1">PHP 5.6.0 released</a></div>
<nav id="trick"><div><dl>
<dt><a href="getting-started.html">Getting Started</a></dt>
	<dd><a href="introduction.html">Introduction</a></dd>
	<dd><a href="tutorial.html">A simple tutorial</a></dd>
<dt><a href="langref.html">Language Reference</a></dt>
	<dd><a href="language.basic-syntax.html">Basic syntax</a></dd>
	<dd><a href="language.types.html">Types</a></dd>
	<dd><a href="language.variables.html">Variables</a></dd>
	<dd><a href="language.constants.html">Constants</a></dd>
	<dd><a href="language.expressions.html">Expressions</a></dd>
	<dd><a href="language.operators.html">Operators</a></dd>
	<dd><a href="language.control-structures.html">Control Structures</a></dd>
	<dd><a href="language.functions.html">Functions</a></dd>
	<dd><a href="language.oop5.html">Classes and Objects</a></dd>
	<dd><a href="language.namespaces.html">Namespaces</a></dd>
	<dd><a href="language.exceptions.html">Exceptions</a></dd>
	<dd><a href="language.generators.html">Generators</a></dd>
	<dd><a href="language.references.html">References Explained</a></dd>
	<dd><a href="reserved.variables.html">Predefined Variables</a></dd>
	<dd><a href="reserved.exceptions.html">Predefined Exceptions</a></dd>
	<dd><a href="reserved.interfaces.html">Predefined Interfaces and Classes</a></dd>
	<dd><a href="context.html">Context options and parameters</a></dd>
	<dd><a href="wrappers.html">Supported Protocols and Wrappers</a></dd>
</dl>
<dl>
<dt><a href="security.html">Security</a></dt>
	<dd><a href="security.intro.html">Introduction</a></dd>
	<dd><a href="security.general.html">General considerations</a></dd>
	<dd><a href="security.cgi-bin.html">Installed as CGI binary</a></dd>
	<dd><a href="security.apache.html">Installed as an Apache module</a></dd>
	<dd><a href="security.filesystem.html">Filesystem Security</a></dd>
	<dd><a href="security.database.html">Database Security</a></dd>
	<dd><a href="security.errors.html">Error Reporting</a></dd>
	<dd><a href="security.globals.html">Using Register Globals</a></dd>
	<dd><a href="security.variables.html">User Submitted Data</a></dd>
	<dd><a href="security.magicquotes.html">Magic Quotes</a></dd>
	<dd><a href="security.hiding.html">Hiding PHP</a></dd>
	<dd><a href="security.current.html">Keeping Current</a></dd>
<dt><a href="features.html">Features</a></dt>
	<dd><a href="features.http-auth.html">HTTP authentication with PHP</a></dd>
	<dd><a href="features.cookies.html">Cookies</a></dd>
	<dd><a href="features.sessions.html">Sessions</a></dd>
	<dd><a href="features.xforms.html">Dealing with XForms</a></dd>
	<dd><a href="features.file-upload.html">Handling file uploads</a></dd>
	<dd><a href="features.remote-files.html">Using remote files</a></dd>
	<dd><a href="features.connection-handling.html">Connection handling</a></dd>
	<dd><a href="features.persistent-connections.html">Persistent Database Connections</a></dd>
	<dd><a href="features.safe-mode.html">Safe Mode</a></dd>
	<dd><a href="features.commandline.html">Command line usage</a></dd>
	<dd><a href="features.gc.html">Garbage Collection</a></dd>
	<dd><a href="features.dtrace.html">DTrace Dynamic Tracing</a></dd>
</dl>
<dl>
<dt><a href="funcref.html">Function Reference</a></dt>
	<dd><a href="refs.basic.php.html">Affecting PHP's Behaviour</a></dd>
	<dd><a href="refs.utilspec.audio.html">Audio Formats Manipulation</a></dd>
	<dd><a href="refs.remote.auth.html">Authentication Services</a></dd>
	<dd><a href="refs.utilspec.cmdline.html">Command Line Specific Extensions</a></dd>
	<dd><a href="refs.compression.html">Compression and Archive Extensions</a></dd>
	<dd><a href="refs.creditcard.html">Credit Card Processing</a></dd>
	<dd><a href="refs.crypto.html">Cryptography Extensions</a></dd>
	<dd><a href="refs.database.html">Database Extensions</a></dd>
	<dd><a href="refs.calendar.html">Date and Time Related Extensions</a></dd>
	<dd><a href="refs.fileprocess.file.html">File System Related Extensions</a></dd>
	<dd><a href="refs.international.html">Human Language and Character Encoding Support</a></dd>
	<dd><a href="refs.utilspec.image.html">Image Processing and Generation</a></dd>
	<dd><a href="refs.remote.mail.html">Mail Related Extensions</a></dd>
	<dd><a href="refs.math.html">Mathematical Extensions</a></dd>
	<dd><a href="refs.utilspec.nontext.html">Non-Text MIME Output</a></dd>
	<dd><a href="refs.fileprocess.process.html">Process Control Extensions</a></dd>
	<dd><a href="refs.basic.other.html">Other Basic Extensions</a></dd>
	<dd><a href="refs.remote.other.html">Other Services</a></dd>
	<dd><a href="refs.search.html">Search Engine Extensions</a></dd>
	<dd><a href="refs.utilspec.server.html">Server Specific Extensions</a></dd>
	<dd><a href="refs.basic.session.html">Session Extensions</a></dd>
	<dd><a href="refs.basic.text.html">Text Processing</a></dd>
	<dd><a href="refs.basic.vartype.html">Variable and Type Related Extensions</a></dd>
	<dd><a href="refs.webservice.html">Web Services</a></dd>
	<dd><a href="refs.utilspec.windows.html">Windows Only Extensions</a></dd>
	<dd><a href="refs.xml.html">XML Manipulation</a></dd>
</dl>
<dl>
<dt>Keyboard Shortcuts</dt><dt>?</dt>
<dd>This help</dd>
<dt>j</dt>
<dd>Next menu item</dd>
<dt>k</dt>
<dd>Previous menu item</dd>
<dt>g p</dt>
<dd>Previous man page</dd>
<dt>g n</dt>
<dd>Next man page</dd>
<dt>G</dt>
<dd>Scroll to bottom</dd>
<dt>g g</dt>
<dd>Scroll to top</dd>
<dt>g h</dt>
<dd>Goto homepage</dd>
<dt>g s</dt>
<dd>Goto search<br>(current page)</dd>
<dt>/</dt>
<dd>Focus search box</dd>
</dl></div></nav>
<div id="goto">
    <div class="search">
         <div class="text"></div>
         <div class="results"><ul></ul></div>
   </div>
</div>

  <div id="breadcrumbs" class="row-fluid">
          
              
        <ul class="breadcrumbs-container">
            <li><a href="index-2.html">PHP Manual</a></li>      <li><a href="funcref.html">Function Reference</a></li>      <li><a href="refs.basic.php.html">Affecting PHP's Behaviour</a></li>      <li><a href="book.info.html">PHP Options/Info</a></li>      <li><a href="ref.info.html">PHP Options/Info Functions</a></li>    </ul>
  </div>




<div id="layout">
  <section id="layout-content">
  <div id="function.set-time-limit" class="refentry">
 <div class="refnamediv">
  <h1 class="refname">set_time_limit</h1>
  <p class="verinfo">(PHP 4, PHP 5)</p><p class="refpurpose"><span class="refname">set_time_limit</span> â€” <span class="dc-title">Limits the maximum execution time</span></p>

 </div>
 
 <div class="refsect1 description" id="refsect1-function.set-time-limit-description">
  <h3 class="title">Description</h3>
  <div class="methodsynopsis dc-description">
   <span class="type">bool</span> <span class="methodname"><strong>set_time_limit</strong></span>
    ( <span class="methodparam"><span class="type">int</span> <code class="parameter">$seconds</code></span>
   )</div>

  <p class="para rdfs-comment">
   Set the number of seconds a script is allowed to run. If this is reached,
   the script returns a fatal error. The default limit is 30 seconds or, if
   it exists, the <em>max_execution_time</em> value defined in the
   <var class="filename">php.ini</var>.
  </p>
  <p class="para">
   When called, <span class="function"><strong>set_time_limit()</strong></span> restarts the timeout
   counter from zero. In other words, if the timeout is the default 30
   seconds, and 25 seconds into script execution a call such as
   <em>set_time_limit(20)</em> is made, the script will run for a
   total of 45 seconds before timing out.
  </p>
 </div>


 <div class="refsect1 parameters" id="refsect1-function.set-time-limit-parameters">
  <h3 class="title">Parameters</h3>
  <p class="para">
   </p><dl>

    
     <dt>
<code class="parameter">seconds</code></dt>

     <dd>

      <p class="para">
       The maximum execution time, in seconds. If set to zero, no time limit
       is imposed.
      </p>
     </dd>

    
   </dl>

  <p></p>
 </div>


 <div class="refsect1 returnvalues" id="refsect1-function.set-time-limit-returnvalues">
  <h3 class="title">Return Values</h3>
  <p class="para">
   Returns <strong><code>TRUE</code></strong> on success, or <strong><code>FALSE</code></strong> on failure.
  </p>
 </div>


 <div class="refsect1 notes" id="refsect1-function.set-time-limit-notes">
  <h3 class="title">Notes</h3>
  <div class="warning"><strong class="warning">Warning</strong>
   <p class="para">
    This function has no effect when PHP is running in <a href="ini.sect.safe-mode.html#ini.safe-mode" class="link">safe mode</a>. There is
    no workaround other than turning off safe mode or changing the time limit
    in the <var class="filename">php.ini</var>.
   </p>
  </div>
  <blockquote class="note"><p><strong class="note">Note</strong>: 
   </p><p class="para">
    The <span class="function"><strong>set_time_limit()</strong></span> function and the configuration 
    directive <a href="info.configuration.html#ini.max-execution-time" class="link">max_execution_time</a>
    only affect the execution time of the script itself.  Any time spent on
    activity that happens outside the execution of the script such as system
    calls using <span class="function"><a href="function.system.html" class="function">system()</a></span>, stream operations, database
    queries, etc. is not included when determining the maximum time that the
    script has been running.
    This is not true on Windows where the measured time is real.
   </p>
  <p></p></blockquote>
 </div>


 <div class="refsect1 seealso" id="refsect1-function.set-time-limit-seealso">
  <h3 class="title">See Also</h3>
  <p class="para">
   </p><ul class="simplelist">
    <li class="member"><a href="info.configuration.html#ini.max-execution-time" class="link">max_execution_time</a></li>
    <li class="member"><a href="info.configuration.html#ini.max-input-time" class="link">max_input_time</a></li>
   </ul>
  <p></p>
 </div>


</div>
<section id="usernotes">
 <div class="head"><h3 class="title">User Contributed Notes</h3></div><div id="allnotes">
  <div class="note" id="115057">  
  <a class="name">
  <strong class="user"><em>kexianbin at diyism dot com</em></strong></a><div class="date" title="2014-05-20 09:41"><strong>3 months ago</strong></div>
  <div class="text" id="Hcom115057">
<div class="phpcode"><code><span class="html">
Both set_time_limit(...) and&nbsp; ini_set('max_execution_time',...); won't count the time cost of sleep,file_get_contents,shell_exec,mysql_query etc, so i build this function my_background_exec(), to run static method/function in background/detached process and time is out kill it:<br><br>my_exec.php:<br><span class="default">&lt;?php<br></span><span class="keyword">function </span><span class="default">my_background_exec</span><span class="keyword">(</span><span class="default">$function_name</span><span class="keyword">, </span><span class="default">$params</span><span class="keyword">, </span><span class="default">$str_requires</span><span class="keyword">, </span><span class="default">$timeout</span><span class="keyword">=</span><span class="default">600</span><span class="keyword">)<br>&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; {</span><span class="default">$map</span><span class="keyword">=array(</span><span class="string">'"'</span><span class="keyword">=&gt;</span><span class="string">'\"'</span><span class="keyword">, </span><span class="string">'$'</span><span class="keyword">=&gt;</span><span class="string">'\$'</span><span class="keyword">, </span><span class="string">'`'</span><span class="keyword">=&gt;</span><span class="string">'\`'</span><span class="keyword">, </span><span class="string">'\\'</span><span class="keyword">=&gt;</span><span class="string">'\\\\'</span><span class="keyword">, </span><span class="string">'!'</span><span class="keyword">=&gt;</span><span class="string">'\!'</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$str_requires</span><span class="keyword">=</span><span class="default">strtr</span><span class="keyword">(</span><span class="default">$str_requires</span><span class="keyword">, </span><span class="default">$map</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$path_run</span><span class="keyword">=</span><span class="default">dirname</span><span class="keyword">(</span><span class="default">$_SERVER</span><span class="keyword">[</span><span class="string">'SCRIPT_FILENAME'</span><span class="keyword">]);<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$my_target_exec</span><span class="keyword">=</span><span class="string">"/usr/bin/php -r \"chdir('</span><span class="keyword">{</span><span class="default">$path_run</span><span class="keyword">}</span><span class="string">');</span><span class="keyword">{</span><span class="default">$str_requires</span><span class="keyword">}</span><span class="string"> \\\$params=json_decode(file_get_contents('php://stdin'),true);call_user_func_array('</span><span class="keyword">{</span><span class="default">$function_name</span><span class="keyword">}</span><span class="string">', \\\$params);\""</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$my_target_exec</span><span class="keyword">=</span><span class="default">strtr</span><span class="keyword">(</span><span class="default">strtr</span><span class="keyword">(</span><span class="default">$my_target_exec</span><span class="keyword">, </span><span class="default">$map</span><span class="keyword">), </span><span class="default">$map</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$my_background_exec</span><span class="keyword">=</span><span class="string">"(/usr/bin/php -r \"chdir('</span><span class="keyword">{</span><span class="default">$path_run</span><span class="keyword">}</span><span class="string">');</span><span class="keyword">{</span><span class="default">$str_requires</span><span class="keyword">}</span><span class="string"> my_timeout_exec(\\\"</span><span class="keyword">{</span><span class="default">$my_target_exec</span><span class="keyword">}</span><span class="string">\\\", file_get_contents('php://stdin'), </span><span class="keyword">{</span><span class="default">$timeout</span><span class="keyword">}</span><span class="string">);\" &lt;&amp;3 &amp;) 3&lt;&amp;0"</span><span class="keyword">;</span><span class="comment">//php by default use "sh", and "sh" don't support "&lt;&amp;0"<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">my_timeout_exec</span><span class="keyword">(</span><span class="default">$my_background_exec</span><span class="keyword">, </span><span class="default">json_encode</span><span class="keyword">(</span><span class="default">$params</span><span class="keyword">), </span><span class="default">2</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br><br>function </span><span class="default">my_timeout_exec</span><span class="keyword">(</span><span class="default">$cmd</span><span class="keyword">, </span><span class="default">$stdin</span><span class="keyword">=</span><span class="string">''</span><span class="keyword">, </span><span class="default">$timeout</span><span class="keyword">)<br>&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; {</span><span class="default">$start</span><span class="keyword">=</span><span class="default">time</span><span class="keyword">();<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$stdout</span><span class="keyword">=</span><span class="string">''</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$stderr</span><span class="keyword">=</span><span class="string">''</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="comment">//file_put_contents('debug.txt', time().':cmd:'.$cmd."\n", FILE_APPEND);<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; //file_put_contents('debug.txt', time().':stdin:'.$stdin."\n", FILE_APPEND);<br><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$process</span><span class="keyword">=</span><span class="default">proc_open</span><span class="keyword">(</span><span class="default">$cmd</span><span class="keyword">, [[</span><span class="string">'pipe'</span><span class="keyword">, </span><span class="string">'r'</span><span class="keyword">], [</span><span class="string">'pipe'</span><span class="keyword">, </span><span class="string">'w'</span><span class="keyword">], [</span><span class="string">'pipe'</span><span class="keyword">, </span><span class="string">'w'</span><span class="keyword">]], </span><span class="default">$pipes</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if (!</span><span class="default">is_resource</span><span class="keyword">(</span><span class="default">$process</span><span class="keyword">))<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; {return array(</span><span class="string">'return'</span><span class="keyword">=&gt;</span><span class="string">'1'</span><span class="keyword">, </span><span class="string">'stdout'</span><span class="keyword">=&gt;</span><span class="default">$stdout</span><span class="keyword">, </span><span class="string">'stderr'</span><span class="keyword">=&gt;</span><span class="default">$stderr</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$status</span><span class="keyword">=</span><span class="default">proc_get_status</span><span class="keyword">(</span><span class="default">$process</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">posix_setpgid</span><span class="keyword">(</span><span class="default">$status</span><span class="keyword">[</span><span class="string">'pid'</span><span class="keyword">], </span><span class="default">$status</span><span class="keyword">[</span><span class="string">'pid'</span><span class="keyword">]);&nbsp; &nbsp; </span><span class="comment">//seperate pgid(process group id) from parent's pgid<br><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">stream_set_blocking</span><span class="keyword">(</span><span class="default">$pipes</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">], </span><span class="default">0</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">stream_set_blocking</span><span class="keyword">(</span><span class="default">$pipes</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">], </span><span class="default">0</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">stream_set_blocking</span><span class="keyword">(</span><span class="default">$pipes</span><span class="keyword">[</span><span class="default">2</span><span class="keyword">], </span><span class="default">0</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">fwrite</span><span class="keyword">(</span><span class="default">$pipes</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">], </span><span class="default">$stdin</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">fclose</span><span class="keyword">(</span><span class="default">$pipes</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">]);<br><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; while (</span><span class="default">1</span><span class="keyword">)<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {</span><span class="default">$stdout</span><span class="keyword">.=</span><span class="default">stream_get_contents</span><span class="keyword">(</span><span class="default">$pipes</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">]);<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$stderr</span><span class="keyword">.=</span><span class="default">stream_get_contents</span><span class="keyword">(</span><span class="default">$pipes</span><span class="keyword">[</span><span class="default">2</span><span class="keyword">]);<br><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">time</span><span class="keyword">()-</span><span class="default">$start</span><span class="keyword">&gt;</span><span class="default">$timeout</span><span class="keyword">)<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {</span><span class="comment">//proc_terminate($process, 9);&nbsp; &nbsp; //only terminate subprocess, won't terminate sub-subprocess<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">posix_kill</span><span class="keyword">(-</span><span class="default">$status</span><span class="keyword">[</span><span class="string">'pid'</span><span class="keyword">], </span><span class="default">9</span><span class="keyword">);&nbsp; &nbsp; </span><span class="comment">//sends SIGKILL to all processes inside group(negative means GPID, all subprocesses share the top process group, except nested my_timeout_exec)<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; //file_put_contents('debug.txt', time().":kill group {$status['pid']}\n", FILE_APPEND);<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">return array(</span><span class="string">'return'</span><span class="keyword">=&gt;</span><span class="string">'1'</span><span class="keyword">, </span><span class="string">'stdout'</span><span class="keyword">=&gt;</span><span class="default">$stdout</span><span class="keyword">, </span><span class="string">'stderr'</span><span class="keyword">=&gt;</span><span class="default">$stderr</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$status</span><span class="keyword">=</span><span class="default">proc_get_status</span><span class="keyword">(</span><span class="default">$process</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">//file_put_contents('debug.txt', time().':status:'.var_export($status, true)."\n";<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">if (!</span><span class="default">$status</span><span class="keyword">[</span><span class="string">'running'</span><span class="keyword">])<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {</span><span class="default">fclose</span><span class="keyword">(</span><span class="default">$pipes</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">]);<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">fclose</span><span class="keyword">(</span><span class="default">$pipes</span><span class="keyword">[</span><span class="default">2</span><span class="keyword">]);<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">proc_close</span><span class="keyword">(</span><span class="default">$process</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">$status</span><span class="keyword">[</span><span class="string">'exitcode'</span><span class="keyword">];<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">usleep</span><span class="keyword">(</span><span class="default">100000</span><span class="keyword">); <br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br>&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br></span><span class="default">?&gt;<br></span><br>a_class.php:<br><span class="default">&lt;?php<br></span><span class="keyword">class </span><span class="default">A<br></span><span class="keyword">{<br>&nbsp; &nbsp; static function </span><span class="default">jack</span><span class="keyword">(</span><span class="default">$a</span><span class="keyword">, </span><span class="default">$b</span><span class="keyword">)<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; {</span><span class="default">sleep</span><span class="keyword">(</span><span class="default">4</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">file_put_contents</span><span class="keyword">(</span><span class="string">'debug.txt'</span><span class="keyword">, </span><span class="default">time</span><span class="keyword">().</span><span class="string">":A::jack:"</span><span class="keyword">.</span><span class="default">$a</span><span class="keyword">.</span><span class="string">' '</span><span class="keyword">.</span><span class="default">$b</span><span class="keyword">.</span><span class="string">"\n"</span><span class="keyword">, </span><span class="default">FILE_APPEND</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">sleep</span><span class="keyword">(</span><span class="default">15</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br>}<br></span><span class="default">?&gt;<br></span><br>test.php:<br><span class="default">&lt;?php<br></span><span class="keyword">require </span><span class="string">'my_exec.php'</span><span class="keyword">;<br><br></span><span class="default">my_background_exec</span><span class="keyword">(</span><span class="string">'A::jack'</span><span class="keyword">, array(</span><span class="string">'hello'</span><span class="keyword">, </span><span class="string">'jack'</span><span class="keyword">), </span><span class="string">'require "my_exec.php";require "a_class.php";'</span><span class="keyword">, </span><span class="default">8</span><span class="keyword">);<br></span><span class="default">?&gt;</span>
</span>
</code></div>
  </div>
 </div>
  <div class="note" id="53564">  
  <a class="name">
  <strong class="user"><em>eric pecoraro at shepard com</em></strong></a><div class="date" title="2005-06-06 12:57"><strong>9 years ago</strong></div>
  <div class="text" id="Hcom53564">
<div class="phpcode"><code><span class="html">
I was having trouble with script timeouts in applications where the user prompted long running background actions. I wrote this cURL/CLI background script that solved the problem when making requests from HTTP.<br><br><span class="default">&lt;?php<br><br></span><span class="comment">/* BACKGROUND CLI 1.0<br>&nbsp;&nbsp; <br>&nbsp;&nbsp; eric pecoraro _at_ shepard dot com - 2005-06-02<br>&nbsp;&nbsp; Use at your own risk. No warranties expressed or implied.<br><br>&nbsp;&nbsp; Include this file at the top of any script to run it in the background<br>&nbsp;&nbsp; with no time limitations ... e.g., include('background_cli.php');<br>&nbsp;&nbsp; <br>&nbsp;&nbsp; The script that calls this file should not return output to the browser. <br>*/<br>#&nbsp; REQUIREMENTS - cURL and CLI<br>&nbsp;&nbsp; </span><span class="keyword">if ( !</span><span class="default">function_exists</span><span class="keyword">(</span><span class="string">'curl_setopt'</span><span class="keyword">) OR !</span><span class="default">function_exists</span><span class="keyword">(</span><span class="string">'curl_setopt'</span><span class="keyword">)&nbsp; ) {<br>&nbsp; &nbsp; &nbsp; echo </span><span class="string">'Requires cURL and CLI installations.' </span><span class="keyword">; exit ; <br>&nbsp;&nbsp; }<br>&nbsp;&nbsp; <br></span><span class="comment">#&nbsp; BUILD PATHS<br>&nbsp;&nbsp; </span><span class="default">$script </span><span class="keyword">= </span><span class="default">array_pop</span><span class="keyword">(</span><span class="default">explode</span><span class="keyword">(</span><span class="string">'/'</span><span class="keyword">,</span><span class="default">$SCRIPT_NAME</span><span class="keyword">)) ; <br>&nbsp;&nbsp; </span><span class="default">$script_dir </span><span class="keyword">= </span><span class="default">substr</span><span class="keyword">(</span><span class="default">$SCRIPT_NAME</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">,</span><span class="default">strlen</span><span class="keyword">(</span><span class="default">$SCRIPT_NAME</span><span class="keyword">)-</span><span class="default">strlen</span><span class="keyword">(</span><span class="default">$script</span><span class="keyword">)) ;<br>&nbsp;&nbsp; </span><span class="default">$scriptURL </span><span class="keyword">= </span><span class="string">'<a rel="nofollow" target="_blank">http://</a>'</span><span class="keyword">. </span><span class="default">$HTTP_HOST </span><span class="keyword">. </span><span class="default">$script_dir </span><span class="keyword">. </span><span class="string">"</span><span class="default">$script</span><span class="string">" </span><span class="keyword">;<br>&nbsp;&nbsp; </span><span class="default">$curlURL </span><span class="keyword">= </span><span class="string">'<a rel="nofollow" target="_blank">http://</a>'</span><span class="keyword">. </span><span class="default">$HTTP_HOST </span><span class="keyword">. </span><span class="default">$script_dir </span><span class="keyword">. </span><span class="string">"</span><span class="default">$script</span><span class="string">?runscript=curl" </span><span class="keyword">;<br><br></span><span class="comment">#&nbsp; Indicate that script is being called by CLI <br>&nbsp;&nbsp; </span><span class="keyword">if ( </span><span class="default">php_sapi_name</span><span class="keyword">() == </span><span class="string">'cli' </span><span class="keyword">) {<br>&nbsp; &nbsp; &nbsp; </span><span class="default">$CLI </span><span class="keyword">= </span><span class="default">true </span><span class="keyword">;<br>&nbsp;&nbsp; }<br><br></span><span class="comment">#&nbsp; Action if script is being called by cURL_prompt()<br>&nbsp;&nbsp; </span><span class="keyword">if ( </span><span class="default">$runscript </span><span class="keyword">== </span><span class="string">'curl' </span><span class="keyword">) {<br>&nbsp; &nbsp; &nbsp; </span><span class="default">$cmd </span><span class="keyword">= </span><span class="string">"/usr/local/bin/php "</span><span class="keyword">.</span><span class="default">$PATH_TRANSLATED </span><span class="keyword">; </span><span class="comment">// server location of script to run<br>&nbsp; &nbsp; &nbsp; </span><span class="default">exec</span><span class="keyword">(</span><span class="default">$cmd</span><span class="keyword">) ;<br>&nbsp; &nbsp; &nbsp; exit;<br>&nbsp;&nbsp; }<br><br></span><span class="comment">#&nbsp; USER INTERFACE<br>&nbsp;&nbsp; // User answer after submission.<br>&nbsp;&nbsp; </span><span class="keyword">if ( </span><span class="default">$post </span><span class="keyword">) {<br>&nbsp; &nbsp; &nbsp; </span><span class="default">cURL_prompt</span><span class="keyword">(</span><span class="default">$curlURL</span><span class="keyword">) ;<br>&nbsp; &nbsp; &nbsp; echo </span><span class="string">'&lt;div style="margin:25px;"&gt;&lt;title&gt;Background CLI&lt;/title&gt;'</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; echo </span><span class="string">'O.K. If all goes well, &lt;b&gt;'</span><span class="keyword">.</span><span class="default">$script</span><span class="keyword">.</span><span class="string">'&lt;/b&gt; is working hard in the background with no ' </span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; echo </span><span class="string">'timeout limitations. &lt;br&gt;&lt;br&gt;&lt;form action='</span><span class="keyword">.</span><span class="default">$scriptURL</span><span class="keyword">.</span><span class="string">' method=GET&gt;' </span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; echo </span><span class="string">'&lt;input type=submit value=" RESET BACKGROUND CLI "&gt;&lt;/form&gt;&lt;/div&gt;' </span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; exit ;<br>&nbsp;&nbsp; }<br>&nbsp;&nbsp; </span><span class="comment">// Start screen.<br>&nbsp;&nbsp; </span><span class="keyword">if ( !</span><span class="default">$CLI </span><span class="keyword">AND !</span><span class="default">$runscript </span><span class="keyword">) {<br>&nbsp; &nbsp; &nbsp; echo </span><span class="string">'&lt;title&gt;Background CLI&lt;/title&gt;&lt;div style="margin:25px;"&gt;' </span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; echo </span><span class="string">'&lt;form action='</span><span class="keyword">.</span><span class="default">$scriptURL</span><span class="keyword">.</span><span class="string">' method=POST&gt;' </span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; echo </span><span class="string">'Click to run &lt;b&gt;'</span><span class="keyword">.</span><span class="default">$script</span><span class="keyword">.</span><span class="string">'&lt;/b&gt; from the PHP CLI command line, in the background.&lt;br&gt;&lt;br&gt;' </span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; echo </span><span class="string">'&lt;input type=hidden value=1 name=post&gt;' </span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; echo </span><span class="string">'&lt;input type=submit value=" RUN IN BACKGROUND "&gt;&lt;/form&gt;&lt;/div&gt;' </span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; exit ;<br>&nbsp;&nbsp; }<br><br></span><span class="comment">#&nbsp; cURL URL PROMPT FUNCTION<br>&nbsp;&nbsp; </span><span class="keyword">function </span><span class="default">cURL_prompt</span><span class="keyword">(</span><span class="default">$url_path</span><span class="keyword">) {<br>&nbsp; &nbsp; &nbsp; </span><span class="default">ob_start</span><span class="keyword">(); </span><span class="comment">// start output buffer<br>&nbsp; &nbsp; &nbsp; </span><span class="default">$c</span><span class="keyword">=</span><span class="default">curl_init</span><span class="keyword">(</span><span class="default">$url_path</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; </span><span class="default">curl_setopt</span><span class="keyword">(</span><span class="default">$c</span><span class="keyword">, </span><span class="default">CURLOPT_TIMEOUT</span><span class="keyword">, </span><span class="default">2</span><span class="keyword">); </span><span class="comment">// drop connection after 2 seconds<br>&nbsp; &nbsp; &nbsp; </span><span class="default">curl_exec</span><span class="keyword">(</span><span class="default">$c</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; </span><span class="default">curl_close</span><span class="keyword">(</span><span class="default">$c</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; </span><span class="default">ob_end_clean</span><span class="keyword">(); </span><span class="comment">// discard output buffer<br>&nbsp;&nbsp; </span><span class="keyword">}<br></span><span class="default">?&gt;</span>
</span>
</code></div>
  </div>
 </div>
  <div class="note" id="33462">  
  <a class="name">
  <strong class="user"><em>php at mightycpa.com</em></strong></a><div class="date" title="2003-06-26 01:30"><strong>11 years ago</strong></div>
  <div class="text" id="Hcom33462">
<div class="phpcode"><code><span class="html">
You may also need to look at Apache's timeout setting (Win32 version for me), I changed max execution time value in php.ini, and still got stopped by Apache's timeout value in the httpd.conf file.</span>
</code></div>
  </div>
 </div>
  <div class="note" id="72167">  
  <a class="name">
  <strong class="user"><em>mba_aslam at yahoo dot com</em></strong></a><div class="date" title="2007-01-05 05:50"><strong>7 years ago</strong></div>
  <div class="text" id="Hcom72167">
<div class="phpcode"><code><span class="html">
while setting the set_time_limit(), the duration of sleep() will be ignored in the execution time. The following illustrates:<br><br><span class="default">&lt;?php<br><br>set_time_limit</span><span class="keyword">(</span><span class="default">20</span><span class="keyword">);<br><br>while (</span><span class="default">$i</span><span class="keyword">&lt;=</span><span class="default">10</span><span class="keyword">)<br>{<br>&nbsp; &nbsp; &nbsp; &nbsp; echo </span><span class="string">"i=</span><span class="default">$i</span><span class="string"> "</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">sleep</span><span class="keyword">(</span><span class="default">100</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$i</span><span class="keyword">++;<br>}<br><br></span><span class="default">?&gt;<br></span><br>Output:<br>i=0 i=1 i=2 i=3 i=4 i=5 i=6 i=7 i=8 i=9 i=10</span>
</code></div>
  </div>
 </div>
  <div class="note" id="85488">  
  <a class="name">
  <strong class="user"><em>cweiske at cweiske dot de</em></strong></a><div class="date" title="2008-09-02 04:38"><strong>5 years ago</strong></div>
  <div class="text" id="Hcom85488">
<div class="phpcode"><code><span class="html">
To get the currently used time, use getrusage()</span>
</code></div>
  </div>
 </div>
  <div class="note" id="83617">  
  <a class="name">
  <strong class="user"><em>AtlantisNet</em></strong></a><div class="date" title="2008-06-04 12:08"><strong>6 years ago</strong></div>
  <div class="text" id="Hcom83617">
<div class="phpcode"><code><span class="html">
In IIS, there is another global timeout setting which will override any PHP settings.&nbsp; You can alter this timeout by following the following instructions:<br><br><a rel="nofollow" target="_blank">http://www.iisadmin.co.uk/?p=7</a></span>
</code></div>
  </div>
 </div>
  <div class="note" id="84563">  
  <a class="name">
  <strong class="user"><em>jonathon dot keogh at gmail dot com</em></strong></a><div class="date" title="2008-07-18 02:07"><strong>6 years ago</strong></div>
  <div class="text" id="Hcom84563">
<div class="phpcode"><code><span class="html">
You can do set_time_limit(0); so that the script will run forever - however this is not recommended and your web server might catch you out with an imposed HTTP timeout (usually around 5 minutes).<br><br>You should check your web server's guides for more information about HTTP timeouts.<br><br>Jonathon</span>
</code></div>
  </div>
 </div>
  <div class="note" id="115189">  
  <a class="name">
  <strong class="user"><em>santosh dot anantharamaiah at decathlon dot in</em></strong></a><div class="date" title="2014-06-11 06:42"><strong>2 months ago</strong></div>
  <div class="text" id="Hcom115189">
<div class="phpcode"><code><span class="html">
set_time_limit('600'); <br><br>We have this piece of code but even with that we are facing error.<br><br>Can anyone tell us how to fix this?</span>
</code></div>
  </div>
 </div>
  <div class="note" id="32532">  
  <a class="name">
  <strong class="user"><em>rsallo at gna dot NOSPAM dot es</em></strong></a><div class="date" title="2003-05-30 04:28"><strong>11 years ago</strong></div>
  <div class="text" id="Hcom32532">
<div class="phpcode"><code><span class="html">
When you are working with IIS, PHP timeout is valid only when it's lower than script timeout defined by IIS.<br><br>IIS 5 has a default timeout of 300 seconds. If you need a higher timeout, you also have to change IIS properties. Otherwise, your server will stop your PHP script before it reaches its own timeout.</span>
</code></div>
  </div>
 </div>
  <div class="note" id="96923">  
  <a class="name">
  <strong class="user"><em>Silver_Knight</em></strong></a><div class="date" title="2010-03-23 05:18"><strong>4 years ago</strong></div>
  <div class="text" id="Hcom96923">
<div class="phpcode"><code><span class="html">
if you are running a script that needs to execute for unknown time, or forever.. you may use<br>set_time_limit(0);<br>.....<br>...<br>..<br>.<br>and at the end of the script use flush() function to tell phpto send out what it has generated.</span>
</code></div>
  </div>
 </div>
  <div class="note" id="59053">  
  <a class="name">
  <strong class="user"><em>rycardo74 at gmail dot com</em></strong></a><div class="date" title="2005-11-24 10:52"><strong>8 years ago</strong></div>
  <div class="text" id="Hcom59053">
<div class="phpcode"><code><span class="html">
this work to fine html streaming AND time pass limit
<br>
<br><span class="default">&lt;?php
<br>header</span><span class="keyword">(</span><span class="string">'Content-type: text/plain'</span><span class="keyword">);
<br>echo </span><span class="default">date</span><span class="keyword">(</span><span class="string">"H:m:s"</span><span class="keyword">), </span><span class="string">"\n"</span><span class="keyword">;
<br></span><span class="default">set_time_limit</span><span class="keyword">(</span><span class="default">30</span><span class="keyword">);
<br>for (</span><span class="default">$i </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">; </span><span class="default">$i </span><span class="keyword">&lt; </span><span class="default">1000</span><span class="keyword">; </span><span class="default">$i</span><span class="keyword">++)
<br>{
<br>
<br>&nbsp; &nbsp; echo </span><span class="default">date</span><span class="keyword">(</span><span class="string">"H:m:s"</span><span class="keyword">),</span><span class="string">"\n"</span><span class="keyword">;
<br>&nbsp; &nbsp; for (</span><span class="default">$r </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">; </span><span class="default">$r </span><span class="keyword">&lt; </span><span class="default">100000</span><span class="keyword">; </span><span class="default">$r</span><span class="keyword">++){
<br>&nbsp; &nbsp; </span><span class="default">$X</span><span class="keyword">.=&nbsp; </span><span class="default">tan</span><span class="keyword">(</span><span class="default">M_LNPI</span><span class="keyword">+</span><span class="default">log</span><span class="keyword">(</span><span class="default">ceil</span><span class="keyword">(&nbsp; </span><span class="default">date</span><span class="keyword">(</span><span class="string">"s"</span><span class="keyword">)*</span><span class="default">M_PI</span><span class="keyword">*</span><span class="default">M_LNPI</span><span class="keyword">+</span><span class="default">100</span><span class="keyword">)));
<br>&nbsp; &nbsp; }
<br>&nbsp; &nbsp; </span><span class="default">ob_flush</span><span class="keyword">();&nbsp;&nbsp; 
<br>&nbsp; &nbsp; </span><span class="default">flush</span><span class="keyword">();
<br>
<br>}
<br>echo </span><span class="string">"work! </span><span class="default">$x</span><span class="string">"</span><span class="keyword">;
<br></span><span class="default">?&gt;</span>
</span>
</code></div>
  </div>
 </div>
  <div class="note" id="72305">  
  <a class="name">
  <strong class="user"><em>php at stock-consulting dot com</em></strong></a><div class="date" title="2007-01-12 05:30"><strong>7 years ago</strong></div>
  <div class="text" id="Hcom72305">
<div class="phpcode"><code><span class="html">
To find out the currently set time limit, use
<br>
<br><span class="default">&lt;?php
<br> ini_get</span><span class="keyword">(</span><span class="string">'max_execution_time'</span><span class="keyword">);
<br></span><span class="default">?&gt;
<br></span>
<br>If set_time_limit has been previously called in the script, the result will be the value which was passed to set_time_limit (and not, as the function name "ini_get" appears to suggest, the value from the php.ini file).</span>
</code></div>
  </div>
 </div>
  <div class="note" id="63839">  
  <a class="name">
  <strong class="user"><em>konrads dot smelkovs at gmail dot com</em></strong></a><div class="date" title="2006-04-01 06:35"><strong>8 years ago</strong></div>
  <div class="text" id="Hcom63839">
<div class="phpcode"><code><span class="html">
If you are streaming large data from database, it is counted towards the max exec time.</span>
</code></div>
  </div>
 </div>
  <div class="note" id="114082">  
  <a class="name">
  <strong class="user"><em>robertbrogers at gmail dot com</em></strong></a><div class="date" title="2014-01-09 08:45"><strong>7 months ago</strong></div>
  <div class="text" id="Hcom114082">
<div class="phpcode"><code><span class="html">
Documentation states:<br>When called, set_time_limit() restarts the timeout counter from zero. In other words, if the timeout is the default 30 seconds, and 25 seconds into script execution a call such as set_time_limit(20) is made, the script will run for a total of 45 seconds before timing out.<br><br>If I have a long running script and i want a exact&nbsp; time limit, I set this as near as possible to the first line.</span>
</code></div>
  </div>
 </div>
  <div class="note" id="105569">  
  <a class="name">
  <strong class="user"><em>alexander dot krause at ed-solutions dot de</em></strong></a><div class="date" title="2011-08-29 02:26"><strong>2 years ago</strong></div>
  <div class="text" id="Hcom105569">
<div class="phpcode"><code><span class="html">
A nice workaround to have a real max_execution_time (needs posix and pcntl):
<br>
<br><span class="default">&lt;?php
<br>$pid</span><span class="keyword">=</span><span class="default">pcntl_fork</span><span class="keyword">();
<br>
<br>if (</span><span class="default">$pid</span><span class="keyword">) {
<br>&nbsp; </span><span class="comment">//long time process
<br>&nbsp; </span><span class="default">$a</span><span class="keyword">=</span><span class="default">0</span><span class="keyword">;
<br>&nbsp; while (</span><span class="default">true</span><span class="keyword">) {
<br>&nbsp; &nbsp; echo </span><span class="string">"a=</span><span class="default">$a</span><span class="string">\n\n"</span><span class="keyword">;
<br>&nbsp; &nbsp; </span><span class="default">ob_flush</span><span class="keyword">();
<br>&nbsp; &nbsp; </span><span class="default">flush</span><span class="keyword">();
<br>&nbsp; &nbsp; </span><span class="default">$a</span><span class="keyword">++;
<br>&nbsp; &nbsp; </span><span class="default">shell_exec</span><span class="keyword">(</span><span class="string">'sleep 10&amp;'</span><span class="keyword">);
<br>&nbsp; }
<br>} else {
<br>&nbsp; </span><span class="comment">//time-limit checker
<br>&nbsp; </span><span class="default">sleep</span><span class="keyword">(</span><span class="default">5</span><span class="keyword">);
<br>&nbsp; </span><span class="default">posix_kill</span><span class="keyword">(</span><span class="default">posix_getppid</span><span class="keyword">(),</span><span class="default">SIGKILL</span><span class="keyword">);
<br>}
<br></span><span class="default">?&gt;</span>
</span>
</code></div>
  </div>
 </div>
  <div class="note" id="62510">  
  <a class="name">
  <strong class="user"><em>jatin at jatinchimote dot com</em></strong></a><div class="date" title="2006-03-01 10:54"><strong>8 years ago</strong></div>
  <div class="text" id="Hcom62510">
<div class="phpcode"><code><span class="html">
If you set the number of seconds to a very large number (not many ppl do that, but just in case) then php exits with a fatal error like :
<br>
<br>Fatal error: Maximum execution time of 1 second exceeded in /path/to/your/script/why.php
<br>
<br>[EDIT by danbrown AT php DOT net: This is due to the limit of 32-bit signed integers.]</span>
</code></div>
  </div>
 </div>
  <div class="note" id="106669">  
  <a class="name">
  <strong class="user"><em>ratty at brohoof dot com</em></strong></a><div class="date" title="2011-11-25 07:39"><strong>2 years ago</strong></div>
  <div class="text" id="Hcom106669">
<div class="phpcode"><code><span class="html">
One thing that I wish I had found sooner is, if you're using php-cli and really need to limit the executation time, and if you're in *nix, you can use "timeout" which is part of coreutils.<br>For example:<br><br>timeout 5 /usr/bin/php -q /path/to/script<br><br>and it will kill it if it takes longer than 5 seconds.<br>I had a few quick php scripts I wrote for use with cacti for example.</span>
</code></div>
  </div>
 </div>
  <div class="note" id="108607">  
  <a class="name">
  <strong class="user"><em>mingalevme at gmail dot com</em></strong></a><div class="date" title="2012-05-10 07:51"><strong>2 years ago</strong></div>
  <div class="text" id="Hcom108607">
<div class="phpcode"><code><span class="html">
If you're using PHP_CLI SAPI and getting error "Maximum execution time of N seconds exceeded" where N is an integer value, try to call set_time_limit(0) every M seconds or every iteration. For example:<br><br><span class="default">&lt;?php<br><br></span><span class="keyword">require_once(</span><span class="string">'db.php'</span><span class="keyword">);<br><br></span><span class="default">$stmt </span><span class="keyword">= </span><span class="default">$db</span><span class="keyword">-&gt;</span><span class="default">query</span><span class="keyword">(</span><span class="default">$sql</span><span class="keyword">);<br><br>while (</span><span class="default">$row </span><span class="keyword">= </span><span class="default">$stmt</span><span class="keyword">-&gt;</span><span class="default">fetchRow</span><span class="keyword">()) {<br>&nbsp; &nbsp; </span><span class="default">set_time_limit</span><span class="keyword">(</span><span class="default">0</span><span class="keyword">);<br>&nbsp; &nbsp; </span><span class="comment">// your code here<br></span><span class="keyword">}<br><br></span><span class="default">?&gt;</span>
</span>
</code></div>
  </div>
 </div>
  <div class="note" id="72268">  
  <a class="name">
  <strong class="user"><em>bjfieldNO at SPAMgmail dot com</em></strong></a><div class="date" title="2007-01-10 02:53"><strong>7 years ago</strong></div>
  <div class="text" id="Hcom72268">
<div class="phpcode"><code><span class="html">
Timeouts after five minutes in IIS on Windows are caused by an inherited CGI Timeout value of 300 seconds.&nbsp; This is not a PHP problem.&nbsp; The fix is to add custom values for the files or directories that need longer to run.<br><br>In IIS 5.0 or 7.0 (beta as of this note), you can change this value on a fairly granular level using IIS Manager, under (roughly) YOURSITE -&gt; Properties -&gt; Home Directory -&gt; Configuration (button) -&gt; Options, but in IIS 6.0, this functionality is turned off (!), so you have to get into the Metabase.<br><br>Find the site number in Metabase Explorer (e.g., 12345678), then from CMD prompt:<br><br>[get to the scripts dir]<br>cd C:\Inetpub\AdminScripts<br><br>[this for each subdirectory from off the site root]<br>cscript adsutil.vbs CREATE W3SVC/12345678/root/"MY SUBDIRECTORY" IIsWebDirectory<br><br>[this for the file in question]<br>cscript adsutil.vbs CREATE W3SVC/12345678/root/"MY SUBDIRECTORY"/ILikeToTimeOut.php IIsWebFile<br><br>[this to set the timeout]<br>cscript adsutil.vbs set W3SVC/12345678/root/"MY SUBDIRECTORY"/ILikeToTimeOut.php/CGITimeout "7200"<br><br>Note:&nbsp; "7200" is 2 hours in seconds, but can be whatever.<br><br>I derived the solution above from this fine article:<br><a rel="nofollow" target="_blank">http://www.iis-resources.com/modules/AMS/article.php?</a><br>storyid=509&amp;page=3</span>
</code></div>
  </div>
 </div>
  <div class="note" id="62447">  
  <a class="name">
  <strong class="user"><em>Cleverduck</em></strong></a><div class="date" title="2006-02-28 01:36"><strong>8 years ago</strong></div>
  <div class="text" id="Hcom62447">
<div class="phpcode"><code><span class="html">
Regarding what 'nytshadow' said, it's important to realize that max-execution-time and the set_time_limit functions measure the time that the CPU is working on the script.&nbsp; If the script blocks, IE: for input, select, sleep, etc., then the time between blocking and returning is NOT measured.&nbsp; This is the same when running scripts from the command line interface.&nbsp; So if you've got a log parser written in PHP that tails a file, that program WILL fail eventually.&nbsp; It just depends how long it takes to read in enough input to process for 30 seconds.<br><br>If you're writing a command line script that should run infinitely, setting max-execution-time to 0 (never stop) is HIGHLY recommended.</span>
</code></div>
  </div>
 </div>
  <div class="note" id="92949">  
  <a class="name">
  <strong class="user"><em>ravenswd at gmail dot com</em></strong></a><div class="date" title="2009-08-15 04:46"><strong>5 years ago</strong></div>
  <div class="text" id="Hcom92949">
<div class="phpcode"><code><span class="html">
Unfortunately, a script which gets into an infinite loop can produce an alarming amount of output in only a few seconds. I was attempting to debug a script, and I added<br><br><span class="default">&lt;?php<br>set_time_limit</span><span class="keyword">(</span><span class="default">2</span><span class="keyword">);<br></span><span class="default">?&gt;<br></span><br>to the beginning of the script. Unfortunately, even two seconds of run time produced enough output to overload the memory available to my browser.<br><br>So, I wrote a short routine which would limit the execution time, and also limit the amount of output returned. I added this to the beginning of my script and it worked perfectly:<br><br><span class="default">&lt;?php<br>set_time_limit</span><span class="keyword">(</span><span class="default">2</span><span class="keyword">);<br><br></span><span class="default">ob_start</span><span class="keyword">();&nbsp; &nbsp;&nbsp; </span><span class="comment">// buffer output<br><br></span><span class="keyword">function </span><span class="default">shutdown </span><span class="keyword">() {<br>&nbsp; &nbsp; </span><span class="comment">// print only first 2000 characters of output<br>&nbsp; &nbsp; </span><span class="default">$out </span><span class="keyword">= </span><span class="default">ob_get_clean</span><span class="keyword">();<br>&nbsp; &nbsp; print </span><span class="default">substr</span><span class="keyword">(</span><span class="default">$out</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">2000</span><span class="keyword">);<br>}<br><br></span><span class="default">register_shutdown_function</span><span class="keyword">(</span><span class="string">'shutdown'</span><span class="keyword">);<br></span><span class="default">?&gt;</span>
</span>
</code></div>
  </div>
 </div>
  <div class="note" id="90933">  
  <a class="name">
  <strong class="user"><em>BW</em></strong></a><div class="date" title="2009-05-16 05:08"><strong>5 years ago</strong></div>
  <div class="text" id="Hcom90933">
<div class="phpcode"><code><span class="html">
If you use Apache you can change maximum execution time by .htaccess with this line<br><br>php_value max_execution_time 200</span>
</code></div>
  </div>
 </div>
  <div class="note" id="100218">  
  <a class="name">
  <strong class="user"><em>agvozden at gmail dot com</em></strong></a><div class="date" title="2010-10-01 01:51"><strong>3 years ago</strong></div>
  <div class="text" id="Hcom100218">
<div class="phpcode"><code><span class="html">
If you got something like:
<br>
<br>msg: set_time_limit() [function.set-time-limit]: Cannot set time limit in safe mode 
<br>
<br>try this:
<br>
<br><span class="default">&lt;?php
<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="keyword">if( !</span><span class="default">ini_get</span><span class="keyword">(</span><span class="string">'safe_mode'</span><span class="keyword">) ){
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">set_time_limit</span><span class="keyword">(</span><span class="default">25</span><span class="keyword">);
<br>&nbsp; &nbsp; &nbsp; &nbsp; }
<br></span><span class="default">?&gt;</span>
</span>
</code></div>
  </div>
 </div>
  <div class="note" id="100039">  
  <a class="name">
  <strong class="user"><em>kamazee at gmail dot com</em></strong></a><div class="date" title="2010-09-21 06:39"><strong>3 years ago</strong></div>
  <div class="text" id="Hcom100039">
<div class="phpcode"><code><span class="html">
Keep in mind that for CLI SAPI max_execution_time is hardcoded to 0. So it seems to be changed by ini_set or set_time_limit but it isn't, actually.<br>The only references I've found to this strange decision are deep in bugtracker (<a rel="nofollow" target="_blank">http://bugs.php.net/37306</a>) and in php.ini (comments for 'max_execution_time' directive).</span>
</code></div>
  </div>
 </div></div>

 
</section>    </section><!-- layout-content -->
        


  </div><!-- layout -->
         
  

    
 <!-- External and third party libraries. -->
 







<a id="toTop" href="javascript:;"><span id="toTopHover"></span><img width="40" height="40" alt="To Top" src="../../images/to-top%402x.png"></a>



<!-- Mirrored from php.net/manual/en/function.set-time-limit.php by HTTrack Website Copier/3.x [XR&CO'2013], Thu, 28 Aug 2014 15:29:36 GMT -->


</body></html>