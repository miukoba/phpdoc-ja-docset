<html><!-- Mirrored from php.net/manual/en/function.socket-create.php by HTTrack Website Copier/3.x [XR&CO'2013], Thu, 28 Aug 2014 16:46:19 GMT --><!-- Added by HTTrack --><head><meta http-equiv="content-type" content="text/html;charset=utf-8"><!-- /Added by HTTrack -->


  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0"> 

  <title>socket_create</title>

 <link rel="shortcut icon" href="../../favicon.ico">
 <link rel="search" type="application/opensearchdescription+xml" href="http://php.net/phpnetimprovedsearch.src" title="Add PHP.net search">
 <link rel="alternate" type="application/atom+xml" href="http://php.net/releases/feed.php" title="PHP Release feed">
 <link rel="alternate" type="application/atom+xml" href="http://php.net/feed.atom" title="PHP: Hypertext Preprocessor">

 <link rel="canonical" href="function.socket-create.html">
 <link rel="shorturl" href="http://php.net/socket-create">
 <link rel="alternate" href="http://php.net/socket-create" hreflang="x-default">

 <link rel="contents" href="index-2.html">
 <link rel="index" href="ref.sockets.html">
 <link rel="prev" href="function.socket-create-pair.html">
 <link rel="next" href="function.socket-get-option.html">

 <link rel="alternate" href="function.socket-create.html" hreflang="en">
 <link rel="alternate" href="http://php.net/manual/pt_BR/function.socket-create.php" hreflang="pt_BR">
 <link rel="alternate" href="http://php.net/manual/zh/function.socket-create.php" hreflang="zh">
 <link rel="alternate" href="http://php.net/manual/fr/function.socket-create.php" hreflang="fr">
 <link rel="alternate" href="http://php.net/manual/de/function.socket-create.php" hreflang="de">
 <link rel="alternate" href="http://php.net/manual/it/function.socket-create.php" hreflang="it">
 <link rel="alternate" href="http://php.net/manual/ja/function.socket-create.php" hreflang="ja">
 <link rel="alternate" href="http://php.net/manual/ro/function.socket-create.php" hreflang="ro">
 <link rel="alternate" href="http://php.net/manual/ru/function.socket-create.php" hreflang="ru">
 <link rel="alternate" href="http://php.net/manual/es/function.socket-create.php" hreflang="es">
 <link rel="alternate" href="http://php.net/manual/tr/function.socket-create.php" hreflang="tr">

<link rel="stylesheet" type="text/css" href="../../cached8fe1.css?t=1401250819&amp;f=/fonts/Fira/fira.css" media="screen">
<link rel="stylesheet" type="text/css" href="../../cached4b8d.css?t=1404368420&amp;f=/fonts/Font-Awesome/css/fontello.css" media="screen">
<link rel="stylesheet" type="text/css" href="../../cached5065.css?t=1403329232&amp;f=/styles/theme-base.css" media="screen">
<link rel="stylesheet" type="text/css" href="../../cachedc78d.css?t=1401249623&amp;f=/styles/theme-medium.css" media="screen">

 <!--[if lte IE 7]>
 <link rel="stylesheet" type="text/css" href="http://php.net/styles/workarounds.ie7.css" media="screen">
 <![endif]-->

 <!--[if lte IE 8]>
 <script type="text/javascript">
  window.brokenIE = true;
 </script>
 <![endif]-->

 <!--[if lte IE 9]>
 <link rel="stylesheet" type="text/css" href="http://php.net/styles/workarounds.ie9.css" media="screen">
 <![endif]-->

 <!--[if IE]>
 <script type="text/javascript" src="http://php.net/js/ext/html5.js"></script>
 <![endif]-->

 <base>

</head>
<body class="docs " style="">


<div class="headsup"><a href="http://php.net/index.php#id2014-08-28-1">PHP 5.6.0 released</a></div>
<nav id="trick"><div><dl>
<dt><a href="getting-started.html">Getting Started</a></dt>
	<dd><a href="introduction.html">Introduction</a></dd>
	<dd><a href="tutorial.html">A simple tutorial</a></dd>
<dt><a href="langref.html">Language Reference</a></dt>
	<dd><a href="language.basic-syntax.html">Basic syntax</a></dd>
	<dd><a href="language.types.html">Types</a></dd>
	<dd><a href="language.variables.html">Variables</a></dd>
	<dd><a href="language.constants.html">Constants</a></dd>
	<dd><a href="language.expressions.html">Expressions</a></dd>
	<dd><a href="language.operators.html">Operators</a></dd>
	<dd><a href="language.control-structures.html">Control Structures</a></dd>
	<dd><a href="language.functions.html">Functions</a></dd>
	<dd><a href="language.oop5.html">Classes and Objects</a></dd>
	<dd><a href="language.namespaces.html">Namespaces</a></dd>
	<dd><a href="language.exceptions.html">Exceptions</a></dd>
	<dd><a href="language.generators.html">Generators</a></dd>
	<dd><a href="language.references.html">References Explained</a></dd>
	<dd><a href="reserved.variables.html">Predefined Variables</a></dd>
	<dd><a href="reserved.exceptions.html">Predefined Exceptions</a></dd>
	<dd><a href="reserved.interfaces.html">Predefined Interfaces and Classes</a></dd>
	<dd><a href="context.html">Context options and parameters</a></dd>
	<dd><a href="wrappers.html">Supported Protocols and Wrappers</a></dd>
</dl>
<dl>
<dt><a href="security.html">Security</a></dt>
	<dd><a href="security.intro.html">Introduction</a></dd>
	<dd><a href="security.general.html">General considerations</a></dd>
	<dd><a href="security.cgi-bin.html">Installed as CGI binary</a></dd>
	<dd><a href="security.apache.html">Installed as an Apache module</a></dd>
	<dd><a href="security.filesystem.html">Filesystem Security</a></dd>
	<dd><a href="security.database.html">Database Security</a></dd>
	<dd><a href="security.errors.html">Error Reporting</a></dd>
	<dd><a href="security.globals.html">Using Register Globals</a></dd>
	<dd><a href="security.variables.html">User Submitted Data</a></dd>
	<dd><a href="security.magicquotes.html">Magic Quotes</a></dd>
	<dd><a href="security.hiding.html">Hiding PHP</a></dd>
	<dd><a href="security.current.html">Keeping Current</a></dd>
<dt><a href="features.html">Features</a></dt>
	<dd><a href="features.http-auth.html">HTTP authentication with PHP</a></dd>
	<dd><a href="features.cookies.html">Cookies</a></dd>
	<dd><a href="features.sessions.html">Sessions</a></dd>
	<dd><a href="features.xforms.html">Dealing with XForms</a></dd>
	<dd><a href="features.file-upload.html">Handling file uploads</a></dd>
	<dd><a href="features.remote-files.html">Using remote files</a></dd>
	<dd><a href="features.connection-handling.html">Connection handling</a></dd>
	<dd><a href="features.persistent-connections.html">Persistent Database Connections</a></dd>
	<dd><a href="features.safe-mode.html">Safe Mode</a></dd>
	<dd><a href="features.commandline.html">Command line usage</a></dd>
	<dd><a href="features.gc.html">Garbage Collection</a></dd>
	<dd><a href="features.dtrace.html">DTrace Dynamic Tracing</a></dd>
</dl>
<dl>
<dt><a href="funcref.html">Function Reference</a></dt>
	<dd><a href="refs.basic.php.html">Affecting PHP's Behaviour</a></dd>
	<dd><a href="refs.utilspec.audio.html">Audio Formats Manipulation</a></dd>
	<dd><a href="refs.remote.auth.html">Authentication Services</a></dd>
	<dd><a href="refs.utilspec.cmdline.html">Command Line Specific Extensions</a></dd>
	<dd><a href="refs.compression.html">Compression and Archive Extensions</a></dd>
	<dd><a href="refs.creditcard.html">Credit Card Processing</a></dd>
	<dd><a href="refs.crypto.html">Cryptography Extensions</a></dd>
	<dd><a href="refs.database.html">Database Extensions</a></dd>
	<dd><a href="refs.calendar.html">Date and Time Related Extensions</a></dd>
	<dd><a href="refs.fileprocess.file.html">File System Related Extensions</a></dd>
	<dd><a href="refs.international.html">Human Language and Character Encoding Support</a></dd>
	<dd><a href="refs.utilspec.image.html">Image Processing and Generation</a></dd>
	<dd><a href="refs.remote.mail.html">Mail Related Extensions</a></dd>
	<dd><a href="refs.math.html">Mathematical Extensions</a></dd>
	<dd><a href="refs.utilspec.nontext.html">Non-Text MIME Output</a></dd>
	<dd><a href="refs.fileprocess.process.html">Process Control Extensions</a></dd>
	<dd><a href="refs.basic.other.html">Other Basic Extensions</a></dd>
	<dd><a href="refs.remote.other.html">Other Services</a></dd>
	<dd><a href="refs.search.html">Search Engine Extensions</a></dd>
	<dd><a href="refs.utilspec.server.html">Server Specific Extensions</a></dd>
	<dd><a href="refs.basic.session.html">Session Extensions</a></dd>
	<dd><a href="refs.basic.text.html">Text Processing</a></dd>
	<dd><a href="refs.basic.vartype.html">Variable and Type Related Extensions</a></dd>
	<dd><a href="refs.webservice.html">Web Services</a></dd>
	<dd><a href="refs.utilspec.windows.html">Windows Only Extensions</a></dd>
	<dd><a href="refs.xml.html">XML Manipulation</a></dd>
</dl>
<dl>
<dt>Keyboard Shortcuts</dt><dt>?</dt>
<dd>This help</dd>
<dt>j</dt>
<dd>Next menu item</dd>
<dt>k</dt>
<dd>Previous menu item</dd>
<dt>g p</dt>
<dd>Previous man page</dd>
<dt>g n</dt>
<dd>Next man page</dd>
<dt>G</dt>
<dd>Scroll to bottom</dd>
<dt>g g</dt>
<dd>Scroll to top</dd>
<dt>g h</dt>
<dd>Goto homepage</dd>
<dt>g s</dt>
<dd>Goto search<br>(current page)</dd>
<dt>/</dt>
<dd>Focus search box</dd>
</dl></div></nav>
<div id="goto">
    <div class="search">
         <div class="text"></div>
         <div class="results"><ul></ul></div>
   </div>
</div>

  <div id="breadcrumbs" class="row-fluid">
          
              
        <ul class="breadcrumbs-container">
            <li><a href="index-2.html">PHP Manual</a></li>      <li><a href="funcref.html">Function Reference</a></li>      <li><a href="refs.remote.other.html">Other Services</a></li>      <li><a href="book.sockets.html">Sockets</a></li>      <li><a href="ref.sockets.html">Socket Functions</a></li>    </ul>
  </div>




<div id="layout">
  <section id="layout-content">
  <div id="function.socket-create" class="refentry">
 <div class="refnamediv">
  <h1 class="refname">socket_create</h1>
  <p class="verinfo">(PHP 4 &gt;= 4.1.0, PHP 5)</p><p class="refpurpose"><span class="refname">socket_create</span> â€” <span class="dc-title">Create a socket (endpoint for communication)</span></p>

 </div>
 
 <div class="refsect1 description" id="refsect1-function.socket-create-description">
  <h3 class="title">Description</h3>
  <div class="methodsynopsis dc-description">
   <span class="type">resource</span> <span class="methodname"><strong>socket_create</strong></span>
    ( <span class="methodparam"><span class="type">int</span> <code class="parameter">$domain</code></span>
   , <span class="methodparam"><span class="type">int</span> <code class="parameter">$type</code></span>
   , <span class="methodparam"><span class="type">int</span> <code class="parameter">$protocol</code></span>
   )</div>

  <p class="para rdfs-comment">
   Creates and returns a socket resource, also referred to as an endpoint
   of communication. A typical network connection is made up of 2 sockets, one
   performing the role of the client, and another performing the role of the server.
  </p>
 </div>


 <div class="refsect1 parameters" id="refsect1-function.socket-create-parameters">
  <h3 class="title">Parameters</h3>
  <p class="para">
   </p><dl>

    
     <dt>
<code class="parameter">domain</code></dt>

     <dd>

      <p class="para">
       The <code class="parameter">domain</code> parameter specifies the protocol
       family to be used by the socket.
      </p>
      <table class="doctable table">
       <caption><strong>Available address/protocol families</strong></caption>
       
        <thead>
         <tr>
          <th>Domain</th>
          <th>Description</th>
         </tr>

        </thead>

        <tbody class="tbody">
         <tr>
          <td><strong><code>AF_INET</code></strong></td>
          <td>
           IPv4 Internet based protocols. TCP and UDP are common protocols of
           this protocol family.
          </td>
         </tr>

         <tr>
          <td><strong><code>AF_INET6</code></strong></td>
          <td>
           IPv6 Internet based protocols. TCP and UDP are common protocols of
           this protocol family.
          </td>
         </tr>

         <tr>
          <td><strong><code>AF_UNIX</code></strong></td>
          <td>
           Local communication protocol family. High efficiency and low
           overhead make it a great form of IPC (Interprocess Communication).
          </td>
         </tr>

        </tbody>
       
      </table>

     </dd>

    
    
     <dt>
<code class="parameter">type</code></dt>

     <dd>

      <p class="para">
       The <code class="parameter">type</code> parameter selects the type of communication
       to be used by the socket.
      </p>
      <table class="doctable table">
       <caption><strong>Available socket types</strong></caption>
       
        <thead>
         <tr>
          <th>Type</th>
          <th>Description</th>
         </tr>

        </thead>

        <tbody class="tbody">
         <tr>
          <td><strong><code>SOCK_STREAM</code></strong></td>
          <td>
           Provides sequenced, reliable, full-duplex, connection-based byte streams.
           An out-of-band data transmission mechanism may be supported.
           The TCP protocol is based on this socket type.
          </td>
         </tr>

         <tr>
          <td><strong><code>SOCK_DGRAM</code></strong></td>
          <td>
           Supports datagrams (connectionless, unreliable messages of a fixed maximum length).
           The UDP protocol is based on this socket type.
          </td>
         </tr>

           <tr>
          <td><strong><code>SOCK_SEQPACKET</code></strong></td>
          <td>
           Provides a sequenced, reliable, two-way connection-based data transmission path for
           datagrams of fixed maximum length;  a consumer is required to read an
           entire packet with each read call.
          </td>
         </tr>

         <tr>
          <td><strong><code>SOCK_RAW</code></strong></td>
          <td>
           Provides raw network protocol access. This special type of socket
           can be used to manually construct any type of protocol. A common use
           for this socket type is to perform ICMP requests (like ping).
          </td>
         </tr>

         <tr>
          <td><strong><code>SOCK_RDM</code></strong></td>
          <td>
           Provides a reliable datagram layer that does not guarantee ordering.
           This is most likely not implemented on your operating system.
          </td>
         </tr>

        </tbody>
       
      </table>

     </dd>

    
    
     <dt>
<code class="parameter">protocol</code></dt>

     <dd>

      <p class="para">
       The <code class="parameter">protocol</code> parameter sets the specific
       protocol within the specified <code class="parameter">domain</code> to be used
       when communicating on the returned socket. The proper value can be
       retrieved by name by using <span class="function"><a href="function.getprotobyname.html" class="function">getprotobyname()</a></span>. If
       the desired protocol is TCP, or UDP the corresponding constants
       <strong><code>SOL_TCP</code></strong>, and <strong><code>SOL_UDP</code></strong>
       can also be used.
      </p>
      <table class="doctable table">
       <caption><strong>Common protocols</strong></caption>
       
        <thead>
         <tr>
          <th>Name</th>
          <th>Description</th>
         </tr>

        </thead>

        <tbody class="tbody">
         <tr>
          <td>icmp</td>
          <td>
           The Internet Control Message Protocol is used primarily by gateways
           and hosts to report errors in datagram communication. The "ping"
           command (present in most modern operating systems) is an example
           application of ICMP.
          </td>
         </tr>

         <tr>
          <td>udp</td>
          <td>
           The User Datagram Protocol is a connectionless, unreliable,
           protocol with fixed record lengths. Due to these aspects, UDP
           requires a minimum amount of protocol overhead.
          </td>
         </tr>

         <tr>
          <td>tcp</td>
          <td>
           The Transmission Control Protocol is a reliable, connection based,
           stream oriented, full duplex protocol. TCP guarantees that all data packets
           will be received in the order in which they were sent. If any packet is somehow
           lost during communication, TCP will automatically retransmit the packet until
           the destination host acknowledges that packet. For reliability and performance
           reasons, the TCP implementation itself decides the appropriate octet boundaries
           of the underlying datagram communication layer. Therefore, TCP applications must
           allow for the possibility of partial record transmission.
          </td>
         </tr>

        </tbody>
       
      </table>

     </dd>

    
   </dl>

  <p></p>
 </div>


 <div class="refsect1 returnvalues" id="refsect1-function.socket-create-returnvalues">
  <h3 class="title">Return Values</h3>
  <p class="para">
   <span class="function"><strong>socket_create()</strong></span> returns a socket resource on success,
   or <strong><code>FALSE</code></strong> on error. The actual error code can be retrieved by calling
   <span class="function"><a href="function.socket-last-error.html" class="function">socket_last_error()</a></span>. This error code may be passed to
   <span class="function"><a href="function.socket-strerror.html" class="function">socket_strerror()</a></span> to get a textual explanation of the
   error.
  </p>
 </div>


 <div class="refsect1 errors" id="refsect1-function.socket-create-errors">
  <h3 class="title">Errors/Exceptions</h3>
   <p class="para">
    If an invalid <code class="parameter">domain</code> or
    <code class="parameter">type</code> is given, <span class="function"><strong>socket_create()</strong></span>
    defaults to <strong><code>AF_INET</code></strong> and
    <strong><code>SOCK_STREAM</code></strong> respectively and additionally emits an
    <strong><code>E_WARNING</code></strong> message.
   </p>
 </div>


 <div class="refsect1 seealso" id="refsect1-function.socket-create-seealso">
  <h3 class="title">See Also</h3>
  <p class="para">
   </p><ul class="simplelist">
    <li class="member"><span class="function"><a href="function.socket-accept.html" class="function" rel="rdfs-seeAlso">socket_accept()</a> - Accepts a connection on a socket</span></li>
    <li class="member"><span class="function"><a href="function.socket-bind.html" class="function" rel="rdfs-seeAlso">socket_bind()</a> - Binds a name to a socket</span></li>
    <li class="member"><span class="function"><a href="function.socket-connect.html" class="function" rel="rdfs-seeAlso">socket_connect()</a> - Initiates a connection on a socket</span></li>
    <li class="member"><span class="function"><a href="function.socket-listen.html" class="function" rel="rdfs-seeAlso">socket_listen()</a> - Listens for a connection on a socket</span></li>
    <li class="member"><span class="function"><a href="function.socket-last-error.html" class="function" rel="rdfs-seeAlso">socket_last_error()</a> - Returns the last error on the socket</span></li>
    <li class="member"><span class="function"><a href="function.socket-strerror.html" class="function" rel="rdfs-seeAlso">socket_strerror()</a> - Return a string describing a socket error</span></li>
   </ul>
  <p></p>
 </div>


</div>
<section id="usernotes">
 <div class="head"><h3 class="title">User Contributed Notes</h3></div><div id="allnotes">
  <div class="note" id="58257">  
  <a class="name">
  <strong class="user"><em>kyle gibson</em></strong></a><div class="date" title="2005-10-28 05:48"><strong>8 years ago</strong></div>
  <div class="text" id="Hcom58257">
<div class="phpcode"><code><span class="html">
Took me about 20 minutes to figure out the proper arguments to supply for a AF_UNIX socket. Anything else, and I would get a PHP warning about the 'type' not being supported. I hope this saves someone else time.<br><br><span class="default">&lt;?php <br>$socket </span><span class="keyword">= </span><span class="default">socket_create</span><span class="keyword">(</span><span class="default">AF_UNIX</span><span class="keyword">, </span><span class="default">SOCK_STREAM</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">);<br></span><span class="comment">// code<br></span><span class="default">?&gt;</span>
</span>
</code></div>
  </div>
 </div>
  <div class="note" id="101012">  
  <a class="name">
  <strong class="user"><em>geoff at spacevs dot com</em></strong></a><div class="date" title="2010-11-20 01:51"><strong>3 years ago</strong></div>
  <div class="text" id="Hcom101012">
<div class="phpcode"><code><span class="html">
Here is a ping function for PHP without using exec/system/passthrough/etc... Very useful to use to just test if a host is online before attempting to connect to it. Timeout is in seconds.<br><br><span class="default">&lt;?PHP<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="keyword">function </span><span class="default">ping</span><span class="keyword">(</span><span class="default">$host</span><span class="keyword">, </span><span class="default">$timeout </span><span class="keyword">= </span><span class="default">1</span><span class="keyword">) {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="comment">/* ICMP ping packet with a pre-calculated checksum */<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$package </span><span class="keyword">= </span><span class="string">"\x08\x00\x7d\x4b\x00\x00\x00\x00PingHost"</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$socket&nbsp; </span><span class="keyword">= </span><span class="default">socket_create</span><span class="keyword">(</span><span class="default">AF_INET</span><span class="keyword">, </span><span class="default">SOCK_RAW</span><span class="keyword">, </span><span class="default">1</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">socket_set_option</span><span class="keyword">(</span><span class="default">$socket</span><span class="keyword">, </span><span class="default">SOL_SOCKET</span><span class="keyword">, </span><span class="default">SO_RCVTIMEO</span><span class="keyword">, array(</span><span class="string">'sec' </span><span class="keyword">=&gt; </span><span class="default">$timeout</span><span class="keyword">, </span><span class="string">'usec' </span><span class="keyword">=&gt; </span><span class="default">0</span><span class="keyword">));<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">socket_connect</span><span class="keyword">(</span><span class="default">$socket</span><span class="keyword">, </span><span class="default">$host</span><span class="keyword">, </span><span class="default">null</span><span class="keyword">);<br><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$ts </span><span class="keyword">= </span><span class="default">microtime</span><span class="keyword">(</span><span class="default">true</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">socket_send</span><span class="keyword">(</span><span class="default">$socket</span><span class="keyword">, </span><span class="default">$package</span><span class="keyword">, </span><span class="default">strLen</span><span class="keyword">(</span><span class="default">$package</span><span class="keyword">), </span><span class="default">0</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if (</span><span class="default">socket_read</span><span class="keyword">(</span><span class="default">$socket</span><span class="keyword">, </span><span class="default">255</span><span class="keyword">))<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$result </span><span class="keyword">= </span><span class="default">microtime</span><span class="keyword">(</span><span class="default">true</span><span class="keyword">) - </span><span class="default">$ts</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; else&nbsp; &nbsp; </span><span class="default">$result </span><span class="keyword">= </span><span class="default">false</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">socket_close</span><span class="keyword">(</span><span class="default">$socket</span><span class="keyword">);<br><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; return </span><span class="default">$result</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; }<br></span><span class="default">?&gt;</span>
</span>
</code></div>
  </div>
 </div>
  <div class="note" id="43057">  
  <a class="name">
  <strong class="user"><em>david at eder dot us</em></strong></a><div class="date" title="2004-06-08 08:07"><strong>10 years ago</strong></div>
  <div class="text" id="Hcom43057">
<div class="phpcode"><code><span class="html">
Seems there aren't any examples of UDP clients out there.&nbsp; This is a tftp client.&nbsp; I hope this makes someone's life easier.<br><br><span class="default">&lt;?php<br>&nbsp; </span><span class="keyword">function </span><span class="default">tftp_fetch</span><span class="keyword">(</span><span class="default">$host</span><span class="keyword">, </span><span class="default">$filename</span><span class="keyword">)<br>&nbsp; {<br>&nbsp; &nbsp; </span><span class="default">$socket </span><span class="keyword">= </span><span class="default">socket_create</span><span class="keyword">(</span><span class="default">AF_INET</span><span class="keyword">, </span><span class="default">SOCK_DGRAM</span><span class="keyword">, </span><span class="default">SOL_UDP</span><span class="keyword">);<br><br>&nbsp; &nbsp; </span><span class="comment">// create the request packet<br>&nbsp; &nbsp; </span><span class="default">$packet </span><span class="keyword">= </span><span class="default">chr</span><span class="keyword">(</span><span class="default">0</span><span class="keyword">) . </span><span class="default">chr</span><span class="keyword">(</span><span class="default">1</span><span class="keyword">) . </span><span class="default">$filename </span><span class="keyword">. </span><span class="default">chr</span><span class="keyword">(</span><span class="default">0</span><span class="keyword">) . </span><span class="string">'octet' </span><span class="keyword">. </span><span class="default">chr</span><span class="keyword">(</span><span class="default">0</span><span class="keyword">);<br>&nbsp; &nbsp; </span><span class="comment">// UDP is connectionless, so we just send on it.<br>&nbsp; &nbsp; </span><span class="default">socket_sendto</span><span class="keyword">(</span><span class="default">$socket</span><span class="keyword">, </span><span class="default">$packet</span><span class="keyword">, </span><span class="default">strlen</span><span class="keyword">(</span><span class="default">$packet</span><span class="keyword">), </span><span class="default">0x100</span><span class="keyword">, </span><span class="default">$host</span><span class="keyword">, </span><span class="default">69</span><span class="keyword">);<br><br>&nbsp; &nbsp; </span><span class="default">$buffer </span><span class="keyword">= </span><span class="string">''</span><span class="keyword">;<br>&nbsp; &nbsp; </span><span class="default">$port </span><span class="keyword">= </span><span class="string">''</span><span class="keyword">;<br>&nbsp; &nbsp; </span><span class="default">$ret </span><span class="keyword">= </span><span class="string">''</span><span class="keyword">;<br>&nbsp; &nbsp; do<br>&nbsp; &nbsp; {<br>&nbsp; &nbsp; &nbsp; </span><span class="comment">// $buffer and $port both come back with information for the ack<br>&nbsp; &nbsp; &nbsp; // 516 = 4 bytes for the header + 512 bytes of data<br>&nbsp; &nbsp; &nbsp; </span><span class="default">socket_recvfrom</span><span class="keyword">(</span><span class="default">$socket</span><span class="keyword">, </span><span class="default">$buffer</span><span class="keyword">, </span><span class="default">516</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">$host</span><span class="keyword">, </span><span class="default">$port</span><span class="keyword">);<br><br>&nbsp; &nbsp; &nbsp; </span><span class="comment">// add the block number from the data packet to the ack packet<br>&nbsp; &nbsp; &nbsp; </span><span class="default">$packet </span><span class="keyword">= </span><span class="default">chr</span><span class="keyword">(</span><span class="default">0</span><span class="keyword">) . </span><span class="default">chr</span><span class="keyword">(</span><span class="default">4</span><span class="keyword">) . </span><span class="default">substr</span><span class="keyword">(</span><span class="default">$buffer</span><span class="keyword">, </span><span class="default">2</span><span class="keyword">, </span><span class="default">2</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; </span><span class="comment">// send ack<br>&nbsp; &nbsp; &nbsp; </span><span class="default">socket_sendto</span><span class="keyword">(</span><span class="default">$socket</span><span class="keyword">, </span><span class="default">$packet</span><span class="keyword">, </span><span class="default">strlen</span><span class="keyword">(</span><span class="default">$packet</span><span class="keyword">), </span><span class="default">0</span><span class="keyword">, </span><span class="default">$host</span><span class="keyword">, </span><span class="default">$port</span><span class="keyword">);<br><br>&nbsp; &nbsp; &nbsp; </span><span class="comment">// append the data to the return variable<br>&nbsp; &nbsp; &nbsp; // for large files this function should take a file handle as an arg<br>&nbsp; &nbsp; &nbsp; </span><span class="default">$ret </span><span class="keyword">.= </span><span class="default">substr</span><span class="keyword">(</span><span class="default">$buffer</span><span class="keyword">, </span><span class="default">4</span><span class="keyword">);<br>&nbsp; &nbsp; }<br>&nbsp; &nbsp; while(</span><span class="default">strlen</span><span class="keyword">(</span><span class="default">$buffer</span><span class="keyword">) == </span><span class="default">516</span><span class="keyword">);&nbsp; </span><span class="comment">// the first non-full packet is the last.<br>&nbsp; &nbsp; </span><span class="keyword">return </span><span class="default">$ret</span><span class="keyword">;<br>&nbsp; }<br></span><span class="default">?&gt;</span>
</span>
</code></div>
  </div>
 </div>
  <div class="note" id="80775">  
  <a class="name">
  <strong class="user"><em>Jean Charles MAMMANA</em></strong></a><div class="date" title="2008-01-31 04:54"><strong>6 years ago</strong></div>
  <div class="text" id="Hcom80775">
<div class="phpcode"><code><span class="html">
I've written the ping() function using socket_create() with SOCK_RAW.<br>(on Unix System, you need to have the root acces to execute this function)<br><br><span class="default">&lt;?php<br><br></span><span class="comment">/// start ping.inc.php ///<br><br></span><span class="default">$g_icmp_error </span><span class="keyword">= </span><span class="string">"No Error"</span><span class="keyword">;<br><br></span><span class="comment">// timeout in ms<br></span><span class="keyword">function </span><span class="default">ping</span><span class="keyword">(</span><span class="default">$host</span><span class="keyword">, </span><span class="default">$timeout</span><span class="keyword">)<br>{<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$port </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$datasize </span><span class="keyword">= </span><span class="default">64</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; global </span><span class="default">$g_icmp_error</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$g_icmp_error </span><span class="keyword">= </span><span class="string">"No Error"</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$ident </span><span class="keyword">= array(</span><span class="default">ord</span><span class="keyword">(</span><span class="string">'J'</span><span class="keyword">), </span><span class="default">ord</span><span class="keyword">(</span><span class="string">'C'</span><span class="keyword">));<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$seq&nbsp;&nbsp; </span><span class="keyword">= array(</span><span class="default">rand</span><span class="keyword">(</span><span class="default">0</span><span class="keyword">, </span><span class="default">255</span><span class="keyword">), </span><span class="default">rand</span><span class="keyword">(</span><span class="default">0</span><span class="keyword">, </span><span class="default">255</span><span class="keyword">));<br><br>&nbsp; &nbsp;&nbsp; </span><span class="default">$packet </span><span class="keyword">= </span><span class="string">''</span><span class="keyword">;<br>&nbsp; &nbsp;&nbsp; </span><span class="default">$packet </span><span class="keyword">.= </span><span class="default">chr</span><span class="keyword">(</span><span class="default">8</span><span class="keyword">); </span><span class="comment">// type = 8 : request<br>&nbsp; &nbsp;&nbsp; </span><span class="default">$packet </span><span class="keyword">.= </span><span class="default">chr</span><span class="keyword">(</span><span class="default">0</span><span class="keyword">); </span><span class="comment">// code = 0<br><br>&nbsp; &nbsp;&nbsp; </span><span class="default">$packet </span><span class="keyword">.= </span><span class="default">chr</span><span class="keyword">(</span><span class="default">0</span><span class="keyword">); </span><span class="comment">// checksum init<br>&nbsp; &nbsp;&nbsp; </span><span class="default">$packet </span><span class="keyword">.= </span><span class="default">chr</span><span class="keyword">(</span><span class="default">0</span><span class="keyword">); </span><span class="comment">// checksum init<br><br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$packet </span><span class="keyword">.= </span><span class="default">chr</span><span class="keyword">(</span><span class="default">$ident</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">]); </span><span class="comment">// identifier<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$packet </span><span class="keyword">.= </span><span class="default">chr</span><span class="keyword">(</span><span class="default">$ident</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">]); </span><span class="comment">// identifier<br><br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$packet </span><span class="keyword">.= </span><span class="default">chr</span><span class="keyword">(</span><span class="default">$seq</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">]); </span><span class="comment">// seq<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$packet </span><span class="keyword">.= </span><span class="default">chr</span><span class="keyword">(</span><span class="default">$seq</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">]); </span><span class="comment">// seq<br><br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="keyword">for (</span><span class="default">$i </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">; </span><span class="default">$i </span><span class="keyword">&lt; </span><span class="default">$datasize</span><span class="keyword">; </span><span class="default">$i</span><span class="keyword">++)<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$packet </span><span class="keyword">.= </span><span class="default">chr</span><span class="keyword">(</span><span class="default">0</span><span class="keyword">);<br><br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$chk </span><span class="keyword">= </span><span class="default">icmpChecksum</span><span class="keyword">(</span><span class="default">$packet</span><span class="keyword">);<br><br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$packet</span><span class="keyword">[</span><span class="default">2</span><span class="keyword">] = </span><span class="default">$chk</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">]; </span><span class="comment">// checksum init<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$packet</span><span class="keyword">[</span><span class="default">3</span><span class="keyword">] = </span><span class="default">$chk</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">]; </span><span class="comment">// checksum init<br><br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$sock </span><span class="keyword">= </span><span class="default">socket_create</span><span class="keyword">(</span><span class="default">AF_INET</span><span class="keyword">, </span><span class="default">SOCK_RAW</span><span class="keyword">,&nbsp; </span><span class="default">getprotobyname</span><span class="keyword">(</span><span class="string">'icmp'</span><span class="keyword">));<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$time_start </span><span class="keyword">= </span><span class="default">microtime</span><span class="keyword">();<br>&nbsp; &nbsp; </span><span class="default">socket_sendto</span><span class="keyword">(</span><span class="default">$sock</span><span class="keyword">, </span><span class="default">$packet</span><span class="keyword">, </span><span class="default">strlen</span><span class="keyword">(</span><span class="default">$packet</span><span class="keyword">), </span><span class="default">0</span><span class="keyword">, </span><span class="default">$host</span><span class="keyword">, </span><span class="default">$port</span><span class="keyword">);<br>&nbsp; &nbsp; <br><br>&nbsp; &nbsp; </span><span class="default">$read&nbsp;&nbsp; </span><span class="keyword">= array(</span><span class="default">$sock</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$write&nbsp; </span><span class="keyword">= </span><span class="default">NULL</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$except </span><span class="keyword">= </span><span class="default">NULL</span><span class="keyword">;<br><br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$select </span><span class="keyword">= </span><span class="default">socket_select</span><span class="keyword">(</span><span class="default">$read</span><span class="keyword">, </span><span class="default">$write</span><span class="keyword">, </span><span class="default">$except</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">$timeout </span><span class="keyword">* </span><span class="default">1000</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; if (</span><span class="default">$select </span><span class="keyword">=== </span><span class="default">NULL</span><span class="keyword">)<br>&nbsp; &nbsp; &nbsp; &nbsp; {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$g_icmp_error </span><span class="keyword">= </span><span class="string">"Select Error"</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">socket_close</span><span class="keyword">(</span><span class="default">$sock</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; return -</span><span class="default">1</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; }<br>&nbsp; &nbsp; &nbsp; &nbsp; elseif (</span><span class="default">$select </span><span class="keyword">=== </span><span class="default">0</span><span class="keyword">)<br>&nbsp; &nbsp; &nbsp; &nbsp; {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$g_icmp_error </span><span class="keyword">= </span><span class="string">"Timeout"</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">socket_close</span><span class="keyword">(</span><span class="default">$sock</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; return -</span><span class="default">1</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; }<br><br>&nbsp; &nbsp; </span><span class="default">$recv </span><span class="keyword">= </span><span class="string">''</span><span class="keyword">;<br>&nbsp; &nbsp; </span><span class="default">$time_stop </span><span class="keyword">= </span><span class="default">microtime</span><span class="keyword">();<br>&nbsp; &nbsp; </span><span class="default">socket_recvfrom</span><span class="keyword">(</span><span class="default">$sock</span><span class="keyword">, </span><span class="default">$recv</span><span class="keyword">, </span><span class="default">65535</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">$host</span><span class="keyword">, </span><span class="default">$port</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$recv </span><span class="keyword">= </span><span class="default">unpack</span><span class="keyword">(</span><span class="string">'C*'</span><span class="keyword">, </span><span class="default">$recv</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; if (</span><span class="default">$recv</span><span class="keyword">[</span><span class="default">10</span><span class="keyword">] !== </span><span class="default">1</span><span class="keyword">) </span><span class="comment">// ICMP proto = 1<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="keyword">{<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$g_icmp_error </span><span class="keyword">= </span><span class="string">"Not ICMP packet"</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">socket_close</span><span class="keyword">(</span><span class="default">$sock</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; return -</span><span class="default">1</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; }<br><br>&nbsp; &nbsp; &nbsp; &nbsp; if (</span><span class="default">$recv</span><span class="keyword">[</span><span class="default">21</span><span class="keyword">] !== </span><span class="default">0</span><span class="keyword">) </span><span class="comment">// ICMP response = 0<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="keyword">{<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$g_icmp_error </span><span class="keyword">= </span><span class="string">"Not ICMP response"</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">socket_close</span><span class="keyword">(</span><span class="default">$sock</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; return -</span><span class="default">1</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; }<br><br>&nbsp; &nbsp; &nbsp; &nbsp; if (</span><span class="default">$ident</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">] !== </span><span class="default">$recv</span><span class="keyword">[</span><span class="default">25</span><span class="keyword">] || </span><span class="default">$ident</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">] !== </span><span class="default">$recv</span><span class="keyword">[</span><span class="default">26</span><span class="keyword">])<br>&nbsp; &nbsp; &nbsp; &nbsp; {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$g_icmp_error </span><span class="keyword">= </span><span class="string">"Bad identification number"</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">socket_close</span><span class="keyword">(</span><span class="default">$sock</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; return -</span><span class="default">1</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; }<br>&nbsp; &nbsp; &nbsp; &nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; if (</span><span class="default">$seq</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">] !== </span><span class="default">$recv</span><span class="keyword">[</span><span class="default">27</span><span class="keyword">] || </span><span class="default">$seq</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">] !== </span><span class="default">$recv</span><span class="keyword">[</span><span class="default">28</span><span class="keyword">])<br>&nbsp; &nbsp; &nbsp; &nbsp; {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$g_icmp_error </span><span class="keyword">= </span><span class="string">"Bad sequence number"</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">socket_close</span><span class="keyword">(</span><span class="default">$sock</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; return -</span><span class="default">1</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; }<br><br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$ms </span><span class="keyword">= (</span><span class="default">$time_stop </span><span class="keyword">- </span><span class="default">$time_start</span><span class="keyword">) * </span><span class="default">1000</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; if (</span><span class="default">$ms </span><span class="keyword">&lt; </span><span class="default">0</span><span class="keyword">)<br>&nbsp; &nbsp; &nbsp; &nbsp; {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$g_icmp_error </span><span class="keyword">= </span><span class="string">"Response too long"</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$ms </span><span class="keyword">= -</span><span class="default">1</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; }<br><br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">socket_close</span><span class="keyword">(</span><span class="default">$sock</span><span class="keyword">);<br><br>&nbsp; &nbsp; &nbsp; &nbsp; return </span><span class="default">$ms</span><span class="keyword">;<br>}<br><br>function </span><span class="default">icmpChecksum</span><span class="keyword">(</span><span class="default">$data</span><span class="keyword">)<br>{<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$bit </span><span class="keyword">= </span><span class="default">unpack</span><span class="keyword">(</span><span class="string">'n*'</span><span class="keyword">, </span><span class="default">$data</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$sum </span><span class="keyword">= </span><span class="default">array_sum</span><span class="keyword">(</span><span class="default">$bit</span><span class="keyword">);<br><br>&nbsp; &nbsp; &nbsp; &nbsp; if (</span><span class="default">strlen</span><span class="keyword">(</span><span class="default">$data</span><span class="keyword">) % </span><span class="default">2</span><span class="keyword">) {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$temp </span><span class="keyword">= </span><span class="default">unpack</span><span class="keyword">(</span><span class="string">'C*'</span><span class="keyword">, </span><span class="default">$data</span><span class="keyword">[</span><span class="default">strlen</span><span class="keyword">(</span><span class="default">$data</span><span class="keyword">) - </span><span class="default">1</span><span class="keyword">]);<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$sum </span><span class="keyword">+= </span><span class="default">$temp</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">];<br>&nbsp; &nbsp; &nbsp; &nbsp; }<br><br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$sum </span><span class="keyword">= (</span><span class="default">$sum </span><span class="keyword">&gt;&gt; </span><span class="default">16</span><span class="keyword">) + (</span><span class="default">$sum </span><span class="keyword">&amp; </span><span class="default">0xffff</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$sum </span><span class="keyword">+= (</span><span class="default">$sum </span><span class="keyword">&gt;&gt; </span><span class="default">16</span><span class="keyword">);<br><br>&nbsp; &nbsp; &nbsp; &nbsp; return </span><span class="default">pack</span><span class="keyword">(</span><span class="string">'n*'</span><span class="keyword">, ~</span><span class="default">$sum</span><span class="keyword">);<br>}<br><br>function </span><span class="default">getLastIcmpError</span><span class="keyword">()<br>{<br>&nbsp; &nbsp; &nbsp; &nbsp; global </span><span class="default">$g_icmp_error</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; return </span><span class="default">$g_icmp_error</span><span class="keyword">;<br>}<br></span><span class="comment">/// end ping.inc.php ///<br></span><span class="default">?&gt;</span>
</span>
</code></div>
  </div>
 </div>
  <div class="note" id="108535">  
  <a class="name">
  <strong class="user"><em>ab1965 at yandex dot ru</em></strong></a><div class="date" title="2012-05-04 12:43"><strong>2 years ago</strong></div>
  <div class="text" id="Hcom108535">
<div class="phpcode"><code><span class="html">
It took some time to understand how one PHP process can communicate with another by means of unix udp sockets. Examples of 'server' and 'client' code are given below. Server is assumed to run before client starts.<br><br>'Server' code<br><span class="default">&lt;?php<br></span><span class="keyword">if (!</span><span class="default">extension_loaded</span><span class="keyword">(</span><span class="string">'sockets'</span><span class="keyword">)) {<br>&nbsp; &nbsp; die(</span><span class="string">'The sockets extension is not loaded.'</span><span class="keyword">);<br>}<br></span><span class="comment">// create unix udp socket<br></span><span class="default">$socket </span><span class="keyword">= </span><span class="default">socket_create</span><span class="keyword">(</span><span class="default">AF_UNIX</span><span class="keyword">, </span><span class="default">SOCK_DGRAM</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">);<br>if (!</span><span class="default">$socket</span><span class="keyword">)<br>&nbsp; &nbsp; &nbsp; &nbsp; die(</span><span class="string">'Unable to create AF_UNIX socket'</span><span class="keyword">);<br><br></span><span class="comment">// same socket will be used in recv_from and send_to<br></span><span class="default">$server_side_sock </span><span class="keyword">= </span><span class="default">dirname</span><span class="keyword">(</span><span class="default">__FILE__</span><span class="keyword">).</span><span class="string">"/server.sock"</span><span class="keyword">;<br>if (!</span><span class="default">socket_bind</span><span class="keyword">(</span><span class="default">$socket</span><span class="keyword">, </span><span class="default">$server_side_sock</span><span class="keyword">))<br>&nbsp; &nbsp; &nbsp; &nbsp; die(</span><span class="string">"Unable to bind to </span><span class="default">$server_side_sock</span><span class="string">"</span><span class="keyword">);<br><br>while(</span><span class="default">1</span><span class="keyword">) </span><span class="comment">// server never exits<br></span><span class="keyword">{<br></span><span class="comment">// receive query<br></span><span class="keyword">if (!</span><span class="default">socket_set_block</span><span class="keyword">(</span><span class="default">$socket</span><span class="keyword">))<br>&nbsp; &nbsp; &nbsp; &nbsp; die(</span><span class="string">'Unable to set blocking mode for socket'</span><span class="keyword">);<br></span><span class="default">$buf </span><span class="keyword">= </span><span class="string">''</span><span class="keyword">;<br></span><span class="default">$from </span><span class="keyword">= </span><span class="string">''</span><span class="keyword">;<br>echo </span><span class="string">"Ready to receive...\n"</span><span class="keyword">;<br></span><span class="comment">// will block to wait client query<br></span><span class="default">$bytes_received </span><span class="keyword">= </span><span class="default">socket_recvfrom</span><span class="keyword">(</span><span class="default">$socket</span><span class="keyword">, </span><span class="default">$buf</span><span class="keyword">, </span><span class="default">65536</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">$from</span><span class="keyword">);<br>if (</span><span class="default">$bytes_received </span><span class="keyword">== -</span><span class="default">1</span><span class="keyword">)<br>&nbsp; &nbsp; &nbsp; &nbsp; die(</span><span class="string">'An error occured while receiving from the socket'</span><span class="keyword">);<br>echo </span><span class="string">"Received </span><span class="default">$buf</span><span class="string"> from </span><span class="default">$from</span><span class="string">\n"</span><span class="keyword">;<br><br></span><span class="default">$buf </span><span class="keyword">.= </span><span class="string">"-&gt;Response"</span><span class="keyword">; </span><span class="comment">// process client query here<br><br>// send response<br></span><span class="keyword">if (!</span><span class="default">socket_set_nonblock</span><span class="keyword">(</span><span class="default">$socket</span><span class="keyword">))<br>&nbsp; &nbsp; &nbsp; &nbsp; die(</span><span class="string">'Unable to set nonblocking mode for socket'</span><span class="keyword">);<br></span><span class="comment">// client side socket filename is known from client request: $from<br></span><span class="default">$len </span><span class="keyword">= </span><span class="default">strlen</span><span class="keyword">(</span><span class="default">$buf</span><span class="keyword">);<br></span><span class="default">$bytes_sent </span><span class="keyword">= </span><span class="default">socket_sendto</span><span class="keyword">(</span><span class="default">$socket</span><span class="keyword">, </span><span class="default">$buf</span><span class="keyword">, </span><span class="default">$len</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">$from</span><span class="keyword">);<br>if (</span><span class="default">$bytes_sent </span><span class="keyword">== -</span><span class="default">1</span><span class="keyword">)<br>&nbsp; &nbsp; &nbsp; &nbsp; die(</span><span class="string">'An error occured while sending to the socket'</span><span class="keyword">);<br>else if (</span><span class="default">$bytes_sent </span><span class="keyword">!= </span><span class="default">$len</span><span class="keyword">)<br>&nbsp; &nbsp; &nbsp; &nbsp; die(</span><span class="default">$bytes_sent </span><span class="keyword">. </span><span class="string">' bytes have been sent instead of the ' </span><span class="keyword">. </span><span class="default">$len </span><span class="keyword">. </span><span class="string">' bytes expected'</span><span class="keyword">);<br>echo </span><span class="string">"Request processed\n"</span><span class="keyword">;<br>}<br></span><span class="default">?&gt;<br></span><br>'Client' code<br><span class="default">&lt;?php<br></span><span class="keyword">if (!</span><span class="default">extension_loaded</span><span class="keyword">(</span><span class="string">'sockets'</span><span class="keyword">)) {<br>&nbsp; &nbsp; die(</span><span class="string">'The sockets extension is not loaded.'</span><span class="keyword">);<br>}<br></span><span class="comment">// create unix udp socket<br></span><span class="default">$socket </span><span class="keyword">= </span><span class="default">socket_create</span><span class="keyword">(</span><span class="default">AF_UNIX</span><span class="keyword">, </span><span class="default">SOCK_DGRAM</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">);<br>if (!</span><span class="default">$socket</span><span class="keyword">)<br>&nbsp; &nbsp; &nbsp; &nbsp; die(</span><span class="string">'Unable to create AF_UNIX socket'</span><span class="keyword">);<br><br></span><span class="comment">// same socket will be later used in recv_from<br>// no binding is required if you wish only send and never receive<br></span><span class="default">$client_side_sock </span><span class="keyword">= </span><span class="default">dirname</span><span class="keyword">(</span><span class="default">__FILE__</span><span class="keyword">).</span><span class="string">"/client.sock"</span><span class="keyword">;<br>if (!</span><span class="default">socket_bind</span><span class="keyword">(</span><span class="default">$socket</span><span class="keyword">, </span><span class="default">$client_side_sock</span><span class="keyword">))<br>&nbsp; &nbsp; &nbsp; &nbsp; die(</span><span class="string">"Unable to bind to </span><span class="default">$client_side_sock</span><span class="string">"</span><span class="keyword">);<br><br></span><span class="comment">// use socket to send data<br></span><span class="keyword">if (!</span><span class="default">socket_set_nonblock</span><span class="keyword">(</span><span class="default">$socket</span><span class="keyword">))<br>&nbsp; &nbsp; &nbsp; &nbsp; die(</span><span class="string">'Unable to set nonblocking mode for socket'</span><span class="keyword">);<br></span><span class="comment">// server side socket filename is known apriori<br></span><span class="default">$server_side_sock </span><span class="keyword">= </span><span class="default">dirname</span><span class="keyword">(</span><span class="default">__FILE__</span><span class="keyword">).</span><span class="string">"/server.sock"</span><span class="keyword">;<br></span><span class="default">$msg </span><span class="keyword">= </span><span class="string">"Message"</span><span class="keyword">;<br></span><span class="default">$len </span><span class="keyword">= </span><span class="default">strlen</span><span class="keyword">(</span><span class="default">$msg</span><span class="keyword">);<br></span><span class="comment">// at this point 'server' process must be running and bound to receive from serv.sock<br></span><span class="default">$bytes_sent </span><span class="keyword">= </span><span class="default">socket_sendto</span><span class="keyword">(</span><span class="default">$socket</span><span class="keyword">, </span><span class="default">$msg</span><span class="keyword">, </span><span class="default">$len</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">$server_side_sock</span><span class="keyword">);<br>if (</span><span class="default">$bytes_sent </span><span class="keyword">== -</span><span class="default">1</span><span class="keyword">)<br>&nbsp; &nbsp; &nbsp; &nbsp; die(</span><span class="string">'An error occured while sending to the socket'</span><span class="keyword">);<br>else if (</span><span class="default">$bytes_sent </span><span class="keyword">!= </span><span class="default">$len</span><span class="keyword">)<br>&nbsp; &nbsp; &nbsp; &nbsp; die(</span><span class="default">$bytes_sent </span><span class="keyword">. </span><span class="string">' bytes have been sent instead of the ' </span><span class="keyword">. </span><span class="default">$len </span><span class="keyword">. </span><span class="string">' bytes expected'</span><span class="keyword">);<br><br></span><span class="comment">// use socket to receive data<br></span><span class="keyword">if (!</span><span class="default">socket_set_block</span><span class="keyword">(</span><span class="default">$socket</span><span class="keyword">))<br>&nbsp; &nbsp; &nbsp; &nbsp; die(</span><span class="string">'Unable to set blocking mode for socket'</span><span class="keyword">);<br></span><span class="default">$buf </span><span class="keyword">= </span><span class="string">''</span><span class="keyword">;<br></span><span class="default">$from </span><span class="keyword">= </span><span class="string">''</span><span class="keyword">;<br></span><span class="comment">// will block to wait server response<br></span><span class="default">$bytes_received </span><span class="keyword">= </span><span class="default">socket_recvfrom</span><span class="keyword">(</span><span class="default">$socket</span><span class="keyword">, </span><span class="default">$buf</span><span class="keyword">, </span><span class="default">65536</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">$from</span><span class="keyword">);<br>if (</span><span class="default">$bytes_received </span><span class="keyword">== -</span><span class="default">1</span><span class="keyword">)<br>&nbsp; &nbsp; &nbsp; &nbsp; die(</span><span class="string">'An error occured while receiving from the socket'</span><span class="keyword">);<br>echo </span><span class="string">"Received </span><span class="default">$buf</span><span class="string"> from </span><span class="default">$from</span><span class="string">\n"</span><span class="keyword">;<br><br></span><span class="comment">// close socket and delete own .sock file<br></span><span class="default">socket_close</span><span class="keyword">(</span><span class="default">$socket</span><span class="keyword">);<br></span><span class="default">unlink</span><span class="keyword">(</span><span class="default">$client_side_sock</span><span class="keyword">);<br>echo </span><span class="string">"Client exits\n"</span><span class="keyword">;<br></span><span class="default">?&gt;</span>
</span>
</code></div>
  </div>
 </div>
  <div class="note" id="81938">  
  <a class="name">
  <strong class="user"><em>alexander dot krause at ed-solutions dot de</em></strong></a><div class="date" title="2008-03-20 12:57"><strong>6 years ago</strong></div>
  <div class="text" id="Hcom81938">
<div class="phpcode"><code><span class="html">
On UNIX systems php needs /etc/protocols for constants like SOL_UDP and SOL_TCP.<br><br>This file was missing on my embedded platform.</span>
</code></div>
  </div>
 </div>
  <div class="note" id="68709">  
  <a class="name">
  <strong class="user"><em>jens at surefoot dot com</em></strong></a><div class="date" title="2006-08-08 05:46"><strong>8 years ago</strong></div>
  <div class="text" id="Hcom68709">
<div class="phpcode"><code><span class="html">
Please be aware that RAW sockets (as used for the ping example) are restricted to root accounts on *nix systems. Since web servers hardly ever run as root, they won't work on webpages.<br><br>On Windows based servers it should work regardless.</span>
</code></div>
  </div>
 </div>
  <div class="note" id="60438">  
  <a class="name"><strong class="user"><em>Anonymous</em></strong></a><div class="date" title="2006-01-06 02:36"><strong>8 years ago</strong></div>
  <div class="text" id="Hcom60438">
<div class="phpcode"><code><span class="html">
Here's a ping function that uses sockets instead of exec().&nbsp; Note: I was unable to get socket_create() to work without running from CLI as root.&nbsp; I've already calculated the package's checksum to simplify the code (the message is 'ping' but it doesn't actually matter).<br><br><span class="default">&lt;?php<br><br></span><span class="keyword">function </span><span class="default">ping</span><span class="keyword">(</span><span class="default">$host</span><span class="keyword">) {<br>&nbsp; &nbsp; </span><span class="default">$package </span><span class="keyword">= </span><span class="string">"\x08\x00\x19\x2f\x00\x00\x00\x00\x70\x69\x6e\x67"</span><span class="keyword">;<br><br>&nbsp; &nbsp; </span><span class="comment">/* create the socket, the last '1' denotes ICMP */&nbsp; &nbsp; <br>&nbsp; &nbsp; </span><span class="default">$socket </span><span class="keyword">= </span><span class="default">socket_create</span><span class="keyword">(</span><span class="default">AF_INET</span><span class="keyword">, </span><span class="default">SOCK_RAW</span><span class="keyword">, </span><span class="default">1</span><span class="keyword">);<br>&nbsp; &nbsp; <br>&nbsp; &nbsp; </span><span class="comment">/* set socket receive timeout to 1 second */<br>&nbsp; &nbsp; </span><span class="default">socket_set_option</span><span class="keyword">(</span><span class="default">$socket</span><span class="keyword">, </span><span class="default">SOL_SOCKET</span><span class="keyword">, </span><span class="default">SO_RCVTIMEO</span><span class="keyword">, array(</span><span class="string">"sec" </span><span class="keyword">=&gt; </span><span class="default">1</span><span class="keyword">, </span><span class="string">"usec" </span><span class="keyword">=&gt; </span><span class="default">0</span><span class="keyword">));<br>&nbsp; &nbsp; <br>&nbsp; &nbsp; </span><span class="comment">/* connect to socket */<br>&nbsp; &nbsp; </span><span class="default">socket_connect</span><span class="keyword">(</span><span class="default">$socket</span><span class="keyword">, </span><span class="default">$host</span><span class="keyword">, </span><span class="default">null</span><span class="keyword">);<br>&nbsp; &nbsp; <br>&nbsp; &nbsp; </span><span class="comment">/* record start time */<br>&nbsp; &nbsp; </span><span class="keyword">list(</span><span class="default">$start_usec</span><span class="keyword">, </span><span class="default">$start_sec</span><span class="keyword">) = </span><span class="default">explode</span><span class="keyword">(</span><span class="string">" "</span><span class="keyword">, </span><span class="default">microtime</span><span class="keyword">());<br>&nbsp; &nbsp; </span><span class="default">$start_time </span><span class="keyword">= ((float) </span><span class="default">$start_usec </span><span class="keyword">+ (float) </span><span class="default">$start_sec</span><span class="keyword">);<br>&nbsp; &nbsp; <br>&nbsp; &nbsp; </span><span class="default">socket_send</span><span class="keyword">(</span><span class="default">$socket</span><span class="keyword">, </span><span class="default">$package</span><span class="keyword">, </span><span class="default">strlen</span><span class="keyword">(</span><span class="default">$package</span><span class="keyword">), </span><span class="default">0</span><span class="keyword">);<br>&nbsp; &nbsp; <br>&nbsp; &nbsp; if(@</span><span class="default">socket_read</span><span class="keyword">(</span><span class="default">$socket</span><span class="keyword">, </span><span class="default">255</span><span class="keyword">)) {<br>&nbsp; &nbsp; &nbsp; &nbsp; list(</span><span class="default">$end_usec</span><span class="keyword">, </span><span class="default">$end_sec</span><span class="keyword">) = </span><span class="default">explode</span><span class="keyword">(</span><span class="string">" "</span><span class="keyword">, </span><span class="default">microtime</span><span class="keyword">());<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$end_time </span><span class="keyword">= ((float) </span><span class="default">$end_usec </span><span class="keyword">+ (float) </span><span class="default">$end_sec</span><span class="keyword">);<br>&nbsp; &nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$total_time </span><span class="keyword">= </span><span class="default">$end_time </span><span class="keyword">- </span><span class="default">$start_time</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; return </span><span class="default">$total_time</span><span class="keyword">;<br>&nbsp; &nbsp; } else {<br>&nbsp; &nbsp; &nbsp; &nbsp; return </span><span class="default">false</span><span class="keyword">;<br>&nbsp; &nbsp; }<br>&nbsp; &nbsp; <br>&nbsp; &nbsp; </span><span class="default">socket_close</span><span class="keyword">(</span><span class="default">$socket</span><span class="keyword">);<br>}<br><br></span><span class="default">?&gt;</span>
</span>
</code></div>
  </div>
 </div>
  <div class="note" id="49368">  
  <a class="name">
  <strong class="user"><em>david at eder dot us</em></strong></a><div class="date" title="2005-01-25 11:42"><strong>9 years ago</strong></div>
  <div class="text" id="Hcom49368">
<div class="phpcode"><code><span class="html">
Sometimes when you are running CLI, you need to know your own ip address.<br><br><span class="default">&lt;?php<br><br>&nbsp; $addr </span><span class="keyword">= </span><span class="default">my_ip</span><span class="keyword">();<br>&nbsp; echo </span><span class="string">"my ip address is </span><span class="default">$addr</span><span class="string">\n"</span><span class="keyword">;<br><br>&nbsp; function </span><span class="default">my_ip</span><span class="keyword">(</span><span class="default">$dest</span><span class="keyword">=</span><span class="string">'64.0.0.0'</span><span class="keyword">, </span><span class="default">$port</span><span class="keyword">=</span><span class="default">80</span><span class="keyword">)<br>&nbsp; {<br>&nbsp; &nbsp; </span><span class="default">$socket </span><span class="keyword">= </span><span class="default">socket_create</span><span class="keyword">(</span><span class="default">AF_INET</span><span class="keyword">, </span><span class="default">SOCK_DGRAM</span><span class="keyword">, </span><span class="default">SOL_UDP</span><span class="keyword">);<br>&nbsp; &nbsp; </span><span class="default">socket_connect</span><span class="keyword">(</span><span class="default">$socket</span><span class="keyword">, </span><span class="default">$dest</span><span class="keyword">, </span><span class="default">$port</span><span class="keyword">);<br>&nbsp; &nbsp; </span><span class="default">socket_getsockname</span><span class="keyword">(</span><span class="default">$socket</span><span class="keyword">, </span><span class="default">$addr</span><span class="keyword">, </span><span class="default">$port</span><span class="keyword">);<br>&nbsp; &nbsp; </span><span class="default">socket_close</span><span class="keyword">(</span><span class="default">$socket</span><span class="keyword">);<br>&nbsp; &nbsp; return </span><span class="default">$addr</span><span class="keyword">;<br>&nbsp; }<br></span><span class="default">?&gt;</span>
</span>
</code></div>
  </div>
 </div>
  <div class="note" id="19075">  
  <a class="name">
  <strong class="user"><em>evan at coeus hyphen group dot com</em></strong></a><div class="date" title="2002-02-14 06:33"><strong>12 years ago</strong></div>
  <div class="text" id="Hcom19075">
<div class="phpcode"><code><span class="html">
Okay I talked with Richard a little (via e-mail). We agree that getprotobyname() and using the constants should be the same in functionality and speed, the use of one or the other is merely coding style. Personally, we both think the constants are prettier :).<br><br>The eight different protocols are the ones implemented in PHP- not the total number in existance (RFC 1340 has 98).<br><br>All we disagree on is using 0- Richard says that "accordning to the official unix/bsd sockets 0 is more than fine." I think that since 0 is a reserved number according to RFC 1320, and when used usually refers to IP, not one of it's sub-protocols (TCP, UDP, etc.)</span>
</code></div>
  </div>
 </div>
  <div class="note" id="93415">  
  <a class="name">
  <strong class="user"><em>rhollencamp at gmail dot com</em></strong></a><div class="date" title="2009-09-08 09:29"><strong>4 years ago</strong></div>
  <div class="text" id="Hcom93415">
<div class="phpcode"><code><span class="html">
Note that if you create a socket with AF_UNIX, a file will be created in the filesystem. This file is not removed when you call socket_close - you should unlink the file after you close the socket.</span>
</code></div>
  </div>
 </div></div>

 
</section>    </section><!-- layout-content -->
        


  </div><!-- layout -->
         
  

    
 <!-- External and third party libraries. -->
 







<a id="toTop" href="javascript:;"><span id="toTopHover"></span><img width="40" height="40" alt="To Top" src="../../images/to-top%402x.png"></a>



<!-- Mirrored from php.net/manual/en/function.socket-create.php by HTTrack Website Copier/3.x [XR&CO'2013], Thu, 28 Aug 2014 16:46:19 GMT -->


</body></html>