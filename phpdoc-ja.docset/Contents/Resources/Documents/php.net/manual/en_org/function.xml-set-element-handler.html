<html><!-- Mirrored from php.net/manual/en/function.xml-set-element-handler.php by HTTrack Website Copier/3.x [XR&CO'2013], Thu, 28 Aug 2014 16:04:37 GMT --><!-- Added by HTTrack --><head><meta http-equiv="content-type" content="text/html;charset=utf-8"><!-- /Added by HTTrack -->


  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0"> 

  <title>xml_set_element_handler</title>

 <link rel="shortcut icon" href="../../favicon.ico">
 <link rel="search" type="application/opensearchdescription+xml" href="http://php.net/phpnetimprovedsearch.src" title="Add PHP.net search">
 <link rel="alternate" type="application/atom+xml" href="http://php.net/releases/feed.php" title="PHP Release feed">
 <link rel="alternate" type="application/atom+xml" href="http://php.net/feed.atom" title="PHP: Hypertext Preprocessor">

 <link rel="canonical" href="function.xml-set-element-handler.html">
 <link rel="shorturl" href="http://php.net/xml-set-element-handler">
 <link rel="alternate" href="http://php.net/xml-set-element-handler" hreflang="x-default">

 <link rel="contents" href="index-2.html">
 <link rel="index" href="ref.xml.html">
 <link rel="prev" href="function.xml-set-default-handler.html">
 <link rel="next" href="function.xml-set-end-namespace-decl-handler.html">

 <link rel="alternate" href="function.xml-set-element-handler.html" hreflang="en">
 <link rel="alternate" href="http://php.net/manual/pt_BR/function.xml-set-element-handler.php" hreflang="pt_BR">
 <link rel="alternate" href="http://php.net/manual/zh/function.xml-set-element-handler.php" hreflang="zh">
 <link rel="alternate" href="http://php.net/manual/fr/function.xml-set-element-handler.php" hreflang="fr">
 <link rel="alternate" href="http://php.net/manual/de/function.xml-set-element-handler.php" hreflang="de">
 <link rel="alternate" href="http://php.net/manual/it/function.xml-set-element-handler.php" hreflang="it">
 <link rel="alternate" href="http://php.net/manual/ja/function.xml-set-element-handler.php" hreflang="ja">
 <link rel="alternate" href="http://php.net/manual/ro/function.xml-set-element-handler.php" hreflang="ro">
 <link rel="alternate" href="http://php.net/manual/ru/function.xml-set-element-handler.php" hreflang="ru">
 <link rel="alternate" href="http://php.net/manual/es/function.xml-set-element-handler.php" hreflang="es">
 <link rel="alternate" href="http://php.net/manual/tr/function.xml-set-element-handler.php" hreflang="tr">

<link rel="stylesheet" type="text/css" href="../../cached8fe1.css?t=1401250819&amp;f=/fonts/Fira/fira.css" media="screen">
<link rel="stylesheet" type="text/css" href="../../cached4b8d.css?t=1404368420&amp;f=/fonts/Font-Awesome/css/fontello.css" media="screen">
<link rel="stylesheet" type="text/css" href="../../cached5065.css?t=1403329232&amp;f=/styles/theme-base.css" media="screen">
<link rel="stylesheet" type="text/css" href="../../cachedc78d.css?t=1401249623&amp;f=/styles/theme-medium.css" media="screen">

 <!--[if lte IE 7]>
 <link rel="stylesheet" type="text/css" href="http://php.net/styles/workarounds.ie7.css" media="screen">
 <![endif]-->

 <!--[if lte IE 8]>
 <script type="text/javascript">
  window.brokenIE = true;
 </script>
 <![endif]-->

 <!--[if lte IE 9]>
 <link rel="stylesheet" type="text/css" href="http://php.net/styles/workarounds.ie9.css" media="screen">
 <![endif]-->

 <!--[if IE]>
 <script type="text/javascript" src="http://php.net/js/ext/html5.js"></script>
 <![endif]-->

 <base>

</head>
<body class="docs " style="">


<div class="headsup"><a href="http://php.net/index.php#id2014-08-28-1">PHP 5.6.0 released</a></div>
<nav id="trick"><div><dl>
<dt><a href="getting-started.html">Getting Started</a></dt>
	<dd><a href="introduction.html">Introduction</a></dd>
	<dd><a href="tutorial.html">A simple tutorial</a></dd>
<dt><a href="langref.html">Language Reference</a></dt>
	<dd><a href="language.basic-syntax.html">Basic syntax</a></dd>
	<dd><a href="language.types.html">Types</a></dd>
	<dd><a href="language.variables.html">Variables</a></dd>
	<dd><a href="language.constants.html">Constants</a></dd>
	<dd><a href="language.expressions.html">Expressions</a></dd>
	<dd><a href="language.operators.html">Operators</a></dd>
	<dd><a href="language.control-structures.html">Control Structures</a></dd>
	<dd><a href="language.functions.html">Functions</a></dd>
	<dd><a href="language.oop5.html">Classes and Objects</a></dd>
	<dd><a href="language.namespaces.html">Namespaces</a></dd>
	<dd><a href="language.exceptions.html">Exceptions</a></dd>
	<dd><a href="language.generators.html">Generators</a></dd>
	<dd><a href="language.references.html">References Explained</a></dd>
	<dd><a href="reserved.variables.html">Predefined Variables</a></dd>
	<dd><a href="reserved.exceptions.html">Predefined Exceptions</a></dd>
	<dd><a href="reserved.interfaces.html">Predefined Interfaces and Classes</a></dd>
	<dd><a href="context.html">Context options and parameters</a></dd>
	<dd><a href="wrappers.html">Supported Protocols and Wrappers</a></dd>
</dl>
<dl>
<dt><a href="security.html">Security</a></dt>
	<dd><a href="security.intro.html">Introduction</a></dd>
	<dd><a href="security.general.html">General considerations</a></dd>
	<dd><a href="security.cgi-bin.html">Installed as CGI binary</a></dd>
	<dd><a href="security.apache.html">Installed as an Apache module</a></dd>
	<dd><a href="security.filesystem.html">Filesystem Security</a></dd>
	<dd><a href="security.database.html">Database Security</a></dd>
	<dd><a href="security.errors.html">Error Reporting</a></dd>
	<dd><a href="security.globals.html">Using Register Globals</a></dd>
	<dd><a href="security.variables.html">User Submitted Data</a></dd>
	<dd><a href="security.magicquotes.html">Magic Quotes</a></dd>
	<dd><a href="security.hiding.html">Hiding PHP</a></dd>
	<dd><a href="security.current.html">Keeping Current</a></dd>
<dt><a href="features.html">Features</a></dt>
	<dd><a href="features.http-auth.html">HTTP authentication with PHP</a></dd>
	<dd><a href="features.cookies.html">Cookies</a></dd>
	<dd><a href="features.sessions.html">Sessions</a></dd>
	<dd><a href="features.xforms.html">Dealing with XForms</a></dd>
	<dd><a href="features.file-upload.html">Handling file uploads</a></dd>
	<dd><a href="features.remote-files.html">Using remote files</a></dd>
	<dd><a href="features.connection-handling.html">Connection handling</a></dd>
	<dd><a href="features.persistent-connections.html">Persistent Database Connections</a></dd>
	<dd><a href="features.safe-mode.html">Safe Mode</a></dd>
	<dd><a href="features.commandline.html">Command line usage</a></dd>
	<dd><a href="features.gc.html">Garbage Collection</a></dd>
	<dd><a href="features.dtrace.html">DTrace Dynamic Tracing</a></dd>
</dl>
<dl>
<dt><a href="funcref.html">Function Reference</a></dt>
	<dd><a href="refs.basic.php.html">Affecting PHP's Behaviour</a></dd>
	<dd><a href="refs.utilspec.audio.html">Audio Formats Manipulation</a></dd>
	<dd><a href="refs.remote.auth.html">Authentication Services</a></dd>
	<dd><a href="refs.utilspec.cmdline.html">Command Line Specific Extensions</a></dd>
	<dd><a href="refs.compression.html">Compression and Archive Extensions</a></dd>
	<dd><a href="refs.creditcard.html">Credit Card Processing</a></dd>
	<dd><a href="refs.crypto.html">Cryptography Extensions</a></dd>
	<dd><a href="refs.database.html">Database Extensions</a></dd>
	<dd><a href="refs.calendar.html">Date and Time Related Extensions</a></dd>
	<dd><a href="refs.fileprocess.file.html">File System Related Extensions</a></dd>
	<dd><a href="refs.international.html">Human Language and Character Encoding Support</a></dd>
	<dd><a href="refs.utilspec.image.html">Image Processing and Generation</a></dd>
	<dd><a href="refs.remote.mail.html">Mail Related Extensions</a></dd>
	<dd><a href="refs.math.html">Mathematical Extensions</a></dd>
	<dd><a href="refs.utilspec.nontext.html">Non-Text MIME Output</a></dd>
	<dd><a href="refs.fileprocess.process.html">Process Control Extensions</a></dd>
	<dd><a href="refs.basic.other.html">Other Basic Extensions</a></dd>
	<dd><a href="refs.remote.other.html">Other Services</a></dd>
	<dd><a href="refs.search.html">Search Engine Extensions</a></dd>
	<dd><a href="refs.utilspec.server.html">Server Specific Extensions</a></dd>
	<dd><a href="refs.basic.session.html">Session Extensions</a></dd>
	<dd><a href="refs.basic.text.html">Text Processing</a></dd>
	<dd><a href="refs.basic.vartype.html">Variable and Type Related Extensions</a></dd>
	<dd><a href="refs.webservice.html">Web Services</a></dd>
	<dd><a href="refs.utilspec.windows.html">Windows Only Extensions</a></dd>
	<dd><a href="refs.xml.html">XML Manipulation</a></dd>
</dl>
<dl>
<dt>Keyboard Shortcuts</dt><dt>?</dt>
<dd>This help</dd>
<dt>j</dt>
<dd>Next menu item</dd>
<dt>k</dt>
<dd>Previous menu item</dd>
<dt>g p</dt>
<dd>Previous man page</dd>
<dt>g n</dt>
<dd>Next man page</dd>
<dt>G</dt>
<dd>Scroll to bottom</dd>
<dt>g g</dt>
<dd>Scroll to top</dd>
<dt>g h</dt>
<dd>Goto homepage</dd>
<dt>g s</dt>
<dd>Goto search<br>(current page)</dd>
<dt>/</dt>
<dd>Focus search box</dd>
</dl></div></nav>
<div id="goto">
    <div class="search">
         <div class="text"></div>
         <div class="results"><ul></ul></div>
   </div>
</div>

  <div id="breadcrumbs" class="row-fluid">
          
              
        <ul class="breadcrumbs-container">
            <li><a href="index-2.html">PHP Manual</a></li>      <li><a href="funcref.html">Function Reference</a></li>      <li><a href="refs.xml.html">XML Manipulation</a></li>      <li><a href="book.xml.html">XML Parser</a></li>      <li><a href="ref.xml.html">XML Parser Functions</a></li>    </ul>
  </div>




<div id="layout">
  <section id="layout-content">
  <div id="function.xml-set-element-handler" class="refentry">
 <div class="refnamediv">
  <h1 class="refname">xml_set_element_handler</h1>
  <p class="verinfo">(PHP 4, PHP 5)</p><p class="refpurpose"><span class="refname">xml_set_element_handler</span> â€” <span class="dc-title">Set up start and end element handlers</span></p>

 </div>
 
 <div class="refsect1 description" id="refsect1-function.xml-set-element-handler-description">
  <h3 class="title">Description</h3>
  <div class="methodsynopsis dc-description">
   <span class="type">bool</span> <span class="methodname"><strong>xml_set_element_handler</strong></span>
    ( <span class="methodparam"><span class="type">resource</span> <code class="parameter">$parser</code></span>
   , <span class="methodparam"><span class="type"><a href="language.types.callable.html" class="type callable">callable</a></span> <code class="parameter">$start_element_handler</code></span>
   , <span class="methodparam"><span class="type"><a href="language.types.callable.html" class="type callable">callable</a></span> <code class="parameter">$end_element_handler</code></span>
   )</div>

  <p class="para rdfs-comment">
   Sets the element handler functions for the XML <code class="parameter">parser</code>.
   <code class="parameter">start_element_handler</code> and
   <code class="parameter">end_element_handler</code> are strings containing
   the names of functions that must exist when <span class="function"><a href="function.xml-parse.html" class="function">xml_parse()</a></span>
   is called for <code class="parameter">parser</code>.
  </p>
 </div>


 <div class="refsect1 parameters" id="refsect1-function.xml-set-element-handler-parameters">
  <h3 class="title">Parameters</h3>
  <p class="para">
   </p><dl>

    
     <dt>
<code class="parameter">parser</code></dt>

     <dd>

      <p class="para">
       A reference to the XML parser to set up start and end element handler functions.
      </p>
     </dd>

    
    
     <dt>
<code class="parameter">start_element_handler</code></dt>

     <dd>

      <p class="para">
       The function named by <code class="parameter">start_element_handler</code>
       must accept three parameters:
       </p><div class="methodsynopsis dc-description">
        <span class="methodname"><span class="replaceable">start_element_handler</span></span>
         ( <span class="methodparam"><span class="type">resource</span> <code class="parameter">$parser</code></span>
        , <span class="methodparam"><span class="type">string</span> <code class="parameter">$name</code></span>
        , <span class="methodparam"><span class="type">array</span> <code class="parameter">$attribs</code></span>
        )</div>

       <dl>

        
         <dt>
<code class="parameter">parser</code></dt>
 
         <dd>

          <span class="simpara">
           The first parameter, <span class="replaceable">parser</span>, is a
           reference to the XML parser calling the handler.
          </span>
         </dd>

        
        
         <dt>
<code class="parameter">name</code></dt>

         <dd>

          <span class="simpara">
           The second parameter, <code class="parameter">name</code>, contains the name
           of the element for which this handler is called.If <a href="xml.case-folding.html" class="link">case-folding</a> is in effect for this
           parser, the element name will be in uppercase letters.
          </span>
         </dd>

        
        
         <dt>
<code class="parameter">attribs</code></dt>

         <dd>

          <span class="simpara">
           The third parameter, <code class="parameter">attribs</code>, contains an
           associative array with the element's attributes (if any).The keys
           of this array are the attribute names, the values are the attribute
           values.Attribute names are <a href="xml.case-folding.html" class="link">case-folded</a> on the same criteria as
           element names.Attribute values are <em class="emphasis">not</em>
           case-folded.
          </span>
          <span class="simpara">
           The original order of the attributes can be retrieved by walking
           through <code class="parameter">attribs</code> the normal way, using
           <span class="function"><a href="function.each.html" class="function">each()</a></span>.The first key in the array was the first
           attribute, and so on.
          </span>
         </dd>

        
       </dl>

      <p></p>
      <blockquote class="note"><p><strong class="note">Note</strong>: <span class="simpara">Instead of a function name, an
array containing an object reference and a method name can also be
supplied.</span></p></blockquote>
     </dd>

    
    
     <dt>
<code class="parameter">end_element_handler</code></dt>

     <dd>

      <p class="para">
       The function named by <code class="parameter">end_element_handler</code>
       must accept two parameters:
       </p><div class="methodsynopsis dc-description">
        <span class="methodname"><span class="replaceable">end_element_handler</span></span>
         ( <span class="methodparam"><span class="type">resource</span> <code class="parameter">$parser</code></span>
        , <span class="methodparam"><span class="type">string</span> <code class="parameter">$name</code></span>
        )</div>

       <dl>

        
         <dt>
<code class="parameter">parser</code></dt>
 
         <dd>

          <span class="simpara">
           The first parameter, <span class="replaceable">parser</span>, is a
           reference to the XML parser calling the handler.
          </span>
         </dd>

        
        
         <dt>
<code class="parameter">name</code></dt>

         <dd>

          <span class="simpara">
           The second parameter, <code class="parameter">name</code>, contains the name
           of the element for which this handler is called.If <a href="xml.case-folding.html" class="link">case-folding</a> is in effect for this
           parser, the element name will be in uppercase letters.
          </span>
         </dd>

        
       </dl>

      <p></p>
      <p class="para">
       If a handler function is set to an empty string, or <strong><code>FALSE</code></strong>, the handler
       in question is disabled.
      </p>
     </dd>

    
   </dl>

  <p></p>
 </div>


 <div class="refsect1 returnvalues" id="refsect1-function.xml-set-element-handler-returnvalues">
  <h3 class="title">Return Values</h3>
  <p class="para">
   Returns <strong><code>TRUE</code></strong> on success or <strong><code>FALSE</code></strong> on failure.
  </p>
 </div>


</div>
<section id="usernotes">
 <div class="head"><h3 class="title">User Contributed Notes</h3></div><div id="allnotes">
  <div class="note" id="85970">  
  <a class="name">
  <strong class="user"><em>kok at nachon dot nl</em></strong></a><div class="date" title="2008-09-26 06:44"><strong>5 years ago</strong></div>
  <div class="text" id="Hcom85970">
<div class="phpcode"><code><span class="html">
Here is another example of detecting empty elements. I works with libxml2. Note that it handles buffer boundaries.<br><br><span class="default">&lt;?php<br><br>$depth </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">; </span><span class="comment">//current depth, used for pretty printing<br></span><span class="default">$empty </span><span class="keyword">= </span><span class="default">false</span><span class="keyword">; </span><span class="comment">//whether the tag is empty<br></span><span class="default">$offset </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">; </span><span class="comment">//the index of the start of the current buffer within the stream<br><br></span><span class="keyword">function </span><span class="default">tagStart</span><span class="keyword">(</span><span class="default">$parser</span><span class="keyword">, </span><span class="default">$name</span><span class="keyword">, array </span><span class="default">$attribs</span><span class="keyword">) {<br>&nbsp; &nbsp; global </span><span class="default">$depth</span><span class="keyword">, </span><span class="default">$empty</span><span class="keyword">, </span><span class="default">$data</span><span class="keyword">, </span><span class="default">$offset</span><span class="keyword">, </span><span class="default">$lastchar</span><span class="keyword">;<br>&nbsp; &nbsp; </span><span class="default">$idx </span><span class="keyword">= </span><span class="default">xml_get_current_byte_index</span><span class="keyword">(</span><span class="default">$parser</span><span class="keyword">);<br>&nbsp; &nbsp; </span><span class="comment">/* xml_get_current_byte_index returns index within the streams and not<br>&nbsp; &nbsp; &nbsp;&nbsp; within the buffer.*/<br>&nbsp; &nbsp; <br>&nbsp; &nbsp; /* Check if the index is within the buffer. */<br>&nbsp; &nbsp; </span><span class="keyword">if (isset(</span><span class="default">$data</span><span class="keyword">[</span><span class="default">$idx </span><span class="keyword">- </span><span class="default">$offset</span><span class="keyword">])) {<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$c </span><span class="keyword">= </span><span class="default">$data</span><span class="keyword">[</span><span class="default">$idx </span><span class="keyword">- </span><span class="default">$offset</span><span class="keyword">];<br>&nbsp; &nbsp; } else {<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="comment">/* If it isn't simple use the last character of the buffer. */<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$c </span><span class="keyword">= </span><span class="default">$lastchar</span><span class="keyword">;<br>&nbsp; &nbsp; }<br>&nbsp; &nbsp; </span><span class="default">$empty </span><span class="keyword">= </span><span class="default">$c </span><span class="keyword">== </span><span class="string">'/'</span><span class="keyword">;<br>&nbsp; &nbsp; echo </span><span class="default">str_repeat</span><span class="keyword">(</span><span class="string">"\t"</span><span class="keyword">, </span><span class="default">$depth</span><span class="keyword">), </span><span class="string">"&lt;</span><span class="default">$name</span><span class="string">"</span><span class="keyword">, (</span><span class="default">$empty </span><span class="keyword">? </span><span class="string">'/&gt;' </span><span class="keyword">: </span><span class="string">'&gt;'</span><span class="keyword">), </span><span class="string">"\n"</span><span class="keyword">;<br>&nbsp; &nbsp; if (!</span><span class="default">$empty</span><span class="keyword">) ++</span><span class="default">$depth</span><span class="keyword">;<br>}<br><br>function </span><span class="default">tagEnd</span><span class="keyword">(</span><span class="default">$parser</span><span class="keyword">, </span><span class="default">$name</span><span class="keyword">) {<br>&nbsp; &nbsp; global </span><span class="default">$depth</span><span class="keyword">, </span><span class="default">$empty</span><span class="keyword">;<br>&nbsp; &nbsp; if (!</span><span class="default">$empty</span><span class="keyword">) {<br>&nbsp; &nbsp; &nbsp; &nbsp; --</span><span class="default">$depth</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; echo </span><span class="default">str_repeat</span><span class="keyword">(</span><span class="string">"\t"</span><span class="keyword">, </span><span class="default">$depth</span><span class="keyword">), </span><span class="string">"&lt;/</span><span class="default">$name</span><span class="string">&gt;\n"</span><span class="keyword">;<br>&nbsp; &nbsp; } else {<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$empty </span><span class="keyword">= </span><span class="default">false</span><span class="keyword">;<br>&nbsp; &nbsp; }<br>}<br><br></span><span class="default">$parser </span><span class="keyword">= </span><span class="default">xml_parser_create</span><span class="keyword">();<br></span><span class="default">xml_parser_set_option</span><span class="keyword">(</span><span class="default">$parser</span><span class="keyword">, </span><span class="default">XML_OPTION_CASE_FOLDING</span><span class="keyword">, </span><span class="default">false</span><span class="keyword">);<br></span><span class="default">xml_set_element_handler</span><span class="keyword">(</span><span class="default">$parser</span><span class="keyword">, </span><span class="string">'tagStart'</span><span class="keyword">, </span><span class="string">'tagEnd'</span><span class="keyword">);<br><br></span><span class="default">$data1 </span><span class="keyword">= </span><span class="string">'<br>&lt;test&gt;<br>&nbsp; &nbsp; &lt;empty att="3" /&gt;<br>&nbsp; &nbsp; &lt;nocontent&gt;&lt;/nocontent&gt;<br>&nbsp; &nbsp; &lt;content&gt;<br>&nbsp; &nbsp; &nbsp; &nbsp; &lt;empty/&gt;<br>&nbsp; &nbsp; &nbsp; &nbsp; &lt;empty/&gt;<br>&nbsp; &nbsp; &lt;/content&gt;<br>&nbsp; &nbsp; &lt;empty/'</span><span class="keyword">;<br><br></span><span class="default">$data2 </span><span class="keyword">= </span><span class="string">'&gt;<br>&nbsp; &nbsp; &lt;empty att="5" /&gt;<br>&lt;/test&gt;<br>'</span><span class="keyword">;<br><br></span><span class="default">$data </span><span class="keyword">= &amp;</span><span class="default">$data1</span><span class="keyword">;<br></span><span class="default">$length </span><span class="keyword">= </span><span class="default">strlen</span><span class="keyword">(</span><span class="default">$data1</span><span class="keyword">);<br></span><span class="default">$lastchar </span><span class="keyword">= </span><span class="default">$data</span><span class="keyword">[</span><span class="default">$length</span><span class="keyword">-</span><span class="default">1</span><span class="keyword">];<br></span><span class="default">xml_parse</span><span class="keyword">(</span><span class="default">$parser</span><span class="keyword">, </span><span class="default">$data1</span><span class="keyword">);<br></span><span class="default">$offset </span><span class="keyword">.= </span><span class="default">$length</span><span class="keyword">;<br></span><span class="default">$data </span><span class="keyword">= &amp;</span><span class="default">$data2</span><span class="keyword">;<br></span><span class="default">xml_parse</span><span class="keyword">(</span><span class="default">$parser</span><span class="keyword">, </span><span class="default">$data2</span><span class="keyword">);</span>
</span>
</code></div>
  </div>
 </div>
  <div class="note" id="73189">  
  <a class="name">
  <strong class="user"><em>darien at etelos dot com</em></strong></a><div class="date" title="2007-02-12 10:48"><strong>7 years ago</strong></div>
  <div class="text" id="Hcom73189">
<div class="phpcode"><code><span class="html">
This documentation is somewhat awry. I know it's been said many times before, but it bears repeating...<br><br>If using PHP4, you may be required to use xml_set_object() instead of calling any of the xml_set_*_handler() functions with a two-item array. It will work fine on PHP5, but move the same code to PHP4 and it will create one copie of $this (even if you use &amp;$this) for each handler you set!<br><br><span class="default">&lt;?php<br></span><span class="comment">// This code will fail mysteriously on PHP4.<br></span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">parser </span><span class="keyword">= </span><span class="default">xml_parser_create</span><span class="keyword">();<br></span><span class="default">xml_set_element_handler</span><span class="keyword">(<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">parser</span><span class="keyword">,<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; array(&amp;</span><span class="default">$this</span><span class="keyword">,</span><span class="string">"start_tag"</span><span class="keyword">),<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; array(&amp;</span><span class="default">$this</span><span class="keyword">,</span><span class="string">"end_tag"</span><span class="keyword">)<br>&nbsp; &nbsp; &nbsp; &nbsp; );<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">xml_set_character_data_handler</span><span class="keyword">(<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">parser</span><span class="keyword">,<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; array(&amp;</span><span class="default">$this</span><span class="keyword">,</span><span class="string">"tag_data"</span><span class="keyword">)<br>&nbsp; &nbsp; &nbsp; &nbsp; );<br></span><span class="default">?&gt;<br></span><br><span class="default">&lt;?php<br></span><span class="comment">// This code will work on PHP4.<br></span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">parser </span><span class="keyword">= </span><span class="default">xml_parser_create</span><span class="keyword">();<br></span><span class="default">xml_set_object</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">parser</span><span class="keyword">,&amp;</span><span class="default">$this</span><span class="keyword">); <br></span><span class="default">xml_set_element_handler</span><span class="keyword">(<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">parser</span><span class="keyword">,<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="string">"start_tag"</span><span class="keyword">,<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="string">"end_tag"<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">xml_set_character_data_handler</span><span class="keyword">(<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">parser</span><span class="keyword">,<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="string">"tag_data"<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="keyword">);<br></span><span class="default">?&gt;</span>
</span>
</code></div>
  </div>
 </div>
  <div class="note" id="55360">  
  <a class="name">
  <strong class="user"><em>ibjoel at hotmail dot com</em></strong></a><div class="date" title="2005-08-01 03:49"><strong>9 years ago</strong></div>
  <div class="text" id="Hcom55360">
<div class="phpcode"><code><span class="html">
I noticed that in the example below, and all the examples I've seen on this site for viewing xml in html, the look of self closing tags such as &lt;br /&gt; are not preserved. The parser cannot distinguish between &lt;tag /&gt; and &lt;tag&gt;&lt;/tag&gt;, and if your start and end element functions are like these examples, both instances will be output with both an indvidual start and end tag.&nbsp; I needed to preserve self-closing tags and it took me a while to figure out this work around. Hope this helps someone...<br>&nbsp; <br>The start tag is left open, and then completed by it's first child, the next start tag or its end tag.&nbsp; The end tag will complete with " /&gt;", or &lt;/tag&gt; depending on the number of bytes between the start and end tags in the parsed data.<br><span class="default">&lt;?php<br></span><span class="comment">//$data=filepath or string<br></span><span class="default">$data</span><span class="keyword">=&lt;&lt;&lt;DATA<br></span><span class="string">&lt;normal_tag&gt;<br>&nbsp; &lt;self_close_tag /&gt;<br>&nbsp; &nbsp; &nbsp; data<br>&nbsp; &lt;normal_tag&gt;data<br>&nbsp; &nbsp;&nbsp; &lt;self_close_tag attr="value" /&gt;<br>&nbsp; &lt;/normal_tag&gt;<br>&nbsp; &nbsp; &nbsp; data<br>&nbsp; &lt;normal_tag&gt;&lt;/normal_tag&gt;<br>&lt;/normal_tag&gt;<br></span><span class="keyword">DATA;<br><br>function </span><span class="default">startElement</span><span class="keyword">(</span><span class="default">$parser</span><span class="keyword">, </span><span class="default">$name</span><span class="keyword">, </span><span class="default">$attrs</span><span class="keyword">)<br>{<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">xml_set_character_data_handler</span><span class="keyword">(</span><span class="default">$parser</span><span class="keyword">, </span><span class="string">"characterData"</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; global </span><span class="default">$first_child</span><span class="keyword">, </span><span class="default">$start_byte</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; if(</span><span class="default">$first_child</span><span class="keyword">)&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="comment">//close start tag if neccessary<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="keyword">echo </span><span class="string">"&gt;&lt;br /&gt;"</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$first_child</span><span class="keyword">=</span><span class="default">true</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$start_byte</span><span class="keyword">=</span><span class="default">xml_get_current_byte_index </span><span class="keyword">(</span><span class="default">$parser</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; if(</span><span class="default">count</span><span class="keyword">(</span><span class="default">$attrs</span><span class="keyword">)&gt;=</span><span class="default">1</span><span class="keyword">){<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; foreach(</span><span class="default">$attrs </span><span class="keyword">as </span><span class="default">$x</span><span class="keyword">=&gt;</span><span class="default">$y</span><span class="keyword">){<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$attr_string </span><span class="keyword">.= </span><span class="string">" </span><span class="default">$x</span><span class="string">=\"</span><span class="default">$y</span><span class="string">\""</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br>&nbsp; &nbsp; &nbsp; &nbsp; }<br>&nbsp; &nbsp; &nbsp; &nbsp; echo </span><span class="default">htmlentities</span><span class="keyword">(</span><span class="string">"&lt;</span><span class="keyword">{</span><span class="default">$name</span><span class="keyword">}{</span><span class="default">$attr_string</span><span class="keyword">}</span><span class="string">"</span><span class="keyword">); </span><span class="comment">//unclosed starttag<br></span><span class="keyword">}<br><br>function </span><span class="default">endElement</span><span class="keyword">(</span><span class="default">$parser</span><span class="keyword">, </span><span class="default">$name</span><span class="keyword">)<br>{<br>&nbsp; &nbsp; &nbsp; &nbsp; global </span><span class="default">$first_child</span><span class="keyword">, </span><span class="default">$start_byte</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$byte</span><span class="keyword">=</span><span class="default">xml_get_current_byte_index </span><span class="keyword">(</span><span class="default">$parser</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; if(</span><span class="default">$byte</span><span class="keyword">-</span><span class="default">$start_byte</span><span class="keyword">&gt;</span><span class="default">2</span><span class="keyword">){&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">//if end tag is more than 2 bytes from start tag<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="keyword">if(</span><span class="default">$first_child</span><span class="keyword">)&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="comment">//close start tag if neccessary<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="keyword">echo </span><span class="string">"&gt;&lt;br /&gt;"</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; echo </span><span class="default">htmlentities</span><span class="keyword">(</span><span class="string">"&lt;/</span><span class="keyword">{</span><span class="default">$name</span><span class="keyword">}</span><span class="string">&gt;"</span><span class="keyword">).</span><span class="string">"&lt;br /&gt;"</span><span class="keyword">;&nbsp; </span><span class="comment">//individual end tag<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="keyword">}else<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; echo </span><span class="string">" /&gt;&lt;br /&gt;"</span><span class="keyword">;&nbsp; </span><span class="comment">// self closing tag<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$first_child</span><span class="keyword">=</span><span class="default">false</span><span class="keyword">;<br><br>}<br><br>function </span><span class="default">characterData</span><span class="keyword">(</span><span class="default">$parser</span><span class="keyword">, </span><span class="default">$data</span><span class="keyword">)<br>{<br>&nbsp; &nbsp; &nbsp; &nbsp; global </span><span class="default">$first_child</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; if(</span><span class="default">$first_child</span><span class="keyword">)&nbsp; </span><span class="comment">//if $data is first child, close start tag<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="keyword">echo </span><span class="string">"&gt;&lt;br /&gt;"</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; if(</span><span class="default">$data</span><span class="keyword">=</span><span class="default">trim</span><span class="keyword">(</span><span class="default">$data</span><span class="keyword">))<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; echo </span><span class="string">"&lt;font color='blue'&gt;</span><span class="default">$data</span><span class="string">&lt;/font&gt;&lt;br /&gt;"</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$first_child</span><span class="keyword">=</span><span class="default">false</span><span class="keyword">;<br>}<br><br>function </span><span class="default">ParseData</span><span class="keyword">(</span><span class="default">$data</span><span class="keyword">)<br>{<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$xml_parser </span><span class="keyword">= </span><span class="default">xml_parser_create</span><span class="keyword">();<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">xml_set_element_handler</span><span class="keyword">(</span><span class="default">$xml_parser</span><span class="keyword">, </span><span class="string">"startElement"</span><span class="keyword">, </span><span class="string">"endElement"</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">xml_parser_set_option</span><span class="keyword">(</span><span class="default">$xml_parser</span><span class="keyword">,</span><span class="default">XML_OPTION_CASE_FOLDING</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; if(</span><span class="default">is_file</span><span class="keyword">(</span><span class="default">$data</span><span class="keyword">))<br>&nbsp; &nbsp; &nbsp; &nbsp; {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if (!(</span><span class="default">$fp </span><span class="keyword">= </span><span class="default">fopen</span><span class="keyword">(</span><span class="default">$file</span><span class="keyword">, </span><span class="string">"r"</span><span class="keyword">))) {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; die(</span><span class="string">"could not open XML input"</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; while (</span><span class="default">$data </span><span class="keyword">= </span><span class="default">fread</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">, </span><span class="default">4096</span><span class="keyword">)) {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if (!</span><span class="default">xml_parse</span><span class="keyword">(</span><span class="default">$xml_parser</span><span class="keyword">, </span><span class="default">$data</span><span class="keyword">, </span><span class="default">feof</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">))) {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$error</span><span class="keyword">=</span><span class="default">xml_error_string</span><span class="keyword">(</span><span class="default">xml_get_error_code</span><span class="keyword">(</span><span class="default">$xml_parser</span><span class="keyword">));<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$line</span><span class="keyword">=</span><span class="default">xml_get_current_line_number</span><span class="keyword">(</span><span class="default">$xml_parser</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; die(</span><span class="default">sprintf</span><span class="keyword">(</span><span class="string">"XML error: %s at line %d"</span><span class="keyword">,</span><span class="default">$error</span><span class="keyword">,</span><span class="default">$line</span><span class="keyword">));<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br>&nbsp; &nbsp; &nbsp; &nbsp; }else{<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if (!</span><span class="default">xml_parse</span><span class="keyword">(</span><span class="default">$xml_parser</span><span class="keyword">, </span><span class="default">$data</span><span class="keyword">, </span><span class="default">1</span><span class="keyword">)) {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$error</span><span class="keyword">=</span><span class="default">xml_error_string</span><span class="keyword">(</span><span class="default">xml_get_error_code</span><span class="keyword">(</span><span class="default">$xml_parser</span><span class="keyword">));<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$line</span><span class="keyword">=</span><span class="default">xml_get_current_line_number</span><span class="keyword">(</span><span class="default">$xml_parser</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; die(</span><span class="default">sprintf</span><span class="keyword">(</span><span class="string">"XML error: %s at line %d"</span><span class="keyword">,</span><span class="default">$error</span><span class="keyword">,</span><span class="default">$line</span><span class="keyword">));<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br>&nbsp; &nbsp; &nbsp; &nbsp; }<br>&nbsp; &nbsp; &nbsp; &nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">xml_parser_free</span><span class="keyword">(</span><span class="default">$xml_parser</span><span class="keyword">);<br>}<br><br></span><span class="default">ParseData</span><span class="keyword">(</span><span class="default">$data</span><span class="keyword">);<br></span><span class="default">?&gt;</span>
</span>
</code></div>
  </div>
 </div>
  <div class="note" id="46731">  
  <a class="name">
  <strong class="user"><em>aw at avatartechnology dot com</em></strong></a><div class="date" title="2004-10-21 08:40"><strong>9 years ago</strong></div>
  <div class="text" id="Hcom46731">
<div class="phpcode"><code><span class="html">
In response to landb at mail dot net...<br><br>As the notes mention, you can pass an array that contains the reference to an object and a method name when you need... so you can call methods in your own class as handlers like this:<br><br>xml_set_element_handler($parser, array($this,"_startElement"), array($this,"_endElement"));<br><br>Hope it helps...</span>
</code></div>
  </div>
 </div>
  <div class="note" id="70840">  
  <a class="name">
  <strong class="user"><em>lloeki at gmail dot com</em></strong></a><div class="date" title="2006-10-31 03:07"><strong>7 years ago</strong></div>
  <div class="text" id="Hcom70840">
<div class="phpcode"><code><span class="html">
I modified the previous script, so that it is associative. I find it more useful that way. BTW I prefer strtolower() things, but that's not mandatory at all.<br><br><span class="default">&lt;?php<br><br>$file </span><span class="keyword">= </span><span class="string">"data.xml"</span><span class="keyword">;<br></span><span class="default">$depth </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">;<br></span><span class="default">$tree </span><span class="keyword">= array();<br></span><span class="default">$tree</span><span class="keyword">[</span><span class="string">'name'</span><span class="keyword">] = </span><span class="string">"root"</span><span class="keyword">;<br></span><span class="default">$stack</span><span class="keyword">[] = &amp;</span><span class="default">$tree</span><span class="keyword">;<br><br>function </span><span class="default">startElement</span><span class="keyword">(</span><span class="default">$parser</span><span class="keyword">, </span><span class="default">$name</span><span class="keyword">, </span><span class="default">$attrs</span><span class="keyword">) {<br>&nbsp;&nbsp; global </span><span class="default">$depth</span><span class="keyword">;<br>&nbsp;&nbsp; global </span><span class="default">$stack</span><span class="keyword">;<br>&nbsp;&nbsp; global </span><span class="default">$tree</span><span class="keyword">;<br>&nbsp; <br>&nbsp;&nbsp; </span><span class="default">$element </span><span class="keyword">= array();<br>&nbsp;&nbsp; foreach (</span><span class="default">$attrs </span><span class="keyword">as </span><span class="default">$key </span><span class="keyword">=&gt; </span><span class="default">$value</span><span class="keyword">) {<br>&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$element</span><span class="keyword">[</span><span class="default">strtolower</span><span class="keyword">(</span><span class="default">$key</span><span class="keyword">)]=</span><span class="default">$value</span><span class="keyword">;<br>&nbsp;&nbsp; }<br><br>&nbsp;&nbsp; </span><span class="default">end</span><span class="keyword">(</span><span class="default">$stack</span><span class="keyword">);<br>&nbsp;&nbsp; </span><span class="default">$stack</span><span class="keyword">[</span><span class="default">key</span><span class="keyword">(</span><span class="default">$stack</span><span class="keyword">)][</span><span class="default">strtolower</span><span class="keyword">(</span><span class="default">$name</span><span class="keyword">)] = &amp;</span><span class="default">$element</span><span class="keyword">;<br>&nbsp;&nbsp; </span><span class="default">$stack</span><span class="keyword">[</span><span class="default">strtolower</span><span class="keyword">(</span><span class="default">$name</span><span class="keyword">)] = &amp;</span><span class="default">$element</span><span class="keyword">;<br>&nbsp;&nbsp; <br>&nbsp;&nbsp; </span><span class="default">$depth</span><span class="keyword">++;<br>}<br><br>function </span><span class="default">endElement</span><span class="keyword">(</span><span class="default">$parser</span><span class="keyword">, </span><span class="default">$name</span><span class="keyword">) {<br>&nbsp;&nbsp; global </span><span class="default">$depth</span><span class="keyword">;<br>&nbsp;&nbsp; global </span><span class="default">$stack</span><span class="keyword">;<br><br>&nbsp;&nbsp; </span><span class="default">array_pop</span><span class="keyword">(</span><span class="default">$stack</span><span class="keyword">);<br>&nbsp;&nbsp; </span><span class="default">$depth</span><span class="keyword">--;<br>}<br><br></span><span class="default">$xml_parser </span><span class="keyword">= </span><span class="default">xml_parser_create</span><span class="keyword">();<br></span><span class="default">xml_set_element_handler</span><span class="keyword">(</span><span class="default">$xml_parser</span><span class="keyword">, </span><span class="string">"startElement"</span><span class="keyword">, </span><span class="string">"endElement"</span><span class="keyword">);<br>if (!(</span><span class="default">$fp </span><span class="keyword">= </span><span class="default">fopen</span><span class="keyword">(</span><span class="default">$file</span><span class="keyword">, </span><span class="string">"r"</span><span class="keyword">))) {<br>&nbsp;&nbsp; die(</span><span class="string">"could not open XML input"</span><span class="keyword">);<br>}<br><br>while (</span><span class="default">$data </span><span class="keyword">= </span><span class="default">fread</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">, </span><span class="default">4096</span><span class="keyword">)) {<br>&nbsp;&nbsp; if (!</span><span class="default">xml_parse</span><span class="keyword">(</span><span class="default">$xml_parser</span><span class="keyword">, </span><span class="default">$data</span><span class="keyword">, </span><span class="default">feof</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">))) {<br>&nbsp; &nbsp; &nbsp;&nbsp; die(</span><span class="default">sprintf</span><span class="keyword">(</span><span class="string">"XML error: %s at line %d"</span><span class="keyword">,<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">xml_error_string</span><span class="keyword">(</span><span class="default">xml_get_error_code</span><span class="keyword">(</span><span class="default">$xml_parser</span><span class="keyword">)),<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">xml_get_current_line_number</span><span class="keyword">(</span><span class="default">$xml_parser</span><span class="keyword">)));<br>&nbsp;&nbsp; }<br>}<br></span><span class="default">xml_parser_free</span><span class="keyword">(</span><span class="default">$xml_parser</span><span class="keyword">);<br></span><span class="default">$tree </span><span class="keyword">= </span><span class="default">end</span><span class="keyword">(</span><span class="default">end</span><span class="keyword">(</span><span class="default">$stack</span><span class="keyword">));<br>echo </span><span class="string">"&lt;pre&gt;"</span><span class="keyword">;<br></span><span class="default">print_r</span><span class="keyword">(</span><span class="default">$tree</span><span class="keyword">);<br>echo </span><span class="string">"&lt;/pre&gt;"</span><span class="keyword">;<br><br></span><span class="default">?&gt;</span>
</span>
</code></div>
  </div>
 </div>
  <div class="note" id="69284">  
  <a class="name">
  <strong class="user"><em>rubentrancoso at gmail dot com</em></strong></a><div class="date" title="2006-08-29 01:44"><strong>7 years ago</strong></div>
  <div class="text" id="Hcom69284">
<div class="phpcode"><code><span class="html">
My 25 cents. This example show how to parse a XML in a associative array tree.<br><br><span class="default">&lt;?php<br><br>$file </span><span class="keyword">= </span><span class="string">"flow/flow.xml"</span><span class="keyword">;<br></span><span class="default">$depth </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">;<br></span><span class="default">$tree </span><span class="keyword">= array();<br></span><span class="default">$tree</span><span class="keyword">[</span><span class="string">'name'</span><span class="keyword">] = </span><span class="string">"root"</span><span class="keyword">; <br></span><span class="default">$stack</span><span class="keyword">[</span><span class="default">count</span><span class="keyword">(</span><span class="default">$stack</span><span class="keyword">)] = &amp;</span><span class="default">$tree</span><span class="keyword">;<br><br>function </span><span class="default">startElement</span><span class="keyword">(</span><span class="default">$parser</span><span class="keyword">, </span><span class="default">$name</span><span class="keyword">, </span><span class="default">$attrs</span><span class="keyword">) {<br>&nbsp;&nbsp; global </span><span class="default">$depth</span><span class="keyword">;<br>&nbsp;&nbsp; global </span><span class="default">$stack</span><span class="keyword">;<br>&nbsp;&nbsp; global </span><span class="default">$tree</span><span class="keyword">;<br>&nbsp;&nbsp; <br>&nbsp;&nbsp; </span><span class="default">$element </span><span class="keyword">= array();<br>&nbsp;&nbsp; </span><span class="default">$element</span><span class="keyword">[</span><span class="string">'name'</span><span class="keyword">] = </span><span class="default">$name</span><span class="keyword">;<br>&nbsp;&nbsp; foreach (</span><span class="default">$attrs </span><span class="keyword">as </span><span class="default">$key </span><span class="keyword">=&gt; </span><span class="default">$value</span><span class="keyword">) { <br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="comment">//echo $key."=".$value;<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$element</span><span class="keyword">[</span><span class="default">$key</span><span class="keyword">]=</span><span class="default">$value</span><span class="keyword">;<br>&nbsp; &nbsp; }<br><br>&nbsp;&nbsp; </span><span class="default">$last </span><span class="keyword">= &amp;</span><span class="default">$stack</span><span class="keyword">[</span><span class="default">count</span><span class="keyword">(</span><span class="default">$stack</span><span class="keyword">)-</span><span class="default">1</span><span class="keyword">];<br>&nbsp;&nbsp; </span><span class="default">$last</span><span class="keyword">[</span><span class="default">count</span><span class="keyword">(</span><span class="default">$last</span><span class="keyword">)-</span><span class="default">1</span><span class="keyword">] = &amp;</span><span class="default">$element</span><span class="keyword">;<br>&nbsp;&nbsp; </span><span class="default">$stack</span><span class="keyword">[</span><span class="default">count</span><span class="keyword">(</span><span class="default">$stack</span><span class="keyword">)] = &amp;</span><span class="default">$element</span><span class="keyword">;<br><br>&nbsp;&nbsp; </span><span class="default">$depth</span><span class="keyword">++;<br>}<br><br>function </span><span class="default">endElement</span><span class="keyword">(</span><span class="default">$parser</span><span class="keyword">, </span><span class="default">$name</span><span class="keyword">) {<br>&nbsp;&nbsp; global </span><span class="default">$depth</span><span class="keyword">;<br>&nbsp;&nbsp; global </span><span class="default">$stack</span><span class="keyword">;<br><br>&nbsp;&nbsp; </span><span class="default">array_pop</span><span class="keyword">(</span><span class="default">$stack</span><span class="keyword">);<br>&nbsp;&nbsp; </span><span class="default">$depth</span><span class="keyword">--;<br>}<br><br></span><span class="default">$xml_parser </span><span class="keyword">= </span><span class="default">xml_parser_create</span><span class="keyword">();<br></span><span class="default">xml_set_element_handler</span><span class="keyword">(</span><span class="default">$xml_parser</span><span class="keyword">, </span><span class="string">"startElement"</span><span class="keyword">, </span><span class="string">"endElement"</span><span class="keyword">);<br>if (!(</span><span class="default">$fp </span><span class="keyword">= </span><span class="default">fopen</span><span class="keyword">(</span><span class="default">$file</span><span class="keyword">, </span><span class="string">"r"</span><span class="keyword">))) {<br>&nbsp;&nbsp; die(</span><span class="string">"could not open XML input"</span><span class="keyword">);<br>}<br><br>while (</span><span class="default">$data </span><span class="keyword">= </span><span class="default">fread</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">, </span><span class="default">4096</span><span class="keyword">)) {<br>&nbsp;&nbsp; if (!</span><span class="default">xml_parse</span><span class="keyword">(</span><span class="default">$xml_parser</span><span class="keyword">, </span><span class="default">$data</span><span class="keyword">, </span><span class="default">feof</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">))) {<br>&nbsp; &nbsp; &nbsp;&nbsp; die(</span><span class="default">sprintf</span><span class="keyword">(</span><span class="string">"XML error: %s at line %d"</span><span class="keyword">,<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">xml_error_string</span><span class="keyword">(</span><span class="default">xml_get_error_code</span><span class="keyword">(</span><span class="default">$xml_parser</span><span class="keyword">)),<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">xml_get_current_line_number</span><span class="keyword">(</span><span class="default">$xml_parser</span><span class="keyword">)));<br>&nbsp;&nbsp; }<br>}<br></span><span class="default">xml_parser_free</span><span class="keyword">(</span><span class="default">$xml_parser</span><span class="keyword">);<br></span><span class="default">$tree </span><span class="keyword">= </span><span class="default">$stack</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">][</span><span class="default">0</span><span class="keyword">];<br>echo </span><span class="string">"&lt;pre&gt;"</span><span class="keyword">;<br></span><span class="default">print_r</span><span class="keyword">(</span><span class="default">$tree</span><span class="keyword">);<br>echo </span><span class="string">"&lt;/pre&gt;"</span><span class="keyword">;</span>
</span>
</code></div>
  </div>
 </div>
  <div class="note" id="66128">  
  <a class="name">
  <strong class="user"><em>redb</em></strong></a><div class="date" title="2006-05-15 05:48"><strong>8 years ago</strong></div>
  <div class="text" id="Hcom66128">
<div class="phpcode"><code><span class="html">
Example below (BadParser) works fine with some changes.<br><br>xml_set_element_handler ( $parser, array ( &amp;$this, 'tagStart' ), array ( &amp;$this, 'tagEnd' ) );<br>xml_set_character_data_handler ( $parser, array ( &amp;$this, 'tagContent' ) );</span>
</code></div>
  </div>
 </div>
  <div class="note" id="59694">  
  <a class="name">
  <strong class="user"><em>vladimir-leontiev at uiowa dot edu</em></strong></a><div class="date" title="2005-12-13 09:44"><strong>8 years ago</strong></div>
  <div class="text" id="Hcom59694">
<div class="phpcode"><code><span class="html">
It seems that characterData() gets characters in chuncks of 1024; therefore if you have string of characters between you tags that is longer than 1024 then characterData() will be called more that once for single pair of tags. I don't know if this feature(bug?) is documented anywhere, I just wanted to warn everyone about this; it had tripped me. I use php 4.3.10 on Linux.</span>
</code></div>
  </div>
 </div>
  <div class="note" id="58893">  
  <a class="name">
  <strong class="user"><em>hendra_g at hotmail dot com</em></strong></a><div class="date" title="2005-11-19 08:10"><strong>8 years ago</strong></div>
  <div class="text" id="Hcom58893">
<div class="phpcode"><code><span class="html">
I ran into the same problem with 'ibjoel at hotmail dot com' in regards to self-closing tags, and found that the script that he/she wrote did not work as I expected.<br>I played around with some of php's functions and examples and compiled something, which may not be the neatest solution, but it works for the data that 'ibjoel at hotmail dot com' provided.<br>The data needs to be read from a file though, so the fp can be utilised. It still uses the xml_get_current_byte_index(resource parser) trick, but this time, I check for the last 2 character before the index and test if it's "/&gt;".<br><br><span class="default">&lt;?php<br></span><span class="comment">/* myxmltest.xml:<br>&lt;normal_tag&gt;<br>&nbsp; &lt;self_close_tag /&gt;<br>&nbsp; &nbsp;&nbsp; data<br>&nbsp; &lt;normal_tag&gt;data<br>&nbsp; &nbsp;&nbsp; &lt;self_close_tag attr="value" /&gt;<br>&nbsp; &lt;/normal_tag&gt;<br>&nbsp; &nbsp;&nbsp; data<br>&nbsp; &lt;normal_tag&gt;&lt;/normal_tag&gt;<br>&lt;/normal_tag&gt;<br>*/<br><br>//## Global Variables ##//<br></span><span class="default">$file </span><span class="keyword">= </span><span class="string">"myxmltest.xml"</span><span class="keyword">;<br></span><span class="default">$character_data_on </span><span class="keyword">= </span><span class="default">false</span><span class="keyword">;<br></span><span class="default">$tag_complete </span><span class="keyword">= </span><span class="default">true</span><span class="keyword">;<br><br>function </span><span class="default">startElement</span><span class="keyword">(</span><span class="default">$parser</span><span class="keyword">, </span><span class="default">$name</span><span class="keyword">, </span><span class="default">$attrs</span><span class="keyword">) <br>{<br>&nbsp; &nbsp; global </span><span class="default">$character_data_on</span><span class="keyword">;<br>&nbsp; &nbsp; global </span><span class="default">$tag_complete</span><span class="keyword">;<br>&nbsp; &nbsp; <br>&nbsp; &nbsp; echo </span><span class="string">"&amp;lt;&lt;font color=\"#0000cc\"&gt;</span><span class="default">$name</span><span class="string">&lt;/font&gt;"</span><span class="keyword">;<br>&nbsp; &nbsp; </span><span class="comment">//## Print the attributes ##//<br>&nbsp; &nbsp; </span><span class="keyword">if (</span><span class="default">sizeof</span><span class="keyword">(</span><span class="default">$attrs</span><span class="keyword">)) {<br>&nbsp; &nbsp; &nbsp; &nbsp; while (list(</span><span class="default">$k</span><span class="keyword">, </span><span class="default">$v</span><span class="keyword">) = </span><span class="default">each</span><span class="keyword">(</span><span class="default">$attrs</span><span class="keyword">)) {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; echo </span><span class="string">" &lt;font color=\"#009900\"&gt;</span><span class="default">$k</span><span class="string">&lt;/font&gt;=\"&lt;font <br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; color=\"#990000\"&gt;</span><span class="default">$v</span><span class="string">&lt;/font&gt;\""</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; }<br>&nbsp; &nbsp; }<br>&nbsp; &nbsp; </span><span class="comment">//## Tag is still still incomplete,<br>&nbsp; &nbsp; //## will be completed at either endElement or characterData ##//<br>&nbsp; &nbsp; </span><span class="default">$tag_complete </span><span class="keyword">= </span><span class="default">false</span><span class="keyword">;<br>&nbsp; &nbsp; </span><span class="default">$character_data_on </span><span class="keyword">= </span><span class="default">false</span><span class="keyword">;<br>}<br><br>function </span><span class="default">endElement</span><span class="keyword">(</span><span class="default">$parser</span><span class="keyword">, </span><span class="default">$name</span><span class="keyword">) <br>{<br>&nbsp; &nbsp; global </span><span class="default">$fp</span><span class="keyword">;<br>&nbsp; &nbsp; global </span><span class="default">$character_data_on</span><span class="keyword">;<br>&nbsp; &nbsp; global </span><span class="default">$tag_complete</span><span class="keyword">;<br>&nbsp; &nbsp; <br>&nbsp; &nbsp; </span><span class="comment">//#### Test for self-closing tag ####//<br>&nbsp; &nbsp; //## xml_get_current_byte_index(resource parser) when run in this<br>&nbsp; &nbsp; //## function, gives the index at (indicated by *):<br>&nbsp; &nbsp; //##&nbsp;&nbsp; for self closing tag: &lt;br /&gt;*<br>&nbsp; &nbsp; //##&nbsp;&nbsp; for individual closing tag: &lt;div&gt;character data*&lt;/div&gt;<br>&nbsp; &nbsp; //## So to test for self-closing tag, we can just test for the last 2 <br>&nbsp; &nbsp; //## characters from the index<br>&nbsp; &nbsp; //###################################//<br>&nbsp; &nbsp; <br>&nbsp; &nbsp; </span><span class="keyword">if (!</span><span class="default">$character_data_on</span><span class="keyword">) {<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="comment">//## Record current fp position ##//<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$temp_fp </span><span class="keyword">= </span><span class="default">ftell</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="comment">//## Point fp to 2 bytes before the end element byte index ##//<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$end_element_byte_index </span><span class="keyword">= </span><span class="default">xml_get_current_byte_index</span><span class="keyword">(</span><span class="default">$parser</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">fseek</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">,</span><span class="default">$end_element_byte_index</span><span class="keyword">-</span><span class="default">2</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="comment">//## Gets the last 2 characters before the end element byte index ##//<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$validator </span><span class="keyword">= </span><span class="default">fgets</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">, </span><span class="default">3</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="comment">//## Restore fp position ##//<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">fseek</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">,</span><span class="default">$temp_fp</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="comment">//## If the last 2 character is "/&gt;" ##//<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="keyword">if (</span><span class="default">$validator</span><span class="keyword">==</span><span class="string">"/&gt;"</span><span class="keyword">) {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="comment">//// Complete the self-closing tag ////<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="keyword">echo </span><span class="string">" /&amp;gt"</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="comment">//// Otherwise it is an individual closing tag ////<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="keyword">} else echo </span><span class="string">"&amp;gt&amp;lt/&lt;font color=\"#0000cc\"&gt;</span><span class="default">$name</span><span class="string">&lt;/font&gt;&amp;gt"</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$tag_complete </span><span class="keyword">= </span><span class="default">true</span><span class="keyword">;<br>&nbsp; &nbsp; } else echo </span><span class="string">"&amp;lt/&lt;font color=\"#0000cc\"&gt;</span><span class="default">$name</span><span class="string">&lt;/font&gt;&amp;gt"</span><span class="keyword">;<br>&nbsp; &nbsp; <br>&nbsp; &nbsp; </span><span class="default">$character_data_on </span><span class="keyword">= </span><span class="default">false</span><span class="keyword">;<br>}<br><br>function </span><span class="default">characterData</span><span class="keyword">(</span><span class="default">$parser</span><span class="keyword">, </span><span class="default">$data</span><span class="keyword">) <br>{<br>&nbsp; &nbsp; global </span><span class="default">$character_data_on</span><span class="keyword">;<br>&nbsp; &nbsp; global </span><span class="default">$tag_complete</span><span class="keyword">;<br>&nbsp; &nbsp; <br>&nbsp; &nbsp; if ((!</span><span class="default">$character_data_on</span><span class="keyword">)&amp;&amp;(!</span><span class="default">$tag_complete</span><span class="keyword">)) {<br>&nbsp; &nbsp; &nbsp; &nbsp; echo </span><span class="string">"&amp;gt"</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$tag_complete </span><span class="keyword">= </span><span class="default">true</span><span class="keyword">;<br>&nbsp; &nbsp; }<br>&nbsp; &nbsp; echo </span><span class="string">"&lt;b&gt;</span><span class="default">$data</span><span class="string">&lt;/b&gt;"</span><span class="keyword">; <br>&nbsp; &nbsp; </span><span class="default">$character_data_on </span><span class="keyword">= </span><span class="default">true</span><span class="keyword">;<br>}<br><br></span><span class="default">$xml_parser </span><span class="keyword">= </span><span class="default">xml_parser_create</span><span class="keyword">();<br></span><span class="default">xml_parser_set_option</span><span class="keyword">(</span><span class="default">$xml_parser</span><span class="keyword">, </span><span class="default">XML_OPTION_CASE_FOLDING</span><span class="keyword">, </span><span class="default">false</span><span class="keyword">);<br></span><span class="default">xml_set_element_handler</span><span class="keyword">(</span><span class="default">$xml_parser</span><span class="keyword">, </span><span class="string">"startElement"</span><span class="keyword">, </span><span class="string">"endElement"</span><span class="keyword">);<br></span><span class="default">xml_set_character_data_handler</span><span class="keyword">(</span><span class="default">$xml_parser</span><span class="keyword">, </span><span class="string">"characterData"</span><span class="keyword">);<br>if (!(</span><span class="default">$fp </span><span class="keyword">= </span><span class="default">fopen</span><span class="keyword">(</span><span class="default">$file</span><span class="keyword">, </span><span class="string">"r"</span><span class="keyword">))) {<br>&nbsp; &nbsp; die(</span><span class="string">"could not open XML input"</span><span class="keyword">);<br>}<br><br>echo </span><span class="string">"&lt;pre&gt;"</span><span class="keyword">;<br>while (</span><span class="default">$file_content </span><span class="keyword">= </span><span class="default">fread</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">, </span><span class="default">4096</span><span class="keyword">)) {<br>&nbsp; &nbsp; if (!</span><span class="default">xml_parse</span><span class="keyword">(</span><span class="default">$xml_parser</span><span class="keyword">, </span><span class="default">$file_content</span><span class="keyword">, </span><span class="default">feof</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">))) {<br>&nbsp; &nbsp; &nbsp; &nbsp; die(</span><span class="default">sprintf</span><span class="keyword">(</span><span class="string">"XML error: %s at line %d"</span><span class="keyword">,<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">xml_error_string</span><span class="keyword">(</span><span class="default">xml_get_error_code</span><span class="keyword">(</span><span class="default">$xml_parser</span><span class="keyword">)),<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">xml_get_current_line_number</span><span class="keyword">(</span><span class="default">$xml_parser</span><span class="keyword">)));<br>&nbsp; &nbsp; }<br>}<br>echo </span><span class="string">"&lt;/pre&gt;"</span><span class="keyword">;<br></span><span class="default">xml_parser_free</span><span class="keyword">(</span><span class="default">$xml_parser</span><span class="keyword">);<br></span><span class="default">?&gt;</span>
</span>
</code></div>
  </div>
 </div>
  <div class="note" id="56955">  
  <a class="name">
  <strong class="user"><em>turan dot yuksel at tcmb dot gov dot tr</em></strong></a><div class="date" title="2005-09-20 03:41"><strong>8 years ago</strong></div>
  <div class="text" id="Hcom56955">
<div class="phpcode"><code><span class="html">
The method that 'ibjoel at hotmail dot com' have described requires libxml2 as the xml parser, it does not work with expat. For a brief explanation, see xml_get_current_byte_index.</span>
</code></div>
  </div>
 </div>
  <div class="note" id="52420">  
  <a class="name">
  <strong class="user"><em>youniforever at naver dot com</em></strong></a><div class="date" title="2005-04-30 03:41"><strong>9 years ago</strong></div>
  <div class="text" id="Hcom52420">
<div class="phpcode"><code><span class="html">
&lt;html&gt; <br>&nbsp; &lt;head&gt; <br>&nbsp; &nbsp; &lt;title&gt;SAX Demonstration&lt;/title&gt; <br>&nbsp;&nbsp; &lt;META HTTP-EQUIV='Content-type' CONTENT='text/html; charset=euc-kr'&gt; <br>&nbsp; &lt;/head&gt; <br>&nbsp; &lt;body&gt; <br>&nbsp; &nbsp; &lt;h1&gt;RSS ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½&lt;/h1&gt; <br>&nbsp; &nbsp; <br>&nbsp; &nbsp; &nbsp; <span class="default">&lt;?php <br><br>&nbsp; &nbsp;&nbsp; $file </span><span class="keyword">= </span><span class="string">"data.xml"</span><span class="keyword">; <br>&nbsp; &nbsp; &nbsp; <br>&nbsp; &nbsp; &nbsp; </span><span class="default">$currentTag </span><span class="keyword">= </span><span class="string">""</span><span class="keyword">; <br>&nbsp; &nbsp; &nbsp; </span><span class="default">$currentAttribs </span><span class="keyword">= </span><span class="string">""</span><span class="keyword">; <br><br>&nbsp; &nbsp; &nbsp; function </span><span class="default">startElement</span><span class="keyword">(</span><span class="default">$parser</span><span class="keyword">, </span><span class="default">$name</span><span class="keyword">, </span><span class="default">$attribs</span><span class="keyword">) <br>&nbsp; &nbsp; &nbsp; { <br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; global </span><span class="default">$currentTag</span><span class="keyword">, </span><span class="default">$currentAttribs</span><span class="keyword">; <br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$currentTag </span><span class="keyword">= </span><span class="default">$name</span><span class="keyword">; <br>&nbsp; &nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$currentAttribs </span><span class="keyword">= </span><span class="default">$attribs</span><span class="keyword">; <br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; switch (</span><span class="default">$name</span><span class="keyword">) { <br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; default: <br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; echo(</span><span class="string">"&lt;b&gt;&amp;lt</span><span class="default">$name</span><span class="string">&amp;gt&lt;/b&gt;&lt;br&gt;"</span><span class="keyword">); <br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; break; <br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; } <br>&nbsp; &nbsp; &nbsp; } <br><br>&nbsp; &nbsp; &nbsp; function </span><span class="default">endElement</span><span class="keyword">(</span><span class="default">$parser</span><span class="keyword">, </span><span class="default">$name</span><span class="keyword">) <br>&nbsp; &nbsp; &nbsp; { <br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; global </span><span class="default">$currentTag</span><span class="keyword">; <br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; switch (</span><span class="default">$name</span><span class="keyword">) { <br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; default: <br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; echo(</span><span class="string">"&lt;br&gt;&lt;b&gt;&amp;lt/</span><span class="default">$name</span><span class="string">&amp;gt&lt;/b&gt;&lt;br&gt;&lt;br&gt;"</span><span class="keyword">); <br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; break; <br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; } <br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$currentTag </span><span class="keyword">= </span><span class="string">""</span><span class="keyword">; <br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$currentAttribs </span><span class="keyword">= </span><span class="string">""</span><span class="keyword">; <br>&nbsp; &nbsp; &nbsp; } <br><br>&nbsp; &nbsp; &nbsp; function </span><span class="default">characterData</span><span class="keyword">(</span><span class="default">$parser</span><span class="keyword">, </span><span class="default">$data</span><span class="keyword">) <br>&nbsp; &nbsp; &nbsp; { <br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; global </span><span class="default">$currentTag</span><span class="keyword">; <br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; switch (</span><span class="default">$currentTag</span><span class="keyword">) { <br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; case </span><span class="string">"link"</span><span class="keyword">: <br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; echo(</span><span class="string">"&lt;a href=\"</span><span class="default">$data</span><span class="string">\"&gt;</span><span class="default">$data</span><span class="string">&lt;/a&gt;\n"</span><span class="keyword">); <br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; break; <br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; case </span><span class="string">"title"</span><span class="keyword">: <br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; echo(</span><span class="string">"title : </span><span class="default">$data</span><span class="string">"</span><span class="keyword">); <br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; break; <br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; default: <br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; echo(</span><span class="default">$data</span><span class="keyword">); <br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; break; <br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; } <br>&nbsp; &nbsp; &nbsp; } <br><br>&nbsp; &nbsp;&nbsp; </span><span class="default">$xmlParser </span><span class="keyword">= </span><span class="default">xml_parser_create</span><span class="keyword">(); <br>&nbsp; &nbsp; <br>&nbsp; &nbsp; &nbsp; </span><span class="default">$caseFold </span><span class="keyword">= </span><span class="default">xml_parser_get_option</span><span class="keyword">(</span><span class="default">$xmlParser</span><span class="keyword">, <br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">XML_OPTION_CASE_FOLDING</span><span class="keyword">); <br>&nbsp; &nbsp; <br>&nbsp; &nbsp; &nbsp; </span><span class="default">$targetEncoding </span><span class="keyword">= </span><span class="default">xml_parser_get_option</span><span class="keyword">(</span><span class="default">$xmlParser</span><span class="keyword">, <br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">XML_OPTION_TARGET_ENCODING</span><span class="keyword">); <br><br>&nbsp; &nbsp; &nbsp; if (</span><span class="default">$caseFold </span><span class="keyword">== </span><span class="default">1</span><span class="keyword">) { <br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">xml_parser_set_option</span><span class="keyword">(</span><span class="default">$xmlParser</span><span class="keyword">, </span><span class="default">XML_OPTION_CASE_FOLDING</span><span class="keyword">, </span><span class="default">false</span><span class="keyword">); <br>&nbsp; &nbsp; &nbsp; } <br><br>&nbsp; &nbsp; &nbsp; </span><span class="default">xml_set_element_handler</span><span class="keyword">(</span><span class="default">$xmlParser</span><span class="keyword">, </span><span class="string">"startElement"</span><span class="keyword">, </span><span class="string">"endElement"</span><span class="keyword">); <br>&nbsp; &nbsp; &nbsp; </span><span class="default">xml_set_character_data_handler</span><span class="keyword">(</span><span class="default">$xmlParser</span><span class="keyword">, </span><span class="string">"characterData"</span><span class="keyword">); <br><br>&nbsp; &nbsp; &nbsp; if (!(</span><span class="default">$fp </span><span class="keyword">= </span><span class="default">fopen</span><span class="keyword">(</span><span class="default">$file</span><span class="keyword">, </span><span class="string">"r"</span><span class="keyword">))) { <br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; die(</span><span class="string">"Cannot open XML data file: </span><span class="default">$file</span><span class="string">"</span><span class="keyword">); <br>&nbsp; &nbsp; &nbsp; } <br><br>&nbsp; &nbsp;&nbsp; while (</span><span class="default">$data </span><span class="keyword">= </span><span class="default">fread</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">, </span><span class="default">4096</span><span class="keyword">)) { <br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if (!</span><span class="default">xml_parse</span><span class="keyword">(</span><span class="default">$xmlParser</span><span class="keyword">, </span><span class="default">$data</span><span class="keyword">, </span><span class="default">feof</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">))) { <br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; die(</span><span class="default">sprintf</span><span class="keyword">(</span><span class="string">"XML error: %s at line %d"</span><span class="keyword">, <br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">xml_error_string</span><span class="keyword">(</span><span class="default">xml_get_error_code</span><span class="keyword">(</span><span class="default">$xmlParser</span><span class="keyword">)), <br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">xml_get_current_line_number</span><span class="keyword">(</span><span class="default">$xmlParser</span><span class="keyword">))); <br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">xml_parser_free</span><span class="keyword">(</span><span class="default">$xmlParser</span><span class="keyword">); <br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; } <br>&nbsp; &nbsp; &nbsp; } <br>&nbsp; &nbsp; &nbsp; </span><span class="default">xml_parser_free</span><span class="keyword">(</span><span class="default">$xmlParser</span><span class="keyword">); <br>&nbsp; &nbsp; &nbsp; </span><span class="default">?&gt;</span> <br>&nbsp; &nbsp; &lt;/table&gt; <br>&nbsp; &lt;/body&gt; <br>&lt;/html&gt;</span>
</code></div>
  </div>
 </div>
  <div class="note" id="29053">  
  <a class="name">
  <strong class="user"><em>tj at tobyjoe dot com</em></strong></a><div class="date" title="2003-01-31 11:22"><strong>11 years ago</strong></div>
  <div class="text" id="Hcom29053">
<div class="phpcode"><code><span class="html">
It seems that the tag handlers don't block on one another (the end handler is called whether or not the begin handler has finished). this can put you in a tight spot if you don't realize it while planning your app.</span>
</code></div>
  </div>
 </div>
  <div class="note" id="15985">  
  <a class="name"><strong class="user"><em>Anonymous</em></strong></a><div class="date" title="2001-10-11 04:09"><strong>12 years ago</strong></div>
  <div class="text" id="Hcom15985">
<div class="phpcode"><code><span class="html">
You CAN use classes to parse XML. Just take a look at the following function:
<br>
<br>xml_set_object</span>
</code></div>
  </div>
 </div>
  <div class="note" id="12782">  
  <a class="name">
  <strong class="user"><em>jg at jmkg dot net</em></strong></a><div class="date" title="2001-05-07 11:08"><strong>13 years ago</strong></div>
  <div class="text" id="Hcom12782">
<div class="phpcode"><code><span class="html">
If you are using a class for xml parsing, and want to check the return value of xml_set_element_handler in case it&nbsp; fails, you must do this outside of the class's constructor. Inside the constructor, PHP-4.0.5 will die.
<br>
<br>Basically, put all your xml initialisation code in another function of the class, and keep it out of the constructor.</span>
</code></div>
  </div>
 </div>
  <div class="note" id="50906">  
  <a class="name"><strong class="user"><em>Anonymous</em></strong></a><div class="date" title="2005-03-13 01:34"><strong>9 years ago</strong></div>
  <div class="text" id="Hcom50906">
<div class="phpcode"><code><span class="html">
In response to aw at avatartechnology dot com...<br>In response to landb at mail dot net...<br><br>When your functions are in an object:<br>Careful ! Don't forget to add: &amp; (reference) to your parameters.<br><br>xml_set_element_handler($parser, array(&amp;$this,"_startElement"), array(&amp;$this,"_endElement"));<br>--&gt; xmlparse will work on your object (good).<br><br>instead of:<br>xml_set_element_handler($parser, array($this,"_startElement"), array($this,"_endElement"));<br>---&gt; xmlparse will work on a COPY of your object (often bad)<br><br>Vin-s<br>(sorry for my english)</span>
</code></div>
  </div>
 </div></div>

 
</section>    </section><!-- layout-content -->
        


  </div><!-- layout -->
         
  

    
 <!-- External and third party libraries. -->
 







<a id="toTop" href="javascript:;"><span id="toTopHover"></span><img width="40" height="40" alt="To Top" src="../../images/to-top%402x.png"></a>



<!-- Mirrored from php.net/manual/en/function.xml-set-element-handler.php by HTTrack Website Copier/3.x [XR&CO'2013], Thu, 28 Aug 2014 16:04:37 GMT -->


</body></html>