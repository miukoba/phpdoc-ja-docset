<html><!-- Mirrored from php.net/manual/en/function.mysql-pconnect.php by HTTrack Website Copier/3.x [XR&CO'2013], Thu, 28 Aug 2014 15:29:52 GMT --><!-- Added by HTTrack --><head><meta http-equiv="content-type" content="text/html;charset=utf-8"><!-- /Added by HTTrack -->


  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0"> 

  <title>mysql_pconnect</title>

 <link rel="shortcut icon" href="../../favicon.ico">
 <link rel="search" type="application/opensearchdescription+xml" href="http://php.net/phpnetimprovedsearch.src" title="Add PHP.net search">
 <link rel="alternate" type="application/atom+xml" href="http://php.net/releases/feed.php" title="PHP Release feed">
 <link rel="alternate" type="application/atom+xml" href="http://php.net/feed.atom" title="PHP: Hypertext Preprocessor">

 <link rel="canonical" href="function.mysql-pconnect.html">
 <link rel="shorturl" href="http://php.net/mysql-pconnect">
 <link rel="alternate" href="http://php.net/mysql-pconnect" hreflang="x-default">

 <link rel="contents" href="index-2.html">
 <link rel="index" href="ref.mysql.html">
 <link rel="prev" href="function.mysql-num-rows.html">
 <link rel="next" href="function.mysql-ping.html">

 <link rel="alternate" href="function.mysql-pconnect.html" hreflang="en">
 <link rel="alternate" href="http://php.net/manual/pt_BR/function.mysql-pconnect.php" hreflang="pt_BR">
 <link rel="alternate" href="http://php.net/manual/zh/function.mysql-pconnect.php" hreflang="zh">
 <link rel="alternate" href="http://php.net/manual/fr/function.mysql-pconnect.php" hreflang="fr">
 <link rel="alternate" href="http://php.net/manual/de/function.mysql-pconnect.php" hreflang="de">
 <link rel="alternate" href="http://php.net/manual/it/function.mysql-pconnect.php" hreflang="it">
 <link rel="alternate" href="http://php.net/manual/ja/function.mysql-pconnect.php" hreflang="ja">
 <link rel="alternate" href="http://php.net/manual/ro/function.mysql-pconnect.php" hreflang="ro">
 <link rel="alternate" href="http://php.net/manual/ru/function.mysql-pconnect.php" hreflang="ru">
 <link rel="alternate" href="http://php.net/manual/es/function.mysql-pconnect.php" hreflang="es">
 <link rel="alternate" href="http://php.net/manual/tr/function.mysql-pconnect.php" hreflang="tr">

<link rel="stylesheet" type="text/css" href="../../cached8fe1.css?t=1401250819&amp;f=/fonts/Fira/fira.css" media="screen">
<link rel="stylesheet" type="text/css" href="../../cached4b8d.css?t=1404368420&amp;f=/fonts/Font-Awesome/css/fontello.css" media="screen">
<link rel="stylesheet" type="text/css" href="../../cached5065.css?t=1403329232&amp;f=/styles/theme-base.css" media="screen">
<link rel="stylesheet" type="text/css" href="../../cachedc78d.css?t=1401249623&amp;f=/styles/theme-medium.css" media="screen">

 <!--[if lte IE 7]>
 <link rel="stylesheet" type="text/css" href="http://php.net/styles/workarounds.ie7.css" media="screen">
 <![endif]-->

 <!--[if lte IE 8]>
 <script type="text/javascript">
  window.brokenIE = true;
 </script>
 <![endif]-->

 <!--[if lte IE 9]>
 <link rel="stylesheet" type="text/css" href="http://php.net/styles/workarounds.ie9.css" media="screen">
 <![endif]-->

 <!--[if IE]>
 <script type="text/javascript" src="http://php.net/js/ext/html5.js"></script>
 <![endif]-->

 <base>

</head>
<body class="docs " style="">


<div class="headsup"><a href="http://php.net/index.php#id2014-08-28-1">PHP 5.6.0 released</a></div>
<nav id="trick"><div><dl>
<dt><a href="getting-started.html">Getting Started</a></dt>
	<dd><a href="introduction.html">Introduction</a></dd>
	<dd><a href="tutorial.html">A simple tutorial</a></dd>
<dt><a href="langref.html">Language Reference</a></dt>
	<dd><a href="language.basic-syntax.html">Basic syntax</a></dd>
	<dd><a href="language.types.html">Types</a></dd>
	<dd><a href="language.variables.html">Variables</a></dd>
	<dd><a href="language.constants.html">Constants</a></dd>
	<dd><a href="language.expressions.html">Expressions</a></dd>
	<dd><a href="language.operators.html">Operators</a></dd>
	<dd><a href="language.control-structures.html">Control Structures</a></dd>
	<dd><a href="language.functions.html">Functions</a></dd>
	<dd><a href="language.oop5.html">Classes and Objects</a></dd>
	<dd><a href="language.namespaces.html">Namespaces</a></dd>
	<dd><a href="language.exceptions.html">Exceptions</a></dd>
	<dd><a href="language.generators.html">Generators</a></dd>
	<dd><a href="language.references.html">References Explained</a></dd>
	<dd><a href="reserved.variables.html">Predefined Variables</a></dd>
	<dd><a href="reserved.exceptions.html">Predefined Exceptions</a></dd>
	<dd><a href="reserved.interfaces.html">Predefined Interfaces and Classes</a></dd>
	<dd><a href="context.html">Context options and parameters</a></dd>
	<dd><a href="wrappers.html">Supported Protocols and Wrappers</a></dd>
</dl>
<dl>
<dt><a href="security.html">Security</a></dt>
	<dd><a href="security.intro.html">Introduction</a></dd>
	<dd><a href="security.general.html">General considerations</a></dd>
	<dd><a href="security.cgi-bin.html">Installed as CGI binary</a></dd>
	<dd><a href="security.apache.html">Installed as an Apache module</a></dd>
	<dd><a href="security.filesystem.html">Filesystem Security</a></dd>
	<dd><a href="security.database.html">Database Security</a></dd>
	<dd><a href="security.errors.html">Error Reporting</a></dd>
	<dd><a href="security.globals.html">Using Register Globals</a></dd>
	<dd><a href="security.variables.html">User Submitted Data</a></dd>
	<dd><a href="security.magicquotes.html">Magic Quotes</a></dd>
	<dd><a href="security.hiding.html">Hiding PHP</a></dd>
	<dd><a href="security.current.html">Keeping Current</a></dd>
<dt><a href="features.html">Features</a></dt>
	<dd><a href="features.http-auth.html">HTTP authentication with PHP</a></dd>
	<dd><a href="features.cookies.html">Cookies</a></dd>
	<dd><a href="features.sessions.html">Sessions</a></dd>
	<dd><a href="features.xforms.html">Dealing with XForms</a></dd>
	<dd><a href="features.file-upload.html">Handling file uploads</a></dd>
	<dd><a href="features.remote-files.html">Using remote files</a></dd>
	<dd><a href="features.connection-handling.html">Connection handling</a></dd>
	<dd><a href="features.persistent-connections.html">Persistent Database Connections</a></dd>
	<dd><a href="features.safe-mode.html">Safe Mode</a></dd>
	<dd><a href="features.commandline.html">Command line usage</a></dd>
	<dd><a href="features.gc.html">Garbage Collection</a></dd>
	<dd><a href="features.dtrace.html">DTrace Dynamic Tracing</a></dd>
</dl>
<dl>
<dt><a href="funcref.html">Function Reference</a></dt>
	<dd><a href="refs.basic.php.html">Affecting PHP's Behaviour</a></dd>
	<dd><a href="refs.utilspec.audio.html">Audio Formats Manipulation</a></dd>
	<dd><a href="refs.remote.auth.html">Authentication Services</a></dd>
	<dd><a href="refs.utilspec.cmdline.html">Command Line Specific Extensions</a></dd>
	<dd><a href="refs.compression.html">Compression and Archive Extensions</a></dd>
	<dd><a href="refs.creditcard.html">Credit Card Processing</a></dd>
	<dd><a href="refs.crypto.html">Cryptography Extensions</a></dd>
	<dd><a href="refs.database.html">Database Extensions</a></dd>
	<dd><a href="refs.calendar.html">Date and Time Related Extensions</a></dd>
	<dd><a href="refs.fileprocess.file.html">File System Related Extensions</a></dd>
	<dd><a href="refs.international.html">Human Language and Character Encoding Support</a></dd>
	<dd><a href="refs.utilspec.image.html">Image Processing and Generation</a></dd>
	<dd><a href="refs.remote.mail.html">Mail Related Extensions</a></dd>
	<dd><a href="refs.math.html">Mathematical Extensions</a></dd>
	<dd><a href="refs.utilspec.nontext.html">Non-Text MIME Output</a></dd>
	<dd><a href="refs.fileprocess.process.html">Process Control Extensions</a></dd>
	<dd><a href="refs.basic.other.html">Other Basic Extensions</a></dd>
	<dd><a href="refs.remote.other.html">Other Services</a></dd>
	<dd><a href="refs.search.html">Search Engine Extensions</a></dd>
	<dd><a href="refs.utilspec.server.html">Server Specific Extensions</a></dd>
	<dd><a href="refs.basic.session.html">Session Extensions</a></dd>
	<dd><a href="refs.basic.text.html">Text Processing</a></dd>
	<dd><a href="refs.basic.vartype.html">Variable and Type Related Extensions</a></dd>
	<dd><a href="refs.webservice.html">Web Services</a></dd>
	<dd><a href="refs.utilspec.windows.html">Windows Only Extensions</a></dd>
	<dd><a href="refs.xml.html">XML Manipulation</a></dd>
</dl>
<dl>
<dt>Keyboard Shortcuts</dt><dt>?</dt>
<dd>This help</dd>
<dt>j</dt>
<dd>Next menu item</dd>
<dt>k</dt>
<dd>Previous menu item</dd>
<dt>g p</dt>
<dd>Previous man page</dd>
<dt>g n</dt>
<dd>Next man page</dd>
<dt>G</dt>
<dd>Scroll to bottom</dd>
<dt>g g</dt>
<dd>Scroll to top</dd>
<dt>g h</dt>
<dd>Goto homepage</dd>
<dt>g s</dt>
<dd>Goto search<br>(current page)</dd>
<dt>/</dt>
<dd>Focus search box</dd>
</dl></div></nav>
<div id="goto">
    <div class="search">
         <div class="text"></div>
         <div class="results"><ul></ul></div>
   </div>
</div>

  <div id="breadcrumbs" class="row-fluid">
          
              
        <ul class="breadcrumbs-container">
            <li><a href="index-2.html">PHP Manual</a></li>      <li><a href="funcref.html">Function Reference</a></li>      <li><a href="refs.database.html">Database Extensions</a></li>      <li><a href="refs.database.vendors.html">Vendor Specific Database Extensions</a></li>      <li><a href="set.mysqlinfo.html">MySQL</a></li>      <li><a href="book.mysql.html">Mysql</a></li>      <li><a href="ref.mysql.html">MySQL Functions</a></li>    </ul>
  </div>




<div id="layout">
  <section id="layout-content">
  <div id="function.mysql-pconnect" class="refentry">
 <div class="refnamediv">
  <h1 class="refname">mysql_pconnect</h1>
  <p class="verinfo">(PHP 4, PHP 5)</p><p class="refpurpose"><span class="refname">mysql_pconnect</span> â€” <span class="dc-title">Open a persistent connection to a MySQL server</span></p>

 </div>

 <div id="function.mysql-pconnect-refsynopsisdiv">
  <div class="warning"><strong class="warning">Warning</strong>
   <p class="para">This extension is deprecated as of PHP 5.5.0, and will be removed in the future.
Instead, the <a href="book.mysqli.html" class="link">MySQLi</a> or <a href="ref.pdo-mysql.html" class="link">PDO_MySQL</a> extension should be used.
See also <a href="mysqlinfo.api.choosing.html" class="link">MySQL: choosing an API</a> guide and
<a href="faq.databases.html#faq.databases.mysql.deprecated" class="link">related FAQ</a> for more information. 
Alternatives to this function include:</p>
   <ul class="simplelist">
    <li class="member"><span class="function"><a href="function.mysqli-connect.html" class="function">mysqli_connect()</a></span> with <em>p:</em> host prefix</li>
    <li class="member"><span class="methodname"><a href="pdo.construct.html" class="methodname">PDO::__construct()</a></span> with <strong><code>PDO::ATTR_PERSISTENT</code></strong> as a driver option</li>
   </ul>
  </div>
 </div>

 <div class="refsect1 description" id="refsect1-function.mysql-pconnect-description">
  <h3 class="title">Description</h3>
  <div class="methodsynopsis dc-description">
   <span class="type">resource</span> <span class="methodname"><strong>mysql_pconnect</strong></span>
    ([ <span class="methodparam"><span class="type">string</span> <code class="parameter">$server</code><span class="initializer"> = ini_get("mysql.default_host")</span></span>
   [, <span class="methodparam"><span class="type">string</span> <code class="parameter">$username</code><span class="initializer"> = ini_get("mysql.default_user")</span></span>
   [, <span class="methodparam"><span class="type">string</span> <code class="parameter">$password</code><span class="initializer"> = ini_get("mysql.default_password")</span></span>
   [, <span class="methodparam"><span class="type">int</span> <code class="parameter">$client_flags</code><span class="initializer"> = 0</span></span>
  ]]]] )</div>

  
  <p class="para rdfs-comment">
   Establishes a persistent connection to a MySQL server.
  </p>
  
  <p class="para">
   <span class="function"><strong>mysql_pconnect()</strong></span> acts very much like
   <span class="function"><a href="function.mysql-connect.html" class="function">mysql_connect()</a></span> with two major differences.
  </p>
  <p class="para">
   First, when connecting, the function would first try to find a
   (persistent) link that's already open with the same host,
   username and password.  If one is found, an identifier for it
   will be returned instead of opening a new connection.
  </p>
  <p class="para">
   Second, the connection to the SQL server will not be closed when
   the execution of the script ends.  Instead, the link will remain
   open for future use (<span class="function"><a href="function.mysql-close.html" class="function">mysql_close()</a></span> will not
   close links established by <span class="function"><strong>mysql_pconnect()</strong></span>).
  </p>
  <p class="para">
   This type of link is therefore called 'persistent'.
  </p>
 </div>


 <div class="refsect1 parameters" id="refsect1-function.mysql-pconnect-parameters">
  <h3 class="title">Parameters</h3>
  <p class="para">
   </p><dl>

    
     <dt>
<code class="parameter">server</code></dt>

     <dd>

      <p class="para">
       The MySQL server. It can also include a port number. e.g. 
       "hostname:port" or a path to a local socket e.g. ":/path/to/socket" for 
       the localhost.
      </p>
      <p class="para">
       If the PHP directive <a href="mysql.configuration.html#ini.mysql.default-host" class="link">
       mysql.default_host</a> is undefined (default), then the default 
       value is 'localhost:3306'
      </p>
     </dd>

    
    
     <dt>
<code class="parameter">username</code></dt>

     <dd>

      <p class="para">
       The username. Default value is the name of the user that owns the
       server process.
      </p>
     </dd>

    
    
     <dt>
<code class="parameter">password</code></dt>

     <dd>

      <p class="para">
       The password. Default value is an empty password.
      </p>
     </dd>

    
    
     <dt>
<code class="parameter">client_flags</code></dt>

     <dd>

      <p class="para">
       The <code class="parameter">client_flags</code> parameter can be a combination 
       of the following constants:
       128 (enable <em>LOAD DATA LOCAL</em> handling),
       <strong><code>MYSQL_CLIENT_SSL</code></strong>, 
       <strong><code>MYSQL_CLIENT_COMPRESS</code></strong>, 
       <strong><code>MYSQL_CLIENT_IGNORE_SPACE</code></strong> or
       <strong><code>MYSQL_CLIENT_INTERACTIVE</code></strong>.
      </p>
     </dd>

     
   </dl>

  <p></p>
 </div>


 <div class="refsect1 returnvalues" id="refsect1-function.mysql-pconnect-returnvalues">
  <h3 class="title">Return Values</h3>
  <p class="para">
   Returns a MySQL persistent link identifier on success, or <strong><code>FALSE</code></strong> on 
   failure.
  </p>
 </div>

 
 <div class="refsect1 changelog" id="refsect1-function.mysql-pconnect-changelog">
  <h3 class="title">Changelog</h3>
  <p class="para">
   </p><table class="doctable informaltable">
    
     <thead>
      <tr>
       <th>Version</th>
       <th>Description</th>
      </tr>

     </thead>

     <tbody class="tbody">
      <tr>
       <td>5.5.0</td>
       <td>
        This function will generate an <strong><code>E_DEPRECATED</code></strong>
        error.
       </td>
      </tr>

     </tbody>
    
   </table>

  <p></p>
 </div>


 <div class="refsect1 notes" id="refsect1-function.mysql-pconnect-notes">
  <h3 class="title">Notes</h3>
  <blockquote class="note"><p><strong class="note">Note</strong>: 
   </p><p class="para">
    Note, that these kind of links only work if you are using
    a module version of PHP. See the
    <a href="features.persistent-connections.html" class="link">Persistent
    Database Connections</a> section for more information.
   </p>
  <p></p></blockquote>
  <div class="warning"><strong class="warning">Warning</strong>
   <p class="para">
    Using persistent connections can require a bit of tuning of your Apache
    and MySQL configurations to ensure that you do not exceed the number of
    connections allowed by MySQL.
   </p>
  </div>
  <blockquote class="note"><p><strong class="note">Note</strong>: 
   </p><p class="para">
    You can suppress the error message on failure by prepending 
    a <a href="language.operators.errorcontrol.html" class="link">@</a>
    to the function name.
   </p>
  <p></p></blockquote>
 </div>


 <div class="refsect1 seealso" id="refsect1-function.mysql-pconnect-seealso">
  <h3 class="title">See Also</h3>
  <p class="para">
   </p><ul class="simplelist">
    <li class="member"><span class="function"><a href="function.mysql-connect.html" class="function" rel="rdfs-seeAlso">mysql_connect()</a> - Open a connection to a MySQL Server</span></li>
    <li class="member"><a href="features.persistent-connections.html" class="link">Persistent
    Database Connections</a></li>
   </ul>
  <p></p>
 </div>

</div>
<section id="usernotes">
 <div class="head"><h3 class="title">User Contributed Notes</h3></div><div id="allnotes">
  <div class="note" id="56804">  
  <a class="name">
  <strong class="user"><em>Ron</em></strong></a><div class="date" title="2005-09-15 08:34"><strong>8 years ago</strong></div>
  <div class="text" id="Hcom56804">
<div class="phpcode"><code><span class="html">
Here's a nifty little class which will load balance across multiple replicated MySQL server instances, using persistent connections, automatically removing failed MySQL servers from the pool.<br><br>You would ONLY use this for queries, never inserts/updates/deletes, UNLESS you had a multi-master situation where updates to any database serverautomatically replicate to the other servers (I don't know whether that's possible with MySQL).<br><br>Using this class, you get a connection to a MySQL server like this:<br>&nbsp; &nbsp; $con = MySQLConnectionFactory::create();<br><br>Here is the class (you'll need to customize the $SERVERS array for your configuration -- note that you would probably use the same username, password and database for all of the servers, just changing the host name, but you're not forced to use the same ones):<br><br><span class="default">&lt;?php<br></span><span class="keyword">class </span><span class="default">MySQLConnectionFactory </span><span class="keyword">{<br>&nbsp; &nbsp; static </span><span class="default">$SERVERS </span><span class="keyword">= array(<br>&nbsp; &nbsp; array(<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="string">'host' </span><span class="keyword">=&gt; </span><span class="string">'myHost1'</span><span class="keyword">,<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="string">'username' </span><span class="keyword">=&gt; </span><span class="string">'myUsername1'</span><span class="keyword">,<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="string">'password' </span><span class="keyword">=&gt; </span><span class="string">'myPassword1'</span><span class="keyword">,<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="string">'database' </span><span class="keyword">=&gt; </span><span class="string">'myDatabase1'</span><span class="keyword">),<br>&nbsp; &nbsp; array(<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="string">'host' </span><span class="keyword">=&gt; </span><span class="string">'myHost2'</span><span class="keyword">,<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="string">'username' </span><span class="keyword">=&gt; </span><span class="string">'myUsername1'</span><span class="keyword">,<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="string">'password' </span><span class="keyword">=&gt; </span><span class="string">'myPassword2'</span><span class="keyword">,<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="string">'database' </span><span class="keyword">=&gt; </span><span class="string">'myDatabase2'</span><span class="keyword">)<br>&nbsp; &nbsp; );<br><br>&nbsp; &nbsp; public static function </span><span class="default">create</span><span class="keyword">() {<br>&nbsp; &nbsp; </span><span class="comment">// Figure out which connections are open, automatically opening any connections<br>&nbsp; &nbsp; // which are failed or not yet opened but can be (re)established.<br>&nbsp; &nbsp; </span><span class="default">$cons </span><span class="keyword">= array();<br>&nbsp; &nbsp; for (</span><span class="default">$i </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">, </span><span class="default">$n </span><span class="keyword">= </span><span class="default">count</span><span class="keyword">(</span><span class="default">MySQLConnectionFactory</span><span class="keyword">::</span><span class="default">$SERVERS</span><span class="keyword">); </span><span class="default">$i </span><span class="keyword">&lt; </span><span class="default">$n</span><span class="keyword">; </span><span class="default">$i</span><span class="keyword">++) {<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$server </span><span class="keyword">= </span><span class="default">MySQLConnectionFactory</span><span class="keyword">::</span><span class="default">$SERVERS</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">];<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$con </span><span class="keyword">= </span><span class="default">mysql_pconnect</span><span class="keyword">(</span><span class="default">$server</span><span class="keyword">[</span><span class="string">'host'</span><span class="keyword">], </span><span class="default">$server</span><span class="keyword">[</span><span class="string">'username'</span><span class="keyword">], </span><span class="default">$server</span><span class="keyword">[</span><span class="string">'password'</span><span class="keyword">]);<br>&nbsp; &nbsp; &nbsp; &nbsp; if (!(</span><span class="default">$con </span><span class="keyword">=== </span><span class="default">false</span><span class="keyword">)) {<br>&nbsp; &nbsp; &nbsp; &nbsp; if (</span><span class="default">mysql_select_db</span><span class="keyword">(</span><span class="default">$server</span><span class="keyword">[</span><span class="string">'database'</span><span class="keyword">], </span><span class="default">$con</span><span class="keyword">) === </span><span class="default">false</span><span class="keyword">) {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; echo(</span><span class="string">'Could not select database: ' </span><span class="keyword">. </span><span class="default">mysql_error</span><span class="keyword">());<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; continue;<br>&nbsp; &nbsp; &nbsp; &nbsp; }<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$cons</span><span class="keyword">[] = </span><span class="default">$con</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; }<br>&nbsp; &nbsp; }<br>&nbsp; &nbsp; </span><span class="comment">// If no servers are responding, throw an exception.<br>&nbsp; &nbsp; </span><span class="keyword">if (</span><span class="default">count</span><span class="keyword">(</span><span class="default">$cons</span><span class="keyword">) == </span><span class="default">0</span><span class="keyword">) {<br>&nbsp; &nbsp; &nbsp; &nbsp; throw new </span><span class="default">Exception<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="keyword">(</span><span class="string">'Unable to connect to any database servers - last error: ' </span><span class="keyword">. </span><span class="default">mysql_error</span><span class="keyword">());<br>&nbsp; &nbsp; }<br>&nbsp; &nbsp; </span><span class="comment">// Pick a random connection from the list of live connections.<br>&nbsp; &nbsp; </span><span class="default">$serverIdx </span><span class="keyword">= </span><span class="default">rand</span><span class="keyword">(</span><span class="default">0</span><span class="keyword">, </span><span class="default">count</span><span class="keyword">(</span><span class="default">$cons</span><span class="keyword">)-</span><span class="default">1</span><span class="keyword">);<br>&nbsp; &nbsp; </span><span class="default">$con </span><span class="keyword">= </span><span class="default">$cons</span><span class="keyword">[</span><span class="default">$serverIdx</span><span class="keyword">];<br>&nbsp; &nbsp; </span><span class="comment">// Return the connection.<br>&nbsp; &nbsp; </span><span class="keyword">return </span><span class="default">$con</span><span class="keyword">;<br>&nbsp; &nbsp; }<br>}<br></span><span class="default">?&gt;</span>
</span>
</code></div>
  </div>
 </div>
  <div class="note" id="85670">  
  <a class="name">
  <strong class="user"><em>david at hundsness dot com</em></strong></a><div class="date" title="2008-09-11 10:44"><strong>5 years ago</strong></div>
  <div class="text" id="Hcom85670">
<div class="phpcode"><code><span class="html">
Here's a recap of important reasons NOT to use persistent connections:<br><br>* When you lock a table, normally it is unlocked when the connection closes, but since persistent connections do not close, any tables you accidentally leave locked will remain locked, and the only way to unlock them is to wait for the connection to timeout or kill the process. The same locking problem occurs with transactions. (See comments below on 23-Apr-2002 &amp; 12-Jul-2003)<br><br>* Normally temporary tables are dropped when the connection closes, but since persistent connections do not close, temporary tables aren't so temporary. If you do not explicitly drop temporary tables when you are done, that table will already exist for a new client reusing the same connection. The same problem occurs with setting session variables. (See comments below on 19-Nov-2004 &amp; 07-Aug-2006)<br><br>* If PHP and MySQL are on the same server or local network, the connection time may be negligible, in which case there is no advantage to persistent connections.<br><br>* Apache does not work well with persistent connections. When it receives a request from a new client, instead of using one of the available children which already has a persistent connection open, it tends to spawn a new child, which must then open a new database connection. This causes excess processes which are just sleeping, wasting resources, and causing errors when you reach your maximum connections, plus it defeats any benefit of persistent connections. (See comments below on 03-Feb-2004, and the footnote at <a rel="nofollow" target="_blank">http://devzone.zend.com/node/view/id/686#fn1</a>)</span>
</code></div>
  </div>
 </div>
  <div class="note" id="95342">  
  <a class="name">
  <strong class="user"><em>Tom</em></strong></a><div class="date" title="2009-12-28 05:43"><strong>4 years ago</strong></div>
  <div class="text" id="Hcom95342">
<div class="phpcode"><code><span class="html">
Persistent connections work well for CGI PHP managed by fastCGI, contrary to the suggestion above that they only work for the module version. That's because fastCGI keeps PHP processes running between requests. Persistent connections in this mode are easily made immune to connection limits too, because you can set PHP_FCGI_CHILDREN &lt;&lt; mysql's max_connections &lt;&lt;&lt; Apache's MaxClients. This also saves resources.</span>
</code></div>
  </div>
 </div>
  <div class="note" id="26416">  
  <a class="name">
  <strong class="user"><em>fate_amendable_to_changeNOSPAM at yahoo dot com</em></strong></a><div class="date" title="2002-10-30 03:58"><strong>11 years ago</strong></div>
  <div class="text" id="Hcom26416">
<div class="phpcode"><code><span class="html">
To tell mysql_pconnect to connect to mysql on a port other than the default use a colon - eg<br><br>mysql_pconnect("127.0.0.1:4444", "user", "pass")<br><br>would connect to localhost on port 4444 <br><br>(useful for ssh tunneling etc)</span>
</code></div>
  </div>
 </div>
  <div class="note" id="40671">  
  <a class="name">
  <strong class="user"><em>matt *at* roughest *dot* net</em></strong></a><div class="date" title="2004-03-10 08:18"><strong>10 years ago</strong></div>
  <div class="text" id="Hcom40671">
<div class="phpcode"><code><span class="html">
Be very careful when using persistent connections on a machine running multiple mysql servers. You must specify the correct socket path, otherwise PHP will reuse connections irregardless of what server they are connected to. That is, it will see an open connection with matching parameters and use it, even if the connection is actually for a different server.</span>
</code></div>
  </div>
 </div>
  <div class="note" id="39599">  
  <a class="name">
  <strong class="user"><em>mightye (at) mightye (dot) org</em></strong></a><div class="date" title="2004-02-03 04:19"><strong>10 years ago</strong></div>
  <div class="text" id="Hcom39599">
<div class="phpcode"><code><span class="html">
Normally you do NOT want to use mysql_pconnect.&nbsp; This function is designed for environments which have a high overhead to connecting to the database.&nbsp; In a typical MySQL / Apache / PHP environment, Apache will create many child processes which lie in idle waiting for a web request to be assigned to them.&nbsp; Each of these child processes will open and hold its own MySQL connection.&nbsp; So if you have a MySQL server which has a limit of 50 connections, but Apache keeps more than 50 child processes running, each of these child processes can hold a connection to your MySQL server, even while they are idle (idle httpd child processes don't lend their MySQL connection to other httpd children, they hold their own).&nbsp; So even if you only have a few pages which actually connect to MySQL on a busy site, you can run out of connections, with all of them not actually being used.&nbsp; <br><br>In general use mysql_connect() for connecting to MySQL unless that connection takes a long time to establish.</span>
</code></div>
  </div>
 </div>
  <div class="note" id="39068">  
  <a class="name">
  <strong class="user"><em>aaryal at foresightint dot com</em></strong></a><div class="date" title="2004-01-15 03:25"><strong>10 years ago</strong></div>
  <div class="text" id="Hcom39068">
<div class="phpcode"><code><span class="html">
don't use pconnect in a situation with MySQL running on one host but on multiple ports (a multiple database configuration). the connection pooling algo in php apparently only keys off of the host, username and password but not the port. therefore, if you use the same host, username and password but a different port, you might get a connection that is connected to a different port than the one you asked for.</span>
</code></div>
  </div>
 </div>
  <div class="note" id="37133">  
  <a class="name">
  <strong class="user"><em>spam at vrana dot cz</em></strong></a><div class="date" title="2003-11-04 10:53"><strong>10 years ago</strong></div>
  <div class="text" id="Hcom37133">
<div class="phpcode"><code><span class="html">
Be warned if you use different parameters for mysql_pconnect() in different scripts on server: PHP can create single persistent connection for every set of parameters in each process up to mysql.max_persistent (PHP directive) per process. So even if you have MaxClients Apache directive set lesser then max_connections MySQL directive, you can easily get Too many connections MySQL error.<br><br>If mysql.max_persistent is set to other value than -1 (unlimited, default value), connections over this limit are silently denied, so use it with care.<br><br>Solution: For servers with potentially unlimited set of connection parameters, forbid persistent connection with mysql.allow_persistent=Off.</span>
</code></div>
  </div>
 </div>
  <div class="note" id="34742">  
  <a class="name">
  <strong class="user"><em>script_this at yahoo dot com</em></strong></a><div class="date" title="2003-08-05 11:41"><strong>11 years ago</strong></div>
  <div class="text" id="Hcom34742">
<div class="phpcode"><code><span class="html">
in response to uthayakutty76 at yahoo dot com's&nbsp; <br>30-Jun-2003 12:31 post:<br><br>-----------------------------------------------------------<br>...The problem is that the connection to the MySQL <br>servers is interrupted very quickly or there is not <br>connection at all. We found out that when using the <br>domain of the server instead of "localhost" problems <br>occur.....<br>-----------------------------------------------------------<br><br>try setting the wait_timeout variable in my.cnf for <br>mysql very high so the connections aren't ever idle for <br>that amount of time.&nbsp; ridiculous really, but it works for <br>localhost or remote database server where as the <br>localhost solution only works if the database is local i <br>think.</span>
</code></div>
  </div>
 </div>
  <div class="note" id="34217">  
  <a class="name">
  <strong class="user"><em>pulstar at mail dot com</em></strong></a><div class="date" title="2003-07-18 11:13"><strong>11 years ago</strong></div>
  <div class="text" id="Hcom34217">
<div class="phpcode"><code><span class="html">
I had some problems when connecting to a remote server with mysql_pconnect and using the flag MYSQL_CLIENT_COMPRESS. Sometimes it connect, but many times it give me the error:<br>Warning: mysql_pconnect(): Unknown database 'XXXXX'<br><br>If you have the same problem, try using mysql_connect instead. It worked fine for me. The script will take a long to reconnect each time the page is reloaded, but it will transfer data with compression. This is a little more secure than to send plain data over the Internet and also more faster when transmiting large amount of data.</span>
</code></div>
  </div>
 </div>
  <div class="note" id="33994">  
  <a class="name">
  <strong class="user"><em>rochlin at centralpets dot com</em></strong></a><div class="date" title="2003-07-12 08:27"><strong>11 years ago</strong></div>
  <div class="text" id="Hcom33994">
<div class="phpcode"><code><span class="html">
Do not use transactions (e.g. with InnoDB MySQL tables) with persistent connections.&nbsp; If your script stops or exits for any reason, your transaction will be left open and your locks will be left on.&nbsp; You have to reset MySQL to release them (so far as I can figure).&nbsp;&nbsp; They won't ROLLBACK automatically on error, like they ought to.&nbsp;&nbsp; When you restart the script, you'll get a new connection, so you can't rollback or commit for the previous script.&nbsp;&nbsp; Any script with a start transaction, rollback, or commit SQL statement should use regular (not persistent) connections.&nbsp;&nbsp; Seems like PHP ought to automatically issue a ROLLBACK on any open transactions when a script exits (error or otherwise) without a COMMIT.&nbsp; ZEND's site has a brief blurb on this.&nbsp; It's OK to mix/match so you use a persistent connection for the read stuff, but open a new regular connection conditionally (if you have to update, which is usually less often).</span>
</code></div>
  </div>
 </div>
  <div class="note" id="31072">  
  <a class="name">
  <strong class="user"><em>rudenko at id.com.ua</em></strong></a><div class="date" title="2003-04-08 07:15"><strong>11 years ago</strong></div>
  <div class="text" id="Hcom31072">
<div class="phpcode"><code><span class="html">
You can solve problem with persistent connections setting directive mysql.allow_persistent = Off in php configuration file. The users whitch will try to create persistant connetion /mysql_pconnect()/ will be connected to db <br>with nonpersistant connection /mysql_connect()/<br><br>For more info see user notes at section Persistant Connections. <a rel="nofollow" target="_blank">http://www.php.net/manual/en/features.persistent-connections.php</a><br>--<br><a rel="nofollow" target="_blank">http://www.id.com.ua</a> Ilya Rudenko</span>
</code></div>
  </div>
 </div>
  <div class="note" id="30244">  
  <a class="name">
  <strong class="user"><em>amn -at- frognet.net</em></strong></a><div class="date" title="2003-03-11 10:45"><strong>11 years ago</strong></div>
  <div class="text" id="Hcom30244">
<div class="phpcode"><code><span class="html">
Be careful using mysql_pconnect. If you are hosting on an ISP, they may frown upon you using multiple persistant mysql connections as this consumes resources for a longer period of time. If your script crashes, your connection can stay open for long periods of time. If there is a loop involved, you could accidently eat up all the available connections. That might be considered abuse by an ISP and you could get in trouble. Try using mysql_connect first instead. 90% of the time, a non-persistant mysql_connect call will do the trick just fine.</span>
</code></div>
  </div>
 </div>
  <div class="note" id="20960">  
  <a class="name">
  <strong class="user"><em>david at acz dot org</em></strong></a><div class="date" title="2002-04-23 11:41"><strong>12 years ago</strong></div>
  <div class="text" id="Hcom20960">
<div class="phpcode"><code><span class="html">
You need to be VERY careful when using LOCK TABLES with persistent connections.&nbsp; If the script terminates before the UNLOCK TABLES is executed, the the table(s) will stay locked, and very likely hang future scripts.&nbsp; This is noted in a bug report, but is still not reflected in the documentation: <a rel="nofollow" target="_blank">http://bugs.php.net/bug.php?id=7634</a></span>
</code></div>
  </div>
 </div>
  <div class="note" id="19407">  
  <a class="name">
  <strong class="user"><em>bartek at bulzak dot com</em></strong></a><div class="date" title="2002-02-26 02:37"><strong>12 years ago</strong></div>
  <div class="text" id="Hcom19407">
<div class="phpcode"><code><span class="html">
PHP 4.1.1 running with Apache under Linux doesn't seem to be doing all necessary flushing when handling persistant mysql connections. Try it out for yourself. Create a temporary table in a pconnect session, add rows (non unique), select/display and drop the table. Now reload your script multiple times, you will see that your results are not consistent, even though you are creating a new table everytime and dropping it.. <br><br>I had my share of problems with pconnect and suggest you don't use it unless absolutely necessary. In that case make sure you test your results for consistency, especially when your queries involve temporary tables or mysql session variables.<br><br>Bartek Bulzak</span>
</code></div>
  </div>
 </div>
  <div class="note" id="11798">  
  <a class="name">
  <strong class="user"><em>aramos at lander dot es</em></strong></a><div class="date" title="2001-03-07 10:15"><strong>13 years ago</strong></div>
  <div class="text" id="Hcom11798">
<div class="phpcode"><code><span class="html">
If your MySQL recive this error log: "Got an error reading communication packets" see this post: <a rel="nofollow" target="_blank">http://marc.theaimsgroup.com/?l=php-dev&amp;m=97858932431876&amp;w=2.</a> This patch work property in 4.0.4pl1 (when httpd.conf have MaxRequestsPerChild non-cero)</span>
</code></div>
  </div>
 </div>
  <div class="note" id="5401">  
  <a class="name">
  <strong class="user"><em>sasha at mysql dot com</em></strong></a><div class="date" title="2000-04-27 09:43"><strong>14 years ago</strong></div>
  <div class="text" id="Hcom5401">
<div class="phpcode"><code><span class="html">
If you need to close idle persistent connections, set a low wait_timeout in MySQL</span>
</code></div>
  </div>
 </div>
  <div class="note" id="104266">  
  <a class="name">
  <strong class="user"><em>shane</em></strong></a><div class="date" title="2011-06-04 12:35"><strong>3 years ago</strong></div>
  <div class="text" id="Hcom104266">
<div class="phpcode"><code><span class="html">
The new mysqlnd library, which replaces the old libmysql, should make disappearing connections a thing of the past. It refreshes the connection (either change_user or ping) before trying to use it. (It also uses less memory, and generally has better performance.) I've only tried it with mysqli, but the native extension also uses it. It's available for PHP &gt;= 5.3, MySQL &gt;= 4.1.</span>
</code></div>
  </div>
 </div>
  <div class="note" id="99380">  
  <a class="name">
  <strong class="user"><em>seawyvern at gmail dot com</em></strong></a><div class="date" title="2010-08-13 12:10"><strong>4 years ago</strong></div>
  <div class="text" id="Hcom99380">
<div class="phpcode"><code><span class="html">
(using PHP v5.3.2)<br>This might help other people who are running into a similar issue. I would occasionally get this error in my apache error log: <br><br>PHP Warning:&nbsp; mysql_pconnect(): MySQL server has gone away<br><br>It appears the persistent connection mysql_pconnect() was returning had timed out and mysql_pconnect() didn't detect it. To address this issue I added some code to check for this case using mysql_ping() and request another connection from mysql_pconnect() if this situation occurred. It appears that the combination of the checking for the time out with mysql_ping( ) and re-requesting the connection with mysql_pconnect( ) either caused the original connection to re-connect or forced mysql_pconnect() to recognize that the connection had timed out and request a new one. The documentation for mysql_ping( ) says that it will force a re-connect if it detects a timeout, however comments on the documentation page mention that this feature has been disabled for some time. Anyways here is the code I used, hope it helps:<br><br>$dbConnection = mysql_pconnect( $myHostname, $myUsername, $myPassword&nbsp; );<br><br>if ( !mysql_ping( $dbConnection ) )<br>{<br>&nbsp;&nbsp; $dbConnection = mysql_pconnect( $myHostname, $myUsername, $myPassword&nbsp; );<br>}</span>
</code></div>
  </div>
 </div>
  <div class="note" id="82813">  
  <a class="name">
  <strong class="user"><em>JM</em></strong></a><div class="date" title="2008-04-26 09:16"><strong>6 years ago</strong></div>
  <div class="text" id="Hcom82813">
<div class="phpcode"><code><span class="html">
If you get an error message which refers to a failure regarding /var/mysql/mysql.sock, try changing your php.ini so that mysql.default_socket=/tmp/mysql.sock</span>
</code></div>
  </div>
 </div>
  <div class="note" id="77154">  
  <a class="name">
  <strong class="user"><em>Sabyasachi Ruj</em></strong></a><div class="date" title="2007-08-17 01:00"><strong>7 years ago</strong></div>
  <div class="text" id="Hcom77154">
<div class="phpcode"><code><span class="html">
If you are using mysql_pconnect(), and say the MySQL server has five persistent connection pooled for that client.<br><br>Now mysql_pconnect can return any one of them.<br><br>So, If you are expecting that mysql_pconnect will return always use the same persistent connection, that is not the case.<br><br>So, say you are executing after connecting with mysql_pconnect:<br><br>set @aa=6;<br><br>And in another page you have again done mysql_pconnect, and executed:<br><br>select @aa;<br><br>That will not necessarily return '6' as the result!<br><br>Because the second mysql_pconnect can take another persistent connection from that server's connection pool.</span>
</code></div>
  </div>
 </div>
  <div class="note" id="68690">  
  <a class="name">
  <strong class="user"><em>Nils Meyer nils at weiss-bescheid dot de</em></strong></a><div class="date" title="2006-08-07 06:03"><strong>8 years ago</strong></div>
  <div class="text" id="Hcom68690">
<div class="phpcode"><code><span class="html">
Be careful when setting variables on a persistent mysql connection. Example:<br>// Set result charset to UTF8<br>mysql_query("SET SESSION character_set_results = 'UTF8'");<br><br>If another script reuses your persistent connection, it will also use the UTF-8 charset. This created a problem with typo3 and TemplaVoila, which reads serialized data from the database. The data is returned as UTF8, but the script expects latin1 and dies with a serialize error ("Template Object could not be unserialized successfully."). This problem is especially tricky because it works on some requests and crashes on others - because the variable is not set on all connections in the persistent connection pool.<br><br>A possible solution is to reset variables to their default value afterwards:<br>$ret = mysql_query("SHOW VARIABLES LIKE 'character_set_results'"); <br>list($foo, $old_charset) = mysql_fetch_assoc($ret);<br>mysql_query("SET SESSION character_set_results = 'UTF8'");<br>// do some fancy utf8 stuff<br>// ..<br><br>// revert to old encoding<br>mysql_query("SET SESSION character_set_results = '$old_charset'");<br><br>or simply use mysql_connect(), as previously stated it makes more sense in most enviroments and there are less things to bother with&nbsp;&nbsp; (like variables, transactions, temporary tables).</span>
</code></div>
  </div>
 </div>
  <div class="note" id="66385">  
  <a class="name">
  <strong class="user"><em>3ch0</em></strong></a><div class="date" title="2006-05-20 02:01"><strong>8 years ago</strong></div>
  <div class="text" id="Hcom66385">
<div class="phpcode"><code><span class="html">
pconnect is preferred when you are using a remote database server on a major web site. mysql in particular stays happier with 1 open connection as opposed to 1000 connections a minute =)</span>
</code></div>
  </div>
 </div>
  <div class="note" id="48562">  
  <a class="name">
  <strong class="user"><em>tomek at 3kropki dot pl</em></strong></a><div class="date" title="2004-12-29 09:36"><strong>9 years ago</strong></div>
  <div class="text" id="Hcom48562">
<div class="phpcode"><code><span class="html">
Instead of use wait_timeout, you can set interactive_timeout to short period of time (for ex. 20 sec.) this is a lot better solution in apache + mysql environment than wait_timeout.<br><br>To know more about interactive_timeout - look to mysql documentation.</span>
</code></div>
  </div>
 </div>
  <div class="note" id="47554">  
  <a class="name">
  <strong class="user"><em>federico dot chiesa at tiscali dot it</em></strong></a><div class="date" title="2004-11-19 05:08"><strong>9 years ago</strong></div>
  <div class="text" id="Hcom47554">
<div class="phpcode"><code><span class="html">
Be very careful when using persistent connections and temporary tables on MySQL: in MySQL, temporary tables are visible only to the currenct connection, but if you have a persistent connection the temporary tables will supposedly be visible to everybody sharing the same persistent connection. This can lead to major trouble. I suggest to use totally random temporary table names when using persistent connections to avoid major problems.</span>
</code></div>
  </div>
 </div>
  <div class="note" id="43869">  
  <a class="name">
  <strong class="user"><em>dfischer at qualcomm dot com</em></strong></a><div class="date" title="2004-07-06 05:57"><strong>10 years ago</strong></div>
  <div class="text" id="Hcom43869">
<div class="phpcode"><code><span class="html">
You also may consider using pconnect if you have transactions that span multiple pages. For example, in applications that I develop, I start a transaction on the moment I query selecting the data that the user plans on editing. I then commit the transactions after the user hits the submit button and the data is committed.<br><br>I cannot simply use mysql_connect as then the connection would be terminated at the end of the page and if I did not commit my transaction, it is automatically rolled back.</span>
</code></div>
  </div>
 </div>
  <div class="note" id="93760">  
  <a class="name">
  <strong class="user"><em>David</em></strong></a><div class="date" title="2009-09-26 01:45"><strong>4 years ago</strong></div>
  <div class="text" id="Hcom93760">
<div class="phpcode"><code><span class="html">
Right after I upgraded to PHP 5.3 I started getting "MySQL server has gone away" errors on almost every other page request from the apache server. I tried a few ideas that didn't work. Here is the solution: I changed all my mysql_pconnect() statements to mysql_connect(). It fixed the problem. For some reason PHP 5.3 does not like persistent connections.</span>
</code></div>
  </div>
 </div>
  <div class="note" id="46913">  
  <a class="name">
  <strong class="user"><em>markunderscoreconnollyatacmdotorg</em></strong></a><div class="date" title="2004-10-27 10:59"><strong>9 years ago</strong></div>
  <div class="text" id="Hcom46913">
<div class="phpcode"><code><span class="html">
I would like to comment on the post from dfischer at qualcomm dot com that proposes spanning transactions over multiple application invocations, in case someone is bold enough to try it.<br><br>I'll assume the table types being used are one of those that support transactions, such as InnoDB or BerkeleyDB.<br><br>First, there is a question of whether this would work at all.&nbsp; To work at all, the transaction context would have to be preserved across all the invocations of the php code through the web server.&nbsp; Reading the description of <a rel="nofollow" target="_blank">http://www.php.net/manual/en/features.persistent-connections.php</a> maintaining transaction context would be at best a coincidence.&nbsp; It would be interesting to find out that this does work on occasion and to understand the ramifications of such behavior.&nbsp; If I happened to get your connection and my action was a cancel, your updates might be gone. <br><br>Second, if such a thing did work (occassionally or always), there would be performance implications as the underlying database managed transactions that were pretty much open-ended.&nbsp; A few long-running transactions would likely eat up many resources in a short time and the likelihood of concurrency conflicts could rise.&nbsp; If the mysql_pconnect behavior is to keep transaction open at the end of php processing, then it would probably be better to not define transactions when using mysql_pconnect. And, transactions that were never closed by code (user went out to lunch and got hit by a bus) could hold resources for quite some time (maybe until after rehab).<br><br>So, even if such a scheme COULD work, it is not a good idea.&nbsp; The transaction should be committed or rolled back at the end of the user request processing.&nbsp; This allows the DBMS to properly manage resource ultilization and keeps bad things from happening to good data.&nbsp; If mysql_pconnect does not coordinate well with the transaction component of the database engine to always end a transaction at the end of processing a request, then mysql_pconnect should never be used where begin transaction is used.</span>
</code></div>
  </div>
 </div></div>

 
</section>    </section><!-- layout-content -->
        


  </div><!-- layout -->
         
  

    
 <!-- External and third party libraries. -->
 







<a id="toTop" href="javascript:;"><span id="toTopHover"></span><img width="40" height="40" alt="To Top" src="../../images/to-top%402x.png"></a>



<!-- Mirrored from php.net/manual/en/function.mysql-pconnect.php by HTTrack Website Copier/3.x [XR&CO'2013], Thu, 28 Aug 2014 15:29:54 GMT -->


</body></html>