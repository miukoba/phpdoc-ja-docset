<html><!-- Mirrored from php.net/manual/en/function.fsockopen.php by HTTrack Website Copier/3.x [XR&CO'2013], Thu, 28 Aug 2014 15:54:52 GMT --><!-- Added by HTTrack --><head><meta http-equiv="content-type" content="text/html;charset=utf-8"><!-- /Added by HTTrack -->


  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0"> 

  <title>fsockopen</title>

 <link rel="shortcut icon" href="../../favicon.ico">
 <link rel="search" type="application/opensearchdescription+xml" href="http://php.net/phpnetimprovedsearch.src" title="Add PHP.net search">
 <link rel="alternate" type="application/atom+xml" href="http://php.net/releases/feed.php" title="PHP Release feed">
 <link rel="alternate" type="application/atom+xml" href="http://php.net/feed.atom" title="PHP: Hypertext Preprocessor">

 <link rel="canonical" href="function.fsockopen.html">
 <link rel="shorturl" href="http://php.net/fsockopen">
 <link rel="alternate" href="http://php.net/fsockopen" hreflang="x-default">

 <link rel="contents" href="index-2.html">
 <link rel="index" href="ref.network.html">
 <link rel="prev" href="function.dns-get-record.html">
 <link rel="next" href="function.gethostbyaddr.html">

 <link rel="alternate" href="function.fsockopen.html" hreflang="en">
 <link rel="alternate" href="http://php.net/manual/pt_BR/function.fsockopen.php" hreflang="pt_BR">
 <link rel="alternate" href="http://php.net/manual/zh/function.fsockopen.php" hreflang="zh">
 <link rel="alternate" href="http://php.net/manual/fr/function.fsockopen.php" hreflang="fr">
 <link rel="alternate" href="http://php.net/manual/de/function.fsockopen.php" hreflang="de">
 <link rel="alternate" href="http://php.net/manual/it/function.fsockopen.php" hreflang="it">
 <link rel="alternate" href="http://php.net/manual/ja/function.fsockopen.php" hreflang="ja">
 <link rel="alternate" href="http://php.net/manual/ro/function.fsockopen.php" hreflang="ro">
 <link rel="alternate" href="http://php.net/manual/ru/function.fsockopen.php" hreflang="ru">
 <link rel="alternate" href="http://php.net/manual/es/function.fsockopen.php" hreflang="es">
 <link rel="alternate" href="http://php.net/manual/tr/function.fsockopen.php" hreflang="tr">

<link rel="stylesheet" type="text/css" href="../../cached8fe1.css?t=1401250819&amp;f=/fonts/Fira/fira.css" media="screen">
<link rel="stylesheet" type="text/css" href="../../cached4b8d.css?t=1404368420&amp;f=/fonts/Font-Awesome/css/fontello.css" media="screen">
<link rel="stylesheet" type="text/css" href="../../cached5065.css?t=1403329232&amp;f=/styles/theme-base.css" media="screen">
<link rel="stylesheet" type="text/css" href="../../cachedc78d.css?t=1401249623&amp;f=/styles/theme-medium.css" media="screen">

 <!--[if lte IE 7]>
 <link rel="stylesheet" type="text/css" href="http://php.net/styles/workarounds.ie7.css" media="screen">
 <![endif]-->

 <!--[if lte IE 8]>
 <script type="text/javascript">
  window.brokenIE = true;
 </script>
 <![endif]-->

 <!--[if lte IE 9]>
 <link rel="stylesheet" type="text/css" href="http://php.net/styles/workarounds.ie9.css" media="screen">
 <![endif]-->

 <!--[if IE]>
 <script type="text/javascript" src="http://php.net/js/ext/html5.js"></script>
 <![endif]-->

 <base>

</head>
<body class="docs " style="">


<div class="headsup"><a href="http://php.net/index.php#id2014-08-28-1">PHP 5.6.0 released</a></div>
<nav id="trick"><div><dl>
<dt><a href="getting-started.html">Getting Started</a></dt>
	<dd><a href="introduction.html">Introduction</a></dd>
	<dd><a href="tutorial.html">A simple tutorial</a></dd>
<dt><a href="langref.html">Language Reference</a></dt>
	<dd><a href="language.basic-syntax.html">Basic syntax</a></dd>
	<dd><a href="language.types.html">Types</a></dd>
	<dd><a href="language.variables.html">Variables</a></dd>
	<dd><a href="language.constants.html">Constants</a></dd>
	<dd><a href="language.expressions.html">Expressions</a></dd>
	<dd><a href="language.operators.html">Operators</a></dd>
	<dd><a href="language.control-structures.html">Control Structures</a></dd>
	<dd><a href="language.functions.html">Functions</a></dd>
	<dd><a href="language.oop5.html">Classes and Objects</a></dd>
	<dd><a href="language.namespaces.html">Namespaces</a></dd>
	<dd><a href="language.exceptions.html">Exceptions</a></dd>
	<dd><a href="language.generators.html">Generators</a></dd>
	<dd><a href="language.references.html">References Explained</a></dd>
	<dd><a href="reserved.variables.html">Predefined Variables</a></dd>
	<dd><a href="reserved.exceptions.html">Predefined Exceptions</a></dd>
	<dd><a href="reserved.interfaces.html">Predefined Interfaces and Classes</a></dd>
	<dd><a href="context.html">Context options and parameters</a></dd>
	<dd><a href="wrappers.html">Supported Protocols and Wrappers</a></dd>
</dl>
<dl>
<dt><a href="security.html">Security</a></dt>
	<dd><a href="security.intro.html">Introduction</a></dd>
	<dd><a href="security.general.html">General considerations</a></dd>
	<dd><a href="security.cgi-bin.html">Installed as CGI binary</a></dd>
	<dd><a href="security.apache.html">Installed as an Apache module</a></dd>
	<dd><a href="security.filesystem.html">Filesystem Security</a></dd>
	<dd><a href="security.database.html">Database Security</a></dd>
	<dd><a href="security.errors.html">Error Reporting</a></dd>
	<dd><a href="security.globals.html">Using Register Globals</a></dd>
	<dd><a href="security.variables.html">User Submitted Data</a></dd>
	<dd><a href="security.magicquotes.html">Magic Quotes</a></dd>
	<dd><a href="security.hiding.html">Hiding PHP</a></dd>
	<dd><a href="security.current.html">Keeping Current</a></dd>
<dt><a href="features.html">Features</a></dt>
	<dd><a href="features.http-auth.html">HTTP authentication with PHP</a></dd>
	<dd><a href="features.cookies.html">Cookies</a></dd>
	<dd><a href="features.sessions.html">Sessions</a></dd>
	<dd><a href="features.xforms.html">Dealing with XForms</a></dd>
	<dd><a href="features.file-upload.html">Handling file uploads</a></dd>
	<dd><a href="features.remote-files.html">Using remote files</a></dd>
	<dd><a href="features.connection-handling.html">Connection handling</a></dd>
	<dd><a href="features.persistent-connections.html">Persistent Database Connections</a></dd>
	<dd><a href="features.safe-mode.html">Safe Mode</a></dd>
	<dd><a href="features.commandline.html">Command line usage</a></dd>
	<dd><a href="features.gc.html">Garbage Collection</a></dd>
	<dd><a href="features.dtrace.html">DTrace Dynamic Tracing</a></dd>
</dl>
<dl>
<dt><a href="funcref.html">Function Reference</a></dt>
	<dd><a href="refs.basic.php.html">Affecting PHP's Behaviour</a></dd>
	<dd><a href="refs.utilspec.audio.html">Audio Formats Manipulation</a></dd>
	<dd><a href="refs.remote.auth.html">Authentication Services</a></dd>
	<dd><a href="refs.utilspec.cmdline.html">Command Line Specific Extensions</a></dd>
	<dd><a href="refs.compression.html">Compression and Archive Extensions</a></dd>
	<dd><a href="refs.creditcard.html">Credit Card Processing</a></dd>
	<dd><a href="refs.crypto.html">Cryptography Extensions</a></dd>
	<dd><a href="refs.database.html">Database Extensions</a></dd>
	<dd><a href="refs.calendar.html">Date and Time Related Extensions</a></dd>
	<dd><a href="refs.fileprocess.file.html">File System Related Extensions</a></dd>
	<dd><a href="refs.international.html">Human Language and Character Encoding Support</a></dd>
	<dd><a href="refs.utilspec.image.html">Image Processing and Generation</a></dd>
	<dd><a href="refs.remote.mail.html">Mail Related Extensions</a></dd>
	<dd><a href="refs.math.html">Mathematical Extensions</a></dd>
	<dd><a href="refs.utilspec.nontext.html">Non-Text MIME Output</a></dd>
	<dd><a href="refs.fileprocess.process.html">Process Control Extensions</a></dd>
	<dd><a href="refs.basic.other.html">Other Basic Extensions</a></dd>
	<dd><a href="refs.remote.other.html">Other Services</a></dd>
	<dd><a href="refs.search.html">Search Engine Extensions</a></dd>
	<dd><a href="refs.utilspec.server.html">Server Specific Extensions</a></dd>
	<dd><a href="refs.basic.session.html">Session Extensions</a></dd>
	<dd><a href="refs.basic.text.html">Text Processing</a></dd>
	<dd><a href="refs.basic.vartype.html">Variable and Type Related Extensions</a></dd>
	<dd><a href="refs.webservice.html">Web Services</a></dd>
	<dd><a href="refs.utilspec.windows.html">Windows Only Extensions</a></dd>
	<dd><a href="refs.xml.html">XML Manipulation</a></dd>
</dl>
<dl>
<dt>Keyboard Shortcuts</dt><dt>?</dt>
<dd>This help</dd>
<dt>j</dt>
<dd>Next menu item</dd>
<dt>k</dt>
<dd>Previous menu item</dd>
<dt>g p</dt>
<dd>Previous man page</dd>
<dt>g n</dt>
<dd>Next man page</dd>
<dt>G</dt>
<dd>Scroll to bottom</dd>
<dt>g g</dt>
<dd>Scroll to top</dd>
<dt>g h</dt>
<dd>Goto homepage</dd>
<dt>g s</dt>
<dd>Goto search<br>(current page)</dd>
<dt>/</dt>
<dd>Focus search box</dd>
</dl></div></nav>
<div id="goto">
    <div class="search">
         <div class="text"></div>
         <div class="results"><ul></ul></div>
   </div>
</div>

  <div id="breadcrumbs" class="row-fluid">
          
              
        <ul class="breadcrumbs-container">
            <li><a href="index-2.html">PHP Manual</a></li>      <li><a href="funcref.html">Function Reference</a></li>      <li><a href="refs.remote.other.html">Other Services</a></li>      <li><a href="book.network.html">Network</a></li>      <li><a href="ref.network.html">Network Functions</a></li>    </ul>
  </div>




<div id="layout">
  <section id="layout-content">
  <div id="function.fsockopen" class="refentry">
 <div class="refnamediv">
  <h1 class="refname">fsockopen</h1>
  <p class="verinfo">(PHP 4, PHP 5)</p><p class="refpurpose"><span class="refname">fsockopen</span> — <span class="dc-title">Open Internet or Unix domain socket connection</span></p>

 </div>
 
 <div class="refsect1 description" id="refsect1-function.fsockopen-description">
  <h3 class="title">Description</h3>
  <div class="methodsynopsis dc-description">
   <span class="type">resource</span> <span class="methodname"><strong>fsockopen</strong></span>
    ( <span class="methodparam"><span class="type">string</span> <code class="parameter">$hostname</code></span>
   [, <span class="methodparam"><span class="type">int</span> <code class="parameter">$port</code><span class="initializer"> = -1</span></span>
   [, <span class="methodparam"><span class="type">int</span> <code class="parameter reference">&amp;$errno</code></span>
   [, <span class="methodparam"><span class="type">string</span> <code class="parameter reference">&amp;$errstr</code></span>
   [, <span class="methodparam"><span class="type">float</span> <code class="parameter">$timeout</code><span class="initializer"> = ini_get("default_socket_timeout")</span></span>
  ]]]] )</div>

  <p class="para rdfs-comment">
   Initiates a socket connection to the resource specified by
   <code class="parameter">hostname</code>.
  </p>
  <p class="para">
   PHP supports targets in the Internet and Unix domains as described in
   <a href="transports.html" class="xref">List of Supported Socket Transports</a>.  A list of supported transports can also be
   retrieved using <span class="function"><a href="function.stream-get-transports.html" class="function">stream_get_transports()</a></span>.
  </p>
  <p class="para">
   The socket will by default be opened in blocking mode.  You can
   switch it to non-blocking mode by using
   <span class="function"><a href="function.stream-set-blocking.html" class="function">stream_set_blocking()</a></span>.
  </p>
  <p class="para">
   The function <span class="function"><a href="function.stream-socket-client.html" class="function">stream_socket_client()</a></span> is similar but
   provides a richer set of options, including non-blocking connection and the
   ability to provide a stream context.
  </p>
 </div>

 <div class="refsect1 parameters" id="refsect1-function.fsockopen-parameters">
  <h3 class="title">Parameters</h3>
  <p class="para">
   </p><dl>

    
     <dt>
<code class="parameter">hostname</code></dt>

     <dd>

      <p class="para">
       If OpenSSL support <a href="openssl.installation.html" class="link">is
       installed</a>, you may prefix the <code class="parameter">hostname</code>
       with either <em>ssl://</em> or <em>tls://</em> to
       use an SSL or TLS client connection over TCP/IP to connect to the
       remote host.
      </p>
     </dd>

    
    
     <dt>
<code class="parameter">port</code></dt>

     <dd>

      <p class="para">
       The port number. This can be omitted and skipped with
       <em>-1</em> for transports that do not use ports, such as
       <em>unix://</em>.
      </p>
     </dd>

    
    
     <dt>
<code class="parameter">errno</code></dt>

     <dd>

      <p class="para">
       If provided, holds the system level error number that occurred in the
       system-level <em>connect()</em> call.
      </p>
      <p class="para">
       If the value returned in <code class="parameter">errno</code> is
       <em>0</em> and the function returned <strong><code>FALSE</code></strong>, it is an
       indication that the error occurred before the 
       <em>connect()</em> call. This is most likely due to a
       problem initializing the socket.
      </p>
     </dd>

    
    
     <dt>
<code class="parameter">errstr</code></dt>

     <dd>

      <p class="para">
       The error message as a string.
      </p>
     </dd>

    
    
     <dt>
<code class="parameter">timeout</code></dt>

     <dd>

      <p class="para">
       The connection timeout, in seconds.
      </p>
      <blockquote class="note"><p><strong class="note">Note</strong>: 
       </p><p class="para">
        If you need to set a timeout for reading/writing data over the
        socket, use <span class="function"><a href="function.stream-set-timeout.html" class="function">stream_set_timeout()</a></span>, as the 
        <code class="parameter">timeout</code> parameter to
        <span class="function"><strong>fsockopen()</strong></span> only applies while connecting the
        socket.
       </p>
      <p></p></blockquote>
     </dd>

    
   </dl>

  <p></p>
 </div>

 <div class="refsect1 returnvalues" id="refsect1-function.fsockopen-returnvalues">
  <h3 class="title">Return Values</h3>
  <p class="para">
   <span class="function"><strong>fsockopen()</strong></span> returns a file pointer which may be used
   together with the other file functions (such as
   <span class="function"><a href="function.fgets.html" class="function">fgets()</a></span>, <span class="function"><a href="function.fgetss.html" class="function">fgetss()</a></span>,
   <span class="function"><a href="function.fwrite.html" class="function">fwrite()</a></span>, <span class="function"><a href="function.fclose.html" class="function">fclose()</a></span>, and
   <span class="function"><a href="function.feof.html" class="function">feof()</a></span>). If the call fails, it will return <strong><code>FALSE</code></strong>
  </p>
 </div>

 <div class="refsect1 errors" id="refsect1-function.fsockopen-errors">
  <h3 class="title">Errors/Exceptions</h3>
  <p class="para">
   Throws <strong><code>E_WARNING</code></strong> if <code class="parameter">hostname</code> is
   not a valid domain.
  </p>
 </div>

 <div class="refsect1 examples" id="refsect1-function.fsockopen-examples">
  <h3 class="title">Examples</h3>
  <p class="para">
   </p><div class="example" id="example-4586">
    <p><strong>Example #1 <span class="function"><strong>fsockopen()</strong></span> Example</strong></p>
    <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br>$fp&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">fsockopen</span><span style="color: #007700">(</span><span style="color: #DD0000">"www.example.com"</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">80</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$errno</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$errstr</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">30</span><span style="color: #007700">);<br>if&nbsp;(!</span><span style="color: #0000BB">$fp</span><span style="color: #007700">)&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;echo&nbsp;</span><span style="color: #DD0000">"</span><span style="color: #0000BB">$errstr</span><span style="color: #DD0000">&nbsp;(</span><span style="color: #0000BB">$errno</span><span style="color: #DD0000">)&lt;br&nbsp;/&gt;\n"</span><span style="color: #007700">;<br>}&nbsp;else&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$out&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #DD0000">"GET&nbsp;/&nbsp;HTTP/1.1\r\n"</span><span style="color: #007700">;<br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$out&nbsp;</span><span style="color: #007700">.=&nbsp;</span><span style="color: #DD0000">"Host:&nbsp;www.example.com\r\n"</span><span style="color: #007700">;<br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$out&nbsp;</span><span style="color: #007700">.=&nbsp;</span><span style="color: #DD0000">"Connection:&nbsp;Close\r\n\r\n"</span><span style="color: #007700">;<br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">fwrite</span><span style="color: #007700">(</span><span style="color: #0000BB">$fp</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$out</span><span style="color: #007700">);<br>&nbsp;&nbsp;&nbsp;&nbsp;while&nbsp;(!</span><span style="color: #0000BB">feof</span><span style="color: #007700">(</span><span style="color: #0000BB">$fp</span><span style="color: #007700">))&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;echo&nbsp;</span><span style="color: #0000BB">fgets</span><span style="color: #007700">(</span><span style="color: #0000BB">$fp</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">128</span><span style="color: #007700">);<br>&nbsp;&nbsp;&nbsp;&nbsp;}<br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">fclose</span><span style="color: #007700">(</span><span style="color: #0000BB">$fp</span><span style="color: #007700">);<br>}<br></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
    </div>

   </div>
  <p></p>
  <p class="para">
   </p><div class="example" id="example-4587">
    <p><strong>Example #2 Using UDP connection</strong></p>
    <div class="example-contents"><p>
     The example below shows how to retrieve the day and time from the UDP
     service "daytime" (port 13) in your own machine.
    </p></div>
    <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br>$fp&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">fsockopen</span><span style="color: #007700">(</span><span style="color: #DD0000">"udp://127.0.0.1"</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">13</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$errno</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$errstr</span><span style="color: #007700">);<br>if&nbsp;(!</span><span style="color: #0000BB">$fp</span><span style="color: #007700">)&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;echo&nbsp;</span><span style="color: #DD0000">"ERROR:&nbsp;</span><span style="color: #0000BB">$errno</span><span style="color: #DD0000">&nbsp;-&nbsp;</span><span style="color: #0000BB">$errstr</span><span style="color: #DD0000">&lt;br&nbsp;/&gt;\n"</span><span style="color: #007700">;<br>}&nbsp;else&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">fwrite</span><span style="color: #007700">(</span><span style="color: #0000BB">$fp</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">"\n"</span><span style="color: #007700">);<br>&nbsp;&nbsp;&nbsp;&nbsp;echo&nbsp;</span><span style="color: #0000BB">fread</span><span style="color: #007700">(</span><span style="color: #0000BB">$fp</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">26</span><span style="color: #007700">);<br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">fclose</span><span style="color: #007700">(</span><span style="color: #0000BB">$fp</span><span style="color: #007700">);<br>}<br></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
    </div>

   </div>
  <p></p>
 </div>

 <div class="refsect1 notes" id="refsect1-function.fsockopen-notes">
  <h3 class="title">Notes</h3>
  <blockquote class="note"><p><strong class="note">Note</strong>: 
   </p><p class="para">
    Depending on the environment, the Unix domain or the optional
    connect timeout may not be available.
   </p>
  <p></p></blockquote>
  <div class="warning"><strong class="warning">Warning</strong>
   <p class="para">
    UDP sockets will sometimes appear to have opened without an error,
    even if the remote host is unreachable.  The error will only
    become apparent when you read or write data to/from the socket.
    The reason for this is because UDP is a "connectionless" protocol,
    which means that the operating system does not try to establish
    a link for the socket until it actually needs to send or receive data.
   </p>
  </div>
  <blockquote class="note"><p><strong class="note">Note</strong>: <span class="simpara">When specifying a numerical IPv6 address
(e.g. <em>fe80::1</em>), you must enclose the IP in square
brackets—for example, <em>tcp://[fe80::1]:80</em>.</span></p></blockquote>
 </div>

 <div class="refsect1 seealso" id="refsect1-function.fsockopen-seealso">
  <h3 class="title">See Also</h3>
  <p class="para">
   </p><ul class="simplelist">
    <li class="member"><span class="function"><a href="function.pfsockopen.html" class="function" rel="rdfs-seeAlso">pfsockopen()</a> - Open persistent Internet or Unix domain socket connection</span></li>
    <li class="member"><span class="function"><a href="function.stream-socket-client.html" class="function" rel="rdfs-seeAlso">stream_socket_client()</a> - Open Internet or Unix domain socket connection</span></li>
    <li class="member"><span class="function"><a href="function.stream-set-blocking.html" class="function" rel="rdfs-seeAlso">stream_set_blocking()</a> - Set blocking/non-blocking mode on a stream</span></li>
    <li class="member"><span class="function"><a href="function.stream-set-timeout.html" class="function" rel="rdfs-seeAlso">stream_set_timeout()</a> - Set timeout period on a stream</span></li>
    <li class="member"><span class="function"><a href="function.fgets.html" class="function" rel="rdfs-seeAlso">fgets()</a> - Gets line from file pointer</span></li>
    <li class="member"><span class="function"><a href="function.fgetss.html" class="function" rel="rdfs-seeAlso">fgetss()</a> - Gets line from file pointer and strip HTML tags</span></li>
    <li class="member"><span class="function"><a href="function.fwrite.html" class="function" rel="rdfs-seeAlso">fwrite()</a> - Binary-safe file write</span></li>
    <li class="member"><span class="function"><a href="function.fclose.html" class="function" rel="rdfs-seeAlso">fclose()</a> - Closes an open file pointer</span></li>
    <li class="member"><span class="function"><a href="function.feof.html" class="function" rel="rdfs-seeAlso">feof()</a> - Tests for end-of-file on a file pointer</span></li>
    <li class="member"><span class="function"><a href="function.socket-connect.html" class="function" rel="rdfs-seeAlso">socket_connect()</a> - Initiates a connection on a socket</span></li>
    <li class="member">The <a href="ref.curl.html" class="link">Curl extension</a></li>
   </ul>
  <p></p>
 </div>

</div>
<section id="usernotes">
 <div class="head"><h3 class="title">User Contributed Notes</h3></div><div id="allnotes">
  <div class="note" id="56049">  
  <a class="name">
  <strong class="user"><em>robin at pozytron dot com</em></strong></a><div class="date" title="2005-08-21 03:38"><strong>9 years ago</strong></div>
  <div class="text" id="Hcom56049">
<div class="phpcode"><code><span class="html">
I have found, when using fsockopen() and the POST method, that using HTTP/1.1 is VERY significantly slower than HTTP/1.0 (at least for the server I'm querying, an Orion-based server). Also, using cURL tended to be faster than fsockopen(), though only slightly. For example, here was a recent set of data (for the same exact request in each case):
<br>
<br>cURL: 4.2sec
<br>fsockopen() HTTP/1.0: 4.9sec
<br>fsockopen() HTTP/1.1: 19.9sec (!)
<br>
<br>I'm not sure why this was occurring. Perhaps it has something to do with the Orion server, which I have little experience with. However, it was not a fluke, and I double-checked the code to make sure there were no errors.
<br>
<br>EDITORS NOTE: HTTP/1.1 uses persistent connection causing this delay. Use "Connection: close" header to disable it.</span>
</code></div>
  </div>
 </div>
  <div class="note" id="72674">  
  <a class="name">
  <strong class="user"><em>ryan1_00 at hotmail dot com</em></strong></a><div class="date" title="2007-01-29 07:52"><strong>7 years ago</strong></div>
  <div class="text" id="Hcom72674">
<div class="phpcode"><code><span class="html">
This script checks specific ports so you need to have the correct port open on the server for this to work.
<br>
<br>E.g if i have a windows domain controller and it is servering LDAP then the following would be used to check it is online:
<br><span class="default">&lt;?php
<br>chkServer</span><span class="keyword">(</span><span class="string">"MyDC"</span><span class="keyword">, </span><span class="string">"389"</span><span class="keyword">);
<br></span><span class="default">?&gt;
<br></span>
<br>for a webserver:
<br><span class="default">&lt;?php
<br>chkServer</span><span class="keyword">(</span><span class="string">"MyWebSvr"</span><span class="keyword">, </span><span class="string">"80"</span><span class="keyword">);
<br></span><span class="default">?&gt;
<br></span>
<br>etc etc
<br>--------------------------------------------------------
<br>
<br><span class="default">&lt;?php
<br></span><span class="comment">// check if a server is up by connecting to a port
<br></span><span class="keyword">function </span><span class="default">chkServer</span><span class="keyword">(</span><span class="default">$host</span><span class="keyword">, </span><span class="default">$port</span><span class="keyword">)
<br>{&nbsp;&nbsp; 
<br>&nbsp; &nbsp; </span><span class="default">$hostip </span><span class="keyword">= @</span><span class="default">gethostbyname</span><span class="keyword">(</span><span class="default">$host</span><span class="keyword">); </span><span class="comment">// resloves IP from Hostname returns hostname on failure
<br>&nbsp; &nbsp; 
<br>&nbsp; &nbsp; </span><span class="keyword">if (</span><span class="default">$hostip </span><span class="keyword">== </span><span class="default">$host</span><span class="keyword">) </span><span class="comment">// if the IP is not resloved
<br>&nbsp; &nbsp; </span><span class="keyword">{
<br>&nbsp; &nbsp; &nbsp; &nbsp; echo </span><span class="string">"Server is down or does not exist"</span><span class="keyword">;
<br>&nbsp; &nbsp; }
<br>&nbsp; &nbsp; else
<br>&nbsp; &nbsp; {
<br>&nbsp; &nbsp; &nbsp; &nbsp; if (!</span><span class="default">$x </span><span class="keyword">= @</span><span class="default">fsockopen</span><span class="keyword">(</span><span class="default">$hostip</span><span class="keyword">, </span><span class="default">$port</span><span class="keyword">, </span><span class="default">$errno</span><span class="keyword">, </span><span class="default">$errstr</span><span class="keyword">, </span><span class="default">5</span><span class="keyword">)) </span><span class="comment">// attempt to connect
<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="keyword">{
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; echo </span><span class="string">"Server is down"</span><span class="keyword">;
<br>&nbsp; &nbsp; &nbsp; &nbsp; }
<br>&nbsp; &nbsp; &nbsp; &nbsp; else 
<br>&nbsp; &nbsp; &nbsp; &nbsp; {
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; echo </span><span class="string">"Server is up"</span><span class="keyword">;
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if (</span><span class="default">$x</span><span class="keyword">)
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; @</span><span class="default">fclose</span><span class="keyword">(</span><span class="default">$x</span><span class="keyword">); </span><span class="comment">//close connection
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="keyword">}
<br>&nbsp; &nbsp; &nbsp; &nbsp; }&nbsp; 
<br>&nbsp; &nbsp; }
<br>}
<br></span><span class="default">?&gt;</span>
</span>
</code></div>
  </div>
 </div>
  <div class="note" id="95605">  
  <a class="name">
  <strong class="user"><em>nytro_rst at yahoo dot com</em></strong></a><div class="date" title="2010-01-12 02:26"><strong>4 years ago</strong></div>
  <div class="text" id="Hcom95605">
<div class="phpcode"><code><span class="html">
A simple proxy list checker. You can check a list ip:port if that port is opened on that IP.<br><br><span class="default">&lt;?php<br><br>$fisier </span><span class="keyword">= </span><span class="default">file_get_contents</span><span class="keyword">(</span><span class="string">'proxy_list.txt'</span><span class="keyword">); </span><span class="comment">// Read the file with the proxy list<br></span><span class="default">$linii </span><span class="keyword">= </span><span class="default">explode</span><span class="keyword">(</span><span class="string">"\n"</span><span class="keyword">, </span><span class="default">$fisier</span><span class="keyword">); </span><span class="comment">// Get each proxy<br></span><span class="default">$fisier </span><span class="keyword">= </span><span class="default">fopen</span><span class="keyword">(</span><span class="string">"bune.txt"</span><span class="keyword">, </span><span class="string">"a"</span><span class="keyword">); </span><span class="comment">// Here we will write the good ones<br><br></span><span class="keyword">for(</span><span class="default">$i </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">; </span><span class="default">$i </span><span class="keyword">&lt; </span><span class="default">count</span><span class="keyword">(</span><span class="default">$linii</span><span class="keyword">) - </span><span class="default">1</span><span class="keyword">; </span><span class="default">$i</span><span class="keyword">++) </span><span class="default">test</span><span class="keyword">(</span><span class="default">$linii</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">]); </span><span class="comment">// Test each proxy<br><br></span><span class="keyword">function </span><span class="default">test</span><span class="keyword">(</span><span class="default">$proxy</span><span class="keyword">)<br>{<br>&nbsp; global </span><span class="default">$fisier</span><span class="keyword">;<br>&nbsp; </span><span class="default">$splited </span><span class="keyword">= </span><span class="default">explode</span><span class="keyword">(</span><span class="string">':'</span><span class="keyword">,</span><span class="default">$proxy</span><span class="keyword">); </span><span class="comment">// Separate IP and port<br>&nbsp; </span><span class="keyword">if(</span><span class="default">$con </span><span class="keyword">= @</span><span class="default">fsockopen</span><span class="keyword">(</span><span class="default">$splited</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">], </span><span class="default">$splited</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">], </span><span class="default">$eroare</span><span class="keyword">, </span><span class="default">$eroare_str</span><span class="keyword">, </span><span class="default">3</span><span class="keyword">)) <br>&nbsp; {<br>&nbsp; &nbsp; </span><span class="default">fwrite</span><span class="keyword">(</span><span class="default">$fisier</span><span class="keyword">, </span><span class="default">$proxy </span><span class="keyword">. </span><span class="string">"\n"</span><span class="keyword">); </span><span class="comment">// Check if we can connect to that IP and port<br>&nbsp; &nbsp; </span><span class="keyword">print </span><span class="default">$proxy </span><span class="keyword">. </span><span class="string">'&lt;br&gt;'</span><span class="keyword">; </span><span class="comment">// Show the proxy<br>&nbsp; &nbsp; </span><span class="default">fclose</span><span class="keyword">(</span><span class="default">$con</span><span class="keyword">); </span><span class="comment">// Close the socket handle<br>&nbsp; </span><span class="keyword">}<br>}<br><br></span><span class="default">fclose</span><span class="keyword">(</span><span class="default">$fisier</span><span class="keyword">); </span><span class="comment">// Close the file<br><br></span><span class="default">?&gt;</span>
</span>
</code></div>
  </div>
 </div>
  <div class="note" id="75388">  
  <a class="name">
  <strong class="user"><em>Alexander Wegener</em></strong></a><div class="date" title="2007-05-26 07:29"><strong>7 years ago</strong></div>
  <div class="text" id="Hcom75388">
<div class="phpcode"><code><span class="html">
To check if a Url is Online (with http and https)<br>Using @fgets to hide Warning when using SSL<br>(Bug: "Warning: function.fgets SSL: fatal protocol error", <a rel="nofollow" target="_blank">http://bugs.php.net/bug.php?id=23220</a>)<br><br><span class="default">&lt;?php<br><br>&nbsp; &nbsp; </span><span class="keyword">function </span><span class="default">isOnline</span><span class="keyword">(</span><span class="default">$url</span><span class="keyword">) {<br>&nbsp; &nbsp; &nbsp; &nbsp; if (!</span><span class="default">$url_info </span><span class="keyword">= </span><span class="default">parse_url</span><span class="keyword">(</span><span class="default">$url</span><span class="keyword">)) {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; return </span><span class="default">false</span><span class="keyword">;&nbsp; &nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; }<br>&nbsp; &nbsp; &nbsp; &nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; switch (</span><span class="default">$url_info</span><span class="keyword">[</span><span class="string">'scheme'</span><span class="keyword">]) {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; case </span><span class="string">'https'</span><span class="keyword">:<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$scheme </span><span class="keyword">= </span><span class="string">'ssl://'</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$port </span><span class="keyword">= </span><span class="default">443</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; break;<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; case </span><span class="string">'http'</span><span class="keyword">:<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; default:<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$scheme </span><span class="keyword">= </span><span class="string">''</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$port </span><span class="keyword">= </span><span class="default">80</span><span class="keyword">;&nbsp; &nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; }<br>&nbsp; &nbsp; &nbsp; &nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$data </span><span class="keyword">= </span><span class="string">""</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$fid </span><span class="keyword">= @</span><span class="default">fsockopen</span><span class="keyword">(</span><span class="default">$scheme </span><span class="keyword">. </span><span class="default">$url_info</span><span class="keyword">[</span><span class="string">'host'</span><span class="keyword">], </span><span class="default">$port</span><span class="keyword">, </span><span class="default">$errno</span><span class="keyword">, </span><span class="default">$errstr</span><span class="keyword">, </span><span class="default">30</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; if (</span><span class="default">$fid</span><span class="keyword">) {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">fputs</span><span class="keyword">(</span><span class="default">$fid</span><span class="keyword">, </span><span class="string">'HEAD ' </span><span class="keyword">. (isset(</span><span class="default">$url_info</span><span class="keyword">[</span><span class="string">'path'</span><span class="keyword">])? </span><span class="default">$url_info</span><span class="keyword">[</span><span class="string">'path'</span><span class="keyword">]: </span><span class="string">'/'</span><span class="keyword">) . (isset(</span><span class="default">$url_info</span><span class="keyword">[</span><span class="string">'query'</span><span class="keyword">])? </span><span class="string">'?' </span><span class="keyword">. </span><span class="default">$url_info</span><span class="keyword">[</span><span class="string">'query'</span><span class="keyword">]: </span><span class="string">''</span><span class="keyword">) . </span><span class="string">" HTTP/1.0\r\n" </span><span class="keyword">. <br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="string">"Connection: close\r\n" </span><span class="keyword">. <br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="string">'Host: ' </span><span class="keyword">. </span><span class="default">$url_info</span><span class="keyword">[</span><span class="string">'host'</span><span class="keyword">] . </span><span class="string">"\r\n\r\n"</span><span class="keyword">);&nbsp; &nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; while (!</span><span class="default">feof</span><span class="keyword">(</span><span class="default">$fid</span><span class="keyword">)) {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$data </span><span class="keyword">.= @</span><span class="default">fgets</span><span class="keyword">(</span><span class="default">$fid</span><span class="keyword">, </span><span class="default">128</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">fclose</span><span class="keyword">(</span><span class="default">$fid</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; return !empty(</span><span class="default">$data</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; } else {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; return </span><span class="default">false</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; }<br>&nbsp; &nbsp; } <br><br></span><span class="default">?&gt;</span>
</span>
</code></div>
  </div>
 </div>
  <div class="note" id="33888">  
  <a class="name">
  <strong class="user"><em>brage (a t) jeffnappi (d.o.t) commie</em></strong></a><div class="date" title="2003-07-10 02:16"><strong>11 years ago</strong></div>
  <div class="text" id="Hcom33888">
<div class="phpcode"><code><span class="html">
thought you guys may appreciate this function, allows you to pass an array of urls to download and does so simultaneously using non-blocking sockets, then returns the data in an array.
<br>
<br><span class="default">&lt;?php
<br></span><span class="comment">// function connects to an array of URLS at the same time
<br>// and returns an array of results.
<br>
<br></span><span class="keyword">function </span><span class="default">multiHTTP </span><span class="keyword">(</span><span class="default">$urlArr</span><span class="keyword">) {
<br> </span><span class="default">$sockets </span><span class="keyword">= Array(); </span><span class="comment">// socket array!
<br> </span><span class="default">$urlInfo </span><span class="keyword">= Array(); </span><span class="comment">// info arr
<br> </span><span class="default">$retDone </span><span class="keyword">= Array();
<br> </span><span class="default">$retData </span><span class="keyword">= Array();
<br> </span><span class="default">$errno&nbsp;&nbsp; </span><span class="keyword">= Array();
<br> </span><span class="default">$errstr&nbsp; </span><span class="keyword">= Array();
<br> for (</span><span class="default">$x</span><span class="keyword">=</span><span class="default">0</span><span class="keyword">;</span><span class="default">$x</span><span class="keyword">&lt;</span><span class="default">count</span><span class="keyword">(</span><span class="default">$urlArr</span><span class="keyword">);</span><span class="default">$x</span><span class="keyword">++) {
<br>&nbsp; </span><span class="default">$urlInfo</span><span class="keyword">[</span><span class="default">$x</span><span class="keyword">] = </span><span class="default">parse_url</span><span class="keyword">(</span><span class="default">$urlArr</span><span class="keyword">[</span><span class="default">$x</span><span class="keyword">]);
<br>&nbsp; </span><span class="default">$urlInfo</span><span class="keyword">[</span><span class="default">$x</span><span class="keyword">][</span><span class="default">port</span><span class="keyword">] = (</span><span class="default">$urlInfo</span><span class="keyword">[</span><span class="default">$x</span><span class="keyword">][</span><span class="default">port</span><span class="keyword">]) ? </span><span class="default">$urlInfo</span><span class="keyword">[</span><span class="default">$x</span><span class="keyword">][</span><span class="default">port</span><span class="keyword">] : </span><span class="default">80</span><span class="keyword">;
<br>&nbsp; </span><span class="default">$urlInfo</span><span class="keyword">[</span><span class="default">$x</span><span class="keyword">][</span><span class="default">path</span><span class="keyword">] = (</span><span class="default">$urlInfo</span><span class="keyword">[</span><span class="default">$x</span><span class="keyword">][</span><span class="default">path</span><span class="keyword">]) ? </span><span class="default">$urlInfo</span><span class="keyword">[</span><span class="default">$x</span><span class="keyword">][</span><span class="default">path</span><span class="keyword">] : </span><span class="string">"/"</span><span class="keyword">;
<br>&nbsp; </span><span class="default">$sockets</span><span class="keyword">[</span><span class="default">$x</span><span class="keyword">] = </span><span class="default">fsockopen</span><span class="keyword">(</span><span class="default">$urlInfo</span><span class="keyword">[</span><span class="default">$x</span><span class="keyword">][</span><span class="default">host</span><span class="keyword">], </span><span class="default">$urlInfo</span><span class="keyword">[</span><span class="default">$x</span><span class="keyword">][</span><span class="default">port</span><span class="keyword">],
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$errno</span><span class="keyword">[</span><span class="default">$x</span><span class="keyword">], </span><span class="default">$errstr</span><span class="keyword">[</span><span class="default">$x</span><span class="keyword">], </span><span class="default">30</span><span class="keyword">);
<br>&nbsp; </span><span class="default">socket_set_blocking</span><span class="keyword">(</span><span class="default">$sockets</span><span class="keyword">[</span><span class="default">$x</span><span class="keyword">],</span><span class="default">FALSE</span><span class="keyword">);
<br>&nbsp; </span><span class="default">$query </span><span class="keyword">= (</span><span class="default">$urlInfo</span><span class="keyword">[</span><span class="default">$x</span><span class="keyword">][</span><span class="default">query</span><span class="keyword">]) ? </span><span class="string">"?" </span><span class="keyword">. </span><span class="default">$urlInfo</span><span class="keyword">[</span><span class="default">$x</span><span class="keyword">][</span><span class="default">query</span><span class="keyword">] : </span><span class="string">""</span><span class="keyword">;
<br>&nbsp; </span><span class="default">fputs</span><span class="keyword">(</span><span class="default">$sockets</span><span class="keyword">[</span><span class="default">$x</span><span class="keyword">],</span><span class="string">"GET " </span><span class="keyword">. </span><span class="default">$urlInfo</span><span class="keyword">[</span><span class="default">$x</span><span class="keyword">][</span><span class="default">path</span><span class="keyword">] . </span><span class="string">"</span><span class="default">$query</span><span class="string"> HTTP/1.0\r\nHost: " </span><span class="keyword">.
<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$urlInfo</span><span class="keyword">[</span><span class="default">$x</span><span class="keyword">][</span><span class="default">host</span><span class="keyword">] . </span><span class="string">"\r\n\r\n"</span><span class="keyword">);
<br> }
<br> </span><span class="comment">// ok read the data from each one
<br> </span><span class="default">$done </span><span class="keyword">= </span><span class="default">false</span><span class="keyword">;
<br> while (!</span><span class="default">$done</span><span class="keyword">) {
<br>&nbsp; for (</span><span class="default">$x</span><span class="keyword">=</span><span class="default">0</span><span class="keyword">; </span><span class="default">$x </span><span class="keyword">&lt; </span><span class="default">count</span><span class="keyword">(</span><span class="default">$urlArr</span><span class="keyword">);</span><span class="default">$x</span><span class="keyword">++) {
<br>&nbsp;&nbsp; if (!</span><span class="default">feof</span><span class="keyword">(</span><span class="default">$sockets</span><span class="keyword">[</span><span class="default">$x</span><span class="keyword">])) {
<br>&nbsp; &nbsp; if (</span><span class="default">$retData</span><span class="keyword">[</span><span class="default">$x</span><span class="keyword">]) {
<br>&nbsp; &nbsp;&nbsp; </span><span class="default">$retData</span><span class="keyword">[</span><span class="default">$x</span><span class="keyword">] .= </span><span class="default">fgets</span><span class="keyword">(</span><span class="default">$sockets</span><span class="keyword">[</span><span class="default">$x</span><span class="keyword">],</span><span class="default">128</span><span class="keyword">);
<br>&nbsp; &nbsp; } else {
<br>&nbsp; &nbsp;&nbsp; </span><span class="default">$retData</span><span class="keyword">[</span><span class="default">$x</span><span class="keyword">] = </span><span class="default">fgets</span><span class="keyword">(</span><span class="default">$sockets</span><span class="keyword">[</span><span class="default">$x</span><span class="keyword">],</span><span class="default">128</span><span class="keyword">);
<br>&nbsp; &nbsp; }
<br>&nbsp;&nbsp; } else {
<br>&nbsp; &nbsp; </span><span class="default">$retDone</span><span class="keyword">[</span><span class="default">$x</span><span class="keyword">] = </span><span class="default">1</span><span class="keyword">;
<br>&nbsp;&nbsp; }
<br>&nbsp; }
<br>&nbsp; </span><span class="default">$done </span><span class="keyword">= (</span><span class="default">array_sum</span><span class="keyword">(</span><span class="default">$retDone</span><span class="keyword">) == </span><span class="default">count</span><span class="keyword">(</span><span class="default">$urlArr</span><span class="keyword">));
<br> }
<br> return </span><span class="default">$retData</span><span class="keyword">;
<br>}
<br></span><span class="default">?&gt;</span>
</span>
</code></div>
  </div>
 </div>
  <div class="note" id="33411">  
  <a class="name">
  <strong class="user"><em>xbensemhoun at t-systems dot fr</em></strong></a><div class="date" title="2003-06-25 02:48"><strong>11 years ago</strong></div>
  <div class="text" id="Hcom33411">
<div class="phpcode"><code><span class="html">
To make a telnet connection with a Cisco router:
<br>
<br><span class="default">&lt;?php
<br>$cfgServer </span><span class="keyword">= </span><span class="string">"nnn.nnn.nnn.nnn"</span><span class="keyword">;&nbsp; </span><span class="comment">//IP of your router
<br></span><span class="default">$cfgPort&nbsp; &nbsp; </span><span class="keyword">= </span><span class="default">23</span><span class="keyword">;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="comment">//port, 22 if SSH
<br></span><span class="default">$cfgTimeOut </span><span class="keyword">= </span><span class="default">10</span><span class="keyword">;
<br>
<br></span><span class="default">$usenet </span><span class="keyword">= </span><span class="default">fsockopen</span><span class="keyword">(</span><span class="default">$cfgServer</span><span class="keyword">, </span><span class="default">$cfgPort</span><span class="keyword">, </span><span class="default">$errno</span><span class="keyword">, </span><span class="default">$errstr</span><span class="keyword">, </span><span class="default">$cfgTimeOut</span><span class="keyword">);
<br>
<br>if(!</span><span class="default">$usenet</span><span class="keyword">)
<br>&nbsp; &nbsp; &nbsp; &nbsp; {
<br>&nbsp; &nbsp; &nbsp; &nbsp; echo </span><span class="string">"Connexion failed\n"</span><span class="keyword">;
<br>&nbsp; &nbsp; &nbsp; &nbsp; exit();
<br>&nbsp; &nbsp; &nbsp; &nbsp; }
<br>else
<br>&nbsp; &nbsp; &nbsp; &nbsp; {
<br>&nbsp; &nbsp; &nbsp; &nbsp; echo </span><span class="string">"Connected\n&lt;BR&gt;"</span><span class="keyword">;
<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">fputs </span><span class="keyword">(</span><span class="default">$usenet</span><span class="keyword">, </span><span class="string">"toto\r\n"</span><span class="keyword">);
<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">fputs </span><span class="keyword">(</span><span class="default">$usenet</span><span class="keyword">, </span><span class="string">"en\r\n"</span><span class="keyword">);
<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">fputs </span><span class="keyword">(</span><span class="default">$usenet</span><span class="keyword">, </span><span class="string">"tutu\r\n"</span><span class="keyword">);
<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">fputs </span><span class="keyword">(</span><span class="default">$usenet</span><span class="keyword">, </span><span class="string">"exit\r\n"</span><span class="keyword">);
<br>&nbsp; &nbsp; &nbsp; &nbsp; while (!</span><span class="default">feof</span><span class="keyword">(</span><span class="default">$usenet</span><span class="keyword">))
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; echo </span><span class="string">". "</span><span class="keyword">.</span><span class="default">fgets</span><span class="keyword">(</span><span class="default">$usenet</span><span class="keyword">, </span><span class="default">128</span><span class="keyword">).</span><span class="string">"&lt;BR&gt;\n"</span><span class="keyword">;
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }
<br>&nbsp; &nbsp; &nbsp; &nbsp; }
<br></span><span class="default">?&gt;
<br></span>
<br>Then you will have:
<br>Connected
<br>. ��������
<br>.
<br>. User Access Verification
<br>.
<br>. Password:
<br>. testXB&gt;en
<br>. Password:
<br>. testXB#exit
<br>.</span>
</code></div>
  </div>
 </div>
  <div class="note" id="92588">  
  <a class="name">
  <strong class="user"><em>walter</em></strong></a><div class="date" title="2009-07-30 08:05"><strong>5 years ago</strong></div>
  <div class="text" id="Hcom92588">
<div class="phpcode"><code><span class="html">
For some reason the default FreeBSD 7.0 port (jailed environment) breaks fsockopen() on SSL URLs, returning a constant stream of nothing!&nbsp; In my case this resulted in php-cgi bringing down lighttpd completely, in rapid time!&nbsp; Avoid FreeBSD/jails/fsockopen + SSL.&nbsp; Use curl_init() instead.</span>
</code></div>
  </div>
 </div>
  <div class="note" id="101872">  
  <a class="name">
  <strong class="user"><em>Jeremy Saintot</em></strong></a><div class="date" title="2011-01-14 04:24"><strong>3 years ago</strong></div>
  <div class="text" id="Hcom101872">
<div class="phpcode"><code><span class="html">
Here is my fsockopen-based HTTP request fonction (GET and POST) :
<br>
<br><span class="default">&lt;?php
<br></span><span class="keyword">function </span><span class="default">http_request</span><span class="keyword">(
<br>&nbsp; &nbsp; </span><span class="default">$verb </span><span class="keyword">= </span><span class="string">'GET'</span><span class="keyword">,&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">/* HTTP Request Method (GET and POST supported) */
<br>&nbsp; &nbsp; </span><span class="default">$ip</span><span class="keyword">,&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">/* Target IP/Hostname */
<br>&nbsp; &nbsp; </span><span class="default">$port </span><span class="keyword">= </span><span class="default">80</span><span class="keyword">,&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="comment">/* Target TCP port */
<br>&nbsp; &nbsp; </span><span class="default">$uri </span><span class="keyword">= </span><span class="string">'/'</span><span class="keyword">,&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="comment">/* Target URI */
<br>&nbsp; &nbsp; </span><span class="default">$getdata </span><span class="keyword">= array(),&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="comment">/* HTTP GET Data ie. array('var1' =&gt; 'val1', 'var2' =&gt; 'val2') */
<br>&nbsp; &nbsp; </span><span class="default">$postdata </span><span class="keyword">= array(),&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">/* HTTP POST Data ie. array('var1' =&gt; 'val1', 'var2' =&gt; 'val2') */
<br>&nbsp; &nbsp; </span><span class="default">$cookie </span><span class="keyword">= array(),&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">/* HTTP Cookie Data ie. array('var1' =&gt; 'val1', 'var2' =&gt; 'val2') */
<br>&nbsp; &nbsp; </span><span class="default">$custom_headers </span><span class="keyword">= array(), </span><span class="comment">/* Custom HTTP headers ie. array('Referer: <a rel="nofollow" target="_blank">http://localhost/</a> */
<br>&nbsp; &nbsp; </span><span class="default">$timeout </span><span class="keyword">= </span><span class="default">1</span><span class="keyword">,&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">/* Socket timeout in seconds */
<br>&nbsp; &nbsp; </span><span class="default">$req_hdr </span><span class="keyword">= </span><span class="default">false</span><span class="keyword">,&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="comment">/* Include HTTP request headers */
<br>&nbsp; &nbsp; </span><span class="default">$res_hdr </span><span class="keyword">= </span><span class="default">false&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">/* Include HTTP response headers */
<br>&nbsp; &nbsp; </span><span class="keyword">)
<br>{
<br>&nbsp; &nbsp; </span><span class="default">$ret </span><span class="keyword">= </span><span class="string">''</span><span class="keyword">;
<br>&nbsp; &nbsp; </span><span class="default">$verb </span><span class="keyword">= </span><span class="default">strtoupper</span><span class="keyword">(</span><span class="default">$verb</span><span class="keyword">);
<br>&nbsp; &nbsp; </span><span class="default">$cookie_str </span><span class="keyword">= </span><span class="string">''</span><span class="keyword">;
<br>&nbsp; &nbsp; </span><span class="default">$getdata_str </span><span class="keyword">= </span><span class="default">count</span><span class="keyword">(</span><span class="default">$getdata</span><span class="keyword">) ? </span><span class="string">'?' </span><span class="keyword">: </span><span class="string">''</span><span class="keyword">;
<br>&nbsp; &nbsp; </span><span class="default">$postdata_str </span><span class="keyword">= </span><span class="string">''</span><span class="keyword">;
<br>
<br>&nbsp; &nbsp; foreach (</span><span class="default">$getdata </span><span class="keyword">as </span><span class="default">$k </span><span class="keyword">=&gt; </span><span class="default">$v</span><span class="keyword">)
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$getdata_str </span><span class="keyword">.= </span><span class="default">urlencode</span><span class="keyword">(</span><span class="default">$k</span><span class="keyword">) .</span><span class="string">'='</span><span class="keyword">. </span><span class="default">urlencode</span><span class="keyword">(</span><span class="default">$v</span><span class="keyword">) . </span><span class="string">'&amp;'</span><span class="keyword">;
<br>
<br>&nbsp; &nbsp; foreach (</span><span class="default">$postdata </span><span class="keyword">as </span><span class="default">$k </span><span class="keyword">=&gt; </span><span class="default">$v</span><span class="keyword">)
<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$postdata_str </span><span class="keyword">.= </span><span class="default">urlencode</span><span class="keyword">(</span><span class="default">$k</span><span class="keyword">) .</span><span class="string">'='</span><span class="keyword">. </span><span class="default">urlencode</span><span class="keyword">(</span><span class="default">$v</span><span class="keyword">) .</span><span class="string">'&amp;'</span><span class="keyword">;
<br>
<br>&nbsp; &nbsp; foreach (</span><span class="default">$cookie </span><span class="keyword">as </span><span class="default">$k </span><span class="keyword">=&gt; </span><span class="default">$v</span><span class="keyword">)
<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$cookie_str </span><span class="keyword">.= </span><span class="default">urlencode</span><span class="keyword">(</span><span class="default">$k</span><span class="keyword">) .</span><span class="string">'='</span><span class="keyword">. </span><span class="default">urlencode</span><span class="keyword">(</span><span class="default">$v</span><span class="keyword">) .</span><span class="string">'; '</span><span class="keyword">;
<br>
<br>&nbsp; &nbsp; </span><span class="default">$crlf </span><span class="keyword">= </span><span class="string">"\r\n"</span><span class="keyword">;
<br>&nbsp; &nbsp; </span><span class="default">$req </span><span class="keyword">= </span><span class="default">$verb </span><span class="keyword">.</span><span class="string">' '</span><span class="keyword">. </span><span class="default">$uri </span><span class="keyword">. </span><span class="default">$getdata_str </span><span class="keyword">.</span><span class="string">' HTTP/1.1' </span><span class="keyword">. </span><span class="default">$crlf</span><span class="keyword">;
<br>&nbsp; &nbsp; </span><span class="default">$req </span><span class="keyword">.= </span><span class="string">'Host: '</span><span class="keyword">. </span><span class="default">$ip </span><span class="keyword">. </span><span class="default">$crlf</span><span class="keyword">;
<br>&nbsp; &nbsp; </span><span class="default">$req </span><span class="keyword">.= </span><span class="string">'User-Agent: Mozilla/5.0 Firefox/3.6.12' </span><span class="keyword">. </span><span class="default">$crlf</span><span class="keyword">;
<br>&nbsp; &nbsp; </span><span class="default">$req </span><span class="keyword">.= </span><span class="string">'Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8' </span><span class="keyword">. </span><span class="default">$crlf</span><span class="keyword">;
<br>&nbsp; &nbsp; </span><span class="default">$req </span><span class="keyword">.= </span><span class="string">'Accept-Language: en-us,en;q=0.5' </span><span class="keyword">. </span><span class="default">$crlf</span><span class="keyword">;
<br>&nbsp; &nbsp; </span><span class="default">$req </span><span class="keyword">.= </span><span class="string">'Accept-Encoding: deflate' </span><span class="keyword">. </span><span class="default">$crlf</span><span class="keyword">;
<br>&nbsp; &nbsp; </span><span class="default">$req </span><span class="keyword">.= </span><span class="string">'Accept-Charset: ISO-8859-1,utf-8;q=0.7,*;q=0.7' </span><span class="keyword">. </span><span class="default">$crlf</span><span class="keyword">;
<br>&nbsp; &nbsp; 
<br>&nbsp; &nbsp; foreach (</span><span class="default">$custom_headers </span><span class="keyword">as </span><span class="default">$k </span><span class="keyword">=&gt; </span><span class="default">$v</span><span class="keyword">)
<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$req </span><span class="keyword">.= </span><span class="default">$k </span><span class="keyword">.</span><span class="string">': '</span><span class="keyword">. </span><span class="default">$v </span><span class="keyword">. </span><span class="default">$crlf</span><span class="keyword">;
<br>&nbsp; &nbsp; &nbsp; &nbsp; 
<br>&nbsp; &nbsp; if (!empty(</span><span class="default">$cookie_str</span><span class="keyword">))
<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$req </span><span class="keyword">.= </span><span class="string">'Cookie: '</span><span class="keyword">. </span><span class="default">substr</span><span class="keyword">(</span><span class="default">$cookie_str</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, -</span><span class="default">2</span><span class="keyword">) . </span><span class="default">$crlf</span><span class="keyword">;
<br>&nbsp; &nbsp; &nbsp; &nbsp; 
<br>&nbsp; &nbsp; if (</span><span class="default">$verb </span><span class="keyword">== </span><span class="string">'POST' </span><span class="keyword">&amp;&amp; !empty(</span><span class="default">$postdata_str</span><span class="keyword">))
<br>&nbsp; &nbsp; {
<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$postdata_str </span><span class="keyword">= </span><span class="default">substr</span><span class="keyword">(</span><span class="default">$postdata_str</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, -</span><span class="default">1</span><span class="keyword">);
<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$req </span><span class="keyword">.= </span><span class="string">'Content-Type: application/x-www-form-urlencoded' </span><span class="keyword">. </span><span class="default">$crlf</span><span class="keyword">;
<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$req </span><span class="keyword">.= </span><span class="string">'Content-Length: '</span><span class="keyword">. </span><span class="default">strlen</span><span class="keyword">(</span><span class="default">$postdata_str</span><span class="keyword">) . </span><span class="default">$crlf </span><span class="keyword">. </span><span class="default">$crlf</span><span class="keyword">;
<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$req </span><span class="keyword">.= </span><span class="default">$postdata_str</span><span class="keyword">;
<br>&nbsp; &nbsp; }
<br>&nbsp; &nbsp; else </span><span class="default">$req </span><span class="keyword">.= </span><span class="default">$crlf</span><span class="keyword">;
<br>&nbsp; &nbsp; 
<br>&nbsp; &nbsp; if (</span><span class="default">$req_hdr</span><span class="keyword">)
<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$ret </span><span class="keyword">.= </span><span class="default">$req</span><span class="keyword">;
<br>&nbsp; &nbsp; 
<br>&nbsp; &nbsp; if ((</span><span class="default">$fp </span><span class="keyword">= @</span><span class="default">fsockopen</span><span class="keyword">(</span><span class="default">$ip</span><span class="keyword">, </span><span class="default">$port</span><span class="keyword">, </span><span class="default">$errno</span><span class="keyword">, </span><span class="default">$errstr</span><span class="keyword">)) == </span><span class="default">false</span><span class="keyword">)
<br>&nbsp; &nbsp; &nbsp; &nbsp; return </span><span class="string">"Error </span><span class="default">$errno</span><span class="string">: </span><span class="default">$errstr</span><span class="string">\n"</span><span class="keyword">;
<br>&nbsp; &nbsp; 
<br>&nbsp; &nbsp; </span><span class="default">stream_set_timeout</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">$timeout </span><span class="keyword">* </span><span class="default">1000</span><span class="keyword">);
<br>&nbsp; &nbsp; 
<br>&nbsp; &nbsp; </span><span class="default">fputs</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">, </span><span class="default">$req</span><span class="keyword">);
<br>&nbsp; &nbsp; while (</span><span class="default">$line </span><span class="keyword">= </span><span class="default">fgets</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">)) </span><span class="default">$ret </span><span class="keyword">.= </span><span class="default">$line</span><span class="keyword">;
<br>&nbsp; &nbsp; </span><span class="default">fclose</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">);
<br>&nbsp; &nbsp; 
<br>&nbsp; &nbsp; if (!</span><span class="default">$res_hdr</span><span class="keyword">)
<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$ret </span><span class="keyword">= </span><span class="default">substr</span><span class="keyword">(</span><span class="default">$ret</span><span class="keyword">, </span><span class="default">strpos</span><span class="keyword">(</span><span class="default">$ret</span><span class="keyword">, </span><span class="string">"\r\n\r\n"</span><span class="keyword">) + </span><span class="default">4</span><span class="keyword">);
<br>&nbsp; &nbsp; 
<br>&nbsp; &nbsp; return </span><span class="default">$ret</span><span class="keyword">;
<br>}
<br></span><span class="default">?&gt;
<br></span>
<br>Example usages :
<br>
<br><span class="default">&lt;?php
<br></span><span class="keyword">echo </span><span class="default">http_request</span><span class="keyword">(</span><span class="string">'GET'</span><span class="keyword">, </span><span class="string">'www.php.net'</span><span class="keyword">);
<br>echo </span><span class="default">http_request</span><span class="keyword">(</span><span class="string">'GET'</span><span class="keyword">, </span><span class="string">'www.php.net'</span><span class="keyword">, </span><span class="default">80</span><span class="keyword">, </span><span class="string">'/manual/en/function.phpinfo.php'</span><span class="keyword">);
<br>echo </span><span class="default">http_request</span><span class="keyword">(</span><span class="string">'GET'</span><span class="keyword">, </span><span class="string">'www.php.net'</span><span class="keyword">, </span><span class="default">80</span><span class="keyword">, </span><span class="string">'/manual/en/function.phpinfo.php'</span><span class="keyword">, array(</span><span class="string">'get1' </span><span class="keyword">=&gt; </span><span class="string">'v_get1'</span><span class="keyword">), array(), array(</span><span class="string">'cookie1' </span><span class="keyword">=&gt; </span><span class="string">'v_cookie1'</span><span class="keyword">), array(</span><span class="string">'X-My-Header' </span><span class="keyword">=&gt; </span><span class="string">'My Value'</span><span class="keyword">));
<br></span><span class="default">?&gt;
<br></span>
<br>[EDIT BY danbrown AT php DOT net: Contains a bugfix provided by "Wrinkled Cheese" on 24-JUN-2011 to fix the $getdata foreach() loop; another bugfix provided by Suat Secmen on 12-JAN-2012 to fix a $timeout = 1000, then stream_set_timeout($fp, 0, $timeout * 1000), equaling 1,000 seconds.]</span>
</code></div>
  </div>
 </div>
  <div class="note" id="77587">  
  <a class="name">
  <strong class="user"><em>anarchy</em></strong></a><div class="date" title="2007-09-04 06:34"><strong>6 years ago</strong></div>
  <div class="text" id="Hcom77587">
<div class="phpcode"><code><span class="html">
The DEFAULT stream timeout is set according to default_socket_timeout in your php.ini file.&nbsp; Took forever for me to dig that up....</span>
</code></div>
  </div>
 </div>
  <div class="note" id="82586">  
  <a class="name">
  <strong class="user"><em>jabeba at web dot de</em></strong></a><div class="date" title="2008-04-17 06:21"><strong>6 years ago</strong></div>
  <div class="text" id="Hcom82586">
<div class="phpcode"><code><span class="html">
If you have to use a proxy to make requests outside of your local network, you may use this class:
<br>
<br><span class="default">&lt;?php
<br></span><span class="comment">/*
<br> * 
<br> * No Proxy Authentification Implemented; PHP 5
<br> * 
<br> */
<br>
<br></span><span class="keyword">class </span><span class="default">RemoteFopenViaProxy </span><span class="keyword">{
<br>
<br>&nbsp; &nbsp; private </span><span class="default">$result</span><span class="keyword">;
<br>&nbsp; &nbsp; private </span><span class="default">$proxy_name</span><span class="keyword">;
<br>&nbsp; &nbsp; private </span><span class="default">$proxy_port</span><span class="keyword">;
<br>&nbsp; &nbsp; private </span><span class="default">$request_url</span><span class="keyword">;
<br>
<br>&nbsp; &nbsp; public function </span><span class="default">get_proxy_name</span><span class="keyword">() {
<br>&nbsp; &nbsp; &nbsp; &nbsp; return </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">proxy_name</span><span class="keyword">;
<br>&nbsp; &nbsp; }
<br>
<br>&nbsp; &nbsp; public function </span><span class="default">set_proxy_name</span><span class="keyword">(</span><span class="default">$n</span><span class="keyword">) {
<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">proxy_name </span><span class="keyword">= </span><span class="default">$n</span><span class="keyword">;
<br>&nbsp; &nbsp; }
<br>
<br>&nbsp; &nbsp; public function </span><span class="default">get_proxy_port</span><span class="keyword">() {
<br>&nbsp; &nbsp; &nbsp; &nbsp; return </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">proxy_port</span><span class="keyword">;
<br>&nbsp; &nbsp; }
<br>
<br>&nbsp; &nbsp; public function </span><span class="default">set_proxy_port</span><span class="keyword">(</span><span class="default">$p</span><span class="keyword">) {
<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">proxy_port </span><span class="keyword">= </span><span class="default">$p</span><span class="keyword">;
<br>&nbsp; &nbsp; }
<br>
<br>&nbsp; &nbsp; public function </span><span class="default">get_request_url</span><span class="keyword">() {
<br>&nbsp; &nbsp; &nbsp; &nbsp; return </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">request_url</span><span class="keyword">;
<br>&nbsp; &nbsp; }
<br>
<br>&nbsp; &nbsp; public function </span><span class="default">set_request_url</span><span class="keyword">(</span><span class="default">$u</span><span class="keyword">) {
<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">request_url </span><span class="keyword">= </span><span class="default">$u</span><span class="keyword">;
<br>&nbsp; &nbsp; }
<br>
<br>&nbsp; &nbsp; public function </span><span class="default">get_result</span><span class="keyword">() {
<br>&nbsp; &nbsp; &nbsp; &nbsp; return </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">result</span><span class="keyword">;
<br>&nbsp; &nbsp; }
<br>
<br>&nbsp; &nbsp; public function </span><span class="default">set_result</span><span class="keyword">(</span><span class="default">$r</span><span class="keyword">) {
<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">result </span><span class="keyword">= </span><span class="default">$r</span><span class="keyword">;
<br>&nbsp; &nbsp; }
<br>
<br>&nbsp; &nbsp; private function </span><span class="default">get_url_via_proxy</span><span class="keyword">() {
<br>
<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$proxy_fp </span><span class="keyword">= </span><span class="default">fsockopen</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">get_proxy_name</span><span class="keyword">(), </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">get_proxy_port</span><span class="keyword">());
<br>
<br>&nbsp; &nbsp; &nbsp; &nbsp; if (!</span><span class="default">$proxy_fp</span><span class="keyword">) {
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; return </span><span class="default">false</span><span class="keyword">;
<br>&nbsp; &nbsp; &nbsp; &nbsp; }
<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">fputs</span><span class="keyword">(</span><span class="default">$proxy_fp</span><span class="keyword">, </span><span class="string">"GET " </span><span class="keyword">. </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">get_request_url</span><span class="keyword">() . </span><span class="string">" HTTP/1.0\r\nHost: " </span><span class="keyword">. </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">get_proxy_name</span><span class="keyword">() . </span><span class="string">"\r\n\r\n"</span><span class="keyword">);
<br>&nbsp; &nbsp; &nbsp; &nbsp; while (!</span><span class="default">feof</span><span class="keyword">(</span><span class="default">$proxy_fp</span><span class="keyword">)) {
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$proxy_cont </span><span class="keyword">.= </span><span class="default">fread</span><span class="keyword">(</span><span class="default">$proxy_fp</span><span class="keyword">, </span><span class="default">4096</span><span class="keyword">);
<br>&nbsp; &nbsp; &nbsp; &nbsp; }
<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">fclose</span><span class="keyword">(</span><span class="default">$proxy_fp</span><span class="keyword">);
<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$proxy_cont </span><span class="keyword">= </span><span class="default">substr</span><span class="keyword">(</span><span class="default">$proxy_cont</span><span class="keyword">, </span><span class="default">strpos</span><span class="keyword">(</span><span class="default">$proxy_cont</span><span class="keyword">, </span><span class="string">"\r\n\r\n"</span><span class="keyword">) + </span><span class="default">4</span><span class="keyword">);
<br>&nbsp; &nbsp; &nbsp; &nbsp; return </span><span class="default">$proxy_cont</span><span class="keyword">;
<br>
<br>&nbsp; &nbsp; }
<br>
<br>&nbsp; &nbsp; private function </span><span class="default">get_url</span><span class="keyword">(</span><span class="default">$url</span><span class="keyword">) {
<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$fd </span><span class="keyword">= @ </span><span class="default">file</span><span class="keyword">(</span><span class="default">$url</span><span class="keyword">);
<br>&nbsp; &nbsp; &nbsp; &nbsp; if (</span><span class="default">$fd</span><span class="keyword">) {
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; return </span><span class="default">$fd</span><span class="keyword">;
<br>&nbsp; &nbsp; &nbsp; &nbsp; } else {
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; return </span><span class="default">false</span><span class="keyword">;
<br>&nbsp; &nbsp; &nbsp; &nbsp; }
<br>&nbsp; &nbsp; }
<br>
<br>&nbsp; &nbsp; private function </span><span class="default">logger</span><span class="keyword">(</span><span class="default">$line</span><span class="keyword">, </span><span class="default">$file</span><span class="keyword">) {
<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$fd </span><span class="keyword">= </span><span class="default">fopen</span><span class="keyword">(</span><span class="default">$file </span><span class="keyword">. </span><span class="string">".log"</span><span class="keyword">, </span><span class="string">"a+"</span><span class="keyword">);
<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">fwrite</span><span class="keyword">(</span><span class="default">$fd</span><span class="keyword">, </span><span class="default">date</span><span class="keyword">(</span><span class="string">"Ymd G:i:s"</span><span class="keyword">) . </span><span class="string">" - " </span><span class="keyword">. </span><span class="default">$file </span><span class="keyword">. </span><span class="string">" - " </span><span class="keyword">. </span><span class="default">$line </span><span class="keyword">. </span><span class="string">"\n"</span><span class="keyword">);
<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">fclose</span><span class="keyword">(</span><span class="default">$fd</span><span class="keyword">);
<br>&nbsp; &nbsp; }
<br>
<br>&nbsp; &nbsp; function </span><span class="default">__construct</span><span class="keyword">(</span><span class="default">$url</span><span class="keyword">, </span><span class="default">$proxy_name </span><span class="keyword">= </span><span class="string">""</span><span class="keyword">, </span><span class="default">$proxy_port </span><span class="keyword">= </span><span class="string">""</span><span class="keyword">) {
<br>
<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">set_request_url</span><span class="keyword">(</span><span class="default">$url</span><span class="keyword">);
<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">set_proxy_name</span><span class="keyword">(</span><span class="default">$proxy_name</span><span class="keyword">);
<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">set_proxy_port</span><span class="keyword">(</span><span class="default">$proxy_port</span><span class="keyword">);
<br>
<br>&nbsp; &nbsp; }
<br>
<br>&nbsp; &nbsp; public function </span><span class="default">request_via_proxy</span><span class="keyword">() {
<br>
<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">set_result</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">get_url_via_proxy</span><span class="keyword">());
<br>&nbsp; &nbsp; &nbsp; &nbsp; if (!</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">get_result</span><span class="keyword">()) {
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">logger</span><span class="keyword">(</span><span class="string">"FAILED: get_url_via_proxy(" </span><span class="keyword">. </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">get_proxy_name</span><span class="keyword">() . </span><span class="string">"," </span><span class="keyword">. </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">get_proxy_port</span><span class="keyword">() . </span><span class="string">"," </span><span class="keyword">. </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">get_request_url</span><span class="keyword">() . </span><span class="string">")"</span><span class="keyword">, </span><span class="string">"RemoteFopenViaProxyClass.log"</span><span class="keyword">);
<br>&nbsp; &nbsp; &nbsp; &nbsp; }
<br>&nbsp; &nbsp; }
<br>
<br>&nbsp; &nbsp; public function </span><span class="default">request_without_proxy</span><span class="keyword">() {
<br>
<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">set_result</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">get_url</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">get_request_url</span><span class="keyword">()));
<br>&nbsp; &nbsp; &nbsp; &nbsp; if (!</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">get_result</span><span class="keyword">()) {
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">logger</span><span class="keyword">(</span><span class="string">"FAILED: get_url(" </span><span class="keyword">. </span><span class="default">$url </span><span class="keyword">. </span><span class="string">")"</span><span class="keyword">, </span><span class="string">"RemoteFopenViaProxyClass.log"</span><span class="keyword">);
<br>&nbsp; &nbsp; &nbsp; &nbsp; }
<br>&nbsp; &nbsp; }
<br>}
<br></span><span class="default">?&gt;
<br></span>
<br>Use it this way:
<br>
<br><span class="default">&lt;?php
<br></span><span class="comment">// call constructor
<br></span><span class="default">$obj </span><span class="keyword">= new </span><span class="default">RemoteFopenViaProxy</span><span class="keyword">(</span><span class="default">$insert_request_url</span><span class="keyword">, </span><span class="default">$insert_proxy_name</span><span class="keyword">, </span><span class="default">$insert_proxy_port</span><span class="keyword">);
<br></span><span class="comment">// change settings after object generation
<br></span><span class="default">$obj</span><span class="keyword">-&gt;</span><span class="default">set_proxy_name</span><span class="keyword">(</span><span class="default">$insert_proxy_name</span><span class="keyword">);
<br></span><span class="default">$obj</span><span class="keyword">-&gt;</span><span class="default">set_proxy_port</span><span class="keyword">(</span><span class="default">$insert_proxy_port</span><span class="keyword">);
<br></span><span class="default">$obj</span><span class="keyword">-&gt;</span><span class="default">set_request_url</span><span class="keyword">(</span><span class="default">$insert_request_url</span><span class="keyword">);
<br></span><span class="default">$obj</span><span class="keyword">-&gt;</span><span class="default">request_via_proxy</span><span class="keyword">();
<br>echo </span><span class="default">$obj</span><span class="keyword">-&gt;</span><span class="default">get_result</span><span class="keyword">();
<br></span><span class="default">?&gt;
<br></span>
<br>If there are errors during execution, the script tries to write some useful information into a log file.</span>
</code></div>
  </div>
 </div>
  <div class="note" id="76468">  
  <a class="name">
  <strong class="user"><em>warezthebeef at gmail dot com</em></strong></a><div class="date" title="2007-07-17 04:37"><strong>7 years ago</strong></div>
  <div class="text" id="Hcom76468">
<div class="phpcode"><code><span class="html">
I ran into a problem where I needed to make an fsockopen() style connection from one specific ip address on a server with multiple ip aliases. Unfortunately fsockopen() does not allow the specification of a source address making it unsuitable. I could not find any other solutions elsewhere so here is mine for those with php 5.1.0 or greater.
<br>
<br><span class="default">&lt;?php
<br></span><span class="comment">// connect to the internet using the '192.168.0.100' IP
<br></span><span class="default">$opts </span><span class="keyword">= array(</span><span class="string">'socket' </span><span class="keyword">=&gt; array(</span><span class="string">'bindto' </span><span class="keyword">=&gt; </span><span class="string">'192.168.0.100:0'</span><span class="keyword">));
<br>
<br></span><span class="default">$context </span><span class="keyword">= </span><span class="default">stream_context_create</span><span class="keyword">(</span><span class="default">$opts</span><span class="keyword">);
<br>
<br></span><span class="default">$fp </span><span class="keyword">= </span><span class="default">stream_socket_client</span><span class="keyword">(</span><span class="string">"tcp://www.example.com:80"</span><span class="keyword">, </span><span class="default">$errno</span><span class="keyword">, </span><span class="default">$errstr</span><span class="keyword">, </span><span class="default">30</span><span class="keyword">, </span><span class="default">STREAM_CLIENT_CONNECT</span><span class="keyword">, </span><span class="default">$context</span><span class="keyword">);
<br></span><span class="default">?&gt;
<br></span>
<br>Now $fp can be used like a resource handle returned by a vanilla fsockopen() call!</span>
</code></div>
  </div>
 </div>
  <div class="note" id="37517">  
  <a class="name">
  <strong class="user"><em>asalamanca at redcetus dot com</em></strong></a><div class="date" title="2003-11-18 11:27"><strong>10 years ago</strong></div>
  <div class="text" id="Hcom37517">
<div class="phpcode"><code><span class="html">
This is a very fast program for test a form or link (many times).
<br><span class="default">&lt;?php
<br>$repeat&nbsp; </span><span class="keyword">= </span><span class="default">100</span><span class="keyword">;&nbsp; </span><span class="comment">// How many times repeat the test
<br>
<br></span><span class="default">$timeout </span><span class="keyword">= </span><span class="default">100</span><span class="keyword">;&nbsp; </span><span class="comment">// Max time for stablish the conection
<br></span><span class="default">$size&nbsp; &nbsp; </span><span class="keyword">= </span><span class="default">16</span><span class="keyword">;&nbsp;&nbsp; </span><span class="comment">// Bytes will be read (and display). 0 for read all
<br>
<br></span><span class="default">$server&nbsp; </span><span class="keyword">= </span><span class="string">'127.0.0.1'</span><span class="keyword">;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="comment">// IP address
<br></span><span class="default">$host&nbsp; &nbsp; </span><span class="keyword">= </span><span class="string">'www.example.net'</span><span class="keyword">;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// Domain name
<br></span><span class="default">$target&nbsp; </span><span class="keyword">= </span><span class="string">'/poll/answer.asp'</span><span class="keyword">;&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="comment">// Specific program
<br></span><span class="default">$referer </span><span class="keyword">= </span><span class="string">'<a rel="nofollow" target="_blank">http://www.example.com/</a>'</span><span class="keyword">;&nbsp; &nbsp; </span><span class="comment">// Referer
<br></span><span class="default">$port&nbsp; &nbsp; </span><span class="keyword">= </span><span class="default">80</span><span class="keyword">;
<br>
<br></span><span class="comment">// Setup an array of fields to get with then create the get string
<br></span><span class="default">$gets </span><span class="keyword">= array ( </span><span class="string">'get_field_1' </span><span class="keyword">=&gt; </span><span class="string">'somevalue'</span><span class="keyword">,
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="string">'get_field_2' </span><span class="keyword">=&gt; </span><span class="string">'somevalue' </span><span class="keyword">);
<br>
<br></span><span class="comment">// Setup an array of fields to post with then create the post string
<br></span><span class="default">$posts </span><span class="keyword">= array ( </span><span class="string">'post_field_1' </span><span class="keyword">=&gt; </span><span class="string">'somevalue'</span><span class="keyword">,
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="string">'post_field_2' </span><span class="keyword">=&gt; </span><span class="string">'somevalue' </span><span class="keyword">);
<br>
<br></span><span class="comment">// That's all. Now the program proccess $repeat times
<br>
<br></span><span class="default">$method </span><span class="keyword">= </span><span class="string">"GET"</span><span class="keyword">;
<br>if ( </span><span class="default">is_array</span><span class="keyword">( </span><span class="default">$gets </span><span class="keyword">) ) {
<br>&nbsp; &nbsp; </span><span class="default">$getValues </span><span class="keyword">= </span><span class="string">'?'</span><span class="keyword">;
<br>&nbsp; &nbsp; foreach( </span><span class="default">$gets </span><span class="keyword">AS </span><span class="default">$name </span><span class="keyword">=&gt; </span><span class="default">$value </span><span class="keyword">){
<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$getValues </span><span class="keyword">.= </span><span class="default">urlencode</span><span class="keyword">( </span><span class="default">$name </span><span class="keyword">) . </span><span class="string">"=" </span><span class="keyword">. </span><span class="default">urlencode</span><span class="keyword">( </span><span class="default">$value </span><span class="keyword">) . </span><span class="string">'&amp;'</span><span class="keyword">;
<br>&nbsp; &nbsp; }
<br>&nbsp; &nbsp; </span><span class="default">$getValues </span><span class="keyword">= </span><span class="default">substr</span><span class="keyword">( </span><span class="default">$getValues</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, -</span><span class="default">1 </span><span class="keyword">);
<br>} else {
<br>&nbsp; &nbsp; </span><span class="default">$getValues </span><span class="keyword">= </span><span class="string">''</span><span class="keyword">;
<br>}
<br>
<br>if ( </span><span class="default">is_array</span><span class="keyword">( </span><span class="default">$posts </span><span class="keyword">) ) {
<br>&nbsp; &nbsp; foreach( </span><span class="default">$posts </span><span class="keyword">AS </span><span class="default">$name </span><span class="keyword">=&gt; </span><span class="default">$value </span><span class="keyword">){
<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$postValues </span><span class="keyword">.= </span><span class="default">urlencode</span><span class="keyword">( </span><span class="default">$name </span><span class="keyword">) . </span><span class="string">"=" </span><span class="keyword">. </span><span class="default">urlencode</span><span class="keyword">( </span><span class="default">$value </span><span class="keyword">) . </span><span class="string">'&amp;'</span><span class="keyword">;
<br>&nbsp; &nbsp; }
<br>&nbsp; &nbsp; </span><span class="default">$postValues </span><span class="keyword">= </span><span class="default">substr</span><span class="keyword">( </span><span class="default">$postValues</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, -</span><span class="default">1 </span><span class="keyword">);
<br>&nbsp; &nbsp; </span><span class="default">$method </span><span class="keyword">= </span><span class="string">"POST"</span><span class="keyword">;
<br>} else {
<br>&nbsp; &nbsp; </span><span class="default">$postValues </span><span class="keyword">= </span><span class="string">''</span><span class="keyword">;
<br>}
<br>
<br></span><span class="default">$request&nbsp; </span><span class="keyword">= </span><span class="string">"</span><span class="default">$method</span><span class="string"> </span><span class="default">$target$getValues</span><span class="string"> HTTP/1.1\r\n"</span><span class="keyword">;
<br></span><span class="default">$request </span><span class="keyword">.= </span><span class="string">"Host: </span><span class="default">$host</span><span class="string">\r\n"</span><span class="keyword">;
<br></span><span class="default">$request </span><span class="keyword">.= </span><span class="string">'User-Agent: Mozilla/5.0 (X11; U; Linux i686; en-US; rv:1.2.1) '</span><span class="keyword">;
<br></span><span class="default">$request </span><span class="keyword">.= </span><span class="string">"Gecko/20021204\r\n"</span><span class="keyword">;
<br></span><span class="default">$request </span><span class="keyword">.= </span><span class="string">'Accept: text/xml,application/xml,application/xhtml+xml,'</span><span class="keyword">;
<br></span><span class="default">$request </span><span class="keyword">.= </span><span class="string">'text/html;q=0.9,text/plain;q=0.8,video/x-mng,image/png,'</span><span class="keyword">;
<br></span><span class="default">$request </span><span class="keyword">.= </span><span class="string">"image/jpeg,image/gif;q=0.2,text/css,*/*;q=0.1\r\n"</span><span class="keyword">;
<br></span><span class="default">$request </span><span class="keyword">.= </span><span class="string">"Accept-Language: en-us, en;q=0.50\r\n"</span><span class="keyword">;
<br></span><span class="default">$request </span><span class="keyword">.= </span><span class="string">"Accept-Encoding: gzip, deflate, compress;q=0.9\r\n"</span><span class="keyword">;
<br></span><span class="default">$request </span><span class="keyword">.= </span><span class="string">"Accept-Charset: ISO-8859-1, utf-8;q=0.66, *;q=0.66\r\n"</span><span class="keyword">;
<br></span><span class="default">$request </span><span class="keyword">.= </span><span class="string">"Keep-Alive: 300\r\n"</span><span class="keyword">;
<br></span><span class="default">$request </span><span class="keyword">.= </span><span class="string">"Connection: keep-alive\r\n"</span><span class="keyword">;
<br></span><span class="default">$request </span><span class="keyword">.= </span><span class="string">"Referer: </span><span class="default">$referer</span><span class="string">\r\n"</span><span class="keyword">;
<br></span><span class="default">$request </span><span class="keyword">.= </span><span class="string">"Cache-Control: max-age=0\r\n"</span><span class="keyword">;
<br>
<br>if ( </span><span class="default">$method </span><span class="keyword">== </span><span class="string">"POST" </span><span class="keyword">) {
<br>&nbsp; &nbsp; </span><span class="default">$lenght </span><span class="keyword">= </span><span class="default">strlen</span><span class="keyword">( </span><span class="default">$postValues </span><span class="keyword">);
<br>&nbsp; &nbsp; </span><span class="default">$request </span><span class="keyword">.= </span><span class="string">"Content-Type: application/x-www-form-urlencoded\r\n"</span><span class="keyword">;
<br>&nbsp; &nbsp; </span><span class="default">$request </span><span class="keyword">.= </span><span class="string">"Content-Length: </span><span class="default">$lenght</span><span class="string">\r\n"</span><span class="keyword">;
<br>&nbsp; &nbsp; </span><span class="default">$request </span><span class="keyword">.= </span><span class="string">"\r\n"</span><span class="keyword">;
<br>&nbsp; &nbsp; </span><span class="default">$request </span><span class="keyword">.= </span><span class="default">$postValues</span><span class="keyword">;
<br>}
<br>
<br>for ( </span><span class="default">$i </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">; </span><span class="default">$i </span><span class="keyword">&lt; </span><span class="default">$repeat</span><span class="keyword">; </span><span class="default">$i</span><span class="keyword">++ ) {
<br>&nbsp; &nbsp; </span><span class="default">$socket&nbsp; </span><span class="keyword">= </span><span class="default">fsockopen</span><span class="keyword">( </span><span class="default">$server</span><span class="keyword">, </span><span class="default">$port</span><span class="keyword">, </span><span class="default">$errno</span><span class="keyword">, </span><span class="default">$errstr</span><span class="keyword">, </span><span class="default">$timeout </span><span class="keyword">);
<br>&nbsp; &nbsp; </span><span class="default">fputs</span><span class="keyword">( </span><span class="default">$socket</span><span class="keyword">, </span><span class="default">$request </span><span class="keyword">);
<br>&nbsp; &nbsp; if ( </span><span class="default">$size </span><span class="keyword">&gt; </span><span class="default">0 </span><span class="keyword">) {
<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$ret </span><span class="keyword">= </span><span class="default">fgets</span><span class="keyword">( </span><span class="default">$socket</span><span class="keyword">, </span><span class="default">$size </span><span class="keyword">);
<br>&nbsp; &nbsp; } else {
<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$ret </span><span class="keyword">= </span><span class="string">''</span><span class="keyword">;
<br>&nbsp; &nbsp; &nbsp; &nbsp; while ( !</span><span class="default">feof</span><span class="keyword">( </span><span class="default">$socket </span><span class="keyword">) ) {
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$ret </span><span class="keyword">.= </span><span class="default">fgets</span><span class="keyword">( </span><span class="default">$socket</span><span class="keyword">, </span><span class="default">4096 </span><span class="keyword">);
<br>&nbsp; &nbsp; &nbsp; &nbsp; }
<br>&nbsp; &nbsp; }
<br>&nbsp; &nbsp; </span><span class="default">fclose</span><span class="keyword">( </span><span class="default">$socket </span><span class="keyword">);
<br>&nbsp; &nbsp; echo </span><span class="string">"&lt;hr&gt; </span><span class="default">$i</span><span class="string"> -- </span><span class="default">$content</span><span class="string"> </span><span class="default">$ret</span><span class="string">"</span><span class="keyword">;
<br>}
<br></span><span class="default">?&gt;
<br></span>
<br>Alejandro Salamanca</span>
</code></div>
  </div>
 </div>
  <div class="note" id="91668">  
  <a class="name">
  <strong class="user"><em>ghzero at ghzero dot de</em></strong></a><div class="date" title="2009-06-22 05:20"><strong>5 years ago</strong></div>
  <div class="text" id="Hcom91668">
<div class="phpcode"><code><span class="html">
note:<br>the default protocol - if not given - seems to be tcp://</span>
</code></div>
  </div>
 </div>
  <div class="note" id="86621">  
  <a class="name">
  <strong class="user"><em>laisebrown at gmail dot com</em></strong></a><div class="date" title="2008-10-26 03:30"><strong>5 years ago</strong></div>
  <div class="text" id="Hcom86621">
<div class="phpcode"><code><span class="html">
When you're connecting through a proxy server you can't rely on fsockopen returning false to indicate that the connection has failed. (This also applies to fgets and fwrite.)<br><br>To check whether the proxy succeeded in contacting the real target host, you need to look for the http response code in the headers that get returned. Typically, if the proxy was unable to reach the host, you'll find a line containing something like:<br>HTTP/1.0 503 Service Unavailable</span>
</code></div>
  </div>
 </div>
  <div class="note" id="52966">  
  <a class="name">
  <strong class="user"><em>richard dot lajaunie at cote-azur dot cci dot fr</em></strong></a><div class="date" title="2005-05-19 12:10"><strong>9 years ago</strong></div>
  <div class="text" id="Hcom52966">
<div class="phpcode"><code><span class="html">
<span class="default">&lt;?php
<br></span><span class="comment">/************************************************************
<br>* Author: Richard Lajaunie
<br>* Mail : richard.lajaunie@cote-azur.cci.fr
<br>*
<br>* subject : this script retreive all mac-addresses on all ports
<br>* of a Cisco 3548 Switch by a telnet connection
<br>*
<br>* base on the script by: xbensemhoun at t-systems dot fr
<br>**************************************************************/
<br>
<br></span><span class="keyword">if ( </span><span class="default">array_key_exists</span><span class="keyword">(</span><span class="default">1</span><span class="keyword">, </span><span class="default">$argv</span><span class="keyword">) ){
<br>&nbsp;&nbsp; </span><span class="default">$cfgServer </span><span class="keyword">= </span><span class="default">$argv</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">];
<br>}else{
<br>&nbsp;&nbsp; echo </span><span class="string">"ex: 'php test.php 10.0.0.0' \n"</span><span class="keyword">;
<br>&nbsp;&nbsp; exit;
<br>}
<br>
<br></span><span class="default">$cfgPort&nbsp; &nbsp; </span><span class="keyword">= </span><span class="default">23</span><span class="keyword">;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="comment">//port, 22 if SSH
<br></span><span class="default">$cfgTimeOut </span><span class="keyword">= </span><span class="default">10</span><span class="keyword">;
<br>
<br></span><span class="default">$usenet </span><span class="keyword">= </span><span class="default">fsockopen</span><span class="keyword">(</span><span class="default">$cfgServer</span><span class="keyword">, </span><span class="default">$cfgPort</span><span class="keyword">, </span><span class="default">$errno</span><span class="keyword">, </span><span class="default">$errstr</span><span class="keyword">), </span><span class="default">$cfgTimeOut</span><span class="keyword">);
<br>
<br>if(!</span><span class="default">$usenet</span><span class="keyword">){
<br>&nbsp; &nbsp; &nbsp;&nbsp; echo </span><span class="string">"Connexion failed\n"</span><span class="keyword">;
<br>&nbsp; &nbsp; &nbsp;&nbsp; exit();
<br>}else{
<br>&nbsp; &nbsp; &nbsp;&nbsp; echo </span><span class="string">"Connected\n"</span><span class="keyword">;
<br>&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">fputs </span><span class="keyword">(</span><span class="default">$usenet</span><span class="keyword">, </span><span class="string">"password\r\n"</span><span class="keyword">);
<br>&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">fputs </span><span class="keyword">(</span><span class="default">$usenet</span><span class="keyword">, </span><span class="string">"en\r\n"</span><span class="keyword">);
<br>&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">fputs </span><span class="keyword">(</span><span class="default">$usenet</span><span class="keyword">, </span><span class="string">"password\r\n"</span><span class="keyword">);
<br>&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">fputs </span><span class="keyword">(</span><span class="default">$usenet</span><span class="keyword">, </span><span class="string">"sh mac-address-table\r\n"</span><span class="keyword">);
<br>&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">fputs </span><span class="keyword">(</span><span class="default">$usenet</span><span class="keyword">, </span><span class="string">" "</span><span class="keyword">); </span><span class="comment">// this space bar is this for long output
<br>&nbsp; &nbsp; &nbsp; 
<br>&nbsp; &nbsp; &nbsp;&nbsp; // this skip non essential text
<br>&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$j </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">;
<br>&nbsp; &nbsp; &nbsp;&nbsp; while (</span><span class="default">$j</span><span class="keyword">&lt;</span><span class="default">16</span><span class="keyword">){
<br>&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">fgets</span><span class="keyword">(</span><span class="default">$usenet</span><span class="keyword">, </span><span class="default">128</span><span class="keyword">);
<br>&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$j</span><span class="keyword">++;
<br>&nbsp; &nbsp; &nbsp;&nbsp; }
<br>&nbsp;&nbsp; </span><span class="default">stream_set_timeout</span><span class="keyword">(</span><span class="default">$usenet</span><span class="keyword">, </span><span class="default">2</span><span class="keyword">); </span><span class="comment">// set the timeout for the fgets
<br>&nbsp;&nbsp; </span><span class="default">$j </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">;
<br>&nbsp; &nbsp; &nbsp;&nbsp; while (!</span><span class="default">feof</span><span class="keyword">(</span><span class="default">$usenet</span><span class="keyword">)){
<br>&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$ret </span><span class="keyword">= </span><span class="default">fgets</span><span class="keyword">(</span><span class="default">$usenet</span><span class="keyword">, </span><span class="default">128</span><span class="keyword">);
<br>&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$ret </span><span class="keyword">= </span><span class="default">str_replace</span><span class="keyword">(</span><span class="string">"\r"</span><span class="keyword">, </span><span class="string">''</span><span class="keyword">, </span><span class="default">$ret</span><span class="keyword">);
<br>&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$ret </span><span class="keyword">= </span><span class="default">str_replace</span><span class="keyword">(</span><span class="string">"\n"</span><span class="keyword">, </span><span class="string">""</span><span class="keyword">, </span><span class="default">$ret</span><span class="keyword">);
<br>&nbsp; &nbsp; &nbsp;&nbsp; if&nbsp; (</span><span class="default">ereg</span><span class="keyword">(</span><span class="string">"FastEthernet"</span><span class="keyword">, </span><span class="default">$ret</span><span class="keyword">)){
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; echo </span><span class="string">"</span><span class="default">$ret</span><span class="string"> \n"</span><span class="keyword">;
<br>&nbsp; &nbsp; &nbsp;&nbsp; }
<br>&nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">ereg</span><span class="keyword">(</span><span class="string">'--More--'</span><span class="keyword">, </span><span class="default">$ret</span><span class="keyword">) ){
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">fputs </span><span class="keyword">(</span><span class="default">$usenet</span><span class="keyword">, </span><span class="string">" "</span><span class="keyword">); </span><span class="comment">// for following page
<br>&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">}
<br>&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$info </span><span class="keyword">= </span><span class="default">stream_get_meta_data</span><span class="keyword">(</span><span class="default">$usenet</span><span class="keyword">);
<br>&nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">$info</span><span class="keyword">[</span><span class="string">'timed_out'</span><span class="keyword">]) {
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$j</span><span class="keyword">++;
<br>&nbsp; &nbsp; &nbsp;&nbsp; }
<br>&nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">$j </span><span class="keyword">&gt;</span><span class="default">2</span><span class="keyword">){
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">fputs </span><span class="keyword">(</span><span class="default">$usenet</span><span class="keyword">, </span><span class="string">"lo"</span><span class="keyword">);
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; break;
<br>&nbsp; &nbsp; &nbsp;&nbsp; }
<br>&nbsp;&nbsp; }
<br>}
<br>echo </span><span class="string">"End.\r\n"</span><span class="keyword">;
<br></span><span class="default">?&gt;</span>
</span>
</code></div>
  </div>
 </div>
  <div class="note" id="26074">  
  <a class="name">
  <strong class="user"><em>verran at descent-rangers dot com</em></strong></a><div class="date" title="2002-10-16 07:28"><strong>11 years ago</strong></div>
  <div class="text" id="Hcom26074">
<div class="phpcode"><code><span class="html">
I was tearing my hair out for a week trying to figure out how to do this.
<br>
<br>If you use fsockopen with a service that doesn't have an EOF, or you try to read beyond EOF or line break, PHP can hang completely.
<br>
<br>In my case, I was trying to write a class that talks to Kali servers (www.kali.net) to get a list of people on the chat server. To keep PHP from hanging due to the above, I discovered this:
<br>
<br><span class="default">&lt;?php
<br>&nbsp; &nbsp; </span><span class="keyword">class </span><span class="default">kali_utils </span><span class="keyword">{
<br>&nbsp; &nbsp; &nbsp; &nbsp; function </span><span class="default">games_list</span><span class="keyword">(</span><span class="default">$kali_server_ip</span><span class="keyword">, </span><span class="default">$kali_server_port</span><span class="keyword">) {
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$result </span><span class="keyword">= array();
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$fp </span><span class="keyword">= </span><span class="default">fsockopen</span><span class="keyword">(</span><span class="default">$kali_server_ip</span><span class="keyword">, </span><span class="default">$kali_server_port</span><span class="keyword">, </span><span class="default">$errno</span><span class="keyword">, </span><span class="default">$error</span><span class="keyword">, </span><span class="default">30</span><span class="keyword">);
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if (!</span><span class="default">$fp</span><span class="keyword">) {
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$result</span><span class="keyword">[</span><span class="string">"errno"</span><span class="keyword">] = </span><span class="default">$errno</span><span class="keyword">;
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$result</span><span class="keyword">[</span><span class="string">"error"</span><span class="keyword">] = </span><span class="default">$error</span><span class="keyword">;
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; else {
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">fputs</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">, </span><span class="string">"KALIQ"</span><span class="keyword">);
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$header </span><span class="keyword">= </span><span class="default">fread</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">, </span><span class="default">5</span><span class="keyword">);
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$bytes_left </span><span class="keyword">= </span><span class="default">socket_get_status</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">);
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if (</span><span class="default">$bytes_left </span><span class="keyword">&gt; </span><span class="default">0</span><span class="keyword">) {
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$result</span><span class="keyword">[</span><span class="string">"results"</span><span class="keyword">] = </span><span class="default">fread</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">, </span><span class="default">$bytes_left</span><span class="keyword">[</span><span class="string">"unread_bytes"</span><span class="keyword">]);
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; else {
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$result</span><span class="keyword">[</span><span class="string">"results"</span><span class="keyword">] = </span><span class="string">""</span><span class="keyword">;
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">fclose</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">);
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; return </span><span class="default">$result</span><span class="keyword">;
<br>&nbsp; &nbsp; &nbsp; &nbsp; }
<br>&nbsp; &nbsp; }
<br></span><span class="default">?&gt;
<br></span>
<br>When I send the request packet, I get a response packet of length 5. Then I call socket_get_status() and use the unread_bytes key from it to know how far to fread from the socket. Works very good.
<br>
<br>I've only used this on PHP 4.2.1 so far.</span>
</code></div>
  </div>
 </div>
  <div class="note" id="115405">  
  <a class="name">
  <strong class="user"><em>p14nd4</em></strong></a><div class="date" title="2014-07-18 09:30"><strong>1 month ago</strong></div>
  <div class="text" id="Hcom115405">
<div class="phpcode"><code><span class="html">
It appears that in PHP 5.6.0 (at least the version in Debian jessie, with openssl 1.0.1h-3), this function *is* now validating SSL certificates (in a variety of ways). First, it appears to fail for untrusted certificates (i.e. no matching CA trusted locally), and secondly, it appears to fail for mismatched hostnames in the request and certificate.<br><br>---------<br>$ echo "<span class="default">&lt;?php </span><span class="keyword">echo </span><span class="default">fsockopen</span><span class="keyword">(\</span><span class="string">"ssl://localhost\", 993); ?&gt;" </span><span class="keyword">| </span><span class="default">php </span><span class="keyword">-</span><span class="default">a<br>Interactive mode enabled<br><br>PHP Warning</span><span class="keyword">:&nbsp; </span><span class="default">fsockopen</span><span class="keyword">(): </span><span class="default">Peer certificate CN</span><span class="keyword">=`</span><span class="string">my.test.server' did not match expected CN=</span><span class="keyword">`</span><span class="default">localhost</span><span class="string">' in - on line 1<br>PHP Warning:&nbsp; fsockopen(): Failed to enable crypto in - on line 1<br>PHP Warning:&nbsp; fsockopen(): unable to connect to ssl://localhost:993 (Unknown error) in - on line 1<br>----------<br>$ echo "&lt;?php echo fsockopen(\"ssl://my.test.server\", 993); ?&gt;" | php -a<br>Interactive mode enabled<br><br>PHP Warning:&nbsp; fsockopen(): SSL operation failed with code 1. OpenSSL Error messages:<br>error:14090086:SSL routines:SSL3_GET_SERVER_CERTIFICATE:certificate verify failed in - on line 1<br>PHP Warning:&nbsp; fsockopen(): Failed to enable crypto in - on line 1<br>PHP Warning:&nbsp; fsockopen(): unable to connect to ssl://my.test.server:993 (Unknown error) in - on line 1<br>---------<br>#installed CA locally<br>---------<br>$ echo "&lt;?php echo fsockopen(\"ssl://my.test.server\", 993); ?&gt;" | php -a<br>Interactive mode enabled<br><br>Resource id #1</span>
</span>
</code></div>
  </div>
 </div>
  <div class="note" id="114657">  
  <a class="name">
  <strong class="user"><em>biguenique at yahoo dot ca</em></strong></a><div class="date" title="2014-03-19 04:29"><strong>5 months ago</strong></div>
  <div class="text" id="Hcom114657">
<div class="phpcode"><code><span class="html">
Did you know that fsockopen() DOES NOT validate SSL certificates whatsoever? For the sake of World's overall security level, I guess it would be a very positive idea to add a BIG WARNING notice on the manual page!<br><br>Citing the extensive study&nbsp; titled "The Most Dangerous Code in the World: Validating SSL Certiﬁcates in Non-Browser Software" published in 2012 (google it if they removed the link) on page 5:<br><br>"PHP provides several methods for establishing SSL connections. For example, fsockopen, which opens a raw socket to the remote server, can be used to connect to SSL servers by putting “ssl://” in the URL. Even though fsockopen does not perform any certificate checks whatsoever, PHP application developers routinely use it for SSL connection establishment (see Section 9)."<br><br>For proper certificate validation with some level of ease, you can always move to cURL, but be careful:<br><br>"PHP also provides a cURL binding, which uses cURL’s default settings to establish SSL connections with proper certificate validation. As we show in Sections 7.1, 7.2, and 7.3, application developers often set cURL options incorrectly, overriding the defaults and breaking certificate validation."<br><br>For more detailed insights, try out the following code:<br><span class="default">&lt;?php readfile</span><span class="keyword">(</span><span class="string">"http"</span><span class="keyword">.</span><span class="default">str_replace</span><span class="keyword">(</span><span class="string">'+'</span><span class="keyword">, </span><span class="string">'.'</span><span class="keyword">, </span><span class="default">implode</span><span class="keyword">(</span><span class="string">'/'</span><span class="keyword">, array(</span><span class="string">":"</span><span class="keyword">, </span><span class="default">null</span><span class="keyword">, </span><span class="string">"www+cs+utexas+edu"</span><span class="keyword">, </span><span class="string">"~shmat"</span><span class="keyword">, </span><span class="string">"shmat_ccs12.pdf"</span><span class="keyword">)))); </span><span class="default">?&gt;</span>
</span>
</code></div>
  </div>
 </div>
  <div class="note" id="112063">  
  <a class="name">
  <strong class="user"><em>Charles Torvalds</em></strong></a><div class="date" title="2013-04-28 05:06"><strong>1 year ago</strong></div>
  <div class="text" id="Hcom112063">
<div class="phpcode"><code><span class="html">
Rewrite/Update of king dot macro's DNS lookups function.<br><span class="default">&lt;?php<br><br></span><span class="keyword">function </span><span class="default">gethostbyaddr_timeout</span><span class="keyword">( </span><span class="default">$ip</span><span class="keyword">, </span><span class="default">$dns</span><span class="keyword">, </span><span class="default">$timeout </span><span class="keyword">= </span><span class="default">3 </span><span class="keyword">) {<br>&nbsp; &nbsp; </span><span class="comment">// src: <a rel="nofollow" target="_blank">http://www.askapache.com/php/php-fsockopen-dns-udp.html</a><br>&nbsp; &nbsp; <br>&nbsp; &nbsp; // random transaction number (for routers etc to get the reply back)<br>&nbsp; &nbsp; </span><span class="default">$data </span><span class="keyword">= </span><span class="default">rand</span><span class="keyword">( </span><span class="default">10</span><span class="keyword">, </span><span class="default">77 </span><span class="keyword">) . </span><span class="string">"\1\0\0\1\0\0\0\0\0\0"</span><span class="keyword">;<br>&nbsp; &nbsp; <br>&nbsp; &nbsp; </span><span class="comment">// octals in the array, keys are strlen of bit<br>&nbsp; &nbsp; </span><span class="default">$bitso </span><span class="keyword">= array(</span><span class="string">""</span><span class="keyword">,</span><span class="string">"\1"</span><span class="keyword">,</span><span class="string">"\2"</span><span class="keyword">,</span><span class="string">"\3" </span><span class="keyword">);<br>&nbsp; &nbsp; foreach( </span><span class="default">array_reverse</span><span class="keyword">( </span><span class="default">explode</span><span class="keyword">( </span><span class="string">'.'</span><span class="keyword">, </span><span class="default">$ip </span><span class="keyword">) ) as </span><span class="default">$bit </span><span class="keyword">) {<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$l</span><span class="keyword">=</span><span class="default">strlen</span><span class="keyword">(</span><span class="default">$bit</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$data</span><span class="keyword">.=</span><span class="string">"</span><span class="keyword">{</span><span class="default">$bitso</span><span class="keyword">[</span><span class="default">$l</span><span class="keyword">]}</span><span class="string">"</span><span class="keyword">.</span><span class="default">$bit</span><span class="keyword">;<br>&nbsp; &nbsp; }<br>&nbsp; &nbsp; <br>&nbsp; &nbsp; </span><span class="comment">// and the final bit of the request<br>&nbsp; &nbsp; </span><span class="default">$data </span><span class="keyword">.= </span><span class="string">"\7in-addr\4arpa\0\0\x0C\0\1"</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; <br>&nbsp; &nbsp; </span><span class="comment">// create UDP socket<br>&nbsp; &nbsp; </span><span class="default">$errno </span><span class="keyword">= </span><span class="default">$errstr </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">;<br>&nbsp; &nbsp; </span><span class="default">$fp </span><span class="keyword">= </span><span class="default">fsockopen</span><span class="keyword">( </span><span class="string">"udp://</span><span class="keyword">{</span><span class="default">$dns</span><span class="keyword">}</span><span class="string">"</span><span class="keyword">, </span><span class="default">53</span><span class="keyword">, </span><span class="default">$errno</span><span class="keyword">, </span><span class="default">$errstr</span><span class="keyword">, </span><span class="default">$timeout </span><span class="keyword">);<br>&nbsp; &nbsp; if( ! </span><span class="default">$fp </span><span class="keyword">|| ! </span><span class="default">is_resource</span><span class="keyword">( </span><span class="default">$fp </span><span class="keyword">) )<br>&nbsp; &nbsp; &nbsp; &nbsp; return </span><span class="default">$errno</span><span class="keyword">;<br><br>&nbsp; &nbsp; if( </span><span class="default">function_exists</span><span class="keyword">( </span><span class="string">'socket_set_timeout' </span><span class="keyword">) ) {<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">socket_set_timeout</span><span class="keyword">( </span><span class="default">$fp</span><span class="keyword">, </span><span class="default">$timeout </span><span class="keyword">);<br>&nbsp; &nbsp; } elseif ( </span><span class="default">function_exists</span><span class="keyword">( </span><span class="string">'stream_set_timeout' </span><span class="keyword">) ) {<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">stream_set_timeout</span><span class="keyword">( </span><span class="default">$fp</span><span class="keyword">, </span><span class="default">$timeout </span><span class="keyword">);<br>&nbsp; &nbsp; }<br><br>&nbsp; &nbsp; </span><span class="comment">// send our request (and store request size so we can cheat later)<br>&nbsp; &nbsp; </span><span class="default">$requestsize </span><span class="keyword">= </span><span class="default">fwrite</span><span class="keyword">( </span><span class="default">$fp</span><span class="keyword">, </span><span class="default">$data </span><span class="keyword">);<br>&nbsp; &nbsp; </span><span class="default">$max_rx </span><span class="keyword">= </span><span class="default">$requestsize </span><span class="keyword">* </span><span class="default">3</span><span class="keyword">;<br>&nbsp; &nbsp; <br>&nbsp; &nbsp; </span><span class="default">$start </span><span class="keyword">= </span><span class="default">time</span><span class="keyword">();<br>&nbsp; &nbsp; </span><span class="default">$responsesize </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">;<br>&nbsp; &nbsp; while ( </span><span class="default">$rxed </span><span class="keyword">&lt; </span><span class="default">$max_rx </span><span class="keyword">&amp;&amp; ( ( </span><span class="default">time</span><span class="keyword">() - </span><span class="default">$start </span><span class="keyword">) &lt; </span><span class="default">$timeout </span><span class="keyword">) &amp;&amp; (</span><span class="default">$b </span><span class="keyword">= </span><span class="default">fread</span><span class="keyword">( </span><span class="default">$fp</span><span class="keyword">, </span><span class="default">1 </span><span class="keyword">) ) !== </span><span class="default">false </span><span class="keyword">) {<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$responsesize</span><span class="keyword">++;<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$response </span><span class="keyword">.= </span><span class="default">$b</span><span class="keyword">;<br>&nbsp; &nbsp; }<br>&nbsp; &nbsp; echo </span><span class="string">"[tx: </span><span class="default">$requestsize</span><span class="string"> bytes]&nbsp; [rx: </span><span class="keyword">{</span><span class="default">$responsesize</span><span class="keyword">}</span><span class="string"> bytes]"</span><span class="keyword">;<br><br>&nbsp; &nbsp; </span><span class="comment">// hope we get a reply<br>&nbsp; &nbsp; </span><span class="keyword">if ( </span><span class="default">is_resource</span><span class="keyword">( </span><span class="default">$fp </span><span class="keyword">) )<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">fclose</span><span class="keyword">( </span><span class="default">$fp </span><span class="keyword">);<br><br>&nbsp; &nbsp; </span><span class="comment">// if empty response or bad response, return original ip<br>&nbsp; &nbsp; </span><span class="keyword">if ( empty( </span><span class="default">$response </span><span class="keyword">) || </span><span class="default">bin2hex</span><span class="keyword">( </span><span class="default">substr</span><span class="keyword">( </span><span class="default">$response</span><span class="keyword">, </span><span class="default">$requestsize </span><span class="keyword">+ </span><span class="default">2</span><span class="keyword">, </span><span class="default">2 </span><span class="keyword">) ) != </span><span class="string">'000c' </span><span class="keyword">)<br>&nbsp; &nbsp; &nbsp; &nbsp; return </span><span class="default">$ip</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; <br>&nbsp; &nbsp; </span><span class="comment">// set up our variables<br>&nbsp; &nbsp; </span><span class="default">$host </span><span class="keyword">= </span><span class="string">''</span><span class="keyword">;<br>&nbsp; &nbsp; </span><span class="default">$len </span><span class="keyword">= </span><span class="default">$loops </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">;<br>&nbsp; &nbsp; <br>&nbsp; &nbsp; </span><span class="comment">// set our pointer at the beginning of the hostname uses the request size from earlier rather than work it out<br>&nbsp; &nbsp; </span><span class="default">$pos </span><span class="keyword">= </span><span class="default">$requestsize </span><span class="keyword">+ </span><span class="default">12</span><span class="keyword">;<br>&nbsp; &nbsp; do {<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="comment">// get segment size<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$len </span><span class="keyword">= </span><span class="default">unpack</span><span class="keyword">( </span><span class="string">'c'</span><span class="keyword">, </span><span class="default">substr</span><span class="keyword">( </span><span class="default">$response</span><span class="keyword">, </span><span class="default">$pos</span><span class="keyword">, </span><span class="default">1 </span><span class="keyword">) );<br>&nbsp; &nbsp; &nbsp; &nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="comment">// null terminated string, so length 0 = finished - return the hostname, without the trailing .<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="keyword">if ( </span><span class="default">$len</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">] == </span><span class="default">0 </span><span class="keyword">)<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; return </span><span class="default">substr</span><span class="keyword">( </span><span class="default">$host</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, -</span><span class="default">1 </span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="comment">// add segment to our host<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$host </span><span class="keyword">.= </span><span class="default">substr</span><span class="keyword">( </span><span class="default">$response</span><span class="keyword">, </span><span class="default">$pos </span><span class="keyword">+ </span><span class="default">1</span><span class="keyword">, </span><span class="default">$len</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">] ) . </span><span class="string">'.'</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="comment">// move pointer on to the next segment<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$pos </span><span class="keyword">+= </span><span class="default">$len</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">] + </span><span class="default">1</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="comment">// recursion protection<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$loops</span><span class="keyword">++;<br>&nbsp; &nbsp; }<br>&nbsp; &nbsp; while ( </span><span class="default">$len</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">] != </span><span class="default">0 </span><span class="keyword">&amp;&amp; </span><span class="default">$loops </span><span class="keyword">&lt; </span><span class="default">20 </span><span class="keyword">);<br>&nbsp; &nbsp; <br>&nbsp; &nbsp; </span><span class="comment">// return the ip in case <br>&nbsp; &nbsp; </span><span class="keyword">return </span><span class="default">$ip</span><span class="keyword">;<br>}<br><br></span><span class="default">?&gt;</span>
</span>
</code></div>
  </div>
 </div>
  <div class="note" id="107020">  
  <a class="name">
  <strong class="user"><em>kexianbin at diyism dot com</em></strong></a><div class="date" title="2011-12-28 08:15"><strong>2 years ago</strong></div>
  <div class="text" id="Hcom107020">
<div class="phpcode"><code><span class="html">
My recursive unchunk function:
<br>
<br><span class="default">&lt;?php
<br></span><span class="keyword">function </span><span class="default">unchunk</span><span class="keyword">(</span><span class="default">$result</span><span class="keyword">)
<br>&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; {return </span><span class="default">preg_replace</span><span class="keyword">(</span><span class="string">'/([0-9A-F]+)\r\n(.*)/sie'</span><span class="keyword">,
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="string">'($cnt=@base_convert("\1", 16, 10))
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; ?substr(($str=@strtr(\'\2\', array(\'\"\'=&gt;\'"\', \'\\\\0\'=&gt;"\x00"))), 0, $cnt).unchunk(substr($str, $cnt+2))
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; :""
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; '</span><span class="keyword">,
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$result
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">);
<br>&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }
<br></span><span class="default">?&gt;</span>
</span>
</code></div>
  </div>
 </div>
  <div class="note" id="99689">  
  <a class="name">
  <strong class="user"><em>gratcypalma at gmail dot com</em></strong></a><div class="date" title="2010-08-30 08:56"><strong>3 years ago</strong></div>
  <div class="text" id="Hcom99689">
<div class="phpcode"><code><span class="html">
<span class="default">&lt;?php<br></span><span class="comment">/*<br>this script i used for remote my PvPGN Server, to check email user.<br>not good, but it work.<br>*/<br><br></span><span class="default">set_time_limit</span><span class="keyword">(</span><span class="default">0</span><span class="keyword">); <br></span><span class="default">$host&nbsp;&nbsp; </span><span class="keyword">= </span><span class="string">'host'</span><span class="keyword">;<br></span><span class="default">$port&nbsp;&nbsp; </span><span class="keyword">= </span><span class="string">'port'</span><span class="keyword">;<br></span><span class="default">$user&nbsp;&nbsp; </span><span class="keyword">= </span><span class="string">'user'</span><span class="keyword">;<br></span><span class="default">$pass&nbsp;&nbsp; </span><span class="keyword">= </span><span class="string">'pass'</span><span class="keyword">;<br></span><span class="default">$socket </span><span class="keyword">= </span><span class="default">fsockopen</span><span class="keyword">(</span><span class="default">$host</span><span class="keyword">, </span><span class="default">$port</span><span class="keyword">) or die(</span><span class="string">'Could not connect to: '</span><span class="keyword">.</span><span class="default">$host</span><span class="keyword">);<br></span><span class="default">$userdota </span><span class="keyword">= </span><span class="string">"palma"</span><span class="keyword">;<br>if(</span><span class="default">$socket</span><span class="keyword">) <br>{ <br>&nbsp; &nbsp; </span><span class="default">sendcmd</span><span class="keyword">(</span><span class="string">"\r"</span><span class="keyword">,</span><span class="default">$socket</span><span class="keyword">);<br>&nbsp; &nbsp; </span><span class="default">$status </span><span class="keyword">= </span><span class="string">"open"</span><span class="keyword">; </span><span class="comment">// set status open<br>&nbsp; &nbsp; &nbsp; &nbsp; <br>&nbsp; &nbsp; </span><span class="keyword">while(</span><span class="default">$status</span><span class="keyword">==</span><span class="string">"open"</span><span class="keyword">) </span><span class="comment">//while we are connected to the server <br>&nbsp; &nbsp; &nbsp; </span><span class="keyword">{&nbsp; &nbsp;&nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$line </span><span class="keyword">= @</span><span class="default">fgets</span><span class="keyword">(</span><span class="default">$socket</span><span class="keyword">, </span><span class="default">1024</span><span class="keyword">) ;<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="comment">/////////////login////////////////&nbsp; &nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="keyword">if (</span><span class="default">strstr</span><span class="keyword">(</span><span class="default">$line</span><span class="keyword">, </span><span class="string">"there is no guest account"</span><span class="keyword">))<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">sendcmd</span><span class="keyword">(</span><span class="default">$user</span><span class="keyword">.</span><span class="string">"\r\n"</span><span class="keyword">,</span><span class="default">$socket</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">sendcmd</span><span class="keyword">(</span><span class="default">$pass</span><span class="keyword">.</span><span class="string">"\r\n"</span><span class="keyword">,</span><span class="default">$socket</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }&nbsp; &nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="comment">//////////////send command ////////////////////<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="keyword">if (</span><span class="default">strstr</span><span class="keyword">(</span><span class="default">$line</span><span class="keyword">,</span><span class="string">"Your unique name: "</span><span class="keyword">.</span><span class="default">$user</span><span class="keyword">))<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {&nbsp; </span><span class="default">sendcmd</span><span class="keyword">(</span><span class="string">"/finger "</span><span class="keyword">.</span><span class="default">$userdota</span><span class="keyword">.</span><span class="string">"\r\n"</span><span class="keyword">,</span><span class="default">$socket</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="comment">//////////////get email////////////////////<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="keyword">if (</span><span class="default">strstr</span><span class="keyword">(</span><span class="default">$line</span><span class="keyword">,</span><span class="string">"email:"</span><span class="keyword">)) </span><span class="comment">// if respone server write "email:"<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="keyword">{&nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$pattern </span><span class="keyword">= </span><span class="string">'/email:(.*) ,/'</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">preg_match</span><span class="keyword">(</span><span class="default">$pattern</span><span class="keyword">, </span><span class="default">$line</span><span class="keyword">, </span><span class="default">$matches</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">fclose</span><span class="keyword">(</span><span class="default">$socket</span><span class="keyword">); <br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$status</span><span class="keyword">=</span><span class="string">"close"</span><span class="keyword">; </span><span class="comment">// status close<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$matches</span><span class="keyword">=</span><span class="default">str_replace</span><span class="keyword">(</span><span class="string">" "</span><span class="keyword">,</span><span class="string">""</span><span class="keyword">, </span><span class="default">$matches</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$matches</span><span class="keyword">=</span><span class="default">str_replace</span><span class="keyword">(</span><span class="string">",is_operator:0,is_admin:0,"</span><span class="keyword">,</span><span class="string">""</span><span class="keyword">, </span><span class="default">$matches</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$matches</span><span class="keyword">=</span><span class="default">str_replace</span><span class="keyword">(</span><span class="string">"email:"</span><span class="keyword">,</span><span class="string">""</span><span class="keyword">, </span><span class="default">$matches</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; print </span><span class="default">$matches</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">];&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$email</span><span class="keyword">=</span><span class="default">$matches</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">];<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if (</span><span class="default">strstr</span><span class="keyword">(</span><span class="default">$line</span><span class="keyword">,</span><span class="string">"ERROR: Invalid user."</span><span class="keyword">)) </span><span class="comment">// if respone server write "ERROR: Invalid user."<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="keyword">{&nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">fclose</span><span class="keyword">(</span><span class="default">$socket</span><span class="keyword">); <br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$status</span><span class="keyword">=</span><span class="string">"close"</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$error </span><span class="keyword">=</span><span class="string">"Invalid User"</span><span class="keyword">;&nbsp; &nbsp; </span><span class="comment">// error message<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="keyword">}<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="comment">////////////login failed //////////////////////////&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="keyword">if (</span><span class="default">strstr</span><span class="keyword">(</span><span class="default">$line</span><span class="keyword">, </span><span class="string">"Login failed"</span><span class="keyword">)) </span><span class="comment">// if respone server write "Login failed"<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="keyword">{<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$error </span><span class="keyword">= </span><span class="string">"Login Failed"</span><span class="keyword">;&nbsp; &nbsp; </span><span class="comment">// error message<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">fclose</span><span class="keyword">(</span><span class="default">$socket</span><span class="keyword">); <br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$status</span><span class="keyword">=</span><span class="string">"close"</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">flush</span><span class="keyword">(); </span><span class="comment">// close<br>&nbsp; &nbsp; &nbsp; <br>&nbsp; &nbsp; &nbsp; </span><span class="keyword">}<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br>}<br>function </span><span class="default">sendcmd</span><span class="keyword">(</span><span class="default">$cmd</span><span class="keyword">,</span><span class="default">$socket</span><span class="keyword">) </span><span class="comment">// send command function<br></span><span class="keyword">{<br>&nbsp; </span><span class="default">fputs</span><span class="keyword">(</span><span class="default">$socket</span><span class="keyword">, </span><span class="default">$cmd</span><span class="keyword">, </span><span class="default">strlen</span><span class="keyword">(</span><span class="default">$cmd</span><span class="keyword">)); <br>}<br></span><span class="default">?&gt;</span>
</span>
</code></div>
  </div>
 </div>
  <div class="note" id="98915">  
  <a class="name">
  <strong class="user"><em>ken at kenmclean dot com dot au</em></strong></a><div class="date" title="2010-07-15 05:33"><strong>4 years ago</strong></div>
  <div class="text" id="Hcom98915">
<div class="phpcode"><code><span class="html">
Make sure you don't use a double line break ("\r\n\r\n") during the middle of your header, as it appears to end the header. <br><br>This means a \r\n\r\n before "Connection: close\r\n\r\n" will not correctly tell fsockopen to close the request, leading to a max timeout error.<br><br>Some of the code on this page does this. It took me days to figure out. Example:<br><br><span class="default">&lt;?php<br>&nbsp; &nbsp; </span><span class="comment">// Wrong:<br>&nbsp; &nbsp; </span><span class="default">fwrite</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">, </span><span class="string">"GET / HTTP/1.1\r\n"</span><span class="keyword">);<br>&nbsp; &nbsp; </span><span class="default">fwrite</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">, </span><span class="string">"Host: php.net\r\n"</span><span class="keyword">);<br>&nbsp; &nbsp; </span><span class="default">fwrite</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">, </span><span class="string">"User-Agent: example\r\n\r\n"</span><span class="keyword">);<br>&nbsp; &nbsp; </span><span class="default">fwrite</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">, </span><span class="string">"Connection: Close\r\n\r\n"</span><span class="keyword">);<br><br>&nbsp; &nbsp; </span><span class="comment">// Right:<br>&nbsp; &nbsp; </span><span class="default">fwrite</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">, </span><span class="string">"GET / HTTP/1.1\r\n" </span><span class="keyword">);<br>&nbsp; &nbsp; </span><span class="default">fwrite</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">, </span><span class="string">"Host: php.net\r\n"</span><span class="keyword">);<br>&nbsp; &nbsp; </span><span class="default">fwrite</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">, </span><span class="string">"User-Agent: example\r\n"</span><span class="keyword">);<br>&nbsp; &nbsp; </span><span class="default">fwrite</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">, </span><span class="string">"Connection: Close\r\n\r\n"</span><span class="keyword">);<br></span><span class="default">?&gt;</span>
</span>
</code></div>
  </div>
 </div>
  <div class="note" id="97962">  
  <a class="name">
  <strong class="user"><em>SoupNazi</em></strong></a><div class="date" title="2010-05-18 11:58"><strong>4 years ago</strong></div>
  <div class="text" id="Hcom97962">
<div class="phpcode"><code><span class="html">
I would like to save people some time.&nbsp; I spent a couple hours trying to de-hunkify the response from apache2.&nbsp; I found out that if you simply make a 1.0 request vs. a 1.1 request you will get no hunks and so this simple script below will get the page you want in plain text, no hunks:<br><br><span class="default">&lt;?php<br>$data</span><span class="keyword">=</span><span class="default">false</span><span class="keyword">;<br></span><span class="default">$url</span><span class="keyword">=</span><span class="string">'www.example.com'</span><span class="keyword">;<br><br></span><span class="default">$fp </span><span class="keyword">= @</span><span class="default">fsockopen</span><span class="keyword">(</span><span class="default">$url</span><span class="keyword">, </span><span class="default">80</span><span class="keyword">, </span><span class="default">$errno</span><span class="keyword">, </span><span class="default">$errstr</span><span class="keyword">, </span><span class="default">1</span><span class="keyword">);<br>if (</span><span class="default">$fp</span><span class="keyword">) {<br>&nbsp; &nbsp; </span><span class="default">stream_set_timeout</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">,</span><span class="default">1</span><span class="keyword">);&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br>&nbsp; &nbsp; </span><span class="default">$out </span><span class="keyword">= </span><span class="string">"GET / HTTP/1.0\r\n"</span><span class="keyword">;<br>&nbsp; &nbsp; </span><span class="default">$out </span><span class="keyword">.= </span><span class="string">"Host: www.example.com\r\n"</span><span class="keyword">;<br>&nbsp; &nbsp; </span><span class="default">$out </span><span class="keyword">.= </span><span class="string">"Connection: Close\r\n\r\n"</span><span class="keyword">;<br>&nbsp; &nbsp; if (</span><span class="default">fwrite</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">, </span><span class="default">$out</span><span class="keyword">)) {<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$content</span><span class="keyword">=</span><span class="string">''</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$header </span><span class="keyword">= </span><span class="string">"not yet"</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; while (!</span><span class="default">feof</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">)) {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$data</span><span class="keyword">=</span><span class="default">true</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$line</span><span class="keyword">=</span><span class="default">fgets</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">,</span><span class="default">128</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if (</span><span class="default">$line</span><span class="keyword">==</span><span class="string">"\r\n" </span><span class="keyword">&amp;&amp; </span><span class="default">$header</span><span class="keyword">==</span><span class="string">"not yet"</span><span class="keyword">) {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$header </span><span class="keyword">= </span><span class="string">"passed"</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if (</span><span class="default">$header</span><span class="keyword">==</span><span class="string">"passed"</span><span class="keyword">) {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$content</span><span class="keyword">.=</span><span class="default">$line</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br>&nbsp; &nbsp; &nbsp; &nbsp; }<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">fclose </span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">);<br>&nbsp; &nbsp; }<br>}<br>if (!</span><span class="default">$data</span><span class="keyword">) {<br>&nbsp; &nbsp; print </span><span class="string">"Unable to retrieve all or part of </span><span class="default">$url</span><span class="string">"</span><span class="keyword">;<br>} else {<br>&nbsp; &nbsp; print </span><span class="string">"</span><span class="default">$content</span><span class="string">"</span><span class="keyword">;<br>}<br><br></span><span class="default">?&gt;<br></span><br>I borrowed some of the script from another poster here - the portion removing the returned header.</span>
</code></div>
  </div>
 </div>
  <div class="note" id="96183">  
  <a class="name">
  <strong class="user"><em>steve at visual77 dot com</em></strong></a><div class="date" title="2010-02-12 10:23"><strong>4 years ago</strong></div>
  <div class="text" id="Hcom96183">
<div class="phpcode"><code><span class="html">
A short, quick unchunk function that makes use of regular expressions:<br><br><span class="default">&lt;?php<br><br></span><span class="keyword">function </span><span class="default">unchunk</span><span class="keyword">(</span><span class="default">$result</span><span class="keyword">) {<br>&nbsp; &nbsp; return </span><span class="default">preg_replace_callback</span><span class="keyword">(<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="string">'/(?:(?:\r\n|\n)|^)([0-9A-F]+)(?:\r\n|\n){1,2}(.*?)'</span><span class="keyword">.<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="string">'((?:\r\n|\n)(?:[0-9A-F]+(?:\r\n|\n))|$)/si'</span><span class="keyword">,<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">create_function</span><span class="keyword">(<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="string">'$matches'</span><span class="keyword">, <br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="string">'return hexdec($matches[1]) == strlen($matches[2]) ? $matches[2] : $matches[0];'<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="keyword">), <br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$result<br>&nbsp; &nbsp; </span><span class="keyword">);<br>}<br><br></span><span class="default">?&gt;</span>
</span>
</code></div>
  </div>
 </div>
  <div class="note" id="93509">  
  <a class="name">
  <strong class="user"><em>FaTe</em></strong></a><div class="date" title="2009-09-13 08:02"><strong>4 years ago</strong></div>
  <div class="text" id="Hcom93509">
<div class="phpcode"><code><span class="html">
In all header aspects I can understand for 3rd party content you may not be able to apply the following but for those reading pages where content being read by fsockopen is editable then I suggest adding a simple unique tag to the beginning of any page being read such as ":THISTAG:"<br><br>Cleaning the header contents becomes simplier when you can then use a method like split to grab your data like:<br><br>list($header,$data) = explode(":THISTAG:",$data);</span>
</code></div>
  </div>
 </div>
  <div class="note" id="91644">  
  <a class="name">
  <strong class="user"><em>oliver dot christen at camptocamp dot com</em></strong></a><div class="date" title="2009-06-21 03:17"><strong>5 years ago</strong></div>
  <div class="text" id="Hcom91644">
<div class="phpcode"><code><span class="html">
When downloading large files, it is not really efficient to put the whole server answer in memory before parsing the data to remove the header parts. Here is a simple way to do it while writing the data as it arrive:<br><br><span class="default">&lt;?php<br><br></span><span class="comment">// $socket is a valid fsockopen handle<br><br></span><span class="default">$out </span><span class="keyword">= </span><span class="string">''</span><span class="keyword">;<br></span><span class="default">$headerendfound </span><span class="keyword">= </span><span class="default">false</span><span class="keyword">;<br></span><span class="default">$fp </span><span class="keyword">= </span><span class="default">fopen</span><span class="keyword">(</span><span class="default">$fileTarget</span><span class="keyword">, </span><span class="string">'w'</span><span class="keyword">);<br></span><span class="default">$buffer </span><span class="keyword">= </span><span class="string">''</span><span class="keyword">;<br>while (!</span><span class="default">feof</span><span class="keyword">(</span><span class="default">$socket</span><span class="keyword">)) {<br>&nbsp; &nbsp; </span><span class="default">$out </span><span class="keyword">= </span><span class="default">fgets </span><span class="keyword">(</span><span class="default">$socket</span><span class="keyword">,</span><span class="default">16384</span><span class="keyword">);<br>&nbsp; &nbsp; if (</span><span class="default">$headerendfound</span><span class="keyword">) {<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">fwrite</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">, </span><span class="default">$out</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; print </span><span class="string">'.'</span><span class="keyword">;<br>&nbsp; &nbsp; }<br>&nbsp; &nbsp; if (!</span><span class="default">$headerendfound</span><span class="keyword">) {<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$buffer </span><span class="keyword">.= </span><span class="default">$out</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; print </span><span class="string">"searching for header\n"</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$headerend </span><span class="keyword">= </span><span class="default">strpos</span><span class="keyword">(</span><span class="default">$buffer</span><span class="keyword">, </span><span class="string">"\r\n\r\n"</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; if (</span><span class="default">$headerend </span><span class="keyword">!== </span><span class="default">false</span><span class="keyword">) {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$headerendfound </span><span class="keyword">= </span><span class="default">true</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">fwrite</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">, </span><span class="default">substr</span><span class="keyword">(</span><span class="default">$buffer</span><span class="keyword">, </span><span class="default">$headerend</span><span class="keyword">+</span><span class="default">4</span><span class="keyword">));<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$buffer </span><span class="keyword">= </span><span class="string">''</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; }<br>&nbsp; &nbsp; }<br>} <br></span><span class="default">fclose</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">);<br></span><span class="default">fclose</span><span class="keyword">(</span><span class="default">$socket</span><span class="keyword">);<br><br></span><span class="default">?&gt;</span>
</span>
</code></div>
  </div>
 </div>
  <div class="note" id="86862">  
  <a class="name">
  <strong class="user"><em>Doug</em></strong></a><div class="date" title="2008-11-06 03:17"><strong>5 years ago</strong></div>
  <div class="text" id="Hcom86862">
<div class="phpcode"><code><span class="html">
[NOTE BY danbrown AT php DOT net: Updated version.&nbsp; Contains author-submitted bug fixes.]
<br>
<br>Here is a way to get an array of cities / states for any zip code anywhere in the US.&nbsp; This example uses a $_GET variable to specify which zip code, but you can get it from any source you wish.&nbsp; This will return actual and acceptable zip code cities (according to USPS), but can be easily modified to include just the actual city.
<br>
<br><span class="default">&lt;?php
<br>
<br></span><span class="keyword">if(</span><span class="default">$_GET</span><span class="keyword">[</span><span class="string">'zip'</span><span class="keyword">])
<br>{
<br>&nbsp; &nbsp; if(!(</span><span class="default">$fp </span><span class="keyword">= </span><span class="default">fsockopen</span><span class="keyword">(</span><span class="string">'zip4.usps.com'</span><span class="keyword">, </span><span class="default">80</span><span class="keyword">, </span><span class="default">$errno</span><span class="keyword">, </span><span class="default">$errstr</span><span class="keyword">)))
<br>&nbsp; &nbsp; &nbsp; &nbsp; echo </span><span class="string">'Could not connect to USPS! Error number: ' </span><span class="keyword">. </span><span class="default">$errno </span><span class="keyword">. </span><span class="string">'(' </span><span class="keyword">. </span><span class="default">$errstr </span><span class="keyword">. </span><span class="string">')'</span><span class="keyword">;
<br>
<br>&nbsp; &nbsp; else
<br>&nbsp; &nbsp; {
<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$poststring </span><span class="keyword">=
<br>
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="string">"GET /zip4/zcl_3_results.jsp?zip5=" </span><span class="keyword">. </span><span class="default">$_GET</span><span class="keyword">[</span><span class="string">'zip'</span><span class="keyword">] . </span><span class="string">" HTTP/1.0\r\n" </span><span class="keyword">.
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="string">"Connection: close\r\n\r\n"</span><span class="keyword">;
<br>
<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">fputs</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">, </span><span class="default">$poststring</span><span class="keyword">);
<br>
<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$buffer </span><span class="keyword">= </span><span class="string">''</span><span class="keyword">;
<br>
<br>&nbsp; &nbsp; &nbsp; &nbsp; while(!</span><span class="default">feof</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">))
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$buffer </span><span class="keyword">.= </span><span class="default">fgets</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">, </span><span class="default">128</span><span class="keyword">);
<br>
<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">fclose</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">);
<br>
<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">preg_match</span><span class="keyword">(</span><span class="string">'/Actual City name(.*)/s'</span><span class="keyword">, </span><span class="default">$buffer</span><span class="keyword">, </span><span class="default">$match</span><span class="keyword">);
<br>
<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$temp </span><span class="keyword">= </span><span class="default">explode</span><span class="keyword">(</span><span class="string">'Not Acceptable'</span><span class="keyword">, </span><span class="default">$match</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">]);
<br>
<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="comment">// Capture city/state combination for all valid cities
<br>
<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">preg_match_all</span><span class="keyword">(</span><span class="string">'/headers="pre"&gt;(?:&lt;b&gt;)?([\w|\s]+), (\w+)/'</span><span class="keyword">, </span><span class="default">$temp</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">], </span><span class="default">$acceptable</span><span class="keyword">, </span><span class="default">PREG_SET_ORDER</span><span class="keyword">);
<br>
<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$values </span><span class="keyword">= array();
<br>
<br>&nbsp; &nbsp; &nbsp; &nbsp; foreach(</span><span class="default">$acceptable </span><span class="keyword">as </span><span class="default">$value</span><span class="keyword">)
<br>
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$values</span><span class="keyword">[] =
<br>
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; array
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; (
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="string">'city' </span><span class="keyword">=&gt; </span><span class="default">$value</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">],
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="string">'state' </span><span class="keyword">=&gt; </span><span class="default">$value</span><span class="keyword">[</span><span class="default">2</span><span class="keyword">]
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; );
<br>
<br>&nbsp; &nbsp; &nbsp; &nbsp; if(</span><span class="default">count</span><span class="keyword">(</span><span class="default">$values</span><span class="keyword">) == </span><span class="default">0</span><span class="keyword">)
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; echo </span><span class="string">'Zip could not be found in the database!'</span><span class="keyword">;
<br>&nbsp; &nbsp; }
<br>}
<br>else
<br>&nbsp; &nbsp; echo </span><span class="string">'Please specify a zip!'</span><span class="keyword">;
<br>
<br></span><span class="default">?&gt;</span>
</span>
</code></div>
  </div>
 </div>
  <div class="note" id="86305">  
  <a class="name">
  <strong class="user"><em>Anonymous</em></strong></a><div class="date" title="2008-10-12 05:26"><strong>5 years ago</strong></div>
  <div class="text" id="Hcom86305">
<div class="phpcode"><code><span class="html">
"system level connect()" is not further documented inside the php documentation so it is hard to find out more about error numbers.<br><br>someone suggest a more system-close way to find out more about error numbers here: <a rel="nofollow" target="_blank">http://www.askapache.com/php/fsockopen-socket.html</a> (an interesting read about fsockopen anyway).<br><br>in my case i could debug to the fact that fsocketopen error number 16 was resulted in the inpossibility to resolve a hostname.</span>
</code></div>
  </div>
 </div>
  <div class="note" id="85622">  
  <a class="name">
  <strong class="user"><em>andrew at enigma-pro dot com</em></strong></a><div class="date" title="2008-09-09 08:28"><strong>5 years ago</strong></div>
  <div class="text" id="Hcom85622">
<div class="phpcode"><code><span class="html">
Notice using "tcp" insted of "http"
<br><span class="default">&lt;?php
<br>fsockopen</span><span class="keyword">(</span><span class="string">"tcp://example.net"</span><span class="keyword">,</span><span class="default">80 </span><span class="keyword">, </span><span class="default">$errno</span><span class="keyword">, </span><span class="default">$errstr</span><span class="keyword">, </span><span class="default">30</span><span class="keyword">);
<br></span><span class="default">?&gt;</span>
</span>
</code></div>
  </div>
 </div>
  <div class="note" id="85572">  
  <a class="name">
  <strong class="user"><em>mikey at badpenguins dot com</em></strong></a><div class="date" title="2008-09-06 09:00"><strong>5 years ago</strong></div>
  <div class="text" id="Hcom85572">
<div class="phpcode"><code><span class="html">
My $0.02 on handling chunked transfer encoded output...&nbsp; Has rudimentary error handling.
<br>
<br><span class="default">&lt;?php
<br></span><span class="comment">//
<br>// Example usage...
<br>//
<br></span><span class="default">$server&nbsp; </span><span class="keyword">= </span><span class="string">'127.0.0.1'</span><span class="keyword">;
<br></span><span class="default">$port&nbsp; &nbsp; </span><span class="keyword">= </span><span class="string">'80'</span><span class="keyword">;
<br></span><span class="default">$uri&nbsp; &nbsp;&nbsp; </span><span class="keyword">= </span><span class="string">'/cgi-bin/random-cgi'</span><span class="keyword">;
<br></span><span class="default">$content </span><span class="keyword">= </span><span class="string">'Your post content...'</span><span class="keyword">;
<br>
<br></span><span class="default">$post_results </span><span class="keyword">= </span><span class="default">httpPost</span><span class="keyword">(</span><span class="default">$server</span><span class="keyword">,</span><span class="default">$port</span><span class="keyword">,</span><span class="default">$uri</span><span class="keyword">,</span><span class="default">$content</span><span class="keyword">);
<br>if (!</span><span class="default">is_string</span><span class="keyword">(</span><span class="default">$post_results</span><span class="keyword">)) {
<br>&nbsp; &nbsp; die(</span><span class="string">'uh oh, something went wrong'</span><span class="keyword">);
<br>&nbsp; &nbsp; } else {
<br>&nbsp; &nbsp; die(</span><span class="string">'Here are your results: ' </span><span class="keyword">. </span><span class="default">$post_results</span><span class="keyword">);
<br>&nbsp; &nbsp; }
<br>
<br></span><span class="comment">//
<br>// Post provided content to an http server and optionally
<br>// convert chunk encoded results.&nbsp; Returns false on errors,
<br>// result of post on success.&nbsp; This example only handles http,
<br>// not https.
<br>//
<br></span><span class="keyword">function </span><span class="default">httpPost</span><span class="keyword">(</span><span class="default">$ip</span><span class="keyword">=</span><span class="default">null</span><span class="keyword">,</span><span class="default">$port</span><span class="keyword">=</span><span class="default">80</span><span class="keyword">,</span><span class="default">$uri</span><span class="keyword">=</span><span class="default">null</span><span class="keyword">,</span><span class="default">$content</span><span class="keyword">=</span><span class="default">null</span><span class="keyword">) {
<br>&nbsp; &nbsp; if (empty(</span><span class="default">$ip</span><span class="keyword">))&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; { return </span><span class="default">false</span><span class="keyword">; }
<br>&nbsp; &nbsp; if (!</span><span class="default">is_numeric</span><span class="keyword">(</span><span class="default">$port</span><span class="keyword">)) { return </span><span class="default">false</span><span class="keyword">; }
<br>&nbsp; &nbsp; if (empty(</span><span class="default">$uri</span><span class="keyword">))&nbsp; &nbsp; &nbsp; &nbsp; { return </span><span class="default">false</span><span class="keyword">; }
<br>&nbsp; &nbsp; if (empty(</span><span class="default">$content</span><span class="keyword">))&nbsp; &nbsp; { return </span><span class="default">false</span><span class="keyword">; }
<br>&nbsp; &nbsp; </span><span class="comment">// generate headers in array.
<br>&nbsp; &nbsp; </span><span class="default">$t&nbsp;&nbsp; </span><span class="keyword">= array();
<br>&nbsp; &nbsp; </span><span class="default">$t</span><span class="keyword">[] = </span><span class="string">'POST ' </span><span class="keyword">. </span><span class="default">$uri </span><span class="keyword">. </span><span class="string">' HTTP/1.1'</span><span class="keyword">;
<br>&nbsp; &nbsp; </span><span class="default">$t</span><span class="keyword">[] = </span><span class="string">'Content-Type: text/html'</span><span class="keyword">;
<br>&nbsp; &nbsp; </span><span class="default">$t</span><span class="keyword">[] = </span><span class="string">'Host: ' </span><span class="keyword">. </span><span class="default">$ip </span><span class="keyword">. </span><span class="string">':' </span><span class="keyword">. </span><span class="default">$port</span><span class="keyword">;
<br>&nbsp; &nbsp; </span><span class="default">$t</span><span class="keyword">[] = </span><span class="string">'Content-Length: ' </span><span class="keyword">. </span><span class="default">strlen</span><span class="keyword">(</span><span class="default">$content</span><span class="keyword">);
<br>&nbsp; &nbsp; </span><span class="default">$t</span><span class="keyword">[] = </span><span class="string">'Connection: close'</span><span class="keyword">;
<br>&nbsp; &nbsp; </span><span class="default">$t&nbsp;&nbsp; </span><span class="keyword">= </span><span class="default">implode</span><span class="keyword">(</span><span class="string">"\r\n"</span><span class="keyword">,</span><span class="default">$t</span><span class="keyword">) . </span><span class="string">"\r\n\r\n" </span><span class="keyword">. </span><span class="default">$content</span><span class="keyword">;
<br>&nbsp; &nbsp; </span><span class="comment">//
<br>&nbsp; &nbsp; // Open socket, provide error report vars and timeout of 10
<br>&nbsp; &nbsp; // seconds.
<br>&nbsp; &nbsp; //
<br>&nbsp; &nbsp; </span><span class="default">$fp&nbsp; </span><span class="keyword">= @</span><span class="default">fsockopen</span><span class="keyword">(</span><span class="default">$ip</span><span class="keyword">,</span><span class="default">$port</span><span class="keyword">,</span><span class="default">$errno</span><span class="keyword">,</span><span class="default">$errstr</span><span class="keyword">,</span><span class="default">10</span><span class="keyword">);
<br>&nbsp; &nbsp; </span><span class="comment">// If we don't have a stream resource, abort.
<br>&nbsp; &nbsp; </span><span class="keyword">if (!(</span><span class="default">get_resource_type</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">) == </span><span class="string">'stream'</span><span class="keyword">)) { return </span><span class="default">false</span><span class="keyword">; }
<br>&nbsp; &nbsp; </span><span class="comment">//
<br>&nbsp; &nbsp; // Send headers and content.
<br>&nbsp; &nbsp; //
<br>&nbsp; &nbsp; </span><span class="keyword">if (!</span><span class="default">fwrite</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">,</span><span class="default">$t</span><span class="keyword">)) {
<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">fclose</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">);
<br>&nbsp; &nbsp; &nbsp; &nbsp; return </span><span class="default">false</span><span class="keyword">;
<br>&nbsp; &nbsp; &nbsp; &nbsp; }
<br>&nbsp; &nbsp; </span><span class="comment">//
<br>&nbsp; &nbsp; // Read all of response into $rsp and close the socket.
<br>&nbsp; &nbsp; //
<br>&nbsp; &nbsp; </span><span class="default">$rsp </span><span class="keyword">= </span><span class="string">''</span><span class="keyword">;
<br>&nbsp; &nbsp; while(!</span><span class="default">feof</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">)) { </span><span class="default">$rsp </span><span class="keyword">.= </span><span class="default">fgets</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">,</span><span class="default">8192</span><span class="keyword">); }
<br>&nbsp; &nbsp; </span><span class="default">fclose</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">);
<br>&nbsp; &nbsp; </span><span class="comment">//
<br>&nbsp; &nbsp; // Call parseHttpResponse() to return the results.
<br>&nbsp; &nbsp; //
<br>&nbsp; &nbsp; </span><span class="keyword">return </span><span class="default">parseHttpResponse</span><span class="keyword">(</span><span class="default">$rsp</span><span class="keyword">);
<br>&nbsp; &nbsp; }
<br>
<br></span><span class="comment">//
<br>// Accepts provided http content, checks for a valid http response,
<br>// unchunks if needed, returns http content without headers on
<br>// success, false on any errors.
<br>//
<br></span><span class="keyword">function </span><span class="default">parseHttpResponse</span><span class="keyword">(</span><span class="default">$content</span><span class="keyword">=</span><span class="default">null</span><span class="keyword">) {
<br>&nbsp; &nbsp; if (empty(</span><span class="default">$content</span><span class="keyword">)) { return </span><span class="default">false</span><span class="keyword">; }
<br>&nbsp; &nbsp; </span><span class="comment">// split into array, headers and content.
<br>&nbsp; &nbsp; </span><span class="default">$hunks </span><span class="keyword">= </span><span class="default">explode</span><span class="keyword">(</span><span class="string">"\r\n\r\n"</span><span class="keyword">,</span><span class="default">trim</span><span class="keyword">(</span><span class="default">$content</span><span class="keyword">));
<br>&nbsp; &nbsp; if (!</span><span class="default">is_array</span><span class="keyword">(</span><span class="default">$hunks</span><span class="keyword">) or </span><span class="default">count</span><span class="keyword">(</span><span class="default">$hunks</span><span class="keyword">) &lt; </span><span class="default">2</span><span class="keyword">) {
<br>&nbsp; &nbsp; &nbsp; &nbsp; return </span><span class="default">false</span><span class="keyword">;
<br>&nbsp; &nbsp; &nbsp; &nbsp; }
<br>&nbsp; &nbsp; </span><span class="default">$header&nbsp; </span><span class="keyword">= </span><span class="default">$hunks</span><span class="keyword">[</span><span class="default">count</span><span class="keyword">(</span><span class="default">$hunks</span><span class="keyword">) - </span><span class="default">2</span><span class="keyword">];
<br>&nbsp; &nbsp; </span><span class="default">$body&nbsp; &nbsp; </span><span class="keyword">= </span><span class="default">$hunks</span><span class="keyword">[</span><span class="default">count</span><span class="keyword">(</span><span class="default">$hunks</span><span class="keyword">) - </span><span class="default">1</span><span class="keyword">];
<br>&nbsp; &nbsp; </span><span class="default">$headers </span><span class="keyword">= </span><span class="default">explode</span><span class="keyword">(</span><span class="string">"\n"</span><span class="keyword">,</span><span class="default">$header</span><span class="keyword">);
<br>&nbsp; &nbsp; unset(</span><span class="default">$hunks</span><span class="keyword">);
<br>&nbsp; &nbsp; unset(</span><span class="default">$header</span><span class="keyword">);
<br>&nbsp; &nbsp; if (!</span><span class="default">verifyHttpResponse</span><span class="keyword">(</span><span class="default">$headers</span><span class="keyword">)) { return </span><span class="default">false</span><span class="keyword">; }
<br>&nbsp; &nbsp; if (</span><span class="default">in_array</span><span class="keyword">(</span><span class="string">'Transfer-Encoding: chunked'</span><span class="keyword">,</span><span class="default">$headers</span><span class="keyword">)) {
<br>&nbsp; &nbsp; &nbsp; &nbsp; return </span><span class="default">trim</span><span class="keyword">(</span><span class="default">unchunkHttpResponse</span><span class="keyword">(</span><span class="default">$body</span><span class="keyword">));
<br>&nbsp; &nbsp; &nbsp; &nbsp; } else {
<br>&nbsp; &nbsp; &nbsp; &nbsp; return </span><span class="default">trim</span><span class="keyword">(</span><span class="default">$body</span><span class="keyword">);
<br>&nbsp; &nbsp; &nbsp; &nbsp; }
<br>&nbsp; &nbsp; }
<br>
<br></span><span class="comment">//
<br>// Validate http responses by checking header.&nbsp; Expects array of
<br>// headers as argument.&nbsp; Returns boolean.
<br>//
<br></span><span class="keyword">function </span><span class="default">validateHttpResponse</span><span class="keyword">(</span><span class="default">$headers</span><span class="keyword">=</span><span class="default">null</span><span class="keyword">) {
<br>&nbsp; &nbsp; if (!</span><span class="default">is_array</span><span class="keyword">(</span><span class="default">$headers</span><span class="keyword">) or </span><span class="default">count</span><span class="keyword">(</span><span class="default">$headers</span><span class="keyword">) &lt; </span><span class="default">1</span><span class="keyword">) { return </span><span class="default">false</span><span class="keyword">; }
<br>&nbsp; &nbsp; switch(</span><span class="default">trim</span><span class="keyword">(</span><span class="default">strtolower</span><span class="keyword">(</span><span class="default">$headers</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">]))) {
<br>&nbsp; &nbsp; &nbsp; &nbsp; case </span><span class="string">'http/1.0 100 ok'</span><span class="keyword">:
<br>&nbsp; &nbsp; &nbsp; &nbsp; case </span><span class="string">'http/1.0 200 ok'</span><span class="keyword">:
<br>&nbsp; &nbsp; &nbsp; &nbsp; case </span><span class="string">'http/1.1 100 ok'</span><span class="keyword">:
<br>&nbsp; &nbsp; &nbsp; &nbsp; case </span><span class="string">'http/1.1 200 ok'</span><span class="keyword">:
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; return </span><span class="default">true</span><span class="keyword">;
<br>&nbsp; &nbsp; &nbsp; &nbsp; break;
<br>&nbsp; &nbsp; &nbsp; &nbsp; }
<br>&nbsp; &nbsp; return </span><span class="default">false</span><span class="keyword">;
<br>&nbsp; &nbsp; }
<br>
<br></span><span class="comment">//
<br>// Unchunk http content.&nbsp; Returns unchunked content on success,
<br>// false on any errors...&nbsp; Borrows from code posted above by
<br>// jbr at ya-right dot com.
<br>//
<br></span><span class="keyword">function </span><span class="default">unchunkHttpResponse</span><span class="keyword">(</span><span class="default">$str</span><span class="keyword">=</span><span class="default">null</span><span class="keyword">) {
<br>&nbsp; &nbsp; if (!</span><span class="default">is_string</span><span class="keyword">(</span><span class="default">$str</span><span class="keyword">) or </span><span class="default">strlen</span><span class="keyword">(</span><span class="default">$str</span><span class="keyword">) &lt; </span><span class="default">1</span><span class="keyword">) { return </span><span class="default">false</span><span class="keyword">; }
<br>&nbsp; &nbsp; </span><span class="default">$eol </span><span class="keyword">= </span><span class="string">"\r\n"</span><span class="keyword">;
<br>&nbsp; &nbsp; </span><span class="default">$add </span><span class="keyword">= </span><span class="default">strlen</span><span class="keyword">(</span><span class="default">$eol</span><span class="keyword">);
<br>&nbsp; &nbsp; </span><span class="default">$tmp </span><span class="keyword">= </span><span class="default">$str</span><span class="keyword">;
<br>&nbsp; &nbsp; </span><span class="default">$str </span><span class="keyword">= </span><span class="string">''</span><span class="keyword">;
<br>&nbsp; &nbsp; do {
<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$tmp </span><span class="keyword">= </span><span class="default">ltrim</span><span class="keyword">(</span><span class="default">$tmp</span><span class="keyword">);
<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$pos </span><span class="keyword">= </span><span class="default">strpos</span><span class="keyword">(</span><span class="default">$tmp</span><span class="keyword">, </span><span class="default">$eol</span><span class="keyword">);
<br>&nbsp; &nbsp; &nbsp; &nbsp; if (</span><span class="default">$pos </span><span class="keyword">=== </span><span class="default">false</span><span class="keyword">) { return </span><span class="default">false</span><span class="keyword">; }
<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$len </span><span class="keyword">= </span><span class="default">hexdec</span><span class="keyword">(</span><span class="default">substr</span><span class="keyword">(</span><span class="default">$tmp</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">,</span><span class="default">$pos</span><span class="keyword">));
<br>&nbsp; &nbsp; &nbsp; &nbsp; if (!</span><span class="default">is_numeric</span><span class="keyword">(</span><span class="default">$len</span><span class="keyword">) or </span><span class="default">$len </span><span class="keyword">&lt; </span><span class="default">0</span><span class="keyword">) { return </span><span class="default">false</span><span class="keyword">; }
<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$str </span><span class="keyword">.= </span><span class="default">substr</span><span class="keyword">(</span><span class="default">$tmp</span><span class="keyword">, (</span><span class="default">$pos </span><span class="keyword">+ </span><span class="default">$add</span><span class="keyword">), </span><span class="default">$len</span><span class="keyword">);
<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$tmp&nbsp; </span><span class="keyword">= </span><span class="default">substr</span><span class="keyword">(</span><span class="default">$tmp</span><span class="keyword">, (</span><span class="default">$len </span><span class="keyword">+ </span><span class="default">$pos </span><span class="keyword">+ </span><span class="default">$add</span><span class="keyword">));
<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$check </span><span class="keyword">= </span><span class="default">trim</span><span class="keyword">(</span><span class="default">$tmp</span><span class="keyword">);
<br>&nbsp; &nbsp; &nbsp; &nbsp; } while(!empty(</span><span class="default">$check</span><span class="keyword">));
<br>&nbsp; &nbsp; unset(</span><span class="default">$tmp</span><span class="keyword">);
<br>&nbsp; &nbsp; return </span><span class="default">$str</span><span class="keyword">;
<br>&nbsp; &nbsp; }
<br>
<br></span><span class="default">?&gt;</span>
</span>
</code></div>
  </div>
 </div>
  <div class="note" id="84599">  
  <a class="name">
  <strong class="user"><em>admin at lab-9 dot com</em></strong></a><div class="date" title="2008-07-21 05:32"><strong>6 years ago</strong></div>
  <div class="text" id="Hcom84599">
<div class="phpcode"><code><span class="html">
When you try to POST/GET requests via HTTPS over SSL/TLS you should notice this:<br><br><span class="default">&lt;?php<br></span><span class="comment">// preconditions<br></span><span class="default">$port </span><span class="keyword">= </span><span class="default">80 </span><span class="keyword">| </span><span class="default">443<br>$host </span><span class="keyword">= </span><span class="string">"www.example.com"</span><span class="keyword">;<br></span><span class="default">$method </span><span class="keyword">= </span><span class="string">"POST" </span><span class="keyword">| </span><span class="string">"GET"</span><span class="keyword">;<br></span><span class="default">$contenttype </span><span class="keyword">= </span><span class="string">"text/html" </span><span class="keyword">| </span><span class="string">"text/plain" </span><span class="keyword">| </span><span class="string">"text/xml" </span><span class="keyword">| ...;<br></span><span class="default">$data </span><span class="keyword">= </span><span class="string">"&lt;something&gt;"</span><span class="keyword">;<br><br></span><span class="comment">// script<br></span><span class="keyword">if(</span><span class="default">$port </span><span class="keyword">== </span><span class="default">443</span><span class="keyword">)<br>&nbsp; &nbsp; &nbsp; </span><span class="default">$sslhost </span><span class="keyword">= </span><span class="string">"ssl://"</span><span class="keyword">.</span><span class="default">$host</span><span class="keyword">;<br>else<br>&nbsp; &nbsp; &nbsp; </span><span class="default">$sslhost </span><span class="keyword">= </span><span class="default">$host</span><span class="keyword">;<br></span><span class="default">$fp </span><span class="keyword">= </span><span class="default">fsockopen</span><span class="keyword">(</span><span class="default">$sslhost</span><span class="keyword">, </span><span class="default">$port</span><span class="keyword">);<br></span><span class="default">fputs</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">, </span><span class="string">"</span><span class="default">$method</span><span class="string"> </span><span class="default">$path</span><span class="string"> HTTP/1.1\r\n"</span><span class="keyword">);<br></span><span class="default">fputs</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">, </span><span class="string">"Host: </span><span class="default">$host</span><span class="string">\r\n"</span><span class="keyword">);<br></span><span class="default">fputs</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">, </span><span class="string">"Content-type: </span><span class="default">$contenttype</span><span class="string">\r\n"</span><span class="keyword">);<br></span><span class="default">fputs</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">, </span><span class="string">"Content-length: "</span><span class="keyword">.</span><span class="default">strlen</span><span class="keyword">(</span><span class="default">$data</span><span class="keyword">).</span><span class="string">"\r\n"</span><span class="keyword">);<br></span><span class="default">fputs</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">, </span><span class="string">"Connection: close\r\n"</span><span class="keyword">);<br></span><span class="default">fputs</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">, </span><span class="string">"\r\n"</span><span class="keyword">);<br></span><span class="default">?&gt;<br></span><br>The server usually does not understand the HTTP-header "Host: XXX" if you provide it with the trailing "ssl://" used by fsockopen(); If you do it anyway you probably get a HTTP 400 back as response. :-)</span>
</code></div>
  </div>
 </div>
  <div class="note" id="81652">  
  <a class="name">
  <strong class="user"><em> dot  dot  dot  dot  dot alexander at gmail dot com</em></strong></a><div class="date" title="2008-03-08 07:15"><strong>6 years ago</strong></div>
  <div class="text" id="Hcom81652">
<div class="phpcode"><code><span class="html">
An edit to my below function for extra headers support and a bit of debugging<br>( array("key" =&gt; "value")&nbsp; type)<br> <span class="default">&lt;?php<br><br></span><span class="keyword">if(!</span><span class="default">function_exists</span><span class="keyword">(</span><span class="string">"download"</span><span class="keyword">)){<br>&nbsp; &nbsp; function </span><span class="default">download</span><span class="keyword">(</span><span class="default">$uri</span><span class="keyword">, </span><span class="default">$port </span><span class="keyword">= </span><span class="default">80</span><span class="keyword">, </span><span class="default">$extra_headers </span><span class="keyword">= </span><span class="default">NULL</span><span class="keyword">){<br>if(!</span><span class="default">function_exists</span><span class="keyword">(</span><span class="string">"stripos"</span><span class="keyword">)){<br>&nbsp; &nbsp; function </span><span class="default">stripos</span><span class="keyword">(</span><span class="default">$str</span><span class="keyword">, </span><span class="default">$needle</span><span class="keyword">, </span><span class="default">$offset</span><span class="keyword">=</span><span class="default">0</span><span class="keyword">){<br>&nbsp; &nbsp; &nbsp; &nbsp; return </span><span class="default">strpos</span><span class="keyword">(</span><span class="default">strtolower</span><span class="keyword">(</span><span class="default">$str</span><span class="keyword">),</span><span class="default">strtolower</span><span class="keyword">(</span><span class="default">$needle</span><span class="keyword">),</span><span class="default">$offset</span><span class="keyword">);<br>&nbsp; &nbsp; }</span><span class="comment">/* endfunction stripos */<br></span><span class="keyword">}</span><span class="comment">/* endfunction exists stripos*/<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="keyword">if(!</span><span class="default">is_int</span><span class="keyword">(</span><span class="default">$port</span><span class="keyword">))</span><span class="default">$port </span><span class="keyword">= </span><span class="default">80</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; if(!</span><span class="default">is_array</span><span class="keyword">(</span><span class="default">$extra_headers</span><span class="keyword">))</span><span class="default">$extra_headers </span><span class="keyword">= array();<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$uri </span><span class="keyword">= </span><span class="default">strtr</span><span class="keyword">( </span><span class="default">strval</span><span class="keyword">(</span><span class="default">$uri</span><span class="keyword">), array(</span><span class="string">"<a rel="nofollow" target="_blank">http://</a>" </span><span class="keyword">=&gt; </span><span class="string">""</span><span class="keyword">, </span><span class="string">"https://" </span><span class="keyword">=&gt; </span><span class="string">"ssl://"</span><span class="keyword">, </span><span class="string">"ssl://" </span><span class="keyword">=&gt; </span><span class="string">"ssl://"</span><span class="keyword">, </span><span class="string">"\\" </span><span class="keyword">=&gt; </span><span class="string">"/"</span><span class="keyword">, </span><span class="string">"//" </span><span class="keyword">=&gt; </span><span class="string">"/"</span><span class="keyword">) );<br>&nbsp; &nbsp; &nbsp; &nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; if(&nbsp; ( </span><span class="default">$protocol </span><span class="keyword">= </span><span class="default">stripos</span><span class="keyword">(</span><span class="default">$uri</span><span class="keyword">, </span><span class="string">"://"</span><span class="keyword">) ) !== </span><span class="default">FALSE&nbsp; </span><span class="keyword">){<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if(&nbsp; ( </span><span class="default">$domain_pos </span><span class="keyword">= </span><span class="default">stripos</span><span class="keyword">(</span><span class="default">$uri</span><span class="keyword">, </span><span class="string">"/"</span><span class="keyword">, (</span><span class="default">$protocol </span><span class="keyword">+ </span><span class="default">3</span><span class="keyword">)) ) !== </span><span class="default">FALSE&nbsp; </span><span class="keyword">){<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$domain </span><span class="keyword">= </span><span class="default">substr</span><span class="keyword">(</span><span class="default">$uri</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">$domain_pos</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$file </span><span class="keyword">= </span><span class="default">substr</span><span class="keyword">(</span><span class="default">$uri</span><span class="keyword">, </span><span class="default">$domain_pos</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; else{<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$domain </span><span class="keyword">= </span><span class="default">$uri</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$file </span><span class="keyword">= </span><span class="string">"/"</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br>&nbsp; &nbsp; &nbsp; &nbsp; }<br>&nbsp; &nbsp; &nbsp; &nbsp; else{<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if(&nbsp; ( </span><span class="default">$domain_pos </span><span class="keyword">= </span><span class="default">stripos</span><span class="keyword">(</span><span class="default">$uri</span><span class="keyword">, </span><span class="string">"/"</span><span class="keyword">) ) !== </span><span class="default">FALSE&nbsp; </span><span class="keyword">){<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$domain </span><span class="keyword">= </span><span class="default">substr</span><span class="keyword">(</span><span class="default">$uri</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">$domain_pos</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$file </span><span class="keyword">= </span><span class="default">substr</span><span class="keyword">(</span><span class="default">$uri</span><span class="keyword">, </span><span class="default">$domain_pos</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; else{<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$domain </span><span class="keyword">= </span><span class="default">$uri</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$file </span><span class="keyword">= </span><span class="string">"/"</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br>&nbsp; &nbsp; &nbsp; &nbsp; }<br>&nbsp; &nbsp; &nbsp; &nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$fp </span><span class="keyword">= </span><span class="default">fsockopen</span><span class="keyword">(</span><span class="default">$domain</span><span class="keyword">, </span><span class="default">$port</span><span class="keyword">, </span><span class="default">$errno</span><span class="keyword">, </span><span class="default">$errstr</span><span class="keyword">, </span><span class="default">30</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; if(!</span><span class="default">$fp</span><span class="keyword">){<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; return </span><span class="default">FALSE</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; }<br>&nbsp; &nbsp; &nbsp; &nbsp; else{<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$out </span><span class="keyword">= </span><span class="string">"GET " </span><span class="keyword">. </span><span class="default">$file </span><span class="keyword">. </span><span class="string">" HTTP/1.1\r\n"</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$out </span><span class="keyword">.= </span><span class="string">"Host: " </span><span class="keyword">. </span><span class="default">$domain </span><span class="keyword">. </span><span class="string">"\r\n"</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; foreach( </span><span class="default">$extra_headers </span><span class="keyword">as </span><span class="default">$nm </span><span class="keyword">=&gt; </span><span class="default">$vl </span><span class="keyword">){<br>&nbsp; &nbsp; </span><span class="default">$out </span><span class="keyword">.= </span><span class="default">strtr</span><span class="keyword">( </span><span class="default">strval</span><span class="keyword">(</span><span class="default">$nm</span><span class="keyword">), array( </span><span class="string">"\r" </span><span class="keyword">=&gt; </span><span class="string">""</span><span class="keyword">, </span><span class="string">"\n" </span><span class="keyword">=&gt; </span><span class="string">""</span><span class="keyword">, </span><span class="string">": " </span><span class="keyword">=&gt; </span><span class="string">""</span><span class="keyword">, </span><span class="string">":" </span><span class="keyword">=&gt; </span><span class="string">""</span><span class="keyword">) ) . </span><span class="string">": " </span><span class="keyword">. </span><span class="default">strtr</span><span class="keyword">( </span><span class="default">strval</span><span class="keyword">(</span><span class="default">$vl</span><span class="keyword">), array( </span><span class="string">"\r" </span><span class="keyword">=&gt; </span><span class="string">""</span><span class="keyword">, </span><span class="string">"\n" </span><span class="keyword">=&gt; </span><span class="string">""</span><span class="keyword">, </span><span class="string">": " </span><span class="keyword">=&gt; </span><span class="string">""</span><span class="keyword">, </span><span class="string">":" </span><span class="keyword">=&gt; </span><span class="string">""</span><span class="keyword">) ) . </span><span class="string">"\r\n"</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$out </span><span class="keyword">.= </span><span class="string">"Connection: Close\r\n\r\n"</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$response </span><span class="keyword">= </span><span class="string">""</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">fwrite</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">, </span><span class="default">$out</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; while (!</span><span class="default">feof</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">)) {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$response </span><span class="keyword">.= </span><span class="default">fgets</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">, </span><span class="default">128</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">fclose</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; global </span><span class="default">$http_response_header</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$http_response_header </span><span class="keyword">= array();<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if(&nbsp; </span><span class="default">stripos</span><span class="keyword">(</span><span class="default">$response</span><span class="keyword">, </span><span class="string">"\r\n\r\n"</span><span class="keyword">) !== </span><span class="default">FALSE&nbsp; </span><span class="keyword">){<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$hc </span><span class="keyword">= </span><span class="default">explode</span><span class="keyword">(</span><span class="string">"\r\n\r\n"</span><span class="keyword">,&nbsp; </span><span class="default">$response</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$headers </span><span class="keyword">= </span><span class="default">explode</span><span class="keyword">(</span><span class="string">"\r\n"</span><span class="keyword">,&nbsp; </span><span class="default">$hc</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">]);<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if(!</span><span class="default">is_array</span><span class="keyword">(</span><span class="default">$headers</span><span class="keyword">))</span><span class="default">$headers </span><span class="keyword">= array();<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; foreach(</span><span class="default">$headers </span><span class="keyword">as </span><span class="default">$key </span><span class="keyword">=&gt; </span><span class="default">$header</span><span class="keyword">){<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$a </span><span class="keyword">= </span><span class="string">""</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$b </span><span class="keyword">= </span><span class="string">""</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if(&nbsp; </span><span class="default">stripos</span><span class="keyword">(</span><span class="default">$header</span><span class="keyword">, </span><span class="string">":"</span><span class="keyword">) !== </span><span class="default">FALSE&nbsp; </span><span class="keyword">){<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; list(</span><span class="default">$a</span><span class="keyword">, </span><span class="default">$b</span><span class="keyword">) = </span><span class="default">explode</span><span class="keyword">(</span><span class="string">":"</span><span class="keyword">, </span><span class="default">$header</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$http_response_header</span><span class="keyword">[</span><span class="default">trim</span><span class="keyword">(</span><span class="default">$a</span><span class="keyword">)] = </span><span class="default">trim</span><span class="keyword">(</span><span class="default">$b</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; return </span><span class="default">end</span><span class="keyword">(</span><span class="default">$hc</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; else if(&nbsp; </span><span class="default">stripos</span><span class="keyword">(</span><span class="default">$response</span><span class="keyword">, </span><span class="string">"\r\n"</span><span class="keyword">) !== </span><span class="default">FALSE&nbsp; </span><span class="keyword">){<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$headers </span><span class="keyword">= </span><span class="default">explode</span><span class="keyword">(</span><span class="string">"\r\n"</span><span class="keyword">,&nbsp; </span><span class="default">$response</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if(!</span><span class="default">is_array</span><span class="keyword">(</span><span class="default">$headers</span><span class="keyword">))</span><span class="default">$headers </span><span class="keyword">= array();<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; foreach(</span><span class="default">$headers </span><span class="keyword">as </span><span class="default">$key </span><span class="keyword">=&gt; </span><span class="default">$header</span><span class="keyword">){<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if(&nbsp; </span><span class="default">$key </span><span class="keyword">&lt; ( </span><span class="default">count</span><span class="keyword">(</span><span class="default">$headers</span><span class="keyword">) - </span><span class="default">1 </span><span class="keyword">)&nbsp; ){<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$a </span><span class="keyword">= </span><span class="string">""</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$b </span><span class="keyword">= </span><span class="string">""</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if(&nbsp; </span><span class="default">stripos</span><span class="keyword">(</span><span class="default">$header</span><span class="keyword">, </span><span class="string">":"</span><span class="keyword">) !== </span><span class="default">FALSE&nbsp; </span><span class="keyword">){<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; list(</span><span class="default">$a</span><span class="keyword">, </span><span class="default">$b</span><span class="keyword">) = </span><span class="default">explode</span><span class="keyword">(</span><span class="string">":"</span><span class="keyword">, </span><span class="default">$header</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$http_response_header</span><span class="keyword">[</span><span class="default">trim</span><span class="keyword">(</span><span class="default">$a</span><span class="keyword">)] = </span><span class="default">trim</span><span class="keyword">(</span><span class="default">$b</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; return </span><span class="default">end</span><span class="keyword">(</span><span class="default">$headers</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; else{<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; return </span><span class="default">$response</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br>&nbsp; &nbsp; &nbsp; &nbsp; }<br>&nbsp; &nbsp; }</span><span class="comment">/*endfunction download*/<br></span><span class="keyword">}</span><span class="comment">/*endif no function download*/<br></span><span class="default">?&gt;</span>
</span>
</code></div>
  </div>
 </div>
  <div class="note" id="80066">  
  <a class="name">
  <strong class="user"><em>huli0401 at gmail dot com</em></strong></a><div class="date" title="2007-12-27 09:12"><strong>6 years ago</strong></div>
  <div class="text" id="Hcom80066">
<div class="phpcode"><code><span class="html">
<span class="default">&lt;?php
<br></span><span class="comment">// Check for new version
<br>&nbsp; &nbsp; </span><span class="default">$current_version </span><span class="keyword">= </span><span class="default">explode</span><span class="keyword">(</span><span class="string">'.'</span><span class="keyword">, </span><span class="string">'1.0.00'</span><span class="keyword">);
<br>&nbsp; &nbsp; </span><span class="default">$minor_revision </span><span class="keyword">= (int) </span><span class="default">$current_version</span><span class="keyword">[</span><span class="default">2</span><span class="keyword">];
<br>
<br>&nbsp; &nbsp; </span><span class="default">$errno </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">;
<br>&nbsp; &nbsp; </span><span class="default">$errstr </span><span class="keyword">= </span><span class="default">$version_info </span><span class="keyword">= </span><span class="string">''</span><span class="keyword">;
<br>
<br>&nbsp; &nbsp; if (</span><span class="default">$fsock </span><span class="keyword">= </span><span class="default">fsockopen</span><span class="keyword">(</span><span class="string">"www.exanmple.eu"</span><span class="keyword">, </span><span class="default">80</span><span class="keyword">, </span><span class="default">$errno</span><span class="keyword">, </span><span class="default">$errstr</span><span class="keyword">, </span><span class="default">30</span><span class="keyword">))
<br>&nbsp; &nbsp; {
<br>&nbsp; &nbsp; &nbsp; &nbsp; @</span><span class="default">fputs</span><span class="keyword">(</span><span class="default">$fsock</span><span class="keyword">, </span><span class="string">"GET /ver.txt HTTP/1.1\r\n"</span><span class="keyword">);
<br>&nbsp; &nbsp; &nbsp; &nbsp; @</span><span class="default">fputs</span><span class="keyword">(</span><span class="default">$fsock</span><span class="keyword">, </span><span class="string">"HOST: www.example.eu\r\n"</span><span class="keyword">);
<br>&nbsp; &nbsp; &nbsp; &nbsp; @</span><span class="default">fputs</span><span class="keyword">(</span><span class="default">$fsock</span><span class="keyword">, </span><span class="string">"Connection: close\r\n\r\n"</span><span class="keyword">);
<br>
<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$get_info </span><span class="keyword">= </span><span class="default">false</span><span class="keyword">;
<br>&nbsp; &nbsp; &nbsp; &nbsp; while (!@</span><span class="default">feof</span><span class="keyword">(</span><span class="default">$fsock</span><span class="keyword">))
<br>&nbsp; &nbsp; &nbsp; &nbsp; {
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if (</span><span class="default">$get_info</span><span class="keyword">)
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$version_info </span><span class="keyword">.= @</span><span class="default">fread</span><span class="keyword">(</span><span class="default">$fsock</span><span class="keyword">, </span><span class="default">1024</span><span class="keyword">);
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; else
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if (@</span><span class="default">fgets</span><span class="keyword">(</span><span class="default">$fsock</span><span class="keyword">, </span><span class="default">1024</span><span class="keyword">) == </span><span class="string">"\r\n"</span><span class="keyword">)
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$get_info </span><span class="keyword">= </span><span class="default">true</span><span class="keyword">;
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }
<br>&nbsp; &nbsp; &nbsp; &nbsp; }
<br>&nbsp; &nbsp; &nbsp; &nbsp; @</span><span class="default">fclose</span><span class="keyword">(</span><span class="default">$fsock</span><span class="keyword">);
<br>
<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$version_info </span><span class="keyword">= </span><span class="default">explode</span><span class="keyword">(</span><span class="string">"\n"</span><span class="keyword">, </span><span class="default">$version_info</span><span class="keyword">);
<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$latest_head_revision </span><span class="keyword">= (int) </span><span class="default">$version_info</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">];
<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$latest_minor_revision </span><span class="keyword">= (int) </span><span class="default">$version_info</span><span class="keyword">[</span><span class="default">2</span><span class="keyword">];
<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$latest_version </span><span class="keyword">= (int) </span><span class="default">$version_info</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">] . </span><span class="string">'.' </span><span class="keyword">. (int) </span><span class="default">$version_info</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">] . </span><span class="string">'.' </span><span class="keyword">. (int) </span><span class="default">$version_info</span><span class="keyword">[</span><span class="default">2</span><span class="keyword">];
<br>
<br>&nbsp; &nbsp; &nbsp; &nbsp; if (</span><span class="default">$latest_head_revision </span><span class="keyword">== </span><span class="default">2 </span><span class="keyword">&amp;&amp; </span><span class="default">$minor_revision </span><span class="keyword">== </span><span class="default">$latest_minor_revision</span><span class="keyword">)
<br>&nbsp; &nbsp; &nbsp; &nbsp; {
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$version_info </span><span class="keyword">= </span><span class="string">'&lt;p style="color:green"&gt;OK&lt;/p&gt;'</span><span class="keyword">;
<br>&nbsp; &nbsp; &nbsp; &nbsp; }
<br>&nbsp; &nbsp; &nbsp; &nbsp; else
<br>&nbsp; &nbsp; &nbsp; &nbsp; {
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$version_info </span><span class="keyword">= </span><span class="string">'&lt;p style="color:red"&gt;neaktualne'</span><span class="keyword">;
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$version_info </span><span class="keyword">.= </span><span class="string">'&lt;br /&gt;'</span><span class="default">Latest_version_info</span><span class="string">' . $latest_version) . ' ' . sprintf(Current_version_info'</span><span class="keyword">. </span><span class="string">'1.0.00'</span><span class="keyword">) . </span><span class="string">'&lt;/p&gt;'</span><span class="keyword">;
<br>&nbsp; &nbsp; &nbsp; &nbsp; }
<br>&nbsp; &nbsp; }
<br>&nbsp; &nbsp; else
<br>&nbsp; &nbsp; {
<br>&nbsp; &nbsp; &nbsp; &nbsp; if (</span><span class="default">$errstr</span><span class="keyword">)
<br>&nbsp; &nbsp; &nbsp; &nbsp; {
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$version_info </span><span class="keyword">= </span><span class="string">'&lt;p style="color:red"&gt;' </span><span class="keyword">. </span><span class="default">sprintf</span><span class="keyword">(</span><span class="default">Connect_socket_error</span><span class="keyword">) . </span><span class="string">'&lt;/p&gt;'</span><span class="keyword">;
<br>&nbsp; &nbsp; &nbsp; &nbsp; }
<br>&nbsp; &nbsp; &nbsp; &nbsp; else
<br>&nbsp; &nbsp; &nbsp; &nbsp; {
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$version_info </span><span class="keyword">= </span><span class="string">'&lt;p&gt;'</span><span class="default">Socket_functions_disabled</span><span class="string">'&lt;/p&gt;'</span><span class="keyword">;
<br>&nbsp; &nbsp; &nbsp; &nbsp; }
<br>&nbsp; &nbsp; }
<br>&nbsp; &nbsp; 
<br>&nbsp; &nbsp; </span><span class="default">$version_info </span><span class="keyword">.= </span><span class="string">'&lt;p&gt;'</span><span class="default">Mailing_list_subscribe_reminder</span><span class="string">'&lt;/p&gt;'</span><span class="keyword">;
<br>
<br>echo </span><span class="default">$version_info</span><span class="keyword">;
<br></span><span class="default">?&gt;</span>
</span>
</code></div>
  </div>
 </div>
  <div class="note" id="76899">  
  <a class="name">
  <strong class="user"><em>Adlez</em></strong></a><div class="date" title="2007-08-04 01:32"><strong>7 years ago</strong></div>
  <div class="text" id="Hcom76899">
<div class="phpcode"><code><span class="html">
For those of you who do not have cURL, you might want to try this. 
<br>It doesn't have all the functions that cURL has, but it has the basics. 
<br>Please let me know of any bugs or problems.
<br>
<br><span class="default">&lt;?php
<br></span><span class="keyword">function </span><span class="default">open_page</span><span class="keyword">(</span><span class="default">$url</span><span class="keyword">,</span><span class="default">$f</span><span class="keyword">=</span><span class="default">1</span><span class="keyword">,</span><span class="default">$c</span><span class="keyword">=</span><span class="default">2</span><span class="keyword">,</span><span class="default">$r</span><span class="keyword">=</span><span class="default">0</span><span class="keyword">,</span><span class="default">$a</span><span class="keyword">=</span><span class="default">0</span><span class="keyword">,</span><span class="default">$cf</span><span class="keyword">=</span><span class="default">0</span><span class="keyword">,</span><span class="default">$pd</span><span class="keyword">=</span><span class="string">""</span><span class="keyword">){
<br> global </span><span class="default">$oldheader</span><span class="keyword">;
<br> </span><span class="default">$url </span><span class="keyword">= </span><span class="default">str_replace</span><span class="keyword">(</span><span class="string">"<a rel="nofollow" target="_blank">http://</a>"</span><span class="keyword">,</span><span class="string">""</span><span class="keyword">,</span><span class="default">$url</span><span class="keyword">);
<br> if (</span><span class="default">preg_match</span><span class="keyword">(</span><span class="string">"#/#"</span><span class="keyword">,</span><span class="string">"</span><span class="default">$url</span><span class="string">"</span><span class="keyword">)){
<br>&nbsp; </span><span class="default">$page </span><span class="keyword">= </span><span class="default">$url</span><span class="keyword">;
<br>&nbsp; </span><span class="default">$url </span><span class="keyword">= @</span><span class="default">explode</span><span class="keyword">(</span><span class="string">"/"</span><span class="keyword">,</span><span class="default">$url</span><span class="keyword">);
<br>&nbsp; </span><span class="default">$url </span><span class="keyword">= </span><span class="default">$url</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">];
<br>&nbsp; </span><span class="default">$page </span><span class="keyword">= </span><span class="default">str_replace</span><span class="keyword">(</span><span class="default">$url</span><span class="keyword">,</span><span class="string">""</span><span class="keyword">,</span><span class="default">$page</span><span class="keyword">);
<br>&nbsp; if (!</span><span class="default">$page </span><span class="keyword">|| </span><span class="default">$page </span><span class="keyword">== </span><span class="string">""</span><span class="keyword">){
<br>&nbsp;&nbsp; </span><span class="default">$page </span><span class="keyword">= </span><span class="string">"/"</span><span class="keyword">;
<br>&nbsp; }
<br>&nbsp; </span><span class="default">$ip </span><span class="keyword">= </span><span class="default">gethostbyname</span><span class="keyword">(</span><span class="default">$url</span><span class="keyword">);
<br> }else{
<br>&nbsp; </span><span class="default">$ip </span><span class="keyword">= </span><span class="default">gethostbyname</span><span class="keyword">(</span><span class="default">$url</span><span class="keyword">);
<br>&nbsp; </span><span class="default">$page </span><span class="keyword">= </span><span class="string">"/"</span><span class="keyword">;
<br> }
<br> </span><span class="default">$open </span><span class="keyword">= </span><span class="default">fsockopen</span><span class="keyword">(</span><span class="default">$ip</span><span class="keyword">, </span><span class="default">80</span><span class="keyword">, </span><span class="default">$errno</span><span class="keyword">, </span><span class="default">$errstr</span><span class="keyword">, </span><span class="default">60</span><span class="keyword">);
<br> if (</span><span class="default">$pd</span><span class="keyword">){
<br>&nbsp; </span><span class="default">$send </span><span class="keyword">= </span><span class="string">"POST </span><span class="default">$page</span><span class="string"> HTTP/1.0\r\n"</span><span class="keyword">;
<br> }else{
<br>&nbsp; </span><span class="default">$send </span><span class="keyword">= </span><span class="string">"GET </span><span class="default">$page</span><span class="string"> HTTP/1.0\r\n"</span><span class="keyword">;
<br> }
<br> </span><span class="default">$send </span><span class="keyword">.= </span><span class="string">"Host: </span><span class="default">$url</span><span class="string">\r\n"</span><span class="keyword">;
<br> if (</span><span class="default">$r</span><span class="keyword">){
<br>&nbsp; </span><span class="default">$send </span><span class="keyword">.= </span><span class="string">"Referer: </span><span class="default">$r</span><span class="string">\r\n"</span><span class="keyword">;
<br> }else{
<br>&nbsp; if (</span><span class="default">$_SERVER</span><span class="keyword">[</span><span class="string">'HTTP_REFERER'</span><span class="keyword">]){
<br>&nbsp;&nbsp; </span><span class="default">$send </span><span class="keyword">.= </span><span class="string">"Referer: </span><span class="keyword">{</span><span class="default">$_SERVER</span><span class="keyword">[</span><span class="string">'HTTP_REFERER'</span><span class="keyword">]}</span><span class="string">\r\n"</span><span class="keyword">;
<br>&nbsp; }
<br> }
<br> if (</span><span class="default">$cf</span><span class="keyword">){
<br>&nbsp; if (@</span><span class="default">file_exists</span><span class="keyword">(</span><span class="default">$cf</span><span class="keyword">)){
<br>&nbsp;&nbsp; </span><span class="default">$cookie </span><span class="keyword">= </span><span class="default">urldecode</span><span class="keyword">(@</span><span class="default">file_get_contents</span><span class="keyword">(</span><span class="default">$cf</span><span class="keyword">));
<br>&nbsp;&nbsp; if (</span><span class="default">$cookie</span><span class="keyword">){
<br>&nbsp; &nbsp; </span><span class="default">$send </span><span class="keyword">.= </span><span class="string">"Cookie: </span><span class="default">$cookie</span><span class="string">\r\n"</span><span class="keyword">;
<br>&nbsp; &nbsp; </span><span class="default">$add </span><span class="keyword">= @</span><span class="default">fopen</span><span class="keyword">(</span><span class="default">$cf</span><span class="keyword">,</span><span class="string">'w'</span><span class="keyword">);
<br>&nbsp; &nbsp; </span><span class="default">fwrite</span><span class="keyword">(</span><span class="default">$add</span><span class="keyword">,</span><span class="string">""</span><span class="keyword">);
<br>&nbsp; &nbsp; </span><span class="default">fclose</span><span class="keyword">(</span><span class="default">$add</span><span class="keyword">);
<br>&nbsp;&nbsp; }
<br>&nbsp; }
<br> }
<br> </span><span class="default">$send </span><span class="keyword">.= </span><span class="string">"Accept-Language: en-us, en;q=0.50\r\n"</span><span class="keyword">;
<br> if (</span><span class="default">$a</span><span class="keyword">){
<br>&nbsp; </span><span class="default">$send </span><span class="keyword">.= </span><span class="string">"User-Agent: </span><span class="default">$a</span><span class="string">\r\n"</span><span class="keyword">;
<br> }else{
<br>&nbsp; </span><span class="default">$send </span><span class="keyword">.= </span><span class="string">"User-Agent: </span><span class="keyword">{</span><span class="default">$_SERVER</span><span class="keyword">[</span><span class="string">'HTTP_USER_AGENT'</span><span class="keyword">]}</span><span class="string">\r\n"</span><span class="keyword">;
<br> }
<br> if (</span><span class="default">$pd</span><span class="keyword">){
<br>&nbsp; </span><span class="default">$send </span><span class="keyword">.= </span><span class="string">"Content-Type: application/x-www-form-urlencoded\r\n"</span><span class="keyword">;&nbsp; 
<br>&nbsp; </span><span class="default">$send </span><span class="keyword">.= </span><span class="string">"Content-Length: " </span><span class="keyword">.</span><span class="default">strlen</span><span class="keyword">(</span><span class="default">$pd</span><span class="keyword">) .</span><span class="string">"\r\n\r\n"</span><span class="keyword">;
<br>&nbsp; </span><span class="default">$send </span><span class="keyword">.= </span><span class="default">$pd</span><span class="keyword">;
<br> }else{
<br>&nbsp; </span><span class="default">$send </span><span class="keyword">.= </span><span class="string">"Connection: Close\r\n\r\n"</span><span class="keyword">;
<br> }
<br> </span><span class="default">fputs</span><span class="keyword">(</span><span class="default">$open</span><span class="keyword">, </span><span class="default">$send</span><span class="keyword">);
<br> while (!</span><span class="default">feof</span><span class="keyword">(</span><span class="default">$open</span><span class="keyword">)) {
<br>&nbsp; </span><span class="default">$return </span><span class="keyword">.= </span><span class="default">fgets</span><span class="keyword">(</span><span class="default">$open</span><span class="keyword">, </span><span class="default">4096</span><span class="keyword">);
<br> }
<br> </span><span class="default">fclose</span><span class="keyword">(</span><span class="default">$open</span><span class="keyword">);
<br> </span><span class="default">$return </span><span class="keyword">= @</span><span class="default">explode</span><span class="keyword">(</span><span class="string">"\r\n\r\n"</span><span class="keyword">,</span><span class="default">$return</span><span class="keyword">,</span><span class="default">2</span><span class="keyword">);
<br> </span><span class="default">$header </span><span class="keyword">= </span><span class="default">$return</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">];
<br> if (</span><span class="default">$cf</span><span class="keyword">){
<br>&nbsp; if (</span><span class="default">preg_match</span><span class="keyword">(</span><span class="string">"/Set\-Cookie\: /i"</span><span class="keyword">,</span><span class="string">"</span><span class="default">$header</span><span class="string">"</span><span class="keyword">)){
<br>&nbsp;&nbsp; </span><span class="default">$cookie </span><span class="keyword">= @</span><span class="default">explode</span><span class="keyword">(</span><span class="string">"Set-Cookie: "</span><span class="keyword">,</span><span class="default">$header</span><span class="keyword">,</span><span class="default">2</span><span class="keyword">);
<br>&nbsp;&nbsp; </span><span class="default">$cookie </span><span class="keyword">= </span><span class="default">$cookie</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">];
<br>&nbsp;&nbsp; </span><span class="default">$cookie </span><span class="keyword">= </span><span class="default">explode</span><span class="keyword">(</span><span class="string">"\r"</span><span class="keyword">,</span><span class="default">$cookie</span><span class="keyword">);
<br>&nbsp;&nbsp; </span><span class="default">$cookie </span><span class="keyword">= </span><span class="default">$cookie</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">];
<br>&nbsp;&nbsp; </span><span class="default">$cookie </span><span class="keyword">= </span><span class="default">str_replace</span><span class="keyword">(</span><span class="string">"path=/"</span><span class="keyword">,</span><span class="string">""</span><span class="keyword">,</span><span class="default">$cookie</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">]);
<br>&nbsp;&nbsp; </span><span class="default">$add </span><span class="keyword">= @</span><span class="default">fopen</span><span class="keyword">(</span><span class="default">$cf</span><span class="keyword">,</span><span class="string">'a'</span><span class="keyword">);
<br>&nbsp;&nbsp; </span><span class="default">fwrite</span><span class="keyword">(</span><span class="default">$add</span><span class="keyword">,</span><span class="default">$cookie</span><span class="keyword">,</span><span class="default">strlen</span><span class="keyword">(</span><span class="default">$read</span><span class="keyword">));
<br>&nbsp;&nbsp; </span><span class="default">fclose</span><span class="keyword">(</span><span class="default">$add</span><span class="keyword">);
<br>&nbsp; }
<br> }
<br> if (</span><span class="default">$oldheader</span><span class="keyword">){
<br>&nbsp; </span><span class="default">$header </span><span class="keyword">= </span><span class="string">"</span><span class="default">$oldheader</span><span class="string">&lt;br /&gt;&lt;br /&gt;\n</span><span class="default">$header</span><span class="string">"</span><span class="keyword">;
<br> }
<br> </span><span class="default">$header </span><span class="keyword">= </span><span class="default">str_replace</span><span class="keyword">(</span><span class="string">"\n"</span><span class="keyword">,</span><span class="string">"&lt;br /&gt;"</span><span class="keyword">,</span><span class="default">$header</span><span class="keyword">);
<br> if (</span><span class="default">$return</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">]){
<br>&nbsp; </span><span class="default">$body </span><span class="keyword">= </span><span class="default">$return</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">];
<br> }else{
<br>&nbsp; </span><span class="default">$body </span><span class="keyword">= </span><span class="string">""</span><span class="keyword">;
<br> }
<br> if (</span><span class="default">$c </span><span class="keyword">=== </span><span class="default">2</span><span class="keyword">){
<br>&nbsp; if (</span><span class="default">$body</span><span class="keyword">){
<br>&nbsp;&nbsp; </span><span class="default">$return </span><span class="keyword">= </span><span class="default">$body</span><span class="keyword">;
<br>&nbsp; }else{
<br>&nbsp;&nbsp; </span><span class="default">$return </span><span class="keyword">= </span><span class="default">$header</span><span class="keyword">;
<br>&nbsp; }
<br> }
<br> if (</span><span class="default">$c </span><span class="keyword">=== </span><span class="default">1</span><span class="keyword">){
<br>&nbsp; </span><span class="default">$return </span><span class="keyword">= </span><span class="default">$header</span><span class="keyword">;
<br> }
<br> if (</span><span class="default">$c </span><span class="keyword">=== </span><span class="default">3</span><span class="keyword">){
<br>&nbsp; </span><span class="default">$return </span><span class="keyword">= </span><span class="string">"</span><span class="default">$header$body</span><span class="string">"</span><span class="keyword">;
<br> }
<br> if (</span><span class="default">$f</span><span class="keyword">){
<br>&nbsp; if (</span><span class="default">preg_match</span><span class="keyword">(</span><span class="string">"/Location\:/"</span><span class="keyword">,</span><span class="string">"</span><span class="default">$header</span><span class="string">"</span><span class="keyword">)){
<br>&nbsp;&nbsp; </span><span class="default">$url </span><span class="keyword">= @</span><span class="default">explode</span><span class="keyword">(</span><span class="string">"Location: "</span><span class="keyword">,</span><span class="default">$header</span><span class="keyword">);
<br>&nbsp;&nbsp; </span><span class="default">$url </span><span class="keyword">= </span><span class="default">$url</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">];
<br>&nbsp;&nbsp; </span><span class="default">$url </span><span class="keyword">= @</span><span class="default">explode</span><span class="keyword">(</span><span class="string">"\r"</span><span class="keyword">,</span><span class="default">$url</span><span class="keyword">);
<br>&nbsp;&nbsp; </span><span class="default">$url </span><span class="keyword">= </span><span class="default">$url</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">];
<br>&nbsp;&nbsp; </span><span class="default">$oldheader </span><span class="keyword">= </span><span class="default">str_replace</span><span class="keyword">(</span><span class="string">"\r\n\r\n"</span><span class="keyword">,</span><span class="string">""</span><span class="keyword">,</span><span class="default">$header</span><span class="keyword">);
<br>&nbsp;&nbsp; </span><span class="default">$l </span><span class="keyword">= </span><span class="string">"&amp;#76&amp;#111&amp;#99&amp;#97&amp;#116&amp;#105&amp;#111&amp;#110&amp;#58"</span><span class="keyword">;
<br>&nbsp;&nbsp; </span><span class="default">$oldheader </span><span class="keyword">= </span><span class="default">str_replace</span><span class="keyword">(</span><span class="string">"Location:"</span><span class="keyword">,</span><span class="default">$l</span><span class="keyword">,</span><span class="default">$oldheader</span><span class="keyword">);
<br>&nbsp;&nbsp; return </span><span class="default">open_page</span><span class="keyword">(</span><span class="default">$url</span><span class="keyword">,</span><span class="default">$f</span><span class="keyword">,</span><span class="default">$c</span><span class="keyword">,</span><span class="default">$r</span><span class="keyword">,</span><span class="default">$a</span><span class="keyword">,</span><span class="default">$cf</span><span class="keyword">,</span><span class="default">$pd</span><span class="keyword">);
<br>&nbsp; }else{
<br>&nbsp;&nbsp; return </span><span class="default">$return</span><span class="keyword">;
<br>&nbsp; }
<br> }else{
<br>&nbsp; return </span><span class="default">$return</span><span class="keyword">;
<br> }
<br>}
<br></span><span class="comment">/////////////
<br>////Usage////
<br>/////////////
<br></span><span class="default">$url </span><span class="keyword">= </span><span class="string">"<a rel="nofollow" target="_blank">http://www.php.net</a>"</span><span class="keyword">;
<br></span><span class="default">$f </span><span class="keyword">= </span><span class="default">1</span><span class="keyword">;
<br></span><span class="default">$c </span><span class="keyword">= </span><span class="default">2</span><span class="keyword">;</span><span class="comment">//1 for header, 2 for body, 3 for both
<br></span><span class="default">$r </span><span class="keyword">= </span><span class="default">NULL</span><span class="keyword">;
<br></span><span class="default">$a </span><span class="keyword">= </span><span class="default">NULL</span><span class="keyword">;
<br></span><span class="default">$cf </span><span class="keyword">= </span><span class="default">NULL</span><span class="keyword">;
<br></span><span class="default">$pd </span><span class="keyword">= </span><span class="default">NULL</span><span class="keyword">;
<br></span><span class="default">$page </span><span class="keyword">= </span><span class="default">open_page</span><span class="keyword">(</span><span class="default">$url</span><span class="keyword">,</span><span class="default">$f</span><span class="keyword">,</span><span class="default">$c</span><span class="keyword">,</span><span class="default">$r</span><span class="keyword">,</span><span class="default">$a</span><span class="keyword">,</span><span class="default">$cf</span><span class="keyword">,</span><span class="default">$pd</span><span class="keyword">);
<br>print </span><span class="default">$page</span><span class="keyword">;
<br></span><span class="default">?&gt;</span>
</span>
</code></div>
  </div>
 </div>
  <div class="note" id="76626">  
  <a class="name">
  <strong class="user"><em>bradland at umich dot edu</em></strong></a><div class="date" title="2007-07-23 09:32"><strong>7 years ago</strong></div>
  <div class="text" id="Hcom76626">
<div class="phpcode"><code><span class="html">
I was having trouble doing an https in fopen and with fsockopen where the address had ssl://.&nbsp; I was getting error code 114 in the log.&nbsp; After much research i found that there was some ssl conflict trouble with MySQL 5.0.20-5.0.33.&nbsp; It had some functions that were interfering with openssl that showed up in the php install.<br><br><a rel="nofollow" target="_blank">http://bugs.mysql.com/bug.php?id=21930</a><br><a rel="nofollow" target="_blank">http://bugs.mysql.com/bug.php?id=19289</a></span>
</code></div>
  </div>
 </div>
  <div class="note" id="72576">  
  <a class="name">
  <strong class="user"><em>v13+phpnet at it dot teithe dot gr</em></strong></a><div class="date" title="2007-01-24 03:01"><strong>7 years ago</strong></div>
  <div class="text" id="Hcom72576">
<div class="phpcode"><code><span class="html">
The following function performs pop3 authentication. Returns NULL on error, or true/false to indicate username/password matching:<br><br>$address is the hostname of the server and $ssl is a boolean that indicates whether an SSL connection is requested.<br><br><span class="default">&lt;?php<br></span><span class="keyword">function </span><span class="default">pop3authCheck</span><span class="keyword">(</span><span class="default">$username</span><span class="keyword">, </span><span class="default">$password</span><span class="keyword">, </span><span class="default">$address</span><span class="keyword">, </span><span class="default">$ssl</span><span class="keyword">)<br>{<br>&nbsp; &nbsp; if (</span><span class="default">$ssl</span><span class="keyword">)<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$uri</span><span class="keyword">=</span><span class="string">"ssl://</span><span class="default">$address</span><span class="string">:995"</span><span class="keyword">;<br>&nbsp; &nbsp; else<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$uri</span><span class="keyword">=</span><span class="string">"tcp://</span><span class="default">$address</span><span class="string">:110"</span><span class="keyword">;<br><br>&nbsp; &nbsp; </span><span class="default">$fp</span><span class="keyword">=</span><span class="default">fsockopen</span><span class="keyword">(</span><span class="default">$uri</span><span class="keyword">);<br><br>&nbsp; &nbsp; if (!</span><span class="default">$fp</span><span class="keyword">)<br>&nbsp; &nbsp; &nbsp; &nbsp; return(</span><span class="default">NULL</span><span class="keyword">);<br><br>&nbsp; &nbsp; </span><span class="default">$st</span><span class="keyword">=</span><span class="default">fgets</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">, </span><span class="default">512</span><span class="keyword">);<br>&nbsp; &nbsp; if (</span><span class="default">substr</span><span class="keyword">(</span><span class="default">$st</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">3</span><span class="keyword">)!=</span><span class="string">"+OK"</span><span class="keyword">)<br>&nbsp; &nbsp; {<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">fclose</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; return(</span><span class="default">NULL</span><span class="keyword">);<br>&nbsp; &nbsp; }<br><br>&nbsp; &nbsp; </span><span class="default">$st</span><span class="keyword">=</span><span class="string">"USER </span><span class="default">$username</span><span class="string">\n"</span><span class="keyword">;<br>&nbsp; &nbsp; if (</span><span class="default">fwrite</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">, </span><span class="default">$st</span><span class="keyword">)!=</span><span class="default">strlen</span><span class="keyword">(</span><span class="default">$st</span><span class="keyword">))<br>&nbsp; &nbsp; {<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">fclose</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; return(</span><span class="default">NULL</span><span class="keyword">);<br>&nbsp; &nbsp; }<br><br>&nbsp; &nbsp; </span><span class="default">$st</span><span class="keyword">=</span><span class="default">fgets</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">, </span><span class="default">512</span><span class="keyword">);<br>&nbsp; &nbsp; if (</span><span class="default">substr</span><span class="keyword">(</span><span class="default">$st</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">3</span><span class="keyword">)!=</span><span class="string">"+OK"</span><span class="keyword">)<br>&nbsp; &nbsp; {<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">fclose</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; return(</span><span class="default">NULL</span><span class="keyword">);<br>&nbsp; &nbsp; }<br><br>&nbsp; &nbsp; </span><span class="default">$st</span><span class="keyword">=</span><span class="string">"PASS </span><span class="default">$password</span><span class="string">\n"</span><span class="keyword">;<br>&nbsp; &nbsp; if (</span><span class="default">fwrite</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">, </span><span class="default">$st</span><span class="keyword">)!=</span><span class="default">strlen</span><span class="keyword">(</span><span class="default">$st</span><span class="keyword">))<br>&nbsp; &nbsp; {<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">fclose</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; return(</span><span class="default">NULL</span><span class="keyword">);<br>&nbsp; &nbsp; }<br><br>&nbsp; &nbsp; </span><span class="default">$st</span><span class="keyword">=</span><span class="default">fgets</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">, </span><span class="default">512</span><span class="keyword">);<br>&nbsp; &nbsp; </span><span class="default">fclose</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">);<br>&nbsp; &nbsp; if (</span><span class="default">substr</span><span class="keyword">(</span><span class="default">$st</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">3</span><span class="keyword">)==</span><span class="string">"+OK"</span><span class="keyword">)<br>&nbsp; &nbsp; &nbsp; &nbsp; return(</span><span class="default">true</span><span class="keyword">);<br>&nbsp; &nbsp; else if (</span><span class="default">substr</span><span class="keyword">(</span><span class="default">$st</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">4</span><span class="keyword">)==</span><span class="string">"+ERR"</span><span class="keyword">)<br>&nbsp; &nbsp; &nbsp; &nbsp; return(</span><span class="default">false</span><span class="keyword">);<br>&nbsp; &nbsp; else<br>&nbsp; &nbsp; &nbsp; &nbsp; return(</span><span class="default">NULL</span><span class="keyword">);<br>}<br></span><span class="default">?&gt;</span>
</span>
</code></div>
  </div>
 </div>
  <div class="note" id="71532">  
  <a class="name"><strong class="user"><em>Anonymous</em></strong></a><div class="date" title="2006-12-04 08:34"><strong>7 years ago</strong></div>
  <div class="text" id="Hcom71532">
<div class="phpcode"><code><span class="html">
I've had issues with some of the handlers for chunked http 1.1 responses.&nbsp; Here's a method that worked for me, if it works for you as well, then cheers :P<br><br><span class="default">&lt;?php<br><br>&nbsp; &nbsp; </span><span class="keyword">function </span><span class="default">httpSocketConnection</span><span class="keyword">(</span><span class="default">$host</span><span class="keyword">, </span><span class="default">$method</span><span class="keyword">, </span><span class="default">$path</span><span class="keyword">, </span><span class="default">$data</span><span class="keyword">)<br>&nbsp; &nbsp; {<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$method </span><span class="keyword">= </span><span class="default">strtoupper</span><span class="keyword">(</span><span class="default">$method</span><span class="keyword">);&nbsp; &nbsp; &nbsp; &nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; if (</span><span class="default">$method </span><span class="keyword">== </span><span class="string">"GET"</span><span class="keyword">)<br>&nbsp; &nbsp; &nbsp; &nbsp; {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$path</span><span class="keyword">.= </span><span class="string">'?'</span><span class="keyword">.</span><span class="default">$data</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; }&nbsp; &nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$filePointer </span><span class="keyword">= </span><span class="default">fsockopen</span><span class="keyword">(</span><span class="default">$host</span><span class="keyword">, </span><span class="default">80</span><span class="keyword">, </span><span class="default">$errorNumber</span><span class="keyword">, </span><span class="default">$errorString</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; if (!</span><span class="default">$filePointer</span><span class="keyword">) <br>&nbsp; &nbsp; &nbsp; &nbsp; {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">logEvent</span><span class="keyword">(</span><span class="string">'debug'</span><span class="keyword">, </span><span class="string">'Failed opening http socket connection: '</span><span class="keyword">.</span><span class="default">$errorString</span><span class="keyword">.</span><span class="string">' ('</span><span class="keyword">.</span><span class="default">$errorNumber</span><span class="keyword">.</span><span class="string">')&lt;br/&gt;\n'</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; return </span><span class="default">false</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; }<br><br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$requestHeader </span><span class="keyword">= </span><span class="default">$method</span><span class="keyword">.</span><span class="string">" "</span><span class="keyword">.</span><span class="default">$path</span><span class="keyword">.</span><span class="string">"&nbsp; HTTP/1.1\r\n"</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$requestHeader</span><span class="keyword">.= </span><span class="string">"Host: "</span><span class="keyword">.</span><span class="default">$host</span><span class="keyword">.</span><span class="string">"\r\n"</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$requestHeader</span><span class="keyword">.= </span><span class="string">"User-Agent:&nbsp; &nbsp; &nbsp; Mozilla/5.0 (Windows; U; Windows NT 5.1; en-US; rv:1.8.1) Gecko/20061010 Firefox/2.0\r\n"</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$requestHeader</span><span class="keyword">.= </span><span class="string">"Content-Type: application/x-www-form-urlencoded\r\n"</span><span class="keyword">;<br><br>&nbsp; &nbsp; &nbsp; &nbsp; if (</span><span class="default">$method </span><span class="keyword">== </span><span class="string">"POST"</span><span class="keyword">)<br>&nbsp; &nbsp; &nbsp; &nbsp; {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$requestHeader</span><span class="keyword">.= </span><span class="string">"Content-Length: "</span><span class="keyword">.</span><span class="default">strlen</span><span class="keyword">(</span><span class="default">$data</span><span class="keyword">).</span><span class="string">"\r\n"</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; }<br>&nbsp; &nbsp; &nbsp; &nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$requestHeader</span><span class="keyword">.= </span><span class="string">"Connection: close\r\n\r\n"</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; if (</span><span class="default">$method </span><span class="keyword">== </span><span class="string">"POST"</span><span class="keyword">)<br>&nbsp; &nbsp; &nbsp; &nbsp; {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$requestHeader</span><span class="keyword">.= </span><span class="default">$data</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; }&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br><br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">fwrite</span><span class="keyword">(</span><span class="default">$filePointer</span><span class="keyword">, </span><span class="default">$requestHeader</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$responseHeader </span><span class="keyword">= </span><span class="string">''</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$responseContent </span><span class="keyword">= </span><span class="string">''</span><span class="keyword">;<br><br>&nbsp; &nbsp; &nbsp; &nbsp; do <br>&nbsp; &nbsp; &nbsp; &nbsp; {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$responseHeader</span><span class="keyword">.= </span><span class="default">fread</span><span class="keyword">(</span><span class="default">$filePointer</span><span class="keyword">, </span><span class="default">1</span><span class="keyword">); <br>&nbsp; &nbsp; &nbsp; &nbsp; }<br>&nbsp; &nbsp; &nbsp; &nbsp; while (!</span><span class="default">preg_match</span><span class="keyword">(</span><span class="string">'/\\r\\n\\r\\n$/'</span><span class="keyword">, </span><span class="default">$responseHeader</span><span class="keyword">));<br>&nbsp; &nbsp; &nbsp; &nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; if (!</span><span class="default">strstr</span><span class="keyword">(</span><span class="default">$responseHeader</span><span class="keyword">, </span><span class="string">"Transfer-Encoding: chunked"</span><span class="keyword">))<br>&nbsp; &nbsp; &nbsp; &nbsp; {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; while (!</span><span class="default">feof</span><span class="keyword">(</span><span class="default">$filePointer</span><span class="keyword">))<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$responseContent</span><span class="keyword">.= </span><span class="default">fgets</span><span class="keyword">(</span><span class="default">$filePointer</span><span class="keyword">, </span><span class="default">128</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br>&nbsp; &nbsp; &nbsp; &nbsp; }<br>&nbsp; &nbsp; &nbsp; &nbsp; else <br>&nbsp; &nbsp; &nbsp; &nbsp; {<br><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; while (</span><span class="default">$chunk_length </span><span class="keyword">= </span><span class="default">hexdec</span><span class="keyword">(</span><span class="default">fgets</span><span class="keyword">(</span><span class="default">$filePointer</span><span class="keyword">))) <br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$responseContentChunk </span><span class="keyword">= </span><span class="string">''</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">logEventToTextFile</span><span class="keyword">(</span><span class="string">'debug'</span><span class="keyword">, </span><span class="default">$chunk_length</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$read_length </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; while (</span><span class="default">$read_length </span><span class="keyword">&lt; </span><span class="default">$chunk_length</span><span class="keyword">) <br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$responseContentChunk </span><span class="keyword">.= </span><span class="default">fread</span><span class="keyword">(</span><span class="default">$filePointer</span><span class="keyword">, </span><span class="default">$chunk_length </span><span class="keyword">- </span><span class="default">$read_length</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$read_length </span><span class="keyword">= </span><span class="default">strlen</span><span class="keyword">(</span><span class="default">$responseContentChunk</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$responseContent</span><span class="keyword">.= </span><span class="default">$responseContentChunk</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">fgets</span><span class="keyword">(</span><span class="default">$filePointer</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; }<br><br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">logEventToTextFile</span><span class="keyword">(</span><span class="string">'debug'</span><span class="keyword">, </span><span class="default">$responseContent</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; return </span><span class="default">chop</span><span class="keyword">(</span><span class="default">$responseContent</span><span class="keyword">);<br>&nbsp; &nbsp; }<br><br></span><span class="default">?&gt;</span>
</span>
</code></div>
  </div>
 </div>
  <div class="note" id="64094">  
  <a class="name">
  <strong class="user"><em>yadiutama_skom at yahoo dot com</em></strong></a><div class="date" title="2006-04-07 02:09"><strong>8 years ago</strong></div>
  <div class="text" id="Hcom64094">
<div class="phpcode"><code><span class="html">
This is a simple example for sending and retrieve SOAP message by using fsockopen:<br><br><span class="default">&lt;?php<br>$fp </span><span class="keyword">= @</span><span class="default">fsockopen</span><span class="keyword">(</span><span class="string">"www.example.com"</span><span class="keyword">, </span><span class="default">80</span><span class="keyword">, </span><span class="default">$errno</span><span class="keyword">, </span><span class="default">$errstr</span><span class="keyword">);<br>if (!</span><span class="default">$fp</span><span class="keyword">) {<br>&nbsp; &nbsp; echo </span><span class="string">"</span><span class="default">$errstr</span><span class="string"> (</span><span class="default">$errno</span><span class="string">)&lt;br /&gt;\n"</span><span class="keyword">;<br>} else {<br><br></span><span class="default">$soap_out&nbsp; </span><span class="keyword">= </span><span class="string">"POST /example/exampleServer.php HTTP/1.0\r\n"</span><span class="keyword">;<br></span><span class="default">$soap_out </span><span class="keyword">.= </span><span class="string">"Host: www.example.com\r\n"</span><span class="keyword">;<br></span><span class="default">$soap_out </span><span class="keyword">.= </span><span class="string">"User-Agent: MySOAPisOKGuys \r\n"</span><span class="keyword">;<br></span><span class="default">$soap_out </span><span class="keyword">.= </span><span class="string">"Content-Type: text/xml; charset=ISO-8859-1\r\n"</span><span class="keyword">;<br></span><span class="default">$soap_out </span><span class="keyword">.= </span><span class="string">"Content-Length: 512\r\n\r\n"</span><span class="keyword">;<br></span><span class="default">$soap_out </span><span class="keyword">.= </span><span class="string">'&lt;?xml version="1.0" encoding="ISO-8859-1"?&gt;<br>&lt;SOAP-ENV:Envelope SOAP-ENV:encodingStyle="<a rel="nofollow" target="_blank">http://schemas.xmlsoap.org/soap/encoding/</a>" xmlns:SOAP-ENV="<a rel="nofollow" target="_blank">http://schemas.xmlsoap.org/soap/envelope/</a>" xmlns:xsd="<a rel="nofollow" target="_blank">http://www.w3.org/2001/XMLSchema</a>" xmlns:xsi="<a rel="nofollow" target="_blank">http://www.w3.org/2001/XMLSchema-instance</a>" xmlns:SOAP-ENC="<a rel="nofollow" target="_blank">http://schemas.xmlsoap.org/soap/encoding/</a>"&gt;<br>&lt;SOAP-ENV:Body&gt;<br>&lt;ns5973:contact xmlns:ns5973="<a rel="nofollow" target="_blank">http://tempuri.org</a>"&gt;<br>&lt;__numeric_0&gt;&lt;id&nbsp; xsi:nil="true"/&gt;&lt;/__numeric_0&gt;<br>&lt;/ns5973:contact&gt;<br>&lt;/SOAP-ENV:Body&gt;<br>&lt;/SOAP-ENV:Envelope&gt;'</span><span class="keyword">;<br><br>&nbsp; &nbsp; </span><span class="default">fputs</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">, </span><span class="default">$soap_out</span><span class="keyword">, </span><span class="default">strlen</span><span class="keyword">(</span><span class="default">$soap_out</span><span class="keyword">));&nbsp; </span><span class="comment">// send request SOAP<br><br>&nbsp; &nbsp; </span><span class="keyword">echo </span><span class="string">"&lt;xmp&gt;"</span><span class="keyword">.</span><span class="default">$out</span><span class="keyword">.</span><span class="string">"&lt;/xmp&gt;"</span><span class="keyword">;<br><br>&nbsp; &nbsp; while (!</span><span class="default">feof</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">)) {<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$soap_in </span><span class="keyword">. = </span><span class="default">fgets</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">, </span><span class="default">100</span><span class="keyword">);<br>&nbsp; &nbsp; }<br><br>&nbsp; &nbsp; echo </span><span class="string">"&lt;xmp&gt;</span><span class="default">$soap_in</span><span class="string">&lt;/xmp&gt;"</span><span class="keyword">;&nbsp;&nbsp; </span><span class="comment">//display response SOAP<br><br>&nbsp; &nbsp; </span><span class="default">fclose</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">);<br>}<br></span><span class="default">?&gt;</span> <br><br>And this is an example result:<br><br>POST /soap/example/contactServer.php HTTP/1.0<br>Host: www.example.com<br>User-Agent: MySOAPisOKGuys<br>Content-Type: text/xml; charset=ISO-8859-1<br>Content-Length: 512<br>&lt;?xml version="1.0" encoding="ISO-8859-1"?&gt;<br>&lt;SOAP-ENV:Envelope<br>SOAP-ENV:encodingStyle="<a rel="nofollow" target="_blank">http://schemas.xmlsoap.org/soap/encoding/</a>"<br>xmlns:SOAP-ENV="<a rel="nofollow" target="_blank">http://schemas.xmlsoap.org/soap/envelope/</a>"<br>xmlns:xsd="<a rel="nofollow" target="_blank">http://www.w3.org/2001/XMLSchema</a>"<br>xmlns:xsi="<a rel="nofollow" target="_blank">http://www.w3.org/2001/XMLSchema-instance</a>"<br>xmlns:SOAP-ENC="<a rel="nofollow" target="_blank">http://schemas.xmlsoap.org/soap/encoding/</a>"&gt;<br>&lt;SOAP-ENV:Body&gt;&lt;ns5973:contact<br>xmlns:ns5973="<a rel="nofollow" target="_blank">http://tempuri.org</a>"&gt;&lt;__numeric_0&gt;&lt;id<br>xsi:nil="true"/&gt;&lt;/__numeric_0&gt;&lt;/ns5973:contact&gt;<br>&lt;/SOAP-ENV:Body&gt;<br>&lt;/SOAP-ENV:Envelope&gt;<br><br>HTTP/1.1 200 OK<br>Date: Thu, 06 Apr 2006 07:03:26 GMT<br>Server: Apache/1.3.23 (Win32)<br>X-Powered-By: PHP/4.1.1<br>X-SOAP-Server: MySOAPisOKGuys<br>Content-Length: 625<br>Connection: close<br>Content-Type: text/xml; charset=ISO-8859-1<br>&lt;?xml version="1.0" encoding="ISO-8859-1"?&gt;<br>&lt;SOAP-ENV:Envelope<br>SOAP-ENV:encodingStyle="<a rel="nofollow" target="_blank">http://schemas.xmlsoap.org/soap/encoding/</a>"<br>xmlns:SOAP-ENV="<a rel="nofollow" target="_blank">http://schemas.xmlsoap.org/soap/envelope/</a>"<br>xmlns:xsd="<a rel="nofollow" target="_blank">http://www.w3.org/2001/XMLSchema</a>"<br>xmlns:xsi="<a rel="nofollow" target="_blank">http://www.w3.org/2001/XMLSchema-instance</a>"<br>xmlns:SOAP-ENC="<a rel="nofollow" target="_blank">http://schemas.xmlsoap.org/soap/encoding/</a>"&gt;<br>&lt;SOAP-ENV:Body&gt;&lt;ns1:contactResponse<br>xmlns:ns1="<a rel="nofollow" target="_blank">http://tempuri.org</a>"&gt;<br>&lt;return xsi:type="xsd:string"&gt;<br>&lt;/return&gt;<br>&lt;/ns1:contactResponse&gt;<br>&lt;/SOAP-ENV:Body&gt;<br>&lt;/SOAP-ENV:Envelope&gt;</span>
</code></div>
  </div>
 </div>
  <div class="note" id="62380">  
  <a class="name">
  <strong class="user"><em>Duukkis</em></strong></a><div class="date" title="2006-02-27 05:13"><strong>8 years ago</strong></div>
  <div class="text" id="Hcom62380">
<div class="phpcode"><code><span class="html">
Lots of tries and lots of reading http-headers...<br><br>If you want to post $_POST vars and (in this case) one file named userfile to $remote_server and $remote_url.<br><br><span class="default">&lt;?php<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="comment">// get the necessary data<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$file_name </span><span class="keyword">= </span><span class="default">$_FILES</span><span class="keyword">[</span><span class="string">'userfile'</span><span class="keyword">][</span><span class="string">'name'</span><span class="keyword">];&nbsp; &nbsp;&nbsp; </span><span class="comment">// the file<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$tmp_name </span><span class="keyword">= </span><span class="default">$_FILES</span><span class="keyword">[</span><span class="string">'userfile'</span><span class="keyword">][</span><span class="string">'tmp_name'</span><span class="keyword">];&nbsp; &nbsp;&nbsp; </span><span class="comment">// the file<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$content_type </span><span class="keyword">= </span><span class="default">$_FILES</span><span class="keyword">[</span><span class="string">'userfile'</span><span class="keyword">][</span><span class="string">'type'</span><span class="keyword">];&nbsp; &nbsp;&nbsp; </span><span class="comment">// the file mime type<br>&nbsp; &nbsp; &nbsp; &nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">srand</span><span class="keyword">((double)</span><span class="default">microtime</span><span class="keyword">()*</span><span class="default">1000000</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$boundary </span><span class="keyword">= </span><span class="string">"---------------------"</span><span class="keyword">.</span><span class="default">substr</span><span class="keyword">(</span><span class="default">md5</span><span class="keyword">(</span><span class="default">rand</span><span class="keyword">(</span><span class="default">0</span><span class="keyword">,</span><span class="default">32000</span><span class="keyword">)),</span><span class="default">0</span><span class="keyword">,</span><span class="default">10</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="comment">// Build the header<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$header </span><span class="keyword">= </span><span class="string">"POST </span><span class="default">$remote_url</span><span class="string"> HTTP/1.0\r\n"</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$header </span><span class="keyword">.= </span><span class="string">"Host: </span><span class="default">$remote_server</span><span class="string">\r\n"</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$header </span><span class="keyword">.= </span><span class="string">"Content-type: multipart/form-data, boundary=</span><span class="default">$boundary</span><span class="string">\r\n"</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="comment">// attach post vars<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="keyword">foreach(</span><span class="default">$_POST </span><span class="keyword">AS </span><span class="default">$index </span><span class="keyword">=&gt; </span><span class="default">$value</span><span class="keyword">){<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$data </span><span class="keyword">.=</span><span class="string">"--</span><span class="default">$boundary</span><span class="string">\r\n"</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$data </span><span class="keyword">.= </span><span class="string">"Content-Disposition: form-data; name=\""</span><span class="keyword">.</span><span class="default">$index</span><span class="keyword">.</span><span class="string">"\"\r\n"</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$data </span><span class="keyword">.= </span><span class="string">"\r\n"</span><span class="keyword">.</span><span class="default">$value</span><span class="keyword">.</span><span class="string">"\r\n"</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$data </span><span class="keyword">.=</span><span class="string">"--</span><span class="default">$boundary</span><span class="string">\r\n"</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; }<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="comment">// and attach the file<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$data </span><span class="keyword">.= </span><span class="string">"--</span><span class="default">$boundary</span><span class="string">\r\n"</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$content_file </span><span class="keyword">= </span><span class="default">join</span><span class="keyword">(</span><span class="string">""</span><span class="keyword">, </span><span class="default">file</span><span class="keyword">(</span><span class="default">$tmp_name</span><span class="keyword">));<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$data </span><span class="keyword">.=</span><span class="string">"Content-Disposition: form-data; name=\"userfile\"; filename=\"</span><span class="default">$file_name</span><span class="string">\"\r\n"</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$data </span><span class="keyword">.= </span><span class="string">"Content-Type: </span><span class="default">$content_type</span><span class="string">\r\n\r\n"</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$data </span><span class="keyword">.= </span><span class="string">""</span><span class="keyword">.</span><span class="default">$content_file</span><span class="keyword">.</span><span class="string">"\r\n"</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$data </span><span class="keyword">.=</span><span class="string">"--</span><span class="default">$boundary</span><span class="string">--\r\n"</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$header </span><span class="keyword">.= </span><span class="string">"Content-length: " </span><span class="keyword">. </span><span class="default">strlen</span><span class="keyword">(</span><span class="default">$data</span><span class="keyword">) . </span><span class="string">"\r\n\r\n"</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// Open the connection<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$fp </span><span class="keyword">= </span><span class="default">fsockopen</span><span class="keyword">(</span><span class="default">$remote_server</span><span class="keyword">, </span><span class="default">80</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="comment">// then just <br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">fputs</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">, </span><span class="default">$header</span><span class="keyword">.</span><span class="default">$data</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">fclose</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">);<br></span><span class="default">?&gt;</span>
</span>
</code></div>
  </div>
 </div>
  <div class="note" id="61957">  
  <a class="name">
  <strong class="user"><em>ittasks at gmail dot com</em></strong></a><div class="date" title="2006-02-15 04:02"><strong>8 years ago</strong></div>
  <div class="text" id="Hcom61957">
<div class="phpcode"><code><span class="html">
login to the site prior to downloading page:
<br>
<br>In some wierd situations site security is based on
<br> ASPSESSION ID and where could be a
<br> login asp&nbsp; script in one place, and the actual page with 
<br>information in another place.
<br>
<br>for such cases you have to submit ( POST ) you login and 
<br>password first, when grab ASP session (and also some 
<br>cookies from response, and when use that ASP SESSION in 
<br>second request to the actual page: (i took some parts of 
<br>codes from other ppl)
<br><span class="default">&lt;?php 
<br></span><span class="comment">//submit login form: (url, post data, extra headers (optional))
<br>//do not put&nbsp; http into URL, just domain name
<br></span><span class="default">$mycookies </span><span class="keyword">= </span><span class="default">GetCookies</span><span class="keyword">(</span><span class="string">"www.yourdomain.com/login.login.asp"</span><span class="keyword">,
<br></span><span class="string">"password=12345&amp;username=your_username&amp;submit=LOGIN&amp;set=Y"</span><span class="keyword">,</span><span class="string">""</span><span class="keyword">);
<br></span><span class="comment">//some extra params if you need them
<br>// echo "Cookies:&lt;br&gt;&lt;pre&gt;\n".$mycookies."\n&lt;/pre&gt;";
<br>//$body =PostPage("www.example.com/coolpage.asp",
<br>//"action=zzz",$mycookies);
<br>//echo "&lt;br&gt;Body:&lt;br&gt;\n".$body."\n";
<br>//im using get page - so it goes like this:
<br></span><span class="default">$opts </span><span class="keyword">= array(</span><span class="string">'http'</span><span class="keyword">=&gt;array(</span><span class="string">'method'</span><span class="keyword">=&gt;</span><span class="string">"GET"</span><span class="keyword">,
<br></span><span class="string">'header'</span><span class="keyword">=&gt;</span><span class="string">"Accept-language: en\r\nCookie: "</span><span class="keyword">.</span><span class="default">$mycookies</span><span class="keyword">.</span><span class="string">"\r\n" </span><span class="keyword">));
<br></span><span class="default">$context </span><span class="keyword">= </span><span class="default">stream_context_create</span><span class="keyword">(</span><span class="default">$opts</span><span class="keyword">);
<br></span><span class="default">$fp </span><span class="keyword">= </span><span class="default">fopen</span><span class="keyword">(</span><span class="string">'<a rel="nofollow" target="_blank">http://www.example.com/coolpage.asp?p1=1&amp;p2=23</a>'</span><span class="keyword">, </span><span class="string">'r'</span><span class="keyword">, </span><span class="default">false</span><span class="keyword">, </span><span class="default">$context</span><span class="keyword">);
<br></span><span class="default">fpassthru</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">);
<br></span><span class="default">$html </span><span class="keyword">= </span><span class="default">fread</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">, </span><span class="default">1000000</span><span class="keyword">);
<br></span><span class="default">fclose</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">);
<br>echo </span><span class="default">$html</span><span class="keyword">;
<br>
<br>function </span><span class="default">PostPage</span><span class="keyword">(</span><span class="default">$host</span><span class="keyword">,</span><span class="default">$query</span><span class="keyword">,</span><span class="default">$others</span><span class="keyword">=</span><span class="string">''</span><span class="keyword">){
<br>&nbsp;&nbsp; </span><span class="default">$path</span><span class="keyword">=</span><span class="default">explode</span><span class="keyword">(</span><span class="string">'/'</span><span class="keyword">,</span><span class="default">$host</span><span class="keyword">);
<br>&nbsp;&nbsp; </span><span class="default">$host</span><span class="keyword">=</span><span class="default">$path</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">];
<br>&nbsp;&nbsp; unset(</span><span class="default">$path</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">]);
<br>&nbsp;&nbsp; </span><span class="default">$path</span><span class="keyword">=</span><span class="string">'/'</span><span class="keyword">.(</span><span class="default">implode</span><span class="keyword">(</span><span class="string">'/'</span><span class="keyword">,</span><span class="default">$path</span><span class="keyword">));
<br></span><span class="default">$post</span><span class="keyword">=</span><span class="string">"POST </span><span class="default">$path</span><span class="string"> HTTP/1.1\r\nHost: </span><span class="default">$host</span><span class="string">\r\n"</span><span class="keyword">;
<br></span><span class="default">$post</span><span class="keyword">.=</span><span class="string">"Content-type: application/x-www-form-"</span><span class="keyword">;
<br></span><span class="default">$post</span><span class="keyword">.=</span><span class="string">"urlencoded\r\n</span><span class="keyword">${</span><span class="default">others</span><span class="keyword">}</span><span class="string">"</span><span class="keyword">;
<br></span><span class="default">$post</span><span class="keyword">.=</span><span class="string">"User-Agent: Mozilla 4.0\r\nContent-length: "</span><span class="keyword">;
<br></span><span class="default">$post</span><span class="keyword">.=</span><span class="default">strlen</span><span class="keyword">(</span><span class="default">$query</span><span class="keyword">).</span><span class="string">"\r\nConnection: close\r\n\r\n</span><span class="default">$query</span><span class="string">"</span><span class="keyword">;
<br>&nbsp;&nbsp; </span><span class="default">$h</span><span class="keyword">=</span><span class="default">fsockopen</span><span class="keyword">(</span><span class="default">$host</span><span class="keyword">,</span><span class="default">80</span><span class="keyword">);
<br>&nbsp;&nbsp; </span><span class="default">fwrite</span><span class="keyword">(</span><span class="default">$h</span><span class="keyword">,</span><span class="default">$post</span><span class="keyword">);
<br>&nbsp;&nbsp; for(</span><span class="default">$a</span><span class="keyword">=</span><span class="default">0</span><span class="keyword">,</span><span class="default">$r</span><span class="keyword">=</span><span class="string">''</span><span class="keyword">;!</span><span class="default">$a</span><span class="keyword">;){
<br>&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$b</span><span class="keyword">=</span><span class="default">fread</span><span class="keyword">(</span><span class="default">$h</span><span class="keyword">,</span><span class="default">8192</span><span class="keyword">);
<br>&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$r</span><span class="keyword">.=</span><span class="default">$b</span><span class="keyword">;
<br>&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$a</span><span class="keyword">=((</span><span class="default">$b</span><span class="keyword">==</span><span class="string">''</span><span class="keyword">)?</span><span class="default">1</span><span class="keyword">:</span><span class="default">0</span><span class="keyword">);
<br>&nbsp;&nbsp; }
<br>&nbsp;&nbsp; </span><span class="default">fclose</span><span class="keyword">(</span><span class="default">$h</span><span class="keyword">);
<br>&nbsp;&nbsp; return </span><span class="default">$r</span><span class="keyword">;
<br>}
<br>function </span><span class="default">GetCookies</span><span class="keyword">(</span><span class="default">$host</span><span class="keyword">,</span><span class="default">$query</span><span class="keyword">,</span><span class="default">$others</span><span class="keyword">=</span><span class="string">''</span><span class="keyword">){
<br>&nbsp;&nbsp; </span><span class="default">$path</span><span class="keyword">=</span><span class="default">explode</span><span class="keyword">(</span><span class="string">'/'</span><span class="keyword">,</span><span class="default">$host</span><span class="keyword">);
<br>&nbsp;&nbsp; </span><span class="default">$host</span><span class="keyword">=</span><span class="default">$path</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">];
<br>&nbsp;&nbsp; unset(</span><span class="default">$path</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">]);
<br>&nbsp;&nbsp; </span><span class="default">$crlf </span><span class="keyword">= </span><span class="string">"\r\n"</span><span class="keyword">;
<br>&nbsp;&nbsp; </span><span class="default">$path</span><span class="keyword">=</span><span class="string">'/'</span><span class="keyword">.(</span><span class="default">implode</span><span class="keyword">(</span><span class="string">'/'</span><span class="keyword">,</span><span class="default">$path</span><span class="keyword">));
<br>&nbsp;&nbsp; </span><span class="default">$post</span><span class="keyword">=</span><span class="string">"POST </span><span class="default">$path</span><span class="string"> HTTP/1.1\r\nHost: </span><span class="default">$host</span><span class="string">\r\n"</span><span class="keyword">;
<br></span><span class="default">$post</span><span class="keyword">.=</span><span class="string">"Content-type: application/x-www-form-urlencoded\r\n</span><span class="keyword">${</span><span class="default">others</span><span class="keyword">}</span><span class="string">"</span><span class="keyword">;
<br></span><span class="default">$post</span><span class="keyword">.=</span><span class="string">"User-Agent: Mozilla 4.0\r\nContent-length: "</span><span class="keyword">;
<br></span><span class="default">$post</span><span class="keyword">.=</span><span class="default">strlen</span><span class="keyword">(</span><span class="default">$query</span><span class="keyword">).</span><span class="string">"\r\nConnection: close\r\n\r\n</span><span class="default">$query</span><span class="string">"</span><span class="keyword">;
<br>&nbsp;&nbsp; </span><span class="default">$h</span><span class="keyword">=</span><span class="default">fsockopen</span><span class="keyword">(</span><span class="default">$host</span><span class="keyword">,</span><span class="default">80</span><span class="keyword">);
<br>&nbsp;&nbsp; </span><span class="default">fwrite</span><span class="keyword">(</span><span class="default">$h</span><span class="keyword">,</span><span class="default">$post</span><span class="keyword">);
<br>&nbsp;&nbsp; </span><span class="default">$r</span><span class="keyword">=</span><span class="string">""</span><span class="keyword">; 
<br>&nbsp;&nbsp; for(</span><span class="default">$a</span><span class="keyword">=</span><span class="default">0</span><span class="keyword">;!</span><span class="default">$a</span><span class="keyword">;){
<br>&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$b</span><span class="keyword">=</span><span class="default">fread</span><span class="keyword">(</span><span class="default">$h</span><span class="keyword">,</span><span class="default">512</span><span class="keyword">);
<br>&nbsp; &nbsp; &nbsp;&nbsp; echo </span><span class="default">$b</span><span class="keyword">;
<br>&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$r</span><span class="keyword">.=</span><span class="default">$b</span><span class="keyword">;
<br>&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$gotSession</span><span class="keyword">=</span><span class="default">strpos</span><span class="keyword">(</span><span class="default">$r</span><span class="keyword">,</span><span class="string">"ASPSESSION"</span><span class="keyword">);
<br>&nbsp;&nbsp; if(</span><span class="default">$gotSession</span><span class="keyword">)
<br>&nbsp; &nbsp; &nbsp; if(</span><span class="default">strpos</span><span class="keyword">(</span><span class="default">$r</span><span class="keyword">, </span><span class="default">$crlf </span><span class="keyword">. </span><span class="default">$crlf</span><span class="keyword">,</span><span class="default">$gotSession</span><span class="keyword">)&gt;</span><span class="default">0</span><span class="keyword">) break;
<br>&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$a</span><span class="keyword">=((</span><span class="default">$b</span><span class="keyword">==</span><span class="string">''</span><span class="keyword">)?</span><span class="default">1</span><span class="keyword">:</span><span class="default">0</span><span class="keyword">);
<br>&nbsp;&nbsp; }
<br>&nbsp;&nbsp; </span><span class="default">fclose</span><span class="keyword">(</span><span class="default">$h</span><span class="keyword">);
<br>&nbsp;&nbsp; </span><span class="default">$arr </span><span class="keyword">= </span><span class="default">split</span><span class="keyword">(</span><span class="string">"Set-Cookie:"</span><span class="keyword">,</span><span class="default">$r</span><span class="keyword">);
<br>&nbsp;&nbsp; </span><span class="default">$AllCookies</span><span class="keyword">=</span><span class="string">""</span><span class="keyword">;</span><span class="default">$count</span><span class="keyword">=</span><span class="default">1</span><span class="keyword">;
<br>&nbsp;&nbsp; while (</span><span class="default">$count </span><span class="keyword">&lt; </span><span class="default">count</span><span class="keyword">(</span><span class="default">$arr</span><span class="keyword">)) {
<br></span><span class="default">$AllCookies</span><span class="keyword">.=</span><span class="default">substr</span><span class="keyword">(</span><span class="default">$arr</span><span class="keyword">[</span><span class="default">$count</span><span class="keyword">].</span><span class="string">";"</span><span class="keyword">,
<br></span><span class="default">0</span><span class="keyword">,</span><span class="default">strpos</span><span class="keyword">(</span><span class="default">$arr</span><span class="keyword">[</span><span class="default">$count</span><span class="keyword">].</span><span class="string">";"</span><span class="keyword">,</span><span class="string">";"</span><span class="keyword">)+</span><span class="default">1</span><span class="keyword">);
<br>
<br> </span><span class="default">$count</span><span class="keyword">++;}
<br>&nbsp;&nbsp; return </span><span class="default">$AllCookies</span><span class="keyword">;
<br>
<br>}
<br> </span><span class="default">?&gt;
<br></span>
<br>It's not optimized , but i hope someone might find it usefull.
<br>Best Regards 
<br>DRY_GIN</span>
</code></div>
  </div>
 </div>
  <div class="note" id="59556">  
  <a class="name">
  <strong class="user"><em>sivann at cs dot ntua dot gr</em></strong></a><div class="date" title="2005-12-09 07:40"><strong>8 years ago</strong></div>
  <div class="text" id="Hcom59556">
<div class="phpcode"><code><span class="html">
This is an ident request example. If your client is running identd your real username will be known by the server.
<br>It is also usefull to identify people bypassing IP ACLs by using SOCKS proxy and dynamic IP forwarding. If the socks proxy server uses ident (most unices do) you will know his real username.
<br>For more information see RFC1413
<br>Timeout of 2 seconds in the example may not be enough.
<br>
<br><span class="default">&lt;?php
<br>error_reporting</span><span class="keyword">(</span><span class="default">E_ALL</span><span class="keyword">);
<br></span><span class="default">$remip </span><span class="keyword">= </span><span class="default">$HTTP_SERVER_VARS</span><span class="keyword">[</span><span class="string">'REMOTE_ADDR'</span><span class="keyword">];
<br></span><span class="default">$remport </span><span class="keyword">= </span><span class="default">$HTTP_SERVER_VARS</span><span class="keyword">[</span><span class="string">'REMOTE_PORT'</span><span class="keyword">];
<br>
<br></span><span class="default">ob_implicit_flush</span><span class="keyword">();
<br></span><span class="default">$fp </span><span class="keyword">= </span><span class="default">fsockopen</span><span class="keyword">(</span><span class="default">$remip</span><span class="keyword">, </span><span class="default">113</span><span class="keyword">, </span><span class="default">$errno</span><span class="keyword">, </span><span class="default">$errstr</span><span class="keyword">, </span><span class="default">2</span><span class="keyword">);
<br>if (!</span><span class="default">$fp</span><span class="keyword">) {
<br>&nbsp;&nbsp; echo </span><span class="string">"</span><span class="default">$errstr</span><span class="string"> (</span><span class="default">$errno</span><span class="string">)&lt;br&gt;\n"</span><span class="keyword">;
<br>&nbsp;&nbsp; exit;
<br>} 
<br>else {
<br>&nbsp;&nbsp; </span><span class="default">$out </span><span class="keyword">= </span><span class="string">"</span><span class="default">$remport</span><span class="string">, 80\r\n"</span><span class="keyword">;
<br>&nbsp;&nbsp; </span><span class="default">fwrite</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">, </span><span class="default">$out</span><span class="keyword">);
<br>&nbsp;&nbsp; </span><span class="default">$answer</span><span class="keyword">=</span><span class="default">fgets</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">, </span><span class="default">128</span><span class="keyword">);
<br>}
<br></span><span class="default">fclose</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">);
<br></span><span class="default">$ansparts</span><span class="keyword">=</span><span class="default">explode</span><span class="keyword">(</span><span class="string">":"</span><span class="keyword">,</span><span class="default">$answer</span><span class="keyword">); 
<br></span><span class="default">$user</span><span class="keyword">=</span><span class="default">chop</span><span class="keyword">(</span><span class="default">$ansparts</span><span class="keyword">[</span><span class="default">3</span><span class="keyword">]);
<br>echo </span><span class="string">"You are </span><span class="default">$user</span><span class="string">@</span><span class="default">$remip</span><span class="string">:</span><span class="default">$remport</span><span class="string">"</span><span class="keyword">;
<br>
<br></span><span class="default">?&gt;</span>
</span>
</code></div>
  </div>
 </div>
  <div class="note" id="58196">  
  <a class="name">
  <strong class="user"><em>Kiki_EF</em></strong></a><div class="date" title="2005-10-27 12:20"><strong>8 years ago</strong></div>
  <div class="text" id="Hcom58196">
<div class="phpcode"><code><span class="html">
Additional ICQ status request over proxy
<br><span class="default">&lt;?php
<br></span><span class="keyword">function </span><span class="default">icq_uin</span><span class="keyword">(</span><span class="default">$uin</span><span class="keyword">)
<br>{
<br>&nbsp; &nbsp; if (! </span><span class="default">is_numeric</span><span class="keyword">(</span><span class="default">$uin</span><span class="keyword">))
<br>&nbsp; &nbsp; &nbsp; &nbsp; return </span><span class="default">false</span><span class="keyword">;
<br>&nbsp; &nbsp; </span><span class="default">$proxy_name </span><span class="keyword">= </span><span class="string">'proxy.mydomain.de'</span><span class="keyword">;
<br>&nbsp; &nbsp; </span><span class="default">$proxy_port </span><span class="keyword">= </span><span class="default">8080</span><span class="keyword">;
<br>&nbsp; &nbsp; </span><span class="default">$proxy_user </span><span class="keyword">= </span><span class="string">""</span><span class="keyword">;
<br>&nbsp; &nbsp; </span><span class="default">$proxy_pass </span><span class="keyword">= </span><span class="string">""</span><span class="keyword">;
<br>&nbsp; &nbsp; </span><span class="default">$proxy_cont </span><span class="keyword">= </span><span class="string">''</span><span class="keyword">;
<br>&nbsp; &nbsp; </span><span class="default">$request_url </span><span class="keyword">= </span><span class="string">"<a rel="nofollow" target="_blank">http://status.icq.com/online.gif?icq=</a></span><span class="default">$uin</span><span class="string">"</span><span class="keyword">;
<br>
<br>&nbsp; &nbsp; </span><span class="default">$proxy_fp </span><span class="keyword">= </span><span class="default">fsockopen</span><span class="keyword">(</span><span class="default">$proxy_name</span><span class="keyword">, </span><span class="default">$proxy_port</span><span class="keyword">);
<br>&nbsp; &nbsp; if (!</span><span class="default">$proxy_fp</span><span class="keyword">)
<br>&nbsp; &nbsp; &nbsp; &nbsp; return </span><span class="default">false</span><span class="keyword">;
<br>&nbsp; &nbsp; </span><span class="default">fputs</span><span class="keyword">(</span><span class="default">$proxy_fp</span><span class="keyword">, </span><span class="string">"GET </span><span class="default">$request_url</span><span class="string"> HTTP/1.0\r\nHost: </span><span class="default">$proxy_name</span><span class="string">\r\n"</span><span class="keyword">);
<br>&nbsp; &nbsp; </span><span class="default">fputs</span><span class="keyword">(</span><span class="default">$proxy_fp</span><span class="keyword">, </span><span class="string">"Proxy-Authorization: Basic "</span><span class="keyword">. </span><span class="default">base64_encode </span><span class="keyword">(</span><span class="string">"</span><span class="default">$proxy_user</span><span class="string">:</span><span class="default">$proxy_pass</span><span class="string">"</span><span class="keyword">).</span><span class="string">"\r\n\r\n"</span><span class="keyword">);
<br>&nbsp; &nbsp; while(!</span><span class="default">feof</span><span class="keyword">(</span><span class="default">$proxy_fp</span><span class="keyword">)){
<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$proxy_cont </span><span class="keyword">.= </span><span class="default">fread</span><span class="keyword">(</span><span class="default">$proxy_fp</span><span class="keyword">,</span><span class="default">4096</span><span class="keyword">);
<br>&nbsp; &nbsp; }
<br>&nbsp; &nbsp; </span><span class="default">fclose</span><span class="keyword">(</span><span class="default">$proxy_fp</span><span class="keyword">);
<br>&nbsp; &nbsp; </span><span class="default">$proxy_cont </span><span class="keyword">= </span><span class="default">substr</span><span class="keyword">(</span><span class="default">$proxy_cont</span><span class="keyword">, </span><span class="default">strpos</span><span class="keyword">(</span><span class="default">$proxy_cont</span><span class="keyword">,</span><span class="string">"\r\n\r\n"</span><span class="keyword">)+</span><span class="default">4</span><span class="keyword">);
<br>&nbsp; &nbsp; if (</span><span class="default">strstr</span><span class="keyword">(</span><span class="default">$proxy_cont</span><span class="keyword">, </span><span class="string">'online1'</span><span class="keyword">))
<br>&nbsp; &nbsp; &nbsp; &nbsp; return </span><span class="string">'online'</span><span class="keyword">;
<br>&nbsp; &nbsp; if (</span><span class="default">strstr</span><span class="keyword">(</span><span class="default">$proxy_cont</span><span class="keyword">, </span><span class="string">'online0'</span><span class="keyword">))
<br>&nbsp; &nbsp; &nbsp; &nbsp; return </span><span class="string">'offline'</span><span class="keyword">;
<br>&nbsp; &nbsp; if (</span><span class="default">strstr</span><span class="keyword">(</span><span class="default">$proxy_cont</span><span class="keyword">, </span><span class="string">'online2'</span><span class="keyword">))
<br>&nbsp; &nbsp; &nbsp; &nbsp; return </span><span class="string">'disabled'</span><span class="keyword">;
<br>}
<br>echo </span><span class="string">"User is "</span><span class="keyword">.</span><span class="default">icq_uin</span><span class="keyword">(</span><span class="default">123456789012345</span><span class="keyword">);
<br></span><span class="default">?&gt;
<br></span>
<br>Thanx
<br>
<br>[EDIT BY danbrown AT php DOT net: Based on code provided in a note by (rafaelbc AT matrix DOT com DOT br) on 23-MAY-09, which has since been removed.]</span>
</code></div>
  </div>
 </div>
  <div class="note" id="55675">  
  <a class="name">
  <strong class="user"><em>dna at revold-design dot de</em></strong></a><div class="date" title="2005-08-10 05:04"><strong>9 years ago</strong></div>
  <div class="text" id="Hcom55675">
<div class="phpcode"><code><span class="html">
Something useful for ICQ:
<br><span class="default">&lt;?php
<br>$icquin </span><span class="keyword">= </span><span class="string">"197829943"</span><span class="keyword">;
<br>function </span><span class="default">GetICQ</span><span class="keyword">(</span><span class="default">$uin</span><span class="keyword">) {
<br>&nbsp; &nbsp; if (!</span><span class="default">is_numeric</span><span class="keyword">(</span><span class="default">$uin</span><span class="keyword">)) return </span><span class="default">FALSE</span><span class="keyword">;
<br>
<br>&nbsp; &nbsp; </span><span class="default">$fp </span><span class="keyword">= </span><span class="default">fsockopen</span><span class="keyword">(</span><span class="string">'status.icq.com'</span><span class="keyword">, </span><span class="default">80</span><span class="keyword">, </span><span class="default">$errno</span><span class="keyword">, </span><span class="default">$errstr</span><span class="keyword">, </span><span class="default">8</span><span class="keyword">);
<br>&nbsp; &nbsp; if (!</span><span class="default">$fp</span><span class="keyword">) {
<br>&nbsp; &nbsp; return </span><span class="string">"N/A"</span><span class="keyword">;
<br>&nbsp; &nbsp; &nbsp; &nbsp; }
<br>&nbsp; &nbsp; else {
<br>
<br>&nbsp; &nbsp; </span><span class="default">$request </span><span class="keyword">= </span><span class="string">"HEAD /online.gif?icq=</span><span class="default">$uin</span><span class="string"> HTTP/1.0\r\n"
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="keyword">.</span><span class="string">"Host: web.icq.com\r\n"
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="keyword">.</span><span class="string">"Connection: close\r\n\r\n"</span><span class="keyword">;
<br>&nbsp; &nbsp; </span><span class="default">fputs</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">, </span><span class="default">$request</span><span class="keyword">);
<br>
<br>&nbsp; &nbsp; do {
<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$response </span><span class="keyword">= </span><span class="default">fgets</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">, </span><span class="default">1024</span><span class="keyword">);
<br>&nbsp; &nbsp; }
<br>&nbsp; &nbsp; while (!</span><span class="default">feof</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">) &amp;&amp; !</span><span class="default">stristr</span><span class="keyword">(</span><span class="default">$response</span><span class="keyword">, </span><span class="string">'Location'</span><span class="keyword">));
<br>
<br>&nbsp; &nbsp; </span><span class="default">fclose</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">);
<br>
<br>&nbsp; &nbsp; if (</span><span class="default">strstr</span><span class="keyword">(</span><span class="default">$response</span><span class="keyword">, </span><span class="string">'online1'</span><span class="keyword">)) return </span><span class="string">'Online'</span><span class="keyword">;
<br>&nbsp; &nbsp; if (</span><span class="default">strstr</span><span class="keyword">(</span><span class="default">$response</span><span class="keyword">, </span><span class="string">'online0'</span><span class="keyword">)) return </span><span class="string">'Offline'</span><span class="keyword">;
<br>&nbsp; &nbsp; if (</span><span class="default">strstr</span><span class="keyword">(</span><span class="default">$response</span><span class="keyword">, </span><span class="string">'online2'</span><span class="keyword">)) return </span><span class="string">'N/A'</span><span class="keyword">;
<br>&nbsp; &nbsp; </span><span class="comment">// N/A means, this User set the Option, his Online
<br>&nbsp; &nbsp; // Status cannot be shown over the Internet
<br>&nbsp; &nbsp; 
<br>&nbsp; &nbsp; </span><span class="keyword">return </span><span class="default">FALSE</span><span class="keyword">;
<br>&nbsp; &nbsp; }
<br>}
<br>
<br>echo </span><span class="default">GetICQ</span><span class="keyword">(</span><span class="default">$icquin</span><span class="keyword">);
<br></span><span class="default">?&gt;</span>
</span>
</code></div>
  </div>
 </div>
  <div class="note" id="52033">  
  <a class="name">
  <strong class="user"><em>saul dot dobney at dobney dot com</em></strong></a><div class="date" title="2005-04-19 08:40"><strong>9 years ago</strong></div>
  <div class="text" id="Hcom52033">
<div class="phpcode"><code><span class="html">
If you are using fsockopen to access webpage, but come across a redirect (Location: ) in the header and want to find and follow the redirect as in this snippet:
<br>
<br><span class="default">&lt;?php
<br></span><span class="keyword">while (!</span><span class="default">feof</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">)) {
<br>&nbsp;&nbsp; </span><span class="default">$line</span><span class="keyword">=</span><span class="default">fgets</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">, </span><span class="default">1024</span><span class="keyword">);&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
<br>&nbsp;&nbsp; if (</span><span class="default">stristr</span><span class="keyword">(</span><span class="default">$line</span><span class="keyword">,</span><span class="string">"location:"</span><span class="keyword">)!=</span><span class="string">""</span><span class="keyword">) {
<br>&nbsp; &nbsp; </span><span class="default">$redirect</span><span class="keyword">=</span><span class="default">preg_replace</span><span class="keyword">(</span><span class="string">"/location:/i"</span><span class="keyword">,</span><span class="string">""</span><span class="keyword">,</span><span class="default">$line</span><span class="keyword">);
<br>&nbsp;&nbsp; }
<br>}
<br></span><span class="default">?&gt;
<br></span>
<br>Then don't forget to <span class="default">&lt;?php $redirect </span><span class="keyword">= </span><span class="default">trim</span><span class="keyword">(</span><span class="default">$redirect</span><span class="keyword">); </span><span class="default">?&gt;</span> before trying to follow this new link as $redirect actually has a \r\n on the end of it and won't give you a valid path in the next iteration otherwise. A six hour bug.
<br>
<br>Saul Dobney</span>
</code></div>
  </div>
 </div>
  <div class="note" id="51363">  
  <a class="name">
  <strong class="user"><em>ahauk at NO-SPAM dot synergynt dot net</em></strong></a><div class="date" title="2005-03-28 02:38"><strong>9 years ago</strong></div>
  <div class="text" id="Hcom51363">
<div class="phpcode"><code><span class="html">
The following script will login to a POP3 account using the username, password and server name provided via a standard form; determine the amount of messages using a binary search; then purge all messages.<br><br><span class="default">&lt;?php<br>&nbsp; &nbsp; $server </span><span class="keyword">= </span><span class="default">$_POST</span><span class="keyword">[</span><span class="string">"server"</span><span class="keyword">];<br>&nbsp; &nbsp; </span><span class="default">$user </span><span class="keyword">= </span><span class="default">$_POST</span><span class="keyword">[</span><span class="string">"user"</span><span class="keyword">];<br>&nbsp; &nbsp; </span><span class="default">$pass </span><span class="keyword">= </span><span class="default">$_POST</span><span class="keyword">[</span><span class="string">"pass"</span><span class="keyword">];<br>&nbsp; &nbsp; </span><span class="default">$count </span><span class="keyword">= </span><span class="default">1</span><span class="keyword">;<br>&nbsp; &nbsp; </span><span class="default">$low </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">;<br>&nbsp; &nbsp; </span><span class="default">$mid </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">;<br>&nbsp; &nbsp; </span><span class="default">$high </span><span class="keyword">= </span><span class="default">100000</span><span class="keyword">;<br>&nbsp; &nbsp; </span><span class="default">$connection </span><span class="keyword">= </span><span class="default">fsockopen</span><span class="keyword">(</span><span class="default">$server</span><span class="keyword">, </span><span class="default">110</span><span class="keyword">, </span><span class="default">$errno</span><span class="keyword">, </span><span class="default">$errstr</span><span class="keyword">, </span><span class="default">30</span><span class="keyword">);<br><br>&nbsp; &nbsp; if(!</span><span class="default">$connection</span><span class="keyword">) {<br>&nbsp; &nbsp; &nbsp; &nbsp; print </span><span class="string">"Connect Failed: </span><span class="default">$errstr</span><span class="string"> (</span><span class="default">$errno</span><span class="string">)"</span><span class="keyword">;<br>&nbsp; &nbsp; } else {<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$output </span><span class="keyword">= </span><span class="default">fgets</span><span class="keyword">(</span><span class="default">$connection</span><span class="keyword">, </span><span class="default">128</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">fputs</span><span class="keyword">(</span><span class="default">$connection</span><span class="keyword">, </span><span class="string">"user </span><span class="default">$user</span><span class="string">\n"</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$output </span><span class="keyword">= </span><span class="default">fgets</span><span class="keyword">(</span><span class="default">$connection</span><span class="keyword">, </span><span class="default">128</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">fputs</span><span class="keyword">(</span><span class="default">$connection</span><span class="keyword">, </span><span class="string">"pass </span><span class="default">$pass</span><span class="string">\n"</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$output </span><span class="keyword">= </span><span class="default">fgets</span><span class="keyword">(</span><span class="default">$connection</span><span class="keyword">, </span><span class="default">128</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; while(</span><span class="default">$low </span><span class="keyword">&lt; </span><span class="default">$high </span><span class="keyword">- </span><span class="default">1</span><span class="keyword">) {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$mid </span><span class="keyword">= </span><span class="default">floor</span><span class="keyword">((</span><span class="default">$low </span><span class="keyword">+ </span><span class="default">$high</span><span class="keyword">) / </span><span class="default">2</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">fputs</span><span class="keyword">(</span><span class="default">$connection</span><span class="keyword">, </span><span class="string">"list </span><span class="default">$mid</span><span class="string">\n"</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$output </span><span class="keyword">= </span><span class="default">fgets</span><span class="keyword">(</span><span class="default">$connection</span><span class="keyword">, </span><span class="default">128</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$subout </span><span class="keyword">= </span><span class="default">substr</span><span class="keyword">(</span><span class="default">$output</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">4</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if(</span><span class="default">$subout </span><span class="keyword">== </span><span class="string">"+OK "</span><span class="keyword">) {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$low </span><span class="keyword">= </span><span class="default">$mid</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; continue;<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; elseif(</span><span class="default">$subout </span><span class="keyword">== </span><span class="string">"-ERR"</span><span class="keyword">) {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$high </span><span class="keyword">= </span><span class="default">$mid</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; continue;<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; } else {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; break;<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; print </span><span class="string">"An error has occurred. Please try again."</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br>&nbsp; &nbsp; &nbsp; &nbsp; }<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$limit </span><span class="keyword">= </span><span class="default">$mid </span><span class="keyword">- </span><span class="default">1</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; while(</span><span class="default">$count </span><span class="keyword">&lt;= </span><span class="default">$limit</span><span class="keyword">) {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">fputs</span><span class="keyword">(</span><span class="default">$connection</span><span class="keyword">, </span><span class="string">"dele </span><span class="default">$count</span><span class="string">\n"</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">fgets</span><span class="keyword">(</span><span class="default">$connection</span><span class="keyword">, </span><span class="default">128</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$count </span><span class="keyword">= </span><span class="default">$count </span><span class="keyword">+ </span><span class="default">1</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; }<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">fputs</span><span class="keyword">(</span><span class="default">$connection</span><span class="keyword">, </span><span class="string">"quit\n"</span><span class="keyword">);<br>&nbsp; &nbsp; }<br>&nbsp; &nbsp; </span><span class="default">fclose</span><span class="keyword">(</span><span class="default">$connection</span><span class="keyword">);<br>&nbsp; &nbsp; print </span><span class="string">"Successfully removed </span><span class="default">$limit</span><span class="string"> messages."</span><span class="keyword">;<br></span><span class="default">?&gt;</span>
</span>
</code></div>
  </div>
 </div>
  <div class="note" id="50641">  
  <a class="name">
  <strong class="user"><em>lukas at MORESPAM dot jhu dot edu</em></strong></a><div class="date" title="2005-03-05 07:29"><strong>9 years ago</strong></div>
  <div class="text" id="Hcom50641">
<div class="phpcode"><code><span class="html">
Here's a function that I needed and couldn't use CURL... it helps you if you want to send the POST data (instead of GET) from one form to 2 or more other PHP scripts.&nbsp; Trust me... it's a life saver!!
<br>
<br><span class="default">&lt;?php
<br>&nbsp; &nbsp; &nbsp; </span><span class="keyword">function </span><span class="default">HTTP_Post</span><span class="keyword">(</span><span class="default">$URL</span><span class="keyword">,</span><span class="default">$data</span><span class="keyword">, </span><span class="default">$referrer</span><span class="keyword">=</span><span class="string">""</span><span class="keyword">) {
<br>
<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="comment">// parsing the given URL
<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$URL_Info</span><span class="keyword">=</span><span class="default">parse_url</span><span class="keyword">(</span><span class="default">$URL</span><span class="keyword">);
<br>
<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="comment">// Building referrer
<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="keyword">if(</span><span class="default">$referrer</span><span class="keyword">==</span><span class="string">""</span><span class="keyword">) </span><span class="comment">// if not given use this script as referrer
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$referrer</span><span class="keyword">=</span><span class="default">$_SERVER</span><span class="keyword">[</span><span class="string">"SCRIPT_URI"</span><span class="keyword">];
<br>
<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="comment">// making string from $data
<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="keyword">foreach(</span><span class="default">$data </span><span class="keyword">as </span><span class="default">$key</span><span class="keyword">=&gt;</span><span class="default">$value</span><span class="keyword">)
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$values</span><span class="keyword">[]=</span><span class="string">"</span><span class="default">$key</span><span class="string">="</span><span class="keyword">.</span><span class="default">urlencode</span><span class="keyword">(</span><span class="default">$value</span><span class="keyword">);
<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$data_string</span><span class="keyword">=</span><span class="default">implode</span><span class="keyword">(</span><span class="string">"&amp;"</span><span class="keyword">,</span><span class="default">$values</span><span class="keyword">);
<br>
<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="comment">// Find out which port is needed - if not given use standard (=80)
<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="keyword">if(!isset(</span><span class="default">$URL_Info</span><span class="keyword">[</span><span class="string">"port"</span><span class="keyword">]))
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$URL_Info</span><span class="keyword">[</span><span class="string">"port"</span><span class="keyword">]=</span><span class="default">80</span><span class="keyword">;
<br>
<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="comment">// building POST-request:
<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$request</span><span class="keyword">.=</span><span class="string">"POST "</span><span class="keyword">.</span><span class="default">$URL_Info</span><span class="keyword">[</span><span class="string">"path"</span><span class="keyword">].</span><span class="string">" HTTP/1.1\n"</span><span class="keyword">;
<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$request</span><span class="keyword">.=</span><span class="string">"Host: "</span><span class="keyword">.</span><span class="default">$URL_Info</span><span class="keyword">[</span><span class="string">"host"</span><span class="keyword">].</span><span class="string">"\n"</span><span class="keyword">;
<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$request</span><span class="keyword">.=</span><span class="string">"Referer: </span><span class="default">$referer</span><span class="string">\n"</span><span class="keyword">;
<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$request</span><span class="keyword">.=</span><span class="string">"Content-type: application/x-www-form-urlencoded\n"</span><span class="keyword">;
<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$request</span><span class="keyword">.=</span><span class="string">"Content-length: "</span><span class="keyword">.</span><span class="default">strlen</span><span class="keyword">(</span><span class="default">$data_string</span><span class="keyword">).</span><span class="string">"\n"</span><span class="keyword">;
<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$request</span><span class="keyword">.=</span><span class="string">"Connection: close\n"</span><span class="keyword">;
<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$request</span><span class="keyword">.=</span><span class="string">"\n"</span><span class="keyword">;
<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$request</span><span class="keyword">.=</span><span class="default">$data_string</span><span class="keyword">.</span><span class="string">"\n"</span><span class="keyword">;
<br>
<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$fp </span><span class="keyword">= </span><span class="default">fsockopen</span><span class="keyword">(</span><span class="default">$URL_Info</span><span class="keyword">[</span><span class="string">"host"</span><span class="keyword">],</span><span class="default">$URL_Info</span><span class="keyword">[</span><span class="string">"port"</span><span class="keyword">]);
<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">fputs</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">, </span><span class="default">$request</span><span class="keyword">);
<br>&nbsp; &nbsp; &nbsp; &nbsp; while(!</span><span class="default">feof</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">)) {
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$result </span><span class="keyword">.= </span><span class="default">fgets</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">, </span><span class="default">128</span><span class="keyword">);
<br>&nbsp; &nbsp; &nbsp; &nbsp; }
<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">fclose</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">);
<br>
<br>&nbsp; &nbsp; &nbsp; &nbsp; return </span><span class="default">$result</span><span class="keyword">;
<br>&nbsp; &nbsp; &nbsp; }
<br>
<br>&nbsp; &nbsp; &nbsp; </span><span class="default">$output1</span><span class="keyword">=</span><span class="default">HTTP_Post</span><span class="keyword">(</span><span class="string">"<a rel="nofollow" target="_blank">http://www.example.com/script1.php</a>"</span><span class="keyword">,</span><span class="default">$_POST</span><span class="keyword">);
<br>&nbsp; &nbsp; &nbsp; </span><span class="default">$output2</span><span class="keyword">=</span><span class="default">HTTP_Post</span><span class="keyword">(</span><span class="string">"<a rel="nofollow" target="_blank">http://www.example.net/script2.php</a>"</span><span class="keyword">,</span><span class="default">$_POST</span><span class="keyword">);
<br></span><span class="default">?&gt;</span>
</span>
</code></div>
  </div>
 </div>
  <div class="note" id="50293">  
  <a class="name">
  <strong class="user"><em>dante at dantecubed dot com</em></strong></a><div class="date" title="2005-02-23 04:00"><strong>9 years ago</strong></div>
  <div class="text" id="Hcom50293">
<div class="phpcode"><code><span class="html">
You may be able to speed this function up by using an IP address instead of a domain. PHP uses getHostByAddr internally in this function anyway, so you can save a step in the function process.</span>
</code></div>
  </div>
 </div>
  <div class="note" id="49938">  
  <a class="name">
  <strong class="user"><em>konrad dot meyer at gmail dot com</em></strong></a><div class="date" title="2005-02-12 01:34"><strong>9 years ago</strong></div>
  <div class="text" id="Hcom49938">
<div class="phpcode"><code><span class="html">
The documentation example is of a GET request. I have found POST documentation to be lacking, and here's a function to easily simulate submitting form data:<br><br><span class="default">&lt;?php<br></span><span class="comment"># $host includes host and path and filename<br>&nbsp; &nbsp; # ex: "myserver.com/this/is/path/to/file.php"<br># $query is the POST query data<br>&nbsp; &nbsp; # ex: "a=thisstring&amp;number=46&amp;string=thatstring<br># $others is any extra headers you want to send<br>&nbsp; &nbsp; # ex: "Accept-Encoding: compress, gzip\r\n"<br></span><span class="keyword">function </span><span class="default">post</span><span class="keyword">(</span><span class="default">$host</span><span class="keyword">,</span><span class="default">$query</span><span class="keyword">,</span><span class="default">$others</span><span class="keyword">=</span><span class="string">''</span><span class="keyword">){<br>&nbsp; &nbsp; </span><span class="default">$path</span><span class="keyword">=</span><span class="default">explode</span><span class="keyword">(</span><span class="string">'/'</span><span class="keyword">,</span><span class="default">$host</span><span class="keyword">);<br>&nbsp; &nbsp; </span><span class="default">$host</span><span class="keyword">=</span><span class="default">$path</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">];<br>&nbsp; &nbsp; unset(</span><span class="default">$path</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">]);<br>&nbsp; &nbsp; </span><span class="default">$path</span><span class="keyword">=</span><span class="string">'/'</span><span class="keyword">.(</span><span class="default">implode</span><span class="keyword">(</span><span class="string">'/'</span><span class="keyword">,</span><span class="default">$path</span><span class="keyword">));<br>&nbsp; &nbsp; </span><span class="default">$post</span><span class="keyword">=</span><span class="string">"POST </span><span class="default">$path</span><span class="string"> HTTP/1.1\r\nHost: </span><span class="default">$host</span><span class="string">\r\nContent-type: application/x-www-form-urlencoded\r\n</span><span class="keyword">${</span><span class="default">others</span><span class="keyword">}</span><span class="string">User-Agent: Mozilla 4.0\r\nContent-length: "</span><span class="keyword">.</span><span class="default">strlen</span><span class="keyword">(</span><span class="default">$query</span><span class="keyword">).</span><span class="string">"\r\nConnection: close\r\n\r\n</span><span class="default">$query</span><span class="string">"</span><span class="keyword">;<br>&nbsp; &nbsp; </span><span class="default">$h</span><span class="keyword">=</span><span class="default">fsockopen</span><span class="keyword">(</span><span class="default">$host</span><span class="keyword">,</span><span class="default">80</span><span class="keyword">);<br>&nbsp; &nbsp; </span><span class="default">fwrite</span><span class="keyword">(</span><span class="default">$h</span><span class="keyword">,</span><span class="default">$post</span><span class="keyword">);<br>&nbsp; &nbsp; for(</span><span class="default">$a</span><span class="keyword">=</span><span class="default">0</span><span class="keyword">,</span><span class="default">$r</span><span class="keyword">=</span><span class="string">''</span><span class="keyword">;!</span><span class="default">$a</span><span class="keyword">;){<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$b</span><span class="keyword">=</span><span class="default">fread</span><span class="keyword">(</span><span class="default">$h</span><span class="keyword">,</span><span class="default">8192</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$r</span><span class="keyword">.=</span><span class="default">$b</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$a</span><span class="keyword">=((</span><span class="default">$b</span><span class="keyword">==</span><span class="string">''</span><span class="keyword">)?</span><span class="default">1</span><span class="keyword">:</span><span class="default">0</span><span class="keyword">);<br>&nbsp; &nbsp; }<br>&nbsp; &nbsp; </span><span class="default">fclose</span><span class="keyword">(</span><span class="default">$h</span><span class="keyword">);<br>&nbsp; &nbsp; return </span><span class="default">$r</span><span class="keyword">;<br>}<br></span><span class="default">?&gt;</span>
</span>
</code></div>
  </div>
 </div>
  <div class="note" id="47845">  
  <a class="name">
  <strong class="user"><em>edwin at bitstorm dot org</em></strong></a><div class="date" title="2004-12-02 05:50"><strong>9 years ago</strong></div>
  <div class="text" id="Hcom47845">
<div class="phpcode"><code><span class="html">
Here's a function to just fetch the contents behind an URL.<br><br><span class="default">&lt;?php<br></span><span class="keyword">function </span><span class="default">fetchURL</span><span class="keyword">( </span><span class="default">$url </span><span class="keyword">) {<br>&nbsp; &nbsp; </span><span class="default">$url_parsed </span><span class="keyword">= </span><span class="default">parse_url</span><span class="keyword">(</span><span class="default">$url</span><span class="keyword">);<br>&nbsp; &nbsp; </span><span class="default">$host </span><span class="keyword">= </span><span class="default">$url_parsed</span><span class="keyword">[</span><span class="string">"host"</span><span class="keyword">];<br>&nbsp; &nbsp; </span><span class="default">$port </span><span class="keyword">= </span><span class="default">$url_parsed</span><span class="keyword">[</span><span class="string">"port"</span><span class="keyword">];<br>&nbsp; &nbsp; if (</span><span class="default">$port</span><span class="keyword">==</span><span class="default">0</span><span class="keyword">)<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$port </span><span class="keyword">= </span><span class="default">80</span><span class="keyword">;<br>&nbsp; &nbsp; </span><span class="default">$path </span><span class="keyword">= </span><span class="default">$url_parsed</span><span class="keyword">[</span><span class="string">"path"</span><span class="keyword">];<br>&nbsp; &nbsp; if (</span><span class="default">$url_parsed</span><span class="keyword">[</span><span class="string">"query"</span><span class="keyword">] != </span><span class="string">""</span><span class="keyword">)<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$path </span><span class="keyword">.= </span><span class="string">"?"</span><span class="keyword">.</span><span class="default">$url_parsed</span><span class="keyword">[</span><span class="string">"query"</span><span class="keyword">];<br><br>&nbsp; &nbsp; </span><span class="default">$out </span><span class="keyword">= </span><span class="string">"GET </span><span class="default">$path</span><span class="string"> HTTP/1.0\r\nHost: </span><span class="default">$host</span><span class="string">\r\n\r\n"</span><span class="keyword">;<br><br>&nbsp; &nbsp; </span><span class="default">$fp </span><span class="keyword">= </span><span class="default">fsockopen</span><span class="keyword">(</span><span class="default">$host</span><span class="keyword">, </span><span class="default">$port</span><span class="keyword">, </span><span class="default">$errno</span><span class="keyword">, </span><span class="default">$errstr</span><span class="keyword">, </span><span class="default">30</span><span class="keyword">);<br><br>&nbsp; &nbsp; </span><span class="default">fwrite</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">, </span><span class="default">$out</span><span class="keyword">);<br>&nbsp; &nbsp; </span><span class="default">$body </span><span class="keyword">= </span><span class="default">false</span><span class="keyword">;<br>&nbsp; &nbsp; while (!</span><span class="default">feof</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">)) {<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$s </span><span class="keyword">= </span><span class="default">fgets</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">, </span><span class="default">1024</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; if ( </span><span class="default">$body </span><span class="keyword">)<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$in </span><span class="keyword">.= </span><span class="default">$s</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; if ( </span><span class="default">$s </span><span class="keyword">== </span><span class="string">"\r\n" </span><span class="keyword">)<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$body </span><span class="keyword">= </span><span class="default">true</span><span class="keyword">;<br>&nbsp; &nbsp; }<br>&nbsp; &nbsp; <br>&nbsp; &nbsp; </span><span class="default">fclose</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">);<br>&nbsp; &nbsp; <br>&nbsp; &nbsp; return </span><span class="default">$in</span><span class="keyword">;<br>}<br></span><span class="default">?&gt;</span>
</span>
</code></div>
  </div>
 </div>
  <div class="note" id="46836">  
  <a class="name">
  <strong class="user"><em>michiel at parse dot nl</em></strong></a><div class="date" title="2004-10-25 04:42"><strong>9 years ago</strong></div>
  <div class="text" id="Hcom46836">
<div class="phpcode"><code><span class="html">
The following snippet allows you to retrieve the title of a page.
<br>
<br>Great for rewriting auto-url detectors to display the actual title rather then <a rel="nofollow" target="_blank">http://...</a>
<br>
<br><span class="default">&lt;?php
<br></span><span class="keyword">echo </span><span class="default">get_url_title</span><span class="keyword">(</span><span class="string">"<a rel="nofollow" target="_blank">http://www.php.net/cal.php?id=409</a>"</span><span class="keyword">);
<br>
<br>function </span><span class="default">get_url_title</span><span class="keyword">(</span><span class="default">$url</span><span class="keyword">, </span><span class="default">$timeout </span><span class="keyword">= </span><span class="default">2</span><span class="keyword">)
<br>{
<br>&nbsp; &nbsp; </span><span class="default">$url </span><span class="keyword">= </span><span class="default">parse_url</span><span class="keyword">(</span><span class="default">$url</span><span class="keyword">);
<br>
<br>&nbsp; &nbsp; if(!</span><span class="default">in_array</span><span class="keyword">(</span><span class="default">$url</span><span class="keyword">[</span><span class="string">'scheme'</span><span class="keyword">],array(</span><span class="string">''</span><span class="keyword">,</span><span class="string">'http'</span><span class="keyword">)))
<br>&nbsp; &nbsp; &nbsp; &nbsp; return;
<br>
<br>&nbsp; &nbsp; </span><span class="default">$fp </span><span class="keyword">= </span><span class="default">fsockopen </span><span class="keyword">(</span><span class="default">$url</span><span class="keyword">[</span><span class="string">'host'</span><span class="keyword">], (</span><span class="default">$url</span><span class="keyword">[</span><span class="string">'port'</span><span class="keyword">] &gt; </span><span class="default">0 </span><span class="keyword">? </span><span class="default">$url</span><span class="keyword">[</span><span class="string">'port'</span><span class="keyword">] : </span><span class="default">80</span><span class="keyword">), </span><span class="default">$errno</span><span class="keyword">, </span><span class="default">$errstr</span><span class="keyword">, </span><span class="default">$timeout</span><span class="keyword">);
<br>&nbsp; &nbsp; if (!</span><span class="default">$fp</span><span class="keyword">)
<br>&nbsp; &nbsp; {
<br>&nbsp; &nbsp; &nbsp; &nbsp; return;
<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="comment">// echo "$errstr ($errno)&lt;br&gt;\n";
<br>&nbsp; &nbsp; </span><span class="keyword">}
<br>&nbsp; &nbsp; else
<br>&nbsp; &nbsp; {
<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">fputs </span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">, </span><span class="string">"GET /"</span><span class="keyword">.</span><span class="default">$url</span><span class="keyword">[</span><span class="string">'path'</span><span class="keyword">].(</span><span class="default">$url</span><span class="keyword">[</span><span class="string">'query'</span><span class="keyword">] ? </span><span class="string">'?'</span><span class="keyword">.</span><span class="default">$url</span><span class="keyword">[</span><span class="string">'query'</span><span class="keyword">] : </span><span class="string">''</span><span class="keyword">).</span><span class="string">" HTTP/1.0\r\nHost: "</span><span class="keyword">.</span><span class="default">$url</span><span class="keyword">[</span><span class="string">'host'</span><span class="keyword">].</span><span class="string">"\r\n\r\n"</span><span class="keyword">);
<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$d </span><span class="keyword">= </span><span class="string">''</span><span class="keyword">;
<br>&nbsp; &nbsp; &nbsp; &nbsp; while (!</span><span class="default">feof</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">))
<br>&nbsp; &nbsp; &nbsp; &nbsp; {
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$d </span><span class="keyword">.= </span><span class="default">fgets </span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">,</span><span class="default">2048</span><span class="keyword">);
<br>
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if(</span><span class="default">preg_match</span><span class="keyword">(</span><span class="string">'~(&lt;/head&gt;|&lt;body&gt;|(&lt;title&gt;\s*(.*?)\s*&lt;/title&gt;))~i'</span><span class="keyword">, </span><span class="default">$d</span><span class="keyword">, </span><span class="default">$m</span><span class="keyword">))
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; break;
<br>&nbsp; &nbsp; &nbsp; &nbsp; }
<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">fclose </span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">);
<br>
<br>&nbsp; &nbsp; &nbsp; &nbsp; return </span><span class="default">$m</span><span class="keyword">[</span><span class="default">3</span><span class="keyword">];
<br>&nbsp; &nbsp; }
<br>}
<br></span><span class="default">?&gt;</span>
</span>
</code></div>
  </div>
 </div>
  <div class="note" id="40836">  
  <a class="name">
  <strong class="user"><em>alex at renesource dot lv</em></strong></a><div class="date" title="2004-03-16 11:07"><strong>10 years ago</strong></div>
  <div class="text" id="Hcom40836">
<div class="phpcode"><code><span class="html">
Set up SSL connection to server that requires client certificate:
<br>
<br>Convert client certificate from *.pfx (pkcs12) into*.pem with openssl (if needed):
<br>
<br>&gt; openssl pkcs12 -in keys.pfx -out keys.pem
<br>
<br>PHP:
<br>
<br><span class="default">&lt;?php
<br>$context </span><span class="keyword">= </span><span class="default">stream_context_create</span><span class="keyword">();
<br></span><span class="default">$result </span><span class="keyword">= </span><span class="default">stream_context_set_option</span><span class="keyword">(</span><span class="default">$context</span><span class="keyword">, </span><span class="string">'ssl'</span><span class="keyword">, </span><span class="string">'local_cert'</span><span class="keyword">, </span><span class="string">'/path/to/keys.pem'</span><span class="keyword">);
<br></span><span class="default">$result </span><span class="keyword">= </span><span class="default">stream_context_set_option</span><span class="keyword">(</span><span class="default">$context</span><span class="keyword">, </span><span class="string">'ssl'</span><span class="keyword">, </span><span class="string">'passphrase'</span><span class="keyword">, </span><span class="string">'pass_to_access_keys'</span><span class="keyword">);
<br>
<br></span><span class="default">$socket </span><span class="keyword">= </span><span class="default">fsockopen</span><span class="keyword">(</span><span class="string">'ssl://'</span><span class="keyword">.</span><span class="default">$host</span><span class="keyword">, </span><span class="default">443</span><span class="keyword">, </span><span class="default">$errno</span><span class="keyword">, </span><span class="default">$errstr</span><span class="keyword">, </span><span class="default">30</span><span class="keyword">, </span><span class="default">$context</span><span class="keyword">);
<br></span><span class="default">?&gt;</span>
</span>
</code></div>
  </div>
 </div>
  <div class="note" id="39948">  
  <a class="name">
  <strong class="user"><em>jack at jtr dot de</em></strong></a><div class="date" title="2004-02-16 02:05"><strong>10 years ago</strong></div>
  <div class="text" id="Hcom39948">
<div class="phpcode"><code><span class="html">
Here is a function for testing a website/URI for availability:<br><br><span class="default">&lt;?php<br>&nbsp; &nbsp; </span><span class="comment">/*<br>&nbsp; &nbsp; * @return boolean<br>&nbsp; &nbsp; * @param&nbsp; string $link<br>&nbsp; &nbsp; * @desc&nbsp;&nbsp; �berpr�ft die angegeben URL auf Erreichbarkeit (HTTP-Code: 200)<br>&nbsp; &nbsp; */<br>&nbsp; &nbsp; </span><span class="keyword">function </span><span class="default">url_validate</span><span class="keyword">( </span><span class="default">$link </span><span class="keyword">)<br>&nbsp; &nbsp; {&nbsp; &nbsp; &nbsp; &nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$url_parts </span><span class="keyword">= @</span><span class="default">parse_url</span><span class="keyword">( </span><span class="default">$link </span><span class="keyword">);<br><br>&nbsp; &nbsp; &nbsp; &nbsp; if ( empty( </span><span class="default">$url_parts</span><span class="keyword">[</span><span class="string">"host"</span><span class="keyword">] ) ) return( </span><span class="default">false </span><span class="keyword">);<br><br>&nbsp; &nbsp; &nbsp; &nbsp; if ( !empty( </span><span class="default">$url_parts</span><span class="keyword">[</span><span class="string">"path"</span><span class="keyword">] ) )<br>&nbsp; &nbsp; &nbsp; &nbsp; {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$documentpath </span><span class="keyword">= </span><span class="default">$url_parts</span><span class="keyword">[</span><span class="string">"path"</span><span class="keyword">];<br>&nbsp; &nbsp; &nbsp; &nbsp; }<br>&nbsp; &nbsp; &nbsp; &nbsp; else<br>&nbsp; &nbsp; &nbsp; &nbsp; {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$documentpath </span><span class="keyword">= </span><span class="string">"/"</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; }<br><br>&nbsp; &nbsp; &nbsp; &nbsp; if ( !empty( </span><span class="default">$url_parts</span><span class="keyword">[</span><span class="string">"query"</span><span class="keyword">] ) )<br>&nbsp; &nbsp; &nbsp; &nbsp; {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$documentpath </span><span class="keyword">.= </span><span class="string">"?" </span><span class="keyword">. </span><span class="default">$url_parts</span><span class="keyword">[</span><span class="string">"query"</span><span class="keyword">];<br>&nbsp; &nbsp; &nbsp; &nbsp; }<br><br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$host </span><span class="keyword">= </span><span class="default">$url_parts</span><span class="keyword">[</span><span class="string">"host"</span><span class="keyword">];<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$port </span><span class="keyword">= </span><span class="default">$url_parts</span><span class="keyword">[</span><span class="string">"port"</span><span class="keyword">];<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="comment">// Now (HTTP-)GET $documentpath at $host";<br><br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="keyword">if (empty( </span><span class="default">$port </span><span class="keyword">) ) </span><span class="default">$port </span><span class="keyword">= </span><span class="string">"80"</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$socket </span><span class="keyword">= @</span><span class="default">fsockopen</span><span class="keyword">( </span><span class="default">$host</span><span class="keyword">, </span><span class="default">$port</span><span class="keyword">, </span><span class="default">$errno</span><span class="keyword">, </span><span class="default">$errstr</span><span class="keyword">, </span><span class="default">30 </span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; if (!</span><span class="default">$socket</span><span class="keyword">)<br>&nbsp; &nbsp; &nbsp; &nbsp; {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; return(</span><span class="default">false</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; }<br>&nbsp; &nbsp; &nbsp; &nbsp; else<br>&nbsp; &nbsp; &nbsp; &nbsp; {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">fwrite </span><span class="keyword">(</span><span class="default">$socket</span><span class="keyword">, </span><span class="string">"HEAD "</span><span class="keyword">.</span><span class="default">$documentpath</span><span class="keyword">.</span><span class="string">" HTTP/1.0\r\nHost: </span><span class="default">$host</span><span class="string">\r\n\r\n"</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$http_response </span><span class="keyword">= </span><span class="default">fgets</span><span class="keyword">( </span><span class="default">$socket</span><span class="keyword">, </span><span class="default">22 </span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if ( </span><span class="default">ereg</span><span class="keyword">(</span><span class="string">"200 OK"</span><span class="keyword">, </span><span class="default">$http_response</span><span class="keyword">, </span><span class="default">$regs </span><span class="keyword">) )<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; return(</span><span class="default">true</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">fclose</span><span class="keyword">( </span><span class="default">$socket </span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; } else<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br></span><span class="comment">//&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; echo "HTTP-Response: $http_response&lt;br&gt;";<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="keyword">return(</span><span class="default">false</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br>&nbsp; &nbsp; &nbsp; &nbsp; }<br>&nbsp; &nbsp; }<br></span><span class="default">?&gt;</span>
</span>
</code></div>
  </div>
 </div>
  <div class="note" id="39868">  
  <a class="name">
  <strong class="user"><em>sir_reality2001 at yahoo dot com</em></strong></a><div class="date" title="2004-02-13 09:45"><strong>10 years ago</strong></div>
  <div class="text" id="Hcom39868">
<div class="phpcode"><code><span class="html">
<span class="default">&lt;?php
<br></span><span class="comment">// This script is an example of posting multiple files using 
<br>// fsockopen.
<br>// The tricky part is making sure the HTTP headers and file boundaries are acceptable to the target webserver.
<br>// This script is for example purposes only and could/should be improved upon.
<br>
<br></span><span class="default">$host</span><span class="keyword">=</span><span class="string">'targethost'</span><span class="keyword">;
<br></span><span class="default">$port</span><span class="keyword">=</span><span class="default">80</span><span class="keyword">;
<br></span><span class="default">$path</span><span class="keyword">=</span><span class="string">'/test/socket/file_upload/receive_files.php'</span><span class="keyword">;
<br>
<br></span><span class="comment">// the file you want to upload 
<br></span><span class="default">$file_array</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">] = </span><span class="string">"dingoboy.gif"</span><span class="keyword">; </span><span class="comment">// the file 
<br></span><span class="default">$file_array</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">] = </span><span class="string">"dingoboy2.gif"</span><span class="keyword">; </span><span class="comment">// the file 
<br></span><span class="default">$file_array</span><span class="keyword">[</span><span class="default">2</span><span class="keyword">] = </span><span class="string">"dingoboy3.gif"</span><span class="keyword">; </span><span class="comment">// the file 
<br></span><span class="default">$content_type </span><span class="keyword">= </span><span class="string">"image/gif"</span><span class="keyword">; </span><span class="comment">// the file mime type
<br>//$content_type = "text/plain";
<br>//echo "file_array[0]:$file_array[0]&lt;br&gt;&lt;br&gt;";
<br>
<br></span><span class="default">srand</span><span class="keyword">((double)</span><span class="default">microtime</span><span class="keyword">()*</span><span class="default">1000000</span><span class="keyword">);
<br></span><span class="default">$boundary </span><span class="keyword">= </span><span class="string">"---------------------------"</span><span class="keyword">.</span><span class="default">substr</span><span class="keyword">(</span><span class="default">md5</span><span class="keyword">(</span><span class="default">rand</span><span class="keyword">(</span><span class="default">0</span><span class="keyword">,</span><span class="default">32000</span><span class="keyword">)),</span><span class="default">0</span><span class="keyword">,</span><span class="default">10</span><span class="keyword">);
<br>
<br></span><span class="default">$data </span><span class="keyword">= </span><span class="string">"--</span><span class="default">$boundary</span><span class="string">"</span><span class="keyword">;
<br>
<br>for(</span><span class="default">$i</span><span class="keyword">=</span><span class="default">0</span><span class="keyword">;</span><span class="default">$i</span><span class="keyword">&lt;</span><span class="default">count</span><span class="keyword">(</span><span class="default">$file_array</span><span class="keyword">);</span><span class="default">$i</span><span class="keyword">++){
<br>&nbsp;&nbsp; </span><span class="default">$content_file </span><span class="keyword">= </span><span class="default">join</span><span class="keyword">(</span><span class="string">""</span><span class="keyword">, </span><span class="default">file</span><span class="keyword">(</span><span class="default">$file_array</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">]));
<br>
<br>&nbsp;&nbsp; </span><span class="default">$data</span><span class="keyword">.=</span><span class="string">"
<br>Content-Disposition: form-data; name=\"file"</span><span class="keyword">.(</span><span class="default">$i</span><span class="keyword">+</span><span class="default">1</span><span class="keyword">).</span><span class="string">"\"; filename=\"</span><span class="default">$file_array</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">]</span><span class="string">\"
<br>Content-Type: </span><span class="default">$content_type</span><span class="string"> 
<br>
<br></span><span class="default">$content_file</span><span class="string">
<br>--</span><span class="default">$boundary</span><span class="string">"</span><span class="keyword">;
<br>
<br>}
<br>
<br></span><span class="default">$data</span><span class="keyword">.=</span><span class="string">"--\r\n\r\n"</span><span class="keyword">;
<br>
<br></span><span class="default">$msg </span><span class="keyword">=
<br></span><span class="string">"POST </span><span class="default">$path</span><span class="string"> HTTP/1.0
<br>Content-Type: multipart/form-data; boundary=</span><span class="default">$boundary</span><span class="string">
<br>Content-Length: "</span><span class="keyword">.</span><span class="default">strlen</span><span class="keyword">(</span><span class="default">$data</span><span class="keyword">).</span><span class="string">"\r\n\r\n"</span><span class="keyword">;
<br>
<br></span><span class="default">$result</span><span class="keyword">=</span><span class="string">""</span><span class="keyword">;
<br>
<br></span><span class="comment">// open the connection
<br></span><span class="default">$f </span><span class="keyword">= </span><span class="default">fsockopen</span><span class="keyword">(</span><span class="default">$host</span><span class="keyword">, </span><span class="default">$port</span><span class="keyword">);
<br>
<br></span><span class="default">fputs</span><span class="keyword">(</span><span class="default">$f</span><span class="keyword">,</span><span class="default">$msg</span><span class="keyword">.</span><span class="default">$data</span><span class="keyword">);
<br>
<br></span><span class="comment">// get the response
<br></span><span class="keyword">while (!</span><span class="default">feof</span><span class="keyword">(</span><span class="default">$f</span><span class="keyword">)) </span><span class="default">$result </span><span class="keyword">.= </span><span class="default">fread</span><span class="keyword">(</span><span class="default">$f</span><span class="keyword">,</span><span class="default">32000</span><span class="keyword">);
<br>
<br></span><span class="default">fclose</span><span class="keyword">(</span><span class="default">$f</span><span class="keyword">);
<br>
<br></span><span class="default">?&gt;</span>
</span>
</code></div>
  </div>
 </div>
  <div class="note" id="39295">  
  <a class="name">
  <strong class="user"><em>rob at robhulme dot com</em></strong></a><div class="date" title="2004-01-23 09:17"><strong>10 years ago</strong></div>
  <div class="text" id="Hcom39295">
<div class="phpcode"><code><span class="html">
Just a note to everyone who is using fsockopen and fread / fgets for a HTTP connection.<br><br>Unless you specify "Connection: Close" in your headers you will need to wait for the socket to time out before feof($streamPointer) to return true.<br><br>This has wasted 2 days of my time, grr!<br><br>-Rob</span>
</code></div>
  </div>
 </div>
  <div class="note" id="36819">  
  <a class="name">
  <strong class="user"><em>terminal</em></strong></a><div class="date" title="2003-10-23 12:30"><strong>10 years ago</strong></div>
  <div class="text" id="Hcom36819">
<div class="phpcode"><code><span class="html">
Try this.<br>Use AUTH when necessary.<br>Read RFC 821 when having problems.<br><br><span class="default">&lt;?php<br><br>&nbsp; &nbsp; $handle </span><span class="keyword">= </span><span class="default">smtp_connect</span><span class="keyword">(</span><span class="default">$smtp_server</span><span class="keyword">, </span><span class="default">25</span><span class="keyword">, </span><span class="default">30</span><span class="keyword">, </span><span class="default">1</span><span class="keyword">, </span><span class="default">1</span><span class="keyword">, </span><span class="default">1</span><span class="keyword">);<br>&nbsp; &nbsp; echo </span><span class="default">smtp_command</span><span class="keyword">(</span><span class="default">$handle</span><span class="keyword">, </span><span class="string">"EHLO </span><span class="default">$domain</span><span class="string">\r\n"</span><span class="keyword">, </span><span class="default">1</span><span class="keyword">, </span><span class="default">1</span><span class="keyword">);<br>&nbsp; &nbsp; echo </span><span class="default">smtp_command</span><span class="keyword">(</span><span class="default">$handle</span><span class="keyword">, </span><span class="string">"MAIL FROM:&lt;</span><span class="default">$from_mail</span><span class="string">&gt;\r\n"</span><span class="keyword">, </span><span class="default">1</span><span class="keyword">, </span><span class="default">1</span><span class="keyword">);<br>&nbsp; &nbsp; echo </span><span class="default">smtp_command</span><span class="keyword">(</span><span class="default">$handle</span><span class="keyword">, </span><span class="string">"RCPT TO:&lt;</span><span class="default">$to_mail</span><span class="string">&gt;\r\n"</span><span class="keyword">, </span><span class="default">1</span><span class="keyword">, </span><span class="default">1</span><span class="keyword">);<br>&nbsp; &nbsp; echo </span><span class="default">smtp_command</span><span class="keyword">(</span><span class="default">$handle</span><span class="keyword">, </span><span class="string">"DATA\r\n"</span><span class="keyword">, </span><span class="default">1</span><span class="keyword">, </span><span class="default">1</span><span class="keyword">);<br>&nbsp; &nbsp; echo </span><span class="default">smtp_command</span><span class="keyword">(</span><span class="default">$handle</span><span class="keyword">, </span><span class="string">"</span><span class="default">$message</span><span class="string">\r\n.\r\n"</span><span class="keyword">, </span><span class="default">1</span><span class="keyword">, </span><span class="default">1</span><span class="keyword">);<br>&nbsp; &nbsp; </span><span class="comment">// don't do it like this - it will hang up<br>&nbsp; &nbsp; // echo smtp_command($handle, "$message", 1, 1);<br>&nbsp; &nbsp; // echo smtp_command($handle, "\r\n.\r\n", 1, 1);<br>&nbsp; &nbsp; </span><span class="keyword">echo </span><span class="default">smtp_command</span><span class="keyword">(</span><span class="default">$handle</span><span class="keyword">, </span><span class="string">"QUIT\r\n"</span><span class="keyword">, </span><span class="default">1</span><span class="keyword">, </span><span class="default">1</span><span class="keyword">);<br>&nbsp; &nbsp; </span><span class="default">smtp_close</span><span class="keyword">(</span><span class="default">$handle</span><span class="keyword">); <br>&nbsp; &nbsp; <br>&nbsp; &nbsp; <br>&nbsp; &nbsp; function </span><span class="default">smtp_connect</span><span class="keyword">(</span><span class="default">$host</span><span class="keyword">, </span><span class="default">$port</span><span class="keyword">, </span><span class="default">$timeout</span><span class="keyword">=</span><span class="default">30</span><span class="keyword">, </span><span class="default">$echo_command</span><span class="keyword">=</span><span class="default">False</span><span class="keyword">, </span><span class="default">$echo_response</span><span class="keyword">=</span><span class="default">False</span><span class="keyword">, </span><span class="default">$nl2br</span><span class="keyword">=</span><span class="default">False</span><span class="keyword">)<br>&nbsp; &nbsp; {<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$errno </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$errstr </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; if(</span><span class="default">$echo_command</span><span class="keyword">)<br>&nbsp; &nbsp; &nbsp; &nbsp; {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if(</span><span class="default">$nl2br</span><span class="keyword">) { echo </span><span class="default">nl2br</span><span class="keyword">(</span><span class="string">"CONNECTING TO </span><span class="default">$host</span><span class="string">\r\n"</span><span class="keyword">); }<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; else { echo </span><span class="string">"CONNECTING TO </span><span class="default">$host</span><span class="string">\r\n"</span><span class="keyword">; }<br>&nbsp; &nbsp; &nbsp; &nbsp; }<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$handle </span><span class="keyword">= </span><span class="default">fsockopen</span><span class="keyword">(</span><span class="default">$host</span><span class="keyword">, </span><span class="default">$port</span><span class="keyword">, </span><span class="default">$errno</span><span class="keyword">, </span><span class="default">$errstr</span><span class="keyword">, </span><span class="default">$timeout</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; if(!</span><span class="default">$handle</span><span class="keyword">)<br>&nbsp; &nbsp; &nbsp; &nbsp; {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if(</span><span class="default">$echo_command</span><span class="keyword">)<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if(</span><span class="default">$nl2br</span><span class="keyword">) { echo </span><span class="default">nl2br</span><span class="keyword">(</span><span class="string">"CONNECTION FAILED\r\n"</span><span class="keyword">); }<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; else { echo </span><span class="string">"CONNECTION FAILED\r\n"</span><span class="keyword">; }<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; return </span><span class="default">False</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; }<br>&nbsp; &nbsp; &nbsp; &nbsp; if(</span><span class="default">$echo_command</span><span class="keyword">)<br>&nbsp; &nbsp; &nbsp; &nbsp; {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if(</span><span class="default">$nl2br</span><span class="keyword">) { echo </span><span class="default">nl2br</span><span class="keyword">(</span><span class="string">"SUCCESS\r\n"</span><span class="keyword">); }<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; else { echo </span><span class="string">"SUCCESS\r\n"</span><span class="keyword">; }<br>&nbsp; &nbsp; &nbsp; &nbsp; }<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$response </span><span class="keyword">= </span><span class="default">fgets</span><span class="keyword">(</span><span class="default">$handle</span><span class="keyword">,</span><span class="default">1</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$bytes_left </span><span class="keyword">= </span><span class="default">socket_get_status</span><span class="keyword">(</span><span class="default">$handle</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; if (</span><span class="default">$bytes_left </span><span class="keyword">&gt; </span><span class="default">0</span><span class="keyword">) { </span><span class="default">$response </span><span class="keyword">.= </span><span class="default">fread</span><span class="keyword">(</span><span class="default">$handle</span><span class="keyword">, </span><span class="default">$bytes_left</span><span class="keyword">[</span><span class="string">"unread_bytes"</span><span class="keyword">]); }<br>&nbsp; &nbsp; &nbsp; &nbsp; if(</span><span class="default">$echo_response</span><span class="keyword">)<br>&nbsp; &nbsp; &nbsp; &nbsp; {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if(</span><span class="default">$nl2br</span><span class="keyword">) { echo </span><span class="default">nl2br</span><span class="keyword">(</span><span class="default">$response</span><span class="keyword">); }<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; else { echo </span><span class="default">$response</span><span class="keyword">; }<br>&nbsp; &nbsp; &nbsp; &nbsp; }<br>&nbsp; &nbsp; &nbsp; &nbsp; return </span><span class="default">$handle</span><span class="keyword">;<br>&nbsp; &nbsp; }<br><br>&nbsp; &nbsp; function </span><span class="default">smtp_command</span><span class="keyword">(</span><span class="default">$handle</span><span class="keyword">, </span><span class="default">$command</span><span class="keyword">, </span><span class="default">$echo_command</span><span class="keyword">=</span><span class="default">False</span><span class="keyword">, </span><span class="default">$nl2br</span><span class="keyword">=</span><span class="default">False</span><span class="keyword">)<br>&nbsp; &nbsp; {<br>&nbsp; &nbsp; &nbsp; &nbsp; if(</span><span class="default">$echo_command</span><span class="keyword">)<br>&nbsp; &nbsp; &nbsp; &nbsp; {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if(</span><span class="default">$nl2br</span><span class="keyword">) { echo </span><span class="default">nl2br</span><span class="keyword">(</span><span class="default">$command</span><span class="keyword">); }<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; else { echo </span><span class="default">$command</span><span class="keyword">; }<br>&nbsp; &nbsp; &nbsp; &nbsp; }<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">fputs</span><span class="keyword">(</span><span class="default">$handle</span><span class="keyword">, </span><span class="default">$command</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$response </span><span class="keyword">= </span><span class="default">fgets</span><span class="keyword">(</span><span class="default">$handle</span><span class="keyword">,</span><span class="default">1</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$bytes_left </span><span class="keyword">= </span><span class="default">socket_get_status</span><span class="keyword">(</span><span class="default">$handle</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; if (</span><span class="default">$bytes_left </span><span class="keyword">&gt; </span><span class="default">0</span><span class="keyword">) { </span><span class="default">$response </span><span class="keyword">.= </span><span class="default">fread</span><span class="keyword">(</span><span class="default">$handle</span><span class="keyword">, </span><span class="default">$bytes_left</span><span class="keyword">[</span><span class="string">"unread_bytes"</span><span class="keyword">]); }<br>&nbsp; &nbsp; &nbsp; &nbsp; if(</span><span class="default">$nl2br</span><span class="keyword">) { return </span><span class="default">nl2br</span><span class="keyword">(</span><span class="default">$response</span><span class="keyword">); }<br>&nbsp; &nbsp; &nbsp; &nbsp; else { return </span><span class="default">$response</span><span class="keyword">; }<br>&nbsp; &nbsp; }<br>&nbsp; &nbsp; <br>&nbsp; &nbsp; function </span><span class="default">smtp_close</span><span class="keyword">(</span><span class="default">$handle</span><span class="keyword">)<br>&nbsp; &nbsp; {<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">fclose</span><span class="keyword">(</span><span class="default">$handle</span><span class="keyword">);<br>&nbsp; &nbsp; }<br></span><span class="default">?&gt;</span>
</span>
</code></div>
  </div>
 </div>
  <div class="note" id="36703">  
  <a class="name">
  <strong class="user"><em>richardaburton at hotmail dot com</em></strong></a><div class="date" title="2003-10-19 08:29"><strong>10 years ago</strong></div>
  <div class="text" id="Hcom36703">
<div class="phpcode"><code><span class="html">
Improved HTTP/1.1 chunked transfer-encoding example.
<br>
<br>The sample code given below by Jack does not function correctly when run against a recent version of Apache (I'm assuming that this did once work, but from the HTTP/1.1 spec I can only assume if it did work it was based mostly on luck).
<br>
<br><span class="default">&lt;?php
<br>
<br>$header </span><span class="keyword">= </span><span class="string">""</span><span class="keyword">;
<br></span><span class="default">$response </span><span class="keyword">= </span><span class="string">""</span><span class="keyword">;
<br>
<br></span><span class="comment">// connect
<br></span><span class="keyword">if (!(</span><span class="default">$request</span><span class="keyword">=</span><span class="default">fsockopen</span><span class="keyword">(</span><span class="string">'example.com'</span><span class="keyword">,</span><span class="default">80</span><span class="keyword">,</span><span class="default">$errno</span><span class="keyword">,</span><span class="default">$errstr</span><span class="keyword">))) exit(</span><span class="default">$errstr</span><span class="keyword">);
<br>else {
<br>&nbsp;&nbsp; </span><span class="default">socket_set_timeout</span><span class="keyword">(</span><span class="default">$request</span><span class="keyword">,</span><span class="default">10</span><span class="keyword">);
<br>&nbsp;&nbsp; </span><span class="comment">// send request
<br>&nbsp;&nbsp; </span><span class="default">fwrite</span><span class="keyword">(</span><span class="default">$request</span><span class="keyword">,</span><span class="default">$post</span><span class="keyword">);
<br>&nbsp;&nbsp; </span><span class="comment">// get header
<br>&nbsp;&nbsp; </span><span class="keyword">do </span><span class="default">$header</span><span class="keyword">.=</span><span class="default">fread</span><span class="keyword">(</span><span class="default">$request</span><span class="keyword">,</span><span class="default">1</span><span class="keyword">); while (!</span><span class="default">preg_match</span><span class="keyword">(</span><span class="string">'/\\r\\n\\r\\n$/'</span><span class="keyword">,</span><span class="default">$header</span><span class="keyword">));
<br>&nbsp;&nbsp; </span><span class="comment">// check for chunked encoding
<br>&nbsp;&nbsp; </span><span class="keyword">if (</span><span class="default">preg_match</span><span class="keyword">(</span><span class="string">'/Transfer\\-Encoding:\\s+chunked\\r\\n/'</span><span class="keyword">,</span><span class="default">$header</span><span class="keyword">))
<br>&nbsp; &nbsp; &nbsp; do {
<br>&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$byte </span><span class="keyword">= </span><span class="string">""</span><span class="keyword">;
<br>&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$chunk_size</span><span class="keyword">=</span><span class="string">""</span><span class="keyword">;
<br>&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; do {
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$chunk_size</span><span class="keyword">.=</span><span class="default">$byte</span><span class="keyword">;
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$byte</span><span class="keyword">=</span><span class="default">fread</span><span class="keyword">(</span><span class="default">$request</span><span class="keyword">,</span><span class="default">1</span><span class="keyword">);
<br>&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; } while (</span><span class="default">$byte</span><span class="keyword">!=</span><span class="string">"\\r"</span><span class="keyword">);&nbsp; &nbsp; &nbsp; </span><span class="comment">// till we match the CR
<br>&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">fread</span><span class="keyword">(</span><span class="default">$request</span><span class="keyword">, </span><span class="default">1</span><span class="keyword">);&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// also drop off the LF
<br>&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$chunk_size</span><span class="keyword">=</span><span class="default">hexdec</span><span class="keyword">(</span><span class="default">$chunk_size</span><span class="keyword">); </span><span class="comment">// convert to real number
<br>&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$response</span><span class="keyword">.=</span><span class="default">fread</span><span class="keyword">(</span><span class="default">$request</span><span class="keyword">,</span><span class="default">$chunk_size</span><span class="keyword">);
<br>&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">fread</span><span class="keyword">(</span><span class="default">$request</span><span class="keyword">,</span><span class="default">2</span><span class="keyword">);&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="comment">// ditch the CRLF that trails the chunk
<br>&nbsp; &nbsp; &nbsp; </span><span class="keyword">} while (</span><span class="default">$chunk_size</span><span class="keyword">);&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// till we reach the 0 length chunk (end marker)
<br>&nbsp;&nbsp; </span><span class="keyword">else {
<br>&nbsp; &nbsp; &nbsp; </span><span class="comment">// check for specified content length
<br>&nbsp; &nbsp; &nbsp; </span><span class="keyword">if (</span><span class="default">preg_match</span><span class="keyword">(</span><span class="string">'/Content\\-Length:\\s+([0-9]*)\\r\\n/'</span><span class="keyword">,</span><span class="default">$header</span><span class="keyword">,</span><span class="default">$matches</span><span class="keyword">)) {
<br>&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$response</span><span class="keyword">=</span><span class="default">fread</span><span class="keyword">(</span><span class="default">$request</span><span class="keyword">,</span><span class="default">$matches</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">]);
<br>&nbsp; &nbsp; &nbsp; } else {
<br>&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// not a nice way to do it (may also result in extra CRLF which trails the real content???)
<br>&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">while (!</span><span class="default">feof</span><span class="keyword">(</span><span class="default">$request</span><span class="keyword">)) </span><span class="default">$response </span><span class="keyword">.= </span><span class="default">fread</span><span class="keyword">(</span><span class="default">$request</span><span class="keyword">, </span><span class="default">4096</span><span class="keyword">);
<br>&nbsp; &nbsp; &nbsp; }
<br>&nbsp;&nbsp; }
<br>&nbsp;&nbsp; </span><span class="comment">// close connection
<br>&nbsp;&nbsp; </span><span class="default">fclose</span><span class="keyword">(</span><span class="default">$request</span><span class="keyword">);
<br>}
<br>
<br></span><span class="comment">// do something useful with the response
<br></span><span class="keyword">print(</span><span class="default">$header</span><span class="keyword">);
<br>print(</span><span class="default">$response</span><span class="keyword">);
<br>
<br></span><span class="default">?&gt;
<br></span>
<br>Richard.</span>
</code></div>
  </div>
 </div>
  <div class="note" id="34887">  
  <a class="name">
  <strong class="user"><em>joe at edwardsconsultants dot com</em></strong></a><div class="date" title="2003-08-10 02:56"><strong>11 years ago</strong></div>
  <div class="text" id="Hcom34887">
<div class="phpcode"><code><span class="html">
just a quick note for users attempting https and thinking they must resort to curl or alternate methods -
<br>you can use fsockopen, just read the docs closely.&nbsp; basically they are saying to use 'ssl://' for a HTTPS (SSL) web request.
<br>
<br>so this would work for authorize.net, and others; even for that paypal IPN - however I think it would be best to leave the site and deal with paypal's form:
<br>
<br><span class="default">&lt;?php
<br>$host </span><span class="keyword">= </span><span class="string">"something.example.com"</span><span class="keyword">;
<br></span><span class="default">$port </span><span class="keyword">= </span><span class="default">443</span><span class="keyword">;
<br></span><span class="default">$path </span><span class="keyword">= </span><span class="string">"/the/url/path/file.php"</span><span class="keyword">; </span><span class="comment">//or .dll, etc. for authnet, etc.
<br>
<br>//you will need to setup an array of fields to post with
<br>//then create the post string
<br></span><span class="default">$formdata </span><span class="keyword">= array ( </span><span class="string">"x_field" </span><span class="keyword">=&gt; </span><span class="string">"somevalue"</span><span class="keyword">);
<br></span><span class="comment">//build the post string
<br>&nbsp; </span><span class="keyword">foreach(</span><span class="default">$formdata </span><span class="keyword">AS </span><span class="default">$key </span><span class="keyword">=&gt; </span><span class="default">$val</span><span class="keyword">){
<br>&nbsp; &nbsp; </span><span class="default">$poststring </span><span class="keyword">.= </span><span class="default">urlencode</span><span class="keyword">(</span><span class="default">$key</span><span class="keyword">) . </span><span class="string">"=" </span><span class="keyword">. </span><span class="default">urlencode</span><span class="keyword">(</span><span class="default">$val</span><span class="keyword">) . </span><span class="string">"&amp;"</span><span class="keyword">;
<br>&nbsp; }
<br></span><span class="comment">// strip off trailing ampersand
<br></span><span class="default">$poststring </span><span class="keyword">= </span><span class="default">substr</span><span class="keyword">(</span><span class="default">$poststring</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, -</span><span class="default">1</span><span class="keyword">);
<br>
<br></span><span class="default">$fp </span><span class="keyword">= </span><span class="default">fsockopen</span><span class="keyword">(</span><span class="string">"ssl://"</span><span class="keyword">.</span><span class="default">$host</span><span class="keyword">, </span><span class="default">$port</span><span class="keyword">, </span><span class="default">$errno</span><span class="keyword">, </span><span class="default">$errstr</span><span class="keyword">, </span><span class="default">$timeout </span><span class="keyword">= </span><span class="default">30</span><span class="keyword">);
<br>
<br>if(!</span><span class="default">$fp</span><span class="keyword">){
<br> </span><span class="comment">//error tell us
<br> </span><span class="keyword">echo </span><span class="string">"</span><span class="default">$errstr</span><span class="string"> (</span><span class="default">$errno</span><span class="string">)\n"</span><span class="keyword">;
<br>&nbsp;&nbsp; 
<br>}else{
<br>
<br>&nbsp; </span><span class="comment">//send the server request
<br>&nbsp; </span><span class="default">fputs</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">, </span><span class="string">"POST </span><span class="default">$path</span><span class="string"> HTTP/1.1\r\n"</span><span class="keyword">);
<br>&nbsp; </span><span class="default">fputs</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">, </span><span class="string">"Host: </span><span class="default">$host</span><span class="string">\r\n"</span><span class="keyword">);
<br>&nbsp; </span><span class="default">fputs</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">, </span><span class="string">"Content-type: application/x-www-form-urlencoded\r\n"</span><span class="keyword">);
<br>&nbsp; </span><span class="default">fputs</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">, </span><span class="string">"Content-length: "</span><span class="keyword">.</span><span class="default">strlen</span><span class="keyword">(</span><span class="default">$poststring</span><span class="keyword">).</span><span class="string">"\r\n"</span><span class="keyword">);
<br>&nbsp; </span><span class="default">fputs</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">, </span><span class="string">"Connection: close\r\n\r\n"</span><span class="keyword">);
<br>&nbsp; </span><span class="default">fputs</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">, </span><span class="default">$poststring </span><span class="keyword">. </span><span class="string">"\r\n\r\n"</span><span class="keyword">);
<br>
<br>&nbsp; </span><span class="comment">//loop through the response from the server
<br>&nbsp; </span><span class="keyword">while(!</span><span class="default">feof</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">)) {
<br>&nbsp; &nbsp; echo </span><span class="default">fgets</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">, </span><span class="default">4096</span><span class="keyword">);
<br>&nbsp; }
<br>&nbsp; </span><span class="comment">//close fp - we are done with it
<br>&nbsp; </span><span class="default">fclose</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">);
<br>}
<br></span><span class="default">?&gt;</span>
</span>
</code></div>
  </div>
 </div>
  <div class="note" id="34551">  
  <a class="name">
  <strong class="user"><em>sergiopaternoster at tiscali dot it</em></strong></a><div class="date" title="2003-07-30 10:49"><strong>11 years ago</strong></div>
  <div class="text" id="Hcom34551">
<div class="phpcode"><code><span class="html">
If you want to connect via Telnet, it could be useful to set also the Terminal Type (some OS requires it)
<br>
<br><span class="default">&lt;?php
<br>$IAC&nbsp; </span><span class="keyword">= </span><span class="default">chr</span><span class="keyword">(</span><span class="default">255</span><span class="keyword">);&nbsp;&nbsp; </span><span class="comment">/* interpret as command: */
<br></span><span class="default">$SB </span><span class="keyword">= </span><span class="default">chr</span><span class="keyword">(</span><span class="default">250</span><span class="keyword">);&nbsp; &nbsp;&nbsp; </span><span class="comment">/* interpret as subnegotiation */
<br></span><span class="default">$SE </span><span class="keyword">= </span><span class="default">chr</span><span class="keyword">(</span><span class="default">240</span><span class="keyword">);&nbsp; &nbsp;&nbsp; </span><span class="comment">/* end sub negotiation */
<br></span><span class="default">$TELOPT_TTYPE </span><span class="keyword">= </span><span class="default">chr</span><span class="keyword">(</span><span class="default">24</span><span class="keyword">);&nbsp; &nbsp;&nbsp; </span><span class="comment">/* terminal type */
<br></span><span class="default">$TELQUAL_IS </span><span class="keyword">= </span><span class="default">chr</span><span class="keyword">(</span><span class="default">0</span><span class="keyword">);&nbsp; &nbsp; </span><span class="comment">/* Option is... */
<br>
<br>//sending Terminal Type
<br></span><span class="default">fwrite</span><span class="keyword">(</span><span class="default">$sock</span><span class="keyword">,</span><span class="default">$IAC</span><span class="keyword">.</span><span class="default">$SB</span><span class="keyword">.</span><span class="default">$TELOPT_TTYPE</span><span class="keyword">.</span><span class="default">$TELQUAL_IS</span><span class="keyword">.</span><span class="string">'vt100'</span><span class="keyword">.</span><span class="default">$IAC</span><span class="keyword">.</span><span class="default">$SE</span><span class="keyword">);
<br></span><span class="default">?&gt;
<br></span>
<br>ciao
<br>Sergio Paternoster</span>
</code></div>
  </div>
 </div>
  <div class="note" id="32830">  
  <a class="name">
  <strong class="user"><em>blazely at removetoemail netspace net au</em></strong></a><div class="date" title="2003-06-08 09:55"><strong>11 years ago</strong></div>
  <div class="text" id="Hcom32830">
<div class="phpcode"><code><span class="html">
Here's a quick function to establish a connection to a web server that will time out if the connection is lost after a user definable amount of time or if the server can't be reached.
<br>
<br>Also supports Basic authentication if a username/password is specified. Any improvements or criticisms, please email me! :-)
<br>
<br>Returns either a resource ID, an error code or 0 if the server can't be reached at all. Returns -1 in the event that something really wierd happens like a non-standard http response or something. Hope it helps someone.
<br>
<br>Cheers,
<br>
<br>Ben Blazely
<br>
<br><span class="default">&lt;?php
<br></span><span class="keyword">function </span><span class="default">connectToURL</span><span class="keyword">(</span><span class="default">$addr</span><span class="keyword">, </span><span class="default">$port</span><span class="keyword">, </span><span class="default">$path</span><span class="keyword">, </span><span class="default">$user</span><span class="keyword">=</span><span class="string">""</span><span class="keyword">, </span><span class="default">$pass</span><span class="keyword">=</span><span class="string">""</span><span class="keyword">, </span><span class="default">$timeout</span><span class="keyword">=</span><span class="string">"30"</span><span class="keyword">)
<br>{
<br> </span><span class="default">$urlHandle </span><span class="keyword">= </span><span class="default">fsockopen</span><span class="keyword">(</span><span class="default">$addr</span><span class="keyword">, </span><span class="default">$port</span><span class="keyword">, </span><span class="default">$errno</span><span class="keyword">, </span><span class="default">$errstr</span><span class="keyword">, </span><span class="default">$timeout</span><span class="keyword">);
<br> if (</span><span class="default">$urlHandle</span><span class="keyword">)
<br> {
<br>&nbsp; </span><span class="default">socket_set_timeout</span><span class="keyword">(</span><span class="default">$urlHandle</span><span class="keyword">, </span><span class="default">$timeout</span><span class="keyword">);
<br>&nbsp; if (</span><span class="default">$path</span><span class="keyword">)
<br>&nbsp; {
<br>&nbsp;&nbsp; </span><span class="default">$urlString </span><span class="keyword">= </span><span class="string">"GET </span><span class="default">$path</span><span class="string"> HTTP/1.0\r\nHost: </span><span class="default">$addr</span><span class="string">\r\nConnection: Keep-Alive\r\nUser-Agent: MyURLGrabber\r\n"</span><span class="keyword">;
<br>&nbsp;&nbsp; if (</span><span class="default">$user</span><span class="keyword">)
<br>&nbsp; &nbsp; </span><span class="default">$urlString </span><span class="keyword">.= </span><span class="string">"Authorization: Basic "</span><span class="keyword">.</span><span class="default">base64_encode</span><span class="keyword">(</span><span class="string">"</span><span class="default">$user</span><span class="string">:</span><span class="default">$pass</span><span class="string">"</span><span class="keyword">).</span><span class="string">"\r\n"</span><span class="keyword">;
<br>&nbsp; &nbsp; </span><span class="default">$urlString </span><span class="keyword">.= </span><span class="string">"\r\n"</span><span class="keyword">;
<br>
<br>&nbsp; &nbsp; </span><span class="default">fputs</span><span class="keyword">(</span><span class="default">$urlHandle</span><span class="keyword">, </span><span class="default">$urlString</span><span class="keyword">);
<br>
<br>&nbsp; &nbsp; </span><span class="default">$response </span><span class="keyword">= </span><span class="default">fgets</span><span class="keyword">(</span><span class="default">$urlHandle</span><span class="keyword">);
<br>
<br>&nbsp; &nbsp; if (</span><span class="default">substr_count</span><span class="keyword">(</span><span class="default">$response</span><span class="keyword">, </span><span class="string">"200 OK"</span><span class="keyword">) &gt; </span><span class="default">0</span><span class="keyword">)&nbsp; &nbsp; &nbsp; </span><span class="comment">// Check the status of the link
<br>&nbsp; &nbsp; </span><span class="keyword">{
<br>&nbsp; &nbsp;&nbsp; </span><span class="default">$endHeader </span><span class="keyword">= </span><span class="default">false</span><span class="keyword">;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// Strip initial header information
<br>&nbsp; &nbsp;&nbsp; </span><span class="keyword">while ( !</span><span class="default">$endHeader</span><span class="keyword">)
<br>&nbsp; &nbsp;&nbsp; {
<br>&nbsp; &nbsp; &nbsp; if (</span><span class="default">fgets</span><span class="keyword">(</span><span class="default">$urlHandle</span><span class="keyword">) == </span><span class="string">"\r\n"</span><span class="keyword">)
<br>&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$endHeader </span><span class="keyword">= </span><span class="default">true</span><span class="keyword">;
<br>&nbsp; &nbsp;&nbsp; }
<br>
<br>&nbsp; &nbsp;&nbsp; return </span><span class="default">$urlHandle</span><span class="keyword">;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="comment">// All OK, return the file handle
<br>&nbsp; &nbsp; </span><span class="keyword">}
<br>&nbsp; &nbsp; else if (</span><span class="default">strlen</span><span class="keyword">(</span><span class="default">$response</span><span class="keyword">) &lt; </span><span class="default">15</span><span class="keyword">)&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="comment">// Cope with wierd non standard responses
<br>&nbsp; &nbsp; </span><span class="keyword">{
<br>&nbsp; &nbsp;&nbsp; </span><span class="default">fclose</span><span class="keyword">(</span><span class="default">$urlHandle</span><span class="keyword">);
<br>&nbsp; &nbsp;&nbsp; return -</span><span class="default">1</span><span class="keyword">;
<br>&nbsp; &nbsp; }
<br>&nbsp; &nbsp; else&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="comment">// Cope with a standard error response
<br>&nbsp; &nbsp; </span><span class="keyword">{
<br>&nbsp; &nbsp;&nbsp; </span><span class="default">fclose</span><span class="keyword">(</span><span class="default">$urlHandle</span><span class="keyword">);
<br>&nbsp; &nbsp;&nbsp; return </span><span class="default">substr</span><span class="keyword">(</span><span class="default">$response</span><span class="keyword">,</span><span class="default">9</span><span class="keyword">,</span><span class="default">3</span><span class="keyword">);
<br>&nbsp; &nbsp; }
<br>&nbsp;&nbsp; }
<br>
<br>&nbsp;&nbsp; return </span><span class="default">$urlHandle</span><span class="keyword">;
<br>&nbsp; }
<br>&nbsp; else
<br>&nbsp; {
<br>&nbsp;&nbsp; return </span><span class="default">0</span><span class="keyword">;
<br>&nbsp; }
<br> }
<br>}
<br></span><span class="default">?&gt;</span>
</span>
</code></div>
  </div>
 </div>
  <div class="note" id="29005">  
  <a class="name">
  <strong class="user"><em>Sherif Gayed</em></strong></a><div class="date" title="2003-01-29 10:00"><strong>11 years ago</strong></div>
  <div class="text" id="Hcom29005">
<div class="phpcode"><code><span class="html">
Here is how to connect to the web from behind a proxy server:
<br>
<br><span class="default">&lt;?php
<br></span><span class="comment">/*************start code**************/
<br>/*your proxy server address*/
<br></span><span class="default">$proxy </span><span class="keyword">= </span><span class="string">"192.168.10.1"</span><span class="keyword">;
<br></span><span class="comment">/*your proxy server port*/
<br></span><span class="default">$port </span><span class="keyword">= </span><span class="default">8080</span><span class="keyword">;
<br></span><span class="comment">/*the url you want to connect to*/
<br></span><span class="default">$url </span><span class="keyword">= </span><span class="string">"<a rel="nofollow" target="_blank">http://www.php.net/</a>"</span><span class="keyword">;
<br></span><span class="default">$fp </span><span class="keyword">= </span><span class="default">fsockopen</span><span class="keyword">(</span><span class="default">$proxy</span><span class="keyword">, </span><span class="default">$port</span><span class="keyword">);
<br></span><span class="default">fputs</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">, </span><span class="string">"GET </span><span class="default">$url</span><span class="string"> HTTP/1.0\r\nHost: </span><span class="default">$proxy</span><span class="string">\r\n\r\n"</span><span class="keyword">);
<br>while(!</span><span class="default">feof</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">)){
<br>&nbsp; </span><span class="default">$line </span><span class="keyword">= </span><span class="default">fgets</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">, </span><span class="default">4000</span><span class="keyword">);
<br>&nbsp; print(</span><span class="default">$line</span><span class="keyword">);
<br>}
<br></span><span class="default">fclose</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">);
<br></span><span class="comment">/**************end code**************/
<br></span><span class="default">?&gt;</span>
</span>
</code></div>
  </div>
 </div>
  <div class="note" id="28137">  
  <a class="name">
  <strong class="user"><em>g dot bashi at ntlworld dot com</em></strong></a><div class="date" title="2003-01-03 09:55"><strong>11 years ago</strong></div>
  <div class="text" id="Hcom28137">
<div class="phpcode"><code><span class="html">
The timeout parameter was not supported under windows until PHP 4.3.0, previously it was fixed at 30sec.</span>
</code></div>
  </div>
 </div>
  <div class="note" id="27755">  
  <a class="name">
  <strong class="user"><em>dan at lovepond dot com</em></strong></a><div class="date" title="2002-12-17 01:38"><strong>11 years ago</strong></div>
  <div class="text" id="Hcom27755">
<div class="phpcode"><code><span class="html">
Here is some code to help out abit more with the EOF problem.
<br>I had a problem where I needed to strip out so many lines of server input to get back right data i wanted.
<br>
<br><span class="default">&lt;?php
<br>$port</span><span class="keyword">=</span><span class="default">4000</span><span class="keyword">;
<br></span><span class="default">$host</span><span class="keyword">=</span><span class="string">"localhost"</span><span class="keyword">;
<br></span><span class="default">$message</span><span class="keyword">=</span><span class="string">"test"</span><span class="keyword">;
<br></span><span class="default">$status</span><span class="keyword">=</span><span class="default">senddata</span><span class="keyword">(</span><span class="default">$host</span><span class="keyword">,</span><span class="default">$port</span><span class="keyword">,</span><span class="default">$message</span><span class="keyword">);
<br>print </span><span class="string">"</span><span class="default">$status</span><span class="string">"</span><span class="keyword">;
<br>
<br>function </span><span class="default">senddata</span><span class="keyword">(</span><span class="default">$host</span><span class="keyword">,</span><span class="default">$port</span><span class="keyword">,</span><span class="default">$message</span><span class="keyword">) {
<br>
<br></span><span class="comment">#takes in account servers that do not return EOF character
<br>#send data to server and get back input
<br>
<br>#function globals
<br></span><span class="default">$linenumber</span><span class="keyword">=</span><span class="string">"2"</span><span class="keyword">; </span><span class="comment">#amount of lines to get rid of before we give input
<br></span><span class="default">$lineamount</span><span class="keyword">=</span><span class="string">"1"</span><span class="keyword">; </span><span class="comment">#amount of lines to read after we give input
<br>
<br></span><span class="default">$fp </span><span class="keyword">= </span><span class="default">fsockopen</span><span class="keyword">(</span><span class="string">"</span><span class="default">$host</span><span class="string">"</span><span class="keyword">, </span><span class="default">$port</span><span class="keyword">, </span><span class="default">$errno</span><span class="keyword">, </span><span class="default">$errstr</span><span class="keyword">, </span><span class="default">30</span><span class="keyword">);
<br>if (!</span><span class="default">$fp</span><span class="keyword">) {
<br>&nbsp;&nbsp; echo </span><span class="string">"</span><span class="default">$errstr</span><span class="string"> (</span><span class="default">$errno</span><span class="string">)"</span><span class="keyword">;
<br>}
<br>else {
<br>&nbsp;&nbsp; for (</span><span class="default">$i </span><span class="keyword">= </span><span class="default">1</span><span class="keyword">; </span><span class="default">$i </span><span class="keyword">&lt; </span><span class="default">$linenumber</span><span class="keyword">+</span><span class="default">1</span><span class="keyword">; </span><span class="default">$i</span><span class="keyword">++) {
<br>&nbsp; &nbsp; &nbsp; </span><span class="default">fread </span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">,</span><span class="default">1</span><span class="keyword">);
<br>&nbsp; &nbsp; &nbsp; </span><span class="default">$bytes_left </span><span class="keyword">= </span><span class="default">socket_get_status</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">);
<br>&nbsp; &nbsp; &nbsp; if (</span><span class="default">$bytes_left </span><span class="keyword">&gt; </span><span class="default">0</span><span class="keyword">) { </span><span class="default">fread</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">, </span><span class="default">$bytes_left</span><span class="keyword">[</span><span class="default">unread_bytes</span><span class="keyword">]); }
<br>&nbsp;&nbsp; }
<br>&nbsp;&nbsp; </span><span class="default">fputs</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">, </span><span class="string">"</span><span class="default">$message</span><span class="string">\r\n"</span><span class="keyword">);
<br>&nbsp;&nbsp; for (</span><span class="default">$i </span><span class="keyword">= </span><span class="default">1</span><span class="keyword">; </span><span class="default">$i </span><span class="keyword">&lt; </span><span class="default">$lineamount</span><span class="keyword">+</span><span class="default">1</span><span class="keyword">; </span><span class="default">$i</span><span class="keyword">++) {
<br>&nbsp; &nbsp; &nbsp; </span><span class="default">$status</span><span class="keyword">.=</span><span class="default">fread</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">,</span><span class="default">1</span><span class="keyword">);
<br>&nbsp; &nbsp; &nbsp; </span><span class="default">$bytes_left </span><span class="keyword">= </span><span class="default">socket_get_status</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">);
<br>&nbsp; &nbsp; &nbsp; if (</span><span class="default">$bytes_left </span><span class="keyword">&gt; </span><span class="default">0</span><span class="keyword">) { </span><span class="default">$status</span><span class="keyword">.=</span><span class="default">fread</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">, </span><span class="default">$bytes_left</span><span class="keyword">[</span><span class="default">unread_bytes</span><span class="keyword">]); }
<br>&nbsp;&nbsp; }
<br>&nbsp;&nbsp; </span><span class="default">fclose </span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">);
<br>}
<br>
<br>return </span><span class="default">$status</span><span class="keyword">;
<br>}
<br>
<br></span><span class="default">?&gt;</span>
</span>
</code></div>
  </div>
 </div>
  <div class="note" id="23481">  
  <a class="name">
  <strong class="user"><em>iain at monitormedia dot co dot uk</em></strong></a><div class="date" title="2002-07-19 05:48"><strong>12 years ago</strong></div>
  <div class="text" id="Hcom23481">
<div class="phpcode"><code><span class="html">
Here's how to send an email using SMTP. This includes rudimentary checking on server responses during the process of sending an email. Could be improved by more comprehensive processing of the result codes...or going on to the next mail exchanger when you fail after connecting to the first.
<br>
<br><span class="default">&lt;?php
<br>
<br></span><span class="keyword">function </span><span class="default">another_mail</span><span class="keyword">(</span><span class="default">$to</span><span class="keyword">,</span><span class="default">$subject</span><span class="keyword">,</span><span class="default">$headers</span><span class="keyword">,</span><span class="default">$message</span><span class="keyword">)
<br>{
<br> </span><span class="comment">// Could get this from the php ini?
<br> </span><span class="default">$from</span><span class="keyword">=</span><span class="string">"me@example.com"</span><span class="keyword">;
<br> list(</span><span class="default">$me</span><span class="keyword">,</span><span class="default">$mydomain</span><span class="keyword">) = </span><span class="default">split</span><span class="keyword">(</span><span class="string">"@"</span><span class="keyword">,</span><span class="default">$from</span><span class="keyword">);
<br>
<br> </span><span class="comment">// Now look up the mail exchangers for the recipient
<br> </span><span class="keyword">list(</span><span class="default">$user</span><span class="keyword">,</span><span class="default">$domain</span><span class="keyword">) = </span><span class="default">split</span><span class="keyword">(</span><span class="string">"@"</span><span class="keyword">,</span><span class="default">$to</span><span class="keyword">,</span><span class="default">2</span><span class="keyword">);
<br> if(</span><span class="default">getmxrr</span><span class="keyword">(</span><span class="default">$domain</span><span class="keyword">,</span><span class="default">$mx</span><span class="keyword">,</span><span class="default">$weight</span><span class="keyword">) == </span><span class="default">0</span><span class="keyword">)&nbsp; return </span><span class="default">FALSE</span><span class="keyword">;
<br>
<br> </span><span class="comment">// Try them in order of lowest weight first
<br> </span><span class="default">array_multisort</span><span class="keyword">(</span><span class="default">$mx</span><span class="keyword">,</span><span class="default">$weight</span><span class="keyword">);
<br> </span><span class="default">$success</span><span class="keyword">=</span><span class="default">0</span><span class="keyword">;
<br>
<br> foreach(</span><span class="default">$mx </span><span class="keyword">as </span><span class="default">$host</span><span class="keyword">) {
<br>&nbsp; </span><span class="comment">// Open an SMTP connection
<br>&nbsp; </span><span class="default">$connection </span><span class="keyword">= </span><span class="default">fsockopen </span><span class="keyword">(</span><span class="default">$host</span><span class="keyword">, </span><span class="default">25</span><span class="keyword">, </span><span class="default">$errno</span><span class="keyword">, </span><span class="default">$errstr</span><span class="keyword">, </span><span class="default">1</span><span class="keyword">);
<br>&nbsp; if (!</span><span class="default">$connection</span><span class="keyword">)
<br>&nbsp; &nbsp; continue;
<br>&nbsp; </span><span class="default">$res</span><span class="keyword">=</span><span class="default">fgets</span><span class="keyword">(</span><span class="default">$connection</span><span class="keyword">,</span><span class="default">256</span><span class="keyword">);
<br>&nbsp; if(</span><span class="default">substr</span><span class="keyword">(</span><span class="default">$res</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">,</span><span class="default">3</span><span class="keyword">) != </span><span class="string">"220"</span><span class="keyword">) break;
<br>
<br>&nbsp; </span><span class="comment">// Introduce ourselves
<br>&nbsp; </span><span class="default">fputs</span><span class="keyword">(</span><span class="default">$connection</span><span class="keyword">, </span><span class="string">"HELO </span><span class="default">$mydomain</span><span class="string">\n"</span><span class="keyword">);
<br>&nbsp; </span><span class="default">$res</span><span class="keyword">=</span><span class="default">fgets</span><span class="keyword">(</span><span class="default">$connection</span><span class="keyword">,</span><span class="default">256</span><span class="keyword">);
<br>&nbsp; if(</span><span class="default">substr</span><span class="keyword">(</span><span class="default">$res</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">,</span><span class="default">3</span><span class="keyword">) != </span><span class="string">"250"</span><span class="keyword">) break;
<br>
<br>&nbsp; </span><span class="comment">// Envelope from
<br>&nbsp; </span><span class="default">fputs</span><span class="keyword">(</span><span class="default">$connection</span><span class="keyword">, </span><span class="string">"MAIL FROM: </span><span class="default">$from</span><span class="string">\n"</span><span class="keyword">);
<br>&nbsp; </span><span class="default">$res</span><span class="keyword">=</span><span class="default">fgets</span><span class="keyword">(</span><span class="default">$connection</span><span class="keyword">,</span><span class="default">256</span><span class="keyword">);
<br>&nbsp; if(</span><span class="default">substr</span><span class="keyword">(</span><span class="default">$res</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">,</span><span class="default">3</span><span class="keyword">) != </span><span class="string">"250"</span><span class="keyword">) break;
<br>
<br>&nbsp; </span><span class="comment">// Envelope to
<br>&nbsp; </span><span class="default">fputs</span><span class="keyword">(</span><span class="default">$connection</span><span class="keyword">, </span><span class="string">"RCPT TO: </span><span class="default">$to</span><span class="string">\n"</span><span class="keyword">);
<br>&nbsp; </span><span class="default">$res</span><span class="keyword">=</span><span class="default">fgets</span><span class="keyword">(</span><span class="default">$connection</span><span class="keyword">,</span><span class="default">256</span><span class="keyword">);
<br>&nbsp; if(</span><span class="default">substr</span><span class="keyword">(</span><span class="default">$res</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">,</span><span class="default">3</span><span class="keyword">) != </span><span class="string">"250"</span><span class="keyword">) break;
<br>
<br>&nbsp; </span><span class="comment">// The message
<br>&nbsp; </span><span class="default">fputs</span><span class="keyword">(</span><span class="default">$connection</span><span class="keyword">, </span><span class="string">"DATA\n"</span><span class="keyword">);
<br>&nbsp; </span><span class="default">$res</span><span class="keyword">=</span><span class="default">fgets</span><span class="keyword">(</span><span class="default">$connection</span><span class="keyword">,</span><span class="default">256</span><span class="keyword">);
<br>&nbsp; if(</span><span class="default">substr</span><span class="keyword">(</span><span class="default">$res</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">,</span><span class="default">3</span><span class="keyword">) != </span><span class="string">"354"</span><span class="keyword">) break;
<br>
<br>&nbsp; </span><span class="comment">// Send To:, From:, Subject:, other headers, blank line, message, and finish
<br>&nbsp; // with a period on its own line.
<br>&nbsp; </span><span class="default">fputs</span><span class="keyword">(</span><span class="default">$connection</span><span class="keyword">, </span><span class="string">"To: </span><span class="default">$to</span><span class="string">\nFrom: </span><span class="default">$from</span><span class="string">\nSubject: </span><span class="default">$subject</span><span class="string">\n</span><span class="default">$headers</span><span class="string">\n\n</span><span class="default">$message</span><span class="string">\n.\n"</span><span class="keyword">);
<br>&nbsp; </span><span class="default">$res</span><span class="keyword">=</span><span class="default">fgets</span><span class="keyword">(</span><span class="default">$connection</span><span class="keyword">,</span><span class="default">256</span><span class="keyword">);
<br>&nbsp; if(</span><span class="default">substr</span><span class="keyword">(</span><span class="default">$res</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">,</span><span class="default">3</span><span class="keyword">) != </span><span class="string">"250"</span><span class="keyword">) break;
<br>
<br>&nbsp; </span><span class="comment">// Say bye bye
<br>&nbsp; </span><span class="default">fputs</span><span class="keyword">(</span><span class="default">$connection</span><span class="keyword">,</span><span class="string">"QUIT\n"</span><span class="keyword">);
<br>&nbsp; </span><span class="default">$res</span><span class="keyword">=</span><span class="default">fgets</span><span class="keyword">(</span><span class="default">$connection</span><span class="keyword">,</span><span class="default">256</span><span class="keyword">);
<br>&nbsp; if(</span><span class="default">substr</span><span class="keyword">(</span><span class="default">$res</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">,</span><span class="default">3</span><span class="keyword">) != </span><span class="string">"221"</span><span class="keyword">) break;
<br>
<br>&nbsp; </span><span class="comment">// It worked! So break out of the loop which tries all the mail exchangers.
<br>&nbsp; </span><span class="default">$success</span><span class="keyword">=</span><span class="default">1</span><span class="keyword">;
<br>&nbsp; break;
<br> }
<br> </span><span class="comment">// Debug for if we fall over - uncomment as desired
<br> // print $success?"Mail sent":"Failure: $res\n";
<br> </span><span class="keyword">if(</span><span class="default">$connection</span><span class="keyword">) {
<br>&nbsp; if(</span><span class="default">$success</span><span class="keyword">==</span><span class="default">0</span><span class="keyword">) </span><span class="default">fputs</span><span class="keyword">(</span><span class="default">$connection</span><span class="keyword">, </span><span class="string">"QUIT\n"</span><span class="keyword">);
<br>&nbsp; </span><span class="default">fclose </span><span class="keyword">(</span><span class="default">$connection</span><span class="keyword">);
<br> }
<br> return </span><span class="default">$success</span><span class="keyword">?</span><span class="default">TRUE</span><span class="keyword">:</span><span class="default">FALSE</span><span class="keyword">;
<br>}
<br>
<br></span><span class="default">another_mail</span><span class="keyword">(</span><span class="string">"recipient@example.com"</span><span class="keyword">,</span><span class="string">"My Subject"</span><span class="keyword">,</span><span class="string">"X-mailer: PHP Script\nX-another-header: Whatever"</span><span class="keyword">,</span><span class="string">"Test email body.\n\nNote if you actually put a period on a line\nby itself, the function will terminate prematurely.\n\nYou will get a partial email sent though.\n"</span><span class="keyword">);
<br></span><span class="default">?&gt;</span>
</span>
</code></div>
  </div>
 </div>
  <div class="note" id="87144">  
  <a class="name">
  <strong class="user"><em>Hyan Christian</em></strong></a><div class="date" title="2008-11-20 10:42"><strong>5 years ago</strong></div>
  <div class="text" id="Hcom87144">
<div class="phpcode"><code><span class="html">
To just take the HTTP content from fsockopen, better wait until feof finish to read the \r\n separator
<br>
<br><span class="default">&lt;?php
<br></span><span class="comment">//fsockopen, fputs..
<br>
<br></span><span class="default">$content </span><span class="keyword">= </span><span class="string">""</span><span class="keyword">;
<br></span><span class="default">$header </span><span class="keyword">= </span><span class="string">"not yet"</span><span class="keyword">;
<br>
<br>while( !</span><span class="default">feof</span><span class="keyword">( </span><span class="default">$pointer </span><span class="keyword">) ) {
<br>&nbsp; &nbsp; </span><span class="default">$line </span><span class="keyword">= </span><span class="default">fgets</span><span class="keyword">( </span><span class="default">$pointer</span><span class="keyword">, </span><span class="default">128 </span><span class="keyword">);
<br>&nbsp; &nbsp; if( </span><span class="default">$line </span><span class="keyword">== </span><span class="string">"\r\n" </span><span class="keyword">&amp;&amp; </span><span class="default">$header </span><span class="keyword">== </span><span class="string">"not yet" </span><span class="keyword">) {
<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$header </span><span class="keyword">= </span><span class="string">"passed"</span><span class="keyword">;
<br>&nbsp; &nbsp; }
<br>&nbsp; &nbsp; if( </span><span class="default">$header </span><span class="keyword">== </span><span class="string">"passed" </span><span class="keyword">) {
<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$content </span><span class="keyword">.= </span><span class="default">$line</span><span class="keyword">;
<br>&nbsp; &nbsp; }
<br>}
<br>
<br></span><span class="comment">//fclose..
<br>
<br></span><span class="keyword">echo( </span><span class="default">substr</span><span class="keyword">( </span><span class="default">$content</span><span class="keyword">, </span><span class="default">2 </span><span class="keyword">) );
<br></span><span class="default">?&gt;</span>
</span>
</code></div>
  </div>
 </div>
  <div class="note" id="91554">  
  <a class="name">
  <strong class="user"><em>andypsv at rcdrugs dot com</em></strong></a><div class="date" title="2009-06-16 01:15"><strong>5 years ago</strong></div>
  <div class="text" id="Hcom91554">
<div class="phpcode"><code><span class="html">
look at this smart ssl/http fsockopen function as a good solution for dealing with things
<br>
<br><span class="default">&lt;?php
<br></span><span class="keyword">function </span><span class="default">_get</span><span class="keyword">(</span><span class="default">$type</span><span class="keyword">,</span><span class="default">$host</span><span class="keyword">,</span><span class="default">$port</span><span class="keyword">=</span><span class="string">'80'</span><span class="keyword">,</span><span class="default">$path</span><span class="keyword">=</span><span class="string">'/'</span><span class="keyword">,</span><span class="default">$data</span><span class="keyword">=</span><span class="string">''</span><span class="keyword">) {
<br>&nbsp; &nbsp; </span><span class="default">$_err </span><span class="keyword">= </span><span class="string">'lib sockets::'</span><span class="keyword">.</span><span class="default">__FUNCTION__</span><span class="keyword">.</span><span class="string">'(): '</span><span class="keyword">;
<br>&nbsp; &nbsp; switch(</span><span class="default">$type</span><span class="keyword">) { case </span><span class="string">'http'</span><span class="keyword">: </span><span class="default">$type </span><span class="keyword">= </span><span class="string">''</span><span class="keyword">; case </span><span class="string">'ssl'</span><span class="keyword">: continue; default: die(</span><span class="default">$_err</span><span class="keyword">.</span><span class="string">'bad $type'</span><span class="keyword">); } if(!</span><span class="default">ctype_digit</span><span class="keyword">(</span><span class="default">$port</span><span class="keyword">)) die(</span><span class="default">$_err</span><span class="keyword">.</span><span class="string">'bad port'</span><span class="keyword">);
<br>&nbsp; &nbsp; if(!empty(</span><span class="default">$data</span><span class="keyword">)) foreach(</span><span class="default">$data </span><span class="keyword">AS </span><span class="default">$k </span><span class="keyword">=&gt; </span><span class="default">$v</span><span class="keyword">) </span><span class="default">$str </span><span class="keyword">.= </span><span class="default">urlencode</span><span class="keyword">(</span><span class="default">$k</span><span class="keyword">).</span><span class="string">'='</span><span class="keyword">.</span><span class="default">urlencode</span><span class="keyword">(</span><span class="default">$v</span><span class="keyword">).</span><span class="string">'&amp;'</span><span class="keyword">; </span><span class="default">$str </span><span class="keyword">= </span><span class="default">substr</span><span class="keyword">(</span><span class="default">$str</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">,-</span><span class="default">1</span><span class="keyword">);
<br>&nbsp; &nbsp; 
<br>&nbsp; &nbsp; </span><span class="default">$fp </span><span class="keyword">= </span><span class="default">fsockopen</span><span class="keyword">(</span><span class="default">$host</span><span class="keyword">,</span><span class="default">$port</span><span class="keyword">,</span><span class="default">$errno</span><span class="keyword">,</span><span class="default">$errstr</span><span class="keyword">,</span><span class="default">$timeout</span><span class="keyword">=</span><span class="default">30</span><span class="keyword">);
<br>&nbsp; &nbsp; if(!</span><span class="default">$fp</span><span class="keyword">) die(</span><span class="default">$_err</span><span class="keyword">.</span><span class="default">$errstr</span><span class="keyword">.</span><span class="default">$errno</span><span class="keyword">); else {
<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">fputs</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">, </span><span class="string">"POST </span><span class="default">$path</span><span class="string"> HTTP/1.1\r\n"</span><span class="keyword">);
<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">fputs</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">, </span><span class="string">"Host: </span><span class="default">$host</span><span class="string">\r\n"</span><span class="keyword">);
<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">fputs</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">, </span><span class="string">"Content-type: application/x-www-form-urlencoded\r\n"</span><span class="keyword">);
<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">fputs</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">, </span><span class="string">"Content-length: "</span><span class="keyword">.</span><span class="default">strlen</span><span class="keyword">(</span><span class="default">$str</span><span class="keyword">).</span><span class="string">"\r\n"</span><span class="keyword">);
<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">fputs</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">, </span><span class="string">"Connection: close\r\n\r\n"</span><span class="keyword">);
<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">fputs</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">, </span><span class="default">$str</span><span class="keyword">.</span><span class="string">"\r\n\r\n"</span><span class="keyword">);
<br>&nbsp; &nbsp; &nbsp; &nbsp; 
<br>&nbsp; &nbsp; &nbsp; &nbsp; while(!</span><span class="default">feof</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">)) </span><span class="default">$d </span><span class="keyword">.= </span><span class="default">fgets</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">,</span><span class="default">4096</span><span class="keyword">);
<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">fclose</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">);
<br>&nbsp; &nbsp; } return </span><span class="default">$d</span><span class="keyword">;
<br>}
<br></span><span class="default">?&gt;</span>
</span>
</code></div>
  </div>
 </div></div>

 
</section>    </section><!-- layout-content -->
        


  </div><!-- layout -->
         
  

    
 <!-- External and third party libraries. -->
 







<a id="toTop" href="javascript:;"><span id="toTopHover"></span><img width="40" height="40" alt="To Top" src="../../images/to-top%402x.png"></a>



<!-- Mirrored from php.net/manual/en/function.fsockopen.php by HTTrack Website Copier/3.x [XR&CO'2013], Thu, 28 Aug 2014 15:54:53 GMT -->


</body></html>