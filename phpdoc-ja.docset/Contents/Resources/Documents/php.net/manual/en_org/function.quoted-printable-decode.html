<html><!-- Mirrored from php.net/manual/en/function.quoted-printable-decode.php by HTTrack Website Copier/3.x [XR&CO'2013], Thu, 28 Aug 2014 16:51:16 GMT --><!-- Added by HTTrack --><head><meta http-equiv="content-type" content="text/html;charset=utf-8"><!-- /Added by HTTrack -->


  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0"> 

  <title>quoted_printable_decode</title>

 <link rel="shortcut icon" href="../../favicon.ico">
 <link rel="search" type="application/opensearchdescription+xml" href="http://php.net/phpnetimprovedsearch.src" title="Add PHP.net search">
 <link rel="alternate" type="application/atom+xml" href="http://php.net/releases/feed.php" title="PHP Release feed">
 <link rel="alternate" type="application/atom+xml" href="http://php.net/feed.atom" title="PHP: Hypertext Preprocessor">

 <link rel="canonical" href="function.quoted-printable-decode.html">
 <link rel="shorturl" href="http://php.net/quoted-printable-decode">
 <link rel="alternate" href="http://php.net/quoted-printable-decode" hreflang="x-default">

 <link rel="contents" href="index-2.html">
 <link rel="index" href="ref.strings.html">
 <link rel="prev" href="function.printf.html">
 <link rel="next" href="function.quoted-printable-encode.html">

 <link rel="alternate" href="function.quoted-printable-decode.html" hreflang="en">
 <link rel="alternate" href="http://php.net/manual/pt_BR/function.quoted-printable-decode.php" hreflang="pt_BR">
 <link rel="alternate" href="http://php.net/manual/zh/function.quoted-printable-decode.php" hreflang="zh">
 <link rel="alternate" href="http://php.net/manual/fr/function.quoted-printable-decode.php" hreflang="fr">
 <link rel="alternate" href="http://php.net/manual/de/function.quoted-printable-decode.php" hreflang="de">
 <link rel="alternate" href="http://php.net/manual/it/function.quoted-printable-decode.php" hreflang="it">
 <link rel="alternate" href="http://php.net/manual/ja/function.quoted-printable-decode.php" hreflang="ja">
 <link rel="alternate" href="http://php.net/manual/ro/function.quoted-printable-decode.php" hreflang="ro">
 <link rel="alternate" href="http://php.net/manual/ru/function.quoted-printable-decode.php" hreflang="ru">
 <link rel="alternate" href="http://php.net/manual/es/function.quoted-printable-decode.php" hreflang="es">
 <link rel="alternate" href="http://php.net/manual/tr/function.quoted-printable-decode.php" hreflang="tr">

<link rel="stylesheet" type="text/css" href="../../cached8fe1.css?t=1401250819&amp;f=/fonts/Fira/fira.css" media="screen">
<link rel="stylesheet" type="text/css" href="../../cached4b8d.css?t=1404368420&amp;f=/fonts/Font-Awesome/css/fontello.css" media="screen">
<link rel="stylesheet" type="text/css" href="../../cached5065.css?t=1403329232&amp;f=/styles/theme-base.css" media="screen">
<link rel="stylesheet" type="text/css" href="../../cachedc78d.css?t=1401249623&amp;f=/styles/theme-medium.css" media="screen">

 <!--[if lte IE 7]>
 <link rel="stylesheet" type="text/css" href="http://php.net/styles/workarounds.ie7.css" media="screen">
 <![endif]-->

 <!--[if lte IE 8]>
 <script type="text/javascript">
  window.brokenIE = true;
 </script>
 <![endif]-->

 <!--[if lte IE 9]>
 <link rel="stylesheet" type="text/css" href="http://php.net/styles/workarounds.ie9.css" media="screen">
 <![endif]-->

 <!--[if IE]>
 <script type="text/javascript" src="http://php.net/js/ext/html5.js"></script>
 <![endif]-->

 <base>

</head>
<body class="docs " style="">


<div class="headsup"><a href="http://php.net/index.php#id2014-08-28-1">PHP 5.6.0 released</a></div>
<nav id="trick"><div><dl>
<dt><a href="getting-started.html">Getting Started</a></dt>
	<dd><a href="introduction.html">Introduction</a></dd>
	<dd><a href="tutorial.html">A simple tutorial</a></dd>
<dt><a href="langref.html">Language Reference</a></dt>
	<dd><a href="language.basic-syntax.html">Basic syntax</a></dd>
	<dd><a href="language.types.html">Types</a></dd>
	<dd><a href="language.variables.html">Variables</a></dd>
	<dd><a href="language.constants.html">Constants</a></dd>
	<dd><a href="language.expressions.html">Expressions</a></dd>
	<dd><a href="language.operators.html">Operators</a></dd>
	<dd><a href="language.control-structures.html">Control Structures</a></dd>
	<dd><a href="language.functions.html">Functions</a></dd>
	<dd><a href="language.oop5.html">Classes and Objects</a></dd>
	<dd><a href="language.namespaces.html">Namespaces</a></dd>
	<dd><a href="language.exceptions.html">Exceptions</a></dd>
	<dd><a href="language.generators.html">Generators</a></dd>
	<dd><a href="language.references.html">References Explained</a></dd>
	<dd><a href="reserved.variables.html">Predefined Variables</a></dd>
	<dd><a href="reserved.exceptions.html">Predefined Exceptions</a></dd>
	<dd><a href="reserved.interfaces.html">Predefined Interfaces and Classes</a></dd>
	<dd><a href="context.html">Context options and parameters</a></dd>
	<dd><a href="wrappers.html">Supported Protocols and Wrappers</a></dd>
</dl>
<dl>
<dt><a href="security.html">Security</a></dt>
	<dd><a href="security.intro.html">Introduction</a></dd>
	<dd><a href="security.general.html">General considerations</a></dd>
	<dd><a href="security.cgi-bin.html">Installed as CGI binary</a></dd>
	<dd><a href="security.apache.html">Installed as an Apache module</a></dd>
	<dd><a href="security.filesystem.html">Filesystem Security</a></dd>
	<dd><a href="security.database.html">Database Security</a></dd>
	<dd><a href="security.errors.html">Error Reporting</a></dd>
	<dd><a href="security.globals.html">Using Register Globals</a></dd>
	<dd><a href="security.variables.html">User Submitted Data</a></dd>
	<dd><a href="security.magicquotes.html">Magic Quotes</a></dd>
	<dd><a href="security.hiding.html">Hiding PHP</a></dd>
	<dd><a href="security.current.html">Keeping Current</a></dd>
<dt><a href="features.html">Features</a></dt>
	<dd><a href="features.http-auth.html">HTTP authentication with PHP</a></dd>
	<dd><a href="features.cookies.html">Cookies</a></dd>
	<dd><a href="features.sessions.html">Sessions</a></dd>
	<dd><a href="features.xforms.html">Dealing with XForms</a></dd>
	<dd><a href="features.file-upload.html">Handling file uploads</a></dd>
	<dd><a href="features.remote-files.html">Using remote files</a></dd>
	<dd><a href="features.connection-handling.html">Connection handling</a></dd>
	<dd><a href="features.persistent-connections.html">Persistent Database Connections</a></dd>
	<dd><a href="features.safe-mode.html">Safe Mode</a></dd>
	<dd><a href="features.commandline.html">Command line usage</a></dd>
	<dd><a href="features.gc.html">Garbage Collection</a></dd>
	<dd><a href="features.dtrace.html">DTrace Dynamic Tracing</a></dd>
</dl>
<dl>
<dt><a href="funcref.html">Function Reference</a></dt>
	<dd><a href="refs.basic.php.html">Affecting PHP's Behaviour</a></dd>
	<dd><a href="refs.utilspec.audio.html">Audio Formats Manipulation</a></dd>
	<dd><a href="refs.remote.auth.html">Authentication Services</a></dd>
	<dd><a href="refs.utilspec.cmdline.html">Command Line Specific Extensions</a></dd>
	<dd><a href="refs.compression.html">Compression and Archive Extensions</a></dd>
	<dd><a href="refs.creditcard.html">Credit Card Processing</a></dd>
	<dd><a href="refs.crypto.html">Cryptography Extensions</a></dd>
	<dd><a href="refs.database.html">Database Extensions</a></dd>
	<dd><a href="refs.calendar.html">Date and Time Related Extensions</a></dd>
	<dd><a href="refs.fileprocess.file.html">File System Related Extensions</a></dd>
	<dd><a href="refs.international.html">Human Language and Character Encoding Support</a></dd>
	<dd><a href="refs.utilspec.image.html">Image Processing and Generation</a></dd>
	<dd><a href="refs.remote.mail.html">Mail Related Extensions</a></dd>
	<dd><a href="refs.math.html">Mathematical Extensions</a></dd>
	<dd><a href="refs.utilspec.nontext.html">Non-Text MIME Output</a></dd>
	<dd><a href="refs.fileprocess.process.html">Process Control Extensions</a></dd>
	<dd><a href="refs.basic.other.html">Other Basic Extensions</a></dd>
	<dd><a href="refs.remote.other.html">Other Services</a></dd>
	<dd><a href="refs.search.html">Search Engine Extensions</a></dd>
	<dd><a href="refs.utilspec.server.html">Server Specific Extensions</a></dd>
	<dd><a href="refs.basic.session.html">Session Extensions</a></dd>
	<dd><a href="refs.basic.text.html">Text Processing</a></dd>
	<dd><a href="refs.basic.vartype.html">Variable and Type Related Extensions</a></dd>
	<dd><a href="refs.webservice.html">Web Services</a></dd>
	<dd><a href="refs.utilspec.windows.html">Windows Only Extensions</a></dd>
	<dd><a href="refs.xml.html">XML Manipulation</a></dd>
</dl>
<dl>
<dt>Keyboard Shortcuts</dt><dt>?</dt>
<dd>This help</dd>
<dt>j</dt>
<dd>Next menu item</dd>
<dt>k</dt>
<dd>Previous menu item</dd>
<dt>g p</dt>
<dd>Previous man page</dd>
<dt>g n</dt>
<dd>Next man page</dd>
<dt>G</dt>
<dd>Scroll to bottom</dd>
<dt>g g</dt>
<dd>Scroll to top</dd>
<dt>g h</dt>
<dd>Goto homepage</dd>
<dt>g s</dt>
<dd>Goto search<br>(current page)</dd>
<dt>/</dt>
<dd>Focus search box</dd>
</dl></div></nav>
<div id="goto">
    <div class="search">
         <div class="text"></div>
         <div class="results"><ul></ul></div>
   </div>
</div>

  <div id="breadcrumbs" class="row-fluid">
          
              
        <ul class="breadcrumbs-container">
            <li><a href="index-2.html">PHP Manual</a></li>      <li><a href="funcref.html">Function Reference</a></li>      <li><a href="refs.basic.text.html">Text Processing</a></li>      <li><a href="book.strings.html">Strings</a></li>      <li><a href="ref.strings.html">String Functions</a></li>    </ul>
  </div>




<div id="layout">
  <section id="layout-content">
  <div id="function.quoted-printable-decode" class="refentry">
 <div class="refnamediv">
  <h1 class="refname">quoted_printable_decode</h1>
  <p class="verinfo">(PHP 4, PHP 5)</p><p class="refpurpose"><span class="refname">quoted_printable_decode</span> — <span class="dc-title">Convert a quoted-printable string to an 8 bit string</span></p>

 </div>
 
 <div class="refsect1 description" id="refsect1-function.quoted-printable-decode-description">
  <h3 class="title">Description</h3>
  <div class="methodsynopsis dc-description">
   <span class="type">string</span> <span class="methodname"><strong>quoted_printable_decode</strong></span>
    ( <span class="methodparam"><span class="type">string</span> <code class="parameter">$str</code></span>
   )</div>

  <p class="para rdfs-comment">
   This function returns an 8-bit binary string corresponding to the decoded
   quoted printable string (according to <a href="http://www.faqs.org/rfcs/rfc2045" class="link external">»&nbsp;RFC2045</a>, section 6.7, not <a href="http://www.faqs.org/rfcs/rfc2821" class="link external">»&nbsp;RFC2821</a>, section 4.5.2, so additional periods
   are not stripped from the beginning of line).
  </p>
  <p class="para">
   This function is similar to <span class="function"><a href="function.imap-qprint.html" class="function">imap_qprint()</a></span>, except this
   one does not require the IMAP module to work.
  </p>
 </div>


 <div class="refsect1 parameters" id="refsect1-function.quoted-printable-decode-parameters">
  <h3 class="title">Parameters</h3>
  <p class="para">
   </p><dl>

    
     <dt>
<code class="parameter">str</code></dt>

     <dd>

      <p class="para">
       The input string.
      </p>
     </dd>

    
   </dl>

  <p></p>
 </div>


 <div class="refsect1 returnvalues" id="refsect1-function.quoted-printable-decode-returnvalues">
  <h3 class="title">Return Values</h3>
  <p class="para">
   Returns the 8-bit binary string.
  </p>
 </div>


 <div class="refsect1 seealso" id="refsect1-function.quoted-printable-decode-seealso">
  <h3 class="title">See Also</h3>
  <p class="para">
   </p><ul class="simplelist">
    <li class="member"><span class="function"><a href="function.quoted-printable-encode.html" class="function" rel="rdfs-seeAlso">quoted_printable_encode()</a> - Convert a 8 bit string to a quoted-printable string</span></li>
   </ul>
  <p></p>
 </div>


</div>
<section id="usernotes">
 <div class="head"><h3 class="title">User Contributed Notes</h3></div><div id="allnotes">
  <div class="note" id="7445">  
  <a class="name">
  <strong class="user"><em>madmax at express dot ru</em></strong></a><div class="date" title="2000-08-03 05:41"><strong>14 years ago</strong></div>
  <div class="text" id="Hcom7445">
<div class="phpcode"><code><span class="html">
Some&nbsp; browser (netscape, for example)
<br>send 8-bit quoted printable text like this:
<br>=C5=DD=A3=D2=C1= =DA
<br>
<br>"= =" means continuos word.
<br> php function not detect this situations and translate in string like:
<br> abcde=f</span>
</code></div>
  </div>
 </div>
  <div class="note" id="73402">  
  <a class="name">
  <strong class="user"><em>legolas558 at users dot sausafe dot net</em></strong></a><div class="date" title="2007-02-21 11:09"><strong>7 years ago</strong></div>
  <div class="text" id="Hcom73402">
<div class="phpcode"><code><span class="html">
As soletan at toxa dot de reported, that function is very bad and does not provide valid enquoted printable strings. While using it I saw spam agents marking the emails as QP_EXCESS and sometimes the email client did not recognize the header at all; I really lost time :(. This is the new version (we use it in the Drake CMS core) that works seamlessly:<br><br><span class="default">&lt;?php<br><br></span><span class="comment">//L: note $encoding that is uppercase<br>//L: also your PHP installation must have ctype_alpha, otherwise write it yourself<br></span><span class="keyword">function </span><span class="default">quoted_printable_encode</span><span class="keyword">(</span><span class="default">$string</span><span class="keyword">, </span><span class="default">$encoding</span><span class="keyword">=</span><span class="string">'UTF-8'</span><span class="keyword">) {<br></span><span class="comment">// use this function with headers, not with the email body as it misses word wrapping<br>&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$len </span><span class="keyword">= </span><span class="default">strlen</span><span class="keyword">(</span><span class="default">$string</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$result </span><span class="keyword">= </span><span class="string">''</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$enc </span><span class="keyword">= </span><span class="default">false</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp;&nbsp; for(</span><span class="default">$i</span><span class="keyword">=</span><span class="default">0</span><span class="keyword">;</span><span class="default">$i</span><span class="keyword">&lt;</span><span class="default">$len</span><span class="keyword">;++</span><span class="default">$i</span><span class="keyword">) {<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$c </span><span class="keyword">= </span><span class="default">$string</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">];<br>&nbsp; &nbsp; &nbsp; &nbsp; if (</span><span class="default">ctype_alpha</span><span class="keyword">(</span><span class="default">$c</span><span class="keyword">))<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$result</span><span class="keyword">.=</span><span class="default">$c</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; else if (</span><span class="default">$c</span><span class="keyword">==</span><span class="string">' '</span><span class="keyword">) {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$result</span><span class="keyword">.=</span><span class="string">'_'</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$enc </span><span class="keyword">= </span><span class="default">true</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; } else {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$result</span><span class="keyword">.=</span><span class="default">sprintf</span><span class="keyword">(</span><span class="string">"=%02X"</span><span class="keyword">, </span><span class="default">ord</span><span class="keyword">(</span><span class="default">$c</span><span class="keyword">));<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$enc </span><span class="keyword">= </span><span class="default">true</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; }<br>&nbsp; &nbsp; &nbsp;&nbsp; }<br>&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">//L: so spam agents won't mark your email with QP_EXCESS<br>&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">if (!</span><span class="default">$enc</span><span class="keyword">) return </span><span class="default">$string</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="string">'=?'</span><span class="keyword">.</span><span class="default">$encoding</span><span class="keyword">.</span><span class="string">'?q?'</span><span class="keyword">.</span><span class="default">$result</span><span class="keyword">.</span><span class="string">'?='</span><span class="keyword">;<br>}<br><br></span><span class="default">I hope it helps </span><span class="keyword">;)<br><br></span><span class="default">?&gt;</span>
</span>
</code></div>
  </div>
 </div>
  <div class="note" id="50141">  
  <a class="name">
  <strong class="user"><em>dmitry at koterov dot ru</em></strong></a><div class="date" title="2005-02-19 05:26"><strong>9 years ago</strong></div>
  <div class="text" id="Hcom50141">
<div class="phpcode"><code><span class="html">
Previous comment has a bug: encoding of short test does not work because of incorrect usage of preg_match_all(). Have somebody read it at all? :-)<br><br>Correct version (seems), with additional imap_8bit() function emulation:<br><br>if (!function_exists('imap_8bit')) {<br> function imap_8bit($text) {<br>&nbsp;&nbsp; return quoted_printable_encode($text);<br> }<br>}<br><br>function quoted_printable_encode_character ( $matches ) {<br>&nbsp;&nbsp; $character = $matches[0];<br>&nbsp;&nbsp; return sprintf ( '=%02x', ord ( $character ) );<br>}<br><br>// based on <a rel="nofollow" target="_blank">http://www.freesoft.org/CIE/RFC/1521/6.htm</a><br>function quoted_printable_encode ( $string ) {<br>&nbsp;&nbsp; // rule #2, #3 (leaves space and tab characters in tact)<br>&nbsp;&nbsp; $string = preg_replace_callback (<br>&nbsp; &nbsp;&nbsp; '/[^\x21-\x3C\x3E-\x7E\x09\x20]/',<br>&nbsp; &nbsp;&nbsp; 'quoted_printable_encode_character',<br>&nbsp; &nbsp;&nbsp; $string<br>&nbsp;&nbsp; );<br>&nbsp;&nbsp; $newline = "=\r\n"; // '=' + CRLF (rule #4)<br>&nbsp;&nbsp; // make sure the splitting of lines does not interfere with escaped characters<br>&nbsp;&nbsp; // (chunk_split fails here)<br>&nbsp;&nbsp; $string = preg_replace ( '/(.{73}[^=]{0,3})/', '$1'.$newline, $string);<br>&nbsp;&nbsp; return $string;<br>}</span>
</code></div>
  </div>
 </div>
  <div class="note" id="78023">  
  <a class="name">
  <strong class="user"><em>ludwig at gramberg-webdesign dot de</em></strong></a><div class="date" title="2007-09-24 12:13"><strong>6 years ago</strong></div>
  <div class="text" id="Hcom78023">
<div class="phpcode"><code><span class="html">
my approach for quoted printable encode using the stream converting abilities<br><br><span class="default">&lt;?php<br></span><span class="comment">/**<br> * @param string $str<br> * @return string<br> * */<br></span><span class="keyword">function </span><span class="default">quoted_printable_encode</span><span class="keyword">(</span><span class="default">$str</span><span class="keyword">) {<br>&nbsp; &nbsp; </span><span class="default">$fp </span><span class="keyword">= </span><span class="default">fopen</span><span class="keyword">(</span><span class="string">'php://temp'</span><span class="keyword">, </span><span class="string">'w+'</span><span class="keyword">);<br>&nbsp; &nbsp; </span><span class="default">stream_filter_append</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">, </span><span class="string">'convert.quoted-printable-encode'</span><span class="keyword">);<br>&nbsp; &nbsp; </span><span class="default">fwrite</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">, </span><span class="default">$str</span><span class="keyword">);&nbsp; &nbsp; <br>&nbsp; &nbsp; </span><span class="default">fseek</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">);<br>&nbsp; &nbsp; </span><span class="default">$result </span><span class="keyword">= </span><span class="string">''</span><span class="keyword">;<br>&nbsp; &nbsp; while(!</span><span class="default">feof</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">))<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$result </span><span class="keyword">.= </span><span class="default">fread</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">, </span><span class="default">1024</span><span class="keyword">);<br>&nbsp; &nbsp; </span><span class="default">fclose</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">);<br>&nbsp; &nbsp; return </span><span class="default">$result</span><span class="keyword">;<br>}<br></span><span class="default">?&gt;</span>
</span>
</code></div>
  </div>
 </div>
  <div class="note" id="70516">  
  <a class="name">
  <strong class="user"><em>Thomas Pequet / Memotoo.com</em></strong></a><div class="date" title="2006-10-19 06:15"><strong>7 years ago</strong></div>
  <div class="text" id="Hcom70516">
<div class="phpcode"><code><span class="html">
If you want a function to do the reverse of "quoted_printable_decode()", follow the link you will find the "quoted_printable_encode()" function:<br><a rel="nofollow" target="_blank">http://www.memotoo.com/softs/public/PHP/quoted</a> printable_encode.inc.php<br><br>Compatible "ENCODING=QUOTED-PRINTABLE"<br>Example: <br>quoted_printable_encode(ut8_encode("c'est quand l'été ?")) <br>-&gt; "c'est quand l'=C3=A9t=C3=A9 ?"</span>
</code></div>
  </div>
 </div>
  <div class="note" id="55033">  
  <a class="name">
  <strong class="user"><em>steffen dot weber at computerbase dot de</em></strong></a><div class="date" title="2005-07-22 02:08"><strong>9 years ago</strong></div>
  <div class="text" id="Hcom55033">
<div class="phpcode"><code><span class="html">
As the two digit hexadecimal representation SHOULD be in uppercase you want to use "=%02X" (uppercase X) instead of "=%02x" as the first argument to sprintf().</span>
</code></div>
  </div>
 </div>
  <div class="note" id="86764">  
  <a class="name">
  <strong class="user"><em>andre at luyer dot nl</em></strong></a><div class="date" title="2008-11-02 12:36"><strong>5 years ago</strong></div>
  <div class="text" id="Hcom86764">
<div class="phpcode"><code><span class="html">
A small update for Andrew's code below. This one leaves the original CRLF pairs intact (and allowing the preg_replace to work as intended):<br><br><span class="default">&lt;?php<br></span><span class="keyword">if (!</span><span class="default">function_exists</span><span class="keyword">(</span><span class="string">"quoted_printable_encode"</span><span class="keyword">)) {<br>&nbsp; </span><span class="comment">/**<br>&nbsp; * Process a string to fit the requirements of RFC2045 section 6.7. Note that<br>&nbsp; * this works, but replaces more characters than the minimum set. For readability<br>&nbsp; * the spaces and CRLF pairs aren't encoded though.<br>&nbsp; */<br>&nbsp; </span><span class="keyword">function </span><span class="default">quoted_printable_encode</span><span class="keyword">(</span><span class="default">$string</span><span class="keyword">) {<br>&nbsp; &nbsp; return </span><span class="default">preg_replace</span><span class="keyword">(</span><span class="string">'/[^\r\n]{73}[^=\r\n]{2}/'</span><span class="keyword">, </span><span class="string">"$0=\r\n"</span><span class="keyword">,<br>&nbsp; &nbsp; &nbsp; </span><span class="default">str_replace</span><span class="keyword">(</span><span class="string">"%"</span><span class="keyword">, </span><span class="string">"="</span><span class="keyword">, </span><span class="default">str_replace</span><span class="keyword">(</span><span class="string">"%0D%0A"</span><span class="keyword">, </span><span class="string">"\r\n"</span><span class="keyword">, <br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">str_replace</span><span class="keyword">(</span><span class="string">"%20"</span><span class="keyword">,</span><span class="string">" "</span><span class="keyword">,</span><span class="default">rawurlencode</span><span class="keyword">(</span><span class="default">$string</span><span class="keyword">)))));<br>&nbsp; }<br>}<br></span><span class="default">?&gt;<br></span><br>Regards, André</span>
</code></div>
  </div>
 </div>
  <div class="note" id="85157">  
  <a class="name">
  <strong class="user"><em>david at lionhead dot nl</em></strong></a><div class="date" title="2008-08-18 05:54"><strong>6 years ago</strong></div>
  <div class="text" id="Hcom85157">
<div class="phpcode"><code><span class="html">
My version of quoted_printable encode, as the convert.quoted-printable-encode filter breaks on outlook express. This one seems to work on express/outlook/thunderbird/gmail.<br><br>function quoted_printable_encode($txt) {<br>&nbsp; &nbsp; $tmp="";<br>&nbsp; &nbsp; $line="";<br>&nbsp; &nbsp; for ($i=0;$i&lt;strlen($txt);$i++) {<br>&nbsp; &nbsp; &nbsp; &nbsp; if (($txt[$i]&gt;='a' &amp;&amp; $txt[$i]&lt;='z') || ($txt[$i]&gt;='A' &amp;&amp; $txt[$i]&lt;='Z') || ($txt[$i]&gt;='0' &amp;&amp; $txt[$i]&lt;='9'))<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $line.=$txt[$i];<br>&nbsp; &nbsp; &nbsp; &nbsp; else<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $line.="=".sprintf("%02X",ord($txt[$i]));<br>&nbsp; &nbsp; &nbsp; &nbsp; if (strlen($line)&gt;=75) {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $tmp.="$line=\n";<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $line="";<br>&nbsp; &nbsp; &nbsp; &nbsp; }<br>&nbsp; &nbsp; }<br>&nbsp; &nbsp; $tmp.="$line\n";<br>&nbsp; &nbsp; return $tmp;<br>}</span>
</code></div>
  </div>
 </div>
  <div class="note" id="113516">  
  <a class="name">
  <strong class="user"><em>yual at inbox dot ru</em></strong></a><div class="date" title="2013-10-23 08:38"><strong>10 months ago</strong></div>
  <div class="text" id="Hcom113516">
<div class="phpcode"><code><span class="html">
I use a hack for this bug:<br><br>$str = str_replace("=\r\n", '', quoted_printable_encode($str));<br>if (strlen($str) &gt; 73) {$str = substr($str,0,74)."=\n".substr($str,74);}</span>
</code></div>
  </div>
 </div>
  <div class="note" id="76645">  
  <a class="name">
  <strong class="user"><em>roelof</em></strong></a><div class="date" title="2007-07-24 07:06"><strong>7 years ago</strong></div>
  <div class="text" id="Hcom76645">
<div class="phpcode"><code><span class="html">
I modified the below version of legolas558 at users dot sausafe dot net and added a wrapping option.<br><br><span class="default">&lt;?php<br></span><span class="comment">/**<br> *&nbsp; &nbsp; Codeer een String naar zogenaamde 'quoted printable'. Dit type van coderen wordt<br> *&nbsp; &nbsp; gebruikt om de content van 8 bit e-mail berichten als 7 bits te versturen.<br> *<br> *&nbsp; &nbsp; @access public<br> *&nbsp; &nbsp; @param string&nbsp; &nbsp; $str&nbsp; &nbsp; De String die we coderen<br> *&nbsp; &nbsp; @param bool&nbsp; &nbsp; &nbsp; $wrap&nbsp;&nbsp; Voeg linebreaks toe na 74 tekens?<br> *&nbsp; &nbsp; @return string<br> */<br><br></span><span class="keyword">function </span><span class="default">quoted_printable_encode</span><span class="keyword">(</span><span class="default">$str</span><span class="keyword">, </span><span class="default">$wrap</span><span class="keyword">=</span><span class="default">true</span><span class="keyword">)<br>{<br>&nbsp; &nbsp; </span><span class="default">$return </span><span class="keyword">= </span><span class="string">''</span><span class="keyword">;<br>&nbsp; &nbsp; </span><span class="default">$iL </span><span class="keyword">= </span><span class="default">strlen</span><span class="keyword">(</span><span class="default">$str</span><span class="keyword">);<br>&nbsp; &nbsp; for(</span><span class="default">$i</span><span class="keyword">=</span><span class="default">0</span><span class="keyword">; </span><span class="default">$i</span><span class="keyword">&lt;</span><span class="default">$iL</span><span class="keyword">; </span><span class="default">$i</span><span class="keyword">++)<br>&nbsp; &nbsp; {<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$char </span><span class="keyword">= </span><span class="default">$str</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">];<br>&nbsp; &nbsp; &nbsp; &nbsp; if(</span><span class="default">ctype_print</span><span class="keyword">(</span><span class="default">$char</span><span class="keyword">) &amp;&amp; !</span><span class="default">ctype_punct</span><span class="keyword">(</span><span class="default">$char</span><span class="keyword">)) </span><span class="default">$return </span><span class="keyword">.= </span><span class="default">$char</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; else </span><span class="default">$return </span><span class="keyword">.= </span><span class="default">sprintf</span><span class="keyword">(</span><span class="string">'=%02X'</span><span class="keyword">, </span><span class="default">ord</span><span class="keyword">(</span><span class="default">$char</span><span class="keyword">));<br>&nbsp; &nbsp; }<br>&nbsp; &nbsp; return (</span><span class="default">$wrap </span><span class="keyword">=== </span><span class="default">true</span><span class="keyword">)<br>&nbsp; &nbsp; &nbsp; &nbsp; ? </span><span class="default">wordwrap</span><span class="keyword">(</span><span class="default">$return</span><span class="keyword">, </span><span class="default">74</span><span class="keyword">, </span><span class="string">" =\n"</span><span class="keyword">)<br>&nbsp; &nbsp; &nbsp; &nbsp; : </span><span class="default">$return</span><span class="keyword">;<br>}<br><br></span><span class="default">?&gt;</span>
</span>
</code></div>
  </div>
 </div>
  <div class="note" id="73385">  
  <a class="name">
  <strong class="user"><em>soletan at toxa dot de</em></strong></a><div class="date" title="2007-02-20 03:54"><strong>7 years ago</strong></div>
  <div class="text" id="Hcom73385">
<div class="phpcode"><code><span class="html">
Be warned! The method below for encoding text does not work as requested by RFC1521!<br><br>Consider a line consisting of 75 'A' and a single é (or similar non-ASCII character) ... the method below would encode and return a line of 78 octets, breaking with RFC 1521, 5.1 Rule #5: "The Quoted-Printable encoding REQUIRES that encoded lines be no more than 76 characters long."<br><br>Good QP-encoding takes a bit more than this.</span>
</code></div>
  </div>
 </div>
  <div class="note" id="14139">  
  <a class="name">
  <strong class="user"><em>pob at medienrecht dot NOSPAM dot org</em></strong></a><div class="date" title="2001-07-18 01:06"><strong>13 years ago</strong></div>
  <div class="text" id="Hcom14139">
<div class="phpcode"><code><span class="html">
If you do not have access to imap_* and do not want to use 
<br>�$message = chunk_split( base64_encode($message) );�
<br>because you want to be able to read the �source� of your mails, you might want to try this:
<br>(any suggestions very welcome!)
<br>
<br>
<br>function qp_enc($input = "quoted-printable encoding test string", $line_max = 76) {
<br>
<br>&nbsp; &nbsp; $hex = array('0','1','2','3','4','5','6','7','8','9','A','B','C','D','E','F');
<br>&nbsp; &nbsp; $lines = preg_split("/(?:\r\n|\r|\n)/", $input);
<br>&nbsp; &nbsp; $eol = "\r\n";
<br>&nbsp; &nbsp; $escape = "=";
<br>&nbsp; &nbsp; $output = "";
<br>
<br>&nbsp; &nbsp; while( list(, $line) = each($lines) ) {
<br>&nbsp; &nbsp; &nbsp; &nbsp; //$line = rtrim($line); // remove trailing white space -&gt; no =20\r\n necessary
<br>&nbsp; &nbsp; &nbsp; &nbsp; $linlen = strlen($line);
<br>&nbsp; &nbsp; &nbsp; &nbsp; $newline = "";
<br>&nbsp; &nbsp; &nbsp; &nbsp; for($i = 0; $i &lt; $linlen; $i++) {
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $c = substr($line, $i, 1);
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $dec = ord($c);
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if ( ($dec == 32) &amp;&amp; ($i == ($linlen - 1)) ) { // convert space at eol only
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $c = "=20"; 
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; } elseif ( ($dec == 61) || ($dec &lt; 32 ) || ($dec &gt; 126) ) { // always encode "\t", which is *not* required
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $h2 = floor($dec/16); $h1 = floor($dec%16); 
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $c = $escape.$hex["$h2"].$hex["$h1"]; 
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if ( (strlen($newline) + strlen($c)) &gt;= $line_max ) { // CRLF is not counted
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $output .= $newline.$escape.$eol; // soft line break; " =\r\n" is okay
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $newline = "";
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $newline .= $c;
<br>&nbsp; &nbsp; &nbsp; &nbsp; } // end of for
<br>&nbsp; &nbsp; &nbsp; &nbsp; $output .= $newline.$eol;
<br>&nbsp; &nbsp; }
<br>&nbsp; &nbsp; return trim($output);
<br>
<br>}
<br>
<br>$eight_bit = "\xA7 \xC4 \xD6 \xDC \xE4 \xF6 \xFC \xDF&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; =&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; xxx&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; yyy&nbsp; &nbsp; &nbsp;&nbsp; zzz&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; \r\n"
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ." \xA7&nbsp; &nbsp; &nbsp; \r \xC4 \n \xD6 \x09&nbsp; &nbsp; "; 
<br>print $eight_bit."\r\n---------------\r\n";
<br>$encoded = qp_enc($eight_bit); 
<br>print $encoded;</span>
</code></div>
  </div>
 </div>
  <div class="note" id="89417">  
  <a class="name">
  <strong class="user"><em>feedr</em></strong></a><div class="date" title="2009-03-06 02:39"><strong>5 years ago</strong></div>
  <div class="text" id="Hcom89417">
<div class="phpcode"><code><span class="html">
Another (improved) version of quoted_printable_encode(). Please note the order of the array elements in str_replace().<br>I've just rewritten the previous function for better readability.<br><br><span class="default">&lt;?php<br></span><span class="keyword">if (!</span><span class="default">function_exists</span><span class="keyword">(</span><span class="string">"quoted_printable_encode"</span><span class="keyword">)) {<br>&nbsp; </span><span class="comment">/**<br>&nbsp; * Process a string to fit the requirements of RFC2045 section 6.7. Note that<br>&nbsp; * this works, but replaces more characters than the minimum set. For readability<br>&nbsp; * the spaces and CRLF pairs aren't encoded though.<br>&nbsp; */<br>&nbsp; </span><span class="keyword">function </span><span class="default">quoted_printable_encode</span><span class="keyword">(</span><span class="default">$string</span><span class="keyword">) {<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$string </span><span class="keyword">= </span><span class="default">str_replace</span><span class="keyword">(array(</span><span class="string">'%20'</span><span class="keyword">, </span><span class="string">'%0D%0A'</span><span class="keyword">, </span><span class="string">'%'</span><span class="keyword">), array(</span><span class="string">' '</span><span class="keyword">, </span><span class="string">"\r\n"</span><span class="keyword">, </span><span class="string">'='</span><span class="keyword">), </span><span class="default">rawurlencode</span><span class="keyword">(</span><span class="default">$string</span><span class="keyword">));<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$string </span><span class="keyword">= </span><span class="default">preg_replace</span><span class="keyword">(</span><span class="string">'/[^\r\n]{73}[^=\r\n]{2}/'</span><span class="keyword">, </span><span class="string">"$0=\r\n"</span><span class="keyword">, </span><span class="default">$string</span><span class="keyword">);<br><br>&nbsp; &nbsp; &nbsp; &nbsp; return </span><span class="default">$string</span><span class="keyword">;<br>&nbsp; }<br>}<br></span><span class="default">?&gt;</span>
</span>
</code></div>
  </div>
 </div>
  <div class="note" id="86449">  
  <a class="name">
  <strong class="user"><em>Karora</em></strong></a><div class="date" title="2008-10-19 08:27"><strong>5 years ago</strong></div>
  <div class="text" id="Hcom86449">
<div class="phpcode"><code><span class="html">
Taking a bunch of the earlier comments together, you can synthesize a nice short and reasonably efficient quoted_printable_encode function like this:
<br>
<br>Note that I put this in my standard library file, so I wrap it in a !function_exists in order that if there is a pre-existing PHP one it will just work and this will evaluate to a noop.
<br>
<br><span class="default">&lt;?php
<br></span><span class="keyword">if ( !</span><span class="default">function_exists</span><span class="keyword">(</span><span class="string">"quoted_printable_encode"</span><span class="keyword">) ) {
<br>&nbsp; </span><span class="comment">/**
<br>&nbsp; * Process a string to fit the requirements of RFC2045 section 6.7.&nbsp; Note that
<br>&nbsp; * this works, but replaces more characters than the minimum set. For readability
<br>&nbsp; * the spaces aren't encoded as =20 though.
<br>&nbsp; */
<br>&nbsp; </span><span class="keyword">function </span><span class="default">quoted_printable_encode</span><span class="keyword">(</span><span class="default">$string</span><span class="keyword">) {
<br>&nbsp; &nbsp; return </span><span class="default">preg_replace</span><span class="keyword">(</span><span class="string">'/[^\r\n]{73}[^=\r\n]{2}/'</span><span class="keyword">, </span><span class="string">"$0=\r\n"</span><span class="keyword">, </span><span class="default">str_replace</span><span class="keyword">(</span><span class="string">"%"</span><span class="keyword">,</span><span class="string">"="</span><span class="keyword">,</span><span class="default">str_replace</span><span class="keyword">(</span><span class="string">"%20"</span><span class="keyword">,</span><span class="string">" "</span><span class="keyword">,</span><span class="default">rawurlencode</span><span class="keyword">(</span><span class="default">$string</span><span class="keyword">))));
<br>&nbsp; }
<br>}
<br></span><span class="default">?&gt;
<br></span>
<br>Regards,
<br>Andrew McMillan.</span>
</code></div>
  </div>
 </div>
  <div class="note" id="85993">  
  <a class="name">
  <strong class="user"><em>zg</em></strong></a><div class="date" title="2008-09-27 06:48"><strong>5 years ago</strong></div>
  <div class="text" id="Hcom85993">
<div class="phpcode"><code><span class="html">
<span class="default">&lt;?php<br><br></span><span class="keyword">function </span><span class="default">quoted_printable_encode</span><span class="keyword">( </span><span class="default">$str</span><span class="keyword">, </span><span class="default">$chunkLen </span><span class="keyword">= </span><span class="default">72 </span><span class="keyword">)<br>{<br>&nbsp; &nbsp; </span><span class="default">$offset </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">;<br>&nbsp; &nbsp; <br>&nbsp; &nbsp; </span><span class="default">$str </span><span class="keyword">= </span><span class="default">strtr</span><span class="keyword">(</span><span class="default">rawurlencode</span><span class="keyword">(</span><span class="default">$str</span><span class="keyword">), array(</span><span class="string">'%' </span><span class="keyword">=&gt; </span><span class="string">'='</span><span class="keyword">));<br>&nbsp; &nbsp; </span><span class="default">$len </span><span class="keyword">= </span><span class="default">strlen</span><span class="keyword">(</span><span class="default">$str</span><span class="keyword">);<br>&nbsp; &nbsp; </span><span class="default">$enc </span><span class="keyword">= </span><span class="string">''</span><span class="keyword">;<br>&nbsp; &nbsp; <br>&nbsp; &nbsp; while ( </span><span class="default">$offset </span><span class="keyword">&lt; </span><span class="default">$len </span><span class="keyword">)<br>&nbsp; &nbsp; {<br>&nbsp; &nbsp; &nbsp; &nbsp; if ( </span><span class="default">$str</span><span class="keyword">{ </span><span class="default">$offset </span><span class="keyword">+ </span><span class="default">$chunkLen </span><span class="keyword">- </span><span class="default">1 </span><span class="keyword">} === </span><span class="string">'=' </span><span class="keyword">)<br>&nbsp; &nbsp; &nbsp; &nbsp; {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$line </span><span class="keyword">= </span><span class="default">substr</span><span class="keyword">(</span><span class="default">$str</span><span class="keyword">, </span><span class="default">$offset</span><span class="keyword">, </span><span class="default">$chunkLen </span><span class="keyword">- </span><span class="default">1</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$offset </span><span class="keyword">+= </span><span class="default">$chunkLen </span><span class="keyword">- </span><span class="default">1</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; }<br>&nbsp; &nbsp; &nbsp; &nbsp; elseif ( </span><span class="default">$str</span><span class="keyword">{ </span><span class="default">$offset </span><span class="keyword">+ </span><span class="default">$chunkLen </span><span class="keyword">- </span><span class="default">2 </span><span class="keyword">} === </span><span class="string">'=' </span><span class="keyword">)<br>&nbsp; &nbsp; &nbsp; &nbsp; {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$line </span><span class="keyword">= </span><span class="default">substr</span><span class="keyword">(</span><span class="default">$str</span><span class="keyword">, </span><span class="default">$offset</span><span class="keyword">, </span><span class="default">$chunkLen </span><span class="keyword">- </span><span class="default">2</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$offset </span><span class="keyword">+= </span><span class="default">$chunkLen </span><span class="keyword">- </span><span class="default">2</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; }<br>&nbsp; &nbsp; &nbsp; &nbsp; else <br>&nbsp; &nbsp; &nbsp; &nbsp; {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$line </span><span class="keyword">= </span><span class="default">substr</span><span class="keyword">(</span><span class="default">$str</span><span class="keyword">, </span><span class="default">$offset</span><span class="keyword">, </span><span class="default">$chunkLen</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$offset </span><span class="keyword">+= </span><span class="default">$chunkLen</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; }<br>&nbsp; &nbsp; &nbsp; &nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; if ( </span><span class="default">$offset </span><span class="keyword">+ </span><span class="default">$chunkLen </span><span class="keyword">&lt; </span><span class="default">$len </span><span class="keyword">)<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$enc </span><span class="keyword">.= </span><span class="default">$line </span><span class="keyword">.</span><span class="string">"=\n"</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; else <br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$enc </span><span class="keyword">.= </span><span class="default">$line</span><span class="keyword">;<br>&nbsp; &nbsp; }<br>&nbsp; &nbsp; <br>&nbsp; &nbsp; return </span><span class="default">$enc</span><span class="keyword">;<br>}<br><br></span><span class="default">?&gt;</span>
</span>
</code></div>
  </div>
 </div>
  <div class="note" id="85926">  
  <a class="name">
  <strong class="user"><em>Christian Albrecht</em></strong></a><div class="date" title="2008-09-24 03:10"><strong>5 years ago</strong></div>
  <div class="text" id="Hcom85926">
<div class="phpcode"><code><span class="html">
In Addition to david lionhead's function:<br><br><span class="default">&lt;?php<br></span><span class="keyword">function </span><span class="default">quoted_printable_encode</span><span class="keyword">(</span><span class="default">$txt</span><span class="keyword">) {<br>&nbsp; &nbsp; </span><span class="comment">/* Make sure there are no %20 or similar */<br>&nbsp; &nbsp; </span><span class="default">$txt </span><span class="keyword">= </span><span class="default">rawurldecode</span><span class="keyword">(</span><span class="default">$txt</span><span class="keyword">);<br>&nbsp; &nbsp; </span><span class="default">$tmp</span><span class="keyword">=</span><span class="string">""</span><span class="keyword">;<br>&nbsp; &nbsp; </span><span class="default">$line</span><span class="keyword">=</span><span class="string">""</span><span class="keyword">;<br>&nbsp; &nbsp; for (</span><span class="default">$i</span><span class="keyword">=</span><span class="default">0</span><span class="keyword">;</span><span class="default">$i</span><span class="keyword">&lt;</span><span class="default">strlen</span><span class="keyword">(</span><span class="default">$txt</span><span class="keyword">);</span><span class="default">$i</span><span class="keyword">++) {<br>&nbsp; &nbsp; &nbsp; &nbsp; if ((</span><span class="default">$txt</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">]&gt;=</span><span class="string">'a' </span><span class="keyword">&amp;&amp; </span><span class="default">$txt</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">]&lt;=</span><span class="string">'z'</span><span class="keyword">) || (</span><span class="default">$txt</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">]&gt;=</span><span class="string">'A' </span><span class="keyword">&amp;&amp; </span><span class="default">$txt</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">]&lt;=</span><span class="string">'Z'</span><span class="keyword">) || (</span><span class="default">$txt</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">]&gt;=</span><span class="string">'0' </span><span class="keyword">&amp;&amp; </span><span class="default">$txt</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">]&lt;=</span><span class="string">'9'</span><span class="keyword">)) {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$line</span><span class="keyword">.=</span><span class="default">$txt</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">];<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if (</span><span class="default">strlen</span><span class="keyword">(</span><span class="default">$line</span><span class="keyword">)&gt;=</span><span class="default">75</span><span class="keyword">) {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$tmp</span><span class="keyword">.=</span><span class="string">"</span><span class="default">$line</span><span class="string">=\n"</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$line</span><span class="keyword">=</span><span class="string">""</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br>&nbsp; &nbsp; &nbsp; &nbsp; }<br>&nbsp; &nbsp; &nbsp; &nbsp; else {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="comment">/* Important to differentiate this case from the above */<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="keyword">if (</span><span class="default">strlen</span><span class="keyword">(</span><span class="default">$line</span><span class="keyword">)&gt;=</span><span class="default">72</span><span class="keyword">) {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$tmp</span><span class="keyword">.=</span><span class="string">"</span><span class="default">$line</span><span class="string">=\n"</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$line</span><span class="keyword">=</span><span class="string">""</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$line</span><span class="keyword">.=</span><span class="string">"="</span><span class="keyword">.</span><span class="default">sprintf</span><span class="keyword">(</span><span class="string">"%02X"</span><span class="keyword">,</span><span class="default">ord</span><span class="keyword">(</span><span class="default">$txt</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">]));<br>&nbsp; &nbsp; &nbsp; &nbsp; }<br>&nbsp; &nbsp; }<br>&nbsp; &nbsp; </span><span class="default">$tmp</span><span class="keyword">.=</span><span class="string">"</span><span class="default">$line</span><span class="string">\n"</span><span class="keyword">;<br>&nbsp; &nbsp; return </span><span class="default">$tmp</span><span class="keyword">;<br>}<br></span><span class="default">?&gt;</span>
</span>
</code></div>
  </div>
 </div>
  <div class="note" id="84403">  
  <a class="name">
  <strong class="user"><em>Bobo</em></strong></a><div class="date" title="2008-07-12 09:20"><strong>6 years ago</strong></div>
  <div class="text" id="Hcom84403">
<div class="phpcode"><code><span class="html">
Following up to Hoffa's function, return the result like:<br><br>chunk_split($string, 76, "=\n");<br><br>to conform to the RFC, which requires that lines are no longer than 76 chars.</span>
</code></div>
  </div>
 </div>
  <div class="note" id="82204">  
  <a class="name">
  <strong class="user"><em>h atnospam hoffa dotelidot se</em></strong></a><div class="date" title="2008-03-31 05:32"><strong>6 years ago</strong></div>
  <div class="text" id="Hcom82204">
<div class="phpcode"><code><span class="html">
I do like this to encode<br><br>function quoted_printable_encode($string) {<br>&nbsp; $string = rawurlencode($string);<br>&nbsp; $string = str_replace("%","=",$string);<br>&nbsp; RETURN $string;<br>}<br><br>best regards / Hoffa</span>
</code></div>
  </div>
 </div>
  <div class="note" id="82000">  
  <a class="name">
  <strong class="user"><em>vita dot plachy at seznam dot cz</em></strong></a><div class="date" title="2008-03-23 08:22"><strong>6 years ago</strong></div>
  <div class="text" id="Hcom82000">
<div class="phpcode"><code><span class="html">
<span class="default">&lt;?php
<br>$text </span><span class="keyword">= &lt;&lt;&lt;EOF
<br></span><span class="string">This function enables you to convert text to a quoted-printable string as well as to create encoded-words used in email headers (see <a rel="nofollow" target="_blank">http://www.faqs.org/rfcs/rfc2047.html</a>).
<br>
<br>No line of returned text will be longer than specified. Encoded-words will not contain a newline character. Special characters are removed.
<br></span><span class="keyword">EOF;
<br>
<br></span><span class="default">define</span><span class="keyword">(</span><span class="string">'QP_LINE_LENGTH'</span><span class="keyword">, </span><span class="default">75</span><span class="keyword">);
<br></span><span class="default">define</span><span class="keyword">(</span><span class="string">'QP_LINE_SEPARATOR'</span><span class="keyword">, </span><span class="string">"\r\n"</span><span class="keyword">);
<br>
<br>function </span><span class="default">quoted_printable_encode</span><span class="keyword">(</span><span class="default">$string</span><span class="keyword">, </span><span class="default">$encodedWord </span><span class="keyword">= </span><span class="default">false</span><span class="keyword">)
<br>{
<br>&nbsp; &nbsp; if(!</span><span class="default">preg_match</span><span class="keyword">(</span><span class="string">'//u'</span><span class="keyword">, </span><span class="default">$string</span><span class="keyword">)) {
<br>&nbsp; &nbsp; &nbsp; &nbsp; throw new </span><span class="default">Exception</span><span class="keyword">(</span><span class="string">'Input string is not valid UTF-8'</span><span class="keyword">);
<br>&nbsp; &nbsp; }
<br>&nbsp; &nbsp; 
<br>&nbsp; &nbsp; static </span><span class="default">$wordStart </span><span class="keyword">= </span><span class="string">'=?UTF-8?Q?'</span><span class="keyword">;
<br>&nbsp; &nbsp; static </span><span class="default">$wordEnd </span><span class="keyword">= </span><span class="string">'?='</span><span class="keyword">;
<br>&nbsp; &nbsp; static </span><span class="default">$endl </span><span class="keyword">= </span><span class="default">QP_LINE_SEPARATOR</span><span class="keyword">;
<br>&nbsp; &nbsp; 
<br>&nbsp; &nbsp; </span><span class="default">$lineLength </span><span class="keyword">= </span><span class="default">$encodedWord
<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="keyword">? </span><span class="default">QP_LINE_LENGTH </span><span class="keyword">- </span><span class="default">strlen</span><span class="keyword">(</span><span class="default">$wordStart</span><span class="keyword">) - </span><span class="default">strlen</span><span class="keyword">(</span><span class="default">$wordEnd</span><span class="keyword">)
<br>&nbsp; &nbsp; &nbsp; &nbsp; : </span><span class="default">QP_LINE_LENGTH</span><span class="keyword">;
<br>&nbsp; &nbsp; 
<br>&nbsp; &nbsp; </span><span class="default">$string </span><span class="keyword">= </span><span class="default">$encodedWord
<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="keyword">? </span><span class="default">preg_replace</span><span class="keyword">(</span><span class="string">'~[\r\n]+~'</span><span class="keyword">, </span><span class="string">' '</span><span class="keyword">, </span><span class="default">$string</span><span class="keyword">)&nbsp; &nbsp; </span><span class="comment">// we need encoded word to be single line
<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="keyword">: </span><span class="default">preg_replace</span><span class="keyword">(</span><span class="string">'~\r\n?~'</span><span class="keyword">, </span><span class="string">"\n"</span><span class="keyword">, </span><span class="default">$string</span><span class="keyword">);&nbsp; &nbsp; </span><span class="comment">// normalize line endings
<br>&nbsp; &nbsp; </span><span class="default">$string </span><span class="keyword">= </span><span class="default">preg_replace</span><span class="keyword">(</span><span class="string">'~[\x00-\x08\x0B-\x1F]+~'</span><span class="keyword">, </span><span class="string">''</span><span class="keyword">, </span><span class="default">$string</span><span class="keyword">);&nbsp; &nbsp; </span><span class="comment">// remove control characters
<br>&nbsp; &nbsp; 
<br>&nbsp; &nbsp; </span><span class="default">$output </span><span class="keyword">= </span><span class="default">$encodedWord </span><span class="keyword">? </span><span class="default">$wordStart </span><span class="keyword">: </span><span class="string">''</span><span class="keyword">;
<br>&nbsp; &nbsp; </span><span class="default">$charsLeft </span><span class="keyword">= </span><span class="default">$lineLength</span><span class="keyword">;
<br>&nbsp; &nbsp; 
<br>&nbsp; &nbsp; </span><span class="default">$chr </span><span class="keyword">= isset(</span><span class="default">$string</span><span class="keyword">{</span><span class="default">0</span><span class="keyword">}) ? </span><span class="default">$string</span><span class="keyword">{</span><span class="default">0</span><span class="keyword">} : </span><span class="default">null</span><span class="keyword">;
<br>&nbsp; &nbsp; </span><span class="default">$ord </span><span class="keyword">= </span><span class="default">ord</span><span class="keyword">(</span><span class="default">$chr</span><span class="keyword">);
<br>&nbsp; &nbsp; 
<br>&nbsp; &nbsp; for (</span><span class="default">$i </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">; isset(</span><span class="default">$chr</span><span class="keyword">); </span><span class="default">$i</span><span class="keyword">++) {
<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$nextChr </span><span class="keyword">= isset(</span><span class="default">$string</span><span class="keyword">{</span><span class="default">$i </span><span class="keyword">+ </span><span class="default">1</span><span class="keyword">}) ? </span><span class="default">$string</span><span class="keyword">{</span><span class="default">$i </span><span class="keyword">+ </span><span class="default">1</span><span class="keyword">} : </span><span class="default">null</span><span class="keyword">;
<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$nextOrd </span><span class="keyword">= </span><span class="default">ord</span><span class="keyword">(</span><span class="default">$nextChr</span><span class="keyword">);
<br>&nbsp; &nbsp; &nbsp; &nbsp; 
<br>&nbsp; &nbsp; &nbsp; &nbsp; if (
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$ord </span><span class="keyword">&gt; </span><span class="default">127 </span><span class="keyword">or&nbsp; &nbsp; </span><span class="comment">// high byte value
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$ord </span><span class="keyword">=== </span><span class="default">95 </span><span class="keyword">or&nbsp; &nbsp; </span><span class="comment">// underscore "_"
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$ord </span><span class="keyword">=== </span><span class="default">63 </span><span class="keyword">&amp;&amp; </span><span class="default">$encodedWord </span><span class="keyword">or&nbsp; &nbsp; </span><span class="comment">// "?" in encoded word
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$ord </span><span class="keyword">=== </span><span class="default">61 </span><span class="keyword">or&nbsp; &nbsp; </span><span class="comment">// equal sign "="
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; // space or tab in encoded word or at line end
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$ord </span><span class="keyword">=== </span><span class="default">32 </span><span class="keyword">|| </span><span class="default">$ord </span><span class="keyword">=== </span><span class="default">9 </span><span class="keyword">and </span><span class="default">$encodedWord </span><span class="keyword">|| !isset(</span><span class="default">$nextOrd</span><span class="keyword">) || </span><span class="default">$nextOrd </span><span class="keyword">=== </span><span class="default">10
<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="keyword">) {
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$chr </span><span class="keyword">= </span><span class="default">sprintf</span><span class="keyword">(</span><span class="string">'=%02X'</span><span class="keyword">, </span><span class="default">$ord</span><span class="keyword">);&nbsp; &nbsp; 
<br>&nbsp; &nbsp; &nbsp; &nbsp; }
<br>&nbsp; &nbsp; &nbsp; &nbsp; 
<br>&nbsp; &nbsp; &nbsp; &nbsp; if (</span><span class="default">$ord </span><span class="keyword">=== </span><span class="default">10</span><span class="keyword">) {&nbsp; &nbsp; </span><span class="comment">// line feed
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$output </span><span class="keyword">.= </span><span class="default">$endl</span><span class="keyword">;
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$charsLeft </span><span class="keyword">= </span><span class="default">$lineLength</span><span class="keyword">;
<br>&nbsp; &nbsp; &nbsp; &nbsp; } elseif (
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">strlen</span><span class="keyword">(</span><span class="default">$chr</span><span class="keyword">) &lt; </span><span class="default">$charsLeft </span><span class="keyword">or
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">strlen</span><span class="keyword">(</span><span class="default">$chr</span><span class="keyword">) === </span><span class="default">$charsLeft </span><span class="keyword">and </span><span class="default">$nextOrd </span><span class="keyword">=== </span><span class="default">10 </span><span class="keyword">|| </span><span class="default">$encodedWord
<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="keyword">) {&nbsp; &nbsp; </span><span class="comment">// add character
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$output </span><span class="keyword">.= </span><span class="default">$chr</span><span class="keyword">;
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$charsLeft</span><span class="keyword">-=</span><span class="default">strlen</span><span class="keyword">(</span><span class="default">$chr</span><span class="keyword">);
<br>&nbsp; &nbsp; &nbsp; &nbsp; } elseif (isset(</span><span class="default">$nextOrd</span><span class="keyword">)) {&nbsp; &nbsp; </span><span class="comment">// another line needed
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$output </span><span class="keyword">.= </span><span class="default">$encodedWord
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="keyword">? </span><span class="default">$wordEnd </span><span class="keyword">. </span><span class="default">$endl </span><span class="keyword">. </span><span class="string">"\t" </span><span class="keyword">. </span><span class="default">$wordStart </span><span class="keyword">. </span><span class="default">$chr
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="keyword">: </span><span class="string">'=' </span><span class="keyword">. </span><span class="default">$endl </span><span class="keyword">. </span><span class="default">$chr</span><span class="keyword">;
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$charsLeft </span><span class="keyword">= </span><span class="default">$lineLength </span><span class="keyword">- </span><span class="default">strlen</span><span class="keyword">(</span><span class="default">$chr</span><span class="keyword">);
<br>&nbsp; &nbsp; &nbsp; &nbsp; }
<br>&nbsp; &nbsp; &nbsp; &nbsp; 
<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$chr </span><span class="keyword">= </span><span class="default">$nextChr</span><span class="keyword">;
<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$ord </span><span class="keyword">= </span><span class="default">$nextOrd</span><span class="keyword">;
<br>&nbsp; &nbsp; }
<br>&nbsp; &nbsp; 
<br>&nbsp; &nbsp; return </span><span class="default">$output </span><span class="keyword">. (</span><span class="default">$encodedWord </span><span class="keyword">? </span><span class="default">$wordEnd </span><span class="keyword">: </span><span class="string">''</span><span class="keyword">);
<br>}
<br>
<br>echo </span><span class="default">quoted_printable_encode</span><span class="keyword">(</span><span class="default">$text</span><span class="comment">/*, true*/</span><span class="keyword">);</span>
</span>
</code></div>
  </div>
 </div>
  <div class="note" id="73187">  
  <a class="name">
  <strong class="user"><em>legolas558</em></strong></a><div class="date" title="2007-02-12 10:32"><strong>7 years ago</strong></div>
  <div class="text" id="Hcom73187">
<div class="phpcode"><code><span class="html">
Please note that in the below encode function there is a bug!<br><br><span class="default">&lt;?php<br></span><span class="keyword">if ((</span><span class="default">$c</span><span class="keyword">==</span><span class="default">0x3d</span><span class="keyword">) || (</span><span class="default">$c</span><span class="keyword">&gt;=</span><span class="default">0x80</span><span class="keyword">) || (</span><span class="default">$c</span><span class="keyword">&lt;</span><span class="default">0x20</span><span class="keyword">))<br></span><span class="default">?&gt;<br></span><br>$c should be checked against less or equal to encode spaces!<br><br>so the correct code is<br><br><span class="default">&lt;?php<br></span><span class="keyword">if ((</span><span class="default">$c</span><span class="keyword">==</span><span class="default">0x3d</span><span class="keyword">) || (</span><span class="default">$c</span><span class="keyword">&gt;=</span><span class="default">0x80</span><span class="keyword">) || (</span><span class="default">$c</span><span class="keyword">&lt;=</span><span class="default">0x20</span><span class="keyword">))<br></span><span class="default">?&gt;<br></span><br>Fix the code or post this note, please</span>
</code></div>
  </div>
 </div></div>

 
</section>    </section><!-- layout-content -->
        


  </div><!-- layout -->
         
  

    
 <!-- External and third party libraries. -->
 







<a id="toTop" href="javascript:;"><span id="toTopHover"></span><img width="40" height="40" alt="To Top" src="../../images/to-top%402x.png"></a>



<!-- Mirrored from php.net/manual/en/function.quoted-printable-decode.php by HTTrack Website Copier/3.x [XR&CO'2013], Thu, 28 Aug 2014 16:51:16 GMT -->


</body></html>