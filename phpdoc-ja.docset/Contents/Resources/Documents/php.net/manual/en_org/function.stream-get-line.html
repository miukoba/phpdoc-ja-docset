<html><!-- Mirrored from php.net/manual/en/function.stream-get-line.php by HTTrack Website Copier/3.x [XR&CO'2013], Thu, 28 Aug 2014 16:07:35 GMT --><!-- Added by HTTrack --><head><meta http-equiv="content-type" content="text/html;charset=utf-8"><!-- /Added by HTTrack -->


  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0"> 

  <title>stream_get_line</title>

 <link rel="shortcut icon" href="../../favicon.ico">
 <link rel="search" type="application/opensearchdescription+xml" href="http://php.net/phpnetimprovedsearch.src" title="Add PHP.net search">
 <link rel="alternate" type="application/atom+xml" href="http://php.net/releases/feed.php" title="PHP Release feed">
 <link rel="alternate" type="application/atom+xml" href="http://php.net/feed.atom" title="PHP: Hypertext Preprocessor">

 <link rel="canonical" href="function.stream-get-line.html">
 <link rel="shorturl" href="http://php.net/stream-get-line">
 <link rel="alternate" href="http://php.net/stream-get-line" hreflang="x-default">

 <link rel="contents" href="index-2.html">
 <link rel="index" href="ref.stream.html">
 <link rel="prev" href="function.stream-get-filters.html">
 <link rel="next" href="function.stream-get-meta-data.html">

 <link rel="alternate" href="function.stream-get-line.html" hreflang="en">
 <link rel="alternate" href="http://php.net/manual/pt_BR/function.stream-get-line.php" hreflang="pt_BR">
 <link rel="alternate" href="http://php.net/manual/zh/function.stream-get-line.php" hreflang="zh">
 <link rel="alternate" href="http://php.net/manual/fr/function.stream-get-line.php" hreflang="fr">
 <link rel="alternate" href="http://php.net/manual/de/function.stream-get-line.php" hreflang="de">
 <link rel="alternate" href="http://php.net/manual/it/function.stream-get-line.php" hreflang="it">
 <link rel="alternate" href="http://php.net/manual/ja/function.stream-get-line.php" hreflang="ja">
 <link rel="alternate" href="http://php.net/manual/ro/function.stream-get-line.php" hreflang="ro">
 <link rel="alternate" href="http://php.net/manual/ru/function.stream-get-line.php" hreflang="ru">
 <link rel="alternate" href="http://php.net/manual/es/function.stream-get-line.php" hreflang="es">
 <link rel="alternate" href="http://php.net/manual/tr/function.stream-get-line.php" hreflang="tr">

<link rel="stylesheet" type="text/css" href="../../cached8fe1.css?t=1401250819&amp;f=/fonts/Fira/fira.css" media="screen">
<link rel="stylesheet" type="text/css" href="../../cached4b8d.css?t=1404368420&amp;f=/fonts/Font-Awesome/css/fontello.css" media="screen">
<link rel="stylesheet" type="text/css" href="../../cached5065.css?t=1403329232&amp;f=/styles/theme-base.css" media="screen">
<link rel="stylesheet" type="text/css" href="../../cachedc78d.css?t=1401249623&amp;f=/styles/theme-medium.css" media="screen">

 <!--[if lte IE 7]>
 <link rel="stylesheet" type="text/css" href="http://php.net/styles/workarounds.ie7.css" media="screen">
 <![endif]-->

 <!--[if lte IE 8]>
 <script type="text/javascript">
  window.brokenIE = true;
 </script>
 <![endif]-->

 <!--[if lte IE 9]>
 <link rel="stylesheet" type="text/css" href="http://php.net/styles/workarounds.ie9.css" media="screen">
 <![endif]-->

 <!--[if IE]>
 <script type="text/javascript" src="http://php.net/js/ext/html5.js"></script>
 <![endif]-->

 <base>

</head>
<body class="docs " style="">


<div class="headsup"><a href="http://php.net/index.php#id2014-08-28-1">PHP 5.6.0 released</a></div>
<nav id="trick"><div><dl>
<dt><a href="getting-started.html">Getting Started</a></dt>
	<dd><a href="introduction.html">Introduction</a></dd>
	<dd><a href="tutorial.html">A simple tutorial</a></dd>
<dt><a href="langref.html">Language Reference</a></dt>
	<dd><a href="language.basic-syntax.html">Basic syntax</a></dd>
	<dd><a href="language.types.html">Types</a></dd>
	<dd><a href="language.variables.html">Variables</a></dd>
	<dd><a href="language.constants.html">Constants</a></dd>
	<dd><a href="language.expressions.html">Expressions</a></dd>
	<dd><a href="language.operators.html">Operators</a></dd>
	<dd><a href="language.control-structures.html">Control Structures</a></dd>
	<dd><a href="language.functions.html">Functions</a></dd>
	<dd><a href="language.oop5.html">Classes and Objects</a></dd>
	<dd><a href="language.namespaces.html">Namespaces</a></dd>
	<dd><a href="language.exceptions.html">Exceptions</a></dd>
	<dd><a href="language.generators.html">Generators</a></dd>
	<dd><a href="language.references.html">References Explained</a></dd>
	<dd><a href="reserved.variables.html">Predefined Variables</a></dd>
	<dd><a href="reserved.exceptions.html">Predefined Exceptions</a></dd>
	<dd><a href="reserved.interfaces.html">Predefined Interfaces and Classes</a></dd>
	<dd><a href="context.html">Context options and parameters</a></dd>
	<dd><a href="wrappers.html">Supported Protocols and Wrappers</a></dd>
</dl>
<dl>
<dt><a href="security.html">Security</a></dt>
	<dd><a href="security.intro.html">Introduction</a></dd>
	<dd><a href="security.general.html">General considerations</a></dd>
	<dd><a href="security.cgi-bin.html">Installed as CGI binary</a></dd>
	<dd><a href="security.apache.html">Installed as an Apache module</a></dd>
	<dd><a href="security.filesystem.html">Filesystem Security</a></dd>
	<dd><a href="security.database.html">Database Security</a></dd>
	<dd><a href="security.errors.html">Error Reporting</a></dd>
	<dd><a href="security.globals.html">Using Register Globals</a></dd>
	<dd><a href="security.variables.html">User Submitted Data</a></dd>
	<dd><a href="security.magicquotes.html">Magic Quotes</a></dd>
	<dd><a href="security.hiding.html">Hiding PHP</a></dd>
	<dd><a href="security.current.html">Keeping Current</a></dd>
<dt><a href="features.html">Features</a></dt>
	<dd><a href="features.http-auth.html">HTTP authentication with PHP</a></dd>
	<dd><a href="features.cookies.html">Cookies</a></dd>
	<dd><a href="features.sessions.html">Sessions</a></dd>
	<dd><a href="features.xforms.html">Dealing with XForms</a></dd>
	<dd><a href="features.file-upload.html">Handling file uploads</a></dd>
	<dd><a href="features.remote-files.html">Using remote files</a></dd>
	<dd><a href="features.connection-handling.html">Connection handling</a></dd>
	<dd><a href="features.persistent-connections.html">Persistent Database Connections</a></dd>
	<dd><a href="features.safe-mode.html">Safe Mode</a></dd>
	<dd><a href="features.commandline.html">Command line usage</a></dd>
	<dd><a href="features.gc.html">Garbage Collection</a></dd>
	<dd><a href="features.dtrace.html">DTrace Dynamic Tracing</a></dd>
</dl>
<dl>
<dt><a href="funcref.html">Function Reference</a></dt>
	<dd><a href="refs.basic.php.html">Affecting PHP's Behaviour</a></dd>
	<dd><a href="refs.utilspec.audio.html">Audio Formats Manipulation</a></dd>
	<dd><a href="refs.remote.auth.html">Authentication Services</a></dd>
	<dd><a href="refs.utilspec.cmdline.html">Command Line Specific Extensions</a></dd>
	<dd><a href="refs.compression.html">Compression and Archive Extensions</a></dd>
	<dd><a href="refs.creditcard.html">Credit Card Processing</a></dd>
	<dd><a href="refs.crypto.html">Cryptography Extensions</a></dd>
	<dd><a href="refs.database.html">Database Extensions</a></dd>
	<dd><a href="refs.calendar.html">Date and Time Related Extensions</a></dd>
	<dd><a href="refs.fileprocess.file.html">File System Related Extensions</a></dd>
	<dd><a href="refs.international.html">Human Language and Character Encoding Support</a></dd>
	<dd><a href="refs.utilspec.image.html">Image Processing and Generation</a></dd>
	<dd><a href="refs.remote.mail.html">Mail Related Extensions</a></dd>
	<dd><a href="refs.math.html">Mathematical Extensions</a></dd>
	<dd><a href="refs.utilspec.nontext.html">Non-Text MIME Output</a></dd>
	<dd><a href="refs.fileprocess.process.html">Process Control Extensions</a></dd>
	<dd><a href="refs.basic.other.html">Other Basic Extensions</a></dd>
	<dd><a href="refs.remote.other.html">Other Services</a></dd>
	<dd><a href="refs.search.html">Search Engine Extensions</a></dd>
	<dd><a href="refs.utilspec.server.html">Server Specific Extensions</a></dd>
	<dd><a href="refs.basic.session.html">Session Extensions</a></dd>
	<dd><a href="refs.basic.text.html">Text Processing</a></dd>
	<dd><a href="refs.basic.vartype.html">Variable and Type Related Extensions</a></dd>
	<dd><a href="refs.webservice.html">Web Services</a></dd>
	<dd><a href="refs.utilspec.windows.html">Windows Only Extensions</a></dd>
	<dd><a href="refs.xml.html">XML Manipulation</a></dd>
</dl>
<dl>
<dt>Keyboard Shortcuts</dt><dt>?</dt>
<dd>This help</dd>
<dt>j</dt>
<dd>Next menu item</dd>
<dt>k</dt>
<dd>Previous menu item</dd>
<dt>g p</dt>
<dd>Previous man page</dd>
<dt>g n</dt>
<dd>Next man page</dd>
<dt>G</dt>
<dd>Scroll to bottom</dd>
<dt>g g</dt>
<dd>Scroll to top</dd>
<dt>g h</dt>
<dd>Goto homepage</dd>
<dt>g s</dt>
<dd>Goto search<br>(current page)</dd>
<dt>/</dt>
<dd>Focus search box</dd>
</dl></div></nav>
<div id="goto">
    <div class="search">
         <div class="text"></div>
         <div class="results"><ul></ul></div>
   </div>
</div>

  <div id="breadcrumbs" class="row-fluid">
          
              
        <ul class="breadcrumbs-container">
            <li><a href="index-2.html">PHP Manual</a></li>      <li><a href="funcref.html">Function Reference</a></li>      <li><a href="refs.basic.other.html">Other Basic Extensions</a></li>      <li><a href="book.stream.html">Streams</a></li>      <li><a href="ref.stream.html">Stream Functions</a></li>    </ul>
  </div>




<div id="layout">
  <section id="layout-content">
  <div id="function.stream-get-line" class="refentry">
 <div class="refnamediv">
  <h1 class="refname">stream_get_line</h1>
  <p class="verinfo">(PHP 5)</p><p class="refpurpose"><span class="refname">stream_get_line</span> â€” <span class="dc-title">Gets line from stream resource up to a given delimiter</span></p>

 </div>
 <div class="refsect1 description" id="refsect1-function.stream-get-line-description">
  <h3 class="title">Description</h3>
  <div class="methodsynopsis dc-description">
   <span class="type">string</span> <span class="methodname"><strong>stream_get_line</strong></span>
    ( <span class="methodparam"><span class="type">resource</span> <code class="parameter">$handle</code></span>
   , <span class="methodparam"><span class="type">int</span> <code class="parameter">$length</code></span>
   [, <span class="methodparam"><span class="type">string</span> <code class="parameter">$ending</code></span>
  ] )</div>

  <p class="para rdfs-comment">
   Gets a line from the given handle.
  </p>
  <p class="para">
   Reading ends when <code class="parameter">length</code> bytes have been read, when
   the string specified by <code class="parameter">ending</code> is found (which is
   <em class="emphasis">not</em> included in the return value), or on <acronym title="End Of File">EOF</acronym>
   (whichever comes first).
  </p>
  <p class="para">
   This function is nearly identical to <span class="function"><a href="function.fgets.html" class="function">fgets()</a></span> except in
   that it allows end of line delimiters other than the standard \n, \r, and
   \r\n, and does <em class="emphasis">not</em> return the delimiter itself.
  </p>
 </div>


 <div class="refsect1 parameters" id="refsect1-function.stream-get-line-parameters">
  <h3 class="title">Parameters</h3>
  <p class="para">
   </p><dl>

    
     <dt>
<code class="parameter">handle</code></dt>

     <dd>

      <p class="para">
       A valid file handle.
      </p>
     </dd>

    
    
     <dt>
<code class="parameter">length</code></dt>

     <dd>

      <p class="para">
       The number of bytes to read from the handle.
      </p>
     </dd>

    
    
     <dt>
<code class="parameter">ending</code></dt>

     <dd>

      <p class="para">
       An optional string delimiter.
      </p>
     </dd>

    
   </dl>

  <p></p>
 </div>


 <div class="refsect1 returnvalues" id="refsect1-function.stream-get-line-returnvalues">
  <h3 class="title">Return Values</h3>
  <p class="para">
   Returns a string of up to <code class="parameter">length</code> bytes read from the file
   pointed to by <code class="parameter">handle</code>.
  </p>
  <p class="para">
   If an error occurs, returns <strong><code>FALSE</code></strong>.
  </p>
 </div>

  
 <div class="refsect1 seealso" id="refsect1-function.stream-get-line-seealso">
  <h3 class="title">See Also</h3>
  <ul class="simplelist">
   <li class="member"><span class="function"><a href="function.fread.html" class="function" rel="rdfs-seeAlso">fread()</a> - Binary-safe file read</span></li>
   <li class="member"><span class="function"><a href="function.fgets.html" class="function" rel="rdfs-seeAlso">fgets()</a> - Gets line from file pointer</span></li>
   <li class="member"><span class="function"><a href="function.fgetc.html" class="function" rel="rdfs-seeAlso">fgetc()</a> - Gets character from file pointer</span></li>
  </ul>
 </div>


</div>
<section id="usernotes">
 <div class="head"><h3 class="title">User Contributed Notes</h3></div><div id="allnotes">
  <div class="note" id="67555">  
  <a class="name">
  <strong class="user"><em>dante at lorenso dot com</em></strong></a><div class="date" title="2006-06-08 12:34"><strong>8 years ago</strong></div>
  <div class="text" id="Hcom67555">
<div class="phpcode"><code><span class="html">
My testing has found this function to be dramatically faster than fgets on PHP 5.1.14.&nbsp; The difference is probably due to how buffering is used internally.&nbsp; Compare the following:
<br><span class="default">&lt;?php
<br></span><span class="comment">// reads 10,000 lines in 27 seconds
<br></span><span class="keyword">while (!</span><span class="default">feof</span><span class="keyword">(</span><span class="default">$handle</span><span class="keyword">)) {
<br>&nbsp; &nbsp; </span><span class="default">$line </span><span class="keyword">= </span><span class="default">fgets</span><span class="keyword">(</span><span class="default">$handle</span><span class="keyword">, </span><span class="default">1000000</span><span class="keyword">); 
<br>}
<br></span><span class="default">?&gt;
<br></span>vs.
<br><span class="default">&lt;?php
<br></span><span class="comment">// reads 10,000 lines in 0.5 seconds
<br></span><span class="keyword">while (!</span><span class="default">feof</span><span class="keyword">(</span><span class="default">$handle</span><span class="keyword">)) {
<br>&nbsp; &nbsp; </span><span class="default">$line </span><span class="keyword">= </span><span class="default">stream_get_line</span><span class="keyword">(</span><span class="default">$handle</span><span class="keyword">, </span><span class="default">1000000</span><span class="keyword">, </span><span class="string">"\n"</span><span class="keyword">);
<br>}
<br></span><span class="default">?&gt;</span>
</span>
</code></div>
  </div>
 </div>
  <div class="note" id="79944">  
  <a class="name">
  <strong class="user"><em>Mat Jaggard  at  Tickets dot com</em></strong></a><div class="date" title="2007-12-20 08:12"><strong>6 years ago</strong></div>
  <div class="text" id="Hcom79944">
<div class="phpcode"><code><span class="html">
I've spent quite a while trying to get stream_get_line to get a chunk encoded html file and to finish correctly at the end so that I can pipeline requests.<br><br>This is the function I have come up with.<br><br><span class="default">&lt;?php<br>&nbsp; &nbsp; </span><span class="keyword">function </span><span class="default">getURLContents</span><span class="keyword">(</span><span class="default">$url</span><span class="keyword">, </span><span class="default">$ip</span><span class="keyword">, </span><span class="default">$port</span><span class="keyword">, </span><span class="default">$ssl </span><span class="keyword">= </span><span class="default">false</span><span class="keyword">, </span><span class="default">$closeConnection </span><span class="keyword">= </span><span class="default">false</span><span class="keyword">)<br>&nbsp; &nbsp; {<br>&nbsp; &nbsp; &nbsp; &nbsp; if (</span><span class="default">$ssl</span><span class="keyword">)<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$ssl </span><span class="keyword">= </span><span class="string">'ssl://'</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; else<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$ssl </span><span class="keyword">= </span><span class="string">''</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$fp </span><span class="keyword">= </span><span class="default">pfsockopen</span><span class="keyword">(</span><span class="default">$ssl</span><span class="keyword">.</span><span class="default">$ip</span><span class="keyword">, </span><span class="default">$port</span><span class="keyword">, </span><span class="default">$errno</span><span class="keyword">, </span><span class="default">$errstr</span><span class="keyword">, </span><span class="default">MAX_TIME_TO_START_CONNECTION</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; if (</span><span class="default">$fp</span><span class="keyword">)<br>&nbsp; &nbsp; &nbsp; &nbsp; {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$out </span><span class="keyword">=&nbsp; </span><span class="string">'GET '</span><span class="keyword">.</span><span class="default">$url</span><span class="keyword">.</span><span class="string">" HTTP/1.1\r\n"</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$out </span><span class="keyword">.= </span><span class="string">'Host: '</span><span class="keyword">.</span><span class="default">$ip</span><span class="keyword">.</span><span class="string">':'</span><span class="keyword">.</span><span class="default">$port</span><span class="keyword">.</span><span class="string">"\r\n"</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if (</span><span class="default">$closeConnection</span><span class="keyword">)<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$out </span><span class="keyword">.= </span><span class="string">"Connection: close\r\n"</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; else<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$out </span><span class="keyword">.= </span><span class="string">"Connection: keep-alive\r\n"</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$out </span><span class="keyword">.= </span><span class="string">"\r\n"</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if (!</span><span class="default">fwrite</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">, </span><span class="default">$out</span><span class="keyword">))<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; echo </span><span class="string">'Problem writing to socket, opening a new connection.'</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">fclose</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$fp </span><span class="keyword">= </span><span class="default">pfsockopen</span><span class="keyword">(</span><span class="default">$ssl</span><span class="keyword">.</span><span class="default">$ip</span><span class="keyword">, </span><span class="default">$port</span><span class="keyword">, </span><span class="default">$errno</span><span class="keyword">, </span><span class="default">$errstr</span><span class="keyword">, </span><span class="default">MAX_TIME_TO_START_CONNECTION</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">fwrite</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">, </span><span class="default">$out</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$theData </span><span class="keyword">= </span><span class="string">''</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$notDone </span><span class="keyword">= </span><span class="default">true</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">stream_set_blocking</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$startTime </span><span class="keyword">= </span><span class="default">time</span><span class="keyword">();<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$lastTime </span><span class="keyword">= </span><span class="default">$startTime</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; while (!</span><span class="default">feof</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">) &amp;&amp; !</span><span class="default">$done </span><span class="keyword">&amp;&amp; ((</span><span class="default">$startTime </span><span class="keyword">+ </span><span class="default">MAX_TIME_FOR_THE_RESPONSE</span><span class="keyword">) &gt; </span><span class="default">time</span><span class="keyword">()))<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">usleep</span><span class="keyword">(</span><span class="default">100</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$theNewData </span><span class="keyword">= </span><span class="default">stream_get_line</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">, </span><span class="default">1024</span><span class="keyword">, </span><span class="string">"\n"</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$theData </span><span class="keyword">.= </span><span class="default">$theNewData</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$done </span><span class="keyword">= (</span><span class="default">trim</span><span class="keyword">(</span><span class="default">$theNewData</span><span class="keyword">) === </span><span class="string">'0'</span><span class="keyword">);<br><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br>&nbsp; &nbsp; &nbsp; &nbsp; }<br>&nbsp; &nbsp; &nbsp; &nbsp; else<br>&nbsp; &nbsp; &nbsp; &nbsp; {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; echo </span><span class="string">'ERROR CONNECTING TO '</span><span class="keyword">.</span><span class="default">$ip</span><span class="keyword">.</span><span class="string">':'</span><span class="keyword">.</span><span class="default">$port</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; return </span><span class="default">false</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; }<br>&nbsp; &nbsp; &nbsp; &nbsp; if (</span><span class="default">$closeConnection</span><span class="keyword">)<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">fclose</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; return </span><span class="default">$theData</span><span class="keyword">;<br>&nbsp; &nbsp; }<br></span><span class="default">?&gt;</span>
</span>
</code></div>
  </div>
 </div>
  <div class="note" id="111034">  
  <a class="name">
  <strong class="user"><em>carltondickson</em></strong></a><div class="date" title="2013-01-08 04:25"><strong>1 year ago</strong></div>
  <div class="text" id="Hcom111034">
<div class="phpcode"><code><span class="html">
If you are specifying the 3rd optional "ending" parameter as a string which is more than one character and actually find that the line returned by the function sometimes contains this "ending" value it may be related to the following bug, https://bugs.php.net/bug.php?id=63240<br><br>Our server was running 5.3.18 and when we upgraded to 5.3.20 it worked fine, I believe this was fixed in 5.3.19 though.</span>
</code></div>
  </div>
 </div>
  <div class="note" id="94879">  
  <a class="name">
  <strong class="user"><em>pk at ritm dot ru</em></strong></a><div class="date" title="2009-11-30 09:30"><strong>4 years ago</strong></div>
  <div class="text" id="Hcom94879">
<div class="phpcode"><code><span class="html">
fgets is faster but stream_get_line is more useful in a tcp server scripts.<br><br>when fgets reads some bytes from socket, where EOF is reached, it returns bool(false) same as stream_get_line<br><br>BUT if remote client drops connection, and server script will try to read some data with function fgets, function will return bool(false), and stream_get_line will return string(0) ""<br><br>so you can detect remote client disconnection with stream_get_line, and cannot with fgets</span>
</code></div>
  </div>
 </div>
  <div class="note" id="85193">  
  <a class="name">
  <strong class="user"><em>amoo_miki at yahoo dot com</em></strong></a><div class="date" title="2008-08-19 10:34"><strong>6 years ago</strong></div>
  <div class="text" id="Hcom85193">
<div class="phpcode"><code><span class="html">
If the "ending" is a string, there are cases where the function doesn't return the correct value for the first time it is called. Don't be shocked if you find it returning a string value of upto "length" that includes the "ending". (See bug #44607)
<br>
<br>If the "ending" is just a single character, the function would always work correctly. ("\n" is a single character)
<br>
<br>Temporarily, until this is fixed, the below function can be used:
<br>
<br><span class="default">&lt;?php
<br></span><span class="keyword">function </span><span class="default">istream_get_line</span><span class="keyword">(&amp;</span><span class="default">$fp</span><span class="keyword">, </span><span class="default">$length</span><span class="keyword">, </span><span class="default">$end</span><span class="keyword">) {
<br>&nbsp; &nbsp; </span><span class="default">$current </span><span class="keyword">= </span><span class="default">ftell</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">);
<br>&nbsp; &nbsp; </span><span class="default">$str </span><span class="keyword">= </span><span class="default">fread</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">, </span><span class="default">$length</span><span class="keyword">);
<br>&nbsp; &nbsp; </span><span class="default">$i </span><span class="keyword">= </span><span class="default">strpos</span><span class="keyword">(</span><span class="default">$str</span><span class="keyword">, </span><span class="default">$end</span><span class="keyword">);
<br>&nbsp; &nbsp; if (</span><span class="default">$i </span><span class="keyword">=== </span><span class="default">FALSE</span><span class="keyword">) {
<br>&nbsp; &nbsp; &nbsp; &nbsp; return </span><span class="default">$str</span><span class="keyword">;&nbsp; &nbsp; 
<br>&nbsp; &nbsp; } else {
<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">fseek</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">, </span><span class="default">$current </span><span class="keyword">+ </span><span class="default">$i </span><span class="keyword">+ </span><span class="default">strlen</span><span class="keyword">(</span><span class="default">$end</span><span class="keyword">));
<br>&nbsp; &nbsp; &nbsp; &nbsp; return </span><span class="default">substr</span><span class="keyword">(</span><span class="default">$str</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">$i</span><span class="keyword">);
<br>&nbsp; &nbsp; }
<br>}
<br></span><span class="default">?&gt;</span>
</span>
</code></div>
  </div>
 </div>
  <div class="note" id="111731">  
  <a class="name">
  <strong class="user"><em>kjeld at mail4us dot dk</em></strong></a><div class="date" title="2013-03-21 10:56"><strong>1 year ago</strong></div>
  <div class="text" id="Hcom111731">
<div class="phpcode"><code><span class="html">
I have been struggling with the problem that stream_get_line() sometimes reads too much when the 3rd parameter is used (and the 3rd parameter has a length greater than 1), so $ending is actually contained in the data returned (https://bugs.php.net/bug.php?id=63240).<br><br>I don't have the option of upgrading my PHP version but it seems that a workaround can be to insert:<br><br>&nbsp; &nbsp; fseek($fp, ftell($fp));<br><br>just before calling stream_get_line().</span>
</code></div>
  </div>
 </div>
  <div class="note" id="109339">  
  <a class="name">
  <strong class="user"><em>Anonymous</em></strong></a><div class="date" title="2012-07-08 03:35"><strong>2 years ago</strong></div>
  <div class="text" id="Hcom109339">
<div class="phpcode"><code><span class="html">
WARNING:<br>Specifying a length of 0 does NOT give you an infinite length, contrary to what the documentation might suggest. Instead, setting a length of 0 just makes the function default to a length of 8192. To be precise, it gets the value PHP_SOCK_CHUNK_SIZE (8192) in ext/standard/streamsfuncs.c.<br><br>So, let's say you're trying to read ALL data until you reach a "\x03" (decimal 3) byte. How do you GUARANTEE that this is the case? Well, there's no way! The only thing you can do stream_get_lin() into a "master" string, then fseek() backwards by 1 character, then fgetc() and verify that it's "\x03". If you don't see a "\x03", it means that stream_get_line() has aborted after 8192 bytes and before hitting "\x03", and you'll have to call it again. Keep appending the return values to a "master" string until you hit a "\x03" or EOF... That's the ONLY way to properly build a string that contains EVERYTHING until the character you're looking for.</span>
</code></div>
  </div>
 </div>
  <div class="note" id="64568">  
  <a class="name"><strong class="user"><em>Anonymous</em></strong></a><div class="date" title="2006-04-18 02:07"><strong>8 years ago</strong></div>
  <div class="text" id="Hcom64568">
<div class="phpcode"><code><span class="html">
In version 5.0.4 using this funtion and then calling ftell($stream) would give you the position up to but not including the "ending" string. <br><br>When I rev'd to PHP version 5.1.2, calling this function then using ftell($stream) would give the position up to AND including the "ending" string<br><br>for example, parsing HTTP responses.<br><br>The response from apache using curl....<br>------------------------------------------------------------<br>HTTP/1.1 200 OK<br>Date: Tue, 18 Apr 2006 20:54:59 GMT<br>Server: Apache/1.3.33 (Unix) PHP/5.0.4 mod_ssl/2.8.22 OpenSSL/0.9.7e<br>X-Powered-By: PHP/5.0.4<br>Transfer-Encoding: chunked<br>Content-Type: text/html<br><br>&lt;html&gt;&lt;body&gt;test&lt;/body&gt;&lt;/html&gt;<br>-------------------------------------------------------------<br><br>The code:<br><br><span class="default">&lt;?php<br><br>&nbsp; $headers </span><span class="keyword">= </span><span class="default">stream_get_line</span><span class="keyword">(</span><span class="default">$in</span><span class="keyword">,</span><span class="default">4096</span><span class="keyword">,</span><span class="string">"\r\n\r\n"</span><span class="keyword">);<br><br>&nbsp;&nbsp; </span><span class="default">fseek </span><span class="keyword">(</span><span class="default">$in</span><span class="keyword">,</span><span class="default">ftell</span><span class="keyword">(</span><span class="default">$in</span><span class="keyword">)+</span><span class="default">4</span><span class="keyword">);<br><br>&nbsp;&nbsp; while (!</span><span class="default">feof</span><span class="keyword">(</span><span class="default">$in</span><span class="keyword">)){<br>&nbsp; &nbsp; &nbsp; </span><span class="default">fputs </span><span class="keyword">(</span><span class="default">$out</span><span class="keyword">,</span><span class="default">stream_get_line</span><span class="keyword">(</span><span class="default">$in</span><span class="keyword">,</span><span class="default">4096</span><span class="keyword">,</span><span class="string">''</span><span class="keyword">));<br>&nbsp;&nbsp; }<br><br></span><span class="default">?&gt;<br></span><br>prior to my 5.0.4 this worked perfectly, trimming the \r\n\r\n section of the HTTP response and seperating the top into the $headers string, and the rest was placed into the file handle $out.<br><br>using php 5.1.2, the above code chopps off the first 4 bytes of the HTTP response and puts <br><br>l&gt;&lt;body&gt;test&lt;/body&gt;&lt;/html&gt; <br><br>into $out.</span>
</code></div>
  </div>
 </div></div>

 
</section>    </section><!-- layout-content -->
        


  </div><!-- layout -->
         
  

    
 <!-- External and third party libraries. -->
 







<a id="toTop" href="javascript:;"><span id="toTopHover"></span><img width="40" height="40" alt="To Top" src="../../images/to-top%402x.png"></a>



<!-- Mirrored from php.net/manual/en/function.stream-get-line.php by HTTrack Website Copier/3.x [XR&CO'2013], Thu, 28 Aug 2014 16:07:35 GMT -->


</body></html>