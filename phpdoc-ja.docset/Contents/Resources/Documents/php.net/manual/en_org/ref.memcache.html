<html><!-- Mirrored from php.net/manual/en/ref.memcache.php by HTTrack Website Copier/3.x [XR&CO'2013], Thu, 28 Aug 2014 15:50:39 GMT --><!-- Added by HTTrack --><head><meta http-equiv="content-type" content="text/html;charset=utf-8"><!-- /Added by HTTrack -->


  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0"> 

  <title>Memcache Functions</title>

 <link rel="shortcut icon" href="../../favicon.ico">
 <link rel="search" type="application/opensearchdescription+xml" href="http://php.net/phpnetimprovedsearch.src" title="Add PHP.net search">
 <link rel="alternate" type="application/atom+xml" href="http://php.net/releases/feed.php" title="PHP Release feed">
 <link rel="alternate" type="application/atom+xml" href="http://php.net/feed.atom" title="PHP: Hypertext Preprocessor">

 <link rel="canonical" href="ref.memcache.html">
 <link rel="shorturl" href="http://php.net/memcache">
 <link rel="alternate" href="http://php.net/memcache" hreflang="x-default">

 <link rel="contents" href="index-2.html">
 <link rel="index" href="book.memcache.html">
 <link rel="prev" href="memcache.setserverparams.html">
 <link rel="next" href="function.memcache-debug.html">

 <link rel="alternate" href="ref.memcache.html" hreflang="en">
 <link rel="alternate" href="http://php.net/manual/pt_BR/ref.memcache.php" hreflang="pt_BR">
 <link rel="alternate" href="http://php.net/manual/zh/ref.memcache.php" hreflang="zh">
 <link rel="alternate" href="http://php.net/manual/fr/ref.memcache.php" hreflang="fr">
 <link rel="alternate" href="http://php.net/manual/de/ref.memcache.php" hreflang="de">
 <link rel="alternate" href="http://php.net/manual/it/ref.memcache.php" hreflang="it">
 <link rel="alternate" href="http://php.net/manual/ja/ref.memcache.php" hreflang="ja">
 <link rel="alternate" href="http://php.net/manual/ro/ref.memcache.php" hreflang="ro">
 <link rel="alternate" href="http://php.net/manual/ru/ref.memcache.php" hreflang="ru">
 <link rel="alternate" href="http://php.net/manual/es/ref.memcache.php" hreflang="es">
 <link rel="alternate" href="http://php.net/manual/tr/ref.memcache.php" hreflang="tr">

<link rel="stylesheet" type="text/css" href="../../cached8fe1.css?t=1401250819&amp;f=/fonts/Fira/fira.css" media="screen">
<link rel="stylesheet" type="text/css" href="../../cached4b8d.css?t=1404368420&amp;f=/fonts/Font-Awesome/css/fontello.css" media="screen">
<link rel="stylesheet" type="text/css" href="../../cached5065.css?t=1403329232&amp;f=/styles/theme-base.css" media="screen">
<link rel="stylesheet" type="text/css" href="../../cachedc78d.css?t=1401249623&amp;f=/styles/theme-medium.css" media="screen">

 <!--[if lte IE 7]>
 <link rel="stylesheet" type="text/css" href="http://php.net/styles/workarounds.ie7.css" media="screen">
 <![endif]-->

 <!--[if lte IE 8]>
 <script type="text/javascript">
  window.brokenIE = true;
 </script>
 <![endif]-->

 <!--[if lte IE 9]>
 <link rel="stylesheet" type="text/css" href="http://php.net/styles/workarounds.ie9.css" media="screen">
 <![endif]-->

 <!--[if IE]>
 <script type="text/javascript" src="http://php.net/js/ext/html5.js"></script>
 <![endif]-->

 <base>

</head>
<body class="docs " style="">


<div class="headsup"><a href="http://php.net/index.php#id2014-08-28-1">PHP 5.6.0 released</a></div>
<nav id="trick"><div><dl>
<dt><a href="getting-started.html">Getting Started</a></dt>
	<dd><a href="introduction.html">Introduction</a></dd>
	<dd><a href="tutorial.html">A simple tutorial</a></dd>
<dt><a href="langref.html">Language Reference</a></dt>
	<dd><a href="language.basic-syntax.html">Basic syntax</a></dd>
	<dd><a href="language.types.html">Types</a></dd>
	<dd><a href="language.variables.html">Variables</a></dd>
	<dd><a href="language.constants.html">Constants</a></dd>
	<dd><a href="language.expressions.html">Expressions</a></dd>
	<dd><a href="language.operators.html">Operators</a></dd>
	<dd><a href="language.control-structures.html">Control Structures</a></dd>
	<dd><a href="language.functions.html">Functions</a></dd>
	<dd><a href="language.oop5.html">Classes and Objects</a></dd>
	<dd><a href="language.namespaces.html">Namespaces</a></dd>
	<dd><a href="language.exceptions.html">Exceptions</a></dd>
	<dd><a href="language.generators.html">Generators</a></dd>
	<dd><a href="language.references.html">References Explained</a></dd>
	<dd><a href="reserved.variables.html">Predefined Variables</a></dd>
	<dd><a href="reserved.exceptions.html">Predefined Exceptions</a></dd>
	<dd><a href="reserved.interfaces.html">Predefined Interfaces and Classes</a></dd>
	<dd><a href="context.html">Context options and parameters</a></dd>
	<dd><a href="wrappers.html">Supported Protocols and Wrappers</a></dd>
</dl>
<dl>
<dt><a href="security.html">Security</a></dt>
	<dd><a href="security.intro.html">Introduction</a></dd>
	<dd><a href="security.general.html">General considerations</a></dd>
	<dd><a href="security.cgi-bin.html">Installed as CGI binary</a></dd>
	<dd><a href="security.apache.html">Installed as an Apache module</a></dd>
	<dd><a href="security.filesystem.html">Filesystem Security</a></dd>
	<dd><a href="security.database.html">Database Security</a></dd>
	<dd><a href="security.errors.html">Error Reporting</a></dd>
	<dd><a href="security.globals.html">Using Register Globals</a></dd>
	<dd><a href="security.variables.html">User Submitted Data</a></dd>
	<dd><a href="security.magicquotes.html">Magic Quotes</a></dd>
	<dd><a href="security.hiding.html">Hiding PHP</a></dd>
	<dd><a href="security.current.html">Keeping Current</a></dd>
<dt><a href="features.html">Features</a></dt>
	<dd><a href="features.http-auth.html">HTTP authentication with PHP</a></dd>
	<dd><a href="features.cookies.html">Cookies</a></dd>
	<dd><a href="features.sessions.html">Sessions</a></dd>
	<dd><a href="features.xforms.html">Dealing with XForms</a></dd>
	<dd><a href="features.file-upload.html">Handling file uploads</a></dd>
	<dd><a href="features.remote-files.html">Using remote files</a></dd>
	<dd><a href="features.connection-handling.html">Connection handling</a></dd>
	<dd><a href="features.persistent-connections.html">Persistent Database Connections</a></dd>
	<dd><a href="features.safe-mode.html">Safe Mode</a></dd>
	<dd><a href="features.commandline.html">Command line usage</a></dd>
	<dd><a href="features.gc.html">Garbage Collection</a></dd>
	<dd><a href="features.dtrace.html">DTrace Dynamic Tracing</a></dd>
</dl>
<dl>
<dt><a href="funcref.html">Function Reference</a></dt>
	<dd><a href="refs.basic.php.html">Affecting PHP's Behaviour</a></dd>
	<dd><a href="refs.utilspec.audio.html">Audio Formats Manipulation</a></dd>
	<dd><a href="refs.remote.auth.html">Authentication Services</a></dd>
	<dd><a href="refs.utilspec.cmdline.html">Command Line Specific Extensions</a></dd>
	<dd><a href="refs.compression.html">Compression and Archive Extensions</a></dd>
	<dd><a href="refs.creditcard.html">Credit Card Processing</a></dd>
	<dd><a href="refs.crypto.html">Cryptography Extensions</a></dd>
	<dd><a href="refs.database.html">Database Extensions</a></dd>
	<dd><a href="refs.calendar.html">Date and Time Related Extensions</a></dd>
	<dd><a href="refs.fileprocess.file.html">File System Related Extensions</a></dd>
	<dd><a href="refs.international.html">Human Language and Character Encoding Support</a></dd>
	<dd><a href="refs.utilspec.image.html">Image Processing and Generation</a></dd>
	<dd><a href="refs.remote.mail.html">Mail Related Extensions</a></dd>
	<dd><a href="refs.math.html">Mathematical Extensions</a></dd>
	<dd><a href="refs.utilspec.nontext.html">Non-Text MIME Output</a></dd>
	<dd><a href="refs.fileprocess.process.html">Process Control Extensions</a></dd>
	<dd><a href="refs.basic.other.html">Other Basic Extensions</a></dd>
	<dd><a href="refs.remote.other.html">Other Services</a></dd>
	<dd><a href="refs.search.html">Search Engine Extensions</a></dd>
	<dd><a href="refs.utilspec.server.html">Server Specific Extensions</a></dd>
	<dd><a href="refs.basic.session.html">Session Extensions</a></dd>
	<dd><a href="refs.basic.text.html">Text Processing</a></dd>
	<dd><a href="refs.basic.vartype.html">Variable and Type Related Extensions</a></dd>
	<dd><a href="refs.webservice.html">Web Services</a></dd>
	<dd><a href="refs.utilspec.windows.html">Windows Only Extensions</a></dd>
	<dd><a href="refs.xml.html">XML Manipulation</a></dd>
</dl>
<dl>
<dt>Keyboard Shortcuts</dt><dt>?</dt>
<dd>This help</dd>
<dt>j</dt>
<dd>Next menu item</dd>
<dt>k</dt>
<dd>Previous menu item</dd>
<dt>g p</dt>
<dd>Previous man page</dd>
<dt>g n</dt>
<dd>Next man page</dd>
<dt>G</dt>
<dd>Scroll to bottom</dd>
<dt>g g</dt>
<dd>Scroll to top</dd>
<dt>g h</dt>
<dd>Goto homepage</dd>
<dt>g s</dt>
<dd>Goto search<br>(current page)</dd>
<dt>/</dt>
<dd>Focus search box</dd>
</dl></div></nav>
<div id="goto">
    <div class="search">
         <div class="text"></div>
         <div class="results"><ul></ul></div>
   </div>
</div>

  <div id="breadcrumbs" class="row-fluid">
          
              
        <ul class="breadcrumbs-container">
            <li><a href="index-2.html">PHP Manual</a></li>      <li><a href="funcref.html">Function Reference</a></li>      <li><a href="refs.remote.other.html">Other Services</a></li>      <li><a href="book.memcache.html">Memcache</a></li>    </ul>
  </div>




<div id="layout">
  <section id="layout-content">
  <div id="ref.memcache" class="reference">
 <h1 class="title">Memcache Functions</h1>
 







<h2>Table of Contents</h2><ul class="chunklist chunklist_reference"><li><a href="function.memcache-debug.html">memcache_debug</a> â€” Turn debug output on/off</li></ul>
</div>

<section id="usernotes">
 <div class="head"><h3 class="title">User Contributed Notes</h3></div><div id="allnotes">
  <div class="note" id="94689">  
  <a class="name">
  <strong class="user"><em>dweller at devonweller dot com</em></strong></a><div class="date" title="2009-11-18 09:02"><strong>4 years ago</strong></div>
  <div class="text" id="Hcom94689">
<div class="phpcode"><code><span class="html">
In the memcache PECL extension version 2.2.5, the delete function does not work with memcached 1.4.3.&nbsp; To work around this, here is a version of the memcache PECL extension with a patch provided by harv at pringo dot com applied:
<br>
<br><a rel="nofollow" target="_blank">http://code.google.com/p/phpmemcachepatch/downloads/list</a>
<br>
<br>To install: download 
<br>
<br><a rel="nofollow" target="_blank">http://phpmemcachepatch.googlecode.com/files/memcache-2.2.5b.tgz</a> 
<br>
<br>and do:
<br>
<br>pecl install memcache-2.2.5b.tgz</span>
</code></div>
  </div>
 </div>
  <div class="note" id="81240">  
  <a class="name">
  <strong class="user"><em>restlessmind at I dot gmail dot HATE dot com dot SPAM</em></strong></a><div class="date" title="2008-02-19 01:50"><strong>6 years ago</strong></div>
  <div class="text" id="Hcom81240">
<div class="phpcode"><code><span class="html">
If you are trying install this module for PHP 5.2 under Windows but it won't load on startup, make sure you have all your dependencies including the correct thread-safety build of PHP.<br><br>For hours I tried to track down why I couldn't load php_memcache.dll, and finally used Dependency Walker (from <a rel="nofollow" target="_blank">http://www.dependencywalker.com</a>) on the .dll file.&nbsp; This made me realize that while I was using the version of PHP 5.2.5 that was non-thread safe, the .dll offered by pecl4win was expecting the thread safe version of PHP.&nbsp; Once I rectified this, everything worked fine.</span>
</code></div>
  </div>
 </div>
  <div class="note" id="78156">  
  <a class="name">
  <strong class="user"><em>mogmios at gmail dot com</em></strong></a><div class="date" title="2007-09-30 09:03"><strong>6 years ago</strong></div>
  <div class="text" id="Hcom78156">
<div class="phpcode"><code><span class="html">
When installing the memcache module for Apache/PHP with a non-standard location it seems like there is no way to define the location when configuring for build. You'll get an error complaining about being unable to find php_session.h. I modified configure to try the PREFIX location too and that seems to have worked fine.<br><br>&nbsp; &nbsp; if test -f "${prefix}/include/php/ext/session/php_session.h"; then<br>&nbsp; &nbsp; &nbsp; session_inc_path="${prefix}/include/php"<br>&nbsp; &nbsp; elif test -f "$abs_srcdir/include/php/ext/session/php_session.h"; then<br>&nbsp; &nbsp; &nbsp; session_inc_path="$abs_srcdir/include/php"<br>&nbsp; &nbsp; elif test -f "$abs_srcdir/ext/session/php_session.h"; then<br>&nbsp; &nbsp; &nbsp; session_inc_path="$abs_srcdir"<br>&nbsp; &nbsp; elif test -f "$phpincludedir/ext/session/php_session.h"; then<br>&nbsp; &nbsp; &nbsp; session_inc_path="$phpincludedir"<br>&nbsp; &nbsp; fi</span>
</code></div>
  </div>
 </div>
  <div class="note" id="77296">  
  <a class="name">
  <strong class="user"><em>Colin Guthrie</em></strong></a><div class="date" title="2007-08-23 02:57"><strong>7 years ago</strong></div>
  <div class="text" id="Hcom77296">
<div class="phpcode"><code><span class="html">
I have noticed a bug/documentation error:<br><br>The above docs say the following about the session.save_path arguement:<br>"Each url may contain parameters which are applied to that server, they are the same as for the Memcache::addServer() method. "<br><br>addServer method's docs say:<br>"port<br><br>&nbsp; &nbsp; Point to the port where memcached is listening for connections. This parameter is optional and its default value is 11211. Set this parameter to 0 when using UNIX domain sockets. "<br><br>However when specifying the save_path, I have found that with PHP 5.2.3 and memcache 2.1.2 that the port is a *required* part of the string.<br><br>Hope that helps some people scratching their heads.</span>
</code></div>
  </div>
 </div>
  <div class="note" id="75997">  
  <a class="name">
  <strong class="user"><em>markfrawley at gmail dot com</em></strong></a><div class="date" title="2007-06-26 01:10"><strong>7 years ago</strong></div>
  <div class="text" id="Hcom75997">
<div class="phpcode"><code><span class="html">
Here is a PHP4 backport of the above MemcacheAggregator class:<br><br><span class="default">&lt;?php<br></span><span class="keyword">class </span><span class="default">MemcachedAggregator </span><span class="keyword">{<br>&nbsp; &nbsp; var </span><span class="default">$connections</span><span class="keyword">;<br>&nbsp; &nbsp; var </span><span class="default">$_servers</span><span class="keyword">;<br><br>&nbsp; &nbsp; function </span><span class="default">MemcachedAggregator</span><span class="keyword">(</span><span class="default">$servers</span><span class="keyword">) {<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">_servers </span><span class="keyword">= </span><span class="default">$servers</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="comment">// Attempt to establish/retrieve persistent connections to all servers.<br>&nbsp; &nbsp; &nbsp; &nbsp; // If any of them fail, they just don't get put into our list of active<br>&nbsp; &nbsp; &nbsp; &nbsp; // connections.<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">connections </span><span class="keyword">= array();<br>&nbsp; &nbsp; &nbsp; &nbsp; for (</span><span class="default">$i </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">, </span><span class="default">$n </span><span class="keyword">= </span><span class="default">count</span><span class="keyword">(</span><span class="default">$servers</span><span class="keyword">); </span><span class="default">$i </span><span class="keyword">&lt; </span><span class="default">$n</span><span class="keyword">; </span><span class="default">$i</span><span class="keyword">++) {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$server </span><span class="keyword">= </span><span class="default">$servers</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">];<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$con </span><span class="keyword">= </span><span class="default">memcache_connect</span><span class="keyword">(</span><span class="default">$server</span><span class="keyword">[</span><span class="string">'host'</span><span class="keyword">]);<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="comment">//memcache_debug(1); <br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; //$memcache = &amp;new Memcache;<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; //$con = $memcache-&gt;connect($server['host']);<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="keyword">if (!(</span><span class="default">$con </span><span class="keyword">== </span><span class="default">false</span><span class="keyword">)) {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">connections</span><span class="keyword">[] = &amp;</span><span class="default">$con</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; }<br>&nbsp; &nbsp; }<br><br>&nbsp; &nbsp; function </span><span class="default">_getConForKey</span><span class="keyword">(</span><span class="default">$key</span><span class="keyword">) {<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$hashCode </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; for (</span><span class="default">$i </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">, </span><span class="default">$len </span><span class="keyword">= </span><span class="default">strlen</span><span class="keyword">(</span><span class="default">$key</span><span class="keyword">); </span><span class="default">$i </span><span class="keyword">&lt; </span><span class="default">$len</span><span class="keyword">; </span><span class="default">$i</span><span class="keyword">++) {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$hashCode </span><span class="keyword">= (int)((</span><span class="default">$hashCode</span><span class="keyword">*</span><span class="default">33</span><span class="keyword">)+</span><span class="default">ord</span><span class="keyword">(</span><span class="default">$key</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">])) &amp; </span><span class="default">0x7fffffff</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; }<br>&nbsp; &nbsp; &nbsp; &nbsp; if ((</span><span class="default">$ns </span><span class="keyword">= </span><span class="default">count</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">connections</span><span class="keyword">)) &gt; </span><span class="default">0</span><span class="keyword">) {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; return </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">connections</span><span class="keyword">[</span><span class="default">$hashCode</span><span class="keyword">%</span><span class="default">$ns</span><span class="keyword">];<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="comment">//return $this-&gt;connections[0];<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="keyword">}<br>&nbsp; &nbsp; &nbsp; &nbsp; return </span><span class="default">false</span><span class="keyword">;<br>&nbsp; &nbsp; }<br><br>&nbsp; &nbsp; function </span><span class="default">debug</span><span class="keyword">(</span><span class="default">$on_off</span><span class="keyword">) {<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$result </span><span class="keyword">= </span><span class="default">false</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; for (</span><span class="default">$i </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">; </span><span class="default">$i </span><span class="keyword">&lt; </span><span class="default">count</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">connections</span><span class="keyword">); </span><span class="default">$i</span><span class="keyword">++) {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if (</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">connections</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">]-&gt;</span><span class="default">debug</span><span class="keyword">(</span><span class="default">$on_off</span><span class="keyword">)) </span><span class="default">$result </span><span class="keyword">= </span><span class="default">true</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; }<br>&nbsp; &nbsp; &nbsp; &nbsp; return </span><span class="default">$result</span><span class="keyword">;<br>&nbsp; &nbsp; }<br><br>&nbsp; &nbsp; function </span><span class="default">flush</span><span class="keyword">() {<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$result </span><span class="keyword">= </span><span class="default">false</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; for (</span><span class="default">$i </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">; </span><span class="default">$i </span><span class="keyword">&lt; </span><span class="default">count</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">connections</span><span class="keyword">); </span><span class="default">$i</span><span class="keyword">++) {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if (</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">connections</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">]-&gt;</span><span class="default">flush</span><span class="keyword">()) </span><span class="default">$result </span><span class="keyword">= </span><span class="default">true</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; }<br>&nbsp; &nbsp; &nbsp; &nbsp; return </span><span class="default">$result</span><span class="keyword">;<br>&nbsp; &nbsp; }<br><br>&nbsp; &nbsp; </span><span class="comment">/// The following are not implemented:<br>&nbsp; &nbsp; ///getStats()<br>&nbsp; &nbsp; ///getVersion()<br><br>&nbsp; &nbsp; </span><span class="keyword">function </span><span class="default">get</span><span class="keyword">(</span><span class="default">$key</span><span class="keyword">) {<br>&nbsp; &nbsp; &nbsp; &nbsp; if (</span><span class="default">is_array</span><span class="keyword">(</span><span class="default">$key</span><span class="keyword">)) {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$dest </span><span class="keyword">= array();<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; foreach (</span><span class="default">$key </span><span class="keyword">as </span><span class="default">$subkey</span><span class="keyword">) {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$val </span><span class="keyword">= </span><span class="default">get</span><span class="keyword">(</span><span class="default">$subkey</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if (!(</span><span class="default">$val </span><span class="keyword">=== </span><span class="default">false</span><span class="keyword">)) </span><span class="default">$dest</span><span class="keyword">[</span><span class="default">$subkey</span><span class="keyword">] = </span><span class="default">$val</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; return </span><span class="default">$dest</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; } else {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$conn </span><span class="keyword">= &amp;</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">_getConForKey</span><span class="keyword">(</span><span class="default">$key</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; return </span><span class="default">$conn</span><span class="keyword">-&gt;</span><span class="default">get</span><span class="keyword">(</span><span class="default">$key</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; }<br>&nbsp; &nbsp; }<br><br>&nbsp; &nbsp; function </span><span class="default">set</span><span class="keyword">(</span><span class="default">$key</span><span class="keyword">, </span><span class="default">$var</span><span class="keyword">, </span><span class="default">$compress</span><span class="keyword">=</span><span class="default">0</span><span class="keyword">, </span><span class="default">$expire</span><span class="keyword">=</span><span class="default">0</span><span class="keyword">) {<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$conn </span><span class="keyword">= &amp;</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">_getConForKey</span><span class="keyword">(</span><span class="default">$key</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; return </span><span class="default">$conn</span><span class="keyword">-&gt;</span><span class="default">set</span><span class="keyword">(</span><span class="default">$key</span><span class="keyword">, </span><span class="default">$var</span><span class="keyword">, </span><span class="default">$compress</span><span class="keyword">, </span><span class="default">$expire</span><span class="keyword">);<br>&nbsp; &nbsp; }<br><br>&nbsp; &nbsp; function </span><span class="default">add</span><span class="keyword">(</span><span class="default">$key</span><span class="keyword">, </span><span class="default">$var</span><span class="keyword">, </span><span class="default">$compress</span><span class="keyword">=</span><span class="default">0</span><span class="keyword">, </span><span class="default">$expire</span><span class="keyword">=</span><span class="default">0</span><span class="keyword">) {<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$conn </span><span class="keyword">= &amp;</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">_getConForKey</span><span class="keyword">(</span><span class="default">$key</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; return </span><span class="default">$conn</span><span class="keyword">-&gt;</span><span class="default">add</span><span class="keyword">(</span><span class="default">$key</span><span class="keyword">, </span><span class="default">$var</span><span class="keyword">, </span><span class="default">$compress</span><span class="keyword">, </span><span class="default">$expire</span><span class="keyword">);<br>&nbsp; &nbsp; }<br><br>&nbsp; &nbsp; function </span><span class="default">replace</span><span class="keyword">(</span><span class="default">$key</span><span class="keyword">, </span><span class="default">$var</span><span class="keyword">, </span><span class="default">$compress</span><span class="keyword">=</span><span class="default">0</span><span class="keyword">, </span><span class="default">$expire</span><span class="keyword">=</span><span class="default">0</span><span class="keyword">) {<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$conn </span><span class="keyword">= &amp;</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">_getConForKey</span><span class="keyword">(</span><span class="default">$key</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; return </span><span class="default">$conn</span><span class="keyword">-&gt;</span><span class="default">replace</span><span class="keyword">(</span><span class="default">$key</span><span class="keyword">, </span><span class="default">$var</span><span class="keyword">, </span><span class="default">$compress</span><span class="keyword">, </span><span class="default">$expire</span><span class="keyword">);<br>&nbsp; &nbsp; }<br><br>&nbsp; &nbsp; function </span><span class="default">delete</span><span class="keyword">(</span><span class="default">$key</span><span class="keyword">, </span><span class="default">$timeout</span><span class="keyword">=</span><span class="default">0</span><span class="keyword">) {<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$conn </span><span class="keyword">= &amp;</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">_getConForKey</span><span class="keyword">(</span><span class="default">$key</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; return </span><span class="default">$conn</span><span class="keyword">-&gt;</span><span class="default">delete</span><span class="keyword">(</span><span class="default">$key</span><span class="keyword">, </span><span class="default">$timeout</span><span class="keyword">);<br>&nbsp; &nbsp; }<br><br>&nbsp; &nbsp; function </span><span class="default">increment</span><span class="keyword">(</span><span class="default">$key</span><span class="keyword">, </span><span class="default">$value</span><span class="keyword">=</span><span class="default">1</span><span class="keyword">) {<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$conn </span><span class="keyword">= &amp;</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">_getConForKey</span><span class="keyword">(</span><span class="default">$key</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; return </span><span class="default">$conn</span><span class="keyword">-&gt;</span><span class="default">increment</span><span class="keyword">(</span><span class="default">$key</span><span class="keyword">, </span><span class="default">$value</span><span class="keyword">);<br>&nbsp; &nbsp; }<br><br>&nbsp; &nbsp; function </span><span class="default">decrement</span><span class="keyword">(</span><span class="default">$key</span><span class="keyword">, </span><span class="default">$value</span><span class="keyword">=</span><span class="default">1</span><span class="keyword">) {<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$conn </span><span class="keyword">= &amp;</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">_getConForKey</span><span class="keyword">(</span><span class="default">$key</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; return </span><span class="default">$conn</span><span class="keyword">-&gt;</span><span class="default">decrement</span><span class="keyword">(</span><span class="default">$key</span><span class="keyword">, </span><span class="default">$value</span><span class="keyword">);<br>&nbsp; &nbsp; }<br><br>&nbsp; &nbsp; function </span><span class="default">showStats</span><span class="keyword">(</span><span class="default">$server</span><span class="keyword">=</span><span class="default">null</span><span class="keyword">) {<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$stats_out </span><span class="keyword">= </span><span class="string">''</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; if(</span><span class="default">$server </span><span class="keyword">== </span><span class="default">null</span><span class="keyword">) {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$i</span><span class="keyword">=</span><span class="default">0</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; foreach(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">connections </span><span class="keyword">as </span><span class="default">$conn</span><span class="keyword">) {&nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$server </span><span class="keyword">= </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">_servers</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">];<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$stats_array </span><span class="keyword">= </span><span class="default">memcache_get_stats</span><span class="keyword">(</span><span class="default">$conn</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$stats_out </span><span class="keyword">.= </span><span class="string">"&lt;/br&gt;&lt;b&gt;Server: "</span><span class="keyword">.</span><span class="default">$server</span><span class="keyword">[</span><span class="string">'host'</span><span class="keyword">].</span><span class="string">": &lt;/b&gt;&lt;br/&gt;"</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; foreach(</span><span class="default">$stats_array </span><span class="keyword">as </span><span class="default">$key </span><span class="keyword">=&gt; </span><span class="default">$val</span><span class="keyword">) {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$stats_out </span><span class="keyword">.= </span><span class="string">"</span><span class="default">$key</span><span class="string"> =&gt; </span><span class="default">$val</span><span class="string"> &lt;br/&gt;"</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }&nbsp;&nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$i</span><span class="keyword">++;<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br>&nbsp; &nbsp; &nbsp; &nbsp; }<br>&nbsp; &nbsp; &nbsp; &nbsp; return </span><span class="default">$stats_out</span><span class="keyword">;<br>&nbsp; &nbsp; }&nbsp; &nbsp; <br>}<br></span><span class="default">?&gt;</span>
</span>
</code></div>
  </div>
 </div>
  <div class="note" id="75232">  
  <a class="name">
  <strong class="user"><em>moazzamk at gmail dot com</em></strong></a><div class="date" title="2007-05-18 03:25"><strong>7 years ago</strong></div>
  <div class="text" id="Hcom75232">
<div class="phpcode"><code><span class="html">
You can't call parent::__construct() in the constructor of your class if you are extending the memcache class. However, not running the constructor still initiates it and works fine. <br><br><span class="default">&lt;?php<br><br></span><span class="comment">// wrong<br><br></span><span class="keyword">class </span><span class="default">a </span><span class="keyword">extends </span><span class="default">Memcache </span><span class="keyword">{<br>&nbsp; function </span><span class="default">__construct</span><span class="keyword">(</span><span class="default">$host</span><span class="keyword">, </span><span class="default">$port</span><span class="keyword">)<br>&nbsp; {<br>&nbsp; &nbsp; </span><span class="default">parent</span><span class="keyword">::</span><span class="default">__construct</span><span class="keyword">();<br>&nbsp; &nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">connect</span><span class="keyword">(</span><span class="default">$host</span><span class="keyword">, </span><span class="default">$port</span><span class="keyword">);<br>&nbsp; }<br><br></span><span class="comment">//correct<br></span><span class="keyword">class </span><span class="default">a </span><span class="keyword">extends </span><span class="default">Memcache </span><span class="keyword">{<br>&nbsp; function </span><span class="default">__construct</span><span class="keyword">(</span><span class="default">$host</span><span class="keyword">, </span><span class="default">$port</span><span class="keyword">)<br>&nbsp; {<br>&nbsp; &nbsp; </span><span class="default">parent</span><span class="keyword">::</span><span class="default">__construct</span><span class="keyword">();<br>&nbsp; &nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">connect</span><span class="keyword">(</span><span class="default">$host</span><span class="keyword">, </span><span class="default">$port</span><span class="keyword">);<br>&nbsp; }<br><br></span><span class="default">?&gt;<br></span><br>I am guessing this applies to all native/PECL classes.</span>
</code></div>
  </div>
 </div>
  <div class="note" id="74418">  
  <a class="name">
  <strong class="user"><em>gil at squidoo dot com</em></strong></a><div class="date" title="2007-04-10 02:45"><strong>7 years ago</strong></div>
  <div class="text" id="Hcom74418">
<div class="phpcode"><code><span class="html">
There is a tiny bug in the Aggregator class when using the flush() function. The reference to $connections should be $this-&gt;connections.<br><br>Change:<br><br>public function flush() {<br>&nbsp; $result = false;<br>&nbsp; for ($i = 0; $i &lt; count($connections); $i++) {<br>&nbsp; &nbsp; if ($this-&gt;connections[$i]-&gt;flush()) {<br>&nbsp; &nbsp; &nbsp; $result = true;<br>&nbsp; &nbsp; }<br>&nbsp; }<br>&nbsp; return $result;<br>}<br><br>To:<br><br>public function flush() {<br>&nbsp; $result = false;<br>&nbsp; for ($i = 0; $i &lt; count($this-&gt;connections); $i++) {<br>&nbsp; &nbsp; if ($this-&gt;connections[$i]-&gt;flush()) {<br>&nbsp; &nbsp; &nbsp; $result = true;<br>&nbsp; &nbsp; }<br>&nbsp; }<br>&nbsp; return $result;<br>}</span>
</code></div>
  </div>
 </div>
  <div class="note" id="70760">  
  <a class="name">
  <strong class="user"><em>ed at me3inc dot com</em></strong></a><div class="date" title="2006-10-26 02:47"><strong>7 years ago</strong></div>
  <div class="text" id="Hcom70760">
<div class="phpcode"><code><span class="html">
Re. Installing the memcache extension:<br><br>I had all kinds of troubles getting it hooked up, because in all of the instructions I read I never got the last, most important step - you must have a php.ini and have in it "extension=memcache.so." <br><br>So, the steps:<br>First - ./configure with --enable-memcache. This should show in your phpinfo() at the top (even though nothing of the memcache extension works yet).<br><br>Second:<br>either pecl install memcache<br>OR<br>download the source<br>tar -xzvf [thesourcetarball]<br>phpize<br>./configure<br>make<br>make install<br><br>Finally: Add extension=memcache.so to your php.ini. (If you don't have one, it should go in the root of where php is called ie., /usr/local/lib)<br><br>Call phpinfo() and you should see a memcache section.</span>
</code></div>
  </div>
 </div>
  <div class="note" id="60901">  
  <a class="name">
  <strong class="user"><em>iliya at pisem dot net</em></strong></a><div class="date" title="2006-01-19 12:35"><strong>8 years ago</strong></div>
  <div class="text" id="Hcom60901">
<div class="phpcode"><code><span class="html">
one more "intelligent" cache aggregator:<br>https://svn.shadanakar.org/onPHP/ trunk/core/Cache/AggregateCache.class.php<br>can be used with several cache connectors - memcached, filesystem, etc.<br>(remove whitespace manually)</span>
</code></div>
  </div>
 </div>
  <div class="note" id="56771">  
  <a class="name">
  <strong class="user"><em>Ron</em></strong></a><div class="date" title="2005-09-14 01:19"><strong>8 years ago</strong></div>
  <div class="text" id="Hcom56771">
<div class="phpcode"><code><span class="html">
An improvement to the above:<br><br>The above class will cause an error if all cache servers are down.&nbsp; The preferred behavior is to just have a cache miss (or take no action in the case of write operations) and return false, so the app can run in non-cached mode if all cache servers are down.<br><br>To make this happen, simply change the connection usage to look something like this in each affected function.&nbsp; This code is for the get() function:<br><br>&nbsp; &nbsp; &nbsp; &nbsp; $con = $this-&gt;_getConForKey($key);<br>&nbsp; &nbsp; &nbsp; &nbsp; if ($con === false) return false;<br>&nbsp; &nbsp; &nbsp; &nbsp; return $con-&gt;get($key);<br><br>Similarly, the affected code in the set() function would look like this:<br>&nbsp; &nbsp; $con = $this-&gt;_getConForKey($key);<br>&nbsp; &nbsp; if ($con === false) return false;<br>&nbsp; &nbsp; return $con-&gt;set($key, $var, $compress, $expire);<br><br>Modify each function accordingly, and if all of your cache servers are down, you can still function (although more slowly due to the 100% cache miss rate).</span>
</code></div>
  </div>
 </div>
  <div class="note" id="56765">  
  <a class="name">
  <strong class="user"><em>Ron</em></strong></a><div class="date" title="2005-09-14 10:20"><strong>8 years ago</strong></div>
  <div class="text" id="Hcom56765">
<div class="phpcode"><code><span class="html">
Here is a simple memcached aggregator class which distributes the cache among multiple cache servers.&nbsp; If a server fails, the load is redistributed automatically.&nbsp; It uses persistent connections.<br><br>The constructor takes an array of arrays, with each inner array representing a server, with a 'server' (string) attribute that is the IP addres or host name of the memcached server, and a 'port' (int) attribute that is the port number on which memcached is running on the server.<br><br>All of the existing memcached API functions are implemented except getStats() and getVersion(), which are server-specific.<br><br><span class="default">&lt;?php<br></span><span class="keyword">class </span><span class="default">MemcachedAggregator </span><span class="keyword">{<br>&nbsp; &nbsp; var </span><span class="default">$connections</span><span class="keyword">;<br><br>&nbsp; &nbsp; public function </span><span class="default">__construct</span><span class="keyword">(</span><span class="default">$servers</span><span class="keyword">) {<br>&nbsp; &nbsp; </span><span class="comment">// Attempt to establish/retrieve persistent connections to all servers.<br>&nbsp; &nbsp; // If any of them fail, they just don't get put into our list of active<br>&nbsp; &nbsp; // connections.<br>&nbsp; &nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">connections </span><span class="keyword">= array();<br>&nbsp; &nbsp; for (</span><span class="default">$i </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">, </span><span class="default">$n </span><span class="keyword">= </span><span class="default">count</span><span class="keyword">(</span><span class="default">$servers</span><span class="keyword">); </span><span class="default">$i </span><span class="keyword">&lt; </span><span class="default">$n</span><span class="keyword">; </span><span class="default">$i</span><span class="keyword">++) {<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$server </span><span class="keyword">= </span><span class="default">$servers</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">];<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$con </span><span class="keyword">= </span><span class="default">memcache_pconnect</span><span class="keyword">(</span><span class="default">$server</span><span class="keyword">[</span><span class="string">'host'</span><span class="keyword">], </span><span class="default">$server</span><span class="keyword">[</span><span class="string">'port'</span><span class="keyword">]);<br>&nbsp; &nbsp; &nbsp; &nbsp; if (!(</span><span class="default">$con </span><span class="keyword">== </span><span class="default">false</span><span class="keyword">)) {<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">connections</span><span class="keyword">[] = </span><span class="default">$con</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; }<br>&nbsp; &nbsp; }<br>&nbsp; &nbsp; }<br><br>&nbsp; &nbsp; private function </span><span class="default">_getConForKey</span><span class="keyword">(</span><span class="default">$key</span><span class="keyword">) {<br>&nbsp; &nbsp; </span><span class="default">$hashCode </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">;<br>&nbsp; &nbsp; for (</span><span class="default">$i </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">, </span><span class="default">$len </span><span class="keyword">= </span><span class="default">strlen</span><span class="keyword">(</span><span class="default">$key</span><span class="keyword">); </span><span class="default">$i </span><span class="keyword">&lt; </span><span class="default">$len</span><span class="keyword">; </span><span class="default">$i</span><span class="keyword">++) {<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$hashCode </span><span class="keyword">= (int)((</span><span class="default">$hashCode</span><span class="keyword">*</span><span class="default">33</span><span class="keyword">)+</span><span class="default">ord</span><span class="keyword">(</span><span class="default">$key</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">])) &amp; </span><span class="default">0x7fffffff</span><span class="keyword">;<br>&nbsp; &nbsp; }<br>&nbsp; &nbsp; if ((</span><span class="default">$ns </span><span class="keyword">= </span><span class="default">count</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">connections</span><span class="keyword">)) &gt; </span><span class="default">0</span><span class="keyword">) {<br>&nbsp; &nbsp; &nbsp; &nbsp; return </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">connections</span><span class="keyword">[</span><span class="default">$hashCode</span><span class="keyword">%</span><span class="default">$ns</span><span class="keyword">];<br>&nbsp; &nbsp; }<br>&nbsp; &nbsp; return </span><span class="default">false</span><span class="keyword">;<br>&nbsp; &nbsp; }<br><br>&nbsp; &nbsp; public function </span><span class="default">debug</span><span class="keyword">(</span><span class="default">$on_off</span><span class="keyword">) {<br>&nbsp; &nbsp; </span><span class="default">$result </span><span class="keyword">= </span><span class="default">false</span><span class="keyword">;<br>&nbsp; &nbsp; for (</span><span class="default">$i </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">; </span><span class="default">$i </span><span class="keyword">&lt; </span><span class="default">count</span><span class="keyword">(</span><span class="default">$connections</span><span class="keyword">); </span><span class="default">$i</span><span class="keyword">++) {<br>&nbsp; &nbsp; &nbsp; &nbsp; if (</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">connections</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">]-&gt;</span><span class="default">debug</span><span class="keyword">(</span><span class="default">$on_off</span><span class="keyword">)) </span><span class="default">$result </span><span class="keyword">= </span><span class="default">true</span><span class="keyword">;<br>&nbsp; &nbsp; }<br>&nbsp; &nbsp; return </span><span class="default">$result</span><span class="keyword">;<br>&nbsp; &nbsp; }<br><br>&nbsp; &nbsp; public function </span><span class="default">flush</span><span class="keyword">() {<br>&nbsp; &nbsp; </span><span class="default">$result </span><span class="keyword">= </span><span class="default">false</span><span class="keyword">;<br>&nbsp; &nbsp; for (</span><span class="default">$i </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">; </span><span class="default">$i </span><span class="keyword">&lt; </span><span class="default">count</span><span class="keyword">(</span><span class="default">$connections</span><span class="keyword">); </span><span class="default">$i</span><span class="keyword">++) {<br>&nbsp; &nbsp; &nbsp; &nbsp; if (</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">connections</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">]-&gt;</span><span class="default">flush</span><span class="keyword">()) </span><span class="default">$result </span><span class="keyword">= </span><span class="default">true</span><span class="keyword">;<br>&nbsp; &nbsp; }<br>&nbsp; &nbsp; return </span><span class="default">$result</span><span class="keyword">;<br>&nbsp; &nbsp; }<br><br></span><span class="comment">/// The following are not implemented:<br>///getStats()<br>///getVersion()<br><br>&nbsp; &nbsp; </span><span class="keyword">public function </span><span class="default">get</span><span class="keyword">(</span><span class="default">$key</span><span class="keyword">) {<br>&nbsp; &nbsp; if (</span><span class="default">is_array</span><span class="keyword">(</span><span class="default">$key</span><span class="keyword">)) {<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$dest </span><span class="keyword">= array();<br>&nbsp; &nbsp; &nbsp; &nbsp; foreach (</span><span class="default">$key </span><span class="keyword">as </span><span class="default">$subkey</span><span class="keyword">) {<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$val </span><span class="keyword">= </span><span class="default">get</span><span class="keyword">(</span><span class="default">$subkey</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; if (!(</span><span class="default">$val </span><span class="keyword">=== </span><span class="default">false</span><span class="keyword">)) </span><span class="default">$dest</span><span class="keyword">[</span><span class="default">$subkey</span><span class="keyword">] = </span><span class="default">$val</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; }<br>&nbsp; &nbsp; &nbsp; &nbsp; return </span><span class="default">$dest</span><span class="keyword">;<br>&nbsp; &nbsp; } else {<br>&nbsp; &nbsp; &nbsp; &nbsp; return </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">_getConForKey</span><span class="keyword">(</span><span class="default">$key</span><span class="keyword">)-&gt;</span><span class="default">get</span><span class="keyword">(</span><span class="default">$key</span><span class="keyword">);<br>&nbsp; &nbsp; }<br>&nbsp; &nbsp; }<br><br>&nbsp; &nbsp; public function </span><span class="default">set</span><span class="keyword">(</span><span class="default">$key</span><span class="keyword">, </span><span class="default">$var</span><span class="keyword">, </span><span class="default">$compress</span><span class="keyword">=</span><span class="default">0</span><span class="keyword">, </span><span class="default">$expire</span><span class="keyword">=</span><span class="default">0</span><span class="keyword">) {<br>&nbsp; &nbsp; return </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">_getConForKey</span><span class="keyword">(</span><span class="default">$key</span><span class="keyword">)-&gt;</span><span class="default">set</span><span class="keyword">(</span><span class="default">$key</span><span class="keyword">, </span><span class="default">$var</span><span class="keyword">, </span><span class="default">$compress</span><span class="keyword">, </span><span class="default">$expire</span><span class="keyword">);<br>&nbsp; &nbsp; }<br><br>&nbsp; &nbsp; public function </span><span class="default">add</span><span class="keyword">(</span><span class="default">$key</span><span class="keyword">, </span><span class="default">$var</span><span class="keyword">, </span><span class="default">$compress</span><span class="keyword">=</span><span class="default">0</span><span class="keyword">, </span><span class="default">$expire</span><span class="keyword">=</span><span class="default">0</span><span class="keyword">) {<br>&nbsp; &nbsp; return </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">_getConForKey</span><span class="keyword">(</span><span class="default">$key</span><span class="keyword">)-&gt;</span><span class="default">add</span><span class="keyword">(</span><span class="default">$key</span><span class="keyword">, </span><span class="default">$var</span><span class="keyword">, </span><span class="default">$compress</span><span class="keyword">, </span><span class="default">$expire</span><span class="keyword">);<br>&nbsp; &nbsp; }<br><br>&nbsp; &nbsp; public function </span><span class="default">replace</span><span class="keyword">(</span><span class="default">$key</span><span class="keyword">, </span><span class="default">$var</span><span class="keyword">, </span><span class="default">$compress</span><span class="keyword">=</span><span class="default">0</span><span class="keyword">, </span><span class="default">$expire</span><span class="keyword">=</span><span class="default">0</span><span class="keyword">) {<br>&nbsp; &nbsp; return </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">_getConForKey</span><span class="keyword">(</span><span class="default">$key</span><span class="keyword">)-&gt;</span><span class="default">replace<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="keyword">(</span><span class="default">$key</span><span class="keyword">, </span><span class="default">$var</span><span class="keyword">, </span><span class="default">$compress</span><span class="keyword">, </span><span class="default">$expire</span><span class="keyword">);<br>&nbsp; &nbsp; }<br><br>&nbsp; &nbsp; public function </span><span class="default">delete</span><span class="keyword">(</span><span class="default">$key</span><span class="keyword">, </span><span class="default">$timeout</span><span class="keyword">=</span><span class="default">0</span><span class="keyword">) {<br>&nbsp; &nbsp; return </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">_getConForKey</span><span class="keyword">(</span><span class="default">$key</span><span class="keyword">)-&gt;</span><span class="default">delete</span><span class="keyword">(</span><span class="default">$key</span><span class="keyword">, </span><span class="default">$timeout</span><span class="keyword">);<br>&nbsp; &nbsp; }<br><br>&nbsp; &nbsp; public function </span><span class="default">increment</span><span class="keyword">(</span><span class="default">$key</span><span class="keyword">, </span><span class="default">$value</span><span class="keyword">=</span><span class="default">1</span><span class="keyword">) {<br>&nbsp; &nbsp; return </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">_getConForKey</span><span class="keyword">(</span><span class="default">$key</span><span class="keyword">)-&gt;</span><span class="default">increment</span><span class="keyword">(</span><span class="default">$key</span><span class="keyword">, </span><span class="default">$value</span><span class="keyword">);<br>&nbsp; &nbsp; }<br><br>&nbsp; &nbsp; public function </span><span class="default">decrement</span><span class="keyword">(</span><span class="default">$key</span><span class="keyword">, </span><span class="default">$value</span><span class="keyword">=</span><span class="default">1</span><span class="keyword">) {<br>&nbsp; &nbsp; return </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">_getConForKey</span><span class="keyword">(</span><span class="default">$key</span><span class="keyword">)-&gt;</span><span class="default">decrement</span><span class="keyword">(</span><span class="default">$key</span><span class="keyword">, </span><span class="default">$value</span><span class="keyword">);<br>&nbsp; &nbsp; }<br><br>}<br></span><span class="default">?&gt;</span>
</span>
</code></div>
  </div>
 </div>
  <div class="note" id="80747">  
  <a class="name">
  <strong class="user"><em>contact at codeassembly dot com</em></strong></a><div class="date" title="2008-01-30 06:28"><strong>6 years ago</strong></div>
  <div class="text" id="Hcom80747">
<div class="phpcode"><code><span class="html">
Note that there is no way to have your own hashing mechanism, the best way to group a set of objects to a server is to manually select the server to use.<br><br>I want to keep all objects for a certain user on the same server.<br><br>user_54_description<br>user_54_info<br>user_54_comments<br>user_54_etc<br>.<br>.<br><br>If I have all these objects on the same server I can get all data with only one call to memcache -&gt; get (get_multi), so this improves performance a lot.<br><br>The way I do this is by hashing the User/Object id to to the number of servers.<br><br><span class="default">&lt;?php<br>$memcache_hosts </span><span class="keyword">= array<br>(<br></span><span class="string">'192.168.1.1'</span><span class="keyword">,<br></span><span class="string">'192.168.1.2'</span><span class="keyword">,<br></span><span class="string">'192.168.1.3'</span><span class="keyword">,<br></span><span class="string">'192.168.1.4'</span><span class="keyword">,<br></span><span class="string">'192.168.1.5'</span><span class="keyword">,<br>);<br><br></span><span class="default">$server </span><span class="keyword">= </span><span class="default">$id </span><span class="keyword">% </span><span class="default">count</span><span class="keyword">(</span><span class="default">$memcache_hosts</span><span class="keyword">);<br><br></span><span class="default">$memcache </span><span class="keyword">= new </span><span class="default">Memcache</span><span class="keyword">;<br></span><span class="default">$memcache</span><span class="keyword">-&gt;</span><span class="default">connect</span><span class="keyword">(</span><span class="default">$memcache_hosts</span><span class="keyword">[</span><span class="default">$server</span><span class="keyword">], </span><span class="default">11211</span><span class="keyword">);<br><br></span><span class="comment">//get or set your objects here<br></span><span class="default">?&gt;<br></span><br>You can leave other objects that you don't want to group to memcache extension to hash and select the appropiate server.</span>
</code></div>
  </div>
 </div>
  <div class="note" id="72239">  
  <a class="name">
  <strong class="user"><em>jcastromail at yahoo dot es</em></strong></a><div class="date" title="2007-01-08 05:28"><strong>7 years ago</strong></div>
  <div class="text" id="Hcom72239">
<div class="phpcode"><code><span class="html">
Hi there:
<br>
<br>For run memcached in a windows box: (tested with latest php,apache and memcache in xp sp2)
<br>
<br>a) download the php_memcache.dll it can be found in the pecl file.
<br>
<br>b) put the dll in the extension folder (c:/php/extension for example). You cannot miss this folder because they are filled with php*.dll files.&nbsp; In some cases the extension folder used is the system32, a non-standard way to put dll but still works.
<br>
<br>c)configure the php.ini
<br>; i put this like the latest extension
<br>extension=php_memcache.dll
<br>
<br>; i'm not sure about this but don't hurts..
<br>[Memcache]
<br>memcache.allow_failover = 1 
<br>memcache.max_failover_attempts=20 
<br>memcache.chunk_size =8192
<br>memcache.default_port = 11211
<br>
<br>d)This is important, memcached works with a EXTERNAL service. This service must be downloaded and installed prior to use the memcache.&nbsp; I use:&nbsp; <a rel="nofollow" target="_blank">http://jehiah.cz/projects/memcached-win32/</a>
<br>
<br>e)Remember to install the service and to start the service memcached.exe -d install for install and run services.msc for start the memcached service (or restart the system).
<br>
<br>f) check the firewall ports.
<br>
<br>Finally restart the apache/iis and runs some test. At least in phpinfo must show some info about the memcache.
<br>
<br>Final notes :The "awe" about memcache is not only can help for speed some process (or reduce the cpu use), also can be used like a global session for store a whole object also this "global session" is shared among all the users, like APPLICATION used in ASP.&nbsp; So (for example) it's possible to do a user counter without needing of database or writing a file.</span>
</code></div>
  </div>
 </div></div>

 
</section>    </section><!-- layout-content -->
        


  </div><!-- layout -->
         
  

    
 <!-- External and third party libraries. -->
 







<a id="toTop" href="javascript:;"><span id="toTopHover"></span><img width="40" height="40" alt="To Top" src="../../images/to-top%402x.png"></a>



<!-- Mirrored from php.net/manual/en/ref.memcache.php by HTTrack Website Copier/3.x [XR&CO'2013], Thu, 28 Aug 2014 15:50:39 GMT -->


</body></html>