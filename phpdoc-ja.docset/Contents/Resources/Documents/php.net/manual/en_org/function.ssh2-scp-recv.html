<html><!-- Mirrored from php.net/manual/en/function.ssh2-scp-recv.php by HTTrack Website Copier/3.x [XR&CO'2013], Thu, 28 Aug 2014 16:46:35 GMT --><!-- Added by HTTrack --><head><meta http-equiv="content-type" content="text/html;charset=utf-8"><!-- /Added by HTTrack -->


  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0"> 

  <title>ssh2_scp_recv</title>

 <link rel="shortcut icon" href="../../favicon.ico">
 <link rel="search" type="application/opensearchdescription+xml" href="http://php.net/phpnetimprovedsearch.src" title="Add PHP.net search">
 <link rel="alternate" type="application/atom+xml" href="http://php.net/releases/feed.php" title="PHP Release feed">
 <link rel="alternate" type="application/atom+xml" href="http://php.net/feed.atom" title="PHP: Hypertext Preprocessor">

 <link rel="canonical" href="function.ssh2-scp-recv.html">
 <link rel="shorturl" href="http://php.net/ssh2-scp-recv">
 <link rel="alternate" href="http://php.net/ssh2-scp-recv" hreflang="x-default">

 <link rel="contents" href="index-2.html">
 <link rel="index" href="ref.ssh2.html">
 <link rel="prev" href="function.ssh2-publickey-remove.html">
 <link rel="next" href="function.ssh2-scp-send.html">

 <link rel="alternate" href="function.ssh2-scp-recv.html" hreflang="en">
 <link rel="alternate" href="http://php.net/manual/pt_BR/function.ssh2-scp-recv.php" hreflang="pt_BR">
 <link rel="alternate" href="http://php.net/manual/zh/function.ssh2-scp-recv.php" hreflang="zh">
 <link rel="alternate" href="http://php.net/manual/fr/function.ssh2-scp-recv.php" hreflang="fr">
 <link rel="alternate" href="http://php.net/manual/de/function.ssh2-scp-recv.php" hreflang="de">
 <link rel="alternate" href="http://php.net/manual/it/function.ssh2-scp-recv.php" hreflang="it">
 <link rel="alternate" href="http://php.net/manual/ja/function.ssh2-scp-recv.php" hreflang="ja">
 <link rel="alternate" href="http://php.net/manual/ro/function.ssh2-scp-recv.php" hreflang="ro">
 <link rel="alternate" href="http://php.net/manual/ru/function.ssh2-scp-recv.php" hreflang="ru">
 <link rel="alternate" href="http://php.net/manual/es/function.ssh2-scp-recv.php" hreflang="es">
 <link rel="alternate" href="http://php.net/manual/tr/function.ssh2-scp-recv.php" hreflang="tr">

<link rel="stylesheet" type="text/css" href="../../cached8fe1.css?t=1401250819&amp;f=/fonts/Fira/fira.css" media="screen">
<link rel="stylesheet" type="text/css" href="../../cached4b8d.css?t=1404368420&amp;f=/fonts/Font-Awesome/css/fontello.css" media="screen">
<link rel="stylesheet" type="text/css" href="../../cached5065.css?t=1403329232&amp;f=/styles/theme-base.css" media="screen">
<link rel="stylesheet" type="text/css" href="../../cachedc78d.css?t=1401249623&amp;f=/styles/theme-medium.css" media="screen">

 <!--[if lte IE 7]>
 <link rel="stylesheet" type="text/css" href="http://php.net/styles/workarounds.ie7.css" media="screen">
 <![endif]-->

 <!--[if lte IE 8]>
 <script type="text/javascript">
  window.brokenIE = true;
 </script>
 <![endif]-->

 <!--[if lte IE 9]>
 <link rel="stylesheet" type="text/css" href="http://php.net/styles/workarounds.ie9.css" media="screen">
 <![endif]-->

 <!--[if IE]>
 <script type="text/javascript" src="http://php.net/js/ext/html5.js"></script>
 <![endif]-->

 <base>

</head>
<body class="docs " style="">


<div class="headsup"><a href="http://php.net/index.php#id2014-08-28-1">PHP 5.6.0 released</a></div>
<nav id="trick"><div><dl>
<dt><a href="getting-started.html">Getting Started</a></dt>
	<dd><a href="introduction.html">Introduction</a></dd>
	<dd><a href="tutorial.html">A simple tutorial</a></dd>
<dt><a href="langref.html">Language Reference</a></dt>
	<dd><a href="language.basic-syntax.html">Basic syntax</a></dd>
	<dd><a href="language.types.html">Types</a></dd>
	<dd><a href="language.variables.html">Variables</a></dd>
	<dd><a href="language.constants.html">Constants</a></dd>
	<dd><a href="language.expressions.html">Expressions</a></dd>
	<dd><a href="language.operators.html">Operators</a></dd>
	<dd><a href="language.control-structures.html">Control Structures</a></dd>
	<dd><a href="language.functions.html">Functions</a></dd>
	<dd><a href="language.oop5.html">Classes and Objects</a></dd>
	<dd><a href="language.namespaces.html">Namespaces</a></dd>
	<dd><a href="language.exceptions.html">Exceptions</a></dd>
	<dd><a href="language.generators.html">Generators</a></dd>
	<dd><a href="language.references.html">References Explained</a></dd>
	<dd><a href="reserved.variables.html">Predefined Variables</a></dd>
	<dd><a href="reserved.exceptions.html">Predefined Exceptions</a></dd>
	<dd><a href="reserved.interfaces.html">Predefined Interfaces and Classes</a></dd>
	<dd><a href="context.html">Context options and parameters</a></dd>
	<dd><a href="wrappers.html">Supported Protocols and Wrappers</a></dd>
</dl>
<dl>
<dt><a href="security.html">Security</a></dt>
	<dd><a href="security.intro.html">Introduction</a></dd>
	<dd><a href="security.general.html">General considerations</a></dd>
	<dd><a href="security.cgi-bin.html">Installed as CGI binary</a></dd>
	<dd><a href="security.apache.html">Installed as an Apache module</a></dd>
	<dd><a href="security.filesystem.html">Filesystem Security</a></dd>
	<dd><a href="security.database.html">Database Security</a></dd>
	<dd><a href="security.errors.html">Error Reporting</a></dd>
	<dd><a href="security.globals.html">Using Register Globals</a></dd>
	<dd><a href="security.variables.html">User Submitted Data</a></dd>
	<dd><a href="security.magicquotes.html">Magic Quotes</a></dd>
	<dd><a href="security.hiding.html">Hiding PHP</a></dd>
	<dd><a href="security.current.html">Keeping Current</a></dd>
<dt><a href="features.html">Features</a></dt>
	<dd><a href="features.http-auth.html">HTTP authentication with PHP</a></dd>
	<dd><a href="features.cookies.html">Cookies</a></dd>
	<dd><a href="features.sessions.html">Sessions</a></dd>
	<dd><a href="features.xforms.html">Dealing with XForms</a></dd>
	<dd><a href="features.file-upload.html">Handling file uploads</a></dd>
	<dd><a href="features.remote-files.html">Using remote files</a></dd>
	<dd><a href="features.connection-handling.html">Connection handling</a></dd>
	<dd><a href="features.persistent-connections.html">Persistent Database Connections</a></dd>
	<dd><a href="features.safe-mode.html">Safe Mode</a></dd>
	<dd><a href="features.commandline.html">Command line usage</a></dd>
	<dd><a href="features.gc.html">Garbage Collection</a></dd>
	<dd><a href="features.dtrace.html">DTrace Dynamic Tracing</a></dd>
</dl>
<dl>
<dt><a href="funcref.html">Function Reference</a></dt>
	<dd><a href="refs.basic.php.html">Affecting PHP's Behaviour</a></dd>
	<dd><a href="refs.utilspec.audio.html">Audio Formats Manipulation</a></dd>
	<dd><a href="refs.remote.auth.html">Authentication Services</a></dd>
	<dd><a href="refs.utilspec.cmdline.html">Command Line Specific Extensions</a></dd>
	<dd><a href="refs.compression.html">Compression and Archive Extensions</a></dd>
	<dd><a href="refs.creditcard.html">Credit Card Processing</a></dd>
	<dd><a href="refs.crypto.html">Cryptography Extensions</a></dd>
	<dd><a href="refs.database.html">Database Extensions</a></dd>
	<dd><a href="refs.calendar.html">Date and Time Related Extensions</a></dd>
	<dd><a href="refs.fileprocess.file.html">File System Related Extensions</a></dd>
	<dd><a href="refs.international.html">Human Language and Character Encoding Support</a></dd>
	<dd><a href="refs.utilspec.image.html">Image Processing and Generation</a></dd>
	<dd><a href="refs.remote.mail.html">Mail Related Extensions</a></dd>
	<dd><a href="refs.math.html">Mathematical Extensions</a></dd>
	<dd><a href="refs.utilspec.nontext.html">Non-Text MIME Output</a></dd>
	<dd><a href="refs.fileprocess.process.html">Process Control Extensions</a></dd>
	<dd><a href="refs.basic.other.html">Other Basic Extensions</a></dd>
	<dd><a href="refs.remote.other.html">Other Services</a></dd>
	<dd><a href="refs.search.html">Search Engine Extensions</a></dd>
	<dd><a href="refs.utilspec.server.html">Server Specific Extensions</a></dd>
	<dd><a href="refs.basic.session.html">Session Extensions</a></dd>
	<dd><a href="refs.basic.text.html">Text Processing</a></dd>
	<dd><a href="refs.basic.vartype.html">Variable and Type Related Extensions</a></dd>
	<dd><a href="refs.webservice.html">Web Services</a></dd>
	<dd><a href="refs.utilspec.windows.html">Windows Only Extensions</a></dd>
	<dd><a href="refs.xml.html">XML Manipulation</a></dd>
</dl>
<dl>
<dt>Keyboard Shortcuts</dt><dt>?</dt>
<dd>This help</dd>
<dt>j</dt>
<dd>Next menu item</dd>
<dt>k</dt>
<dd>Previous menu item</dd>
<dt>g p</dt>
<dd>Previous man page</dd>
<dt>g n</dt>
<dd>Next man page</dd>
<dt>G</dt>
<dd>Scroll to bottom</dd>
<dt>g g</dt>
<dd>Scroll to top</dd>
<dt>g h</dt>
<dd>Goto homepage</dd>
<dt>g s</dt>
<dd>Goto search<br>(current page)</dd>
<dt>/</dt>
<dd>Focus search box</dd>
</dl></div></nav>
<div id="goto">
    <div class="search">
         <div class="text"></div>
         <div class="results"><ul></ul></div>
   </div>
</div>

  <div id="breadcrumbs" class="row-fluid">
          
              
        <ul class="breadcrumbs-container">
            <li><a href="index-2.html">PHP Manual</a></li>      <li><a href="funcref.html">Function Reference</a></li>      <li><a href="refs.remote.other.html">Other Services</a></li>      <li><a href="book.ssh2.html">SSH2</a></li>      <li><a href="ref.ssh2.html">SSH2 Functions</a></li>    </ul>
  </div>




<div id="layout">
  <section id="layout-content">
  <div id="function.ssh2-scp-recv" class="refentry">
 <div class="refnamediv">
  <h1 class="refname">ssh2_scp_recv</h1>
  <p class="verinfo">(PECL ssh2 &gt;= 0.9.0)</p><p class="refpurpose"><span class="refname">ssh2_scp_recv</span> â€” <span class="dc-title">Request a file via SCP</span></p>

 </div>
 
 <div class="refsect1 description" id="refsect1-function.ssh2-scp-recv-description">
  <h3 class="title">Description</h3>
  <div class="methodsynopsis dc-description">
   <span class="type">bool</span> <span class="methodname"><strong>ssh2_scp_recv</strong></span>
    ( <span class="methodparam"><span class="type">resource</span> <code class="parameter">$session</code></span>
   , <span class="methodparam"><span class="type">string</span> <code class="parameter">$remote_file</code></span>
   , <span class="methodparam"><span class="type">string</span> <code class="parameter">$local_file</code></span>
   )</div>

  <p class="para rdfs-comment">
   Copy a file from the remote server to the local filesystem using the SCP protocol.
  </p>
 </div>


 <div class="refsect1 parameters" id="refsect1-function.ssh2-scp-recv-parameters">
  <h3 class="title">Parameters</h3>
  <p class="para">
   </p><dl>

    
     <dt>
<code class="parameter">session</code></dt>

     <dd>

      <p class="para">
       An SSH connection link identifier, obtained from a call to
       <span class="function"><a href="function.ssh2-connect.html" class="function">ssh2_connect()</a></span>.
      </p>
     </dd>

    
    
     <dt>
<code class="parameter">remote_file</code></dt>

     <dd>

      <p class="para">
       Path to the remote file.
      </p>
     </dd>

    
    
     <dt>
<code class="parameter">local_file</code></dt>

     <dd>

      <p class="para">
       Path to the local file.
      </p>
     </dd>

    
   </dl>

  <p></p>
 </div>


 <div class="refsect1 returnvalues" id="refsect1-function.ssh2-scp-recv-returnvalues">
  <h3 class="title">Return Values</h3>
  <p class="para">
   Returns <strong><code>TRUE</code></strong> on success or <strong><code>FALSE</code></strong> on failure.
  </p>
 </div>


 <div class="refsect1 examples" id="refsect1-function.ssh2-scp-recv-examples">
  <h3 class="title">Examples</h3>
  <p class="para">
   </p><div class="example" id="example-4731">
    <p><strong>Example #1 Downloading a file via SCP</strong></p>
    <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br>$connection&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">ssh2_connect</span><span style="color: #007700">(</span><span style="color: #DD0000">'shell.example.com'</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">22</span><span style="color: #007700">);<br></span><span style="color: #0000BB">ssh2_auth_password</span><span style="color: #007700">(</span><span style="color: #0000BB">$connection</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">'username'</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">'password'</span><span style="color: #007700">);<br><br></span><span style="color: #0000BB">ssh2_scp_recv</span><span style="color: #007700">(</span><span style="color: #0000BB">$connection</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">'/remote/filename'</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">'/local/filename'</span><span style="color: #007700">);<br></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
    </div>

   </div>
  <p></p>
 </div>


 <div class="refsect1 seealso" id="refsect1-function.ssh2-scp-recv-seealso">
  <h3 class="title">See Also</h3>
  <p class="para">
   </p><ul class="simplelist">
    <li class="member"><span class="function"><a href="function.ssh2-scp-send.html" class="function" rel="rdfs-seeAlso">ssh2_scp_send()</a> - Send a file via SCP</span></li>
    <li class="member"><span class="function"><a href="function.copy.html" class="function" rel="rdfs-seeAlso">copy()</a> - Copies file</span></li>
   </ul>
  <p></p>
 </div>


</div>
<section id="usernotes">
 <div class="head"><h3 class="title">User Contributed Notes</h3></div><div id="allnotes">
  <div class="note" id="104124">  
  <a class="name">
  <strong class="user"><em>ojovirtual</em></strong></a><div class="date" title="2011-05-25 01:37"><strong>3 years ago</strong></div>
  <div class="text" id="Hcom104124">
<div class="phpcode"><code><span class="html">
Trying to get a remote file with spaces in its name?
<br>
<br>Never forget to use quotes in the remote filename, but never in the local one.
<br>
<br>Example:
<br>
<br><span class="default">&lt;?php
<br>$remote_file_name</span><span class="keyword">=</span><span class="string">"my name with spaces.ext"
<br>
<br></span><span class="default">ssh2_scp_recv</span><span class="keyword">(</span><span class="default">$cn</span><span class="keyword">,</span><span class="default">$remote_file_name</span><span class="keyword">,</span><span class="default">$local_path</span><span class="keyword">.</span><span class="string">"/"</span><span class="keyword">.</span><span class="default">$remote_file_name</span><span class="keyword">); </span><span class="comment">// ERROR
<br>
<br></span><span class="default">ssh2_scp_recv</span><span class="keyword">(</span><span class="default">$cn</span><span class="keyword">,</span><span class="string">"\""</span><span class="keyword">.</span><span class="default">$remote_file_name</span><span class="keyword">.</span><span class="string">"\""</span><span class="keyword">,</span><span class="default">$local_path</span><span class="keyword">.</span><span class="string">"/"</span><span class="keyword">.</span><span class="default">$remote_file_name</span><span class="keyword">); </span><span class="comment">//OK
<br>
<br></span><span class="default">ssh2_scp_recv</span><span class="keyword">(</span><span class="default">$cn</span><span class="keyword">,</span><span class="string">"\""</span><span class="keyword">.</span><span class="default">$remote_file_name</span><span class="keyword">.</span><span class="string">"\""</span><span class="keyword">,</span><span class="string">"\""</span><span class="keyword">.</span><span class="default">$local_path</span><span class="keyword">.</span><span class="string">"/"</span><span class="keyword">.</span><span class="default">$remote_file_name</span><span class="keyword">.</span><span class="string">"\""</span><span class="keyword">); </span><span class="comment">//ERROR
<br></span><span class="default">?&gt;
<br></span>
<br>So, the quotes in the file name are needed only for remote, not for local.</span>
</code></div>
  </div>
 </div>
  <div class="note" id="82072">  
  <a class="name">
  <strong class="user"><em>chad dot [the letter d] johnson AT gmail</em></strong></a><div class="date" title="2008-03-26 12:23"><strong>6 years ago</strong></div>
  <div class="text" id="Hcom82072">
<div class="phpcode"><code><span class="html">
If when trying to use this function you get "Warning: ssh2_scp_send(): Failure creating remote file," then try using<br><br>$data = file_get_contents("ssh2.s<a rel="nofollow" target="_blank">ftp://$sftp/path/to/file</a>");</span>
</code></div>
  </div>
 </div>
  <div class="note" id="112862">  
  <a class="name">
  <strong class="user"><em>Maddie</em></strong></a><div class="date" title="2013-07-30 05:40"><strong>1 year ago</strong></div>
  <div class="text" id="Hcom112862">
<div class="phpcode"><code><span class="html">
If you are getting the error - ssh2_scp_recv(): Unable to receive remote file<br><br>Try using file_get_contents("ssh2.s<a rel="nofollow" target="_blank">ftp://$sftp$fileLocation</a>") and file_put_contents() as a workaround-- this is after I tried all sorts of different remote file path formats to no avail.</span>
</code></div>
  </div>
 </div>
  <div class="note" id="112508">  
  <a class="name">
  <strong class="user"><em>Anonymous</em></strong></a><div class="date" title="2013-06-24 09:14"><strong>1 year ago</strong></div>
  <div class="text" id="Hcom112508">
<div class="phpcode"><code><span class="html">
May fail when trying to get a remote file from the user's home directory when you try to use a path like '~/filename.txt' .&nbsp; It appears to dislike tildes, so use the full file path.</span>
</code></div>
  </div>
 </div>
  <div class="note" id="110230">  
  <a class="name">
  <strong class="user"><em>mark at mohc dot net</em></strong></a><div class="date" title="2012-10-03 12:47"><strong>1 year ago</strong></div>
  <div class="text" id="Hcom110230">
<div class="phpcode"><code><span class="html">
Transferred files can be truncated if you do not call ssh2_exec($connection,'exit').&nbsp; ssh2_scp_send will return true even if the file did not completely transfer.<br><br>eg.<br><br>ssh2_scp_send($connection, $infile, $remotefile, 0644);<br>ssh2_exec($connection, 'exit'); // exit the ssh2 connection</span>
</code></div>
  </div>
 </div>
  <div class="note" id="97997">  
  <a class="name">
  <strong class="user"><em>luis dot sv at gmail dot com</em></strong></a><div class="date" title="2010-05-19 03:16"><strong>4 years ago</strong></div>
  <div class="text" id="Hcom97997">
<div class="phpcode"><code><span class="html">
This function can be used to copy all files into a directory on a remote server, using SSH and SCP.
<br>
<br><span class="default">&lt;?php
<br>$connection </span><span class="keyword">= </span><span class="default">ssh2_connect</span><span class="keyword">(</span><span class="string">'host'</span><span class="keyword">, </span><span class="default">22</span><span class="keyword">);
<br></span><span class="default">ssh2_auth_password</span><span class="keyword">(</span><span class="default">$connection</span><span class="keyword">, </span><span class="string">'user'</span><span class="keyword">, </span><span class="string">'password'</span><span class="keyword">);
<br>
<br></span><span class="default">$remote_dir</span><span class="keyword">=</span><span class="string">"/remote_dir/"</span><span class="keyword">;
<br></span><span class="default">$local_dir</span><span class="keyword">=</span><span class="string">"/local_dir/"</span><span class="keyword">;
<br>
<br></span><span class="default">$com </span><span class="keyword">=</span><span class="string">"ls </span><span class="default">$remote_dir</span><span class="string">"</span><span class="keyword">;
<br></span><span class="default">$stream </span><span class="keyword">= </span><span class="default">ssh2_exec</span><span class="keyword">(</span><span class="default">$connection</span><span class="keyword">, </span><span class="default">$com</span><span class="keyword">);
<br></span><span class="default">stream_set_blocking</span><span class="keyword">(</span><span class="default">$stream</span><span class="keyword">,</span><span class="default">true</span><span class="keyword">);
<br></span><span class="default">$cmd</span><span class="keyword">=</span><span class="default">fread</span><span class="keyword">(</span><span class="default">$stream</span><span class="keyword">,</span><span class="default">4096</span><span class="keyword">);
<br>
<br></span><span class="default">$arr</span><span class="keyword">=</span><span class="default">explode</span><span class="keyword">(</span><span class="string">"\n"</span><span class="keyword">,</span><span class="default">$cmd</span><span class="keyword">);
<br>
<br></span><span class="default">$total_files</span><span class="keyword">=</span><span class="default">sizeof</span><span class="keyword">(</span><span class="default">$arr</span><span class="keyword">);
<br>
<br>for(</span><span class="default">$i</span><span class="keyword">=</span><span class="default">0</span><span class="keyword">;</span><span class="default">$i</span><span class="keyword">&lt;</span><span class="default">$total_files</span><span class="keyword">;</span><span class="default">$i</span><span class="keyword">++){
<br>&nbsp; &nbsp; </span><span class="default">$file_name</span><span class="keyword">=</span><span class="default">trim</span><span class="keyword">(</span><span class="default">$arr</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">]);
<br>&nbsp; &nbsp; if(</span><span class="default">$file_name</span><span class="keyword">!=</span><span class="string">''</span><span class="keyword">){
<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$remote_file</span><span class="keyword">=</span><span class="default">$remote_dir</span><span class="keyword">.</span><span class="default">$file_name</span><span class="keyword">;&nbsp; &nbsp; &nbsp; &nbsp; 
<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$local_file</span><span class="keyword">=</span><span class="default">$local_dir</span><span class="keyword">.</span><span class="default">$file_name</span><span class="keyword">;
<br>&nbsp; &nbsp; &nbsp; &nbsp; 
<br>&nbsp; &nbsp; &nbsp; &nbsp; if(</span><span class="default">ssh2_scp_recv</span><span class="keyword">(</span><span class="default">$connection</span><span class="keyword">, </span><span class="default">$remote_file</span><span class="keyword">,</span><span class="default">$local_file</span><span class="keyword">)){
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; echo </span><span class="string">"File "</span><span class="keyword">.</span><span class="default">$file_name</span><span class="keyword">.</span><span class="string">" was copied to </span><span class="default">$local_dir</span><span class="string">&lt;br /&gt;"</span><span class="keyword">;
<br>&nbsp; &nbsp; &nbsp; &nbsp; }
<br>&nbsp; &nbsp; }
<br>}
<br>
<br></span><span class="default">fclose</span><span class="keyword">(</span><span class="default">$stream</span><span class="keyword">);
<br></span><span class="default">?&gt;</span>
</span>
</code></div>
  </div>
 </div>
  <div class="note" id="83487">  
  <a class="name">
  <strong class="user"><em>gordon_e_rouse at yahoo dot com dot au</em></strong></a><div class="date" title="2008-05-28 03:19"><strong>6 years ago</strong></div>
  <div class="text" id="Hcom83487">
<div class="phpcode"><code><span class="html">
Being still in Beta, I guess it will have it quirks. One I found was that if the remote filename has brackets in it, it just wont work.<br><br>I should file it as a bug report, but find the process all intimidating really - I am always just a stupid user who does not know what he is on about!<br><br>But anyway - the work around of renaming the file before downloading it works fine.<br><br>use:<br>$_new_path = str_replace("(", "", $_path );<br>$_new_path = str_replace(")", "", $_new_path );<br><br>ssh2_sftp_rename( $sftp,&nbsp; $_path, $_new_path );<br><br>To tell you the truth I haven't determined if it is the open or close bracket, or both. Someone else can investigate that.<br><br>Meanwhile, it would be good to know all the bad filename characters which this function has problems with, no doubt there are more.</span>
</code></div>
  </div>
 </div>
  <div class="note" id="82731">  
  <a class="name">
  <strong class="user"><em>miller4980 at msn dot com</em></strong></a><div class="date" title="2008-04-23 11:10"><strong>6 years ago</strong></div>
  <div class="text" id="Hcom82731">
<div class="phpcode"><code><span class="html">
Problem:<br>&nbsp; can't pass an array to sftp_scp_rec()<br>&nbsp; also: for Windows: sftp was not happy when connecting to&nbsp;&nbsp; a&nbsp; Windows dir. <br>&nbsp; eg: sftp_scp_rec($connection, "remote/directory","local/$directory[$i]");<br>Solution:<br>The array was placing whitespace on the end of the variable.<br>trim(" ","",$directory[$i]);<br><br>connecting to Windows dir:<br>sftp_scp_rec($connection, "linux/directory","\\windows\share[$i]");<br><br>This script backs up remote Linux directories to a local Windows directory based on modified dates of files.<br><br>The Idea is to get a complete back up of a directory via ftp client etc. <br>Then when the script runs it will back up newly modified files only.<br><br><span class="default">&lt;?php<br></span><span class="comment">//error_reporting(0);<br><br></span><span class="default">$file&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="keyword">=</span><span class="string">''</span><span class="keyword">;<br></span><span class="default">$arr2&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="keyword">=</span><span class="string">''</span><span class="keyword">;<br></span><span class="default">$arr1&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="keyword">=</span><span class="string">''</span><span class="keyword">;<br></span><span class="default">$ldir&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">= </span><span class="string">''</span><span class="keyword">;<br><br></span><span class="default">$remotedirs</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">]&nbsp; &nbsp;&nbsp; = </span><span class="string">"Domain name or IP address/"</span><span class="keyword">;<br></span><span class="default">$remotedirs</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">]&nbsp; &nbsp;&nbsp; = </span><span class="string">"Domain name or IP address/"</span><span class="keyword">;<br></span><span class="default">$remotedirs</span><span class="keyword">[</span><span class="default">2</span><span class="keyword">]&nbsp; &nbsp;&nbsp; = </span><span class="string">"Domain name or IP address/"</span><span class="keyword">;<br></span><span class="default">$remotedirs</span><span class="keyword">[</span><span class="default">3</span><span class="keyword">]&nbsp; &nbsp;&nbsp; = </span><span class="string">"Domain name or IP address/"</span><span class="keyword">;<br><br>&nbsp; &nbsp; </span><span class="default">$fh </span><span class="keyword">= </span><span class="default">fopen</span><span class="keyword">(</span><span class="string">"c:\dirlist.txt"</span><span class="keyword">,</span><span class="string">"w"</span><span class="keyword">);<br>&nbsp; &nbsp; </span><span class="default">fwrite</span><span class="keyword">(</span><span class="default">$fh</span><span class="keyword">, </span><span class="string">" "</span><span class="keyword">);<br>&nbsp; &nbsp; </span><span class="default">fclose</span><span class="keyword">(</span><span class="default">$fh</span><span class="keyword">);<br>foreach (</span><span class="default">$remotedirs </span><span class="keyword">as </span><span class="default">$val</span><span class="keyword">){<br>echo </span><span class="default">$remotedir </span><span class="keyword">= </span><span class="string">"/data/www/</span><span class="default">$val</span><span class="string">/"</span><span class="keyword">;<br></span><span class="default">$localdir&nbsp; &nbsp;&nbsp; </span><span class="keyword">= </span><span class="string">"\\\\192.168.0.234\\C$\\xampp\\htdocs\\</span><span class="default">$val</span><span class="string">\\"</span><span class="keyword">;<br></span><span class="default">backupwebsites</span><span class="keyword">(</span><span class="default">$remotedir</span><span class="keyword">,</span><span class="default">$localdir</span><span class="keyword">);<br>}<br>function </span><span class="default">backupwebsites</span><span class="keyword">(</span><span class="default">$remotedir</span><span class="keyword">,</span><span class="default">$localdir</span><span class="keyword">){<br>&nbsp; &nbsp; </span><span class="default">$connection </span><span class="keyword">= </span><span class="default">ssh2_connect</span><span class="keyword">(</span><span class="default">Host IP </span><span class="keyword">or </span><span class="default">Domain</span><span class="keyword">, </span><span class="default">22</span><span class="keyword">);<br>&nbsp; &nbsp; </span><span class="default">$com </span><span class="keyword">=</span><span class="string">"ls -R -lt </span><span class="default">$remotedir</span><span class="string">"</span><span class="keyword">;<br>&nbsp; &nbsp; </span><span class="default">ssh2_auth_password</span><span class="keyword">(</span><span class="default">$connection</span><span class="keyword">, </span><span class="string">'user'</span><span class="keyword">, </span><span class="string">'password'</span><span class="keyword">);<br>&nbsp; &nbsp; </span><span class="default">$stream </span><span class="keyword">= </span><span class="default">ssh2_exec</span><span class="keyword">(</span><span class="default">$connection</span><span class="keyword">, </span><span class="default">$com </span><span class="keyword">);<br>&nbsp; &nbsp; </span><span class="default">stream_set_blocking</span><span class="keyword">(</span><span class="default">$stream</span><span class="keyword">, </span><span class="default">true</span><span class="keyword">);<br>&nbsp; &nbsp; </span><span class="default">$output </span><span class="keyword">= </span><span class="default">stream_get_contents</span><span class="keyword">(</span><span class="default">$stream</span><span class="keyword">);<br><br>&nbsp; &nbsp; </span><span class="default">$fh </span><span class="keyword">= </span><span class="default">fopen</span><span class="keyword">(</span><span class="string">"c:\dirlist.txt"</span><span class="keyword">,</span><span class="string">"a+"</span><span class="keyword">);<br>&nbsp; &nbsp; </span><span class="default">fwrite</span><span class="keyword">(</span><span class="default">$fh</span><span class="keyword">, </span><span class="default">$output</span><span class="keyword">);<br>&nbsp; &nbsp; </span><span class="default">fclose</span><span class="keyword">(</span><span class="default">$fh</span><span class="keyword">);<br>&nbsp; &nbsp; </span><span class="default">$handle </span><span class="keyword">= @</span><span class="default">fopen</span><span class="keyword">(</span><span class="string">'c:\dirlist.txt'</span><span class="keyword">, </span><span class="string">"r"</span><span class="keyword">);<br>if (</span><span class="default">$handle</span><span class="keyword">) {<br>&nbsp;&nbsp; while (!</span><span class="default">feof</span><span class="keyword">(</span><span class="default">$handle</span><span class="keyword">)) {<br>&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$lines</span><span class="keyword">[] = </span><span class="default">fgets</span><span class="keyword">(</span><span class="default">$handle</span><span class="keyword">, </span><span class="default">4096</span><span class="keyword">);<br>&nbsp;&nbsp; }<br>&nbsp;&nbsp; </span><span class="default">fclose</span><span class="keyword">(</span><span class="default">$handle</span><span class="keyword">);<br>}<br>&nbsp; &nbsp; foreach (</span><span class="default">$lines </span><span class="keyword">as </span><span class="default">$val</span><span class="keyword">)<br>&nbsp; &nbsp; {<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$yr </span><span class="keyword">= </span><span class="default">date</span><span class="keyword">(</span><span class="string">'Y-m-d'</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$i</span><span class="keyword">++;<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$arr1</span><span class="keyword">=</span><span class="default">split</span><span class="keyword">(</span><span class="string">"200"</span><span class="keyword">,</span><span class="default">$val</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$arr2</span><span class="keyword">=</span><span class="default">explode</span><span class="keyword">(</span><span class="string">" "</span><span class="keyword">,</span><span class="default">$arr1</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">]);<br>&nbsp; &nbsp; &nbsp; &nbsp; if(</span><span class="string">"200"</span><span class="keyword">.</span><span class="default">$arr2</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">]==</span><span class="default">$yr</span><span class="keyword">)<br>&nbsp; &nbsp; &nbsp; &nbsp; {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="comment">//if("200".$arr2[0]=='2008-04-21'){&nbsp; &nbsp; //for testing<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$remotedir </span><span class="keyword">= </span><span class="default">$remotedir</span><span class="keyword">.</span><span class="default">$arr2</span><span class="keyword">[</span><span class="default">2</span><span class="keyword">];<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$cpy</span><span class="keyword">=</span><span class="default">$arr2</span><span class="keyword">[</span><span class="default">2</span><span class="keyword">];<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$file </span><span class="keyword">= </span><span class="default">$localdir</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">glue</span><span class="keyword">(</span><span class="default">$connection</span><span class="keyword">,</span><span class="default">$remotedir</span><span class="keyword">,</span><span class="default">$localdir</span><span class="keyword">,</span><span class="default">$cpy</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; }<br>&nbsp; &nbsp; }<br>}&nbsp; &nbsp; <br></span><span class="comment">//echo $i;<br></span><span class="keyword">function </span><span class="default">glue</span><span class="keyword">(</span><span class="default">$connection</span><span class="keyword">,</span><span class="default">$remotedir</span><span class="keyword">,</span><span class="default">$localdir</span><span class="keyword">,</span><span class="default">$cpy</span><span class="keyword">){<br>&nbsp; &nbsp; </span><span class="default">$ldir</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">] = </span><span class="string">"</span><span class="default">$localdir</span><span class="string">"</span><span class="keyword">;<br>&nbsp; &nbsp; </span><span class="default">$ldir</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">]=</span><span class="string">"</span><span class="default">$cpy</span><span class="string">"</span><span class="keyword">;<br>&nbsp; &nbsp; </span><span class="default">$file </span><span class="keyword">= </span><span class="default">$ldir</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">].</span><span class="default">$ldir</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">];<br>&nbsp; &nbsp; </span><span class="default">$file </span><span class="keyword">= </span><span class="default">trim</span><span class="keyword">(</span><span class="default">$file</span><span class="keyword">);<br>&nbsp; &nbsp;&nbsp; </span><span class="default">$file</span><span class="keyword">;<br> </span><span class="default">gop</span><span class="keyword">(</span><span class="default">$connection</span><span class="keyword">,</span><span class="default">$remotedir</span><span class="keyword">,</span><span class="default">$file</span><span class="keyword">);<br>}<br>function </span><span class="default">gop</span><span class="keyword">(</span><span class="default">$connection</span><span class="keyword">,</span><span class="default">$remotedir</span><span class="keyword">,</span><span class="default">$file</span><span class="keyword">){<br>echo </span><span class="default">$file</span><span class="keyword">;<br><br></span><span class="default">ssh2_scp_recv</span><span class="keyword">(<br></span><span class="default">$connection</span><span class="keyword">, <br></span><span class="default">$remotedir</span><span class="keyword">,<br></span><span class="default">$file</span><span class="keyword">);<br>}<br><br></span><span class="default">?&gt;</span>
</span>
</code></div>
  </div>
 </div>
  <div class="note" id="68734">  
  <a class="name">
  <strong class="user"><em>jcalcote at novell dot com</em></strong></a><div class="date" title="2006-08-08 01:51"><strong>8 years ago</strong></div>
  <div class="text" id="Hcom68734">
<div class="phpcode"><code><span class="html">
If you scan a remote directory for a list of files by using opendir and readdir on a path obtained from ssh2_sftp(), you'll end up with a list of full file paths containing the ssh2.s<a rel="nofollow" target="_blank">ftp://$sftp</a> prefix, where $sftp is the sftp resource string returned by ssh2_sftp. <br><br>If you later attempt to use ssh2_scp_recv() (even on the same connection!) to copy files locally from the remote path, the copy operation will fail because ssh2_scp_recv() doesn't like the wrapper path prefix. It expects remote file references to be rooted at the base of the remote file system (eg., '/').<br><br>Moral: ssh2_scp_recv() likes paths rooted at the file system root on the remote machine, not full network paths. This routine will fail with an obscure message about not being able to copy the files - yet when you go look it works fine. Worse, when you connect and copy them from an scp shell session, it also works fine.</span>
</code></div>
  </div>
 </div></div>

 
</section>    </section><!-- layout-content -->
        


  </div><!-- layout -->
         
  

    
 <!-- External and third party libraries. -->
 







<a id="toTop" href="javascript:;"><span id="toTopHover"></span><img width="40" height="40" alt="To Top" src="../../images/to-top%402x.png"></a>



<!-- Mirrored from php.net/manual/en/function.ssh2-scp-recv.php by HTTrack Website Copier/3.x [XR&CO'2013], Thu, 28 Aug 2014 16:46:35 GMT -->


</body></html>