<html><!-- Mirrored from php.net/manual/en/function.html-entity-decode.php by HTTrack Website Copier/3.x [XR&CO'2013], Thu, 28 Aug 2014 16:04:56 GMT --><!-- Added by HTTrack --><head><meta http-equiv="content-type" content="text/html;charset=utf-8"><!-- /Added by HTTrack -->


  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0"> 

  <title>html_entity_decode</title>

 <link rel="shortcut icon" href="../../favicon.ico">
 <link rel="search" type="application/opensearchdescription+xml" href="http://php.net/phpnetimprovedsearch.src" title="Add PHP.net search">
 <link rel="alternate" type="application/atom+xml" href="http://php.net/releases/feed.php" title="PHP Release feed">
 <link rel="alternate" type="application/atom+xml" href="http://php.net/feed.atom" title="PHP: Hypertext Preprocessor">

 <link rel="canonical" href="function.html-entity-decode.html">
 <link rel="shorturl" href="http://php.net/html-entity-decode">
 <link rel="alternate" href="http://php.net/html-entity-decode" hreflang="x-default">

 <link rel="contents" href="index-2.html">
 <link rel="index" href="ref.strings.html">
 <link rel="prev" href="function.hex2bin.html">
 <link rel="next" href="function.htmlentities.html">

 <link rel="alternate" href="function.html-entity-decode.html" hreflang="en">
 <link rel="alternate" href="http://php.net/manual/pt_BR/function.html-entity-decode.php" hreflang="pt_BR">
 <link rel="alternate" href="http://php.net/manual/zh/function.html-entity-decode.php" hreflang="zh">
 <link rel="alternate" href="http://php.net/manual/fr/function.html-entity-decode.php" hreflang="fr">
 <link rel="alternate" href="http://php.net/manual/de/function.html-entity-decode.php" hreflang="de">
 <link rel="alternate" href="http://php.net/manual/it/function.html-entity-decode.php" hreflang="it">
 <link rel="alternate" href="http://php.net/manual/ja/function.html-entity-decode.php" hreflang="ja">
 <link rel="alternate" href="http://php.net/manual/ro/function.html-entity-decode.php" hreflang="ro">
 <link rel="alternate" href="http://php.net/manual/ru/function.html-entity-decode.php" hreflang="ru">
 <link rel="alternate" href="http://php.net/manual/es/function.html-entity-decode.php" hreflang="es">
 <link rel="alternate" href="http://php.net/manual/tr/function.html-entity-decode.php" hreflang="tr">

<link rel="stylesheet" type="text/css" href="../../cached8fe1.css?t=1401250819&amp;f=/fonts/Fira/fira.css" media="screen">
<link rel="stylesheet" type="text/css" href="../../cached4b8d.css?t=1404368420&amp;f=/fonts/Font-Awesome/css/fontello.css" media="screen">
<link rel="stylesheet" type="text/css" href="../../cached5065.css?t=1403329232&amp;f=/styles/theme-base.css" media="screen">
<link rel="stylesheet" type="text/css" href="../../cachedc78d.css?t=1401249623&amp;f=/styles/theme-medium.css" media="screen">

 <!--[if lte IE 7]>
 <link rel="stylesheet" type="text/css" href="http://php.net/styles/workarounds.ie7.css" media="screen">
 <![endif]-->

 <!--[if lte IE 8]>
 <script type="text/javascript">
  window.brokenIE = true;
 </script>
 <![endif]-->

 <!--[if lte IE 9]>
 <link rel="stylesheet" type="text/css" href="http://php.net/styles/workarounds.ie9.css" media="screen">
 <![endif]-->

 <!--[if IE]>
 <script type="text/javascript" src="http://php.net/js/ext/html5.js"></script>
 <![endif]-->

 <base>

</head>
<body class="docs " style="">


<div class="headsup"><a href="http://php.net/index.php#id2014-08-28-1">PHP 5.6.0 released</a></div>
<nav id="trick"><div><dl>
<dt><a href="getting-started.html">Getting Started</a></dt>
	<dd><a href="introduction.html">Introduction</a></dd>
	<dd><a href="tutorial.html">A simple tutorial</a></dd>
<dt><a href="langref.html">Language Reference</a></dt>
	<dd><a href="language.basic-syntax.html">Basic syntax</a></dd>
	<dd><a href="language.types.html">Types</a></dd>
	<dd><a href="language.variables.html">Variables</a></dd>
	<dd><a href="language.constants.html">Constants</a></dd>
	<dd><a href="language.expressions.html">Expressions</a></dd>
	<dd><a href="language.operators.html">Operators</a></dd>
	<dd><a href="language.control-structures.html">Control Structures</a></dd>
	<dd><a href="language.functions.html">Functions</a></dd>
	<dd><a href="language.oop5.html">Classes and Objects</a></dd>
	<dd><a href="language.namespaces.html">Namespaces</a></dd>
	<dd><a href="language.exceptions.html">Exceptions</a></dd>
	<dd><a href="language.generators.html">Generators</a></dd>
	<dd><a href="language.references.html">References Explained</a></dd>
	<dd><a href="reserved.variables.html">Predefined Variables</a></dd>
	<dd><a href="reserved.exceptions.html">Predefined Exceptions</a></dd>
	<dd><a href="reserved.interfaces.html">Predefined Interfaces and Classes</a></dd>
	<dd><a href="context.html">Context options and parameters</a></dd>
	<dd><a href="wrappers.html">Supported Protocols and Wrappers</a></dd>
</dl>
<dl>
<dt><a href="security.html">Security</a></dt>
	<dd><a href="security.intro.html">Introduction</a></dd>
	<dd><a href="security.general.html">General considerations</a></dd>
	<dd><a href="security.cgi-bin.html">Installed as CGI binary</a></dd>
	<dd><a href="security.apache.html">Installed as an Apache module</a></dd>
	<dd><a href="security.filesystem.html">Filesystem Security</a></dd>
	<dd><a href="security.database.html">Database Security</a></dd>
	<dd><a href="security.errors.html">Error Reporting</a></dd>
	<dd><a href="security.globals.html">Using Register Globals</a></dd>
	<dd><a href="security.variables.html">User Submitted Data</a></dd>
	<dd><a href="security.magicquotes.html">Magic Quotes</a></dd>
	<dd><a href="security.hiding.html">Hiding PHP</a></dd>
	<dd><a href="security.current.html">Keeping Current</a></dd>
<dt><a href="features.html">Features</a></dt>
	<dd><a href="features.http-auth.html">HTTP authentication with PHP</a></dd>
	<dd><a href="features.cookies.html">Cookies</a></dd>
	<dd><a href="features.sessions.html">Sessions</a></dd>
	<dd><a href="features.xforms.html">Dealing with XForms</a></dd>
	<dd><a href="features.file-upload.html">Handling file uploads</a></dd>
	<dd><a href="features.remote-files.html">Using remote files</a></dd>
	<dd><a href="features.connection-handling.html">Connection handling</a></dd>
	<dd><a href="features.persistent-connections.html">Persistent Database Connections</a></dd>
	<dd><a href="features.safe-mode.html">Safe Mode</a></dd>
	<dd><a href="features.commandline.html">Command line usage</a></dd>
	<dd><a href="features.gc.html">Garbage Collection</a></dd>
	<dd><a href="features.dtrace.html">DTrace Dynamic Tracing</a></dd>
</dl>
<dl>
<dt><a href="funcref.html">Function Reference</a></dt>
	<dd><a href="refs.basic.php.html">Affecting PHP's Behaviour</a></dd>
	<dd><a href="refs.utilspec.audio.html">Audio Formats Manipulation</a></dd>
	<dd><a href="refs.remote.auth.html">Authentication Services</a></dd>
	<dd><a href="refs.utilspec.cmdline.html">Command Line Specific Extensions</a></dd>
	<dd><a href="refs.compression.html">Compression and Archive Extensions</a></dd>
	<dd><a href="refs.creditcard.html">Credit Card Processing</a></dd>
	<dd><a href="refs.crypto.html">Cryptography Extensions</a></dd>
	<dd><a href="refs.database.html">Database Extensions</a></dd>
	<dd><a href="refs.calendar.html">Date and Time Related Extensions</a></dd>
	<dd><a href="refs.fileprocess.file.html">File System Related Extensions</a></dd>
	<dd><a href="refs.international.html">Human Language and Character Encoding Support</a></dd>
	<dd><a href="refs.utilspec.image.html">Image Processing and Generation</a></dd>
	<dd><a href="refs.remote.mail.html">Mail Related Extensions</a></dd>
	<dd><a href="refs.math.html">Mathematical Extensions</a></dd>
	<dd><a href="refs.utilspec.nontext.html">Non-Text MIME Output</a></dd>
	<dd><a href="refs.fileprocess.process.html">Process Control Extensions</a></dd>
	<dd><a href="refs.basic.other.html">Other Basic Extensions</a></dd>
	<dd><a href="refs.remote.other.html">Other Services</a></dd>
	<dd><a href="refs.search.html">Search Engine Extensions</a></dd>
	<dd><a href="refs.utilspec.server.html">Server Specific Extensions</a></dd>
	<dd><a href="refs.basic.session.html">Session Extensions</a></dd>
	<dd><a href="refs.basic.text.html">Text Processing</a></dd>
	<dd><a href="refs.basic.vartype.html">Variable and Type Related Extensions</a></dd>
	<dd><a href="refs.webservice.html">Web Services</a></dd>
	<dd><a href="refs.utilspec.windows.html">Windows Only Extensions</a></dd>
	<dd><a href="refs.xml.html">XML Manipulation</a></dd>
</dl>
<dl>
<dt>Keyboard Shortcuts</dt><dt>?</dt>
<dd>This help</dd>
<dt>j</dt>
<dd>Next menu item</dd>
<dt>k</dt>
<dd>Previous menu item</dd>
<dt>g p</dt>
<dd>Previous man page</dd>
<dt>g n</dt>
<dd>Next man page</dd>
<dt>G</dt>
<dd>Scroll to bottom</dd>
<dt>g g</dt>
<dd>Scroll to top</dd>
<dt>g h</dt>
<dd>Goto homepage</dd>
<dt>g s</dt>
<dd>Goto search<br>(current page)</dd>
<dt>/</dt>
<dd>Focus search box</dd>
</dl></div></nav>
<div id="goto">
    <div class="search">
         <div class="text"></div>
         <div class="results"><ul></ul></div>
   </div>
</div>

  <div id="breadcrumbs" class="row-fluid">
          
              
        <ul class="breadcrumbs-container">
            <li><a href="index-2.html">PHP Manual</a></li>      <li><a href="funcref.html">Function Reference</a></li>      <li><a href="refs.basic.text.html">Text Processing</a></li>      <li><a href="book.strings.html">Strings</a></li>      <li><a href="ref.strings.html">String Functions</a></li>    </ul>
  </div>




<div id="layout">
  <section id="layout-content">
  <div id="function.html-entity-decode" class="refentry">
 <div class="refnamediv">
  <h1 class="refname">html_entity_decode</h1>
  <p class="verinfo">(PHP 4 &gt;= 4.3.0, PHP 5)</p><p class="refpurpose"><span class="refname">html_entity_decode</span> — <span class="dc-title">Convert all HTML entities to their applicable characters</span></p>

 </div>
 
 <div class="refsect1 description" id="refsect1-function.html-entity-decode-description">
  <h3 class="title">Description</h3>
  <div class="methodsynopsis dc-description">
   <span class="type">string</span> <span class="methodname"><strong>html_entity_decode</strong></span>
    ( <span class="methodparam"><span class="type">string</span> <code class="parameter">$string</code></span>
   [, <span class="methodparam"><span class="type">int</span> <code class="parameter">$flags</code><span class="initializer"> = ENT_COMPAT | ENT_HTML401</span></span>
   [, <span class="methodparam"><span class="type">string</span> <code class="parameter">$encoding</code><span class="initializer"> = ini_get("default_charset")</span></span>
  ]] )</div>

  <p class="para rdfs-comment">
   <span class="function"><strong>html_entity_decode()</strong></span> is the opposite of
   <span class="function"><a href="function.htmlentities.html" class="function">htmlentities()</a></span> in that it converts all HTML entities
   in the <code class="parameter">string</code> to their applicable characters.
  </p>
  <p class="para">
   More precisely, this function decodes all the entities (including all numeric
   entities) that a) are necessarily valid for the chosen document type — i.e.,
   for XML, this function does not decode named entities that might be defined
   in some DTD — and b) whose character or characters are in the coded character
   set associated with the chosen encoding and are permitted in the chosen
   document type. All other entities are left as is.
  </p>
 </div>


 <div class="refsect1 parameters" id="refsect1-function.html-entity-decode-parameters">
  <h3 class="title">Parameters</h3>
  <p class="para">
   </p><dl>

    
     <dt>
<code class="parameter">string</code></dt>

     <dd>

      <p class="para">
       The input string.
      </p>
     </dd>

    
    
     <dt>
<code class="parameter">flags</code></dt>

     <dd>

      <p class="para">
       A bitmask of one or more of the following flags, which specify how to handle quotes and
       which document type to use. The default is <em>ENT_COMPAT | ENT_HTML401</em>.
       </p><table class="doctable table">
        <caption><strong>Available <code class="parameter">flags</code> constants</strong></caption>
        
         <thead>
          <tr>
           <th>Constant Name</th>
           <th>Description</th>
          </tr>

         </thead>

         <tbody class="tbody">
          <tr>
           <td><strong><code>ENT_COMPAT</code></strong></td>
           <td>Will convert double-quotes and leave single-quotes alone.</td>
          </tr>

          <tr>
           <td><strong><code>ENT_QUOTES</code></strong></td>
           <td>Will convert both double and single quotes.</td>
          </tr>

          <tr>
           <td><strong><code>ENT_NOQUOTES</code></strong></td>
           <td>Will leave both double and single quotes unconverted.</td>
          </tr>

          <tr>
           <td><strong><code>ENT_HTML401</code></strong></td>
           <td>
            Handle code as HTML 4.01.
           </td>
          </tr>

          <tr>
           <td><strong><code>ENT_XML1</code></strong></td>
           <td>
            Handle code as XML 1.
           </td>
          </tr>

          <tr>
           <td><strong><code>ENT_XHTML</code></strong></td>
           <td>
            Handle code as XHTML.
           </td>
          </tr>

          <tr>
           <td><strong><code>ENT_HTML5</code></strong></td>
           <td>
            Handle code as HTML 5.
           </td>
          </tr>

         </tbody>
        
       </table>

      <p></p>
     </dd>

    
    
     <dt>
<code class="parameter">encoding</code></dt>

     <dd>

      
 <p class="para">
  An optional argument defining the encoding used when converting characters.
 </p>

 <p class="para">
  If omitted, the default value of the <code class="parameter">encoding</code> varies
  depending on the PHP version in use. In PHP 5.6 and later, the
  <a href="ini.core.html#ini.default-charset" class="link">default_charset</a> configuration
  option is used as the default value. PHP 5.4 and 5.5 will use
  <em>UTF-8</em> as the default. Earlier versions of PHP use
  <em>ISO-8859-1</em>.
 </p>

 <p class="para">
  Although this argument is technically optional, you are highly encouraged to
  specify the correct value for your code if you are using PHP 5.5 or earlier,
  or if your <a href="ini.core.html#ini.default-charset" class="link">default_charset</a>
  configuration option may be set incorrectly for the given input.
 </p>

      

<p class="para">
 The following character sets are supported:
 </p><table class="doctable table">
  <caption><strong>Supported charsets</strong></caption>
  
   <thead>
    <tr>
     <th>Charset</th>
     <th>Aliases</th>
     <th>Description</th>
    </tr>

   </thead>

   <tbody class="tbody">
    <tr>
     <td>ISO-8859-1</td>
     <td>ISO8859-1</td>
     <td>
      Western European, Latin-1.
     </td>
    </tr>

    <tr>
     <td>ISO-8859-5</td>
     <td>ISO8859-5</td>
     <td>
      Little used cyrillic charset (Latin/Cyrillic).
     </td>
    </tr>

    <tr>
     <td>ISO-8859-15</td>
     <td>ISO8859-15</td>
     <td>
      Western European, Latin-9. Adds the Euro sign, French and Finnish
      letters missing in Latin-1 (ISO-8859-1).
     </td>
    </tr>

    <tr>
     <td>UTF-8</td>
     <td class="empty">&nbsp;</td>
     <td>
      ASCII compatible multi-byte 8-bit Unicode.
     </td>
    </tr>

    <tr>
     <td>cp866</td>
     <td>ibm866, 866</td>
     <td>
      DOS-specific Cyrillic charset.
     </td>
    </tr>

    <tr>
     <td>cp1251</td>
     <td>Windows-1251, win-1251, 1251</td>
     <td>
      Windows-specific Cyrillic charset.
     </td>
    </tr>

    <tr>
     <td>cp1252</td>
     <td>Windows-1252, 1252</td>
     <td>
      Windows specific charset for Western European.
     </td>
    </tr>

    <tr>
     <td>KOI8-R</td>
     <td>koi8-ru, koi8r</td>
     <td>
      Russian.
     </td>
    </tr>

    <tr>
     <td>BIG5</td>
     <td>950</td>
     <td>
      Traditional Chinese, mainly used in Taiwan.
     </td>
    </tr>

    <tr>
     <td>GB2312</td>
     <td>936</td>
     <td>
      Simplified Chinese, national standard character set.
     </td>
    </tr>

    <tr>
     <td>BIG5-HKSCS</td>
     <td class="empty">&nbsp;</td>
     <td>
      Big5 with Hong Kong extensions, Traditional Chinese.
     </td>
    </tr>

    <tr>
     <td>Shift_JIS</td>
     <td>SJIS, SJIS-win, cp932, 932</td>
     <td>
      Japanese
     </td>
    </tr>

    <tr>
     <td>EUC-JP</td>
     <td>EUCJP, eucJP-win</td>
     <td>
      Japanese
     </td>
    </tr>

    <tr>
     <td>MacRoman</td>
     <td class="empty">&nbsp;</td>
     <td>
      Charset that was used by Mac OS.
     </td>
    </tr>

    <tr>
     <td><em>''</em></td>
     <td class="empty">&nbsp;</td>
     <td>
      An empty string activates detection from script encoding (Zend multibyte),
      <a href="ini.core.html#ini.default-charset" class="link">default_charset</a> and current
      locale (see <span class="function"><a href="function.nl-langinfo.html" class="function">nl_langinfo()</a></span> and
      <span class="function"><a href="function.setlocale.html" class="function">setlocale()</a></span>), in this order. Not recommended.
     </td>
    </tr>

   </tbody>
  
 </table>

 <blockquote class="note"><p><strong class="note">Note</strong>: 
  <span class="simpara">
   Any other character sets are not recognized. The default encoding will be
   used instead and a warning will be emitted.
  </span>
 </p></blockquote>
<p></p>


     </dd>

    
   </dl>

  <p></p>
 </div>


 <div class="refsect1 returnvalues" id="refsect1-function.html-entity-decode-returnvalues">
  <h3 class="title">Return Values</h3>
  <p class="para">
   Returns the decoded string.
  </p>
 </div>


 <div class="refsect1 changelog" id="refsect1-function.html-entity-decode-changelog">
  <h3 class="title">Changelog</h3>
  <p class="para">
   </p><table class="doctable informaltable">
    
     <thead>
      <tr>
       <th>Version</th>
       <th>Description</th>
      </tr>

     </thead>

     <tbody class="tbody">
      
 <tr>
  <td>5.6.0</td>
  <td>
   The default value for the <code class="parameter">encoding</code> parameter was
   changed to be the value of the
   <a href="ini.core.html#ini.default-charset" class="link">default_charset</a> configuration
   option.
  </td>
 </tr>


      <tr>
       <td>5.4.0</td>
       <td>
        Default encoding changed from ISO-8859-1 to UTF-8.
       </td>
      </tr>

      <tr>
       <td>5.4.0</td>
       <td>
        The constants <strong><code>ENT_HTML401</code></strong>, <strong><code>ENT_XML1</code></strong>,
        <strong><code>ENT_XHTML</code></strong> and <strong><code>ENT_HTML5</code></strong> were added.
       </td>
      </tr>

     </tbody>
    
   </table>

  <p></p>
 </div>


 <div class="refsect1 examples" id="refsect1-function.html-entity-decode-examples">
  <h3 class="title">Examples</h3>
  <p class="para">
   </p><div class="example" id="example-4952">
    <p><strong>Example #1 Decoding HTML entities</strong></p>
    <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br>$orig&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #DD0000">"I'll&nbsp;\"walk\"&nbsp;the&nbsp;&lt;b&gt;dog&lt;/b&gt;&nbsp;now"</span><span style="color: #007700">;<br><br></span><span style="color: #0000BB">$a&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">htmlentities</span><span style="color: #007700">(</span><span style="color: #0000BB">$orig</span><span style="color: #007700">);<br><br></span><span style="color: #0000BB">$b&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">html_entity_decode</span><span style="color: #007700">(</span><span style="color: #0000BB">$a</span><span style="color: #007700">);<br><br>echo&nbsp;</span><span style="color: #0000BB">$a</span><span style="color: #007700">;&nbsp;</span><span style="color: #FF8000">//&nbsp;I'll&nbsp;&amp;quot;walk&amp;quot;&nbsp;the&nbsp;&amp;lt;b&amp;gt;dog&amp;lt;/b&amp;gt;&nbsp;now<br><br></span><span style="color: #007700">echo&nbsp;</span><span style="color: #0000BB">$b</span><span style="color: #007700">;&nbsp;</span><span style="color: #FF8000">//&nbsp;I'll&nbsp;"walk"&nbsp;the&nbsp;&lt;b&gt;dog&lt;/b&gt;&nbsp;now<br></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
    </div>

   </div>   
  <p></p>
 </div>


 <div class="refsect1 notes" id="refsect1-function.html-entity-decode-notes">
  <h3 class="title">Notes</h3>
  <blockquote class="note"><p><strong class="note">Note</strong>: 
   </p><p class="para">
    You might wonder why trim(html_entity_decode('&amp;nbsp;')); doesn't
    reduce the string to an empty string, that's because the '&amp;nbsp;'
    entity is not ASCII code 32 (which is stripped by
    <span class="function"><a href="function.trim.html" class="function">trim()</a></span>) but ASCII code 160 (0xa0) in the default ISO
    8859-1 encoding.
   </p>
  <p></p></blockquote>
 </div>


 <div class="refsect1 seealso" id="refsect1-function.html-entity-decode-seealso">
  <h3 class="title">See Also</h3>
  <p class="para">
   </p><ul class="simplelist">
    <li class="member"><span class="function"><a href="function.htmlentities.html" class="function" rel="rdfs-seeAlso">htmlentities()</a> - Convert all applicable characters to HTML entities</span></li>
    <li class="member"><span class="function"><a href="function.htmlspecialchars.html" class="function" rel="rdfs-seeAlso">htmlspecialchars()</a> - Convert special characters to HTML entities</span></li>
    <li class="member"><span class="function"><a href="function.get-html-translation-table.html" class="function" rel="rdfs-seeAlso">get_html_translation_table()</a> - Returns the translation table used by htmlspecialchars and htmlentities</span></li>
    <li class="member"><span class="function"><a href="function.urldecode.html" class="function" rel="rdfs-seeAlso">urldecode()</a> - Decodes URL-encoded string</span></li>
   </ul>
  <p></p>
 </div>


</div>
<section id="usernotes">
 <div class="head"><h3 class="title">User Contributed Notes</h3></div><div id="allnotes">
  <div class="note" id="104617">  
  <a class="name">
  <strong class="user"><em>Martin</em></strong></a><div class="date" title="2011-06-26 04:37"><strong>3 years ago</strong></div>
  <div class="text" id="Hcom104617">
<div class="phpcode"><code><span class="html">
If you need something that converts &amp;#[0-9]+ entities to UTF-8, this is simple and works:
<br>
<br><span class="default">&lt;?php
<br></span><span class="comment">/* Entity crap. /
<br>$input = "Fovi&amp;#269;";
<br>
<br>$output = preg_replace_callback("/(&amp;#[0-9]+;)/", function($m) { return mb_convert_encoding($m[1], "UTF-8", "HTML-ENTITIES"); }, $input);
<br>
<br>/* Plain UTF-8. */
<br></span><span class="keyword">echo </span><span class="default">$output</span><span class="keyword">;
<br></span><span class="default">?&gt;</span>
</span>
</code></div>
  </div>
 </div>
  <div class="note" id="80539">  
  <a class="name">
  <strong class="user"><em>me at richardsnazell dot com</em></strong></a><div class="date" title="2008-01-21 04:19"><strong>6 years ago</strong></div>
  <div class="text" id="Hcom80539">
<div class="phpcode"><code><span class="html">
I had a problem getting the 'TM' trademark symbol to display correctly in an email subject line. Using html_entity_decode() with different charsets didn't work, but directly replacing the entity with it's ASCII equivalent did:<br><br>$subject = str_replace('&amp;trade;', chr(153), $subject);</span>
</code></div>
  </div>
 </div>
  <div class="note" id="47371">  
  <a class="name">
  <strong class="user"><em>daniel at brightbyte dot de</em></strong></a><div class="date" title="2004-11-13 06:12"><strong>9 years ago</strong></div>
  <div class="text" id="Hcom47371">
<div class="phpcode"><code><span class="html">
This function seems to have to have two limitations (at least in PHP 4.3.8):<br><br>a) it does not work with multibyte character codings, such as UTF-8<br>b) it does not decode numeric entity references<br><br>a) can be solved by using iconv to convert to ISO-8859-1, then decoding the entities, than convert to UTF-8 again. But that's quite ugly and detroys all characters not present in Latin-1.<br><br>b) can be solved rather nicely using the following code:<br><br><span class="default">&lt;?php<br></span><span class="keyword">function </span><span class="default">decode_entities</span><span class="keyword">(</span><span class="default">$text</span><span class="keyword">) {<br>&nbsp; &nbsp; </span><span class="default">$text</span><span class="keyword">= </span><span class="default">html_entity_decode</span><span class="keyword">(</span><span class="default">$text</span><span class="keyword">,</span><span class="default">ENT_QUOTES</span><span class="keyword">,</span><span class="string">"ISO-8859-1"</span><span class="keyword">); </span><span class="comment">#NOTE: UTF-8 does not work!<br>&nbsp; &nbsp; </span><span class="default">$text</span><span class="keyword">= </span><span class="default">preg_replace</span><span class="keyword">(</span><span class="string">'/&amp;#(\d+);/me'</span><span class="keyword">,</span><span class="string">"chr(\\1)"</span><span class="keyword">,</span><span class="default">$text</span><span class="keyword">); </span><span class="comment">#decimal notation<br>&nbsp; &nbsp; </span><span class="default">$text</span><span class="keyword">= </span><span class="default">preg_replace</span><span class="keyword">(</span><span class="string">'/&amp;#x([a-f0-9]+);/mei'</span><span class="keyword">,</span><span class="string">"chr(0x\\1)"</span><span class="keyword">,</span><span class="default">$text</span><span class="keyword">);&nbsp; </span><span class="comment">#hex notation<br>&nbsp; &nbsp; </span><span class="keyword">return </span><span class="default">$text</span><span class="keyword">;<br>}<br></span><span class="default">?&gt;<br></span><br>HTH</span>
</code></div>
  </div>
 </div>
  <div class="note" id="99322">  
  <a class="name">
  <strong class="user"><em>neurotic dot neu at gmail dot com</em></strong></a><div class="date" title="2010-08-10 12:25"><strong>4 years ago</strong></div>
  <div class="text" id="Hcom99322">
<div class="phpcode"><code><span class="html">
This is a safe rawurldecode with utf8 detection:
<br>
<br><span class="default">&lt;?php
<br></span><span class="keyword">function </span><span class="default">utf8_rawurldecode</span><span class="keyword">(</span><span class="default">$raw_url_encoded</span><span class="keyword">){
<br>&nbsp; &nbsp; </span><span class="default">$enc </span><span class="keyword">= </span><span class="default">rawurldecode</span><span class="keyword">(</span><span class="default">$raw_url_encoded</span><span class="keyword">);
<br>&nbsp; &nbsp; if(</span><span class="default">utf8_encode</span><span class="keyword">(</span><span class="default">utf8_decode</span><span class="keyword">(</span><span class="default">$enc</span><span class="keyword">))==</span><span class="default">$enc</span><span class="keyword">){;
<br>&nbsp; &nbsp; &nbsp; &nbsp; return </span><span class="default">rawurldecode</span><span class="keyword">(</span><span class="default">$raw_url_encoded</span><span class="keyword">);
<br>&nbsp; &nbsp; }else{
<br>&nbsp; &nbsp; &nbsp; &nbsp; return </span><span class="default">utf8_encode</span><span class="keyword">(</span><span class="default">rawurldecode</span><span class="keyword">(</span><span class="default">$raw_url_encoded</span><span class="keyword">));
<br>&nbsp; &nbsp; }
<br>}
<br></span><span class="default">?&gt;</span>
</span>
</code></div>
  </div>
 </div>
  <div class="note" id="111859">  
  <a class="name">
  <strong class="user"><em>Benjamin</em></strong></a><div class="date" title="2013-04-05 11:07"><strong>1 year ago</strong></div>
  <div class="text" id="Hcom111859">
<div class="phpcode"><code><span class="html">
The following function decodes named and numeric HTML entities and works on UTF-8. Requires iconv.<br><br>function decodeHtmlEnt($str) {<br>&nbsp; &nbsp; $ret = html_entity_decode($str, ENT_COMPAT, 'UTF-8');<br>&nbsp; &nbsp; $p2 = -1;<br>&nbsp; &nbsp; for(;;) {<br>&nbsp; &nbsp; &nbsp; &nbsp; $p = strpos($ret, '&amp;#', $p2+1);<br>&nbsp; &nbsp; &nbsp; &nbsp; if ($p === FALSE)<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; break;<br>&nbsp; &nbsp; &nbsp; &nbsp; $p2 = strpos($ret, ';', $p);<br>&nbsp; &nbsp; &nbsp; &nbsp; if ($p2 === FALSE)<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; break;<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; if (substr($ret, $p+2, 1) == 'x')<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $char = hexdec(substr($ret, $p+3, $p2-$p-3));<br>&nbsp; &nbsp; &nbsp; &nbsp; else<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $char = intval(substr($ret, $p+2, $p2-$p-2));<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; //echo "$char\n";<br>&nbsp; &nbsp; &nbsp; &nbsp; $newchar = iconv(<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 'UCS-4', 'UTF-8',<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; chr(($char&gt;&gt;24)&amp;0xFF).chr(($char&gt;&gt;16)&amp;0xFF).chr(($char&gt;&gt;8)&amp;0xFF).chr($char&amp;0xFF) <br>&nbsp; &nbsp; &nbsp; &nbsp; );<br>&nbsp; &nbsp; &nbsp; &nbsp; //echo "$newchar&lt;$p&lt;$p2&lt;&lt;\n";<br>&nbsp; &nbsp; &nbsp; &nbsp; $ret = substr_replace($ret, $newchar, $p, 1+$p2-$p);<br>&nbsp; &nbsp; &nbsp; &nbsp; $p2 = $p + strlen($newchar);<br>&nbsp; &nbsp; }<br>&nbsp; &nbsp; return $ret;<br>}</span>
</code></div>
  </div>
 </div>
  <div class="note" id="98697">  
  <a class="name">
  <strong class="user"><em>Free at Key dot no</em></strong></a><div class="date" title="2010-07-01 05:51"><strong>4 years ago</strong></div>
  <div class="text" id="Hcom98697">
<div class="phpcode"><code><span class="html">
Handy function to convert remaining HTML-entities into human readable chars (for entities which do not exist in target charset):
<br>
<br><span class="default">&lt;?php
<br></span><span class="keyword">function </span><span class="default">cleanString</span><span class="keyword">(</span><span class="default">$in</span><span class="keyword">,</span><span class="default">$offset</span><span class="keyword">=</span><span class="default">null</span><span class="keyword">)
<br>{
<br>&nbsp; &nbsp; </span><span class="default">$out </span><span class="keyword">= </span><span class="default">trim</span><span class="keyword">(</span><span class="default">$in</span><span class="keyword">);
<br>&nbsp; &nbsp; if (!empty(</span><span class="default">$out</span><span class="keyword">))
<br>&nbsp; &nbsp; {
<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$entity_start </span><span class="keyword">= </span><span class="default">strpos</span><span class="keyword">(</span><span class="default">$out</span><span class="keyword">,</span><span class="string">'&amp;'</span><span class="keyword">,</span><span class="default">$offset</span><span class="keyword">);
<br>&nbsp; &nbsp; &nbsp; &nbsp; if (</span><span class="default">$entity_start </span><span class="keyword">=== </span><span class="default">false</span><span class="keyword">)
<br>&nbsp; &nbsp; &nbsp; &nbsp; {
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="comment">// ideal
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="keyword">return </span><span class="default">$out</span><span class="keyword">;&nbsp; &nbsp; 
<br>&nbsp; &nbsp; &nbsp; &nbsp; }
<br>&nbsp; &nbsp; &nbsp; &nbsp; else
<br>&nbsp; &nbsp; &nbsp; &nbsp; {
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$entity_end </span><span class="keyword">= </span><span class="default">strpos</span><span class="keyword">(</span><span class="default">$out</span><span class="keyword">,</span><span class="string">';'</span><span class="keyword">,</span><span class="default">$entity_start</span><span class="keyword">);
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if (</span><span class="default">$entity_end </span><span class="keyword">=== </span><span class="default">false</span><span class="keyword">)
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">$out</span><span class="keyword">;
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="comment">// zu lang um eine entity zu sein
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="keyword">else if (</span><span class="default">$entity_end </span><span class="keyword">&gt; </span><span class="default">$entity_start</span><span class="keyword">+</span><span class="default">7</span><span class="keyword">)
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// und weiter gehts
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$out </span><span class="keyword">= </span><span class="default">cleanString</span><span class="keyword">(</span><span class="default">$out</span><span class="keyword">,</span><span class="default">$entity_start</span><span class="keyword">+</span><span class="default">1</span><span class="keyword">);
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="comment">// gottcha!
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="keyword">else
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$clean </span><span class="keyword">= </span><span class="default">substr</span><span class="keyword">(</span><span class="default">$out</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">,</span><span class="default">$entity_start</span><span class="keyword">);
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$subst </span><span class="keyword">= </span><span class="default">substr</span><span class="keyword">(</span><span class="default">$out</span><span class="keyword">,</span><span class="default">$entity_start</span><span class="keyword">+</span><span class="default">1</span><span class="keyword">,</span><span class="default">1</span><span class="keyword">);
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// &amp;scaron; =&gt; "s" / &amp;#353; =&gt; "_"
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$clean </span><span class="keyword">.= (</span><span class="default">$subst </span><span class="keyword">!= </span><span class="string">"#"</span><span class="keyword">) ? </span><span class="default">$subst </span><span class="keyword">: </span><span class="string">"_"</span><span class="keyword">;
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$clean </span><span class="keyword">.= </span><span class="default">substr</span><span class="keyword">(</span><span class="default">$out</span><span class="keyword">,</span><span class="default">$entity_end</span><span class="keyword">+</span><span class="default">1</span><span class="keyword">);
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// und weiter gehts
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$out </span><span class="keyword">= </span><span class="default">cleanString</span><span class="keyword">(</span><span class="default">$clean</span><span class="keyword">,</span><span class="default">$entity_start</span><span class="keyword">+</span><span class="default">1</span><span class="keyword">);
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }
<br>&nbsp; &nbsp; &nbsp; &nbsp; }
<br>&nbsp; &nbsp; }
<br>&nbsp; &nbsp; return </span><span class="default">$out</span><span class="keyword">;
<br>}
<br></span><span class="default">?&gt;</span>
</span>
</code></div>
  </div>
 </div>
  <div class="note" id="70921">  
  <a class="name">
  <strong class="user"><em>jojo</em></strong></a><div class="date" title="2006-11-03 08:27"><strong>7 years ago</strong></div>
  <div class="text" id="Hcom70921">
<div class="phpcode"><code><span class="html">
The decipherment does the character encoded by the escape function of JavaScript. 
<br>When the multi byte is used on the page, it is effective. 
<br>
<br>javascript escape('aaああaa') ..... 'aa%u3042%u3042aa'
<br>php&nbsp; jsEscape_decode('aa%u3042%u3042aa')..'aaああaa'
<br>
<br><span class="default">&lt;?php
<br></span><span class="keyword">function </span><span class="default">jsEscape_decode</span><span class="keyword">(</span><span class="default">$jsEscaped</span><span class="keyword">,</span><span class="default">$outCharCode</span><span class="keyword">=</span><span class="string">'SJIS'</span><span class="keyword">){
<br>&nbsp; &nbsp; </span><span class="default">$arrMojis </span><span class="keyword">= </span><span class="default">explode</span><span class="keyword">(</span><span class="string">"%u"</span><span class="keyword">,</span><span class="default">$jsEscaped</span><span class="keyword">);
<br>&nbsp; &nbsp; for (</span><span class="default">$i </span><span class="keyword">= </span><span class="default">1</span><span class="keyword">;</span><span class="default">$i </span><span class="keyword">&lt; </span><span class="default">count</span><span class="keyword">(</span><span class="default">$arrMojis</span><span class="keyword">);</span><span class="default">$i</span><span class="keyword">++){
<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$c </span><span class="keyword">= </span><span class="default">substr</span><span class="keyword">(</span><span class="default">$arrMojis</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">],</span><span class="default">0</span><span class="keyword">,</span><span class="default">4</span><span class="keyword">);
<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$cc </span><span class="keyword">= </span><span class="default">mb_convert_encoding</span><span class="keyword">(</span><span class="default">pack</span><span class="keyword">(</span><span class="string">'H*'</span><span class="keyword">,</span><span class="default">$c</span><span class="keyword">),</span><span class="default">$outCharCode</span><span class="keyword">,</span><span class="string">'UTF-16'</span><span class="keyword">);
<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$arrMojis</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">] = </span><span class="default">substr_replace</span><span class="keyword">(</span><span class="default">$arrMojis</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">],</span><span class="default">$cc</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">,</span><span class="default">4</span><span class="keyword">);
<br>&nbsp; &nbsp; }
<br>&nbsp; &nbsp; return </span><span class="default">implode</span><span class="keyword">(</span><span class="string">''</span><span class="keyword">,</span><span class="default">$arrMojis</span><span class="keyword">);
<br>}
<br></span><span class="default">?&gt;</span>
</span>
</code></div>
  </div>
 </div>
  <div class="note" id="45649">  
  <a class="name">
  <strong class="user"><em>aidan at php dot net</em></strong></a><div class="date" title="2004-09-14 12:57"><strong>9 years ago</strong></div>
  <div class="text" id="Hcom45649">
<div class="phpcode"><code><span class="html">
This functionality is now implemented in the PEAR package PHP_Compat.<br><br>More information about using this function without upgrading your version of PHP can be found on the below link:<br><br><a rel="nofollow" target="_blank">http://pear.php.net/package/PHP_Compat</a></span>
</code></div>
  </div>
 </div>
  <div class="note" id="54943">  
  <a class="name">
  <strong class="user"><em>florianborn (at) yahoo (dot) de</em></strong></a><div class="date" title="2005-07-20 03:43"><strong>9 years ago</strong></div>
  <div class="text" id="Hcom54943">
<div class="phpcode"><code><span class="html">
Note that<br><br><span class="default">&lt;?php<br><br> </span><span class="keyword">echo </span><span class="default">urlencode</span><span class="keyword">(</span><span class="default">html_entity_decode</span><span class="keyword">(</span><span class="string">"&amp;nbsp;"</span><span class="keyword">));<br><br></span><span class="default">?&gt;<br></span><br>will output "%A0" instead of "+".</span>
</code></div>
  </div>
 </div>
  <div class="note" id="51055">  
  <a class="name">
  <strong class="user"><em>php dot net at c dash ovidiu dot tk</em></strong></a><div class="date" title="2005-03-18 12:37"><strong>9 years ago</strong></div>
  <div class="text" id="Hcom51055">
<div class="phpcode"><code><span class="html">
Quick &amp; dirty code that translates numeric entities to UTF-8.<br><br><span class="default">&lt;?php<br><br>&nbsp; &nbsp; </span><span class="keyword">function </span><span class="default">replace_num_entity</span><span class="keyword">(</span><span class="default">$ord</span><span class="keyword">)<br>&nbsp; &nbsp; {<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$ord </span><span class="keyword">= </span><span class="default">$ord</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">];<br>&nbsp; &nbsp; &nbsp; &nbsp; if (</span><span class="default">preg_match</span><span class="keyword">(</span><span class="string">'/^x([0-9a-f]+)$/i'</span><span class="keyword">, </span><span class="default">$ord</span><span class="keyword">, </span><span class="default">$match</span><span class="keyword">))<br>&nbsp; &nbsp; &nbsp; &nbsp; {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$ord </span><span class="keyword">= </span><span class="default">hexdec</span><span class="keyword">(</span><span class="default">$match</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">]);<br>&nbsp; &nbsp; &nbsp; &nbsp; }<br>&nbsp; &nbsp; &nbsp; &nbsp; else<br>&nbsp; &nbsp; &nbsp; &nbsp; {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$ord </span><span class="keyword">= </span><span class="default">intval</span><span class="keyword">(</span><span class="default">$ord</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; }<br>&nbsp; &nbsp; &nbsp; &nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$no_bytes </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$byte </span><span class="keyword">= array();<br><br>&nbsp; &nbsp; &nbsp; &nbsp; if (</span><span class="default">$ord </span><span class="keyword">&lt; </span><span class="default">128</span><span class="keyword">)<br>&nbsp; &nbsp; &nbsp; &nbsp; {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; return </span><span class="default">chr</span><span class="keyword">(</span><span class="default">$ord</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; }<br>&nbsp; &nbsp; &nbsp; &nbsp; elseif (</span><span class="default">$ord </span><span class="keyword">&lt; </span><span class="default">2048</span><span class="keyword">)<br>&nbsp; &nbsp; &nbsp; &nbsp; {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$no_bytes </span><span class="keyword">= </span><span class="default">2</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; }<br>&nbsp; &nbsp; &nbsp; &nbsp; elseif (</span><span class="default">$ord </span><span class="keyword">&lt; </span><span class="default">65536</span><span class="keyword">)<br>&nbsp; &nbsp; &nbsp; &nbsp; {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$no_bytes </span><span class="keyword">= </span><span class="default">3</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; }<br>&nbsp; &nbsp; &nbsp; &nbsp; elseif (</span><span class="default">$ord </span><span class="keyword">&lt; </span><span class="default">1114112</span><span class="keyword">)<br>&nbsp; &nbsp; &nbsp; &nbsp; {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$no_bytes </span><span class="keyword">= </span><span class="default">4</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; }<br>&nbsp; &nbsp; &nbsp; &nbsp; else<br>&nbsp; &nbsp; &nbsp; &nbsp; {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; return;<br>&nbsp; &nbsp; &nbsp; &nbsp; }<br><br>&nbsp; &nbsp; &nbsp; &nbsp; switch(</span><span class="default">$no_bytes</span><span class="keyword">)<br>&nbsp; &nbsp; &nbsp; &nbsp; {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; case </span><span class="default">2</span><span class="keyword">:<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$prefix </span><span class="keyword">= array(</span><span class="default">31</span><span class="keyword">, </span><span class="default">192</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; break;<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; case </span><span class="default">3</span><span class="keyword">:<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$prefix </span><span class="keyword">= array(</span><span class="default">15</span><span class="keyword">, </span><span class="default">224</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; break;<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; case </span><span class="default">4</span><span class="keyword">:<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$prefix </span><span class="keyword">= array(</span><span class="default">7</span><span class="keyword">, </span><span class="default">240</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br>&nbsp; &nbsp; &nbsp; &nbsp; }<br><br>&nbsp; &nbsp; &nbsp; &nbsp; for (</span><span class="default">$i </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">; </span><span class="default">$i </span><span class="keyword">&lt; </span><span class="default">$no_bytes</span><span class="keyword">; </span><span class="default">$i</span><span class="keyword">++)<br>&nbsp; &nbsp; &nbsp; &nbsp; {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$byte</span><span class="keyword">[</span><span class="default">$no_bytes </span><span class="keyword">- </span><span class="default">$i </span><span class="keyword">- </span><span class="default">1</span><span class="keyword">] = ((</span><span class="default">$ord </span><span class="keyword">&amp; (</span><span class="default">63 </span><span class="keyword">* </span><span class="default">pow</span><span class="keyword">(</span><span class="default">2</span><span class="keyword">, </span><span class="default">6 </span><span class="keyword">* </span><span class="default">$i</span><span class="keyword">))) / </span><span class="default">pow</span><span class="keyword">(</span><span class="default">2</span><span class="keyword">, </span><span class="default">6 </span><span class="keyword">* </span><span class="default">$i</span><span class="keyword">)) &amp; </span><span class="default">63 </span><span class="keyword">| </span><span class="default">128</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; }<br><br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$byte</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">] = (</span><span class="default">$byte</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">] &amp; </span><span class="default">$prefix</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">]) | </span><span class="default">$prefix</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">];<br><br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$ret </span><span class="keyword">= </span><span class="string">''</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; for (</span><span class="default">$i </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">; </span><span class="default">$i </span><span class="keyword">&lt; </span><span class="default">$no_bytes</span><span class="keyword">; </span><span class="default">$i</span><span class="keyword">++)<br>&nbsp; &nbsp; &nbsp; &nbsp; {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$ret </span><span class="keyword">.= </span><span class="default">chr</span><span class="keyword">(</span><span class="default">$byte</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">]);<br>&nbsp; &nbsp; &nbsp; &nbsp; }<br><br>&nbsp; &nbsp; &nbsp; &nbsp; return </span><span class="default">$ret</span><span class="keyword">;<br>&nbsp; &nbsp; }<br><br>&nbsp; &nbsp; </span><span class="default">$test </span><span class="keyword">= </span><span class="string">'This is a &amp;#269;&amp;#x5d0; test&amp;#39;'</span><span class="keyword">;<br><br>&nbsp; &nbsp; echo </span><span class="default">$test </span><span class="keyword">. </span><span class="string">"&lt;br /&gt;\n"</span><span class="keyword">;<br>&nbsp; &nbsp; echo </span><span class="default">preg_replace_callback</span><span class="keyword">(</span><span class="string">'/&amp;#([0-9a-fx]+);/mi'</span><span class="keyword">, </span><span class="string">'replace_num_entity'</span><span class="keyword">, </span><span class="default">$test</span><span class="keyword">);<br><br></span><span class="default">?&gt;</span>
</span>
</code></div>
  </div>
 </div>
  <div class="note" id="93378">  
  <a class="name">
  <strong class="user"><em>Matt Robinson</em></strong></a><div class="date" title="2009-09-06 02:11"><strong>4 years ago</strong></div>
  <div class="text" id="Hcom93378">
<div class="phpcode"><code><span class="html">
I wrote in a previous comment that html_entity_decode() only handled about 100 characters. That's not quite true; it only handles entities that exist in the output character set (the third argument). If you want to get ALL HTML entities, make sure you use ENT_QUOTES and set the third argument to 'UTF-8'. <br><br>If you don't want a UTF-8 string, you'll need to convert it afterward with something like utf8_decode(), iconv(), or mb_convert_encoding(). <br><br>If you're producing XML, which doesn't recognise most HTML entities:<br><br>When producing a UTF-8 document (the default), then htmlspecialchars(html_entity_decode($string, ENT_QUOTES, 'UTF-8'), ENT_NOQUOTES, 'UTF-8') (because you only need to escape &lt; and &gt; and &amp; unless you're printing inside the XML tags themselves).<br><br>Otherwise, either convert all the named entities to numeric ones, or declare the named entities in the document's DTD. The full list of 252 entities can be found in the HTML 4.01 Spec, or you can cut and paste the function from my site (<a rel="nofollow" target="_blank">http://inanimatt.com/php-convert-entities.php</a>).</span>
</code></div>
  </div>
 </div>
  <div class="note" id="89483">  
  <a class="name">
  <strong class="user"><em>marion at figmentthinking dot com</em></strong></a><div class="date" title="2009-03-10 05:11"><strong>5 years ago</strong></div>
  <div class="text" id="Hcom89483">
<div class="phpcode"><code><span class="html">
I just ran into the:
<br>Bug #27626 html_entity_decode bug - cannot yet handle MBCS in html_entity_decode()!
<br>
<br>The simple solution if you're still running PHP 4 is to wrap the html_entity_decode() function with the utf8_decode() function.
<br>
<br><span class="default">&lt;?php
<br>$string </span><span class="keyword">= </span><span class="string">'&amp;nbsp;'</span><span class="keyword">;
<br></span><span class="default">$utf8_encode </span><span class="keyword">= </span><span class="default">utf8_encode</span><span class="keyword">(</span><span class="default">html_entity_decode</span><span class="keyword">(</span><span class="default">$string</span><span class="keyword">));
<br></span><span class="default">?&gt;
<br></span>
<br>By default html_entity_decode() returns the ISO-8859-1 character set, and by default utf8_decode()...
<br>
<br><a rel="nofollow" target="_blank">http://us.php.net/manual/en/function.utf8-decode.php</a>
<br>"Converts a string with ISO-8859-1 characters encoded with UTF-8 to single-byte ISO-8859-1"</span>
</code></div>
  </div>
 </div>
  <div class="note" id="106871">  
  <a class="name">
  <strong class="user"><em>Victor</em></strong></a><div class="date" title="2011-12-14 06:22"><strong>2 years ago</strong></div>
  <div class="text" id="Hcom106871">
<div class="phpcode"><code><span class="html">
We were having very peculiar behavior regarding foreign characters such as e-acute.<br><br>However, it was only showing up as a problem when extracting those characters out of our mysql database and when being displayed through a proxy server of ours that handles dns issues.<br><br>As other users have made a note of, the default character setting wasn't what they were expecting it to be when they left theirs blank.<br><br>When we changed our default_charset to "UTF-8", our problems and needs for using functions like these were no longer necessary in handling foreign characters such as e-acute. Good enough for us!</span>
</code></div>
  </div>
 </div>
  <div class="note" id="83089">  
  <a class="name">
  <strong class="user"><em>kae at verens dot com</em></strong></a><div class="date" title="2008-05-09 06:11"><strong>6 years ago</strong></div>
  <div class="text" id="Hcom83089">
<div class="phpcode"><code><span class="html">
the references to 'chr()' in the example unhtmlentities() function should be changed to unichr, using the example unichr() function described in the 'chr' reference (<a rel="nofollow" target="_blank">http://php.net/chr</a>).<br><br>the reason for this is characters such as &amp;#x20AC; which do not break down into an ASCII number (that's the Euro, by the way).</span>
</code></div>
  </div>
 </div>
  <div class="note" id="89371">  
  <a class="name">
  <strong class="user"><em>jl dot garcia at gmail dot com</em></strong></a><div class="date" title="2009-03-04 03:33"><strong>5 years ago</strong></div>
  <div class="text" id="Hcom89371">
<div class="phpcode"><code><span class="html">
I created this function to filter all the text that goes in or comes out of the database.
<br>
<br><span class="default">&lt;?php
<br></span><span class="keyword">function </span><span class="default">filter_string</span><span class="keyword">(</span><span class="default">$string</span><span class="keyword">, </span><span class="default">$nohtml</span><span class="keyword">=</span><span class="string">''</span><span class="keyword">, </span><span class="default">$save</span><span class="keyword">=</span><span class="string">''</span><span class="keyword">) {
<br>&nbsp; &nbsp; if(!empty(</span><span class="default">$nohtml</span><span class="keyword">)) {
<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$string </span><span class="keyword">= </span><span class="default">trim</span><span class="keyword">(</span><span class="default">$string</span><span class="keyword">);
<br>&nbsp; &nbsp; &nbsp; &nbsp; if(!empty(</span><span class="default">$save</span><span class="keyword">)) </span><span class="default">$string </span><span class="keyword">= </span><span class="default">htmlentities</span><span class="keyword">(</span><span class="default">trim</span><span class="keyword">(</span><span class="default">$string</span><span class="keyword">), </span><span class="default">ENT_QUOTES</span><span class="keyword">, </span><span class="string">'ISO-8859-15'</span><span class="keyword">);
<br>&nbsp; &nbsp; &nbsp; &nbsp; else </span><span class="default">$string </span><span class="keyword">= </span><span class="default">html_entity_decode</span><span class="keyword">(</span><span class="default">$string</span><span class="keyword">, </span><span class="default">ENT_QUOTES</span><span class="keyword">, </span><span class="string">'ISO-8859-15'</span><span class="keyword">);
<br>&nbsp; &nbsp; }
<br>&nbsp; &nbsp; if(!empty(</span><span class="default">$save</span><span class="keyword">)) </span><span class="default">$string </span><span class="keyword">= </span><span class="default">mysql_real_escape_string</span><span class="keyword">(</span><span class="default">$string</span><span class="keyword">);
<br>&nbsp; &nbsp; else </span><span class="default">$string </span><span class="keyword">= </span><span class="default">stripslashes</span><span class="keyword">(</span><span class="default">$string</span><span class="keyword">);
<br>&nbsp; &nbsp; return(</span><span class="default">$string</span><span class="keyword">);
<br>}
<br></span><span class="default">?&gt;</span>
</span>
</code></div>
  </div>
 </div>
  <div class="note" id="68491">  
  <a class="name">
  <strong class="user"><em>grvg (at) free (dot) fr</em></strong></a><div class="date" title="2006-07-29 09:44"><strong>8 years ago</strong></div>
  <div class="text" id="Hcom68491">
<div class="phpcode"><code><span class="html">
Here is the ultimate functions to convert HTML entities to UTF-8&nbsp;:
<br>The main function is&nbsp;htmlentities2utf8
<br>Others are helper functions
<br>
<br><span class="default">&lt;?php
<br></span><span class="keyword">function </span><span class="default">chr_utf8</span><span class="keyword">(</span><span class="default">$code</span><span class="keyword">)
<br>&nbsp; &nbsp; {
<br>&nbsp; &nbsp; &nbsp; &nbsp; if (</span><span class="default">$code </span><span class="keyword">&lt; </span><span class="default">0</span><span class="keyword">) return </span><span class="default">false</span><span class="keyword">;
<br>&nbsp; &nbsp; &nbsp; &nbsp; elseif (</span><span class="default">$code </span><span class="keyword">&lt; </span><span class="default">128</span><span class="keyword">) return </span><span class="default">chr</span><span class="keyword">(</span><span class="default">$code</span><span class="keyword">);
<br>&nbsp; &nbsp; &nbsp; &nbsp; elseif (</span><span class="default">$code </span><span class="keyword">&lt; </span><span class="default">160</span><span class="keyword">) </span><span class="comment">// Remove Windows Illegals Cars
<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="keyword">{
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if (</span><span class="default">$code</span><span class="keyword">==</span><span class="default">128</span><span class="keyword">) </span><span class="default">$code</span><span class="keyword">=</span><span class="default">8364</span><span class="keyword">;
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; elseif (</span><span class="default">$code</span><span class="keyword">==</span><span class="default">129</span><span class="keyword">) </span><span class="default">$code</span><span class="keyword">=</span><span class="default">160</span><span class="keyword">; </span><span class="comment">// not affected
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="keyword">elseif (</span><span class="default">$code</span><span class="keyword">==</span><span class="default">130</span><span class="keyword">) </span><span class="default">$code</span><span class="keyword">=</span><span class="default">8218</span><span class="keyword">;
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; elseif (</span><span class="default">$code</span><span class="keyword">==</span><span class="default">131</span><span class="keyword">) </span><span class="default">$code</span><span class="keyword">=</span><span class="default">402</span><span class="keyword">;
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; elseif (</span><span class="default">$code</span><span class="keyword">==</span><span class="default">132</span><span class="keyword">) </span><span class="default">$code</span><span class="keyword">=</span><span class="default">8222</span><span class="keyword">;
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; elseif (</span><span class="default">$code</span><span class="keyword">==</span><span class="default">133</span><span class="keyword">) </span><span class="default">$code</span><span class="keyword">=</span><span class="default">8230</span><span class="keyword">;
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; elseif (</span><span class="default">$code</span><span class="keyword">==</span><span class="default">134</span><span class="keyword">) </span><span class="default">$code</span><span class="keyword">=</span><span class="default">8224</span><span class="keyword">;
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; elseif (</span><span class="default">$code</span><span class="keyword">==</span><span class="default">135</span><span class="keyword">) </span><span class="default">$code</span><span class="keyword">=</span><span class="default">8225</span><span class="keyword">;
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; elseif (</span><span class="default">$code</span><span class="keyword">==</span><span class="default">136</span><span class="keyword">) </span><span class="default">$code</span><span class="keyword">=</span><span class="default">710</span><span class="keyword">;
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; elseif (</span><span class="default">$code</span><span class="keyword">==</span><span class="default">137</span><span class="keyword">) </span><span class="default">$code</span><span class="keyword">=</span><span class="default">8240</span><span class="keyword">;
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; elseif (</span><span class="default">$code</span><span class="keyword">==</span><span class="default">138</span><span class="keyword">) </span><span class="default">$code</span><span class="keyword">=</span><span class="default">352</span><span class="keyword">;
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; elseif (</span><span class="default">$code</span><span class="keyword">==</span><span class="default">139</span><span class="keyword">) </span><span class="default">$code</span><span class="keyword">=</span><span class="default">8249</span><span class="keyword">;
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; elseif (</span><span class="default">$code</span><span class="keyword">==</span><span class="default">140</span><span class="keyword">) </span><span class="default">$code</span><span class="keyword">=</span><span class="default">338</span><span class="keyword">;
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; elseif (</span><span class="default">$code</span><span class="keyword">==</span><span class="default">141</span><span class="keyword">) </span><span class="default">$code</span><span class="keyword">=</span><span class="default">160</span><span class="keyword">; </span><span class="comment">// not affected
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="keyword">elseif (</span><span class="default">$code</span><span class="keyword">==</span><span class="default">142</span><span class="keyword">) </span><span class="default">$code</span><span class="keyword">=</span><span class="default">381</span><span class="keyword">;
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; elseif (</span><span class="default">$code</span><span class="keyword">==</span><span class="default">143</span><span class="keyword">) </span><span class="default">$code</span><span class="keyword">=</span><span class="default">160</span><span class="keyword">; </span><span class="comment">// not affected
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="keyword">elseif (</span><span class="default">$code</span><span class="keyword">==</span><span class="default">144</span><span class="keyword">) </span><span class="default">$code</span><span class="keyword">=</span><span class="default">160</span><span class="keyword">; </span><span class="comment">// not affected
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="keyword">elseif (</span><span class="default">$code</span><span class="keyword">==</span><span class="default">145</span><span class="keyword">) </span><span class="default">$code</span><span class="keyword">=</span><span class="default">8216</span><span class="keyword">;
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; elseif (</span><span class="default">$code</span><span class="keyword">==</span><span class="default">146</span><span class="keyword">) </span><span class="default">$code</span><span class="keyword">=</span><span class="default">8217</span><span class="keyword">;
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; elseif (</span><span class="default">$code</span><span class="keyword">==</span><span class="default">147</span><span class="keyword">) </span><span class="default">$code</span><span class="keyword">=</span><span class="default">8220</span><span class="keyword">;
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; elseif (</span><span class="default">$code</span><span class="keyword">==</span><span class="default">148</span><span class="keyword">) </span><span class="default">$code</span><span class="keyword">=</span><span class="default">8221</span><span class="keyword">;
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; elseif (</span><span class="default">$code</span><span class="keyword">==</span><span class="default">149</span><span class="keyword">) </span><span class="default">$code</span><span class="keyword">=</span><span class="default">8226</span><span class="keyword">;
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; elseif (</span><span class="default">$code</span><span class="keyword">==</span><span class="default">150</span><span class="keyword">) </span><span class="default">$code</span><span class="keyword">=</span><span class="default">8211</span><span class="keyword">;
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; elseif (</span><span class="default">$code</span><span class="keyword">==</span><span class="default">151</span><span class="keyword">) </span><span class="default">$code</span><span class="keyword">=</span><span class="default">8212</span><span class="keyword">;
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; elseif (</span><span class="default">$code</span><span class="keyword">==</span><span class="default">152</span><span class="keyword">) </span><span class="default">$code</span><span class="keyword">=</span><span class="default">732</span><span class="keyword">;
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; elseif (</span><span class="default">$code</span><span class="keyword">==</span><span class="default">153</span><span class="keyword">) </span><span class="default">$code</span><span class="keyword">=</span><span class="default">8482</span><span class="keyword">;
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; elseif (</span><span class="default">$code</span><span class="keyword">==</span><span class="default">154</span><span class="keyword">) </span><span class="default">$code</span><span class="keyword">=</span><span class="default">353</span><span class="keyword">;
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; elseif (</span><span class="default">$code</span><span class="keyword">==</span><span class="default">155</span><span class="keyword">) </span><span class="default">$code</span><span class="keyword">=</span><span class="default">8250</span><span class="keyword">;
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; elseif (</span><span class="default">$code</span><span class="keyword">==</span><span class="default">156</span><span class="keyword">) </span><span class="default">$code</span><span class="keyword">=</span><span class="default">339</span><span class="keyword">;
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; elseif (</span><span class="default">$code</span><span class="keyword">==</span><span class="default">157</span><span class="keyword">) </span><span class="default">$code</span><span class="keyword">=</span><span class="default">160</span><span class="keyword">; </span><span class="comment">// not affected
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="keyword">elseif (</span><span class="default">$code</span><span class="keyword">==</span><span class="default">158</span><span class="keyword">) </span><span class="default">$code</span><span class="keyword">=</span><span class="default">382</span><span class="keyword">;
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; elseif (</span><span class="default">$code</span><span class="keyword">==</span><span class="default">159</span><span class="keyword">) </span><span class="default">$code</span><span class="keyword">=</span><span class="default">376</span><span class="keyword">;
<br>&nbsp; &nbsp; &nbsp; &nbsp; }
<br>&nbsp; &nbsp; &nbsp; &nbsp; if (</span><span class="default">$code </span><span class="keyword">&lt; </span><span class="default">2048</span><span class="keyword">) return </span><span class="default">chr</span><span class="keyword">(</span><span class="default">192 </span><span class="keyword">| (</span><span class="default">$code </span><span class="keyword">&gt;&gt; </span><span class="default">6</span><span class="keyword">)) . </span><span class="default">chr</span><span class="keyword">(</span><span class="default">128 </span><span class="keyword">| (</span><span class="default">$code </span><span class="keyword">&amp; </span><span class="default">63</span><span class="keyword">));
<br>&nbsp; &nbsp; &nbsp; &nbsp; elseif (</span><span class="default">$code </span><span class="keyword">&lt; </span><span class="default">65536</span><span class="keyword">) return </span><span class="default">chr</span><span class="keyword">(</span><span class="default">224 </span><span class="keyword">| (</span><span class="default">$code </span><span class="keyword">&gt;&gt; </span><span class="default">12</span><span class="keyword">)) . </span><span class="default">chr</span><span class="keyword">(</span><span class="default">128 </span><span class="keyword">| ((</span><span class="default">$code </span><span class="keyword">&gt;&gt; </span><span class="default">6</span><span class="keyword">) &amp; </span><span class="default">63</span><span class="keyword">)) . </span><span class="default">chr</span><span class="keyword">(</span><span class="default">128 </span><span class="keyword">| (</span><span class="default">$code </span><span class="keyword">&amp; </span><span class="default">63</span><span class="keyword">));
<br>&nbsp; &nbsp; &nbsp; &nbsp; else return </span><span class="default">chr</span><span class="keyword">(</span><span class="default">240 </span><span class="keyword">| (</span><span class="default">$code </span><span class="keyword">&gt;&gt; </span><span class="default">18</span><span class="keyword">)) . </span><span class="default">chr</span><span class="keyword">(</span><span class="default">128 </span><span class="keyword">| ((</span><span class="default">$code </span><span class="keyword">&gt;&gt; </span><span class="default">12</span><span class="keyword">) &amp; </span><span class="default">63</span><span class="keyword">)) . </span><span class="default">chr</span><span class="keyword">(</span><span class="default">128 </span><span class="keyword">| ((</span><span class="default">$code </span><span class="keyword">&gt;&gt; </span><span class="default">6</span><span class="keyword">) &amp; </span><span class="default">63</span><span class="keyword">)) . </span><span class="default">chr</span><span class="keyword">(</span><span class="default">128 </span><span class="keyword">| (</span><span class="default">$code </span><span class="keyword">&amp; </span><span class="default">63</span><span class="keyword">));
<br>&nbsp; &nbsp; }
<br>
<br>&nbsp; &nbsp; </span><span class="comment">// Callback for preg_replace_callback('~&amp;(#(x?))?([^;]+);~', 'html_entity_replace', $str);
<br>&nbsp; &nbsp; </span><span class="keyword">function </span><span class="default">html_entity_replace</span><span class="keyword">(</span><span class="default">$matches</span><span class="keyword">)
<br>&nbsp; &nbsp; {
<br>&nbsp; &nbsp; &nbsp; &nbsp; if (</span><span class="default">$matches</span><span class="keyword">[</span><span class="default">2</span><span class="keyword">])
<br>&nbsp; &nbsp; &nbsp; &nbsp; {
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; return </span><span class="default">chr_utf8</span><span class="keyword">(</span><span class="default">hexdec</span><span class="keyword">(</span><span class="default">$matches</span><span class="keyword">[</span><span class="default">3</span><span class="keyword">]));
<br>&nbsp; &nbsp; &nbsp; &nbsp; } elseif (</span><span class="default">$matches</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">])
<br>&nbsp; &nbsp; &nbsp; &nbsp; {
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; return </span><span class="default">chr_utf8</span><span class="keyword">(</span><span class="default">$matches</span><span class="keyword">[</span><span class="default">3</span><span class="keyword">]);
<br>&nbsp; &nbsp; &nbsp; &nbsp; }
<br>&nbsp; &nbsp; &nbsp; &nbsp; switch (</span><span class="default">$matches</span><span class="keyword">[</span><span class="default">3</span><span class="keyword">])
<br>&nbsp; &nbsp; &nbsp; &nbsp; {
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; case </span><span class="string">"nbsp"</span><span class="keyword">: return </span><span class="default">chr_utf8</span><span class="keyword">(</span><span class="default">160</span><span class="keyword">);
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; case </span><span class="string">"iexcl"</span><span class="keyword">: return </span><span class="default">chr_utf8</span><span class="keyword">(</span><span class="default">161</span><span class="keyword">);
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; case </span><span class="string">"cent"</span><span class="keyword">: return </span><span class="default">chr_utf8</span><span class="keyword">(</span><span class="default">162</span><span class="keyword">);
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; case </span><span class="string">"pound"</span><span class="keyword">: return </span><span class="default">chr_utf8</span><span class="keyword">(</span><span class="default">163</span><span class="keyword">);
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; case </span><span class="string">"curren"</span><span class="keyword">: return </span><span class="default">chr_utf8</span><span class="keyword">(</span><span class="default">164</span><span class="keyword">);
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; case </span><span class="string">"yen"</span><span class="keyword">: return </span><span class="default">chr_utf8</span><span class="keyword">(</span><span class="default">165</span><span class="keyword">);
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="comment">//... etc with all named HTML entities
<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="keyword">}
<br>&nbsp; &nbsp; &nbsp; &nbsp; return </span><span class="default">false</span><span class="keyword">;
<br>&nbsp; &nbsp; }
<br>&nbsp; &nbsp; 
<br>&nbsp; &nbsp; function </span><span class="default">htmlentities2utf8 </span><span class="keyword">(</span><span class="default">$string</span><span class="keyword">) </span><span class="comment">// because of the html_entity_decode() bug with UTF-8
<br>&nbsp; &nbsp; </span><span class="keyword">{
<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$string </span><span class="keyword">= </span><span class="default">preg_replace_callback</span><span class="keyword">(</span><span class="string">'~&amp;(#(x?))?([^;]+);~'</span><span class="keyword">, </span><span class="string">'html_entity_replace'</span><span class="keyword">, </span><span class="default">$string</span><span class="keyword">);
<br>&nbsp; &nbsp; &nbsp; &nbsp; return </span><span class="default">$string</span><span class="keyword">;
<br>&nbsp; &nbsp; }
<br></span><span class="default">?&gt;</span>
</span>
</code></div>
  </div>
 </div></div>

 
</section>    </section><!-- layout-content -->
        


  </div><!-- layout -->
         
  

    
 <!-- External and third party libraries. -->
 







<a id="toTop" href="javascript:;"><span id="toTopHover"></span><img width="40" height="40" alt="To Top" src="../../images/to-top%402x.png"></a>



<!-- Mirrored from php.net/manual/en/function.html-entity-decode.php by HTTrack Website Copier/3.x [XR&CO'2013], Thu, 28 Aug 2014 16:04:57 GMT -->


</body></html>