<html><!-- Mirrored from php.net/manual/en/mysqlnd-ms.concept_cache.php by HTTrack Website Copier/3.x [XR&CO'2013], Thu, 28 Aug 2014 17:07:11 GMT --><!-- Added by HTTrack --><head><meta http-equiv="content-type" content="text/html;charset=utf-8"><!-- /Added by HTTrack -->


  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0"> 

  <title>Cache integration</title>

 <link rel="shortcut icon" href="../../favicon.ico">
 <link rel="search" type="application/opensearchdescription+xml" href="http://php.net/phpnetimprovedsearch.src" title="Add PHP.net search">
 <link rel="alternate" type="application/atom+xml" href="http://php.net/releases/feed.php" title="PHP Release feed">
 <link rel="alternate" type="application/atom+xml" href="http://php.net/feed.atom" title="PHP: Hypertext Preprocessor">

 <link rel="canonical" href="mysqlnd-ms.concept_cache.html">
 <link rel="shorturl" href="mysqlnd-ms.concept_cache.html">
 <link rel="alternate" href="mysqlnd-ms.concept_cache.html" hreflang="x-default">

 <link rel="contents" href="index-2.html">
 <link rel="index" href="mysqlnd-ms.concepts.html">
 <link rel="prev" href="mysqlnd-ms.gtid.html">
 <link rel="next" href="mysqlnd-ms.supportedclusters.html">

 <link rel="alternate" href="mysqlnd-ms.concept_cache.html" hreflang="en">
 <link rel="alternate" href="http://php.net/manual/pt_BR/mysqlnd-ms.concept_cache.php" hreflang="pt_BR">
 <link rel="alternate" href="http://php.net/manual/zh/mysqlnd-ms.concept_cache.php" hreflang="zh">
 <link rel="alternate" href="http://php.net/manual/fr/mysqlnd-ms.concept_cache.php" hreflang="fr">
 <link rel="alternate" href="http://php.net/manual/de/mysqlnd-ms.concept_cache.php" hreflang="de">
 <link rel="alternate" href="http://php.net/manual/it/mysqlnd-ms.concept_cache.php" hreflang="it">
 <link rel="alternate" href="http://php.net/manual/ja/mysqlnd-ms.concept_cache.php" hreflang="ja">
 <link rel="alternate" href="http://php.net/manual/ro/mysqlnd-ms.concept_cache.php" hreflang="ro">
 <link rel="alternate" href="http://php.net/manual/ru/mysqlnd-ms.concept_cache.php" hreflang="ru">
 <link rel="alternate" href="http://php.net/manual/es/mysqlnd-ms.concept_cache.php" hreflang="es">
 <link rel="alternate" href="http://php.net/manual/tr/mysqlnd-ms.concept_cache.php" hreflang="tr">

<link rel="stylesheet" type="text/css" href="../../cached8fe1.css?t=1401250819&amp;f=/fonts/Fira/fira.css" media="screen">
<link rel="stylesheet" type="text/css" href="../../cached4b8d.css?t=1404368420&amp;f=/fonts/Font-Awesome/css/fontello.css" media="screen">
<link rel="stylesheet" type="text/css" href="../../cached5065.css?t=1403329232&amp;f=/styles/theme-base.css" media="screen">
<link rel="stylesheet" type="text/css" href="../../cachedc78d.css?t=1401249623&amp;f=/styles/theme-medium.css" media="screen">

 <!--[if lte IE 7]>
 <link rel="stylesheet" type="text/css" href="http://php.net/styles/workarounds.ie7.css" media="screen">
 <![endif]-->

 <!--[if lte IE 8]>
 <script type="text/javascript">
  window.brokenIE = true;
 </script>
 <![endif]-->

 <!--[if lte IE 9]>
 <link rel="stylesheet" type="text/css" href="http://php.net/styles/workarounds.ie9.css" media="screen">
 <![endif]-->

 <!--[if IE]>
 <script type="text/javascript" src="http://php.net/js/ext/html5.js"></script>
 <![endif]-->

 <base>

</head>
<body class="docs " style="">


<div class="headsup"><a href="http://php.net/index.php#id2014-08-28-1">PHP 5.6.0 released</a></div>
<nav id="trick"><div><dl>
<dt><a href="getting-started.html">Getting Started</a></dt>
	<dd><a href="introduction.html">Introduction</a></dd>
	<dd><a href="tutorial.html">A simple tutorial</a></dd>
<dt><a href="langref.html">Language Reference</a></dt>
	<dd><a href="language.basic-syntax.html">Basic syntax</a></dd>
	<dd><a href="language.types.html">Types</a></dd>
	<dd><a href="language.variables.html">Variables</a></dd>
	<dd><a href="language.constants.html">Constants</a></dd>
	<dd><a href="language.expressions.html">Expressions</a></dd>
	<dd><a href="language.operators.html">Operators</a></dd>
	<dd><a href="language.control-structures.html">Control Structures</a></dd>
	<dd><a href="language.functions.html">Functions</a></dd>
	<dd><a href="language.oop5.html">Classes and Objects</a></dd>
	<dd><a href="language.namespaces.html">Namespaces</a></dd>
	<dd><a href="language.exceptions.html">Exceptions</a></dd>
	<dd><a href="language.generators.html">Generators</a></dd>
	<dd><a href="language.references.html">References Explained</a></dd>
	<dd><a href="reserved.variables.html">Predefined Variables</a></dd>
	<dd><a href="reserved.exceptions.html">Predefined Exceptions</a></dd>
	<dd><a href="reserved.interfaces.html">Predefined Interfaces and Classes</a></dd>
	<dd><a href="context.html">Context options and parameters</a></dd>
	<dd><a href="wrappers.html">Supported Protocols and Wrappers</a></dd>
</dl>
<dl>
<dt><a href="security.html">Security</a></dt>
	<dd><a href="security.intro.html">Introduction</a></dd>
	<dd><a href="security.general.html">General considerations</a></dd>
	<dd><a href="security.cgi-bin.html">Installed as CGI binary</a></dd>
	<dd><a href="security.apache.html">Installed as an Apache module</a></dd>
	<dd><a href="security.filesystem.html">Filesystem Security</a></dd>
	<dd><a href="security.database.html">Database Security</a></dd>
	<dd><a href="security.errors.html">Error Reporting</a></dd>
	<dd><a href="security.globals.html">Using Register Globals</a></dd>
	<dd><a href="security.variables.html">User Submitted Data</a></dd>
	<dd><a href="security.magicquotes.html">Magic Quotes</a></dd>
	<dd><a href="security.hiding.html">Hiding PHP</a></dd>
	<dd><a href="security.current.html">Keeping Current</a></dd>
<dt><a href="features.html">Features</a></dt>
	<dd><a href="features.http-auth.html">HTTP authentication with PHP</a></dd>
	<dd><a href="features.cookies.html">Cookies</a></dd>
	<dd><a href="features.sessions.html">Sessions</a></dd>
	<dd><a href="features.xforms.html">Dealing with XForms</a></dd>
	<dd><a href="features.file-upload.html">Handling file uploads</a></dd>
	<dd><a href="features.remote-files.html">Using remote files</a></dd>
	<dd><a href="features.connection-handling.html">Connection handling</a></dd>
	<dd><a href="features.persistent-connections.html">Persistent Database Connections</a></dd>
	<dd><a href="features.safe-mode.html">Safe Mode</a></dd>
	<dd><a href="features.commandline.html">Command line usage</a></dd>
	<dd><a href="features.gc.html">Garbage Collection</a></dd>
	<dd><a href="features.dtrace.html">DTrace Dynamic Tracing</a></dd>
</dl>
<dl>
<dt><a href="funcref.html">Function Reference</a></dt>
	<dd><a href="refs.basic.php.html">Affecting PHP's Behaviour</a></dd>
	<dd><a href="refs.utilspec.audio.html">Audio Formats Manipulation</a></dd>
	<dd><a href="refs.remote.auth.html">Authentication Services</a></dd>
	<dd><a href="refs.utilspec.cmdline.html">Command Line Specific Extensions</a></dd>
	<dd><a href="refs.compression.html">Compression and Archive Extensions</a></dd>
	<dd><a href="refs.creditcard.html">Credit Card Processing</a></dd>
	<dd><a href="refs.crypto.html">Cryptography Extensions</a></dd>
	<dd><a href="refs.database.html">Database Extensions</a></dd>
	<dd><a href="refs.calendar.html">Date and Time Related Extensions</a></dd>
	<dd><a href="refs.fileprocess.file.html">File System Related Extensions</a></dd>
	<dd><a href="refs.international.html">Human Language and Character Encoding Support</a></dd>
	<dd><a href="refs.utilspec.image.html">Image Processing and Generation</a></dd>
	<dd><a href="refs.remote.mail.html">Mail Related Extensions</a></dd>
	<dd><a href="refs.math.html">Mathematical Extensions</a></dd>
	<dd><a href="refs.utilspec.nontext.html">Non-Text MIME Output</a></dd>
	<dd><a href="refs.fileprocess.process.html">Process Control Extensions</a></dd>
	<dd><a href="refs.basic.other.html">Other Basic Extensions</a></dd>
	<dd><a href="refs.remote.other.html">Other Services</a></dd>
	<dd><a href="refs.search.html">Search Engine Extensions</a></dd>
	<dd><a href="refs.utilspec.server.html">Server Specific Extensions</a></dd>
	<dd><a href="refs.basic.session.html">Session Extensions</a></dd>
	<dd><a href="refs.basic.text.html">Text Processing</a></dd>
	<dd><a href="refs.basic.vartype.html">Variable and Type Related Extensions</a></dd>
	<dd><a href="refs.webservice.html">Web Services</a></dd>
	<dd><a href="refs.utilspec.windows.html">Windows Only Extensions</a></dd>
	<dd><a href="refs.xml.html">XML Manipulation</a></dd>
</dl>
<dl>
<dt>Keyboard Shortcuts</dt><dt>?</dt>
<dd>This help</dd>
<dt>j</dt>
<dd>Next menu item</dd>
<dt>k</dt>
<dd>Previous menu item</dd>
<dt>g p</dt>
<dd>Previous man page</dd>
<dt>g n</dt>
<dd>Next man page</dd>
<dt>G</dt>
<dd>Scroll to bottom</dd>
<dt>g g</dt>
<dd>Scroll to top</dd>
<dt>g h</dt>
<dd>Goto homepage</dd>
<dt>g s</dt>
<dd>Goto search<br>(current page)</dd>
<dt>/</dt>
<dd>Focus search box</dd>
</dl></div></nav>
<div id="goto">
    <div class="search">
         <div class="text"></div>
         <div class="results"><ul></ul></div>
   </div>
</div>

  <div id="breadcrumbs" class="row-fluid">
          
              
        <ul class="breadcrumbs-container">
            <li><a href="index-2.html">PHP Manual</a></li>      <li><a href="funcref.html">Function Reference</a></li>      <li><a href="refs.database.html">Database Extensions</a></li>      <li><a href="refs.database.vendors.html">Vendor Specific Database Extensions</a></li>      <li><a href="set.mysqlinfo.html">MySQL</a></li>      <li><a href="book.mysqlnd-ms.html">mysqlnd_ms</a></li>      <li><a href="mysqlnd-ms.concepts.html">Concepts</a></li>    </ul>
  </div>




<div id="layout">
  <section id="layout-content">
  <div id="mysqlnd-ms.concept_cache" class="section">
  <h2 class="title">Cache integration</h2>
  <blockquote class="note"><p><strong class="note">Note</strong>: 
   <strong>Version requirement</strong><br>
   </p><p class="para">
    The feature requires use of <em>PECL/mysqlnd_ms</em> 1.3.0-beta or later,
    and <em>PECL/mysqlnd_qc</em> 1.1.0-alpha or newer.
    <em>PECL/mysqlnd_ms</em> must be
    compiled to support the feature. PHP 5.4.0 or newer is required.
   </p>
  <p></p></blockquote>
  <blockquote class="note"><p><strong class="note">Note</strong>: 
   <strong>Setup: extension load order</strong><br>
   </p><p class="para">
    <em>PECL/mysqlnd_ms</em> must be loaded before
    <em>PECL/mysqlnd_qc</em>, when using shared
    extensions.
   </p>
  <p></p></blockquote>
  <blockquote class="note"><p><strong class="note">Note</strong>: 
   <strong>Feature stability</strong><br>
   </p><p class="para">
    The cache integration is of beta quality.
   </p>
  <p></p></blockquote>
  <blockquote class="note"><p><strong class="note">Note</strong>: 
   <strong>Suitable MySQL clusters</strong><br>
   </p><p class="para">
    The feature is targeted for use with MySQL Replication (primary copy).
    Currently, no other kinds of MySQL clusters are supported. Users
    of such cluster must control PECL/mysqlnd_qc manually if they are
    interested in client-side query caching.
   </p>
  <p></p></blockquote>
  <p class="para">
   Support for MySQL replication clusters (asynchronous primary copy) is the
   main focus of <em>PECL/mysqlnd_ms</em>.
   The slaves of a MySQL replication cluster
   may or may not reflect the latest updates from the master.
   Slaves are asynchronous and can lag behind the master. A read from a slave
   is eventual consistent from a cluster-wide perspective.
  </p>
  <p class="para">
   The same level of consistency is offered by a local cache using time-to-live (TTL)
   invalidation strategy. Current data or stale data may be served. Eventually, data
   searched for in the cache is not available and the source of the cache needs to
   be accessed.
  </p>
  <p class="para">
   Given that both a MySQL Replication slave (asynchronous secondary) and a local
   TTL-driven cache deliver the same level of service it is possible to transparently
   replace a remote database access with a local cache access to gain better possibility.
  </p>
  <p class="para">
   As of <em>PECL/mysqlnd_ms</em> 1.3.0-beta the plugin is
   capable of transparently controlling  <em>PECL/mysqlnd_ms</em> 1.1.0-alpha
   or newer to cache a read-only query if explicitly allowed by setting an
   appropriate quality of service through <span class="function"><a href="function.mysqlnd-ms-set-qos.html" class="function">mysqlnd_ms_set_qos()</a></span>. P
   lease, see the
   <a href="mysqlnd-ms.quickstart.cache.html" class="link">quickstart</a> for a code example.
   Both plugins must be installed, <em>PECL/mysqlnd_ms</em>
   must be compiled to support the cache feature and PHP 5.4.0 or newer has to be used.
  </p>
  <p class="para">
   Applications have full control of cache usage and can request fresh data
   at any time, if need be. Thec ache usage can be enabled and disabled
   time during the execution of a script. The cache will be used
   if <span class="function"><a href="function.mysqlnd-ms-set-qos.html" class="function">mysqlnd_ms_set_qos()</a></span> sets the quality of service
   to eventual consistency and enables cache usage. Cache usage is disabled by
   requesting higher consistency levels, for example,
   session consistency (read your writes). Once the quality of service has been
   relaxed to eventual consistency the cache can be used again.
  </p>
  <p class="para">
   If caching is enabled for a read-only statement, <em>PECL/mysqlnd_ms</em> may inject
   <a href="mysqlnd-qc.quickstart.caching.html" class="link">SQL hints to control caching</a>
   by PECL/mysqlnd_qc. It may modify the SQL statement it got from the application.
   Subsequent SQL processors are supposed to ignore the SQL hints. A SQL hint is a
   SQL comment. Comments must not be ignored, for example, by the database server.
  </p>
  <p class="para">
   The TTL of a cache entry is computed on a per statement basis. Applications
   set an maximum age for the data they want to retrieve using
   <span class="function"><a href="function.mysqlnd-ms-set-qos.html" class="function">mysqlnd_ms_set_qos()</a></span>. The age sets an approximate upper limit
   of how many seconds the data returned may lag behind the master.
  </p>
  <p class="para">
   The following logic is used to compute the actual TTL if caching is enabled.
   The logic takes the estimated slave lag into account for choosing a TTL. If,
   for example, there are two slaves lagging 5 and 10 seconds behind and the maximum
   age allowed is 60 seconds, the TTL is set to 50 seconds. Please note, the
   age setting is no more than an estimated guess.
   </p><ul class="itemizedlist">
    <li class="listitem">
     <span class="simpara">
      Check whether the statement is read-only. If not, don't cache.
     </span>
    </li>
    <li class="listitem">
     <span class="simpara">
      If caching is enabled, check the slave lag of all configured slaves.
      Establish slave connections if none exist so far and lazy connections are
      used.
     </span>
    </li>
    <li class="listitem">
     <span class="simpara">
      Send <em>SHOW SLAVE STATUS</em> to all slaves. Do not wait
      for the first slave to reply before sending to the second slave. Clients
      often wait long for replies, thus we send out all requests in a burst before
      fetching in a second stage.
     </span>
    </li>
    <li class="listitem">
     <span class="simpara">
      Loop over all slaves. For every slave wait for its reply. Do not start
      checking another slave before the currently waited for slave has replied.
      Check for <em>Slave_IO_Running=Yes</em> and <em>Slave_SQL_Running=Yes</em>.
      If both conditions hold true, fetch the value of <em>Seconds_Behind_Master</em>.
      In case of any errors or if conditions fail, set an error on the slave connection.
      Skip any such slave connection for the rest of connection filtering.
     </span>
    </li>
    <li class="listitem">
     <span class="simpara">
      Search for the maximum value of <em>Seconds_Behind_Master</em> from
      all slaves that passed the previous conditions. Subtract the value from
      the maximum age provided by the user with <span class="function"><a href="function.mysqlnd-ms-set-qos.html" class="function">mysqlnd_ms_set_qos()</a></span>.
      Use the result as a TTL.
     </span>
    </li>
    <li class="listitem">
     <span class="simpara">
      The filtering may sort out all slaves. If so, the maximum age is used as
      TTL, because the maximum lag found equals zero. It is perfectly valid to
      sort out all slaves. In the following it is up to subsequent filter
      to decide what to do. The built-in load balancing filter will pick the
      master.
     </span>
    </li>
    <li class="listitem">
     <span class="simpara">
      Inject the appropriate SQL hints to enable caching by <em>PECL/mysqlnd_qc</em>.
     </span>
    </li>
    <li class="listitem">
     <span class="simpara">
      Proceed with the connection filtering, e.g. apply load balancing rules to
      pick a slave.
     </span>
    </li>
    <li class="listitem">
     <span class="simpara">
      <em>PECL/mysqlnd_qc</em> is loaded after
      <em>PECL/mysqlnd_ms</em> by PHP. Thus, it will see
      all query modifications of <em>PECL/mysqlnd_ms</em> and cache
      the query if instructed to do so.
     </span>
    </li>
   </ul>
  <p></p>
  <p class="para">
   The algorithm may seem expensive. <em>SHOW SLAVE STATUS</em> is a very
   fast operation. Given a sufficient number of requests and cache hits per second the cost of
   checking the slaves lag can easily outweight the costs of the cache decision.
  </p>
  <p class="para">
   Suggestions on a better algorithm are always welcome.
  </p>
 </div>
<section id="usernotes">
 <div class="head"><h3 class="title">User Contributed Notes</h3></div>
 <div class="note">There are no user contributed notes for this page.</div></section>    </section><!-- layout-content -->
        


  </div><!-- layout -->
         
  

    
 <!-- External and third party libraries. -->
 







<a id="toTop" href="javascript:;"><span id="toTopHover"></span><img width="40" height="40" alt="To Top" src="../../images/to-top%402x.png"></a>



<!-- Mirrored from php.net/manual/en/mysqlnd-ms.concept_cache.php by HTTrack Website Copier/3.x [XR&CO'2013], Thu, 28 Aug 2014 17:07:12 GMT -->


</body></html>