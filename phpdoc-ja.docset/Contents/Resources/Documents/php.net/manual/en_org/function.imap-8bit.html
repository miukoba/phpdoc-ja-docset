<html><!-- Mirrored from php.net/manual/en/function.imap-8bit.php by HTTrack Website Copier/3.x [XR&CO'2013], Thu, 28 Aug 2014 16:28:27 GMT --><!-- Added by HTTrack --><head><meta http-equiv="content-type" content="text/html;charset=utf-8"><!-- /Added by HTTrack -->


  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0"> 

  <title>imap_8bit</title>

 <link rel="shortcut icon" href="../../favicon.ico">
 <link rel="search" type="application/opensearchdescription+xml" href="http://php.net/phpnetimprovedsearch.src" title="Add PHP.net search">
 <link rel="alternate" type="application/atom+xml" href="http://php.net/releases/feed.php" title="PHP Release feed">
 <link rel="alternate" type="application/atom+xml" href="http://php.net/feed.atom" title="PHP: Hypertext Preprocessor">

 <link rel="canonical" href="function.imap-8bit.html">
 <link rel="shorturl" href="http://php.net/imap-8bit">
 <link rel="alternate" href="http://php.net/imap-8bit" hreflang="x-default">

 <link rel="contents" href="index-2.html">
 <link rel="index" href="ref.imap.html">
 <link rel="prev" href="ref.imap.html">
 <link rel="next" href="function.imap-alerts.html">

 <link rel="alternate" href="function.imap-8bit.html" hreflang="en">
 <link rel="alternate" href="http://php.net/manual/pt_BR/function.imap-8bit.php" hreflang="pt_BR">
 <link rel="alternate" href="http://php.net/manual/zh/function.imap-8bit.php" hreflang="zh">
 <link rel="alternate" href="http://php.net/manual/fr/function.imap-8bit.php" hreflang="fr">
 <link rel="alternate" href="http://php.net/manual/de/function.imap-8bit.php" hreflang="de">
 <link rel="alternate" href="http://php.net/manual/it/function.imap-8bit.php" hreflang="it">
 <link rel="alternate" href="http://php.net/manual/ja/function.imap-8bit.php" hreflang="ja">
 <link rel="alternate" href="http://php.net/manual/ro/function.imap-8bit.php" hreflang="ro">
 <link rel="alternate" href="http://php.net/manual/ru/function.imap-8bit.php" hreflang="ru">
 <link rel="alternate" href="http://php.net/manual/es/function.imap-8bit.php" hreflang="es">
 <link rel="alternate" href="http://php.net/manual/tr/function.imap-8bit.php" hreflang="tr">

<link rel="stylesheet" type="text/css" href="../../cached8fe1.css?t=1401250819&amp;f=/fonts/Fira/fira.css" media="screen">
<link rel="stylesheet" type="text/css" href="../../cached4b8d.css?t=1404368420&amp;f=/fonts/Font-Awesome/css/fontello.css" media="screen">
<link rel="stylesheet" type="text/css" href="../../cached5065.css?t=1403329232&amp;f=/styles/theme-base.css" media="screen">
<link rel="stylesheet" type="text/css" href="../../cachedc78d.css?t=1401249623&amp;f=/styles/theme-medium.css" media="screen">

 <!--[if lte IE 7]>
 <link rel="stylesheet" type="text/css" href="http://php.net/styles/workarounds.ie7.css" media="screen">
 <![endif]-->

 <!--[if lte IE 8]>
 <script type="text/javascript">
  window.brokenIE = true;
 </script>
 <![endif]-->

 <!--[if lte IE 9]>
 <link rel="stylesheet" type="text/css" href="http://php.net/styles/workarounds.ie9.css" media="screen">
 <![endif]-->

 <!--[if IE]>
 <script type="text/javascript" src="http://php.net/js/ext/html5.js"></script>
 <![endif]-->

 <base>

</head>
<body class="docs " style="">


<div class="headsup"><a href="http://php.net/index.php#id2014-08-28-1">PHP 5.6.0 released</a></div>
<nav id="trick"><div><dl>
<dt><a href="getting-started.html">Getting Started</a></dt>
	<dd><a href="introduction.html">Introduction</a></dd>
	<dd><a href="tutorial.html">A simple tutorial</a></dd>
<dt><a href="langref.html">Language Reference</a></dt>
	<dd><a href="language.basic-syntax.html">Basic syntax</a></dd>
	<dd><a href="language.types.html">Types</a></dd>
	<dd><a href="language.variables.html">Variables</a></dd>
	<dd><a href="language.constants.html">Constants</a></dd>
	<dd><a href="language.expressions.html">Expressions</a></dd>
	<dd><a href="language.operators.html">Operators</a></dd>
	<dd><a href="language.control-structures.html">Control Structures</a></dd>
	<dd><a href="language.functions.html">Functions</a></dd>
	<dd><a href="language.oop5.html">Classes and Objects</a></dd>
	<dd><a href="language.namespaces.html">Namespaces</a></dd>
	<dd><a href="language.exceptions.html">Exceptions</a></dd>
	<dd><a href="language.generators.html">Generators</a></dd>
	<dd><a href="language.references.html">References Explained</a></dd>
	<dd><a href="reserved.variables.html">Predefined Variables</a></dd>
	<dd><a href="reserved.exceptions.html">Predefined Exceptions</a></dd>
	<dd><a href="reserved.interfaces.html">Predefined Interfaces and Classes</a></dd>
	<dd><a href="context.html">Context options and parameters</a></dd>
	<dd><a href="wrappers.html">Supported Protocols and Wrappers</a></dd>
</dl>
<dl>
<dt><a href="security.html">Security</a></dt>
	<dd><a href="security.intro.html">Introduction</a></dd>
	<dd><a href="security.general.html">General considerations</a></dd>
	<dd><a href="security.cgi-bin.html">Installed as CGI binary</a></dd>
	<dd><a href="security.apache.html">Installed as an Apache module</a></dd>
	<dd><a href="security.filesystem.html">Filesystem Security</a></dd>
	<dd><a href="security.database.html">Database Security</a></dd>
	<dd><a href="security.errors.html">Error Reporting</a></dd>
	<dd><a href="security.globals.html">Using Register Globals</a></dd>
	<dd><a href="security.variables.html">User Submitted Data</a></dd>
	<dd><a href="security.magicquotes.html">Magic Quotes</a></dd>
	<dd><a href="security.hiding.html">Hiding PHP</a></dd>
	<dd><a href="security.current.html">Keeping Current</a></dd>
<dt><a href="features.html">Features</a></dt>
	<dd><a href="features.http-auth.html">HTTP authentication with PHP</a></dd>
	<dd><a href="features.cookies.html">Cookies</a></dd>
	<dd><a href="features.sessions.html">Sessions</a></dd>
	<dd><a href="features.xforms.html">Dealing with XForms</a></dd>
	<dd><a href="features.file-upload.html">Handling file uploads</a></dd>
	<dd><a href="features.remote-files.html">Using remote files</a></dd>
	<dd><a href="features.connection-handling.html">Connection handling</a></dd>
	<dd><a href="features.persistent-connections.html">Persistent Database Connections</a></dd>
	<dd><a href="features.safe-mode.html">Safe Mode</a></dd>
	<dd><a href="features.commandline.html">Command line usage</a></dd>
	<dd><a href="features.gc.html">Garbage Collection</a></dd>
	<dd><a href="features.dtrace.html">DTrace Dynamic Tracing</a></dd>
</dl>
<dl>
<dt><a href="funcref.html">Function Reference</a></dt>
	<dd><a href="refs.basic.php.html">Affecting PHP's Behaviour</a></dd>
	<dd><a href="refs.utilspec.audio.html">Audio Formats Manipulation</a></dd>
	<dd><a href="refs.remote.auth.html">Authentication Services</a></dd>
	<dd><a href="refs.utilspec.cmdline.html">Command Line Specific Extensions</a></dd>
	<dd><a href="refs.compression.html">Compression and Archive Extensions</a></dd>
	<dd><a href="refs.creditcard.html">Credit Card Processing</a></dd>
	<dd><a href="refs.crypto.html">Cryptography Extensions</a></dd>
	<dd><a href="refs.database.html">Database Extensions</a></dd>
	<dd><a href="refs.calendar.html">Date and Time Related Extensions</a></dd>
	<dd><a href="refs.fileprocess.file.html">File System Related Extensions</a></dd>
	<dd><a href="refs.international.html">Human Language and Character Encoding Support</a></dd>
	<dd><a href="refs.utilspec.image.html">Image Processing and Generation</a></dd>
	<dd><a href="refs.remote.mail.html">Mail Related Extensions</a></dd>
	<dd><a href="refs.math.html">Mathematical Extensions</a></dd>
	<dd><a href="refs.utilspec.nontext.html">Non-Text MIME Output</a></dd>
	<dd><a href="refs.fileprocess.process.html">Process Control Extensions</a></dd>
	<dd><a href="refs.basic.other.html">Other Basic Extensions</a></dd>
	<dd><a href="refs.remote.other.html">Other Services</a></dd>
	<dd><a href="refs.search.html">Search Engine Extensions</a></dd>
	<dd><a href="refs.utilspec.server.html">Server Specific Extensions</a></dd>
	<dd><a href="refs.basic.session.html">Session Extensions</a></dd>
	<dd><a href="refs.basic.text.html">Text Processing</a></dd>
	<dd><a href="refs.basic.vartype.html">Variable and Type Related Extensions</a></dd>
	<dd><a href="refs.webservice.html">Web Services</a></dd>
	<dd><a href="refs.utilspec.windows.html">Windows Only Extensions</a></dd>
	<dd><a href="refs.xml.html">XML Manipulation</a></dd>
</dl>
<dl>
<dt>Keyboard Shortcuts</dt><dt>?</dt>
<dd>This help</dd>
<dt>j</dt>
<dd>Next menu item</dd>
<dt>k</dt>
<dd>Previous menu item</dd>
<dt>g p</dt>
<dd>Previous man page</dd>
<dt>g n</dt>
<dd>Next man page</dd>
<dt>G</dt>
<dd>Scroll to bottom</dd>
<dt>g g</dt>
<dd>Scroll to top</dd>
<dt>g h</dt>
<dd>Goto homepage</dd>
<dt>g s</dt>
<dd>Goto search<br>(current page)</dd>
<dt>/</dt>
<dd>Focus search box</dd>
</dl></div></nav>
<div id="goto">
    <div class="search">
         <div class="text"></div>
         <div class="results"><ul></ul></div>
   </div>
</div>

  <div id="breadcrumbs" class="row-fluid">
          
              
        <ul class="breadcrumbs-container">
            <li><a href="index-2.html">PHP Manual</a></li>      <li><a href="funcref.html">Function Reference</a></li>      <li><a href="refs.remote.mail.html">Mail Related Extensions</a></li>      <li><a href="book.imap.html">IMAP</a></li>      <li><a href="ref.imap.html">IMAP Functions</a></li>    </ul>
  </div>




<div id="layout">
  <section id="layout-content">
  <div id="function.imap-8bit" class="refentry">
 <div class="refnamediv">
  <h1 class="refname">imap_8bit</h1>
  <p class="verinfo">(PHP 4, PHP 5)</p><p class="refpurpose"><span class="refname">imap_8bit</span> — <span class="dc-title">Convert an 8bit string to a quoted-printable string</span></p>

 </div>
 <div class="refsect1 description" id="refsect1-function.imap-8bit-description">
  <h3 class="title">Description</h3>
  <div class="methodsynopsis dc-description">
   <span class="type">string</span> <span class="methodname"><strong>imap_8bit</strong></span>
    ( <span class="methodparam"><span class="type">string</span> <code class="parameter">$string</code></span>
   )</div>

  <p class="para rdfs-comment">
   Convert an 8bit string to a quoted-printable string (according to
   <a href="http://www.faqs.org/rfcs/rfc2045" class="link external">»&nbsp;RFC2045</a>, section 6.7).
  </p>
 </div>

 <div class="refsect1 parameters" id="refsect1-function.imap-8bit-parameters">
  <h3 class="title">Parameters</h3>
  <p class="para">
   </p><dl>

    
     <dt>
<code class="parameter">string</code></dt>

     <dd>

      <p class="para">
       The 8bit string to convert
      </p>
     </dd>

    
   </dl>

  <p></p>
 </div>

 <div class="refsect1 returnvalues" id="refsect1-function.imap-8bit-returnvalues">
  <h3 class="title">Return Values</h3>
  <p class="para">
   Returns a quoted-printable string.
  </p>
 </div>

 <div class="refsect1 seealso" id="refsect1-function.imap-8bit-seealso">
  <h3 class="title">See Also</h3>
  <p class="para">
   </p><ul class="simplelist">
    <li class="member"><span class="function"><a href="function.imap-qprint.html" class="function" rel="rdfs-seeAlso">imap_qprint()</a> - Convert a quoted-printable string to an 8 bit string</span></li>
   </ul>
  <p></p>
 </div>

</div>
<section id="usernotes">
 <div class="head"><h3 class="title">User Contributed Notes</h3></div><div id="allnotes">
  <div class="note" id="8686">  
  <a class="name">
  <strong class="user"><em>zuffa at isdd dot sk</em></strong></a><div class="date" title="2000-09-23 08:57"><strong>13 years ago</strong></div>
  <div class="text" id="Hcom8686">
<div class="phpcode"><code><span class="html">
Warning !
<br>This function splits input text into
<br>several lines aligned to 75 characters.
<br>This is critical when you need input
<br>text to be only one striaght line as
<br>e.g. in e-mail header values.</span>
</code></div>
  </div>
 </div>
  <div class="note" id="61216">  
  <a class="name">
  <strong class="user"><em>umu</em></strong></a><div class="date" title="2006-01-28 05:58"><strong>8 years ago</strong></div>
  <div class="text" id="Hcom61216">
<div class="phpcode"><code><span class="html">
...deed.ztinmehc-ut.zrh@umuumu@hrz.tu-chemnitz.deed...<br><br>I use the following function instead of imap_8bit <br>when using PHP without the IMAP module, <br>which is based on code found in <br><a rel="nofollow" target="_blank">http://www.php.net/quoted_printable_decode,</a><br>and giving (supposedly) exactly the same results as imap_8bit,<br>(tested on thousands of random strings containing lots<br>of spaces, tabs, crlf, lfcr, lf, cr and so on,<br>no counterexample found SO FAR:)<br><br>AND you can force a trailing space to be encoded,<br>as opposed to what imap_8bit does,<br>which I consider is a violation of RFC2045,<br>(see <a rel="nofollow" target="_blank">http://bugs.php.net/bug.php?id=35290</a>) <br>by commenting that one central line.<br><br><span class="default">&lt;?php<br></span><span class="keyword">function </span><span class="default">quoted_printable_encode</span><span class="keyword">(</span><span class="default">$sText</span><span class="keyword">,</span><span class="default">$bEmulate_imap_8bit</span><span class="keyword">=</span><span class="default">true</span><span class="keyword">) {<br>&nbsp; </span><span class="comment">// split text into lines<br>&nbsp; </span><span class="default">$aLines</span><span class="keyword">=</span><span class="default">explode</span><span class="keyword">(</span><span class="default">chr</span><span class="keyword">(</span><span class="default">13</span><span class="keyword">).</span><span class="default">chr</span><span class="keyword">(</span><span class="default">10</span><span class="keyword">),</span><span class="default">$sText</span><span class="keyword">);<br><br>&nbsp; for (</span><span class="default">$i</span><span class="keyword">=</span><span class="default">0</span><span class="keyword">;</span><span class="default">$i</span><span class="keyword">&lt;</span><span class="default">count</span><span class="keyword">(</span><span class="default">$aLines</span><span class="keyword">);</span><span class="default">$i</span><span class="keyword">++) {<br>&nbsp; &nbsp; </span><span class="default">$sLine </span><span class="keyword">=&amp; </span><span class="default">$aLines</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">];<br>&nbsp; &nbsp; if (</span><span class="default">strlen</span><span class="keyword">(</span><span class="default">$sLine</span><span class="keyword">)===</span><span class="default">0</span><span class="keyword">) continue; </span><span class="comment">// do nothing, if empty<br><br>&nbsp; &nbsp; </span><span class="default">$sRegExp </span><span class="keyword">= </span><span class="string">'/[^\x09\x20\x21-\x3C\x3E-\x7E]/e'</span><span class="keyword">;<br><br>&nbsp; &nbsp; </span><span class="comment">// imap_8bit encodes x09 everywhere, not only at lineends,<br>&nbsp; &nbsp; // for EBCDIC safeness encode !"#$@[\]^`{|}~,<br>&nbsp; &nbsp; // for complete safeness encode every character :)<br>&nbsp; &nbsp; </span><span class="keyword">if (</span><span class="default">$bEmulate_imap_8bit</span><span class="keyword">)<br>&nbsp; &nbsp; &nbsp; </span><span class="default">$sRegExp </span><span class="keyword">= </span><span class="string">'/[^\x20\x21-\x3C\x3E-\x7E]/e'</span><span class="keyword">;<br><br>&nbsp; &nbsp; </span><span class="default">$sReplmt </span><span class="keyword">= </span><span class="string">'sprintf( "=%02X", ord ( "$0" ) ) ;'</span><span class="keyword">;<br>&nbsp; &nbsp; </span><span class="default">$sLine </span><span class="keyword">= </span><span class="default">preg_replace</span><span class="keyword">( </span><span class="default">$sRegExp</span><span class="keyword">, </span><span class="default">$sReplmt</span><span class="keyword">, </span><span class="default">$sLine </span><span class="keyword">);&nbsp; <br><br>&nbsp; &nbsp; </span><span class="comment">// encode x09,x20 at lineends<br>&nbsp; &nbsp; </span><span class="keyword">{<br>&nbsp; &nbsp; &nbsp; </span><span class="default">$iLength </span><span class="keyword">= </span><span class="default">strlen</span><span class="keyword">(</span><span class="default">$sLine</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; </span><span class="default">$iLastChar </span><span class="keyword">= </span><span class="default">ord</span><span class="keyword">(</span><span class="default">$sLine</span><span class="keyword">{</span><span class="default">$iLength</span><span class="keyword">-</span><span class="default">1</span><span class="keyword">});<br><br>&nbsp; &nbsp; &nbsp; </span><span class="comment">//&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; !!!!!!!!&nbsp; &nbsp; <br>&nbsp; &nbsp; &nbsp; // imap_8_bit does not encode x20 at the very end of a text,<br>&nbsp; &nbsp; &nbsp; // here is, where I don't agree with imap_8_bit, <br>&nbsp; &nbsp; &nbsp; // please correct me, if I'm wrong, <br>&nbsp; &nbsp; &nbsp; // or comment next line for RFC2045 conformance, if you like<br>&nbsp; &nbsp; &nbsp; </span><span class="keyword">if (!(</span><span class="default">$bEmulate_imap_8bit </span><span class="keyword">&amp;&amp; (</span><span class="default">$i</span><span class="keyword">==</span><span class="default">count</span><span class="keyword">(</span><span class="default">$aLines</span><span class="keyword">)-</span><span class="default">1</span><span class="keyword">)))<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br>&nbsp; &nbsp; &nbsp; if ((</span><span class="default">$iLastChar</span><span class="keyword">==</span><span class="default">0x09</span><span class="keyword">)||(</span><span class="default">$iLastChar</span><span class="keyword">==</span><span class="default">0x20</span><span class="keyword">)) {<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$sLine</span><span class="keyword">{</span><span class="default">$iLength</span><span class="keyword">-</span><span class="default">1</span><span class="keyword">}=</span><span class="string">'='</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$sLine </span><span class="keyword">.= (</span><span class="default">$iLastChar</span><span class="keyword">==</span><span class="default">0x09</span><span class="keyword">)?</span><span class="string">'09'</span><span class="keyword">:</span><span class="string">'20'</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; }<br>&nbsp; &nbsp; }&nbsp; &nbsp; </span><span class="comment">// imap_8bit encodes x20 before chr(13), too<br>&nbsp; &nbsp; // although IMHO not requested by RFC2045, why not do it safer :)<br>&nbsp; &nbsp; // and why not encode any x20 around chr(10) or chr(13)<br>&nbsp; &nbsp; </span><span class="keyword">if (</span><span class="default">$bEmulate_imap_8bit</span><span class="keyword">) {<br>&nbsp; &nbsp; &nbsp; </span><span class="default">$sLine</span><span class="keyword">=</span><span class="default">str_replace</span><span class="keyword">(</span><span class="string">' =0D'</span><span class="keyword">,</span><span class="string">'=20=0D'</span><span class="keyword">,</span><span class="default">$sLine</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; </span><span class="comment">//$sLine=str_replace(' =0A','=20=0A',$sLine);<br>&nbsp; &nbsp; &nbsp; //$sLine=str_replace('=0D ','=0D=20',$sLine);<br>&nbsp; &nbsp; &nbsp; //$sLine=str_replace('=0A ','=0A=20',$sLine);<br>&nbsp; &nbsp; </span><span class="keyword">}<br><br>&nbsp; &nbsp; </span><span class="comment">// finally split into softlines no longer than 76 chars,<br>&nbsp; &nbsp; // for even more safeness one could encode x09,x20 <br>&nbsp; &nbsp; // at the very first character of the line <br>&nbsp; &nbsp; // and after soft linebreaks, as well,<br>&nbsp; &nbsp; // but this wouldn't be caught by such an easy RegExp&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <br>&nbsp; &nbsp; </span><span class="default">preg_match_all</span><span class="keyword">( </span><span class="string">'/.{1,73}([^=]{0,2})?/'</span><span class="keyword">, </span><span class="default">$sLine</span><span class="keyword">, </span><span class="default">$aMatch </span><span class="keyword">);<br>&nbsp; &nbsp; </span><span class="default">$sLine </span><span class="keyword">= </span><span class="default">implode</span><span class="keyword">( </span><span class="string">'=' </span><span class="keyword">. </span><span class="default">chr</span><span class="keyword">(</span><span class="default">13</span><span class="keyword">).</span><span class="default">chr</span><span class="keyword">(</span><span class="default">10</span><span class="keyword">), </span><span class="default">$aMatch</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">] ); </span><span class="comment">// add soft crlf's<br>&nbsp; </span><span class="keyword">}<br><br>&nbsp; </span><span class="comment">// join lines into text<br>&nbsp; </span><span class="keyword">return </span><span class="default">implode</span><span class="keyword">(</span><span class="default">chr</span><span class="keyword">(</span><span class="default">13</span><span class="keyword">).</span><span class="default">chr</span><span class="keyword">(</span><span class="default">10</span><span class="keyword">),</span><span class="default">$aLines</span><span class="keyword">);<br>}<br></span><span class="default">?&gt;</span>
</span>
</code></div>
  </div>
 </div>
  <div class="note" id="83985">  
  <a class="name">
  <strong class="user"><em>Anonymous</em></strong></a><div class="date" title="2008-06-22 05:25"><strong>6 years ago</strong></div>
  <div class="text" id="Hcom83985">
<div class="phpcode"><code><span class="html">
umu's code seems to work great. BUT if you are on a Unix system you should replace all chr(13).chr(10) with just chr(10)<br><br>Works for me anyway on php5.mail() -&gt; qmail@suse10.1 -&gt; outlook express</span>
</code></div>
  </div>
 </div>
  <div class="note" id="75081">  
  <a class="name">
  <strong class="user"><em>roman at REMOVETHIS dot teamnet dot com dot pl</em></strong></a><div class="date" title="2007-05-11 04:26"><strong>7 years ago</strong></div>
  <div class="text" id="Hcom75081">
<div class="phpcode"><code><span class="html">
Code based on k dot kozlowski at enter dot pl but for UTF-8<br>(the only problem i encounter is SUBJECT_ENCODED_TWICE on SPAM test with very long subject, but the same produce others MUA's)<br>&lt;?<br>function header_quoted_printable_encode($string, $encoding='UTF-8') {<br>&nbsp;&nbsp; <br>&nbsp; &nbsp; $string = str_replace(" ", "_", trim($string)) ;<br>&nbsp; &nbsp; // We need to delete "=\r\n" produced by imap_8bit() and replace '?'<br>&nbsp; &nbsp; $string = str_replace("?", "=3F", str_replace("=\r\n", "", imap_8bit($string))) ;<br>&nbsp; &nbsp; <br>&nbsp; &nbsp; // Now we split by \r\n - i'm not sure about how many chars (header name counts or not?)<br>&nbsp; &nbsp; $string = chunk_split($string, 73);<br>&nbsp; &nbsp; // We also have to remove last unneeded \r\n :<br>&nbsp; &nbsp; $string = substr($string, 0, strlen($string)-2);<br>&nbsp; &nbsp; // replace newlines with encoding text "=?UTF ..."<br>&nbsp; &nbsp; $string = str_replace("\r\n", "?=".HEAD_CRLF." =?".$encoding."?Q?", $string) ;<br>&nbsp; &nbsp; <br>&nbsp; &nbsp; return '=?'.$encoding.'?Q?'.$string.'?=';<br>}<br>?&gt;</span>
</code></div>
  </div>
 </div>
  <div class="note" id="57447">  
  <a class="name">
  <strong class="user"><em>hans at lintoo dot dk</em></strong></a><div class="date" title="2005-10-04 10:35"><strong>8 years ago</strong></div>
  <div class="text" id="Hcom57447">
<div class="phpcode"><code><span class="html">
I modified nick at plumdigitalmedia dot com's note so that it may support ISO-8859-1 encoded headers:<br><span class="default">&lt;?php<br>&nbsp; &nbsp; </span><span class="keyword">public function </span><span class="default">encodeSubject</span><span class="keyword">(</span><span class="default">$string</span><span class="keyword">,</span><span class="default">$prefix</span><span class="keyword">=</span><span class="string">"=?ISO-8859-1?Q?"</span><span class="keyword">,</span><span class="default">$postfix</span><span class="keyword">=</span><span class="string">"?="</span><span class="keyword">)&nbsp; &nbsp; {<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$crlf&nbsp; &nbsp; </span><span class="keyword">= </span><span class="string">"\n\t"</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$string&nbsp; </span><span class="keyword">= </span><span class="default">preg_replace</span><span class="keyword">(</span><span class="string">'!(\r\n|\r|\n)!'</span><span class="keyword">, </span><span class="default">$crlf</span><span class="keyword">, </span><span class="default">$string</span><span class="keyword">) . </span><span class="default">$crlf </span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$f</span><span class="keyword">[]&nbsp; &nbsp; = </span><span class="string">'/([\000-\010\013\014\016-\037\075\177-\377])/e' </span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$r</span><span class="keyword">[]&nbsp; &nbsp; = </span><span class="string">"'=' . sprintf('%02X', ord('\\1'))" </span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$f</span><span class="keyword">[]&nbsp; &nbsp; = </span><span class="string">'/([\011\040])' </span><span class="keyword">. </span><span class="default">$crlf </span><span class="keyword">. </span><span class="string">'/e' </span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$r</span><span class="keyword">[]&nbsp; &nbsp; = </span><span class="string">"'=' . sprintf('%02X', ord('\\1')) . '" </span><span class="keyword">. </span><span class="default">$crlf </span><span class="keyword">. </span><span class="string">"'" </span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$string&nbsp; </span><span class="keyword">= </span><span class="default">preg_replace</span><span class="keyword">(</span><span class="default">$f</span><span class="keyword">, </span><span class="default">$r</span><span class="keyword">, </span><span class="default">$string</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; return </span><span class="default">$prefix</span><span class="keyword">.</span><span class="default">trim</span><span class="keyword">(</span><span class="default">wordwrap</span><span class="keyword">(</span><span class="default">$string</span><span class="keyword">, </span><span class="default">70 </span><span class="keyword">- </span><span class="default">strlen</span><span class="keyword">(</span><span class="default">$prefix</span><span class="keyword">) - </span><span class="default">strlen</span><span class="keyword">(</span><span class="default">$postfix</span><span class="keyword">), </span><span class="string">' ' </span><span class="keyword">. </span><span class="default">$postfix </span><span class="keyword">. </span><span class="default">$crlf </span><span class="keyword">. </span><span class="default">$prefix</span><span class="keyword">, </span><span class="default">true</span><span class="keyword">)).</span><span class="default">$postfix</span><span class="keyword">;<br>&nbsp; &nbsp; }<br></span><span class="default">?&gt;<br></span>Regards, Hans @ <a rel="nofollow" target="_blank">http://lintoo.dk/</a></span>
</code></div>
  </div>
 </div>
  <div class="note" id="50937">  
  <a class="name">
  <strong class="user"><em>k dot kozlowski at enter dot pl</em></strong></a><div class="date" title="2005-03-14 06:50"><strong>9 years ago</strong></div>
  <div class="text" id="Hcom50937">
<div class="phpcode"><code><span class="html">
I had problems with encoding large subjects with polish characters. The problem was that imap_8bit() splits subject (on 75-th char) but when I add "=?ISO-8859-2?Q?" the header is too long.<br><br>This is a solution :<br><span class="default">&lt;?php<br>$subject </span><span class="keyword">= </span><span class="default">str_replace</span><span class="keyword">(</span><span class="string">" "</span><span class="keyword">, </span><span class="string">"_"</span><span class="keyword">, </span><span class="default">trim</span><span class="keyword">(</span><span class="default">$subject</span><span class="keyword">)) ;<br></span><span class="comment">// We need to delete "=\r\n" produced by imap_8bit() and replace '?'<br></span><span class="default">$subject </span><span class="keyword">= </span><span class="default">str_replace</span><span class="keyword">(</span><span class="string">"?"</span><span class="keyword">, </span><span class="string">"=3F"</span><span class="keyword">, </span><span class="default">str_replace</span><span class="keyword">(</span><span class="string">"=\r\n"</span><span class="keyword">, </span><span class="string">""</span><span class="keyword">, </span><span class="default">imap_8bit</span><span class="keyword">(</span><span class="default">$subject</span><span class="keyword">))) ;<br></span><span class="comment">// Now we split by \r\n but with encoding text "=?ISO ..."<br></span><span class="default">$subject </span><span class="keyword">= </span><span class="default">str_replace</span><span class="keyword">(</span><span class="string">"\r\n"</span><span class="keyword">, </span><span class="string">"?=\r\n =?ISO-8859-2?Q?"</span><span class="keyword">, </span><span class="default">chunk_split</span><span class="keyword">(</span><span class="default">$subject</span><span class="keyword">, </span><span class="default">55</span><span class="keyword">)) ;<br></span><span class="comment">// We also have to remove last unneeded encoding text :<br></span><span class="default">$subject </span><span class="keyword">= </span><span class="string">"=?ISO-8859-2?Q?" </span><span class="keyword">. </span><span class="default">substr</span><span class="keyword">(</span><span class="default">$subject</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">strlen</span><span class="keyword">(</span><span class="default">$subject</span><span class="keyword">)-</span><span class="default">20</span><span class="keyword">) . </span><span class="string">"?=" </span><span class="keyword">;<br></span><span class="default">?&gt;</span>
</span>
</code></div>
  </div>
 </div>
  <div class="note" id="104380">  
  <a class="name">
  <strong class="user"><em>Michael Konecny</em></strong></a><div class="date" title="2011-06-12 09:57"><strong>3 years ago</strong></div>
  <div class="text" id="Hcom104380">
<div class="phpcode"><code><span class="html">
There is a bug in MS Exchange server, that improperly handles CRLFs. Seems like it converts both CR and LF into LF, so, instead of getting just a new line, you get TWO new lines.<br>The header information is then improperly parsed by the e-mail client, and is usually viewed in the message body.<br><br>This can make custom-created headers unusable.<br><br>The only way I found to get around this is to go against RFC rules for header formatting, and use only \n for new lines.<br><br>Unfortunately I haven't been able to learn the version of Exchange server where this happened, but I have the feeling that it's not just the one I was unlucky to encounter.<br><br>Hope this helps someone.</span>
</code></div>
  </div>
 </div>
  <div class="note" id="93323">  
  <a class="name">
  <strong class="user"><em>esh dot software at energiash dot com</em></strong></a><div class="date" title="2009-09-02 06:45"><strong>4 years ago</strong></div>
  <div class="text" id="Hcom93323">
<div class="phpcode"><code><span class="html">
When producing quoted printable emails this is the right way<br><br>$subject="Subject: =?iso-8859-1?Q?". imap_8bit("áéíóú"). "?="; <br><br>and the following would do the wrong thing, because qprint over "=ED" would produce 8bit data ( í ):<br><br>$subject="Subject: =?iso-8859-1?Q?". imap_qprint("=ED"). "?=";</span>
</code></div>
  </div>
 </div>
  <div class="note" id="56787">  
  <a class="name">
  <strong class="user"><em>marco dot manngatter at ecg-leipzig dot de</em></strong></a><div class="date" title="2005-09-15 03:43"><strong>8 years ago</strong></div>
  <div class="text" id="Hcom56787">
<div class="phpcode"><code><span class="html">
you can use the following to make a larger subject.<br>use the imap_qprint() function, to convert your subject.<br><br>example:<br><span class="default">&lt;?php<br><br>$subject </span><span class="keyword">.= </span><span class="string">"=?iso-8859-1?Q?" </span><span class="keyword">. </span><span class="default">imap_qprint</span><span class="keyword">(</span><span class="default">$subject</span><span class="keyword">) . </span><span class="string">"?="</span><span class="keyword">;<br><br></span><span class="default">?&gt;</span>
</span>
</code></div>
  </div>
 </div>
  <div class="note" id="52706">  
  <a class="name">
  <strong class="user"><em>nick at plumdigitalmedia dot com</em></strong></a><div class="date" title="2005-05-10 08:15"><strong>9 years ago</strong></div>
  <div class="text" id="Hcom52706">
<div class="phpcode"><code><span class="html">
This function appears to wrap lines in the middle of words, not just at whitespace, which upsets some versions of Outlook Express when used to format email body text. We've had more luck with this function:<br><br>&lt;?<br><br>&nbsp; &nbsp; function quoted_printable($string)<br>&nbsp; &nbsp; {<br>&nbsp; &nbsp; &nbsp; &nbsp; $crlf&nbsp; &nbsp; = "\n" ;<br>&nbsp; &nbsp; &nbsp; &nbsp; $string&nbsp; = preg_replace('!(\r\n|\r|\n)!', $crlf, $string) . $crlf ;<br>&nbsp; &nbsp; &nbsp; &nbsp; $f[]&nbsp; &nbsp;&nbsp; = '/([\000-\010\013\014\016-\037\075\177-\377])/e' ;<br>&nbsp; &nbsp; &nbsp; &nbsp; $r[]&nbsp; &nbsp;&nbsp; = "'=' . sprintf('%02X', ord('\\1'))" ;<br>&nbsp; &nbsp; &nbsp; &nbsp; $f[]&nbsp; &nbsp;&nbsp; = '/([\011\040])' . $crlf . '/e' ;<br>&nbsp; &nbsp; &nbsp; &nbsp; $r[]&nbsp; &nbsp;&nbsp; = "'=' . sprintf('%02X', ord('\\1')) . '" . $crlf . "'" ;<br>&nbsp; &nbsp; &nbsp; &nbsp; $string&nbsp; = preg_replace($f, $r, $string) ; <br>&nbsp; &nbsp; &nbsp; &nbsp; return trim(wordwrap($string, 70, ' =' . $crlf)) ;<br>&nbsp; &nbsp; }<br><br>?&gt;</span>
</code></div>
  </div>
 </div>
  <div class="note" id="43525">  
  <a class="name">
  <strong class="user"><em>rayFX</em></strong></a><div class="date" title="2004-06-24 09:14"><strong>10 years ago</strong></div>
  <div class="text" id="Hcom43525">
<div class="phpcode"><code><span class="html">
imap_8bit seems to have a bug as it doesn't encode "?".<br>Had a lot of trouble to encode a mail-subject with<br>german umlaute with an ending "?"...<br><br>Try this:<br><br>$subject = "=?iso-8859-1?Q?" . str_replace("?","=3F",imap_8bit($tsubject_to_encode)) . "?=";</span>
</code></div>
  </div>
 </div>
  <div class="note" id="38283">  
  <a class="name">
  <strong class="user"><em>MagicalTux at FF.ST</em></strong></a><div class="date" title="2003-12-15 06:50"><strong>10 years ago</strong></div>
  <div class="text" id="Hcom38283">
<div class="phpcode"><code><span class="html">
Reading Bully's note :<br>you can use the following to make a larger subject:<br>&lt;?<br>$encoded = str_replace("=\r\n","",imap_8bit($string_to_encode)); <br>?&gt;<br>It's wrong. The header MAY NOT go over 75 chars per line.<br><br>The right solution :<br>&lt;?<br>$encoded = rtrim( str_replace( "\n","\n\t", imap_8bit ($string_to_encode)))."\r\n";<br>?&gt;<br><br>It will add \t at the start of the encoded new lines.<br>Mailers to see the lines after Subject: as extensions of this header.</span>
</code></div>
  </div>
 </div>
  <div class="note" id="20977">  
  <a class="name">
  <strong class="user"><em>bully at newearth dot de</em></strong></a><div class="date" title="2002-04-24 07:48"><strong>12 years ago</strong></div>
  <div class="text" id="Hcom20977">
<div class="phpcode"><code><span class="html">
you can use the following to make a larger subject:<br><br>$encoded = str_replace("=\r\n","",imap_8bit($string_to_encode));</span>
</code></div>
  </div>
 </div>
  <div class="note" id="60002">  
  <a class="name">
  <strong class="user"><em>hans at lintoo dot dk</em></strong></a><div class="date" title="2005-12-22 06:05"><strong>8 years ago</strong></div>
  <div class="text" id="Hcom60002">
<div class="phpcode"><code><span class="html">
The code below this note gives a lot of trouple with SpamAssasin, to fix it you will need to encode your subject with something like this:<br><span class="default">&lt;?php<br></span><span class="comment">/**<br> * Function to encode a header if necessary<br> * according to RFC2047<br> */<br></span><span class="keyword">private function </span><span class="default">encodeHeader</span><span class="keyword">(</span><span class="default">$input</span><span class="keyword">, </span><span class="default">$charset </span><span class="keyword">= </span><span class="string">'ISO-8859-1'</span><span class="keyword">)<br>{<br>&nbsp; &nbsp; </span><span class="default">preg_match_all</span><span class="keyword">(</span><span class="string">'/(\s?\w*[\x80-\xFF]+\w*\s?)/'</span><span class="keyword">, </span><span class="default">$input</span><span class="keyword">, </span><span class="default">$matches</span><span class="keyword">);<br>&nbsp; &nbsp; foreach (</span><span class="default">$matches</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">] as </span><span class="default">$value</span><span class="keyword">) {<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$replacement </span><span class="keyword">= </span><span class="default">preg_replace</span><span class="keyword">(</span><span class="string">'/([\x20\x80-\xFF])/e'</span><span class="keyword">, </span><span class="string">'"=" . strtoupper(dechex(ord("\1")))'</span><span class="keyword">, </span><span class="default">$value</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$input </span><span class="keyword">= </span><span class="default">str_replace</span><span class="keyword">(</span><span class="default">$value</span><span class="keyword">, </span><span class="string">'=?' </span><span class="keyword">. </span><span class="default">$charset </span><span class="keyword">. </span><span class="string">'?Q?' </span><span class="keyword">. </span><span class="default">$replacement </span><span class="keyword">. </span><span class="string">'?='</span><span class="keyword">, </span><span class="default">$input</span><span class="keyword">);<br>&nbsp; &nbsp; }<br>&nbsp; &nbsp; <br>&nbsp; &nbsp; return </span><span class="default">wordwrap</span><span class="keyword">(</span><span class="default">$input</span><span class="keyword">,</span><span class="default">75</span><span class="keyword">,</span><span class="string">"\n\t"</span><span class="keyword">,</span><span class="default">true</span><span class="keyword">);<br>}<br></span><span class="default">?&gt;</span>
</span>
</code></div>
  </div>
 </div>
  <div class="note" id="27520">  
  <a class="name">
  <strong class="user"><em>php dot net at werner-ott dot de</em></strong></a><div class="date" title="2002-12-09 02:45"><strong>11 years ago</strong></div>
  <div class="text" id="Hcom27520">
<div class="phpcode"><code><span class="html">
A comment on the "split-after-75-characters" phenomenon:<br><br>By splitting lines up after 75 characters, the function's behaviour is complying to RFC2047 (<a rel="nofollow" target="_blank">http://www.ietf.org/rfc/rfc2047.txt</a>) (which specifies a protocol for the representation of non-ASCII text in message headers), section "2. Syntax of encoded-words".<br><br>A so called 'encoded word' has the following format:<br><br>&nbsp;&nbsp; encoded-word = "=?" charset "?" encoding "?" encoded-text "?="<br><br>An 'encoded-word' may not be more than 75 characters long, including 'charset', 'encoding', 'encoded-text', and delimiters.&nbsp; If it is desirable to encode more text than will fit in an 'encoded-word' of 75 characters, multiple 'encoded-word's (separated by CRLF SPACE) may be used.<br><br>hth<br>WOT</span>
</code></div>
  </div>
 </div></div>

 
</section>    </section><!-- layout-content -->
        


  </div><!-- layout -->
         
  

    
 <!-- External and third party libraries. -->
 







<a id="toTop" href="javascript:;"><span id="toTopHover"></span><img width="40" height="40" alt="To Top" src="../../images/to-top%402x.png"></a>



<!-- Mirrored from php.net/manual/en/function.imap-8bit.php by HTTrack Website Copier/3.x [XR&CO'2013], Thu, 28 Aug 2014 16:28:28 GMT -->


</body></html>