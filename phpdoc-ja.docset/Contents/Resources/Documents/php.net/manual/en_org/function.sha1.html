<html><!-- Mirrored from php.net/manual/en/function.sha1.php by HTTrack Website Copier/3.x [XR&CO'2013], Thu, 28 Aug 2014 15:54:54 GMT --><!-- Added by HTTrack --><head><meta http-equiv="content-type" content="text/html;charset=utf-8"><!-- /Added by HTTrack -->


  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0"> 

  <title>sha1</title>

 <link rel="shortcut icon" href="../../favicon.ico">
 <link rel="search" type="application/opensearchdescription+xml" href="http://php.net/phpnetimprovedsearch.src" title="Add PHP.net search">
 <link rel="alternate" type="application/atom+xml" href="http://php.net/releases/feed.php" title="PHP Release feed">
 <link rel="alternate" type="application/atom+xml" href="http://php.net/feed.atom" title="PHP: Hypertext Preprocessor">

 <link rel="canonical" href="function.sha1.html">
 <link rel="shorturl" href="http://php.net/sha1">
 <link rel="alternate" href="http://php.net/sha1" hreflang="x-default">

 <link rel="contents" href="index-2.html">
 <link rel="index" href="ref.strings.html">
 <link rel="prev" href="function.sha1-file.html">
 <link rel="next" href="function.similar-text.html">

 <link rel="alternate" href="function.sha1.html" hreflang="en">
 <link rel="alternate" href="http://php.net/manual/pt_BR/function.sha1.php" hreflang="pt_BR">
 <link rel="alternate" href="http://php.net/manual/zh/function.sha1.php" hreflang="zh">
 <link rel="alternate" href="http://php.net/manual/fr/function.sha1.php" hreflang="fr">
 <link rel="alternate" href="http://php.net/manual/de/function.sha1.php" hreflang="de">
 <link rel="alternate" href="http://php.net/manual/it/function.sha1.php" hreflang="it">
 <link rel="alternate" href="http://php.net/manual/ja/function.sha1.php" hreflang="ja">
 <link rel="alternate" href="http://php.net/manual/ro/function.sha1.php" hreflang="ro">
 <link rel="alternate" href="http://php.net/manual/ru/function.sha1.php" hreflang="ru">
 <link rel="alternate" href="http://php.net/manual/es/function.sha1.php" hreflang="es">
 <link rel="alternate" href="http://php.net/manual/tr/function.sha1.php" hreflang="tr">

<link rel="stylesheet" type="text/css" href="../../cached8fe1.css?t=1401250819&amp;f=/fonts/Fira/fira.css" media="screen">
<link rel="stylesheet" type="text/css" href="../../cached4b8d.css?t=1404368420&amp;f=/fonts/Font-Awesome/css/fontello.css" media="screen">
<link rel="stylesheet" type="text/css" href="../../cached5065.css?t=1403329232&amp;f=/styles/theme-base.css" media="screen">
<link rel="stylesheet" type="text/css" href="../../cachedc78d.css?t=1401249623&amp;f=/styles/theme-medium.css" media="screen">

 <!--[if lte IE 7]>
 <link rel="stylesheet" type="text/css" href="http://php.net/styles/workarounds.ie7.css" media="screen">
 <![endif]-->

 <!--[if lte IE 8]>
 <script type="text/javascript">
  window.brokenIE = true;
 </script>
 <![endif]-->

 <!--[if lte IE 9]>
 <link rel="stylesheet" type="text/css" href="http://php.net/styles/workarounds.ie9.css" media="screen">
 <![endif]-->

 <!--[if IE]>
 <script type="text/javascript" src="http://php.net/js/ext/html5.js"></script>
 <![endif]-->

 <base>

</head>
<body class="docs " style="">


<div class="headsup"><a href="http://php.net/index.php#id2014-08-28-1">PHP 5.6.0 released</a></div>
<nav id="trick"><div><dl>
<dt><a href="getting-started.html">Getting Started</a></dt>
	<dd><a href="introduction.html">Introduction</a></dd>
	<dd><a href="tutorial.html">A simple tutorial</a></dd>
<dt><a href="langref.html">Language Reference</a></dt>
	<dd><a href="language.basic-syntax.html">Basic syntax</a></dd>
	<dd><a href="language.types.html">Types</a></dd>
	<dd><a href="language.variables.html">Variables</a></dd>
	<dd><a href="language.constants.html">Constants</a></dd>
	<dd><a href="language.expressions.html">Expressions</a></dd>
	<dd><a href="language.operators.html">Operators</a></dd>
	<dd><a href="language.control-structures.html">Control Structures</a></dd>
	<dd><a href="language.functions.html">Functions</a></dd>
	<dd><a href="language.oop5.html">Classes and Objects</a></dd>
	<dd><a href="language.namespaces.html">Namespaces</a></dd>
	<dd><a href="language.exceptions.html">Exceptions</a></dd>
	<dd><a href="language.generators.html">Generators</a></dd>
	<dd><a href="language.references.html">References Explained</a></dd>
	<dd><a href="reserved.variables.html">Predefined Variables</a></dd>
	<dd><a href="reserved.exceptions.html">Predefined Exceptions</a></dd>
	<dd><a href="reserved.interfaces.html">Predefined Interfaces and Classes</a></dd>
	<dd><a href="context.html">Context options and parameters</a></dd>
	<dd><a href="wrappers.html">Supported Protocols and Wrappers</a></dd>
</dl>
<dl>
<dt><a href="security.html">Security</a></dt>
	<dd><a href="security.intro.html">Introduction</a></dd>
	<dd><a href="security.general.html">General considerations</a></dd>
	<dd><a href="security.cgi-bin.html">Installed as CGI binary</a></dd>
	<dd><a href="security.apache.html">Installed as an Apache module</a></dd>
	<dd><a href="security.filesystem.html">Filesystem Security</a></dd>
	<dd><a href="security.database.html">Database Security</a></dd>
	<dd><a href="security.errors.html">Error Reporting</a></dd>
	<dd><a href="security.globals.html">Using Register Globals</a></dd>
	<dd><a href="security.variables.html">User Submitted Data</a></dd>
	<dd><a href="security.magicquotes.html">Magic Quotes</a></dd>
	<dd><a href="security.hiding.html">Hiding PHP</a></dd>
	<dd><a href="security.current.html">Keeping Current</a></dd>
<dt><a href="features.html">Features</a></dt>
	<dd><a href="features.http-auth.html">HTTP authentication with PHP</a></dd>
	<dd><a href="features.cookies.html">Cookies</a></dd>
	<dd><a href="features.sessions.html">Sessions</a></dd>
	<dd><a href="features.xforms.html">Dealing with XForms</a></dd>
	<dd><a href="features.file-upload.html">Handling file uploads</a></dd>
	<dd><a href="features.remote-files.html">Using remote files</a></dd>
	<dd><a href="features.connection-handling.html">Connection handling</a></dd>
	<dd><a href="features.persistent-connections.html">Persistent Database Connections</a></dd>
	<dd><a href="features.safe-mode.html">Safe Mode</a></dd>
	<dd><a href="features.commandline.html">Command line usage</a></dd>
	<dd><a href="features.gc.html">Garbage Collection</a></dd>
	<dd><a href="features.dtrace.html">DTrace Dynamic Tracing</a></dd>
</dl>
<dl>
<dt><a href="funcref.html">Function Reference</a></dt>
	<dd><a href="refs.basic.php.html">Affecting PHP's Behaviour</a></dd>
	<dd><a href="refs.utilspec.audio.html">Audio Formats Manipulation</a></dd>
	<dd><a href="refs.remote.auth.html">Authentication Services</a></dd>
	<dd><a href="refs.utilspec.cmdline.html">Command Line Specific Extensions</a></dd>
	<dd><a href="refs.compression.html">Compression and Archive Extensions</a></dd>
	<dd><a href="refs.creditcard.html">Credit Card Processing</a></dd>
	<dd><a href="refs.crypto.html">Cryptography Extensions</a></dd>
	<dd><a href="refs.database.html">Database Extensions</a></dd>
	<dd><a href="refs.calendar.html">Date and Time Related Extensions</a></dd>
	<dd><a href="refs.fileprocess.file.html">File System Related Extensions</a></dd>
	<dd><a href="refs.international.html">Human Language and Character Encoding Support</a></dd>
	<dd><a href="refs.utilspec.image.html">Image Processing and Generation</a></dd>
	<dd><a href="refs.remote.mail.html">Mail Related Extensions</a></dd>
	<dd><a href="refs.math.html">Mathematical Extensions</a></dd>
	<dd><a href="refs.utilspec.nontext.html">Non-Text MIME Output</a></dd>
	<dd><a href="refs.fileprocess.process.html">Process Control Extensions</a></dd>
	<dd><a href="refs.basic.other.html">Other Basic Extensions</a></dd>
	<dd><a href="refs.remote.other.html">Other Services</a></dd>
	<dd><a href="refs.search.html">Search Engine Extensions</a></dd>
	<dd><a href="refs.utilspec.server.html">Server Specific Extensions</a></dd>
	<dd><a href="refs.basic.session.html">Session Extensions</a></dd>
	<dd><a href="refs.basic.text.html">Text Processing</a></dd>
	<dd><a href="refs.basic.vartype.html">Variable and Type Related Extensions</a></dd>
	<dd><a href="refs.webservice.html">Web Services</a></dd>
	<dd><a href="refs.utilspec.windows.html">Windows Only Extensions</a></dd>
	<dd><a href="refs.xml.html">XML Manipulation</a></dd>
</dl>
<dl>
<dt>Keyboard Shortcuts</dt><dt>?</dt>
<dd>This help</dd>
<dt>j</dt>
<dd>Next menu item</dd>
<dt>k</dt>
<dd>Previous menu item</dd>
<dt>g p</dt>
<dd>Previous man page</dd>
<dt>g n</dt>
<dd>Next man page</dd>
<dt>G</dt>
<dd>Scroll to bottom</dd>
<dt>g g</dt>
<dd>Scroll to top</dd>
<dt>g h</dt>
<dd>Goto homepage</dd>
<dt>g s</dt>
<dd>Goto search<br>(current page)</dd>
<dt>/</dt>
<dd>Focus search box</dd>
</dl></div></nav>
<div id="goto">
    <div class="search">
         <div class="text"></div>
         <div class="results"><ul></ul></div>
   </div>
</div>

  <div id="breadcrumbs" class="row-fluid">
          
              
        <ul class="breadcrumbs-container">
            <li><a href="index-2.html">PHP Manual</a></li>      <li><a href="funcref.html">Function Reference</a></li>      <li><a href="refs.basic.text.html">Text Processing</a></li>      <li><a href="book.strings.html">Strings</a></li>      <li><a href="ref.strings.html">String Functions</a></li>    </ul>
  </div>




<div id="layout">
  <section id="layout-content">
  <div id="function.sha1" class="refentry">
 <div class="refnamediv">
  <h1 class="refname">sha1</h1>
  <p class="verinfo">(PHP 4 &gt;= 4.3.0, PHP 5)</p><p class="refpurpose"><span class="refname">sha1</span> â€” <span class="dc-title">Calculate the sha1 hash of a string</span></p>

 </div>
 
 <div class="refsect1 description" id="refsect1-function.sha1-description">
  <h3 class="title">Description</h3>
  <div class="methodsynopsis dc-description">
   <span class="type">string</span> <span class="methodname"><strong>sha1</strong></span>
    ( <span class="methodparam"><span class="type">string</span> <code class="parameter">$str</code></span>
   [, <span class="methodparam"><span class="type">bool</span> <code class="parameter">$raw_output</code><span class="initializer"> = false</span></span>
  ] )</div>

  <p class="simpara">
   Calculates the sha1 hash of <code class="parameter">str</code> using the
   <a href="http://www.faqs.org/rfcs/rfc3174" class="link external">Â»&nbsp;US Secure Hash Algorithm 1</a>.
  </p>
 </div>


 <div class="refsect1 parameters" id="refsect1-function.sha1-parameters">
  <h3 class="title">Parameters</h3>
  <p class="para">
   </p><dl>

    
     <dt>
<code class="parameter">str</code></dt>

     <dd>

      <p class="para">
       The input string.
      </p>
     </dd>

    
    
     <dt>
<code class="parameter">raw_output</code></dt>

     <dd>

      <p class="para">
       If the optional <code class="parameter">raw_output</code> is set to <strong><code>TRUE</code></strong>,
       then the sha1 digest is instead returned in raw binary format with a
       length of 20, otherwise the returned value is a 40-character
       hexadecimal number.
      </p>
     </dd>

    
   </dl>

  <p></p>
 </div>


 <div class="refsect1 returnvalues" id="refsect1-function.sha1-returnvalues">
  <h3 class="title">Return Values</h3>
  <p class="para">
   Returns the sha1 hash as a string.
  </p>
 </div>


 <div class="refsect1 examples" id="refsect1-function.sha1-examples">
  <h3 class="title">Examples</h3>
  <p class="para">
   </p><div class="example" id="example-4978">
    <p><strong>Example #1 A <span class="function"><strong>sha1()</strong></span> example</strong></p>
    <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br>$str&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #DD0000">'apple'</span><span style="color: #007700">;<br><br>if&nbsp;(</span><span style="color: #0000BB">sha1</span><span style="color: #007700">(</span><span style="color: #0000BB">$str</span><span style="color: #007700">)&nbsp;===&nbsp;</span><span style="color: #DD0000">'d0be2dc421be4fcd0172e5afceea3970e2f3d940'</span><span style="color: #007700">)&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;echo&nbsp;</span><span style="color: #DD0000">"Would&nbsp;you&nbsp;like&nbsp;a&nbsp;green&nbsp;or&nbsp;red&nbsp;apple?"</span><span style="color: #007700">;<br>}<br></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
    </div>

   </div>
  <p></p>
 </div>

 
 <div class="refsect1 notes" id="refsect1-function.sha1-notes">
  <h3 class="title">Notes</h3>
  <blockquote class="note"><p><strong class="note">Note</strong>: 
 <strong>Secure password hashing</strong><br>
 </p><p class="para">
  It is not recommended to use this function to secure passwords, due to the fast nature of this hashing algorithm. See
  <a href="faq.passwords.html#faq.passwords.fasthash" class="link">here</a> for details.
 </p>
<p></p></blockquote>

 </div>


 <div class="refsect1 seealso" id="refsect1-function.sha1-seealso">
  <h3 class="title">See Also</h3>
  <p class="para">
   </p><ul class="simplelist">
    <li class="member"><span class="function"><a href="function.sha1-file.html" class="function" rel="rdfs-seeAlso">sha1_file()</a> - Calculate the sha1 hash of a file</span></li>
    <li class="member"><span class="function"><a href="function.crc32.html" class="function" rel="rdfs-seeAlso">crc32()</a> - Calculates the crc32 polynomial of a string</span></li>
    <li class="member"><span class="function"><a href="function.md5.html" class="function" rel="rdfs-seeAlso">md5()</a> - Calculate the md5 hash of a string</span></li>
    <li class="member"><span class="function"><a href="function.hash.html" class="function" rel="rdfs-seeAlso">hash()</a> - Generate a hash value (message digest)</span></li>
    <li class="member"><span class="function"><a href="function.crypt.html" class="function" rel="rdfs-seeAlso">crypt()</a> - One-way string hashing</span></li>
    <li class="member"><span class="function"><a href="function.password-hash.html" class="function" rel="rdfs-seeAlso">password_hash()</a> - Creates a password hash</span></li>
   </ul>
  <p></p>
 </div>


</div>
<section id="usernotes">
 <div class="head"><h3 class="title">User Contributed Notes</h3></div><div id="allnotes">
  <div class="note" id="81388">  
  <a class="name">
  <strong class="user"><em>nathan</em></strong></a><div class="date" title="2008-02-25 08:11"><strong>6 years ago</strong></div>
  <div class="text" id="Hcom81388">
<div class="phpcode"><code><span class="html">
The suggestion below to double-hash your password is not a good idea.&nbsp; You are much much better off adding a variable salt to passwords before hashing (such as the username or other field that is dissimilar for every account).<br><br>Double hashing is *worse* security than a regular hash.&nbsp; What you're actually doing is taking some input $passwd, converting it to a string of exactly 32 characters containing only the characters [0-9][A-F], and then hashing *that*. You have just *greatly* increased the odds of a hash collision (ie. the odds that I can guess a phrase that will hash to the same value as your password).<br><br>sha1(md5($pass)) makes even less sense, since you're feeding in 128-bits of information to generate a 256-bit hash, so 50% of the resulting data is redundant.&nbsp; You have not increased security at all.</span>
</code></div>
  </div>
 </div>
  <div class="note" id="66239">  
  <a class="name">
  <strong class="user"><em>erling dot westenvik at gmail dot com</em></strong></a><div class="date" title="2006-05-17 06:15"><strong>8 years ago</strong></div>
  <div class="text" id="Hcom66239">
<div class="phpcode"><code><span class="html">
Regarding php at REMOVEMEkennel17 dot co dot uk's note below:<br><br>The phrase: "To get the correct behaviour", would perhaps be better off if it read: "To get the wanted (but not recommended) behaviour".<br><br>Always honor the expected data types for functions: sha1 expects a string as input, and returns a string on exit. NULL, TRUE and FALSE are not string data types. The string "" is a string as good as "any". By following the "logic" that sha1("") should return "", then what should sha1("a") return? "b"? "c"?<br><br>An authentication system that allows for blank passwords is not really an authentication system in the first place. What you are describing is merely a way to tell the application that you want to see data in some specific context, like sorted by user name, etc. Create other tools for this purpose and leave the authentication system to deal with what it is supposed to do: Granting users access to restricted data and blocking other users from seeing the same data.<br><br>Don't store passwords in clear text, but salt and encrypt them. That way it makes perfect sense having <span class="default">&lt;?php $sStoredPwd </span><span class="keyword">=== </span><span class="default">sha1</span><span class="keyword">(</span><span class="default">$sStoredSalt </span><span class="keyword">. </span><span class="default">$_POST</span><span class="keyword">[</span><span class="string">"sTypedPwd"</span><span class="keyword">]); </span><span class="default">?&gt;</span>, even with a blank "password". No other person than the user itself, not even the programmer, should know the password or be able to guess it. If the user forgets the password, a new one must be generated.<br><br>Regards,<br>Erling</span>
</code></div>
  </div>
 </div>
  <div class="note" id="56503">  
  <a class="name">
  <strong class="user"><em>Dan</em></strong></a><div class="date" title="2005-09-05 10:12"><strong>8 years ago</strong></div>
  <div class="text" id="Hcom56503">
<div class="phpcode"><code><span class="html">
I've noticed websites are now starting to require passwords of a certain length that MUST contain at least 1 non-alphanumeric character. This in itself makes dictionary attacks kind of useless. My web site requires that as well. It uses md5, and appends a site code into the md5 as well. And the include file that contains that site key is outside the public folders. I sure hope I've done enough to keep the bad boys out.</span>
</code></div>
  </div>
 </div>
  <div class="note" id="47097">  
  <a class="name">
  <strong class="user"><em>rsemirag at yahoo dot com</em></strong></a><div class="date" title="2004-11-02 10:34"><strong>9 years ago</strong></div>
  <div class="text" id="Hcom47097">
<div class="phpcode"><code><span class="html">
If you're struggling to generate an SHA encoded password for LDAP (PHP &lt; 5.0), what you end up needing is this:<br><br>$userpassword = base64_encode(pack("H*", sha1($pass)));<br><br>I found this in the OpenLDAP FAQ (many thanks to Google and Ace), though I'm using the iPlanet LDAP server.<br><br>Ray Semiraglio</span>
</code></div>
  </div>
 </div>
  <div class="note" id="94326">  
  <a class="name">
  <strong class="user"><em>Anonymous</em></strong></a><div class="date" title="2009-10-28 05:48"><strong>4 years ago</strong></div>
  <div class="text" id="Hcom94326">
<div class="phpcode"><code><span class="html">
Another solution to the salted hash with salt included directly in the hash, while keeping the same length of the result. If you want to generate a hash, call the function without the second argument. If you want to check a password against a hash, use the hash as the second argument. In this case, the function returns the hash itself on success, or boolean false on failure. You can also specify a hash algorithm as the third argument (otherwise SHA-1 will be used).<br><br><span class="default">&lt;?php<br></span><span class="keyword">function </span><span class="default">__hash</span><span class="keyword">(</span><span class="default">$password</span><span class="keyword">, </span><span class="default">$obscured </span><span class="keyword">= </span><span class="default">NULL</span><span class="keyword">, </span><span class="default">$algorithm </span><span class="keyword">= </span><span class="string">"sha1"</span><span class="keyword">)<br>{<br>&nbsp; </span><span class="comment">// whether to use user specified algorithm<br>&nbsp; </span><span class="default">$mode </span><span class="keyword">= </span><span class="default">in_array</span><span class="keyword">(</span><span class="default">$algorithm</span><span class="keyword">, </span><span class="default">hash_algos</span><span class="keyword">());<br>&nbsp; </span><span class="comment">// generate random salt<br>&nbsp; </span><span class="default">$salt </span><span class="keyword">= </span><span class="default">uniqid</span><span class="keyword">(</span><span class="default">mt_rand</span><span class="keyword">(), </span><span class="default">true</span><span class="keyword">);<br>&nbsp; </span><span class="comment">// hash it<br>&nbsp; </span><span class="default">$salt </span><span class="keyword">= </span><span class="default">$mode </span><span class="keyword">? </span><span class="default">hash</span><span class="keyword">(</span><span class="default">$algorithm</span><span class="keyword">, </span><span class="default">$salt</span><span class="keyword">) : </span><span class="default">sha1</span><span class="keyword">(</span><span class="default">$salt</span><span class="keyword">);<br>&nbsp; </span><span class="comment">// get the length<br>&nbsp; </span><span class="default">$slen </span><span class="keyword">= </span><span class="default">strlen</span><span class="keyword">(</span><span class="default">$salt</span><span class="keyword">);<br>&nbsp; </span><span class="comment">// compute the actual length of salt we will use<br>&nbsp; // 1/8 to 1/4 of the hash, with shorter passwords producing longer salts<br>&nbsp; </span><span class="default">$slen </span><span class="keyword">= </span><span class="default">max</span><span class="keyword">(</span><span class="default">$slen </span><span class="keyword">&gt;&gt; </span><span class="default">3</span><span class="keyword">, (</span><span class="default">$slen </span><span class="keyword">&gt;&gt; </span><span class="default">2</span><span class="keyword">) - </span><span class="default">strlen</span><span class="keyword">(</span><span class="default">$password</span><span class="keyword">));<br>&nbsp; </span><span class="comment">// if we are checking password against a hash, harvest the actual salt from it, otherwise just cut the salt we already have to the proper size<br>&nbsp; </span><span class="default">$salt </span><span class="keyword">= </span><span class="default">$obscured </span><span class="keyword">? </span><span class="default">__harvest</span><span class="keyword">(</span><span class="default">$obscured</span><span class="keyword">, </span><span class="default">$slen</span><span class="keyword">, </span><span class="default">$password</span><span class="keyword">) : </span><span class="default">substr</span><span class="keyword">(</span><span class="default">$salt</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">$slen</span><span class="keyword">);<br>&nbsp; </span><span class="comment">// hash the password - this is maybe unnecessary<br>&nbsp; </span><span class="default">$hash </span><span class="keyword">= </span><span class="default">$mode </span><span class="keyword">? </span><span class="default">hash</span><span class="keyword">(</span><span class="default">$algorithm</span><span class="keyword">, </span><span class="default">$password</span><span class="keyword">) : </span><span class="default">sha1</span><span class="keyword">(</span><span class="default">$password</span><span class="keyword">);<br>&nbsp; </span><span class="comment">// place the salt in it<br>&nbsp; </span><span class="default">$hash </span><span class="keyword">= </span><span class="default">__scramble</span><span class="keyword">(</span><span class="default">$hash</span><span class="keyword">, </span><span class="default">$salt</span><span class="keyword">, </span><span class="default">$password</span><span class="keyword">);<br>&nbsp; </span><span class="comment">// and hash it again<br>&nbsp; </span><span class="default">$hash </span><span class="keyword">= </span><span class="default">$mode </span><span class="keyword">? </span><span class="default">hash</span><span class="keyword">(</span><span class="default">$algorithm</span><span class="keyword">, </span><span class="default">$hash</span><span class="keyword">) : </span><span class="default">sha1</span><span class="keyword">(</span><span class="default">$hash</span><span class="keyword">);<br>&nbsp; </span><span class="comment">// cut the result so we can add salt and maintain the same length<br>&nbsp; </span><span class="default">$hash </span><span class="keyword">= </span><span class="default">substr</span><span class="keyword">(</span><span class="default">$hash</span><span class="keyword">, </span><span class="default">$slen</span><span class="keyword">);<br>&nbsp; </span><span class="comment">// ... do that<br>&nbsp; </span><span class="default">$hash </span><span class="keyword">= </span><span class="default">__scramble</span><span class="keyword">(</span><span class="default">$hash</span><span class="keyword">, </span><span class="default">$salt</span><span class="keyword">, </span><span class="default">$password</span><span class="keyword">);<br>&nbsp; </span><span class="comment">// and return the result<br>&nbsp; </span><span class="keyword">return </span><span class="default">$obscured </span><span class="keyword">&amp;&amp; </span><span class="default">$obscured </span><span class="keyword">!== </span><span class="default">$hash </span><span class="keyword">? </span><span class="default">false </span><span class="keyword">: </span><span class="default">$hash</span><span class="keyword">;<br>}<br></span><span class="default">?&gt;<br></span><br>It uses a random, variable length salt, depending on the length of the password. The functions __scramble() and __harvest() are used to place salt into the hash or pull it out respectively. You can write your own, and of course the strength of the result greatly depends on them. They can be relatively simple yet still quite secure:<br><br><span class="default">&lt;?php<br></span><span class="keyword">function </span><span class="default">__scramble</span><span class="keyword">(</span><span class="default">$hash</span><span class="keyword">, </span><span class="default">$salt</span><span class="keyword">, </span><span class="default">$password</span><span class="keyword">)<br>{<br>&nbsp; return </span><span class="default">substr</span><span class="keyword">(</span><span class="default">$hash</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">strlen</span><span class="keyword">(</span><span class="default">$password</span><span class="keyword">)) . </span><span class="default">$salt </span><span class="keyword">. </span><span class="default">substr</span><span class="keyword">(</span><span class="default">$hash</span><span class="keyword">, </span><span class="default">strlen</span><span class="keyword">(</span><span class="default">$password</span><span class="keyword">));<br>}<br><br>function </span><span class="default">__harvest</span><span class="keyword">(</span><span class="default">$obscured</span><span class="keyword">, </span><span class="default">$slen</span><span class="keyword">, </span><span class="default">$password</span><span class="keyword">)<br>{<br>&nbsp; return </span><span class="default">substr</span><span class="keyword">(</span><span class="default">$obscured</span><span class="keyword">, </span><span class="default">min</span><span class="keyword">(</span><span class="default">strlen</span><span class="keyword">(</span><span class="default">$password</span><span class="keyword">), </span><span class="default">strlen</span><span class="keyword">(</span><span class="default">$obscured</span><span class="keyword">) - </span><span class="default">$slen</span><span class="keyword">), </span><span class="default">$slen</span><span class="keyword">);<br>}<br></span><span class="default">?&gt;<br></span><br>Or they can be ridiculously complicated (my favourite kind):<br><br><span class="default">&lt;?php<br></span><span class="keyword">function </span><span class="default">__scramble</span><span class="keyword">(</span><span class="default">$hash</span><span class="keyword">, </span><span class="default">$salt</span><span class="keyword">, </span><span class="default">$password</span><span class="keyword">)<br>{<br>&nbsp; </span><span class="default">$k </span><span class="keyword">= </span><span class="default">strlen</span><span class="keyword">(</span><span class="default">$password</span><span class="keyword">); </span><span class="default">$j </span><span class="keyword">= </span><span class="default">$k </span><span class="keyword">= </span><span class="default">$k </span><span class="keyword">&gt; </span><span class="default">0 </span><span class="keyword">? </span><span class="default">$k </span><span class="keyword">: </span><span class="default">1</span><span class="keyword">; </span><span class="default">$p </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">; </span><span class="default">$index </span><span class="keyword">= array(); </span><span class="default">$out </span><span class="keyword">= </span><span class="string">""</span><span class="keyword">; </span><span class="default">$m </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">;<br>&nbsp; for (</span><span class="default">$i </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">; </span><span class="default">$i </span><span class="keyword">&lt; </span><span class="default">strlen</span><span class="keyword">(</span><span class="default">$salt</span><span class="keyword">); </span><span class="default">$i</span><span class="keyword">++)<br>&nbsp; {<br>&nbsp; &nbsp; </span><span class="default">$c </span><span class="keyword">= </span><span class="default">substr</span><span class="keyword">(</span><span class="default">$password</span><span class="keyword">, </span><span class="default">$p</span><span class="keyword">, </span><span class="default">1</span><span class="keyword">);<br>&nbsp; &nbsp; </span><span class="default">$j </span><span class="keyword">= </span><span class="default">pow</span><span class="keyword">(</span><span class="default">$j </span><span class="keyword">+ (</span><span class="default">$c </span><span class="keyword">!== </span><span class="default">false </span><span class="keyword">? </span><span class="default">ord</span><span class="keyword">(</span><span class="default">$c</span><span class="keyword">) : </span><span class="default">0</span><span class="keyword">), </span><span class="default">2</span><span class="keyword">) % (</span><span class="default">strlen</span><span class="keyword">(</span><span class="default">$hash</span><span class="keyword">) + </span><span class="default">strlen</span><span class="keyword">(</span><span class="default">$salt</span><span class="keyword">));<br>&nbsp; &nbsp; while (</span><span class="default">array_key_exists</span><span class="keyword">(</span><span class="default">$j</span><span class="keyword">, </span><span class="default">$index</span><span class="keyword">))<br>&nbsp; &nbsp; &nbsp; </span><span class="default">$j </span><span class="keyword">= ++</span><span class="default">$j </span><span class="keyword">% (</span><span class="default">strlen</span><span class="keyword">(</span><span class="default">$hash</span><span class="keyword">) + </span><span class="default">strlen</span><span class="keyword">(</span><span class="default">$salt</span><span class="keyword">));<br>&nbsp; &nbsp; </span><span class="default">$index</span><span class="keyword">[</span><span class="default">$j</span><span class="keyword">] = </span><span class="default">$i</span><span class="keyword">;<br>&nbsp; &nbsp; </span><span class="default">$p </span><span class="keyword">= ++</span><span class="default">$p </span><span class="keyword">% </span><span class="default">$k</span><span class="keyword">;<br>&nbsp; }<br>&nbsp; for (</span><span class="default">$i </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">; </span><span class="default">$i </span><span class="keyword">&lt; </span><span class="default">strlen</span><span class="keyword">(</span><span class="default">$hash</span><span class="keyword">) + </span><span class="default">strlen</span><span class="keyword">(</span><span class="default">$salt</span><span class="keyword">); </span><span class="default">$i</span><span class="keyword">++)<br>&nbsp; &nbsp; </span><span class="default">$out </span><span class="keyword">.= </span><span class="default">array_key_exists</span><span class="keyword">(</span><span class="default">$i</span><span class="keyword">, </span><span class="default">$index</span><span class="keyword">) ? </span><span class="default">$salt</span><span class="keyword">[</span><span class="default">$index</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">]] : </span><span class="default">$hash</span><span class="keyword">[</span><span class="default">$m</span><span class="keyword">++];<br>&nbsp; return </span><span class="default">$out</span><span class="keyword">;<br>}<br><br>function </span><span class="default">__harvest</span><span class="keyword">(</span><span class="default">$obscured</span><span class="keyword">, </span><span class="default">$slen</span><span class="keyword">, </span><span class="default">$password</span><span class="keyword">)<br>{<br>&nbsp; </span><span class="default">$k </span><span class="keyword">= </span><span class="default">strlen</span><span class="keyword">(</span><span class="default">$password</span><span class="keyword">); </span><span class="default">$j </span><span class="keyword">= </span><span class="default">$k </span><span class="keyword">= </span><span class="default">$k </span><span class="keyword">&gt; </span><span class="default">0 </span><span class="keyword">? </span><span class="default">$k </span><span class="keyword">: </span><span class="default">1</span><span class="keyword">; </span><span class="default">$p </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">; </span><span class="default">$index </span><span class="keyword">= array(); </span><span class="default">$out </span><span class="keyword">= </span><span class="string">""</span><span class="keyword">;<br>&nbsp; for (</span><span class="default">$i </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">; </span><span class="default">$i </span><span class="keyword">&lt; </span><span class="default">$slen</span><span class="keyword">; </span><span class="default">$i</span><span class="keyword">++)<br>&nbsp; {<br>&nbsp; &nbsp; </span><span class="default">$c </span><span class="keyword">= </span><span class="default">substr</span><span class="keyword">(</span><span class="default">$password</span><span class="keyword">, </span><span class="default">$p</span><span class="keyword">, </span><span class="default">1</span><span class="keyword">);<br>&nbsp; &nbsp; </span><span class="default">$j </span><span class="keyword">= </span><span class="default">pow</span><span class="keyword">(</span><span class="default">$j </span><span class="keyword">+ (</span><span class="default">$c </span><span class="keyword">!== </span><span class="default">false </span><span class="keyword">? </span><span class="default">ord</span><span class="keyword">(</span><span class="default">$c</span><span class="keyword">) : </span><span class="default">0</span><span class="keyword">), </span><span class="default">2</span><span class="keyword">) % </span><span class="default">strlen</span><span class="keyword">(</span><span class="default">$obscured</span><span class="keyword">);<br>&nbsp; &nbsp; while (</span><span class="default">in_array</span><span class="keyword">(</span><span class="default">$j</span><span class="keyword">, </span><span class="default">$index</span><span class="keyword">))<br>&nbsp; &nbsp; &nbsp; </span><span class="default">$j </span><span class="keyword">= ++</span><span class="default">$j </span><span class="keyword">% </span><span class="default">strlen</span><span class="keyword">(</span><span class="default">$obscured</span><span class="keyword">);<br>&nbsp; &nbsp; </span><span class="default">$index</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">] = </span><span class="default">$j</span><span class="keyword">;<br>&nbsp; &nbsp; </span><span class="default">$p </span><span class="keyword">= ++</span><span class="default">$p </span><span class="keyword">% </span><span class="default">$k</span><span class="keyword">;<br>&nbsp; }<br>&nbsp; for (</span><span class="default">$i </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">; </span><span class="default">$i </span><span class="keyword">&lt; </span><span class="default">$slen</span><span class="keyword">; </span><span class="default">$i</span><span class="keyword">++)<br>&nbsp; &nbsp; </span><span class="default">$out </span><span class="keyword">.= </span><span class="default">$obscured</span><span class="keyword">[</span><span class="default">$index</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">]];<br>&nbsp; return </span><span class="default">$out</span><span class="keyword">;<br>}<br></span><span class="default">?&gt;</span>
</span>
</code></div>
  </div>
 </div>
  <div class="note" id="90301">  
  <a class="name">
  <strong class="user"><em>paul</em></strong></a><div class="date" title="2009-04-15 06:57"><strong>5 years ago</strong></div>
  <div class="text" id="Hcom90301">
<div class="phpcode"><code><span class="html">
I believe this offers best amount of protection using a random salt, that has to be stored so it can be used later for verification.
<br>
<br>If no salt is given (which can be retrieved by halving the output and taking the first half), then it will generate a random salt, hash it, place it in a position relative to the length of password (between 0 and length of hash type(sha1? md5?)) within the hashed password, and then hash the complete string.
<br>
<br>This results in a password hash using a salt that is dynamically placed dependant on password length. The salt used is then appended to the front of the finished hash so it can be retrieved later on for verifying.
<br>
<br>Seeing as users will choose a typical password of between 5 and say 15 characters long, this gives them an extra 10 times the amount of dictionary attacks to try out with the hash as it could be placed in any position, because this is a random generated salt too, it means at least 10 dictionary attacks (with possiblity of upto 40) for each instance a password is created, to try and work out your sha1 encrypted password.
<br>
<br>If you change your password say every month, even if someone gets a look in at your file through a local exploit, the amount of time to work out your password would far outweigh the frequency at which you change it.
<br>
<br>Nothing is secure, but this should take them longer to work out then the time you change it. That is at least by todays technologies.
<br>
<br>Paul
<br>
<br><span class="default">&lt;?php
<br>&nbsp; &nbsp; </span><span class="keyword">function </span><span class="default">createHash</span><span class="keyword">(</span><span class="default">$inText</span><span class="keyword">, </span><span class="default">$saltHash</span><span class="keyword">=</span><span class="default">NULL</span><span class="keyword">, </span><span class="default">$mode</span><span class="keyword">=</span><span class="string">'sha1'</span><span class="keyword">){
<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="comment">// hash the text //
<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$textHash </span><span class="keyword">= </span><span class="default">hash</span><span class="keyword">(</span><span class="default">$mode</span><span class="keyword">, </span><span class="default">$inText</span><span class="keyword">);
<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="comment">// set where salt will appear in hash //
<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$saltStart </span><span class="keyword">= </span><span class="default">strlen</span><span class="keyword">(</span><span class="default">$inText</span><span class="keyword">);
<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="comment">// if no salt given create random one //
<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="keyword">if(</span><span class="default">$saltHash </span><span class="keyword">== </span><span class="default">NULL</span><span class="keyword">) {
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$saltHash </span><span class="keyword">= </span><span class="default">hash</span><span class="keyword">(</span><span class="default">$mode</span><span class="keyword">, </span><span class="default">uniqid</span><span class="keyword">(</span><span class="default">rand</span><span class="keyword">(), </span><span class="default">true</span><span class="keyword">));
<br>&nbsp; &nbsp; &nbsp; &nbsp; }
<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="comment">// add salt into text hash at pass length position and hash it //
<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="keyword">if(</span><span class="default">$saltStart </span><span class="keyword">&gt; </span><span class="default">0 </span><span class="keyword">&amp;&amp; </span><span class="default">$saltStart </span><span class="keyword">&lt; </span><span class="default">strlen</span><span class="keyword">(</span><span class="default">$saltHash</span><span class="keyword">)) {
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$textHashStart </span><span class="keyword">= </span><span class="default">substr</span><span class="keyword">(</span><span class="default">$textHash</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">,</span><span class="default">$saltStart</span><span class="keyword">);
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$textHashEnd </span><span class="keyword">= </span><span class="default">substr</span><span class="keyword">(</span><span class="default">$textHash</span><span class="keyword">,</span><span class="default">$saltStart</span><span class="keyword">,</span><span class="default">strlen</span><span class="keyword">(</span><span class="default">$saltHash</span><span class="keyword">));
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$outHash </span><span class="keyword">= </span><span class="default">hash</span><span class="keyword">(</span><span class="default">$mode</span><span class="keyword">, </span><span class="default">$textHashEnd</span><span class="keyword">.</span><span class="default">$saltHash</span><span class="keyword">.</span><span class="default">$textHashStart</span><span class="keyword">); 
<br>&nbsp; &nbsp; &nbsp; &nbsp; } elseif(</span><span class="default">$saltStart </span><span class="keyword">&gt; (</span><span class="default">strlen</span><span class="keyword">(</span><span class="default">$saltHash</span><span class="keyword">)-</span><span class="default">1</span><span class="keyword">)) {
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$outHash </span><span class="keyword">= </span><span class="default">hash</span><span class="keyword">(</span><span class="default">$mode</span><span class="keyword">, </span><span class="default">$textHash</span><span class="keyword">.</span><span class="default">$saltHash</span><span class="keyword">);
<br>&nbsp; &nbsp; &nbsp; &nbsp; } else {
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$outHash </span><span class="keyword">= </span><span class="default">hash</span><span class="keyword">(</span><span class="default">$mode</span><span class="keyword">, </span><span class="default">$saltHash</span><span class="keyword">.</span><span class="default">$textHash</span><span class="keyword">);
<br>&nbsp; &nbsp; &nbsp; &nbsp; }
<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="comment">// put salt at front of hash //
<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$output </span><span class="keyword">= </span><span class="default">$saltHash</span><span class="keyword">.</span><span class="default">$outHash</span><span class="keyword">;
<br>&nbsp; &nbsp; &nbsp; &nbsp; return </span><span class="default">$output</span><span class="keyword">;
<br>&nbsp; &nbsp; }
<br></span><span class="default">?&gt;</span>
</span>
</code></div>
  </div>
 </div>
  <div class="note" id="109602">  
  <a class="name">
  <strong class="user"><em>php at wbhostmax dot de</em></strong></a><div class="date" title="2012-08-01 10:57"><strong>2 years ago</strong></div>
  <div class="text" id="Hcom109602">
<div class="phpcode"><code><span class="html">
<span class="default">&lt;?php<br></span><span class="keyword">function </span><span class="default">DoubleSaltedHash</span><span class="keyword">(</span><span class="default">$pw</span><span class="keyword">, </span><span class="default">$salt</span><span class="keyword">) {<br>&nbsp; &nbsp; return </span><span class="default">sha1</span><span class="keyword">(</span><span class="default">$salt</span><span class="keyword">.</span><span class="default">sha1</span><span class="keyword">(</span><span class="default">$salt</span><span class="keyword">.</span><span class="default">sha1</span><span class="keyword">(</span><span class="default">$pw</span><span class="keyword">)));<br>}<br><br>function </span><span class="default">generate_salt</span><span class="keyword">() {<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$dummy </span><span class="keyword">= </span><span class="default">array_merge</span><span class="keyword">(</span><span class="default">range</span><span class="keyword">(</span><span class="string">'0'</span><span class="keyword">, </span><span class="string">'9'</span><span class="keyword">));<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">mt_srand</span><span class="keyword">((double)</span><span class="default">microtime</span><span class="keyword">()*</span><span class="default">1000000</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; for (</span><span class="default">$i </span><span class="keyword">= </span><span class="default">1</span><span class="keyword">; </span><span class="default">$i </span><span class="keyword">&lt;= (</span><span class="default">count</span><span class="keyword">(</span><span class="default">$dummy</span><span class="keyword">)*</span><span class="default">2</span><span class="keyword">); </span><span class="default">$i</span><span class="keyword">++)<br>&nbsp; &nbsp; &nbsp; &nbsp; {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$swap </span><span class="keyword">= </span><span class="default">mt_rand</span><span class="keyword">(</span><span class="default">0</span><span class="keyword">,</span><span class="default">count</span><span class="keyword">(</span><span class="default">$dummy</span><span class="keyword">)-</span><span class="default">1</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$tmp </span><span class="keyword">= </span><span class="default">$dummy</span><span class="keyword">[</span><span class="default">$swap</span><span class="keyword">];<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$dummy</span><span class="keyword">[</span><span class="default">$swap</span><span class="keyword">] = </span><span class="default">$dummy</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">];<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$dummy</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">] = </span><span class="default">$tmp</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; }<br>&nbsp; &nbsp; &nbsp; &nbsp; return </span><span class="default">sha1</span><span class="keyword">(</span><span class="default">substr</span><span class="keyword">(</span><span class="default">implode</span><span class="keyword">(</span><span class="string">''</span><span class="keyword">,</span><span class="default">$dummy</span><span class="keyword">),</span><span class="default">0</span><span class="keyword">,</span><span class="default">9</span><span class="keyword">));<br>}<br></span><span class="default">$pw</span><span class="keyword">=</span><span class="string">"geheim"<br></span><span class="default">$salt</span><span class="keyword">=</span><span class="default">generate_salt</span><span class="keyword">();<br>echo </span><span class="string">"hash:"</span><span class="keyword">.</span><span class="default">DoubleSaltedHash</span><span class="keyword">(</span><span class="default">$pw</span><span class="keyword">, </span><span class="default">$salt</span><span class="keyword">);<br><br></span><span class="default">?&gt;<br></span><br>this is my way to crypt passwords</span>
</code></div>
  </div>
 </div>
  <div class="note" id="87692">  
  <a class="name">
  <strong class="user"><em>ranko84 at gmail dot com</em></strong></a><div class="date" title="2008-12-16 08:11"><strong>5 years ago</strong></div>
  <div class="text" id="Hcom87692">
<div class="phpcode"><code><span class="html">
Small update..., well more like fix to the obscure function, replace<br><span class="default">&lt;?php<br></span><span class="keyword">if (</span><span class="default">$keepLength </span><span class="keyword">!= </span><span class="default">NULL</span><span class="keyword">)<br>{<br>&nbsp; &nbsp; if (</span><span class="default">$hSLength </span><span class="keyword">!= </span><span class="default">0</span><span class="keyword">)<br>&nbsp; &nbsp; {<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$hPassHash </span><span class="keyword">= </span><span class="default">substr</span><span class="keyword">(</span><span class="default">$hPassHash</span><span class="keyword">, </span><span class="default">$hLPosition</span><span class="keyword">, -</span><span class="default">$hRPosition</span><span class="keyword">);<br>&nbsp; &nbsp; }<br>}<br></span><span class="default">?&gt;<br></span><br>with<br><br><span class="default">&lt;?php<br></span><span class="keyword">if (</span><span class="default">$keepLength </span><span class="keyword">!= </span><span class="default">NULL</span><span class="keyword">)<br>{<br>&nbsp; &nbsp; if (</span><span class="default">$hSLength </span><span class="keyword">!= </span><span class="default">0</span><span class="keyword">)<br>&nbsp; &nbsp; {<br>&nbsp; &nbsp; &nbsp; &nbsp; if (</span><span class="default">$hRPosition </span><span class="keyword">== </span><span class="default">0</span><span class="keyword">)<br>&nbsp; &nbsp; &nbsp; &nbsp; {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$hPassHash </span><span class="keyword">= </span><span class="default">substr</span><span class="keyword">(</span><span class="default">$hPassHash</span><span class="keyword">, </span><span class="default">$hLPosition</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; }<br>&nbsp; &nbsp; &nbsp; &nbsp; else<br>&nbsp; &nbsp; &nbsp; &nbsp; {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$hPassHash </span><span class="keyword">= </span><span class="default">substr</span><span class="keyword">(</span><span class="default">$hPassHash</span><span class="keyword">, </span><span class="default">$hLPosition</span><span class="keyword">, -</span><span class="default">$hRPosition</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; }<br>&nbsp; &nbsp; }<br>}<br></span><span class="default">?&gt;<br></span><br>I've been getting few requests to explain how it's used so, this might be little long.<br><br>Problems:<br>1. In most solutions with hash and salt, you were bound to have one extra row in your database that would state, preferably random, salt for that hashed data. If attacker would manage to get drop of your database he would get hashed data and salt that is used with plain data to make it obscure, and then cracking that hashed data would be same as if you didn't add any salt to it.<br>2. I stumbled upon some functions that would hash data, then input salt into random places in hash and store it in database, but they would still have to write down random parameter used to scramble salt so they could reuse it when validating data. Getting simple database drop wouldn't help much here, but if they would manage to get their hands on obscuring function too, they could easily see what is salt and what hash.<br><br>Solutions:<br>1. Why use extra row to store salt when you can input it in hash. I'm not sure how attackers determine what type of hash are they facing, but I guess it has connection to hash length. In that case, why make attackers job easier and store in database data_hash+salt where they could assume just by it's length it has salt in there.<br>Reason behind $keepLength. If it's set to 1, strlen of hashed data plus salt would be equal to strlen of hashed data leading attacker to believe there is no salt.<br>If you leave $keepLength on NULL, strlen of final result would be strlen(used_hash_algorithm)+$hSLength.<br>$minhPass is there to reserve enough place for string that has to be hashed, so someone using this function wouldn't accidentally delete it by setting too high salt length ($hSLength), for example... if you set it 30000 it will keep working normal.<br><br>2. If you think about it, constant, but variable value when making input would be same data that is being input.<br>In case we're trying to hash password, and have user A with password "notme", password strlen equals to 5, and if we use default parameters of the function, with $keepLength set to 1, process would be:<br>random salt, hash it, add first 5 characters of hashed_salt at beginning of plain password, add last 5 characters of hashed_salt at end of plain password, hash it. Replace first 5 characters of hashed_password with first 5 character of hashed_salt, do same with last 5 characters of hashed_password, return hashed_password.<br>In case that string is longer than 10 characters function would use simple mathematics to reduce it to numbers lower than 10, well... lower than number that is stated in $hSLength.<br>And good thing is that every time user enters correct password it has same length so it's not necessary to write it anywhere.<br><br>So what is achieved in the end?<br>1. Attacker might not know that hash is salted, and you don't have that extra row in your database stating THIS IS SALT FOR THIS HASH.<br>2. If he does find out that it is, he wouldn't know what is hashed password and what is salt.<br>3. If he manages to get access to obscure function, only thing that might help him is value of $hSLength, where if $hSLength is set to 10 he would have to crack 10 variations of hashed string since he doesn't know how long password of user he's trying to crack is.<br>For example first variation would be hashed_password without last 10 characters, second variation would be hashed_password without first character and last 9 characters...<br>4. Even in case he has enough power to crack all 10 variations, resulting string that he might get doesn't necessarily has to be exactly long as password of original user in which case, attacker fails again.</span>
</code></div>
  </div>
 </div>
  <div class="note" id="112844">  
  <a class="name">
  <strong class="user"><em>marcin at marcinwolny dot net</em></strong></a><div class="date" title="2013-07-29 03:32"><strong>1 year ago</strong></div>
  <div class="text" id="Hcom112844">
<div class="phpcode"><code><span class="html">
Keep in mind that MD5 is less secure than SHA1.<br>Older CPUs can calculate MD5 over twice as fast as SHA1. GPUs in parallel calculations can handle MD5 over 3 times as fast as SHA1!<br><br>Two Radeon 79xx-series GPUs can calculate a rainbow table for 6-character lowercase MD5 password in... roughly 6 seconds!<br><br>Source: <a rel="nofollow" target="_blank">http://www.codinghorror.com/blog/2012/04/speed-hashing.html</a></span>
</code></div>
  </div>
 </div>
  <div class="note" id="50169">  
  <a class="name">
  <strong class="user"><em>svn at datapirate dot de</em></strong></a><div class="date" title="2005-02-20 05:26"><strong>9 years ago</strong></div>
  <div class="text" id="Hcom50169">
<div class="phpcode"><code><span class="html">
Wanna use SHA-2 algorithm? Try this:<br><br>Download Tar-Ball from <a rel="nofollow" target="_blank">http://www.adg.us/computers/sha.html</a><br>Compile (may occur some warnings) and test it:<br><br>cc -O2 -DSHA2_UNROLL_TRANSFORM -Wall -o sha2 sha2prog.c sha2.c<br>./sha2test.pl<br><br>Copy it to /usr/local/bin/ (don't forget to check permissions)<br><br>Here are two functions that could be used with:<br><br>function sha2($bits, $string){<br>&nbsp; &nbsp; $sha2bin="/usr/local/bin/sha2";<br>&nbsp; &nbsp; $echocmd="echo";<br>&nbsp; &nbsp; if(!in_array($bits, array(256, 384, 512)))return(false);<br>&nbsp; &nbsp; $r=exec($echocmd." ".escapeshellarg($string)."|".$sha2bin." -q -".$bits, $sha2);<br>&nbsp; &nbsp; return($sha2[0]);<br>}<br><br>function sha2_file($bits, $filename){<br>&nbsp; &nbsp; $sha2bin="/usr/local/bin/sha2";<br>&nbsp; &nbsp; if(!in_array($bits, array(256, 384, 512)))return(false);<br>&nbsp; &nbsp; if(!file_exists($filename)||!is_readable($filename))return(false);<br>&nbsp; &nbsp; $r=exec($sha2bin." -q -".$bits." ".escapeshellarg($filename), $sha2);<br>&nbsp; &nbsp; return($sha2[0]);<br>}<br><br>and use it like below:<br><br><span class="default">&lt;?php<br>$str </span><span class="keyword">= </span><span class="string">'apple'</span><span class="keyword">;<br>if (</span><span class="default">sha2</span><span class="keyword">(</span><span class="default">256</span><span class="keyword">, </span><span class="default">$str</span><span class="keyword">) === </span><span class="string">'303980bcb9e9e6cdec515230791af8b0ab1aaa244b58a8d99152673aa22197d0'</span><span class="keyword">) {<br>&nbsp;&nbsp; echo </span><span class="string">"Would you like a green or red apple?"</span><span class="keyword">;<br>&nbsp;&nbsp; exit;<br>}<br></span><span class="default">?&gt;</span>
</span>
</code></div>
  </div>
 </div>
  <div class="note" id="103024">  
  <a class="name">
  <strong class="user"><em>mgcummings at yahoo dot com</em></strong></a><div class="date" title="2011-03-21 12:46"><strong>3 years ago</strong></div>
  <div class="text" id="Hcom103024">
<div class="phpcode"><code><span class="html">
Thought I might save someone else some time trying to figure out how to generate a hash like MySQL5 PASSWORD() makes using just PHP.<br><br>$hash = '*' . sha1(sha1($pass), TRUE));</span>
</code></div>
  </div>
 </div>
  <div class="note" id="31479">  
  <a class="name">
  <strong class="user"><em>bobm at hp dot com</em></strong></a><div class="date" title="2003-04-23 09:12"><strong>11 years ago</strong></div>
  <div class="text" id="Hcom31479">
<div class="phpcode"><code><span class="html">
To achieve raw binary format prior to PHP5, you can do this...<br><br>$raw = pack("H*", sha1($str));<br><br>Regards,<br><br>Bob Mader</span>
</code></div>
  </div>
 </div>
  <div class="note" id="55435">  
  <a class="name">
  <strong class="user"><em>WTM</em></strong></a><div class="date" title="2005-08-03 07:30"><strong>9 years ago</strong></div>
  <div class="text" id="Hcom55435">
<div class="phpcode"><code><span class="html">
Actually, the post by Helpful Harry won't improve your security except for the most simple break in attempts.&nbsp; Since the random seed is attached to the end of the password hash, if you steal the hashed password, you steal the seed.<br><br>That means you can write a simple php program to call the pw_check function Harry included from a loop, feeding it dictionary words or random characters.<br><br>Of course, if you modified the program to use the seed in a more complicated way, "they" would have to know the new function's operation.&nbsp; But then again, if someone can steal your password database, they can probably steal your website code (or guess it).</span>
</code></div>
  </div>
 </div>
  <div class="note" id="88057">  
  <a class="name">
  <strong class="user"><em>mVamer</em></strong></a><div class="date" title="2009-01-07 05:49"><strong>5 years ago</strong></div>
  <div class="text" id="Hcom88057">
<div class="phpcode"><code><span class="html">
If I correctly understand what ranko84 is on about, this would be a simpler function with roughly the same result.
<br>
<br><span class="default">&lt;?php
<br></span><span class="keyword">function </span><span class="default">obscure</span><span class="keyword">(</span><span class="default">$password</span><span class="keyword">, </span><span class="default">$algorythm </span><span class="keyword">= </span><span class="string">"sha1"</span><span class="keyword">)
<br>{
<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="comment">// Get some random salt, or verify a salt.
<br>&nbsp; &nbsp; &nbsp; &nbsp; // Added by (grosbedo AT gmail DOT com)
<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="keyword">if (</span><span class="default">$salt </span><span class="keyword">== </span><span class="default">NULL</span><span class="keyword">)
<br>&nbsp; &nbsp; &nbsp; &nbsp; {
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$salt </span><span class="keyword">= </span><span class="default">hash</span><span class="keyword">(</span><span class="default">$algorythm</span><span class="keyword">, </span><span class="default">uniqid</span><span class="keyword">(</span><span class="default">rand</span><span class="keyword">(), </span><span class="default">true</span><span class="keyword">));
<br>&nbsp; &nbsp; &nbsp; &nbsp; }
<br>
<br>&nbsp; &nbsp; </span><span class="comment">// Determine the length of the hash.
<br>&nbsp; &nbsp; </span><span class="default">$hash_length </span><span class="keyword">= </span><span class="default">strlen</span><span class="keyword">(</span><span class="default">$salt</span><span class="keyword">);
<br>
<br>&nbsp; &nbsp; </span><span class="comment">// Determine the length of the password.
<br>&nbsp; &nbsp; </span><span class="default">$password_length </span><span class="keyword">= </span><span class="default">strlen</span><span class="keyword">(</span><span class="default">$password</span><span class="keyword">);
<br>
<br>&nbsp; &nbsp; </span><span class="comment">// Determine the maximum length of password. This is only needed if
<br>&nbsp; &nbsp; // the user enters a very long password. In any case, the salt will
<br>&nbsp; &nbsp; // be a maximum of half the end result. The longer the hash, the
<br>&nbsp; &nbsp; // longer the password/salt can be. 
<br>&nbsp; &nbsp; </span><span class="default">$password_max_length </span><span class="keyword">= </span><span class="default">$hash_length </span><span class="keyword">/ </span><span class="default">2</span><span class="keyword">;
<br>
<br>&nbsp; &nbsp; </span><span class="comment">// Shorten the salt based on the length of the password.
<br>&nbsp; &nbsp; </span><span class="keyword">if (</span><span class="default">$password_length </span><span class="keyword">&gt;= </span><span class="default">$password_max_length</span><span class="keyword">)
<br>&nbsp; &nbsp; {
<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$salt </span><span class="keyword">= </span><span class="default">substr</span><span class="keyword">(</span><span class="default">$salt</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">$password_max_length</span><span class="keyword">);
<br>&nbsp; &nbsp; }
<br>&nbsp; &nbsp; else
<br>&nbsp; &nbsp; {
<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$salt </span><span class="keyword">= </span><span class="default">substr</span><span class="keyword">(</span><span class="default">$salt</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">$password_length</span><span class="keyword">);
<br>&nbsp; &nbsp; }
<br>
<br>&nbsp; &nbsp; </span><span class="comment">// Determine the length of the salt.
<br>&nbsp; &nbsp; </span><span class="default">$salt_length </span><span class="keyword">= </span><span class="default">strlen</span><span class="keyword">(</span><span class="default">$salt</span><span class="keyword">);
<br>
<br>&nbsp; &nbsp; </span><span class="comment">// Determine the salted hashed password.
<br>&nbsp; &nbsp; </span><span class="default">$salted_password </span><span class="keyword">= </span><span class="default">hash</span><span class="keyword">(</span><span class="default">$algorythm</span><span class="keyword">, </span><span class="default">$salt </span><span class="keyword">. </span><span class="default">$password</span><span class="keyword">);
<br>
<br>&nbsp; &nbsp; </span><span class="comment">// If we add the salt to the hashed password, we would get a hash that
<br>&nbsp; &nbsp; // is longer than a normally hashed password. We don't want that; it
<br>&nbsp; &nbsp; // would give away hints to an attacker. Because the password and the
<br>&nbsp; &nbsp; // length of the password are known, we can just throw away the first
<br>&nbsp; &nbsp; // couple of characters of the salted password. That way the salt and
<br>&nbsp; &nbsp; // the salted password together are the same length as a normally
<br>&nbsp; &nbsp; // hashed password without salt.
<br>&nbsp; &nbsp; </span><span class="default">$used_chars </span><span class="keyword">= (</span><span class="default">$hash_length </span><span class="keyword">- </span><span class="default">$salt_length</span><span class="keyword">) * -</span><span class="default">1</span><span class="keyword">;
<br>&nbsp; &nbsp; </span><span class="default">$final_result </span><span class="keyword">= </span><span class="default">$salt </span><span class="keyword">. </span><span class="default">substr</span><span class="keyword">(</span><span class="default">$salted_password</span><span class="keyword">, </span><span class="default">$used_chars</span><span class="keyword">);
<br>
<br>&nbsp; &nbsp; return </span><span class="default">$final_result</span><span class="keyword">;
<br>}
<br></span><span class="default">?&gt;</span>
</span>
</code></div>
  </div>
 </div>
  <div class="note" id="83079">  
  <a class="name">
  <strong class="user"><em>ranko84 at gmail dot com</em></strong></a><div class="date" title="2008-05-08 07:12"><strong>6 years ago</strong></div>
  <div class="text" id="Hcom83079">
<div class="phpcode"><code><span class="html">
Thanks for the feedback. This should do the trick, I hope.<br>I think that I haven't understood this sentence completely "In this case you will need the salt to reside in the database along with the username and password." As in, were you refering to previous method, this method or this function.<br>Salt already resides in database along with username, password, or any string you decide to hash. This function just scrambles it depending on length of string (password) user enters so that attacker has trouble finding out what is salt and what is hash, if attacker even suspects that there is salt (reasons behind $keepLength, or defining $hSLength where you could set it to 24 leading attacker to believe he's facing sha256, not sha1).<br><br><span class="default">&lt;?php<br></span><span class="keyword">function </span><span class="default">obscure </span><span class="keyword">(</span><span class="default">$hString</span><span class="keyword">, </span><span class="default">$hDecode </span><span class="keyword">= </span><span class="default">NULL</span><span class="keyword">, </span><span class="default">$hSLength </span><span class="keyword">= </span><span class="default">10</span><span class="keyword">, </span><span class="default">$keepLength </span><span class="keyword">= </span><span class="default">NULL</span><span class="keyword">, </span><span class="default">$minhPass </span><span class="keyword">= </span><span class="default">10</span><span class="keyword">, </span><span class="default">$hMethod </span><span class="keyword">= </span><span class="default">sha1</span><span class="keyword">)<br>{<br>&nbsp; &nbsp; if (</span><span class="default">$hDecode </span><span class="keyword">== </span><span class="default">NULL</span><span class="keyword">)<br>&nbsp; &nbsp; {<br>&nbsp; &nbsp; &nbsp; &nbsp; for (</span><span class="default">$i </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">; </span><span class="default">$i</span><span class="keyword">&lt;</span><span class="default">16</span><span class="keyword">; </span><span class="default">$i</span><span class="keyword">++)<br>&nbsp; &nbsp; &nbsp; &nbsp; {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$hSalt </span><span class="keyword">= </span><span class="default">rand</span><span class="keyword">(</span><span class="default">33</span><span class="keyword">, </span><span class="default">255</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$hRandomSalt </span><span class="keyword">.= </span><span class="default">chr</span><span class="keyword">(</span><span class="default">$hSalt</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; }<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$hRandomSalt </span><span class="keyword">= </span><span class="default">hash</span><span class="keyword">(</span><span class="default">$hMethod</span><span class="keyword">, </span><span class="default">$hRandomSalt</span><span class="keyword">);<br>&nbsp; &nbsp; }<br>&nbsp; &nbsp; else<br>&nbsp; &nbsp; {<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$hRandomSalt </span><span class="keyword">= </span><span class="default">$hDecode</span><span class="keyword">;<br>&nbsp; &nbsp; }<br><br>&nbsp; &nbsp; if (</span><span class="default">$keepLength </span><span class="keyword">!= </span><span class="default">NULL</span><span class="keyword">)<br>&nbsp; &nbsp; {<br>&nbsp; &nbsp; &nbsp; &nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; if (</span><span class="default">$hSLength </span><span class="keyword">&gt; (</span><span class="default">strlen</span><span class="keyword">(</span><span class="default">$hRandomSalt</span><span class="keyword">) - </span><span class="default">$minhPass</span><span class="keyword">))<br>&nbsp; &nbsp; &nbsp; &nbsp; {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$hSLength </span><span class="keyword">= (</span><span class="default">strlen</span><span class="keyword">(</span><span class="default">$hRandomSalt</span><span class="keyword">) - </span><span class="default">$minhPass</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; }<br>&nbsp; &nbsp; }<br>&nbsp; &nbsp; else if (</span><span class="default">$hSLength </span><span class="keyword">&lt; </span><span class="default">0</span><span class="keyword">)<br>&nbsp; &nbsp; {<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$hSLength </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">;<br>&nbsp; &nbsp; }<br><br>&nbsp; &nbsp; </span><span class="default">$hLPosition </span><span class="keyword">= </span><span class="default">strlen</span><span class="keyword">(</span><span class="default">$hString</span><span class="keyword">);<br><br>&nbsp; &nbsp; while (</span><span class="default">$hLPosition </span><span class="keyword">&gt; </span><span class="default">$hSLength</span><span class="keyword">)<br>&nbsp; &nbsp; {<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$hNumber </span><span class="keyword">= </span><span class="default">substr</span><span class="keyword">(</span><span class="default">$hLPosition</span><span class="keyword">, -</span><span class="default">1</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$hLPosition </span><span class="keyword">= </span><span class="default">$hLPosition </span><span class="keyword">* (</span><span class="default">$hNumber</span><span class="keyword">/</span><span class="default">10</span><span class="keyword">);<br>&nbsp; &nbsp; }<br><br>&nbsp; &nbsp; </span><span class="default">$hLPosition </span><span class="keyword">= (integer)</span><span class="default">$hLPosition</span><span class="keyword">;<br>&nbsp; &nbsp; </span><span class="default">$hRPosition </span><span class="keyword">= </span><span class="default">$hSLength </span><span class="keyword">- </span><span class="default">$hLPosition</span><span class="keyword">;<br><br>&nbsp; &nbsp; </span><span class="default">$hFSalt </span><span class="keyword">= </span><span class="default">substr</span><span class="keyword">(</span><span class="default">$hRandomSalt</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">$hLPosition</span><span class="keyword">);<br>&nbsp; &nbsp; </span><span class="default">$hLSalt </span><span class="keyword">= </span><span class="default">substr</span><span class="keyword">(</span><span class="default">$hRandomSalt</span><span class="keyword">, -</span><span class="default">$hRPosition</span><span class="keyword">, </span><span class="default">$hRPosition</span><span class="keyword">);<br><br>&nbsp; &nbsp; </span><span class="default">$hPassHash </span><span class="keyword">= </span><span class="default">hash</span><span class="keyword">(</span><span class="default">$hMethod</span><span class="keyword">, (</span><span class="default">$hLSalt </span><span class="keyword">. </span><span class="default">$hString </span><span class="keyword">. </span><span class="default">$hFSalt</span><span class="keyword">));<br><br>&nbsp; &nbsp; if (</span><span class="default">$keepLength </span><span class="keyword">!= </span><span class="default">NULL</span><span class="keyword">)<br>&nbsp; &nbsp; {<br>&nbsp; &nbsp; &nbsp; &nbsp; if (</span><span class="default">$hSLength </span><span class="keyword">!= </span><span class="default">0</span><span class="keyword">)<br>&nbsp; &nbsp; &nbsp; &nbsp; {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$hPassHash </span><span class="keyword">= </span><span class="default">substr</span><span class="keyword">(</span><span class="default">$hPassHash</span><span class="keyword">, </span><span class="default">$hLPosition</span><span class="keyword">, -</span><span class="default">$hRPosition</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; }<br>&nbsp; &nbsp; }<br><br>&nbsp; &nbsp; return </span><span class="default">$hFSalt </span><span class="keyword">. </span><span class="default">$hPassHash </span><span class="keyword">. </span><span class="default">$hLSalt</span><span class="keyword">;<br>}<br></span><span class="default">?&gt;</span>
</span>
</code></div>
  </div>
 </div>
  <div class="note" id="77817">  
  <a class="name">
  <strong class="user"><em>NoName</em></strong></a><div class="date" title="2007-09-13 03:26"><strong>6 years ago</strong></div>
  <div class="text" id="Hcom77817">
<div class="phpcode"><code><span class="html">
Regarding the twistSTR - the problem is that currently it is relatively easy to generate a collision for any alphanumeric plaintext of a given, short length via e.g. a rainbow table. You're bettter off using a sufficiently lengthy and random salt.</span>
</code></div>
  </div>
 </div>
  <div class="note" id="71449">  
  <a class="name">
  <strong class="user"><em>novum123 at ribbonbazaar dot com</em></strong></a><div class="date" title="2006-11-29 08:54"><strong>7 years ago</strong></div>
  <div class="text" id="Hcom71449">
<div class="phpcode"><code><span class="html">
So far as the dictionary attacks are concerned, I thought up the following function:<br><br><span class="default">&lt;?php<br></span><span class="keyword">function </span><span class="default">twistSTR</span><span class="keyword">(</span><span class="default">$array</span><span class="keyword">){<br>&nbsp; </span><span class="default">$twisted</span><span class="keyword">=</span><span class="string">""</span><span class="keyword">;<br>&nbsp; </span><span class="default">$array_strlen</span><span class="keyword">=array();<br><br>&nbsp; foreach (</span><span class="default">$array </span><span class="keyword">as </span><span class="default">$element</span><span class="keyword">){<br>&nbsp; &nbsp; </span><span class="default">$array_strlen</span><span class="keyword">[]=</span><span class="default">strlen</span><span class="keyword">(</span><span class="default">$element</span><span class="keyword">);<br>&nbsp; }<br><br>&nbsp; for (</span><span class="default">$i</span><span class="keyword">=</span><span class="default">0</span><span class="keyword">; </span><span class="default">$i</span><span class="keyword">&lt;</span><span class="default">max</span><span class="keyword">(</span><span class="default">$array_strlen</span><span class="keyword">); </span><span class="default">$i</span><span class="keyword">++){<br>&nbsp; &nbsp; foreach (</span><span class="default">$array </span><span class="keyword">as </span><span class="default">$element</span><span class="keyword">){<br>&nbsp; &nbsp; &nbsp; if (</span><span class="default">$i</span><span class="keyword">&lt;</span><span class="default">strlen</span><span class="keyword">(</span><span class="default">$element</span><span class="keyword">)){<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$twisted</span><span class="keyword">=</span><span class="default">$twisted</span><span class="keyword">.</span><span class="default">$element</span><span class="keyword">{</span><span class="default">$i</span><span class="keyword">};<br>&nbsp; &nbsp; &nbsp; }<br>&nbsp; &nbsp; }<br>&nbsp; }<br><br>&nbsp; return </span><span class="default">$twisted</span><span class="keyword">;<br>}<br></span><span class="default">?&gt;<br></span><br>The twistSTR function basically takes an array input of strings and alternates each character of each string among all the other strings.&nbsp; For example:<br><br><span class="default">&lt;?php<br></span><span class="keyword">echo </span><span class="default">twistSTR</span><span class="keyword">(array(</span><span class="string">"this"</span><span class="keyword">,</span><span class="string">"and"</span><span class="keyword">,</span><span class="string">"that"</span><span class="keyword">));</span><span class="comment">//output: tathnhidast<br></span><span class="default">?&gt;<br></span><br>It can be applied in the following manner:<br><br><span class="default">&lt;?php<br></span><span class="keyword">if (</span><span class="default">$un</span><span class="keyword">===</span><span class="default">$_POST</span><span class="keyword">[</span><span class="string">"username"</span><span class="keyword">] &amp;&amp; </span><span class="default">$pwd</span><span class="keyword">===</span><span class="default">sha1</span><span class="keyword">(</span><span class="default">twistSTR</span><span class="keyword">(array(</span><span class="default">$salt</span><span class="keyword">,</span><span class="default">$_POST</span><span class="keyword">[</span><span class="string">"password"</span><span class="keyword">])))){<br></span><span class="default">?&gt;<br></span><br>It's not amazingly difficult to reverse engineer the actual output, but then again, that's not the point.&nbsp; The point is that when a password is entered into one of those databases, they are going to enter for example "thisandthat", not "tathnhidast".</span>
</code></div>
  </div>
 </div>
  <div class="note" id="70474">  
  <a class="name">
  <strong class="user"><em>Gregory Boshoff</em></strong></a><div class="date" title="2006-10-18 04:23"><strong>7 years ago</strong></div>
  <div class="text" id="Hcom70474">
<div class="phpcode"><code><span class="html">
Note that the sha1 algorithm has been compromised and is no longer being used by government agencies.<br><br>As of PHP 5.1.2 a new set of hashing functions are available.<br><br><a rel="nofollow" target="_blank">http://www.php.net/manual/en/function.hash.php</a><br><br>The new function hash() supports a new range of hashing methods.<br><br>echo hash('sha256', 'The quick brown fox jumped over the lazy dog.');<br><br>It is recommended that developers start to future proof their applications by using the stronger sha-2, hashing methods such as sha256, sha384, sha512 or better.<br><br>As of PHP 5.1.2 hash_algos() returns an array of system specific or registered hashing algorithms methods that are available to PHP.<br><br>print_r(hash_algos());</span>
</code></div>
  </div>
 </div>
  <div class="note" id="56941">  
  <a class="name">
  <strong class="user"><em>php at REMOVEMEkennel17 dot co dot uk</em></strong></a><div class="date" title="2005-09-19 06:52"><strong>8 years ago</strong></div>
  <div class="text" id="Hcom56941">
<div class="phpcode"><code><span class="html">
It should be noted that sha1("") does not return an empty string.&nbsp; This means that if you are running a system that does not require users to have a password, the following code will not work as expected:<br><br><span class="default">&lt;?php <br></span><span class="keyword">if (</span><span class="default">$StoredPassword </span><span class="keyword">== </span><span class="default">sha1</span><span class="keyword">(</span><span class="default">$NewPassword</span><span class="keyword">)) <br>&nbsp; &nbsp; </span><span class="comment">// Password good<br></span><span class="default">?&gt;</span> <br><br>If $StoredPassword and $NewPassword are both blank, then the password should be treated as good, but because sha1("") != "" it will be treated as bad. To get the correct behaviour you need to use:<br><br><span class="default">&lt;?php <br></span><span class="keyword">if ((</span><span class="default">$StoredPassword </span><span class="keyword">== </span><span class="string">"" </span><span class="keyword">&amp;&amp; </span><span class="default">$NewPassword </span><span class="keyword">== </span><span class="string">""</span><span class="keyword">) || (</span><span class="default">$StoredPassword </span><span class="keyword">== </span><span class="default">sha1</span><span class="keyword">(</span><span class="default">$NewPassword</span><span class="keyword">)))<br>&nbsp; &nbsp; </span><span class="comment">// Password good<br></span><span class="default">?&gt;</span> <br><br>(Note: I use a custom IsBlank() function instead of comparison against the empty string, so NULL values are also matched.)<br><br>For reference, here are a couple of special values put through sha1().&nbsp; Note that sha1("") == sha1(NULL) == sha1(false), and also that sha1(0) != sha1(false)<br><br>"" -&gt; da39a3ee5e6b4b0d3255bfef95601890afd80709<br>NULL -&gt; da39a3ee5e6b4b0d3255bfef95601890afd80709<br>0 -&gt; b6589fc6ab0dc82cf12099d1c2d40ab994e8410c<br>1 -&gt; 356a192b7913b04c54574d18c28d46e6395428ab<br>false -&gt; da39a3ee5e6b4b0d3255bfef95601890afd80709<br>true -&gt; 356a192b7913b04c54574d18c28d46e6395428ab</span>
</code></div>
  </div>
 </div>
  <div class="note" id="54509">  
  <a class="name">
  <strong class="user"><em>Helpful Harry</em></strong></a><div class="date" title="2005-07-06 10:21"><strong>9 years ago</strong></div>
  <div class="text" id="Hcom54509">
<div class="phpcode"><code><span class="html">
check out these randomized sha1 password storage functions, they output a string of 50 characters, the first 40 characters being a sha1 output based on the last 10 characters - those being a random seed<br><br>to encode a password run pw_encode with the password, it'll return a different pseudo-random string every time - store this value.<br><br>to check a password run pw_check with the password attempt and the stored value, it'll return true on a match and false otherwise<br><br>these functions eliminate the pesky problem of dictionary matches being run on your password lists<br><br><span class="default">&lt;?php<br><br></span><span class="keyword">function </span><span class="default">pw_encode</span><span class="keyword">(</span><span class="default">$password</span><span class="keyword">)<br>{<br>&nbsp;&nbsp; for (</span><span class="default">$i </span><span class="keyword">= </span><span class="default">1</span><span class="keyword">; </span><span class="default">$i </span><span class="keyword">&lt;= </span><span class="default">10</span><span class="keyword">; </span><span class="default">$i</span><span class="keyword">++)<br>&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$seed </span><span class="keyword">.= </span><span class="default">substr</span><span class="keyword">(</span><span class="string">'0123456789abcdef'</span><span class="keyword">, </span><span class="default">rand</span><span class="keyword">(</span><span class="default">0</span><span class="keyword">,</span><span class="default">15</span><span class="keyword">), </span><span class="default">1</span><span class="keyword">);<br>&nbsp;&nbsp; return </span><span class="default">sha1</span><span class="keyword">(</span><span class="default">$seed</span><span class="keyword">.</span><span class="default">$password</span><span class="keyword">.</span><span class="default">$seed</span><span class="keyword">).</span><span class="default">$seed</span><span class="keyword">;<br>}<br><br>function </span><span class="default">pw_check</span><span class="keyword">(</span><span class="default">$password</span><span class="keyword">, </span><span class="default">$stored_value</span><span class="keyword">)<br>{<br>&nbsp;&nbsp; if (</span><span class="default">strlen</span><span class="keyword">(</span><span class="default">$stored_value</span><span class="keyword">) != </span><span class="default">50</span><span class="keyword">)<br>&nbsp; &nbsp; &nbsp; return </span><span class="default">FALSE</span><span class="keyword">;<br>&nbsp;&nbsp; </span><span class="default">$stored_seed </span><span class="keyword">= </span><span class="default">substr</span><span class="keyword">(</span><span class="default">$stored_value</span><span class="keyword">,</span><span class="default">40</span><span class="keyword">,</span><span class="default">10</span><span class="keyword">);<br>&nbsp;&nbsp; if (</span><span class="default">sha1</span><span class="keyword">(</span><span class="default">$stored_seed</span><span class="keyword">.</span><span class="default">$password</span><span class="keyword">.</span><span class="default">$stored_seed</span><span class="keyword">).</span><span class="default">$stored_seed </span><span class="keyword">== </span><span class="default">$stored_value</span><span class="keyword">)<br>&nbsp; &nbsp;&nbsp; return </span><span class="default">TRUE</span><span class="keyword">;<br>&nbsp;&nbsp; else<br>&nbsp; &nbsp;&nbsp; return </span><span class="default">FALSE</span><span class="keyword">;<br>}<br><br></span><span class="default">?&gt;</span>
</span>
</code></div>
  </div>
 </div>
  <div class="note" id="52372">  
  <a class="name">
  <strong class="user"><em>alex at milivojevic dot org</em></strong></a><div class="date" title="2005-04-28 02:12"><strong>9 years ago</strong></div>
  <div class="text" id="Hcom52372">
<div class="phpcode"><code><span class="html">
Regarding my previous comment, if you want to be on the safe side and use only ASCII printable seeds (shouldn't matter for SSHA seeds), something like this could be used:<br><br><span class="default">&lt;?php<br>$salt </span><span class="keyword">= </span><span class="default">substr</span><span class="keyword">(</span><span class="default">base64_encode</span><span class="keyword">(</span><span class="default">pack</span><span class="keyword">(</span><span class="string">"H*"</span><span class="keyword">, </span><span class="default">sha1</span><span class="keyword">(</span><span class="default">mt_rand</span><span class="keyword">()))), </span><span class="default">0</span><span class="keyword">, </span><span class="default">4</span><span class="keyword">);<br></span><span class="default">?&gt;</span>
</span>
</code></div>
  </div>
 </div>
  <div class="note" id="47609">  
  <a class="name">
  <strong class="user"><em>sinatosk at gmail dot com</em></strong></a><div class="date" title="2004-11-22 12:43"><strong>9 years ago</strong></div>
  <div class="text" id="Hcom47609">
<div class="phpcode"><code><span class="html">
Heres an SHA1 function that will work on it's own completely. This is for users who are using below PHP 4.3.0. it works same as PHP5 ( being able to return raw output ).<br><br><span class="default">&lt;?php<br><br></span><span class="comment">/*<br>** Date modified: 1st October 2004 20:09 GMT<br>*<br>** PHP implementation of the Secure Hash Algorithm ( SHA-1 )<br>*<br>** This code is available under the GNU Lesser General Public License:<br>** <a rel="nofollow" target="_blank">http://www.gnu.org/licenses/lgpl.txt</a><br>*<br>** Based on the PHP implementation by Marcus Campbell<br>** <a rel="nofollow" target="_blank">http://www.tecknik.net/sha-1/</a><br>*<br>** This is a slightly modified version by me Jerome Clarke ( sinatosk@gmail.com )<br>** because I feel more comfortable with this<br>*/<br><br></span><span class="keyword">function </span><span class="default">sha1_str2blks_SHA1</span><span class="keyword">(</span><span class="default">$str</span><span class="keyword">)<br>{<br>&nbsp; &nbsp; </span><span class="default">$strlen_str </span><span class="keyword">= </span><span class="default">strlen</span><span class="keyword">(</span><span class="default">$str</span><span class="keyword">);<br>&nbsp; &nbsp; <br>&nbsp; &nbsp; </span><span class="default">$nblk </span><span class="keyword">= ((</span><span class="default">$strlen_str </span><span class="keyword">+ </span><span class="default">8</span><span class="keyword">) &gt;&gt; </span><span class="default">6</span><span class="keyword">) + </span><span class="default">1</span><span class="keyword">;<br>&nbsp; &nbsp; <br>&nbsp; &nbsp; for (</span><span class="default">$i</span><span class="keyword">=</span><span class="default">0</span><span class="keyword">; </span><span class="default">$i </span><span class="keyword">&lt; </span><span class="default">$nblk </span><span class="keyword">* </span><span class="default">16</span><span class="keyword">; </span><span class="default">$i</span><span class="keyword">++) </span><span class="default">$blks</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">] = </span><span class="default">0</span><span class="keyword">;<br>&nbsp; &nbsp; <br>&nbsp; &nbsp; for (</span><span class="default">$i</span><span class="keyword">=</span><span class="default">0</span><span class="keyword">; </span><span class="default">$i </span><span class="keyword">&lt; </span><span class="default">$strlen_str</span><span class="keyword">; </span><span class="default">$i</span><span class="keyword">++)<br>&nbsp; &nbsp; {<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$blks</span><span class="keyword">[</span><span class="default">$i </span><span class="keyword">&gt;&gt; </span><span class="default">2</span><span class="keyword">] |= </span><span class="default">ord</span><span class="keyword">(</span><span class="default">substr</span><span class="keyword">(</span><span class="default">$str</span><span class="keyword">, </span><span class="default">$i</span><span class="keyword">, </span><span class="default">1</span><span class="keyword">)) &lt;&lt; (</span><span class="default">24 </span><span class="keyword">- (</span><span class="default">$i </span><span class="keyword">% </span><span class="default">4</span><span class="keyword">) * </span><span class="default">8</span><span class="keyword">);<br>&nbsp; &nbsp; }<br>&nbsp; &nbsp; <br>&nbsp; &nbsp; </span><span class="default">$blks</span><span class="keyword">[</span><span class="default">$i </span><span class="keyword">&gt;&gt; </span><span class="default">2</span><span class="keyword">] |= </span><span class="default">0x80 </span><span class="keyword">&lt;&lt; (</span><span class="default">24 </span><span class="keyword">- (</span><span class="default">$i </span><span class="keyword">% </span><span class="default">4</span><span class="keyword">) * </span><span class="default">8</span><span class="keyword">);<br>&nbsp; &nbsp; </span><span class="default">$blks</span><span class="keyword">[</span><span class="default">$nblk </span><span class="keyword">* </span><span class="default">16 </span><span class="keyword">- </span><span class="default">1</span><span class="keyword">] = </span><span class="default">$strlen_str </span><span class="keyword">* </span><span class="default">8</span><span class="keyword">;<br>&nbsp; &nbsp; <br>&nbsp; &nbsp; return </span><span class="default">$blks</span><span class="keyword">;<br>}<br><br>function </span><span class="default">sha1_safe_add</span><span class="keyword">(</span><span class="default">$x</span><span class="keyword">, </span><span class="default">$y</span><span class="keyword">)<br>{<br>&nbsp; &nbsp; </span><span class="default">$lsw </span><span class="keyword">= (</span><span class="default">$x </span><span class="keyword">&amp; </span><span class="default">0xFFFF</span><span class="keyword">) + (</span><span class="default">$y </span><span class="keyword">&amp; </span><span class="default">0xFFFF</span><span class="keyword">);<br>&nbsp; &nbsp; </span><span class="default">$msw </span><span class="keyword">= (</span><span class="default">$x </span><span class="keyword">&gt;&gt; </span><span class="default">16</span><span class="keyword">) + (</span><span class="default">$y </span><span class="keyword">&gt;&gt; </span><span class="default">16</span><span class="keyword">) + (</span><span class="default">$lsw </span><span class="keyword">&gt;&gt; </span><span class="default">16</span><span class="keyword">);<br>&nbsp; &nbsp; <br>&nbsp; &nbsp; return (</span><span class="default">$msw </span><span class="keyword">&lt;&lt; </span><span class="default">16</span><span class="keyword">) | (</span><span class="default">$lsw </span><span class="keyword">&amp; </span><span class="default">0xFFFF</span><span class="keyword">);<br>}<br><br>function </span><span class="default">sha1_rol</span><span class="keyword">(</span><span class="default">$num</span><span class="keyword">, </span><span class="default">$cnt</span><span class="keyword">)<br>{<br>&nbsp; &nbsp; return (</span><span class="default">$num </span><span class="keyword">&lt;&lt; </span><span class="default">$cnt</span><span class="keyword">) | </span><span class="default">sha1_zeroFill</span><span class="keyword">(</span><span class="default">$num</span><span class="keyword">, </span><span class="default">32 </span><span class="keyword">- </span><span class="default">$cnt</span><span class="keyword">);&nbsp; &nbsp; <br>}<br><br>function </span><span class="default">sha1_zeroFill</span><span class="keyword">(</span><span class="default">$a</span><span class="keyword">, </span><span class="default">$b</span><span class="keyword">)<br>{<br>&nbsp; &nbsp; </span><span class="default">$bin </span><span class="keyword">= </span><span class="default">decbin</span><span class="keyword">(</span><span class="default">$a</span><span class="keyword">);<br>&nbsp; &nbsp; <br>&nbsp; &nbsp; </span><span class="default">$strlen_bin </span><span class="keyword">= </span><span class="default">strlen</span><span class="keyword">(</span><span class="default">$bin</span><span class="keyword">);<br>&nbsp; &nbsp; <br>&nbsp; &nbsp; </span><span class="default">$bin </span><span class="keyword">= </span><span class="default">$strlen_bin </span><span class="keyword">&lt; </span><span class="default">$b </span><span class="keyword">? </span><span class="default">0 </span><span class="keyword">: </span><span class="default">substr</span><span class="keyword">(</span><span class="default">$bin</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">$strlen_bin </span><span class="keyword">- </span><span class="default">$b</span><span class="keyword">);<br>&nbsp; &nbsp; <br>&nbsp; &nbsp; for (</span><span class="default">$i</span><span class="keyword">=</span><span class="default">0</span><span class="keyword">; </span><span class="default">$i </span><span class="keyword">&lt; </span><span class="default">$b</span><span class="keyword">; </span><span class="default">$i</span><span class="keyword">++) </span><span class="default">$bin </span><span class="keyword">= </span><span class="string">'0'</span><span class="keyword">.</span><span class="default">$bin</span><span class="keyword">;<br>&nbsp; &nbsp; <br>&nbsp; &nbsp; return </span><span class="default">bindec</span><span class="keyword">(</span><span class="default">$bin</span><span class="keyword">);<br>}<br><br>function </span><span class="default">sha1_ft</span><span class="keyword">(</span><span class="default">$t</span><span class="keyword">, </span><span class="default">$b</span><span class="keyword">, </span><span class="default">$c</span><span class="keyword">, </span><span class="default">$d</span><span class="keyword">)<br>{<br>&nbsp; &nbsp; if (</span><span class="default">$t </span><span class="keyword">&lt; </span><span class="default">20</span><span class="keyword">) return (</span><span class="default">$b </span><span class="keyword">&amp; </span><span class="default">$c</span><span class="keyword">) | ((~</span><span class="default">$b</span><span class="keyword">) &amp; </span><span class="default">$d</span><span class="keyword">);<br>&nbsp; &nbsp; if (</span><span class="default">$t </span><span class="keyword">&lt; </span><span class="default">40</span><span class="keyword">) return </span><span class="default">$b </span><span class="keyword">^ </span><span class="default">$c </span><span class="keyword">^ </span><span class="default">$d</span><span class="keyword">;<br>&nbsp; &nbsp; if (</span><span class="default">$t </span><span class="keyword">&lt; </span><span class="default">60</span><span class="keyword">) return (</span><span class="default">$b </span><span class="keyword">&amp; </span><span class="default">$c</span><span class="keyword">) | (</span><span class="default">$b </span><span class="keyword">&amp; </span><span class="default">$d</span><span class="keyword">) | (</span><span class="default">$c </span><span class="keyword">&amp; </span><span class="default">$d</span><span class="keyword">);<br>&nbsp; &nbsp; <br>&nbsp; &nbsp; return </span><span class="default">$b </span><span class="keyword">^ </span><span class="default">$c </span><span class="keyword">^ </span><span class="default">$d</span><span class="keyword">;<br>}<br><br>function </span><span class="default">sha1_kt</span><span class="keyword">(</span><span class="default">$t</span><span class="keyword">)<br>{<br>&nbsp; &nbsp; if (</span><span class="default">$t </span><span class="keyword">&lt; </span><span class="default">20</span><span class="keyword">) return </span><span class="default">1518500249</span><span class="keyword">;<br>&nbsp; &nbsp; if (</span><span class="default">$t </span><span class="keyword">&lt; </span><span class="default">40</span><span class="keyword">) return </span><span class="default">1859775393</span><span class="keyword">;<br>&nbsp; &nbsp; if (</span><span class="default">$t </span><span class="keyword">&lt; </span><span class="default">60</span><span class="keyword">) return -</span><span class="default">1894007588</span><span class="keyword">;<br>&nbsp; &nbsp; <br>&nbsp; &nbsp; return -</span><span class="default">899497514</span><span class="keyword">;<br>}<br><br>function </span><span class="default">sha1</span><span class="keyword">(</span><span class="default">$str</span><span class="keyword">, </span><span class="default">$raw_output</span><span class="keyword">=</span><span class="default">FALSE</span><span class="keyword">)<br>{<br>&nbsp; &nbsp; if ( </span><span class="default">$raw_output </span><span class="keyword">=== </span><span class="default">TRUE </span><span class="keyword">) return </span><span class="default">pack</span><span class="keyword">(</span><span class="string">'H*'</span><span class="keyword">, </span><span class="default">sha1</span><span class="keyword">(</span><span class="default">$str</span><span class="keyword">, </span><span class="default">FALSE</span><span class="keyword">));<br>&nbsp; &nbsp; <br>&nbsp; &nbsp; </span><span class="default">$x </span><span class="keyword">= </span><span class="default">sha1_str2blks_SHA1</span><span class="keyword">(</span><span class="default">$str</span><span class="keyword">);<br>&nbsp; &nbsp; </span><span class="default">$a </span><span class="keyword">=&nbsp; </span><span class="default">1732584193</span><span class="keyword">;<br>&nbsp; &nbsp; </span><span class="default">$b </span><span class="keyword">= -</span><span class="default">271733879</span><span class="keyword">;<br>&nbsp; &nbsp; </span><span class="default">$c </span><span class="keyword">= -</span><span class="default">1732584194</span><span class="keyword">;<br>&nbsp; &nbsp; </span><span class="default">$d </span><span class="keyword">=&nbsp; </span><span class="default">271733878</span><span class="keyword">;<br>&nbsp; &nbsp; </span><span class="default">$e </span><span class="keyword">= -</span><span class="default">1009589776</span><span class="keyword">;<br>&nbsp; &nbsp; <br>&nbsp; &nbsp; </span><span class="default">$x_count </span><span class="keyword">= </span><span class="default">count</span><span class="keyword">(</span><span class="default">$x</span><span class="keyword">);<br>&nbsp; &nbsp; <br>&nbsp; &nbsp; for (</span><span class="default">$i </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">; </span><span class="default">$i </span><span class="keyword">&lt; </span><span class="default">$x_count</span><span class="keyword">; </span><span class="default">$i </span><span class="keyword">+= </span><span class="default">16</span><span class="keyword">)<br>&nbsp; &nbsp; {<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$olda </span><span class="keyword">= </span><span class="default">$a</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$oldb </span><span class="keyword">= </span><span class="default">$b</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$oldc </span><span class="keyword">= </span><span class="default">$c</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$oldd </span><span class="keyword">= </span><span class="default">$d</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$olde </span><span class="keyword">= </span><span class="default">$e</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; for (</span><span class="default">$j </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">; </span><span class="default">$j </span><span class="keyword">&lt; </span><span class="default">80</span><span class="keyword">; </span><span class="default">$j</span><span class="keyword">++)<br>&nbsp; &nbsp; &nbsp; &nbsp; {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$w</span><span class="keyword">[</span><span class="default">$j</span><span class="keyword">] = (</span><span class="default">$j </span><span class="keyword">&lt; </span><span class="default">16</span><span class="keyword">) ? </span><span class="default">$x</span><span class="keyword">[</span><span class="default">$i </span><span class="keyword">+ </span><span class="default">$j</span><span class="keyword">] : </span><span class="default">sha1_rol</span><span class="keyword">(</span><span class="default">$w</span><span class="keyword">[</span><span class="default">$j </span><span class="keyword">- </span><span class="default">3</span><span class="keyword">] ^ </span><span class="default">$w</span><span class="keyword">[</span><span class="default">$j </span><span class="keyword">- </span><span class="default">8</span><span class="keyword">] ^ </span><span class="default">$w</span><span class="keyword">[</span><span class="default">$j </span><span class="keyword">- </span><span class="default">14</span><span class="keyword">] ^ </span><span class="default">$w</span><span class="keyword">[</span><span class="default">$j </span><span class="keyword">- </span><span class="default">16</span><span class="keyword">], </span><span class="default">1</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$t </span><span class="keyword">= </span><span class="default">sha1_safe_add</span><span class="keyword">(</span><span class="default">sha1_safe_add</span><span class="keyword">(</span><span class="default">sha1_rol</span><span class="keyword">(</span><span class="default">$a</span><span class="keyword">, </span><span class="default">5</span><span class="keyword">), </span><span class="default">sha1_ft</span><span class="keyword">(</span><span class="default">$j</span><span class="keyword">, </span><span class="default">$b</span><span class="keyword">, </span><span class="default">$c</span><span class="keyword">, </span><span class="default">$d</span><span class="keyword">)), </span><span class="default">sha1_safe_add</span><span class="keyword">(</span><span class="default">sha1_safe_add</span><span class="keyword">(</span><span class="default">$e</span><span class="keyword">, </span><span class="default">$w</span><span class="keyword">[</span><span class="default">$j</span><span class="keyword">]), </span><span class="default">sha1_kt</span><span class="keyword">(</span><span class="default">$j</span><span class="keyword">)));<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$e </span><span class="keyword">= </span><span class="default">$d</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$d </span><span class="keyword">= </span><span class="default">$c</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$c </span><span class="keyword">= </span><span class="default">sha1_rol</span><span class="keyword">(</span><span class="default">$b</span><span class="keyword">, </span><span class="default">30</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$b </span><span class="keyword">= </span><span class="default">$a</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$a </span><span class="keyword">= </span><span class="default">$t</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; }<br>&nbsp; &nbsp; &nbsp; &nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$a </span><span class="keyword">= </span><span class="default">sha1_safe_add</span><span class="keyword">(</span><span class="default">$a</span><span class="keyword">, </span><span class="default">$olda</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$b </span><span class="keyword">= </span><span class="default">sha1_safe_add</span><span class="keyword">(</span><span class="default">$b</span><span class="keyword">, </span><span class="default">$oldb</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$c </span><span class="keyword">= </span><span class="default">sha1_safe_add</span><span class="keyword">(</span><span class="default">$c</span><span class="keyword">, </span><span class="default">$oldc</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$d </span><span class="keyword">= </span><span class="default">sha1_safe_add</span><span class="keyword">(</span><span class="default">$d</span><span class="keyword">, </span><span class="default">$oldd</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$e </span><span class="keyword">= </span><span class="default">sha1_safe_add</span><span class="keyword">(</span><span class="default">$e</span><span class="keyword">, </span><span class="default">$olde</span><span class="keyword">);<br>&nbsp; &nbsp; }<br>&nbsp; &nbsp; <br>&nbsp; &nbsp; return </span><span class="default">sprintf</span><span class="keyword">(</span><span class="string">'%08x%08x%08x%08x%08x'</span><span class="keyword">, </span><span class="default">$a</span><span class="keyword">, </span><span class="default">$b</span><span class="keyword">, </span><span class="default">$c</span><span class="keyword">, </span><span class="default">$d</span><span class="keyword">, </span><span class="default">$e</span><span class="keyword">);<br>}<br><br></span><span class="default">?&gt;</span>
</span>
</code></div>
  </div>
 </div>
  <div class="note" id="40226">  
  <a class="name">
  <strong class="user"><em>brian_bisaillon at rogers dot com</em></strong></a><div class="date" title="2004-02-25 08:19"><strong>10 years ago</strong></div>
  <div class="text" id="Hcom40226">
<div class="phpcode"><code><span class="html">
Source code to create SSHA passwords...<br><br>public function HashPassword($password)<br>{<br>&nbsp; mt_srand((double)microtime()*1000000);<br>&nbsp; $salt = mhash_keygen_s2k(MHASH_SHA1, $password, substr(pack('h*', md5(mt_rand())), 0, 8), 4);<br>&nbsp; $hash = "{SSHA}".base64_encode(mhash(MHASH_SHA1, $password.$salt).$salt);<br>&nbsp; return $hash;<br>}<br><br>Source code to validate SSHA passwords...<br><br>public function ValidatePassword($password, $hash)<br>{<br>&nbsp; $hash = base64_decode(substr($hash, 6));<br>&nbsp; $original_hash = substr($hash, 0, 20);<br>&nbsp; $salt = substr($hash, 20);<br>&nbsp; $new_hash = mhash(MHASH_SHA1, $password . $salt);<br>&nbsp;&nbsp; if (strcmp($original_hash, $new_hash) == 0)<br>&nbsp; &nbsp;&nbsp; ... do something because your password is valid ...<br>&nbsp; else<br>&nbsp; &nbsp; echo 'Unauthorized: Authorization has been refused for the credentials you provided. Please login with a valid username and password.';<br>&nbsp; &nbsp; ... be sure to clear your session data ...<br>}<br><br>Note: The format is compatible with OpenLDAP's SSHA scheme if I'm not mistaken.</span>
</code></div>
  </div>
 </div>
  <div class="note" id="39492">  
  <a class="name">
  <strong class="user"><em>mark at  dot BANSPAM dot pronexus dot nl</em></strong></a><div class="date" title="2004-01-30 06:28"><strong>10 years ago</strong></div>
  <div class="text" id="Hcom39492">
<div class="phpcode"><code><span class="html">
Looking for a simple function to implement HMAC-SHA1 but don't want to use the entire PEAR Message lib?<br><br>//Calculate HMAC-SHA1 according to RFC2104<br>// <a rel="nofollow" target="_blank">http://www.ietf.org/rfc/rfc2104.txt</a><br>function hmacsha1($key,$data) {<br>&nbsp; &nbsp; $blocksize=64;<br>&nbsp; &nbsp; $hashfunc='sha1';<br>&nbsp; &nbsp; if (strlen($key)&gt;$blocksize)<br>&nbsp; &nbsp; &nbsp; &nbsp; $key=pack('H*', $hashfunc($key));<br>&nbsp; &nbsp; $key=str_pad($key,$blocksize,chr(0x00));<br>&nbsp; &nbsp; $ipad=str_repeat(chr(0x36),$blocksize);<br>&nbsp; &nbsp; $opad=str_repeat(chr(0x5c),$blocksize);<br>&nbsp; &nbsp; $hmac = pack(<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 'H*',$hashfunc(<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ($key^$opad).pack(<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 'H*',$hashfunc(<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ($key^$ipad).$data<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; )<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; )<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; )<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; );<br>&nbsp; &nbsp; return bin2hex($hmac);<br>}<br><br>It is very useful for client-authentication. see also <a rel="nofollow" target="_blank">http://cookies.lcs.mit.edu/pubs/webauth:tr.pdf</a><br>Optionally you can change $hashfunc to 'md5' to make this an HMAC-MD5 function ;-)<br>If you want raw or base64 output instead of hexadecimal, just change the last return line.<br><br>Cheers,<br>Mark<br><br>p.s. the "$hmac =" line used to be 1 line but I had to cut it up in order to fit it here ;)</span>
</code></div>
  </div>
 </div>
  <div class="note" id="86239">  
  <a class="name">
  <strong class="user"><em>Andre D</em></strong></a><div class="date" title="2008-10-08 06:28"><strong>5 years ago</strong></div>
  <div class="text" id="Hcom86239">
<div class="phpcode"><code><span class="html">
Here's a better version of the getDigestNotation() function I posted earlier. (The first version had a bug in the argument checking.)<br><br><span class="default">&lt;?php<br></span><span class="keyword">function </span><span class="default">getDigestNotation</span><span class="keyword">(</span><span class="default">$rawDigest</span><span class="keyword">, </span><span class="default">$bitsPerCharacter</span><span class="keyword">, </span><span class="default">$chars </span><span class="keyword">= </span><span class="default">NULL</span><span class="keyword">)<br>{<br>&nbsp; &nbsp; if (</span><span class="default">$chars </span><span class="keyword">=== </span><span class="default">NULL </span><span class="keyword">|| </span><span class="default">strlen</span><span class="keyword">(</span><span class="default">$chars</span><span class="keyword">) &lt; </span><span class="default">2</span><span class="keyword">) {<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$chars </span><span class="keyword">= </span><span class="string">'0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ-,'</span><span class="keyword">;<br>&nbsp; &nbsp; }<br><br>&nbsp; &nbsp; if (</span><span class="default">$bitsPerCharacter </span><span class="keyword">&lt; </span><span class="default">1</span><span class="keyword">) {<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="comment">// $bitsPerCharacter must be at least 1<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$bitsPerCharacter </span><span class="keyword">= </span><span class="default">1</span><span class="keyword">;<br><br>&nbsp; &nbsp; } elseif (</span><span class="default">strlen</span><span class="keyword">(</span><span class="default">$chars</span><span class="keyword">) &lt; </span><span class="default">pow</span><span class="keyword">(</span><span class="default">2</span><span class="keyword">, </span><span class="default">$bitsPerCharacter</span><span class="keyword">)) {<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="comment">// Character length of $chars is too small for $bitsPerCharacter<br>&nbsp; &nbsp; &nbsp; &nbsp; // Set $bitsPerCharacter to greatest value allowed by length of $chars<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$bitsPerCharacter </span><span class="keyword">= </span><span class="default">1</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$minCharLength </span><span class="keyword">= </span><span class="default">2</span><span class="keyword">;<br><br>&nbsp; &nbsp; &nbsp; &nbsp; while (</span><span class="default">strlen</span><span class="keyword">(</span><span class="default">$chars</span><span class="keyword">) &gt;= (</span><span class="default">$minCharLength </span><span class="keyword">*= </span><span class="default">2</span><span class="keyword">)) {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$bitsPerCharacter</span><span class="keyword">++;<br>&nbsp; &nbsp; &nbsp; &nbsp; }<br><br>&nbsp; &nbsp; &nbsp; &nbsp; unset(</span><span class="default">$minCharLength</span><span class="keyword">);<br>&nbsp; &nbsp; }<br><br>&nbsp; &nbsp; </span><span class="default">$bytes </span><span class="keyword">= </span><span class="default">unpack</span><span class="keyword">(</span><span class="string">'C*'</span><span class="keyword">, </span><span class="default">$rawDigest</span><span class="keyword">);<br>&nbsp; &nbsp; </span><span class="default">$byteCount </span><span class="keyword">= </span><span class="default">count</span><span class="keyword">(</span><span class="default">$bytes</span><span class="keyword">);<br><br>&nbsp; &nbsp; </span><span class="default">$out </span><span class="keyword">= </span><span class="string">''</span><span class="keyword">;<br>&nbsp; &nbsp; </span><span class="default">$byte </span><span class="keyword">= </span><span class="default">array_shift</span><span class="keyword">(</span><span class="default">$bytes</span><span class="keyword">);<br>&nbsp; &nbsp; </span><span class="default">$bitsRead </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">;<br><br>&nbsp; &nbsp; for (</span><span class="default">$i </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">; </span><span class="default">$i </span><span class="keyword">&lt; </span><span class="default">$byteCount </span><span class="keyword">* </span><span class="default">8 </span><span class="keyword">/ </span><span class="default">$bitsPerCharacter</span><span class="keyword">; </span><span class="default">$i</span><span class="keyword">++) {<br><br>&nbsp; &nbsp; &nbsp; &nbsp; if (</span><span class="default">$bitsRead </span><span class="keyword">+ </span><span class="default">$bitsPerCharacter </span><span class="keyword">&gt; </span><span class="default">8</span><span class="keyword">) {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="comment">// Not enough bits remain in this byte for the current character<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; // Get remaining bits and get next byte<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$oldBits </span><span class="keyword">= </span><span class="default">$byte </span><span class="keyword">- (</span><span class="default">$byte </span><span class="keyword">&gt;&gt; </span><span class="default">8 </span><span class="keyword">- </span><span class="default">$bitsRead </span><span class="keyword">&lt;&lt; </span><span class="default">8 </span><span class="keyword">- </span><span class="default">$bitsRead</span><span class="keyword">);<br><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if (</span><span class="default">count</span><span class="keyword">(</span><span class="default">$bytes</span><span class="keyword">) == </span><span class="default">0</span><span class="keyword">) {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="comment">// Last bits; match final character and exit loop<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$out </span><span class="keyword">.= </span><span class="default">$chars</span><span class="keyword">[</span><span class="default">$oldBits</span><span class="keyword">];<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; break;<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$oldBitCount </span><span class="keyword">= </span><span class="default">8 </span><span class="keyword">- </span><span class="default">$bitsRead</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$byte </span><span class="keyword">= </span><span class="default">array_shift</span><span class="keyword">(</span><span class="default">$bytes</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$bitsRead </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">;<br><br>&nbsp; &nbsp; &nbsp; &nbsp; } else {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$oldBitCount </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; }<br><br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="comment">// Read only the needed bits from this byte<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$bits </span><span class="keyword">= </span><span class="default">$byte </span><span class="keyword">&gt;&gt; </span><span class="default">8 </span><span class="keyword">- (</span><span class="default">$bitsRead </span><span class="keyword">+ (</span><span class="default">$bitsPerCharacter </span><span class="keyword">- </span><span class="default">$oldBitCount</span><span class="keyword">));<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$bits </span><span class="keyword">= </span><span class="default">$bits </span><span class="keyword">- (</span><span class="default">$bits </span><span class="keyword">&gt;&gt; </span><span class="default">$bitsPerCharacter </span><span class="keyword">- </span><span class="default">$oldBitCount </span><span class="keyword">&lt;&lt; </span><span class="default">$bitsPerCharacter </span><span class="keyword">- </span><span class="default">$oldBitCount</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$bitsRead </span><span class="keyword">+= </span><span class="default">$bitsPerCharacter </span><span class="keyword">- </span><span class="default">$oldBitCount</span><span class="keyword">;<br><br>&nbsp; &nbsp; &nbsp; &nbsp; if (</span><span class="default">$oldBitCount </span><span class="keyword">&gt; </span><span class="default">0</span><span class="keyword">) {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="comment">// Bits come from seperate bytes, add $oldBits to $bits<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$bits </span><span class="keyword">= (</span><span class="default">$oldBits </span><span class="keyword">&lt;&lt; </span><span class="default">$bitsPerCharacter </span><span class="keyword">- </span><span class="default">$oldBitCount</span><span class="keyword">) | </span><span class="default">$bits</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; }<br><br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$out </span><span class="keyword">.= </span><span class="default">$chars</span><span class="keyword">[</span><span class="default">$bits</span><span class="keyword">];<br>&nbsp; &nbsp; }<br><br>&nbsp; &nbsp; return </span><span class="default">$out</span><span class="keyword">;<br>}<br></span><span class="default">?&gt;</span>
</span>
</code></div>
  </div>
 </div>
  <div class="note" id="86172">  
  <a class="name">
  <strong class="user"><em>Andr D</em></strong></a><div class="date" title="2008-10-06 12:01"><strong>5 years ago</strong></div>
  <div class="text" id="Hcom86172">
<div class="phpcode"><code><span class="html">
Sometimes you want the digest in both readable notation (such as hexadecimal) and raw binary. At other times you want the digest in a notation other than hexadecimal.<br><br>The following getDigestNotation() function takes a binary string and returns it in base 2, 4, 8, 16, 32, or 64 notation. It works with sha1(), md5(), hash(), or anything else that can output a raw binary string.<br><br>It works similar to the session.hash_bits_per_character php.ini configuration option.<br><br>You can specify which characters to use for each position, or use the default, which matches session.hash_bits_per_character (0-9, a-z, A-Z, "-", ","). The practical range of bits to use per character ($bitsPerCharacter) is 1 to 6; you may use more, but you will have to provide your own base character string ($chars) that is at least pow(2, $bitsPerCharacter) characters long. So even with 7 bits per character you need to specify a value for $chars that is 128 characters long, which exceeds the number of printable ASCII characters.<br><br>The output's radix relates to the value of $bitsPerCharacter as follows:<br>1: base-2 (binary)<br>2: base-4<br>3: base-8 (octal)<br>4: base-16 (hexadecimal)<br>5: base-32<br>6: base-64<br><br><span class="default">&lt;?php<br>$raw </span><span class="keyword">= </span><span class="default">sha1</span><span class="keyword">(</span><span class="default">uniqid</span><span class="keyword">(</span><span class="default">mt_rand</span><span class="keyword">(), </span><span class="default">TRUE</span><span class="keyword">), </span><span class="default">TRUE</span><span class="keyword">);<br><br>echo </span><span class="default">getDigestNotation</span><span class="keyword">(</span><span class="default">$raw</span><span class="keyword">, </span><span class="default">6</span><span class="keyword">);<br><br>function </span><span class="default">getDigestNotation</span><span class="keyword">(</span><span class="default">$rawDigest</span><span class="keyword">, </span><span class="default">$bitsPerCharacter</span><span class="keyword">, </span><span class="default">$chars </span><span class="keyword">= </span><span class="default">NULL</span><span class="keyword">)<br>{<br>&nbsp; &nbsp; if (</span><span class="default">$chars </span><span class="keyword">=== </span><span class="default">NULL </span><span class="keyword">|| </span><span class="default">strlen</span><span class="keyword">(</span><span class="default">$chars</span><span class="keyword">) &lt; </span><span class="default">2</span><span class="keyword">) {<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$chars </span><span class="string">'0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ-,'</span><span class="keyword">;<br>&nbsp; &nbsp; }<br><br>&nbsp; &nbsp; if (</span><span class="default">$bitsPerCharacter </span><span class="keyword">&lt; </span><span class="default">1</span><span class="keyword">) {<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="comment">// $bitsPerCharacter must be at least 1<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$bitsPerCharacter </span><span class="keyword">= </span><span class="default">1</span><span class="keyword">;<br><br>&nbsp; &nbsp; } elseif (</span><span class="default">strlen</span><span class="keyword">(</span><span class="default">$chars</span><span class="keyword">) &lt; </span><span class="default">pow</span><span class="keyword">(</span><span class="default">2</span><span class="keyword">, </span><span class="default">$bitsPerCharacter</span><span class="keyword">)) {<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="comment">// Character length of $chars is too small for $bitsPerCharacter<br>&nbsp; &nbsp; &nbsp; &nbsp; // Set $bitsPerCharacter to greatest value allowed by length of $chars<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$bitsPerCharacter </span><span class="keyword">= </span><span class="default">1</span><span class="keyword">;<br><br>&nbsp; &nbsp; &nbsp; &nbsp; do {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$bitsPerCharacter</span><span class="keyword">++;<br>&nbsp; &nbsp; &nbsp; &nbsp; } while (</span><span class="default">strlen</span><span class="keyword">(</span><span class="default">$chars</span><span class="keyword">) &gt; </span><span class="default">pow</span><span class="keyword">(</span><span class="default">2</span><span class="keyword">, </span><span class="default">$bitsPerCharacter</span><span class="keyword">));<br>&nbsp; &nbsp; }<br><br>&nbsp; &nbsp; </span><span class="default">$bytes </span><span class="keyword">= </span><span class="default">unpack</span><span class="keyword">(</span><span class="string">'C*'</span><span class="keyword">, </span><span class="default">$rawDigest</span><span class="keyword">);<br>&nbsp; &nbsp; </span><span class="default">$byteCount </span><span class="keyword">= </span><span class="default">count</span><span class="keyword">(</span><span class="default">$bytes</span><span class="keyword">);<br><br>&nbsp; &nbsp; </span><span class="default">$out </span><span class="keyword">= </span><span class="string">''</span><span class="keyword">;<br>&nbsp; &nbsp; </span><span class="default">$byte </span><span class="keyword">= </span><span class="default">array_shift</span><span class="keyword">(</span><span class="default">$bytes</span><span class="keyword">);<br>&nbsp; &nbsp; </span><span class="default">$bitsRead </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">;<br><br>&nbsp; &nbsp; for (</span><span class="default">$i </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">; </span><span class="default">$i </span><span class="keyword">&lt; </span><span class="default">$byteCount </span><span class="keyword">* </span><span class="default">8 </span><span class="keyword">/ </span><span class="default">$bitsPerCharacter</span><span class="keyword">; </span><span class="default">$i</span><span class="keyword">++) {<br><br>&nbsp; &nbsp; &nbsp; &nbsp; if (</span><span class="default">$bitsRead </span><span class="keyword">+ </span><span class="default">$bitsPerCharacter </span><span class="keyword">&gt; </span><span class="default">8</span><span class="keyword">) {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="comment">// Not enough bits remain in this byte for the current character<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; // Get remaining bits and get next byte<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$oldBits </span><span class="keyword">= </span><span class="default">$byte </span><span class="keyword">- (</span><span class="default">$byte </span><span class="keyword">&gt;&gt; </span><span class="default">8 </span><span class="keyword">- </span><span class="default">$bitsRead </span><span class="keyword">&lt;&lt; </span><span class="default">8 </span><span class="keyword">- </span><span class="default">$bitsRead</span><span class="keyword">);<br><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if (</span><span class="default">count</span><span class="keyword">(</span><span class="default">$bytes</span><span class="keyword">) == </span><span class="default">0</span><span class="keyword">) {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="comment">// Last bits; match final character and exit loop<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$out </span><span class="keyword">.= </span><span class="default">$chars</span><span class="keyword">[</span><span class="default">$oldBits</span><span class="keyword">];<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; break;<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$oldBitCount </span><span class="keyword">= </span><span class="default">8 </span><span class="keyword">- </span><span class="default">$bitsRead</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$byte </span><span class="keyword">= </span><span class="default">array_shift</span><span class="keyword">(</span><span class="default">$bytes</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$bitsRead </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">;<br><br>&nbsp; &nbsp; &nbsp; &nbsp; } else {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$oldBitCount </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; }<br><br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="comment">// Read only the needed bits from this byte<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$bits </span><span class="keyword">= </span><span class="default">$byte </span><span class="keyword">&gt;&gt; </span><span class="default">8 </span><span class="keyword">- (</span><span class="default">$bitsRead </span><span class="keyword">+ (</span><span class="default">$bitsPerCharacter </span><span class="keyword">- </span><span class="default">$oldBitCount</span><span class="keyword">));<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$bits </span><span class="keyword">= </span><span class="default">$bits </span><span class="keyword">- (</span><span class="default">$bits </span><span class="keyword">&gt;&gt; </span><span class="default">$bitsPerCharacter </span><span class="keyword">- </span><span class="default">$oldBitCount </span><span class="keyword">&lt;&lt; </span><span class="default">$bitsPerCharacter </span><span class="keyword">- </span><span class="default">$oldBitCount</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$bitsRead </span><span class="keyword">+= </span><span class="default">$bitsPerCharacter </span><span class="keyword">- </span><span class="default">$oldBitCount</span><span class="keyword">;<br><br>&nbsp; &nbsp; &nbsp; &nbsp; if (</span><span class="default">$oldBitCount </span><span class="keyword">&gt; </span><span class="default">0</span><span class="keyword">) {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="comment">// Bits come from seperate bytes, add $oldBits to $bits<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$bits </span><span class="keyword">= (</span><span class="default">$oldBits </span><span class="keyword">&lt;&lt; </span><span class="default">$bitsPerCharacter </span><span class="keyword">- </span><span class="default">$oldBitCount</span><span class="keyword">) | </span><span class="default">$bits</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; }<br><br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$out </span><span class="keyword">.= </span><span class="default">$chars</span><span class="keyword">[</span><span class="default">$bits</span><span class="keyword">];<br>&nbsp; &nbsp; }<br><br>&nbsp; &nbsp; return </span><span class="default">$out</span><span class="keyword">;<br>}<br></span><span class="default">?&gt;<br></span><br>Lastly, depending on the digest length, there may be fewer bits remaining for the last character than $bitsPerCharacter, so the last character will be smaller. The same thing happens with PHP's session ID generator, when 5 or 6 is used for session.hash_bits_per_character.</span>
</code></div>
  </div>
 </div>
  <div class="note" id="101087">  
  <a class="name">
  <strong class="user"><em>rich dot sage at gmail dot com</em></strong></a><div class="date" title="2010-11-25 12:59"><strong>3 years ago</strong></div>
  <div class="text" id="Hcom101087">
<div class="phpcode"><code><span class="html">
If you're using Dovecot for mail retrieval and you want to generate SHA1 passwords yourself, you'll need to set the raw_output value to true, then base64_encode the output:<br><br><span class="default">&lt;?php<br></span><span class="keyword">function </span><span class="default">makeDovecotPassword</span><span class="keyword">(</span><span class="default">$input</span><span class="keyword">)<br>{<br>&nbsp; return </span><span class="string">'{SHA}' </span><span class="keyword">. </span><span class="default">base64_encode</span><span class="keyword">(</span><span class="default">sha1</span><span class="keyword">(</span><span class="default">$input</span><span class="keyword">, </span><span class="default">true</span><span class="keyword">));<br>}<br></span><span class="default">?&gt;</span>
</span>
</code></div>
  </div>
 </div>
  <div class="note" id="37442">  
  <a class="name">
  <strong class="user"><em>labarks</em></strong></a><div class="date" title="2003-11-15 03:06"><strong>10 years ago</strong></div>
  <div class="text" id="Hcom37442">
<div class="phpcode"><code><span class="html">
Append this to the your sha1lib file to make it more portable.&nbsp; If your version of php does support sha1() then it will try to use Mhash or else it will use the sha1lib.&nbsp; Use $sha1 if you want to display which is being used.<br><br>if ( function_exists('sha1') )<br>&nbsp; &nbsp; $sha1 = "sha1";<br><br>if ( !function_exists('sha1') &amp;&amp; function_exists('mhash'))<br>{<br>&nbsp; &nbsp; function sha1($hash_source) <br>&nbsp; &nbsp; {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $hash = mhash(MHASH_SHA1, $hash_source);<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $hex_hash = bin2hex($hash);<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return $hex_hash;<br>&nbsp; &nbsp; } <br>&nbsp; &nbsp; $sha1 = "Mhash";<br>}<br>if ( !function_exists('sha1') &amp;&amp; !function_exists('mhash'))<br>{<br>&nbsp; &nbsp; function sha1( $string, $raw_output = false )<br>&nbsp; &nbsp; {<br>&nbsp; &nbsp; &nbsp; &nbsp; $library = new Sha1Lib();<br>&nbsp; &nbsp; &nbsp; &nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; return $raw_output ? $library-&gt;str_sha1($string) : $library-&gt;hex_sha1($string);<br>&nbsp; &nbsp; }<br>&nbsp; &nbsp; $sha1 = "sha1lib";<br>}</span>
</code></div>
  </div>
 </div>
  <div class="note" id="81007">  
  <a class="name">
  <strong class="user"><em>ERASEthemasterswordsman at gmail dot com</em></strong></a><div class="date" title="2008-02-10 06:09"><strong>6 years ago</strong></div>
  <div class="text" id="Hcom81007">
<div class="phpcode"><code><span class="html">
Please note that hashing a has is not completely secure, but can be used as an extra precaution (but not recommended):<br><br><span class="default">&lt;?php<br><br>sha1</span><span class="keyword">(</span><span class="default">md5</span><span class="keyword">(</span><span class="default">$string</span><span class="keyword">));<br><br></span><span class="default">?&gt;</span>
</span>
</code></div>
  </div>
 </div></div>

 
</section>    </section><!-- layout-content -->
        


  </div><!-- layout -->
         
  

    
 <!-- External and third party libraries. -->
 







<a id="toTop" href="javascript:;"><span id="toTopHover"></span><img width="40" height="40" alt="To Top" src="../../images/to-top%402x.png"></a>



<!-- Mirrored from php.net/manual/en/function.sha1.php by HTTrack Website Copier/3.x [XR&CO'2013], Thu, 28 Aug 2014 15:54:54 GMT -->


</body></html>