<html><!-- Mirrored from php.net/manual/en/function.socket-recv.php by HTTrack Website Copier/3.x [XR&CO'2013], Thu, 28 Aug 2014 16:46:21 GMT --><!-- Added by HTTrack --><head><meta http-equiv="content-type" content="text/html;charset=utf-8"><!-- /Added by HTTrack -->


  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0"> 

  <title>socket_recv</title>

 <link rel="shortcut icon" href="../../favicon.ico">
 <link rel="search" type="application/opensearchdescription+xml" href="http://php.net/phpnetimprovedsearch.src" title="Add PHP.net search">
 <link rel="alternate" type="application/atom+xml" href="http://php.net/releases/feed.php" title="PHP Release feed">
 <link rel="alternate" type="application/atom+xml" href="http://php.net/feed.atom" title="PHP: Hypertext Preprocessor">

 <link rel="canonical" href="function.socket-recv.html">
 <link rel="shorturl" href="http://php.net/socket-recv">
 <link rel="alternate" href="http://php.net/socket-recv" hreflang="x-default">

 <link rel="contents" href="index-2.html">
 <link rel="index" href="ref.sockets.html">
 <link rel="prev" href="function.socket-read.html">
 <link rel="next" href="function.socket-recvfrom.html">

 <link rel="alternate" href="function.socket-recv.html" hreflang="en">
 <link rel="alternate" href="http://php.net/manual/pt_BR/function.socket-recv.php" hreflang="pt_BR">
 <link rel="alternate" href="http://php.net/manual/zh/function.socket-recv.php" hreflang="zh">
 <link rel="alternate" href="http://php.net/manual/fr/function.socket-recv.php" hreflang="fr">
 <link rel="alternate" href="http://php.net/manual/de/function.socket-recv.php" hreflang="de">
 <link rel="alternate" href="http://php.net/manual/it/function.socket-recv.php" hreflang="it">
 <link rel="alternate" href="http://php.net/manual/ja/function.socket-recv.php" hreflang="ja">
 <link rel="alternate" href="http://php.net/manual/ro/function.socket-recv.php" hreflang="ro">
 <link rel="alternate" href="http://php.net/manual/ru/function.socket-recv.php" hreflang="ru">
 <link rel="alternate" href="http://php.net/manual/es/function.socket-recv.php" hreflang="es">
 <link rel="alternate" href="http://php.net/manual/tr/function.socket-recv.php" hreflang="tr">

<link rel="stylesheet" type="text/css" href="../../cached8fe1.css?t=1401250819&amp;f=/fonts/Fira/fira.css" media="screen">
<link rel="stylesheet" type="text/css" href="../../cached4b8d.css?t=1404368420&amp;f=/fonts/Font-Awesome/css/fontello.css" media="screen">
<link rel="stylesheet" type="text/css" href="../../cached5065.css?t=1403329232&amp;f=/styles/theme-base.css" media="screen">
<link rel="stylesheet" type="text/css" href="../../cachedc78d.css?t=1401249623&amp;f=/styles/theme-medium.css" media="screen">

 <!--[if lte IE 7]>
 <link rel="stylesheet" type="text/css" href="http://php.net/styles/workarounds.ie7.css" media="screen">
 <![endif]-->

 <!--[if lte IE 8]>
 <script type="text/javascript">
  window.brokenIE = true;
 </script>
 <![endif]-->

 <!--[if lte IE 9]>
 <link rel="stylesheet" type="text/css" href="http://php.net/styles/workarounds.ie9.css" media="screen">
 <![endif]-->

 <!--[if IE]>
 <script type="text/javascript" src="http://php.net/js/ext/html5.js"></script>
 <![endif]-->

 <base>

</head>
<body class="docs " style="">


<div class="headsup"><a href="http://php.net/index.php#id2014-08-28-1">PHP 5.6.0 released</a></div>
<nav id="trick"><div><dl>
<dt><a href="getting-started.html">Getting Started</a></dt>
	<dd><a href="introduction.html">Introduction</a></dd>
	<dd><a href="tutorial.html">A simple tutorial</a></dd>
<dt><a href="langref.html">Language Reference</a></dt>
	<dd><a href="language.basic-syntax.html">Basic syntax</a></dd>
	<dd><a href="language.types.html">Types</a></dd>
	<dd><a href="language.variables.html">Variables</a></dd>
	<dd><a href="language.constants.html">Constants</a></dd>
	<dd><a href="language.expressions.html">Expressions</a></dd>
	<dd><a href="language.operators.html">Operators</a></dd>
	<dd><a href="language.control-structures.html">Control Structures</a></dd>
	<dd><a href="language.functions.html">Functions</a></dd>
	<dd><a href="language.oop5.html">Classes and Objects</a></dd>
	<dd><a href="language.namespaces.html">Namespaces</a></dd>
	<dd><a href="language.exceptions.html">Exceptions</a></dd>
	<dd><a href="language.generators.html">Generators</a></dd>
	<dd><a href="language.references.html">References Explained</a></dd>
	<dd><a href="reserved.variables.html">Predefined Variables</a></dd>
	<dd><a href="reserved.exceptions.html">Predefined Exceptions</a></dd>
	<dd><a href="reserved.interfaces.html">Predefined Interfaces and Classes</a></dd>
	<dd><a href="context.html">Context options and parameters</a></dd>
	<dd><a href="wrappers.html">Supported Protocols and Wrappers</a></dd>
</dl>
<dl>
<dt><a href="security.html">Security</a></dt>
	<dd><a href="security.intro.html">Introduction</a></dd>
	<dd><a href="security.general.html">General considerations</a></dd>
	<dd><a href="security.cgi-bin.html">Installed as CGI binary</a></dd>
	<dd><a href="security.apache.html">Installed as an Apache module</a></dd>
	<dd><a href="security.filesystem.html">Filesystem Security</a></dd>
	<dd><a href="security.database.html">Database Security</a></dd>
	<dd><a href="security.errors.html">Error Reporting</a></dd>
	<dd><a href="security.globals.html">Using Register Globals</a></dd>
	<dd><a href="security.variables.html">User Submitted Data</a></dd>
	<dd><a href="security.magicquotes.html">Magic Quotes</a></dd>
	<dd><a href="security.hiding.html">Hiding PHP</a></dd>
	<dd><a href="security.current.html">Keeping Current</a></dd>
<dt><a href="features.html">Features</a></dt>
	<dd><a href="features.http-auth.html">HTTP authentication with PHP</a></dd>
	<dd><a href="features.cookies.html">Cookies</a></dd>
	<dd><a href="features.sessions.html">Sessions</a></dd>
	<dd><a href="features.xforms.html">Dealing with XForms</a></dd>
	<dd><a href="features.file-upload.html">Handling file uploads</a></dd>
	<dd><a href="features.remote-files.html">Using remote files</a></dd>
	<dd><a href="features.connection-handling.html">Connection handling</a></dd>
	<dd><a href="features.persistent-connections.html">Persistent Database Connections</a></dd>
	<dd><a href="features.safe-mode.html">Safe Mode</a></dd>
	<dd><a href="features.commandline.html">Command line usage</a></dd>
	<dd><a href="features.gc.html">Garbage Collection</a></dd>
	<dd><a href="features.dtrace.html">DTrace Dynamic Tracing</a></dd>
</dl>
<dl>
<dt><a href="funcref.html">Function Reference</a></dt>
	<dd><a href="refs.basic.php.html">Affecting PHP's Behaviour</a></dd>
	<dd><a href="refs.utilspec.audio.html">Audio Formats Manipulation</a></dd>
	<dd><a href="refs.remote.auth.html">Authentication Services</a></dd>
	<dd><a href="refs.utilspec.cmdline.html">Command Line Specific Extensions</a></dd>
	<dd><a href="refs.compression.html">Compression and Archive Extensions</a></dd>
	<dd><a href="refs.creditcard.html">Credit Card Processing</a></dd>
	<dd><a href="refs.crypto.html">Cryptography Extensions</a></dd>
	<dd><a href="refs.database.html">Database Extensions</a></dd>
	<dd><a href="refs.calendar.html">Date and Time Related Extensions</a></dd>
	<dd><a href="refs.fileprocess.file.html">File System Related Extensions</a></dd>
	<dd><a href="refs.international.html">Human Language and Character Encoding Support</a></dd>
	<dd><a href="refs.utilspec.image.html">Image Processing and Generation</a></dd>
	<dd><a href="refs.remote.mail.html">Mail Related Extensions</a></dd>
	<dd><a href="refs.math.html">Mathematical Extensions</a></dd>
	<dd><a href="refs.utilspec.nontext.html">Non-Text MIME Output</a></dd>
	<dd><a href="refs.fileprocess.process.html">Process Control Extensions</a></dd>
	<dd><a href="refs.basic.other.html">Other Basic Extensions</a></dd>
	<dd><a href="refs.remote.other.html">Other Services</a></dd>
	<dd><a href="refs.search.html">Search Engine Extensions</a></dd>
	<dd><a href="refs.utilspec.server.html">Server Specific Extensions</a></dd>
	<dd><a href="refs.basic.session.html">Session Extensions</a></dd>
	<dd><a href="refs.basic.text.html">Text Processing</a></dd>
	<dd><a href="refs.basic.vartype.html">Variable and Type Related Extensions</a></dd>
	<dd><a href="refs.webservice.html">Web Services</a></dd>
	<dd><a href="refs.utilspec.windows.html">Windows Only Extensions</a></dd>
	<dd><a href="refs.xml.html">XML Manipulation</a></dd>
</dl>
<dl>
<dt>Keyboard Shortcuts</dt><dt>?</dt>
<dd>This help</dd>
<dt>j</dt>
<dd>Next menu item</dd>
<dt>k</dt>
<dd>Previous menu item</dd>
<dt>g p</dt>
<dd>Previous man page</dd>
<dt>g n</dt>
<dd>Next man page</dd>
<dt>G</dt>
<dd>Scroll to bottom</dd>
<dt>g g</dt>
<dd>Scroll to top</dd>
<dt>g h</dt>
<dd>Goto homepage</dd>
<dt>g s</dt>
<dd>Goto search<br>(current page)</dd>
<dt>/</dt>
<dd>Focus search box</dd>
</dl></div></nav>
<div id="goto">
    <div class="search">
         <div class="text"></div>
         <div class="results"><ul></ul></div>
   </div>
</div>

  <div id="breadcrumbs" class="row-fluid">
          
              
        <ul class="breadcrumbs-container">
            <li><a href="index-2.html">PHP Manual</a></li>      <li><a href="funcref.html">Function Reference</a></li>      <li><a href="refs.remote.other.html">Other Services</a></li>      <li><a href="book.sockets.html">Sockets</a></li>      <li><a href="ref.sockets.html">Socket Functions</a></li>    </ul>
  </div>




<div id="layout">
  <section id="layout-content">
  <div id="function.socket-recv" class="refentry">
 <div class="refnamediv">
  <h1 class="refname">socket_recv</h1>
  <p class="verinfo">(PHP 4 &gt;= 4.1.0, PHP 5)</p><p class="refpurpose"><span class="refname">socket_recv</span> â€” <span class="dc-title">Receives data from a connected socket </span></p>

 </div>
 
 <div class="refsect1 description" id="refsect1-function.socket-recv-description">
  <h3 class="title">Description</h3>
  <div class="methodsynopsis dc-description">
   <span class="type">int</span> <span class="methodname"><strong>socket_recv</strong></span>
    ( <span class="methodparam"><span class="type">resource</span> <code class="parameter">$socket</code></span>
   , <span class="methodparam"><span class="type">string</span> <code class="parameter reference">&amp;$buf</code></span>
   , <span class="methodparam"><span class="type">int</span> <code class="parameter">$len</code></span>
   , <span class="methodparam"><span class="type">int</span> <code class="parameter">$flags</code></span>
   )</div>

  <p class="para rdfs-comment">
   The <span class="function"><strong>socket_recv()</strong></span> function receives
   <code class="parameter">len</code> bytes of data in <code class="parameter">buf</code> from
   <code class="parameter">socket</code>. <span class="function"><strong>socket_recv()</strong></span> can
   be used to gather data from connected sockets. Additionally, one or
   more flags can be specified to modify the behaviour of the
   function.
  </p>
  <p class="para">
   <code class="parameter">buf</code> is passed by reference, so it must be
   specified as a variable in the argument list. Data read from
   <code class="parameter">socket</code> by <span class="function"><strong>socket_recv()</strong></span>
   will be returned in <code class="parameter">buf</code>.
  </p>
 </div>


 <div class="refsect1 parameters" id="refsect1-function.socket-recv-parameters">
  <h3 class="title">Parameters</h3>
  <p class="para">
   </p><dl>

    
     <dt>
<code class="parameter">socket</code></dt>

     <dd>

      <p class="para">
       The <code class="parameter">socket</code> must be a socket resource previously
       created by socket_create().
      </p>
     </dd>

    

    
     <dt>
<code class="parameter">buf</code></dt>

     <dd>

      <p class="para">
       The data received will be fetched to the variable specified with
       <code class="parameter">buf</code>. If an error occurs, if the
       connection is reset, or if no data is
       available, <code class="parameter">buf</code> will be set to <strong><code>NULL</code></strong>.
      </p>
     </dd>

    

    
     <dt>
<code class="parameter">len</code></dt>

     <dd>

      <p class="para">
       Up to <code class="parameter">len</code> bytes will be fetched from remote host.
      </p>
     </dd>

    

    
     <dt>
<code class="parameter">flags</code></dt>

     <dd>

      <p class="para">
       The value of <code class="parameter">flags</code> can be any combination of 
       the following flags, joined with the binary OR (<em>|</em>)
       operator.
      </p>
      
      <table class="doctable table">
       <caption><strong>Possible values for <code class="parameter">flags</code></strong></caption>
       
        <thead>
         <tr>
          <th>Flag</th>
          <th>Description</th>
         </tr>

        </thead>

        <tbody class="tbody">
         <tr>
          <td><strong><code>MSG_OOB</code></strong></td>
          <td>
           Process out-of-band data.
          </td>
         </tr>

         <tr>
          <td><strong><code>MSG_PEEK</code></strong></td>
          <td>
           Receive data from the beginning of the receive queue without
           removing it from the queue.
          </td>
         </tr>

         <tr>
          <td><strong><code>MSG_WAITALL</code></strong></td>
          <td>
           Block until at least <code class="parameter">len</code> are received.
           However, if a signal is caught or the remote host disconnects, the
           function may return less data.
          </td>
         </tr>

         <tr>
          <td><strong><code>MSG_DONTWAIT</code></strong></td>
          <td>
           With this flag set, the function returns even if it would normally
           have blocked.
          </td>
         </tr>

        </tbody>
       
      </table>

     </dd>

        
   </dl>

  <p></p>
 </div>


 <div class="refsect1 returnvalues" id="refsect1-function.socket-recv-returnvalues">
  <h3 class="title">Return Values</h3>
  <p class="para">
   <span class="function"><strong>socket_recv()</strong></span> returns the number of bytes received,
   or <strong><code>FALSE</code></strong> if there was an error. The actual error code can be retrieved by 
   calling <span class="function"><a href="function.socket-last-error.html" class="function">socket_last_error()</a></span>. This error code may be
   passed to <span class="function"><a href="function.socket-strerror.html" class="function">socket_strerror()</a></span> to get a textual explanation
   of the error.
  </p>
 </div>


 <div class="refsect1 examples" id="refsect1-function.socket-recv-examples">
  <h3 class="title">Examples</h3>
  <p class="para">
   </p><div class="example" id="example-4709">
    <p><strong>Example #1 <span class="function"><strong>socket_recv()</strong></span> example</strong></p>
    <div class="example-contents"><p>
     This example is a simple rewrite of the first example from
     <a href="sockets.examples.html" class="xref">Examples</a> to
     use <span class="function"><strong>socket_recv()</strong></span>.
    </p></div>
    <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br>error_reporting</span><span style="color: #007700">(</span><span style="color: #0000BB">E_ALL</span><span style="color: #007700">);<br><br>echo&nbsp;</span><span style="color: #DD0000">"&lt;h2&gt;TCP/IP&nbsp;Connection&lt;/h2&gt;\n"</span><span style="color: #007700">;<br><br></span><span style="color: #FF8000">/*&nbsp;Get&nbsp;the&nbsp;port&nbsp;for&nbsp;the&nbsp;WWW&nbsp;service.&nbsp;*/<br></span><span style="color: #0000BB">$service_port&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">getservbyname</span><span style="color: #007700">(</span><span style="color: #DD0000">'www'</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">'tcp'</span><span style="color: #007700">);<br><br></span><span style="color: #FF8000">/*&nbsp;Get&nbsp;the&nbsp;IP&nbsp;address&nbsp;for&nbsp;the&nbsp;target&nbsp;host.&nbsp;*/<br></span><span style="color: #0000BB">$address&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">gethostbyname</span><span style="color: #007700">(</span><span style="color: #DD0000">'www.example.com'</span><span style="color: #007700">);<br><br></span><span style="color: #FF8000">/*&nbsp;Create&nbsp;a&nbsp;TCP/IP&nbsp;socket.&nbsp;*/<br></span><span style="color: #0000BB">$socket&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">socket_create</span><span style="color: #007700">(</span><span style="color: #0000BB">AF_INET</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">SOCK_STREAM</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">SOL_TCP</span><span style="color: #007700">);<br>if&nbsp;(</span><span style="color: #0000BB">$socket&nbsp;</span><span style="color: #007700">===&nbsp;</span><span style="color: #0000BB">false</span><span style="color: #007700">)&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;echo&nbsp;</span><span style="color: #DD0000">"socket_create()&nbsp;failed:&nbsp;reason:&nbsp;"&nbsp;</span><span style="color: #007700">.&nbsp;</span><span style="color: #0000BB">socket_strerror</span><span style="color: #007700">(</span><span style="color: #0000BB">socket_last_error</span><span style="color: #007700">())&nbsp;.&nbsp;</span><span style="color: #DD0000">"\n"</span><span style="color: #007700">;<br>}&nbsp;else&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;echo&nbsp;</span><span style="color: #DD0000">"OK.\n"</span><span style="color: #007700">;<br>}<br><br>echo&nbsp;</span><span style="color: #DD0000">"Attempting&nbsp;to&nbsp;connect&nbsp;to&nbsp;'</span><span style="color: #0000BB">$address</span><span style="color: #DD0000">'&nbsp;on&nbsp;port&nbsp;'</span><span style="color: #0000BB">$service_port</span><span style="color: #DD0000">'..."</span><span style="color: #007700">;<br></span><span style="color: #0000BB">$result&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">socket_connect</span><span style="color: #007700">(</span><span style="color: #0000BB">$socket</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$address</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$service_port</span><span style="color: #007700">);<br>if&nbsp;(</span><span style="color: #0000BB">$result&nbsp;</span><span style="color: #007700">===&nbsp;</span><span style="color: #0000BB">false</span><span style="color: #007700">)&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;echo&nbsp;</span><span style="color: #DD0000">"socket_connect()&nbsp;failed.\nReason:&nbsp;(</span><span style="color: #0000BB">$result</span><span style="color: #DD0000">)&nbsp;"&nbsp;</span><span style="color: #007700">.&nbsp;</span><span style="color: #0000BB">socket_strerror</span><span style="color: #007700">(</span><span style="color: #0000BB">socket_last_error</span><span style="color: #007700">(</span><span style="color: #0000BB">$socket</span><span style="color: #007700">))&nbsp;.&nbsp;</span><span style="color: #DD0000">"\n"</span><span style="color: #007700">;<br>}&nbsp;else&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;echo&nbsp;</span><span style="color: #DD0000">"OK.\n"</span><span style="color: #007700">;<br>}<br><br></span><span style="color: #0000BB">$in&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #DD0000">"HEAD&nbsp;/&nbsp;HTTP/1.1\r\n"</span><span style="color: #007700">;<br></span><span style="color: #0000BB">$in&nbsp;</span><span style="color: #007700">.=&nbsp;</span><span style="color: #DD0000">"Host:&nbsp;www.example.com\r\n"</span><span style="color: #007700">;<br></span><span style="color: #0000BB">$in&nbsp;</span><span style="color: #007700">.=&nbsp;</span><span style="color: #DD0000">"Connection:&nbsp;Close\r\n\r\n"</span><span style="color: #007700">;<br></span><span style="color: #0000BB">$out&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #DD0000">''</span><span style="color: #007700">;<br><br>echo&nbsp;</span><span style="color: #DD0000">"Sending&nbsp;HTTP&nbsp;HEAD&nbsp;request..."</span><span style="color: #007700">;<br></span><span style="color: #0000BB">socket_write</span><span style="color: #007700">(</span><span style="color: #0000BB">$socket</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$in</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">strlen</span><span style="color: #007700">(</span><span style="color: #0000BB">$in</span><span style="color: #007700">));<br>echo&nbsp;</span><span style="color: #DD0000">"OK.\n"</span><span style="color: #007700">;<br><br>echo&nbsp;</span><span style="color: #DD0000">"Reading&nbsp;response:\n\n"</span><span style="color: #007700">;<br></span><span style="color: #0000BB">$buf&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #DD0000">'This&nbsp;is&nbsp;my&nbsp;buffer.'</span><span style="color: #007700">;<br>if&nbsp;(</span><span style="color: #0000BB">false&nbsp;</span><span style="color: #007700">!==&nbsp;(</span><span style="color: #0000BB">$bytes&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">socket_recv</span><span style="color: #007700">(</span><span style="color: #0000BB">$socket</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$buf</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">2048</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">MSG_WAITALL</span><span style="color: #007700">)))&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;echo&nbsp;</span><span style="color: #DD0000">"Read&nbsp;</span><span style="color: #0000BB">$bytes</span><span style="color: #DD0000">&nbsp;bytes&nbsp;from&nbsp;socket_recv().&nbsp;Closing&nbsp;socket..."</span><span style="color: #007700">;<br>}&nbsp;else&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;echo&nbsp;</span><span style="color: #DD0000">"socket_recv()&nbsp;failed;&nbsp;reason:&nbsp;"&nbsp;</span><span style="color: #007700">.&nbsp;</span><span style="color: #0000BB">socket_strerror</span><span style="color: #007700">(</span><span style="color: #0000BB">socket_last_error</span><span style="color: #007700">(</span><span style="color: #0000BB">$socket</span><span style="color: #007700">))&nbsp;.&nbsp;</span><span style="color: #DD0000">"\n"</span><span style="color: #007700">;<br>}<br></span><span style="color: #0000BB">socket_close</span><span style="color: #007700">(</span><span style="color: #0000BB">$socket</span><span style="color: #007700">);<br><br>echo&nbsp;</span><span style="color: #0000BB">$buf&nbsp;</span><span style="color: #007700">.&nbsp;</span><span style="color: #DD0000">"\n"</span><span style="color: #007700">;<br>echo&nbsp;</span><span style="color: #DD0000">"OK.\n\n"</span><span style="color: #007700">;<br></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
    </div>

    <div class="example-contents"><p>
     The above example will produce something like:
    </p></div>
    <div class="example-contents screen">
<div class="cdata"><pre>&lt;h2&gt;TCP/IP Connection&lt;/h2&gt;
OK.
Attempting to connect to '208.77.188.166' on port '80'...OK.
Sending HTTP HEAD request...OK.
Reading response:

Read 123 bytes from socket_recv(). Closing socket...HTTP/1.1 200 OK
Date: Mon, 14 Sep 2009 08:56:36 GMT
Server: Apache/2.2.3 (Red Hat)
Last-Modified: Tue, 15 Nov 2005 13:24:10 GMT
ETag: "b80f4-1b6-80bfd280"
Accept-Ranges: bytes
Content-Length: 438
Connection: close
Content-Type: text/html; charset=UTF-8

OK.
</pre></div>
    </div>
   </div>
  <p></p>
 </div>

                     
</div>
<section id="usernotes">
 <div class="head"><h3 class="title">User Contributed Notes</h3></div><div id="allnotes">
  <div class="note" id="47182">  
  <a class="name">
  <strong class="user"><em>dgk at tcde dot ru</em></strong></a><div class="date" title="2004-11-05 03:57"><strong>9 years ago</strong></div>
  <div class="text" id="Hcom47182">
<div class="phpcode"><code><span class="html">
I've used socket_select and socket_recv with a while loop and found myself in trouble when remote side closed connection. The code below produced infinite loop and socket_select returned immediately (which lead to high cpu time consumption).<br><br>&lt;?<br><br>socket_set_nonblock($my_socket);<br>$streams = array($my_socket/*, ... */);<br><br>$lastAccess = time();<br>while (socket_select($streams, $write = NULL, $except = NULL, SLEEP_TIME_SECONDS, SLEEP_TIME_MILLISECONDS) !== FALSE) {<br>&nbsp; &nbsp; if (in_array($my_socket, $streams)) {<br>&nbsp; &nbsp; &nbsp; &nbsp; while (@socket_recv($my_socket, $data, 8192, 0)) {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; echo $data;<br>&nbsp; &nbsp; &nbsp; &nbsp; }<br>&nbsp; &nbsp; &nbsp; &nbsp; $lastAccess = time();<br>&nbsp; &nbsp; } else {<br>&nbsp; &nbsp; &nbsp; &nbsp; if (time()-$lastAccess &gt; LAST_ACCESS_TIMEOUT) {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; break;<br>&nbsp; &nbsp; &nbsp; &nbsp; }<br>&nbsp; &nbsp; }<br>&nbsp; &nbsp; // ...<br>&nbsp; &nbsp; $streams = array($my_socket/*, ... */);<br>}<br><br>?&gt;<br><br>The solution was simple, but quite hard to find because socket_recv is not documented. socket_recv returns FALSE if there is no data and 0 if the socket is widowed (disconnected by remote side). So I had just to check return value of socket_recv. The problem now sounds stupid, but I've spend some time to find it out.<br>I hope this will save some of somebody's hair ;)</span>
</code></div>
  </div>
 </div>
  <div class="note" id="112728">  
  <a class="name">
  <strong class="user"><em>ss-130 at yandex dot ru</em></strong></a><div class="date" title="2013-07-17 11:09"><strong>1 year ago</strong></div>
  <div class="text" id="Hcom112728">
<div class="phpcode"><code><span class="html">
<span class="default">&lt;?php<br>$er </span><span class="keyword">= </span><span class="default">error_reporting</span><span class="keyword">(</span><span class="default">0</span><span class="keyword">);<br></span><span class="default">$bytes&nbsp; &nbsp; </span><span class="keyword">= </span><span class="default">socket_recv</span><span class="keyword">(</span><span class="default">$socket</span><span class="keyword">,</span><span class="default">$buffer</span><span class="keyword">,</span><span class="default">1</span><span class="keyword">,</span><span class="default">MSG_WAITALL</span><span class="keyword">);<br></span><span class="default">error_reporting</span><span class="keyword">(</span><span class="default">$er</span><span class="keyword">);<br><br></span><span class="comment">// MEGA BUG HERE<br>// this statuses are wrong and swapped, closed socket must be with "FALSE"<br>// but in fact he swap the values:<br>// <a rel="nofollow" target="_blank">http://php.net/manual/en/function.socket-recv.php</a><br>// <br></span><span class="keyword">if(</span><span class="default">$bytes</span><span class="keyword">===</span><span class="default">false</span><span class="keyword">){ </span><span class="comment">// no data available, socket not closed<br>&nbsp; &nbsp; </span><span class="keyword">echo </span><span class="string">'WS_READ_ERR1: '</span><span class="keyword">.</span><span class="default">socket_strerror</span><span class="keyword">(</span><span class="default">socket_last_error</span><span class="keyword">(</span><span class="default">$socket</span><span class="keyword">)).</span><span class="default">PHP_EOL</span><span class="keyword">;<br>&nbsp; &nbsp; </span><span class="comment">// print when no data available:<br>&nbsp; &nbsp; // WS_READ_ERR1: Resource temporarily unavailable<br>&nbsp; &nbsp; </span><span class="keyword">continue;<br>}else if(</span><span class="default">$bytes</span><span class="keyword">===</span><span class="default">0</span><span class="keyword">){ </span><span class="comment">// socket closed<br>&nbsp; &nbsp; </span><span class="keyword">echo </span><span class="string">'WS_READ_ERR2: '</span><span class="keyword">.</span><span class="default">socket_strerror</span><span class="keyword">(</span><span class="default">socket_last_error</span><span class="keyword">(</span><span class="default">$socket</span><span class="keyword">)).</span><span class="default">PHP_EOL</span><span class="keyword">;<br>&nbsp; &nbsp; </span><span class="comment">// print when socket closed:<br>&nbsp; &nbsp; // WS_READ_ERR2: Success<br>&nbsp; &nbsp; </span><span class="default">$process</span><span class="keyword">-&gt;</span><span class="default">close</span><span class="keyword">();<br>}<br><br></span><span class="default">?&gt;</span>
</span>
</code></div>
  </div>
 </div>
  <div class="note" id="107740">  
  <a class="name">
  <strong class="user"><em>davide dot renzi at gmail dot com</em></strong></a><div class="date" title="2012-03-01 08:50"><strong>2 years ago</strong></div>
  <div class="text" id="Hcom107740">
<div class="phpcode"><code><span class="html">
In PHP version 5.* there is a bug: MSG_DONTWAIT flag is not defined (see https://bugs.php.net/bug.php?id=48326)</span>
</code></div>
  </div>
 </div>
  <div class="note" id="52552">  
  <a class="name"><strong class="user"><em>Anonymous</em></strong></a><div class="date" title="2005-05-05 07:42"><strong>9 years ago</strong></div>
  <div class="text" id="Hcom52552">
<div class="phpcode"><code><span class="html">
I'm glad that Bastion left the above post about the mysterious int flag. He just helped to fix a problem that I've spent six hours on. Here's my code:<br><br>for($ct=1; $ct&lt;=$numrecs; $ct++) {<br>&nbsp; &nbsp;&nbsp; $rec = "";<br>&nbsp; &nbsp;&nbsp; $nr=socket_recv($fp,$rec,77,0);<br>&nbsp; &nbsp;&nbsp; print "Rec # $ct --&gt;";<br>&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; print "$rec";<br>&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; print "&lt;br&gt;";<br>&nbsp; &nbsp; &nbsp; }<br><br>The code is pretty simple, it just loops through all my records and prints them out. All records are 77 bytes and all end with a period. The first 36 records print perfectly then at 37 things go bad. The records start to get offset. The last few characters of the 37th record end up printing on the 38th record. The data on the sending side was perfect, so I knew that the problem was with socked_recv.<br><br>After reading the above post I tried changing the int flag. Changing the flag to 2 worked:<br>$nr=socket_recv($fp,$rec,77,2);<br><br>Now everything lines up perfectly. I had always left int flag as 0 since it's undocumented. <br><br>Martin K.</span>
</code></div>
  </div>
 </div>
  <div class="note" id="115372">  
  <a class="name">
  <strong class="user"><em>m_lajos at hotmail dot com</em></strong></a><div class="date" title="2014-07-14 03:45"><strong>1 month ago</strong></div>
  <div class="text" id="Hcom115372">
<div class="phpcode"><code><span class="html">
Workaround for the missing MSG_DONTWAIT flag according to the bug report page:<br><br><span class="default">&lt;?php </span><span class="keyword">if(!</span><span class="default">defined</span><span class="keyword">(</span><span class="string">'MSG_DONTWAIT'</span><span class="keyword">)) </span><span class="default">define</span><span class="keyword">(</span><span class="string">'MSG_DONTWAIT'</span><span class="keyword">, </span><span class="default">0x40</span><span class="keyword">); </span><span class="default">?&gt;</span>
</span>
</code></div>
  </div>
 </div>
  <div class="note" id="56161">  
  <a class="name">
  <strong class="user"><em>rathamahata at rathamahata dot net</em></strong></a><div class="date" title="2005-08-25 04:44"><strong>9 years ago</strong></div>
  <div class="text" id="Hcom56161">
<div class="phpcode"><code><span class="html">
It looks like that mysterious flags are just the recv(2) flags passed to your OS syscall and nothing more...<br><br>ext/sockets/sockets.c:PHP_FUNCTION(socket_recv)<br>...<br>&nbsp; &nbsp; &nbsp; &nbsp; if ((retval = recv(php_sock-&gt;bsd_socket, recv_buf, len, flags)) &lt; 1) {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; efree(recv_buf);<br>...<br><br>for linux you can type `man 2 recv' and you will see complete description of thouse flags.<br><br>Sergey S. Kosrtyliov &lt;rathamahata@rathamahata.net&gt;<br><a rel="nofollow" target="_blank">http://www.rathamahata.net/</a></span>
</code></div>
  </div>
 </div>
  <div class="note" id="47789">  
  <a class="name">
  <strong class="user"><em>engine at [NO SPAM] illusiononly dot com</em></strong></a><div class="date" title="2004-11-30 04:58"><strong>9 years ago</strong></div>
  <div class="text" id="Hcom47789">
<div class="phpcode"><code><span class="html">
To read from socket both on linux and windows OS having&nbsp; flash as a client I use function bellow. $length is the size of&nbsp; a chunk, not the max length to read. It will continue reading until EOL char&nbsp; occures or client disconnects (or in case of error), so it works for bigger packets as well.<br><br>&nbsp; &nbsp;&nbsp; function read($descriptor, $length = 1024) {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $this-&gt;method = "read";<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if(!$client){<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; echo("No valid socket descriptor !\n");<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; return false;<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $read ='';<br>&nbsp; &nbsp; &nbsp; &nbsp; while(($flag=socket_recv($descriptor, $buf, $length,0))&gt;0){<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $asc=ord(substr($buf, -1));<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if ($asc==0) {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $read.=substr($buf,0,-1);<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; break;<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }else{<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $read.=$buf;<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br>&nbsp; &nbsp; &nbsp; &nbsp; }<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if ($flag&lt;0){<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; //error<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; return false;<br>&nbsp; &nbsp; &nbsp; &nbsp; }elseif ($flag==0){<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; //Client disconnected<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; return&nbsp; false;<br>&nbsp; &nbsp; &nbsp; &nbsp; }else{<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; return $read;<br>&nbsp; &nbsp; &nbsp; &nbsp; }<br><br>&nbsp; &nbsp;&nbsp; }</span>
</code></div>
  </div>
 </div>
  <div class="note" id="41278">  
  <a class="name">
  <strong class="user"><em>bastiaan at [no-spam] megabass dot nl</em></strong></a><div class="date" title="2004-04-05 09:35"><strong>10 years ago</strong></div>
  <div class="text" id="Hcom41278">
<div class="phpcode"><code><span class="html">
in case you want to empty/unset $buffer, but failing to do so, try using 0 as flag.<br>PHP_NORMAL_READ and PHP_BINARY_READ respectively hold 1 and 2 as value.</span>
</code></div>
  </div>
 </div>
  <div class="note" id="52582">  
  <a class="name"><strong class="user"><em>Anonymous</em></strong></a><div class="date" title="2005-05-06 04:59"><strong>9 years ago</strong></div>
  <div class="text" id="Hcom52582">
<div class="phpcode"><code><span class="html">
My last post was incorrect. The int flag set to 2 apparently reset the file position pointer so what I was reading was the first record repeatedly. <br><br>My workaroud ended up being the following:<br><br>for($ct=1; $ct&lt;=$numrecs; $ct++) {<br>&nbsp; &nbsp; $rec = "";<br>&nbsp; &nbsp; $nr=socket_recv($fp,$rec,76,0);<br>&nbsp; &nbsp; &nbsp; &nbsp; <br>&nbsp; &nbsp; //grab the extra bytes.<br>&nbsp; &nbsp; $terminator = "";<br>&nbsp; &nbsp; while ($terminator != ".") {<br>&nbsp; &nbsp; &nbsp; &nbsp; $nr=socket_recv($fp,$terminator,1,0);<br>&nbsp; &nbsp; }<br>&nbsp; &nbsp; <br>&nbsp; &nbsp;&nbsp; $custarray[]=substr($rec,0,76);&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <br>}<br><br>Martin K.</span>
</code></div>
  </div>
 </div></div>

 
</section>    </section><!-- layout-content -->
        


  </div><!-- layout -->
         
  

    
 <!-- External and third party libraries. -->
 







<a id="toTop" href="javascript:;"><span id="toTopHover"></span><img width="40" height="40" alt="To Top" src="../../images/to-top%402x.png"></a>



<!-- Mirrored from php.net/manual/en/function.socket-recv.php by HTTrack Website Copier/3.x [XR&CO'2013], Thu, 28 Aug 2014 16:46:21 GMT -->


</body></html>