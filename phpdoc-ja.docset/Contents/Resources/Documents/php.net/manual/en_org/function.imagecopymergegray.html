<html><!-- Mirrored from php.net/manual/en/function.imagecopymergegray.php by HTTrack Website Copier/3.x [XR&CO'2013], Thu, 28 Aug 2014 16:01:04 GMT --><!-- Added by HTTrack --><head><meta http-equiv="content-type" content="text/html;charset=utf-8"><!-- /Added by HTTrack -->


  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0"> 

  <title>imagecopymergegray</title>

 <link rel="shortcut icon" href="../../favicon.ico">
 <link rel="search" type="application/opensearchdescription+xml" href="http://php.net/phpnetimprovedsearch.src" title="Add PHP.net search">
 <link rel="alternate" type="application/atom+xml" href="http://php.net/releases/feed.php" title="PHP Release feed">
 <link rel="alternate" type="application/atom+xml" href="http://php.net/feed.atom" title="PHP: Hypertext Preprocessor">

 <link rel="canonical" href="function.imagecopymergegray.html">
 <link rel="shorturl" href="http://php.net/imagecopymergegray">
 <link rel="alternate" href="http://php.net/imagecopymergegray" hreflang="x-default">

 <link rel="contents" href="index-2.html">
 <link rel="index" href="ref.image.html">
 <link rel="prev" href="function.imagecopymerge.html">
 <link rel="next" href="function.imagecopyresampled.html">

 <link rel="alternate" href="function.imagecopymergegray.html" hreflang="en">
 <link rel="alternate" href="http://php.net/manual/pt_BR/function.imagecopymergegray.php" hreflang="pt_BR">
 <link rel="alternate" href="http://php.net/manual/zh/function.imagecopymergegray.php" hreflang="zh">
 <link rel="alternate" href="http://php.net/manual/fr/function.imagecopymergegray.php" hreflang="fr">
 <link rel="alternate" href="http://php.net/manual/de/function.imagecopymergegray.php" hreflang="de">
 <link rel="alternate" href="http://php.net/manual/it/function.imagecopymergegray.php" hreflang="it">
 <link rel="alternate" href="http://php.net/manual/ja/function.imagecopymergegray.php" hreflang="ja">
 <link rel="alternate" href="http://php.net/manual/ro/function.imagecopymergegray.php" hreflang="ro">
 <link rel="alternate" href="http://php.net/manual/ru/function.imagecopymergegray.php" hreflang="ru">
 <link rel="alternate" href="http://php.net/manual/es/function.imagecopymergegray.php" hreflang="es">
 <link rel="alternate" href="http://php.net/manual/tr/function.imagecopymergegray.php" hreflang="tr">

<link rel="stylesheet" type="text/css" href="../../cached8fe1.css?t=1401250819&amp;f=/fonts/Fira/fira.css" media="screen">
<link rel="stylesheet" type="text/css" href="../../cached4b8d.css?t=1404368420&amp;f=/fonts/Font-Awesome/css/fontello.css" media="screen">
<link rel="stylesheet" type="text/css" href="../../cached5065.css?t=1403329232&amp;f=/styles/theme-base.css" media="screen">
<link rel="stylesheet" type="text/css" href="../../cachedc78d.css?t=1401249623&amp;f=/styles/theme-medium.css" media="screen">

 <!--[if lte IE 7]>
 <link rel="stylesheet" type="text/css" href="http://php.net/styles/workarounds.ie7.css" media="screen">
 <![endif]-->

 <!--[if lte IE 8]>
 <script type="text/javascript">
  window.brokenIE = true;
 </script>
 <![endif]-->

 <!--[if lte IE 9]>
 <link rel="stylesheet" type="text/css" href="http://php.net/styles/workarounds.ie9.css" media="screen">
 <![endif]-->

 <!--[if IE]>
 <script type="text/javascript" src="http://php.net/js/ext/html5.js"></script>
 <![endif]-->

 <base>

</head>
<body class="docs " style="">


<div class="headsup"><a href="http://php.net/index.php#id2014-08-28-1">PHP 5.6.0 released</a></div>
<nav id="trick"><div><dl>
<dt><a href="getting-started.html">Getting Started</a></dt>
	<dd><a href="introduction.html">Introduction</a></dd>
	<dd><a href="tutorial.html">A simple tutorial</a></dd>
<dt><a href="langref.html">Language Reference</a></dt>
	<dd><a href="language.basic-syntax.html">Basic syntax</a></dd>
	<dd><a href="language.types.html">Types</a></dd>
	<dd><a href="language.variables.html">Variables</a></dd>
	<dd><a href="language.constants.html">Constants</a></dd>
	<dd><a href="language.expressions.html">Expressions</a></dd>
	<dd><a href="language.operators.html">Operators</a></dd>
	<dd><a href="language.control-structures.html">Control Structures</a></dd>
	<dd><a href="language.functions.html">Functions</a></dd>
	<dd><a href="language.oop5.html">Classes and Objects</a></dd>
	<dd><a href="language.namespaces.html">Namespaces</a></dd>
	<dd><a href="language.exceptions.html">Exceptions</a></dd>
	<dd><a href="language.generators.html">Generators</a></dd>
	<dd><a href="language.references.html">References Explained</a></dd>
	<dd><a href="reserved.variables.html">Predefined Variables</a></dd>
	<dd><a href="reserved.exceptions.html">Predefined Exceptions</a></dd>
	<dd><a href="reserved.interfaces.html">Predefined Interfaces and Classes</a></dd>
	<dd><a href="context.html">Context options and parameters</a></dd>
	<dd><a href="wrappers.html">Supported Protocols and Wrappers</a></dd>
</dl>
<dl>
<dt><a href="security.html">Security</a></dt>
	<dd><a href="security.intro.html">Introduction</a></dd>
	<dd><a href="security.general.html">General considerations</a></dd>
	<dd><a href="security.cgi-bin.html">Installed as CGI binary</a></dd>
	<dd><a href="security.apache.html">Installed as an Apache module</a></dd>
	<dd><a href="security.filesystem.html">Filesystem Security</a></dd>
	<dd><a href="security.database.html">Database Security</a></dd>
	<dd><a href="security.errors.html">Error Reporting</a></dd>
	<dd><a href="security.globals.html">Using Register Globals</a></dd>
	<dd><a href="security.variables.html">User Submitted Data</a></dd>
	<dd><a href="security.magicquotes.html">Magic Quotes</a></dd>
	<dd><a href="security.hiding.html">Hiding PHP</a></dd>
	<dd><a href="security.current.html">Keeping Current</a></dd>
<dt><a href="features.html">Features</a></dt>
	<dd><a href="features.http-auth.html">HTTP authentication with PHP</a></dd>
	<dd><a href="features.cookies.html">Cookies</a></dd>
	<dd><a href="features.sessions.html">Sessions</a></dd>
	<dd><a href="features.xforms.html">Dealing with XForms</a></dd>
	<dd><a href="features.file-upload.html">Handling file uploads</a></dd>
	<dd><a href="features.remote-files.html">Using remote files</a></dd>
	<dd><a href="features.connection-handling.html">Connection handling</a></dd>
	<dd><a href="features.persistent-connections.html">Persistent Database Connections</a></dd>
	<dd><a href="features.safe-mode.html">Safe Mode</a></dd>
	<dd><a href="features.commandline.html">Command line usage</a></dd>
	<dd><a href="features.gc.html">Garbage Collection</a></dd>
	<dd><a href="features.dtrace.html">DTrace Dynamic Tracing</a></dd>
</dl>
<dl>
<dt><a href="funcref.html">Function Reference</a></dt>
	<dd><a href="refs.basic.php.html">Affecting PHP's Behaviour</a></dd>
	<dd><a href="refs.utilspec.audio.html">Audio Formats Manipulation</a></dd>
	<dd><a href="refs.remote.auth.html">Authentication Services</a></dd>
	<dd><a href="refs.utilspec.cmdline.html">Command Line Specific Extensions</a></dd>
	<dd><a href="refs.compression.html">Compression and Archive Extensions</a></dd>
	<dd><a href="refs.creditcard.html">Credit Card Processing</a></dd>
	<dd><a href="refs.crypto.html">Cryptography Extensions</a></dd>
	<dd><a href="refs.database.html">Database Extensions</a></dd>
	<dd><a href="refs.calendar.html">Date and Time Related Extensions</a></dd>
	<dd><a href="refs.fileprocess.file.html">File System Related Extensions</a></dd>
	<dd><a href="refs.international.html">Human Language and Character Encoding Support</a></dd>
	<dd><a href="refs.utilspec.image.html">Image Processing and Generation</a></dd>
	<dd><a href="refs.remote.mail.html">Mail Related Extensions</a></dd>
	<dd><a href="refs.math.html">Mathematical Extensions</a></dd>
	<dd><a href="refs.utilspec.nontext.html">Non-Text MIME Output</a></dd>
	<dd><a href="refs.fileprocess.process.html">Process Control Extensions</a></dd>
	<dd><a href="refs.basic.other.html">Other Basic Extensions</a></dd>
	<dd><a href="refs.remote.other.html">Other Services</a></dd>
	<dd><a href="refs.search.html">Search Engine Extensions</a></dd>
	<dd><a href="refs.utilspec.server.html">Server Specific Extensions</a></dd>
	<dd><a href="refs.basic.session.html">Session Extensions</a></dd>
	<dd><a href="refs.basic.text.html">Text Processing</a></dd>
	<dd><a href="refs.basic.vartype.html">Variable and Type Related Extensions</a></dd>
	<dd><a href="refs.webservice.html">Web Services</a></dd>
	<dd><a href="refs.utilspec.windows.html">Windows Only Extensions</a></dd>
	<dd><a href="refs.xml.html">XML Manipulation</a></dd>
</dl>
<dl>
<dt>Keyboard Shortcuts</dt><dt>?</dt>
<dd>This help</dd>
<dt>j</dt>
<dd>Next menu item</dd>
<dt>k</dt>
<dd>Previous menu item</dd>
<dt>g p</dt>
<dd>Previous man page</dd>
<dt>g n</dt>
<dd>Next man page</dd>
<dt>G</dt>
<dd>Scroll to bottom</dd>
<dt>g g</dt>
<dd>Scroll to top</dd>
<dt>g h</dt>
<dd>Goto homepage</dd>
<dt>g s</dt>
<dd>Goto search<br>(current page)</dd>
<dt>/</dt>
<dd>Focus search box</dd>
</dl></div></nav>
<div id="goto">
    <div class="search">
         <div class="text"></div>
         <div class="results"><ul></ul></div>
   </div>
</div>

  <div id="breadcrumbs" class="row-fluid">
          
              
        <ul class="breadcrumbs-container">
            <li><a href="index-2.html">PHP Manual</a></li>      <li><a href="funcref.html">Function Reference</a></li>      <li><a href="refs.utilspec.image.html">Image Processing and Generation</a></li>      <li><a href="book.image.html">GD</a></li>      <li><a href="ref.image.html">GD and Image Functions</a></li>    </ul>
  </div>




<div id="layout">
  <section id="layout-content">
  <div id="function.imagecopymergegray" class="refentry">
 <div class="refnamediv">
  <h1 class="refname">imagecopymergegray</h1>
  <p class="verinfo">(PHP 4 &gt;= 4.0.6, PHP 5)</p><p class="refpurpose"><span class="refname">imagecopymergegray</span> â€” <span class="dc-title">Copy and merge part of an image with gray scale</span></p>

 </div>
 <div class="refsect1 description" id="refsect1-function.imagecopymergegray-description">
  <h3 class="title">Description</h3>
  <div class="methodsynopsis dc-description">
   <span class="type">bool</span> <span class="methodname"><strong>imagecopymergegray</strong></span>
    ( <span class="methodparam"><span class="type">resource</span> <code class="parameter">$dst_im</code></span>
   , <span class="methodparam"><span class="type">resource</span> <code class="parameter">$src_im</code></span>
   , <span class="methodparam"><span class="type">int</span> <code class="parameter">$dst_x</code></span>
   , <span class="methodparam"><span class="type">int</span> <code class="parameter">$dst_y</code></span>
   , <span class="methodparam"><span class="type">int</span> <code class="parameter">$src_x</code></span>
   , <span class="methodparam"><span class="type">int</span> <code class="parameter">$src_y</code></span>
   , <span class="methodparam"><span class="type">int</span> <code class="parameter">$src_w</code></span>
   , <span class="methodparam"><span class="type">int</span> <code class="parameter">$src_h</code></span>
   , <span class="methodparam"><span class="type">int</span> <code class="parameter">$pct</code></span>
   )</div>

  <p class="para rdfs-comment">
   <span class="function"><strong>imagecopymergegray()</strong></span> copy a part of <code class="parameter">src_im</code> onto
   <code class="parameter">dst_im</code> starting at the x,y coordinates
   <code class="parameter">src_x</code>, <code class="parameter">src_y </code> with
   a width of <code class="parameter">src_w</code> and a height of
   <code class="parameter">src_h</code>.  The portion defined will be copied
   onto the x,y coordinates, <code class="parameter">dst_x</code> and
   <code class="parameter">dst_y</code>.
  </p>
  <p class="para">
   This function is identical to <span class="function"><a href="function.imagecopymerge.html" class="function">imagecopymerge()</a></span> except
   that when merging it preserves the hue of the source by converting
   the destination pixels to gray scale before the copy operation.
  </p>
 </div>

 <div class="refsect1 parameters" id="refsect1-function.imagecopymergegray-parameters">
  <h3 class="title">Parameters</h3>
  <p class="para">
   </p><dl>

    
     <dt>
<code class="parameter">dst_im</code></dt>

     <dd>

      <p class="para">Destination image link resource.</p>
     </dd>

    
    
     <dt>
<code class="parameter">src_im</code></dt>

     <dd>

      <p class="para">Source image link resource.</p>
     </dd>

    
    
     <dt>
<code class="parameter">dst_x</code></dt>

     <dd>

      <p class="para">
       x-coordinate of destination point.
      </p>
     </dd>

    
    
     <dt>
<code class="parameter">dst_y</code></dt>

     <dd>

      <p class="para">
       y-coordinate of destination point.
      </p>
     </dd>

    
    
     <dt>
<code class="parameter">src_x</code></dt>

     <dd>

      <p class="para">
       x-coordinate of source point.
      </p>
     </dd>

    
    
     <dt>
<code class="parameter">src_y</code></dt>

     <dd>

      <p class="para">
       y-coordinate of source point.
      </p>
     </dd>

    
    
     <dt>
<code class="parameter">src_w</code></dt>

     <dd>

      <p class="para">Source width.</p>
     </dd>

    
    
     <dt>
<code class="parameter">src_h</code></dt>

     <dd>

      <p class="para">Source height.</p>
     </dd>

    
    
     <dt>
<code class="parameter">pct</code></dt>

     <dd>

      <p class="para">
        The <code class="parameter">src_im</code> will be changed to grayscale according 
        to <code class="parameter">pct</code> where 0 is fully grayscale and 100 is 
        unchanged. When <code class="parameter">pct</code> = 100 this function behaves 
        identically to <span class="function"><a href="function.imagecopy.html" class="function">imagecopy()</a></span> for pallete images, except for
        ignoring alpha components, while
        it implements alpha transparency for true colour images.
      </p>
     </dd>

    
   </dl>

  <p></p>
 </div>

 <div class="refsect1 returnvalues" id="refsect1-function.imagecopymergegray-returnvalues">
  <h3 class="title">Return Values</h3>
  <p class="para">
   Returns <strong><code>TRUE</code></strong> on success or <strong><code>FALSE</code></strong> on failure.
  </p>
 </div>

 <div class="refsect1 examples" id="refsect1-function.imagecopymergegray-examples">
  <h3 class="title">Examples</h3>
  <p class="para">
   </p><div class="example" id="example-3298">
    <p><strong>Example #1 <span class="function"><strong>imagecopymergegray()</strong></span> usage</strong></p>
    <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br></span><span style="color: #FF8000">//&nbsp;Create&nbsp;image&nbsp;instances<br></span><span style="color: #0000BB">$dest&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">imagecreatefromgif</span><span style="color: #007700">(</span><span style="color: #DD0000">'php.gif'</span><span style="color: #007700">);<br></span><span style="color: #0000BB">$src&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">imagecreatefromgif</span><span style="color: #007700">(</span><span style="color: #DD0000">'php.gif'</span><span style="color: #007700">);<br><br></span><span style="color: #FF8000">//&nbsp;Copy&nbsp;and&nbsp;merge&nbsp;-&nbsp;Gray&nbsp;=&nbsp;20%<br></span><span style="color: #0000BB">imagecopymergegray</span><span style="color: #007700">(</span><span style="color: #0000BB">$dest</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$src</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">10</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">10</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">0</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">0</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">100</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">47</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">20</span><span style="color: #007700">);<br><br></span><span style="color: #FF8000">//&nbsp;Output&nbsp;and&nbsp;free&nbsp;from&nbsp;memory<br></span><span style="color: #0000BB">header</span><span style="color: #007700">(</span><span style="color: #DD0000">'Content-Type:&nbsp;image/gif'</span><span style="color: #007700">);<br></span><span style="color: #0000BB">imagegif</span><span style="color: #007700">(</span><span style="color: #0000BB">$dest</span><span style="color: #007700">);<br><br></span><span style="color: #0000BB">imagedestroy</span><span style="color: #007700">(</span><span style="color: #0000BB">$dest</span><span style="color: #007700">);<br></span><span style="color: #0000BB">imagedestroy</span><span style="color: #007700">(</span><span style="color: #0000BB">$src</span><span style="color: #007700">);<br></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
    </div>

   </div>
  <p></p>
 </div>

</div>
<section id="usernotes">
 <div class="head"><h3 class="title">User Contributed Notes</h3></div><div id="allnotes">
  <div class="note" id="83104">  
  <a class="name">
  <strong class="user"><em>amezghal at msn dot com</em></strong></a><div class="date" title="2008-05-09 05:59"><strong>6 years ago</strong></div>
  <div class="text" id="Hcom83104">
<div class="phpcode"><code><span class="html">
gray effect :)<br><span class="default">&lt;?php<br>header</span><span class="keyword">(</span><span class="string">'content-type:image/png'</span><span class="keyword">);<br></span><span class="default">$url_img </span><span class="keyword">= </span><span class="string">'my_image.png'</span><span class="keyword">;<br></span><span class="default">$img </span><span class="keyword">= </span><span class="default">imagecreatefrompng</span><span class="keyword">(</span><span class="default">$url_img</span><span class="keyword">);<br></span><span class="default">$x </span><span class="keyword">= </span><span class="default">imagesx</span><span class="keyword">(</span><span class="default">$img</span><span class="keyword">);<br></span><span class="default">$y </span><span class="keyword">= </span><span class="default">imagesy</span><span class="keyword">(</span><span class="default">$img</span><span class="keyword">);<br></span><span class="default">$gray_img </span><span class="keyword">= </span><span class="default">imagecreatetruecolor</span><span class="keyword">(</span><span class="default">$x</span><span class="keyword">, </span><span class="default">$y</span><span class="keyword">);<br></span><span class="default">imagecolorallocate</span><span class="keyword">(</span><span class="default">$gray_img</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">);<br>for (</span><span class="default">$i </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">; </span><span class="default">$i </span><span class="keyword">&lt; </span><span class="default">$x</span><span class="keyword">; </span><span class="default">$i</span><span class="keyword">++) {<br>&nbsp; for (</span><span class="default">$j </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">; </span><span class="default">$j </span><span class="keyword">&lt; </span><span class="default">$y</span><span class="keyword">; </span><span class="default">$j</span><span class="keyword">++) {<br>&nbsp; &nbsp; </span><span class="default">$rgb </span><span class="keyword">= </span><span class="default">imagecolorat</span><span class="keyword">(</span><span class="default">$img</span><span class="keyword">, </span><span class="default">$i</span><span class="keyword">, </span><span class="default">$j</span><span class="keyword">);<br>&nbsp; &nbsp; </span><span class="default">$r </span><span class="keyword">= (</span><span class="default">$rgb </span><span class="keyword">&gt;&gt; </span><span class="default">16</span><span class="keyword">) &amp; </span><span class="default">0xFF</span><span class="keyword">;<br>&nbsp; &nbsp; </span><span class="default">$g </span><span class="keyword">= (</span><span class="default">$rgb </span><span class="keyword">&gt;&gt; </span><span class="default">8</span><span class="keyword">) &amp; </span><span class="default">0xFF</span><span class="keyword">;<br>&nbsp; &nbsp; </span><span class="default">$b </span><span class="keyword">= </span><span class="default">$rgb </span><span class="keyword">&amp; </span><span class="default">0xFF</span><span class="keyword">;<br>&nbsp; &nbsp;&nbsp; </span><span class="comment">//for gray mode $r = $g = $b<br>&nbsp; &nbsp; </span><span class="default">$color </span><span class="keyword">= </span><span class="default">max</span><span class="keyword">(array(</span><span class="default">$r</span><span class="keyword">, </span><span class="default">$g</span><span class="keyword">, </span><span class="default">$b</span><span class="keyword">));<br>&nbsp; &nbsp; </span><span class="default">$gray_color </span><span class="keyword">= </span><span class="default">imagecolorexact</span><span class="keyword">(</span><span class="default">$new_img</span><span class="keyword">, </span><span class="default">$color</span><span class="keyword">, </span><span class="default">$color</span><span class="keyword">,&nbsp;&nbsp; </span><span class="default">$color</span><span class="keyword">);<br>&nbsp; &nbsp;&nbsp; </span><span class="default">imagesetpixel</span><span class="keyword">(</span><span class="default">$gray_img</span><span class="keyword">, </span><span class="default">$i</span><span class="keyword">, </span><span class="default">$j</span><span class="keyword">, </span><span class="default">$gray_color</span><span class="keyword">);<br>&nbsp;&nbsp; }<br>}<br></span><span class="default">?&gt;</span>
</span>
</code></div>
  </div>
 </div>
  <div class="note" id="55853">  
  <a class="name">
  <strong class="user"><em>Mark Barba</em></strong></a><div class="date" title="2005-08-15 12:31"><strong>9 years ago</strong></div>
  <div class="text" id="Hcom55853">
<div class="phpcode"><code><span class="html">
//&nbsp; Using the same code I found here on php.net, <br>// I was able to figure out how to convert GIF (or any other<br>// format GD supports) to CIP format.&nbsp; CIP is the image<br>// format for Cisco IP Phones...&nbsp; 7905/7940 and 7960 <br>// models...&nbsp; Hope someone finds this useful and make it <br>// better...&nbsp; <br><br>/////// GIF2CIP PHP code ///////<br><br>// Convert image in memory to grayscale<br>&nbsp; &nbsp; $img_width&nbsp; = imageSX($im2);<br>&nbsp; &nbsp; $img_height = imageSY($im2);<br><br>&nbsp;&nbsp; // convert to grayscale<br>&nbsp;&nbsp; // note: this will NOT affect your original image, unless<br>&nbsp;&nbsp; // originalFileName and destinationFileName are the same<br>&nbsp;&nbsp; for ($y = 0; $y &lt;$img_height; $y++) { <br>&nbsp; &nbsp; &nbsp;&nbsp; for ($x = 0; $x &lt;$img_width; $x++) { <br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $rgb = imagecolorat($im2, $x, $y);<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $red&nbsp; = ($rgb &gt;&gt; 16) &amp; 0xFF;<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $green = ($rgb &gt;&gt; 8)&nbsp; &amp; 0xFF;<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $blue&nbsp; = $rgb &amp; 0xFF;<br><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $gray = round(.299*$red + .587*$green + .114*$blue);<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; // shift gray level to the left<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $grayR = $gray &lt;&lt; 16;&nbsp; // R: red<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $grayG = $gray &lt;&lt; 8;&nbsp; &nbsp; // G: green<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $grayB = $gray;&nbsp; &nbsp; &nbsp; &nbsp; // B: blue<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; // OR operation to compute gray value<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $grayColor = $grayR | $grayG | $grayB;<br><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; // set the pixel color<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; imagesetpixel ($im2, $x, $y, $grayColor);<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; imagecolorallocate ($im2, $gray, $gray, $gray);<br>&nbsp; &nbsp; &nbsp;&nbsp; }<br>&nbsp;&nbsp; }<br>/////////////////////////////////////////////////////////<br><br>&nbsp; &nbsp; // Modifies palette to only 4-colors (CIP Images on 7905/7940 &amp; 7960 is 2-bit color)<br>&nbsp; &nbsp; ImageTrueColorToPalette2($im2,FALSE,4);<br><br>&nbsp; &nbsp; // Basic header for CIP Image files...<br>&nbsp; &nbsp; header ("Content-type: text/xml");<br>&nbsp; &nbsp; echo "&lt;CiscoIPPhoneImage&gt; ";<br>&nbsp; &nbsp; echo "&lt;LocationX&gt;-1&lt;/LocationX&gt; ";<br>&nbsp; &nbsp; echo "&lt;LocationY&gt;-1&lt;/LocationY&gt; ";<br>&nbsp; &nbsp; echo "&lt;Width&gt;132&lt;/Width&gt; ";<br>&nbsp; &nbsp; echo "&lt;Height&gt;65&lt;/Height&gt; ";<br>&nbsp; &nbsp; echo "&lt;Depth&gt;2&lt;/Depth&gt; ";<br>&nbsp; &nbsp; echo "&lt;Data&gt;";<br><br>// get image dimensions (almost same code as above)<br>&nbsp;&nbsp; $img_width&nbsp; = imageSX($im2);<br>&nbsp;&nbsp; $img_height = imageSY($im2);<br><br>&nbsp;&nbsp; // convert to grayscale<br>&nbsp;&nbsp; // note: this will NOT affect your original image, unless<br>&nbsp;&nbsp; // originalFileName and destinationFileName are the same<br>&nbsp;&nbsp; for ($y = 0; $y &lt;$img_height; $y++) { <br>&nbsp; &nbsp; &nbsp;&nbsp; for ($x = 0; $x+4 &lt;$img_width; $x = $x+4) <br>&nbsp; &nbsp; &nbsp;&nbsp; { <br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; for ($ix = 0; $ix &lt; 4; $ix++)<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $rgb = imagecolorat($im2, $x + $ix, $y);<br><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; // I came up with this translation on my own<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; // Some smart person is bound to perfect it<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if ($rgb=="2") {$rgb=0;$Gray1[$ix] = $rgb;continue;}<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if ($rgb=="0") {$rgb=2;$Gray1[$ix] = $rgb;continue;}<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if ($rgb=="1") {$rgb=1;$Gray1[$ix] = $rgb;continue;}<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if ($rgb=="3") {$rgb=3;$Gray1[$ix] = $rgb;continue;}<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $gray1 = $Gray1[0];<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $gray2 = $Gray1[1] &lt;&lt; 2;<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $gray3 = $Gray1[2] &lt;&lt; 4;<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $gray4 = $Gray1[3] &lt;&lt; 6;<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; // Pack 4 pixels into a single byte for CIP images<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $grey = $gray1 | $gray2 | $gray3 | $gray4;<br><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; // CIP image data is sent in HEX, strtoupper is not really needed.<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $code = strtoupper(dechex($grey)); <br><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; // My quick fix to padding single HEX values<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if (strlen($code)==1) $code = "0".$code;<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; echo $code;<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br>&nbsp; &nbsp; &nbsp;&nbsp; }<br><br>&nbsp;&nbsp; }<br>&nbsp; &nbsp; echo "&lt;/Data&gt;";<br>&nbsp; &nbsp; echo "&lt;Title&gt;$myvar&lt;/Title&gt; ";<br>&nbsp; &nbsp; echo "&lt;Prompt&gt;$city&lt;/Prompt&gt; ";<br>&nbsp; &nbsp; echo "&lt;/CiscoIPPhoneImage&gt;";<br>&nbsp; &nbsp; exit;</span>
</code></div>
  </div>
 </div>
  <div class="note" id="94111">  
  <a class="name">
  <strong class="user"><em>anonymous at domain dot com</em></strong></a><div class="date" title="2009-10-16 03:54"><strong>4 years ago</strong></div>
  <div class="text" id="Hcom94111">
<div class="phpcode"><code><span class="html">
grayscale conversion is built-in with imagefilter(). <br><br><span class="default">&lt;?php<br>&nbsp; &nbsp;&nbsp; </span><span class="comment">/* other code */<br><br>&nbsp; &nbsp;&nbsp; </span><span class="default">$image </span><span class="keyword">= </span><span class="default">imagecreatefromjpeg</span><span class="keyword">(</span><span class="string">'some.jpg'</span><span class="keyword">);<br>&nbsp; &nbsp;&nbsp; </span><span class="default">imagefilter</span><span class="keyword">(</span><span class="default">$image</span><span class="keyword">, </span><span class="default">IMG_FILTER_GRAYSCALE</span><span class="keyword">);<br><br>&nbsp; &nbsp;&nbsp; </span><span class="comment">/* other code (ie save) */<br><br>&nbsp; &nbsp;&nbsp; </span><span class="default">imagedestroy</span><span class="keyword">(</span><span class="default">$image</span><span class="keyword">);<br><br>&nbsp; &nbsp;&nbsp; </span><span class="comment">/* other code */<br></span><span class="default">?&gt;<br></span><br>you could create the sepia effect by the following:<br><br><span class="default">&lt;?php<br>&nbsp; &nbsp;&nbsp; </span><span class="comment">/* other code */<br><br>&nbsp; &nbsp;&nbsp; </span><span class="default">$image </span><span class="keyword">= </span><span class="default">imagecreatefromjpeg</span><span class="keyword">(</span><span class="string">'some.jpg'</span><span class="keyword">);<br>&nbsp; &nbsp;&nbsp; </span><span class="default">imagefilter</span><span class="keyword">(</span><span class="default">$image</span><span class="keyword">, </span><span class="default">IMG_FILTER_GRAYSCALE</span><span class="keyword">);<br>&nbsp; &nbsp;&nbsp; </span><span class="default">imagefilter</span><span class="keyword">(</span><span class="default">$image</span><span class="keyword">, </span><span class="default">IMG_FILTER_COLORIZE</span><span class="keyword">, </span><span class="default">112</span><span class="keyword">, </span><span class="default">66</span><span class="keyword">, </span><span class="default">20</span><span class="keyword">);<br>&nbsp; &nbsp;&nbsp; </span><span class="comment">//Wikipedia RGB definition of sepia<br><br>&nbsp; &nbsp;&nbsp; /* other code (ie save) */<br><br>&nbsp; &nbsp;&nbsp; </span><span class="default">imagedestroy</span><span class="keyword">(</span><span class="default">$image</span><span class="keyword">);<br><br>&nbsp; &nbsp;&nbsp; </span><span class="comment">/* other code */<br></span><span class="default">?&gt;</span>
</span>
</code></div>
  </div>
 </div>
  <div class="note" id="74523">  
  <a class="name">
  <strong class="user"><em>szamil at ginf dot pl</em></strong></a><div class="date" title="2007-04-15 02:17"><strong>7 years ago</strong></div>
  <div class="text" id="Hcom74523">
<div class="phpcode"><code><span class="html">
I've changed a little switch251's code and here we have sephia effect<br><span class="default">&lt;?php<br>&nbsp;&nbsp; </span><span class="comment">// replace with your files<br>&nbsp; &nbsp; </span><span class="default">$originalFileName&nbsp; &nbsp; </span><span class="keyword">= </span><span class="default">$filename</span><span class="keyword">;<br>&nbsp; &nbsp; </span><span class="default">$destinationFileName </span><span class="keyword">= </span><span class="string">"2"</span><span class="keyword">.</span><span class="default">$filename</span><span class="keyword">;<br>&nbsp; &nbsp; <br>&nbsp; &nbsp; </span><span class="comment">// create a copy of the original image<br>&nbsp; &nbsp; // works with jpg images<br>&nbsp; &nbsp; // fell free to adapt to other formats ;)<br>&nbsp; &nbsp; </span><span class="default">$fullPath </span><span class="keyword">= </span><span class="default">explode</span><span class="keyword">(</span><span class="string">"."</span><span class="keyword">,</span><span class="default">$originalFileName</span><span class="keyword">);<br>&nbsp; &nbsp; </span><span class="default">$lastIndex </span><span class="keyword">= </span><span class="default">sizeof</span><span class="keyword">(</span><span class="default">$fullPath</span><span class="keyword">) - </span><span class="default">1</span><span class="keyword">;<br>&nbsp; &nbsp; </span><span class="default">$extension </span><span class="keyword">= </span><span class="default">$fullPath</span><span class="keyword">[</span><span class="default">$lastIndex</span><span class="keyword">];<br>&nbsp; &nbsp; if (</span><span class="default">preg_match</span><span class="keyword">(</span><span class="string">"/jpg|jpeg|JPG|JPEG/"</span><span class="keyword">, </span><span class="default">$extension</span><span class="keyword">))<br>&nbsp; &nbsp; {<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$sourceImage </span><span class="keyword">= </span><span class="default">imagecreatefromjpeg</span><span class="keyword">(</span><span class="default">$originalFileName</span><span class="keyword">);<br>&nbsp; &nbsp; }<br><br>&nbsp; &nbsp; </span><span class="comment">// get image dimensions<br>&nbsp; &nbsp; </span><span class="default">$img_width&nbsp; </span><span class="keyword">= </span><span class="default">imageSX</span><span class="keyword">(</span><span class="default">$sourceImage</span><span class="keyword">);<br>&nbsp; &nbsp; </span><span class="default">$img_height </span><span class="keyword">= </span><span class="default">imageSY</span><span class="keyword">(</span><span class="default">$sourceImage</span><span class="keyword">);<br><br>&nbsp; &nbsp; </span><span class="comment">// convert to grayscale<br>&nbsp; &nbsp; // note: this will NOT affect your original image, unless<br>&nbsp; &nbsp; // originalFileName and destinationFileName are the same<br>&nbsp; &nbsp; </span><span class="keyword">for (</span><span class="default">$y </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">; </span><span class="default">$y </span><span class="keyword">&lt;</span><span class="default">$img_height</span><span class="keyword">; </span><span class="default">$y</span><span class="keyword">++) <br>&nbsp; &nbsp; { <br>&nbsp; &nbsp; &nbsp; &nbsp; for (</span><span class="default">$x </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">; </span><span class="default">$x </span><span class="keyword">&lt;</span><span class="default">$img_width</span><span class="keyword">; </span><span class="default">$x</span><span class="keyword">++) <br>&nbsp; &nbsp; &nbsp; &nbsp; { <br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$rgb </span><span class="keyword">= </span><span class="default">imagecolorat</span><span class="keyword">(</span><span class="default">$sourceImage</span><span class="keyword">, </span><span class="default">$x</span><span class="keyword">, </span><span class="default">$y</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$red&nbsp;&nbsp; </span><span class="keyword">= (</span><span class="default">$rgb </span><span class="keyword">&gt;&gt; </span><span class="default">16</span><span class="keyword">) &amp; </span><span class="default">0xFF</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$green </span><span class="keyword">= (</span><span class="default">$rgb </span><span class="keyword">&gt;&gt; </span><span class="default">8</span><span class="keyword">)&nbsp; &amp; </span><span class="default">0xFF</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$blue&nbsp; </span><span class="keyword">= </span><span class="default">$rgb </span><span class="keyword">&amp; </span><span class="default">0xFF</span><span class="keyword">;<br><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="comment">//sephia<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$red2 </span><span class="keyword">= </span><span class="default">min</span><span class="keyword">(</span><span class="default">$red</span><span class="keyword">*</span><span class="default">.393 </span><span class="keyword">+ </span><span class="default">$green</span><span class="keyword">*</span><span class="default">.769 </span><span class="keyword">+ </span><span class="default">$blue</span><span class="keyword">*</span><span class="default">.189</span><span class="keyword">,</span><span class="default">255</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$green2 </span><span class="keyword">= </span><span class="default">min</span><span class="keyword">(</span><span class="default">$red</span><span class="keyword">*</span><span class="default">.349 </span><span class="keyword">+ </span><span class="default">$green</span><span class="keyword">*</span><span class="default">.686 </span><span class="keyword">+ </span><span class="default">$blue</span><span class="keyword">*</span><span class="default">.168</span><span class="keyword">,</span><span class="default">255</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$blue2&nbsp; </span><span class="keyword">= </span><span class="default">min</span><span class="keyword">(</span><span class="default">$red</span><span class="keyword">*</span><span class="default">.272 </span><span class="keyword">+ </span><span class="default">$green</span><span class="keyword">*</span><span class="default">.534 </span><span class="keyword">+ </span><span class="default">$blue</span><span class="keyword">*</span><span class="default">.131</span><span class="keyword">,</span><span class="default">255</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="comment">// shift gray level to the left<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$grayR </span><span class="keyword">= </span><span class="default">$red2 </span><span class="keyword">&lt;&lt; </span><span class="default">16</span><span class="keyword">;&nbsp;&nbsp; </span><span class="comment">// R: red<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$grayG </span><span class="keyword">= </span><span class="default">$green2 </span><span class="keyword">&lt;&lt; </span><span class="default">8 </span><span class="keyword">;&nbsp; &nbsp; </span><span class="comment">// G: green<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$grayB </span><span class="keyword">= </span><span class="default">$blue2</span><span class="keyword">;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// B: blue<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; // OR operation to compute gray value<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$grayColor </span><span class="keyword">= </span><span class="default">$grayR </span><span class="keyword">| </span><span class="default">$grayG </span><span class="keyword">| </span><span class="default">$grayB</span><span class="keyword">;<br><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="comment">// set the pixel color<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">imagesetpixel </span><span class="keyword">(</span><span class="default">$sourceImage</span><span class="keyword">, </span><span class="default">$x</span><span class="keyword">, </span><span class="default">$y</span><span class="keyword">, </span><span class="default">$grayColor</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">imagecolorallocate </span><span class="keyword">(</span><span class="default">$sourceImage</span><span class="keyword">, </span><span class="default">$gray</span><span class="keyword">, </span><span class="default">$gray</span><span class="keyword">, </span><span class="default">$gray</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; }<br>&nbsp; &nbsp; }<br><br>&nbsp; &nbsp; </span><span class="comment">// copy pixel values to new file buffer<br>&nbsp; &nbsp; </span><span class="default">$destinationImage </span><span class="keyword">= </span><span class="default">ImageCreateTrueColor</span><span class="keyword">(</span><span class="default">$img_width</span><span class="keyword">, </span><span class="default">$img_height</span><span class="keyword">);<br>&nbsp; &nbsp; </span><span class="default">imagecopy</span><span class="keyword">(</span><span class="default">$destinationImage</span><span class="keyword">, </span><span class="default">$sourceImage</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">$img_width</span><span class="keyword">, </span><span class="default">$img_height</span><span class="keyword">);<br><br>&nbsp; &nbsp; </span><span class="comment">// create file on disk<br>&nbsp; &nbsp; </span><span class="default">imagejpeg</span><span class="keyword">(</span><span class="default">$destinationImage</span><span class="keyword">, </span><span class="default">$destinationFileName</span><span class="keyword">);<br>&nbsp; &nbsp; <br>&nbsp; &nbsp; </span><span class="comment">// destroy temp image buffers<br>&nbsp; &nbsp; </span><span class="default">imagedestroy</span><span class="keyword">(</span><span class="default">$destinationImage</span><span class="keyword">);&nbsp; &nbsp; <br>&nbsp; &nbsp; </span><span class="default">imagedestroy</span><span class="keyword">(</span><span class="default">$sourceImage</span><span class="keyword">);<br></span><span class="default">?&gt;</span>
</span>
</code></div>
  </div>
 </div>
  <div class="note" id="41579">  
  <a class="name">
  <strong class="user"><em>switch251 at netcourrier dot com</em></strong></a><div class="date" title="2004-04-15 07:18"><strong>10 years ago</strong></div>
  <div class="text" id="Hcom41579">
<div class="phpcode"><code><span class="html">
In addition to code_couturier too: his code will produce blue pictures, because the value he uses to set the pixel color (the code is incomplete: I first thought it should be $gray) is between 0 and 255, which corresponds to blue levels.<br><br>To convert the picture to grayscale, use the following code:<br><br><span class="default">&lt;?php<br>&nbsp; &nbsp; </span><span class="comment">// replace with your files<br>&nbsp; &nbsp; </span><span class="default">$originalFileName&nbsp; &nbsp; </span><span class="keyword">= </span><span class="string">"colorPicture.jpg"</span><span class="keyword">;<br>&nbsp; &nbsp; </span><span class="default">$destinationFileName </span><span class="keyword">= </span><span class="string">"bwPicture.jpg"</span><span class="keyword">;<br>&nbsp; &nbsp; <br>&nbsp; &nbsp; </span><span class="comment">// create a copy of the original image<br>&nbsp; &nbsp; // works with jpg images<br>&nbsp; &nbsp; // fell free to adapt to other formats ;)<br>&nbsp; &nbsp; </span><span class="default">$fullPath </span><span class="keyword">= </span><span class="default">explode</span><span class="keyword">(</span><span class="string">"."</span><span class="keyword">,</span><span class="default">$originalFileName</span><span class="keyword">);<br>&nbsp; &nbsp; </span><span class="default">$lastIndex </span><span class="keyword">= </span><span class="default">sizeof</span><span class="keyword">(</span><span class="default">$fullPath</span><span class="keyword">) - </span><span class="default">1</span><span class="keyword">;<br>&nbsp; &nbsp; </span><span class="default">$extension </span><span class="keyword">= </span><span class="default">$fullPath</span><span class="keyword">[</span><span class="default">$lastIndex</span><span class="keyword">];<br>&nbsp; &nbsp; if (</span><span class="default">preg_match</span><span class="keyword">(</span><span class="string">"/jpg|jpeg|JPG|JPEG/"</span><span class="keyword">, </span><span class="default">$extension</span><span class="keyword">)){<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$sourceImage </span><span class="keyword">= </span><span class="default">imagecreatefromjpeg</span><span class="keyword">(</span><span class="default">$originalFileName</span><span class="keyword">);<br>&nbsp; &nbsp; }<br><br>&nbsp; &nbsp; </span><span class="comment">// get image dimensions<br>&nbsp; &nbsp; </span><span class="default">$img_width&nbsp; </span><span class="keyword">= </span><span class="default">imageSX</span><span class="keyword">(</span><span class="default">$sourceImage</span><span class="keyword">);<br>&nbsp; &nbsp; </span><span class="default">$img_height </span><span class="keyword">= </span><span class="default">imageSY</span><span class="keyword">(</span><span class="default">$sourceImage</span><span class="keyword">);<br><br>&nbsp; &nbsp; </span><span class="comment">// convert to grayscale<br>&nbsp; &nbsp; // note: this will NOT affect your original image, unless<br>&nbsp; &nbsp; // originalFileName and destinationFileName are the same<br>&nbsp; &nbsp; </span><span class="keyword">for (</span><span class="default">$y </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">; </span><span class="default">$y </span><span class="keyword">&lt;</span><span class="default">$img_height</span><span class="keyword">; </span><span class="default">$y</span><span class="keyword">++) { <br>&nbsp; &nbsp; &nbsp; &nbsp; for (</span><span class="default">$x </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">; </span><span class="default">$x </span><span class="keyword">&lt;</span><span class="default">$img_width</span><span class="keyword">; </span><span class="default">$x</span><span class="keyword">++) { <br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$rgb </span><span class="keyword">= </span><span class="default">imagecolorat</span><span class="keyword">(</span><span class="default">$sourceImage</span><span class="keyword">, </span><span class="default">$x</span><span class="keyword">, </span><span class="default">$y</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$red&nbsp;&nbsp; </span><span class="keyword">= (</span><span class="default">$rgb </span><span class="keyword">&gt;&gt; </span><span class="default">16</span><span class="keyword">) &amp; </span><span class="default">0xFF</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$green </span><span class="keyword">= (</span><span class="default">$rgb </span><span class="keyword">&gt;&gt; </span><span class="default">8</span><span class="keyword">)&nbsp; &amp; </span><span class="default">0xFF</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$blue&nbsp; </span><span class="keyword">= </span><span class="default">$rgb </span><span class="keyword">&amp; </span><span class="default">0xFF</span><span class="keyword">;<br><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$gray </span><span class="keyword">= </span><span class="default">round</span><span class="keyword">(</span><span class="default">.299</span><span class="keyword">*</span><span class="default">$red </span><span class="keyword">+ </span><span class="default">.587</span><span class="keyword">*</span><span class="default">$green </span><span class="keyword">+ </span><span class="default">.114</span><span class="keyword">*</span><span class="default">$blue</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="comment">// shift gray level to the left<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$grayR </span><span class="keyword">= </span><span class="default">$gray </span><span class="keyword">&lt;&lt; </span><span class="default">16</span><span class="keyword">;&nbsp;&nbsp; </span><span class="comment">// R: red<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$grayG </span><span class="keyword">= </span><span class="default">$gray </span><span class="keyword">&lt;&lt; </span><span class="default">8</span><span class="keyword">;&nbsp; &nbsp; </span><span class="comment">// G: green<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$grayB </span><span class="keyword">= </span><span class="default">$gray</span><span class="keyword">;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// B: blue<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; // OR operation to compute gray value<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$grayColor </span><span class="keyword">= </span><span class="default">$grayR </span><span class="keyword">| </span><span class="default">$grayG </span><span class="keyword">| </span><span class="default">$grayB</span><span class="keyword">;<br><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="comment">// set the pixel color<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">imagesetpixel </span><span class="keyword">(</span><span class="default">$sourceImage</span><span class="keyword">, </span><span class="default">$x</span><span class="keyword">, </span><span class="default">$y</span><span class="keyword">, </span><span class="default">$grayColor</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">imagecolorallocate </span><span class="keyword">(</span><span class="default">$sourceImage</span><span class="keyword">, </span><span class="default">$gray</span><span class="keyword">, </span><span class="default">$gray</span><span class="keyword">, </span><span class="default">$gray</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; }<br>&nbsp; &nbsp; }<br><br>&nbsp; &nbsp; </span><span class="comment">// copy pixel values to new file buffer<br>&nbsp; &nbsp; </span><span class="default">$destinationImage </span><span class="keyword">= </span><span class="default">ImageCreateTrueColor</span><span class="keyword">(</span><span class="default">$img_width</span><span class="keyword">, </span><span class="default">$img_height</span><span class="keyword">);<br>&nbsp; &nbsp; </span><span class="default">imagecopy</span><span class="keyword">(</span><span class="default">$destinationImage</span><span class="keyword">, </span><span class="default">$sourceImage</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">$img_width</span><span class="keyword">, </span><span class="default">$img_height</span><span class="keyword">);<br><br>&nbsp; &nbsp; </span><span class="comment">// create file on disk<br>&nbsp; &nbsp; </span><span class="default">imagejpeg</span><span class="keyword">(</span><span class="default">$destinationImage</span><span class="keyword">, </span><span class="default">$destinationFileName</span><span class="keyword">);<br>&nbsp; &nbsp; <br>&nbsp; &nbsp; </span><span class="comment">// destroy temp image buffers<br>&nbsp; &nbsp; </span><span class="default">imagedestroy</span><span class="keyword">(</span><span class="default">$destinationImage</span><span class="keyword">);&nbsp; &nbsp; <br>&nbsp; &nbsp; </span><span class="default">imagedestroy</span><span class="keyword">(</span><span class="default">$sourceImage</span><span class="keyword">);<br></span><span class="default">?&gt;<br></span><br>Copy-paste, replace the file names on the top and there you go (picture files must be in same folder as this script. If not, you will have to do your own file management).</span>
</code></div>
  </div>
 </div>
  <div class="note" id="39920">  
  <a class="name">
  <strong class="user"><em>annonymous at example dot com</em></strong></a><div class="date" title="2004-02-15 04:25"><strong>10 years ago</strong></div>
  <div class="text" id="Hcom39920">
<div class="phpcode"><code><span class="html">
in addition to code_couturier - try this formula to calculate gray-value (luminance) in his "more exact" way:<br><br>$gray = round(.299*$red + .587*$green + .114*$blue);</span>
</code></div>
  </div>
 </div>
  <div class="note" id="36668">  
  <a class="name">
  <strong class="user"><em>code_couturier at graffiti dot net</em></strong></a><div class="date" title="2003-10-18 12:08"><strong>10 years ago</strong></div>
  <div class="text" id="Hcom36668">
<div class="phpcode"><code><span class="html">
# very fast way to generate a grayscal-<br># image from a true color image<br><br>#...<br><br># --- quick grayscale image<br>for ($y = 0; $y &lt;$img_height; $y++) { <br> for ($x = 0; $x &lt;$img_width; $x++) { <br><br> # here we extract the green from <br> # the pixel at x,y , to use it as gray value<br> $gray = (ImageColorAt($image, $x, $y) &gt;&gt; 8) &amp; 0xFF;<br><br> # a more exact way would be this:<br> # $rgb = ImageColorAt($image, $x, $y);<br> # $red = ($rgb &gt;&gt; 16) &amp; 0xFF;<br> # $green = (trgb &gt;&gt; 8) &amp; 0xFF;<br> # $blue = $rgb &amp; 0xFF;<br> # $gray = (int)(($red+$green+$blue)/4); <br><br> # and here we set the new pixel/color<br>&nbsp; imagesetpixel ($image, $x, $y, <br>&nbsp; ImageColorAllocate ($image, $gray,$gray,$gray));<br> }<br>}<br> <br># ...</span>
</code></div>
  </div>
 </div>
  <div class="note" id="36420">  
  <a class="name">
  <strong class="user"><em>mail at laeubi dot de</em></strong></a><div class="date" title="2003-10-09 12:45"><strong>10 years ago</strong></div>
  <div class="text" id="Hcom36420">
<div class="phpcode"><code><span class="html">
This function don't work properly for me on trucolerimages (have not tried yet for other types) it jsut produce a part-grayscale image, and some color get mesed up.<br>I found a workaround here:<br><a rel="nofollow" target="_blank">http://www.phpbuilder.com/columns/cash20030526.php3?page=2</a><br><br>[quote]<br>Advanced Image Editing Under the GD Library<br>Colorizing<br>Colorizing images is fairly easy to do. The easiest way to colorize an image is fairly simple to grasp. Create an image of the same dimensions and fill that image with the color you want to change it to. This new image is then placed on top of the older image, giving it a colorized look.<br><br><span class="default">&lt;?php <br></span><span class="keyword">function </span><span class="default">imagecolorize</span><span class="keyword">(&amp;</span><span class="default">$im</span><span class="keyword">,&amp;</span><span class="default">$col</span><span class="keyword">,</span><span class="default">$pct</span><span class="keyword">) { <br>&nbsp; &nbsp; </span><span class="comment">// Get the image's width <br>&nbsp; &nbsp; </span><span class="default">$im_w </span><span class="keyword">= </span><span class="default">imagesx</span><span class="keyword">(</span><span class="default">$im</span><span class="keyword">);&nbsp; <br>&nbsp; &nbsp; </span><span class="comment">// Get the image's height <br>&nbsp; &nbsp; </span><span class="default">$im_h </span><span class="keyword">= </span><span class="default">imagesy</span><span class="keyword">(</span><span class="default">$im</span><span class="keyword">);&nbsp; <br>&nbsp; &nbsp; </span><span class="comment">// Set a pixel with the color, so we can get it easily <br>&nbsp; &nbsp; </span><span class="default">$setpixel </span><span class="keyword">= </span><span class="default">imagesetpixel</span><span class="keyword">(</span><span class="default">$im</span><span class="keyword">,</span><span class="default">$im_w</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">,</span><span class="default">$col</span><span class="keyword">);&nbsp; <br>&nbsp; &nbsp; </span><span class="comment">// Get the color <br>&nbsp; &nbsp; </span><span class="default">$index </span><span class="keyword">= </span><span class="default">imagecolorat</span><span class="keyword">(</span><span class="default">$im</span><span class="keyword">,</span><span class="default">$im_w</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">);&nbsp; <br>&nbsp; &nbsp; </span><span class="comment">// Find the color in the index <br>&nbsp; &nbsp; </span><span class="default">$rgb </span><span class="keyword">= </span><span class="default">imagecolorsforindex</span><span class="keyword">(</span><span class="default">$im</span><span class="keyword">,</span><span class="default">$index</span><span class="keyword">);&nbsp; <br>&nbsp; &nbsp; </span><span class="comment">// Get the red value <br>&nbsp; &nbsp; </span><span class="default">$r </span><span class="keyword">= </span><span class="default">$rgb</span><span class="keyword">[</span><span class="string">"red"</span><span class="keyword">]; <br>&nbsp; &nbsp; </span><span class="comment">// Get the green value <br>&nbsp; &nbsp; </span><span class="default">$g </span><span class="keyword">= </span><span class="default">$rgb</span><span class="keyword">[</span><span class="string">"green"</span><span class="keyword">];&nbsp; <br>&nbsp; &nbsp; </span><span class="comment">// Get the blue value <br>&nbsp; &nbsp; </span><span class="default">$b </span><span class="keyword">= </span><span class="default">$rgb</span><span class="keyword">[</span><span class="string">"blue"</span><span class="keyword">];&nbsp; <br>&nbsp; &nbsp; </span><span class="comment">// Create the layover <br>&nbsp; &nbsp; </span><span class="default">$layover </span><span class="keyword">= </span><span class="default">imagecreate</span><span class="keyword">(</span><span class="default">$im_w</span><span class="keyword">,</span><span class="default">$im_h</span><span class="keyword">);&nbsp; <br>&nbsp; &nbsp; </span><span class="comment">// Allocate the color on this image <br>&nbsp; &nbsp; </span><span class="default">$color </span><span class="keyword">= </span><span class="default">imagecolorallocate</span><span class="keyword">(</span><span class="default">$layover</span><span class="keyword">,</span><span class="default">$r</span><span class="keyword">,</span><span class="default">$g</span><span class="keyword">,</span><span class="default">$b</span><span class="keyword">);&nbsp; <br>&nbsp; &nbsp; </span><span class="comment">// Fill the image with the new color (this really isn't needed) <br>&nbsp; &nbsp; </span><span class="default">$fill </span><span class="keyword">= </span><span class="default">imagefill</span><span class="keyword">(</span><span class="default">$layover</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">,</span><span class="default">$color</span><span class="keyword">);&nbsp; <br>&nbsp; &nbsp; </span><span class="comment">// Merge the layover on top of the older image <br>&nbsp; &nbsp; </span><span class="default">$merge </span><span class="keyword">= </span><span class="default">imagecopymerge</span><span class="keyword">(</span><span class="default">$im</span><span class="keyword">,</span><span class="default">$layover</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">,</span><span class="default">$im_w</span><span class="keyword">,</span><span class="default">$im_h</span><span class="keyword">,</span><span class="default">$pct</span><span class="keyword">); <br>&nbsp; &nbsp; </span><span class="default">imagedestroy</span><span class="keyword">(</span><span class="default">$layover</span><span class="keyword">); </span><span class="comment">// Destroy the layover <br></span><span class="keyword">} <br></span><span class="default">?&gt;</span> <br><br>If we use a blue layover RGB(0,0,255), we get this result:<br>[/quote]<br><br>if you use black or gray, its not perfekt, but better than nothing ;)</span>
</code></div>
  </div>
 </div></div>

 
</section>    </section><!-- layout-content -->
        


  </div><!-- layout -->
         
  

    
 <!-- External and third party libraries. -->
 







<a id="toTop" href="javascript:;"><span id="toTopHover"></span><img width="40" height="40" alt="To Top" src="../../images/to-top%402x.png"></a>



<!-- Mirrored from php.net/manual/en/function.imagecopymergegray.php by HTTrack Website Copier/3.x [XR&CO'2013], Thu, 28 Aug 2014 16:01:04 GMT -->


</body></html>