<html><!-- Mirrored from php.net/manual/en/class.soapserver.php by HTTrack Website Copier/3.x [XR&CO'2013], Thu, 28 Aug 2014 15:52:11 GMT --><!-- Added by HTTrack --><head><meta http-equiv="content-type" content="text/html;charset=utf-8"><!-- /Added by HTTrack -->


  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0"> 

  <title>SoapServer</title>

 <link rel="shortcut icon" href="../../favicon.ico">
 <link rel="search" type="application/opensearchdescription+xml" href="http://php.net/phpnetimprovedsearch.src" title="Add PHP.net search">
 <link rel="alternate" type="application/atom+xml" href="http://php.net/releases/feed.php" title="PHP Release feed">
 <link rel="alternate" type="application/atom+xml" href="http://php.net/feed.atom" title="PHP: Hypertext Preprocessor">

 <link rel="canonical" href="class.soapserver.html">
 <link rel="shorturl" href="http://php.net/soapserver">
 <link rel="alternate" href="http://php.net/soapserver" hreflang="x-default">

 <link rel="contents" href="index-2.html">
 <link rel="index" href="book.soap.html">
 <link rel="prev" href="soapclient.soapclient.html">
 <link rel="next" href="soapserver.addfunction.html">

 <link rel="alternate" href="class.soapserver.html" hreflang="en">
 <link rel="alternate" href="http://php.net/manual/pt_BR/class.soapserver.php" hreflang="pt_BR">
 <link rel="alternate" href="http://php.net/manual/zh/class.soapserver.php" hreflang="zh">
 <link rel="alternate" href="http://php.net/manual/fr/class.soapserver.php" hreflang="fr">
 <link rel="alternate" href="http://php.net/manual/de/class.soapserver.php" hreflang="de">
 <link rel="alternate" href="http://php.net/manual/it/class.soapserver.php" hreflang="it">
 <link rel="alternate" href="http://php.net/manual/ja/class.soapserver.php" hreflang="ja">
 <link rel="alternate" href="http://php.net/manual/ro/class.soapserver.php" hreflang="ro">
 <link rel="alternate" href="http://php.net/manual/ru/class.soapserver.php" hreflang="ru">
 <link rel="alternate" href="http://php.net/manual/es/class.soapserver.php" hreflang="es">
 <link rel="alternate" href="http://php.net/manual/tr/class.soapserver.php" hreflang="tr">

<link rel="stylesheet" type="text/css" href="../../cached8fe1.css?t=1401250819&amp;f=/fonts/Fira/fira.css" media="screen">
<link rel="stylesheet" type="text/css" href="../../cached4b8d.css?t=1404368420&amp;f=/fonts/Font-Awesome/css/fontello.css" media="screen">
<link rel="stylesheet" type="text/css" href="../../cached5065.css?t=1403329232&amp;f=/styles/theme-base.css" media="screen">
<link rel="stylesheet" type="text/css" href="../../cachedc78d.css?t=1401249623&amp;f=/styles/theme-medium.css" media="screen">

 <!--[if lte IE 7]>
 <link rel="stylesheet" type="text/css" href="http://php.net/styles/workarounds.ie7.css" media="screen">
 <![endif]-->

 <!--[if lte IE 8]>
 <script type="text/javascript">
  window.brokenIE = true;
 </script>
 <![endif]-->

 <!--[if lte IE 9]>
 <link rel="stylesheet" type="text/css" href="http://php.net/styles/workarounds.ie9.css" media="screen">
 <![endif]-->

 <!--[if IE]>
 <script type="text/javascript" src="http://php.net/js/ext/html5.js"></script>
 <![endif]-->

 <base>

</head>
<body class="docs " style="">


<div class="headsup"><a href="http://php.net/index.php#id2014-08-28-1">PHP 5.6.0 released</a></div>
<nav id="trick"><div><dl>
<dt><a href="getting-started.html">Getting Started</a></dt>
	<dd><a href="introduction.html">Introduction</a></dd>
	<dd><a href="tutorial.html">A simple tutorial</a></dd>
<dt><a href="langref.html">Language Reference</a></dt>
	<dd><a href="language.basic-syntax.html">Basic syntax</a></dd>
	<dd><a href="language.types.html">Types</a></dd>
	<dd><a href="language.variables.html">Variables</a></dd>
	<dd><a href="language.constants.html">Constants</a></dd>
	<dd><a href="language.expressions.html">Expressions</a></dd>
	<dd><a href="language.operators.html">Operators</a></dd>
	<dd><a href="language.control-structures.html">Control Structures</a></dd>
	<dd><a href="language.functions.html">Functions</a></dd>
	<dd><a href="language.oop5.html">Classes and Objects</a></dd>
	<dd><a href="language.namespaces.html">Namespaces</a></dd>
	<dd><a href="language.exceptions.html">Exceptions</a></dd>
	<dd><a href="language.generators.html">Generators</a></dd>
	<dd><a href="language.references.html">References Explained</a></dd>
	<dd><a href="reserved.variables.html">Predefined Variables</a></dd>
	<dd><a href="reserved.exceptions.html">Predefined Exceptions</a></dd>
	<dd><a href="reserved.interfaces.html">Predefined Interfaces and Classes</a></dd>
	<dd><a href="context.html">Context options and parameters</a></dd>
	<dd><a href="wrappers.html">Supported Protocols and Wrappers</a></dd>
</dl>
<dl>
<dt><a href="security.html">Security</a></dt>
	<dd><a href="security.intro.html">Introduction</a></dd>
	<dd><a href="security.general.html">General considerations</a></dd>
	<dd><a href="security.cgi-bin.html">Installed as CGI binary</a></dd>
	<dd><a href="security.apache.html">Installed as an Apache module</a></dd>
	<dd><a href="security.filesystem.html">Filesystem Security</a></dd>
	<dd><a href="security.database.html">Database Security</a></dd>
	<dd><a href="security.errors.html">Error Reporting</a></dd>
	<dd><a href="security.globals.html">Using Register Globals</a></dd>
	<dd><a href="security.variables.html">User Submitted Data</a></dd>
	<dd><a href="security.magicquotes.html">Magic Quotes</a></dd>
	<dd><a href="security.hiding.html">Hiding PHP</a></dd>
	<dd><a href="security.current.html">Keeping Current</a></dd>
<dt><a href="features.html">Features</a></dt>
	<dd><a href="features.http-auth.html">HTTP authentication with PHP</a></dd>
	<dd><a href="features.cookies.html">Cookies</a></dd>
	<dd><a href="features.sessions.html">Sessions</a></dd>
	<dd><a href="features.xforms.html">Dealing with XForms</a></dd>
	<dd><a href="features.file-upload.html">Handling file uploads</a></dd>
	<dd><a href="features.remote-files.html">Using remote files</a></dd>
	<dd><a href="features.connection-handling.html">Connection handling</a></dd>
	<dd><a href="features.persistent-connections.html">Persistent Database Connections</a></dd>
	<dd><a href="features.safe-mode.html">Safe Mode</a></dd>
	<dd><a href="features.commandline.html">Command line usage</a></dd>
	<dd><a href="features.gc.html">Garbage Collection</a></dd>
	<dd><a href="features.dtrace.html">DTrace Dynamic Tracing</a></dd>
</dl>
<dl>
<dt><a href="funcref.html">Function Reference</a></dt>
	<dd><a href="refs.basic.php.html">Affecting PHP's Behaviour</a></dd>
	<dd><a href="refs.utilspec.audio.html">Audio Formats Manipulation</a></dd>
	<dd><a href="refs.remote.auth.html">Authentication Services</a></dd>
	<dd><a href="refs.utilspec.cmdline.html">Command Line Specific Extensions</a></dd>
	<dd><a href="refs.compression.html">Compression and Archive Extensions</a></dd>
	<dd><a href="refs.creditcard.html">Credit Card Processing</a></dd>
	<dd><a href="refs.crypto.html">Cryptography Extensions</a></dd>
	<dd><a href="refs.database.html">Database Extensions</a></dd>
	<dd><a href="refs.calendar.html">Date and Time Related Extensions</a></dd>
	<dd><a href="refs.fileprocess.file.html">File System Related Extensions</a></dd>
	<dd><a href="refs.international.html">Human Language and Character Encoding Support</a></dd>
	<dd><a href="refs.utilspec.image.html">Image Processing and Generation</a></dd>
	<dd><a href="refs.remote.mail.html">Mail Related Extensions</a></dd>
	<dd><a href="refs.math.html">Mathematical Extensions</a></dd>
	<dd><a href="refs.utilspec.nontext.html">Non-Text MIME Output</a></dd>
	<dd><a href="refs.fileprocess.process.html">Process Control Extensions</a></dd>
	<dd><a href="refs.basic.other.html">Other Basic Extensions</a></dd>
	<dd><a href="refs.remote.other.html">Other Services</a></dd>
	<dd><a href="refs.search.html">Search Engine Extensions</a></dd>
	<dd><a href="refs.utilspec.server.html">Server Specific Extensions</a></dd>
	<dd><a href="refs.basic.session.html">Session Extensions</a></dd>
	<dd><a href="refs.basic.text.html">Text Processing</a></dd>
	<dd><a href="refs.basic.vartype.html">Variable and Type Related Extensions</a></dd>
	<dd><a href="refs.webservice.html">Web Services</a></dd>
	<dd><a href="refs.utilspec.windows.html">Windows Only Extensions</a></dd>
	<dd><a href="refs.xml.html">XML Manipulation</a></dd>
</dl>
<dl>
<dt>Keyboard Shortcuts</dt><dt>?</dt>
<dd>This help</dd>
<dt>j</dt>
<dd>Next menu item</dd>
<dt>k</dt>
<dd>Previous menu item</dd>
<dt>g p</dt>
<dd>Previous man page</dd>
<dt>g n</dt>
<dd>Next man page</dd>
<dt>G</dt>
<dd>Scroll to bottom</dd>
<dt>g g</dt>
<dd>Scroll to top</dd>
<dt>g h</dt>
<dd>Goto homepage</dd>
<dt>g s</dt>
<dd>Goto search<br>(current page)</dd>
<dt>/</dt>
<dd>Focus search box</dd>
</dl></div></nav>
<div id="goto">
    <div class="search">
         <div class="text"></div>
         <div class="results"><ul></ul></div>
   </div>
</div>

  <div id="breadcrumbs" class="row-fluid">
          
              
        <ul class="breadcrumbs-container">
            <li><a href="index-2.html">PHP Manual</a></li>      <li><a href="funcref.html">Function Reference</a></li>      <li><a href="refs.webservice.html">Web Services</a></li>      <li><a href="book.soap.html">SOAP</a></li>    </ul>
  </div>




<div id="layout">
  <section id="layout-content">
  <div id="class.soapserver" class="reference">

 <h1 class="title">The SoapServer class</h1>
 

 <div class="partintro"><p class="verinfo">(PHP 5 &gt;= 5.0.1)</p>


  <div class="section" id="soapserver.intro">
   <h2 class="title">Introduction</h2>
   <p class="para">
    The SoapServer class provides a server for the <a href="http://www.w3.org/TR/soap11/" class="link external">»&nbsp;SOAP 1.1</a> and <a href="http://www.w3.org/TR/soap12/" class="link external">»&nbsp;SOAP 1.2</a> protocols. It can be used with or without a WSDL service description.
   </p>
  </div>


  <div class="section" id="soapserver.synopsis">
   <h2 class="title">Class synopsis</h2>


   <div class="classsynopsis">
    <div class="ooclass"></div>


    <div class="classsynopsisinfo">
     <span class="ooclass">
      <strong class="classname">SoapServer</strong>
     </span>
     {</div>

    
    <div class="classsynopsisinfo classsynopsisinfo_comment">/* Methods */</div>
    <div class="methodsynopsis dc-description">
   <span class="modifier">public</span> <span class="type">void</span> <span class="methodname"><a href="soapserver.addfunction.html" class="methodname">addFunction</a></span>
    ( <span class="methodparam"><span class="type"><a href="language.pseudo-types.html#language.types.mixed" class="type mixed">mixed</a></span> <code class="parameter">$functions</code></span>
   )</div>
<div class="methodsynopsis dc-description">
   <span class="modifier">public</span> <span class="type">void</span> <span class="methodname"><a href="soapserver.addsoapheader.html" class="methodname">addSoapHeader</a></span>
    ( <span class="methodparam"><span class="type"><a href="class.soapheader.html" class="type SoapHeader">SoapHeader</a></span> <code class="parameter">$object</code></span>
   )</div>
<div class="methodsynopsis dc-description">
   <span class="modifier">public</span> <span class="methodname"><a href="soapserver.construct.html" class="methodname">__construct</a></span>
    ( <span class="methodparam"><span class="type"><a href="language.pseudo-types.html#language.types.mixed" class="type mixed">mixed</a></span> <code class="parameter">$wsdl</code></span>
   [, <span class="methodparam"><span class="type">array</span> <code class="parameter">$options</code></span>
  ] )</div>
<div class="methodsynopsis dc-description">
   <span class="modifier">public</span> <span class="type">void</span> <span class="methodname"><a href="soapserver.fault.html" class="methodname">fault</a></span>
    ( <span class="methodparam"><span class="type">string</span> <code class="parameter">$code</code></span>
   , <span class="methodparam"><span class="type">string</span> <code class="parameter">$string</code></span>
   [, <span class="methodparam"><span class="type">string</span> <code class="parameter">$actor</code></span>
   [, <span class="methodparam"><span class="type">string</span> <code class="parameter">$details</code></span>
   [, <span class="methodparam"><span class="type">string</span> <code class="parameter">$name</code></span>
  ]]] )</div>
<div class="methodsynopsis dc-description">
   <span class="modifier">public</span> <span class="type">array</span> <span class="methodname"><a href="soapserver.getfunctions.html" class="methodname">getFunctions</a></span>
    ( <span class="methodparam">void</span>
   )</div>
<div class="methodsynopsis dc-description">
   <span class="modifier">public</span> <span class="type">void</span> <span class="methodname"><a href="soapserver.handle.html" class="methodname">handle</a></span>
    ([ <span class="methodparam"><span class="type">string</span> <code class="parameter">$soap_request</code></span>
  ] )</div>
<div class="methodsynopsis dc-description">
   <span class="modifier">public</span> <span class="type">void</span> <span class="methodname"><a href="soapserver.setclass.html" class="methodname">setClass</a></span>
    ( <span class="methodparam"><span class="type">string</span> <code class="parameter">$class_name</code></span>
   [, <span class="methodparam"><span class="type"><a href="language.pseudo-types.html#language.types.mixed" class="type mixed">mixed</a></span> <code class="parameter">$args</code></span>
   [, <span class="methodparam"><span class="type"><a href="language.pseudo-types.html#language.types.mixed" class="type mixed">mixed</a></span> <code class="parameter">$...</code></span>
  ]] )</div>
<div class="methodsynopsis dc-description">
   <span class="modifier">public</span> <span class="type">void</span> <span class="methodname"><a href="soapserver.setobject.html" class="methodname">setObject</a></span>
    ( <span class="methodparam"><span class="type">object</span> <code class="parameter">$object</code></span>
   )</div>
<div class="methodsynopsis dc-description">
   <span class="modifier">public</span> <span class="type">void</span> <span class="methodname"><a href="soapserver.setpersistence.html" class="methodname">setPersistence</a></span>
    ( <span class="methodparam"><span class="type">int</span> <code class="parameter">$mode</code></span>
   )</div>
<div class="methodsynopsis dc-description">
   <span class="modifier">public</span> <span class="methodname"><a href="soapserver.soapserver.html" class="methodname">SoapServer</a></span>
    ( <span class="methodparam"><span class="type"><a href="language.pseudo-types.html#language.types.mixed" class="type mixed">mixed</a></span> <code class="parameter">$wsdl</code></span>
   [, <span class="methodparam"><span class="type">array</span> <code class="parameter">$options</code></span>
  ] )</div>

   }</div>


  </div>

 </div>

 







































































<h2>Table of Contents</h2><ul class="chunklist chunklist_reference"><li><a href="soapserver.addfunction.html">SoapServer::addFunction</a> — Adds one or more functions to handle SOAP requests</li><li><a href="soapserver.addsoapheader.html">SoapServer::addSoapHeader</a> — Add a SOAP header to the response</li><li><a href="soapserver.construct.html">SoapServer::__construct</a> — SoapServer constructor</li><li><a href="soapserver.fault.html">SoapServer::fault</a> — Issue SoapServer fault indicating an error</li><li><a href="soapserver.getfunctions.html">SoapServer::getFunctions</a> — Returns list of defined functions</li><li><a href="soapserver.handle.html">SoapServer::handle</a> — Handles a SOAP request</li><li><a href="soapserver.setclass.html">SoapServer::setClass</a> — Sets the class which handles SOAP requests</li><li><a href="soapserver.setobject.html">SoapServer::setObject</a> — Sets the object which will be used to handle SOAP requests</li><li><a href="soapserver.setpersistence.html">SoapServer::setPersistence</a> — Sets SoapServer persistence mode</li><li><a href="soapserver.soapserver.html">SoapServer::SoapServer</a> — SoapServer constructor</li></ul>
</div>

<section id="usernotes">
 <div class="head"><h3 class="title">User Contributed Notes</h3></div><div id="allnotes">
  <div class="note" id="105448">  
  <a class="name">
  <strong class="user"><em>php1221 at klox dot net</em></strong></a><div class="date" title="2011-08-18 01:39"><strong>3 years ago</strong></div>
  <div class="text" id="Hcom105448">
<div class="phpcode"><code><span class="html">
While there are plenty of mentions online that SoapServer doesn't support SOAP Headers, this isn't true.
<br>
<br>In your class, if you declare a function with the name of the header, the function will be called when that header is received.
<br>
<br><span class="default">&lt;?php
<br></span><span class="keyword">class </span><span class="default">MySoapService </span><span class="keyword">{
<br>&nbsp; private </span><span class="default">$user_is_valid</span><span class="keyword">;
<br>
<br>&nbsp; function </span><span class="default">MyHeader</span><span class="keyword">(</span><span class="default">$header</span><span class="keyword">) {
<br>&nbsp; &nbsp; if ((isset(</span><span class="default">$header</span><span class="keyword">-&gt;</span><span class="default">Username</span><span class="keyword">)) &amp;&amp; (isset(</span><span class="default">$header</span><span class="keyword">-&gt;</span><span class="default">Password</span><span class="keyword">))) {
<br>&nbsp; &nbsp; &nbsp; if (</span><span class="default">ValidateUser</span><span class="keyword">(</span><span class="default">$header</span><span class="keyword">-&gt;</span><span class="default">Username</span><span class="keyword">, </span><span class="default">$header</span><span class="keyword">-&gt;</span><span class="default">Password</span><span class="keyword">)) {
<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$user_is_valid </span><span class="keyword">= </span><span class="default">true</span><span class="keyword">;
<br>&nbsp; &nbsp; &nbsp; }
<br>&nbsp; &nbsp; }
<br>&nbsp; }
<br>
<br>&nbsp; function </span><span class="default">MySoapRequest</span><span class="keyword">(</span><span class="default">$request</span><span class="keyword">) {
<br>&nbsp; &nbsp; if (</span><span class="default">$user_is_valid</span><span class="keyword">) {
<br>&nbsp; &nbsp; &nbsp; </span><span class="comment">// process request
<br>&nbsp; &nbsp; </span><span class="keyword">}
<br>&nbsp; &nbsp; else {
<br>&nbsp; &nbsp; &nbsp; throw new </span><span class="default">MyFault</span><span class="keyword">(</span><span class="string">"MySoapRequest"</span><span class="keyword">, </span><span class="string">"User not valid."</span><span class="keyword">);
<br>&nbsp; &nbsp; }
<br>&nbsp; }
<br>}
<br></span><span class="default">?&gt;</span>
</span>
</code></div>
  </div>
 </div>
  <div class="note" id="98082">  
  <a class="name">
  <strong class="user"><em>junk2cm at gmx dot de</em></strong></a><div class="date" title="2010-05-25 12:54"><strong>4 years ago</strong></div>
  <div class="text" id="Hcom98082">
<div class="phpcode"><code><span class="html">
As the SoapServer class lacks the possibility of dealing with SOAP-Headers, my following workaround is suitable to my needs when I had to do authentication via the SOAP-Headers:<br>1. Use a class which handles SOAP requests and let the constructor of this class take the sent headers.<br>2. Before invoking the SoapServer extract the SOAP-Header from the incoming raw data.<br>3. When using setClass pass the extracted header to the handling class.<br><br>In Your Server-Skript do things like this <br><span class="default">&lt;?php<br>$hdr </span><span class="keyword">= </span><span class="default">file_get_contents</span><span class="keyword">(</span><span class="string">"php://input"</span><span class="keyword">);<br>if (</span><span class="default">strpos</span><span class="keyword">(</span><span class="default">$hdr</span><span class="keyword">,</span><span class="string">'&lt;s:Header&gt;'</span><span class="keyword">)===</span><span class="default">false</span><span class="keyword">) {<br>&nbsp; &nbsp; </span><span class="default">$hdr </span><span class="keyword">= </span><span class="default">null</span><span class="keyword">;<br>} else {<br>&nbsp; &nbsp; </span><span class="default">$hdr </span><span class="keyword">= </span><span class="default">explode</span><span class="keyword">(</span><span class="string">'&lt;s:Header&gt;'</span><span class="keyword">,</span><span class="default">$hdr</span><span class="keyword">);<br>&nbsp; &nbsp; </span><span class="default">$hdr </span><span class="keyword">= </span><span class="default">explode</span><span class="keyword">(</span><span class="string">'&lt;/s:Header&gt;'</span><span class="keyword">,</span><span class="default">$hdr</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">]);<br>&nbsp; &nbsp; </span><span class="default">$hdr </span><span class="keyword">= </span><span class="default">$hdr</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">];<br>}<br></span><span class="default">$srv </span><span class="keyword">= new </span><span class="default">SoapServer</span><span class="keyword">(</span><span class="string">'Your_wsdl'</span><span class="keyword">);<br></span><span class="default">$srv</span><span class="keyword">-&gt;</span><span class="default">setClass</span><span class="keyword">(</span><span class="string">"ServiceClass"</span><span class="keyword">,</span><span class="default">$hdr</span><span class="keyword">);<br></span><span class="default">$srv</span><span class="keyword">-&gt;</span><span class="default">handle</span><span class="keyword">();<br></span><span class="default">?&gt;<br></span><br>And the service class is like this:<br><span class="default">&lt;?php<br></span><span class="keyword">class </span><span class="default">ServiceClass </span><span class="keyword">{<br>&nbsp; &nbsp; var </span><span class="default">$IsAuthenticated</span><span class="keyword">;<br><br>&nbsp; &nbsp; function </span><span class="default">__construct</span><span class="keyword">(</span><span class="default">$hdr</span><span class="keyword">) {<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">IsAuthenticated </span><span class="keyword">= </span><span class="default">false</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; if (</span><span class="default">$hdr</span><span class="keyword">!=</span><span class="default">null</span><span class="keyword">) {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">header </span><span class="keyword">= </span><span class="default">simplexml_load_string</span><span class="keyword">(</span><span class="default">$hdr</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="comment">//Your authentication stuff goes here...<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="keyword">}<br>&nbsp; &nbsp; }<br>&nbsp; &nbsp; <br>&nbsp; &nbsp; function </span><span class="default">SomeFunctionOfTheService</span><span class="keyword">(</span><span class="default">$a</span><span class="keyword">) {<br>&nbsp; &nbsp; &nbsp; &nbsp; if (</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">IsAuthenticated</span><span class="keyword">) {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="comment">//here Your function...<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="keyword">}<br>&nbsp; &nbsp; }<br><br>}<br></span><span class="default">?&gt;</span>
</span>
</code></div>
  </div>
 </div>
  <div class="note" id="101979">  
  <a class="name">
  <strong class="user"><em>hawky83 at googlemail dot com</em></strong></a><div class="date" title="2011-01-21 02:46"><strong>3 years ago</strong></div>
  <div class="text" id="Hcom101979">
<div class="phpcode"><code><span class="html">
Another simple example for SOAP_SERVER with errorhandling an params and wsdl:
<br>
<br>SERVER (soap_all_srv.php):
<br>
<br><span class="default">&lt;?php 
<br></span><span class="comment">// PEAR::SOAP einbinden
<br></span><span class="keyword">require_once </span><span class="string">"SOAP/Server.php"</span><span class="keyword">;
<br></span><span class="default">$skiptrace </span><span class="keyword">=&amp; </span><span class="default">PEAR</span><span class="keyword">::</span><span class="default">getStaticProperty</span><span class="keyword">(</span><span class="string">'PEAR_Error'</span><span class="keyword">, </span><span class="string">'skiptrace'</span><span class="keyword">);
<br></span><span class="default">$skiptrace </span><span class="keyword">= </span><span class="default">true</span><span class="keyword">;
<br>
<br></span><span class="comment">// Service-Class
<br></span><span class="keyword">class </span><span class="default">mytimeserv </span><span class="keyword">{
<br>
<br>&nbsp; </span><span class="comment">// __dispatch_map
<br>&nbsp; </span><span class="keyword">public </span><span class="default">$__dispatch_map </span><span class="keyword">= array ();
<br>&nbsp; 
<br>&nbsp; </span><span class="comment">// In/Out param -&gt; __dispatch_map
<br>&nbsp; </span><span class="keyword">public function </span><span class="default">__construct</span><span class="keyword">() {
<br>&nbsp; &nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">__dispatch_map</span><span class="keyword">[</span><span class="string">"now"</span><span class="keyword">] =
<br>&nbsp; &nbsp; &nbsp; array (</span><span class="string">"in" </span><span class="keyword">=&gt; array(</span><span class="string">"format" </span><span class="keyword">=&gt; </span><span class="string">"string"</span><span class="keyword">),
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="string">"out" </span><span class="keyword">=&gt; array(</span><span class="string">"time" </span><span class="keyword">=&gt; </span><span class="string">"string"</span><span class="keyword">));
<br>&nbsp; }
<br>&nbsp; 
<br>&nbsp; </span><span class="comment">// get back __dispatch_map in __dispatch
<br>&nbsp; </span><span class="keyword">public function </span><span class="default">__dispatch</span><span class="keyword">(</span><span class="default">$methodname</span><span class="keyword">) {
<br>&nbsp; 
<br>&nbsp; &nbsp; if (isset(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">__dispatch_map</span><span class="keyword">[</span><span class="default">$methodname</span><span class="keyword">])) {
<br>&nbsp; &nbsp; &nbsp; return </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">__dispatch_map</span><span class="keyword">[</span><span class="default">$methodname</span><span class="keyword">];
<br>&nbsp; &nbsp; }
<br>&nbsp; &nbsp; 
<br>&nbsp; &nbsp; return </span><span class="default">NULL</span><span class="keyword">;
<br>&nbsp; }
<br>&nbsp; 
<br>&nbsp; </span><span class="comment">// servicemthod with parameters
<br>&nbsp; </span><span class="keyword">function </span><span class="default">now </span><span class="keyword">(</span><span class="default">$format</span><span class="keyword">) {
<br>&nbsp; 
<br>&nbsp; &nbsp; </span><span class="comment">// formaterror?
<br>&nbsp; &nbsp; </span><span class="keyword">if ((</span><span class="default">$format </span><span class="keyword">== </span><span class="default">null</span><span class="keyword">) || (</span><span class="default">trim</span><span class="keyword">(</span><span class="default">$format</span><span class="keyword">) == </span><span class="string">""</span><span class="keyword">)) {
<br>&nbsp; &nbsp; 
<br>&nbsp; &nbsp; &nbsp; </span><span class="comment">// send errormessage
<br>&nbsp; &nbsp; &nbsp; </span><span class="keyword">return new </span><span class="default">SOAP_Fault</span><span class="keyword">(</span><span class="string">"Kein Parameter angegeben"</span><span class="keyword">,</span><span class="string">"0815"</span><span class="keyword">, </span><span class="string">"Client"</span><span class="keyword">);
<br>&nbsp; &nbsp; }
<br>&nbsp; &nbsp; 
<br>&nbsp; &nbsp; </span><span class="default">date_default_timezone_set</span><span class="keyword">(</span><span class="string">'Europe/Berlin'</span><span class="keyword">);
<br>&nbsp; &nbsp; 
<br>&nbsp; &nbsp; </span><span class="default">$time </span><span class="keyword">= </span><span class="default">date </span><span class="keyword">(</span><span class="default">$format</span><span class="keyword">);
<br>&nbsp; &nbsp; 
<br>&nbsp; &nbsp; </span><span class="comment">// return SOAP-Obj.
<br>&nbsp; &nbsp; </span><span class="keyword">return (new </span><span class="default">SOAP_Value</span><span class="keyword">(</span><span class="string">'time'</span><span class="keyword">,</span><span class="string">'string'</span><span class="keyword">, </span><span class="default">$time</span><span class="keyword">));
<br>&nbsp; }&nbsp; &nbsp; &nbsp;&nbsp; 
<br>}
<br>
<br></span><span class="comment">// service-class
<br></span><span class="default">$service </span><span class="keyword">= new </span><span class="default">mytimeserv</span><span class="keyword">();
<br>
<br></span><span class="comment">// server
<br></span><span class="default">$ss </span><span class="keyword">= new </span><span class="default">SOAP_Server</span><span class="keyword">();
<br>
<br></span><span class="comment">// add service with name
<br></span><span class="default">$ss</span><span class="keyword">-&gt;</span><span class="default">addObjectMap </span><span class="keyword">(&amp;</span><span class="default">$service</span><span class="keyword">,</span><span class="string">"urn:mytimeserv"</span><span class="keyword">);
<br>
<br></span><span class="comment">// service or wsdl
<br></span><span class="keyword">if (isset(</span><span class="default">$_SERVER</span><span class="keyword">[</span><span class="string">"REQUEST_METHOD"</span><span class="keyword">])&amp;&amp; </span><span class="default">$_SERVER</span><span class="keyword">[</span><span class="string">"REQUEST_METHOD"</span><span class="keyword">] == </span><span class="string">"POST"</span><span class="keyword">) {
<br>
<br>&nbsp; &nbsp; </span><span class="comment">// postdata -&gt; service
<br>&nbsp; &nbsp; </span><span class="default">$ss</span><span class="keyword">-&gt;</span><span class="default">service </span><span class="keyword">(</span><span class="default">$HTTP_RAW_POST_DATA</span><span class="keyword">);
<br>&nbsp; &nbsp; 
<br>} else {
<br>
<br>&nbsp; </span><span class="comment">// wsdl-param in url
<br>&nbsp; </span><span class="keyword">if (isset(</span><span class="default">$_SERVER</span><span class="keyword">[</span><span class="string">'QUERY_STRING'</span><span class="keyword">]) &amp;&amp; </span><span class="default">strcasecmp</span><span class="keyword">(</span><span class="default">$_SERVER</span><span class="keyword">[</span><span class="string">'QUERY_STRING'</span><span class="keyword">],</span><span class="string">'wsdl'</span><span class="keyword">) == </span><span class="default">0</span><span class="keyword">) {
<br>&nbsp; &nbsp; 
<br>&nbsp; &nbsp; </span><span class="comment">// DISCO_Server for WSDL 
<br>&nbsp; &nbsp; </span><span class="keyword">require_once </span><span class="string">"SOAP/Disco.php"</span><span class="keyword">;
<br>&nbsp; &nbsp; </span><span class="default">$disco </span><span class="keyword">= new </span><span class="default">SOAP_DISCO_Server </span><span class="keyword">(</span><span class="default">$ss</span><span class="keyword">,</span><span class="string">"mytimeserv"</span><span class="keyword">,</span><span class="string">"My Time Service"</span><span class="keyword">);
<br>&nbsp; &nbsp; 
<br>&nbsp; &nbsp; </span><span class="comment">// set HTML-Header 
<br>&nbsp; &nbsp; </span><span class="default">header</span><span class="keyword">(</span><span class="string">"Content-type: text/xml"</span><span class="keyword">);
<br>&nbsp; &nbsp; 
<br>&nbsp; &nbsp; </span><span class="comment">// return wsdl
<br>&nbsp; &nbsp; </span><span class="keyword">print </span><span class="default">$disco</span><span class="keyword">-&gt;</span><span class="default">getWSDL </span><span class="keyword">();
<br>&nbsp; }
<br>}
<br>
<br></span><span class="default">?&gt;
<br></span>
<br>CLIENT (soap_all_client.php) (for wsdl: <a rel="nofollow" target="_blank">http://example.com/soap_all_srv.php?wsdl</a>):
<br><span class="default">&lt;?php
<br>
<br></span><span class="keyword">require_once </span><span class="string">"SOAP/Client.php"</span><span class="keyword">;
<br>
<br></span><span class="comment">// SOAP/WSDL
<br></span><span class="default">$sw </span><span class="keyword">= new </span><span class="default">SOAP_WSDL </span><span class="keyword">(</span><span class="string">"<a rel="nofollow" target="_blank">http://example.com/soap_all_srv.php?wsdl</a>"</span><span class="keyword">);
<br>
<br></span><span class="comment">// Proxy-Obj.
<br></span><span class="default">$proxy </span><span class="keyword">= </span><span class="default">$sw</span><span class="keyword">-&gt;</span><span class="default">getProxy </span><span class="keyword">();
<br>
<br></span><span class="comment">// servicemthod
<br></span><span class="default">$erg </span><span class="keyword">= </span><span class="default">$proxy</span><span class="keyword">-&gt;</span><span class="default">now </span><span class="keyword">(</span><span class="string">"H:i:s"</span><span class="keyword">);
<br>
<br></span><span class="comment">// return
<br></span><span class="keyword">print </span><span class="default">$erg</span><span class="keyword">.</span><span class="string">"\n"</span><span class="keyword">;
<br>
<br></span><span class="default">?&gt;</span>
</span>
</code></div>
  </div>
 </div>
  <div class="note" id="113210">  
  <a class="name">
  <strong class="user"><em>s at dumdeedum dot com</em></strong></a><div class="date" title="2013-09-12 05:32"><strong>11 months ago</strong></div>
  <div class="text" id="Hcom113210">
<div class="phpcode"><code><span class="html">
I was running PHP 5.3.2 and couldn't for the life of me get SOAP headers to work, no matter how carefully I built my class/wsdl/client.&nbsp; What finally fixed it was updating to the latest PHP.&nbsp; No idea if there was a bug somewhere or what, but it's never a bad idea to stay current and it might save you weeks of frustration!</span>
</code></div>
  </div>
 </div>
  <div class="note" id="95309">  
  <a class="name">
  <strong class="user"><em>dsubar at interna dot com</em></strong></a><div class="date" title="2009-12-25 09:49"><strong>4 years ago</strong></div>
  <div class="text" id="Hcom95309">
<div class="phpcode"><code><span class="html">
Do not put a SoapServer and a SoapClient in the same PHP file. This seems to cause arbitrary behavior. On the PHP interpreter in Eclipse, everything worked fine. Under MAMP, I got an undocumented error. In moving the client from the same file as the server, everything worked fine.</span>
</code></div>
  </div>
 </div>
  <div class="note" id="98227">  
  <a class="name">
  <strong class="user"><em>mikkel at nsales dot dk</em></strong></a><div class="date" title="2010-06-02 03:15"><strong>4 years ago</strong></div>
  <div class="text" id="Hcom98227">
<div class="phpcode"><code><span class="html">
If you want to return a custom object array from a nusoap webservice, you have to cast the objects to arrays like so:
<br>
<br><span class="default">&lt;?php
<br>$users </span><span class="keyword">= array();
<br>while(</span><span class="default">$res </span><span class="keyword">= </span><span class="default">$db_obj</span><span class="keyword">-&gt;</span><span class="default">fetch_row</span><span class="keyword">())
<br>{
<br>&nbsp; </span><span class="default">$user </span><span class="keyword">= new </span><span class="default">user</span><span class="keyword">();
<br>&nbsp; </span><span class="default">$user</span><span class="keyword">-&gt;</span><span class="default">Id </span><span class="keyword">= </span><span class="default">$res</span><span class="keyword">[</span><span class="string">'id'</span><span class="keyword">];
<br>&nbsp; </span><span class="default">$user</span><span class="keyword">-&gt;</span><span class="default">Username </span><span class="keyword">= </span><span class="default">$res</span><span class="keyword">[</span><span class="string">'username'</span><span class="keyword">];
<br>&nbsp; </span><span class="default">$user</span><span class="keyword">-&gt;</span><span class="default">Email </span><span class="keyword">= </span><span class="default">$res</span><span class="keyword">[</span><span class="string">'email'</span><span class="keyword">];
<br>&nbsp; 
<br>&nbsp; </span><span class="default">$users</span><span class="keyword">[] = (array) </span><span class="default">$user</span><span class="keyword">;
<br>}
<br>
<br>return (</span><span class="default">$users</span><span class="keyword">);
<br></span><span class="default">?&gt;</span>
</span>
</code></div>
  </div>
 </div>
  <div class="note" id="109306">  
  <a class="name">
  <strong class="user"><em>phpman dot fulter47 at recursor dot net</em></strong></a><div class="date" title="2012-07-04 05:36"><strong>2 years ago</strong></div>
  <div class="text" id="Hcom109306">
<div class="phpcode"><code><span class="html">
For those (like me) coming from other SOAP frameworks and getting confused:<br><br>- A PHP SOAP server application created using the SoapServer class can not be used as a standalone SOAP server.<br>It needs an HTTP server to receive SOAP requests, which must run a PHP engine to execute the PHP SOAP server script as a CGI.<br><br>- For this reason, there are no settings in PHP that control the Interface/Port under which the SOAP server will wait for requests - it is the HTTP server who is responsible for that.<br><br>- The "uri" parameter is an "id value", used as the namespace for the SOAP response. It is only required if no WSDL file is used (that contains this setting), i.e. "wsdl" is set to NULL. It does _not_ control the Hostname/Port under which the HTTP server will be reachable for requests.</span>
</code></div>
  </div>
 </div>
  <div class="note" id="98021">  
  <a class="name">
  <strong class="user"><em>carlos dot vini at gmail dot com</em></strong></a><div class="date" title="2010-05-20 01:55"><strong>4 years ago</strong></div>
  <div class="text" id="Hcom98021">
<div class="phpcode"><code><span class="html">
SoapServer does not support WSDL with literal/document. I have a class:
<br>
<br><span class="default">&lt;?php
<br></span><span class="keyword">class </span><span class="default">My_Soap </span><span class="keyword">{
<br>&nbsp; &nbsp; </span><span class="comment">/**
<br>&nbsp; &nbsp;&nbsp; * Returns Hello World.
<br>&nbsp; &nbsp;&nbsp; * 
<br>&nbsp; &nbsp;&nbsp; * @param string $world
<br>&nbsp; &nbsp;&nbsp; * @return string
<br>&nbsp; &nbsp;&nbsp; */
<br>&nbsp; &nbsp; </span><span class="keyword">public function </span><span class="default">getInterAdmins</span><span class="keyword">(</span><span class="default">$world</span><span class="keyword">) {
<br>&nbsp; &nbsp; &nbsp; &nbsp; return </span><span class="string">'hello' </span><span class="keyword">. </span><span class="default">$world</span><span class="keyword">;
<br>&nbsp; &nbsp; }
<br>}
<br></span><span class="default">?&gt;
<br></span>
<br>To fix this I had to create proxy class:
<br><span class="default">&lt;?php
<br></span><span class="keyword">class </span><span class="default">My_Soap_LiteralDocumentProxy </span><span class="keyword">{
<br>&nbsp;&nbsp; public function </span><span class="default">__call</span><span class="keyword">(</span><span class="default">$methodName</span><span class="keyword">, </span><span class="default">$args</span><span class="keyword">) {
<br>&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$soapClass </span><span class="keyword">= new </span><span class="default">My_Soap</span><span class="keyword">();
<br>&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$result </span><span class="keyword">= </span><span class="default">call_user_func_array</span><span class="keyword">(array(</span><span class="default">$soapClass</span><span class="keyword">, </span><span class="default">$methodName</span><span class="keyword">),&nbsp; </span><span class="default">$args</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">]);
<br>&nbsp; &nbsp; &nbsp;&nbsp; return array(</span><span class="default">$methodName </span><span class="keyword">. </span><span class="string">'Result' </span><span class="keyword">=&gt; </span><span class="default">$result</span><span class="keyword">);
<br>&nbsp;&nbsp; }
<br>}
<br></span><span class="default">?&gt;
<br></span>
<br>Now make sure that the WSDL is created using My_Soap. And that the Server is created using My_Soap_LiteralDocumentProxy:
<br>
<br><span class="default">&lt;?php
<br>
<br></span><span class="keyword">if (isset(</span><span class="default">$_GET</span><span class="keyword">[</span><span class="string">'wsdl'</span><span class="keyword">])) {
<br>&nbsp; &nbsp; </span><span class="default">$wsdl </span><span class="keyword">= new </span><span class="default">Zend_Soap_AutoDiscover</span><span class="keyword">(); </span><span class="comment">// It generates the WSDL
<br>&nbsp; &nbsp; </span><span class="default">$wsdl</span><span class="keyword">-&gt;</span><span class="default">setOperationBodyStyle</span><span class="keyword">(array(
<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="string">'use' </span><span class="keyword">=&gt; </span><span class="string">'literal'
<br>&nbsp; &nbsp; </span><span class="keyword">));
<br>&nbsp; &nbsp; </span><span class="default">$wsdl</span><span class="keyword">-&gt;</span><span class="default">setBindingStyle</span><span class="keyword">(array(
<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="string">'style' </span><span class="keyword">=&gt; </span><span class="string">'document'
<br>&nbsp; &nbsp; </span><span class="keyword">));
<br>&nbsp; &nbsp; </span><span class="default">$wsdl</span><span class="keyword">-&gt;</span><span class="default">setClass</span><span class="keyword">(</span><span class="string">'My_Soap'</span><span class="keyword">);
<br>&nbsp; &nbsp; </span><span class="default">$wsdl</span><span class="keyword">-&gt;</span><span class="default">handle</span><span class="keyword">();
<br>} else {
<br>&nbsp; &nbsp; </span><span class="default">$server </span><span class="keyword">= new </span><span class="default">Zend_Soap_Server</span><span class="keyword">(</span><span class="string">'<a rel="nofollow" target="_blank">http://localhost/something/webservice.php?wsdl</a>'</span><span class="keyword">);
<br>&nbsp; &nbsp; </span><span class="default">$server</span><span class="keyword">-&gt;</span><span class="default">setClass</span><span class="keyword">(</span><span class="string">'My_Soap_LiteralDocumentProxy'</span><span class="keyword">);
<br>&nbsp; &nbsp; </span><span class="default">$server</span><span class="keyword">-&gt;</span><span class="default">handle</span><span class="keyword">();
<br>}
<br>
<br></span><span class="default">?&gt;</span>
</span>
</code></div>
  </div>
 </div></div>

 
</section>    </section><!-- layout-content -->
        


  </div><!-- layout -->
         
  

    
 <!-- External and third party libraries. -->
 







<a id="toTop" href="javascript:;"><span id="toTopHover"></span><img width="40" height="40" alt="To Top" src="../../images/to-top%402x.png"></a>



<!-- Mirrored from php.net/manual/en/class.soapserver.php by HTTrack Website Copier/3.x [XR&CO'2013], Thu, 28 Aug 2014 15:52:11 GMT -->


</body></html>