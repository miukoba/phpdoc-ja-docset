<html><!-- Mirrored from php.net/manual/en/book.pdo.php by HTTrack Website Copier/3.x [XR&CO'2013], Thu, 28 Aug 2014 15:45:18 GMT --><!-- Added by HTTrack --><head><meta http-equiv="content-type" content="text/html;charset=utf-8"><!-- /Added by HTTrack -->


  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0"> 

  <title>PDO</title>

 <link rel="shortcut icon" href="../../favicon.ico">
 <link rel="search" type="application/opensearchdescription+xml" href="http://php.net/phpnetimprovedsearch.src" title="Add PHP.net search">
 <link rel="alternate" type="application/atom+xml" href="http://php.net/releases/feed.php" title="PHP Release feed">
 <link rel="alternate" type="application/atom+xml" href="http://php.net/feed.atom" title="PHP: Hypertext Preprocessor">

 <link rel="canonical" href="book.pdo.html">
 <link rel="shorturl" href="http://php.net/pdo">
 <link rel="alternate" href="http://php.net/pdo" hreflang="x-default">

 <link rel="contents" href="index-2.html">
 <link rel="index" href="refs.database.abstract.html">
 <link rel="prev" href="function.odbc-tables.html">
 <link rel="next" href="intro.pdo.html">

 <link rel="alternate" href="book.pdo.html" hreflang="en">
 <link rel="alternate" href="http://php.net/manual/pt_BR/book.pdo.php" hreflang="pt_BR">
 <link rel="alternate" href="http://php.net/manual/zh/book.pdo.php" hreflang="zh">
 <link rel="alternate" href="http://php.net/manual/fr/book.pdo.php" hreflang="fr">
 <link rel="alternate" href="http://php.net/manual/de/book.pdo.php" hreflang="de">
 <link rel="alternate" href="http://php.net/manual/it/book.pdo.php" hreflang="it">
 <link rel="alternate" href="http://php.net/manual/ja/book.pdo.php" hreflang="ja">
 <link rel="alternate" href="http://php.net/manual/ro/book.pdo.php" hreflang="ro">
 <link rel="alternate" href="http://php.net/manual/ru/book.pdo.php" hreflang="ru">
 <link rel="alternate" href="http://php.net/manual/es/book.pdo.php" hreflang="es">
 <link rel="alternate" href="http://php.net/manual/tr/book.pdo.php" hreflang="tr">

<link rel="stylesheet" type="text/css" href="../../cached8fe1.css?t=1401250819&amp;f=/fonts/Fira/fira.css" media="screen">
<link rel="stylesheet" type="text/css" href="../../cached4b8d.css?t=1404368420&amp;f=/fonts/Font-Awesome/css/fontello.css" media="screen">
<link rel="stylesheet" type="text/css" href="../../cached5065.css?t=1403329232&amp;f=/styles/theme-base.css" media="screen">
<link rel="stylesheet" type="text/css" href="../../cachedc78d.css?t=1401249623&amp;f=/styles/theme-medium.css" media="screen">

 <!--[if lte IE 7]>
 <link rel="stylesheet" type="text/css" href="http://php.net/styles/workarounds.ie7.css" media="screen">
 <![endif]-->

 <!--[if lte IE 8]>
 <script type="text/javascript">
  window.brokenIE = true;
 </script>
 <![endif]-->

 <!--[if lte IE 9]>
 <link rel="stylesheet" type="text/css" href="http://php.net/styles/workarounds.ie9.css" media="screen">
 <![endif]-->

 <!--[if IE]>
 <script type="text/javascript" src="http://php.net/js/ext/html5.js"></script>
 <![endif]-->

 <base>

</head>
<body class="docs " style="">


<div class="headsup"><a href="http://php.net/index.php#id2014-08-28-1">PHP 5.6.0 released</a></div>
<nav id="trick"><div><dl>
<dt><a href="getting-started.html">Getting Started</a></dt>
	<dd><a href="introduction.html">Introduction</a></dd>
	<dd><a href="tutorial.html">A simple tutorial</a></dd>
<dt><a href="langref.html">Language Reference</a></dt>
	<dd><a href="language.basic-syntax.html">Basic syntax</a></dd>
	<dd><a href="language.types.html">Types</a></dd>
	<dd><a href="language.variables.html">Variables</a></dd>
	<dd><a href="language.constants.html">Constants</a></dd>
	<dd><a href="language.expressions.html">Expressions</a></dd>
	<dd><a href="language.operators.html">Operators</a></dd>
	<dd><a href="language.control-structures.html">Control Structures</a></dd>
	<dd><a href="language.functions.html">Functions</a></dd>
	<dd><a href="language.oop5.html">Classes and Objects</a></dd>
	<dd><a href="language.namespaces.html">Namespaces</a></dd>
	<dd><a href="language.exceptions.html">Exceptions</a></dd>
	<dd><a href="language.generators.html">Generators</a></dd>
	<dd><a href="language.references.html">References Explained</a></dd>
	<dd><a href="reserved.variables.html">Predefined Variables</a></dd>
	<dd><a href="reserved.exceptions.html">Predefined Exceptions</a></dd>
	<dd><a href="reserved.interfaces.html">Predefined Interfaces and Classes</a></dd>
	<dd><a href="context.html">Context options and parameters</a></dd>
	<dd><a href="wrappers.html">Supported Protocols and Wrappers</a></dd>
</dl>
<dl>
<dt><a href="security.html">Security</a></dt>
	<dd><a href="security.intro.html">Introduction</a></dd>
	<dd><a href="security.general.html">General considerations</a></dd>
	<dd><a href="security.cgi-bin.html">Installed as CGI binary</a></dd>
	<dd><a href="security.apache.html">Installed as an Apache module</a></dd>
	<dd><a href="security.filesystem.html">Filesystem Security</a></dd>
	<dd><a href="security.database.html">Database Security</a></dd>
	<dd><a href="security.errors.html">Error Reporting</a></dd>
	<dd><a href="security.globals.html">Using Register Globals</a></dd>
	<dd><a href="security.variables.html">User Submitted Data</a></dd>
	<dd><a href="security.magicquotes.html">Magic Quotes</a></dd>
	<dd><a href="security.hiding.html">Hiding PHP</a></dd>
	<dd><a href="security.current.html">Keeping Current</a></dd>
<dt><a href="features.html">Features</a></dt>
	<dd><a href="features.http-auth.html">HTTP authentication with PHP</a></dd>
	<dd><a href="features.cookies.html">Cookies</a></dd>
	<dd><a href="features.sessions.html">Sessions</a></dd>
	<dd><a href="features.xforms.html">Dealing with XForms</a></dd>
	<dd><a href="features.file-upload.html">Handling file uploads</a></dd>
	<dd><a href="features.remote-files.html">Using remote files</a></dd>
	<dd><a href="features.connection-handling.html">Connection handling</a></dd>
	<dd><a href="features.persistent-connections.html">Persistent Database Connections</a></dd>
	<dd><a href="features.safe-mode.html">Safe Mode</a></dd>
	<dd><a href="features.commandline.html">Command line usage</a></dd>
	<dd><a href="features.gc.html">Garbage Collection</a></dd>
	<dd><a href="features.dtrace.html">DTrace Dynamic Tracing</a></dd>
</dl>
<dl>
<dt><a href="funcref.html">Function Reference</a></dt>
	<dd><a href="refs.basic.php.html">Affecting PHP's Behaviour</a></dd>
	<dd><a href="refs.utilspec.audio.html">Audio Formats Manipulation</a></dd>
	<dd><a href="refs.remote.auth.html">Authentication Services</a></dd>
	<dd><a href="refs.utilspec.cmdline.html">Command Line Specific Extensions</a></dd>
	<dd><a href="refs.compression.html">Compression and Archive Extensions</a></dd>
	<dd><a href="refs.creditcard.html">Credit Card Processing</a></dd>
	<dd><a href="refs.crypto.html">Cryptography Extensions</a></dd>
	<dd><a href="refs.database.html">Database Extensions</a></dd>
	<dd><a href="refs.calendar.html">Date and Time Related Extensions</a></dd>
	<dd><a href="refs.fileprocess.file.html">File System Related Extensions</a></dd>
	<dd><a href="refs.international.html">Human Language and Character Encoding Support</a></dd>
	<dd><a href="refs.utilspec.image.html">Image Processing and Generation</a></dd>
	<dd><a href="refs.remote.mail.html">Mail Related Extensions</a></dd>
	<dd><a href="refs.math.html">Mathematical Extensions</a></dd>
	<dd><a href="refs.utilspec.nontext.html">Non-Text MIME Output</a></dd>
	<dd><a href="refs.fileprocess.process.html">Process Control Extensions</a></dd>
	<dd><a href="refs.basic.other.html">Other Basic Extensions</a></dd>
	<dd><a href="refs.remote.other.html">Other Services</a></dd>
	<dd><a href="refs.search.html">Search Engine Extensions</a></dd>
	<dd><a href="refs.utilspec.server.html">Server Specific Extensions</a></dd>
	<dd><a href="refs.basic.session.html">Session Extensions</a></dd>
	<dd><a href="refs.basic.text.html">Text Processing</a></dd>
	<dd><a href="refs.basic.vartype.html">Variable and Type Related Extensions</a></dd>
	<dd><a href="refs.webservice.html">Web Services</a></dd>
	<dd><a href="refs.utilspec.windows.html">Windows Only Extensions</a></dd>
	<dd><a href="refs.xml.html">XML Manipulation</a></dd>
</dl>
<dl>
<dt>Keyboard Shortcuts</dt><dt>?</dt>
<dd>This help</dd>
<dt>j</dt>
<dd>Next menu item</dd>
<dt>k</dt>
<dd>Previous menu item</dd>
<dt>g p</dt>
<dd>Previous man page</dd>
<dt>g n</dt>
<dd>Next man page</dd>
<dt>G</dt>
<dd>Scroll to bottom</dd>
<dt>g g</dt>
<dd>Scroll to top</dd>
<dt>g h</dt>
<dd>Goto homepage</dd>
<dt>g s</dt>
<dd>Goto search<br>(current page)</dd>
<dt>/</dt>
<dd>Focus search box</dd>
</dl></div></nav>
<div id="goto">
    <div class="search">
         <div class="text"></div>
         <div class="results"><ul></ul></div>
   </div>
</div>

  <div id="breadcrumbs" class="row-fluid">
          
              
        <ul class="breadcrumbs-container">
            <li><a href="index-2.html">PHP Manual</a></li>      <li><a href="funcref.html">Function Reference</a></li>      <li><a href="refs.database.html">Database Extensions</a></li>      <li><a href="refs.database.abstract.html">Abstraction Layers</a></li>    </ul>
  </div>




<div id="layout">
  <section id="layout-content">
  <div id="book.pdo" class="book">
 
 <h1 class="title">PHP Data Objects</h1>
 
 
 
 
 
 
 







 







 





 

 







 







 







 








 



 



 



 



 



 




 

 






<ul class="chunklist chunklist_book"><li><a href="intro.pdo.html">Introduction</a></li><li><a href="pdo.setup.html">Installing/Configuring</a><ul class="chunklist chunklist_book chunklist_children"><li><a href="pdo.requirements.html">Requirements</a></li><li><a href="pdo.installation.html">Installation</a></li><li><a href="pdo.configuration.html">Runtime Configuration</a></li><li><a href="pdo.resources.html">Resource Types</a></li></ul></li><li><a href="pdo.constants.html">Predefined Constants</a></li><li><a href="pdo.connections.html">Connections and Connection management</a></li><li><a href="pdo.transactions.html">Transactions and auto-commit</a></li><li><a href="pdo.prepared-statements.html">Prepared statements and stored procedures</a></li><li><a href="pdo.error-handling.html">Errors and error handling</a></li><li><a href="pdo.lobs.html">Large Objects (LOBs)</a></li><li><a href="class.pdo.html">PDO</a> — The PDO class<ul class="chunklist chunklist_book chunklist_children"><li><a href="pdo.begintransaction.html">PDO::beginTransaction</a> — Initiates a transaction</li><li><a href="pdo.commit.html">PDO::commit</a> — Commits a transaction</li><li><a href="pdo.construct.html">PDO::__construct</a> — Creates a PDO instance representing a connection to a database</li><li><a href="pdo.errorcode.html">PDO::errorCode</a> — Fetch the SQLSTATE associated with the last operation on the database handle</li><li><a href="pdo.errorinfo.html">PDO::errorInfo</a> — Fetch extended error information associated with the last operation on the database handle</li><li><a href="pdo.exec.html">PDO::exec</a> — Execute an SQL statement and return the number of affected rows</li><li><a href="pdo.getattribute.html">PDO::getAttribute</a> — Retrieve a database connection attribute</li><li><a href="pdo.getavailabledrivers.html">PDO::getAvailableDrivers</a> — Return an array of available PDO drivers</li><li><a href="pdo.intransaction.html">PDO::inTransaction</a> — Checks if inside a transaction</li><li><a href="pdo.lastinsertid.html">PDO::lastInsertId</a> — Returns the ID of the last inserted row or sequence value</li><li><a href="pdo.prepare.html">PDO::prepare</a> — Prepares a statement for execution and returns a statement object</li><li><a href="pdo.query.html">PDO::query</a> — Executes an SQL statement, returning a result set as a PDOStatement object</li><li><a href="pdo.quote.html">PDO::quote</a> — Quotes a string for use in a query.</li><li><a href="pdo.rollback.html">PDO::rollBack</a> — Rolls back a transaction</li><li><a href="pdo.setattribute.html">PDO::setAttribute</a> — Set an attribute</li></ul></li><li><a href="class.pdostatement.html">PDOStatement</a> — The PDOStatement class<ul class="chunklist chunklist_book chunklist_children"><li><a href="pdostatement.bindcolumn.html">PDOStatement::bindColumn</a> — Bind a column to a PHP variable</li><li><a href="pdostatement.bindparam.html">PDOStatement::bindParam</a> — Binds a parameter to the specified variable name</li><li><a href="pdostatement.bindvalue.html">PDOStatement::bindValue</a> — Binds a value to a parameter</li><li><a href="pdostatement.closecursor.html">PDOStatement::closeCursor</a> — Closes the cursor, enabling the statement to be executed again.</li><li><a href="pdostatement.columncount.html">PDOStatement::columnCount</a> — Returns the number of columns in the result set</li><li><a href="pdostatement.debugdumpparams.html">PDOStatement::debugDumpParams</a> — Dump an SQL prepared command</li><li><a href="pdostatement.errorcode.html">PDOStatement::errorCode</a> — Fetch the SQLSTATE associated with the last operation on the statement handle</li><li><a href="pdostatement.errorinfo.html">PDOStatement::errorInfo</a> — Fetch extended error information associated with the last operation on the statement handle</li><li><a href="pdostatement.execute.html">PDOStatement::execute</a> — Executes a prepared statement</li><li><a href="pdostatement.fetch.html">PDOStatement::fetch</a> — Fetches the next row from a result set</li><li><a href="pdostatement.fetchall.html">PDOStatement::fetchAll</a> — Returns an array containing all of the result set rows</li><li><a href="pdostatement.fetchcolumn.html">PDOStatement::fetchColumn</a> — Returns a single column from the next row of a result set</li><li><a href="pdostatement.fetchobject.html">PDOStatement::fetchObject</a> — Fetches the next row and returns it as an object.</li><li><a href="pdostatement.getattribute.html">PDOStatement::getAttribute</a> — Retrieve a statement attribute</li><li><a href="pdostatement.getcolumnmeta.html">PDOStatement::getColumnMeta</a> — Returns metadata for a column in a result set</li><li><a href="pdostatement.nextrowset.html">PDOStatement::nextRowset</a> — Advances to the next rowset in a multi-rowset statement handle</li><li><a href="pdostatement.rowcount.html">PDOStatement::rowCount</a> — Returns the number of rows affected by the last SQL statement</li><li><a href="pdostatement.setattribute.html">PDOStatement::setAttribute</a> — Set a statement attribute</li><li><a href="pdostatement.setfetchmode.html">PDOStatement::setFetchMode</a> — Set the default fetch mode for this statement</li></ul></li><li><a href="class.pdoexception.html">PDOException</a> — The PDOException class</li><li><a href="pdo.drivers.html">PDO Drivers</a><ul class="chunklist chunklist_book chunklist_children"><li><a href="ref.pdo-cubrid.html">CUBRID (PDO)</a> — CUBRID Functions (PDO_CUBRID)</li><li><a href="ref.pdo-dblib.html">MS SQL Server (PDO)</a> — Microsoft SQL Server and Sybase Functions (PDO_DBLIB)</li><li><a href="ref.pdo-firebird.html">Firebird (PDO)</a> — Firebird Functions (PDO_FIREBIRD)</li><li><a href="ref.pdo-ibm.html">IBM (PDO)</a> — IBM Functions (PDO_IBM)</li><li><a href="ref.pdo-informix.html">Informix (PDO)</a> — Informix Functions (PDO_INFORMIX)</li><li><a href="ref.pdo-mysql.html">MySQL (PDO)</a> — MySQL Functions (PDO_MYSQL)</li><li><a href="ref.pdo-sqlsrv.html">MS SQL Server (PDO)</a> — Microsoft SQL Server Functions (PDO_SQLSRV)</li><li><a href="ref.pdo-oci.html">Oracle (PDO)</a> — Oracle Functions (PDO_OCI)</li><li><a href="ref.pdo-odbc.html">ODBC and DB2 (PDO)</a> — ODBC and DB2 Functions (PDO_ODBC)</li><li><a href="ref.pdo-pgsql.html">PostgreSQL (PDO)</a> — PostgreSQL Functions (PDO_PGSQL)</li><li><a href="ref.pdo-sqlite.html">SQLite (PDO)</a> — SQLite Functions (PDO_SQLITE)</li><li><a href="ref.pdo-4d.html">4D (PDO)</a> — 4D Functions (PDO_4D)</li></ul></li></ul></div>
<section id="usernotes">
 <div class="head"><h3 class="title">User Contributed Notes</h3></div><div id="allnotes">
  <div class="note" id="69304">  
  <a class="name">
  <strong class="user"><em>djlopez at gmx dot de</em></strong></a><div class="date" title="2006-08-30 02:56"><strong>7 years ago</strong></div>
  <div class="text" id="Hcom69304">
<div class="phpcode"><code><span class="html">
Please note this:<br><br>Won't work:<br>$sth = $dbh-&gt;prepare('SELECT name, colour, calories FROM ?&nbsp; WHERE calories &lt; ?');<br><br>THIS WORKS!<br>$sth = $dbh-&gt;prepare('SELECT name, colour, calories FROM fruit WHERE calories &lt; ?');<br><br>The parameter cannot be applied on table names!!</span>
</code></div>
  </div>
 </div>
  <div class="note" id="64950">  
  <a class="name">
  <strong class="user"><em>pokojny at radlight dot com</em></strong></a><div class="date" title="2006-04-23 08:50"><strong>8 years ago</strong></div>
  <div class="text" id="Hcom64950">
<div class="phpcode"><code><span class="html">
I wanted to extend PDO class to store statistics of DB usage, and I faced some problems. I wanted to count number of created statements and number of their executings. So PDOStatement should have link to PDO that created it and stores the statistical info. The problem was that I didn't knew how PDO creates PDOStatement (constructor parameters and so on), so I have created these two classes:<br><br><span class="default">&lt;?php<br></span><span class="comment">/**<br> * PHP Document Object plus<br> * <br> * PHP Document Object plus is library with functionality of PDO, entirely written<br> * in PHP, so that developer can easily extend it's classes with specific functionality,<br> * such as providing database usage statistics implemented in v1.0b<br> * <br> * @author Peter Pokojny<br> * @license <a rel="nofollow" target="_blank">http://opensource.org/licenses/gpl-license.php</a> GNU Public License<br> */<br>&nbsp; &nbsp; </span><span class="keyword">class </span><span class="default">PDOp </span><span class="keyword">{<br>&nbsp; &nbsp; &nbsp; &nbsp; protected </span><span class="default">$PDO</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; public </span><span class="default">$numExecutes</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; public </span><span class="default">$numStatements</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; public function </span><span class="default">__construct</span><span class="keyword">(</span><span class="default">$dsn</span><span class="keyword">, </span><span class="default">$user</span><span class="keyword">=</span><span class="default">NULL</span><span class="keyword">, </span><span class="default">$pass</span><span class="keyword">=</span><span class="default">NULL</span><span class="keyword">, </span><span class="default">$driver_options</span><span class="keyword">=</span><span class="default">NULL</span><span class="keyword">) {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">PDO </span><span class="keyword">= new </span><span class="default">PDO</span><span class="keyword">(</span><span class="default">$dsn</span><span class="keyword">, </span><span class="default">$user</span><span class="keyword">, </span><span class="default">$pass</span><span class="keyword">, </span><span class="default">$driver_options</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">numExecutes </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">numStatements </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; }<br>&nbsp; &nbsp; &nbsp; &nbsp; public function </span><span class="default">__call</span><span class="keyword">(</span><span class="default">$func</span><span class="keyword">, </span><span class="default">$args</span><span class="keyword">) {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; return </span><span class="default">call_user_func_array</span><span class="keyword">(array(&amp;</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">PDO</span><span class="keyword">, </span><span class="default">$func</span><span class="keyword">), </span><span class="default">$args</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; }<br>&nbsp; &nbsp; &nbsp; &nbsp; public function </span><span class="default">prepare</span><span class="keyword">() {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">numStatements</span><span class="keyword">++;<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$args </span><span class="keyword">= </span><span class="default">func_get_args</span><span class="keyword">();<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$PDOS </span><span class="keyword">= </span><span class="default">call_user_func_array</span><span class="keyword">(array(&amp;</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">PDO</span><span class="keyword">, </span><span class="string">'prepare'</span><span class="keyword">), </span><span class="default">$args</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; return new </span><span class="default">PDOpStatement</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">, </span><span class="default">$PDOS</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; }<br>&nbsp; &nbsp; &nbsp; &nbsp; public function </span><span class="default">query</span><span class="keyword">() {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">numExecutes</span><span class="keyword">++;<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">numStatements</span><span class="keyword">++;<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$args </span><span class="keyword">= </span><span class="default">func_get_args</span><span class="keyword">();<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$PDOS </span><span class="keyword">= </span><span class="default">call_user_func_array</span><span class="keyword">(array(&amp;</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">PDO</span><span class="keyword">, </span><span class="string">'query'</span><span class="keyword">), </span><span class="default">$args</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; return new </span><span class="default">PDOpStatement</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">, </span><span class="default">$PDOS</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; }<br>&nbsp; &nbsp; &nbsp; &nbsp; public function </span><span class="default">exec</span><span class="keyword">() {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">numExecutes</span><span class="keyword">++;<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$args </span><span class="keyword">= </span><span class="default">func_get_args</span><span class="keyword">();<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; return </span><span class="default">call_user_func_array</span><span class="keyword">(array(&amp;</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">PDO</span><span class="keyword">, </span><span class="string">'exec'</span><span class="keyword">), </span><span class="default">$args</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; }<br>&nbsp; &nbsp; }<br>&nbsp; &nbsp; class </span><span class="default">PDOpStatement </span><span class="keyword">implements </span><span class="default">IteratorAggregate </span><span class="keyword">{<br>&nbsp; &nbsp; &nbsp; &nbsp; protected </span><span class="default">$PDOS</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; protected </span><span class="default">$PDOp</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; public function </span><span class="default">__construct</span><span class="keyword">(</span><span class="default">$PDOp</span><span class="keyword">, </span><span class="default">$PDOS</span><span class="keyword">) {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">PDOp </span><span class="keyword">= </span><span class="default">$PDOp</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">PDOS </span><span class="keyword">= </span><span class="default">$PDOS</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; }<br>&nbsp; &nbsp; &nbsp; &nbsp; public function </span><span class="default">__call</span><span class="keyword">(</span><span class="default">$func</span><span class="keyword">, </span><span class="default">$args</span><span class="keyword">) {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; return </span><span class="default">call_user_func_array</span><span class="keyword">(array(&amp;</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">PDOS</span><span class="keyword">, </span><span class="default">$func</span><span class="keyword">), </span><span class="default">$args</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; }<br>&nbsp; &nbsp; &nbsp; &nbsp; public function </span><span class="default">bindColumn</span><span class="keyword">(</span><span class="default">$column</span><span class="keyword">, &amp;</span><span class="default">$param</span><span class="keyword">, </span><span class="default">$type</span><span class="keyword">=</span><span class="default">NULL</span><span class="keyword">) {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if (</span><span class="default">$type </span><span class="keyword">=== </span><span class="default">NULL</span><span class="keyword">)<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">PDOS</span><span class="keyword">-&gt;</span><span class="default">bindColumn</span><span class="keyword">(</span><span class="default">$column</span><span class="keyword">, </span><span class="default">$param</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; else<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">PDOS</span><span class="keyword">-&gt;</span><span class="default">bindColumn</span><span class="keyword">(</span><span class="default">$column</span><span class="keyword">, </span><span class="default">$param</span><span class="keyword">, </span><span class="default">$type</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; }<br>&nbsp; &nbsp; &nbsp; &nbsp; public function </span><span class="default">bindParam</span><span class="keyword">(</span><span class="default">$column</span><span class="keyword">, &amp;</span><span class="default">$param</span><span class="keyword">, </span><span class="default">$type</span><span class="keyword">=</span><span class="default">NULL</span><span class="keyword">) {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if (</span><span class="default">$type </span><span class="keyword">=== </span><span class="default">NULL</span><span class="keyword">)<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">PDOS</span><span class="keyword">-&gt;</span><span class="default">bindParam</span><span class="keyword">(</span><span class="default">$column</span><span class="keyword">, </span><span class="default">$param</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; else<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">PDOS</span><span class="keyword">-&gt;</span><span class="default">bindParam</span><span class="keyword">(</span><span class="default">$column</span><span class="keyword">, </span><span class="default">$param</span><span class="keyword">, </span><span class="default">$type</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; }<br>&nbsp; &nbsp; &nbsp; &nbsp; public function </span><span class="default">execute</span><span class="keyword">() {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">PDOp</span><span class="keyword">-&gt;</span><span class="default">numExecutes</span><span class="keyword">++;<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$args </span><span class="keyword">= </span><span class="default">func_get_args</span><span class="keyword">();<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; return </span><span class="default">call_user_func_array</span><span class="keyword">(array(&amp;</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">PDOS</span><span class="keyword">, </span><span class="string">'execute'</span><span class="keyword">), </span><span class="default">$args</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; }<br>&nbsp; &nbsp; &nbsp; &nbsp; public function </span><span class="default">__get</span><span class="keyword">(</span><span class="default">$property</span><span class="keyword">) {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; return </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">PDOS</span><span class="keyword">-&gt;</span><span class="default">$property</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; }<br>&nbsp; &nbsp; &nbsp; &nbsp; public function </span><span class="default">getIterator</span><span class="keyword">() {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; return </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">PDOS</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; }<br>&nbsp;&nbsp; }<br></span><span class="default">?&gt;<br></span><br>Classes have properties with original PDO and PDOStatement objects, which are providing the functionality to PDOp and PDOpStatement.<br>From outside, PDOp and PDOpStatement look like PDO and PDOStatement, but also are providing wanted info.</span>
</code></div>
  </div>
 </div>
  <div class="note" id="69963">  
  <a class="name">
  <strong class="user"><em>webform at aouie dot website</em></strong></a><div class="date" title="2006-09-27 11:38"><strong>7 years ago</strong></div>
  <div class="text" id="Hcom69963">
<div class="phpcode"><code><span class="html">
If you use $dbh = new PDO('pgsql:host=localhost;dbname=test_basic01', $user, $pass); and you get the following error:<br>PHP Fatal error:&nbsp; Uncaught exception 'PDOException' with message 'SQLSTATE[08006] [7] could not connect to server: Connection refused\n\tIs the server running on host "localhost" and accepting\n\tTCP/IP connections on port 5432?'<br>then as pointed out under pg_connect at: <a rel="nofollow" target="_blank">http://www.php.net/manual/en/function.pg-connect.php#38291</a> <br>******<br>you should try to leave the host= and port= parts out of the connection string. This sounds strange, but this is an "option" of Postgre. If you have not activated the TCP/IP port in postgresql.conf then postgresql doesn't accept any incoming requests from an TCP/IP port. If you use host= in your connection string you are going to connect to Postgre via TCP/IP, so that's not going to work. If you leave the host= part out of your connection string you connect to Postgre via the Unix domain sockets, which is faster and more secure, but you can't connect with the database via any other PC as the localhost.<br>******<br>Sincerely,<br>Aouie</span>
</code></div>
  </div>
 </div>
  <div class="note" id="98659">  
  <a class="name">
  <strong class="user"><em>lkmorlan at uwaterloo dot ca</em></strong></a><div class="date" title="2010-06-29 09:38"><strong>4 years ago</strong></div>
  <div class="text" id="Hcom98659">
<div class="phpcode"><code><span class="html">
This works to get UTF8 data from MSSQL:<br><br><span class="default">&lt;?php<br>$db </span><span class="keyword">= new </span><span class="default">PDO</span><span class="keyword">(</span><span class="string">'dblib:host=your_hostname;dbname=your_db;charset=UTF-8'</span><span class="keyword">, </span><span class="default">$user</span><span class="keyword">, </span><span class="default">$pass</span><span class="keyword">);<br></span><span class="default">?&gt;</span>
</span>
</code></div>
  </div>
 </div>
  <div class="note" id="61824">  
  <a class="name">
  <strong class="user"><em>Dariusz Kielar</em></strong></a><div class="date" title="2006-02-12 10:50"><strong>8 years ago</strong></div>
  <div class="text" id="Hcom61824">
<div class="phpcode"><code><span class="html">
I found a nice pdo modification written in php called Open Power Driver. It has identical API with the original, but allows you to cache query results: <a rel="nofollow" target="_blank">http://www.openpb.net/opd.php</a></span>
</code></div>
  </div>
 </div>
  <div class="note" id="73829">  
  <a class="name">
  <strong class="user"><em>djlopez at gmx dot de</em></strong></a><div class="date" title="2007-03-12 05:04"><strong>7 years ago</strong></div>
  <div class="text" id="Hcom73829">
<div class="phpcode"><code><span class="html">
Note this:<br><br>Won't work:<br>$sth = $dbh-&gt;prepare('SELECT name, colour, calories FROM fruit WHERE ? &lt; ?');<br><br>THIS WORKS!<br>$sth = $dbh-&gt;prepare('SELECT name, colour, calories FROM fruit WHERE calories &lt; ?');<br><br>Parameters cannot be applied on column names!!</span>
</code></div>
  </div>
 </div>
  <div class="note" id="59355">  
  <a class="name">
  <strong class="user"><em>Matthias Leuffen</em></strong></a><div class="date" title="2005-12-04 01:36"><strong>8 years ago</strong></div>
  <div class="text" id="Hcom59355">
<div class="phpcode"><code><span class="html">
Hi there,<br><br>because of ZDE 5.0 and other PHP-IDEs do not seem to support PDO from PHP5.1 in code-completion-database yet, I wrote a code-completion alias for the PDO class.<br>NOTE: This Class has no functionality and should be only included to your IDE-Project but NOT(!) to your application.<br><br><span class="default">&lt;?php<br></span><span class="comment">/**<br> * This is a Code-Completion only file<br> * (For use with ZDE or other IDEs)<br> * <br> * Do NOT include() or require() this to your code<br> * <br> * @author Matthias Leuffen<br> */<br><br>&nbsp; &nbsp; </span><span class="keyword">class </span><span class="default">PDO </span><span class="keyword">{<br>&nbsp; &nbsp; &nbsp; &nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="comment">/**<br>&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; * Error Constants<br>&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; *<br>&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; */<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="keyword">const </span><span class="default">ERR_ALREADY_EXISTS </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; const </span><span class="default">ERR_CANT_MAP </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; const </span><span class="default">ERR_NOT_FOUND </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; const </span><span class="default">ERR_SYNTAX </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; const </span><span class="default">ERR_CONSTRAINT </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; const </span><span class="default">ERR_MISMATCH </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; const </span><span class="default">ERR_DISCONNECTED </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; const </span><span class="default">ERR_NONE </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">;<br><br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="comment">/**<br>&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; * Attributes (to use in PDO::setAttribute() as 1st Parameter)<br>&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; *<br>&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; */<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="keyword">const </span><span class="default">ATTR_ERRMODE </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; const </span><span class="default">ATTR_TIMEOUT </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; const </span><span class="default">ATTR_AUTOCOMMIT </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; const </span><span class="default">ATTR_PERSISTENT </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">;<br><br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="comment">// Values for ATTR_ERRMODE<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="keyword">const </span><span class="default">ERRMODE_EXCEPTION </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; const </span><span class="default">ERRMODE_WARNING </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">;<br><br>&nbsp; &nbsp; &nbsp; &nbsp; const </span><span class="default">FETCH_ASSOC </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; const </span><span class="default">FETCH_NUM </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; const </span><span class="default">FETCH_OBJ </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; public function </span><span class="default">__construct</span><span class="keyword">(</span><span class="default">$uri</span><span class="keyword">, </span><span class="default">$user</span><span class="keyword">, </span><span class="default">$pass</span><span class="keyword">, </span><span class="default">$optsArr</span><span class="keyword">) {<br>&nbsp; &nbsp; &nbsp; &nbsp; }<br>&nbsp; &nbsp; &nbsp; &nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="comment">/**<br>&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; * Prepare Statement: Returns PDOStatement<br>&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; *<br>&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; * @param string $prepareString<br>&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; * @return PDOStatement<br>&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; */<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="keyword">public function </span><span class="default">prepare </span><span class="keyword">(</span><span class="default">$prepareString</span><span class="keyword">) {<br>&nbsp; &nbsp; &nbsp; &nbsp; }<br>&nbsp; &nbsp; &nbsp; &nbsp; public function </span><span class="default">query </span><span class="keyword">(</span><span class="default">$queryString</span><span class="keyword">) {<br>&nbsp; &nbsp; &nbsp; &nbsp; }<br>&nbsp; &nbsp; &nbsp; &nbsp; public function </span><span class="default">quote </span><span class="keyword">(</span><span class="default">$input</span><span class="keyword">) {<br>&nbsp; &nbsp; &nbsp; &nbsp; }<br>&nbsp; &nbsp; &nbsp; &nbsp; public function </span><span class="default">exec </span><span class="keyword">(</span><span class="default">$statement</span><span class="keyword">) {<br>&nbsp; &nbsp; &nbsp; &nbsp; }<br>&nbsp; &nbsp; &nbsp; &nbsp; public function </span><span class="default">lastInsertId</span><span class="keyword">() {<br>&nbsp; &nbsp; &nbsp; &nbsp; }<br>&nbsp; &nbsp; &nbsp; &nbsp; public function </span><span class="default">beginTransaction </span><span class="keyword">() {<br>&nbsp; &nbsp; &nbsp; &nbsp; }<br>&nbsp; &nbsp; &nbsp; &nbsp; public function </span><span class="default">commit </span><span class="keyword">() {<br>&nbsp; &nbsp; &nbsp; &nbsp; }<br>&nbsp; &nbsp; &nbsp; &nbsp; public function </span><span class="default">rollBack </span><span class="keyword">() {<br>&nbsp; &nbsp; &nbsp; &nbsp; }<br>&nbsp; &nbsp; &nbsp; &nbsp; public function </span><span class="default">errorCode </span><span class="keyword">() {<br>&nbsp; &nbsp; &nbsp; &nbsp; }<br>&nbsp; &nbsp; &nbsp; &nbsp; public function </span><span class="default">errorInfo </span><span class="keyword">() {<br>&nbsp; &nbsp; &nbsp; &nbsp; }&nbsp; &nbsp; &nbsp; &nbsp; <br>&nbsp; &nbsp; }<br>&nbsp; &nbsp; <br>&nbsp; &nbsp; class </span><span class="default">PDOStatement </span><span class="keyword">{<br>&nbsp; &nbsp; &nbsp; &nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; public function </span><span class="default">bindValue </span><span class="keyword">(</span><span class="default">$no</span><span class="keyword">, </span><span class="default">$value</span><span class="keyword">) {<br>&nbsp; &nbsp; &nbsp; &nbsp; }<br>&nbsp; &nbsp; &nbsp; &nbsp; public function </span><span class="default">fetch </span><span class="keyword">() {<br>&nbsp; &nbsp; &nbsp; &nbsp; }<br>&nbsp; &nbsp; &nbsp; &nbsp; public function </span><span class="default">nextRowset </span><span class="keyword">() {<br>&nbsp; &nbsp; &nbsp; &nbsp; }<br>&nbsp; &nbsp; &nbsp; &nbsp; public function </span><span class="default">execute</span><span class="keyword">() {<br>&nbsp; &nbsp; &nbsp; &nbsp; }<br>&nbsp; &nbsp; &nbsp; &nbsp; public function </span><span class="default">errorCode </span><span class="keyword">() {<br>&nbsp; &nbsp; &nbsp; &nbsp; }<br>&nbsp; &nbsp; &nbsp; &nbsp; public function </span><span class="default">errorInfo </span><span class="keyword">() {<br>&nbsp; &nbsp; &nbsp; &nbsp; }<br>&nbsp; &nbsp; &nbsp; &nbsp; public function </span><span class="default">rowCount </span><span class="keyword">() {<br>&nbsp; &nbsp; &nbsp; &nbsp; }<br>&nbsp; &nbsp; &nbsp; &nbsp; public function </span><span class="default">setFetchMode </span><span class="keyword">(</span><span class="default">$mode</span><span class="keyword">) {<br>&nbsp; &nbsp; &nbsp; &nbsp; }<br>&nbsp; &nbsp; &nbsp; &nbsp; public function </span><span class="default">columnCount </span><span class="keyword">() {<br>&nbsp; &nbsp; &nbsp; &nbsp; }<br>&nbsp; &nbsp; }</span>
</span>
</code></div>
  </div>
 </div>
  <div class="note" id="93178">  
  <a class="name">
  <strong class="user"><em>paul dot maddox at gmail dot com</em></strong></a><div class="date" title="2009-08-27 05:54"><strong>5 years ago</strong></div>
  <div class="text" id="Hcom93178">
<div class="phpcode"><code><span class="html">
I decided to create a singleton wrapper for PDO that ensures only one instance is ever used.
<br>It uses PHP 5.3.0's __callStatic functionality to pass on statically called methods to PDO.
<br>
<br>This means you can just call it statically from anywhere without having to initiate or define the object.
<br>
<br>Usage examples:
<br>
<br><span class="default">&lt;?php
<br>DB</span><span class="keyword">::</span><span class="default">exec</span><span class="keyword">(</span><span class="string">"DELETE FROM Blah"</span><span class="keyword">);
<br>
<br>foreach( </span><span class="default">DB</span><span class="keyword">::</span><span class="default">query</span><span class="keyword">(</span><span class="string">"SELECT * FROM Blah"</span><span class="keyword">) as </span><span class="default">$row</span><span class="keyword">){
<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">print_r</span><span class="keyword">(</span><span class="default">$row</span><span class="keyword">);
<br>}
<br></span><span class="default">?&gt;
<br></span>
<br>Code:
<br>
<br><span class="default">&lt;?php
<br>
<br></span><span class="keyword">class </span><span class="default">DB </span><span class="keyword">{
<br>&nbsp; &nbsp; 
<br>&nbsp; &nbsp; private static </span><span class="default">$objInstance</span><span class="keyword">;
<br>&nbsp; &nbsp; 
<br>&nbsp; &nbsp; </span><span class="comment">/*
<br>&nbsp; &nbsp;&nbsp; * Class Constructor - Create a new database connection if one doesn't exist
<br>&nbsp; &nbsp;&nbsp; * Set to private so no-one can create a new instance via ' = new DB();'
<br>&nbsp; &nbsp;&nbsp; */
<br>&nbsp; &nbsp; </span><span class="keyword">private function </span><span class="default">__construct</span><span class="keyword">() {} 
<br>&nbsp; &nbsp; 
<br>&nbsp; &nbsp; </span><span class="comment">/*
<br>&nbsp; &nbsp;&nbsp; * Like the constructor, we make __clone private so nobody can clone the instance
<br>&nbsp; &nbsp;&nbsp; */
<br>&nbsp; &nbsp; </span><span class="keyword">private function </span><span class="default">__clone</span><span class="keyword">() {}
<br>&nbsp; &nbsp; 
<br>&nbsp; &nbsp; </span><span class="comment">/*
<br>&nbsp; &nbsp;&nbsp; * Returns DB instance or create initial connection
<br>&nbsp; &nbsp;&nbsp; * @param 
<br>&nbsp; &nbsp;&nbsp; * @return $objInstance;
<br>&nbsp; &nbsp;&nbsp; */
<br>&nbsp; &nbsp; </span><span class="keyword">public static function </span><span class="default">getInstance</span><span class="keyword">(&nbsp; ) {
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
<br>&nbsp; &nbsp; &nbsp; &nbsp; if(!</span><span class="default">self</span><span class="keyword">::</span><span class="default">$objInstance</span><span class="keyword">){
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">self</span><span class="keyword">::</span><span class="default">$objInstance </span><span class="keyword">= new </span><span class="default">PDO</span><span class="keyword">(</span><span class="default">DB_DSN</span><span class="keyword">, </span><span class="default">DB_USER</span><span class="keyword">, </span><span class="default">DB_PASS</span><span class="keyword">);
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">self</span><span class="keyword">::</span><span class="default">$objInstance</span><span class="keyword">-&gt;</span><span class="default">setAttribute</span><span class="keyword">(</span><span class="default">PDO</span><span class="keyword">::</span><span class="default">ATTR_ERRMODE</span><span class="keyword">, </span><span class="default">PDO</span><span class="keyword">::</span><span class="default">ERRMODE_EXCEPTION</span><span class="keyword">);
<br>&nbsp; &nbsp; &nbsp; &nbsp; }
<br>&nbsp; &nbsp; &nbsp; &nbsp; 
<br>&nbsp; &nbsp; &nbsp; &nbsp; return </span><span class="default">self</span><span class="keyword">::</span><span class="default">$objInstance</span><span class="keyword">;
<br>&nbsp; &nbsp; 
<br>&nbsp; &nbsp; } </span><span class="comment"># end method
<br>&nbsp; &nbsp; 
<br>&nbsp; &nbsp; /*
<br>&nbsp; &nbsp;&nbsp; * Passes on any static calls to this class onto the singleton PDO instance
<br>&nbsp; &nbsp;&nbsp; * @param $chrMethod, $arrArguments
<br>&nbsp; &nbsp;&nbsp; * @return $mix
<br>&nbsp; &nbsp;&nbsp; */
<br>&nbsp; &nbsp; </span><span class="keyword">final public static function </span><span class="default">__callStatic</span><span class="keyword">( </span><span class="default">$chrMethod</span><span class="keyword">, </span><span class="default">$arrArguments </span><span class="keyword">) {
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$objInstance </span><span class="keyword">= </span><span class="default">self</span><span class="keyword">::</span><span class="default">getInstance</span><span class="keyword">();
<br>&nbsp; &nbsp; &nbsp; &nbsp; 
<br>&nbsp; &nbsp; &nbsp; &nbsp; return </span><span class="default">call_user_func_array</span><span class="keyword">(array(</span><span class="default">$objInstance</span><span class="keyword">, </span><span class="default">$chrMethod</span><span class="keyword">), </span><span class="default">$arrArguments</span><span class="keyword">);
<br>&nbsp; &nbsp; &nbsp; &nbsp; 
<br>&nbsp; &nbsp; } </span><span class="comment"># end method
<br>&nbsp; &nbsp; 
<br></span><span class="keyword">}
<br></span><span class="default">?&gt;</span>
</span>
</code></div>
  </div>
 </div>
  <div class="note" id="60269">  
  <a class="name">
  <strong class="user"><em>tomasz dot wasiluk at gmail dot com</em></strong></a><div class="date" title="2006-01-01 04:09"><strong>8 years ago</strong></div>
  <div class="text" id="Hcom60269">
<div class="phpcode"><code><span class="html">
Watch out for putting spaces in the DSN<br>mysql:host=localhost;dbname=test works<br>mysql: host = localhost; dbname=test works<br>mysql: host = localhost; dbname = test doesn't work...</span>
</code></div>
  </div>
 </div>
  <div class="note" id="62798">  
  <a class="name">
  <strong class="user"><em>keyvez at hotmail dot com</em></strong></a><div class="date" title="2006-03-09 12:49"><strong>8 years ago</strong></div>
  <div class="text" id="Hcom62798">
<div class="phpcode"><code><span class="html">
PDO doesn't return OUTPUT params from mssql stored procedures<br><br>/* Stored Procedure Create Code: */<br>/*<br>CREATE PROCEDURE p_sel_all_termlength @err INT OUTPUT AS<br>SET @err = 2627<br>*/<br><br>/* PHP Code: */<br><span class="default">&lt;?php<br>&nbsp; &nbsp; $Link </span><span class="keyword">= new </span><span class="default">PDO</span><span class="keyword">(</span><span class="string">'mssql:host=sqlserver;dbname=database'</span><span class="keyword">, </span><span class="string">'username'</span><span class="keyword">,<br></span><span class="string">'password'</span><span class="keyword">);<br>&nbsp; &nbsp; <br>&nbsp; &nbsp; </span><span class="default">$ErrorCode </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">;<br>&nbsp; &nbsp; <br>&nbsp; &nbsp; </span><span class="default">$Stmt </span><span class="keyword">= </span><span class="default">$Link</span><span class="keyword">-&gt;</span><span class="default">prepare</span><span class="keyword">(</span><span class="string">'p_sel_all_termlength ?'</span><span class="keyword">);<br>&nbsp; &nbsp; </span><span class="default">$Stmt</span><span class="keyword">-&gt;</span><span class="default">bindParam</span><span class="keyword">(</span><span class="default">1</span><span class="keyword">,</span><span class="default">$ErrorCode</span><span class="keyword">,</span><span class="default">PDO</span><span class="keyword">::</span><span class="default">PARAM_INT</span><span class="keyword">,</span><span class="default">4</span><span class="keyword">);<br>&nbsp; &nbsp; </span><span class="default">$Stmt</span><span class="keyword">-&gt;</span><span class="default">execute</span><span class="keyword">();<br>&nbsp; &nbsp; echo </span><span class="string">"Error = " </span><span class="keyword">. </span><span class="default">$ErrorCode </span><span class="keyword">. </span><span class="string">"\n"</span><span class="keyword">;<br></span><span class="default">?&gt;<br></span><br>/* PHP Output:<br>Error = 0<br>*/</span>
</code></div>
  </div>
 </div>
  <div class="note" id="112641">  
  <a class="name">
  <strong class="user"><em>Sbastien Gourmand</em></strong></a><div class="date" title="2013-07-08 10:19"><strong>1 year ago</strong></div>
  <div class="text" id="Hcom112641">
<div class="phpcode"><code><span class="html">
Merge the prepare() and execute() in one function like a sprintf().<br>And like sprintf, I choose to use unnamed args (?) ;)<br><br>you could still use old insecure query() ( not prepared ) with renamed function :)<br><br><span class="default">&lt;?php<br></span><span class="keyword">class </span><span class="default">MyPDO </span><span class="keyword">extends </span><span class="default">PDO</span><span class="keyword">{<br><br>&nbsp; &nbsp; const </span><span class="default">PARAM_host</span><span class="keyword">=</span><span class="string">'localhost'</span><span class="keyword">;<br>&nbsp; &nbsp; const </span><span class="default">PARAM_port</span><span class="keyword">=</span><span class="string">'3306'</span><span class="keyword">;<br>&nbsp; &nbsp; const </span><span class="default">PARAM_db_name</span><span class="keyword">=</span><span class="string">'test'</span><span class="keyword">;<br>&nbsp; &nbsp; const </span><span class="default">PARAM_user</span><span class="keyword">=</span><span class="string">'root'</span><span class="keyword">;<br>&nbsp; &nbsp; const </span><span class="default">PARAM_db_pass</span><span class="keyword">=</span><span class="string">''</span><span class="keyword">;<br><br>&nbsp; &nbsp; public function </span><span class="default">__construct</span><span class="keyword">(</span><span class="default">$options</span><span class="keyword">=</span><span class="default">null</span><span class="keyword">){<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">parent</span><span class="keyword">::</span><span class="default">__construct</span><span class="keyword">(</span><span class="string">'mysql:host='</span><span class="keyword">.</span><span class="default">MyPDO</span><span class="keyword">::</span><span class="default">PARAM_host</span><span class="keyword">.</span><span class="string">';port='</span><span class="keyword">.</span><span class="default">MyPDO</span><span class="keyword">::</span><span class="default">PARAM_port</span><span class="keyword">.</span><span class="string">';dbname='</span><span class="keyword">.</span><span class="default">MyPDO</span><span class="keyword">::</span><span class="default">PARAM_db_name</span><span class="keyword">,<br></span><span class="default">MyPDO</span><span class="keyword">::</span><span class="default">PARAM_user</span><span class="keyword">,<br></span><span class="default">MyPDO</span><span class="keyword">::</span><span class="default">PARAM_db_pass</span><span class="keyword">,</span><span class="default">$options</span><span class="keyword">);<br>&nbsp; &nbsp; }<br><br>&nbsp; &nbsp; public function </span><span class="default">query</span><span class="keyword">(</span><span class="default">$query</span><span class="keyword">){ </span><span class="comment">//secured query with prepare and execute<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$args </span><span class="keyword">= </span><span class="default">func_get_args</span><span class="keyword">();<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">array_shift</span><span class="keyword">(</span><span class="default">$args</span><span class="keyword">); </span><span class="comment">//first element is not an argument but the query itself, should removed<br><br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$reponse </span><span class="keyword">= </span><span class="default">parent</span><span class="keyword">::</span><span class="default">prepare</span><span class="keyword">(</span><span class="default">$query</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$reponse</span><span class="keyword">-&gt;</span><span class="default">execute</span><span class="keyword">(</span><span class="default">$args</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; return </span><span class="default">$reponse</span><span class="keyword">;<br><br>&nbsp; &nbsp; }<br><br>&nbsp; &nbsp; public function </span><span class="default">insecureQuery</span><span class="keyword">(</span><span class="default">$query</span><span class="keyword">){ </span><span class="comment">//you can use the old query at your risk ;) and should use secure quote() function with it<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="keyword">return </span><span class="default">parent</span><span class="keyword">::</span><span class="default">query</span><span class="keyword">(</span><span class="default">$query</span><span class="keyword">);<br>&nbsp; &nbsp; }<br><br>}<br><br></span><span class="default">$db </span><span class="keyword">= new </span><span class="default">MyPDO</span><span class="keyword">();<br></span><span class="default">$db</span><span class="keyword">-&gt;</span><span class="default">setAttribute</span><span class="keyword">(</span><span class="default">PDO</span><span class="keyword">::</span><span class="default">ATTR_DEFAULT_FETCH_MODE</span><span class="keyword">, </span><span class="default">PDO</span><span class="keyword">::</span><span class="default">FETCH_OBJ</span><span class="keyword">);<br><br></span><span class="default">$t1 </span><span class="keyword">= isset(</span><span class="default">$_GET</span><span class="keyword">[</span><span class="string">"t1"</span><span class="keyword">])?</span><span class="default">$_GET</span><span class="keyword">[</span><span class="string">"t1"</span><span class="keyword">]:</span><span class="default">1</span><span class="keyword">; </span><span class="comment">// need to be securised for injonction<br></span><span class="default">$t2 </span><span class="keyword">= isset(</span><span class="default">$_GET</span><span class="keyword">[</span><span class="string">"t2"</span><span class="keyword">])?</span><span class="default">$_GET</span><span class="keyword">[</span><span class="string">"t2"</span><span class="keyword">]:</span><span class="default">2</span><span class="keyword">; </span><span class="comment">// need to be securised for injonction<br></span><span class="default">$t3 </span><span class="keyword">= isset(</span><span class="default">$_GET</span><span class="keyword">[</span><span class="string">"t3"</span><span class="keyword">])?</span><span class="default">$_GET</span><span class="keyword">[</span><span class="string">"t3"</span><span class="keyword">]:</span><span class="default">3</span><span class="keyword">; </span><span class="comment">// need to be securised for injonction<br><br></span><span class="default">$ret </span><span class="keyword">= </span><span class="default">$db</span><span class="keyword">-&gt;</span><span class="default">query</span><span class="keyword">(</span><span class="string">"SELECT * FROM table_test WHERE t1=? AND t2=? AND t3=?"</span><span class="keyword">,</span><span class="default">$t1</span><span class="keyword">,</span><span class="default">$t2</span><span class="keyword">,</span><span class="default">$t3</span><span class="keyword">);<br></span><span class="comment">//$ret = $db-&gt;insecureQuery("SELECT * FROM table_test WHERE t1=".$db-&gt;quote($t1));<br><br></span><span class="keyword">while (</span><span class="default">$o </span><span class="keyword">= </span><span class="default">$ret</span><span class="keyword">-&gt;</span><span class="default">fetch</span><span class="keyword">())<br>{<br>&nbsp; &nbsp; echo </span><span class="default">$o</span><span class="keyword">-&gt;</span><span class="default">nom</span><span class="keyword">.</span><span class="default">PHP_EOL</span><span class="keyword">;<br>}<br></span><span class="default">?&gt;</span>
</span>
</code></div>
  </div>
 </div>
  <div class="note" id="114974">  
  <a class="name">
  <strong class="user"><em>matthew at button-mashers dot net</em></strong></a><div class="date" title="2014-05-07 11:31"><strong>3 months ago</strong></div>
  <div class="text" id="Hcom114974">
<div class="phpcode"><code><span class="html">
When using prepared statements there is no official PDO feature to show you the final query string that is submitted to a database complete with the parameters you passed.<br><br>Use this simple function for debugging. The values you are passing may not be what you expect.<br><br><span class="default">&lt;?php<br></span><span class="comment">//Sample query string<br></span><span class="default">$query </span><span class="keyword">= </span><span class="string">"UPDATE users SET name = :user_name WHERE id = :user_id"</span><span class="keyword">;<br><br></span><span class="comment">//Sample parameters<br></span><span class="default">$params </span><span class="keyword">= [</span><span class="string">':user_name' </span><span class="keyword">=&gt; </span><span class="string">'foobear'</span><span class="keyword">, </span><span class="string">':user_id' </span><span class="keyword">=&gt; </span><span class="default">1001</span><span class="keyword">];<br><br>function </span><span class="default">build_pdo_query</span><span class="keyword">(</span><span class="default">$string</span><span class="keyword">, </span><span class="default">$array</span><span class="keyword">) {<br>&nbsp; &nbsp; </span><span class="comment">//Get the key lengths for each of the array elements.<br>&nbsp; &nbsp; </span><span class="default">$keys </span><span class="keyword">= </span><span class="default">array_map</span><span class="keyword">(</span><span class="string">'strlen'</span><span class="keyword">, </span><span class="default">array_keys</span><span class="keyword">(</span><span class="default">$array</span><span class="keyword">));<br><br>&nbsp; &nbsp; </span><span class="comment">//Sort the array by string length so the longest strings are replaced first.<br>&nbsp; &nbsp; </span><span class="default">array_multisort</span><span class="keyword">(</span><span class="default">$keys</span><span class="keyword">, </span><span class="default">SORT_DESC</span><span class="keyword">, </span><span class="default">$array</span><span class="keyword">);<br><br>&nbsp; &nbsp; foreach(</span><span class="default">$array </span><span class="keyword">as </span><span class="default">$k </span><span class="keyword">=&gt; </span><span class="default">$v</span><span class="keyword">) {<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="comment">//Quote non-numeric values.<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$replacement </span><span class="keyword">= </span><span class="default">is_numeric</span><span class="keyword">(</span><span class="default">$v</span><span class="keyword">) ? </span><span class="default">$v </span><span class="keyword">: </span><span class="string">"'</span><span class="keyword">{</span><span class="default">$v</span><span class="keyword">}</span><span class="string">'"</span><span class="keyword">;<br><br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="comment">//Replace the needle.<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$string </span><span class="keyword">= </span><span class="default">str_replace</span><span class="keyword">(</span><span class="default">$k</span><span class="keyword">, </span><span class="default">$replacement</span><span class="keyword">, </span><span class="default">$string</span><span class="keyword">);<br>&nbsp; &nbsp; }<br><br>&nbsp; &nbsp; return </span><span class="default">$string</span><span class="keyword">;<br>}<br><br>echo </span><span class="default">build_pdo_query</span><span class="keyword">(</span><span class="default">$query</span><span class="keyword">, </span><span class="default">$params</span><span class="keyword">);&nbsp; &nbsp; </span><span class="comment">//UPDATE users SET name = 'foobear' WHERE id = 1001<br></span><span class="default">?&gt;</span>
</span>
</code></div>
  </div>
 </div>
  <div class="note" id="96264">  
  <a class="name">
  <strong class="user"><em>jose at thezcompany dot com</em></strong></a><div class="date" title="2010-02-17 12:39"><strong>4 years ago</strong></div>
  <div class="text" id="Hcom96264">
<div class="phpcode"><code><span class="html">
I ran into a real annoying bug/feature when using PDO for SQL statements that use SQL user variables.&nbsp; I was working on some logic for a Geo Proximity Search for an events-venues system (sharing is caring so it's below) and it just wouldn't take and the errors returned were garbage. The SQL was sound as I verified it.&nbsp; So if you're having this issue, I hope this helps.&nbsp; What you need to do is break apart the query into two...<br><br>From:<br><span class="default">&lt;?php<br>$sql</span><span class="keyword">=</span><span class="string">"set @latitude=:lat;<br>set @longitude=:lon;<br>set @radius=20;<br><br>set @lng_min = @longitude - @radius/abs(cos(radians(@latitude))*69);<br>set @lng_max = @longitude + @radius/abs(cos(radians(@latitude))*69);<br>set @lat_min = @latitude - (@radius/69);<br>set @lat_max = @latitude + (@radius/69);<br><br>SELECT *,<br>3956 * 2 * ASIN(SQRT(POWER(SIN((@latitude - ABS(venue_lat)) * PI()/180 / 2),2) + COS(@latitude * PI()/180) * COS(ABS(venue_lat) * PI()/180) * POWER(SIN((@longitude - venue_lon) * PI()/180 / 2),2))) AS distance<br>FROM events LEFT JOIN venues ON venues.venue_id = events.venue_fk<br>WHERE (venue_lon BETWEEN @lng_min AND @lng_max)<br>AND (venue_lat BETWEEN @lat_min and @lat_max)<br>AND events.event_date &gt;= CURDATE()<br>AND events.event_time &gt;= CURTIME()<br>ORDER BY distance DESC;"</span><span class="keyword">;<br><br></span><span class="default">$stmt </span><span class="keyword">= </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">_db</span><span class="keyword">-&gt;</span><span class="default">prepare</span><span class="keyword">(</span><span class="default">$sql</span><span class="keyword">);<br></span><span class="default">$stmt</span><span class="keyword">-&gt;</span><span class="default">bindParam</span><span class="keyword">(</span><span class="string">':lat'</span><span class="keyword">, </span><span class="default">$lat</span><span class="keyword">, </span><span class="default">PDO</span><span class="keyword">::</span><span class="default">PARAM_STR</span><span class="keyword">);<br></span><span class="default">$stmt</span><span class="keyword">-&gt;</span><span class="default">bindParam</span><span class="keyword">(</span><span class="string">':lon'</span><span class="keyword">, </span><span class="default">$lon</span><span class="keyword">, </span><span class="default">PDO</span><span class="keyword">::</span><span class="default">PARAM_STR</span><span class="keyword">);<br></span><span class="default">$stmt</span><span class="keyword">-&gt;</span><span class="default">bindParam</span><span class="keyword">(</span><span class="string">':offset'</span><span class="keyword">, </span><span class="default">$offset</span><span class="keyword">, </span><span class="default">PDO</span><span class="keyword">::</span><span class="default">PARAM_INT</span><span class="keyword">); <br></span><span class="default">$stmt</span><span class="keyword">-&gt;</span><span class="default">bindParam</span><span class="keyword">(</span><span class="string">':max'</span><span class="keyword">, </span><span class="default">$max</span><span class="keyword">, </span><span class="default">PDO</span><span class="keyword">::</span><span class="default">PARAM_INT</span><span class="keyword">);<br></span><span class="default">$stmt</span><span class="keyword">-&gt;</span><span class="default">execute</span><span class="keyword">();<br></span><span class="default">?&gt;</span> <br><br>To:<br><span class="default">&lt;?php<br>$sql </span><span class="keyword">= </span><span class="string">"SET @latitude=:lat;<br>SET @longitude=:lon;<br>SET @radius=20;<br>SET @lng_min=@longitude - @radius/abs(cos(radians(@latitude))*69);<br>SET @lng_max=@longitude + @radius/abs(cos(radians(@latitude))*69);<br>SET @lat_min=@latitude - (@radius/69);<br>SET @lat_max=@latitude + (@radius/69);"</span><span class="keyword">; <br><br></span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">_db</span><span class="keyword">-&gt;</span><span class="default">setAttribute</span><span class="keyword">(</span><span class="default">PDO</span><span class="keyword">::</span><span class="default">ATTR_ERRMODE</span><span class="keyword">, </span><span class="default">PDO</span><span class="keyword">::</span><span class="default">ERRMODE_WARNING</span><span class="keyword">);<br></span><span class="default">$stmt </span><span class="keyword">= </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">_db</span><span class="keyword">-&gt;</span><span class="default">prepare</span><span class="keyword">(</span><span class="default">$sql</span><span class="keyword">);<br></span><span class="default">$stmt</span><span class="keyword">-&gt;</span><span class="default">bindParam</span><span class="keyword">(</span><span class="string">':lat'</span><span class="keyword">, </span><span class="default">$lat</span><span class="keyword">, </span><span class="default">PDO</span><span class="keyword">::</span><span class="default">PARAM_STR</span><span class="keyword">);<br></span><span class="default">$stmt</span><span class="keyword">-&gt;</span><span class="default">bindParam</span><span class="keyword">(</span><span class="string">':lon'</span><span class="keyword">, </span><span class="default">$lon</span><span class="keyword">, </span><span class="default">PDO</span><span class="keyword">::</span><span class="default">PARAM_STR</span><span class="keyword">);<br></span><span class="default">$stmt</span><span class="keyword">-&gt;</span><span class="default">execute</span><span class="keyword">();<br><br></span><span class="default">$sql </span><span class="keyword">= </span><span class="string">"SELECT *,<br>(3956 * 2 * ASIN(SQRT(POWER(SIN((@latitude - ABS(venue_lat)) * PI()/180 / 2),2) + COS(@latitude * PI()/180) * COS(ABS(venue_lat) * PI()/180) * POWER(SIN((@longitude - venue_lon) * PI()/180 / 2),2)))) AS distance<br>FROM events LEFT JOIN venues ON venues.venue_id = events.venue_fk<br>WHERE (venue_lon BETWEEN @lng_min AND @lng_max)<br>AND (venue_lat BETWEEN @lat_min and @lat_max)<br>AND events.event_date &gt;= CURDATE()<br>AND events.event_time &gt;= CURTIME()<br>ORDER BY distance DESC<br>LIMIT :offset,:max;"</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <br></span><span class="default">$stmt </span><span class="keyword">= </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">_db</span><span class="keyword">-&gt;</span><span class="default">prepare</span><span class="keyword">(</span><span class="default">$sql</span><span class="keyword">); <br></span><span class="default">$stmt</span><span class="keyword">-&gt;</span><span class="default">bindParam</span><span class="keyword">(</span><span class="string">':offset'</span><span class="keyword">, </span><span class="default">$offset</span><span class="keyword">, </span><span class="default">PDO</span><span class="keyword">::</span><span class="default">PARAM_INT</span><span class="keyword">); <br></span><span class="default">$stmt</span><span class="keyword">-&gt;</span><span class="default">bindParam</span><span class="keyword">(</span><span class="string">':max'</span><span class="keyword">, </span><span class="default">$max</span><span class="keyword">, </span><span class="default">PDO</span><span class="keyword">::</span><span class="default">PARAM_INT</span><span class="keyword">);<br></span><span class="default">$stmt</span><span class="keyword">-&gt;</span><span class="default">execute</span><span class="keyword">();<br></span><span class="default">?&gt;<br></span><br>Hope this helps anyone out there!</span>
</code></div>
  </div>
 </div>
  <div class="note" id="85542">  
  <a class="name">
  <strong class="user"><em>rijnzael at gmail dot com</em></strong></a><div class="date" title="2008-09-04 01:46"><strong>5 years ago</strong></div>
  <div class="text" id="Hcom85542">
<div class="phpcode"><code><span class="html">
If you plan on using prepared statements to issue a series of KILLs, think again.&nbsp; PDO apparently does not support this, and will tell you, assuming you don't put any parameters in the statement (a situation in which it would be pointless to use prepared statements anyway).&nbsp; If you do specify some ?-mark parameters, it will just spit out an error that doesn't help at all.</span>
</code></div>
  </div>
 </div>
  <div class="note" id="84056">  
  <a class="name">
  <strong class="user"><em>cmcculloh</em></strong></a><div class="date" title="2008-06-25 12:14"><strong>6 years ago</strong></div>
  <div class="text" id="Hcom84056">
<div class="phpcode"><code><span class="html">
It appears that PDO SQL statements can not make use of /* */ comments. Or at least, when I was trying to use them with mine it was crashing without error and giving me a blank page (even though I surrounded with try catch block).</span>
</code></div>
  </div>
 </div>
  <div class="note" id="80127">  
  <a class="name">
  <strong class="user"><em>ob.php from daevel.fr</em></strong></a><div class="date" title="2007-12-30 12:57"><strong>6 years ago</strong></div>
  <div class="text" id="Hcom80127">
<div class="phpcode"><code><span class="html">
Be careful with PDO extends : if you use the smileaf's example, PDO will close the connection only at the end of the script, because of the "array( $this )" parameter used with the setAttribute() method.<br><br>Instead, I use only this :<br>&nbsp; &nbsp; $this-&gt;setAttribute( PDO::ATTR_STATEMENT_CLASS, array( $this-&gt;statementClassName, array() ) );<br><br>And in prepare() and query() method you can populate the "dbh" if you really need it.</span>
</code></div>
  </div>
 </div>
  <div class="note" id="79722">  
  <a class="name">
  <strong class="user"><em>neonmandk at gmail dot com</em></strong></a><div class="date" title="2007-12-10 04:29"><strong>6 years ago</strong></div>
  <div class="text" id="Hcom79722">
<div class="phpcode"><code><span class="html">
If you will make a OBJ row from PDO you can use this eg.<br><br>$resKampange = $dbc-&gt;prepare( "SELECT * FROM Table LIMIT 1" );<br>$resKampange-&gt;execute();<br>$rowKampange = $resKampange-&gt;fetch( PDO::FETCH_OB );<br><br>echo $rowKampange-&gt;felt1;<br><br>Good lock :0)</span>
</code></div>
  </div>
 </div>
  <div class="note" id="79558">  
  <a class="name">
  <strong class="user"><em>Ostap</em></strong></a><div class="date" title="2007-12-03 02:08"><strong>6 years ago</strong></div>
  <div class="text" id="Hcom79558">
<div class="phpcode"><code><span class="html">
There is a book titled "Learning PHP Data Objects" written by Dennis Popel and published by Packt. There is a post with further links (ordering, reviews) at author's blog: <a rel="nofollow" target="_blank">http://www.onphp5.com/article/58</a></span>
</code></div>
  </div>
 </div>
  <div class="note" id="79157">  
  <a class="name">
  <strong class="user"><em>nospam dot list at unclassified dot de</em></strong></a><div class="date" title="2007-11-13 04:24"><strong>6 years ago</strong></div>
  <div class="text" id="Hcom79157">
<div class="phpcode"><code><span class="html">
When using persistent connections, pay attention not to leave the database connection in some kind of locked state. This can happen when you start a transaction by hand (i.e. not through the PDO-&gt;beginTransaction() method), possibly even acquire some locks (e.g. with "SELECT ... FOR UPDATE", "LOCK TABLES ..." or in SQLite with "BEGIN EXCLUSIVE TRANSACTION") and then your PHP script ends with a fatal error, unhandled exception or under other circumstances that lead to an unclean exit.<br><br>To use that database again, it may then be necessary to disable the persistence attribute to get a new database connection or restart the web server. (Persistent connections should not work with a PHP-CGI anyway.) It does not work (tested with PHP 5.2.3/WinXP and SQLite) to close a persistent database connection - it will not actually be closed but instead returned to PDO's connection pool.<br><br>The only thing you can do to resolve the lock as a regular user (I imagine) is to try and get all of your persistent connections in a single script and unlock the tables resp. end the transactions with the appropriate SQL statements ("UNLOCK TABLES" in MySQL, "ROLLBACK" for transactions). Should they fail, there is no problem, but one or some of them might succeed and thereby resolve your locking problem.</span>
</code></div>
  </div>
 </div>
  <div class="note" id="78962">  
  <a class="name">
  <strong class="user"><em>xorinox at vtxmail dot ch</em></strong></a><div class="date" title="2007-11-04 03:52"><strong>6 years ago</strong></div>
  <div class="text" id="Hcom78962">
<div class="phpcode"><code><span class="html">
I have seen a lot of user struggling with calling mysql procedures with in/out/inout parameters using bindParam. There seems to be a bug or missing feature within the mysql C api. This at least I could find out after reading a lot of posts at different places...<br><br>At the moment I workaround it like below. $con is a PDO object:<br><br><span class="default">&lt;?php<br></span><span class="comment">//in<br></span><span class="default">$proc </span><span class="keyword">= </span><span class="default">$con</span><span class="keyword">-&gt;</span><span class="default">prepare</span><span class="keyword">( </span><span class="string">"call proc_in( @i_param )" </span><span class="keyword">);<br></span><span class="default">$con</span><span class="keyword">-&gt;</span><span class="default">query</span><span class="keyword">( </span><span class="string">"set @i_param = 'myValue'" </span><span class="keyword">);<br></span><span class="default">$proc</span><span class="keyword">-&gt;</span><span class="default">execute</span><span class="keyword">();<br><br></span><span class="comment">//out<br></span><span class="default">$proc </span><span class="keyword">= </span><span class="default">$con</span><span class="keyword">-&gt;</span><span class="default">prepare</span><span class="keyword">( </span><span class="string">"call proc_out( @o_param )" </span><span class="keyword">);<br></span><span class="default">$proc</span><span class="keyword">-&gt;</span><span class="default">execute</span><span class="keyword">();<br></span><span class="default">$o_param </span><span class="keyword">= </span><span class="default">$con</span><span class="keyword">-&gt;</span><span class="default">query</span><span class="keyword">( </span><span class="string">"select @o_param" </span><span class="keyword">)-&gt;</span><span class="default">fetchColumn</span><span class="keyword">();<br><br></span><span class="comment">//inout<br></span><span class="default">$proc </span><span class="keyword">= </span><span class="default">$con</span><span class="keyword">-&gt;</span><span class="default">prepare</span><span class="keyword">( </span><span class="string">"call proc_inout( @io_param )" </span><span class="keyword">);<br></span><span class="default">$con</span><span class="keyword">-&gt;</span><span class="default">query</span><span class="keyword">( </span><span class="string">"set @io_param = 'myValue'" </span><span class="keyword">);<br></span><span class="default">$proc</span><span class="keyword">-&gt;</span><span class="default">execute</span><span class="keyword">();<br></span><span class="default">$io_param </span><span class="keyword">= </span><span class="default">$con</span><span class="keyword">-&gt;</span><span class="default">query</span><span class="keyword">( </span><span class="string">"select @io_param" </span><span class="keyword">)-&gt;</span><span class="default">fetchColumn</span><span class="keyword">();<br></span><span class="default">?&gt;</span>
</span>
</code></div>
  </div>
 </div>
  <div class="note" id="78532">  
  <a class="name">
  <strong class="user"><em>Konstantin at Tokar dot ru</em></strong></a><div class="date" title="2007-10-16 08:34"><strong>6 years ago</strong></div>
  <div class="text" id="Hcom78532">
<div class="phpcode"><code><span class="html">
Example 5: <br><span class="default">&lt;?php<br></span><span class="keyword">try {<br>&nbsp; </span><span class="default">$dbh </span><span class="keyword">= new </span><span class="default">PDO</span><span class="keyword">(</span><span class="string">'odbc:SAMPLE'</span><span class="keyword">, </span><span class="string">'db2inst1'</span><span class="keyword">, </span><span class="string">'ibmdb2'</span><span class="keyword">,<br>&nbsp; &nbsp; &nbsp; array(</span><span class="default">PDO</span><span class="keyword">::</span><span class="default">ATTR_PERSISTENT </span><span class="keyword">=&gt; </span><span class="default">true</span><span class="keyword">));<br>....... <br>} catch (</span><span class="default">Exception $e</span><span class="keyword">) {<br>&nbsp; </span><span class="default">$dbh</span><span class="keyword">-&gt;</span><span class="default">rollBack</span><span class="keyword">();<br>&nbsp; echo </span><span class="string">"Failed: " </span><span class="keyword">. </span><span class="default">$e</span><span class="keyword">-&gt;</span><span class="default">getMessage</span><span class="keyword">();<br>}<br></span><span class="default">?&gt;</span> <br><br>We must change the last two lines to catch the error connecting to the database:<br><br>} catch (Exception $e) {<br>&nbsp; echo "Failed: " . $e-&gt;getMessage();<br>&nbsp; $dbh-&gt;rollBack();<br>}<br>?&gt;</span>
</code></div>
  </div>
 </div>
  <div class="note" id="77532">  
  <a class="name">
  <strong class="user"><em>anton dot clarke at sonikmedia dot com</em></strong></a><div class="date" title="2007-09-02 12:12"><strong>6 years ago</strong></div>
  <div class="text" id="Hcom77532">
<div class="phpcode"><code><span class="html">
Not all PDO drivers return a LOB as a file stream; mysql 5 is one example. Therefore when streaming a mime typed object from the database you cannot use fpassthru.<br><br>The following is a modified example that works with a mysql database. (Tested FreeBSD v 6.2 with mysql 5.0.45 and php 5.2.3) <br><br><span class="default">&lt;?php<br>ob_start</span><span class="keyword">();<br></span><span class="default">$db </span><span class="keyword">= new </span><span class="default">PDO</span><span class="keyword">(</span><span class="string">'mysql:host=localhost;dbname=&lt;SOMEDB&gt;'</span><span class="keyword">, </span><span class="string">'&lt;USERNAME&gt;'</span><span class="keyword">, </span><span class="string">'PASSWORD'</span><span class="keyword">);<br></span><span class="default">$stmt </span><span class="keyword">= </span><span class="default">$db</span><span class="keyword">-&gt;</span><span class="default">prepare</span><span class="keyword">(</span><span class="string">"select contenttype, imagedata from images where id=?"</span><span class="keyword">);<br></span><span class="default">$stmt</span><span class="keyword">-&gt;</span><span class="default">execute</span><span class="keyword">(array(</span><span class="default">$_GET</span><span class="keyword">[</span><span class="string">'id'</span><span class="keyword">]));<br></span><span class="default">$stmt</span><span class="keyword">-&gt;</span><span class="default">bindColumn</span><span class="keyword">(</span><span class="default">1</span><span class="keyword">, </span><span class="default">$type</span><span class="keyword">, </span><span class="default">PDO</span><span class="keyword">::</span><span class="default">PARAM_STR</span><span class="keyword">, </span><span class="default">256</span><span class="keyword">);<br></span><span class="default">$stmt</span><span class="keyword">-&gt;</span><span class="default">bindColumn</span><span class="keyword">(</span><span class="default">2</span><span class="keyword">, </span><span class="default">$lob</span><span class="keyword">, </span><span class="default">PDO</span><span class="keyword">::</span><span class="default">PARAM_LOB</span><span class="keyword">);<br></span><span class="default">$stmt</span><span class="keyword">-&gt;</span><span class="default">fetch</span><span class="keyword">(</span><span class="default">PDO</span><span class="keyword">::</span><span class="default">FETCH_BOUND</span><span class="keyword">);<br></span><span class="default">ob_clean</span><span class="keyword">();<br></span><span class="default">header</span><span class="keyword">(</span><span class="string">"Content-Type: </span><span class="default">$type</span><span class="string">"</span><span class="keyword">);<br>echo </span><span class="default">$lob</span><span class="keyword">; </span><span class="comment">// fpassthru reports an error that $lob is not a stream so echo is used in place.<br></span><span class="default">ob_end_flush</span><span class="keyword">();<br></span><span class="default">?&gt;<br></span><br>Please note the inclusion of buffer control. I only needed this when using 'include','include_once','require', or 'require_once' - my feeling is there is a subtle issue with those options as even an empty include file caused a buffer issue for me. === AND YES, I DID CHECK MY INCLUDE FILES DID NOT HAVE SPURIOUS WHITESPACE ETC OUTSIDE THE <span class="default">&lt;?php ?&gt;</span> DELIMITERS! ===</span>
</code></div>
  </div>
 </div>
  <div class="note" id="75362">  
  <a class="name">
  <strong class="user"><em>metalim</em></strong></a><div class="date" title="2007-05-25 05:38"><strong>7 years ago</strong></div>
  <div class="text" id="Hcom75362">
<div class="phpcode"><code><span class="html">
From Oracle example:<br>&lt;?<br>$stmt-&gt;beginTransaction();<br>$stmt-&gt;execute();<br>$stmt-&gt;commit();<br>?&gt;<br><br>PDOStatement has no beginTransaction(), nor commit(). Please fix documentation.</span>
</code></div>
  </div>
 </div>
  <div class="note" id="75310">  
  <a class="name">
  <strong class="user"><em>bart at mediawave dot nl</em></strong></a><div class="date" title="2007-05-23 07:57"><strong>7 years ago</strong></div>
  <div class="text" id="Hcom75310">
<div class="phpcode"><code><span class="html">
It seems MySQL doesn't support scrollable cursors. So unfortunately PDO::CURSOR_SCROLL wont work.</span>
</code></div>
  </div>
 </div>
  <div class="note" id="73568">  
  <a class="name">
  <strong class="user"><em>smileaf at smileaf dot org</em></strong></a><div class="date" title="2007-03-01 10:57"><strong>7 years ago</strong></div>
  <div class="text" id="Hcom73568">
<div class="phpcode"><code><span class="html">
If you intend on extending PDOStatement and your using <br>setAttribute(PDO::ATTR_STATEMENT_CLASS, ...)<br>you must override the __construct() of your PDOStatement class.<br>failure to do so will result in an error on any PDO::query() call.<br>Warning: PDO::query() [function.PDO-query]: SQLSTATE[HY000]: General error: user-supplied statement does not accept constructor arguments<br><br>Here is a minimum PDO and PDOStatement class<br><span class="default">&lt;?php<br></span><span class="keyword">class </span><span class="default">Database </span><span class="keyword">extends </span><span class="default">PDO </span><span class="keyword">{<br>&nbsp; &nbsp; function </span><span class="default">__construct</span><span class="keyword">(</span><span class="default">$dsn</span><span class="keyword">, </span><span class="default">$username</span><span class="keyword">=</span><span class="string">""</span><span class="keyword">, </span><span class="default">$password</span><span class="keyword">=</span><span class="string">""</span><span class="keyword">, </span><span class="default">$driver_options</span><span class="keyword">=array()) {<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">parent</span><span class="keyword">::</span><span class="default">__construct</span><span class="keyword">(</span><span class="default">$dsn</span><span class="keyword">,</span><span class="default">$username</span><span class="keyword">,</span><span class="default">$password</span><span class="keyword">, </span><span class="default">$driver_options</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">setAttribute</span><span class="keyword">(</span><span class="default">PDO</span><span class="keyword">::</span><span class="default">ATTR_STATEMENT_CLASS</span><span class="keyword">, array(</span><span class="string">'DBStatement'</span><span class="keyword">, array(</span><span class="default">$this</span><span class="keyword">)));<br>&nbsp; &nbsp; }<br>}<br>class </span><span class="default">DBStatement </span><span class="keyword">extends </span><span class="default">PDOStatement </span><span class="keyword">{<br>&nbsp; &nbsp; public </span><span class="default">$dbh</span><span class="keyword">;<br>&nbsp; &nbsp; protected function </span><span class="default">__construct</span><span class="keyword">(</span><span class="default">$dbh</span><span class="keyword">) {<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">dbh </span><span class="keyword">= </span><span class="default">$dbh</span><span class="keyword">;<br>&nbsp; &nbsp; }<br>}<br></span><span class="default">?&gt;</span>
</span>
</code></div>
  </div>
 </div>
  <div class="note" id="73318">  
  <a class="name">
  <strong class="user"><em>php at moechofe dot com</em></strong></a><div class="date" title="2007-02-17 11:52"><strong>7 years ago</strong></div>
  <div class="text" id="Hcom73318">
<div class="phpcode"><code><span class="html">
Simple example to extends PDO<br><br><span class="default">&lt;?php<br><br></span><span class="keyword">class </span><span class="default">connexion </span><span class="keyword">extends </span><span class="default">PDO<br></span><span class="keyword">{<br>&nbsp; public </span><span class="default">$query </span><span class="keyword">= </span><span class="default">null</span><span class="keyword">;<br>&nbsp; public function </span><span class="default">prepare</span><span class="keyword">( </span><span class="default">$statement</span><span class="keyword">, </span><span class="default">$driver_options </span><span class="keyword">= array() )<br>&nbsp; {<br>&nbsp; &nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">query </span><span class="keyword">= </span><span class="default">$statement</span><span class="keyword">;<br>&nbsp; &nbsp; return </span><span class="default">parent</span><span class="keyword">::</span><span class="default">prepare</span><span class="keyword">( </span><span class="default">$statement</span><span class="keyword">, </span><span class="default">$driver_options </span><span class="keyword">= array() );<br>&nbsp; }<br>&nbsp; public function </span><span class="default">last_query</span><span class="keyword">()<br>&nbsp; {<br>&nbsp; &nbsp; return </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">query</span><span class="keyword">;<br>&nbsp; }<br>}<br><br>class </span><span class="default">connexion_statement </span><span class="keyword">extends </span><span class="default">PDOStatement<br></span><span class="keyword">{<br>&nbsp; protected </span><span class="default">$pdo</span><span class="keyword">;<br>&nbsp; protected function </span><span class="default">__construct</span><span class="keyword">(</span><span class="default">$pdo</span><span class="keyword">)<br>&nbsp; {<br>&nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">pdo </span><span class="keyword">= </span><span class="default">$pdo</span><span class="keyword">;<br>&nbsp; }<br>&nbsp; </span><span class="comment">// return first column of first row<br>&nbsp; </span><span class="keyword">public function </span><span class="default">fetchFirst</span><span class="keyword">()<br>&nbsp; {<br>&nbsp; &nbsp; </span><span class="default">$row </span><span class="keyword">= </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">fetch</span><span class="keyword">( </span><span class="default">PDO</span><span class="keyword">::</span><span class="default">FETCH_NUM </span><span class="keyword">);<br>&nbsp; &nbsp; return </span><span class="default">$row</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">];<br>&nbsp; }<br>&nbsp; </span><span class="comment">// real cast number<br>&nbsp; </span><span class="keyword">public function </span><span class="default">fetch</span><span class="keyword">( </span><span class="default">$fetch_style </span><span class="keyword">= </span><span class="default">null</span><span class="keyword">, </span><span class="default">$cursor_orientation </span><span class="keyword">= </span><span class="default">null</span><span class="keyword">, </span><span class="default">$cursor_offset </span><span class="keyword">= </span><span class="default">null </span><span class="keyword">)<br>&nbsp; {<br>&nbsp; &nbsp; </span><span class="default">$row </span><span class="keyword">= </span><span class="default">parent</span><span class="keyword">::</span><span class="default">fetch</span><span class="keyword">( </span><span class="default">$fetch_style</span><span class="keyword">, </span><span class="default">$cursor_orientation</span><span class="keyword">, </span><span class="default">$cursor_offset </span><span class="keyword">);<br>&nbsp; &nbsp; if( </span><span class="default">is_array</span><span class="keyword">(</span><span class="default">$row</span><span class="keyword">) )<br>&nbsp; &nbsp; &nbsp; foreach( </span><span class="default">$row </span><span class="keyword">as </span><span class="default">$key </span><span class="keyword">=&gt; </span><span class="default">$value </span><span class="keyword">)<br>&nbsp; &nbsp; &nbsp; &nbsp; if( </span><span class="default">strval</span><span class="keyword">(</span><span class="default">intval</span><span class="keyword">(</span><span class="default">$value</span><span class="keyword">)) === </span><span class="default">$value </span><span class="keyword">)<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$row</span><span class="keyword">[</span><span class="default">$key</span><span class="keyword">] = </span><span class="default">intval</span><span class="keyword">(</span><span class="default">$value</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; elseif( </span><span class="default">strval</span><span class="keyword">(</span><span class="default">floatval</span><span class="keyword">(</span><span class="default">$value</span><span class="keyword">)) === </span><span class="default">$value </span><span class="keyword">)<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$row</span><span class="keyword">[</span><span class="default">$key</span><span class="keyword">] = </span><span class="default">floatval</span><span class="keyword">(</span><span class="default">$value</span><span class="keyword">);<br>&nbsp; &nbsp; return </span><span class="default">$row</span><span class="keyword">;<br>&nbsp; }<br>&nbsp; </span><span class="comment">// permit $prepare-&gt;execute( $arg1, $arg2, ... );<br>&nbsp; </span><span class="keyword">public function </span><span class="default">execute</span><span class="keyword">( </span><span class="default">$args </span><span class="keyword">= </span><span class="default">null </span><span class="keyword">)<br>&nbsp; {<br>&nbsp; &nbsp; if( </span><span class="default">is_array</span><span class="keyword">( </span><span class="default">$args </span><span class="keyword">) )<br>&nbsp; &nbsp; &nbsp; return </span><span class="default">parent</span><span class="keyword">::</span><span class="default">execute</span><span class="keyword">( </span><span class="default">$args </span><span class="keyword">);<br>&nbsp; &nbsp; else<br>&nbsp; &nbsp; {<br>&nbsp; &nbsp; &nbsp; </span><span class="default">$args </span><span class="keyword">= </span><span class="default">func_get_args</span><span class="keyword">();<br>&nbsp; &nbsp; &nbsp; return eval( </span><span class="string">'return parent::execute( $args );' </span><span class="keyword">);<br>&nbsp; &nbsp; }<br>&nbsp; }<br>&nbsp; public function </span><span class="default">last_query</span><span class="keyword">()<br>&nbsp; {<br>&nbsp; &nbsp; return </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">pdo</span><span class="keyword">-&gt;</span><span class="default">last_query</span><span class="keyword">();<br>&nbsp; }<br>}<br><br></span><span class="default">$pdo </span><span class="keyword">= new </span><span class="default">connexion</span><span class="keyword">( ... );<br></span><span class="default">$pdo</span><span class="keyword">-&gt;</span><span class="default">setAttribute</span><span class="keyword">( </span><span class="default">PDO</span><span class="keyword">::</span><span class="default">ATTR_STATEMENT_CLASS</span><span class="keyword">, array( </span><span class="string">'connexion_statement'</span><span class="keyword">, array(</span><span class="default">$pdo</span><span class="keyword">) ) );<br><br></span><span class="default">?&gt;</span>
</span>
</code></div>
  </div>
 </div>
  <div class="note" id="68398">  
  <a class="name">
  <strong class="user"><em>paulius_k at yahoo dot com</em></strong></a><div class="date" title="2006-07-25 08:42"><strong>8 years ago</strong></div>
  <div class="text" id="Hcom68398">
<div class="phpcode"><code><span class="html">
If you need to get Output variable from MSSQL stored procedure, try this :<br><br>-- PROCEDURE<br>CREATE PROCEDURE spReturn_Int @err int OUTPUT <br>AS<br>SET @err = 11<br>GO<br><br>$sth = $dbh-&gt;prepare("EXECUTE spReturn_Int ?");<br>$sth-&gt;bindParam(1, $return_value, PDO::PARAM_INT|PDO::PARAM_INPUT_OUTPUT);<br>$sth-&gt;execute();<br>print "procedure returned $return_value\n";</span>
</code></div>
  </div>
 </div>
  <div class="note" id="66413">  
  <a class="name">
  <strong class="user"><em>nicolas at serpe dot org</em></strong></a><div class="date" title="2006-05-21 12:36"><strong>8 years ago</strong></div>
  <div class="text" id="Hcom66413">
<div class="phpcode"><code><span class="html">
I use PDO with the ODBC driver to query stored procedures in a MS SQL Server 2005 Database under Windows XP Professional with IIS 5 and PHP 5.1.4. You may have the same problems with a different configuration.<br><br>I experienced 2 very time consuming errors:<br><br>1. The first one is when you return the result of a SELECT query, and you get the following clueless message:<br>&gt;&gt;&gt; Fatal error: Uncaught exception 'PDOException' with message 'SQLSTATE[24000]: Invalid cursor state: 0 [Microsoft][SQL Native Client]Invalid cursor state (SQLFetchScroll[0] at ext\pdo_odbc\odbc_stmt.c:372)' in (YOUR_TRACE_HERE) &lt;&lt;&lt;<br>Your exact message may be different, the part to pay attention to is "Invalid cursor state".<br><br>-&gt; I found that I had this error because I didn't include "SET NOCOUNT ON" in the *body* of the stored procedure. By default the server returns a special piece of information along with the results, indicating how many rows were affected by the stored procedure, and that's not handled by PDO.<br><br>2. The second error I had was:<br>&gt;&gt;&gt; Fatal error: Uncaught exception 'PDOException' with message 'SQLSTATE[22003]: Numeric value out of range: 0 [Microsoft][SQL Native Client]Numeric value out of range (SQLFetchScroll[0] at ext\pdo_odbc\odbc_stmt.c:372)' in (YOUR_TRACE_HERE) &lt;&lt;&lt;<br>Another meaningless error "Numeric value out of range"... <br><br>-&gt; I was actually returning a date datatype (datetime or smalldatetime) "as is", that is, without converting it to varchar before including it in the result set... I don't know if PDO is responsible for converting it to a PHP datatype, but it doesn't. Convert it before it reaches PHP.</span>
</code></div>
  </div>
 </div>
  <div class="note" id="62087">  
  <a class="name">
  <strong class="user"><em>www.navin.biz</em></strong></a><div class="date" title="2006-02-19 10:16"><strong>8 years ago</strong></div>
  <div class="text" id="Hcom62087">
<div class="phpcode"><code><span class="html">
Below is an example of extending PDO &amp; PDOStatement classes:<br><br><span class="default">&lt;?php<br><br></span><span class="keyword">class </span><span class="default">Database </span><span class="keyword">extends </span><span class="default">PDO<br></span><span class="keyword">{<br>&nbsp; &nbsp; function </span><span class="default">__construct</span><span class="keyword">()<br>&nbsp; &nbsp; {<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">parent</span><span class="keyword">::</span><span class="default">__construct</span><span class="keyword">(</span><span class="string">'mysql:dbname=test;host=localhost'</span><span class="keyword">, </span><span class="string">'root'</span><span class="keyword">, </span><span class="string">''</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">setAttribute</span><span class="keyword">(</span><span class="default">PDO</span><span class="keyword">::</span><span class="default">ATTR_STATEMENT_CLASS</span><span class="keyword">, array(</span><span class="string">'DBStatement'</span><span class="keyword">, array(</span><span class="default">$this</span><span class="keyword">)));<br>&nbsp; &nbsp; }<br>}<br><br>class </span><span class="default">DBStatement </span><span class="keyword">extends </span><span class="default">PDOStatement<br></span><span class="keyword">{<br>&nbsp; &nbsp; public </span><span class="default">$dbh</span><span class="keyword">;<br><br>&nbsp; &nbsp; protected function </span><span class="default">__construct</span><span class="keyword">(</span><span class="default">$dbh</span><span class="keyword">)<br>&nbsp; &nbsp; {<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">dbh </span><span class="keyword">= </span><span class="default">$dbh</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">setFetchMode</span><span class="keyword">(</span><span class="default">PDO</span><span class="keyword">::</span><span class="default">FETCH_OBJ</span><span class="keyword">);<br>&nbsp; &nbsp; }<br>&nbsp; &nbsp; <br>&nbsp; &nbsp; public function </span><span class="default">foundRows</span><span class="keyword">()<br>&nbsp; &nbsp; {<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$rows </span><span class="keyword">= </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">dbh</span><span class="keyword">-&gt;</span><span class="default">prepare</span><span class="keyword">(</span><span class="string">'SELECT found_rows() AS rows'</span><span class="keyword">, array(</span><span class="default">PDO</span><span class="keyword">::</span><span class="default">MYSQL_ATTR_USE_BUFFERED_QUERY </span><span class="keyword">=&gt; </span><span class="default">TRUE</span><span class="keyword">));<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$rows</span><span class="keyword">-&gt;</span><span class="default">execute</span><span class="keyword">();<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$rowsCount </span><span class="keyword">= </span><span class="default">$rows</span><span class="keyword">-&gt;</span><span class="default">fetch</span><span class="keyword">(</span><span class="default">PDO</span><span class="keyword">::</span><span class="default">FETCH_OBJ</span><span class="keyword">)-&gt;</span><span class="default">rows</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$rows</span><span class="keyword">-&gt;</span><span class="default">closeCursor</span><span class="keyword">();<br>&nbsp; &nbsp; &nbsp; &nbsp; return </span><span class="default">$rowsCount</span><span class="keyword">;<br>&nbsp; &nbsp; }<br>}<br><br></span><span class="default">?&gt;</span>
</span>
</code></div>
  </div>
 </div>
  <div class="note" id="61622">  
  <a class="name">
  <strong class="user"><em>shaolin at adf dot nu</em></strong></a><div class="date" title="2006-02-07 06:18"><strong>8 years ago</strong></div>
  <div class="text" id="Hcom61622">
<div class="phpcode"><code><span class="html">
If your having problems re-compiling PHP with PDO as shared module try this.<br><br>--enable-pdo=shared<br>--with-pdo-mysql=shared,/usr/local/mysql<br>--with-sqlite=shared<br>--with-pdo-sqlite=shared<br><br>1. If PDO is built as a shared modules, all PDO drivers must also be<br>built as shared modules.<br>2. If ext/pdo_sqlite is built as a shared module, ext/sqlite must also<br>be built as a shared module.<br>3. In the extensions entries, if ext/pdo_sqlite is built as a shared<br>module, php.ini must specify pdo_sqlite first, followed by sqlite.</span>
</code></div>
  </div>
 </div>
  <div class="note" id="101681">  
  <a class="name">
  <strong class="user"><em>lkmorlan at uwaterloo dot ca</em></strong></a><div class="date" title="2011-01-04 07:25"><strong>3 years ago</strong></div>
  <div class="text" id="Hcom101681">
<div class="phpcode"><code><span class="html">
You may also have to edit /etc/freetds.conf. Make sure the TDS version is recent, e.g., "tds version = 8.0".</span>
</code></div>
  </div>
 </div>
  <div class="note" id="50999">  
  <a class="name">
  <strong class="user"><em>ng4rrjanbiah at rediffmail dot com</em></strong></a><div class="date" title="2005-03-15 10:53"><strong>9 years ago</strong></div>
  <div class="text" id="Hcom50999">
<div class="phpcode"><code><span class="html">
Some useful links on PDO:
<br>1. PDO Wiki ( <a rel="nofollow" target="_blank">http://wiki.cc/php/PDO</a> )
<br>2. Introducing PHP Data Objects ( <a rel="nofollow" target="_blank">http://netevil.org/downloads/Introducing-PDO.ppt</a> ), [226 KB], Wez Furlong, 2004-09-24
<br>3. The PHP 5 Data Object (PDO) Abstraction Layer and Oracle ( <a rel="nofollow" target="_blank">http://www.oracle.com/technology/pub/articles/php_experts/otn_pdo_oracle5.html</a> ), [60.85 KB], Wez Furlong, 2004-07-28
<br>4. PDO - Why it should not be part of core PHP! ( <a rel="nofollow" target="_blank">http://www.akbkhome.com/blog.php/View/55/</a> ), Critical review, [38.63 KB], Alan Knowles, 2004-10-22
<br>
<br>HTH,
<br>R. Rajesh Jeba Anbiah</span>
</code></div>
  </div>
 </div></div>

 
</section>    </section><!-- layout-content -->
        


  </div><!-- layout -->
         
  

    
 <!-- External and third party libraries. -->
 







<a id="toTop" href="javascript:;"><span id="toTopHover"></span><img width="40" height="40" alt="To Top" src="../../images/to-top%402x.png"></a>



<!-- Mirrored from php.net/manual/en/book.pdo.php by HTTrack Website Copier/3.x [XR&CO'2013], Thu, 28 Aug 2014 15:45:25 GMT -->


</body></html>