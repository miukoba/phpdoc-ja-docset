<html><!-- Mirrored from php.net/manual/en/ref.xml.php by HTTrack Website Copier/3.x [XR&CO'2013], Thu, 28 Aug 2014 15:52:54 GMT --><!-- Added by HTTrack --><head><meta http-equiv="content-type" content="text/html;charset=utf-8"><!-- /Added by HTTrack -->


  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0"> 

  <title>XML Parser Functions</title>

 <link rel="shortcut icon" href="../../favicon.ico">
 <link rel="search" type="application/opensearchdescription+xml" href="http://php.net/phpnetimprovedsearch.src" title="Add PHP.net search">
 <link rel="alternate" type="application/atom+xml" href="http://php.net/releases/feed.php" title="PHP Release feed">
 <link rel="alternate" type="application/atom+xml" href="http://php.net/feed.atom" title="PHP: Hypertext Preprocessor">

 <link rel="canonical" href="ref.xml.html">
 <link rel="shorturl" href="http://php.net/xml">
 <link rel="alternate" href="http://php.net/xml" hreflang="x-default">

 <link rel="contents" href="index-2.html">
 <link rel="index" href="book.xml.html">
 <link rel="prev" href="example.xml-external-entity.html">
 <link rel="next" href="function.utf8-decode.html">

 <link rel="alternate" href="ref.xml.html" hreflang="en">
 <link rel="alternate" href="http://php.net/manual/pt_BR/ref.xml.php" hreflang="pt_BR">
 <link rel="alternate" href="http://php.net/manual/zh/ref.xml.php" hreflang="zh">
 <link rel="alternate" href="http://php.net/manual/fr/ref.xml.php" hreflang="fr">
 <link rel="alternate" href="http://php.net/manual/de/ref.xml.php" hreflang="de">
 <link rel="alternate" href="http://php.net/manual/it/ref.xml.php" hreflang="it">
 <link rel="alternate" href="http://php.net/manual/ja/ref.xml.php" hreflang="ja">
 <link rel="alternate" href="http://php.net/manual/ro/ref.xml.php" hreflang="ro">
 <link rel="alternate" href="http://php.net/manual/ru/ref.xml.php" hreflang="ru">
 <link rel="alternate" href="http://php.net/manual/es/ref.xml.php" hreflang="es">
 <link rel="alternate" href="http://php.net/manual/tr/ref.xml.php" hreflang="tr">

<link rel="stylesheet" type="text/css" href="../../cached8fe1.css?t=1401250819&amp;f=/fonts/Fira/fira.css" media="screen">
<link rel="stylesheet" type="text/css" href="../../cached4b8d.css?t=1404368420&amp;f=/fonts/Font-Awesome/css/fontello.css" media="screen">
<link rel="stylesheet" type="text/css" href="../../cached5065.css?t=1403329232&amp;f=/styles/theme-base.css" media="screen">
<link rel="stylesheet" type="text/css" href="../../cachedc78d.css?t=1401249623&amp;f=/styles/theme-medium.css" media="screen">

 <!--[if lte IE 7]>
 <link rel="stylesheet" type="text/css" href="http://php.net/styles/workarounds.ie7.css" media="screen">
 <![endif]-->

 <!--[if lte IE 8]>
 <script type="text/javascript">
  window.brokenIE = true;
 </script>
 <![endif]-->

 <!--[if lte IE 9]>
 <link rel="stylesheet" type="text/css" href="http://php.net/styles/workarounds.ie9.css" media="screen">
 <![endif]-->

 <!--[if IE]>
 <script type="text/javascript" src="http://php.net/js/ext/html5.js"></script>
 <![endif]-->

 <base>

</head>
<body class="docs " style="">


<div class="headsup"><a href="http://php.net/index.php#id2014-08-28-1">PHP 5.6.0 released</a></div>
<nav id="trick"><div><dl>
<dt><a href="getting-started.html">Getting Started</a></dt>
	<dd><a href="introduction.html">Introduction</a></dd>
	<dd><a href="tutorial.html">A simple tutorial</a></dd>
<dt><a href="langref.html">Language Reference</a></dt>
	<dd><a href="language.basic-syntax.html">Basic syntax</a></dd>
	<dd><a href="language.types.html">Types</a></dd>
	<dd><a href="language.variables.html">Variables</a></dd>
	<dd><a href="language.constants.html">Constants</a></dd>
	<dd><a href="language.expressions.html">Expressions</a></dd>
	<dd><a href="language.operators.html">Operators</a></dd>
	<dd><a href="language.control-structures.html">Control Structures</a></dd>
	<dd><a href="language.functions.html">Functions</a></dd>
	<dd><a href="language.oop5.html">Classes and Objects</a></dd>
	<dd><a href="language.namespaces.html">Namespaces</a></dd>
	<dd><a href="language.exceptions.html">Exceptions</a></dd>
	<dd><a href="language.generators.html">Generators</a></dd>
	<dd><a href="language.references.html">References Explained</a></dd>
	<dd><a href="reserved.variables.html">Predefined Variables</a></dd>
	<dd><a href="reserved.exceptions.html">Predefined Exceptions</a></dd>
	<dd><a href="reserved.interfaces.html">Predefined Interfaces and Classes</a></dd>
	<dd><a href="context.html">Context options and parameters</a></dd>
	<dd><a href="wrappers.html">Supported Protocols and Wrappers</a></dd>
</dl>
<dl>
<dt><a href="security.html">Security</a></dt>
	<dd><a href="security.intro.html">Introduction</a></dd>
	<dd><a href="security.general.html">General considerations</a></dd>
	<dd><a href="security.cgi-bin.html">Installed as CGI binary</a></dd>
	<dd><a href="security.apache.html">Installed as an Apache module</a></dd>
	<dd><a href="security.filesystem.html">Filesystem Security</a></dd>
	<dd><a href="security.database.html">Database Security</a></dd>
	<dd><a href="security.errors.html">Error Reporting</a></dd>
	<dd><a href="security.globals.html">Using Register Globals</a></dd>
	<dd><a href="security.variables.html">User Submitted Data</a></dd>
	<dd><a href="security.magicquotes.html">Magic Quotes</a></dd>
	<dd><a href="security.hiding.html">Hiding PHP</a></dd>
	<dd><a href="security.current.html">Keeping Current</a></dd>
<dt><a href="features.html">Features</a></dt>
	<dd><a href="features.http-auth.html">HTTP authentication with PHP</a></dd>
	<dd><a href="features.cookies.html">Cookies</a></dd>
	<dd><a href="features.sessions.html">Sessions</a></dd>
	<dd><a href="features.xforms.html">Dealing with XForms</a></dd>
	<dd><a href="features.file-upload.html">Handling file uploads</a></dd>
	<dd><a href="features.remote-files.html">Using remote files</a></dd>
	<dd><a href="features.connection-handling.html">Connection handling</a></dd>
	<dd><a href="features.persistent-connections.html">Persistent Database Connections</a></dd>
	<dd><a href="features.safe-mode.html">Safe Mode</a></dd>
	<dd><a href="features.commandline.html">Command line usage</a></dd>
	<dd><a href="features.gc.html">Garbage Collection</a></dd>
	<dd><a href="features.dtrace.html">DTrace Dynamic Tracing</a></dd>
</dl>
<dl>
<dt><a href="funcref.html">Function Reference</a></dt>
	<dd><a href="refs.basic.php.html">Affecting PHP's Behaviour</a></dd>
	<dd><a href="refs.utilspec.audio.html">Audio Formats Manipulation</a></dd>
	<dd><a href="refs.remote.auth.html">Authentication Services</a></dd>
	<dd><a href="refs.utilspec.cmdline.html">Command Line Specific Extensions</a></dd>
	<dd><a href="refs.compression.html">Compression and Archive Extensions</a></dd>
	<dd><a href="refs.creditcard.html">Credit Card Processing</a></dd>
	<dd><a href="refs.crypto.html">Cryptography Extensions</a></dd>
	<dd><a href="refs.database.html">Database Extensions</a></dd>
	<dd><a href="refs.calendar.html">Date and Time Related Extensions</a></dd>
	<dd><a href="refs.fileprocess.file.html">File System Related Extensions</a></dd>
	<dd><a href="refs.international.html">Human Language and Character Encoding Support</a></dd>
	<dd><a href="refs.utilspec.image.html">Image Processing and Generation</a></dd>
	<dd><a href="refs.remote.mail.html">Mail Related Extensions</a></dd>
	<dd><a href="refs.math.html">Mathematical Extensions</a></dd>
	<dd><a href="refs.utilspec.nontext.html">Non-Text MIME Output</a></dd>
	<dd><a href="refs.fileprocess.process.html">Process Control Extensions</a></dd>
	<dd><a href="refs.basic.other.html">Other Basic Extensions</a></dd>
	<dd><a href="refs.remote.other.html">Other Services</a></dd>
	<dd><a href="refs.search.html">Search Engine Extensions</a></dd>
	<dd><a href="refs.utilspec.server.html">Server Specific Extensions</a></dd>
	<dd><a href="refs.basic.session.html">Session Extensions</a></dd>
	<dd><a href="refs.basic.text.html">Text Processing</a></dd>
	<dd><a href="refs.basic.vartype.html">Variable and Type Related Extensions</a></dd>
	<dd><a href="refs.webservice.html">Web Services</a></dd>
	<dd><a href="refs.utilspec.windows.html">Windows Only Extensions</a></dd>
	<dd><a href="refs.xml.html">XML Manipulation</a></dd>
</dl>
<dl>
<dt>Keyboard Shortcuts</dt><dt>?</dt>
<dd>This help</dd>
<dt>j</dt>
<dd>Next menu item</dd>
<dt>k</dt>
<dd>Previous menu item</dd>
<dt>g p</dt>
<dd>Previous man page</dd>
<dt>g n</dt>
<dd>Next man page</dd>
<dt>G</dt>
<dd>Scroll to bottom</dd>
<dt>g g</dt>
<dd>Scroll to top</dd>
<dt>g h</dt>
<dd>Goto homepage</dd>
<dt>g s</dt>
<dd>Goto search<br>(current page)</dd>
<dt>/</dt>
<dd>Focus search box</dd>
</dl></div></nav>
<div id="goto">
    <div class="search">
         <div class="text"></div>
         <div class="results"><ul></ul></div>
   </div>
</div>

  <div id="breadcrumbs" class="row-fluid">
          
              
        <ul class="breadcrumbs-container">
            <li><a href="index-2.html">PHP Manual</a></li>      <li><a href="funcref.html">Function Reference</a></li>      <li><a href="refs.xml.html">XML Manipulation</a></li>      <li><a href="book.xml.html">XML Parser</a></li>    </ul>
  </div>




<div id="layout">
  <section id="layout-content">
  <div id="ref.xml" class="reference">
 <h1 class="title">XML Parser Functions</h1>

 
















































































































































<h2>Table of Contents</h2><ul class="chunklist chunklist_reference"><li><a href="function.utf8-decode.html">utf8_decode</a> — Converts a string with ISO-8859-1 characters encoded with UTF-8
   to single-byte ISO-8859-1</li><li><a href="function.utf8-encode.html">utf8_encode</a> — Encodes an ISO-8859-1 string to UTF-8</li><li><a href="function.xml-error-string.html">xml_error_string</a> — Get XML parser error string</li><li><a href="function.xml-get-current-byte-index.html">xml_get_current_byte_index</a> — Get current byte index for an XML parser</li><li><a href="function.xml-get-current-column-number.html">xml_get_current_column_number</a> — Get current column number for an XML parser</li><li><a href="function.xml-get-current-line-number.html">xml_get_current_line_number</a> — Get current line number for an XML parser</li><li><a href="function.xml-get-error-code.html">xml_get_error_code</a> — Get XML parser error code</li><li><a href="function.xml-parse-into-struct.html">xml_parse_into_struct</a> — Parse XML data into an array structure</li><li><a href="function.xml-parse.html">xml_parse</a> — Start parsing an XML document</li><li><a href="function.xml-parser-create-ns.html">xml_parser_create_ns</a> — Create an XML parser with namespace support</li><li><a href="function.xml-parser-create.html">xml_parser_create</a> — Create an XML parser</li><li><a href="function.xml-parser-free.html">xml_parser_free</a> — Free an XML parser</li><li><a href="function.xml-parser-get-option.html">xml_parser_get_option</a> — Get options from an XML parser</li><li><a href="function.xml-parser-set-option.html">xml_parser_set_option</a> — Set options in an XML parser</li><li><a href="function.xml-set-character-data-handler.html">xml_set_character_data_handler</a> — Set up character data handler</li><li><a href="function.xml-set-default-handler.html">xml_set_default_handler</a> — Set up default handler</li><li><a href="function.xml-set-element-handler.html">xml_set_element_handler</a> — Set up start and end element handlers</li><li><a href="function.xml-set-end-namespace-decl-handler.html">xml_set_end_namespace_decl_handler</a> — Set up end namespace declaration handler</li><li><a href="function.xml-set-external-entity-ref-handler.html">xml_set_external_entity_ref_handler</a> — Set up external entity reference handler</li><li><a href="function.xml-set-notation-decl-handler.html">xml_set_notation_decl_handler</a> — Set up notation declaration handler</li><li><a href="function.xml-set-object.html">xml_set_object</a> — Use XML Parser within an object</li><li><a href="function.xml-set-processing-instruction-handler.html">xml_set_processing_instruction_handler</a> — Set up processing instruction (PI) handler</li><li><a href="function.xml-set-start-namespace-decl-handler.html">xml_set_start_namespace_decl_handler</a> — Set up start namespace declaration handler</li><li><a href="function.xml-set-unparsed-entity-decl-handler.html">xml_set_unparsed_entity_decl_handler</a> — Set up unparsed entity declaration handler</li></ul>
</div>

<section id="usernotes">
 <div class="head"><h3 class="title">User Contributed Notes</h3></div><div id="allnotes">
  <div class="note" id="106743">  
  <a class="name">
  <strong class="user"><em>Glen at ITIStudios dot ca</em></strong></a><div class="date" title="2011-12-02 03:37"><strong>2 years ago</strong></div>
  <div class="text" id="Hcom106743">
<div class="phpcode"><code><span class="html">
<span class="default">&lt;?php
<br></span><span class="comment">/**
<br> *&nbsp; XML to Associative Array Class
<br> * 
<br> *&nbsp; Usage:
<br> *&nbsp; &nbsp;&nbsp; $domObj = new xmlToArrayParser($xml);
<br> *&nbsp; &nbsp;&nbsp; $domArr = $domObj-&gt;array;
<br> *&nbsp; &nbsp;&nbsp; 
<br> *&nbsp; &nbsp;&nbsp; if($domObj-&gt;parse_error) echo $domObj-&gt;get_xml_error();
<br> *&nbsp; &nbsp;&nbsp; else print_r($domArr);
<br> * 
<br> *&nbsp; &nbsp;&nbsp; On Success: 
<br> *&nbsp; &nbsp;&nbsp; eg. $domArr['top']['element2']['attrib']['var2'] =&gt; val2
<br> * 
<br> *&nbsp; &nbsp;&nbsp; On Error:
<br> *&nbsp; &nbsp;&nbsp; eg. Error Code [76] "Mismatched tag", at char 58 on line 3
<br> */
<br>
<br>/**
<br> * Convert an xml file or string to an associative array (including the tag attributes): 
<br> * $domObj = new xmlToArrayParser($xml); 
<br> * $elemVal = $domObj-&gt;array['element']
<br> * Or:&nbsp; $domArr=$domObj-&gt;array;&nbsp; $elemVal = $domArr['element'].
<br> * 
<br> * @version&nbsp; 2.0
<br> * @param Str $xml file/string.
<br> */
<br></span><span class="keyword">class </span><span class="default">xmlToArrayParser </span><span class="keyword">{
<br>&nbsp; </span><span class="comment">/** The array created by the parser can be assigned to any variable: $anyVarArr = $domObj-&gt;array.*/
<br>&nbsp; </span><span class="keyword">public&nbsp; </span><span class="default">$array </span><span class="keyword">= array();
<br>&nbsp; public&nbsp; </span><span class="default">$parse_error </span><span class="keyword">= </span><span class="default">false</span><span class="keyword">;
<br>&nbsp; private </span><span class="default">$parser</span><span class="keyword">;
<br>&nbsp; private </span><span class="default">$pointer</span><span class="keyword">;
<br>&nbsp; 
<br>&nbsp; </span><span class="comment">/** Constructor: $domObj = new xmlToArrayParser($xml); */
<br>&nbsp; </span><span class="keyword">public function </span><span class="default">__construct</span><span class="keyword">(</span><span class="default">$xml</span><span class="keyword">) {
<br>&nbsp; &nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">pointer </span><span class="keyword">=&amp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">array</span><span class="keyword">;
<br>&nbsp; &nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">parser </span><span class="keyword">= </span><span class="default">xml_parser_create</span><span class="keyword">(</span><span class="string">"UTF-8"</span><span class="keyword">);
<br>&nbsp; &nbsp; </span><span class="default">xml_set_object</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">parser</span><span class="keyword">, </span><span class="default">$this</span><span class="keyword">);
<br>&nbsp; &nbsp; </span><span class="default">xml_parser_set_option</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">parser</span><span class="keyword">, </span><span class="default">XML_OPTION_CASE_FOLDING</span><span class="keyword">, </span><span class="default">false</span><span class="keyword">);
<br>&nbsp; &nbsp; </span><span class="default">xml_set_element_handler</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">parser</span><span class="keyword">, </span><span class="string">"tag_open"</span><span class="keyword">, </span><span class="string">"tag_close"</span><span class="keyword">);
<br>&nbsp; &nbsp; </span><span class="default">xml_set_character_data_handler</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">parser</span><span class="keyword">, </span><span class="string">"cdata"</span><span class="keyword">); 
<br>&nbsp; &nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">parse_error </span><span class="keyword">= </span><span class="default">xml_parse</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">parser</span><span class="keyword">, </span><span class="default">ltrim</span><span class="keyword">(</span><span class="default">$xml</span><span class="keyword">))? </span><span class="default">false </span><span class="keyword">: </span><span class="default">true</span><span class="keyword">;
<br>&nbsp; }
<br>&nbsp; 
<br>&nbsp; </span><span class="comment">/** Free the parser. */
<br>&nbsp; </span><span class="keyword">public function </span><span class="default">__destruct</span><span class="keyword">() { </span><span class="default">xml_parser_free</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">parser</span><span class="keyword">);}
<br>
<br>&nbsp; </span><span class="comment">/** Get the xml error if an an error in the xml file occured during parsing. */
<br>&nbsp; </span><span class="keyword">public function </span><span class="default">get_xml_error</span><span class="keyword">() {
<br>&nbsp; &nbsp; if(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">parse_error</span><span class="keyword">) { 
<br>&nbsp; &nbsp; &nbsp; </span><span class="default">$errCode </span><span class="keyword">= </span><span class="default">xml_get_error_code </span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">parser</span><span class="keyword">);
<br>&nbsp; &nbsp; &nbsp; </span><span class="default">$thisError </span><span class="keyword">=&nbsp; </span><span class="string">"Error Code ["</span><span class="keyword">. </span><span class="default">$errCode </span><span class="keyword">.</span><span class="string">"] \"&lt;strong style='color:red;'&gt;" </span><span class="keyword">. </span><span class="default">xml_error_string</span><span class="keyword">(</span><span class="default">$errCode</span><span class="keyword">).</span><span class="string">"&lt;/strong&gt;\", 
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; at char "</span><span class="keyword">.</span><span class="default">xml_get_current_column_number</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">parser</span><span class="keyword">) . </span><span class="string">" 
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; on line "</span><span class="keyword">.</span><span class="default">xml_get_current_line_number</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">parser</span><span class="keyword">).</span><span class="string">""</span><span class="keyword">;
<br>&nbsp; &nbsp; }else </span><span class="default">$thisError </span><span class="keyword">= </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">parse_error</span><span class="keyword">;
<br>&nbsp; &nbsp; return </span><span class="default">$thisError</span><span class="keyword">;
<br>&nbsp; }
<br>&nbsp; 
<br>&nbsp; private function </span><span class="default">tag_open</span><span class="keyword">(</span><span class="default">$parser</span><span class="keyword">, </span><span class="default">$tag</span><span class="keyword">, </span><span class="default">$attributes</span><span class="keyword">) {
<br>&nbsp; &nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">convert_to_array</span><span class="keyword">(</span><span class="default">$tag</span><span class="keyword">, </span><span class="string">'attrib'</span><span class="keyword">);
<br>&nbsp; &nbsp; </span><span class="default">$idx</span><span class="keyword">=</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">convert_to_array</span><span class="keyword">(</span><span class="default">$tag</span><span class="keyword">, </span><span class="string">'cdata'</span><span class="keyword">); 
<br>&nbsp; &nbsp; if(isset(</span><span class="default">$idx</span><span class="keyword">)) { 
<br>&nbsp; &nbsp; &nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">pointer</span><span class="keyword">[</span><span class="default">$tag</span><span class="keyword">][</span><span class="default">$idx</span><span class="keyword">] = Array(</span><span class="string">'@idx' </span><span class="keyword">=&gt; </span><span class="default">$idx</span><span class="keyword">,</span><span class="string">'@parent' </span><span class="keyword">=&gt; &amp;</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">pointer</span><span class="keyword">);
<br>&nbsp; &nbsp; &nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">pointer </span><span class="keyword">=&amp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">pointer</span><span class="keyword">[</span><span class="default">$tag</span><span class="keyword">][</span><span class="default">$idx</span><span class="keyword">];
<br>&nbsp; &nbsp; }else {
<br>&nbsp; &nbsp; &nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">pointer</span><span class="keyword">[</span><span class="default">$tag</span><span class="keyword">] = Array(</span><span class="string">'@parent' </span><span class="keyword">=&gt; &amp;</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">pointer</span><span class="keyword">);
<br>&nbsp; &nbsp; &nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">pointer </span><span class="keyword">=&amp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">pointer</span><span class="keyword">[</span><span class="default">$tag</span><span class="keyword">];
<br>&nbsp; &nbsp; }
<br>&nbsp; &nbsp; if (!empty(</span><span class="default">$attributes</span><span class="keyword">)) { </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">pointer</span><span class="keyword">[</span><span class="string">'attrib'</span><span class="keyword">] = </span><span class="default">$attributes</span><span class="keyword">; }
<br>&nbsp; }
<br>
<br>&nbsp; </span><span class="comment">/** Adds the current elements content to the current pointer[cdata] array. */
<br>&nbsp; </span><span class="keyword">private function </span><span class="default">cdata</span><span class="keyword">(</span><span class="default">$parser</span><span class="keyword">, </span><span class="default">$cdata</span><span class="keyword">) { </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">pointer</span><span class="keyword">[</span><span class="string">'cdata'</span><span class="keyword">] = </span><span class="default">trim</span><span class="keyword">(</span><span class="default">$cdata</span><span class="keyword">); }
<br>
<br>&nbsp; private function </span><span class="default">tag_close</span><span class="keyword">(</span><span class="default">$parser</span><span class="keyword">, </span><span class="default">$tag</span><span class="keyword">) {
<br>&nbsp; &nbsp; </span><span class="default">$current </span><span class="keyword">= &amp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">pointer</span><span class="keyword">;
<br>&nbsp; &nbsp; if(isset(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">pointer</span><span class="keyword">[</span><span class="string">'@idx'</span><span class="keyword">])) {unset(</span><span class="default">$current</span><span class="keyword">[</span><span class="string">'@idx'</span><span class="keyword">]);}
<br>&nbsp; &nbsp; 
<br>&nbsp; &nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">pointer </span><span class="keyword">= &amp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">pointer</span><span class="keyword">[</span><span class="string">'@parent'</span><span class="keyword">];
<br>&nbsp; &nbsp; unset(</span><span class="default">$current</span><span class="keyword">[</span><span class="string">'@parent'</span><span class="keyword">]);
<br>&nbsp; &nbsp; 
<br>&nbsp; &nbsp; if(isset(</span><span class="default">$current</span><span class="keyword">[</span><span class="string">'cdata'</span><span class="keyword">]) &amp;&amp; </span><span class="default">count</span><span class="keyword">(</span><span class="default">$current</span><span class="keyword">) == </span><span class="default">1</span><span class="keyword">) { </span><span class="default">$current </span><span class="keyword">= </span><span class="default">$current</span><span class="keyword">[</span><span class="string">'cdata'</span><span class="keyword">];}
<br>&nbsp; &nbsp; else if(empty(</span><span class="default">$current</span><span class="keyword">[</span><span class="string">'cdata'</span><span class="keyword">])) {unset(</span><span class="default">$current</span><span class="keyword">[</span><span class="string">'cdata'</span><span class="keyword">]);}
<br>&nbsp; }
<br>&nbsp; 
<br>&nbsp; </span><span class="comment">/** Converts a single element item into array(element[0]) if a second element of the same name is encountered. */
<br>&nbsp; </span><span class="keyword">private function </span><span class="default">convert_to_array</span><span class="keyword">(</span><span class="default">$tag</span><span class="keyword">, </span><span class="default">$item</span><span class="keyword">) { 
<br>&nbsp; &nbsp; if(isset(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">pointer</span><span class="keyword">[</span><span class="default">$tag</span><span class="keyword">][</span><span class="default">$item</span><span class="keyword">])) { 
<br>&nbsp; &nbsp; &nbsp; </span><span class="default">$content </span><span class="keyword">= </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">pointer</span><span class="keyword">[</span><span class="default">$tag</span><span class="keyword">];
<br>&nbsp; &nbsp; &nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">pointer</span><span class="keyword">[</span><span class="default">$tag</span><span class="keyword">] = array((</span><span class="default">0</span><span class="keyword">) =&gt; </span><span class="default">$content</span><span class="keyword">);
<br>&nbsp; &nbsp; &nbsp; </span><span class="default">$idx </span><span class="keyword">= </span><span class="default">1</span><span class="keyword">;
<br>&nbsp; &nbsp; }else if (isset(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">pointer</span><span class="keyword">[</span><span class="default">$tag</span><span class="keyword">])) { 
<br>&nbsp; &nbsp; &nbsp; </span><span class="default">$idx </span><span class="keyword">= </span><span class="default">count</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">pointer</span><span class="keyword">[</span><span class="default">$tag</span><span class="keyword">]); 
<br>&nbsp; &nbsp; &nbsp; if(!isset(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">pointer</span><span class="keyword">[</span><span class="default">$tag</span><span class="keyword">][</span><span class="default">0</span><span class="keyword">])) { 
<br>&nbsp; &nbsp; &nbsp; &nbsp; foreach (</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">pointer</span><span class="keyword">[</span><span class="default">$tag</span><span class="keyword">] as </span><span class="default">$key </span><span class="keyword">=&gt; </span><span class="default">$value</span><span class="keyword">) {
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; unset(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">pointer</span><span class="keyword">[</span><span class="default">$tag</span><span class="keyword">][</span><span class="default">$key</span><span class="keyword">]);
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">pointer</span><span class="keyword">[</span><span class="default">$tag</span><span class="keyword">][</span><span class="default">0</span><span class="keyword">][</span><span class="default">$key</span><span class="keyword">] = </span><span class="default">$value</span><span class="keyword">;
<br>&nbsp; &nbsp; }}}else </span><span class="default">$idx </span><span class="keyword">= </span><span class="default">null</span><span class="keyword">;
<br>&nbsp; &nbsp; return </span><span class="default">$idx</span><span class="keyword">;
<br>&nbsp; }
<br>}
<br></span><span class="default">?&gt;
<br></span>
<br>This is supplimental information for the "class xmlToArrayParser".
<br>This is a fully functional error free, extensively tested php class unlike the posts that follow it.
<br>
<br>Key phrase: Fully functional, fully tested, error free XML To Array parser.
<br>
<br><span class="default">&lt;?php
<br></span><span class="comment">/**
<br> * class xmlToArrayParser
<br> * 
<br>&nbsp; Notes: 
<br>&nbsp; 1. 'attrib' and 'cdata' are keys added to the array when the element contains both attributes and content.
<br>&nbsp; 2. Ignores content that is not in between it's own set of tags.
<br>&nbsp; 3. Don't know if it recognizes processing instructions nor do I know about processing instructions.
<br>&nbsp; &nbsp;&nbsp; &lt;\?some_pi some_attr="some_value"?&gt;&nbsp; This is the same as a document declaration.
<br>&nbsp; 4. Empty elements are not included unless they have attributes.
<br>&nbsp; 5. Version 2.0, Dec. 2, 2011, added xml error reporting.
<br>&nbsp; 
<br>&nbsp; Usage:
<br>&nbsp; &nbsp; $domObj = new xmlToArrayParser($xml);
<br>&nbsp; &nbsp; $elemVal = $domObj-&gt;array['element']
<br>&nbsp; &nbsp; Or assign the entire array to its own variable:
<br>&nbsp; &nbsp; $domArr = $domObj-&gt;array;
<br>&nbsp; &nbsp; $elemVal = $domArr['element']
<br>&nbsp; 
<br>&nbsp; Example:
<br>&nbsp; &nbsp; $xml = '&lt;?xml version="1.0" encoding="UTF-8" standalone="no"?&gt;
<br>&nbsp; &nbsp; &lt;top&gt;
<br>&nbsp; &nbsp; &nbsp; &lt;element1&gt;element content 1&lt;/element1&gt;
<br>&nbsp; &nbsp; &nbsp; &lt;element2 var2="val2" /&gt;
<br>&nbsp; &nbsp; &nbsp; &lt;element3 var3="val3" var4="val4"&gt;element content 3&lt;/element3&gt; 
<br>&nbsp; &nbsp; &nbsp; &lt;element3 var5="val5"&gt;element content 4&lt;/element3&gt;
<br>&nbsp; &nbsp; &nbsp; &lt;element3 var6="val6" /&gt;
<br>&nbsp; &nbsp; &nbsp; &lt;element3&gt;element content 7&lt;/element3&gt;
<br>&nbsp; &nbsp; &lt;/top&gt;';
<br>&nbsp; &nbsp; 
<br>&nbsp; &nbsp; $domObj = new xmlToArrayParser($xml);
<br>&nbsp; &nbsp; $domArr = $domObj-&gt;array;
<br>&nbsp; &nbsp; 
<br>&nbsp; &nbsp; if($domObj-&gt;parse_error) echo $domObj-&gt;get_xml_error();
<br>&nbsp; &nbsp; else print_r($domArr);
<br>
<br>&nbsp; &nbsp; On Success:
<br>&nbsp; &nbsp; $domArr['top']['element1'] =&gt; element content 1
<br>&nbsp; &nbsp; $domArr['top']['element2']['attrib']['var2'] =&gt; val2
<br>&nbsp; &nbsp; $domArr['top']['element3']['0']['attrib']['var3'] =&gt; val3
<br>&nbsp; &nbsp; $domArr['top']['element3']['0']['attrib']['var4'] =&gt; val4
<br>&nbsp; &nbsp; $domArr['top']['element3']['0']['cdata'] =&gt; element content 3
<br>&nbsp; &nbsp; $domArr['top']['element3']['1']['attrib']['var5'] =&gt; val5
<br>&nbsp; &nbsp; $domArr['top']['element3']['1']['cdata'] =&gt; element content 4
<br>&nbsp; &nbsp; $domArr['top']['element3']['2']['attrib']['var6'] =&gt; val6
<br>&nbsp; &nbsp; $domArr['top']['element3']['3'] =&gt; element content 7
<br>&nbsp; &nbsp; 
<br>&nbsp; &nbsp; On Error:
<br>&nbsp; &nbsp; Error Code [76] "Mismatched tag", at char 58 on line 3
<br> *
<br> */
<br></span><span class="default">?&gt;</span>
</span>
</code></div>
  </div>
 </div>
  <div class="note" id="72051">  
  <a class="name">
  <strong class="user"><em>geoffers [at] gmail [dot] com</em></strong></a><div class="date" title="2006-12-30 03:27"><strong>7 years ago</strong></div>
  <div class="text" id="Hcom72051">
<div class="phpcode"><code><span class="html">
Time to add my attempt at a very simple script that parses XML into a structure:<br><br><span class="default">&lt;?php<br><br></span><span class="keyword">class </span><span class="default">Simple_Parser <br></span><span class="keyword">{<br>&nbsp; &nbsp; var </span><span class="default">$parser</span><span class="keyword">;<br>&nbsp; &nbsp; var </span><span class="default">$error_code</span><span class="keyword">;<br>&nbsp; &nbsp; var </span><span class="default">$error_string</span><span class="keyword">;<br>&nbsp; &nbsp; var </span><span class="default">$current_line</span><span class="keyword">;<br>&nbsp; &nbsp; var </span><span class="default">$current_column</span><span class="keyword">;<br>&nbsp; &nbsp; var </span><span class="default">$data </span><span class="keyword">= array();<br>&nbsp; &nbsp; var </span><span class="default">$datas </span><span class="keyword">= array();<br>&nbsp; &nbsp; <br>&nbsp; &nbsp; function </span><span class="default">parse</span><span class="keyword">(</span><span class="default">$data</span><span class="keyword">)<br>&nbsp; &nbsp; {<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">parser </span><span class="keyword">= </span><span class="default">xml_parser_create</span><span class="keyword">(</span><span class="string">'UTF-8'</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">xml_set_object</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">parser</span><span class="keyword">, </span><span class="default">$this</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">xml_parser_set_option</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">parser</span><span class="keyword">, </span><span class="default">XML_OPTION_SKIP_WHITE</span><span class="keyword">, </span><span class="default">1</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">xml_set_element_handler</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">parser</span><span class="keyword">, </span><span class="string">'tag_open'</span><span class="keyword">, </span><span class="string">'tag_close'</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">xml_set_character_data_handler</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">parser</span><span class="keyword">, </span><span class="string">'cdata'</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; if (!</span><span class="default">xml_parse</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">parser</span><span class="keyword">, </span><span class="default">$data</span><span class="keyword">))<br>&nbsp; &nbsp; &nbsp; &nbsp; {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">data </span><span class="keyword">= array();<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">error_code </span><span class="keyword">= </span><span class="default">xml_get_error_code</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">parser</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">error_string </span><span class="keyword">= </span><span class="default">xml_error_string</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">error_code</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">current_line </span><span class="keyword">= </span><span class="default">xml_get_current_line_number</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">parser</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">current_column </span><span class="keyword">= </span><span class="default">xml_get_current_column_number</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">parser</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; }<br>&nbsp; &nbsp; &nbsp; &nbsp; else<br>&nbsp; &nbsp; &nbsp; &nbsp; {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">data </span><span class="keyword">= </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">data</span><span class="keyword">[</span><span class="string">'child'</span><span class="keyword">];<br>&nbsp; &nbsp; &nbsp; &nbsp; }<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">xml_parser_free</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">parser</span><span class="keyword">);<br>&nbsp; &nbsp; }<br><br>&nbsp; &nbsp; function </span><span class="default">tag_open</span><span class="keyword">(</span><span class="default">$parser</span><span class="keyword">, </span><span class="default">$tag</span><span class="keyword">, </span><span class="default">$attribs</span><span class="keyword">)<br>&nbsp; &nbsp; {<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">data</span><span class="keyword">[</span><span class="string">'child'</span><span class="keyword">][</span><span class="default">$tag</span><span class="keyword">][] = array(</span><span class="string">'data' </span><span class="keyword">=&gt; </span><span class="string">''</span><span class="keyword">, </span><span class="string">'attribs' </span><span class="keyword">=&gt; </span><span class="default">$attribs</span><span class="keyword">, </span><span class="string">'child' </span><span class="keyword">=&gt; array());<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">datas</span><span class="keyword">[] =&amp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">data</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">data </span><span class="keyword">=&amp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">data</span><span class="keyword">[</span><span class="string">'child'</span><span class="keyword">][</span><span class="default">$tag</span><span class="keyword">][</span><span class="default">count</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">data</span><span class="keyword">[</span><span class="string">'child'</span><span class="keyword">][</span><span class="default">$tag</span><span class="keyword">])-</span><span class="default">1</span><span class="keyword">];<br>&nbsp; &nbsp; }<br><br>&nbsp; &nbsp; function </span><span class="default">cdata</span><span class="keyword">(</span><span class="default">$parser</span><span class="keyword">, </span><span class="default">$cdata</span><span class="keyword">)<br>&nbsp; &nbsp; {<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">data</span><span class="keyword">[</span><span class="string">'data'</span><span class="keyword">] .= </span><span class="default">$cdata</span><span class="keyword">;<br>&nbsp; &nbsp; }<br><br>&nbsp; &nbsp; function </span><span class="default">tag_close</span><span class="keyword">(</span><span class="default">$parser</span><span class="keyword">, </span><span class="default">$tag</span><span class="keyword">)<br>&nbsp; &nbsp; {<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">data </span><span class="keyword">=&amp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">datas</span><span class="keyword">[</span><span class="default">count</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">datas</span><span class="keyword">)-</span><span class="default">1</span><span class="keyword">];<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">array_pop</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">datas</span><span class="keyword">);<br>&nbsp; &nbsp; }<br>}<br><br></span><span class="default">$xml_parser </span><span class="keyword">= new </span><span class="default">Simple_Parser</span><span class="keyword">;<br></span><span class="default">$xml_parser</span><span class="keyword">-&gt;</span><span class="default">parse</span><span class="keyword">(</span><span class="string">'&lt;foo&gt;&lt;bar&gt;test&lt;/bar&gt;&lt;/foo&gt;'</span><span class="keyword">);<br><br></span><span class="default">?&gt;</span>
</span>
</code></div>
  </div>
 </div>
  <div class="note" id="58845">  
  <a class="name">
  <strong class="user"><em>Greg S</em></strong></a><div class="date" title="2005-11-17 08:56"><strong>8 years ago</strong></div>
  <div class="text" id="Hcom58845">
<div class="phpcode"><code><span class="html">
If you need utf8_encode support and configure PHP with --disable-all you will have some trouble. Unfortunately the configure options aren't completely documented. If you need utf8 functions and have everything disabled just recompile PHP with --enable-xml and you should be good to go.</span>
</code></div>
  </div>
 </div>
  <div class="note" id="78678">  
  <a class="name">
  <strong class="user"><em>demonpants at gmail dot com</em></strong></a><div class="date" title="2007-10-22 08:59"><strong>6 years ago</strong></div>
  <div class="text" id="Hcom78678">
<div class="phpcode"><code><span class="html">
I wanted to access the ISBN database, and was previously parsing the HTML string generated from their main page, that is until I discovered they have an API that returns XML.<br><br>So, if anyone wants to get some information from the ISBN database, all you need to do is the following.<br><br><span class="default">&lt;?php<br></span><span class="comment">//Search the ISBN database for the book.<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$url </span><span class="keyword">= </span><span class="string">"<a rel="nofollow" target="_blank">http://www.isbndb.com/api/books.xml?</a> access_key=KEY&amp;index1=isbn&amp;value1=</span><span class="default">$_GET</span><span class="keyword">[</span><span class="default">ISBN</span><span class="keyword">]</span><span class="string">"</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$p </span><span class="keyword">= </span><span class="default">xml_parser_create</span><span class="keyword">();<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">xml_parse_into_struct</span><span class="keyword">(</span><span class="default">$p</span><span class="keyword">,</span><span class="default">file_get_contents</span><span class="keyword">(</span><span class="default">$url</span><span class="keyword">),</span><span class="default">$results</span><span class="keyword">,</span><span class="default">$index</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">xml_parser_free</span><span class="keyword">(</span><span class="default">$p</span><span class="keyword">);<br><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$title </span><span class="keyword">= </span><span class="default">$results</span><span class="keyword">[</span><span class="default">$index</span><span class="keyword">[</span><span class="default">TITLELONG</span><span class="keyword">][</span><span class="default">0</span><span class="keyword">]][</span><span class="default">value</span><span class="keyword">];<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$author </span><span class="keyword">= </span><span class="default">$results</span><span class="keyword">[</span><span class="default">$index</span><span class="keyword">[</span><span class="default">AUTHORSTEXT</span><span class="keyword">][</span><span class="default">0</span><span class="keyword">]][</span><span class="default">value</span><span class="keyword">];<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$publisher </span><span class="keyword">= </span><span class="default">$results</span><span class="keyword">[</span><span class="default">$index</span><span class="keyword">[</span><span class="default">PUBLISHERTEXT</span><span class="keyword">][</span><span class="default">0</span><span class="keyword">]][</span><span class="default">value</span><span class="keyword">];<br></span><span class="default">?&gt;<br></span><br>You will need to get an access key from isbndb.com, but it takes two seconds and is free. When you get it, replace KEY in the URL with your own key. Also, my code above will search for the book that fits the ISBN number stored in the GET variable ISBN - you can search by other parameters and return more than one result, but my example is&nbsp; for a simple ISBN search.</span>
</code></div>
  </div>
 </div>
  <div class="note" id="45802">  
  <a class="name">
  <strong class="user"><em>compu_global_hyper_mega_net_2 at yahoo dot com</em></strong></a><div class="date" title="2004-09-19 01:35"><strong>9 years ago</strong></div>
  <div class="text" id="Hcom45802">
<div class="phpcode"><code><span class="html">
The documentation regarding white space was never complete I think.<br><br>The XML_OPTION_SKIP_WHITE doesn't appear to do anything.&nbsp; I want to preserve the newlines in a cdata section.&nbsp; Setting XML_OPTION_SKIP_WHITE to 0 or false doesn't appear to help.&nbsp; My character_data_handler is getting called once for each line.&nbsp; This obviously should be reflected in the documentation as well.&nbsp; When/how often does the handler get called exactly?&nbsp; Having to build separate test cases is very time consuming.<br><br>Inserting newlines myself in my cdata handler is no good either.&nbsp; For non actual CDATA sections that cause my handler to get called, long lines are split up in multiple calls.&nbsp; My handler would not be able to tell the difference whether or not the subsequent calls would be due to the fact that the data is coming from the next line or the fact that some internal buffer is long enough for it to 'flush' out and call the handler.<br>This behaviour also needs to be properly documented.</span>
</code></div>
  </div>
 </div>
  <div class="note" id="25557">  
  <a class="name">
  <strong class="user"><em>guy  at  bhaktiandvedanta dot com</em></strong></a><div class="date" title="2002-09-27 12:01"><strong>11 years ago</strong></div>
  <div class="text" id="Hcom25557">
<div class="phpcode"><code><span class="html">
For a simple XML parser you can use this function. It doesn't require any extensions to run.
<br>
<br><span class="default">&lt;?php
<br></span><span class="comment">// Extracts content from XML tag
<br>
<br></span><span class="keyword">function </span><span class="default">GetElementByName </span><span class="keyword">(</span><span class="default">$xml</span><span class="keyword">, </span><span class="default">$start</span><span class="keyword">, </span><span class="default">$end</span><span class="keyword">) {
<br>
<br>&nbsp; &nbsp; global </span><span class="default">$pos</span><span class="keyword">;
<br>&nbsp; &nbsp; </span><span class="default">$startpos </span><span class="keyword">= </span><span class="default">strpos</span><span class="keyword">(</span><span class="default">$xml</span><span class="keyword">, </span><span class="default">$start</span><span class="keyword">);
<br>&nbsp; &nbsp; if (</span><span class="default">$startpos </span><span class="keyword">=== </span><span class="default">false</span><span class="keyword">) {
<br>&nbsp; &nbsp; &nbsp; &nbsp; return </span><span class="default">false</span><span class="keyword">;
<br>&nbsp; &nbsp; }
<br>&nbsp; &nbsp; </span><span class="default">$endpos </span><span class="keyword">= </span><span class="default">strpos</span><span class="keyword">(</span><span class="default">$xml</span><span class="keyword">, </span><span class="default">$end</span><span class="keyword">);
<br>&nbsp; &nbsp; </span><span class="default">$endpos </span><span class="keyword">= </span><span class="default">$endpos</span><span class="keyword">+</span><span class="default">strlen</span><span class="keyword">(</span><span class="default">$end</span><span class="keyword">);&nbsp; &nbsp; 
<br>&nbsp; &nbsp; </span><span class="default">$pos </span><span class="keyword">= </span><span class="default">$endpos</span><span class="keyword">;
<br>&nbsp; &nbsp; </span><span class="default">$endpos </span><span class="keyword">= </span><span class="default">$endpos</span><span class="keyword">-</span><span class="default">$startpos</span><span class="keyword">;
<br>&nbsp; &nbsp; </span><span class="default">$endpos </span><span class="keyword">= </span><span class="default">$endpos </span><span class="keyword">- </span><span class="default">strlen</span><span class="keyword">(</span><span class="default">$end</span><span class="keyword">);
<br>&nbsp; &nbsp; </span><span class="default">$tag </span><span class="keyword">= </span><span class="default">substr </span><span class="keyword">(</span><span class="default">$xml</span><span class="keyword">, </span><span class="default">$startpos</span><span class="keyword">, </span><span class="default">$endpos</span><span class="keyword">);
<br>&nbsp; &nbsp; </span><span class="default">$tag </span><span class="keyword">= </span><span class="default">substr </span><span class="keyword">(</span><span class="default">$tag</span><span class="keyword">, </span><span class="default">strlen</span><span class="keyword">(</span><span class="default">$start</span><span class="keyword">));
<br>
<br>&nbsp; &nbsp; return </span><span class="default">$tag</span><span class="keyword">;
<br>
<br>}
<br>
<br></span><span class="comment">// Open and read xml file. You can replace this with your xml data.
<br>
<br></span><span class="default">$file </span><span class="keyword">= </span><span class="string">"data.xml"</span><span class="keyword">;
<br></span><span class="default">$pos </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">;
<br></span><span class="default">$Nodes </span><span class="keyword">= array();
<br>
<br>if (!(</span><span class="default">$fp </span><span class="keyword">= </span><span class="default">fopen</span><span class="keyword">(</span><span class="default">$file</span><span class="keyword">, </span><span class="string">"r"</span><span class="keyword">))) {
<br>&nbsp; &nbsp; die(</span><span class="string">"could not open XML input"</span><span class="keyword">);
<br>}
<br>while (</span><span class="default">$getline </span><span class="keyword">= </span><span class="default">fread</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">, </span><span class="default">4096</span><span class="keyword">)) {
<br>&nbsp; &nbsp; </span><span class="default">$data </span><span class="keyword">= </span><span class="default">$data </span><span class="keyword">. </span><span class="default">$getline</span><span class="keyword">;
<br>}
<br>
<br></span><span class="default">$count </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">;
<br></span><span class="default">$pos </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">;
<br>
<br></span><span class="comment">// Goes throw XML file and creates an array of all &lt;XML_TAG&gt; tags.
<br></span><span class="keyword">while (</span><span class="default">$node </span><span class="keyword">= </span><span class="default">GetElementByName</span><span class="keyword">(</span><span class="default">$data</span><span class="keyword">, </span><span class="string">"&lt;XML_TAG&gt;"</span><span class="keyword">, </span><span class="string">"&lt;/XML_TAG&gt;"</span><span class="keyword">)) {
<br>&nbsp; &nbsp; </span><span class="default">$Nodes</span><span class="keyword">[</span><span class="default">$count</span><span class="keyword">] = </span><span class="default">$node</span><span class="keyword">;
<br>&nbsp; &nbsp; </span><span class="default">$count</span><span class="keyword">++;
<br>&nbsp; &nbsp; </span><span class="default">$data </span><span class="keyword">= </span><span class="default">substr</span><span class="keyword">(</span><span class="default">$data</span><span class="keyword">, </span><span class="default">$pos</span><span class="keyword">);
<br>}
<br>
<br></span><span class="comment">// Gets infomation from tag siblings.
<br></span><span class="keyword">for (</span><span class="default">$i</span><span class="keyword">=</span><span class="default">0</span><span class="keyword">; </span><span class="default">$i</span><span class="keyword">&lt;</span><span class="default">$count</span><span class="keyword">; </span><span class="default">$i</span><span class="keyword">++) {
<br></span><span class="default">$code </span><span class="keyword">= </span><span class="default">GetElementByName</span><span class="keyword">(</span><span class="default">$Nodes</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">], </span><span class="string">"&lt;Code&gt;"</span><span class="keyword">, </span><span class="string">"&lt;/Code&gt;"</span><span class="keyword">);
<br></span><span class="default">$desc </span><span class="keyword">= </span><span class="default">GetElementByName</span><span class="keyword">(</span><span class="default">$Nodes</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">], </span><span class="string">"&lt;Description&gt;"</span><span class="keyword">, </span><span class="string">"&lt;/Description&gt;"</span><span class="keyword">);
<br></span><span class="default">$price </span><span class="keyword">= </span><span class="default">GetElementByName</span><span class="keyword">(</span><span class="default">$Nodes</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">], </span><span class="string">"&lt;BasePrice&gt;"</span><span class="keyword">, </span><span class="string">"&lt;/BasePrice&gt;"</span><span class="keyword">);
<br>}
<br></span><span class="default">?&gt;
<br></span>
<br>Hope this helps! :)
<br>Guy Laor</span>
</code></div>
  </div>
 </div>
  <div class="note" id="24378">  
  <a class="name">
  <strong class="user"><em>jon at gettys dot org</em></strong></a><div class="date" title="2002-08-14 01:59"><strong>12 years ago</strong></div>
  <div class="text" id="Hcom24378">
<div class="phpcode"><code><span class="html">
[Editor's note: see also xml_parse_into_struct().]
<br>
<br>Very simple routine to convert an XML file into a PHP structure. $obj-&gt;xml contains the resulting PHP structure. I would be interested if someone could suggest a cleaner method than the evals I am using.
<br>
<br><span class="default">&lt;?php
<br>$filename </span><span class="keyword">= </span><span class="string">'sample.xml'</span><span class="keyword">;
<br></span><span class="default">$obj</span><span class="keyword">-&gt;</span><span class="default">tree </span><span class="keyword">= </span><span class="string">'$obj-&gt;xml'</span><span class="keyword">;
<br></span><span class="default">$obj</span><span class="keyword">-&gt;</span><span class="default">xml </span><span class="keyword">= </span><span class="string">''</span><span class="keyword">;
<br>
<br>function </span><span class="default">startElement</span><span class="keyword">(</span><span class="default">$parser</span><span class="keyword">, </span><span class="default">$name</span><span class="keyword">, </span><span class="default">$attrs</span><span class="keyword">) {
<br>&nbsp; &nbsp; global </span><span class="default">$obj</span><span class="keyword">;
<br>&nbsp; &nbsp; 
<br>&nbsp; &nbsp; </span><span class="comment">// If var already defined, make array
<br>&nbsp; &nbsp; </span><span class="keyword">eval(</span><span class="string">'$test=isset('</span><span class="keyword">.</span><span class="default">$obj</span><span class="keyword">-&gt;</span><span class="default">tree</span><span class="keyword">.</span><span class="string">'-&gt;'</span><span class="keyword">.</span><span class="default">$name</span><span class="keyword">.</span><span class="string">');'</span><span class="keyword">);
<br>&nbsp; &nbsp; if (</span><span class="default">$test</span><span class="keyword">) {
<br>&nbsp; &nbsp; &nbsp; eval(</span><span class="string">'$tmp='</span><span class="keyword">.</span><span class="default">$obj</span><span class="keyword">-&gt;</span><span class="default">tree</span><span class="keyword">.</span><span class="string">'-&gt;'</span><span class="keyword">.</span><span class="default">$name</span><span class="keyword">.</span><span class="string">';'</span><span class="keyword">);
<br>&nbsp; &nbsp; &nbsp; eval(</span><span class="string">'$arr=is_array('</span><span class="keyword">.</span><span class="default">$obj</span><span class="keyword">-&gt;</span><span class="default">tree</span><span class="keyword">.</span><span class="string">'-&gt;'</span><span class="keyword">.</span><span class="default">$name</span><span class="keyword">.</span><span class="string">');'</span><span class="keyword">);
<br>&nbsp; &nbsp; &nbsp; if (!</span><span class="default">$arr</span><span class="keyword">) {
<br>&nbsp; &nbsp; &nbsp; &nbsp; eval(</span><span class="string">'unset('</span><span class="keyword">.</span><span class="default">$obj</span><span class="keyword">-&gt;</span><span class="default">tree</span><span class="keyword">.</span><span class="string">'-&gt;'</span><span class="keyword">.</span><span class="default">$name</span><span class="keyword">.</span><span class="string">');'</span><span class="keyword">);
<br>&nbsp; &nbsp; &nbsp; &nbsp; eval(</span><span class="default">$obj</span><span class="keyword">-&gt;</span><span class="default">tree</span><span class="keyword">.</span><span class="string">'-&gt;'</span><span class="keyword">.</span><span class="default">$name</span><span class="keyword">.</span><span class="string">'[0]=$tmp;'</span><span class="keyword">);
<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$cnt </span><span class="keyword">= </span><span class="default">1</span><span class="keyword">;
<br>&nbsp; &nbsp; &nbsp; }
<br>&nbsp; &nbsp; &nbsp; else {
<br>&nbsp; &nbsp; &nbsp; &nbsp; eval(</span><span class="string">'$cnt=count('</span><span class="keyword">.</span><span class="default">$obj</span><span class="keyword">-&gt;</span><span class="default">tree</span><span class="keyword">.</span><span class="string">'-&gt;'</span><span class="keyword">.</span><span class="default">$name</span><span class="keyword">.</span><span class="string">');'</span><span class="keyword">);
<br>&nbsp; &nbsp; &nbsp; }
<br>&nbsp; &nbsp; &nbsp; 
<br>&nbsp; &nbsp; &nbsp; </span><span class="default">$obj</span><span class="keyword">-&gt;</span><span class="default">tree </span><span class="keyword">.= </span><span class="string">'-&gt;'</span><span class="keyword">.</span><span class="default">$name</span><span class="keyword">.</span><span class="string">"[</span><span class="default">$cnt</span><span class="string">]"</span><span class="keyword">;
<br>&nbsp; &nbsp; }
<br>&nbsp; &nbsp; else {
<br>&nbsp; &nbsp; &nbsp; </span><span class="default">$obj</span><span class="keyword">-&gt;</span><span class="default">tree </span><span class="keyword">.= </span><span class="string">'-&gt;'</span><span class="keyword">.</span><span class="default">$name</span><span class="keyword">;
<br>&nbsp; &nbsp; }
<br>&nbsp; &nbsp; if (</span><span class="default">count</span><span class="keyword">(</span><span class="default">$attrs</span><span class="keyword">)) {
<br>&nbsp; &nbsp; &nbsp; &nbsp; eval(</span><span class="default">$obj</span><span class="keyword">-&gt;</span><span class="default">tree</span><span class="keyword">.</span><span class="string">'-&gt;attr=$attrs;'</span><span class="keyword">);
<br>&nbsp; &nbsp; }
<br>}
<br>
<br>function </span><span class="default">endElement</span><span class="keyword">(</span><span class="default">$parser</span><span class="keyword">, </span><span class="default">$name</span><span class="keyword">) {
<br>&nbsp; &nbsp; global </span><span class="default">$obj</span><span class="keyword">;
<br>&nbsp; &nbsp; </span><span class="comment">// Strip off last -&gt;
<br>&nbsp; &nbsp; </span><span class="keyword">for(</span><span class="default">$a</span><span class="keyword">=</span><span class="default">strlen</span><span class="keyword">(</span><span class="default">$obj</span><span class="keyword">-&gt;</span><span class="default">tree</span><span class="keyword">);</span><span class="default">$a</span><span class="keyword">&gt;</span><span class="default">0</span><span class="keyword">;</span><span class="default">$a</span><span class="keyword">--) {
<br>&nbsp; &nbsp; &nbsp; &nbsp; if (</span><span class="default">substr</span><span class="keyword">(</span><span class="default">$obj</span><span class="keyword">-&gt;</span><span class="default">tree</span><span class="keyword">, </span><span class="default">$a</span><span class="keyword">, </span><span class="default">2</span><span class="keyword">) == </span><span class="string">'-&gt;'</span><span class="keyword">) {
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$obj</span><span class="keyword">-&gt;</span><span class="default">tree </span><span class="keyword">= </span><span class="default">substr</span><span class="keyword">(</span><span class="default">$obj</span><span class="keyword">-&gt;</span><span class="default">tree</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">$a</span><span class="keyword">);
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; break;
<br>&nbsp; &nbsp; &nbsp; &nbsp; }
<br>&nbsp; &nbsp; }
<br>}
<br>
<br>function </span><span class="default">characterData</span><span class="keyword">(</span><span class="default">$parser</span><span class="keyword">, </span><span class="default">$data</span><span class="keyword">) {
<br>&nbsp; &nbsp; global </span><span class="default">$obj</span><span class="keyword">;
<br>
<br>&nbsp; &nbsp; eval(</span><span class="default">$obj</span><span class="keyword">-&gt;</span><span class="default">tree</span><span class="keyword">.</span><span class="string">'-&gt;data=\''</span><span class="keyword">.</span><span class="default">$data</span><span class="keyword">.</span><span class="string">'\';'</span><span class="keyword">);
<br>}
<br>
<br></span><span class="default">$xml_parser </span><span class="keyword">= </span><span class="default">xml_parser_create</span><span class="keyword">();
<br></span><span class="default">xml_set_element_handler</span><span class="keyword">(</span><span class="default">$xml_parser</span><span class="keyword">, </span><span class="string">"startElement"</span><span class="keyword">, </span><span class="string">"endElement"</span><span class="keyword">);
<br></span><span class="default">xml_set_character_data_handler</span><span class="keyword">(</span><span class="default">$xml_parser</span><span class="keyword">, </span><span class="string">"characterData"</span><span class="keyword">);
<br>if (!(</span><span class="default">$fp </span><span class="keyword">= </span><span class="default">fopen</span><span class="keyword">(</span><span class="default">$filename</span><span class="keyword">, </span><span class="string">"r"</span><span class="keyword">))) {
<br>&nbsp; &nbsp; die(</span><span class="string">"could not open XML input"</span><span class="keyword">);
<br>}
<br>
<br>while (</span><span class="default">$data </span><span class="keyword">= </span><span class="default">fread</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">, </span><span class="default">4096</span><span class="keyword">)) {
<br>&nbsp; &nbsp; if (!</span><span class="default">xml_parse</span><span class="keyword">(</span><span class="default">$xml_parser</span><span class="keyword">, </span><span class="default">$data</span><span class="keyword">, </span><span class="default">feof</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">))) {
<br>&nbsp; &nbsp; &nbsp; &nbsp; die(</span><span class="default">sprintf</span><span class="keyword">(</span><span class="string">"XML error: %s at line %d"</span><span class="keyword">,
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">xml_error_string</span><span class="keyword">(</span><span class="default">xml_get_error_code</span><span class="keyword">(</span><span class="default">$xml_parser</span><span class="keyword">)),
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">xml_get_current_line_number</span><span class="keyword">(</span><span class="default">$xml_parser</span><span class="keyword">)));
<br>&nbsp; &nbsp; }
<br>}
<br></span><span class="default">xml_parser_free</span><span class="keyword">(</span><span class="default">$xml_parser</span><span class="keyword">);
<br></span><span class="default">print_r</span><span class="keyword">(</span><span class="default">$obj</span><span class="keyword">-&gt;</span><span class="default">xml</span><span class="keyword">);
<br>return </span><span class="default">0</span><span class="keyword">;
<br>
<br></span><span class="default">?&gt;</span>
</span>
</code></div>
  </div>
 </div>
  <div class="note" id="18477">  
  <a class="name">
  <strong class="user"><em>hans dot schneider at bbdo-interone dot de</em></strong></a><div class="date" title="2002-01-24 08:43"><strong>12 years ago</strong></div>
  <div class="text" id="Hcom18477">
<div class="phpcode"><code><span class="html">
I had to TRIM the data when I passed one large String containig a wellformed XML-File to xml_parse. The String was read by CURL, which aparently put a BLANK at the end of the String. This BLANK produced a "XML not wellformed"-Error in xml_parse!</span>
</code></div>
  </div>
 </div>
  <div class="note" id="8799">  
  <a class="name">
  <strong class="user"><em>sam at cwa dot co dot nz</em></strong></a><div class="date" title="2000-09-28 07:39"><strong>13 years ago</strong></div>
  <div class="text" id="Hcom8799">
<div class="phpcode"><code><span class="html">
I've discovered some unusual behaviour in this API when ampersand entities are parsed in cdata; for some reason the parser breaks up the section around the entities, and calls the handler repeated times for each of the sections. If you don't allow for this oddity and you are trying to put the cdata into a variable, only the last part will be stored. 
<br>
<br>You can get around this with a line like:
<br>
<br>$foo .= $cdata;
<br>
<br>If the handler is called several times from the same tag, it will append them, rather than rewriting the variable each time. If the entire cdata section is returned, it doesn't matter.
<br>
<br>May happen for other entities, but I haven't investigated.
<br>
<br>Took me a while to figure out what was happening; hope this saves someone else the trouble.</span>
</code></div>
  </div>
 </div>
  <div class="note" id="1108">  
  <a class="name">
  <strong class="user"><em>Daniel dot Rendall at btinternet dot com</em></strong></a><div class="date" title="1999-07-07 10:21"><strong>15 years ago</strong></div>
  <div class="text" id="Hcom1108">
<div class="phpcode"><code><span class="html">
When using the XML parser, make sure you're not using the magic quotes option (e.g. use set_magic_quotes_runtime(0) if it's not the compiled default), otherwise you'll get 'not well-formed' errors when dealing with tags with attributes set in them.</span>
</code></div>
  </div>
 </div>
  <div class="note" id="112992">  
  <a class="name">
  <strong class="user"><em>Glen at ITIStudios dot ca</em></strong></a><div class="date" title="2013-08-15 06:42"><strong>1 year ago</strong></div>
  <div class="text" id="Hcom112992">
<div class="phpcode"><code><span class="html">
Update: concatenate element contents in function cdata()<br><span class="default">&lt;?php<br></span><span class="comment">/**<br> *&nbsp; XML to Associative Array Class<br> *<br> *&nbsp; Usage:<br> *&nbsp; &nbsp;&nbsp; $domObj = new xmlToArrayParser($xml);<br> *&nbsp; &nbsp;&nbsp; $domArr = $domObj-&gt;array;<br> *&nbsp;&nbsp; <br> *&nbsp; &nbsp;&nbsp; if($domObj-&gt;parse_error) echo $domObj-&gt;get_xml_error();<br> *&nbsp; &nbsp;&nbsp; else print_r($domArr);<br> *<br> *&nbsp; &nbsp;&nbsp; On Success:<br> *&nbsp; &nbsp;&nbsp; eg. $domArr['top']['element2']['attrib']['var2'] =&gt; val2<br> *<br> *&nbsp; &nbsp;&nbsp; On Error:<br> *&nbsp; &nbsp;&nbsp; eg. Error Code [76] "Mismatched tag", at char 58 on line 3<br> */<br><br>/**<br> * Convert an xml file or string to an associative array (including the tag attributes):<br> * $domObj = new xmlToArrayParser($xml);<br> * $elemVal = $domObj-&gt;array['element']<br> * Or:&nbsp; $domArr=$domObj-&gt;array;&nbsp; $elemVal = $domArr['element'].<br> *<br> * @version&nbsp; 3.0<br> * @param Str $xml file/string.<br> */<br></span><span class="keyword">class </span><span class="default">xmlToArrayParser </span><span class="keyword">{<br>&nbsp; </span><span class="comment">/** The array created by the parser can be assigned to any variable: $anyVarArr = $domObj-&gt;array.*/<br>&nbsp; </span><span class="keyword">public&nbsp; </span><span class="default">$array </span><span class="keyword">= array();<br>&nbsp; public&nbsp; </span><span class="default">$parse_error </span><span class="keyword">= </span><span class="default">false</span><span class="keyword">;<br>&nbsp; private </span><span class="default">$parser</span><span class="keyword">;<br>&nbsp; private </span><span class="default">$pointer</span><span class="keyword">;<br> <br>&nbsp; </span><span class="comment">/** Constructor: $domObj = new xmlToArrayParser($xml); */<br>&nbsp; </span><span class="keyword">public function </span><span class="default">__construct</span><span class="keyword">(</span><span class="default">$xml</span><span class="keyword">) {<br>&nbsp; &nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">pointer </span><span class="keyword">=&amp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">array</span><span class="keyword">;<br>&nbsp; &nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">parser </span><span class="keyword">= </span><span class="default">xml_parser_create</span><span class="keyword">(</span><span class="string">"UTF-8"</span><span class="keyword">);<br>&nbsp; &nbsp; </span><span class="default">xml_set_object</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">parser</span><span class="keyword">, </span><span class="default">$this</span><span class="keyword">);<br>&nbsp; &nbsp; </span><span class="default">xml_parser_set_option</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">parser</span><span class="keyword">, </span><span class="default">XML_OPTION_CASE_FOLDING</span><span class="keyword">, </span><span class="default">false</span><span class="keyword">);<br>&nbsp; &nbsp; </span><span class="default">xml_set_element_handler</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">parser</span><span class="keyword">, </span><span class="string">"tag_open"</span><span class="keyword">, </span><span class="string">"tag_close"</span><span class="keyword">);<br>&nbsp; &nbsp; </span><span class="default">xml_set_character_data_handler</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">parser</span><span class="keyword">, </span><span class="string">"cdata"</span><span class="keyword">);<br>&nbsp; &nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">parse_error </span><span class="keyword">= </span><span class="default">xml_parse</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">parser</span><span class="keyword">, </span><span class="default">ltrim</span><span class="keyword">(</span><span class="default">$xml</span><span class="keyword">))? </span><span class="default">false </span><span class="keyword">: </span><span class="default">true</span><span class="keyword">;<br>&nbsp; }<br> <br>&nbsp; </span><span class="comment">/** Free the parser. */<br>&nbsp; </span><span class="keyword">public function </span><span class="default">__destruct</span><span class="keyword">() { </span><span class="default">xml_parser_free</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">parser</span><span class="keyword">);}<br><br>&nbsp; </span><span class="comment">/** Get the xml error if an an error in the xml file occured during parsing. */<br>&nbsp; </span><span class="keyword">public function </span><span class="default">get_xml_error</span><span class="keyword">() {<br>&nbsp; &nbsp; if(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">parse_error</span><span class="keyword">) {<br>&nbsp; &nbsp; &nbsp; </span><span class="default">$errCode </span><span class="keyword">= </span><span class="default">xml_get_error_code </span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">parser</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; </span><span class="default">$thisError </span><span class="keyword">=&nbsp; </span><span class="string">"Error Code ["</span><span class="keyword">. </span><span class="default">$errCode </span><span class="keyword">.</span><span class="string">"] \"&lt;strong style='color:red;'&gt;" </span><span class="keyword">. </span><span class="default">xml_error_string</span><span class="keyword">(</span><span class="default">$errCode</span><span class="keyword">).</span><span class="string">"&lt;/strong&gt;\",<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; at char "</span><span class="keyword">.</span><span class="default">xml_get_current_column_number</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">parser</span><span class="keyword">) . </span><span class="string">"<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; on line "</span><span class="keyword">.</span><span class="default">xml_get_current_line_number</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">parser</span><span class="keyword">).</span><span class="string">""</span><span class="keyword">;<br>&nbsp; &nbsp; }else </span><span class="default">$thisError </span><span class="keyword">= </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">parse_error</span><span class="keyword">;<br>&nbsp; &nbsp; return </span><span class="default">$thisError</span><span class="keyword">;<br>&nbsp; }<br> <br>&nbsp; private function </span><span class="default">tag_open</span><span class="keyword">(</span><span class="default">$parser</span><span class="keyword">, </span><span class="default">$tag</span><span class="keyword">, </span><span class="default">$attributes</span><span class="keyword">) {<br>&nbsp; &nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">convert_to_array</span><span class="keyword">(</span><span class="default">$tag</span><span class="keyword">, </span><span class="string">'attrib'</span><span class="keyword">);<br>&nbsp; &nbsp; </span><span class="default">$idx</span><span class="keyword">=</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">convert_to_array</span><span class="keyword">(</span><span class="default">$tag</span><span class="keyword">, </span><span class="string">'cdata'</span><span class="keyword">);<br>&nbsp; &nbsp; if(isset(</span><span class="default">$idx</span><span class="keyword">)) {<br>&nbsp; &nbsp; &nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">pointer</span><span class="keyword">[</span><span class="default">$tag</span><span class="keyword">][</span><span class="default">$idx</span><span class="keyword">] = Array(</span><span class="string">'@idx' </span><span class="keyword">=&gt; </span><span class="default">$idx</span><span class="keyword">,</span><span class="string">'@parent' </span><span class="keyword">=&gt; &amp;</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">pointer</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">pointer </span><span class="keyword">=&amp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">pointer</span><span class="keyword">[</span><span class="default">$tag</span><span class="keyword">][</span><span class="default">$idx</span><span class="keyword">];<br>&nbsp; &nbsp; }else {<br>&nbsp; &nbsp; &nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">pointer</span><span class="keyword">[</span><span class="default">$tag</span><span class="keyword">] = Array(</span><span class="string">'@parent' </span><span class="keyword">=&gt; &amp;</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">pointer</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">pointer </span><span class="keyword">=&amp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">pointer</span><span class="keyword">[</span><span class="default">$tag</span><span class="keyword">];<br>&nbsp; &nbsp; }<br>&nbsp; &nbsp; if (!empty(</span><span class="default">$attributes</span><span class="keyword">)) { </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">pointer</span><span class="keyword">[</span><span class="string">'attrib'</span><span class="keyword">] = </span><span class="default">$attributes</span><span class="keyword">; }<br>&nbsp; }<br><br>&nbsp; </span><span class="comment">/** Adds the current elements content to the current pointer[cdata] array. */<br>&nbsp; </span><span class="keyword">private function </span><span class="default">cdata</span><span class="keyword">(</span><span class="default">$parser</span><span class="keyword">, </span><span class="default">$cdata</span><span class="keyword">){<br>&nbsp; &nbsp; if (isset(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">pointer</span><span class="keyword">[</span><span class="string">'cdata'</span><span class="keyword">])) { </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">pointer</span><span class="keyword">[</span><span class="string">'cdata'</span><span class="keyword">] .= </span><span class="default">$cdata</span><span class="keyword">;}<br>&nbsp; &nbsp; else { </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">pointer</span><span class="keyword">[</span><span class="string">'cdata'</span><span class="keyword">] = </span><span class="default">$cdata</span><span class="keyword">; }<br>&nbsp; }<br>&nbsp; <br>&nbsp; private function </span><span class="default">tag_close</span><span class="keyword">(</span><span class="default">$parser</span><span class="keyword">, </span><span class="default">$tag</span><span class="keyword">) {<br>&nbsp; &nbsp; </span><span class="default">$current </span><span class="keyword">= &amp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">pointer</span><span class="keyword">;<br>&nbsp; &nbsp; if(isset(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">pointer</span><span class="keyword">[</span><span class="string">'@idx'</span><span class="keyword">])) {unset(</span><span class="default">$current</span><span class="keyword">[</span><span class="string">'@idx'</span><span class="keyword">]);}<br>&nbsp; &nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">pointer </span><span class="keyword">= &amp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">pointer</span><span class="keyword">[</span><span class="string">'@parent'</span><span class="keyword">];<br>&nbsp; &nbsp; unset(</span><span class="default">$current</span><span class="keyword">[</span><span class="string">'@parent'</span><span class="keyword">]);<br>&nbsp; &nbsp; if(isset(</span><span class="default">$current</span><span class="keyword">[</span><span class="string">'cdata'</span><span class="keyword">]) &amp;&amp; </span><span class="default">count</span><span class="keyword">(</span><span class="default">$current</span><span class="keyword">) == </span><span class="default">1</span><span class="keyword">) { </span><span class="default">$current </span><span class="keyword">= </span><span class="default">$current</span><span class="keyword">[</span><span class="string">'cdata'</span><span class="keyword">];}<br>&nbsp; &nbsp; else if(empty(</span><span class="default">$current</span><span class="keyword">[</span><span class="string">'cdata'</span><span class="keyword">])) {unset(</span><span class="default">$current</span><span class="keyword">[</span><span class="string">'cdata'</span><span class="keyword">]);}<br>&nbsp; }<br> <br>&nbsp; </span><span class="comment">/** Converts a single element item into array(element[0]) if a second element of the same name is encountered. */<br>&nbsp; </span><span class="keyword">private function </span><span class="default">convert_to_array</span><span class="keyword">(</span><span class="default">$tag</span><span class="keyword">, </span><span class="default">$item</span><span class="keyword">) {<br>&nbsp; &nbsp; if(isset(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">pointer</span><span class="keyword">[</span><span class="default">$tag</span><span class="keyword">]) &amp;&amp; !</span><span class="default">is_array</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">pointer</span><span class="keyword">[</span><span class="default">$tag</span><span class="keyword">])){<br>&nbsp; &nbsp; &nbsp; </span><span class="default">$content </span><span class="keyword">= </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">pointer</span><span class="keyword">[</span><span class="default">$tag</span><span class="keyword">];<br>&nbsp; &nbsp; &nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">pointer</span><span class="keyword">[</span><span class="default">$tag</span><span class="keyword">] = array((</span><span class="default">0</span><span class="keyword">) =&gt; </span><span class="default">$content</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; </span><span class="default">$idx </span><span class="keyword">= </span><span class="default">1</span><span class="keyword">;<br>&nbsp; &nbsp; }else if (isset(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">pointer</span><span class="keyword">[</span><span class="default">$tag</span><span class="keyword">])) {<br>&nbsp; &nbsp; &nbsp; </span><span class="default">$idx </span><span class="keyword">= </span><span class="default">count</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">pointer</span><span class="keyword">[</span><span class="default">$tag</span><span class="keyword">]);<br>&nbsp; &nbsp; &nbsp; if(!isset(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">pointer</span><span class="keyword">[</span><span class="default">$tag</span><span class="keyword">][</span><span class="default">0</span><span class="keyword">])) {<br>&nbsp; &nbsp; &nbsp; &nbsp; foreach (</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">pointer</span><span class="keyword">[</span><span class="default">$tag</span><span class="keyword">] as </span><span class="default">$key </span><span class="keyword">=&gt; </span><span class="default">$value</span><span class="keyword">) {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; unset(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">pointer</span><span class="keyword">[</span><span class="default">$tag</span><span class="keyword">][</span><span class="default">$key</span><span class="keyword">]);<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">pointer</span><span class="keyword">[</span><span class="default">$tag</span><span class="keyword">][</span><span class="default">0</span><span class="keyword">][</span><span class="default">$key</span><span class="keyword">] = </span><span class="default">$value</span><span class="keyword">;<br>&nbsp; &nbsp; }}}else </span><span class="default">$idx </span><span class="keyword">= </span><span class="default">null</span><span class="keyword">;<br>&nbsp; &nbsp; return </span><span class="default">$idx</span><span class="keyword">;<br>&nbsp; }<br>}<br></span><span class="default">?&gt;</span>
</span>
</code></div>
  </div>
 </div>
  <div class="note" id="84758">  
  <a class="name">
  <strong class="user"><em>wolfon.AT-DoG.inbox.ru</em></strong></a><div class="date" title="2008-07-28 03:09"><strong>6 years ago</strong></div>
  <div class="text" id="Hcom84758">
<div class="phpcode"><code><span class="html">
Finally a simple xml =&gt; array class.<br>Functioning like SimpleXML library.<br><br><span class="default">&lt;?php<br></span><span class="keyword">class </span><span class="default">xml&nbsp; </span><span class="keyword">{<br>&nbsp; &nbsp; private </span><span class="default">$parser</span><span class="keyword">;<br>&nbsp; &nbsp; private </span><span class="default">$pointer</span><span class="keyword">;<br>&nbsp; &nbsp; public </span><span class="default">$dom</span><span class="keyword">;<br>&nbsp; &nbsp; <br>&nbsp; &nbsp; public function </span><span class="default">__construct</span><span class="keyword">(</span><span class="default">$data</span><span class="keyword">) {<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">pointer </span><span class="keyword">=&amp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">dom</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">parser </span><span class="keyword">= </span><span class="default">xml_parser_create</span><span class="keyword">();<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">xml_set_object</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">parser</span><span class="keyword">, </span><span class="default">$this</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">xml_parser_set_option</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">parser</span><span class="keyword">, </span><span class="default">XML_OPTION_CASE_FOLDING</span><span class="keyword">, </span><span class="default">false</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">xml_set_element_handler</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">parser</span><span class="keyword">, </span><span class="string">"tag_open"</span><span class="keyword">, </span><span class="string">"tag_close"</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">xml_set_character_data_handler</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">parser</span><span class="keyword">, </span><span class="string">"cdata"</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">xml_parse</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">parser</span><span class="keyword">, </span><span class="default">$data</span><span class="keyword">);<br>&nbsp; &nbsp; }<br>&nbsp;&nbsp; <br>&nbsp; &nbsp; private function </span><span class="default">tag_open</span><span class="keyword">(</span><span class="default">$parser</span><span class="keyword">, </span><span class="default">$tag</span><span class="keyword">, </span><span class="default">$attributes</span><span class="keyword">) {<br>&nbsp; &nbsp; &nbsp; &nbsp; if (isset(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">pointer</span><span class="keyword">[</span><span class="default">$tag</span><span class="keyword">][</span><span class="string">'@attributes'</span><span class="keyword">])) {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$content </span><span class="keyword">= </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">pointer</span><span class="keyword">[</span><span class="default">$tag</span><span class="keyword">];<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">pointer</span><span class="keyword">[</span><span class="default">$tag</span><span class="keyword">] = array(</span><span class="default">0 </span><span class="keyword">=&gt; </span><span class="default">$content</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$idx </span><span class="keyword">= </span><span class="default">1</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; } else if (isset(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">pointer</span><span class="keyword">[</span><span class="default">$tag</span><span class="keyword">]))<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$idx </span><span class="keyword">= </span><span class="default">count</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">pointer</span><span class="keyword">[</span><span class="default">$tag</span><span class="keyword">]);<br><br>&nbsp; &nbsp; &nbsp; &nbsp; if (isset(</span><span class="default">$idx</span><span class="keyword">)) {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">pointer</span><span class="keyword">[</span><span class="default">$tag</span><span class="keyword">][</span><span class="default">$idx</span><span class="keyword">] = Array(<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="string">'@idx' </span><span class="keyword">=&gt; </span><span class="default">$idx</span><span class="keyword">,<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="string">'@parent' </span><span class="keyword">=&gt; &amp;</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">pointer</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">pointer </span><span class="keyword">=&amp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">pointer</span><span class="keyword">[</span><span class="default">$tag</span><span class="keyword">][</span><span class="default">$idx</span><span class="keyword">];<br>&nbsp; &nbsp; &nbsp; &nbsp; } else {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">pointer</span><span class="keyword">[</span><span class="default">$tag</span><span class="keyword">] = Array(<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="string">'@parent' </span><span class="keyword">=&gt; &amp;</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">pointer</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">pointer </span><span class="keyword">=&amp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">pointer</span><span class="keyword">[</span><span class="default">$tag</span><span class="keyword">];<br>&nbsp; &nbsp; &nbsp; &nbsp; }<br>&nbsp; &nbsp; &nbsp; &nbsp; if (!empty(</span><span class="default">$attributes</span><span class="keyword">))<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">pointer</span><span class="keyword">[</span><span class="string">'@attributes'</span><span class="keyword">] = </span><span class="default">$attributes</span><span class="keyword">;<br>&nbsp; &nbsp; }<br><br>&nbsp; &nbsp; private function </span><span class="default">cdata</span><span class="keyword">(</span><span class="default">$parser</span><span class="keyword">, </span><span class="default">$cdata</span><span class="keyword">) {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">pointer</span><span class="keyword">[</span><span class="string">'@data'</span><span class="keyword">] = </span><span class="default">$cdata</span><span class="keyword">;<br>&nbsp; &nbsp; }<br><br>&nbsp; &nbsp; private function </span><span class="default">tag_close</span><span class="keyword">(</span><span class="default">$parser</span><span class="keyword">, </span><span class="default">$tag</span><span class="keyword">) {<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$current </span><span class="keyword">= &amp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">pointer</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; if (isset(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">pointer</span><span class="keyword">[</span><span class="string">'@idx'</span><span class="keyword">]))<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; unset(</span><span class="default">$current</span><span class="keyword">[</span><span class="string">'@idx'</span><span class="keyword">]);<br>&nbsp; &nbsp; &nbsp; &nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">pointer </span><span class="keyword">= &amp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">pointer</span><span class="keyword">[</span><span class="string">'@parent'</span><span class="keyword">];<br>&nbsp; &nbsp; &nbsp; &nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; unset(</span><span class="default">$current</span><span class="keyword">[</span><span class="string">'@parent'</span><span class="keyword">]);<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if (isset(</span><span class="default">$current</span><span class="keyword">[</span><span class="string">'@data'</span><span class="keyword">]) &amp;&amp; </span><span class="default">count</span><span class="keyword">(</span><span class="default">$current</span><span class="keyword">) == </span><span class="default">1</span><span class="keyword">)<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$current </span><span class="keyword">= </span><span class="default">$current</span><span class="keyword">[</span><span class="string">'@data'</span><span class="keyword">];<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; else if (empty(</span><span class="default">$current</span><span class="keyword">[</span><span class="string">'@data'</span><span class="keyword">])||</span><span class="default">$current</span><span class="keyword">[</span><span class="string">'@data'</span><span class="keyword">]==</span><span class="default">0</span><span class="keyword">)<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; unset(</span><span class="default">$current</span><span class="keyword">[</span><span class="string">'@data'</span><span class="keyword">]);<br>&nbsp; &nbsp; }<br>}<br></span><span class="default">?&gt;<br></span><br>maybe I'll do some explanations on habr</span>
</code></div>
  </div>
 </div>
  <div class="note" id="79043">  
  <a class="name">
  <strong class="user"><em>geoff at spacevs dot com</em></strong></a><div class="date" title="2007-11-07 09:13"><strong>6 years ago</strong></div>
  <div class="text" id="Hcom79043">
<div class="phpcode"><code><span class="html">
Reading xml into a class:<br><br><span class="default">&lt;?PHP<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="keyword">class </span><span class="default">XmlData </span><span class="keyword">{}<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$elements </span><span class="keyword">= array();<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$elements</span><span class="keyword">[] =&amp; new </span><span class="default">XmlData</span><span class="keyword">();<br>&nbsp; &nbsp; &nbsp; &nbsp; function </span><span class="default">startElement</span><span class="keyword">(</span><span class="default">$parser</span><span class="keyword">, </span><span class="default">$name</span><span class="keyword">, </span><span class="default">$attrs</span><span class="keyword">) {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; global </span><span class="default">$elements</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$element </span><span class="keyword">=&amp; new </span><span class="default">XMLData</span><span class="keyword">();<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$elements</span><span class="keyword">[</span><span class="default">count</span><span class="keyword">(</span><span class="default">$elements</span><span class="keyword">)-</span><span class="default">1</span><span class="keyword">]-&gt;</span><span class="default">$name </span><span class="keyword">=&amp; </span><span class="default">$element</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$elements</span><span class="keyword">[] =&amp; </span><span class="default">$element</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; }<br>&nbsp; &nbsp; &nbsp; &nbsp; function </span><span class="default">endElement</span><span class="keyword">(</span><span class="default">$parser</span><span class="keyword">, </span><span class="default">$name</span><span class="keyword">) {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; global </span><span class="default">$elements</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">array_pop</span><span class="keyword">(</span><span class="default">$elements</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; }<br>&nbsp; &nbsp; &nbsp; &nbsp; function </span><span class="default">characterData</span><span class="keyword">(</span><span class="default">$parser</span><span class="keyword">, </span><span class="default">$data</span><span class="keyword">) {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; global </span><span class="default">$elements</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$elements</span><span class="keyword">[</span><span class="default">count</span><span class="keyword">(</span><span class="default">$elements</span><span class="keyword">)-</span><span class="default">1</span><span class="keyword">]-&gt;</span><span class="default">data </span><span class="keyword">= </span><span class="default">$data</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; }<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$xml_parser&nbsp; &nbsp;&nbsp; </span><span class="keyword">= </span><span class="default">xml_parser_create</span><span class="keyword">();<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">xml_set_element_handler</span><span class="keyword">(</span><span class="default">$xml_parser</span><span class="keyword">, </span><span class="string">"startElement"</span><span class="keyword">, </span><span class="string">"endElement"</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">xml_set_character_data_handler</span><span class="keyword">(</span><span class="default">$xml_parser</span><span class="keyword">, </span><span class="string">"characterData"</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">xml_parse</span><span class="keyword">(</span><span class="default">$xml_parser</span><span class="keyword">, </span><span class="default">$xml</span><span class="keyword">, </span><span class="default">true</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">xml_parser_free</span><span class="keyword">(</span><span class="default">$xml_parser</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$request </span><span class="keyword">=&amp; </span><span class="default">array_pop</span><span class="keyword">(</span><span class="default">$elements</span><span class="keyword">);<br><br>&nbsp; &nbsp; &nbsp; &nbsp; echo </span><span class="default">$request</span><span class="keyword">-&gt;</span><span class="default">LOGIN</span><span class="keyword">-&gt;</span><span class="default">USER</span><span class="keyword">-&gt;</span><span class="default">data</span><span class="keyword">;<br></span><span class="default">?&gt;</span>
</span>
</code></div>
  </div>
 </div>
  <div class="note" id="76417">  
  <a class="name">
  <strong class="user"><em>v9 at fakehalo dot us</em></strong></a><div class="date" title="2007-07-13 08:04"><strong>7 years ago</strong></div>
  <div class="text" id="Hcom76417">
<div class="phpcode"><code><span class="html">
I needed this for work/personal use.&nbsp; Sometimes you'll have a XML string generated as one long string and no line breaks...nusoap in the case of today/work, but there are any other number of possible things that will generate these.&nbsp; Anyways, this simply takes a long XML string and returns an indented/line-breaked version of the string for display/readability.
<br>
<br><span class="default">&lt;?php
<br></span><span class="keyword">function </span><span class="default">xmlIndent</span><span class="keyword">(</span><span class="default">$str</span><span class="keyword">){
<br>&nbsp; &nbsp; </span><span class="default">$ret </span><span class="keyword">= </span><span class="string">""</span><span class="keyword">;
<br>&nbsp; &nbsp; </span><span class="default">$indent </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">;
<br>&nbsp; &nbsp; </span><span class="default">$indentInc </span><span class="keyword">= </span><span class="default">3</span><span class="keyword">;
<br>&nbsp; &nbsp; </span><span class="default">$noIndent </span><span class="keyword">= </span><span class="default">false</span><span class="keyword">;
<br>&nbsp; &nbsp; while((</span><span class="default">$l </span><span class="keyword">= </span><span class="default">strpos</span><span class="keyword">(</span><span class="default">$str</span><span class="keyword">,</span><span class="string">"&lt;"</span><span class="keyword">,</span><span class="default">$i</span><span class="keyword">))!==</span><span class="default">false</span><span class="keyword">){
<br>&nbsp; &nbsp; &nbsp; &nbsp; if(</span><span class="default">$l</span><span class="keyword">!=</span><span class="default">$r </span><span class="keyword">&amp;&amp; </span><span class="default">$indent</span><span class="keyword">&gt;</span><span class="default">0</span><span class="keyword">){ </span><span class="default">$ret </span><span class="keyword">.= </span><span class="string">"\n" </span><span class="keyword">. </span><span class="default">str_repeat</span><span class="keyword">(</span><span class="string">" "</span><span class="keyword">,</span><span class="default">$indent</span><span class="keyword">) . </span><span class="default">substr</span><span class="keyword">(</span><span class="default">$str</span><span class="keyword">,</span><span class="default">$r</span><span class="keyword">,(</span><span class="default">$l</span><span class="keyword">-</span><span class="default">$r</span><span class="keyword">)); }
<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$i </span><span class="keyword">= </span><span class="default">$l</span><span class="keyword">+</span><span class="default">1</span><span class="keyword">;
<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$r </span><span class="keyword">= </span><span class="default">strpos</span><span class="keyword">(</span><span class="default">$str</span><span class="keyword">,</span><span class="string">"&gt;"</span><span class="keyword">,</span><span class="default">$i</span><span class="keyword">)+</span><span class="default">1</span><span class="keyword">;
<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$t </span><span class="keyword">= </span><span class="default">substr</span><span class="keyword">(</span><span class="default">$str</span><span class="keyword">,</span><span class="default">$l</span><span class="keyword">,(</span><span class="default">$r</span><span class="keyword">-</span><span class="default">$l</span><span class="keyword">));
<br>&nbsp; &nbsp; &nbsp; &nbsp; if(</span><span class="default">strpos</span><span class="keyword">(</span><span class="default">$t</span><span class="keyword">,</span><span class="string">"/"</span><span class="keyword">)==</span><span class="default">1</span><span class="keyword">){
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$indent </span><span class="keyword">-= </span><span class="default">$indentInc</span><span class="keyword">;
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$noIndent </span><span class="keyword">= </span><span class="default">true</span><span class="keyword">;
<br>&nbsp; &nbsp; &nbsp; &nbsp; }
<br>&nbsp; &nbsp; &nbsp; &nbsp; else if((</span><span class="default">$r</span><span class="keyword">-</span><span class="default">$l</span><span class="keyword">-</span><span class="default">strpos</span><span class="keyword">(</span><span class="default">$t</span><span class="keyword">,</span><span class="string">"/"</span><span class="keyword">))==</span><span class="default">2 </span><span class="keyword">|| </span><span class="default">substr</span><span class="keyword">(</span><span class="default">$t</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">,</span><span class="default">2</span><span class="keyword">)==</span><span class="string">"&lt;?"</span><span class="keyword">){ </span><span class="default">$noIndent </span><span class="keyword">= </span><span class="default">true</span><span class="keyword">; }
<br>&nbsp; &nbsp; &nbsp; &nbsp; if(</span><span class="default">$indent</span><span class="keyword">&lt;</span><span class="default">0</span><span class="keyword">){ </span><span class="default">$indent </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">; }
<br>&nbsp; &nbsp; &nbsp; &nbsp; if(</span><span class="default">$ret</span><span class="keyword">){ </span><span class="default">$ret </span><span class="keyword">.= </span><span class="string">"\n"</span><span class="keyword">; }
<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$ret </span><span class="keyword">.= </span><span class="default">str_repeat</span><span class="keyword">(</span><span class="string">" "</span><span class="keyword">,</span><span class="default">$indent</span><span class="keyword">);
<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$ret </span><span class="keyword">.= </span><span class="default">$t</span><span class="keyword">;
<br>&nbsp; &nbsp; &nbsp; &nbsp; if(!</span><span class="default">$noIndent</span><span class="keyword">){ </span><span class="default">$indent </span><span class="keyword">+= </span><span class="default">$indentInc</span><span class="keyword">; }
<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$noIndent </span><span class="keyword">= </span><span class="default">false</span><span class="keyword">;
<br>&nbsp; &nbsp; }
<br>&nbsp; &nbsp; </span><span class="default">$ret </span><span class="keyword">.= </span><span class="string">"\n"</span><span class="keyword">;
<br>&nbsp; &nbsp; return(</span><span class="default">$ret</span><span class="keyword">);
<br>}
<br></span><span class="default">?&gt;
<br></span>
<br>(...this was only tested for what i needed at work, could POSSIBLY need additions)</span>
</code></div>
  </div>
 </div>
  <div class="note" id="71941">  
  <a class="name">
  <strong class="user"><em>Didier: dlvb ** free * fr</em></strong></a><div class="date" title="2006-12-24 09:53"><strong>7 years ago</strong></div>
  <div class="text" id="Hcom71941">
<div class="phpcode"><code><span class="html">
Hi !
<br>
<br>After parsing the XML and modifying it, I just add a method to rebuild the XML form the internal structure (xmlp-&gt;document). 
<br>The method xmlp-&gt;toXML writes into xmlp-&gt;XML attributes. Then, you just have to output it.
<br>I hope it helps.
<br>
<br><span class="default">&lt;?php
<br></span><span class="keyword">class </span><span class="default">XMLParser </span><span class="keyword">{
<br>
<br>var </span><span class="default">$parser</span><span class="keyword">;
<br>var </span><span class="default">$filePath</span><span class="keyword">;
<br>var </span><span class="default">$document</span><span class="keyword">;
<br>var </span><span class="default">$currTag</span><span class="keyword">;
<br>var </span><span class="default">$tagStack</span><span class="keyword">;
<br>var </span><span class="default">$XML</span><span class="keyword">;
<br>var </span><span class="default">$_tag_to_close </span><span class="keyword">= </span><span class="default">false</span><span class="keyword">;
<br>var </span><span class="default">$TAG_ATTRIBUT </span><span class="keyword">= </span><span class="string">'attr'</span><span class="keyword">;
<br>var </span><span class="default">$TAG_DATA </span><span class="keyword">= </span><span class="string">'data'</span><span class="keyword">;
<br>
<br>function </span><span class="default">XMLParser</span><span class="keyword">(</span><span class="default">$path</span><span class="keyword">) {
<br>&nbsp; &nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">parser </span><span class="keyword">= </span><span class="default">xml_parser_create</span><span class="keyword">();
<br>&nbsp; &nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">filePath </span><span class="keyword">= </span><span class="default">$path</span><span class="keyword">;
<br>&nbsp; &nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">document </span><span class="keyword">= array();
<br>&nbsp; &nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">currTag </span><span class="keyword">=&amp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">document</span><span class="keyword">;
<br>&nbsp; &nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">tagStack </span><span class="keyword">= array();
<br>&nbsp; &nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">XML </span><span class="keyword">= </span><span class="string">""</span><span class="keyword">;
<br>}
<br>
<br>function </span><span class="default">parse</span><span class="keyword">() {
<br>&nbsp; &nbsp; </span><span class="default">xml_set_object</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">parser</span><span class="keyword">, </span><span class="default">$this</span><span class="keyword">);
<br>&nbsp; &nbsp; </span><span class="default">xml_set_character_data_handler</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">parser</span><span class="keyword">, </span><span class="string">'dataHandler'</span><span class="keyword">);
<br>&nbsp; &nbsp; </span><span class="default">xml_set_element_handler</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">parser</span><span class="keyword">, </span><span class="string">'startHandler'</span><span class="keyword">, </span><span class="string">'endHandler'</span><span class="keyword">);
<br>
<br>&nbsp;&nbsp; if(!(</span><span class="default">$fp </span><span class="keyword">= </span><span class="default">fopen</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">filePath</span><span class="keyword">, </span><span class="string">"r"</span><span class="keyword">))) {
<br>&nbsp; &nbsp; &nbsp;&nbsp; die(</span><span class="string">"Cannot open XML data file: </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">filePath</span><span class="string">"</span><span class="keyword">);
<br>&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">false</span><span class="keyword">;
<br>&nbsp; &nbsp;&nbsp; }
<br>
<br>&nbsp; &nbsp; while(</span><span class="default">$data </span><span class="keyword">= </span><span class="default">fread</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">, </span><span class="default">4096</span><span class="keyword">)) {
<br>&nbsp; &nbsp; &nbsp; &nbsp; if(!</span><span class="default">xml_parse</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">parser</span><span class="keyword">, </span><span class="default">$data</span><span class="keyword">, </span><span class="default">feof</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">))) {
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; die(</span><span class="default">sprintf</span><span class="keyword">(</span><span class="string">"XML error: %s at line %d"</span><span class="keyword">,
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">xml_error_string</span><span class="keyword">(</span><span class="default">xml_get_error_code</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">parser</span><span class="keyword">)),
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">xml_get_current_line_number</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">parser</span><span class="keyword">)));
<br>&nbsp; &nbsp; &nbsp; }
<br>&nbsp; &nbsp; }
<br>
<br>&nbsp; &nbsp; </span><span class="default">fclose</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">);
<br>&nbsp; &nbsp; </span><span class="default">xml_parser_free</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">parser</span><span class="keyword">);
<br>
<br>&nbsp; &nbsp; return </span><span class="default">true</span><span class="keyword">;
<br>}
<br>
<br>function </span><span class="default">startHandler</span><span class="keyword">(</span><span class="default">$parser</span><span class="keyword">, </span><span class="default">$name</span><span class="keyword">, </span><span class="default">$attribs</span><span class="keyword">) {
<br>&nbsp; &nbsp;&nbsp; if(!isset(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">currTag</span><span class="keyword">[</span><span class="default">$name</span><span class="keyword">]))
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">currTag</span><span class="keyword">[</span><span class="default">$name</span><span class="keyword">] = array();
<br>
<br>&nbsp; &nbsp;&nbsp; </span><span class="default">$newTag </span><span class="keyword">= array();
<br>&nbsp; &nbsp;&nbsp; if(!empty(</span><span class="default">$attribs</span><span class="keyword">))
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$newTag</span><span class="keyword">[</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">TAG_ATTRIBUT</span><span class="keyword">] = </span><span class="default">$attribs</span><span class="keyword">;
<br>&nbsp; &nbsp;&nbsp; </span><span class="default">array_push</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">currTag</span><span class="keyword">[</span><span class="default">$name</span><span class="keyword">], </span><span class="default">$newTag</span><span class="keyword">);
<br>
<br>&nbsp; &nbsp;&nbsp; </span><span class="default">$t </span><span class="keyword">=&amp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">currTag</span><span class="keyword">[</span><span class="default">$name</span><span class="keyword">];
<br>&nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">currTag </span><span class="keyword">=&amp; </span><span class="default">$t</span><span class="keyword">[</span><span class="default">count</span><span class="keyword">(</span><span class="default">$t</span><span class="keyword">)-</span><span class="default">1</span><span class="keyword">];
<br>&nbsp; &nbsp;&nbsp; </span><span class="default">array_push</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">tagStack</span><span class="keyword">, </span><span class="default">$name</span><span class="keyword">);
<br>}
<br>
<br>function </span><span class="default">dataHandler</span><span class="keyword">(</span><span class="default">$parser</span><span class="keyword">, </span><span class="default">$data</span><span class="keyword">) {
<br>&nbsp; &nbsp; </span><span class="default">$data </span><span class="keyword">= </span><span class="default">trim</span><span class="keyword">(</span><span class="default">$data</span><span class="keyword">);
<br>
<br>&nbsp; &nbsp; if(!empty(</span><span class="default">$data</span><span class="keyword">)) {
<br>&nbsp; &nbsp; &nbsp; if(isset(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">currTag</span><span class="keyword">[</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">TAG_DATA</span><span class="keyword">]))
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">currTag</span><span class="keyword">[</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">TAG_DATA</span><span class="keyword">] .= </span><span class="default">$data</span><span class="keyword">;
<br>&nbsp; &nbsp; &nbsp; else
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">currTag</span><span class="keyword">[</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">TAG_DATA</span><span class="keyword">] = </span><span class="default">$data</span><span class="keyword">;
<br>&nbsp; &nbsp; }
<br>}
<br>
<br>function </span><span class="default">endHandler</span><span class="keyword">(</span><span class="default">$parser</span><span class="keyword">, </span><span class="default">$name</span><span class="keyword">) {
<br>&nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">currTag </span><span class="keyword">=&amp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">document</span><span class="keyword">;
<br>&nbsp; &nbsp;&nbsp; </span><span class="default">array_pop</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">tagStack</span><span class="keyword">);
<br>
<br>&nbsp; &nbsp;&nbsp; for(</span><span class="default">$i </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">; </span><span class="default">$i </span><span class="keyword">&lt; </span><span class="default">count</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">tagStack</span><span class="keyword">); </span><span class="default">$i</span><span class="keyword">++) {
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$t </span><span class="keyword">=&amp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">currTag</span><span class="keyword">[</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">tagStack</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">]];
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">currTag </span><span class="keyword">=&amp; </span><span class="default">$t</span><span class="keyword">[</span><span class="default">count</span><span class="keyword">(</span><span class="default">$t</span><span class="keyword">)-</span><span class="default">1</span><span class="keyword">];
<br>&nbsp; &nbsp;&nbsp; }
<br>}
<br>
<br>function </span><span class="default">clearOutput </span><span class="keyword">() {
<br>&nbsp; &nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">XML </span><span class="keyword">= </span><span class="string">""</span><span class="keyword">;
<br>}
<br>
<br>function </span><span class="default">openTag </span><span class="keyword">(</span><span class="default">$tag</span><span class="keyword">) {
<br>&nbsp; &nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">XML</span><span class="keyword">.=</span><span class="string">"&lt;"</span><span class="keyword">.</span><span class="default">strtolower </span><span class="keyword">(</span><span class="default">$tag</span><span class="keyword">);
<br>&nbsp; &nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">_tag_to_close </span><span class="keyword">= </span><span class="default">true</span><span class="keyword">;
<br>}
<br>
<br>function </span><span class="default">closeTag </span><span class="keyword">() {
<br>&nbsp; &nbsp; if (</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">_tag_to_close</span><span class="keyword">) {
<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">XML</span><span class="keyword">.=</span><span class="string">"&gt;"</span><span class="keyword">;
<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">_tag_to_close </span><span class="keyword">= </span><span class="default">false</span><span class="keyword">;
<br>&nbsp; &nbsp; }
<br>}
<br>
<br>function </span><span class="default">closingTag </span><span class="keyword">(</span><span class="default">$tag</span><span class="keyword">) {
<br>&nbsp; &nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">XML</span><span class="keyword">.=</span><span class="string">"&lt;/"</span><span class="keyword">.</span><span class="default">strtolower </span><span class="keyword">(</span><span class="default">$tag</span><span class="keyword">).</span><span class="string">"&gt;"</span><span class="keyword">;
<br>}
<br>
<br>function </span><span class="default">output_attributes </span><span class="keyword">(</span><span class="default">$contenu_fils</span><span class="keyword">) {
<br>&nbsp; &nbsp; foreach (</span><span class="default">$contenu_fils</span><span class="keyword">[</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">TAG_ATTRIBUT</span><span class="keyword">] as </span><span class="default">$nomAttribut </span><span class="keyword">=&gt; </span><span class="default">$valeur</span><span class="keyword">) {
<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">XML</span><span class="keyword">.= </span><span class="string">" "</span><span class="keyword">.</span><span class="default">strtolower</span><span class="keyword">(</span><span class="default">$nomAttribut</span><span class="keyword">).</span><span class="string">"=\""</span><span class="keyword">.</span><span class="default">$valeur</span><span class="keyword">.</span><span class="string">"\""</span><span class="keyword">;
<br>&nbsp; &nbsp; }
<br>}
<br>
<br>function </span><span class="default">addData </span><span class="keyword">(</span><span class="default">$texte</span><span class="keyword">) {
<br></span><span class="comment">// to be completed
<br>&nbsp; &nbsp; </span><span class="default">$ca&nbsp; </span><span class="keyword">= array (</span><span class="string">"é"</span><span class="keyword">, </span><span class="string">"è"</span><span class="keyword">, </span><span class="string">"ê"</span><span class="keyword">, </span><span class="string">"à"</span><span class="keyword">);
<br>&nbsp; &nbsp; </span><span class="default">$par </span><span class="keyword">= array (</span><span class="string">"&amp;eacute;"</span><span class="keyword">, </span><span class="string">"&amp;egrave;"</span><span class="keyword">, </span><span class="string">"&amp;ecirc;"</span><span class="keyword">, </span><span class="string">"agrave;"</span><span class="keyword">);
<br>&nbsp; &nbsp; return </span><span class="default">htmlspecialchars</span><span class="keyword">(</span><span class="default">str_replace </span><span class="keyword">(</span><span class="default">$ca</span><span class="keyword">, </span><span class="default">$par</span><span class="keyword">, </span><span class="default">$texte</span><span class="keyword">), </span><span class="default">ENT_NOQUOTES</span><span class="keyword">);
<br>}
<br>
<br>function </span><span class="default">toXML </span><span class="keyword">(</span><span class="default">$tags</span><span class="keyword">=</span><span class="string">""</span><span class="keyword">) {
<br>&nbsp; &nbsp; if (</span><span class="default">$tags</span><span class="keyword">==</span><span class="string">""</span><span class="keyword">) {
<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$tags </span><span class="keyword">= </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">document</span><span class="keyword">;
<br>&nbsp; &nbsp; &nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">clearOutput </span><span class="keyword">();
<br>&nbsp; &nbsp; }
<br>
<br>&nbsp; &nbsp; foreach (</span><span class="default">$tags </span><span class="keyword">as </span><span class="default">$tag </span><span class="keyword">=&gt; </span><span class="default">$contenu</span><span class="keyword">) {
<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">process </span><span class="keyword">(</span><span class="default">$tag</span><span class="keyword">, </span><span class="default">$contenu</span><span class="keyword">);
<br>&nbsp; &nbsp; }
<br>} 
<br>
<br>function </span><span class="default">process </span><span class="keyword">(</span><span class="default">$tag</span><span class="keyword">, </span><span class="default">$contenu</span><span class="keyword">) {
<br>&nbsp; &nbsp;&nbsp; </span><span class="comment">// Pour tous les TAGs
<br>&nbsp; &nbsp; </span><span class="keyword">foreach (</span><span class="default">$contenu </span><span class="keyword">as </span><span class="default">$indice </span><span class="keyword">=&gt; </span><span class="default">$contenu_fils</span><span class="keyword">) {
<br>&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">openTag </span><span class="keyword">(</span><span class="default">$tag</span><span class="keyword">);
<br>
<br>&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// Pour tous les fils (non attribut et non data)
<br>&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">foreach (</span><span class="default">$contenu_fils </span><span class="keyword">as </span><span class="default">$tagFils </span><span class="keyword">=&gt; </span><span class="default">$fils</span><span class="keyword">) {
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; switch (</span><span class="default">$tagFils</span><span class="keyword">) {
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; case </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">TAG_ATTRIBUT</span><span class="keyword">:
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">output_attributes </span><span class="keyword">(</span><span class="default">$contenu_fils</span><span class="keyword">);
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">closeTag </span><span class="keyword">();
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; break;
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; case </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">TAG_DATA</span><span class="keyword">:
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">closeTag </span><span class="keyword">();
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">XML</span><span class="keyword">.= </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">addData </span><span class="keyword">(</span><span class="default">$contenu_fils </span><span class="keyword">[</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">TAG_DATA</span><span class="keyword">]);
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; break;
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; default: 
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">closeTag </span><span class="keyword">();
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">process </span><span class="keyword">(</span><span class="default">$tagFils</span><span class="keyword">, </span><span class="default">$fils</span><span class="keyword">);
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; break;
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }
<br>&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; } 
<br>
<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">closingTag </span><span class="keyword">(</span><span class="default">$tag</span><span class="keyword">);
<br>&nbsp; &nbsp; }
<br>}
<br>
<br>}
<br></span><span class="default">?&gt;</span>
</span>
</code></div>
  </div>
 </div>
  <div class="note" id="61231">  
  <a class="name">
  <strong class="user"><em>forquan</em></strong></a><div class="date" title="2006-01-28 03:45"><strong>8 years ago</strong></div>
  <div class="text" id="Hcom61231">
<div class="phpcode"><code><span class="html">
Here's code that will create an associative array from an xml file.&nbsp; Keys are the tag data and subarrays are formed from attributes and child tags<br><br><span class="default">&lt;?php<br>$p </span><span class="keyword">=&amp; new </span><span class="default">xmlParser</span><span class="keyword">();<br></span><span class="default">$p</span><span class="keyword">-&gt;</span><span class="default">parse</span><span class="keyword">(</span><span class="string">'/*xml file*/'</span><span class="keyword">);<br></span><span class="default">print_r</span><span class="keyword">(</span><span class="default">$p</span><span class="keyword">-&gt;</span><span class="default">output</span><span class="keyword">);<br></span><span class="default">?&gt;<br></span><br><span class="default">&lt;?php<br></span><span class="keyword">class </span><span class="default">xmlParser</span><span class="keyword">{<br>&nbsp;&nbsp; var </span><span class="default">$xml_obj </span><span class="keyword">= </span><span class="default">null</span><span class="keyword">;<br>&nbsp;&nbsp; var </span><span class="default">$output </span><span class="keyword">= array();<br>&nbsp;&nbsp; var </span><span class="default">$attrs</span><span class="keyword">;<br><br>&nbsp;&nbsp; function </span><span class="default">xmlParser</span><span class="keyword">(){<br>&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">xml_obj </span><span class="keyword">= </span><span class="default">xml_parser_create</span><span class="keyword">();<br>&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">xml_set_object</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">xml_obj</span><span class="keyword">,</span><span class="default">$this</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">xml_set_character_data_handler</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">xml_obj</span><span class="keyword">, </span><span class="string">'dataHandler'</span><span class="keyword">); <br>&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">xml_set_element_handler</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">xml_obj</span><span class="keyword">, </span><span class="string">"startHandler"</span><span class="keyword">, </span><span class="string">"endHandler"</span><span class="keyword">);<br>&nbsp;&nbsp; }<br><br>&nbsp;&nbsp; function </span><span class="default">parse</span><span class="keyword">(</span><span class="default">$path</span><span class="keyword">){<br>&nbsp; &nbsp; &nbsp;&nbsp; if (!(</span><span class="default">$fp </span><span class="keyword">= </span><span class="default">fopen</span><span class="keyword">(</span><span class="default">$path</span><span class="keyword">, </span><span class="string">"r"</span><span class="keyword">))) {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; die(</span><span class="string">"Cannot open XML data file: </span><span class="default">$path</span><span class="string">"</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">false</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp;&nbsp; }<br><br>&nbsp; &nbsp; &nbsp;&nbsp; while (</span><span class="default">$data </span><span class="keyword">= </span><span class="default">fread</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">, </span><span class="default">4096</span><span class="keyword">)) {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if (!</span><span class="default">xml_parse</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">xml_obj</span><span class="keyword">, </span><span class="default">$data</span><span class="keyword">, </span><span class="default">feof</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">))) {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; die(</span><span class="default">sprintf</span><span class="keyword">(</span><span class="string">"XML error: %s at line %d"</span><span class="keyword">,<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">xml_error_string</span><span class="keyword">(</span><span class="default">xml_get_error_code</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">xml_obj</span><span class="keyword">)),<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">xml_get_current_line_number</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">xml_obj</span><span class="keyword">)));<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">xml_parser_free</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">xml_obj</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br>&nbsp; &nbsp; &nbsp;&nbsp; }<br><br>&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">true</span><span class="keyword">;<br>&nbsp;&nbsp; }<br><br>&nbsp;&nbsp; function </span><span class="default">startHandler</span><span class="keyword">(</span><span class="default">$parser</span><span class="keyword">, </span><span class="default">$name</span><span class="keyword">, </span><span class="default">$attribs</span><span class="keyword">){<br>&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$_content </span><span class="keyword">= array();<br>&nbsp; &nbsp; &nbsp;&nbsp; if(!empty(</span><span class="default">$attribs</span><span class="keyword">))<br>&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$_content</span><span class="keyword">[</span><span class="string">'attrs'</span><span class="keyword">] = </span><span class="default">$attribs</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">array_push</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">output</span><span class="keyword">, </span><span class="default">$_content</span><span class="keyword">);<br>&nbsp;&nbsp; }<br><br>&nbsp;&nbsp; function </span><span class="default">dataHandler</span><span class="keyword">(</span><span class="default">$parser</span><span class="keyword">, </span><span class="default">$data</span><span class="keyword">){<br>&nbsp; &nbsp; &nbsp;&nbsp; if(!empty(</span><span class="default">$data</span><span class="keyword">) &amp;&amp; </span><span class="default">$data</span><span class="keyword">!=</span><span class="string">"\n"</span><span class="keyword">) {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$_output_idx </span><span class="keyword">= </span><span class="default">count</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">output</span><span class="keyword">) - </span><span class="default">1</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">output</span><span class="keyword">[</span><span class="default">$_output_idx</span><span class="keyword">][</span><span class="string">'content'</span><span class="keyword">] .= </span><span class="default">$data</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp;&nbsp; }<br>&nbsp;&nbsp; }<br><br>&nbsp;&nbsp; function </span><span class="default">endHandler</span><span class="keyword">(</span><span class="default">$parser</span><span class="keyword">, </span><span class="default">$name</span><span class="keyword">){<br>&nbsp; &nbsp; &nbsp;&nbsp; if(</span><span class="default">count</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">output</span><span class="keyword">) &gt; </span><span class="default">1</span><span class="keyword">) {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$_data </span><span class="keyword">= </span><span class="default">array_pop</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">output</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$_output_idx </span><span class="keyword">= </span><span class="default">count</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">output</span><span class="keyword">) - </span><span class="default">1</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$add </span><span class="keyword">= array();<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">$_data</span><span class="keyword">[</span><span class="string">'attrs'</span><span class="keyword">])<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$add</span><span class="keyword">[</span><span class="string">'attrs'</span><span class="keyword">] = </span><span class="default">$_data</span><span class="keyword">[</span><span class="string">'attrs'</span><span class="keyword">];<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">$_data</span><span class="keyword">[</span><span class="string">'child'</span><span class="keyword">])<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$add</span><span class="keyword">[</span><span class="string">'child'</span><span class="keyword">] = </span><span class="default">$_data</span><span class="keyword">[</span><span class="string">'child'</span><span class="keyword">];<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">output</span><span class="keyword">[</span><span class="default">$_output_idx</span><span class="keyword">][</span><span class="string">'child'</span><span class="keyword">][</span><span class="default">$_data</span><span class="keyword">[</span><span class="string">'content'</span><span class="keyword">]] = </span><span class="default">$add</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp;&nbsp; }&nbsp; &nbsp;&nbsp; <br>&nbsp;&nbsp; }<br>}<br></span><span class="default">?&gt;</span>
</span>
</code></div>
  </div>
 </div>
  <div class="note" id="40918">  
  <a class="name">
  <strong class="user"><em>odders</em></strong></a><div class="date" title="2004-03-18 10:36"><strong>10 years ago</strong></div>
  <div class="text" id="Hcom40918">
<div class="phpcode"><code><span class="html">
I wrote a simple xml parser mainly to deal with rss version 2. I found lots of examples on the net, but they were all masive and bloated and hard to manipulate.<br><br>Output is sent to an array, which holds arrays containg data for each item.<br><br>Obviously, you will have to make modifications to the code to suit your needs, but there isnt a lot of code there, so that shouldnt be a problem.<br><br><span class="default">&lt;?php<br><br>&nbsp;&nbsp; $currentElements </span><span class="keyword">= array();<br>&nbsp;&nbsp; </span><span class="default">$newsArray </span><span class="keyword">= array();<br><br>&nbsp;&nbsp; </span><span class="default">readXml</span><span class="keyword">(</span><span class="string">"./news.xml"</span><span class="keyword">);<br><br>&nbsp;&nbsp; echo(</span><span class="string">"&lt;pre&gt;"</span><span class="keyword">);<br>&nbsp;&nbsp; </span><span class="default">print_r</span><span class="keyword">(</span><span class="default">$newsArray</span><span class="keyword">);<br>&nbsp;&nbsp; echo(</span><span class="string">"&lt;/pre&gt;"</span><span class="keyword">);<br><br>&nbsp;&nbsp; </span><span class="comment">// Reads XML file into formatted html<br>&nbsp;&nbsp; </span><span class="keyword">function </span><span class="default">readXML</span><span class="keyword">(</span><span class="default">$xmlFile</span><span class="keyword">)<br>&nbsp;&nbsp; {<br><br>&nbsp; &nbsp; &nbsp; </span><span class="default">$xmlParser </span><span class="keyword">= </span><span class="default">xml_parser_create</span><span class="keyword">();<br><br>&nbsp; &nbsp; &nbsp; </span><span class="default">xml_parser_set_option</span><span class="keyword">(</span><span class="default">$xmlParser</span><span class="keyword">, </span><span class="default">XML_OPTION_CASE_FOLDING</span><span class="keyword">, </span><span class="default">false</span><span class="keyword">); <br>&nbsp; &nbsp; &nbsp; </span><span class="default">xml_set_element_handler</span><span class="keyword">(</span><span class="default">$xmlParser</span><span class="keyword">, </span><span class="default">startElement</span><span class="keyword">, </span><span class="default">endElement</span><span class="keyword">); <br>&nbsp; &nbsp; &nbsp; </span><span class="default">xml_set_character_data_handler</span><span class="keyword">(</span><span class="default">$xmlParser</span><span class="keyword">, </span><span class="default">characterData</span><span class="keyword">);<br><br>&nbsp; &nbsp; &nbsp; </span><span class="default">$fp </span><span class="keyword">= </span><span class="default">fopen</span><span class="keyword">(</span><span class="default">$xmlFile</span><span class="keyword">, </span><span class="string">"r"</span><span class="keyword">);<br><br>&nbsp; &nbsp; &nbsp; while(</span><span class="default">$data </span><span class="keyword">= </span><span class="default">fread</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">, </span><span class="default">filesize</span><span class="keyword">(</span><span class="default">$xmlFile</span><span class="keyword">))){<br>&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">xml_parse</span><span class="keyword">(</span><span class="default">$xmlParser</span><span class="keyword">, </span><span class="default">$data</span><span class="keyword">, </span><span class="default">feof</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">));}<br><br>&nbsp; &nbsp; &nbsp; </span><span class="default">xml_parser_free</span><span class="keyword">(</span><span class="default">$xmlParser</span><span class="keyword">);<br><br>&nbsp;&nbsp; }<br><br>&nbsp;&nbsp; </span><span class="comment">// Sets the current XML element, and pushes itself onto the element hierarchy<br>&nbsp;&nbsp; </span><span class="keyword">function </span><span class="default">startElement</span><span class="keyword">(</span><span class="default">$parser</span><span class="keyword">, </span><span class="default">$name</span><span class="keyword">, </span><span class="default">$attrs</span><span class="keyword">)<br>&nbsp;&nbsp; {<br><br>&nbsp; &nbsp; &nbsp; global </span><span class="default">$currentElements</span><span class="keyword">, </span><span class="default">$itemCount</span><span class="keyword">;<br><br>&nbsp; &nbsp; &nbsp; </span><span class="default">array_push</span><span class="keyword">(</span><span class="default">$currentElements</span><span class="keyword">, </span><span class="default">$name</span><span class="keyword">);<br><br>&nbsp; &nbsp; &nbsp; if(</span><span class="default">$name </span><span class="keyword">== </span><span class="string">"item"</span><span class="keyword">){</span><span class="default">$itemCount </span><span class="keyword">+= </span><span class="default">1</span><span class="keyword">;}<br><br>&nbsp;&nbsp; } <br><br>&nbsp;&nbsp; </span><span class="comment">// Prints XML data; finds highlights and links<br>&nbsp;&nbsp; </span><span class="keyword">function </span><span class="default">characterData</span><span class="keyword">(</span><span class="default">$parser</span><span class="keyword">, </span><span class="default">$data</span><span class="keyword">)<br>&nbsp;&nbsp; {<br><br>&nbsp; &nbsp; &nbsp; global </span><span class="default">$currentElements</span><span class="keyword">, </span><span class="default">$newsArray</span><span class="keyword">, </span><span class="default">$itemCount</span><span class="keyword">;<br><br>&nbsp; &nbsp; &nbsp; </span><span class="default">$currentCount </span><span class="keyword">= </span><span class="default">count</span><span class="keyword">(</span><span class="default">$currentElements</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; </span><span class="default">$parentElement </span><span class="keyword">= </span><span class="default">$currentElements</span><span class="keyword">[</span><span class="default">$currentCount</span><span class="keyword">-</span><span class="default">2</span><span class="keyword">];<br>&nbsp; &nbsp; &nbsp; </span><span class="default">$thisElement </span><span class="keyword">= </span><span class="default">$currentElements</span><span class="keyword">[</span><span class="default">$currentCount</span><span class="keyword">-</span><span class="default">1</span><span class="keyword">];<br><br>&nbsp; &nbsp; &nbsp; if(</span><span class="default">$parentElement </span><span class="keyword">== </span><span class="string">"item"</span><span class="keyword">){<br>&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$newsArray</span><span class="keyword">[</span><span class="default">$itemCount</span><span class="keyword">-</span><span class="default">1</span><span class="keyword">][</span><span class="default">$thisElement</span><span class="keyword">] = </span><span class="default">$data</span><span class="keyword">;}<br>&nbsp; &nbsp; &nbsp; else{<br>&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; switch(</span><span class="default">$name</span><span class="keyword">){<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; case </span><span class="string">"title"</span><span class="keyword">:<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; break;<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; case </span><span class="string">"link"</span><span class="keyword">:<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; break;<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; case </span><span class="string">"description"</span><span class="keyword">:<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; break;<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; case </span><span class="string">"language"</span><span class="keyword">:<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; break;<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; case </span><span class="string">"item"</span><span class="keyword">:<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; break;}}<br><br>&nbsp;&nbsp; } <br><br>&nbsp;&nbsp; </span><span class="comment">// If the XML element has ended, it is poped off the hierarchy<br>&nbsp;&nbsp; </span><span class="keyword">function </span><span class="default">endElement</span><span class="keyword">(</span><span class="default">$parser</span><span class="keyword">, </span><span class="default">$name</span><span class="keyword">)<br>&nbsp;&nbsp; {<br><br>&nbsp; &nbsp; &nbsp; global </span><span class="default">$currentElements</span><span class="keyword">;<br><br>&nbsp; &nbsp; &nbsp; </span><span class="default">$currentCount </span><span class="keyword">= </span><span class="default">count</span><span class="keyword">(</span><span class="default">$currentElements</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; if(</span><span class="default">$currentElements</span><span class="keyword">[</span><span class="default">$currentCount</span><span class="keyword">-</span><span class="default">1</span><span class="keyword">] == </span><span class="default">$name</span><span class="keyword">){<br>&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">array_pop</span><span class="keyword">(</span><span class="default">$currentElements</span><span class="keyword">);}<br><br>&nbsp;&nbsp; } <br><br></span><span class="default">?&gt;</span>
</span>
</code></div>
  </div>
 </div>
  <div class="note" id="28744">  
  <a class="name">
  <strong class="user"><em>software at serv-a-com dot com</em></strong></a><div class="date" title="2003-01-22 02:08"><strong>11 years ago</strong></div>
  <div class="text" id="Hcom28744">
<div class="phpcode"><code><span class="html">
use:
<br>
<br><span class="default">&lt;?php
<br></span><span class="keyword">while (</span><span class="default">$data </span><span class="keyword">= </span><span class="default">str_replace</span><span class="keyword">(</span><span class="string">"\n"</span><span class="keyword">,</span><span class="string">""</span><span class="keyword">,</span><span class="default">fread</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">, </span><span class="default">4096</span><span class="keyword">))){
<br> </span><span class="comment">// ...
<br></span><span class="keyword">}
<br></span><span class="default">?&gt;
<br></span>
<br>instead of:
<br>
<br><span class="default">&lt;?php
<br></span><span class="keyword">while (</span><span class="default">$data </span><span class="keyword">= </span><span class="default">fread</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">, </span><span class="default">4096</span><span class="keyword">)) {
<br>&nbsp; </span><span class="comment">// ...
<br></span><span class="keyword">}
<br></span><span class="default">?&gt;
<br></span>
<br>[UPDATE 17-FEB-2003: This post] resulted in some of the visitors e-mailg me on the carriage return stripping issue with questions. I'll try to make the following mumble as brief and easy to understand as possible. 
<br>
<br>1. Overview of the 4096 fragmentation issue 
<br>As you know the following freads the file 4096 bytes at a time (that is 4KB) this is perhaps ok for testing expat and figuring out how things work, but it it rather dangerous in the production environment. Data may not be fully understandable due to fread fragmentation and improperly formatted due to numerous sources(formats) of data contained within (i.e. end of line delimited CDATA). 
<br>
<br><span class="default">&lt;?php 
<br></span><span class="keyword">while (</span><span class="default">$data </span><span class="keyword">= </span><span class="default">fread</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">, </span><span class="default">4096</span><span class="keyword">)) { 
<br>&nbsp; if (!</span><span class="default">xml_parse</span><span class="keyword">(</span><span class="default">$xml_parser</span><span class="keyword">, </span><span class="default">$data</span><span class="keyword">, </span><span class="default">feof</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">))) { 
<br>&nbsp; &nbsp; </span><span class="comment">// ... 
<br>&nbsp; </span><span class="keyword">} 
<br>} 
<br></span><span class="default">?&gt;</span> 
<br>
<br>Sometimes to save time one may want to load it all up into a one big variable and leave all the worries to expat. I think anything under 500 KB is ok (as long as nobody knows about it). Some may argue that larger variables are acceptable or even necessary because of the magic that take place while parsing using xml_parse. Our XML parser(expat) works and can be successfully implemented only when we know what type of XML data we are dealing with, it's average size and structure of general layout and data contained within tags. For example if the tags are followed by a line delimiter like a new line we can read it with fgets in and with minimal effort make sure that no data will be sent to the function that does not end with a end tag. But this require a fair knowledge of the file's preference for storing XML data and tags (and a bit of code between reading data and xml_parse'ing it).
<br>It will save you a headache.
<br>
<br>2. Pre Parser Strings and New Line Delimited Data 
<br>One important thing to note at this point is that the xml_parse function requires a string variable. You can manipulate the content of any string variable easily as we all know. 
<br>
<br>A better approach to removing newlines than: 
<br>
<br><span class="default">&lt;?php 
<br></span><span class="keyword">while (</span><span class="default">$data </span><span class="keyword">= </span><span class="default">fread</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">, </span><span class="default">4096</span><span class="keyword">)) { 
<br></span><span class="default">$data </span><span class="keyword">= </span><span class="default">preg_replace</span><span class="keyword">(</span><span class="string">"/\n|\r/"</span><span class="keyword">,</span><span class="string">""</span><span class="keyword">,</span><span class="default">$data</span><span class="keyword">); </span><span class="comment">//flarp 
<br></span><span class="keyword">if (!</span><span class="default">xml_parse</span><span class="keyword">(</span><span class="default">$xml_parser</span><span class="keyword">, </span><span class="default">$data</span><span class="keyword">, </span><span class="default">feof</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">))) {... 
<br></span><span class="default">?&gt;</span> 
<br>
<br>Above works across all 3 line-delimited text files&nbsp; (\n, \r, \r\n). But this could potentially (or will most likely) damage or scramble data contained in for example CDATA areas. As far as I am concerned end of line characters should not be used _within_ XML tags. What seems to be the ultimate solution is to pre-parse the loaded data this would require checking the position within the XML document and adding or subtracting (using a in-between fread temporary variable) data based on conditions like: "Is within tag", "Is within CDATA" etc. before fedding it to the parser. This of course opens up a new can of worms (as in parse data for the parser...). (above procedure would take place between fread and xml_parser calls this method would be compatible with the general usage examples on top of the page) 
<br>
<br>3. The Answer to parsing arbitrary XML and Preprocessor Revisited 
<br>You can't just feed any XML document to the parser you constructed and assuming that it will work! You have to know what kind of methods for storing data are used, for example is there a end of line delimited data in the&nbsp; file ?, Are there any carriage returns in the tags etc... XML files come formatted in different ways some are just a one long string of characters with out any end of line markers others have newlines, carriage returns or both (Microsloth Windows). May or may not contain space and other whitespace between tags. For this reason it is important to what I call Normalize the data before feeding it to the parser. You can perform this with regular expressions or plain old str_replace and concatenation. In many cases this can be done to the file it self sometimes to string data on the fly( as shown in the example above). But I feel it is important to normalize the data before even calling the function to call xml_parse. If you have the ability to access all data before that call you can convert it to what you fell the data should have been in the first place and omit many surprises and expensive regular expression substitution (in a tight spot) while fread'ing the data.</span>
</code></div>
  </div>
 </div>
  <div class="note" id="25301">  
  <a class="name">
  <strong class="user"><em>dmarsh dot NO dot SPAM dot PLEASE at spscc dot ctc dot edu</em></strong></a><div class="date" title="2002-09-18 12:27"><strong>11 years ago</strong></div>
  <div class="text" id="Hcom25301">
<div class="phpcode"><code><span class="html">
Some reference code I am working on as "XML Library" of which I am folding it info an object. Notice the use of the DEFINE:<br><br>Mainly Example 1 and parts of 2 &amp; 3 re-written as an object: <br>--- MyXMLWalk.lib.php ---<br><span class="default">&lt;?php<br><br></span><span class="keyword">if (!</span><span class="default">defined</span><span class="keyword">(</span><span class="string">"PHPXMLWalk"</span><span class="keyword">)) {<br></span><span class="default">define</span><span class="keyword">(</span><span class="string">"PHPXMLWalk"</span><span class="keyword">,</span><span class="default">TRUE</span><span class="keyword">);<br><br>class </span><span class="default">XMLWalk </span><span class="keyword">{<br> var </span><span class="default">$p</span><span class="keyword">; </span><span class="comment">//short for xml parser;<br> </span><span class="keyword">var </span><span class="default">$e</span><span class="keyword">; </span><span class="comment">//short for element stack/array<br><br>&nbsp; </span><span class="keyword">function </span><span class="default">prl</span><span class="keyword">(</span><span class="default">$x</span><span class="keyword">,</span><span class="default">$i</span><span class="keyword">=</span><span class="default">0</span><span class="keyword">) {<br>&nbsp; &nbsp; </span><span class="default">ob_start</span><span class="keyword">();<br>&nbsp; &nbsp; </span><span class="default">print_r</span><span class="keyword">(</span><span class="default">$x</span><span class="keyword">);<br>&nbsp; &nbsp; </span><span class="default">$buf</span><span class="keyword">=</span><span class="default">ob_get_contents</span><span class="keyword">();<br>&nbsp; &nbsp; </span><span class="default">ob_end_clean</span><span class="keyword">();<br>&nbsp; &nbsp; return </span><span class="default">join</span><span class="keyword">(</span><span class="string">"\n"</span><span class="keyword">.</span><span class="default">str_repeat</span><span class="keyword">(</span><span class="string">" "</span><span class="keyword">,</span><span class="default">$i</span><span class="keyword">),</span><span class="default">split</span><span class="keyword">(</span><span class="string">"\n"</span><span class="keyword">,</span><span class="default">$buf</span><span class="keyword">));<br>&nbsp; }<br><br> function </span><span class="default">XMLWalk</span><span class="keyword">() {<br>&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">p </span><span class="keyword">= </span><span class="default">xml_parser_create</span><span class="keyword">();<br>&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">e </span><span class="keyword">= array();<br>&nbsp; </span><span class="default">xml_parser_set_option</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">p</span><span class="keyword">, </span><span class="default">XML_OPTION_CASE_FOLDING</span><span class="keyword">, </span><span class="default">true</span><span class="keyword">);<br>&nbsp; </span><span class="default">xml_set_element_handler</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">p</span><span class="keyword">, array(&amp;</span><span class="default">$this</span><span class="keyword">, </span><span class="string">"startElement"</span><span class="keyword">), array(&amp;</span><span class="default">$this</span><span class="keyword">, </span><span class="string">"endElement"</span><span class="keyword">));<br>&nbsp; </span><span class="default">xml_set_character_data_handler</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">p</span><span class="keyword">, array(&amp;</span><span class="default">$this</span><span class="keyword">, </span><span class="string">"dataElement"</span><span class="keyword">));<br>&nbsp; </span><span class="default">register_shutdown_function</span><span class="keyword">(array(&amp;</span><span class="default">$this</span><span class="keyword">, </span><span class="string">"free"</span><span class="keyword">)); </span><span class="comment">// make a destructor<br>&nbsp; </span><span class="keyword">}<br><br>&nbsp; function </span><span class="default">startElement</span><span class="keyword">(</span><span class="default">$parser</span><span class="keyword">, </span><span class="default">$name</span><span class="keyword">, </span><span class="default">$attrs</span><span class="keyword">) {<br>&nbsp; &nbsp; if (</span><span class="default">count</span><span class="keyword">(</span><span class="default">$attrs</span><span class="keyword">)&gt;=</span><span class="default">1</span><span class="keyword">) {<br>&nbsp; &nbsp; &nbsp; </span><span class="default">$x </span><span class="keyword">= </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">prl</span><span class="keyword">(</span><span class="default">$attrs</span><span class="keyword">, </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">e</span><span class="keyword">[</span><span class="default">$parser</span><span class="keyword">]+</span><span class="default">6</span><span class="keyword">);<br>&nbsp; &nbsp; } else {<br>&nbsp; &nbsp; &nbsp; </span><span class="default">$x </span><span class="keyword">= </span><span class="string">""</span><span class="keyword">;<br>&nbsp; &nbsp; }<br><br>&nbsp; &nbsp; print </span><span class="default">str_repeat</span><span class="keyword">(</span><span class="string">" "</span><span class="keyword">,</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">e</span><span class="keyword">[</span><span class="default">$parser</span><span class="keyword">]+</span><span class="default">0</span><span class="keyword">). </span><span class="string">"</span><span class="default">$name</span><span class="string"> </span><span class="default">$x</span><span class="string">\n"</span><span class="keyword">;<br>&nbsp; &nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">e</span><span class="keyword">[</span><span class="default">$parser</span><span class="keyword">]++;<br>&nbsp; &nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">e</span><span class="keyword">[</span><span class="default">$parser</span><span class="keyword">]++;<br>&nbsp; }<br><br>&nbsp; function </span><span class="default">dataElement</span><span class="keyword">(</span><span class="default">$parser</span><span class="keyword">, </span><span class="default">$data</span><span class="keyword">) {<br>&nbsp; &nbsp; print </span><span class="default">str_repeat</span><span class="keyword">(</span><span class="string">" "</span><span class="keyword">,</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">e</span><span class="keyword">[</span><span class="default">$parser</span><span class="keyword">]+</span><span class="default">0</span><span class="keyword">). </span><span class="default">htmlspecialchars</span><span class="keyword">(</span><span class="default">$data</span><span class="keyword">, </span><span class="default">ENT_QUOTES</span><span class="keyword">) .</span><span class="string">"\n"</span><span class="keyword">;<br>&nbsp; }<br><br>&nbsp; function </span><span class="default">endElement</span><span class="keyword">(</span><span class="default">$parser</span><span class="keyword">, </span><span class="default">$name</span><span class="keyword">) {<br>&nbsp; &nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">e</span><span class="keyword">[</span><span class="default">$parser</span><span class="keyword">]--;<br>&nbsp; &nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">e</span><span class="keyword">[</span><span class="default">$parser</span><span class="keyword">]--;<br>&nbsp; }<br>&nbsp; function </span><span class="default">parse</span><span class="keyword">(</span><span class="default">$data</span><span class="keyword">, </span><span class="default">$fp</span><span class="keyword">) {<br>&nbsp; &nbsp; if (!</span><span class="default">xml_parse</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">p</span><span class="keyword">, </span><span class="default">$data</span><span class="keyword">, </span><span class="default">feof</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">))) {<br>&nbsp; &nbsp; &nbsp; &nbsp; die(</span><span class="default">sprintf</span><span class="keyword">(</span><span class="string">"XML error: %s at line %d"</span><span class="keyword">,<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">xml_error_string</span><span class="keyword">(</span><span class="default">xml_get_error_code</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">p</span><span class="keyword">)),<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">xml_get_current_line_number</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">p</span><span class="keyword">)));<br>&nbsp; &nbsp; }<br>&nbsp; }<br><br>&nbsp; function </span><span class="default">free</span><span class="keyword">() {<br>&nbsp; &nbsp; </span><span class="default">xml_parser_free</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">p</span><span class="keyword">);<br>&nbsp; }<br><br>} </span><span class="comment">// end of class<br><br></span><span class="keyword">} </span><span class="comment">// end of define<br><br></span><span class="default">?&gt;<br></span><br>--- end of file ---<br><br>Calling code:<br><span class="default">&lt;?php<br><br></span><span class="keyword">...<br><br>require(</span><span class="string">"MyXMLWalk.lib.php"</span><span class="keyword">);<br><br></span><span class="default">$file </span><span class="keyword">= </span><span class="string">"x.xml"</span><span class="keyword">;<br><br></span><span class="default">$xme </span><span class="keyword">= new </span><span class="default">XMLWalk</span><span class="keyword">;<br><br>if (!(</span><span class="default">$fp </span><span class="keyword">= </span><span class="default">fopen</span><span class="keyword">(</span><span class="default">$file</span><span class="keyword">, </span><span class="string">"r"</span><span class="keyword">))) {<br>&nbsp; &nbsp; die(</span><span class="string">"could not open XML input"</span><span class="keyword">);<br>}<br><br>while (</span><span class="default">$data </span><span class="keyword">= </span><span class="default">fread</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">, </span><span class="default">4096</span><span class="keyword">)) {<br>&nbsp; </span><span class="default">$xme</span><span class="keyword">-&gt;</span><span class="default">parse</span><span class="keyword">(</span><span class="default">$data</span><span class="keyword">, </span><span class="default">$fp</span><span class="keyword">);<br>}<br><br>...<br></span><span class="default">?&gt;</span>
</span>
</code></div>
  </div>
 </div>
  <div class="note" id="111866">  
  <a class="name">
  <strong class="user"><em>Glen at ITIStudios dot ca</em></strong></a><div class="date" title="2013-04-05 07:38"><strong>1 year ago</strong></div>
  <div class="text" id="Hcom111866">
<div class="phpcode"><code><span class="html">
Update: corrected isset() in convert_to_array() function<br><span class="default">&lt;?php<br></span><span class="comment">/**<br> *&nbsp; XML to Associative Array Class<br> *<br> *&nbsp; Usage:<br> *&nbsp; &nbsp;&nbsp; $domObj = new xmlToArrayParser($xml);<br> *&nbsp; &nbsp;&nbsp; $domArr = $domObj-&gt;array;<br> *&nbsp; &nbsp; <br> *&nbsp; &nbsp;&nbsp; if($domObj-&gt;parse_error) echo $domObj-&gt;get_xml_error();<br> *&nbsp; &nbsp;&nbsp; else print_r($domArr);<br> *<br> *&nbsp; &nbsp;&nbsp; On Success:<br> *&nbsp; &nbsp;&nbsp; eg. $domArr['top']['element2']['attrib']['var2'] =&gt; val2<br> *<br> *&nbsp; &nbsp;&nbsp; On Error:<br> *&nbsp; &nbsp;&nbsp; eg. Error Code [76] "Mismatched tag", at char 58 on line 3<br> */<br><br>/**<br> * Convert an xml file or string to an associative array (including the tag attributes):<br> * $domObj = new xmlToArrayParser($xml);<br> * $elemVal = $domObj-&gt;array['element']<br> * Or:&nbsp; $domArr=$domObj-&gt;array;&nbsp; $elemVal = $domArr['element'].<br> *<br> * @version&nbsp; 2.0<br> * @param Str $xml file/string.<br> */<br></span><span class="keyword">class </span><span class="default">xmlToArrayParser </span><span class="keyword">{<br>&nbsp; </span><span class="comment">/** The array created by the parser can be assigned to any variable: $anyVarArr = $domObj-&gt;array.*/<br>&nbsp; </span><span class="keyword">public&nbsp; </span><span class="default">$array </span><span class="keyword">= array();<br>&nbsp; public&nbsp; </span><span class="default">$parse_error </span><span class="keyword">= </span><span class="default">false</span><span class="keyword">;<br>&nbsp; private </span><span class="default">$parser</span><span class="keyword">;<br>&nbsp; private </span><span class="default">$pointer</span><span class="keyword">;<br> <br>&nbsp; </span><span class="comment">/** Constructor: $domObj = new xmlToArrayParser($xml); */<br>&nbsp; </span><span class="keyword">public function </span><span class="default">__construct</span><span class="keyword">(</span><span class="default">$xml</span><span class="keyword">) {<br>&nbsp; &nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">pointer </span><span class="keyword">=&amp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">array</span><span class="keyword">;<br>&nbsp; &nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">parser </span><span class="keyword">= </span><span class="default">xml_parser_create</span><span class="keyword">(</span><span class="string">"UTF-8"</span><span class="keyword">);<br>&nbsp; &nbsp; </span><span class="default">xml_set_object</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">parser</span><span class="keyword">, </span><span class="default">$this</span><span class="keyword">);<br>&nbsp; &nbsp; </span><span class="default">xml_parser_set_option</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">parser</span><span class="keyword">, </span><span class="default">XML_OPTION_CASE_FOLDING</span><span class="keyword">, </span><span class="default">false</span><span class="keyword">);<br>&nbsp; &nbsp; </span><span class="default">xml_set_element_handler</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">parser</span><span class="keyword">, </span><span class="string">"tag_open"</span><span class="keyword">, </span><span class="string">"tag_close"</span><span class="keyword">);<br>&nbsp; &nbsp; </span><span class="default">xml_set_character_data_handler</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">parser</span><span class="keyword">, </span><span class="string">"cdata"</span><span class="keyword">);<br>&nbsp; &nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">parse_error </span><span class="keyword">= </span><span class="default">xml_parse</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">parser</span><span class="keyword">, </span><span class="default">ltrim</span><span class="keyword">(</span><span class="default">$xml</span><span class="keyword">))? </span><span class="default">false </span><span class="keyword">: </span><span class="default">true</span><span class="keyword">;<br>&nbsp; }<br> <br>&nbsp; </span><span class="comment">/** Free the parser. */<br>&nbsp; </span><span class="keyword">public function </span><span class="default">__destruct</span><span class="keyword">() { </span><span class="default">xml_parser_free</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">parser</span><span class="keyword">);}<br><br>&nbsp; </span><span class="comment">/** Get the xml error if an an error in the xml file occured during parsing. */<br>&nbsp; </span><span class="keyword">public function </span><span class="default">get_xml_error</span><span class="keyword">() {<br>&nbsp; &nbsp; if(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">parse_error</span><span class="keyword">) {<br>&nbsp; &nbsp; &nbsp; </span><span class="default">$errCode </span><span class="keyword">= </span><span class="default">xml_get_error_code </span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">parser</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; </span><span class="default">$thisError </span><span class="keyword">=&nbsp; </span><span class="string">"Error Code ["</span><span class="keyword">. </span><span class="default">$errCode </span><span class="keyword">.</span><span class="string">"] \"&lt;strong style='color:red;'&gt;" </span><span class="keyword">. </span><span class="default">xml_error_string</span><span class="keyword">(</span><span class="default">$errCode</span><span class="keyword">).</span><span class="string">"&lt;/strong&gt;\",<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; at char "</span><span class="keyword">.</span><span class="default">xml_get_current_column_number</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">parser</span><span class="keyword">) . </span><span class="string">"<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; on line "</span><span class="keyword">.</span><span class="default">xml_get_current_line_number</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">parser</span><span class="keyword">).</span><span class="string">""</span><span class="keyword">;<br>&nbsp; &nbsp; }else </span><span class="default">$thisError </span><span class="keyword">= </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">parse_error</span><span class="keyword">;<br>&nbsp; &nbsp; return </span><span class="default">$thisError</span><span class="keyword">;<br>&nbsp; }<br> <br>&nbsp; private function </span><span class="default">tag_open</span><span class="keyword">(</span><span class="default">$parser</span><span class="keyword">, </span><span class="default">$tag</span><span class="keyword">, </span><span class="default">$attributes</span><span class="keyword">) {<br>&nbsp; &nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">convert_to_array</span><span class="keyword">(</span><span class="default">$tag</span><span class="keyword">, </span><span class="string">'attrib'</span><span class="keyword">);<br>&nbsp; &nbsp; </span><span class="default">$idx</span><span class="keyword">=</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">convert_to_array</span><span class="keyword">(</span><span class="default">$tag</span><span class="keyword">, </span><span class="string">'cdata'</span><span class="keyword">);<br>&nbsp; &nbsp; if(isset(</span><span class="default">$idx</span><span class="keyword">)) {<br>&nbsp; &nbsp; &nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">pointer</span><span class="keyword">[</span><span class="default">$tag</span><span class="keyword">][</span><span class="default">$idx</span><span class="keyword">] = Array(</span><span class="string">'@idx' </span><span class="keyword">=&gt; </span><span class="default">$idx</span><span class="keyword">,</span><span class="string">'@parent' </span><span class="keyword">=&gt; &amp;</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">pointer</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">pointer </span><span class="keyword">=&amp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">pointer</span><span class="keyword">[</span><span class="default">$tag</span><span class="keyword">][</span><span class="default">$idx</span><span class="keyword">];<br>&nbsp; &nbsp; }else {<br>&nbsp; &nbsp; &nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">pointer</span><span class="keyword">[</span><span class="default">$tag</span><span class="keyword">] = Array(</span><span class="string">'@parent' </span><span class="keyword">=&gt; &amp;</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">pointer</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">pointer </span><span class="keyword">=&amp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">pointer</span><span class="keyword">[</span><span class="default">$tag</span><span class="keyword">];<br>&nbsp; &nbsp; }<br>&nbsp; &nbsp; if (!empty(</span><span class="default">$attributes</span><span class="keyword">)) { </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">pointer</span><span class="keyword">[</span><span class="string">'attrib'</span><span class="keyword">] = </span><span class="default">$attributes</span><span class="keyword">; }<br>&nbsp; }<br><br>&nbsp; </span><span class="comment">/** Adds the current elements content to the current pointer[cdata] array. */<br>&nbsp; </span><span class="keyword">private function </span><span class="default">cdata</span><span class="keyword">(</span><span class="default">$parser</span><span class="keyword">, </span><span class="default">$cdata</span><span class="keyword">) { </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">pointer</span><span class="keyword">[</span><span class="string">'cdata'</span><span class="keyword">] = </span><span class="default">trim</span><span class="keyword">(</span><span class="default">$cdata</span><span class="keyword">); }<br><br>&nbsp; private function </span><span class="default">tag_close</span><span class="keyword">(</span><span class="default">$parser</span><span class="keyword">, </span><span class="default">$tag</span><span class="keyword">) {<br>&nbsp; &nbsp; </span><span class="default">$current </span><span class="keyword">= &amp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">pointer</span><span class="keyword">;<br>&nbsp; &nbsp; if(isset(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">pointer</span><span class="keyword">[</span><span class="string">'@idx'</span><span class="keyword">])) {unset(</span><span class="default">$current</span><span class="keyword">[</span><span class="string">'@idx'</span><span class="keyword">]);}<br>&nbsp;&nbsp; <br>&nbsp; &nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">pointer </span><span class="keyword">= &amp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">pointer</span><span class="keyword">[</span><span class="string">'@parent'</span><span class="keyword">];<br>&nbsp; &nbsp; unset(</span><span class="default">$current</span><span class="keyword">[</span><span class="string">'@parent'</span><span class="keyword">]);<br>&nbsp;&nbsp; <br>&nbsp; &nbsp; if(isset(</span><span class="default">$current</span><span class="keyword">[</span><span class="string">'cdata'</span><span class="keyword">]) &amp;&amp; </span><span class="default">count</span><span class="keyword">(</span><span class="default">$current</span><span class="keyword">) == </span><span class="default">1</span><span class="keyword">) { </span><span class="default">$current </span><span class="keyword">= </span><span class="default">$current</span><span class="keyword">[</span><span class="string">'cdata'</span><span class="keyword">];}<br>&nbsp; &nbsp; else if(empty(</span><span class="default">$current</span><span class="keyword">[</span><span class="string">'cdata'</span><span class="keyword">])) {unset(</span><span class="default">$current</span><span class="keyword">[</span><span class="string">'cdata'</span><span class="keyword">]);}<br>&nbsp; }<br> <br>&nbsp; </span><span class="comment">/** Converts a single element item into array(element[0]) if a second element of the same name is encountered. */<br>&nbsp; </span><span class="keyword">private function </span><span class="default">convert_to_array</span><span class="keyword">(</span><span class="default">$tag</span><span class="keyword">, </span><span class="default">$item</span><span class="keyword">) {<br>&nbsp; &nbsp; if(isset(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">pointer</span><span class="keyword">[</span><span class="default">$tag</span><span class="keyword">]) &amp;&amp; !</span><span class="default">is_array</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">pointer</span><span class="keyword">[</span><span class="default">$tag</span><span class="keyword">])){<br>&nbsp; &nbsp; &nbsp; </span><span class="default">$content </span><span class="keyword">= </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">pointer</span><span class="keyword">[</span><span class="default">$tag</span><span class="keyword">];<br>&nbsp; &nbsp; &nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">pointer</span><span class="keyword">[</span><span class="default">$tag</span><span class="keyword">] = array((</span><span class="default">0</span><span class="keyword">) =&gt; </span><span class="default">$content</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; </span><span class="default">$idx </span><span class="keyword">= </span><span class="default">1</span><span class="keyword">;<br>&nbsp; &nbsp; }else if (isset(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">pointer</span><span class="keyword">[</span><span class="default">$tag</span><span class="keyword">])) {<br>&nbsp; &nbsp; &nbsp; </span><span class="default">$idx </span><span class="keyword">= </span><span class="default">count</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">pointer</span><span class="keyword">[</span><span class="default">$tag</span><span class="keyword">]);<br>&nbsp; &nbsp; &nbsp; if(!isset(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">pointer</span><span class="keyword">[</span><span class="default">$tag</span><span class="keyword">][</span><span class="default">0</span><span class="keyword">])) {<br>&nbsp; &nbsp; &nbsp; &nbsp; foreach (</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">pointer</span><span class="keyword">[</span><span class="default">$tag</span><span class="keyword">] as </span><span class="default">$key </span><span class="keyword">=&gt; </span><span class="default">$value</span><span class="keyword">) {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; unset(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">pointer</span><span class="keyword">[</span><span class="default">$tag</span><span class="keyword">][</span><span class="default">$key</span><span class="keyword">]);<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">pointer</span><span class="keyword">[</span><span class="default">$tag</span><span class="keyword">][</span><span class="default">0</span><span class="keyword">][</span><span class="default">$key</span><span class="keyword">] = </span><span class="default">$value</span><span class="keyword">;<br>&nbsp; &nbsp; }}}else </span><span class="default">$idx </span><span class="keyword">= </span><span class="default">null</span><span class="keyword">;<br>&nbsp; &nbsp; return </span><span class="default">$idx</span><span class="keyword">;<br>&nbsp; }<br>}<br></span><span class="default">?&gt;</span>
</span>
</code></div>
  </div>
 </div>
  <div class="note" id="77700">  
  <a class="name">
  <strong class="user"><em>Zvjezdan Patz</em></strong></a><div class="date" title="2007-09-09 08:22"><strong>6 years ago</strong></div>
  <div class="text" id="Hcom77700">
<div class="phpcode"><code><span class="html">
The problem I had was I needed to generate xml on the screen for users to actually see and copy to a file.&nbsp; 
<br>
<br>I'm generating the xml manually from a php file and the browser kept interpreting the xml...not very helpful.&nbsp; 
<br>
<br>This is how you get around it:
<br>
<br><span class="default">&lt;?php
<br>
<br>$file&nbsp; </span><span class="keyword">= </span><span class="default">file_get_contents</span><span class="keyword">(</span><span class="string">"<a rel="nofollow" target="_blank">http://example.com/xml.php?whatever=</a></span><span class="default">$whatever</span><span class="string">"</span><span class="keyword">);
<br>print </span><span class="default">nl2br</span><span class="keyword">(</span><span class="default">htmlentities</span><span class="keyword">(</span><span class="default">$file</span><span class="keyword">));
<br>
<br></span><span class="default">?&gt;</span> 
<br>
<br>Prints all my xml quite nicely.</span>
</code></div>
  </div>
 </div></div>

 
</section>    </section><!-- layout-content -->
        


  </div><!-- layout -->
         
  

    
 <!-- External and third party libraries. -->
 







<a id="toTop" href="javascript:;"><span id="toTopHover"></span><img width="40" height="40" alt="To Top" src="../../images/to-top%402x.png"></a>



<!-- Mirrored from php.net/manual/en/ref.xml.php by HTTrack Website Copier/3.x [XR&CO'2013], Thu, 28 Aug 2014 15:52:55 GMT -->


</body></html>