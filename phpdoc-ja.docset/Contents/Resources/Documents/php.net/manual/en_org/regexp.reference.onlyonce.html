<html><!-- Mirrored from php.net/manual/en/regexp.reference.onlyonce.php by HTTrack Website Copier/3.x [XR&CO'2013], Thu, 28 Aug 2014 17:07:27 GMT --><!-- Added by HTTrack --><head><meta http-equiv="content-type" content="text/html;charset=utf-8"><!-- /Added by HTTrack -->


  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0"> 

  <title>Once-only subpatterns</title>

 <link rel="shortcut icon" href="../../favicon.ico">
 <link rel="search" type="application/opensearchdescription+xml" href="http://php.net/phpnetimprovedsearch.src" title="Add PHP.net search">
 <link rel="alternate" type="application/atom+xml" href="http://php.net/releases/feed.php" title="PHP Release feed">
 <link rel="alternate" type="application/atom+xml" href="http://php.net/feed.atom" title="PHP: Hypertext Preprocessor">

 <link rel="canonical" href="regexp.reference.onlyonce.html">
 <link rel="shorturl" href="regexp.reference.onlyonce.html">
 <link rel="alternate" href="regexp.reference.onlyonce.html" hreflang="x-default">

 <link rel="contents" href="index-2.html">
 <link rel="index" href="reference.pcre.pattern.syntax.html">
 <link rel="prev" href="regexp.reference.assertions.html">
 <link rel="next" href="regexp.reference.conditional.html">

 <link rel="alternate" href="regexp.reference.onlyonce.html" hreflang="en">
 <link rel="alternate" href="http://php.net/manual/pt_BR/regexp.reference.onlyonce.php" hreflang="pt_BR">
 <link rel="alternate" href="http://php.net/manual/zh/regexp.reference.onlyonce.php" hreflang="zh">
 <link rel="alternate" href="http://php.net/manual/fr/regexp.reference.onlyonce.php" hreflang="fr">
 <link rel="alternate" href="http://php.net/manual/de/regexp.reference.onlyonce.php" hreflang="de">
 <link rel="alternate" href="http://php.net/manual/it/regexp.reference.onlyonce.php" hreflang="it">
 <link rel="alternate" href="http://php.net/manual/ja/regexp.reference.onlyonce.php" hreflang="ja">
 <link rel="alternate" href="http://php.net/manual/ro/regexp.reference.onlyonce.php" hreflang="ro">
 <link rel="alternate" href="http://php.net/manual/ru/regexp.reference.onlyonce.php" hreflang="ru">
 <link rel="alternate" href="http://php.net/manual/es/regexp.reference.onlyonce.php" hreflang="es">
 <link rel="alternate" href="http://php.net/manual/tr/regexp.reference.onlyonce.php" hreflang="tr">

<link rel="stylesheet" type="text/css" href="../../cached8fe1.css?t=1401250819&amp;f=/fonts/Fira/fira.css" media="screen">
<link rel="stylesheet" type="text/css" href="../../cached4b8d.css?t=1404368420&amp;f=/fonts/Font-Awesome/css/fontello.css" media="screen">
<link rel="stylesheet" type="text/css" href="../../cached5065.css?t=1403329232&amp;f=/styles/theme-base.css" media="screen">
<link rel="stylesheet" type="text/css" href="../../cachedc78d.css?t=1401249623&amp;f=/styles/theme-medium.css" media="screen">

 <!--[if lte IE 7]>
 <link rel="stylesheet" type="text/css" href="http://php.net/styles/workarounds.ie7.css" media="screen">
 <![endif]-->

 <!--[if lte IE 8]>
 <script type="text/javascript">
  window.brokenIE = true;
 </script>
 <![endif]-->

 <!--[if lte IE 9]>
 <link rel="stylesheet" type="text/css" href="http://php.net/styles/workarounds.ie9.css" media="screen">
 <![endif]-->

 <!--[if IE]>
 <script type="text/javascript" src="http://php.net/js/ext/html5.js"></script>
 <![endif]-->

 <base>

</head>
<body class="docs " style="">


<div class="headsup"><a href="http://php.net/index.php#id2014-08-28-1">PHP 5.6.0 released</a></div>
<nav id="trick"><div><dl>
<dt><a href="getting-started.html">Getting Started</a></dt>
	<dd><a href="introduction.html">Introduction</a></dd>
	<dd><a href="tutorial.html">A simple tutorial</a></dd>
<dt><a href="langref.html">Language Reference</a></dt>
	<dd><a href="language.basic-syntax.html">Basic syntax</a></dd>
	<dd><a href="language.types.html">Types</a></dd>
	<dd><a href="language.variables.html">Variables</a></dd>
	<dd><a href="language.constants.html">Constants</a></dd>
	<dd><a href="language.expressions.html">Expressions</a></dd>
	<dd><a href="language.operators.html">Operators</a></dd>
	<dd><a href="language.control-structures.html">Control Structures</a></dd>
	<dd><a href="language.functions.html">Functions</a></dd>
	<dd><a href="language.oop5.html">Classes and Objects</a></dd>
	<dd><a href="language.namespaces.html">Namespaces</a></dd>
	<dd><a href="language.exceptions.html">Exceptions</a></dd>
	<dd><a href="language.generators.html">Generators</a></dd>
	<dd><a href="language.references.html">References Explained</a></dd>
	<dd><a href="reserved.variables.html">Predefined Variables</a></dd>
	<dd><a href="reserved.exceptions.html">Predefined Exceptions</a></dd>
	<dd><a href="reserved.interfaces.html">Predefined Interfaces and Classes</a></dd>
	<dd><a href="context.html">Context options and parameters</a></dd>
	<dd><a href="wrappers.html">Supported Protocols and Wrappers</a></dd>
</dl>
<dl>
<dt><a href="security.html">Security</a></dt>
	<dd><a href="security.intro.html">Introduction</a></dd>
	<dd><a href="security.general.html">General considerations</a></dd>
	<dd><a href="security.cgi-bin.html">Installed as CGI binary</a></dd>
	<dd><a href="security.apache.html">Installed as an Apache module</a></dd>
	<dd><a href="security.filesystem.html">Filesystem Security</a></dd>
	<dd><a href="security.database.html">Database Security</a></dd>
	<dd><a href="security.errors.html">Error Reporting</a></dd>
	<dd><a href="security.globals.html">Using Register Globals</a></dd>
	<dd><a href="security.variables.html">User Submitted Data</a></dd>
	<dd><a href="security.magicquotes.html">Magic Quotes</a></dd>
	<dd><a href="security.hiding.html">Hiding PHP</a></dd>
	<dd><a href="security.current.html">Keeping Current</a></dd>
<dt><a href="features.html">Features</a></dt>
	<dd><a href="features.http-auth.html">HTTP authentication with PHP</a></dd>
	<dd><a href="features.cookies.html">Cookies</a></dd>
	<dd><a href="features.sessions.html">Sessions</a></dd>
	<dd><a href="features.xforms.html">Dealing with XForms</a></dd>
	<dd><a href="features.file-upload.html">Handling file uploads</a></dd>
	<dd><a href="features.remote-files.html">Using remote files</a></dd>
	<dd><a href="features.connection-handling.html">Connection handling</a></dd>
	<dd><a href="features.persistent-connections.html">Persistent Database Connections</a></dd>
	<dd><a href="features.safe-mode.html">Safe Mode</a></dd>
	<dd><a href="features.commandline.html">Command line usage</a></dd>
	<dd><a href="features.gc.html">Garbage Collection</a></dd>
	<dd><a href="features.dtrace.html">DTrace Dynamic Tracing</a></dd>
</dl>
<dl>
<dt><a href="funcref.html">Function Reference</a></dt>
	<dd><a href="refs.basic.php.html">Affecting PHP's Behaviour</a></dd>
	<dd><a href="refs.utilspec.audio.html">Audio Formats Manipulation</a></dd>
	<dd><a href="refs.remote.auth.html">Authentication Services</a></dd>
	<dd><a href="refs.utilspec.cmdline.html">Command Line Specific Extensions</a></dd>
	<dd><a href="refs.compression.html">Compression and Archive Extensions</a></dd>
	<dd><a href="refs.creditcard.html">Credit Card Processing</a></dd>
	<dd><a href="refs.crypto.html">Cryptography Extensions</a></dd>
	<dd><a href="refs.database.html">Database Extensions</a></dd>
	<dd><a href="refs.calendar.html">Date and Time Related Extensions</a></dd>
	<dd><a href="refs.fileprocess.file.html">File System Related Extensions</a></dd>
	<dd><a href="refs.international.html">Human Language and Character Encoding Support</a></dd>
	<dd><a href="refs.utilspec.image.html">Image Processing and Generation</a></dd>
	<dd><a href="refs.remote.mail.html">Mail Related Extensions</a></dd>
	<dd><a href="refs.math.html">Mathematical Extensions</a></dd>
	<dd><a href="refs.utilspec.nontext.html">Non-Text MIME Output</a></dd>
	<dd><a href="refs.fileprocess.process.html">Process Control Extensions</a></dd>
	<dd><a href="refs.basic.other.html">Other Basic Extensions</a></dd>
	<dd><a href="refs.remote.other.html">Other Services</a></dd>
	<dd><a href="refs.search.html">Search Engine Extensions</a></dd>
	<dd><a href="refs.utilspec.server.html">Server Specific Extensions</a></dd>
	<dd><a href="refs.basic.session.html">Session Extensions</a></dd>
	<dd><a href="refs.basic.text.html">Text Processing</a></dd>
	<dd><a href="refs.basic.vartype.html">Variable and Type Related Extensions</a></dd>
	<dd><a href="refs.webservice.html">Web Services</a></dd>
	<dd><a href="refs.utilspec.windows.html">Windows Only Extensions</a></dd>
	<dd><a href="refs.xml.html">XML Manipulation</a></dd>
</dl>
<dl>
<dt>Keyboard Shortcuts</dt><dt>?</dt>
<dd>This help</dd>
<dt>j</dt>
<dd>Next menu item</dd>
<dt>k</dt>
<dd>Previous menu item</dd>
<dt>g p</dt>
<dd>Previous man page</dd>
<dt>g n</dt>
<dd>Next man page</dd>
<dt>G</dt>
<dd>Scroll to bottom</dd>
<dt>g g</dt>
<dd>Scroll to top</dd>
<dt>g h</dt>
<dd>Goto homepage</dd>
<dt>g s</dt>
<dd>Goto search<br>(current page)</dd>
<dt>/</dt>
<dd>Focus search box</dd>
</dl></div></nav>
<div id="goto">
    <div class="search">
         <div class="text"></div>
         <div class="results"><ul></ul></div>
   </div>
</div>

  <div id="breadcrumbs" class="row-fluid">
          
              
        <ul class="breadcrumbs-container">
            <li><a href="index-2.html">PHP Manual</a></li>      <li><a href="funcref.html">Function Reference</a></li>      <li><a href="refs.basic.text.html">Text Processing</a></li>      <li><a href="book.pcre.html">PCRE</a></li>      <li><a href="pcre.pattern.html">PCRE Patterns</a></li>      <li><a href="reference.pcre.pattern.syntax.html">PCRE regex syntax</a></li>    </ul>
  </div>




<div id="layout">
  <section id="layout-content">
  <div id="regexp.reference.onlyonce" class="section">
  <h2 class="title">Once-only subpatterns</h2>
  <p class="para">
   With both maximizing and minimizing repetition,  failure  of
   what  follows  normally  causes  the repeated item to be
   re-evaluated to see if a different number of repeats allows the
   rest  of  the  pattern  to  match. Sometimes it is useful to
   prevent this, either to change the nature of the  match,  or
   to  cause  it fail earlier than it otherwise might, when the
   author of the pattern knows there is no  point  in  carrying
   on.
  </p>
  <p class="para">
   Consider, for example, the pattern \d+foo  when  applied  to
   the subject line
   
   <em>123456bar</em>
  </p>
  <p class="para">
   After matching all 6 digits and then failing to match "foo",
   the normal action of the matcher is to try again with only 5
   digits matching the \d+ item, and then with 4,  and  so  on,
   before ultimately failing. Once-only subpatterns provide the
   means for specifying that once a portion of the pattern  has
   matched,  it  is  not to be re-evaluated in this way, so the
   matcher would give up immediately on failing to match  "foo"
   the  first  time.  The  notation  is another kind of special
   parenthesis, starting with (?&gt; as in this example:
   
   <em>(?&gt;\d+)bar</em>
  </p>
  <p class="para">
   This kind of parenthesis "locks up" the  part of the pattern
   it  contains once it has matched, and a failure further into
   the pattern is prevented from backtracking  into  it.
   Backtracking  past  it to previous items, however, works as normal.
  </p>
  <p class="para">
   An alternative description is that a subpattern of this type
   matches  the  string  of  characters that an identical standalone
   pattern would match, if anchored at the current point
   in the subject string.
  </p>
  <p class="para">
   Once-only subpatterns are not capturing subpatterns.  Simple
   cases  such as the above example can be thought of as a maximizing
   repeat that must  swallow  everything  it  can.  So,
   while both \d+ and \d+? are prepared to adjust the number of
   digits they match in order to make the rest of  the  pattern
   match, (?&gt;\d+) can only match an entire sequence of digits.
  </p>
  <p class="para">
   This construction can of course contain arbitrarily  complicated
   subpatterns, and it can be nested.
  </p>
  <p class="para">
   Once-only subpatterns can be used in conjunction with
   lookbehind assertions  to specify efficient matching at the end
   of the subject string. Consider a simple pattern such as
   
   <em>abcd$</em>
   
   when applied to a long string which does not match.  Because
   matching  proceeds  from  left  to right, PCRE will look for
   each "a" in the subject and then see if what follows matches
   the rest of the pattern. If the pattern is specified as
   
   <em>^.*abcd$</em>
   
   then the initial .* matches the entire string at first,  but
   when  this  fails  (because  there  is no following "a"), it
   backtracks to match all but the last character, then all but
   the  last  two  characters, and so on. Once again the search
   for "a" covers the entire string, from right to left, so  we
   are no better off. However, if the pattern is written as
   
   <em>^(?&gt;.*)(?&lt;=abcd)</em>
   
   then there can be no backtracking for the .*  item;  it  can
   match  only  the  entire  string.  The subsequent lookbehind
   assertion does a single test on the last four characters. If
   it  fails,  the  match  fails immediately. For long strings,
   this approach makes a significant difference to the processing time.
  </p>
  <p class="para">
   When a pattern contains an unlimited repeat inside a subpattern
   that can itself be repeated an unlimited number of
   times, the use of a once-only subpattern is the only way  to
   avoid  some  failing matches taking a very long time indeed.
   The pattern
   
   <em>(\D+|&lt;\d+&gt;)*[!?]</em>
   
   matches an unlimited number of substrings that  either  consist
   of  non-digits,  or digits enclosed in &lt;&gt;, followed by
   either ! or ?. When it matches, it runs quickly. However, if
   it is applied to
   
   <em>aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa</em>
   
   it takes a long  time  before  reporting  failure.  This  is
   because the string can be divided between the two repeats in
   a large number of ways, and all have to be tried. (The example
   used  [!?]  rather  than a single character at the end,
   because both PCRE and Perl have an optimization that  allows
   for  fast  failure  when  a  single  character is used. They
   remember the last single character that is  required  for  a
   match,  and  fail early if it is not present in the string.)
   If the pattern is changed to
   
   <em>((?&gt;\D+)|&lt;\d+&gt;)*[!?]</em>
   
   sequences of non-digits cannot be broken, and  failure  happens quickly.
  </p>
 </div>
<section id="usernotes">
 <div class="head"><h3 class="title">User Contributed Notes</h3></div><div id="allnotes">
  <div class="note" id="104507">  
  <a class="name">
  <strong class="user"><em>northhero at gmail dot com</em></strong></a><div class="date" title="2011-06-19 01:54"><strong>3 years ago</strong></div>
  <div class="text" id="Hcom104507">
<div class="phpcode"><code><span class="html">
The following two patterns are not equal to each other:<br>(\D+|&lt;\d+&gt;)*[!?]&nbsp;&nbsp; and&nbsp;&nbsp; ((?&gt;\D+)|&lt;\d+&gt;)*[!?]<br><br>For example<br>The former matches the string of 'aaaaaaaaaaaa!', but the later does NOT.</span>
</code></div>
  </div>
 </div>
  <div class="note" id="114717">  
  <a class="name">
  <strong class="user"><em>Pedro Gimeno</em></strong></a><div class="date" title="2014-03-27 06:41"><strong>5 months ago</strong></div>
  <div class="text" id="Hcom114717">
<div class="phpcode"><code><span class="html">
The comment by northhero at gmail dot com below is wrong.<br><br><span class="default">&lt;?php<br><br>$pattern1 </span><span class="keyword">= </span><span class="string">'((?&gt;\D+)|&lt;\d+&gt;)*[!?]'</span><span class="keyword">;<br></span><span class="default">$pattern2 </span><span class="keyword">= </span><span class="string">'(\D+|&lt;\d+&gt;)*[!?]'</span><span class="keyword">;<br></span><span class="default">$subject </span><span class="keyword">= </span><span class="string">'aaaaaaaaaaaa!'</span><span class="keyword">;<br><br></span><span class="default">var_dump</span><span class="keyword">(</span><span class="default">preg_match</span><span class="keyword">(</span><span class="string">'/' </span><span class="keyword">. </span><span class="default">$pattern1 </span><span class="keyword">. </span><span class="string">'/'</span><span class="keyword">, </span><span class="default">$subject</span><span class="keyword">, </span><span class="default">$match</span><span class="keyword">));<br></span><span class="default">var_dump</span><span class="keyword">(</span><span class="default">$match</span><span class="keyword">);<br></span><span class="default">var_dump</span><span class="keyword">(</span><span class="default">preg_match</span><span class="keyword">(</span><span class="string">'/' </span><span class="keyword">. </span><span class="default">$pattern1 </span><span class="keyword">. </span><span class="string">'/'</span><span class="keyword">, </span><span class="default">$subject</span><span class="keyword">, </span><span class="default">$match</span><span class="keyword">));<br></span><span class="default">var_dump</span><span class="keyword">(</span><span class="default">$match</span><span class="keyword">);<br></span><span class="default">?&gt;<br></span><br>Output:<br><br>int(1)<br>array(1) {<br>&nbsp; [0]=&gt;<br>&nbsp; string(1) "!"<br>}<br>int(1)<br>array(1) {<br>&nbsp; [0]=&gt;<br>&nbsp; string(1) "!"<br>}<br><br>Both match.</span>
</code></div>
  </div>
 </div></div>

 
</section>    </section><!-- layout-content -->
        


  </div><!-- layout -->
         
  

    
 <!-- External and third party libraries. -->
 







<a id="toTop" href="javascript:;"><span id="toTopHover"></span><img width="40" height="40" alt="To Top" src="../../images/to-top%402x.png"></a>



<!-- Mirrored from php.net/manual/en/regexp.reference.onlyonce.php by HTTrack Website Copier/3.x [XR&CO'2013], Thu, 28 Aug 2014 17:07:27 GMT -->


</body></html>