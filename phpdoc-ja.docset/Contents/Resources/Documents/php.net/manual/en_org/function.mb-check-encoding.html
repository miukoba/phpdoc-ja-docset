<html><!-- Mirrored from php.net/manual/en/function.mb-check-encoding.php by HTTrack Website Copier/3.x [XR&CO'2013], Thu, 28 Aug 2014 16:21:40 GMT --><!-- Added by HTTrack --><head><meta http-equiv="content-type" content="text/html;charset=utf-8"><!-- /Added by HTTrack -->


  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0"> 

  <title>mb_check_encoding</title>

 <link rel="shortcut icon" href="../../favicon.ico">
 <link rel="search" type="application/opensearchdescription+xml" href="http://php.net/phpnetimprovedsearch.src" title="Add PHP.net search">
 <link rel="alternate" type="application/atom+xml" href="http://php.net/releases/feed.php" title="PHP Release feed">
 <link rel="alternate" type="application/atom+xml" href="http://php.net/feed.atom" title="PHP: Hypertext Preprocessor">

 <link rel="canonical" href="function.mb-check-encoding.html">
 <link rel="shorturl" href="http://php.net/mb-check-encoding">
 <link rel="alternate" href="http://php.net/mb-check-encoding" hreflang="x-default">

 <link rel="contents" href="index-2.html">
 <link rel="index" href="ref.mbstring.html">
 <link rel="prev" href="ref.mbstring.html">
 <link rel="next" href="function.mb-convert-case.html">

 <link rel="alternate" href="function.mb-check-encoding.html" hreflang="en">
 <link rel="alternate" href="http://php.net/manual/pt_BR/function.mb-check-encoding.php" hreflang="pt_BR">
 <link rel="alternate" href="http://php.net/manual/zh/function.mb-check-encoding.php" hreflang="zh">
 <link rel="alternate" href="http://php.net/manual/fr/function.mb-check-encoding.php" hreflang="fr">
 <link rel="alternate" href="http://php.net/manual/de/function.mb-check-encoding.php" hreflang="de">
 <link rel="alternate" href="http://php.net/manual/it/function.mb-check-encoding.php" hreflang="it">
 <link rel="alternate" href="http://php.net/manual/ja/function.mb-check-encoding.php" hreflang="ja">
 <link rel="alternate" href="http://php.net/manual/ro/function.mb-check-encoding.php" hreflang="ro">
 <link rel="alternate" href="http://php.net/manual/ru/function.mb-check-encoding.php" hreflang="ru">
 <link rel="alternate" href="http://php.net/manual/es/function.mb-check-encoding.php" hreflang="es">
 <link rel="alternate" href="http://php.net/manual/tr/function.mb-check-encoding.php" hreflang="tr">

<link rel="stylesheet" type="text/css" href="../../cached8fe1.css?t=1401250819&amp;f=/fonts/Fira/fira.css" media="screen">
<link rel="stylesheet" type="text/css" href="../../cached4b8d.css?t=1404368420&amp;f=/fonts/Font-Awesome/css/fontello.css" media="screen">
<link rel="stylesheet" type="text/css" href="../../cached5065.css?t=1403329232&amp;f=/styles/theme-base.css" media="screen">
<link rel="stylesheet" type="text/css" href="../../cachedc78d.css?t=1401249623&amp;f=/styles/theme-medium.css" media="screen">

 <!--[if lte IE 7]>
 <link rel="stylesheet" type="text/css" href="http://php.net/styles/workarounds.ie7.css" media="screen">
 <![endif]-->

 <!--[if lte IE 8]>
 <script type="text/javascript">
  window.brokenIE = true;
 </script>
 <![endif]-->

 <!--[if lte IE 9]>
 <link rel="stylesheet" type="text/css" href="http://php.net/styles/workarounds.ie9.css" media="screen">
 <![endif]-->

 <!--[if IE]>
 <script type="text/javascript" src="http://php.net/js/ext/html5.js"></script>
 <![endif]-->

 <base>

</head>
<body class="docs " style="">


<div class="headsup"><a href="http://php.net/index.php#id2014-08-28-1">PHP 5.6.0 released</a></div>
<nav id="trick"><div><dl>
<dt><a href="getting-started.html">Getting Started</a></dt>
	<dd><a href="introduction.html">Introduction</a></dd>
	<dd><a href="tutorial.html">A simple tutorial</a></dd>
<dt><a href="langref.html">Language Reference</a></dt>
	<dd><a href="language.basic-syntax.html">Basic syntax</a></dd>
	<dd><a href="language.types.html">Types</a></dd>
	<dd><a href="language.variables.html">Variables</a></dd>
	<dd><a href="language.constants.html">Constants</a></dd>
	<dd><a href="language.expressions.html">Expressions</a></dd>
	<dd><a href="language.operators.html">Operators</a></dd>
	<dd><a href="language.control-structures.html">Control Structures</a></dd>
	<dd><a href="language.functions.html">Functions</a></dd>
	<dd><a href="language.oop5.html">Classes and Objects</a></dd>
	<dd><a href="language.namespaces.html">Namespaces</a></dd>
	<dd><a href="language.exceptions.html">Exceptions</a></dd>
	<dd><a href="language.generators.html">Generators</a></dd>
	<dd><a href="language.references.html">References Explained</a></dd>
	<dd><a href="reserved.variables.html">Predefined Variables</a></dd>
	<dd><a href="reserved.exceptions.html">Predefined Exceptions</a></dd>
	<dd><a href="reserved.interfaces.html">Predefined Interfaces and Classes</a></dd>
	<dd><a href="context.html">Context options and parameters</a></dd>
	<dd><a href="wrappers.html">Supported Protocols and Wrappers</a></dd>
</dl>
<dl>
<dt><a href="security.html">Security</a></dt>
	<dd><a href="security.intro.html">Introduction</a></dd>
	<dd><a href="security.general.html">General considerations</a></dd>
	<dd><a href="security.cgi-bin.html">Installed as CGI binary</a></dd>
	<dd><a href="security.apache.html">Installed as an Apache module</a></dd>
	<dd><a href="security.filesystem.html">Filesystem Security</a></dd>
	<dd><a href="security.database.html">Database Security</a></dd>
	<dd><a href="security.errors.html">Error Reporting</a></dd>
	<dd><a href="security.globals.html">Using Register Globals</a></dd>
	<dd><a href="security.variables.html">User Submitted Data</a></dd>
	<dd><a href="security.magicquotes.html">Magic Quotes</a></dd>
	<dd><a href="security.hiding.html">Hiding PHP</a></dd>
	<dd><a href="security.current.html">Keeping Current</a></dd>
<dt><a href="features.html">Features</a></dt>
	<dd><a href="features.http-auth.html">HTTP authentication with PHP</a></dd>
	<dd><a href="features.cookies.html">Cookies</a></dd>
	<dd><a href="features.sessions.html">Sessions</a></dd>
	<dd><a href="features.xforms.html">Dealing with XForms</a></dd>
	<dd><a href="features.file-upload.html">Handling file uploads</a></dd>
	<dd><a href="features.remote-files.html">Using remote files</a></dd>
	<dd><a href="features.connection-handling.html">Connection handling</a></dd>
	<dd><a href="features.persistent-connections.html">Persistent Database Connections</a></dd>
	<dd><a href="features.safe-mode.html">Safe Mode</a></dd>
	<dd><a href="features.commandline.html">Command line usage</a></dd>
	<dd><a href="features.gc.html">Garbage Collection</a></dd>
	<dd><a href="features.dtrace.html">DTrace Dynamic Tracing</a></dd>
</dl>
<dl>
<dt><a href="funcref.html">Function Reference</a></dt>
	<dd><a href="refs.basic.php.html">Affecting PHP's Behaviour</a></dd>
	<dd><a href="refs.utilspec.audio.html">Audio Formats Manipulation</a></dd>
	<dd><a href="refs.remote.auth.html">Authentication Services</a></dd>
	<dd><a href="refs.utilspec.cmdline.html">Command Line Specific Extensions</a></dd>
	<dd><a href="refs.compression.html">Compression and Archive Extensions</a></dd>
	<dd><a href="refs.creditcard.html">Credit Card Processing</a></dd>
	<dd><a href="refs.crypto.html">Cryptography Extensions</a></dd>
	<dd><a href="refs.database.html">Database Extensions</a></dd>
	<dd><a href="refs.calendar.html">Date and Time Related Extensions</a></dd>
	<dd><a href="refs.fileprocess.file.html">File System Related Extensions</a></dd>
	<dd><a href="refs.international.html">Human Language and Character Encoding Support</a></dd>
	<dd><a href="refs.utilspec.image.html">Image Processing and Generation</a></dd>
	<dd><a href="refs.remote.mail.html">Mail Related Extensions</a></dd>
	<dd><a href="refs.math.html">Mathematical Extensions</a></dd>
	<dd><a href="refs.utilspec.nontext.html">Non-Text MIME Output</a></dd>
	<dd><a href="refs.fileprocess.process.html">Process Control Extensions</a></dd>
	<dd><a href="refs.basic.other.html">Other Basic Extensions</a></dd>
	<dd><a href="refs.remote.other.html">Other Services</a></dd>
	<dd><a href="refs.search.html">Search Engine Extensions</a></dd>
	<dd><a href="refs.utilspec.server.html">Server Specific Extensions</a></dd>
	<dd><a href="refs.basic.session.html">Session Extensions</a></dd>
	<dd><a href="refs.basic.text.html">Text Processing</a></dd>
	<dd><a href="refs.basic.vartype.html">Variable and Type Related Extensions</a></dd>
	<dd><a href="refs.webservice.html">Web Services</a></dd>
	<dd><a href="refs.utilspec.windows.html">Windows Only Extensions</a></dd>
	<dd><a href="refs.xml.html">XML Manipulation</a></dd>
</dl>
<dl>
<dt>Keyboard Shortcuts</dt><dt>?</dt>
<dd>This help</dd>
<dt>j</dt>
<dd>Next menu item</dd>
<dt>k</dt>
<dd>Previous menu item</dd>
<dt>g p</dt>
<dd>Previous man page</dd>
<dt>g n</dt>
<dd>Next man page</dd>
<dt>G</dt>
<dd>Scroll to bottom</dd>
<dt>g g</dt>
<dd>Scroll to top</dd>
<dt>g h</dt>
<dd>Goto homepage</dd>
<dt>g s</dt>
<dd>Goto search<br>(current page)</dd>
<dt>/</dt>
<dd>Focus search box</dd>
</dl></div></nav>
<div id="goto">
    <div class="search">
         <div class="text"></div>
         <div class="results"><ul></ul></div>
   </div>
</div>

  <div id="breadcrumbs" class="row-fluid">
          
              
        <ul class="breadcrumbs-container">
            <li><a href="index-2.html">PHP Manual</a></li>      <li><a href="funcref.html">Function Reference</a></li>      <li><a href="refs.international.html">Human Language and Character Encoding Support</a></li>      <li><a href="book.mbstring.html">Multibyte String</a></li>      <li><a href="ref.mbstring.html">Multibyte String Functions</a></li>    </ul>
  </div>




<div id="layout">
  <section id="layout-content">
  <div id="function.mb-check-encoding" class="refentry">
 <div class="refnamediv">
  <h1 class="refname">mb_check_encoding</h1>
  <p class="verinfo">(PHP 4 &gt;= 4.4.3, PHP 5 &gt;= 5.1.3)</p><p class="refpurpose"><span class="refname">mb_check_encoding</span> â€” <span class="dc-title">Check if the string is valid for the specified encoding</span></p>

 </div>

 <div class="refsect1 description" id="refsect1-function.mb-check-encoding-description">
  <h3 class="title">Description</h3>
  <div class="methodsynopsis dc-description">
   <span class="type">bool</span> <span class="methodname"><strong>mb_check_encoding</strong></span>
    ([ <span class="methodparam"><span class="type">string</span> <code class="parameter">$var</code><span class="initializer"> = <strong><code>NULL</code></strong></span></span>
   [, <span class="methodparam"><span class="type">string</span> <code class="parameter">$encoding</code><span class="initializer"> = mb_internal_encoding()</span></span>
  ]] )</div>

  <p class="para rdfs-comment">
   Checks if the specified byte stream is valid for the specified encoding.
   It is useful to prevent so-called "Invalid Encoding Attack".
  </p>
  <p class="para">
  </p>
 </div>


 <div class="refsect1 parameters" id="refsect1-function.mb-check-encoding-parameters">
  <h3 class="title">Parameters</h3>
  <p class="para">
   </p><dl>

    
     <dt>
<code class="parameter">var</code></dt>

     <dd>

      <p class="para">
       The byte stream to check. If it is omitted, this function checks
       all the input from the beginning of the request.
      </p>
     </dd>

    
    
     <dt>
<code class="parameter">encoding</code></dt>

     <dd>

      <p class="para">
       The expected encoding.
      </p>
     </dd>

    
   </dl>

  <p></p>
 </div>


 <div class="refsect1 returnvalues" id="refsect1-function.mb-check-encoding-returnvalues">
  <h3 class="title">Return Values</h3>
  <p class="para">
   Returns <strong><code>TRUE</code></strong> on success or <strong><code>FALSE</code></strong> on failure.
  </p>
 </div>


</div>
<section id="usernotes">
 <div class="head"><h3 class="title">User Contributed Notes</h3></div><div id="allnotes">
  <div class="note" id="112867">  
  <a class="name">
  <strong class="user"><em>Stefan W</em></strong></a><div class="date" title="2013-07-30 11:45"><strong>1 year ago</strong></div>
  <div class="text" id="Hcom112867">
<div class="phpcode"><code><span class="html">
Note that the algorithm in javalc6's comment checks UTF-8 compliance by the letter of the specs.<br><br>This means that overlong byte sequences will pass. For example: 0xC0 0xAF can be used to encode U+002F, the slash character. While legal, this character is more properly encoded as 0x2F. Overlong sequences are unnecessary and should be avoided; they have been - and still are - used in various attacks (like directory traversal attacks).<br><br>It also means that high Unicode characters outside the Basic Multilingual Plane will pass; this means characters above U+FFFF, composed of 4+ bytes (hieroglyhps, cuneiform, etc). You need to decide if you want those characters or not. If you do, be aware that they often cause compatibility problems (for example with JSON and some databases).<br><br>mb_check_encoding(), mb_detect_encoding(x, y, TRUE), and the other comments up to now all reject characters outside the BMP and overlong sequences.</span>
</code></div>
  </div>
 </div>
  <div class="note" id="113919">  
  <a class="name">
  <strong class="user"><em>eyecatchup at gmail dot com</em></strong></a><div class="date" title="2013-12-17 06:18"><strong>8 months ago</strong></div>
  <div class="text" id="Hcom113919">
<div class="phpcode"><code><span class="html">
Unlike other comments suggest, there's no need to serialize a string to use preg_match's "u" modifier for testing if a string is valid UTF-8. You can just use<br><span class="default">&lt;?php<br></span><span class="keyword">function </span><span class="default">is_utf8</span><span class="keyword">(</span><span class="default">$str</span><span class="keyword">) {<br>&nbsp; &nbsp; return (bool) </span><span class="default">preg_match</span><span class="keyword">(</span><span class="string">'//u'</span><span class="keyword">, </span><span class="default">$str</span><span class="keyword">);<br>}</span>
</span>
</code></div>
  </div>
 </div>
  <div class="note" id="114956">  
  <a class="name">
  <strong class="user"><em>Riikka K</em></strong></a><div class="date" title="2014-05-05 02:37"><strong>3 months ago</strong></div>
  <div class="text" id="Hcom114956">
<div class="phpcode"><code><span class="html">
To get more information about how this function validates UTF-8, I ran some tests on PHP 5.5.10, PHP 5.4.24 and PHP 5.3.28. It seems that the function detects valid and invalid byte sequences correctly according to UTF-8 and the Unicode specifications, except for one issue:<br><br>in PHP 5.3.28, the function allows code points above U+10FFFF, which also allows five and six byte sequences. The later versions have corrected this issue.<br><br>Other than that, each version works correctly. Overlong encodings, surrogates, any lone bytes above 0x80 and too short byte sequences are all considered invalid. All valid code points in Unicode are considered valid when encoded with correct number of bytes (including Astral planes, i.e. four byte squences below U+10FFFF).<br><br>mb_detect_encoding() provided similar results with strict parameter enabled (except for PHP 5.3.28, in which it performed worse than mb_check_encoding())</span>
</code></div>
  </div>
 </div>
  <div class="note" id="89286">  
  <a class="name">
  <strong class="user"><em>jbricci at ya-right dot com</em></strong></a><div class="date" title="2009-03-01 06:52"><strong>5 years ago</strong></div>
  <div class="text" id="Hcom89286">
<div class="phpcode"><code><span class="html">
This function does not check for bad byte sequence(s), it only checks if the byte stream is valid. If you want to verify a encoded string is valid, (IE: does not contain any bad byte sequences do the following...<br><br><span class="default">&lt;?php<br><br></span><span class="comment">/* check a strings encoded value */<br><br></span><span class="keyword">function </span><span class="default">checkEncoding </span><span class="keyword">( </span><span class="default">$string</span><span class="keyword">, </span><span class="default">$string_encoding </span><span class="keyword">)<br>{<br>&nbsp; &nbsp; </span><span class="default">$fs </span><span class="keyword">= </span><span class="default">$string_encoding </span><span class="keyword">== </span><span class="string">'UTF-8' </span><span class="keyword">? </span><span class="string">'UTF-32' </span><span class="keyword">: </span><span class="default">$string_encoding</span><span class="keyword">;<br><br>&nbsp; &nbsp; </span><span class="default">$ts </span><span class="keyword">= </span><span class="default">$string_encoding </span><span class="keyword">== </span><span class="string">'UTF-32' </span><span class="keyword">? </span><span class="string">'UTF-8' </span><span class="keyword">: </span><span class="default">$string_encoding</span><span class="keyword">;<br><br>&nbsp; &nbsp; return </span><span class="default">$string </span><span class="keyword">=== </span><span class="default">mb_convert_encoding </span><span class="keyword">( </span><span class="default">mb_convert_encoding </span><span class="keyword">( </span><span class="default">$string</span><span class="keyword">, </span><span class="default">$fs</span><span class="keyword">, </span><span class="default">$ts </span><span class="keyword">), </span><span class="default">$ts</span><span class="keyword">, </span><span class="default">$fs </span><span class="keyword">);<br>}<br><br></span><span class="comment">/* test 1 variables */<br><br></span><span class="default">$string </span><span class="keyword">= </span><span class="string">"\x00\x81"</span><span class="keyword">;<br><br></span><span class="default">$encoding </span><span class="keyword">= </span><span class="string">"Shift_JIS"</span><span class="keyword">;<br><br></span><span class="comment">/* test 1 mb_check_encoding (test for bad byte stream) */<br><br></span><span class="keyword">if ( </span><span class="default">true </span><span class="keyword">=== </span><span class="default">mb_check_encoding </span><span class="keyword">( </span><span class="default">$string</span><span class="keyword">, </span><span class="default">$encoding </span><span class="keyword">) )<br>{<br>&nbsp; &nbsp; echo </span><span class="string">'valid (' </span><span class="keyword">. </span><span class="default">$encoding </span><span class="keyword">. </span><span class="string">') encoded byte stream!&lt;br /&gt;'</span><span class="keyword">;<br>}<br>else<br>{<br>&nbsp; &nbsp; echo </span><span class="string">'invalid (' </span><span class="keyword">. </span><span class="default">$encoding </span><span class="keyword">. </span><span class="string">') encoded byte stream!&lt;br /&gt;'</span><span class="keyword">;<br>}<br><br></span><span class="comment">/* test 1 checkEncoding (test for bad byte sequence(s)) */<br><br></span><span class="keyword">if ( </span><span class="default">true </span><span class="keyword">=== </span><span class="default">checkEncoding </span><span class="keyword">( </span><span class="default">$string</span><span class="keyword">, </span><span class="default">$encoding </span><span class="keyword">) )<br>{<br>&nbsp; &nbsp; echo </span><span class="string">'valid (' </span><span class="keyword">. </span><span class="default">$encoding </span><span class="keyword">. </span><span class="string">') encoded byte sequence!&lt;br /&gt;'</span><span class="keyword">;<br>}<br>else<br>{<br>&nbsp; &nbsp; echo </span><span class="string">'invalid (' </span><span class="keyword">. </span><span class="default">$encoding </span><span class="keyword">. </span><span class="string">') encoded byte sequence!&lt;br /&gt;'</span><span class="keyword">;<br>}<br><br></span><span class="comment">/* test 2 */<br><br>/* test 2 variables */<br><br></span><span class="default">$string </span><span class="keyword">= </span><span class="string">"\x00\xE3"</span><span class="keyword">;<br><br></span><span class="default">$encoding </span><span class="keyword">= </span><span class="string">"UTF-8"</span><span class="keyword">;<br><br></span><span class="comment">/* test 2 mb_check_encoding (test for bad byte stream) */<br><br></span><span class="keyword">if ( </span><span class="default">true </span><span class="keyword">=== </span><span class="default">mb_check_encoding </span><span class="keyword">( </span><span class="default">$string</span><span class="keyword">, </span><span class="default">$encoding </span><span class="keyword">) )<br>{<br>&nbsp; &nbsp; echo </span><span class="string">'valid (' </span><span class="keyword">. </span><span class="default">$encoding </span><span class="keyword">. </span><span class="string">') encoded byte stream!&lt;br /&gt;'</span><span class="keyword">;<br>}<br>else<br>{<br>&nbsp; &nbsp; echo </span><span class="string">'invalid (' </span><span class="keyword">. </span><span class="default">$encoding </span><span class="keyword">. </span><span class="string">') encoded byte stream!&lt;br /&gt;'</span><span class="keyword">;<br>}<br><br></span><span class="comment">/* test 2 checkEncoding (test for bad byte sequence(s)) */<br><br></span><span class="keyword">if ( </span><span class="default">true </span><span class="keyword">=== </span><span class="default">checkEncoding </span><span class="keyword">( </span><span class="default">$string</span><span class="keyword">, </span><span class="default">$encoding </span><span class="keyword">) )<br>{<br>&nbsp; &nbsp; echo </span><span class="string">'valid (' </span><span class="keyword">. </span><span class="default">$encoding </span><span class="keyword">. </span><span class="string">') encoded byte sequence!&lt;br /&gt;'</span><span class="keyword">;<br>}<br>else<br>{<br>&nbsp; &nbsp; echo </span><span class="string">'invalid (' </span><span class="keyword">. </span><span class="default">$encoding </span><span class="keyword">. </span><span class="string">') encoded byte sequence!&lt;br /&gt;'</span><span class="keyword">;<br>}<br><br></span><span class="default">?&gt;</span>
</span>
</code></div>
  </div>
 </div>
  <div class="note" id="95289">  
  <a class="name">
  <strong class="user"><em>javalc6 at gmail dot com</em></strong></a><div class="date" title="2009-12-24 04:52"><strong>4 years ago</strong></div>
  <div class="text" id="Hcom95289">
<div class="phpcode"><code><span class="html">
In order to check if a string is encoded correctly in utf-8, I suggest the following function, that implements the RFC3629 better than mb_check_encoding():
<br>
<br><span class="default">&lt;?php
<br></span><span class="keyword">function </span><span class="default">check_utf8</span><span class="keyword">(</span><span class="default">$str</span><span class="keyword">) {
<br>&nbsp; &nbsp; </span><span class="default">$len </span><span class="keyword">= </span><span class="default">strlen</span><span class="keyword">(</span><span class="default">$str</span><span class="keyword">);
<br>&nbsp; &nbsp; for(</span><span class="default">$i </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">; </span><span class="default">$i </span><span class="keyword">&lt; </span><span class="default">$len</span><span class="keyword">; </span><span class="default">$i</span><span class="keyword">++){
<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$c </span><span class="keyword">= </span><span class="default">ord</span><span class="keyword">(</span><span class="default">$str</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">]);
<br>&nbsp; &nbsp; &nbsp; &nbsp; if (</span><span class="default">$c </span><span class="keyword">&gt; </span><span class="default">128</span><span class="keyword">) {
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if ((</span><span class="default">$c </span><span class="keyword">&gt; </span><span class="default">247</span><span class="keyword">)) return </span><span class="default">false</span><span class="keyword">;
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; elseif (</span><span class="default">$c </span><span class="keyword">&gt; </span><span class="default">239</span><span class="keyword">) </span><span class="default">$bytes </span><span class="keyword">= </span><span class="default">4</span><span class="keyword">;
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; elseif (</span><span class="default">$c </span><span class="keyword">&gt; </span><span class="default">223</span><span class="keyword">) </span><span class="default">$bytes </span><span class="keyword">= </span><span class="default">3</span><span class="keyword">;
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; elseif (</span><span class="default">$c </span><span class="keyword">&gt; </span><span class="default">191</span><span class="keyword">) </span><span class="default">$bytes </span><span class="keyword">= </span><span class="default">2</span><span class="keyword">;
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; else return </span><span class="default">false</span><span class="keyword">;
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if ((</span><span class="default">$i </span><span class="keyword">+ </span><span class="default">$bytes</span><span class="keyword">) &gt; </span><span class="default">$len</span><span class="keyword">) return </span><span class="default">false</span><span class="keyword">;
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; while (</span><span class="default">$bytes </span><span class="keyword">&gt; </span><span class="default">1</span><span class="keyword">) {
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$i</span><span class="keyword">++;
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$b </span><span class="keyword">= </span><span class="default">ord</span><span class="keyword">(</span><span class="default">$str</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">]);
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if (</span><span class="default">$b </span><span class="keyword">&lt; </span><span class="default">128 </span><span class="keyword">|| </span><span class="default">$b </span><span class="keyword">&gt; </span><span class="default">191</span><span class="keyword">) return </span><span class="default">false</span><span class="keyword">;
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$bytes</span><span class="keyword">--;
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }
<br>&nbsp; &nbsp; &nbsp; &nbsp; }
<br>&nbsp; &nbsp; }
<br>&nbsp; &nbsp; return </span><span class="default">true</span><span class="keyword">;
<br>} </span><span class="comment">// end of check_utf8
<br></span><span class="default">?&gt;</span>
</span>
</code></div>
  </div>
 </div>
  <div class="note" id="112756">  
  <a class="name">
  <strong class="user"><em>CertaiN</em></strong></a><div class="date" title="2013-07-19 08:13"><strong>1 year ago</strong></div>
  <div class="text" id="Hcom112756">
<div class="phpcode"><code><span class="html">
For supporting non-scalar variables,<br><br><span class="default">&lt;?php<br></span><span class="keyword">function </span><span class="default">validate_utf8</span><span class="keyword">(</span><span class="default">$input</span><span class="keyword">) {<br>&nbsp; &nbsp; return (bool)</span><span class="default">preg_match</span><span class="keyword">(</span><span class="string">'//u'</span><span class="keyword">, </span><span class="default">serialize</span><span class="keyword">(</span><span class="default">$input</span><span class="keyword">));<br>}</span>
</span>
</code></div>
  </div>
 </div>
  <div class="note" id="112755">  
  <a class="name">
  <strong class="user"><em>CertaiN</em></strong></a><div class="date" title="2013-07-19 08:07"><strong>1 year ago</strong></div>
  <div class="text" id="Hcom112755">
<div class="phpcode"><code><span class="html">
The best way to validate UTF-8 sequence.<br>This works for not only scalar, but also array and object recursively.<br><br><span class="default">&lt;?php<br><br></span><span class="keyword">function </span><span class="default">is_valid_utf8</span><span class="keyword">(</span><span class="default">$text</span><span class="keyword">) {<br>&nbsp; &nbsp; return (bool)</span><span class="default">preg_match</span><span class="keyword">(</span><span class="string">'//u'</span><span class="keyword">, </span><span class="default">serialize</span><span class="keyword">(</span><span class="default">$text</span><span class="keyword">));<br>}<br><br></span><span class="default">?&gt;</span>
</span>
</code></div>
  </div>
 </div></div>

 
</section>    </section><!-- layout-content -->
        


  </div><!-- layout -->
         
  

    
 <!-- External and third party libraries. -->
 







<a id="toTop" href="javascript:;"><span id="toTopHover"></span><img width="40" height="40" alt="To Top" src="../../images/to-top%402x.png"></a>



<!-- Mirrored from php.net/manual/en/function.mb-check-encoding.php by HTTrack Website Copier/3.x [XR&CO'2013], Thu, 28 Aug 2014 16:21:40 GMT -->


</body></html>