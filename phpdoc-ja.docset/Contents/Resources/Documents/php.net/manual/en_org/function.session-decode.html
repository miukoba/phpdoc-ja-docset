<html><!-- Mirrored from php.net/manual/en/function.session-decode.php by HTTrack Website Copier/3.x [XR&CO'2013], Thu, 28 Aug 2014 16:07:59 GMT --><!-- Added by HTTrack --><head><meta http-equiv="content-type" content="text/html;charset=utf-8"><!-- /Added by HTTrack -->


  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0"> 

  <title>session_decode</title>

 <link rel="shortcut icon" href="../../favicon.ico">
 <link rel="search" type="application/opensearchdescription+xml" href="http://php.net/phpnetimprovedsearch.src" title="Add PHP.net search">
 <link rel="alternate" type="application/atom+xml" href="http://php.net/releases/feed.php" title="PHP Release feed">
 <link rel="alternate" type="application/atom+xml" href="http://php.net/feed.atom" title="PHP: Hypertext Preprocessor">

 <link rel="canonical" href="function.session-decode.html">
 <link rel="shorturl" href="http://php.net/session-decode">
 <link rel="alternate" href="http://php.net/session-decode" hreflang="x-default">

 <link rel="contents" href="index-2.html">
 <link rel="index" href="ref.session.html">
 <link rel="prev" href="function.session-commit.html">
 <link rel="next" href="function.session-destroy.html">

 <link rel="alternate" href="function.session-decode.html" hreflang="en">
 <link rel="alternate" href="http://php.net/manual/pt_BR/function.session-decode.php" hreflang="pt_BR">
 <link rel="alternate" href="http://php.net/manual/zh/function.session-decode.php" hreflang="zh">
 <link rel="alternate" href="http://php.net/manual/fr/function.session-decode.php" hreflang="fr">
 <link rel="alternate" href="http://php.net/manual/de/function.session-decode.php" hreflang="de">
 <link rel="alternate" href="http://php.net/manual/it/function.session-decode.php" hreflang="it">
 <link rel="alternate" href="http://php.net/manual/ja/function.session-decode.php" hreflang="ja">
 <link rel="alternate" href="http://php.net/manual/ro/function.session-decode.php" hreflang="ro">
 <link rel="alternate" href="http://php.net/manual/ru/function.session-decode.php" hreflang="ru">
 <link rel="alternate" href="http://php.net/manual/es/function.session-decode.php" hreflang="es">
 <link rel="alternate" href="http://php.net/manual/tr/function.session-decode.php" hreflang="tr">

<link rel="stylesheet" type="text/css" href="../../cached8fe1.css?t=1401250819&amp;f=/fonts/Fira/fira.css" media="screen">
<link rel="stylesheet" type="text/css" href="../../cached4b8d.css?t=1404368420&amp;f=/fonts/Font-Awesome/css/fontello.css" media="screen">
<link rel="stylesheet" type="text/css" href="../../cached5065.css?t=1403329232&amp;f=/styles/theme-base.css" media="screen">
<link rel="stylesheet" type="text/css" href="../../cachedc78d.css?t=1401249623&amp;f=/styles/theme-medium.css" media="screen">

 <!--[if lte IE 7]>
 <link rel="stylesheet" type="text/css" href="http://php.net/styles/workarounds.ie7.css" media="screen">
 <![endif]-->

 <!--[if lte IE 8]>
 <script type="text/javascript">
  window.brokenIE = true;
 </script>
 <![endif]-->

 <!--[if lte IE 9]>
 <link rel="stylesheet" type="text/css" href="http://php.net/styles/workarounds.ie9.css" media="screen">
 <![endif]-->

 <!--[if IE]>
 <script type="text/javascript" src="http://php.net/js/ext/html5.js"></script>
 <![endif]-->

 <base>

</head>
<body class="docs " style="">


<div class="headsup"><a href="http://php.net/index.php#id2014-08-28-1">PHP 5.6.0 released</a></div>
<nav id="trick"><div><dl>
<dt><a href="getting-started.html">Getting Started</a></dt>
	<dd><a href="introduction.html">Introduction</a></dd>
	<dd><a href="tutorial.html">A simple tutorial</a></dd>
<dt><a href="langref.html">Language Reference</a></dt>
	<dd><a href="language.basic-syntax.html">Basic syntax</a></dd>
	<dd><a href="language.types.html">Types</a></dd>
	<dd><a href="language.variables.html">Variables</a></dd>
	<dd><a href="language.constants.html">Constants</a></dd>
	<dd><a href="language.expressions.html">Expressions</a></dd>
	<dd><a href="language.operators.html">Operators</a></dd>
	<dd><a href="language.control-structures.html">Control Structures</a></dd>
	<dd><a href="language.functions.html">Functions</a></dd>
	<dd><a href="language.oop5.html">Classes and Objects</a></dd>
	<dd><a href="language.namespaces.html">Namespaces</a></dd>
	<dd><a href="language.exceptions.html">Exceptions</a></dd>
	<dd><a href="language.generators.html">Generators</a></dd>
	<dd><a href="language.references.html">References Explained</a></dd>
	<dd><a href="reserved.variables.html">Predefined Variables</a></dd>
	<dd><a href="reserved.exceptions.html">Predefined Exceptions</a></dd>
	<dd><a href="reserved.interfaces.html">Predefined Interfaces and Classes</a></dd>
	<dd><a href="context.html">Context options and parameters</a></dd>
	<dd><a href="wrappers.html">Supported Protocols and Wrappers</a></dd>
</dl>
<dl>
<dt><a href="security.html">Security</a></dt>
	<dd><a href="security.intro.html">Introduction</a></dd>
	<dd><a href="security.general.html">General considerations</a></dd>
	<dd><a href="security.cgi-bin.html">Installed as CGI binary</a></dd>
	<dd><a href="security.apache.html">Installed as an Apache module</a></dd>
	<dd><a href="security.filesystem.html">Filesystem Security</a></dd>
	<dd><a href="security.database.html">Database Security</a></dd>
	<dd><a href="security.errors.html">Error Reporting</a></dd>
	<dd><a href="security.globals.html">Using Register Globals</a></dd>
	<dd><a href="security.variables.html">User Submitted Data</a></dd>
	<dd><a href="security.magicquotes.html">Magic Quotes</a></dd>
	<dd><a href="security.hiding.html">Hiding PHP</a></dd>
	<dd><a href="security.current.html">Keeping Current</a></dd>
<dt><a href="features.html">Features</a></dt>
	<dd><a href="features.http-auth.html">HTTP authentication with PHP</a></dd>
	<dd><a href="features.cookies.html">Cookies</a></dd>
	<dd><a href="features.sessions.html">Sessions</a></dd>
	<dd><a href="features.xforms.html">Dealing with XForms</a></dd>
	<dd><a href="features.file-upload.html">Handling file uploads</a></dd>
	<dd><a href="features.remote-files.html">Using remote files</a></dd>
	<dd><a href="features.connection-handling.html">Connection handling</a></dd>
	<dd><a href="features.persistent-connections.html">Persistent Database Connections</a></dd>
	<dd><a href="features.safe-mode.html">Safe Mode</a></dd>
	<dd><a href="features.commandline.html">Command line usage</a></dd>
	<dd><a href="features.gc.html">Garbage Collection</a></dd>
	<dd><a href="features.dtrace.html">DTrace Dynamic Tracing</a></dd>
</dl>
<dl>
<dt><a href="funcref.html">Function Reference</a></dt>
	<dd><a href="refs.basic.php.html">Affecting PHP's Behaviour</a></dd>
	<dd><a href="refs.utilspec.audio.html">Audio Formats Manipulation</a></dd>
	<dd><a href="refs.remote.auth.html">Authentication Services</a></dd>
	<dd><a href="refs.utilspec.cmdline.html">Command Line Specific Extensions</a></dd>
	<dd><a href="refs.compression.html">Compression and Archive Extensions</a></dd>
	<dd><a href="refs.creditcard.html">Credit Card Processing</a></dd>
	<dd><a href="refs.crypto.html">Cryptography Extensions</a></dd>
	<dd><a href="refs.database.html">Database Extensions</a></dd>
	<dd><a href="refs.calendar.html">Date and Time Related Extensions</a></dd>
	<dd><a href="refs.fileprocess.file.html">File System Related Extensions</a></dd>
	<dd><a href="refs.international.html">Human Language and Character Encoding Support</a></dd>
	<dd><a href="refs.utilspec.image.html">Image Processing and Generation</a></dd>
	<dd><a href="refs.remote.mail.html">Mail Related Extensions</a></dd>
	<dd><a href="refs.math.html">Mathematical Extensions</a></dd>
	<dd><a href="refs.utilspec.nontext.html">Non-Text MIME Output</a></dd>
	<dd><a href="refs.fileprocess.process.html">Process Control Extensions</a></dd>
	<dd><a href="refs.basic.other.html">Other Basic Extensions</a></dd>
	<dd><a href="refs.remote.other.html">Other Services</a></dd>
	<dd><a href="refs.search.html">Search Engine Extensions</a></dd>
	<dd><a href="refs.utilspec.server.html">Server Specific Extensions</a></dd>
	<dd><a href="refs.basic.session.html">Session Extensions</a></dd>
	<dd><a href="refs.basic.text.html">Text Processing</a></dd>
	<dd><a href="refs.basic.vartype.html">Variable and Type Related Extensions</a></dd>
	<dd><a href="refs.webservice.html">Web Services</a></dd>
	<dd><a href="refs.utilspec.windows.html">Windows Only Extensions</a></dd>
	<dd><a href="refs.xml.html">XML Manipulation</a></dd>
</dl>
<dl>
<dt>Keyboard Shortcuts</dt><dt>?</dt>
<dd>This help</dd>
<dt>j</dt>
<dd>Next menu item</dd>
<dt>k</dt>
<dd>Previous menu item</dd>
<dt>g p</dt>
<dd>Previous man page</dd>
<dt>g n</dt>
<dd>Next man page</dd>
<dt>G</dt>
<dd>Scroll to bottom</dd>
<dt>g g</dt>
<dd>Scroll to top</dd>
<dt>g h</dt>
<dd>Goto homepage</dd>
<dt>g s</dt>
<dd>Goto search<br>(current page)</dd>
<dt>/</dt>
<dd>Focus search box</dd>
</dl></div></nav>
<div id="goto">
    <div class="search">
         <div class="text"></div>
         <div class="results"><ul></ul></div>
   </div>
</div>

  <div id="breadcrumbs" class="row-fluid">
          
              
        <ul class="breadcrumbs-container">
            <li><a href="index-2.html">PHP Manual</a></li>      <li><a href="funcref.html">Function Reference</a></li>      <li><a href="refs.basic.session.html">Session Extensions</a></li>      <li><a href="book.session.html">Sessions</a></li>      <li><a href="ref.session.html">Session Functions</a></li>    </ul>
  </div>




<div id="layout">
  <section id="layout-content">
  <div id="function.session-decode" class="refentry">
 <div class="refnamediv">
  <h1 class="refname">session_decode</h1>
  <p class="verinfo">(PHP 4, PHP 5)</p><p class="refpurpose"><span class="refname">session_decode</span> â€” <span class="dc-title">Decodes session data from a session encoded string</span></p>

 </div>

 <div class="refsect1 description" id="refsect1-function.session-decode-description">
  <h3 class="title">Description</h3>
  <div class="methodsynopsis dc-description">
   <span class="type">bool</span> <span class="methodname"><strong>session_decode</strong></span>
    ( <span class="methodparam"><span class="type">string</span> <code class="parameter">$data</code></span>
   )</div>

  <p class="para rdfs-comment">
   <span class="function"><strong>session_decode()</strong></span> decodes the serialized session data provided in
   <code class="parameter">$data</code>, and populates the $_SESSION superglobal
   with the result.
  </p>
  <p class="para">
   Please note the unserialization method is not the same as <span class="function"><a href="function.unserialize.html" class="function">unserialize()</a></span>.
   The serialization method is internal to PHP and can be set using 
   <a href="session.configuration.html#ini.session.serialize-handler" class="link">session.serialize_handler</a>.
  </p>
 </div>


 <div class="refsect1 parameters" id="refsect1-function.session-decode-parameters">
  <h3 class="title">Parameters</h3>
  <p class="para">
   </p><dl>

    
     <dt>
<code class="parameter">data</code></dt>

     <dd>

      <p class="para">
       The encoded data to be stored.
      </p>
     </dd>

    
   </dl>

  <p></p>
 </div>


 <div class="refsect1 returnvalues" id="refsect1-function.session-decode-returnvalues">
  <h3 class="title">Return Values</h3>
  <p class="para">
   Returns <strong><code>TRUE</code></strong> on success or <strong><code>FALSE</code></strong> on failure.
  </p>
 </div>


 <div class="refsect1 seealso" id="refsect1-function.session-decode-seealso">
  <h3 class="title">See Also</h3>
  <p class="para">
   </p><ul class="simplelist">
    <li class="member"><span class="function"><a href="function.session-encode.html" class="function" rel="rdfs-seeAlso">session_encode()</a> - Encodes the current session data as a session encoded string</span></li>
    <li class="member"><a href="session.configuration.html#ini.session.serialize-handler" class="link">session.serialize_handler</a></li>
   </ul>
  <p></p>
 </div>


</div>
<section id="usernotes">
 <div class="head"><h3 class="title">User Contributed Notes</h3></div><div id="allnotes">
  <div class="note" id="108037">  
  <a class="name">
  <strong class="user"><em>Frits dot vanCampen at moxio dot com</em></strong></a><div class="date" title="2012-03-23 05:24"><strong>2 years ago</strong></div>
  <div class="text" id="Hcom108037">
<div class="phpcode"><code><span class="html">
I noticed that the posted solutions for manually decoding sessions are not perfect, so I've contributed a more robust solution.<br><br>The preg_match solution can never work. It's not so hard to find a case that might break unserialization.<br>In the case of jason-joeymail is breaks on:<br><br><span class="default">&lt;?php<br>$_SESSION</span><span class="keyword">[</span><span class="string">"test"</span><span class="keyword">] = </span><span class="string">";oops|"</span><span class="keyword">;<br></span><span class="default">?&gt;<br></span><br>Below you can find my solution. It doesn't use a regular expression but rather the reversibility of the serialize operation and the 'feature' that serialize ignores all further input when it thinks it's done. It's by no means a beautiful or particularly fast solution but it is a more robust solution.<br>I've added a deserializer for "php" and "php_binary". It should be trivial to add one for "wddx".<br><br><span class="default">&lt;?php<br></span><span class="keyword">class </span><span class="default">Session </span><span class="keyword">{<br>&nbsp; &nbsp; public static function </span><span class="default">unserialize</span><span class="keyword">(</span><span class="default">$session_data</span><span class="keyword">) {<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$method </span><span class="keyword">= </span><span class="default">ini_get</span><span class="keyword">(</span><span class="string">"session.serialize_handler"</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; switch (</span><span class="default">$method</span><span class="keyword">) {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; case </span><span class="string">"php"</span><span class="keyword">:<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; return </span><span class="default">self</span><span class="keyword">::</span><span class="default">unserialize_php</span><span class="keyword">(</span><span class="default">$session_data</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; break;<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; case </span><span class="string">"php_binary"</span><span class="keyword">:<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; return </span><span class="default">self</span><span class="keyword">::</span><span class="default">unserialize_phpbinary</span><span class="keyword">(</span><span class="default">$session_data</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; break;<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; default:<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; throw new </span><span class="default">Exception</span><span class="keyword">(</span><span class="string">"Unsupported session.serialize_handler: " </span><span class="keyword">. </span><span class="default">$method </span><span class="keyword">. </span><span class="string">". Supported: php, php_binary"</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; }<br>&nbsp; &nbsp; }<br><br>&nbsp; &nbsp; private static function </span><span class="default">unserialize_php</span><span class="keyword">(</span><span class="default">$session_data</span><span class="keyword">) {<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$return_data </span><span class="keyword">= array();<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$offset </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; while (</span><span class="default">$offset </span><span class="keyword">&lt; </span><span class="default">strlen</span><span class="keyword">(</span><span class="default">$session_data</span><span class="keyword">)) {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if (!</span><span class="default">strstr</span><span class="keyword">(</span><span class="default">substr</span><span class="keyword">(</span><span class="default">$session_data</span><span class="keyword">, </span><span class="default">$offset</span><span class="keyword">), </span><span class="string">"|"</span><span class="keyword">)) {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; throw new </span><span class="default">Exception</span><span class="keyword">(</span><span class="string">"invalid data, remaining: " </span><span class="keyword">. </span><span class="default">substr</span><span class="keyword">(</span><span class="default">$session_data</span><span class="keyword">, </span><span class="default">$offset</span><span class="keyword">));<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$pos </span><span class="keyword">= </span><span class="default">strpos</span><span class="keyword">(</span><span class="default">$session_data</span><span class="keyword">, </span><span class="string">"|"</span><span class="keyword">, </span><span class="default">$offset</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$num </span><span class="keyword">= </span><span class="default">$pos </span><span class="keyword">- </span><span class="default">$offset</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$varname </span><span class="keyword">= </span><span class="default">substr</span><span class="keyword">(</span><span class="default">$session_data</span><span class="keyword">, </span><span class="default">$offset</span><span class="keyword">, </span><span class="default">$num</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$offset </span><span class="keyword">+= </span><span class="default">$num </span><span class="keyword">+ </span><span class="default">1</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$data </span><span class="keyword">= </span><span class="default">unserialize</span><span class="keyword">(</span><span class="default">substr</span><span class="keyword">(</span><span class="default">$session_data</span><span class="keyword">, </span><span class="default">$offset</span><span class="keyword">));<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$return_data</span><span class="keyword">[</span><span class="default">$varname</span><span class="keyword">] = </span><span class="default">$data</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$offset </span><span class="keyword">+= </span><span class="default">strlen</span><span class="keyword">(</span><span class="default">serialize</span><span class="keyword">(</span><span class="default">$data</span><span class="keyword">));<br>&nbsp; &nbsp; &nbsp; &nbsp; }<br>&nbsp; &nbsp; &nbsp; &nbsp; return </span><span class="default">$return_data</span><span class="keyword">;<br>&nbsp; &nbsp; }<br><br>&nbsp; &nbsp; private static function </span><span class="default">unserialize_phpbinary</span><span class="keyword">(</span><span class="default">$session_data</span><span class="keyword">) {<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$return_data </span><span class="keyword">= array();<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$offset </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; while (</span><span class="default">$offset </span><span class="keyword">&lt; </span><span class="default">strlen</span><span class="keyword">(</span><span class="default">$session_data</span><span class="keyword">)) {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$num </span><span class="keyword">= </span><span class="default">ord</span><span class="keyword">(</span><span class="default">$session_data</span><span class="keyword">[</span><span class="default">$offset</span><span class="keyword">]);<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$offset </span><span class="keyword">+= </span><span class="default">1</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$varname </span><span class="keyword">= </span><span class="default">substr</span><span class="keyword">(</span><span class="default">$session_data</span><span class="keyword">, </span><span class="default">$offset</span><span class="keyword">, </span><span class="default">$num</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$offset </span><span class="keyword">+= </span><span class="default">$num</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$data </span><span class="keyword">= </span><span class="default">unserialize</span><span class="keyword">(</span><span class="default">substr</span><span class="keyword">(</span><span class="default">$session_data</span><span class="keyword">, </span><span class="default">$offset</span><span class="keyword">));<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$return_data</span><span class="keyword">[</span><span class="default">$varname</span><span class="keyword">] = </span><span class="default">$data</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$offset </span><span class="keyword">+= </span><span class="default">strlen</span><span class="keyword">(</span><span class="default">serialize</span><span class="keyword">(</span><span class="default">$data</span><span class="keyword">));<br>&nbsp; &nbsp; &nbsp; &nbsp; }<br>&nbsp; &nbsp; &nbsp; &nbsp; return </span><span class="default">$return_data</span><span class="keyword">;<br>&nbsp; &nbsp; }<br>}<br></span><span class="default">?&gt;<br></span><br>Usage:<br><br><span class="default">&lt;?php<br>Session</span><span class="keyword">::</span><span class="default">unserialize</span><span class="keyword">(</span><span class="default">session_encode</span><span class="keyword">());<br></span><span class="default">?&gt;</span>
</span>
</code></div>
  </div>
 </div>
  <div class="note" id="113523">  
  <a class="name">
  <strong class="user"><em>frank at interactinet dot com</em></strong></a><div class="date" title="2013-10-24 03:58"><strong>10 months ago</strong></div>
  <div class="text" id="Hcom113523">
<div class="phpcode"><code><span class="html">
I found this to be the simplest solution:<br><br><span class="default">&lt;?php<br></span><span class="comment">// if session is not started<br></span><span class="default">session_start</span><span class="keyword">();<br><br></span><span class="comment">// store our current session<br></span><span class="default">$my_sess </span><span class="keyword">= </span><span class="default">$_SESSION</span><span class="keyword">;<br><br></span><span class="comment">// decode $data (the encoded session data, either from a file or database). Remember, decoded data is put directly into $_SESSION<br></span><span class="default">session_decode</span><span class="keyword">(</span><span class="default">$data</span><span class="keyword">);<br></span><span class="default">$data </span><span class="keyword">= </span><span class="default">$_SESSION</span><span class="keyword">;<br><br></span><span class="default">print_r</span><span class="keyword">(</span><span class="default">$data</span><span class="keyword">);<br><br></span><span class="comment">// restore our own session<br></span><span class="default">$_SESSION </span><span class="keyword">= </span><span class="default">$my_sess</span><span class="keyword">;<br><br></span><span class="default">?&gt;</span>
</span>
</code></div>
  </div>
 </div>
  <div class="note" id="101687">  
  <a class="name">
  <strong class="user"><em>jason at joeymail dot net</em></strong></a><div class="date" title="2011-01-04 04:23"><strong>3 years ago</strong></div>
  <div class="text" id="Hcom101687">
<div class="phpcode"><code><span class="html">
Yet another attempt a wheel re-invention, using match with offsets rather than split...<br><br><span class="default">&lt;?php<br></span><span class="keyword">function </span><span class="default">unserializesession</span><span class="keyword">( </span><span class="default">$data </span><span class="keyword">)<br>{<br>&nbsp; &nbsp; if(&nbsp; </span><span class="default">strlen</span><span class="keyword">( </span><span class="default">$data</span><span class="keyword">) == </span><span class="default">0</span><span class="keyword">)<br>&nbsp; &nbsp; {<br>&nbsp; &nbsp; &nbsp; &nbsp; return array();<br>&nbsp; &nbsp; }<br>&nbsp; &nbsp; <br>&nbsp; &nbsp; </span><span class="comment">// match all the session keys and offsets<br>&nbsp; &nbsp; </span><span class="default">preg_match_all</span><span class="keyword">(</span><span class="string">'/(^|;|\})([a-zA-Z0-9_]+)\|/i'</span><span class="keyword">, </span><span class="default">$data</span><span class="keyword">, </span><span class="default">$matchesarray</span><span class="keyword">, </span><span class="default">PREG_OFFSET_CAPTURE</span><span class="keyword">);<br><br>&nbsp; &nbsp; </span><span class="default">$returnArray </span><span class="keyword">= array();<br><br>&nbsp; &nbsp; </span><span class="default">$lastOffset </span><span class="keyword">= </span><span class="default">null</span><span class="keyword">;<br>&nbsp; &nbsp; </span><span class="default">$currentKey </span><span class="keyword">= </span><span class="string">''</span><span class="keyword">;<br>&nbsp; &nbsp; foreach ( </span><span class="default">$matchesarray</span><span class="keyword">[</span><span class="default">2</span><span class="keyword">] as </span><span class="default">$value </span><span class="keyword">)<br>&nbsp; &nbsp; {<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$offset </span><span class="keyword">= </span><span class="default">$value</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">];<br>&nbsp; &nbsp; &nbsp; &nbsp; if(!</span><span class="default">is_null</span><span class="keyword">( </span><span class="default">$lastOffset</span><span class="keyword">))<br>&nbsp; &nbsp; &nbsp; &nbsp; {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$valueText </span><span class="keyword">= </span><span class="default">substr</span><span class="keyword">(</span><span class="default">$data</span><span class="keyword">, </span><span class="default">$lastOffset</span><span class="keyword">, </span><span class="default">$offset </span><span class="keyword">- </span><span class="default">$lastOffset </span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$returnArray</span><span class="keyword">[</span><span class="default">$currentKey</span><span class="keyword">] = </span><span class="default">unserialize</span><span class="keyword">(</span><span class="default">$valueText</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; }<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$currentKey </span><span class="keyword">= </span><span class="default">$value</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">];<br><br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$lastOffset </span><span class="keyword">= </span><span class="default">$offset </span><span class="keyword">+ </span><span class="default">strlen</span><span class="keyword">( </span><span class="default">$currentKey </span><span class="keyword">)+</span><span class="default">1</span><span class="keyword">;<br>&nbsp; &nbsp; }<br><br>&nbsp; &nbsp; </span><span class="default">$valueText </span><span class="keyword">= </span><span class="default">substr</span><span class="keyword">(</span><span class="default">$data</span><span class="keyword">, </span><span class="default">$lastOffset </span><span class="keyword">);<br>&nbsp; &nbsp; </span><span class="default">$returnArray</span><span class="keyword">[</span><span class="default">$currentKey</span><span class="keyword">] = </span><span class="default">unserialize</span><span class="keyword">(</span><span class="default">$valueText</span><span class="keyword">);<br>&nbsp; &nbsp; <br>&nbsp; &nbsp; return </span><span class="default">$returnArray</span><span class="keyword">;<br>}<br></span><span class="default">?&gt;</span>
</span>
</code></div>
  </div>
 </div>
  <div class="note" id="101428">  
  <a class="name">
  <strong class="user"><em>davyvandenbremt at gmail dot com</em></strong></a><div class="date" title="2010-12-16 01:18"><strong>3 years ago</strong></div>
  <div class="text" id="Hcom101428">
<div class="phpcode"><code><span class="html">
Here's what we are using to unserialize the session.<br><br><span class="default">&lt;?php<br></span><span class="keyword">function </span><span class="default">unserialize_session</span><span class="keyword">(</span><span class="default">$val</span><span class="keyword">) {<br>&nbsp; </span><span class="default">$result </span><span class="keyword">= array();<br>&nbsp; <br>&nbsp; </span><span class="comment">// prefixing with semicolon to make it easier to write the regular expression<br>&nbsp; </span><span class="default">$val </span><span class="keyword">= </span><span class="string">';' </span><span class="keyword">. </span><span class="default">$val</span><span class="keyword">;<br>&nbsp; <br>&nbsp; </span><span class="comment">// regularexpression to find the keys<br>&nbsp; </span><span class="default">$keyreg </span><span class="keyword">= </span><span class="string">'/;([^|{}"]+)\|/'</span><span class="keyword">;<br>&nbsp; <br>&nbsp; </span><span class="comment">// find all keys<br>&nbsp; </span><span class="default">$matches </span><span class="keyword">= array();<br>&nbsp; </span><span class="default">preg_match_all</span><span class="keyword">(</span><span class="default">$keyreg</span><span class="keyword">, </span><span class="default">$val</span><span class="keyword">, </span><span class="default">$matches</span><span class="keyword">);<br>&nbsp; <br>&nbsp; </span><span class="comment">// only go further if we found some keys<br>&nbsp; </span><span class="keyword">if (isset(</span><span class="default">$matches</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">])) {<br>&nbsp; &nbsp; </span><span class="default">$keys </span><span class="keyword">= </span><span class="default">$matches</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">];<br>&nbsp; &nbsp; <br>&nbsp; &nbsp; </span><span class="comment">// find the values by splitting the input on the key regular expression<br>&nbsp; &nbsp; </span><span class="default">$values </span><span class="keyword">= </span><span class="default">preg_split</span><span class="keyword">(</span><span class="default">$keyreg</span><span class="keyword">, </span><span class="default">$val</span><span class="keyword">);<br>&nbsp; &nbsp; <br>&nbsp; &nbsp; </span><span class="comment">// unshift the first value since it's always empty (due to our semicolon prefix)<br>&nbsp; &nbsp; </span><span class="keyword">if (</span><span class="default">count</span><span class="keyword">(</span><span class="default">$values</span><span class="keyword">) &gt; </span><span class="default">1</span><span class="keyword">) {<br>&nbsp; &nbsp; &nbsp; </span><span class="default">array_shift</span><span class="keyword">(</span><span class="default">$values</span><span class="keyword">);<br>&nbsp; &nbsp; }<br>&nbsp; &nbsp; <br>&nbsp; &nbsp; </span><span class="comment">// combine the $keys and $values<br>&nbsp; &nbsp; </span><span class="default">$result </span><span class="keyword">= </span><span class="default">array_combine</span><span class="keyword">(</span><span class="default">$keys</span><span class="keyword">, </span><span class="default">$values</span><span class="keyword">);<br>&nbsp; }<br>&nbsp; <br>&nbsp; return </span><span class="default">$result</span><span class="keyword">;<br>}<br></span><span class="default">?&gt;</span>
</span>
</code></div>
  </div>
 </div>
  <div class="note" id="69111">  
  <a class="name">
  <strong class="user"><em>leon dot pegg at gmail dot com</em></strong></a><div class="date" title="2006-08-23 08:14"><strong>8 years ago</strong></div>
  <div class="text" id="Hcom69111">
<div class="phpcode"><code><span class="html">
i have found this to be a better way to restore session data while keeping your current session.<br><br>function decode_session($session_string){<br>&nbsp; &nbsp; $current_session = session_encode();<br>&nbsp; &nbsp; foreach ($_SESSION as $key =&gt; $value){<br>&nbsp; &nbsp; &nbsp; &nbsp; unset($_SESSION[$key]);<br>&nbsp; &nbsp; }<br>&nbsp; &nbsp; session_decode($session_string);<br>&nbsp; &nbsp; $restored_session = $_SESSION;<br>&nbsp; &nbsp; foreach ($_SESSION as $key =&gt; $value){<br>&nbsp; &nbsp; &nbsp; &nbsp; unset($_SESSION[$key]);<br>&nbsp; &nbsp; }<br>&nbsp; &nbsp; session_decode($current_session);<br>&nbsp; &nbsp; return $restored_session;<br>}<br><br>enjoy</span>
</code></div>
  </div>
 </div>
  <div class="note" id="57897">  
  <a class="name">
  <strong class="user"><em>erwinmoller at xs4all dot nl</em></strong></a><div class="date" title="2005-10-18 07:25"><strong>8 years ago</strong></div>
  <div class="text" id="Hcom57897">
<div class="phpcode"><code><span class="html">
The regExp-method describe earlier doesn't work under all conditions.<br><br>If I feed this:<br>voornaam|s:8:"Ai|;\'\"";achternaam|s:6:"werrwe";leeftijd|i:44;<br><br>I get this:<br>array(4) {<br>&nbsp; ["voornaam"]=&gt;<br>&nbsp; bool(false)<br>&nbsp; ["Ai"]=&gt;<br>&nbsp; bool(false)<br>&nbsp; ["achternaam"]=&gt;<br>&nbsp; string(6) "werrwe"<br>&nbsp; ["leeftijd"]=&gt;<br>&nbsp; int(44)<br>}<br><br>while I expected:<br>array(3) {<br>&nbsp; ["voornaam"]=&gt;<br>&nbsp; string(8) "Ai|;\'\""<br>&nbsp; ["achternaam"]=&gt;<br>&nbsp; string(6) "werrwe"<br>&nbsp; ["leeftijd"]=&gt;<br>&nbsp; int(44)<br>}<br><br>I think the | is messing things up. :-/</span>
</code></div>
  </div>
 </div>
  <div class="note" id="55307">  
  <a class="name">
  <strong class="user"><em>brett at brettbrewer dot com</em></strong></a><div class="date" title="2005-07-29 11:25"><strong>9 years ago</strong></div>
  <div class="text" id="Hcom55307">
<div class="phpcode"><code><span class="html">
I have made a minor change to fabrizio's (et all) version of the unserializesession function because it was choking on underscores in my variable names.&nbsp; Here is the correct version which should account for ALL possible PHP variable names:<br><br>function unserializesession($data) {<br>&nbsp;&nbsp; $vars=preg_split(<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; '/([a-zA-Z_\x7f-\xff][a-zA-Z0-9_\x7f-\xff]*)\|/',<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $data,-1,PREG_SPLIT_NO_EMPTY |&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; PREG_SPLIT_DELIM_CAPTURE<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; );<br>&nbsp;&nbsp; for($i=0; $vars[$i]; $i++) {<br>&nbsp; &nbsp; &nbsp;&nbsp; $result[$vars[$i++]]=unserialize($vars[$i]);&nbsp; &nbsp;&nbsp; <br>&nbsp;&nbsp; }<br>&nbsp;&nbsp; return $result;<br>}<br><br>Please note that I had to split the preg_split function call above into 4 lines due to the limitations of this forum. This version changes the regex used to find variable names so that it complies with the specs for&nbsp; variable names as specified in the PHP manual at <a rel="nofollow" target="_blank">http://us3.php.net/manual/en/language.variables.php.</a> I just took the regex directly from the PHP manual pages where they give the regex equivalent for a valid variable name as: <br><br>[a-zA-Z_\x7f-\xff][a-zA-Z0-9_\x7f-\xff]*<br><br>Anyway, this seems to work great for me now, even on gigantic strings of encoded session data.</span>
</code></div>
  </div>
 </div>
  <div class="note" id="53232">  
  <a class="name">
  <strong class="user"><em>vesely at tana dot it</em></strong></a><div class="date" title="2005-05-26 03:25"><strong>9 years ago</strong></div>
  <div class="text" id="Hcom53232">
<div class="phpcode"><code><span class="html">
When using this function to manage sessions, it is MUCH<br>better to have register_globals turned off. Then one can<br>examine the session content given its id.<br><br><span class="default">&lt;?php<br>&nbsp;&nbsp; $fname </span><span class="keyword">= </span><span class="default">session_save_path</span><span class="keyword">() . </span><span class="string">"/sess_" </span><span class="keyword">. </span><span class="default">$the_sid</span><span class="keyword">;<br>&nbsp;&nbsp; if (</span><span class="default">session_decode</span><span class="keyword">(</span><span class="default">file_get_contents</span><span class="keyword">(</span><span class="default">$fname</span><span class="keyword">)))<br>&nbsp;&nbsp; {<br>&nbsp; &nbsp; &nbsp; </span><span class="default">$vars </span><span class="keyword">= </span><span class="default">$_SESSION</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; </span><span class="default">$_SESSION </span><span class="keyword">= array();<br><br>&nbsp; &nbsp; &nbsp; </span><span class="comment">// examine $vars...<br>&nbsp;&nbsp; </span><span class="keyword">}<br></span><span class="default">?&gt;<br></span><br>Depending on PHP version, you may need to have a dummy<br>session started for the code above to work. I reset the<br>$_SESSION immediately in order to avoid writing the<br>dummy session: that's needed while testing the code!</span>
</code></div>
  </div>
 </div>
  <div class="note" id="52874">  
  <a class="name">
  <strong class="user"><em>fabrizio dot messina at gmail dot com</em></strong></a><div class="date" title="2005-05-16 06:40"><strong>9 years ago</strong></div>
  <div class="text" id="Hcom52874">
<div class="phpcode"><code><span class="html">
this function _really_ split and decode session data:<br><br>function unserializesession($data) {<br>&nbsp;&nbsp; $vars=preg_split('/([a-zA-Z0-9]+)\|/',$data,-1,PREG_SPLIT_NO_EMPTY | PREG_SPLIT_DELIM_CAPTURE);<br>&nbsp;&nbsp; for($i=0; $vars[$i]; $i++) {<br>&nbsp; &nbsp; &nbsp;&nbsp; $result[$vars[$i++]]=unserialize($vars[$i]);&nbsp; &nbsp; &nbsp;&nbsp; <br>&nbsp;&nbsp; }<br>&nbsp;&nbsp; return $result;<br>}<br><br>the difference from previously posted 'unserializesession' function is the regular expression inside function preg_split ('[a-zA-Z0-9]+' vs&nbsp; '[a-z,A-Z]+' )</span>
</code></div>
  </div>
 </div>
  <div class="note" id="42945">  
  <a class="name">
  <strong class="user"><em>sco at postmaster dot co dot uk</em></strong></a><div class="date" title="2004-06-04 07:52"><strong>10 years ago</strong></div>
  <div class="text" id="Hcom42945">
<div class="phpcode"><code><span class="html">
If you're trying to access your session data from outside the regular php session functions, you might want to use WDDX as your serializer, as opposed to the normal php serializer. When your data is serialized as XML, obviously it's easy to unserialize as you please.<br><br>WDDX seems to be a little slower, and the text string it creates is much bigger than that created by the normal php serializer, but it provides the functionality with minimal hassle.<br><br>Donal</span>
</code></div>
  </div>
 </div>
  <div class="note" id="41187">  
  <a class="name">
  <strong class="user"><em>forum at orthanc dot co dot nz</em></strong></a><div class="date" title="2004-04-02 12:26"><strong>10 years ago</strong></div>
  <div class="text" id="Hcom41187">
<div class="phpcode"><code><span class="html">
Becarful using this if you are trying to switch out of an existing session rather than load one into a clean slate.<br><br>session_decode doesn't destroy the existing session data, it will over write it if there is a session variable of the same name, but if the names don't clash the existing session variables will hang around.<br><br>I have yet to find a better solution than<br><br>session_destroy()<br>session_start()<br>session_decode(....);<br><br>-----------------------------------------<br>To explain what I'm talking about<br><br>&lt;?<br>&nbsp; &nbsp; session_start();<br>&nbsp; &nbsp; $a = 5;<br>&nbsp; &nbsp; session_register('a');<br>&nbsp; &nbsp; session_decode("&lt;session that doesn't have a as a session variable&gt;");<br>&nbsp; &nbsp; print (session_is_registered('a') ? $a : 'Not Registered' );<br>?&gt;<br><br>The above code will print '5' as $a hasn't been destroyed or even unregistered by the session_decode</span>
</code></div>
  </div>
 </div>
  <div class="note" id="38221">  
  <a class="name">
  <strong class="user"><em>njail</em></strong></a><div class="date" title="2003-12-12 12:28"><strong>10 years ago</strong></div>
  <div class="text" id="Hcom38221">
<div class="phpcode"><code><span class="html">
<span class="default">&lt;?PHP<br></span><span class="comment">// Get Session Content<br></span><span class="default">$varsess </span><span class="keyword">= Array(</span><span class="string">'SESSION'</span><span class="keyword">);<br>for (</span><span class="default">$i </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">; </span><span class="default">$i </span><span class="keyword">&lt; </span><span class="default">sizeof</span><span class="keyword">(</span><span class="default">$varsess</span><span class="keyword">); </span><span class="default">$i</span><span class="keyword">++)<br>{<br>&nbsp; if (</span><span class="default">is_array</span><span class="keyword">(${</span><span class="string">"_</span><span class="keyword">{</span><span class="default">$varsess</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">]}</span><span class="string">"</span><span class="keyword">}))<br>&nbsp; {<br>&nbsp; &nbsp; foreach (${</span><span class="string">"_</span><span class="keyword">{</span><span class="default">$varsess</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">]}</span><span class="string">"</span><span class="keyword">} as </span><span class="default">$var</span><span class="keyword">=&gt;</span><span class="default">$val</span><span class="keyword">)<br>&nbsp; &nbsp; {<br>&nbsp; &nbsp; $</span><span class="default">$var </span><span class="keyword">= </span><span class="default">$val</span><span class="keyword">;<br>&nbsp; &nbsp; </span><span class="comment">// print "Var :".$var." -- Value :".$val."\n&lt;br&gt;";<br>&nbsp; &nbsp; </span><span class="keyword">}<br>&nbsp; }<br>&nbsp; unset(${</span><span class="string">"_</span><span class="keyword">{</span><span class="default">$varsess</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">]}</span><span class="string">"</span><span class="keyword">});<br>}<br></span><span class="default">?&gt;</span>
</span>
</code></div>
  </div>
 </div>
  <div class="note" id="35147">  
  <a class="name">
  <strong class="user"><em>petej*shaman_ca</em></strong></a><div class="date" title="2003-08-21 01:44"><strong>11 years ago</strong></div>
  <div class="text" id="Hcom35147">
<div class="phpcode"><code><span class="html">
Seems like there was a change in the behavior of this function somewhere between 4.1.2 and 4.3.3.&nbsp; In 4.1.2 session_decode() didn't care whether the session was started, and would just decode the string into the _SESSION array.&nbsp; In my 4.3.3 install, session_decode() wouldn't work unless I explicitly started the session with session_start().</span>
</code></div>
  </div>
 </div>
  <div class="note" id="78640">  
  <a class="name">
  <strong class="user"><em>ac</em></strong></a><div class="date" title="2007-10-20 07:46"><strong>6 years ago</strong></div>
  <div class="text" id="Hcom78640">
<div class="phpcode"><code><span class="html">
this solved my |&nbsp;problem:<br><br>function unserializesession($data) {<br>&nbsp; &nbsp; $vars=preg_split('/([a-zA-Z_\x7f-\xff][a-zA-Z0-9_\x7f-\xff^|]*)\|/',<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $data,-1,PREG_SPLIT_NO_EMPTY | PREG_SPLIT_DELIM_CAPTURE);<br>&nbsp; &nbsp; for($i=0; $vars[$i]; $i++) $result[$vars[$i++]]=unserialize($vars[$i]);<br>&nbsp; &nbsp; return $result;<br>}</span>
</code></div>
  </div>
 </div>
  <div class="note" id="61177">  
  <a class="name">
  <strong class="user"><em>nero321 at zmail dot sk</em></strong></a><div class="date" title="2006-01-27 05:01"><strong>8 years ago</strong></div>
  <div class="text" id="Hcom61177">
<div class="phpcode"><code><span class="html">
Another solution for decoding session string to "$_SESSION"-like array:<br><br><span class="default">&lt;?php<br><br></span><span class="comment">// returns decoded string as arrays of variables<br>//&nbsp;&nbsp; or false on error (when session_decode returns false)<br></span><span class="keyword">function </span><span class="default">DecodeSession</span><span class="keyword">(</span><span class="default">$sess_string</span><span class="keyword">)<br>{<br>&nbsp; &nbsp; </span><span class="comment">// save current session data<br>&nbsp; &nbsp; //&nbsp;&nbsp; and flush $_SESSION array<br>&nbsp; &nbsp; </span><span class="default">$old </span><span class="keyword">= </span><span class="default">$_SESSION</span><span class="keyword">;<br>&nbsp; &nbsp; </span><span class="default">$_SESSION </span><span class="keyword">= array();<br><br>&nbsp; &nbsp; </span><span class="comment">// try to decode passed string<br>&nbsp; &nbsp; </span><span class="default">$ret </span><span class="keyword">= </span><span class="default">session_decode</span><span class="keyword">(</span><span class="default">$sess_string</span><span class="keyword">);<br>&nbsp; &nbsp; if (!</span><span class="default">$ret</span><span class="keyword">) {<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="comment">// if passed string is not session data,<br>&nbsp; &nbsp; &nbsp; &nbsp; //&nbsp;&nbsp; retrieve saved (old) session data<br>&nbsp; &nbsp; &nbsp; &nbsp; //&nbsp;&nbsp; and return false<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$_SESSION </span><span class="keyword">= array();<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$_SESSION </span><span class="keyword">= </span><span class="default">$old</span><span class="keyword">;<br><br>&nbsp; &nbsp; &nbsp; &nbsp; return </span><span class="default">false</span><span class="keyword">;<br>&nbsp; &nbsp; }<br><br>&nbsp; &nbsp; </span><span class="comment">// save decoded session data to sess_array<br>&nbsp; &nbsp; //&nbsp;&nbsp; and flush $_SESSION array<br>&nbsp; &nbsp; </span><span class="default">$sess_array </span><span class="keyword">= </span><span class="default">$_SESSION</span><span class="keyword">;<br>&nbsp; &nbsp; </span><span class="default">$_SESSION </span><span class="keyword">= array();<br><br>&nbsp; &nbsp; </span><span class="comment">// restore old session data<br>&nbsp; &nbsp; </span><span class="default">$_SESSION </span><span class="keyword">= </span><span class="default">$old</span><span class="keyword">;<br><br>&nbsp; &nbsp; </span><span class="comment">// return decoded session data<br>&nbsp; &nbsp; </span><span class="keyword">return </span><span class="default">$sess_array</span><span class="keyword">;<br>}<br><br></span><span class="default">?&gt;<br></span><br>Example of use:<br><br><span class="default">&lt;?php<br><br>$sarr </span><span class="keyword">= </span><span class="default">DecodeSession</span><span class="keyword">(</span><span class="default">$sess_str</span><span class="keyword">);<br></span><span class="default">print_r</span><span class="keyword">(</span><span class="default">$sarr</span><span class="keyword">);<br><br></span><span class="default">?&gt;<br></span><br>But I have not tested performance.</span>
</code></div>
  </div>
 </div>
  <div class="note" id="68155">  
  <a class="name">
  <strong class="user"><em>xueron at gmail dot com</em></strong></a><div class="date" title="2006-07-15 09:30"><strong>8 years ago</strong></div>
  <div class="text" id="Hcom68155">
<div class="phpcode"><code><span class="html">
a perl reg:<br><br>$s = session_encoded_value;<br>%res = $s =~ /([a-zA-Z_\x7f-\xff][a-zA-Z0-9_\x7f-\xff]*)\|([^\|]*[\;\}])/g;</span>
</code></div>
  </div>
 </div>
  <div class="note" id="79244">  
  <a class="name">
  <strong class="user"><em>deminy at deminy dot net</em></strong></a><div class="date" title="2007-11-16 01:24"><strong>6 years ago</strong></div>
  <div class="text" id="Hcom79244">
<div class="phpcode"><code><span class="html">
1. Reply to ac's post:<br><br>As I mentioned at <a rel="nofollow" target="_blank">http://us.php.net/manual/en/function.unserialize.php#76977</a> , the regular expression used to unserialize a PHP session data won't work if the session data contains string variable which contains character '|'.<br><br>Here is a simple example I just come up with to show when the function unserializesession() won't work.<br><br><span class="default">&lt;?php<br></span><span class="keyword">function </span><span class="default">unserializesession</span><span class="keyword">(</span><span class="default">$data</span><span class="keyword">) {<br>&nbsp; &nbsp; </span><span class="default">$vars</span><span class="keyword">=</span><span class="default">preg_split</span><span class="keyword">(</span><span class="string">'/([a-zA-Z_\x7f-\xff][a-zA-Z0-9_\x7f-\xff^|]*)\|/'</span><span class="keyword">,<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$data</span><span class="keyword">,-</span><span class="default">1</span><span class="keyword">,</span><span class="default">PREG_SPLIT_NO_EMPTY </span><span class="keyword">| </span><span class="default">PREG_SPLIT_DELIM_CAPTURE</span><span class="keyword">);<br>&nbsp; &nbsp; for(</span><span class="default">$i</span><span class="keyword">=</span><span class="default">0</span><span class="keyword">; </span><span class="default">$vars</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">]; </span><span class="default">$i</span><span class="keyword">++) </span><span class="default">$result</span><span class="keyword">[</span><span class="default">$vars</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">++]]=</span><span class="default">unserialize</span><span class="keyword">(</span><span class="default">$vars</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">]);<br>&nbsp; &nbsp; return </span><span class="default">$result</span><span class="keyword">;<br>}<br><br></span><span class="default">session_start</span><span class="keyword">();<br><br></span><span class="default">$_SESSION</span><span class="keyword">[</span><span class="string">'var'</span><span class="keyword">] = </span><span class="string">'a|b'</span><span class="keyword">; <br></span><span class="default">$str </span><span class="keyword">= </span><span class="default">session_encode</span><span class="keyword">();<br></span><span class="default">$arr </span><span class="keyword">= </span><span class="default">unserializesession</span><span class="keyword">(</span><span class="default">$str</span><span class="keyword">);<br><br></span><span class="default">print_r</span><span class="keyword">(</span><span class="default">$_SESSION</span><span class="keyword">);<br>echo </span><span class="string">"&lt;br /&gt;\n"</span><span class="keyword">;<br></span><span class="default">print_r</span><span class="keyword">(</span><span class="default">$arr</span><span class="keyword">);<br></span><span class="default">?&gt;<br></span><br>2. Reply to bmorel's post:<br><br>Your function session_real_decode() is very nice to decode session data without involving with session functions. It works in most cases, but when dealing with reference variables, there is another case which should also be handled:<br><br>&nbsp; &nbsp; <span class="default">&lt;?php </span><span class="keyword">case </span><span class="string">'r'</span><span class="keyword">: </span><span class="comment">/* reference&nbsp; */ // R in lowercase </span><span class="default">?&gt;<br></span><br>I found this bug on PHP 5.1.6 several months ago, but don't know if it exsits in other version of PHP or not. Also, I am not sure if similiar bugs exist when handling other data types.<br><br>So here is my suggestion to revise the function, <br>2.1. <br>&nbsp; &nbsp; change the switch statement from<br>&nbsp; &nbsp; <span class="default">&lt;?php </span><span class="keyword">switch (</span><span class="default">$str</span><span class="keyword">[</span><span class="default">$q</span><span class="keyword">]) { </span><span class="default">?&gt;<br></span>&nbsp; &nbsp; to<br>&nbsp; &nbsp; <span class="default">&lt;?php </span><span class="keyword">switch (</span><span class="default">strtolower</span><span class="keyword">(</span><span class="default">$str</span><span class="keyword">[</span><span class="default">$q</span><span class="keyword">])) { </span><span class="default">?&gt;<br></span>2.2. <br>&nbsp; &nbsp; In all case statements, use lowercase characters only for character comparison. For example,<br>&nbsp; &nbsp; <span class="default">&lt;?php </span><span class="keyword">case </span><span class="string">'R'</span><span class="keyword">: </span><span class="comment">/* reference&nbsp; */ </span><span class="default">?&gt;<br></span>&nbsp; &nbsp; should be be written as <br>&nbsp; &nbsp; <span class="default">&lt;?php </span><span class="keyword">case </span><span class="string">'r'</span><span class="keyword">: </span><span class="comment">/* reference&nbsp; */ </span><span class="default">?&gt;<br></span><br>(I don't want to put long code here, so just leave pieces of code to save spaces)</span>
</code></div>
  </div>
 </div></div>

 
</section>    </section><!-- layout-content -->
        


  </div><!-- layout -->
         
  

    
 <!-- External and third party libraries. -->
 







<a id="toTop" href="javascript:;"><span id="toTopHover"></span><img width="40" height="40" alt="To Top" src="../../images/to-top%402x.png"></a>



<!-- Mirrored from php.net/manual/en/function.session-decode.php by HTTrack Website Copier/3.x [XR&CO'2013], Thu, 28 Aug 2014 16:07:59 GMT -->


</body></html>