<html><!-- Mirrored from php.net/manual/en/function.ob-gzhandler.php by HTTrack Website Copier/3.x [XR&CO'2013], Thu, 28 Aug 2014 16:08:38 GMT --><!-- Added by HTTrack --><head><meta http-equiv="content-type" content="text/html;charset=utf-8"><!-- /Added by HTTrack -->


  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0"> 

  <title>ob_gzhandler</title>

 <link rel="shortcut icon" href="../../favicon.ico">
 <link rel="search" type="application/opensearchdescription+xml" href="http://php.net/phpnetimprovedsearch.src" title="Add PHP.net search">
 <link rel="alternate" type="application/atom+xml" href="http://php.net/releases/feed.php" title="PHP Release feed">
 <link rel="alternate" type="application/atom+xml" href="http://php.net/feed.atom" title="PHP: Hypertext Preprocessor">

 <link rel="canonical" href="function.ob-gzhandler.html">
 <link rel="shorturl" href="http://php.net/ob-gzhandler">
 <link rel="alternate" href="http://php.net/ob-gzhandler" hreflang="x-default">

 <link rel="contents" href="index-2.html">
 <link rel="index" href="ref.outcontrol.html">
 <link rel="prev" href="function.ob-get-status.html">
 <link rel="next" href="function.ob-implicit-flush.html">

 <link rel="alternate" href="function.ob-gzhandler.html" hreflang="en">
 <link rel="alternate" href="http://php.net/manual/pt_BR/function.ob-gzhandler.php" hreflang="pt_BR">
 <link rel="alternate" href="http://php.net/manual/zh/function.ob-gzhandler.php" hreflang="zh">
 <link rel="alternate" href="http://php.net/manual/fr/function.ob-gzhandler.php" hreflang="fr">
 <link rel="alternate" href="http://php.net/manual/de/function.ob-gzhandler.php" hreflang="de">
 <link rel="alternate" href="http://php.net/manual/it/function.ob-gzhandler.php" hreflang="it">
 <link rel="alternate" href="http://php.net/manual/ja/function.ob-gzhandler.php" hreflang="ja">
 <link rel="alternate" href="http://php.net/manual/ro/function.ob-gzhandler.php" hreflang="ro">
 <link rel="alternate" href="http://php.net/manual/ru/function.ob-gzhandler.php" hreflang="ru">
 <link rel="alternate" href="http://php.net/manual/es/function.ob-gzhandler.php" hreflang="es">
 <link rel="alternate" href="http://php.net/manual/tr/function.ob-gzhandler.php" hreflang="tr">

<link rel="stylesheet" type="text/css" href="../../cached8fe1.css?t=1401250819&amp;f=/fonts/Fira/fira.css" media="screen">
<link rel="stylesheet" type="text/css" href="../../cached4b8d.css?t=1404368420&amp;f=/fonts/Font-Awesome/css/fontello.css" media="screen">
<link rel="stylesheet" type="text/css" href="../../cached5065.css?t=1403329232&amp;f=/styles/theme-base.css" media="screen">
<link rel="stylesheet" type="text/css" href="../../cachedc78d.css?t=1401249623&amp;f=/styles/theme-medium.css" media="screen">

 <!--[if lte IE 7]>
 <link rel="stylesheet" type="text/css" href="http://php.net/styles/workarounds.ie7.css" media="screen">
 <![endif]-->

 <!--[if lte IE 8]>
 <script type="text/javascript">
  window.brokenIE = true;
 </script>
 <![endif]-->

 <!--[if lte IE 9]>
 <link rel="stylesheet" type="text/css" href="http://php.net/styles/workarounds.ie9.css" media="screen">
 <![endif]-->

 <!--[if IE]>
 <script type="text/javascript" src="http://php.net/js/ext/html5.js"></script>
 <![endif]-->

 <base>

</head>
<body class="docs " style="">


<div class="headsup"><a href="http://php.net/index.php#id2014-08-28-1">PHP 5.6.0 released</a></div>
<nav id="trick"><div><dl>
<dt><a href="getting-started.html">Getting Started</a></dt>
	<dd><a href="introduction.html">Introduction</a></dd>
	<dd><a href="tutorial.html">A simple tutorial</a></dd>
<dt><a href="langref.html">Language Reference</a></dt>
	<dd><a href="language.basic-syntax.html">Basic syntax</a></dd>
	<dd><a href="language.types.html">Types</a></dd>
	<dd><a href="language.variables.html">Variables</a></dd>
	<dd><a href="language.constants.html">Constants</a></dd>
	<dd><a href="language.expressions.html">Expressions</a></dd>
	<dd><a href="language.operators.html">Operators</a></dd>
	<dd><a href="language.control-structures.html">Control Structures</a></dd>
	<dd><a href="language.functions.html">Functions</a></dd>
	<dd><a href="language.oop5.html">Classes and Objects</a></dd>
	<dd><a href="language.namespaces.html">Namespaces</a></dd>
	<dd><a href="language.exceptions.html">Exceptions</a></dd>
	<dd><a href="language.generators.html">Generators</a></dd>
	<dd><a href="language.references.html">References Explained</a></dd>
	<dd><a href="reserved.variables.html">Predefined Variables</a></dd>
	<dd><a href="reserved.exceptions.html">Predefined Exceptions</a></dd>
	<dd><a href="reserved.interfaces.html">Predefined Interfaces and Classes</a></dd>
	<dd><a href="context.html">Context options and parameters</a></dd>
	<dd><a href="wrappers.html">Supported Protocols and Wrappers</a></dd>
</dl>
<dl>
<dt><a href="security.html">Security</a></dt>
	<dd><a href="security.intro.html">Introduction</a></dd>
	<dd><a href="security.general.html">General considerations</a></dd>
	<dd><a href="security.cgi-bin.html">Installed as CGI binary</a></dd>
	<dd><a href="security.apache.html">Installed as an Apache module</a></dd>
	<dd><a href="security.filesystem.html">Filesystem Security</a></dd>
	<dd><a href="security.database.html">Database Security</a></dd>
	<dd><a href="security.errors.html">Error Reporting</a></dd>
	<dd><a href="security.globals.html">Using Register Globals</a></dd>
	<dd><a href="security.variables.html">User Submitted Data</a></dd>
	<dd><a href="security.magicquotes.html">Magic Quotes</a></dd>
	<dd><a href="security.hiding.html">Hiding PHP</a></dd>
	<dd><a href="security.current.html">Keeping Current</a></dd>
<dt><a href="features.html">Features</a></dt>
	<dd><a href="features.http-auth.html">HTTP authentication with PHP</a></dd>
	<dd><a href="features.cookies.html">Cookies</a></dd>
	<dd><a href="features.sessions.html">Sessions</a></dd>
	<dd><a href="features.xforms.html">Dealing with XForms</a></dd>
	<dd><a href="features.file-upload.html">Handling file uploads</a></dd>
	<dd><a href="features.remote-files.html">Using remote files</a></dd>
	<dd><a href="features.connection-handling.html">Connection handling</a></dd>
	<dd><a href="features.persistent-connections.html">Persistent Database Connections</a></dd>
	<dd><a href="features.safe-mode.html">Safe Mode</a></dd>
	<dd><a href="features.commandline.html">Command line usage</a></dd>
	<dd><a href="features.gc.html">Garbage Collection</a></dd>
	<dd><a href="features.dtrace.html">DTrace Dynamic Tracing</a></dd>
</dl>
<dl>
<dt><a href="funcref.html">Function Reference</a></dt>
	<dd><a href="refs.basic.php.html">Affecting PHP's Behaviour</a></dd>
	<dd><a href="refs.utilspec.audio.html">Audio Formats Manipulation</a></dd>
	<dd><a href="refs.remote.auth.html">Authentication Services</a></dd>
	<dd><a href="refs.utilspec.cmdline.html">Command Line Specific Extensions</a></dd>
	<dd><a href="refs.compression.html">Compression and Archive Extensions</a></dd>
	<dd><a href="refs.creditcard.html">Credit Card Processing</a></dd>
	<dd><a href="refs.crypto.html">Cryptography Extensions</a></dd>
	<dd><a href="refs.database.html">Database Extensions</a></dd>
	<dd><a href="refs.calendar.html">Date and Time Related Extensions</a></dd>
	<dd><a href="refs.fileprocess.file.html">File System Related Extensions</a></dd>
	<dd><a href="refs.international.html">Human Language and Character Encoding Support</a></dd>
	<dd><a href="refs.utilspec.image.html">Image Processing and Generation</a></dd>
	<dd><a href="refs.remote.mail.html">Mail Related Extensions</a></dd>
	<dd><a href="refs.math.html">Mathematical Extensions</a></dd>
	<dd><a href="refs.utilspec.nontext.html">Non-Text MIME Output</a></dd>
	<dd><a href="refs.fileprocess.process.html">Process Control Extensions</a></dd>
	<dd><a href="refs.basic.other.html">Other Basic Extensions</a></dd>
	<dd><a href="refs.remote.other.html">Other Services</a></dd>
	<dd><a href="refs.search.html">Search Engine Extensions</a></dd>
	<dd><a href="refs.utilspec.server.html">Server Specific Extensions</a></dd>
	<dd><a href="refs.basic.session.html">Session Extensions</a></dd>
	<dd><a href="refs.basic.text.html">Text Processing</a></dd>
	<dd><a href="refs.basic.vartype.html">Variable and Type Related Extensions</a></dd>
	<dd><a href="refs.webservice.html">Web Services</a></dd>
	<dd><a href="refs.utilspec.windows.html">Windows Only Extensions</a></dd>
	<dd><a href="refs.xml.html">XML Manipulation</a></dd>
</dl>
<dl>
<dt>Keyboard Shortcuts</dt><dt>?</dt>
<dd>This help</dd>
<dt>j</dt>
<dd>Next menu item</dd>
<dt>k</dt>
<dd>Previous menu item</dd>
<dt>g p</dt>
<dd>Previous man page</dd>
<dt>g n</dt>
<dd>Next man page</dd>
<dt>G</dt>
<dd>Scroll to bottom</dd>
<dt>g g</dt>
<dd>Scroll to top</dd>
<dt>g h</dt>
<dd>Goto homepage</dd>
<dt>g s</dt>
<dd>Goto search<br>(current page)</dd>
<dt>/</dt>
<dd>Focus search box</dd>
</dl></div></nav>
<div id="goto">
    <div class="search">
         <div class="text"></div>
         <div class="results"><ul></ul></div>
   </div>
</div>

  <div id="breadcrumbs" class="row-fluid">
          
              
        <ul class="breadcrumbs-container">
            <li><a href="index-2.html">PHP Manual</a></li>      <li><a href="funcref.html">Function Reference</a></li>      <li><a href="refs.basic.php.html">Affecting PHP's Behaviour</a></li>      <li><a href="book.outcontrol.html">Output Control</a></li>      <li><a href="ref.outcontrol.html">Output Control Functions</a></li>    </ul>
  </div>




<div id="layout">
  <section id="layout-content">
  <div id="function.ob-gzhandler" class="refentry">
 <div class="refnamediv">
  <h1 class="refname">ob_gzhandler</h1>
  <p class="verinfo">(PHP 4 &gt;= 4.0.4, PHP 5)</p><p class="refpurpose"><span class="refname">ob_gzhandler</span> â€” <span class="dc-title">ob_start callback function to gzip output buffer</span></p>

 </div>
 
 <div class="refsect1 description" id="refsect1-function.ob-gzhandler-description">
  <h3 class="title">Description</h3>
  <div class="methodsynopsis dc-description">
   <span class="type">string</span> <span class="methodname"><strong>ob_gzhandler</strong></span>
    ( <span class="methodparam"><span class="type">string</span> <code class="parameter">$buffer</code></span>
   , <span class="methodparam"><span class="type">int</span> <code class="parameter">$mode</code></span>
   )</div>

  <p class="para rdfs-comment">
   <span class="function"><strong>ob_gzhandler()</strong></span> is intended to be used as a callback
   function for <span class="function"><a href="function.ob-start.html" class="function">ob_start()</a></span> to help facilitate sending
   gz-encoded data to web browsers that support compressed web pages.  
   Before <span class="function"><strong>ob_gzhandler()</strong></span> actually sends compressed data,
   it determines what type of content encoding the browser will accept
   ("gzip", "deflate" or none at all) and will return its output accordingly.
   All browsers are supported since it's up to the browser to send the
   correct header saying that it accepts compressed web pages. If a browser
   doesn't support compressed pages this function returns <strong><code>FALSE</code></strong>.
  </p>
 </div>


 <div class="refsect1 parameters" id="refsect1-function.ob-gzhandler-parameters">
  <h3 class="title">Parameters</h3>
  <p class="para">
   </p><dl>

    
     <dt>
<code class="parameter">buffer</code></dt>

     <dd>

      <p class="para">
      </p>
     </dd>

    
    
     <dt>
<code class="parameter">mode</code></dt>

     <dd>

      <p class="para">
      </p>
     </dd>

    
   </dl>

  <p></p>
 </div>


 <div class="refsect1 returnvalues" id="refsect1-function.ob-gzhandler-returnvalues">
  <h3 class="title">Return Values</h3>
  <p class="para">
   
  </p>
 </div>


 <div class="refsect1 examples" id="refsect1-function.ob-gzhandler-examples">
  <h3 class="title">Examples</h3>
  <p class="para">
   </p><div class="example" id="example-490">
    <p><strong>Example #1 <span class="function"><strong>ob_gzhandler()</strong></span> example</strong></p>
    <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br><br>ob_start</span><span style="color: #007700">(</span><span style="color: #DD0000">"ob_gzhandler"</span><span style="color: #007700">);<br><br></span><span style="color: #0000BB">?&gt;<br></span>&lt;html&gt;<br>&lt;body&gt;<br>&lt;p&gt;This&nbsp;should&nbsp;be&nbsp;a&nbsp;compressed&nbsp;page.&lt;/p&gt;<br>&lt;/body&gt;<br>&lt;/html&gt;</span>
</code></div>
    </div>

   </div>
  <p></p>
 </div>


 <div class="refsect1 notes" id="refsect1-function.ob-gzhandler-notes">
  <h3 class="title">Notes</h3>
  <blockquote class="note"><p><strong class="note">Note</strong>: 
   </p><p class="para">
    <span class="function"><strong>ob_gzhandler()</strong></span> requires the <a href="ref.zlib.html" class="link">zlib</a> extension.
   </p>
  <p></p></blockquote>
  <blockquote class="note"><p><strong class="note">Note</strong>: 
   </p><p class="para">
    You cannot use both <span class="function"><strong>ob_gzhandler()</strong></span> and <a href="zlib.configuration.html#ini.zlib.output-compression" class="link">zlib.output_compression</a>.
    Also note that using <a href="zlib.configuration.html#ini.zlib.output-compression" class="link">
    zlib.output_compression</a> is preferred over
    <span class="function"><strong>ob_gzhandler()</strong></span>.
   </p>
  <p></p></blockquote>
 </div>


 <div class="refsect1 seealso" id="refsect1-function.ob-gzhandler-seealso">
  <h3 class="title">See Also</h3>
  <p class="para">
   </p><ul class="simplelist">
    <li class="member"><span class="function"><a href="function.ob-start.html" class="function" rel="rdfs-seeAlso">ob_start()</a> - Turn on output buffering</span></li>
    <li class="member"><span class="function"><a href="function.ob-end-flush.html" class="function" rel="rdfs-seeAlso">ob_end_flush()</a> - Flush (send) the output buffer and turn off output buffering</span></li>
   </ul>
  <p></p>
 </div>


</div>
<section id="usernotes">
 <div class="head"><h3 class="title">User Contributed Notes</h3></div><div id="allnotes">
  <div class="note" id="97385">  
  <a class="name">
  <strong class="user"><em>Jer</em></strong></a><div class="date" title="2010-04-16 04:17"><strong>4 years ago</strong></div>
  <div class="text" id="Hcom97385">
<div class="phpcode"><code><span class="html">
I've just spent 5 hours fighting a bug in my application and outcome is:<br><br><span class="default">&lt;?php<br></span><span class="comment">// do not use<br></span><span class="default">ob_start</span><span class="keyword">(</span><span class="string">"ob_gzhandler"</span><span class="keyword">);<br></span><span class="comment">// along with<br></span><span class="default">header</span><span class="keyword">(</span><span class="string">'HTTP/1.1 304 Not Modified'</span><span class="keyword">);<br><br></span><span class="comment">// or in the end use<br></span><span class="default">ob_end_clean</span><span class="keyword">();<br></span><span class="default">?&gt;<br></span><br>W3C Standart requires response body to be empty if 304 header set. With compression on it will at least contain a gzip stream header even if your output is completely empty! <br><br>This affects firefox (current ver.3.6.3) in a very subtle way: one of the requests after the one that gets 304 with not empty body gets it response prepended with contents of that body. In my case it was a css file and styles was not rendered at all, which made problem show up.</span>
</code></div>
  </div>
 </div>
  <div class="note" id="91685">  
  <a class="name">
  <strong class="user"><em>przemekryciuk at gmail dot com</em></strong></a><div class="date" title="2009-06-23 02:34"><strong>5 years ago</strong></div>
  <div class="text" id="Hcom91685">
<div class="phpcode"><code><span class="html">
The simplest way for gzip compression is:<br><span class="default">&lt;?php<br></span><span class="keyword">if(!</span><span class="default">ob_start</span><span class="keyword">(</span><span class="string">"ob_gzhandler"</span><span class="keyword">)) </span><span class="default">ob_start</span><span class="keyword">();<br></span><span class="default">?&gt;<br></span>ob_start("ob_gzhandler") returns FALSE if browser doesn't support gzip, so then is called normal ob_start();</span>
</code></div>
  </div>
 </div>
  <div class="note" id="36909">  
  <a class="name">
  <strong class="user"><em>daijoubuNOSP at Mvideotron dot ca</em></strong></a><div class="date" title="2003-10-27 02:05"><strong>10 years ago</strong></div>
  <div class="text" id="Hcom36909">
<div class="phpcode"><code><span class="html">
So much code...here's a lighter/faster one:
<br><span class="default">&lt;?php
<br>
<br></span><span class="keyword">if ( </span><span class="default">$do_gzip_compress </span><span class="keyword">)
<br>{
<br>&nbsp; &nbsp; </span><span class="default">$gzip_size&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="keyword">= </span><span class="default">ob_get_length</span><span class="keyword">();
<br>&nbsp; &nbsp; </span><span class="default">$gzip_contents&nbsp; &nbsp; </span><span class="keyword">= </span><span class="default">ob_get_clean</span><span class="keyword">(); </span><span class="comment">// PHP &lt; 4.3 use ob_get_contents() + ob_end_clean() 
<br>&nbsp; &nbsp; 
<br>&nbsp; &nbsp; </span><span class="keyword">echo </span><span class="string">"\x1f\x8b\x08\x00\x00\x00\x00\x00"</span><span class="keyword">,
<br>&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">substr</span><span class="keyword">(</span><span class="default">gzcompress</span><span class="keyword">(</span><span class="default">$gzip_contents</span><span class="keyword">, </span><span class="default">9</span><span class="keyword">), </span><span class="default">0</span><span class="keyword">, - </span><span class="default">4</span><span class="keyword">), </span><span class="comment">// substr -4 isn't needed
<br>&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">pack</span><span class="keyword">(</span><span class="string">'V'</span><span class="keyword">, </span><span class="default">crc32</span><span class="keyword">(</span><span class="default">$gzip_contents</span><span class="keyword">)),&nbsp; &nbsp; </span><span class="comment">// crc32 and
<br>&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">pack</span><span class="keyword">(</span><span class="string">'V'</span><span class="keyword">, </span><span class="default">$gzip_size</span><span class="keyword">);&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// size are ignored by all the browsers i have tested
<br></span><span class="keyword">}
<br>
<br>exit;
<br></span><span class="default">?&gt;
<br></span>I wouldn't recommande using level 9, waste of CPU, something between 1 and 6 would be more resonable
<br>I have tested without the substr/crc/size and it worked flawlessly in IE5/5.5/6, Opera7.11/7.21, IE5.5 MAC</span>
</code></div>
  </div>
 </div>
  <div class="note" id="72656">  
  <a class="name">
  <strong class="user"><em>nicolas dot grekas+php at gmail dot com</em></strong></a><div class="date" title="2007-01-28 10:45"><strong>7 years ago</strong></div>
  <div class="text" id="Hcom72656">
<div class="phpcode"><code><span class="html">
Here are some precisions :<br><br>- the "mode" arg accepts a bit field composed of PHP_OUTPUT_HANDLER_START, PHP_OUTPUT_HANDLER_CONT and PHP_OUTPUT_HANDLER_END. See <a rel="nofollow" target="_blank">http://www.php.net/manual/fr/ref.zlib.php#56216</a> for an example. The value that jazfresh recommends below (5) is the good one, because 5 == PHP_OUTPUT_HANDLER_START | PHP_OUTPUT_HANDLER_END.<br><br>- when called INSIDE an output buffering handler, ob_gzhandler DOES NOT return false when the browser doesn't support compressed pages. It rather returns the original string.</span>
</code></div>
  </div>
 </div>
  <div class="note" id="68034">  
  <a class="name">
  <strong class="user"><em>richard at mf2fm dot com</em></strong></a><div class="date" title="2006-07-11 02:50"><strong>8 years ago</strong></div>
  <div class="text" id="Hcom68034">
<div class="phpcode"><code><span class="html">
According to the manual, if ob_gzhander detects that the browser is unable to support deflate or gzip it returns FALSE.&nbsp; Does this mean that if you use ob_start("ob_gzhandler"), any browsers that do not support gzip/deflate will receive a blank page?<br><br>I've been having problems with IE6 displaying gzipped pages and adding a test:<br><br><span class="default">&lt;?php<br><br></span><span class="keyword">if (</span><span class="default">substr_count</span><span class="keyword">(</span><span class="default">$_SERVER</span><span class="keyword">[</span><span class="string">'HTTP_ACCEPT_ENCODING'</span><span class="keyword">], </span><span class="string">'gzip'</span><span class="keyword">)) </span><span class="default">ob_start</span><span class="keyword">(</span><span class="string">"ob_gzhandler"</span><span class="keyword">);<br><br>else </span><span class="default">ob_start</span><span class="keyword">();<br><br></span><span class="default">?&gt;<br></span><br>solved the problem.&nbsp; Surely if ob_gzhandler detects a lack of support for deflation it should return the input unchanged and not FALSE?</span>
</code></div>
  </div>
 </div>
  <div class="note" id="35893">  
  <a class="name">
  <strong class="user"><em>jazfresh at SPAM-JAVELIN dot hotmail dot com</em></strong></a><div class="date" title="2003-09-18 07:54"><strong>10 years ago</strong></div>
  <div class="text" id="Hcom35893">
<div class="phpcode"><code><span class="html">
In the set_error_handler notes, there is a technique described for capturing all errors (even parse errors) before they are displayed the user, using a special error handler and output handler. If this output handler detects a fatal error in the output buffer, it's captured and dealt with before it can be displayed to the user. If no error was detected, then output buffer is displayed verbatim (i.e. without being compressed).<br><br>If you are using this method, you can still take advantage of ob_gzhandler's compression. However, you MUST specify a mode argument (I'm using 4.2.2 on RedHat9). The mode value affects which headers are automatically added (Content-Encoding, etc). A value of '5' worked for me. '0' or discarding the argument produces a blank screen under Mozilla. <br><br><span class="default">&lt;?php<br><br></span><span class="keyword">function </span><span class="default">my_output_handler</span><span class="keyword">(&amp;</span><span class="default">$buffer</span><span class="keyword">) {<br>&nbsp; </span><span class="comment">// Detect errors in the output<br>&nbsp; </span><span class="keyword">if(</span><span class="default">ereg</span><span class="keyword">(</span><span class="string">"(error&lt;/b&gt;:)(.+) in &lt;b&gt;(.+)&lt;/b&gt; on line &lt;b&gt;(.+)&lt;/b&gt;"</span><span class="keyword">, </span><span class="default">$buffer</span><span class="keyword">, </span><span class="default">$regs</span><span class="keyword">)) {<br>&nbsp; &nbsp; </span><span class="default">my_error_handler</span><span class="keyword">(</span><span class="default">E_ERROR</span><span class="keyword">, </span><span class="default">$regs</span><span class="keyword">[</span><span class="default">2</span><span class="keyword">], </span><span class="default">$regs</span><span class="keyword">[</span><span class="default">3</span><span class="keyword">], </span><span class="default">$regs</span><span class="keyword">[</span><span class="default">4</span><span class="keyword">]);<br>&nbsp; &nbsp; </span><span class="comment">// ...<br>&nbsp; &nbsp; // ... Insert your error handling here ...<br>&nbsp; &nbsp; // ...<br>&nbsp; &nbsp; </span><span class="keyword">return </span><span class="string">'An internal error occurred.'</span><span class="keyword">;<br>&nbsp; } else {<br>&nbsp; &nbsp; </span><span class="comment">// The page rendered without any errors, so compress<br>&nbsp; &nbsp; // and output.<br>&nbsp; &nbsp; </span><span class="keyword">return </span><span class="default">ob_gzhandler</span><span class="keyword">(</span><span class="default">$buffer</span><span class="keyword">, </span><span class="default">5</span><span class="keyword">);<br>&nbsp; }<br>}<br></span><span class="default">?&gt;</span>
</span>
</code></div>
  </div>
 </div>
  <div class="note" id="31096">  
  <a class="name"><strong class="user"><em>Anonymous</em></strong></a><div class="date" title="2003-04-09 10:47"><strong>11 years ago</strong></div>
  <div class="text" id="Hcom31096">
<div class="phpcode"><code><span class="html">
When using ob_start("ob_gzhandler"), be aware that the output buffer has to be flushed in order to invoke the ob_gzhandler callback function. <br><br>This may not always happen. For example, if you use ob_get_contents() to copy the output buffer to a string for further manipulation and then silently discard the buffer with ob_end_clean(), the output buffer is never "flushed" and as a result, the ob_gzhandler callback function is never invoked. And your pages won't be compressed.<br><br>This will be the case, for example, if you use the PHP Fusebox architecture/framework.</span>
</code></div>
  </div>
 </div>
  <div class="note" id="87595">  
  <a class="name">
  <strong class="user"><em>walter</em></strong></a><div class="date" title="2008-12-11 07:48"><strong>5 years ago</strong></div>
  <div class="text" id="Hcom87595">
<div class="phpcode"><code><span class="html">
I have a very well tested module in my framework (ie: running in production environments for a couple of years) called 'fastpage', which takes care of both memcaching and gzipping for frequently requested content.&nbsp; It memcaches one version of each unique page both gzipped and non-gzipped, and returns the appropriate version based upon the browser's Accept-encoding header.<br><br>Use is: <br>$page_spec = array($dependent,$variables,$go,$here);<br>if(!fastpage_display('content_id',$page_spec)) {<br> ... make page here ...<br> fastpage_displayed('content_id',$page_spec);<br>}<br><br>Unfortunately, on IE8 beta (in IE8 mode, or in IE7 emulation mode), the fastpage-enabled content was not being un-gzipped.&nbsp; IE would request the content, a 200 status and correct byte count would appear in the server logfile, and IE would show no errors.&nbsp; However, CSS would not be applied and Javascript would not execute.<br><br>The only fix I can find right now is to disable gzip entirely for this browser.&nbsp; User agent string is: Mozilla/4.0 (compatible; MSIE 8.0; Windows NT 5.1; Trident/4.0; .NET CLR 2.0.50727<br><br>The same output works fine in firefox (windows, linux, mac), and in safari.<br><br>Versions are: zlib 1.2.3-r1 / php 5.2.6-r7 / lighttpd 1.4.20<br><br>So much for the 'this has been fixed in IE7' comment, above...</span>
</code></div>
  </div>
 </div>
  <div class="note" id="85327">  
  <a class="name">
  <strong class="user"><em>ronald at hidden dot com</em></strong></a><div class="date" title="2008-08-26 01:15"><strong>6 years ago</strong></div>
  <div class="text" id="Hcom85327">
<div class="phpcode"><code><span class="html">
Hi,<br><br>if you are using apache, I think you are much better of using apache's compression, as this will also compress static text files (css, js, html, etc) and it will keep your php-code clean.<br><br>See <a rel="nofollow" target="_blank">http://httpd.apache.org/docs/2.0/mod/mod_deflate.html</a> for an excellent how to.<br><br>And for other webservers, I'm pretty sure they have equivalents.<br><br>Cheers, Ronald</span>
</code></div>
  </div>
 </div>
  <div class="note" id="80014">  
  <a class="name">
  <strong class="user"><em>sugoi82 at removeme dot gmail dot spam dot com</em></strong></a><div class="date" title="2007-12-24 06:09"><strong>6 years ago</strong></div>
  <div class="text" id="Hcom80014">
<div class="phpcode"><code><span class="html">
in reply to nyarl at hotep dot co dot uk;<br><br>Your 'solution' doesn't really work since session_id() will return an empty string if there is no session started. Therefore it will never return NULL.<br>Yes the problem is gone, but also is your output buffering xD<br><br>I haven't found a solution to this problem yet... It seems ie6 just doesn't wanna play nice - like it does most of the times.</span>
</code></div>
  </div>
 </div>
  <div class="note" id="79711">  
  <a class="name">
  <strong class="user"><em>nyarl at hotep dot co dot uk</em></strong></a><div class="date" title="2007-12-09 06:45"><strong>6 years ago</strong></div>
  <div class="text" id="Hcom79711">
<div class="phpcode"><code><span class="html">
Seems others have had problems with IE6 giving blank pages erratically when using ob_start("ob_gzhandler"). One reason may be that a session has already been started, so try:<br><br><span class="default">&lt;?php<br>&nbsp; </span><span class="keyword">if (</span><span class="default">session_id</span><span class="keyword">() === </span><span class="default">null </span><span class="keyword">) </span><span class="default">ob_start</span><span class="keyword">(</span><span class="string">'ob_gzhandler'</span><span class="keyword">);<br></span><span class="default">?&gt;<br></span><br>Worked for me. :)</span>
</code></div>
  </div>
 </div>
  <div class="note" id="77696">  
  <a class="name">
  <strong class="user"><em>TheSeoDude</em></strong></a><div class="date" title="2007-09-09 03:34"><strong>6 years ago</strong></div>
  <div class="text" id="Hcom77696">
<div class="phpcode"><code><span class="html">
I wrote a simple script that I use on my site. Bandwidth consumption dropped dramatically. Pages shrunk 3-5 times.<br><br>The script simulates the results of using this function directly but by using regular output buffering with ob_start. So you get to output gzip and play with it before you do.<br><br>You can find the script with explanations here:<br><a rel="nofollow" target="_blank">http://www.tellinya.com/art2/106/gzip-compress-html</a><br><br>Cheers and input is always welcome fellow coders!</span>
</code></div>
  </div>
 </div>
  <div class="note" id="77447">  
  <a class="name">
  <strong class="user"><em>maratd at gmail dot com</em></strong></a><div class="date" title="2007-08-29 08:51"><strong>6 years ago</strong></div>
  <div class="text" id="Hcom77447">
<div class="phpcode"><code><span class="html">
Someone previously mentioned that MSIE doesn't cache gzipped content. This is false. He misread the source of information. In fact, IE will cache gzipped content no matter what. Here is the quote from the mailing list:<br><br>The reason the COMPRESSED responses are, in fact,<br>always getting cached no matter what "Vary:" field name<br>is present is just as I suspected... it is because MSIE<br>decides it MUST cache responses that arrive with<br>"Content-Encoding: gzip" because it MUST have a<br>disk ( cache ) file to work with in order to do the<br>decompression.<br><br>Source: <a rel="nofollow" target="_blank">http://lists.over.net/pipermail/mod_gzip/2002-December/006826.html</a></span>
</code></div>
  </div>
 </div>
  <div class="note" id="76845">  
  <a class="name">
  <strong class="user"><em>tehjosh at gamingg dot net</em></strong></a><div class="date" title="2007-08-01 04:18"><strong>7 years ago</strong></div>
  <div class="text" id="Hcom76845">
<div class="phpcode"><code><span class="html">
faisun at sina dot com:<br>If you read up on output buffering, you'll see that if an output buffer callback returns false, this instructs PHP to output the original string untouched.&nbsp; That's why ob_gzhandler() returns false if the encoding is not supported.&nbsp;&nbsp; When ob_start("ob_gzhandler") is used and encoding is not supported, ob_gzhandler() will return false and PHP outputs the original, uncompressed string.<br><br>jsnell at e-normous dot com:<br>Output buffering callback functions accept up to two parameters, so this would probably work better for your situation:<br><br><span class="default">&lt;?php<br></span><span class="keyword">function </span><span class="default">ob_gz_handler_no_errors</span><span class="keyword">(</span><span class="default">$buffer</span><span class="keyword">, </span><span class="default">$mode</span><span class="keyword">)<br>{<br>&nbsp; &nbsp; @</span><span class="default">ob_gzhandler</span><span class="keyword">(</span><span class="default">$buffer</span><span class="keyword">, </span><span class="default">$mode</span><span class="keyword">);<br>}<br><br></span><span class="default">ob_start</span><span class="keyword">(</span><span class="string">'ob_gzhandler_no_errors'</span><span class="keyword">);<br></span><span class="default">?&gt;<br></span><br>However, if you're trying to suppress errors caused by headers already being sent, it would be better to start the output buffering earlier, before any output can be sent.</span>
</code></div>
  </div>
 </div>
  <div class="note" id="75468">  
  <a class="name">
  <strong class="user"><em>jsnell at e-normous dot com</em></strong></a><div class="date" title="2007-05-31 11:04"><strong>7 years ago</strong></div>
  <div class="text" id="Hcom75468">
<div class="phpcode"><code><span class="html">
If you want to suppress errors (such as for cases when headers are already sent) and you don't want to write or patch your error_handler, you need to create an intermediate callback: <br><br>function ob_gz_handler_no_errors($buffer) <br>{<br>&nbsp; &nbsp; @ob_gzhandler($buffer);<br>}<br><br>ob_start('ob_gzhandler_no_errors');</span>
</code></div>
  </div>
 </div>
  <div class="note" id="69211">  
  <a class="name">
  <strong class="user"><em>fpiat at bigfoot dot com</em></strong></a><div class="date" title="2006-08-27 05:55"><strong>8 years ago</strong></div>
  <div class="text" id="Hcom69211">
<div class="phpcode"><code><span class="html">
DON'T compress/gzip your Error pages :<br><br>i can think of two good reasons not to compress your error pages:<br>1. You want to make sure that people can read you error pages, don't you ?<br>2. Compressing pages have a "side effect" : it's smaller !! if you return "HTTP/1.x 404 Document Not fount" (or any other HTTP error), MSIE will display it's built in error message, not yours if it's small than 513bytes. (see "HOW TO: Turn Off the Internet Explorer 5.x and 6.x 'Show Friendly HTTP Error Messages' Feature on the Server Side" <a rel="nofollow" target="_blank">http://support.microsoft.com/default.aspx?scid=kb;en-us;Q294807</a> )</span>
</code></div>
  </div>
 </div>
  <div class="note" id="69206">  
  <a class="name">
  <strong class="user"><em>spam_this at zleelz dot com</em></strong></a><div class="date" title="2006-08-26 11:49"><strong>8 years ago</strong></div>
  <div class="text" id="Hcom69206">
<div class="phpcode"><code><span class="html">
When writing scripts for distribution, I would usually "null" out the following deprecated superglobals so that users who uses the script will not be able to use them.<br><span class="default">&lt;?php<br>$HTTP_GET_VARS </span><span class="keyword">= </span><span class="default">null</span><span class="keyword">;<br></span><span class="default">$HTTP_POST_VARS </span><span class="keyword">= </span><span class="default">null</span><span class="keyword">;<br></span><span class="default">$HTTP_COOKIE_VARS </span><span class="keyword">= </span><span class="default">null</span><span class="keyword">;<br></span><span class="default">$HTTP_POST_FILES </span><span class="keyword">= </span><span class="default">null</span><span class="keyword">;<br></span><span class="default">$HTTP_SERVER_VARS </span><span class="keyword">= </span><span class="default">null</span><span class="keyword">;<br></span><span class="default">?&gt;<br></span><br>However, when using ob_start('ob_gzhandler'), one of those superglobals somehow disable this function.<br><br>Found out that it was $HTTP_SERVER_VARS that's causing the problems.<br><br><span class="default">&lt;?php<br>ob_start</span><span class="keyword">(</span><span class="string">'ob_gzhandler'</span><span class="keyword">);<br><br></span><span class="default">$HTTP_GET_VARS </span><span class="keyword">= </span><span class="default">null</span><span class="keyword">;<br></span><span class="default">$HTTP_POST_VARS </span><span class="keyword">= </span><span class="default">null</span><span class="keyword">;<br></span><span class="default">$HTTP_COOKIE_VARS </span><span class="keyword">= </span><span class="default">null</span><span class="keyword">;<br></span><span class="default">$HTTP_POST_FILES </span><span class="keyword">= </span><span class="default">null</span><span class="keyword">;<br></span><span class="comment">/**<br> * Causing the trouble<br> */<br>//$HTTP_SERVER_VARS = null;<br></span><span class="default">?&gt;<br></span><br>I don't know why it does that, but I just want to point that out.</span>
</code></div>
  </div>
 </div>
  <div class="note" id="61474">  
  <a class="name">
  <strong class="user"><em>mariusads[at]helpedia[dot]com</em></strong></a><div class="date" title="2006-02-04 09:56"><strong>8 years ago</strong></div>
  <div class="text" id="Hcom61474">
<div class="phpcode"><code><span class="html">
Please be aware that, as other users have already mentioned, the compression will fail if there are characters before the php start tag "&lt; ?". <br><br>This is also the case when saving files in UTF-8 format with editors such as Ultraedit. Make sure you save the file using the defined option UTF-8 NO BOM or delete the BOM otherwise the two UTF BOM characters will be written at the start of the file.</span>
</code></div>
  </div>
 </div>
  <div class="note" id="56550">  
  <a class="name">
  <strong class="user"><em>lapoint2 at msu dot edu</em></strong></a><div class="date" title="2005-09-06 06:40"><strong>8 years ago</strong></div>
  <div class="text" id="Hcom56550">
<div class="phpcode"><code><span class="html">
So why doesn't the web server just do this by default?&nbsp; <br>This works for me if I do:<br>ini_set('zlib.output_compression_level', 3);&nbsp; ob_start("ob_gzhandler"); <br>or even just:<br>ob_start("ob_gzhandler"); <br><br>I did the level 3 compression, I think the default was 6 and I didn't want to put too much load on the server.&nbsp; For a 895k file (my largest) the compression levels were:<br>1 = 189k<br>3 = 178k<br>4 = 163k<br>6 = 156k&nbsp; &nbsp; (I believe 6 is the default if you leave out the ini_set)<br>9 = 155k<br>I use <a rel="nofollow" target="_blank">http://www.whatsmyip.org/mod_gzip_test/</a> to check the sizes.<br><br>FYI: This works with dynamic files in Movable Type 3.x (I'm testing it in 3.2) I've got the above command in the first line of my mtview.php file.<br><br>More info here: <a rel="nofollow" target="_blank">http://www.whatsmyip.org/forum/viewtopic.php?t=43</a><br><br>On several sites I've read the some browsers don't like compressed CSS.</span>
</code></div>
  </div>
 </div>
  <div class="note" id="53827">  
  <a class="name">
  <strong class="user"><em>Tony Piper</em></strong></a><div class="date" title="2005-06-14 07:11"><strong>9 years ago</strong></div>
  <div class="text" id="Hcom53827">
<div class="phpcode"><code><span class="html">
I just spent 30 minutes wondering why my browser wasn't getting the gzipped version :-O<br><br>If you're using Google Web Access your pages will&nbsp; be delivered to the browser uncompressed unless you tell GWA to ignore the specific site. <br><br>Obvious, really.</span>
</code></div>
  </div>
 </div>
  <div class="note" id="53157">  
  <a class="name"><strong class="user"><em>Anonymous</em></strong></a><div class="date" title="2005-05-24 03:27"><strong>9 years ago</strong></div>
  <div class="text" id="Hcom53157">
<div class="phpcode"><code><span class="html">
No matter the circumstances, you MUST NOT check the user agent string to find out if gzip compression is enabled. HTTP defines the Accept-Encoding header for exactly this purpose and you MUST check it before enabling compression.</span>
</code></div>
  </div>
 </div>
  <div class="note" id="51949">  
  <a class="name">
  <strong class="user"><em>m at rtij dot nl</em></strong></a><div class="date" title="2005-04-16 05:29"><strong>9 years ago</strong></div>
  <div class="text" id="Hcom51949">
<div class="phpcode"><code><span class="html">
All versions of MSIE have a bug where they don't cache gzipd contents. If your application depends on caching, this is something to keep in mind. In the end, I did:<br><br><span class="default">&lt;?php<br><br></span><span class="comment">// These are so benificial, they default to true.<br></span><span class="keyword">if (!isset(</span><span class="default">$use_page_cache</span><span class="keyword">))<br>&nbsp; &nbsp; </span><span class="default">$use_page_cache </span><span class="keyword">= </span><span class="default">1</span><span class="keyword">;<br>if (!isset(</span><span class="default">$use_compression</span><span class="keyword">))<br>&nbsp; &nbsp; </span><span class="default">$use_compression </span><span class="keyword">= </span><span class="default">1</span><span class="keyword">;<br><br></span><span class="comment">// Add browsers here as we must detect them. Opera is an oddball, if we don't detect<br>// it specifically, it will turn up as MSIE<br><br></span><span class="default">$browser</span><span class="keyword">=</span><span class="string">"other"</span><span class="keyword">;<br>if (isset(</span><span class="default">$_SERVER</span><span class="keyword">[</span><span class="string">'HTTP_USER_AGENT'</span><span class="keyword">])) {<br>&nbsp; &nbsp; </span><span class="default">$agent </span><span class="keyword">= </span><span class="default">$_SERVER</span><span class="keyword">[</span><span class="string">'HTTP_USER_AGENT'</span><span class="keyword">];<br>&nbsp; &nbsp; if (</span><span class="default">eregi</span><span class="keyword">(</span><span class="string">"opera"</span><span class="keyword">,</span><span class="default">$agent</span><span class="keyword">)){<br>&nbsp; &nbsp; </span><span class="default">$browser</span><span class="keyword">=</span><span class="string">"opera"</span><span class="keyword">;<br>&nbsp; &nbsp; }elseif(</span><span class="default">eregi</span><span class="keyword">(</span><span class="string">"msie"</span><span class="keyword">,</span><span class="default">$agent</span><span class="keyword">)){<br>&nbsp; &nbsp; </span><span class="default">$browser</span><span class="keyword">=</span><span class="string">"msie"</span><span class="keyword">;<br>&nbsp; &nbsp; }<br>}<br><br>if (</span><span class="default">$use_compression </span><span class="keyword">&amp;&amp; !( </span><span class="default">$use_page_cache </span><span class="keyword">&amp;&amp; </span><span class="default">$browser </span><span class="keyword">== </span><span class="string">"msie"</span><span class="keyword">)) {<br>&nbsp; &nbsp; </span><span class="comment">// Turn on compression, makes quite a difference in bandwith usage.<br>&nbsp; &nbsp; // However, MSIE (all versions) have a bug with compression and caching. So for MSIE<br>&nbsp; &nbsp; // it's either compression or caching. We choose caching.<br>&nbsp; &nbsp; </span><span class="default">ob_start</span><span class="keyword">(</span><span class="string">'ob_gzhandler'</span><span class="keyword">);<br>}<br><br></span><span class="default">session_cache_limiter</span><span class="keyword">(</span><span class="string">"must-revalidate"</span><span class="keyword">);<br><br></span><span class="default">session_start</span><span class="keyword">();<br><br></span><span class="comment">// ... put stuff in $content ...<br><br></span><span class="keyword">if (</span><span class="default">$use_page_cache</span><span class="keyword">) {<br>&nbsp; &nbsp; </span><span class="comment">// MD5 is slow, however with a fast server (PIII or better) we should be OK<br>&nbsp; &nbsp; </span><span class="default">$hash </span><span class="keyword">= </span><span class="default">md5</span><span class="keyword">(</span><span class="default">$content</span><span class="keyword">);<br>&nbsp; &nbsp; </span><span class="default">$headers </span><span class="keyword">= </span><span class="default">getallheaders</span><span class="keyword">();<br>&nbsp; &nbsp; if (isset(</span><span class="default">$headers</span><span class="keyword">[</span><span class="string">'If-None-Match'</span><span class="keyword">]) &amp;&amp; </span><span class="default">ereg</span><span class="keyword">(</span><span class="default">$hash</span><span class="keyword">, </span><span class="default">$headers</span><span class="keyword">[</span><span class="string">'If-None-Match'</span><span class="keyword">]))<br>&nbsp; &nbsp; {<br>&nbsp; &nbsp; </span><span class="default">header</span><span class="keyword">(</span><span class="string">'HTTP/1.1 304 Not Modified'</span><span class="keyword">);<br>&nbsp; &nbsp; exit;<br>&nbsp; &nbsp; }<br>&nbsp; &nbsp; </span><span class="default">header</span><span class="keyword">(</span><span class="string">"ETag: \"</span><span class="default">$hash</span><span class="string">\""</span><span class="keyword">);<br>}<br><br>print </span><span class="default">$content</span><span class="keyword">;<br><br></span><span class="default">?&gt;</span>
</span>
</code></div>
  </div>
 </div>
  <div class="note" id="50691">  
  <a class="name">
  <strong class="user"><em>grange (at) club-internet (dot) fr</em></strong></a><div class="date" title="2005-03-07 07:17"><strong>9 years ago</strong></div>
  <div class="text" id="Hcom50691">
<div class="phpcode"><code><span class="html">
It may seem obvious but if you use ob_start("ob_gzhandler"),&nbsp; make sure no content is unintentionally echo'ed before : this could be blank lines before '&lt;?php' or after '?&gt;' tags in included files or even errors.<br><br>Otherwise, only a part of the content (the content sent after ob_start()) will be compressed, which will confuse the client.<br><br>Setting compression using zlib.output_compression either in php.ini or in Apache configuration file (with directive php_flag) is safer in this regard.</span>
</code></div>
  </div>
 </div>
  <div class="note" id="50219">  
  <a class="name">
  <strong class="user"><em>wallacebw at some-domain dot com</em></strong></a><div class="date" title="2005-02-21 09:50"><strong>9 years ago</strong></div>
  <div class="text" id="Hcom50219">
<div class="phpcode"><code><span class="html">
IE 6+ appears to validate the CRC and disgard invalid gzip content FYI...<br>Brian</span>
</code></div>
  </div>
 </div>
  <div class="note" id="41158">  
  <a class="name">
  <strong class="user"><em>andy dot rem dot ove dot this at occ dot be</em></strong></a><div class="date" title="2004-04-01 02:21"><strong>10 years ago</strong></div>
  <div class="text" id="Hcom41158">
<div class="phpcode"><code><span class="html">
From what I can understand, quite some people seem to have problems with this functionality.&nbsp; If you want to do this quick, like i did, you can use the outstanding class gzip_encode made by Leknor at <a rel="nofollow" target="_blank">http://leknor.com/code/php/view/class.gzip_encode.php.txt</a></span>
</code></div>
  </div>
 </div>
  <div class="note" id="40894">  
  <a class="name">
  <strong class="user"><em>mazsolt at yahoo dot com</em></strong></a><div class="date" title="2004-03-18 07:20"><strong>10 years ago</strong></div>
  <div class="text" id="Hcom40894">
<div class="phpcode"><code><span class="html">
if you want to send an output to the browser (which accepts gzip), and you haven't set the buffering callback ob_start("ob_gzhandler"), you may use the gzencode() function.<br><br>header("Content-Encoding: gzip");<br>echo gzencode("some output", 9, FORCE_GZIP);</span>
</code></div>
  </div>
 </div>
  <div class="note" id="35969">  
  <a class="name">
  <strong class="user"><em>brewthatistrue at plzYnoAspamHorOevilO dot com</em></strong></a><div class="date" title="2003-09-21 02:04"><strong>10 years ago</strong></div>
  <div class="text" id="Hcom35969">
<div class="phpcode"><code><span class="html">
i had a LOT of trouble trying to get gzipping working correctly<br>i kept getting a blank page on the first load, although subsequent pages loaded fine.<br>i tried stuff with ob_flush and ob_end_clean and all kinds of stuff i didn't understand. i'm totally confused about different versions of php and different methods of gzipping.<br><br>in the end, i got it working (maybe i'll understand it later).<br>i ended up using phpBB's code (stripped of non-gz stuff, and ever-so-slightly modified)<br><a rel="nofollow" target="_blank">http://phpbb.com/</a><br><br>index.php:<br>------------<br><span class="default">&lt;?php<br></span><span class="keyword">require_once(</span><span class="string">'top.php'</span><span class="keyword">);<br><br>echo </span><span class="string">"&lt;html&gt;\n&lt;head&gt;\n&lt;title&gt;Gzip Test&lt;/title&gt;\n&lt;body&gt;\n&lt;h1&gt;testing&lt;/h1&gt;\n&lt;/body&gt;\n&lt;/html&gt;"</span><span class="keyword">;<br><br>require_once(</span><span class="string">'bottom.php'</span><span class="keyword">);<br></span><span class="default">?&gt;<br></span><br>gz_header.php - taken form phpBB's page_header.php<br>--------------<br><span class="default">&lt;?php<br>&nbsp; &nbsp; $phpver </span><span class="keyword">= </span><span class="default">phpversion</span><span class="keyword">();<br><br>&nbsp; &nbsp; </span><span class="default">$useragent </span><span class="keyword">= (isset(</span><span class="default">$_SERVER</span><span class="keyword">[</span><span class="string">"HTTP_USER_AGENT"</span><span class="keyword">]) ) ? </span><span class="default">$_SERVER</span><span class="keyword">[</span><span class="string">"HTTP_USER_AGENT"</span><span class="keyword">] : </span><span class="default">$HTTP_USER_AGENT</span><span class="keyword">;<br><br>&nbsp; &nbsp; if ( </span><span class="default">$phpver </span><span class="keyword">&gt;= </span><span class="string">'4.0.4pl1' </span><span class="keyword">&amp;&amp; ( </span><span class="default">strstr</span><span class="keyword">(</span><span class="default">$useragent</span><span class="keyword">,</span><span class="string">'compatible'</span><span class="keyword">) || </span><span class="default">strstr</span><span class="keyword">(</span><span class="default">$useragent</span><span class="keyword">,</span><span class="string">'Gecko'</span><span class="keyword">) ) )<br>&nbsp; &nbsp; {<br>&nbsp; &nbsp; &nbsp; &nbsp; if ( </span><span class="default">extension_loaded</span><span class="keyword">(</span><span class="string">'zlib'</span><span class="keyword">) )<br>&nbsp; &nbsp; &nbsp; &nbsp; {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">ob_start</span><span class="keyword">(</span><span class="string">'ob_gzhandler'</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; }<br>&nbsp; &nbsp; }<br>&nbsp; &nbsp; else if ( </span><span class="default">$phpver </span><span class="keyword">&gt; </span><span class="string">'4.0' </span><span class="keyword">)<br>&nbsp; &nbsp; {<br>&nbsp; &nbsp; &nbsp; &nbsp; if ( </span><span class="default">strstr</span><span class="keyword">(</span><span class="default">$HTTP_SERVER_VARS</span><span class="keyword">[</span><span class="string">'HTTP_ACCEPT_ENCODING'</span><span class="keyword">], </span><span class="string">'gzip'</span><span class="keyword">) )<br>&nbsp; &nbsp; &nbsp; &nbsp; {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if ( </span><span class="default">extension_loaded</span><span class="keyword">(</span><span class="string">'zlib'</span><span class="keyword">) )<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$do_gzip_compress </span><span class="keyword">= </span><span class="default">TRUE</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">ob_start</span><span class="keyword">();<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">ob_implicit_flush</span><span class="keyword">(</span><span class="default">0</span><span class="keyword">);<br><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">header</span><span class="keyword">(</span><span class="string">'Content-Encoding: gzip'</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br>&nbsp; &nbsp; &nbsp; &nbsp; }<br>&nbsp; &nbsp; }<br></span><span class="default">?&gt;<br></span>gz_footer.php - taken form phpBB's page_tail.php<br>------------<br><span class="default">&lt;?php<br></span><span class="comment">// Compress buffered output if required and send to browser<br></span><span class="keyword">if ( </span><span class="default">$do_gzip_compress </span><span class="keyword">)<br>{<br>&nbsp; &nbsp; </span><span class="comment">//<br>&nbsp; &nbsp; // Borrowed from php.net!<br>&nbsp; &nbsp; //<br>&nbsp; &nbsp; </span><span class="default">$gzip_contents </span><span class="keyword">= </span><span class="default">ob_get_contents</span><span class="keyword">();<br>&nbsp; &nbsp; </span><span class="default">ob_end_clean</span><span class="keyword">();<br><br>&nbsp; &nbsp; </span><span class="default">$gzip_size </span><span class="keyword">= </span><span class="default">strlen</span><span class="keyword">(</span><span class="default">$gzip_contents</span><span class="keyword">);<br>&nbsp; &nbsp; </span><span class="default">$gzip_crc </span><span class="keyword">= </span><span class="default">crc32</span><span class="keyword">(</span><span class="default">$gzip_contents</span><span class="keyword">);<br><br>&nbsp; &nbsp; </span><span class="default">$gzip_contents </span><span class="keyword">= </span><span class="default">gzcompress</span><span class="keyword">(</span><span class="default">$gzip_contents</span><span class="keyword">, </span><span class="default">9</span><span class="keyword">);<br>&nbsp; &nbsp; </span><span class="default">$gzip_contents </span><span class="keyword">= </span><span class="default">substr</span><span class="keyword">(</span><span class="default">$gzip_contents</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">strlen</span><span class="keyword">(</span><span class="default">$gzip_contents</span><span class="keyword">) - </span><span class="default">4</span><span class="keyword">);<br><br>&nbsp; &nbsp; echo </span><span class="string">"\x1f\x8b\x08\x00\x00\x00\x00\x00"</span><span class="keyword">;<br>&nbsp; &nbsp; echo </span><span class="default">$gzip_contents</span><span class="keyword">;<br>&nbsp; &nbsp; echo </span><span class="default">pack</span><span class="keyword">(</span><span class="string">'V'</span><span class="keyword">, </span><span class="default">$gzip_crc</span><span class="keyword">);<br>&nbsp; &nbsp; echo </span><span class="default">pack</span><span class="keyword">(</span><span class="string">'V'</span><span class="keyword">, </span><span class="default">$gzip_size</span><span class="keyword">);<br>}<br><br>exit;<br></span><span class="default">?&gt;<br></span><br>i must admit to not seeing this working in opera 7.11. perhaps i will figure that one out.<br>if there is anything i should change email me and i can edit my post</span>
</code></div>
  </div>
 </div>
  <div class="note" id="35585">  
  <a class="name">
  <strong class="user"><em>daijoubu at videotron dot ca</em></strong></a><div class="date" title="2003-09-06 04:35"><strong>10 years ago</strong></div>
  <div class="text" id="Hcom35585">
<div class="phpcode"><code><span class="html">
About the previous note from Davey:<br><br>ob_start(array('ob_gzhandler',9));<br><br>Does not work. The output size isnï¿½t affected at all, stays the same.<br><br>ob_gzhandler compression level use zlib.output_compression_level, which is -1 per default, level 6.<br><br>To change the compression level on the fly, simply use ini_set:<br><span class="default">&lt;?php<br>ini_set</span><span class="keyword">(</span><span class="string">'zlib.output_compression_level'</span><span class="keyword">, </span><span class="default">1</span><span class="keyword">);<br></span><span class="default">ob_start</span><span class="keyword">(</span><span class="string">'ob_gzhandler'</span><span class="keyword">);<br>echo </span><span class="string">'This is compressed at level 1'</span><span class="keyword">;<br></span><span class="default">?&gt;</span>
</span>
</code></div>
  </div>
 </div>
  <div class="note" id="31243">  
  <a class="name">
  <strong class="user"><em>nospam at 1111-internet dot com</em></strong></a><div class="date" title="2003-04-15 01:47"><strong>11 years ago</strong></div>
  <div class="text" id="Hcom31243">
<div class="phpcode"><code><span class="html">
Following up on my previous post - it appears that while:<br><br><span class="default">&lt;?php<br>ini_set</span><span class="keyword">(</span><span class="string">"zlib.output_compression"</span><span class="keyword">, </span><span class="string">"Off"</span><span class="keyword">); </span><span class="comment">// with no headers yet sent<br>// followed by the rest of your code...<br></span><span class="default">?&gt;<br></span><br>did not work in php 4.2.3, it did begin to work as of php 4.3.0 as an override to the php.ini "zlib.output_compression=on" setting. I did not see this in the change log.<br><br>In light of this, I'd say using zlib.output_compression is definitely the way to go over ob_gzhandler() in most cases.</span>
</code></div>
  </div>
 </div>
  <div class="note" id="30943">  
  <a class="name">
  <strong class="user"><em>davey at its-explosive dot net</em></strong></a><div class="date" title="2003-04-03 06:41"><strong>11 years ago</strong></div>
  <div class="text" id="Hcom30943">
<div class="phpcode"><code><span class="html">
To pass the second argument to ob_gzhandler() which specifies what level of compression should be used (which I assume is 1-9 as with the gzip binary, with 9 using the most processor and time to do, 4 is the standard IIRC) you must call ob_start() like so:<br><br>ob_start(array('ob_gzhandler',9));<br><br>- Davey</span>
</code></div>
  </div>
 </div>
  <div class="note" id="30159">  
  <a class="name">
  <strong class="user"><em>nospam at 1111-internet dot com</em></strong></a><div class="date" title="2003-03-08 03:23"><strong>11 years ago</strong></div>
  <div class="text" id="Hcom30159">
<div class="phpcode"><code><span class="html">
Differences between zlib.output_compression and ob_gzhandler:<br><br>zlib.output_compression runs in parallel with script execution - it begins compressing as soon as it receives any output from your script, and sends data to the client each time its buffer (4K by default) gets full. ob_gzhandler (actually 'ob_start("ob_gzhandler");') will not start compressing until the script flushes (or, usually, exits), and will in turn send the entire compressed document at once - which makes it more susceptible to causing a perception of latency.<br><br>Advantage: zlib.output_compression<br><br>On the other hand, ob_gzhandler gives you script-level control allowing you to use it selectively or to unset it after setting it in certain cases. Despite some documentation to the contrary, zlib.output_compression does not appear to be able to be set or unset on a script level; you must instead set it globally (in php.ini) or in your webserver configs or .htaccess files, possibly using FilesMatch-type mechanisms to control which scripts it will or won't apply to - which could get unwieldy for large projects - particularly those which employ PHP to produce images and other non-text output in addition to normal text output.<br><br>Advantage: ob_gzhandler<br><br>Net advantage: depends on your particular needs. I'm trying zlib.output_compression for now, but I miss the flexibility that ob_gzhandler would provide.<br><br>p.s. here's an Apache 1.3.* httpd.conf/.htaccess file snippet that demonstrates the syntax for conditionally setting zlib.output_compression:<br><br>&lt;FilesMatch "\.(php|html?)$"&gt;<br># turn it on with the buffer set to 2K using php_value<br>php_value zlib.output_compression 2048<br># or just turn it on using php_flag<br># php_flag zlib.output_compression On<br>&lt;/FilesMatch&gt;</span>
</code></div>
  </div>
 </div>
  <div class="note" id="30030">  
  <a class="name">
  <strong class="user"><em>aki at robotnik dot net</em></strong></a><div class="date" title="2003-03-04 11:13"><strong>11 years ago</strong></div>
  <div class="text" id="Hcom30030">
<div class="phpcode"><code><span class="html">
if you get errors like:<br>"output handler 'ob_gzhandler' cannot be used twice"<br>if you are using <br>"ob_start("ob_gzhandler");"<br><br>check for your php.ini file, it should look like this:<br><br>output_buffering = Off&nbsp; ; delete the 4096k value<br>output_handler = <br>zlib.output_compression = Off</span>
</code></div>
  </div>
 </div>
  <div class="note" id="26619">  
  <a class="name">
  <strong class="user"><em>dsugar100 at dolphinsoft dot com</em></strong></a><div class="date" title="2002-11-06 03:33"><strong>11 years ago</strong></div>
  <div class="text" id="Hcom26619">
<div class="phpcode"><code><span class="html">
I have noticed that if you have the php setting for zlib.output_compression set to 'On' AND you attempt to use hte ob_gzhandler handler to ob_start () the output you get in the browser WILL be garbled in PHP 4.2.3.&nbsp; I'm guessing that the output buffering is compressing the output to be sent, and then zlib is doing it a second time, but the browser is only uncompressing it once.<br><br>But using either one will give you the same results (compressed output from the script)</span>
</code></div>
  </div>
 </div>
  <div class="note" id="25607">  
  <a class="name">
  <strong class="user"><em>nid at home dot se</em></strong></a><div class="date" title="2002-09-30 04:10"><strong>11 years ago</strong></div>
  <div class="text" id="Hcom25607">
<div class="phpcode"><code><span class="html">
If you are trying to use the ob_gzhandler in a MSHTA (Microsoft HTML Application) you will find that your pages does not show up. the MSHTA-browser probably says it can handle gzip, but it just won't work (IE:6, PHP:4.1.2)</span>
</code></div>
  </div>
 </div>
  <div class="note" id="24157">  
  <a class="name">
  <strong class="user"><em>psychones at ifrance dot com</em></strong></a><div class="date" title="2002-08-08 05:18"><strong>12 years ago</strong></div>
  <div class="text" id="Hcom24157">
<div class="phpcode"><code><span class="html">
Problem revelate by xn@bnw.com<br><br>cause real problem when you have a global call<br>to ob_gzhandler , for example in an include configuration<br>file , and you want send a non gzip content , for any reason ...<br><br>To resolve it ,<br><br>put this after your global call to ob_gzhandler <br><br>include("conf_that_call_ob_gzhandler.php");<br>--&gt;ob_end_clean();<br>--&gt;header("Content-Encoding: none");<br><br>If you try to overload the header before the the ob_gzhandler call<br>or during the buffering output , it will not work .<br>( probably erase at the call of ob_gzhandler&nbsp; and not allow during<br>buffering ).<br><br>Hope this help</span>
</code></div>
  </div>
 </div>
  <div class="note" id="22593">  
  <a class="name">
  <strong class="user"><em>isoma at altavista dot net</em></strong></a><div class="date" title="2002-06-24 07:44"><strong>12 years ago</strong></div>
  <div class="text" id="Hcom22593">
<div class="phpcode"><code><span class="html">
RFC 2616 suggests that a more correct way to compress documents on the fly is to use gzip transfer encoding rather than gzip content encoding.&nbsp; &nbsp; However, it's perhaps not advisable to use this since client support for it is extremely limited.<br><br>The difference is most evident when you come to save a file from your browser.&nbsp; If it's gzip content encoded then the browser should (and may well) save it gzipped.&nbsp; If it's gzip transfer encoded then the browser should uncompress it first.</span>
</code></div>
  </div>
 </div>
  <div class="note" id="21846">  
  <a class="name">
  <strong class="user"><em>Sven dot Dickert at planb dot de</em></strong></a><div class="date" title="2002-05-29 04:54"><strong>12 years ago</strong></div>
  <div class="text" id="Hcom21846">
<div class="phpcode"><code><span class="html">
Following Browsers send<br>Accept-Encoding: gzip<br>but have Problems with<br>Content-Encoding: gzip<br><br>* netscape &lt; 5 have problems with CSS/Javascript parts sendet in gzip<br>* opera 5.x,6 store downloads compressed<br>* lynx 2.8.4 store downloads compressed but tells this with attaching ".gz" to the filename<br><br>You should know about:<br>* Internet Explorer 5.x,6 should turned to HTTP 1.1 to get "Accept-Encoding: gzip"<br>* In Mozilla 1.0 RC2 you can write the "Accept-Encoding:" in Preferences/Advanced/HTTP Networking</span>
</code></div>
  </div>
 </div>
  <div class="note" id="20704">  
  <a class="name">
  <strong class="user"><em>xn at bnw dot com</em></strong></a><div class="date" title="2002-04-12 08:40"><strong>12 years ago</strong></div>
  <div class="text" id="Hcom20704">
<div class="phpcode"><code><span class="html">
if you call ob_end_clean() after ob_start("ob_gzhandler"), the "Content-Encoding: gzip" header will still get sent (assuming the browser supports the encoding).&nbsp; if you don't call ob_start() again with the ob_gzhandler callback function, the output will not be compressed, but the header will say it is.&nbsp; this causes mozilla (as of build 2002032808) to display a blank page.</span>
</code></div>
  </div>
 </div>
  <div class="note" id="19573">  
  <a class="name">
  <strong class="user"><em>junior at jaj dot com</em></strong></a><div class="date" title="2002-03-04 10:12"><strong>12 years ago</strong></div>
  <div class="text" id="Hcom19573">
<div class="phpcode"><code><span class="html">
To get this to work properly, you have to compile PHP with "--with-zlib". If you don't, you won't get any errors, it just won't actually compress anything. This is a phenomenal thing. For just a small bit of processor time, you can DRASTICALLY reduce the bandwidth requirement of your scripts. There are very few circumstances in which this should not be used.</span>
</code></div>
  </div>
 </div>
  <div class="note" id="73516">  
  <a class="name">
  <strong class="user"><em>sredhead</em></strong></a><div class="date" title="2007-02-27 03:35"><strong>7 years ago</strong></div>
  <div class="text" id="Hcom73516">
<div class="phpcode"><code><span class="html">
One of the earlier posts says caching of gzipped files is broken in all versions of MSIE. The following blog entry appears to declare that this has been fixed in IE7, but I haven't verified this.<br><br><a rel="nofollow" target="_blank">http://blogs.msdn.com/ie/archive/2005/10/31/487509.aspx</a></span>
</code></div>
  </div>
 </div>
  <div class="note" id="65386">  
  <a class="name">
  <strong class="user"><em>michael at michaelphipps dot com</em></strong></a><div class="date" title="2006-04-29 03:34"><strong>8 years ago</strong></div>
  <div class="text" id="Hcom65386">
<div class="phpcode"><code><span class="html">
It is also possible to use ob_gzhandler to compress css and javascript files, however some browsers such as firefox expect content type text/css on css files.<br><br>To get around this send a content type header:<br><br><span class="default">&lt;?php<br>ob_start</span><span class="keyword">(</span><span class="string">'ob_gzhandler'</span><span class="keyword">);<br></span><span class="default">?&gt;<br></span><br>.... your css content ...<br><br><span class="default">&lt;?php<br>header</span><span class="keyword">(</span><span class="string">"Content-Type: text/css"</span><span class="keyword">);<br></span><span class="default">header</span><span class="keyword">(</span><span class="string">"Content-Length: "</span><span class="keyword">.</span><span class="default">ob_get_length</span><span class="keyword">());<br></span><span class="default">ob_end_flush</span><span class="keyword">();<br></span><span class="default">?&gt;</span>
</span>
</code></div>
  </div>
 </div></div>

 
</section>    </section><!-- layout-content -->
        


  </div><!-- layout -->
         
  

    
 <!-- External and third party libraries. -->
 







<a id="toTop" href="javascript:;"><span id="toTopHover"></span><img width="40" height="40" alt="To Top" src="../../images/to-top%402x.png"></a>



<!-- Mirrored from php.net/manual/en/function.ob-gzhandler.php by HTTrack Website Copier/3.x [XR&CO'2013], Thu, 28 Aug 2014 16:08:38 GMT -->


</body></html>