<html><!-- Mirrored from php.net/manual/en/function.ftp-nlist.php by HTTrack Website Copier/3.x [XR&CO'2013], Thu, 28 Aug 2014 16:00:24 GMT --><!-- Added by HTTrack --><head><meta http-equiv="content-type" content="text/html;charset=utf-8"><!-- /Added by HTTrack -->


  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0"> 

  <title>ftp_nlist</title>

 <link rel="shortcut icon" href="../../favicon.ico">
 <link rel="search" type="application/opensearchdescription+xml" href="http://php.net/phpnetimprovedsearch.src" title="Add PHP.net search">
 <link rel="alternate" type="application/atom+xml" href="http://php.net/releases/feed.php" title="PHP Release feed">
 <link rel="alternate" type="application/atom+xml" href="http://php.net/feed.atom" title="PHP: Hypertext Preprocessor">

 <link rel="canonical" href="function.ftp-nlist.html">
 <link rel="shorturl" href="http://php.net/ftp-nlist">
 <link rel="alternate" href="http://php.net/ftp-nlist" hreflang="x-default">

 <link rel="contents" href="index-2.html">
 <link rel="index" href="ref.ftp.html">
 <link rel="prev" href="function.ftp-nb-put.html">
 <link rel="next" href="function.ftp-pasv.html">

 <link rel="alternate" href="function.ftp-nlist.html" hreflang="en">
 <link rel="alternate" href="http://php.net/manual/pt_BR/function.ftp-nlist.php" hreflang="pt_BR">
 <link rel="alternate" href="http://php.net/manual/zh/function.ftp-nlist.php" hreflang="zh">
 <link rel="alternate" href="http://php.net/manual/fr/function.ftp-nlist.php" hreflang="fr">
 <link rel="alternate" href="http://php.net/manual/de/function.ftp-nlist.php" hreflang="de">
 <link rel="alternate" href="http://php.net/manual/it/function.ftp-nlist.php" hreflang="it">
 <link rel="alternate" href="http://php.net/manual/ja/function.ftp-nlist.php" hreflang="ja">
 <link rel="alternate" href="http://php.net/manual/ro/function.ftp-nlist.php" hreflang="ro">
 <link rel="alternate" href="http://php.net/manual/ru/function.ftp-nlist.php" hreflang="ru">
 <link rel="alternate" href="http://php.net/manual/es/function.ftp-nlist.php" hreflang="es">
 <link rel="alternate" href="http://php.net/manual/tr/function.ftp-nlist.php" hreflang="tr">

<link rel="stylesheet" type="text/css" href="../../cached8fe1.css?t=1401250819&amp;f=/fonts/Fira/fira.css" media="screen">
<link rel="stylesheet" type="text/css" href="../../cached4b8d.css?t=1404368420&amp;f=/fonts/Font-Awesome/css/fontello.css" media="screen">
<link rel="stylesheet" type="text/css" href="../../cached5065.css?t=1403329232&amp;f=/styles/theme-base.css" media="screen">
<link rel="stylesheet" type="text/css" href="../../cachedc78d.css?t=1401249623&amp;f=/styles/theme-medium.css" media="screen">

 <!--[if lte IE 7]>
 <link rel="stylesheet" type="text/css" href="http://php.net/styles/workarounds.ie7.css" media="screen">
 <![endif]-->

 <!--[if lte IE 8]>
 <script type="text/javascript">
  window.brokenIE = true;
 </script>
 <![endif]-->

 <!--[if lte IE 9]>
 <link rel="stylesheet" type="text/css" href="http://php.net/styles/workarounds.ie9.css" media="screen">
 <![endif]-->

 <!--[if IE]>
 <script type="text/javascript" src="http://php.net/js/ext/html5.js"></script>
 <![endif]-->

 <base>

</head>
<body class="docs " style="">


<div class="headsup"><a href="http://php.net/index.php#id2014-08-28-1">PHP 5.6.0 released</a></div>
<nav id="trick"><div><dl>
<dt><a href="getting-started.html">Getting Started</a></dt>
	<dd><a href="introduction.html">Introduction</a></dd>
	<dd><a href="tutorial.html">A simple tutorial</a></dd>
<dt><a href="langref.html">Language Reference</a></dt>
	<dd><a href="language.basic-syntax.html">Basic syntax</a></dd>
	<dd><a href="language.types.html">Types</a></dd>
	<dd><a href="language.variables.html">Variables</a></dd>
	<dd><a href="language.constants.html">Constants</a></dd>
	<dd><a href="language.expressions.html">Expressions</a></dd>
	<dd><a href="language.operators.html">Operators</a></dd>
	<dd><a href="language.control-structures.html">Control Structures</a></dd>
	<dd><a href="language.functions.html">Functions</a></dd>
	<dd><a href="language.oop5.html">Classes and Objects</a></dd>
	<dd><a href="language.namespaces.html">Namespaces</a></dd>
	<dd><a href="language.exceptions.html">Exceptions</a></dd>
	<dd><a href="language.generators.html">Generators</a></dd>
	<dd><a href="language.references.html">References Explained</a></dd>
	<dd><a href="reserved.variables.html">Predefined Variables</a></dd>
	<dd><a href="reserved.exceptions.html">Predefined Exceptions</a></dd>
	<dd><a href="reserved.interfaces.html">Predefined Interfaces and Classes</a></dd>
	<dd><a href="context.html">Context options and parameters</a></dd>
	<dd><a href="wrappers.html">Supported Protocols and Wrappers</a></dd>
</dl>
<dl>
<dt><a href="security.html">Security</a></dt>
	<dd><a href="security.intro.html">Introduction</a></dd>
	<dd><a href="security.general.html">General considerations</a></dd>
	<dd><a href="security.cgi-bin.html">Installed as CGI binary</a></dd>
	<dd><a href="security.apache.html">Installed as an Apache module</a></dd>
	<dd><a href="security.filesystem.html">Filesystem Security</a></dd>
	<dd><a href="security.database.html">Database Security</a></dd>
	<dd><a href="security.errors.html">Error Reporting</a></dd>
	<dd><a href="security.globals.html">Using Register Globals</a></dd>
	<dd><a href="security.variables.html">User Submitted Data</a></dd>
	<dd><a href="security.magicquotes.html">Magic Quotes</a></dd>
	<dd><a href="security.hiding.html">Hiding PHP</a></dd>
	<dd><a href="security.current.html">Keeping Current</a></dd>
<dt><a href="features.html">Features</a></dt>
	<dd><a href="features.http-auth.html">HTTP authentication with PHP</a></dd>
	<dd><a href="features.cookies.html">Cookies</a></dd>
	<dd><a href="features.sessions.html">Sessions</a></dd>
	<dd><a href="features.xforms.html">Dealing with XForms</a></dd>
	<dd><a href="features.file-upload.html">Handling file uploads</a></dd>
	<dd><a href="features.remote-files.html">Using remote files</a></dd>
	<dd><a href="features.connection-handling.html">Connection handling</a></dd>
	<dd><a href="features.persistent-connections.html">Persistent Database Connections</a></dd>
	<dd><a href="features.safe-mode.html">Safe Mode</a></dd>
	<dd><a href="features.commandline.html">Command line usage</a></dd>
	<dd><a href="features.gc.html">Garbage Collection</a></dd>
	<dd><a href="features.dtrace.html">DTrace Dynamic Tracing</a></dd>
</dl>
<dl>
<dt><a href="funcref.html">Function Reference</a></dt>
	<dd><a href="refs.basic.php.html">Affecting PHP's Behaviour</a></dd>
	<dd><a href="refs.utilspec.audio.html">Audio Formats Manipulation</a></dd>
	<dd><a href="refs.remote.auth.html">Authentication Services</a></dd>
	<dd><a href="refs.utilspec.cmdline.html">Command Line Specific Extensions</a></dd>
	<dd><a href="refs.compression.html">Compression and Archive Extensions</a></dd>
	<dd><a href="refs.creditcard.html">Credit Card Processing</a></dd>
	<dd><a href="refs.crypto.html">Cryptography Extensions</a></dd>
	<dd><a href="refs.database.html">Database Extensions</a></dd>
	<dd><a href="refs.calendar.html">Date and Time Related Extensions</a></dd>
	<dd><a href="refs.fileprocess.file.html">File System Related Extensions</a></dd>
	<dd><a href="refs.international.html">Human Language and Character Encoding Support</a></dd>
	<dd><a href="refs.utilspec.image.html">Image Processing and Generation</a></dd>
	<dd><a href="refs.remote.mail.html">Mail Related Extensions</a></dd>
	<dd><a href="refs.math.html">Mathematical Extensions</a></dd>
	<dd><a href="refs.utilspec.nontext.html">Non-Text MIME Output</a></dd>
	<dd><a href="refs.fileprocess.process.html">Process Control Extensions</a></dd>
	<dd><a href="refs.basic.other.html">Other Basic Extensions</a></dd>
	<dd><a href="refs.remote.other.html">Other Services</a></dd>
	<dd><a href="refs.search.html">Search Engine Extensions</a></dd>
	<dd><a href="refs.utilspec.server.html">Server Specific Extensions</a></dd>
	<dd><a href="refs.basic.session.html">Session Extensions</a></dd>
	<dd><a href="refs.basic.text.html">Text Processing</a></dd>
	<dd><a href="refs.basic.vartype.html">Variable and Type Related Extensions</a></dd>
	<dd><a href="refs.webservice.html">Web Services</a></dd>
	<dd><a href="refs.utilspec.windows.html">Windows Only Extensions</a></dd>
	<dd><a href="refs.xml.html">XML Manipulation</a></dd>
</dl>
<dl>
<dt>Keyboard Shortcuts</dt><dt>?</dt>
<dd>This help</dd>
<dt>j</dt>
<dd>Next menu item</dd>
<dt>k</dt>
<dd>Previous menu item</dd>
<dt>g p</dt>
<dd>Previous man page</dd>
<dt>g n</dt>
<dd>Next man page</dd>
<dt>G</dt>
<dd>Scroll to bottom</dd>
<dt>g g</dt>
<dd>Scroll to top</dd>
<dt>g h</dt>
<dd>Goto homepage</dd>
<dt>g s</dt>
<dd>Goto search<br>(current page)</dd>
<dt>/</dt>
<dd>Focus search box</dd>
</dl></div></nav>
<div id="goto">
    <div class="search">
         <div class="text"></div>
         <div class="results"><ul></ul></div>
   </div>
</div>

  <div id="breadcrumbs" class="row-fluid">
          
              
        <ul class="breadcrumbs-container">
            <li><a href="index-2.html">PHP Manual</a></li>      <li><a href="funcref.html">Function Reference</a></li>      <li><a href="refs.remote.other.html">Other Services</a></li>      <li><a href="book.ftp.html">FTP</a></li>      <li><a href="ref.ftp.html">FTP Functions</a></li>    </ul>
  </div>




<div id="layout">
  <section id="layout-content">
  <div id="function.ftp-nlist" class="refentry">
 <div class="refnamediv">
  <h1 class="refname">ftp_nlist</h1>
  <p class="verinfo">(PHP 4, PHP 5)</p><p class="refpurpose"><span class="refname">ftp_nlist</span> â€” <span class="dc-title">Returns a list of files in the given directory</span></p>

 </div>
 <div class="refsect1 description" id="refsect1-function.ftp-nlist-description">
  <h3 class="title">Description</h3>
  <div class="methodsynopsis dc-description">
   <span class="type">array</span> <span class="methodname"><strong>ftp_nlist</strong></span>
    ( <span class="methodparam"><span class="type">resource</span> <code class="parameter">$ftp_stream</code></span>
   , <span class="methodparam"><span class="type">string</span> <code class="parameter">$directory</code></span>
   )</div>

 </div>

 <div class="refsect1 parameters" id="refsect1-function.ftp-nlist-parameters">
  <h3 class="title">Parameters</h3>
  <p class="para">
   </p><dl>

    
     <dt>
<code class="parameter">ftp_stream</code></dt>

     <dd>

      <p class="para">
       The link identifier of the FTP connection.
      </p>
     </dd>

    
    
     <dt>
<code class="parameter">directory</code></dt>

     <dd>

      <p class="para">
       The directory to be listed. This parameter can also include arguments, eg.
       ftp_nlist($conn_id, "-la /your/dir");
       Note that this parameter isn't escaped so there may be some issues with
       filenames containing spaces and other characters. 
      </p>
     </dd>

    
   </dl>

  <p></p>
 </div>

 <div class="refsect1 returnvalues" id="refsect1-function.ftp-nlist-returnvalues">
  <h3 class="title">Return Values</h3>
  <p class="para">
   Returns an array of filenames from the specified directory on success or
   <strong><code>FALSE</code></strong> on error.
  </p>
 </div>

 <div class="refsect1 examples" id="refsect1-function.ftp-nlist-examples">
  <h3 class="title">Examples</h3>
  <p class="para">
   </p><div class="example" id="example-4412">
    <p><strong>Example #1 <span class="function"><strong>ftp_nlist()</strong></span> example</strong></p>
    <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br><br></span><span style="color: #FF8000">//&nbsp;set&nbsp;up&nbsp;basic&nbsp;connection<br></span><span style="color: #0000BB">$conn_id&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">ftp_connect</span><span style="color: #007700">(</span><span style="color: #0000BB">$ftp_server</span><span style="color: #007700">);<br><br></span><span style="color: #FF8000">//&nbsp;login&nbsp;with&nbsp;username&nbsp;and&nbsp;password<br></span><span style="color: #0000BB">$login_result&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">ftp_login</span><span style="color: #007700">(</span><span style="color: #0000BB">$conn_id</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$ftp_user_name</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$ftp_user_pass</span><span style="color: #007700">);<br><br></span><span style="color: #FF8000">//&nbsp;get&nbsp;contents&nbsp;of&nbsp;the&nbsp;current&nbsp;directory<br></span><span style="color: #0000BB">$contents&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">ftp_nlist</span><span style="color: #007700">(</span><span style="color: #0000BB">$conn_id</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">"."</span><span style="color: #007700">);<br><br></span><span style="color: #FF8000">//&nbsp;output&nbsp;$contents<br></span><span style="color: #0000BB">var_dump</span><span style="color: #007700">(</span><span style="color: #0000BB">$contents</span><span style="color: #007700">);<br><br></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>  
    </div>

    <div class="example-contents"><p>The above example will output
something similar to:</p></div>
    <div class="example-contents screen">
<div class="cdata"><pre>array(3) {
  [0]=&gt;
  string(11) "public_html"
  [1]=&gt;
  string(10) "public_ftp"
  [2]=&gt;
  string(3) "www"
</pre></div>
    </div>
   </div>
  <p></p>
 </div>

 <div class="refsect1 seealso" id="refsect1-function.ftp-nlist-seealso">
  <h3 class="title">See Also</h3>
  <p class="para">
   </p><ul class="simplelist">
    <li class="member"><span class="function"><a href="function.ftp-rawlist.html" class="function" rel="rdfs-seeAlso">ftp_rawlist()</a> - Returns a detailed list of files in the given directory</span></li>
   </ul>
  <p></p>
 </div>

</div>
<section id="usernotes">
 <div class="head"><h3 class="title">User Contributed Notes</h3></div><div id="allnotes">
  <div class="note" id="95371">  
  <a class="name">
  <strong class="user"><em>Anonymous</em></strong></a><div class="date" title="2009-12-29 09:39"><strong>4 years ago</strong></div>
  <div class="text" id="Hcom95371">
<div class="phpcode"><code><span class="html">
Some complain that ftp_nlist, always return FALSE. I did experience this behavior myself, until I used ftp_pasv, which is useful if your client is behind a firewall (which most clients are now), then ftp_nlist worked just fine. I don't really know what are all the implications of using ftp_pasv, but if you read or experience that ftp_nlist, ftp_get, ftp_nb_get doesn't work, try adding the following:<br><br>ftp_pasv($conn_id,true);</span>
</code></div>
  </div>
 </div>
  <div class="note" id="101135">  
  <a class="name">
  <strong class="user"><em>zgardner at allofe dot com</em></strong></a><div class="date" title="2010-11-28 05:46"><strong>3 years ago</strong></div>
  <div class="text" id="Hcom101135">
<div class="phpcode"><code><span class="html">
While running WAMP (Vista, Apache 2.21, MySQL 5.1.36, PHP 5.3) and recursively downloading files from a LAMP FTP server (Ubuntu 8.04, Apache 2.2.8, MySQL 5.1.51a, PHP 5.2.4, VSFPTD), I would find that my script stops downloading files after a while. I traced it to the call to ftp_nlist halting the script.<br><br>To solve this, I did a ftp_pasv($ftp, true). There's nothing in the VSFTPD, Apache, or PHP error logs on either the client or the server. Very strange.</span>
</code></div>
  </div>
 </div>
  <div class="note" id="66094">  
  <a class="name">
  <strong class="user"><em>mail at martinauer dot net</em></strong></a><div class="date" title="2006-05-14 10:27"><strong>8 years ago</strong></div>
  <div class="text" id="Hcom66094">
<div class="phpcode"><code><span class="html">
Beware:<br>The array will contain complete paths, not just filenames. At least in PHP 4.3.11 when I tried <br><br>ftp_nlist("www.example.com/docs/some/thing")<br><br>it dumped something like this:<br><br>&nbsp; [0]=&gt;<br>&nbsp; string(41) "www.example.com/docs/some/thing/file1.htm"<br>&nbsp; [1]=&gt;<br>&nbsp; string(41) "www.example.com/docs/some/thing/file2.htm"<br>&nbsp; [2]=&gt;<br>&nbsp; string(41) "www.example.com/docs/some/thing/file3.htm"<br>&nbsp; [3]=&gt;<br>&nbsp; string(41) "www.example.com/docs/some/thing/file4.htm"<br>&nbsp; [4]=&gt;<br>&nbsp; string(41) "www.example.com/docs/some/thing/file5.htm"</span>
</code></div>
  </div>
 </div>
  <div class="note" id="83021">  
  <a class="name">
  <strong class="user"><em>juhakala at gmail dot com</em></strong></a><div class="date" title="2008-05-07 03:23"><strong>6 years ago</strong></div>
  <div class="text" id="Hcom83021">
<div class="phpcode"><code><span class="html">
I noticed that this function won't work if working path is different, because $dir keeps value of whole path string. That's why adding basename()-function strips the path and this function will work also sub folders, not only in root folder.<br><br>function ftp_is_dir($dir) {<br>&nbsp; global $ftp_connect;<br>&nbsp; if (ftp_chdir($ftp_connect, basename($dir))) {<br>&nbsp; &nbsp; ftp_chdir($ftp_connect, '..');<br>&nbsp; &nbsp; return true;<br>&nbsp; } else {<br>&nbsp; &nbsp; return false;<br>&nbsp; }<br>}</span>
</code></div>
  </div>
 </div>
  <div class="note" id="54307">  
  <a class="name">
  <strong class="user"><em>dreamsavior at gmail dot com</em></strong></a><div class="date" title="2005-06-29 09:19"><strong>9 years ago</strong></div>
  <div class="text" id="Hcom54307">
<div class="phpcode"><code><span class="html">
Here is the function that would checking whether the given path is directory or not, using ftp_nlist;<br><br><span class="default">&lt;?php<br></span><span class="keyword">function </span><span class="default">is_ftp_dir</span><span class="keyword">(</span><span class="default">$itempath</span><span class="keyword">, </span><span class="default">$ftp_server</span><span class="keyword">, </span><span class="default">$ftp_user_name</span><span class="keyword">=</span><span class="string">'anonymous'</span><span class="keyword">, </span><span class="default">$ftp_user_pass</span><span class="keyword">=</span><span class="string">''</span><span class="keyword">) {<br>&nbsp; &nbsp; if (empty(</span><span class="default">$ftp_user_name</span><span class="keyword">)) {<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$ftp_user_name </span><span class="keyword">= </span><span class="string">"anonymous"</span><span class="keyword">;<br>&nbsp; &nbsp; }<br>&nbsp; &nbsp; if (</span><span class="default">$itempath</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">]!==</span><span class="string">"/"</span><span class="keyword">) {<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$itempath </span><span class="keyword">= </span><span class="string">"/"</span><span class="keyword">.</span><span class="default">$itempath</span><span class="keyword">;<br>&nbsp; &nbsp; }<br><br>&nbsp; &nbsp; </span><span class="default">$conn_id </span><span class="keyword">= </span><span class="default">ftp_connect</span><span class="keyword">(</span><span class="default">$ftp_server</span><span class="keyword">);<br>&nbsp; &nbsp; </span><span class="default">$login_result </span><span class="keyword">= </span><span class="default">ftp_login</span><span class="keyword">(</span><span class="default">$conn_id</span><span class="keyword">, </span><span class="default">$ftp_user_name</span><span class="keyword">, </span><span class="default">$ftp_user_pass</span><span class="keyword">);<br><br>&nbsp; &nbsp; </span><span class="default">$contents </span><span class="keyword">= </span><span class="default">ftp_nlist</span><span class="keyword">(</span><span class="default">$conn_id</span><span class="keyword">, </span><span class="string">"</span><span class="default">$itempath</span><span class="string">"</span><span class="keyword">);<br><br>&nbsp; &nbsp; if (!empty(</span><span class="default">$contents</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">])) {<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$check </span><span class="keyword">= </span><span class="default">str_replace</span><span class="keyword">(</span><span class="default">$itempath</span><span class="keyword">, </span><span class="string">""</span><span class="keyword">, </span><span class="default">$contents</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">]);<br>&nbsp; &nbsp; &nbsp; &nbsp; if (!empty(</span><span class="default">$check</span><span class="keyword">)) {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; return </span><span class="default">true</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; }<br>&nbsp; &nbsp; }<br>&nbsp; &nbsp; </span><span class="default">ftp_close</span><span class="keyword">(</span><span class="default">$conn_id</span><span class="keyword">);<br>}<br><br></span><span class="comment">// example :<br>&nbsp; &nbsp; </span><span class="keyword">if (</span><span class="default">is_ftp_dir</span><span class="keyword">(</span><span class="string">"/pub/ftp/unknownitem"</span><span class="keyword">, </span><span class="string">"ftp.nowhere"</span><span class="keyword">, </span><span class="string">'username'</span><span class="keyword">, </span><span class="string">'verysecret'')) {<br>&nbsp; &nbsp; &nbsp; &nbsp; // do something related to directory handling action<br>&nbsp; &nbsp; } else {<br>&nbsp; &nbsp; &nbsp; &nbsp; // The target item is a file ...<br>&nbsp; &nbsp; }<br><br>?&gt;</span>
</span>
</code></div>
  </div>
 </div>
  <div class="note" id="108501">  
  <a class="name">
  <strong class="user"><em>Jacob Slomp</em></strong></a><div class="date" title="2012-05-02 03:58"><strong>2 years ago</strong></div>
  <div class="text" id="Hcom108501">
<div class="phpcode"><code><span class="html">
Hi,<br><br>I wrote this function to get the file list, I tested it only with php5 with linux ftp. And works fine for me.<br><br>it will return an array with the name, type (file/folder), owner, owner_id and rights.<br><br><span class="default">&lt;?php<br>&nbsp; &nbsp; </span><span class="keyword">function </span><span class="default">ftp_get_filelist</span><span class="keyword">(</span><span class="default">$con</span><span class="keyword">, </span><span class="default">$path</span><span class="keyword">){<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$files </span><span class="keyword">= array();<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$contents </span><span class="keyword">= </span><span class="default">ftp_rawlist </span><span class="keyword">(</span><span class="default">$con</span><span class="keyword">, </span><span class="default">$path</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$a </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">;<br><br>&nbsp; &nbsp; &nbsp; &nbsp; if(</span><span class="default">count</span><span class="keyword">(</span><span class="default">$contents</span><span class="keyword">)){<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; foreach(</span><span class="default">$contents </span><span class="keyword">as </span><span class="default">$line</span><span class="keyword">){<br><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">preg_match</span><span class="keyword">(</span><span class="string">"#([drwx\-]+)([\s]+)([0-9]+)([\s]+)([0-9]+)([\s]+)([a-zA-Z0-9\.]+)([\s]+)([0-9]+)([\s]+)([a-zA-Z]+)([\s ]+)([0-9]+)([\s]+)([0-9]+):([0-9]+)([\s]+)([a-zA-Z0-9\.\-\_ ]+)#si"</span><span class="keyword">, </span><span class="default">$line</span><span class="keyword">, </span><span class="default">$out</span><span class="keyword">);<br><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if(</span><span class="default">$out</span><span class="keyword">[</span><span class="default">3</span><span class="keyword">] != </span><span class="default">1 </span><span class="keyword">&amp;&amp; (</span><span class="default">$out</span><span class="keyword">[</span><span class="default">18</span><span class="keyword">] == </span><span class="string">"." </span><span class="keyword">|| </span><span class="default">$out</span><span class="keyword">[</span><span class="default">18</span><span class="keyword">] == </span><span class="string">".."</span><span class="keyword">)){<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="comment">// do nothing<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="keyword">} else {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$a</span><span class="keyword">++;<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$files</span><span class="keyword">[</span><span class="default">$a</span><span class="keyword">][</span><span class="string">'rights'</span><span class="keyword">] = </span><span class="default">$out</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">];<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$files</span><span class="keyword">[</span><span class="default">$a</span><span class="keyword">][</span><span class="string">'type'</span><span class="keyword">] = </span><span class="default">$out</span><span class="keyword">[</span><span class="default">3</span><span class="keyword">] == </span><span class="default">1 </span><span class="keyword">? </span><span class="string">"file"</span><span class="keyword">:</span><span class="string">"folder"</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$files</span><span class="keyword">[</span><span class="default">$a</span><span class="keyword">][</span><span class="string">'owner_id'</span><span class="keyword">] = </span><span class="default">$out</span><span class="keyword">[</span><span class="default">5</span><span class="keyword">];<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$files</span><span class="keyword">[</span><span class="default">$a</span><span class="keyword">][</span><span class="string">'owner'</span><span class="keyword">] = </span><span class="default">$out</span><span class="keyword">[</span><span class="default">7</span><span class="keyword">];<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$files</span><span class="keyword">[</span><span class="default">$a</span><span class="keyword">][</span><span class="string">'date_modified'</span><span class="keyword">] = </span><span class="default">$out</span><span class="keyword">[</span><span class="default">11</span><span class="keyword">].</span><span class="string">" "</span><span class="keyword">.</span><span class="default">$out</span><span class="keyword">[</span><span class="default">13</span><span class="keyword">] . </span><span class="string">" "</span><span class="keyword">.</span><span class="default">$out</span><span class="keyword">[</span><span class="default">13</span><span class="keyword">].</span><span class="string">":"</span><span class="keyword">.</span><span class="default">$out</span><span class="keyword">[</span><span class="default">16</span><span class="keyword">].</span><span class="string">""</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$files</span><span class="keyword">[</span><span class="default">$a</span><span class="keyword">][</span><span class="string">'name'</span><span class="keyword">] = </span><span class="default">$out</span><span class="keyword">[</span><span class="default">18</span><span class="keyword">];<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br>&nbsp; &nbsp; &nbsp; &nbsp; }<br>&nbsp; &nbsp; &nbsp; &nbsp; return </span><span class="default">$files</span><span class="keyword">;<br>&nbsp; &nbsp; }<br></span><span class="default">?&gt;<br></span><br>Greets,<br><br>Jacob</span>
</code></div>
  </div>
 </div>
  <div class="note" id="102969">  
  <a class="name">
  <strong class="user"><em>vijay dot mahrra at fronter dot com</em></strong></a><div class="date" title="2011-03-17 02:35"><strong>3 years ago</strong></div>
  <div class="text" id="Hcom102969">
<div class="phpcode"><code><span class="html">
We needed to get a list of all files in all subdirectories and couldn't see a method to do this so we wrote our own:
<br>
<br><span class="default">&lt;?php
<br></span><span class="comment">/**
<br> * ftpRecursiveFileListing
<br> *
<br> * Get a recursive listing of all files in all subfolders given an ftp handle and path
<br> *
<br> * @param resource $ftpConnection&nbsp; the ftp connection handle
<br> * @param string $path&nbsp; the folder/directory path
<br> * @return array $allFiles the list of files in the format: directory =&gt; $filename
<br> * @author Niklas Berglund
<br> * @author Vijay Mahrra
<br> */
<br></span><span class="keyword">function </span><span class="default">ftpRecursiveFileListing</span><span class="keyword">(</span><span class="default">$ftpConnection</span><span class="keyword">, </span><span class="default">$path</span><span class="keyword">) {
<br>&nbsp; &nbsp; static </span><span class="default">$allFiles </span><span class="keyword">= array();
<br>&nbsp; &nbsp; </span><span class="default">$contents </span><span class="keyword">= </span><span class="default">ftp_nlist</span><span class="keyword">(</span><span class="default">$ftpConnection</span><span class="keyword">, </span><span class="default">$path</span><span class="keyword">);
<br>
<br>&nbsp; &nbsp; foreach(</span><span class="default">$contents </span><span class="keyword">as </span><span class="default">$currentFile</span><span class="keyword">) {
<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="comment">// assuming its a folder if there's no dot in the name
<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="keyword">if (</span><span class="default">strpos</span><span class="keyword">(</span><span class="default">$currentFile</span><span class="keyword">, </span><span class="string">'.'</span><span class="keyword">) === </span><span class="default">false</span><span class="keyword">) {
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">ftpRecursiveFileListing</span><span class="keyword">(</span><span class="default">$ftpConnection</span><span class="keyword">, </span><span class="default">$currentFile</span><span class="keyword">);
<br>&nbsp; &nbsp; &nbsp; &nbsp; }
<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$allFiles</span><span class="keyword">[</span><span class="default">$path</span><span class="keyword">][] = </span><span class="default">substr</span><span class="keyword">(</span><span class="default">$currentFile</span><span class="keyword">, </span><span class="default">strlen</span><span class="keyword">(</span><span class="default">$path</span><span class="keyword">) + </span><span class="default">1</span><span class="keyword">);
<br>&nbsp; &nbsp; }
<br>&nbsp; &nbsp; return </span><span class="default">$allFiles</span><span class="keyword">;
<br>}
<br></span><span class="default">?&gt;</span>
</span>
</code></div>
  </div>
 </div>
  <div class="note" id="40332">  
  <a class="name">
  <strong class="user"><em>micksam7 at neodecoder dot com</em></strong></a><div class="date" title="2004-02-29 02:40"><strong>10 years ago</strong></div>
  <div class="text" id="Hcom40332">
<div class="phpcode"><code><span class="html">
A little correction to king_killa at juggalos4life dot com's note, it isn't ftp_res, it's ftp_size.<br><br>By the way, here is a complete function that will get all the files on a server, then write them to a array.<br><br><span class="default">&lt;?php<br>$ftp1 </span><span class="keyword">= </span><span class="default">ftp_connect</span><span class="keyword">(</span><span class="string">'ftp.nowhere1230404.foo'</span><span class="keyword">) or die(</span><span class="string">"Couldn't connect to server"</span><span class="keyword">);<br></span><span class="default">ftp_login</span><span class="keyword">(</span><span class="default">$ftp1</span><span class="keyword">,</span><span class="string">'foo'</span><span class="keyword">,</span><span class="string">'bar'</span><span class="keyword">);<br></span><span class="default">ftp_pasv</span><span class="keyword">(</span><span class="default">$ftp1</span><span class="keyword">, </span><span class="default">TRUE</span><span class="keyword">); </span><span class="comment">//Passive Mode is better for this<br><br>//Get them file!<br></span><span class="keyword">echo </span><span class="string">"Collecting Files on Neodecoder&lt;br&gt;"</span><span class="keyword">;<br></span><span class="comment">//Set defaults just in case. PHP complains anyway if we don't.<br></span><span class="default">$dir </span><span class="keyword">= </span><span class="string">""</span><span class="keyword">;<br><br>function </span><span class="default">filecollect</span><span class="keyword">(</span><span class="default">$dir</span><span class="keyword">,</span><span class="default">$filelist</span><span class="keyword">) {<br>global </span><span class="default">$ftp1</span><span class="keyword">; </span><span class="comment">//Get our ftp<br></span><span class="default">$files </span><span class="keyword">= </span><span class="default">ftp_nlist</span><span class="keyword">(</span><span class="default">$ftp1</span><span class="keyword">,</span><span class="default">$dir</span><span class="keyword">); </span><span class="comment">//get files in directory<br></span><span class="keyword">foreach (</span><span class="default">$files </span><span class="keyword">as </span><span class="default">$file</span><span class="keyword">) {<br> </span><span class="default">$isfile </span><span class="keyword">= </span><span class="default">ftp_size</span><span class="keyword">(</span><span class="default">$ftp1</span><span class="keyword">, </span><span class="default">$file</span><span class="keyword">); <br> if(</span><span class="default">$isfile </span><span class="keyword">== </span><span class="string">"-1"</span><span class="keyword">) { </span><span class="comment">//Is a file or directory?<br>&nbsp; </span><span class="default">$filelist </span><span class="keyword">= </span><span class="default">filecollect</span><span class="keyword">(</span><span class="default">$dir</span><span class="keyword">.</span><span class="string">'/'</span><span class="keyword">.</span><span class="default">$file</span><span class="keyword">,</span><span class="default">$filelist</span><span class="keyword">,</span><span class="default">$num</span><span class="keyword">); </span><span class="comment">//If a folder, do a filecollect on it<br> </span><span class="keyword">}<br> else {<br>&nbsp; </span><span class="default">$filelist</span><span class="keyword">[(</span><span class="default">count</span><span class="keyword">(</span><span class="default">$filelist</span><span class="keyword">)+</span><span class="default">1</span><span class="keyword">)] = </span><span class="default">$file</span><span class="keyword">; </span><span class="comment">//If not, add it as a file to the file list<br> </span><span class="keyword">}<br>}<br>return </span><span class="default">$filelist</span><span class="keyword">;<br>}<br><br></span><span class="default">$filelist </span><span class="keyword">= </span><span class="default">filecollect</span><span class="keyword">(</span><span class="default">$dir</span><span class="keyword">,</span><span class="default">$filelist</span><span class="keyword">);<br><br>echo </span><span class="string">"&lt;pre&gt;"</span><span class="keyword">;<br></span><span class="default">print_r</span><span class="keyword">(</span><span class="default">$filelist</span><span class="keyword">);<br>echo </span><span class="string">"&lt;/pre&gt;"</span><span class="keyword">;<br></span><span class="default">?&gt;<br></span><br>This is really handy if your trying to transfer all the files from a ftp server to another server. Which, is why I made the script in the first place. heh..</span>
</code></div>
  </div>
 </div>
  <div class="note" id="78447">  
  <a class="name">
  <strong class="user"><em>webmaster at weltvolk dot de</em></strong></a><div class="date" title="2007-10-12 06:28"><strong>6 years ago</strong></div>
  <div class="text" id="Hcom78447">
<div class="phpcode"><code><span class="html">
In order to make file/folder separation work on remote servers that do not support ftp_size() it's better to use the function ftp_is_dir() mentioned below:<br><br><span class="default">&lt;?php<br><br></span><span class="comment">//identify directories<br><br></span><span class="keyword">function </span><span class="default">ftp_is_dir</span><span class="keyword">(</span><span class="default">$dir</span><span class="keyword">) {<br>&nbsp; global </span><span class="default">$ftp_connect</span><span class="keyword">;<br>&nbsp; if (</span><span class="default">ftp_chdir</span><span class="keyword">(</span><span class="default">$ftp_connect</span><span class="keyword">, </span><span class="default">$dir</span><span class="keyword">)) {<br>&nbsp; &nbsp; </span><span class="default">ftp_chdir</span><span class="keyword">(</span><span class="default">$ftp_connect</span><span class="keyword">, </span><span class="string">'..'</span><span class="keyword">);<br>&nbsp; &nbsp; return </span><span class="default">true</span><span class="keyword">;<br>&nbsp; } else {<br>&nbsp; &nbsp; return </span><span class="default">false</span><span class="keyword">;<br>&nbsp; }<br>}<br></span><span class="default">$ftp_nlist </span><span class="keyword">= </span><span class="default">ftp_nlist</span><span class="keyword">(</span><span class="default">$ftp_connect</span><span class="keyword">, </span><span class="string">"."</span><span class="keyword">);<br><br></span><span class="comment">//alphabetical sorting<br><br></span><span class="default">sort</span><span class="keyword">(</span><span class="default">$ftp_nlist</span><span class="keyword">);<br>foreach (</span><span class="default">$ftp_nlist </span><span class="keyword">as </span><span class="default">$v</span><span class="keyword">) {<br><br></span><span class="comment">//1. ftp_is_dir() is true =&gt; directory<br>&nbsp; </span><span class="keyword">if (</span><span class="default">ftp_is_dir</span><span class="keyword">(</span><span class="default">$v</span><span class="keyword">)) {<br><br></span><span class="comment">//output as [ directory ]<br>&nbsp; &nbsp; &nbsp; </span><span class="keyword">echo </span><span class="string">"[ " </span><span class="keyword">. </span><span class="default">$v </span><span class="keyword">. </span><span class="string">" ]&lt;br /&gt;\n"</span><span class="keyword">;<br>&nbsp; }<br>}<br>foreach (</span><span class="default">$ftp_nlist </span><span class="keyword">as </span><span class="default">$v</span><span class="keyword">) {<br><br></span><span class="comment">//2. ftp_is_dir() is false =&gt; file<br>&nbsp; </span><span class="keyword">if (!</span><span class="default">ftp_is_dir</span><span class="keyword">(</span><span class="default">$v</span><span class="keyword">)) {<br><br></span><span class="comment">//output as file<br>&nbsp; &nbsp; &nbsp; </span><span class="keyword">echo </span><span class="string">"" </span><span class="keyword">. </span><span class="default">$v </span><span class="keyword">. </span><span class="string">"&lt;br /&gt;\n"</span><span class="keyword">;<br>&nbsp; }<br>}<br></span><span class="default">?&gt;</span>
</span>
</code></div>
  </div>
 </div>
  <div class="note" id="77228">  
  <a class="name">
  <strong class="user"><em>wim dot dupre at skynet dot be</em></strong></a><div class="date" title="2007-08-20 05:59"><strong>7 years ago</strong></div>
  <div class="text" id="Hcom77228">
<div class="phpcode"><code><span class="html">
php 5.2.2 on MAC OS 1.4 (Tiger) seems to defaut to active ftp. to get ftp_nlist functioning, i needed to force ftp to passive.<br>the default behaviour with PHP 5.2.3 on windows XP seems to be passive ftp.<br><br>greetz,<br><br>wim</span>
</code></div>
  </div>
 </div>
  <div class="note" id="77128">  
  <a class="name">
  <strong class="user"><em>ralph at ralphje dot nl</em></strong></a><div class="date" title="2007-08-16 03:13"><strong>7 years ago</strong></div>
  <div class="text" id="Hcom77128">
<div class="phpcode"><code><span class="html">
If you receive an error due some open_basedir restrictions, use the following:<br><br><span class="default">&lt;?php<br>putenv</span><span class="keyword">(</span><span class="string">'TMPDIR=/tmp/'</span><span class="keyword">);<br></span><span class="default">$filelist </span><span class="keyword">= </span><span class="default">ftp_nlist</span><span class="keyword">(</span><span class="default">$ftp</span><span class="keyword">, </span><span class="string">"./accounts"</span><span class="keyword">);<br></span><span class="default">?&gt;<br></span><br>(if /tmp/ is an allowed directory within open_basedir)<br><br>It took me a while to find this out.</span>
</code></div>
  </div>
 </div>
  <div class="note" id="77078">  
  <a class="name">
  <strong class="user"><em>AndyM</em></strong></a><div class="date" title="2007-08-13 09:13"><strong>7 years ago</strong></div>
  <div class="text" id="Hcom77078">
<div class="phpcode"><code><span class="html">
Be careful tom at crysis-online dot com - your suggested method seems to be server dependent. I'm currently trying to talk to a proftpd server and the size returned is -1 for all files it seems.</span>
</code></div>
  </div>
 </div>
  <div class="note" id="77007">  
  <a class="name">
  <strong class="user"><em>tom at crysis-online dot com</em></strong></a><div class="date" title="2007-08-09 04:12"><strong>7 years ago</strong></div>
  <div class="text" id="Hcom77007">
<div class="phpcode"><code><span class="html">
This function is way faster than those below for checking if an object is a file or folder.<br><br><span class="default">&lt;?php<br></span><span class="keyword">function </span><span class="default">is_ftp_dir</span><span class="keyword">(</span><span class="default">$file</span><span class="keyword">, </span><span class="default">$ftp_connection</span><span class="keyword">){<br>&nbsp; &nbsp; if(</span><span class="default">ftp_size</span><span class="keyword">(</span><span class="default">$ftp_connection</span><span class="keyword">, </span><span class="default">$file</span><span class="keyword">) == </span><span class="string">'-1'</span><span class="keyword">){<br>&nbsp; &nbsp; &nbsp; &nbsp; return </span><span class="default">true</span><span class="keyword">; </span><span class="comment">// Is directory<br>&nbsp; &nbsp; </span><span class="keyword">}else{<br>&nbsp; &nbsp; &nbsp; &nbsp; return </span><span class="default">false</span><span class="keyword">; </span><span class="comment">// Is file<br>&nbsp; &nbsp; </span><span class="keyword">}<br>}<br></span><span class="default">?&gt;</span>
</span>
</code></div>
  </div>
 </div>
  <div class="note" id="76641">  
  <a class="name">
  <strong class="user"><em>bintjes at gmail dot com</em></strong></a><div class="date" title="2007-07-24 02:51"><strong>7 years ago</strong></div>
  <div class="text" id="Hcom76641">
<div class="phpcode"><code><span class="html">
I've made a recursive function to list all files from folders and subfolders using ftp_rawlist() . I used the function below from ari,&nbsp; parse_rawlist() <br><br>function list_all_files($conn_id, $path){<br>&nbsp; &nbsp; $buff = ftp_rawlist($conn_id, $path);<br>&nbsp; &nbsp; $res = parse_rawlist( $buff) ;<br>&nbsp; &nbsp; static $flist = array();<br>&nbsp; &nbsp; if(count($res)&gt;0){<br>&nbsp; &nbsp; &nbsp; &nbsp; foreach($res as $result){<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; // verify if is dir , if not add to the&nbsp; list of files<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if($result['size']== 0){<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; // recursively call the function if this file is a folder<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; list_all_files($conn_id, $path.'/'.$result['name']);<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; else{<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; // this is a file, add to final list<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $flist[] = $result;<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }&nbsp; &nbsp;&nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; }<br>&nbsp; &nbsp; }<br>&nbsp; &nbsp; return $flist;<br>}</span>
</code></div>
  </div>
 </div>
  <div class="note" id="72875">  
  <a class="name">
  <strong class="user"><em>nigel (at) amanwithapencil (dot) com</em></strong></a><div class="date" title="2007-02-03 08:26"><strong>7 years ago</strong></div>
  <div class="text" id="Hcom72875">
<div class="phpcode"><code><span class="html">
Further to kip's post, this works:<br><br>if (!ftp_chdir($conn, $folder))<br>{<br>&nbsp; &nbsp; ftp_mkdir($conn, $folder);<br>&nbsp; &nbsp; ftp_chdir($conn, $folder);<br>}</span>
</code></div>
  </div>
 </div>
  <div class="note" id="71696">  
  <a class="name">
  <strong class="user"><em>kip at friendchip dot com</em></strong></a><div class="date" title="2006-12-12 04:48"><strong>7 years ago</strong></div>
  <div class="text" id="Hcom71696">
<div class="phpcode"><code><span class="html">
If you're just after an ftp version of is_dir you can see if ftp_chdir returns true or false.</span>
</code></div>
  </div>
 </div>
  <div class="note" id="70166">  
  <a class="name">
  <strong class="user"><em>fx dot menard at pleasenospam dot free dot fr</em></strong></a><div class="date" title="2006-10-05 02:35"><strong>7 years ago</strong></div>
  <div class="text" id="Hcom70166">
<div class="phpcode"><code><span class="html">
A derived use of ftp_nlist function: determine if a given path exists and is a directory or a plain file (this is not easy with basic ftp functions). This code doesn't issue any warning or error. It makes use of ls option -d for efficiency, and -F to append a slash if the retrieved path is a directory.<br><br><span class="default">&lt;?php<br></span><span class="comment">// returns information on a given ftp path<br>// 0 if path does not exist<br>// 1 if path is a file<br>// 2 if path is a directory<br></span><span class="keyword">function </span><span class="default">ftp_pathtype</span><span class="keyword">( </span><span class="default">$conn</span><span class="keyword">, </span><span class="default">$path </span><span class="keyword">)<br>{<br>&nbsp; &nbsp; </span><span class="default">$res </span><span class="keyword">= </span><span class="default">ftp_nlist</span><span class="keyword">( </span><span class="default">$conn</span><span class="keyword">, </span><span class="string">"-dF " </span><span class="keyword">. </span><span class="default">$path </span><span class="keyword">);<br>&nbsp; &nbsp; if ( isset( </span><span class="default">$res</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">] ) and<br>&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">strlen</span><span class="keyword">( </span><span class="default">$res</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">] ) )<br>&nbsp; &nbsp; {<br>&nbsp; &nbsp; &nbsp; &nbsp; if ( </span><span class="default">$res</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">][ </span><span class="default">strlen</span><span class="keyword">( </span><span class="default">$res</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">] )-</span><span class="default">1 </span><span class="keyword">] === </span><span class="string">"/" </span><span class="keyword">)<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="comment">// a directory<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="keyword">return </span><span class="default">2</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; else<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; return </span><span class="default">1</span><span class="keyword">;<br>&nbsp; &nbsp; } else<br>&nbsp; &nbsp; &nbsp; &nbsp; return </span><span class="default">0</span><span class="keyword">;<br>}<br></span><span class="default">?&gt;</span>
</span>
</code></div>
  </div>
 </div>
  <div class="note" id="69140">  
  <a class="name">
  <strong class="user"><em>artiom1st at yahoo dot com</em></strong></a><div class="date" title="2006-08-24 07:26"><strong>8 years ago</strong></div>
  <div class="text" id="Hcom69140">
<div class="phpcode"><code><span class="html">
Sometimes, you won't be able to get folder content because of NAT or Firewall issues on your server. As a result you need to put ftp connection into a passive mode:<br><br><span class="default">&lt;?php<br><br></span><span class="comment">// set up basic connection<br></span><span class="default">$conn_id </span><span class="keyword">= </span><span class="default">ftp_connect</span><span class="keyword">(</span><span class="default">$ftp_server</span><span class="keyword">);<br><br></span><span class="comment">// login with username and password<br></span><span class="default">$login_result </span><span class="keyword">= </span><span class="default">ftp_login</span><span class="keyword">(</span><span class="default">$conn_id</span><span class="keyword">, </span><span class="default">$ftp_user_name</span><span class="keyword">, </span><span class="default">$ftp_user_pass</span><span class="keyword">);<br><br></span><span class="comment">// enabling passive mode<br></span><span class="default">ftp_pasv</span><span class="keyword">( </span><span class="default">$conn_id</span><span class="keyword">, </span><span class="default">true </span><span class="keyword">);<br><br></span><span class="comment">// get contents of the current directory<br></span><span class="default">$contents </span><span class="keyword">= </span><span class="default">ftp_nlist</span><span class="keyword">(</span><span class="default">$conn_id</span><span class="keyword">, </span><span class="string">"."</span><span class="keyword">);<br><br></span><span class="comment">// output $contents<br></span><span class="default">var_dump</span><span class="keyword">(</span><span class="default">$contents</span><span class="keyword">);<br><br></span><span class="default">?&gt;</span>
</span>
</code></div>
  </div>
 </div>
  <div class="note" id="69107">  
  <a class="name">
  <strong class="user"><em>sksafarath at impelsys dot com</em></strong></a><div class="date" title="2006-08-23 04:17"><strong>8 years ago</strong></div>
  <div class="text" id="Hcom69107">
<div class="phpcode"><code><span class="html">
If we are giving second parameter as full directory&nbsp; path then it wil return the list of files with full path, If we want to list only files you can do as following code<br>// set up basic connection<br>$conn_id = ftp_connect($ftp_server);<br><br>// login with username and password<br>$login_result = ftp_login($conn_id, $ftp_user_name, $ftp_user_pass);<br>//if u want to display the files from /home/test/<br>//change directory point to /home/test using<br>ftp_chdir($conn_id, "test");<br>//then pass second parameter as null which will give the list of files.<br>// get contents of the current directory<br>$contents = ftp_nlist($conn_id, "");<br><br>Note: This is working for me in PHP5</span>
</code></div>
  </div>
 </div>
  <div class="note" id="68751">  
  <a class="name">
  <strong class="user"><em>robtherat at gmx dot de</em></strong></a><div class="date" title="2006-08-09 06:00"><strong>8 years ago</strong></div>
  <div class="text" id="Hcom68751">
<div class="phpcode"><code><span class="html">
The function from nekrostar at gmx dot net does not work for me, so I've tryed to do it my way. For checking if a found file is a directory or not I use the ftp_size function.<br><br><span class="default">&lt;?php<br></span><span class="keyword">function </span><span class="default">ftplistdir</span><span class="keyword">(</span><span class="default">$conn_id</span><span class="keyword">, </span><span class="default">$dir</span><span class="keyword">){<br>&nbsp; &nbsp; </span><span class="default">$fold_no </span><span class="keyword">= array(</span><span class="string">"."</span><span class="keyword">, </span><span class="string">".."</span><span class="keyword">, </span><span class="string">"cgi-data"</span><span class="keyword">, </span><span class="string">"comp"</span><span class="keyword">, </span><span class="string">"zuern"</span><span class="keyword">, </span><span class="string">"counter"</span><span class="keyword">); <br>&nbsp; &nbsp; </span><span class="default">$list </span><span class="keyword">= </span><span class="default">ftp_nlist</span><span class="keyword">( </span><span class="default">$conn_id</span><span class="keyword">, </span><span class="default">$dir </span><span class="keyword">);<br>&nbsp; &nbsp; foreach(</span><span class="default">$list </span><span class="keyword">as </span><span class="default">$file</span><span class="keyword">){<br>&nbsp; &nbsp; &nbsp; &nbsp; if (</span><span class="default">ftp_size</span><span class="keyword">(</span><span class="default">$conn_id</span><span class="keyword">, </span><span class="default">$dir </span><span class="keyword">.</span><span class="string">"/"</span><span class="keyword">.</span><span class="default">$file</span><span class="keyword">)== -</span><span class="default">1</span><span class="keyword">){<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if (</span><span class="default">in_array</span><span class="keyword">(</span><span class="default">$file</span><span class="keyword">, </span><span class="default">$fold_no</span><span class="keyword">)) { <br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; print </span><span class="default">$file </span><span class="keyword">.</span><span class="string">" Ueberspringe ausgeschlossenes Verzeichnis.&lt;br&gt;"</span><span class="keyword">; <br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; } else { <br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$geslist</span><span class="keyword">[]= </span><span class="default">$dir </span><span class="keyword">.</span><span class="string">"/"</span><span class="keyword">. </span><span class="default">$file</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$temp</span><span class="keyword">=</span><span class="default">ftplistdir</span><span class="keyword">(</span><span class="default">$conn_id</span><span class="keyword">, </span><span class="default">$dir </span><span class="keyword">.</span><span class="string">"/"</span><span class="keyword">. </span><span class="default">$file</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$geslist</span><span class="keyword">=</span><span class="default">array_merge</span><span class="keyword">(</span><span class="default">$geslist</span><span class="keyword">, </span><span class="default">$temp</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br>&nbsp; &nbsp; &nbsp; &nbsp; }else{<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$geslist</span><span class="keyword">[]= </span><span class="default">$dir </span><span class="keyword">.</span><span class="string">"/"</span><span class="keyword">. </span><span class="default">$file</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; }<br>&nbsp; &nbsp; }<br>&nbsp; &nbsp; return </span><span class="default">$geslist</span><span class="keyword">;<br>}<br></span><span class="default">?&gt;<br></span>I hope it's usefull for anyone<br>Robert</span>
</code></div>
  </div>
 </div>
  <div class="note" id="68574">  
  <a class="name">
  <strong class="user"><em>nekrostar at gmx dot net</em></strong></a><div class="date" title="2006-08-02 04:08"><strong>8 years ago</strong></div>
  <div class="text" id="Hcom68574">
<div class="phpcode"><code><span class="html">
This function returns an array with the directory path and all files and subdirs which are in this<br><br>&nbsp; &nbsp; function ftp_searchdir($conn_id, $dir)<br>&nbsp; &nbsp; {<br>&nbsp; &nbsp; &nbsp; &nbsp; if( !@ftp_is_dir( $conn_id, $dir ) ) {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; die( 'No such directory on the ftp-server' );<br>&nbsp; &nbsp; &nbsp; &nbsp; }<br>&nbsp; &nbsp; &nbsp; &nbsp; if( strrchr( $dir, '/' ) != '/' ) {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $dir = $dir.'/';<br>&nbsp; &nbsp; &nbsp; &nbsp; }<br>&nbsp; &nbsp; &nbsp; &nbsp; $dirlist[0] = $dir;<br>&nbsp; &nbsp; &nbsp; &nbsp; $list = ftp_nlist( $conn_id, $dir );<br>&nbsp; &nbsp; &nbsp; &nbsp; foreach( $list as $path ) {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $path = './'.$path;<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if( $path != $dir.'.' &amp;&amp; $path != $dir.'..') {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if( ftp_is_dir( $conn_id, $path ) ) {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $temp = ftp_searchdir( $conn_id, ($path), 1 );<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $dirlist = array_merge( $dirlist, $temp );<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; } else {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $dirlist[] = $path;<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br><br>&nbsp; &nbsp; &nbsp; &nbsp; }<br>&nbsp; &nbsp; &nbsp; &nbsp; ftp_chdir( $conn_id, '/../' );<br>&nbsp; &nbsp; &nbsp; &nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; return $dirlist;<br><br>&nbsp; &nbsp; }<br>----------------------------------------------------------------------<br>&nbsp; &nbsp; //Looks if a directory ($dir) is isset<br>&nbsp; &nbsp; //returns true or false<br><br>&nbsp; &nbsp; function ftp_is_dir( $conn_id,&nbsp; $dir )<br>&nbsp; &nbsp; {<br>&nbsp; &nbsp; &nbsp; &nbsp; if( @ftp_chdir( $conn_id, $dir ) ) {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ftp_chdir( $conn_id, '/../' );<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; return true;<br>&nbsp; &nbsp; &nbsp; &nbsp; } else {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; return false;<br>&nbsp; &nbsp; &nbsp; &nbsp; }<br>&nbsp; &nbsp; }</span>
</code></div>
  </div>
 </div>
  <div class="note" id="62306">  
  <a class="name">
  <strong class="user"><em>franck569 at free dot fr</em></strong></a><div class="date" title="2006-02-24 10:32"><strong>8 years ago</strong></div>
  <div class="text" id="Hcom62306">
<div class="phpcode"><code><span class="html">
better version of turigeza on yahoo com ftp_rmdirr() function.<br><br>This return true or false if the path will be removed :<br><br>function ftp_rmdirr($handle, $path)<br>{<br>&nbsp; &nbsp; if(!@ftp_delete($handle, $path))<br>&nbsp; &nbsp; {<br>&nbsp; &nbsp; &nbsp; &nbsp; $list = @ftp_nlist($handle, $path);<br>&nbsp; &nbsp; &nbsp; &nbsp; if(!empty($list))<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; foreach($list as $value)<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ftp_rmdirr($handle, $value);<br>&nbsp; &nbsp; }<br>&nbsp; &nbsp; <br>&nbsp; &nbsp; if(@ftp_rmdir($handle, $path))<br>&nbsp; &nbsp; &nbsp; &nbsp; return true;<br>&nbsp; &nbsp; else<br>&nbsp; &nbsp; &nbsp; &nbsp; return false;<br>}</span>
</code></div>
  </div>
 </div>
  <div class="note" id="58528">  
  <a class="name">
  <strong class="user"><em>turigeza on yahoo com</em></strong></a><div class="date" title="2005-11-07 07:10"><strong>8 years ago</strong></div>
  <div class="text" id="Hcom58528">
<div class="phpcode"><code><span class="html">
Recursive directory delete using ftp_nlist() ...<br><span class="default">&lt;?php <br></span><span class="keyword">function </span><span class="default">ftp_rmdirr</span><span class="keyword">(</span><span class="default">$path</span><span class="keyword">, </span><span class="default">$handle</span><span class="keyword">)<br>&nbsp; &nbsp; {<br>&nbsp; &nbsp; if (!(@</span><span class="default">ftp_rmdir</span><span class="keyword">(</span><span class="default">$handle</span><span class="keyword">, </span><span class="default">$path</span><span class="keyword">) || @</span><span class="default">ftp_delete</span><span class="keyword">(</span><span class="default">$handle</span><span class="keyword">, </span><span class="default">$path</span><span class="keyword">)))<br>&nbsp; &nbsp; &nbsp; &nbsp; {<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$list </span><span class="keyword">= </span><span class="default">ftp_nlist</span><span class="keyword">(</span><span class="default">$handle</span><span class="keyword">, </span><span class="default">$path</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; if (!empty(</span><span class="default">$list</span><span class="keyword">))<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; foreach(</span><span class="default">$list </span><span class="keyword">as </span><span class="default">$value</span><span class="keyword">)<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">ftp_rmdirr</span><span class="keyword">(</span><span class="default">$value</span><span class="keyword">, </span><span class="default">$handle</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; }<br>&nbsp; &nbsp; @</span><span class="default">ftp_rmdir</span><span class="keyword">(</span><span class="default">$handle</span><span class="keyword">, </span><span class="default">$path</span><span class="keyword">);<br>&nbsp; &nbsp; }<br></span><span class="default">?&gt;<br></span>It would be very useful if it was built into php. After all most of the time we want to remove non empty directories too. I bet everyone out there dealing with the file system had faced this problem.</span>
</code></div>
  </div>
 </div>
  <div class="note" id="48303">  
  <a class="name">
  <strong class="user"><em>ds at over dot hu</em></strong></a><div class="date" title="2004-12-18 08:43"><strong>9 years ago</strong></div>
  <div class="text" id="Hcom48303">
<div class="phpcode"><code><span class="html">
Another file filecollect script, with static.<br><br><span class="default">&lt;?php<br><br></span><span class="keyword">function </span><span class="default">filecollect</span><span class="keyword">(</span><span class="default">$conn_id</span><span class="keyword">,</span><span class="default">$dir</span><span class="keyword">=</span><span class="string">'.'</span><span class="keyword">) {<br>&nbsp; static </span><span class="default">$flist</span><span class="keyword">=array();<br>&nbsp; if (</span><span class="default">$files </span><span class="keyword">= </span><span class="default">ftp_nlist</span><span class="keyword">(</span><span class="default">$cid</span><span class="keyword">,</span><span class="default">$dir</span><span class="keyword">)){<br>&nbsp; &nbsp; foreach (</span><span class="default">$files </span><span class="keyword">as </span><span class="default">$file</span><span class="keyword">) {<br>&nbsp; &nbsp; &nbsp; if (</span><span class="default">ftp_size</span><span class="keyword">(</span><span class="default">$cid</span><span class="keyword">, </span><span class="default">$file</span><span class="keyword">) == </span><span class="string">"-1"</span><span class="keyword">){<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">filecollect</span><span class="keyword">(</span><span class="default">$cid</span><span class="keyword">,</span><span class="default">$file</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; } else </span><span class="default">$flist</span><span class="keyword">[] = </span><span class="default">$file</span><span class="keyword">;<br>&nbsp; &nbsp; }<br>&nbsp; }<br>&nbsp; return </span><span class="default">$flist</span><span class="keyword">;<br>}<br><br></span><span class="default">$conn_id </span><span class="keyword">= </span><span class="default">ftp_connect</span><span class="keyword">(</span><span class="string">'ftp.nowhere.com'</span><span class="keyword">) or die(</span><span class="string">"Couldn't connect to server"</span><span class="keyword">);<br>&nbsp; if (@</span><span class="default">ftp_login</span><span class="keyword">(</span><span class="default">$conn_id</span><span class="keyword">, </span><span class="string">'anonymous'</span><span class="keyword">, </span><span class="string">'pass@nowhere.com'</span><span class="keyword">)){<br>&nbsp; &nbsp; </span><span class="default">$filelist </span><span class="keyword">= </span><span class="default">filecollect</span><span class="keyword">(</span><span class="default">$conn_id</span><span class="keyword">);<br>&nbsp; &nbsp; echo </span><span class="string">"&lt;pre&gt;"</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; </span><span class="default">print_r</span><span class="keyword">(</span><span class="default">$filelist</span><span class="keyword">);<br>&nbsp; &nbsp; echo </span><span class="string">"&lt;/pre&gt;"</span><span class="keyword">;<br>&nbsp; }<br><br></span><span class="default">?&gt;</span>
</span>
</code></div>
  </div>
 </div>
  <div class="note" id="46011">  
  <a class="name">
  <strong class="user"><em>webmaster at torbox dot info</em></strong></a><div class="date" title="2004-09-26 09:16"><strong>9 years ago</strong></div>
  <div class="text" id="Hcom46011">
<div class="phpcode"><code><span class="html">
To use custom LIST - flags, for example<br>LIST -aF ../*/<br>(listing protected pub dirs)<br>You can use<br><span class="default">&lt;?php<br>$list </span><span class="keyword">= </span><span class="default">ftp_nlist</span><span class="keyword">(</span><span class="default">$ftp</span><span class="keyword">, </span><span class="string">"-aF ../*/"</span><span class="keyword">);<br></span><span class="default">?&gt;<br></span>Took me a while to clever that one out :-)</span>
</code></div>
  </div>
 </div>
  <div class="note" id="36515">  
  <a class="name">
  <strong class="user"><em>tobrien at florahill dot vic dot edu dot au</em></strong></a><div class="date" title="2003-10-13 08:27"><strong>10 years ago</strong></div>
  <div class="text" id="Hcom36515">
<div class="phpcode"><code><span class="html">
ftp_nlist() or ftp_rawlist() takes ages then returns nothing...<br><br>If you are having this issue, you may need to enable PASV mode FTP transfers using the ftp_pasv() function.<br><br>Example...<br><br><span class="default">&lt;?php<br>$ftp_host </span><span class="keyword">= </span><span class="string">"yourFTPHost"</span><span class="keyword">;<br></span><span class="default">$ftp_user </span><span class="keyword">= </span><span class="string">"yourUsername"</span><span class="keyword">;<br></span><span class="default">$ftp_password </span><span class="keyword">= </span><span class="string">"yourPassword"</span><span class="keyword">;<br><br></span><span class="comment">//Connect<br></span><span class="keyword">echo </span><span class="string">"&lt;br /&gt;Connecting to </span><span class="default">$ftp_host</span><span class="string"> via FTP..."</span><span class="keyword">;<br></span><span class="default">$conn </span><span class="keyword">= </span><span class="default">ftp_connect</span><span class="keyword">(</span><span class="default">$ftp_host</span><span class="keyword">);<br></span><span class="default">$login </span><span class="keyword">= </span><span class="default">ftp_login</span><span class="keyword">(</span><span class="default">$conn</span><span class="keyword">, </span><span class="default">$ftp_user</span><span class="keyword">, </span><span class="default">$ftp_password</span><span class="keyword">);<br><br></span><span class="comment">//<br>//Enable PASV ( Note: must be done after ftp_login() )<br>//<br></span><span class="default">$mode </span><span class="keyword">= </span><span class="default">ftp_pasv</span><span class="keyword">(</span><span class="default">$conn</span><span class="keyword">, </span><span class="default">TRUE</span><span class="keyword">);<br><br></span><span class="comment">//Login OK ?<br></span><span class="keyword">if ((!</span><span class="default">$conn</span><span class="keyword">) || (!</span><span class="default">$login</span><span class="keyword">) || (!</span><span class="default">$mode</span><span class="keyword">)) {<br>&nbsp;&nbsp; die(</span><span class="string">"FTP connection has failed !"</span><span class="keyword">);<br>}<br>echo </span><span class="string">"&lt;br /&gt;Login Ok.&lt;br /&gt;"</span><span class="keyword">;<br><br></span><span class="comment">//<br>//Now run ftp_nlist()<br>//<br></span><span class="default">$file_list </span><span class="keyword">= </span><span class="default">ftp_nlist</span><span class="keyword">(</span><span class="default">$conn</span><span class="keyword">, </span><span class="string">""</span><span class="keyword">);<br>foreach (</span><span class="default">$file_list </span><span class="keyword">as </span><span class="default">$file</span><span class="keyword">)<br>{<br>&nbsp; echo </span><span class="string">"&lt;br&gt;</span><span class="default">$file</span><span class="string">"</span><span class="keyword">;<br>}<br><br></span><span class="comment">//close<br></span><span class="default">ftp_close</span><span class="keyword">(</span><span class="default">$conn</span><span class="keyword">);<br><br></span><span class="default">?&gt;</span>
</span>
</code></div>
  </div>
 </div>
  <div class="note" id="34042">  
  <a class="name">
  <strong class="user"><em>aRc</em></strong></a><div class="date" title="2003-07-14 12:46"><strong>11 years ago</strong></div>
  <div class="text" id="Hcom34042">
<div class="phpcode"><code><span class="html">
in windows, ftp_nlist will die on a directory with a space in it's name.&nbsp; to get around this, use ftp_chdir:<br><br>//change directory<br>ftp_chdir($conn, "directory with spaces");<br>//then blindly list<br>$contents = ftp_nlist($conn, "");</span>
</code></div>
  </div>
 </div>
  <div class="note" id="32633">  
  <a class="name">
  <strong class="user"><em>neodeus at allesamarsch dot com</em></strong></a><div class="date" title="2003-06-03 10:10"><strong>11 years ago</strong></div>
  <div class="text" id="Hcom32633">
<div class="phpcode"><code><span class="html">
This is an Example tp read out a Complete FTP Server ( beginn at your root dir )<br>&nbsp; &nbsp; function files($dir)<br>&nbsp; &nbsp; {<br>&nbsp; &nbsp; &nbsp; &nbsp; /*<br>&nbsp; &nbsp; &nbsp; &nbsp; if(!isset($dir) || empty($dir))<br>&nbsp; &nbsp; &nbsp; &nbsp; {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $dir=ftp_pwd($this-&gt;conn_id);<br>&nbsp; &nbsp; &nbsp; &nbsp; }<br>&nbsp; &nbsp; &nbsp; &nbsp; */<br>&nbsp; &nbsp; &nbsp; &nbsp; unset($list);<br>&nbsp; &nbsp; &nbsp; &nbsp; unset($files);<br>&nbsp; &nbsp; &nbsp; &nbsp; unset($folders);<br>&nbsp; &nbsp; &nbsp; &nbsp; unset($folder);<br>&nbsp; &nbsp; &nbsp; &nbsp; unset($file);<br>&nbsp; &nbsp; &nbsp; &nbsp; @ftp_chdir($this-&gt;conn_id, $dir);<br>&nbsp; &nbsp; &nbsp; &nbsp; $dir = ftp_pwd($this-&gt;conn_id);<br>&nbsp; &nbsp; &nbsp; &nbsp; $list=Array(); <br>&nbsp; &nbsp; &nbsp; &nbsp; $list=ftp_nlist($this-&gt;conn_id, "$dir"); <br>&nbsp; &nbsp; &nbsp; &nbsp; $files = Array();<br>&nbsp; &nbsp; &nbsp; &nbsp; $folders = Array();<br>&nbsp; &nbsp; &nbsp; &nbsp; for($i = 0; $i != sizeof($list); $i++)<br>&nbsp; &nbsp; &nbsp; &nbsp; {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $entry = str_replace("//", "", $list[$i]);<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if(@ftp_chdir($this-&gt;conn_id, $entry))<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $folders[] = $entry;<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ftp_chdir($this-&gt;conn_id, $dir);<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; else<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $files[] = $entry;<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br>&nbsp; &nbsp; &nbsp; &nbsp; }<br>&nbsp; &nbsp; &nbsp; &nbsp; print "\t&lt;b&gt; Dateien in ".$dir." :&lt;/b&gt;&lt;br&gt;&lt;br&gt;";<br>&nbsp; &nbsp; &nbsp; &nbsp; foreach($files as $file)<br>&nbsp; &nbsp; &nbsp; &nbsp; {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; print $file."&lt;br&gt;";<br>&nbsp; &nbsp; &nbsp; &nbsp; }<br>&nbsp; &nbsp; &nbsp; &nbsp; print "\t&lt;b&gt;Ordner in ".$dir." :&lt;/b&gt; &lt;br&gt;&lt;br&gt;";<br>&nbsp; &nbsp; &nbsp; &nbsp; foreach ($folders as $folder)<br>&nbsp; &nbsp; &nbsp; &nbsp; {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; print "\t".$folder."&lt;br&gt;";<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ftp_chdir($this-&gt;conn_id, $dir);<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $this-&gt;files($folder);<br>&nbsp; &nbsp; &nbsp; &nbsp; }<br>&nbsp; &nbsp; }</span>
</code></div>
  </div>
 </div>
  <div class="note" id="31668">  
  <a class="name">
  <strong class="user"><em>louis at ewens dot com</em></strong></a><div class="date" title="2003-04-29 04:03"><strong>11 years ago</strong></div>
  <div class="text" id="Hcom31668">
<div class="phpcode"><code><span class="html">
If you do a wildcard or other search for a particular file and the file doesn't exist, Solaris FTP servers send back "search*.xml: No such file or directory" as a single element in the response array. This makes it hard to check for the presence of a file.<br><br>One possible work-around is to parse your own raw directory listing. Or you could check for the error verbatim. But different servers could return different values. A simpler way to compensate is to use the ftp_size command to validate the returned file:<br><br>if ( ($filelist = ftp_nlist( $this-&gt;conn_id, $filesearch )) === FALSE )<br>{<br>&nbsp; &nbsp; &nbsp;&nbsp; Error( "Could not get file list" );<br>&nbsp; &nbsp; &nbsp;&nbsp; return FALSE;<br>}<br>// File actually exists? Catches invalid FTP server list responses<br>if ( !count($filelist) || ftp_size( $this-&gt;conn_id, $filelist[0] ) == -1 )<br>{<br>&nbsp; &nbsp; &nbsp;&nbsp; Error( "No valid files" );<br>&nbsp; &nbsp; &nbsp;&nbsp; return FALSE;<br>}<br>// File is really there, fetch it or whatever else you want to do</span>
</code></div>
  </div>
 </div>
  <div class="note" id="29420">  
  <a class="name">
  <strong class="user"><em>rfr at ajato dot com dot br</em></strong></a><div class="date" title="2003-02-12 08:25"><strong>11 years ago</strong></div>
  <div class="text" id="Hcom29420">
<div class="phpcode"><code><span class="html">
There are some FTP servers that just dont accept the ftp_nlist command, they return a bool variable. but I think all of them accept the LIST command which is the ftp_rawlist command. So yu have to parse rawlist to nlist. I found a code here posted by "fredrik" but it shows a bug if the files at the ftp server have spaces oon theeir name... so here its a better function:<br>function rawlist_2_nlist($list) <br>{ <br>&nbsp; &nbsp; $newlist = array();<br>&nbsp; &nbsp; reset($list); <br>&nbsp; &nbsp; while (list(,$row) = each($list)) <br>&nbsp; &nbsp; {<br>&nbsp; &nbsp; &nbsp; &nbsp; $buf="";<br>&nbsp; &nbsp; &nbsp; &nbsp; if ($row[0]=='d'||$row[0]=='-'){ <br>&nbsp; &nbsp; &nbsp; &nbsp; $buf = substr($row,55);<br>&nbsp; &nbsp; &nbsp; &nbsp; $newlist[]=$buf;<br>&nbsp; &nbsp; &nbsp; &nbsp; }<br>&nbsp; &nbsp; }<br><br>return $newlist; <br>}</span>
</code></div>
  </div>
 </div>
  <div class="note" id="20060">  
  <a class="name">
  <strong class="user"><em>ryan at wonko dot com</em></strong></a><div class="date" title="2002-03-20 07:31"><strong>12 years ago</strong></div>
  <div class="text" id="Hcom20060">
<div class="phpcode"><code><span class="html">
A note to developers using PHP on Windows servers: as of PHP 4.1.2, ftp_nlist() is broken in the Windows build of PHP. It will return nothing at all, even if the same code works fine on UNIX. So if you're going crazy trying to figure out why the function isn't returning anything, stop wasting your time, you're not doing anything wrong. Hopefully this will get fixed in future versions, although it's apparently been an issue since at least 4.0.6.<br><br>More info on this bug is at <a rel="nofollow" target="_blank">http://bugs.php.net/bug.php?id=16057</a></span>
</code></div>
  </div>
 </div>
  <div class="note" id="9583">  
  <a class="name">
  <strong class="user"><em>markw at altexa dot com</em></strong></a><div class="date" title="2000-11-13 12:33"><strong>13 years ago</strong></div>
  <div class="text" id="Hcom9583">
<div class="phpcode"><code><span class="html">
You can do a wildcard file listing with ftp_nlist, as in:
<br>
<br>$list=ftp_nlist($conn_id, "$dir/*.txt");</span>
</code></div>
  </div>
 </div>
  <div class="note" id="78280">  
  <a class="name">
  <strong class="user"><em>webmaster at weltvolk dot de</em></strong></a><div class="date" title="2007-10-05 02:24"><strong>6 years ago</strong></div>
  <div class="text" id="Hcom78280">
<div class="phpcode"><code><span class="html">
How to get the file list in alphabetical order with all directories at the top:<br><br><span class="default">&lt;?php<br>$ftp_nlist </span><span class="keyword">= </span><span class="default">ftp_nlist</span><span class="keyword">(</span><span class="default">$ftp_connect</span><span class="keyword">, </span><span class="string">"."</span><span class="keyword">);<br><br></span><span class="comment">//alphabetical sorting<br><br></span><span class="default">sort</span><span class="keyword">(</span><span class="default">$ftp_nlist</span><span class="keyword">);<br>foreach (</span><span class="default">$ftp_nlist </span><span class="keyword">as </span><span class="default">$v</span><span class="keyword">) {<br><br></span><span class="comment">//1. Size is '-1' =&gt; directory<br>&nbsp; </span><span class="keyword">if (</span><span class="default">ftp_size</span><span class="keyword">(</span><span class="default">$ftp_connect</span><span class="keyword">, </span><span class="default">$v</span><span class="keyword">) == -</span><span class="default">1</span><span class="keyword">) {<br><br></span><span class="comment">//output as [ directory ]<br>&nbsp; &nbsp; &nbsp; </span><span class="keyword">echo </span><span class="string">"[ " </span><span class="keyword">. </span><span class="default">$v </span><span class="keyword">. </span><span class="string">" ]&lt;br /&gt;\n"</span><span class="keyword">;<br>&nbsp; }<br>}<br>foreach (</span><span class="default">$ftp_nlist </span><span class="keyword">as </span><span class="default">$v</span><span class="keyword">) {<br><br></span><span class="comment">//2. Size is not '-1' =&gt; file<br>&nbsp; </span><span class="keyword">if (!(</span><span class="default">ftp_size</span><span class="keyword">(</span><span class="default">$ftp_connect</span><span class="keyword">, </span><span class="default">$v</span><span class="keyword">) == -</span><span class="default">1</span><span class="keyword">)) {<br><br></span><span class="comment">//output as file<br>&nbsp; &nbsp; &nbsp; </span><span class="keyword">echo </span><span class="string">"" </span><span class="keyword">. </span><span class="default">$v </span><span class="keyword">. </span><span class="string">"&lt;br /&gt;\n"</span><span class="keyword">;<br>&nbsp; }<br>}<br></span><span class="default">?&gt;<br></span><br>Result looks like:<br><br>[ a_mydirectory ]<br>[ b_mydirectory ]<br>[ c_mydirectory ]<br>...<br>a_myfile.htm<br>b_myfile.css<br>c_myfile.php<br>...</span>
</code></div>
  </div>
 </div>
  <div class="note" id="73401">  
  <a class="name">
  <strong class="user"><em>josh at servebyte dot com</em></strong></a><div class="date" title="2007-02-21 10:40"><strong>7 years ago</strong></div>
  <div class="text" id="Hcom73401">
<div class="phpcode"><code><span class="html">
Function Keywords: is_file is_dir<br><br><span class="default">&lt;?php<br>$ftp_server </span><span class="keyword">= </span><span class="string">'IP OR HOSTNAME HERE'</span><span class="keyword">;<br></span><span class="default">$ftp_user_name </span><span class="keyword">= </span><span class="string">'USERNAME'</span><span class="keyword">;<br></span><span class="default">$ftp_user_pass </span><span class="keyword">= </span><span class="string">'PASSWORD'</span><span class="keyword">;<br></span><span class="comment">// set up basic connection<br></span><span class="default">$conn_id </span><span class="keyword">= </span><span class="default">ftp_connect</span><span class="keyword">(</span><span class="default">$ftp_server</span><span class="keyword">);<br><br></span><span class="comment">// login with username and password<br></span><span class="default">$login_result </span><span class="keyword">= </span><span class="default">ftp_login</span><span class="keyword">(</span><span class="default">$conn_id</span><span class="keyword">, </span><span class="default">$ftp_user_name</span><span class="keyword">, </span><span class="default">$ftp_user_pass</span><span class="keyword">);<br><br>function </span><span class="default">ftp_is_dir</span><span class="keyword">(</span><span class="default">$folder</span><span class="keyword">) {<br>&nbsp;&nbsp; global </span><span class="default">$conn_id</span><span class="keyword">;<br>&nbsp;&nbsp; if (</span><span class="default">ftp_chdir</span><span class="keyword">(</span><span class="default">$conn_id</span><span class="keyword">, </span><span class="default">$folder</span><span class="keyword">)) {<br>&nbsp; &nbsp; &nbsp; </span><span class="default">ftp_chdir</span><span class="keyword">(</span><span class="default">$conn_id</span><span class="keyword">, </span><span class="string">'..'</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; return </span><span class="default">true</span><span class="keyword">;<br>&nbsp;&nbsp; } else {<br>&nbsp; &nbsp; &nbsp; return </span><span class="default">false</span><span class="keyword">;<br>&nbsp;&nbsp; }<br>}<br><br>function </span><span class="default">xdir</span><span class="keyword">(</span><span class="default">$path</span><span class="keyword">) {<br>&nbsp;&nbsp; global </span><span class="default">$conn_id</span><span class="keyword">;<br>&nbsp;&nbsp; </span><span class="default">$contents </span><span class="keyword">= </span><span class="default">ftp_nlist</span><span class="keyword">(</span><span class="default">$conn_id</span><span class="keyword">, </span><span class="default">$path</span><span class="keyword">);<br>&nbsp;&nbsp; foreach(</span><span class="default">$contents </span><span class="keyword">as </span><span class="default">$file</span><span class="keyword">) {<br>&nbsp; &nbsp; &nbsp; if (</span><span class="default">$file</span><span class="keyword">!=</span><span class="string">'.'</span><span class="keyword">&amp;&amp;</span><span class="default">$file</span><span class="keyword">!=</span><span class="string">'..'</span><span class="keyword">) {<br>&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">ftp_is_dir</span><span class="keyword">(</span><span class="default">$file</span><span class="keyword">)) {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; echo </span><span class="default">$file </span><span class="keyword">. </span><span class="string">' is a folder&lt;br&gt;'</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; } else {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; echo </span><span class="default">$file </span><span class="keyword">. </span><span class="string">' is a file&lt;br&gt;'</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br>&nbsp; &nbsp; &nbsp; }<br>&nbsp;&nbsp; }<br>}<br></span><span class="default">xdir</span><span class="keyword">(</span><span class="string">'.'</span><span class="keyword">);<br></span><span class="default">?&gt;<br></span><br>can be looped through... using the function xdir if the file is a folder ;)<br>Returns a warning upon not being a folder... use error_reporting(0); to resolve this issue.</span>
</code></div>
  </div>
 </div>
  <div class="note" id="72920">  
  <a class="name">
  <strong class="user"><em>nigel (at) amanwithapencil (dot) com</em></strong></a><div class="date" title="2007-02-04 04:02"><strong>7 years ago</strong></div>
  <div class="text" id="Hcom72920">
<div class="phpcode"><code><span class="html">
Actually, this works better (suppresses the error when ftp_chdir() fails)!:<br><br>if (!@ftp_chdir($ftp_conn, $userfolder))<br>{<br>&nbsp; &nbsp; ftp_mkdir($ftp_conn, $userfolder);<br>&nbsp; &nbsp; ftp_chdir($ftp_conn, $userfolder);<br>}</span>
</code></div>
  </div>
 </div></div>

 
</section>    </section><!-- layout-content -->
        


  </div><!-- layout -->
         
  

    
 <!-- External and third party libraries. -->
 







<a id="toTop" href="javascript:;"><span id="toTopHover"></span><img width="40" height="40" alt="To Top" src="../../images/to-top%402x.png"></a>



<!-- Mirrored from php.net/manual/en/function.ftp-nlist.php by HTTrack Website Copier/3.x [XR&CO'2013], Thu, 28 Aug 2014 16:00:25 GMT -->


</body></html>