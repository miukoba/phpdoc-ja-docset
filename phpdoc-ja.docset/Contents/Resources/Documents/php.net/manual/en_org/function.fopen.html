<html><!-- Mirrored from php.net/manual/en/function.fopen.php by HTTrack Website Copier/3.x [XR&CO'2013], Thu, 28 Aug 2014 15:28:54 GMT --><!-- Added by HTTrack --><head><meta http-equiv="content-type" content="text/html;charset=utf-8"><!-- /Added by HTTrack -->


  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0"> 

  <title>fopen</title>

 <link rel="shortcut icon" href="../../favicon.ico">
 <link rel="search" type="application/opensearchdescription+xml" href="http://php.net/phpnetimprovedsearch.src" title="Add PHP.net search">
 <link rel="alternate" type="application/atom+xml" href="http://php.net/releases/feed.php" title="PHP Release feed">
 <link rel="alternate" type="application/atom+xml" href="http://php.net/feed.atom" title="PHP: Hypertext Preprocessor">

 <link rel="canonical" href="function.fopen.html">
 <link rel="shorturl" href="http://php.net/fopen">
 <link rel="alternate" href="http://php.net/fopen" hreflang="x-default">

 <link rel="contents" href="index-2.html">
 <link rel="index" href="ref.filesystem.html">
 <link rel="prev" href="function.fnmatch.html">
 <link rel="next" href="function.fpassthru.html">

 <link rel="alternate" href="function.fopen.html" hreflang="en">
 <link rel="alternate" href="http://php.net/manual/pt_BR/function.fopen.php" hreflang="pt_BR">
 <link rel="alternate" href="http://php.net/manual/zh/function.fopen.php" hreflang="zh">
 <link rel="alternate" href="http://php.net/manual/fr/function.fopen.php" hreflang="fr">
 <link rel="alternate" href="http://php.net/manual/de/function.fopen.php" hreflang="de">
 <link rel="alternate" href="http://php.net/manual/it/function.fopen.php" hreflang="it">
 <link rel="alternate" href="http://php.net/manual/ja/function.fopen.php" hreflang="ja">
 <link rel="alternate" href="http://php.net/manual/ro/function.fopen.php" hreflang="ro">
 <link rel="alternate" href="http://php.net/manual/ru/function.fopen.php" hreflang="ru">
 <link rel="alternate" href="http://php.net/manual/es/function.fopen.php" hreflang="es">
 <link rel="alternate" href="http://php.net/manual/tr/function.fopen.php" hreflang="tr">

<link rel="stylesheet" type="text/css" href="../../cached8fe1.css?t=1401250819&amp;f=/fonts/Fira/fira.css" media="screen">
<link rel="stylesheet" type="text/css" href="../../cached4b8d.css?t=1404368420&amp;f=/fonts/Font-Awesome/css/fontello.css" media="screen">
<link rel="stylesheet" type="text/css" href="../../cached5065.css?t=1403329232&amp;f=/styles/theme-base.css" media="screen">
<link rel="stylesheet" type="text/css" href="../../cachedc78d.css?t=1401249623&amp;f=/styles/theme-medium.css" media="screen">

 <!--[if lte IE 7]>
 <link rel="stylesheet" type="text/css" href="http://php.net/styles/workarounds.ie7.css" media="screen">
 <![endif]-->

 <!--[if lte IE 8]>
 <script type="text/javascript">
  window.brokenIE = true;
 </script>
 <![endif]-->

 <!--[if lte IE 9]>
 <link rel="stylesheet" type="text/css" href="http://php.net/styles/workarounds.ie9.css" media="screen">
 <![endif]-->

 <!--[if IE]>
 <script type="text/javascript" src="http://php.net/js/ext/html5.js"></script>
 <![endif]-->

 <base>

</head>
<body class="docs " style="">


<div class="headsup"><a href="http://php.net/index.php#id2014-08-28-1">PHP 5.6.0 released</a></div>
<nav id="trick"><div><dl>
<dt><a href="getting-started.html">Getting Started</a></dt>
	<dd><a href="introduction.html">Introduction</a></dd>
	<dd><a href="tutorial.html">A simple tutorial</a></dd>
<dt><a href="langref.html">Language Reference</a></dt>
	<dd><a href="language.basic-syntax.html">Basic syntax</a></dd>
	<dd><a href="language.types.html">Types</a></dd>
	<dd><a href="language.variables.html">Variables</a></dd>
	<dd><a href="language.constants.html">Constants</a></dd>
	<dd><a href="language.expressions.html">Expressions</a></dd>
	<dd><a href="language.operators.html">Operators</a></dd>
	<dd><a href="language.control-structures.html">Control Structures</a></dd>
	<dd><a href="language.functions.html">Functions</a></dd>
	<dd><a href="language.oop5.html">Classes and Objects</a></dd>
	<dd><a href="language.namespaces.html">Namespaces</a></dd>
	<dd><a href="language.exceptions.html">Exceptions</a></dd>
	<dd><a href="language.generators.html">Generators</a></dd>
	<dd><a href="language.references.html">References Explained</a></dd>
	<dd><a href="reserved.variables.html">Predefined Variables</a></dd>
	<dd><a href="reserved.exceptions.html">Predefined Exceptions</a></dd>
	<dd><a href="reserved.interfaces.html">Predefined Interfaces and Classes</a></dd>
	<dd><a href="context.html">Context options and parameters</a></dd>
	<dd><a href="wrappers.html">Supported Protocols and Wrappers</a></dd>
</dl>
<dl>
<dt><a href="security.html">Security</a></dt>
	<dd><a href="security.intro.html">Introduction</a></dd>
	<dd><a href="security.general.html">General considerations</a></dd>
	<dd><a href="security.cgi-bin.html">Installed as CGI binary</a></dd>
	<dd><a href="security.apache.html">Installed as an Apache module</a></dd>
	<dd><a href="security.filesystem.html">Filesystem Security</a></dd>
	<dd><a href="security.database.html">Database Security</a></dd>
	<dd><a href="security.errors.html">Error Reporting</a></dd>
	<dd><a href="security.globals.html">Using Register Globals</a></dd>
	<dd><a href="security.variables.html">User Submitted Data</a></dd>
	<dd><a href="security.magicquotes.html">Magic Quotes</a></dd>
	<dd><a href="security.hiding.html">Hiding PHP</a></dd>
	<dd><a href="security.current.html">Keeping Current</a></dd>
<dt><a href="features.html">Features</a></dt>
	<dd><a href="features.http-auth.html">HTTP authentication with PHP</a></dd>
	<dd><a href="features.cookies.html">Cookies</a></dd>
	<dd><a href="features.sessions.html">Sessions</a></dd>
	<dd><a href="features.xforms.html">Dealing with XForms</a></dd>
	<dd><a href="features.file-upload.html">Handling file uploads</a></dd>
	<dd><a href="features.remote-files.html">Using remote files</a></dd>
	<dd><a href="features.connection-handling.html">Connection handling</a></dd>
	<dd><a href="features.persistent-connections.html">Persistent Database Connections</a></dd>
	<dd><a href="features.safe-mode.html">Safe Mode</a></dd>
	<dd><a href="features.commandline.html">Command line usage</a></dd>
	<dd><a href="features.gc.html">Garbage Collection</a></dd>
	<dd><a href="features.dtrace.html">DTrace Dynamic Tracing</a></dd>
</dl>
<dl>
<dt><a href="funcref.html">Function Reference</a></dt>
	<dd><a href="refs.basic.php.html">Affecting PHP's Behaviour</a></dd>
	<dd><a href="refs.utilspec.audio.html">Audio Formats Manipulation</a></dd>
	<dd><a href="refs.remote.auth.html">Authentication Services</a></dd>
	<dd><a href="refs.utilspec.cmdline.html">Command Line Specific Extensions</a></dd>
	<dd><a href="refs.compression.html">Compression and Archive Extensions</a></dd>
	<dd><a href="refs.creditcard.html">Credit Card Processing</a></dd>
	<dd><a href="refs.crypto.html">Cryptography Extensions</a></dd>
	<dd><a href="refs.database.html">Database Extensions</a></dd>
	<dd><a href="refs.calendar.html">Date and Time Related Extensions</a></dd>
	<dd><a href="refs.fileprocess.file.html">File System Related Extensions</a></dd>
	<dd><a href="refs.international.html">Human Language and Character Encoding Support</a></dd>
	<dd><a href="refs.utilspec.image.html">Image Processing and Generation</a></dd>
	<dd><a href="refs.remote.mail.html">Mail Related Extensions</a></dd>
	<dd><a href="refs.math.html">Mathematical Extensions</a></dd>
	<dd><a href="refs.utilspec.nontext.html">Non-Text MIME Output</a></dd>
	<dd><a href="refs.fileprocess.process.html">Process Control Extensions</a></dd>
	<dd><a href="refs.basic.other.html">Other Basic Extensions</a></dd>
	<dd><a href="refs.remote.other.html">Other Services</a></dd>
	<dd><a href="refs.search.html">Search Engine Extensions</a></dd>
	<dd><a href="refs.utilspec.server.html">Server Specific Extensions</a></dd>
	<dd><a href="refs.basic.session.html">Session Extensions</a></dd>
	<dd><a href="refs.basic.text.html">Text Processing</a></dd>
	<dd><a href="refs.basic.vartype.html">Variable and Type Related Extensions</a></dd>
	<dd><a href="refs.webservice.html">Web Services</a></dd>
	<dd><a href="refs.utilspec.windows.html">Windows Only Extensions</a></dd>
	<dd><a href="refs.xml.html">XML Manipulation</a></dd>
</dl>
<dl>
<dt>Keyboard Shortcuts</dt><dt>?</dt>
<dd>This help</dd>
<dt>j</dt>
<dd>Next menu item</dd>
<dt>k</dt>
<dd>Previous menu item</dd>
<dt>g p</dt>
<dd>Previous man page</dd>
<dt>g n</dt>
<dd>Next man page</dd>
<dt>G</dt>
<dd>Scroll to bottom</dd>
<dt>g g</dt>
<dd>Scroll to top</dd>
<dt>g h</dt>
<dd>Goto homepage</dd>
<dt>g s</dt>
<dd>Goto search<br>(current page)</dd>
<dt>/</dt>
<dd>Focus search box</dd>
</dl></div></nav>
<div id="goto">
    <div class="search">
         <div class="text"></div>
         <div class="results"><ul></ul></div>
   </div>
</div>

  <div id="breadcrumbs" class="row-fluid">
          
              
        <ul class="breadcrumbs-container">
            <li><a href="index-2.html">PHP Manual</a></li>      <li><a href="funcref.html">Function Reference</a></li>      <li><a href="refs.fileprocess.file.html">File System Related Extensions</a></li>      <li><a href="book.filesystem.html">Filesystem</a></li>      <li><a href="ref.filesystem.html">Filesystem Functions</a></li>    </ul>
  </div>




<div id="layout">
  <section id="layout-content">
  <div id="function.fopen" class="refentry">
 <div class="refnamediv">
  <h1 class="refname">fopen</h1>
  <p class="verinfo">(PHP 4, PHP 5)</p><p class="refpurpose"><span class="refname">fopen</span> — <span class="dc-title">Opens file or URL</span></p>

 </div>
 
 <div class="refsect1 description" id="refsect1-function.fopen-description">
  <h3 class="title">Description</h3>
  <div class="methodsynopsis dc-description">
   <span class="type">resource</span> <span class="methodname"><strong>fopen</strong></span>
    ( <span class="methodparam"><span class="type">string</span> <code class="parameter">$filename</code></span>
   , <span class="methodparam"><span class="type">string</span> <code class="parameter">$mode</code></span>
   [, <span class="methodparam"><span class="type">bool</span> <code class="parameter">$use_include_path</code><span class="initializer"> = false</span></span>
   [, <span class="methodparam"><span class="type">resource</span> <code class="parameter">$context</code></span>
  ]] )</div>

  <p class="para rdfs-comment">
   <span class="function"><strong>fopen()</strong></span> binds a named resource, specified by
   <code class="parameter">filename</code>, to a stream. 
  </p>
 </div>


 <div class="refsect1 parameters" id="refsect1-function.fopen-parameters">
  <h3 class="title">Parameters</h3>
  <p class="para">
   </p><dl>

    
     <dt>
<code class="parameter">filename</code></dt>

     <dd>

      <p class="para">
       If <code class="parameter">filename</code> is of the form "scheme://...", it
       is assumed to be a URL and PHP will search for a protocol handler
       (also known as a wrapper) for that scheme. If no wrappers for that
       protocol are registered, PHP will emit a notice to help you track
       potential problems in your script and then continue as though
       <code class="parameter">filename</code> specifies a regular file.
      </p>
      <p class="para">
       If PHP has decided that <code class="parameter">filename</code> specifies
       a local file, then it will try to open a stream on that file.
       The file must be accessible to PHP, so you need to ensure that
       the file access permissions allow this access.
       If you have enabled <a href="ini.sect.safe-mode.html#ini.safe-mode" class="link">safe mode</a>,
       or <a href="ini.core.html#ini.open-basedir" class="link">open_basedir</a> further
       restrictions may apply.
      </p>
      <p class="para">
       If PHP has decided that <code class="parameter">filename</code> specifies
       a registered protocol, and that protocol is registered as a
       network URL, PHP will check to make sure that
       <a href="filesystem.configuration.html#ini.allow-url-fopen" class="link">allow_url_fopen</a> is
       enabled. If it is switched off, PHP will emit a warning and
       the fopen call will fail.
      </p>
      <blockquote class="note"><p><strong class="note">Note</strong>: 
       </p><p class="para">
        The list of supported protocols can be found in <a href="wrappers.html" class="xref">Supported Protocols and Wrappers</a>. Some protocols (also referred to as
        <em>wrappers</em>) support <em>context</em>
        and/or <var class="filename">php.ini</var> options. Refer to the specific page for the
        protocol in use for a list of options which can be set. (e.g.
        <var class="filename">php.ini</var> value <em>user_agent</em> used by the
        <em>http</em> wrapper).
       </p>
      <p></p></blockquote>
      <p class="para">
       On the Windows platform, be careful to escape any backslashes
       used in the path to the file, or use forward slashes.
       </p><div class="informalexample">
        <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br>$handle&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">fopen</span><span style="color: #007700">(</span><span style="color: #DD0000">"c:\\folder\\resource.txt"</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">"r"</span><span style="color: #007700">);<br></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
        </div>

       </div>
      <p></p>
     </dd>

    
    
     <dt>
<code class="parameter">mode</code></dt>

     <dd>

      <p class="para">
       The <code class="parameter">mode</code> parameter specifies the type of access
       you require to the stream.  It may be any of the following:
       </p><table class="doctable table">
        <caption><strong>
         A list of possible modes for <span class="function"><strong>fopen()</strong></span>
         using <code class="parameter">mode</code>
        </strong></caption>
        
         <thead>
          <tr>
           <th><code class="parameter">mode</code></th>
           <th>Description</th>
          </tr>

         </thead>

         <tbody class="tbody">
          <tr>
           <td><em>'r'</em></td>
           <td>
            Open for reading only; place the file pointer at the
            beginning of the file.
           </td>
          </tr>

          <tr>
           <td><em>'r+'</em></td>
           <td>
            Open for reading and writing; place the file pointer at
            the beginning of the file.
           </td>
          </tr>

          <tr>
           <td><em>'w'</em></td>
           <td>
            Open for writing only; place the file pointer at the
            beginning of the file and truncate the file to zero length.
            If the file does not exist, attempt to create it.
           </td>
          </tr>

          <tr>
           <td><em>'w+'</em></td>
           <td>
            Open for reading and writing; place the file pointer at
            the beginning of the file and truncate the file to zero
            length.  If the file does not exist, attempt to create it.
           </td>
          </tr>

          <tr>
           <td><em>'a'</em></td>
           <td>
            Open for writing only; place the file pointer at the end of
            the file. If the file does not exist, attempt to create it.
           </td>
          </tr>

          <tr>
           <td><em>'a+'</em></td>
           <td>
            Open for reading and writing; place the file pointer at
            the end of the file. If the file does not exist, attempt to
            create it.
           </td>
          </tr>

          <tr>
           <td><em>'x'</em></td>
           <td>
            Create and open for writing only; place the file pointer at the
            beginning of the file.  If the file already exists, the
            <span class="function"><strong>fopen()</strong></span> call will fail by returning <strong><code>FALSE</code></strong> and
            generating an error of level <strong><code>E_WARNING</code></strong>.  If
            the file does not exist, attempt to create it.  This is equivalent
            to specifying <em>O_EXCL|O_CREAT</em> flags for the
            underlying <em>open(2)</em> system call. 
           </td>
          </tr>

          <tr>
           <td><em>'x+'</em></td>
           <td>
            Create and open for reading and writing; otherwise it has the
            same behavior as <em>'x'</em>.
           </td>
          </tr>

          <tr>
           <td><em>'c'</em></td>
           <td>
            Open the file for writing only. If the file does not exist, it is
            created. If it exists, it is neither truncated (as opposed to
            <em>'w'</em>), nor the call to this function fails (as is
            the case with <em>'x'</em>). The file pointer is
            positioned on the beginning of the file. This may be useful if it's
            desired to get an advisory lock (see <span class="function"><a href="function.flock.html" class="function">flock()</a></span>)
            before attempting to modify the file, as using
            <em>'w'</em> could truncate the file before the lock
            was obtained (if truncation is desired,
            <span class="function"><a href="function.ftruncate.html" class="function">ftruncate()</a></span> can be used after the lock is
            requested).
           </td>
          </tr>

          <tr>
           <td><em>'c+'</em></td>
           <td>
            Open the file for reading and writing; otherwise it has the same
            behavior as <em>'c'</em>.
           </td>
          </tr>

         </tbody>
        
       </table>

      <p></p>
      <blockquote class="note"><p><strong class="note">Note</strong>: 
       </p><p class="para">
        Different operating system families have different line-ending
        conventions.  When you write a text file and want to insert a line
        break, you need to use the correct line-ending character(s) for your
        operating system.  Unix based systems use <em>\n</em> as the
        line ending character, Windows based systems use <em>\r\n</em>
        as the line ending characters and Macintosh based systems use
        <em>\r</em> as the line ending character.
       </p>
       <p class="para">
        If you use the wrong line ending characters when writing your files, you
        might find that other applications that open those files will "look
        funny".
       </p>
       <p class="para">
        Windows offers a text-mode translation flag (<em>'t'</em>)
        which will transparently translate <em>\n</em> to
        <em>\r\n</em> when working with the file.  In contrast, you
        can also use <em>'b'</em> to force binary mode, which will not
        translate your data.  To use these flags, specify either
        <em>'b'</em> or <em>'t'</em> as the last character
        of the <code class="parameter">mode</code> parameter.
       </p>
       <p class="para">
        The default translation mode depends on the SAPI and version of PHP that
        you are using, so you are encouraged to always specify the appropriate
        flag for portability reasons.  You should use the <em>'t'</em>
        mode if you are working with plain-text files and you use
        <em>\n</em> to delimit your line endings in your script, but
        expect your files to be readable with applications such as notepad.  You
        should use the <em>'b'</em> in all other cases.
       </p>
       <p class="para">
        If you do not specify the 'b' flag when working with binary files, you
        may experience strange problems with your data, including broken image
        files and strange problems with <em>\r\n</em> characters.
       </p>
      <p></p></blockquote>
      <blockquote class="note"><p><strong class="note">Note</strong>: 
       </p><p class="para">
        For portability, it is strongly recommended that you always
        use the 'b' flag when opening files with <span class="function"><strong>fopen()</strong></span>.
       </p>
      <p></p></blockquote>
      <blockquote class="note"><p><strong class="note">Note</strong>: 
       </p><p class="para">
        Again, for portability, it is also strongly recommended that
        you re-write code that uses or relies upon the <em>'t'</em>
        mode so that it uses the correct line endings and
        <em>'b'</em> mode instead.
       </p>
      <p></p></blockquote>
     </dd>

    
    
     <dt>
<code class="parameter">use_include_path</code></dt>

     <dd>

      <p class="para">
       The optional third <code class="parameter">use_include_path</code> parameter
       can be set to '1' or <strong><code>TRUE</code></strong> if you want to search for the file in the
       <a href="ini.core.html#ini.include-path" class="link">include_path</a>, too.
      </p>
     </dd>

    
    
     <dt>
<code class="parameter">context</code></dt>

     <dd>

      <blockquote class="note"><p><strong class="note">Note</strong>: <span class="simpara">Context support was added
with PHP 5.0.0. For a description of <em>contexts</em>, refer to
<a href="book.stream.html" class="xref">Streams</a>.</span></p></blockquote>
     </dd>

    
   </dl>

  <p></p>
 </div>


 <div class="refsect1 returnvalues" id="refsect1-function.fopen-returnvalues">
  <h3 class="title">Return Values</h3>
  <p class="para">
   Returns a file pointer resource on success, or <strong><code>FALSE</code></strong> on error.
  </p>
 </div>


 <div class="refsect1 errors" id="refsect1-function.fopen-errors">
  <h3 class="title">Errors/Exceptions</h3>
  <p class="para">
   If the open fails, an error of level
   <strong><code>E_WARNING</code></strong> is generated.  You may use <a href="language.operators.errorcontrol.html" class="link">@</a> to suppress this
   warning.
  </p>
 </div>


 <div class="refsect1 changelog" id="refsect1-function.fopen-changelog">
  <h3 class="title">Changelog</h3>
  <p class="para">
   </p><table class="doctable informaltable">
    
     <thead>
      <tr>
       <th>Version</th>
       <th>Description</th>
      </tr>

     </thead>

     <tbody class="tbody">
      <tr>
       <td>5.2.6</td>
       <td>
        The <em>'c'</em> and <em>'c+'</em> options were
        added
       </td>
      </tr>

      <tr>
       <td>4.3.2</td>
       <td>
        As of PHP 4.3.2, the default mode is set to binary for all platforms
        that distinguish between binary and text mode.  If you are having
        problems with your scripts after upgrading, try using the
        <em>'t'</em> flag as a workaround until you have made your
        script more portable as mentioned before
       </td>
      </tr>

     </tbody>
    
   </table>

  <p></p>
 </div>


 <div class="refsect1 examples" id="refsect1-function.fopen-examples">
  <h3 class="title">Examples</h3>
  <p class="para">
   </p><div class="example" id="example-2479">
    <p><strong>Example #1 <span class="function"><strong>fopen()</strong></span> examples</strong></p>
    <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br>$handle&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">fopen</span><span style="color: #007700">(</span><span style="color: #DD0000">"/home/rasmus/file.txt"</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">"r"</span><span style="color: #007700">);<br></span><span style="color: #0000BB">$handle&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">fopen</span><span style="color: #007700">(</span><span style="color: #DD0000">"/home/rasmus/file.gif"</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">"wb"</span><span style="color: #007700">);<br></span><span style="color: #0000BB">$handle&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">fopen</span><span style="color: #007700">(</span><span style="color: #DD0000">"http://www.example.com/"</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">"r"</span><span style="color: #007700">);<br></span><span style="color: #0000BB">$handle&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">fopen</span><span style="color: #007700">(</span><span style="color: #DD0000">"ftp://user:password@example.com/somefile.txt"</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">"w"</span><span style="color: #007700">);<br></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
    </div>

   </div>
  <p></p>
 </div>


 <div class="refsect1 notes" id="refsect1-function.fopen-notes">
  <h3 class="title">Notes</h3>
  <div class="warning"><strong class="warning">Warning</strong><p class="para">When using SSL, Microsoft IIS
will violate the protocol by closing the connection without sending a
<em>close_notify</em> indicator. PHP will report this as "SSL: Fatal
Protocol Error" when you reach the end of the data. To work around this, the
value of <a href="errorfunc.configuration.html#ini.error-reporting" class="link">error_reporting</a> should be
lowered to a level that does not include warnings.
PHP 4.3.7 and higher can detect buggy IIS server software when you open
the stream using the <em>https://</em> wrapper and will suppress the
warning. When using <span class="function"><a href="function.fsockopen.html" class="function">fsockopen()</a></span> to create an
<em>ssl://</em> socket, the developer is responsible for detecting
and suppressing this warning.</p></div>
  <blockquote class="note"><p><strong class="note">Note</strong>: <span class="simpara">When <a href="features.safe-mode.html" class="link">safe mode</a> is enabled, PHP checks whether
the directory in which the script is operating has the same UID (owner) as the
script that is being executed.</span></p></blockquote>
  <blockquote class="note"><p><strong class="note">Note</strong>: 
   </p><p class="para">
    If you are experiencing problems with reading and writing to files and
    you're using the server module version of PHP, remember to make sure that
    the files and directories you're using are accessible to the server
    process.
   </p>
  <p></p></blockquote>
  <blockquote class="note"><p><strong class="note">Note</strong>: 
   </p><p class="para">
    This function may also succeed when <code class="parameter">filename</code> is a
    directory. If you are unsure whether <code class="parameter">filename</code> is a
    file or a directory, you may need to use the <span class="function"><a href="function.is-dir.html" class="function">is_dir()</a></span>
    function before calling <span class="function"><strong>fopen()</strong></span>.
   </p>
  <p></p></blockquote>
 </div>


 <div class="refsect1 seealso" id="refsect1-function.fopen-seealso">
  <h3 class="title">See Also</h3>
  <p class="para">
   </p><ul class="simplelist">
    <li class="member"><a href="wrappers.html" class="xref">Supported Protocols and Wrappers</a></li>
    <li class="member"><span class="function"><a href="function.fclose.html" class="function" rel="rdfs-seeAlso">fclose()</a> - Closes an open file pointer</span></li>
    <li class="member"><span class="function"><a href="function.fgets.html" class="function" rel="rdfs-seeAlso">fgets()</a> - Gets line from file pointer</span></li>
    <li class="member"><span class="function"><a href="function.fread.html" class="function" rel="rdfs-seeAlso">fread()</a> - Binary-safe file read</span></li>
    <li class="member"><span class="function"><a href="function.fwrite.html" class="function" rel="rdfs-seeAlso">fwrite()</a> - Binary-safe file write</span></li>
    <li class="member"><span class="function"><a href="function.fsockopen.html" class="function" rel="rdfs-seeAlso">fsockopen()</a> - Open Internet or Unix domain socket connection</span></li>
    <li class="member"><span class="function"><a href="function.file.html" class="function" rel="rdfs-seeAlso">file()</a> - Reads entire file into an array</span></li>
    <li class="member"><span class="function"><a href="function.file-exists.html" class="function" rel="rdfs-seeAlso">file_exists()</a> - Checks whether a file or directory exists</span></li>
    <li class="member"><span class="function"><a href="function.is-readable.html" class="function" rel="rdfs-seeAlso">is_readable()</a> - Tells whether a file exists and is readable</span></li>
    <li class="member"><span class="function"><a href="function.stream-set-timeout.html" class="function" rel="rdfs-seeAlso">stream_set_timeout()</a> - Set timeout period on a stream</span></li>
    <li class="member"><span class="function"><a href="function.popen.html" class="function" rel="rdfs-seeAlso">popen()</a> - Opens process file pointer</span></li>
    <li class="member"><span class="function"><a href="function.stream-context-create.html" class="function" rel="rdfs-seeAlso">stream_context_create()</a> - Creates a stream context</span></li>
    <li class="member"><span class="function"><a href="function.umask.html" class="function" rel="rdfs-seeAlso">umask()</a> - Changes the current umask</span></li>
    <li class="member"><a href="class.splfileobject.html" class="classname">SplFileObject</a></li>
   </ul>
  <p></p>
 </div>


</div>
<section id="usernotes">
 <div class="head"><h3 class="title">User Contributed Notes</h3></div><div id="allnotes">
  <div class="note" id="107851">  
  <a class="name">
  <strong class="user"><em>chapman at worldtakeoverindustries dot com</em></strong></a><div class="date" title="2012-03-09 07:25"><strong>2 years ago</strong></div>
  <div class="text" id="Hcom107851">
<div class="phpcode"><code><span class="html">
Note - using fopen in 'w' mode will NOT update the modification time (filemtime) of a file like you may expect. You may want to issue a touch() after writing and closing the file which update its modification time. This may become critical in a caching situation, if you intend to keep your hair.</span>
</code></div>
  </div>
 </div>
  <div class="note" id="84028">  
  <a class="name">
  <strong class="user"><em>php at delhelsa dot com</em></strong></a><div class="date" title="2008-06-24 12:27"><strong>6 years ago</strong></div>
  <div class="text" id="Hcom84028">
<div class="phpcode"><code><span class="html">
With php 5.2.5 on Apache 2.2.4, accessing files on an ftp server with fopen() or readfile() requires an extra forwardslash if an absolute path is needed.
<br>
<br>i.e., if a file called bullbes.txt is stored under /var/school/ on ftp server example.com and you're trying to access it with user blossom and password buttercup, the url would be:
<br>
<br><a rel="nofollow" target="_blank">ftp://blossom:buttercup@example.com//var/school/bubbles.txt</a>
<br>
<br>Note the two forwardslashes. It looks like the second one is needed so the server won't interpret the path as relative to blossom's home on townsville.</span>
</code></div>
  </div>
 </div>
  <div class="note" id="58099">  
  <a class="name">
  <strong class="user"><em>info at b1g dot de</em></strong></a><div class="date" title="2005-10-24 04:54"><strong>8 years ago</strong></div>
  <div class="text" id="Hcom58099">
<div class="phpcode"><code><span class="html">
Simple class to fetch a HTTP URL. Supports "Location:"-redirections. Useful for servers with allow_url_fopen=false. Works with SSL-secured hosts.
<br>
<br><span class="default">&lt;?php
<br></span><span class="comment">#usage:
<br></span><span class="default">$r </span><span class="keyword">= new </span><span class="default">HTTPRequest</span><span class="keyword">(</span><span class="string">'<a rel="nofollow" target="_blank">http://www.example.com</a>'</span><span class="keyword">);
<br>echo </span><span class="default">$r</span><span class="keyword">-&gt;</span><span class="default">DownloadToString</span><span class="keyword">();
<br>
<br>class </span><span class="default">HTTPRequest
<br></span><span class="keyword">{
<br>&nbsp; &nbsp; var </span><span class="default">$_fp</span><span class="keyword">;&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="comment">// HTTP socket
<br>&nbsp; &nbsp; </span><span class="keyword">var </span><span class="default">$_url</span><span class="keyword">;&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="comment">// full URL
<br>&nbsp; &nbsp; </span><span class="keyword">var </span><span class="default">$_host</span><span class="keyword">;&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="comment">// HTTP host
<br>&nbsp; &nbsp; </span><span class="keyword">var </span><span class="default">$_protocol</span><span class="keyword">;&nbsp; &nbsp; </span><span class="comment">// protocol (HTTP/HTTPS)
<br>&nbsp; &nbsp; </span><span class="keyword">var </span><span class="default">$_uri</span><span class="keyword">;&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="comment">// request URI
<br>&nbsp; &nbsp; </span><span class="keyword">var </span><span class="default">$_port</span><span class="keyword">;&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="comment">// port
<br>&nbsp; &nbsp; 
<br>&nbsp; &nbsp; // scan url
<br>&nbsp; &nbsp; </span><span class="keyword">function </span><span class="default">_scan_url</span><span class="keyword">()
<br>&nbsp; &nbsp; {
<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$req </span><span class="keyword">= </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">_url</span><span class="keyword">;
<br>&nbsp; &nbsp; &nbsp; &nbsp; 
<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$pos </span><span class="keyword">= </span><span class="default">strpos</span><span class="keyword">(</span><span class="default">$req</span><span class="keyword">, </span><span class="string">'://'</span><span class="keyword">);
<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">_protocol </span><span class="keyword">= </span><span class="default">strtolower</span><span class="keyword">(</span><span class="default">substr</span><span class="keyword">(</span><span class="default">$req</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">$pos</span><span class="keyword">));
<br>&nbsp; &nbsp; &nbsp; &nbsp; 
<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$req </span><span class="keyword">= </span><span class="default">substr</span><span class="keyword">(</span><span class="default">$req</span><span class="keyword">, </span><span class="default">$pos</span><span class="keyword">+</span><span class="default">3</span><span class="keyword">);
<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$pos </span><span class="keyword">= </span><span class="default">strpos</span><span class="keyword">(</span><span class="default">$req</span><span class="keyword">, </span><span class="string">'/'</span><span class="keyword">);
<br>&nbsp; &nbsp; &nbsp; &nbsp; if(</span><span class="default">$pos </span><span class="keyword">=== </span><span class="default">false</span><span class="keyword">)
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$pos </span><span class="keyword">= </span><span class="default">strlen</span><span class="keyword">(</span><span class="default">$req</span><span class="keyword">);
<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$host </span><span class="keyword">= </span><span class="default">substr</span><span class="keyword">(</span><span class="default">$req</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">$pos</span><span class="keyword">);
<br>&nbsp; &nbsp; &nbsp; &nbsp; 
<br>&nbsp; &nbsp; &nbsp; &nbsp; if(</span><span class="default">strpos</span><span class="keyword">(</span><span class="default">$host</span><span class="keyword">, </span><span class="string">':'</span><span class="keyword">) !== </span><span class="default">false</span><span class="keyword">)
<br>&nbsp; &nbsp; &nbsp; &nbsp; {
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; list(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">_host</span><span class="keyword">, </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">_port</span><span class="keyword">) = </span><span class="default">explode</span><span class="keyword">(</span><span class="string">':'</span><span class="keyword">, </span><span class="default">$host</span><span class="keyword">);
<br>&nbsp; &nbsp; &nbsp; &nbsp; }
<br>&nbsp; &nbsp; &nbsp; &nbsp; else 
<br>&nbsp; &nbsp; &nbsp; &nbsp; {
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">_host </span><span class="keyword">= </span><span class="default">$host</span><span class="keyword">;
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">_port </span><span class="keyword">= (</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">_protocol </span><span class="keyword">== </span><span class="string">'https'</span><span class="keyword">) ? </span><span class="default">443 </span><span class="keyword">: </span><span class="default">80</span><span class="keyword">;
<br>&nbsp; &nbsp; &nbsp; &nbsp; }
<br>&nbsp; &nbsp; &nbsp; &nbsp; 
<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">_uri </span><span class="keyword">= </span><span class="default">substr</span><span class="keyword">(</span><span class="default">$req</span><span class="keyword">, </span><span class="default">$pos</span><span class="keyword">);
<br>&nbsp; &nbsp; &nbsp; &nbsp; if(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">_uri </span><span class="keyword">== </span><span class="string">''</span><span class="keyword">)
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">_uri </span><span class="keyword">= </span><span class="string">'/'</span><span class="keyword">;
<br>&nbsp; &nbsp; }
<br>&nbsp; &nbsp; 
<br>&nbsp; &nbsp; </span><span class="comment">// constructor
<br>&nbsp; &nbsp; </span><span class="keyword">function </span><span class="default">HTTPRequest</span><span class="keyword">(</span><span class="default">$url</span><span class="keyword">)
<br>&nbsp; &nbsp; {
<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">_url </span><span class="keyword">= </span><span class="default">$url</span><span class="keyword">;
<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">_scan_url</span><span class="keyword">();
<br>&nbsp; &nbsp; }
<br>&nbsp; &nbsp; 
<br>&nbsp; &nbsp; </span><span class="comment">// download URL to string
<br>&nbsp; &nbsp; </span><span class="keyword">function </span><span class="default">DownloadToString</span><span class="keyword">()
<br>&nbsp; &nbsp; {
<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$crlf </span><span class="keyword">= </span><span class="string">"\r\n"</span><span class="keyword">;
<br>&nbsp; &nbsp; &nbsp; &nbsp; 
<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="comment">// generate request
<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$req </span><span class="keyword">= </span><span class="string">'GET ' </span><span class="keyword">. </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">_uri </span><span class="keyword">. </span><span class="string">' HTTP/1.0' </span><span class="keyword">. </span><span class="default">$crlf
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="keyword">.&nbsp; &nbsp; </span><span class="string">'Host: ' </span><span class="keyword">. </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">_host </span><span class="keyword">. </span><span class="default">$crlf
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="keyword">.&nbsp; &nbsp; </span><span class="default">$crlf</span><span class="keyword">;
<br>&nbsp; &nbsp; &nbsp; &nbsp; 
<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="comment">// fetch
<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">_fp </span><span class="keyword">= </span><span class="default">fsockopen</span><span class="keyword">((</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">_protocol </span><span class="keyword">== </span><span class="string">'https' </span><span class="keyword">? </span><span class="string">'ssl://' </span><span class="keyword">: </span><span class="string">''</span><span class="keyword">) . </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">_host</span><span class="keyword">, </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">_port</span><span class="keyword">);
<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">fwrite</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">_fp</span><span class="keyword">, </span><span class="default">$req</span><span class="keyword">);
<br>&nbsp; &nbsp; &nbsp; &nbsp; while(</span><span class="default">is_resource</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">_fp</span><span class="keyword">) &amp;&amp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">_fp </span><span class="keyword">&amp;&amp; !</span><span class="default">feof</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">_fp</span><span class="keyword">))
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$response </span><span class="keyword">.= </span><span class="default">fread</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">_fp</span><span class="keyword">, </span><span class="default">1024</span><span class="keyword">);
<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">fclose</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">_fp</span><span class="keyword">);
<br>&nbsp; &nbsp; &nbsp; &nbsp; 
<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="comment">// split header and body
<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$pos </span><span class="keyword">= </span><span class="default">strpos</span><span class="keyword">(</span><span class="default">$response</span><span class="keyword">, </span><span class="default">$crlf </span><span class="keyword">. </span><span class="default">$crlf</span><span class="keyword">);
<br>&nbsp; &nbsp; &nbsp; &nbsp; if(</span><span class="default">$pos </span><span class="keyword">=== </span><span class="default">false</span><span class="keyword">)
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; return(</span><span class="default">$response</span><span class="keyword">);
<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$header </span><span class="keyword">= </span><span class="default">substr</span><span class="keyword">(</span><span class="default">$response</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">$pos</span><span class="keyword">);
<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$body </span><span class="keyword">= </span><span class="default">substr</span><span class="keyword">(</span><span class="default">$response</span><span class="keyword">, </span><span class="default">$pos </span><span class="keyword">+ </span><span class="default">2 </span><span class="keyword">* </span><span class="default">strlen</span><span class="keyword">(</span><span class="default">$crlf</span><span class="keyword">));
<br>&nbsp; &nbsp; &nbsp; &nbsp; 
<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="comment">// parse headers
<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$headers </span><span class="keyword">= array();
<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$lines </span><span class="keyword">= </span><span class="default">explode</span><span class="keyword">(</span><span class="default">$crlf</span><span class="keyword">, </span><span class="default">$header</span><span class="keyword">);
<br>&nbsp; &nbsp; &nbsp; &nbsp; foreach(</span><span class="default">$lines </span><span class="keyword">as </span><span class="default">$line</span><span class="keyword">)
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if((</span><span class="default">$pos </span><span class="keyword">= </span><span class="default">strpos</span><span class="keyword">(</span><span class="default">$line</span><span class="keyword">, </span><span class="string">':'</span><span class="keyword">)) !== </span><span class="default">false</span><span class="keyword">)
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$headers</span><span class="keyword">[</span><span class="default">strtolower</span><span class="keyword">(</span><span class="default">trim</span><span class="keyword">(</span><span class="default">substr</span><span class="keyword">(</span><span class="default">$line</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">$pos</span><span class="keyword">)))] = </span><span class="default">trim</span><span class="keyword">(</span><span class="default">substr</span><span class="keyword">(</span><span class="default">$line</span><span class="keyword">, </span><span class="default">$pos</span><span class="keyword">+</span><span class="default">1</span><span class="keyword">));
<br>&nbsp; &nbsp; &nbsp; &nbsp; 
<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="comment">// redirection?
<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="keyword">if(isset(</span><span class="default">$headers</span><span class="keyword">[</span><span class="string">'location'</span><span class="keyword">]))
<br>&nbsp; &nbsp; &nbsp; &nbsp; {
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$http </span><span class="keyword">= new </span><span class="default">HTTPRequest</span><span class="keyword">(</span><span class="default">$headers</span><span class="keyword">[</span><span class="string">'location'</span><span class="keyword">]);
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; return(</span><span class="default">$http</span><span class="keyword">-&gt;</span><span class="default">DownloadToString</span><span class="keyword">(</span><span class="default">$http</span><span class="keyword">));
<br>&nbsp; &nbsp; &nbsp; &nbsp; }
<br>&nbsp; &nbsp; &nbsp; &nbsp; else 
<br>&nbsp; &nbsp; &nbsp; &nbsp; {
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; return(</span><span class="default">$body</span><span class="keyword">);
<br>&nbsp; &nbsp; &nbsp; &nbsp; }
<br>&nbsp; &nbsp; }
<br>}
<br></span><span class="default">?&gt;</span>
</span>
</code></div>
  </div>
 </div>
  <div class="note" id="41532">  
  <a class="name">
  <strong class="user"><em>Jem Tallon</em></strong></a><div class="date" title="2004-04-13 03:11"><strong>10 years ago</strong></div>
  <div class="text" id="Hcom41532">
<div class="phpcode"><code><span class="html">
If you're using fopen to open a URL that requires authorization, you might need to force a HTTP/1.0 request for it since fopen won't support HTTP/1.1 requests. You can do that by setting your user_agent to one that is known only to support HTTP/1.0 (most webservers will be configured to force HTTP/1.0 for some browsers). Here's what worked for me:
<br>
<br><span class="default">&lt;?php
<br>$returned</span><span class="keyword">=</span><span class="default">URLopen</span><span class="keyword">(</span><span class="string">"<a rel="nofollow" target="_blank">http://</a></span><span class="default">$username</span><span class="string">:</span><span class="default">$password</span><span class="string">@example.com"</span><span class="keyword">);
<br>
<br>function </span><span class="default">URLopen</span><span class="keyword">(</span><span class="default">$url</span><span class="keyword">)
<br>{
<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="comment">// Fake the browser type
<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">ini_set</span><span class="keyword">(</span><span class="string">'user_agent'</span><span class="keyword">,</span><span class="string">'MSIE 4\.0b2;'</span><span class="keyword">);
<br>
<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$dh </span><span class="keyword">= </span><span class="default">fopen</span><span class="keyword">(</span><span class="string">"</span><span class="default">$url</span><span class="string">"</span><span class="keyword">,</span><span class="string">'r'</span><span class="keyword">);
<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$result </span><span class="keyword">= </span><span class="default">fread</span><span class="keyword">(</span><span class="default">$dh</span><span class="keyword">,</span><span class="default">8192</span><span class="keyword">);&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; 
<br>&nbsp; &nbsp; &nbsp; &nbsp; return </span><span class="default">$result</span><span class="keyword">;
<br>}
<br></span><span class="default">?&gt;</span>
</span>
</code></div>
  </div>
 </div>
  <div class="note" id="74398">  
  <a class="name">
  <strong class="user"><em>simon dot allen at swerve dot co dot nz</em></strong></a><div class="date" title="2007-04-09 07:56"><strong>7 years ago</strong></div>
  <div class="text" id="Hcom74398">
<div class="phpcode"><code><span class="html">
using fopen to upload a file through ftp cannot overwrite that file - use curl instead</span>
</code></div>
  </div>
 </div>
  <div class="note" id="64262">  
  <a class="name">
  <strong class="user"><em>ceo at l-i-e dot com</em></strong></a><div class="date" title="2006-04-10 08:13"><strong>8 years ago</strong></div>
  <div class="text" id="Hcom64262">
<div class="phpcode"><code><span class="html">
If you need fopen() on a URL to timeout, you can do like:<br><span class="default">&lt;?php<br>&nbsp; $timeout </span><span class="keyword">= </span><span class="default">3</span><span class="keyword">;<br>&nbsp; </span><span class="default">$old </span><span class="keyword">= </span><span class="default">ini_set</span><span class="keyword">(</span><span class="string">'default_socket_timeout'</span><span class="keyword">, </span><span class="default">$timeout</span><span class="keyword">);<br>&nbsp; </span><span class="default">$file </span><span class="keyword">= </span><span class="default">fopen</span><span class="keyword">(</span><span class="string">'<a rel="nofollow" target="_blank">http://example.com</a>'</span><span class="keyword">, </span><span class="string">'r'</span><span class="keyword">);<br>&nbsp; </span><span class="default">ini_set</span><span class="keyword">(</span><span class="string">'default_socket_timeout'</span><span class="keyword">, </span><span class="default">$old</span><span class="keyword">);<br>&nbsp; </span><span class="default">stream_set_timeout</span><span class="keyword">(</span><span class="default">$file</span><span class="keyword">, </span><span class="default">$timeout</span><span class="keyword">);<br>&nbsp; </span><span class="default">stream_set_blocking</span><span class="keyword">(</span><span class="default">$file</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">);<br>&nbsp; </span><span class="comment">//the rest is standard<br></span><span class="default">?&gt;</span>
</span>
</code></div>
  </div>
 </div>
  <div class="note" id="91363">  
  <a class="name">
  <strong class="user"><em>gmdebby at gmail dot com</em></strong></a><div class="date" title="2009-06-08 06:49"><strong>5 years ago</strong></div>
  <div class="text" id="Hcom91363">
<div class="phpcode"><code><span class="html">
I was wondering why was added the "x" mode, it works only if the file do not exists, will create it and open it in read only, it's useless !!<br>But I found something I could do with that.<br><br>Here is a little mk_file function.<br><br><span class="default">&lt;?php<br></span><span class="keyword">function </span><span class="default">mk_file</span><span class="keyword">(</span><span class="default">$filename</span><span class="keyword">) {<br>&nbsp; &nbsp; if(!</span><span class="default">is_file</span><span class="keyword">(</span><span class="default">$filename</span><span class="keyword">)) {<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">fclose</span><span class="keyword">(</span><span class="default">fopen</span><span class="keyword">(</span><span class="default">$filename</span><span class="keyword">,</span><span class="string">"x"</span><span class="keyword">)); </span><span class="comment">//create the file and close it<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="keyword">return </span><span class="default">true</span><span class="keyword">;<br>&nbsp; &nbsp; } else return </span><span class="default">false</span><span class="keyword">; </span><span class="comment">//file already exists<br></span><span class="keyword">}<br></span><span class="default">?&gt;<br></span><br>You can improve it, add chmod support etc...</span>
</code></div>
  </div>
 </div>
  <div class="note" id="22822">  
  <a class="name"><strong class="user"><em>Anonymous</em></strong></a><div class="date" title="2002-07-01 09:57"><strong>12 years ago</strong></div>
  <div class="text" id="Hcom22822">
<div class="phpcode"><code><span class="html">
Note that if specifying the optional 'b' (binary) mode, it appears that it cannot be the first letter for some unaccountable reason. In other words, "br" doesn't work, while "rb" is ok!</span>
</code></div>
  </div>
 </div>
  <div class="note" id="60718">  
  <a class="name">
  <strong class="user"><em>flobee</em></strong></a><div class="date" title="2006-01-14 07:58"><strong>8 years ago</strong></div>
  <div class="text" id="Hcom60718">
<div class="phpcode"><code><span class="html">
download: i need a function to simulate a "wget url" and do not buffer the data in the memory to avoid thouse problems on large files:<br><span class="default">&lt;?php<br></span><span class="keyword">function </span><span class="default">download</span><span class="keyword">(</span><span class="default">$file_source</span><span class="keyword">, </span><span class="default">$file_target</span><span class="keyword">) {<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$rh </span><span class="keyword">= </span><span class="default">fopen</span><span class="keyword">(</span><span class="default">$file_source</span><span class="keyword">, </span><span class="string">'rb'</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$wh </span><span class="keyword">= </span><span class="default">fopen</span><span class="keyword">(</span><span class="default">$file_target</span><span class="keyword">, </span><span class="string">'wb'</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; if (</span><span class="default">$rh</span><span class="keyword">===</span><span class="default">false </span><span class="keyword">|| </span><span class="default">$wh</span><span class="keyword">===</span><span class="default">false</span><span class="keyword">) {<br></span><span class="comment">// error reading or opening file<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">return </span><span class="default">true</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; }<br>&nbsp; &nbsp; &nbsp; &nbsp; while (!</span><span class="default">feof</span><span class="keyword">(</span><span class="default">$rh</span><span class="keyword">)) {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if (</span><span class="default">fwrite</span><span class="keyword">(</span><span class="default">$wh</span><span class="keyword">, </span><span class="default">fread</span><span class="keyword">(</span><span class="default">$rh</span><span class="keyword">, </span><span class="default">1024</span><span class="keyword">)) === </span><span class="default">FALSE</span><span class="keyword">) {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// 'Download error: Cannot write to file ('.$file_target.')';<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">return </span><span class="default">true</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br>&nbsp; &nbsp; &nbsp; &nbsp; }<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">fclose</span><span class="keyword">(</span><span class="default">$rh</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">fclose</span><span class="keyword">(</span><span class="default">$wh</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="comment">// No error<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="keyword">return </span><span class="default">false</span><span class="keyword">;<br>&nbsp; &nbsp; }<br></span><span class="default">?&gt;</span>
</span>
</code></div>
  </div>
 </div>
  <div class="note" id="104325">  
  <a class="name">
  <strong class="user"><em>splogamurugan at gmail dot com</em></strong></a><div class="date" title="2011-06-09 02:13"><strong>3 years ago</strong></div>
  <div class="text" id="Hcom104325">
<div class="phpcode"><code><span class="html">
While opening a file with multibyte data (Ex: données multi-octets), faced some issues with the encoding. Got to know that it uses&nbsp; windows-1250. Used iconv to convert it to UTF-8 and it resolved the issue.&nbsp; 
<br>
<br><span class="default">&lt;?php
<br></span><span class="keyword">function </span><span class="default">utf8_fopen_read</span><span class="keyword">(</span><span class="default">$fileName</span><span class="keyword">) {
<br>&nbsp; &nbsp; </span><span class="default">$fc </span><span class="keyword">= </span><span class="default">iconv</span><span class="keyword">(</span><span class="string">'windows-1250'</span><span class="keyword">, </span><span class="string">'utf-8'</span><span class="keyword">, </span><span class="default">file_get_contents</span><span class="keyword">(</span><span class="default">$fileName</span><span class="keyword">)); 
<br>&nbsp; &nbsp; </span><span class="default">$handle</span><span class="keyword">=</span><span class="default">fopen</span><span class="keyword">(</span><span class="string">"php://memory"</span><span class="keyword">, </span><span class="string">"rw"</span><span class="keyword">);
<br>&nbsp; &nbsp; </span><span class="default">fwrite</span><span class="keyword">(</span><span class="default">$handle</span><span class="keyword">, </span><span class="default">$fc</span><span class="keyword">); 
<br>&nbsp; &nbsp; </span><span class="default">fseek</span><span class="keyword">(</span><span class="default">$handle</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">); 
<br>&nbsp; &nbsp; return </span><span class="default">$handle</span><span class="keyword">;
<br>}
<br></span><span class="default">?&gt;
<br></span>
<br>Example usage:
<br>
<br><span class="default">&lt;?php
<br>$fh </span><span class="keyword">= </span><span class="default">utf8_fopen_read</span><span class="keyword">(</span><span class="string">"./tpKpiBundle.csv"</span><span class="keyword">);
<br>while ((</span><span class="default">$data </span><span class="keyword">= </span><span class="default">fgetcsv</span><span class="keyword">(</span><span class="default">$fh</span><span class="keyword">, </span><span class="default">1000</span><span class="keyword">, </span><span class="string">","</span><span class="keyword">)) !== </span><span class="default">false</span><span class="keyword">) {
<br>&nbsp; &nbsp; foreach (</span><span class="default">$data </span><span class="keyword">as </span><span class="default">$value</span><span class="keyword">) {
<br>&nbsp; &nbsp; &nbsp; &nbsp; echo </span><span class="default">$value </span><span class="keyword">. </span><span class="string">"&lt;br /&gt;\n"</span><span class="keyword">;
<br>&nbsp; &nbsp; }
<br>}
<br></span><span class="default">?&gt;
<br></span>
<br>Hope it helps.</span>
</code></div>
  </div>
 </div>
  <div class="note" id="112243">  
  <a class="name">
  <strong class="user"><em>simon dot riget at gamil dot com</em></strong></a><div class="date" title="2013-05-21 06:50"><strong>1 year ago</strong></div>
  <div class="text" id="Hcom112243">
<div class="phpcode"><code><span class="html">
Writing and reading on a serial port.<br><br>If you are unable or unwilling to install the serial device library for PHP, its still possible to communicate through a serial port or USB device.<br><br>There are two issues to note:<br>- you must use a system call to set the port control options<br>- you must use NON blocking stream mode for reading (not for writing unless you use flow control) <br><br><span class="default">&lt;?php<br></span><span class="comment">// Set timeout to 500 ms<br></span><span class="default">$timeout</span><span class="keyword">=</span><span class="default">microtime</span><span class="keyword">(</span><span class="default">true</span><span class="keyword">)+</span><span class="default">0.5</span><span class="keyword">;<br><br></span><span class="comment">// Set device controle options (See man page for stty)<br></span><span class="default">exec</span><span class="keyword">(</span><span class="string">"/bin/stty -F /dev/ttyS0 19200 sane raw cs8 hupcl cread clocal -echo -onlcr "</span><span class="keyword">);<br>&nbsp; &nbsp; <br></span><span class="comment">// Open serial port<br></span><span class="default">$fp</span><span class="keyword">=</span><span class="default">fopen</span><span class="keyword">(</span><span class="string">"/dev/ttyS0"</span><span class="keyword">,</span><span class="string">"c+"</span><span class="keyword">);<br>if(!</span><span class="default">$fp</span><span class="keyword">) die(</span><span class="string">"Can't open device"</span><span class="keyword">);<br><br></span><span class="comment">// Set blocking mode for writing<br></span><span class="default">stream_set_blocking</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">,</span><span class="default">1</span><span class="keyword">);<br></span><span class="default">fwrite</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">,</span><span class="string">"foo\n"</span><span class="keyword">);<br><br></span><span class="comment">// Set non blocking mode for reading<br></span><span class="default">stream_set_blocking</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">);<br>do{<br>&nbsp; </span><span class="comment">// Try to read one character from the device<br>&nbsp; </span><span class="default">$c</span><span class="keyword">=</span><span class="default">fgetc</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">);<br> <br>&nbsp; </span><span class="comment">// Wait for data to arive <br>&nbsp; </span><span class="keyword">if(</span><span class="default">$c </span><span class="keyword">=== </span><span class="default">false</span><span class="keyword">){<br>&nbsp; &nbsp; &nbsp; </span><span class="default">usleep</span><span class="keyword">(</span><span class="default">50000</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; continue;<br>&nbsp; }&nbsp; <br>&nbsp; <br>&nbsp; </span><span class="default">$line</span><span class="keyword">.=</span><span class="default">$c</span><span class="keyword">;<br>&nbsp; &nbsp; <br>}while(</span><span class="default">$c</span><span class="keyword">!=</span><span class="string">"\n" </span><span class="keyword">&amp;&amp; </span><span class="default">microtime</span><span class="keyword">(</span><span class="default">true</span><span class="keyword">)&lt;</span><span class="default">$timeout</span><span class="keyword">); <br>&nbsp; <br>echo </span><span class="string">"Responce: </span><span class="default">$line</span><span class="string">"</span><span class="keyword">;&nbsp; <br></span><span class="default">?&gt;</span>
</span>
</code></div>
  </div>
 </div>
  <div class="note" id="55922">  
  <a class="name">
  <strong class="user"><em>Luiz Miguel Axcar (lmaxcar at yahoo dot com dot br)</em></strong></a><div class="date" title="2005-08-17 01:11"><strong>9 years ago</strong></div>
  <div class="text" id="Hcom55922">
<div class="phpcode"><code><span class="html">
If you are getting message "Warning: fopen(): URL file-access is disabled in the server configuration", you can use function below to get the content from a local or remote file.<br><br>Function uses CURL lib, follow the link to get help: <a rel="nofollow" target="_blank">http://www.php.net/curl</a><br><br><span class="default">&lt;?php<br></span><span class="comment">/*<br>&nbsp;&nbsp; * @return string<br>&nbsp;&nbsp; * @param string $url<br>&nbsp;&nbsp; * @desc Return string content from a remote file<br>&nbsp;&nbsp; * @author Luiz Miguel Axcar (lmaxcar@yahoo.com.br)<br>*/<br><br></span><span class="keyword">function </span><span class="default">get_content</span><span class="keyword">(</span><span class="default">$url</span><span class="keyword">)<br>{<br>&nbsp; &nbsp; </span><span class="default">$ch </span><span class="keyword">= </span><span class="default">curl_init</span><span class="keyword">();<br><br>&nbsp; &nbsp; </span><span class="default">curl_setopt </span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">, </span><span class="default">CURLOPT_URL</span><span class="keyword">, </span><span class="default">$url</span><span class="keyword">);<br>&nbsp; &nbsp; </span><span class="default">curl_setopt </span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">, </span><span class="default">CURLOPT_HEADER</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">);<br><br>&nbsp; &nbsp; </span><span class="default">ob_start</span><span class="keyword">();<br><br>&nbsp; &nbsp; </span><span class="default">curl_exec </span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">);<br>&nbsp; &nbsp; </span><span class="default">curl_close </span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">);<br>&nbsp; &nbsp; </span><span class="default">$string </span><span class="keyword">= </span><span class="default">ob_get_contents</span><span class="keyword">();<br><br>&nbsp; &nbsp; </span><span class="default">ob_end_clean</span><span class="keyword">();<br>&nbsp; &nbsp; <br>&nbsp; &nbsp; return </span><span class="default">$string</span><span class="keyword">;&nbsp; &nbsp;&nbsp; <br>}<br><br></span><span class="comment">#usage:<br></span><span class="default">$content </span><span class="keyword">= </span><span class="default">get_content </span><span class="keyword">(</span><span class="string">"<a rel="nofollow" target="_blank">http://www.php.net</a>"</span><span class="keyword">);<br></span><span class="default">var_dump </span><span class="keyword">(</span><span class="default">$content</span><span class="keyword">);<br></span><span class="default">?&gt;</span>
</span>
</code></div>
  </div>
 </div>
  <div class="note" id="98128">  
  <a class="name">
  <strong class="user"><em>anfragen at tsgames dot de</em></strong></a><div class="date" title="2010-05-27 05:54"><strong>4 years ago</strong></div>
  <div class="text" id="Hcom98128">
<div class="phpcode"><code><span class="html">
Since the http-wrapper doesn't support stat() and so you can't use file_exists() for url's, you can simply use a function like this:
<br>
<br><span class="default">&lt;?php
<br></span><span class="keyword">function </span><span class="default">http_file_exists</span><span class="keyword">(</span><span class="default">$url</span><span class="keyword">)
<br>{
<br></span><span class="default">$f</span><span class="keyword">=@</span><span class="default">fopen</span><span class="keyword">(</span><span class="default">$url</span><span class="keyword">,</span><span class="string">"r"</span><span class="keyword">);
<br>if(</span><span class="default">$f</span><span class="keyword">)
<br>{
<br></span><span class="default">fclose</span><span class="keyword">(</span><span class="default">$f</span><span class="keyword">);
<br>return </span><span class="default">true</span><span class="keyword">;
<br>}
<br>return </span><span class="default">false</span><span class="keyword">;
<br>}
<br></span><span class="default">?&gt;</span>
</span>
</code></div>
  </div>
 </div>
  <div class="note" id="105180">  
  <a class="name">
  <strong class="user"><em>php at richardneill dot org</em></strong></a><div class="date" title="2011-08-01 09:39"><strong>3 years ago</strong></div>
  <div class="text" id="Hcom105180">
<div class="phpcode"><code><span class="html">
fopen() will block if the file to be opened is a fifo. This is true whether it's opened in "r" or "w" mode.&nbsp; (See man 7 fifo: this is the correct, default behaviour; although Linux supports non-blocking fopen() of a fifo, PHP doesn't).<br>The consequence of this is that you can't discover whether an initial fifo read/write would block because to do that you need stream_select(), which in turn requires that fopen() has happened!</span>
</code></div>
  </div>
 </div>
  <div class="note" id="95751">  
  <a class="name">
  <strong class="user"><em>Pastix</em></strong></a><div class="date" title="2010-01-20 03:04"><strong>4 years ago</strong></div>
  <div class="text" id="Hcom95751">
<div class="phpcode"><code><span class="html">
If fopen() has been disabled for security reasons, is possible a porting FROM:
<br>
<br><span class="default">&lt;?php
<br>$f</span><span class="keyword">=</span><span class="default">fopen</span><span class="keyword">(</span><span class="default">$file</span><span class="keyword">,</span><span class="string">'rb'</span><span class="keyword">);
<br></span><span class="default">$data</span><span class="keyword">=</span><span class="string">''</span><span class="keyword">;
<br>while(!</span><span class="default">feof</span><span class="keyword">(</span><span class="default">$f</span><span class="keyword">))
<br>&nbsp; &nbsp; </span><span class="default">$data</span><span class="keyword">.=</span><span class="default">fread</span><span class="keyword">(</span><span class="default">$f</span><span class="keyword">,</span><span class="default">$size</span><span class="keyword">);
<br></span><span class="default">fclose</span><span class="keyword">(</span><span class="default">$f</span><span class="keyword">);
<br></span><span class="default">?&gt;
<br></span>
<br>TO:
<br>
<br><span class="default">&lt;?php
<br>$data </span><span class="keyword">= </span><span class="default">file_get_contents</span><span class="keyword">(</span><span class="default">$file</span><span class="keyword">); </span><span class="comment">// (PHP 4 &gt;= 4.3.0, PHP 5)
<br></span><span class="default">?&gt;
<br></span>
<br>and also a porting FROM:
<br>
<br><span class="default">&lt;?php
<br>$f </span><span class="keyword">= </span><span class="default">fopen</span><span class="keyword">(</span><span class="default">$file</span><span class="keyword">,</span><span class="string">'wb'</span><span class="keyword">);
<br></span><span class="default">fwrite</span><span class="keyword">(</span><span class="default">$f</span><span class="keyword">,</span><span class="default">$content</span><span class="keyword">,</span><span class="default">strlen</span><span class="keyword">(</span><span class="default">$content</span><span class="keyword">));
<br></span><span class="default">fclose</span><span class="keyword">(</span><span class="default">$f</span><span class="keyword">);
<br></span><span class="default">?&gt;
<br></span>
<br>TO:
<br>
<br><span class="default">&lt;?php
<br>$f</span><span class="keyword">=</span><span class="default">file_put_contents</span><span class="keyword">(</span><span class="default">$file</span><span class="keyword">, </span><span class="default">$content</span><span class="keyword">); </span><span class="comment">// (PHP 5)
<br></span><span class="default">?&gt;
<br></span>
<br>For detail read the php manual.</span>
</code></div>
  </div>
 </div>
  <div class="note" id="33127">  
  <a class="name">
  <strong class="user"><em>RobNar</em></strong></a><div class="date" title="2003-06-17 08:15"><strong>11 years ago</strong></div>
  <div class="text" id="Hcom33127">
<div class="phpcode"><code><span class="html">
This is an addendum to ibetyouare at home dot com's note about Apache directory permissions.&nbsp; If you are on a shared host and cannot tweak Apache's permissions directives then you might try setting the same thing in a .htaccess file.&nbsp; Failing that, if you are having trouble just creating files then&nbsp; set the directory permissions to allow writing (for whatever directory the file is supposed to be in) and include the following before fopen():<br><br>`touch /path/to/myfile/myfile.txt`;<br><br>That will usually create a new empty file that you can write to even when fopen fails. - PHP 4.3.0</span>
</code></div>
  </div>
 </div>
  <div class="note" id="57871">  
  <a class="name">
  <strong class="user"><em>admin at sellchain dot com</em></strong></a><div class="date" title="2005-10-17 07:34"><strong>8 years ago</strong></div>
  <div class="text" id="Hcom57871">
<div class="phpcode"><code><span class="html">
TIP: If you are using fopen and fread to read HTTP or FTP or Remote Files, and experiencing some performance issues such as stalling, slowing down and otherwise, then it's time you learned a thing called cURL.<br><br>Performance Comparison:<br><br>10 per minute for fopen/fread for 100 HTTP files<br>2000 per minute for cURL for 2000 HTTP files<br><br>cURL should be used for opening HTTP and FTP files, it is EXTREMELY reliable, even when it comes to performance.<br><br>I noticed when using too many scripts at the same time to download the data from the site I was harvesting from, fopen and fread would go into deadlock. When using cURL i can open 50 windows, running 10 URL's from each window, and getting the best performance possible. <br><br>Just a Tip :)</span>
</code></div>
  </div>
 </div>
  <div class="note" id="109944">  
  <a class="name">
  <strong class="user"><em>apathetic012 at gmail dot com</em></strong></a><div class="date" title="2012-09-04 03:19"><strong>1 year ago</strong></div>
  <div class="text" id="Hcom109944">
<div class="phpcode"><code><span class="html">
a variable $http_response_header is available when doing the fopen(). Which contains an array of the response header.</span>
</code></div>
  </div>
 </div>
  <div class="note" id="55434">  
  <a class="name">
  <strong class="user"><em>ideacode</em></strong></a><div class="date" title="2005-08-03 07:28"><strong>9 years ago</strong></div>
  <div class="text" id="Hcom55434">
<div class="phpcode"><code><span class="html">
Note that whether you may open directories is operating system dependent. The following lines:<br><br><span class="default">&lt;?php<br></span><span class="comment">// Windows ($fh === false)<br></span><span class="default">$fh </span><span class="keyword">= </span><span class="default">fopen</span><span class="keyword">(</span><span class="string">'c:\\Temp'</span><span class="keyword">, </span><span class="string">'r'</span><span class="keyword">);<br><br></span><span class="comment">// UNIX (is_resource($fh) === true)<br></span><span class="default">$fh </span><span class="keyword">= </span><span class="default">fopen</span><span class="keyword">(</span><span class="string">'/tmp'</span><span class="keyword">, </span><span class="string">'r'</span><span class="keyword">);<br></span><span class="default">?&gt;<br></span><br>demonstrate that on Windows (2000, probably XP) you may not open a directory (the error is "Permission Denied"), regardless of the security permissions on that directory.<br><br>On UNIX, you may happily read the directory format for the native filesystem.</span>
</code></div>
  </div>
 </div>
  <div class="note" id="107468">  
  <a class="name">
  <strong class="user"><em>kasper at webmasteren dot eu</em></strong></a><div class="date" title="2012-02-10 08:36"><strong>2 years ago</strong></div>
  <div class="text" id="Hcom107468">
<div class="phpcode"><code><span class="html">
"Do not use the following reserved device names for the name of a file:<br>CON, PRN, AUX, NUL, COM1, COM2, COM3, COM4, COM5, COM6, COM7, COM8, COM9, LPT1, <br>LPT2, LPT3, LPT4, LPT5, LPT6, LPT7, LPT8, and LPT9. Also avoid these names <br>followed immediately by an extension; for example, NUL.txt is not recommended. <br>For more information, see Namespaces"<br>it is a windows limitation.<br>see:<br><a rel="nofollow" target="_blank">http://msdn.microsoft.com/en-us/library/windows/desktop/aa365247(v=vs.85</a>).aspx</span>
</code></div>
  </div>
 </div>
  <div class="note" id="102291">  
  <a class="name">
  <strong class="user"><em>owltech at larkandowl dot net</em></strong></a><div class="date" title="2011-02-06 11:20"><strong>3 years ago</strong></div>
  <div class="text" id="Hcom102291">
<div class="phpcode"><code><span class="html">
[fopen note]
<br>
<br>I have been trying unsuccessfully to upload and read a Mac OS file on a Linux server. Lots of records show up a just one big using only the following:
<br>
<br><span class="default">&lt;?php $fhandle </span><span class="keyword">= </span><span class="default">fopen</span><span class="keyword">(</span><span class="default">$file</span><span class="keyword">, </span><span class="string">'r'</span><span class="keyword">); </span><span class="default">?&gt;
<br></span>&nbsp; or
<br><span class="default">&lt;?php $fhandle </span><span class="keyword">= </span><span class="default">fopen</span><span class="keyword">(</span><span class="default">$file</span><span class="keyword">, </span><span class="string">'rb'</span><span class="keyword">); </span><span class="default">?&gt;
<br></span>
<br>It does work, however, this way:
<br>
<br><span class="default">&lt;?php
<br>ini_set</span><span class="keyword">(</span><span class="string">'auto_detect_line_endings'</span><span class="keyword">, </span><span class="default">TRUE</span><span class="keyword">);
<br></span><span class="default">$fhandle </span><span class="keyword">= </span><span class="default">fopen</span><span class="keyword">(</span><span class="default">$file</span><span class="keyword">, </span><span class="string">'r'</span><span class="keyword">);
<br></span><span class="default">?&gt;</span>
</span>
</code></div>
  </div>
 </div>
  <div class="note" id="37761">  
  <a class="name">
  <strong class="user"><em>ken dot gregg at rwre dot com</em></strong></a><div class="date" title="2003-11-25 03:03"><strong>10 years ago</strong></div>
  <div class="text" id="Hcom37761">
<div class="phpcode"><code><span class="html">
PHP will open a directory if a path with no file name is supplied. This just bit me. I was not checking the filename part of a concatenated string.
<br>
<br>For example:
<br>
<br><span class="default">&lt;?php
<br>$fd </span><span class="keyword">= </span><span class="default">fopen</span><span class="keyword">(</span><span class="string">'/home/mydir/' </span><span class="keyword">. </span><span class="default">$somefile</span><span class="keyword">, </span><span class="string">'r'</span><span class="keyword">);
<br></span><span class="default">?&gt;
<br></span>
<br>Will open the directory if $somefile = ''
<br>
<br>If you attempt to read using the file handle you will get the binary directory contents. I tried append mode and it errors out so does not seem to be dangerous.
<br>
<br>This is with FreeBSD 4.5 and PHP 4.3.1. Behaves the same on 4.1.1 and PHP 4.1.2. I have not tested other version/os combinations.</span>
</code></div>
  </div>
 </div>
  <div class="note" id="47344">  
  <a class="name">
  <strong class="user"><em>Thomas Candrian tc_ at gmx dot ch</em></strong></a><div class="date" title="2004-11-11 07:35"><strong>9 years ago</strong></div>
  <div class="text" id="Hcom47344">
<div class="phpcode"><code><span class="html">
With this it isn't possible to get data from another port than 80 (and 443) - at least for me. Because of that I've made this function who gets data from every port you want using HTTP:<br><br>&lt;?php;<br>function getcontent($server, $port, $file)<br>{<br>&nbsp; &nbsp; $cont = "";<br>&nbsp; &nbsp; $ip = gethostbyname($server);<br>&nbsp; &nbsp; $fp = fsockopen($ip, $port);<br>&nbsp; &nbsp; if (!$fp)<br>&nbsp; &nbsp; {<br>&nbsp; &nbsp; &nbsp; &nbsp; return "Unknown";<br>&nbsp; &nbsp; }<br>&nbsp; &nbsp; else<br>&nbsp; &nbsp; {<br>&nbsp; &nbsp; &nbsp; &nbsp; $com = "GET $file HTTP/1.1\r\nAccept: */*\r\nAccept-Language: de-ch\r\nAccept-Encoding: gzip, deflate\r\nUser-Agent: Mozilla/4.0 (compatible; MSIE 6.0; Windows NT 5.0)\r\nHost: $server:$port\r\nConnection: Keep-Alive\r\n\r\n";<br>&nbsp; &nbsp; &nbsp; &nbsp; fputs($fp, $com);<br>&nbsp; &nbsp; &nbsp; &nbsp; while (!feof($fp))<br>&nbsp; &nbsp; &nbsp; &nbsp; {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $cont .= fread($fp, 500);<br>&nbsp; &nbsp; &nbsp; &nbsp; }<br>&nbsp; &nbsp; &nbsp; &nbsp; fclose($fp);<br>&nbsp; &nbsp; &nbsp; &nbsp; $cont = substr($cont, strpos($cont, "\r\n\r\n") + 4);<br>&nbsp; &nbsp; &nbsp; &nbsp; return $cont;<br>&nbsp; &nbsp; }<br>}<br>echo getcontent("www.myhost.com", "81", "/"));<br>?&gt;<br><br>Works fine for me. Had to do this especially for a shoutcast server, which only delivered the HTML-file if the user-agent was given.</span>
</code></div>
  </div>
 </div>
  <div class="note" id="100452">  
  <a class="name">
  <strong class="user"><em>Brad G</em></strong></a><div class="date" title="2010-10-16 02:10"><strong>3 years ago</strong></div>
  <div class="text" id="Hcom100452">
<div class="phpcode"><code><span class="html">
While adding CFLAGS="-D_FILE_OFFSET_BITS=64" immediately before calling "./configure" on the PHP source will enable support for using fopen() on large files (greater than 2 GB), note that -- if such an installation of PHP is used in conjunction with Apache HTTPD [2.x], Apache will become completely unresponsive even when not serving output from a PHP application.<br><br>In order to gain large file support for non-web applications while maintaining the operability of Apache, consider making two distinct PHP installations:&nbsp; one with the above CFLAGS specified during configuration (for non-web uses), and the other without this flag (for use with Apache).</span>
</code></div>
  </div>
 </div>
  <div class="note" id="95777">  
  <a class="name">
  <strong class="user"><em>magnetik at magnetik dot org</em></strong></a><div class="date" title="2010-01-21 06:43"><strong>4 years ago</strong></div>
  <div class="text" id="Hcom95777">
<div class="phpcode"><code><span class="html">
There IS an option to use fopen with a proxy, it's in $context. <br>No need to recode everything.</span>
</code></div>
  </div>
 </div>
  <div class="note" id="94831">  
  <a class="name">
  <strong class="user"><em>b dot evieux at gmail dot com</em></strong></a><div class="date" title="2009-11-27 03:28"><strong>4 years ago</strong></div>
  <div class="text" id="Hcom94831">
<div class="phpcode"><code><span class="html">
Hello all. I have had trouble getting files through proxy, and the solution posted above only works if the requested file is also hosted on the proxy server (which is quite unlikely). so I've put together the following functions pfopen &amp; preadfile. they quite work like the replaced fopen &amp; readfile, and will resort to them if no proxy is provided :)
<br>
<br><span class="default">&lt;?php
<br></span><span class="keyword">function </span><span class="default">preadfile</span><span class="keyword">(</span><span class="default">$_url</span><span class="keyword">, </span><span class="default">$_proxy_name </span><span class="keyword">= </span><span class="default">null</span><span class="keyword">, </span><span class="default">$_proxy_port </span><span class="keyword">= </span><span class="default">4480</span><span class="keyword">){
<br>&nbsp; if(</span><span class="default">is_null</span><span class="keyword">(</span><span class="default">$_proxy_name</span><span class="keyword">) || </span><span class="default">LOCAL_TEST</span><span class="keyword">){
<br>&nbsp; &nbsp; return </span><span class="default">readfile</span><span class="keyword">(</span><span class="default">$_url</span><span class="keyword">);
<br>&nbsp; }else{
<br>&nbsp; &nbsp; </span><span class="default">$proxy_cont </span><span class="keyword">= </span><span class="string">''</span><span class="keyword">;
<br>
<br>&nbsp; &nbsp; </span><span class="default">$proxy_fp </span><span class="keyword">= </span><span class="default">pfopen</span><span class="keyword">(</span><span class="default">$_url</span><span class="keyword">, </span><span class="default">$_proxy_name</span><span class="keyword">, </span><span class="default">$_proxy_port</span><span class="keyword">);
<br>&nbsp; &nbsp; while(!</span><span class="default">feof</span><span class="keyword">(</span><span class="default">$proxy_fp</span><span class="keyword">)) {</span><span class="default">$proxy_cont </span><span class="keyword">.= </span><span class="default">fread</span><span class="keyword">(</span><span class="default">$proxy_fp</span><span class="keyword">,</span><span class="default">4096</span><span class="keyword">);}
<br>&nbsp; &nbsp; </span><span class="default">fclose</span><span class="keyword">(</span><span class="default">$proxy_fp</span><span class="keyword">);
<br>
<br>&nbsp; &nbsp; </span><span class="default">$proxy_cont </span><span class="keyword">= </span><span class="default">substr</span><span class="keyword">(</span><span class="default">$proxy_cont</span><span class="keyword">, </span><span class="default">strpos</span><span class="keyword">(</span><span class="default">$proxy_cont</span><span class="keyword">,</span><span class="string">"\r\n\r\n"</span><span class="keyword">)+</span><span class="default">4</span><span class="keyword">);
<br>&nbsp; &nbsp; echo </span><span class="default">$proxy_cont</span><span class="keyword">;
<br>&nbsp; &nbsp; return </span><span class="default">count</span><span class="keyword">(</span><span class="default">$proxy_cont</span><span class="keyword">);
<br>&nbsp; }
<br>}
<br>function </span><span class="default">pfopen</span><span class="keyword">(</span><span class="default">$_url</span><span class="keyword">, </span><span class="default">$_proxy_name </span><span class="keyword">= </span><span class="default">null</span><span class="keyword">, </span><span class="default">$_proxy_port </span><span class="keyword">= </span><span class="default">4480</span><span class="keyword">) {
<br>&nbsp; if(</span><span class="default">is_null</span><span class="keyword">(</span><span class="default">$_proxy_name</span><span class="keyword">) || </span><span class="default">LOCAL_TEST</span><span class="keyword">){
<br>&nbsp; &nbsp; return </span><span class="default">fopen</span><span class="keyword">(</span><span class="default">$_url</span><span class="keyword">);
<br>&nbsp; }else{
<br>&nbsp; &nbsp; </span><span class="default">$proxy_fp </span><span class="keyword">= </span><span class="default">fsockopen</span><span class="keyword">(</span><span class="default">$_proxy_name</span><span class="keyword">, </span><span class="default">$_proxy_port</span><span class="keyword">);
<br>&nbsp; &nbsp; if (!</span><span class="default">$proxy_fp</span><span class="keyword">) return </span><span class="default">false</span><span class="keyword">;
<br>&nbsp; &nbsp; </span><span class="default">$host</span><span class="keyword">= </span><span class="default">substr</span><span class="keyword">(</span><span class="default">$_url</span><span class="keyword">, </span><span class="default">7</span><span class="keyword">);
<br>&nbsp; &nbsp; </span><span class="default">$host </span><span class="keyword">= </span><span class="default">substr</span><span class="keyword">(</span><span class="default">$bucket</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">strpos</span><span class="keyword">(</span><span class="default">$host</span><span class="keyword">, </span><span class="string">"/"</span><span class="keyword">));
<br>
<br>&nbsp; &nbsp; </span><span class="default">$request </span><span class="keyword">= </span><span class="string">"GET </span><span class="default">$_url</span><span class="string"> HTTP/1.0\r\nHost:</span><span class="default">$host</span><span class="string">\r\n\r\n"</span><span class="keyword">;
<br>
<br>&nbsp; &nbsp; </span><span class="default">fputs</span><span class="keyword">(</span><span class="default">$proxy_fp</span><span class="keyword">, </span><span class="default">$request</span><span class="keyword">);
<br>
<br>&nbsp; &nbsp; return </span><span class="default">$proxy_fp</span><span class="keyword">;
<br>&nbsp; }
<br>}
<br></span><span class="default">?&gt;</span>
</span>
</code></div>
  </div>
 </div>
  <div class="note" id="82805">  
  <a class="name">
  <strong class="user"><em>webmaster at myeshop dot fr</em></strong></a><div class="date" title="2008-04-26 07:40"><strong>6 years ago</strong></div>
  <div class="text" id="Hcom82805">
<div class="phpcode"><code><span class="html">
Also a small function useful for backup for example. It's a mixed between the fopen() and the mkdir() functions.
<br>
<br>This function opens a file but also make the path recursively where the file is contained. This is helpful for ending to finish with "No such file or directory in" errors
<br>
<br><span class="default">&lt;?php
<br></span><span class="keyword">function </span><span class="default">fopen_recursive</span><span class="keyword">(</span><span class="default">$path</span><span class="keyword">, </span><span class="default">$mode</span><span class="keyword">, </span><span class="default">$chmod</span><span class="keyword">=</span><span class="default">0755</span><span class="keyword">){
<br>&nbsp; </span><span class="default">preg_match</span><span class="keyword">(</span><span class="string">'`^(.+)/([a-zA-Z0-9]+\.[a-z]+)$`i'</span><span class="keyword">, </span><span class="default">$path</span><span class="keyword">, </span><span class="default">$matches</span><span class="keyword">);
<br>&nbsp; </span><span class="default">$directory </span><span class="keyword">= </span><span class="default">$matches</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">];
<br>&nbsp; </span><span class="default">$file </span><span class="keyword">= </span><span class="default">$matches</span><span class="keyword">[</span><span class="default">2</span><span class="keyword">];
<br>
<br>&nbsp; if (!</span><span class="default">is_dir</span><span class="keyword">(</span><span class="default">$directory</span><span class="keyword">)){
<br>&nbsp; &nbsp; if (!</span><span class="default">mkdir</span><span class="keyword">(</span><span class="default">$directory</span><span class="keyword">, </span><span class="default">$chmod</span><span class="keyword">, </span><span class="default">1</span><span class="keyword">)){
<br>&nbsp; &nbsp; return </span><span class="default">FALSE</span><span class="keyword">;
<br>&nbsp; &nbsp; }
<br>&nbsp; }
<br> return </span><span class="default">fopen </span><span class="keyword">(</span><span class="default">$path</span><span class="keyword">, </span><span class="default">$mode</span><span class="keyword">);
<br>}
<br></span><span class="default">?&gt;</span>
</span>
</code></div>
  </div>
 </div>
  <div class="note" id="80978">  
  <a class="name">
  <strong class="user"><em>sean downey</em></strong></a><div class="date" title="2008-02-09 12:23"><strong>6 years ago</strong></div>
  <div class="text" id="Hcom80978">
<div class="phpcode"><code><span class="html">
when using ssl / https on windows i would get the error:
<br>"Warning: fopen(https://example.com): failed to open stream: Invalid argument in someSpecialFile.php on line 4344534"
<br>
<br>This was because I did not have the extension "php_openssl.dll" enabled.
<br>
<br>So if you have the same problem, goto your php.ini file and enable it :)</span>
</code></div>
  </div>
 </div>
  <div class="note" id="78370">  
  <a class="name">
  <strong class="user"><em>info at NOSPAMPLEASE dot c-eagle dot com</em></strong></a><div class="date" title="2007-10-08 06:14"><strong>6 years ago</strong></div>
  <div class="text" id="Hcom78370">
<div class="phpcode"><code><span class="html">
If there is a file that´s excessively being rewritten by many different users, you´ll note that two almost-simultaneously accesses on that file could interfere with each other. For example if there´s a chat history containing only the last 25 chat lines. Now adding a line also means deleting the very first one. So while that whole writing is happening, another user might also add a line, reading the file, which, at this point, is incomplete, because it´s just being rewritten. The second user would then rewrite an incomplete file and add its line to it, meaning: you just got yourself some data loss!<br><br>If flock() was working at all, that might be the key to not let those interferences happen - but flock() mostly won´t work as expected (at least that´s my experience on any linux webserver I´ve tried), and writing own file-locking-functions comes with a lot of possible issues that would finally result in corrupted files. Even though it´s very unlikely, it´s not impossible and has happened to me already.<br><br>So I came up with another solution for the file-interference-problem:<br><br>1. A file that´s to be accessed will first be copied to a temp-file directory and its last filemtime() is being stored in a PHP-variable. The temp-file gets a random filename, ensuring no other process is able to interfere with this particular temp-file.<br>2. When the temp-file has been changed/rewritten/whatever, there´ll be a check whether the filemtime() of the original file has been changed since we copied it into our temp-directory.<br>2.1. If filemtime() is still the same, the temp-file will just be renamed/moved to the original filename, ensuring the original file is never in a temporary state - only the complete previous state or the complete new state.<br>2.2. But if filemtime() has been changed while our PHP-process wanted to change its file, the temp-file will just be deleted and our new PHP-fileclose-function will return a FALSE, enabling whatever called that function to do it again (ie. upto 5 times, until it returns TRUE).<br><br>These are the functions I´ve written for that purpose:<br><br><span class="default">&lt;?php<br>$dir_fileopen </span><span class="keyword">= </span><span class="string">"../AN/INTERNAL/DIRECTORY/fileopen"</span><span class="keyword">;<br><br>function </span><span class="default">randomid</span><span class="keyword">() {<br>&nbsp; &nbsp; return </span><span class="default">time</span><span class="keyword">().</span><span class="default">substr</span><span class="keyword">(</span><span class="default">md5</span><span class="keyword">(</span><span class="default">microtime</span><span class="keyword">()), </span><span class="default">0</span><span class="keyword">, </span><span class="default">rand</span><span class="keyword">(</span><span class="default">5</span><span class="keyword">, </span><span class="default">12</span><span class="keyword">));<br>}<br><br>function </span><span class="default">cfopen</span><span class="keyword">(</span><span class="default">$filename</span><span class="keyword">, </span><span class="default">$mode</span><span class="keyword">, </span><span class="default">$overwriteanyway </span><span class="keyword">= </span><span class="default">false</span><span class="keyword">) {<br>&nbsp; &nbsp; global </span><span class="default">$dir_fileopen</span><span class="keyword">;<br>&nbsp; &nbsp; </span><span class="default">clearstatcache</span><span class="keyword">();<br>&nbsp; &nbsp; do {<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$id </span><span class="keyword">= </span><span class="default">md5</span><span class="keyword">(</span><span class="default">randomid</span><span class="keyword">(</span><span class="default">rand</span><span class="keyword">(), </span><span class="default">TRUE</span><span class="keyword">));<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$tempfilename </span><span class="keyword">= </span><span class="default">$dir_fileopen</span><span class="keyword">.</span><span class="string">"/"</span><span class="keyword">.</span><span class="default">$id</span><span class="keyword">.</span><span class="default">md5</span><span class="keyword">(</span><span class="default">$filename</span><span class="keyword">);<br>&nbsp; &nbsp; } while(</span><span class="default">file_exists</span><span class="keyword">(</span><span class="default">$tempfilename</span><span class="keyword">));<br>&nbsp; &nbsp; if (</span><span class="default">file_exists</span><span class="keyword">(</span><span class="default">$filename</span><span class="keyword">)) {<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$newfile </span><span class="keyword">= </span><span class="default">false</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">copy</span><span class="keyword">(</span><span class="default">$filename</span><span class="keyword">, </span><span class="default">$tempfilename</span><span class="keyword">);<br>&nbsp; &nbsp; }else{<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$newfile </span><span class="keyword">= </span><span class="default">true</span><span class="keyword">;<br>&nbsp; &nbsp; }<br>&nbsp; &nbsp; </span><span class="default">$fp </span><span class="keyword">= </span><span class="default">fopen</span><span class="keyword">(</span><span class="default">$tempfilename</span><span class="keyword">, </span><span class="default">$mode</span><span class="keyword">);<br>&nbsp; &nbsp; return </span><span class="default">$fp </span><span class="keyword">? array(</span><span class="default">$fp</span><span class="keyword">, </span><span class="default">$filename</span><span class="keyword">, </span><span class="default">$id</span><span class="keyword">, @</span><span class="default">filemtime</span><span class="keyword">(</span><span class="default">$filename</span><span class="keyword">), </span><span class="default">$newfile</span><span class="keyword">, </span><span class="default">$overwriteanyway</span><span class="keyword">) : </span><span class="default">false</span><span class="keyword">;<br>}<br><br>function </span><span class="default">cfwrite</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">,</span><span class="default">$string</span><span class="keyword">) { return </span><span class="default">fwrite</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">], </span><span class="default">$string</span><span class="keyword">); }<br><br>function </span><span class="default">cfclose</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">, </span><span class="default">$debug </span><span class="keyword">= </span><span class="string">"off"</span><span class="keyword">) {<br>&nbsp; &nbsp; global </span><span class="default">$dir_fileopen</span><span class="keyword">;<br>&nbsp; &nbsp; </span><span class="default">$success </span><span class="keyword">= </span><span class="default">fclose</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">]);<br>&nbsp; &nbsp; </span><span class="default">clearstatcache</span><span class="keyword">();<br>&nbsp; &nbsp; </span><span class="default">$tempfilename </span><span class="keyword">= </span><span class="default">$dir_fileopen</span><span class="keyword">.</span><span class="string">"/"</span><span class="keyword">.</span><span class="default">$fp</span><span class="keyword">[</span><span class="default">2</span><span class="keyword">].</span><span class="default">md5</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">]);<br>&nbsp; &nbsp; if ((@</span><span class="default">filemtime</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">]) == </span><span class="default">$fp</span><span class="keyword">[</span><span class="default">3</span><span class="keyword">]) or (</span><span class="default">$fp</span><span class="keyword">[</span><span class="default">4</span><span class="keyword">]==</span><span class="default">true </span><span class="keyword">and !</span><span class="default">file_exists</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">])) or </span><span class="default">$fp</span><span class="keyword">[</span><span class="default">5</span><span class="keyword">]==</span><span class="default">true</span><span class="keyword">) {<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">rename</span><span class="keyword">(</span><span class="default">$tempfilename</span><span class="keyword">, </span><span class="default">$fp</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">]);<br>&nbsp; &nbsp; }else{<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">unlink</span><span class="keyword">(</span><span class="default">$tempfilename</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; if (</span><span class="default">$debug </span><span class="keyword">!= </span><span class="string">"off"</span><span class="keyword">) echo </span><span class="string">"While writing, another process accessed </span><span class="default">$fp</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">]</span><span class="string">. To ensure file-integrity, your changes were rejected."</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$success </span><span class="keyword">= </span><span class="default">false</span><span class="keyword">;<br>&nbsp; &nbsp; }<br>&nbsp; &nbsp; return </span><span class="default">$success</span><span class="keyword">;<br>}<br></span><span class="default">?&gt;<br></span><br>$overwriteanyway, one of the parameters for cfopen(), means: If cfclose() is used and the original file has changed, this script won´t care and still overwrite the original file with the new temp file. Anyway there won´t be any writing-interference between two PHP processes, assuming there can be no absolute simultaneousness between two (or more) processes.</span>
</code></div>
  </div>
 </div>
  <div class="note" id="56963">  
  <a class="name">
  <strong class="user"><em>nefertari at nefertari dot be</em></strong></a><div class="date" title="2005-09-20 05:47"><strong>8 years ago</strong></div>
  <div class="text" id="Hcom56963">
<div class="phpcode"><code><span class="html">
Important note:<br><br>You have always to use the real path name for a file with the command fopen [for example: fopen($filename, 'w')], never use a symbolic link, it will not work (unable to open $filename).</span>
</code></div>
  </div>
 </div>
  <div class="note" id="56551">  
  <a class="name">
  <strong class="user"><em>durwood at speakeasy dot NOSPAM dot net</em></strong></a><div class="date" title="2005-09-06 11:43"><strong>8 years ago</strong></div>
  <div class="text" id="Hcom56551">
<div class="phpcode"><code><span class="html">
I couldn't for the life of me get a certain php script working when i moved my server to a new Fedora 4 installation. The problem was that fopen() was failing when trying to access a file as a URL through apache -- even though it worked fine when run from the shell and even though the file was readily readable from any browser.&nbsp; After trying to place blame on Apache, RedHat, and even my cat and dog, I finally ran across this bug report on Redhat's website:<br><br>https://bugzilla.redhat.com/bugzilla/show_bug.cgi?id=164700<br><br>Basically the problem was SELinux (which I knew nothing about) -- you have to run the following command in order for SELinux to allow php to open a web file:<br><br>/usr/sbin/setsebool httpd_can_network_connect=1<br><br>To make the change permanent, run it with the -P option:<br><br>/usr/sbin/setsebool -P httpd_can_network_connect=1<br><br>Hope this helps others out -- it sure took me a long time to track down the problem.</span>
</code></div>
  </div>
 </div>
  <div class="note" id="47224">  
  <a class="name">
  <strong class="user"><em>pflaume dot NOSPAM at NOSPAM dot gmx dot de</em></strong></a><div class="date" title="2004-11-07 02:31"><strong>9 years ago</strong></div>
  <div class="text" id="Hcom47224">
<div class="phpcode"><code><span class="html">
fopen() and PROXY<br><br>I wondered why there is no possibility to use fopen() through a proxy in php. The solution posted above did not work for me.<br><br>This little function gets http through a given proxy:<br><br><span class="default">&lt;?php<br></span><span class="keyword">function </span><span class="default">proxy_url</span><span class="keyword">(</span><span class="default">$proxy_url</span><span class="keyword">)<br>{<br>&nbsp; &nbsp; </span><span class="default">$proxy_name </span><span class="keyword">= </span><span class="string">'127.0.0.1'</span><span class="keyword">;<br>&nbsp; &nbsp; </span><span class="default">$proxy_port </span><span class="keyword">= </span><span class="default">4001</span><span class="keyword">;<br>&nbsp; &nbsp; </span><span class="default">$proxy_cont </span><span class="keyword">= </span><span class="string">''</span><span class="keyword">;<br><br>&nbsp; &nbsp; </span><span class="default">$proxy_fp </span><span class="keyword">= </span><span class="default">fsockopen</span><span class="keyword">(</span><span class="default">$proxy_name</span><span class="keyword">, </span><span class="default">$proxy_port</span><span class="keyword">);<br>&nbsp; &nbsp; if (!</span><span class="default">$proxy_fp</span><span class="keyword">)&nbsp; &nbsp; {return </span><span class="default">false</span><span class="keyword">;}<br>&nbsp; &nbsp; </span><span class="default">fputs</span><span class="keyword">(</span><span class="default">$proxy_fp</span><span class="keyword">, </span><span class="string">"GET </span><span class="default">$proxy_url</span><span class="string"> HTTP/1.0\r\nHost: </span><span class="default">$proxy_name</span><span class="string">\r\n\r\n"</span><span class="keyword">);<br>&nbsp; &nbsp; while(!</span><span class="default">feof</span><span class="keyword">(</span><span class="default">$proxy_fp</span><span class="keyword">)) {</span><span class="default">$proxy_cont </span><span class="keyword">.= </span><span class="default">fread</span><span class="keyword">(</span><span class="default">$proxy_fp</span><span class="keyword">,</span><span class="default">4096</span><span class="keyword">);}<br>&nbsp; &nbsp; </span><span class="default">fclose</span><span class="keyword">(</span><span class="default">$proxy_fp</span><span class="keyword">);<br>&nbsp; &nbsp; </span><span class="default">$proxy_cont </span><span class="keyword">= </span><span class="default">substr</span><span class="keyword">(</span><span class="default">$proxy_cont</span><span class="keyword">, </span><span class="default">strpos</span><span class="keyword">(</span><span class="default">$proxy_cont</span><span class="keyword">,</span><span class="string">"\r\n\r\n"</span><span class="keyword">)+</span><span class="default">4</span><span class="keyword">);<br>&nbsp; &nbsp; return </span><span class="default">$proxy_cont</span><span class="keyword">;<br>} <br></span><span class="default">?&gt;</span>
</span>
</code></div>
  </div>
 </div>
  <div class="note" id="39605">  
  <a class="name">
  <strong class="user"><em>richard dot quadling at carval dot co dot uk</em></strong></a><div class="date" title="2004-02-04 05:04"><strong>10 years ago</strong></div>
  <div class="text" id="Hcom39605">
<div class="phpcode"><code><span class="html">
The issue involving some sites requiring a valid user-agent string when using fopen can easily be resolved by setting the user_agent string in the PHP.INI file.<br><br>If you do not have access to the PHP.INI file, then the use of <br><br>ini_set('user_agent','Mozilla: (compatible; Windows XP)');<br><br>should also work.<br><br>The actual agent string is up to you. If you want to identify to the sites that you are using PHP ...<br><br>ini_set('user_agent','PHP');<br><br>would do.<br><br>Regards,<br><br>Richard Quadling.</span>
</code></div>
  </div>
 </div>
  <div class="note" id="37791">  
  <a class="name">
  <strong class="user"><em>sergiopaternoster at tiscali dot it</em></strong></a><div class="date" title="2003-11-27 05:11"><strong>10 years ago</strong></div>
  <div class="text" id="Hcom37791">
<div class="phpcode"><code><span class="html">
If you want to open large files (more than 2GB) that's what I did and it works: you should recompile your php with the CFLAGS="-D_FILE_OFFSET_BITS=64" ./configure etc... This tells to your compiler (I tested only gcc on PHP-4.3.4 binary on Linux and Solaris) to make the PHP parser binary large file aware. This way fopen() will not give you the "Value too large for defined data type" error message.<br>God bless PHP<br>ciao<br>Sergio Paternoster</span>
</code></div>
  </div>
 </div>
  <div class="note" id="33611">  
  <a class="name">
  <strong class="user"><em>unshift at yahoo dot com</em></strong></a><div class="date" title="2003-07-01 04:58"><strong>11 years ago</strong></div>
  <div class="text" id="Hcom33611">
<div class="phpcode"><code><span class="html">
It seems that fopen() errors when you attempt opening a url starting with HTTP:// as opposed to <a rel="nofollow" target="_blank">http://</a> - it is case sensitive.&nbsp; In 4.3.1 anyway..."HTTP://", by not matching "<a rel="nofollow" target="_blank">http://</a>" will tell the wrapper to look locally.&nbsp; From the looks of the source, the same goes for HTTPS vs https, etc.</span>
</code></div>
  </div>
 </div>
  <div class="note" id="32741">  
  <a class="name">
  <strong class="user"><em>Jhilton a at t nurv dot us</em></strong></a><div class="date" title="2003-06-05 12:54"><strong>11 years ago</strong></div>
  <div class="text" id="Hcom32741">
<div class="phpcode"><code><span class="html">
Quick tip. If using fopen to make http requests that contain a querystring, it is advised that you urlencode() your values, else characters like @ can make fopen (or whatever wrapper it is using) throw an error.</span>
</code></div>
  </div>
 </div>
  <div class="note" id="30024">  
  <a class="name"><strong class="user"><em>Anonymous</em></strong></a><div class="date" title="2003-03-04 08:49"><strong>11 years ago</strong></div>
  <div class="text" id="Hcom30024">
<div class="phpcode"><code><span class="html">
To overwrite a file with a new content without deleting it, and without changing the owner or access rights, it's best to not use:
<br>
<br><span class="default">&lt;?php
<br>$file </span><span class="keyword">= </span><span class="default">fopen</span><span class="keyword">(</span><span class="default">$filename</span><span class="keyword">, </span><span class="string">'r+b'</span><span class="keyword">); </span><span class="comment">// binary update mode
<br>//...
<br></span><span class="default">ftruncate</span><span class="keyword">(</span><span class="default">$file</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">);
<br></span><span class="default">fwrite</span><span class="keyword">(</span><span class="default">$file</span><span class="keyword">, </span><span class="default">$my_stuff</span><span class="keyword">);
<br></span><span class="comment">//...
<br></span><span class="default">fclose</span><span class="keyword">(</span><span class="default">$file</span><span class="keyword">);
<br></span><span class="default">?&gt;
<br></span>
<br>but instead the faster one:
<br>
<br><span class="default">&lt;?php
<br>$file </span><span class="keyword">= </span><span class="default">fopen</span><span class="keyword">(</span><span class="default">$filename</span><span class="keyword">, </span><span class="string">'r+b); // binary update mode
<br>//...
<br>rewind($file);
<br>fwrite($file, $my_stuff);
<br>fflush($file);
<br>ftruncate($file, ftell($file));
<br>//...
<br>fclose($file);
<br>?&gt;
<br>
<br>The reason is that truncating a file at size 0 forces the OS to deallocate all storage clusters used by the file, before you write your content which will be reallocated on disk.
<br>
<br>The second code simply overwrites the existing content where it is already located on disk, and truncates any remaining bytes that may exist (if the new content is shorter than the old content). The "r+b" mode allows access for both read and write: the file can be kept opened after reading it and before rewriting the modified content.
<br>
<br>It'</span><span class="default">s particularly useful </span><span class="keyword">for </span><span class="default">files that are accessed often </span><span class="keyword">or </span><span class="default">have a size larger than a few kilobytes</span><span class="keyword">, as </span><span class="default">it saves lots of system I</span><span class="keyword">/</span><span class="default">O</span><span class="keyword">, and </span><span class="default">also limits the filesystem fragmentation </span><span class="keyword">if </span><span class="default">the updated file is quite large</span><span class="keyword">.
<br>
<br>And </span><span class="default">this method also works </span><span class="keyword">if </span><span class="default">the file is locked exclusively once opened </span><span class="keyword">(</span><span class="default">but I would rather recommend using another </span><span class="keyword">empty </span><span class="default">file </span><span class="keyword">for </span><span class="default">locking purpose</span><span class="keyword">, </span><span class="default">opened with </span><span class="string">"a+" </span><span class="default">access mode</span><span class="keyword">, </span><span class="default">in </span><span class="string">"/var/lock/yourapp/*" </span><span class="keyword">or </span><span class="default">other fast filesystems where filelocks are easily monitored </span><span class="keyword">and </span><span class="default">where the webserver running PHP is allowed to create </span><span class="keyword">and </span><span class="default">update lock files</span><span class="keyword">, and </span><span class="default">not forgetting to close the lock file after closing the content file</span><span class="keyword">).</span>
</span>
</code></div>
  </div>
 </div>
  <div class="note" id="16296">  
  <a class="name">
  <strong class="user"><em>php at themastermind1 dot com</em></strong></a><div class="date" title="2001-10-23 10:37"><strong>12 years ago</strong></div>
  <div class="text" id="Hcom16296">
<div class="phpcode"><code><span class="html">
I have found that I can do fopen("COM1:", "r+"); to open the comport in windows. You have to make sure the comport isn't already open or you will get a permission denied. 
<br>
<br>I am still playing around with this but you have to somehow flush what you send to the comport if you are trying to communicate realtime with a device.</span>
</code></div>
  </div>
 </div>
  <div class="note" id="14426">  
  <a class="name">
  <strong class="user"><em>keithm at aoeex dot NOSPAM dot com</em></strong></a><div class="date" title="2001-07-31 05:19"><strong>13 years ago</strong></div>
  <div class="text" id="Hcom14426">
<div class="phpcode"><code><span class="html">
I was working on a consol script for win32 and noticed a few things about it.&nbsp; On win32 it appears that you can't re-open the input stream for reading, but rather you have to open it once, and read from there on.&nbsp; Also, i don't know if this is a bug or what but it appears that fgets() reads until the new line anyway.&nbsp; The number of characters returned is ok, but it will not halt reading and return to the script.&nbsp; I don't know of a work around for this right now, but i'll keep working on it.
<br>
<br>This is some code to work around the close and re-open of stdin.
<br>
<br><span class="default">&lt;?php
<br></span><span class="keyword">function </span><span class="default">read</span><span class="keyword">(</span><span class="default">$length</span><span class="keyword">=</span><span class="string">'255'</span><span class="keyword">){
<br>&nbsp; &nbsp; if (!isset(</span><span class="default">$GLOBALS</span><span class="keyword">[</span><span class="string">'StdinPointer'</span><span class="keyword">])){
<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$GLOBALS</span><span class="keyword">[</span><span class="string">'StdinPointer'</span><span class="keyword">]=</span><span class="default">fopen</span><span class="keyword">(</span><span class="string">"php://stdin"</span><span class="keyword">,</span><span class="string">"r"</span><span class="keyword">);
<br>&nbsp; &nbsp; }
<br>&nbsp; &nbsp; </span><span class="default">$line</span><span class="keyword">=</span><span class="default">fgets</span><span class="keyword">(</span><span class="default">$GLOBALS</span><span class="keyword">[</span><span class="string">'StdinPointer'</span><span class="keyword">],</span><span class="default">$length</span><span class="keyword">);
<br>&nbsp; &nbsp; return </span><span class="default">trim</span><span class="keyword">(</span><span class="default">$line</span><span class="keyword">);
<br>}
<br>echo </span><span class="string">"Enter your name: "</span><span class="keyword">;
<br></span><span class="default">$name</span><span class="keyword">=</span><span class="default">read</span><span class="keyword">();
<br>echo </span><span class="string">"Enter your age: "</span><span class="keyword">;
<br></span><span class="default">$age</span><span class="keyword">=</span><span class="default">read</span><span class="keyword">();
<br>echo </span><span class="string">"Hi </span><span class="default">$name</span><span class="string">, Isn't it Great to be </span><span class="default">$age</span><span class="string"> years old?"</span><span class="keyword">;
<br>@</span><span class="default">fclose</span><span class="keyword">(</span><span class="default">$StdinPointer</span><span class="keyword">);
<br></span><span class="default">?&gt;</span>
</span>
</code></div>
  </div>
 </div>
  <div class="note" id="2224">  
  <a class="name">
  <strong class="user"><em>icon at mricon dot com</em></strong></a><div class="date" title="1999-11-09 02:44"><strong>14 years ago</strong></div>
  <div class="text" id="Hcom2224">
<div class="phpcode"><code><span class="html">
If you're running PHP as apache module, it will always write files as "nobody", "www", "httpd", (or whatever user your webserver runs as) unless you specify a different user/group in httpd.conf, or compile apache with suexec support.
<br>However, if you run PHP as a CGI wrapper, you may setuid the PHP executable to whatever user you wish (*severe* security issues apply). If you really want to be able to su to other user, I recommend compiling with suexec support.
<br>AFAIK, PHP can't NOT use SuEXEC if apache does. If PHP is configured as an apache module it will act as whatever user the apache is. If apache SuEXEC's to otheruser:othergroup (e.g. root:root), that's what PHP will write files as, because it acts as a part of apache code. I suggest you double-check your SuEXEC configuration and settings. Note: you can't su to another user within the PHP code -- it has to be an apache directive, either through &lt;VirtualHost&gt;, or through .htaccess. Also note: I'm not sure how it all works (if it works at all) on Win32 platforms.
<br>Check www.apache.org to see how it's done.</span>
</code></div>
  </div>
 </div>
  <div class="note" id="37553">  
  <a class="name">
  <strong class="user"><em>dan at cleandns dot com</em></strong></a><div class="date" title="2003-11-19 11:15"><strong>10 years ago</strong></div>
  <div class="text" id="Hcom37553">
<div class="phpcode"><code><span class="html">
<span class="default">&lt;?php<br></span><span class="comment">#going to update last users counter script since<br>#aborting a write because a file is locked is not correct.<br><br></span><span class="default">$counter_file </span><span class="keyword">= </span><span class="string">'/tmp/counter.txt'</span><span class="keyword">;<br></span><span class="default">clearstatcache</span><span class="keyword">();<br></span><span class="default">ignore_user_abort</span><span class="keyword">(</span><span class="default">true</span><span class="keyword">);&nbsp; &nbsp;&nbsp; </span><span class="comment">## prevent refresh from aborting file operations and hosing file<br></span><span class="keyword">if (</span><span class="default">file_exists</span><span class="keyword">(</span><span class="default">$counter_file</span><span class="keyword">)) {<br>&nbsp;&nbsp; </span><span class="default">$fh </span><span class="keyword">= </span><span class="default">fopen</span><span class="keyword">(</span><span class="default">$counter_file</span><span class="keyword">, </span><span class="string">'r+'</span><span class="keyword">);<br>&nbsp; &nbsp; while(</span><span class="default">1</span><span class="keyword">) {<br>&nbsp; &nbsp; &nbsp; if (</span><span class="default">flock</span><span class="keyword">(</span><span class="default">$fh</span><span class="keyword">, </span><span class="default">LOCK_EX</span><span class="keyword">)) {<br>&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">#$buffer = chop(fgets($fh, 2));<br>&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$buffer </span><span class="keyword">= </span><span class="default">chop</span><span class="keyword">(</span><span class="default">fread</span><span class="keyword">(</span><span class="default">$fh</span><span class="keyword">, </span><span class="default">filesize</span><span class="keyword">(</span><span class="default">$counter_file</span><span class="keyword">)));<br>&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$buffer</span><span class="keyword">++;<br>&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">rewind</span><span class="keyword">(</span><span class="default">$fh</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">fwrite</span><span class="keyword">(</span><span class="default">$fh</span><span class="keyword">, </span><span class="default">$buffer</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">fflush</span><span class="keyword">(</span><span class="default">$fh</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">ftruncate</span><span class="keyword">(</span><span class="default">$fh</span><span class="keyword">, </span><span class="default">ftell</span><span class="keyword">(</span><span class="default">$fh</span><span class="keyword">));&nbsp; &nbsp;&nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">flock</span><span class="keyword">(</span><span class="default">$fh</span><span class="keyword">, </span><span class="default">LOCK_UN</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; break;<br>&nbsp; &nbsp; &nbsp; }<br>&nbsp;&nbsp; }<br>}<br>else {<br>&nbsp;&nbsp; </span><span class="default">$fh </span><span class="keyword">= </span><span class="default">fopen</span><span class="keyword">(</span><span class="default">$counter_file</span><span class="keyword">, </span><span class="string">'w+'</span><span class="keyword">);<br>&nbsp;&nbsp; </span><span class="default">fwrite</span><span class="keyword">(</span><span class="default">$fh</span><span class="keyword">, </span><span class="string">"1"</span><span class="keyword">);<br>&nbsp;&nbsp; </span><span class="default">$buffer</span><span class="keyword">=</span><span class="string">"1"</span><span class="keyword">;<br>}<br></span><span class="default">fclose</span><span class="keyword">(</span><span class="default">$fh</span><span class="keyword">);<br><br>print </span><span class="string">"Count is </span><span class="default">$buffer</span><span class="string">"</span><span class="keyword">;<br><br></span><span class="default">?&gt;</span>
</span>
</code></div>
  </div>
 </div>
  <div class="note" id="105465">  
  <a class="name">
  <strong class="user"><em>merye at web-graphique dot com</em></strong></a><div class="date" title="2011-08-19 01:10"><strong>3 years ago</strong></div>
  <div class="text" id="Hcom105465">
<div class="phpcode"><code><span class="html">
I had to switch from relative paths to full paths when my web host recently migrated the server onto their hosting cloud.&nbsp; This used to work for me:<br><br><span class="default">&lt;?php<br>$fplog </span><span class="keyword">= </span><span class="default">fopen</span><span class="keyword">(</span><span class="string">'ipn.log'</span><span class="keyword">,</span><span class="string">'a'</span><span class="keyword">);<br></span><span class="default">?&gt;<br></span><br>After the migration, however, I received the following error message:<br><br>Warning: fopen(ipn.log) [function.fopen]: failed to open stream: Permission denied in D:\home\server_name\log_test.php on line 21<br><br>I had to change the code to the following to get it to work:<br><br><span class="default">&lt;?php<br>$logfile </span><span class="keyword">= </span><span class="default">$_SERVER</span><span class="keyword">[</span><span class="string">'DOCUMENT_ROOT'</span><span class="keyword">].</span><span class="string">'\\ipn.log'</span><span class="keyword">;<br></span><span class="default">$fplog </span><span class="keyword">= </span><span class="default">fopen</span><span class="keyword">(</span><span class="default">$logfile</span><span class="keyword">,</span><span class="string">'a'</span><span class="keyword">);<br></span><span class="default">?&gt;</span>
</span>
</code></div>
  </div>
 </div>
  <div class="note" id="99176">  
  <a class="name">
  <strong class="user"><em>eyrie88 at gmail dot com</em></strong></a><div class="date" title="2010-07-31 07:39"><strong>4 years ago</strong></div>
  <div class="text" id="Hcom99176">
<div class="phpcode"><code><span class="html">
Be aware that fopen($url) also respects HTTP status headers. If the URL responds with a 1xx, 4xx, or 5xx status code, you will get a "failed to open stream: HTTP request failed!", followed by the HTTP status response. Same goes for file_get_contents($url)...</span>
</code></div>
  </div>
 </div>
  <div class="note" id="95455">  
  <a class="name">
  <strong class="user"><em>rene</em></strong></a><div class="date" title="2010-01-04 02:43"><strong>4 years ago</strong></div>
  <div class="text" id="Hcom95455">
<div class="phpcode"><code><span class="html">
if fopen() throws a E_WARNING "failed to open stream: HTTP request failed!" at you when opening a valid URL that you know returns data, i advise you to do the following before calling fopen($url,'r'):
<br>
<br><span class="default">&lt;?php
<br>ini_set </span><span class="keyword">(</span><span class="string">'user_agent'</span><span class="keyword">, </span><span class="default">$_SERVER</span><span class="keyword">[</span><span class="string">'HTTP_USER_AGENT'</span><span class="keyword">]);
<br></span><span class="default">?&gt;
<br></span>
<br>or anyways, set that 'user_agent' with ini_set() to something valid.
<br>
<br>thanks, pollita|at|php.net @ <a rel="nofollow" target="_blank">http://bugs.php.net/bug.php?id=22937#c64196</a> , for the clue to this</span>
</code></div>
  </div>
 </div>
  <div class="note" id="113038">  
  <a class="name">
  <strong class="user"><em>contact at sergeylukin dot com</em></strong></a><div class="date" title="2013-08-21 11:53"><strong>1 year ago</strong></div>
  <div class="text" id="Hcom113038">
<div class="phpcode"><code><span class="html">
Here is how you could modify file's contents by only opening it once in "r+" mode:<br><br><span class="default">&lt;?php<br>$filePath </span><span class="keyword">= </span><span class="string">'/path/to/file'</span><span class="keyword">;<br>if( !@</span><span class="default">$fh </span><span class="keyword">= </span><span class="default">fopen</span><span class="keyword">(</span><span class="default">$filePath</span><span class="keyword">, </span><span class="string">'r+'</span><span class="keyword">) ) {<br>&nbsp; die(</span><span class="string">"Could not open </span><span class="default">$filePath</span><span class="string"> in READ+WRITE mode"</span><span class="keyword">);<br>}<br><br></span><span class="comment">// Extract contents<br></span><span class="default">$contents </span><span class="keyword">= </span><span class="default">fread</span><span class="keyword">(</span><span class="default">$fh</span><span class="keyword">, </span><span class="default">filesize</span><span class="keyword">(</span><span class="default">$filePath</span><span class="keyword">));<br><br></span><span class="comment">// ..modify $contents in any way you need..<br><br>// Truncate file (important to move the pointer first)<br></span><span class="default">fseek</span><span class="keyword">(</span><span class="default">$fh</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">);<br></span><span class="default">ftruncate</span><span class="keyword">(</span><span class="default">$fh</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">);<br><br></span><span class="comment">// Write<br></span><span class="default">fwrite</span><span class="keyword">(</span><span class="default">$fh</span><span class="keyword">, </span><span class="default">$contents</span><span class="keyword">);<br><br></span><span class="default">fclose</span><span class="keyword">(</span><span class="default">$fh</span><span class="keyword">);<br></span><span class="default">?&gt;</span>
</span>
</code></div>
  </div>
 </div>
  <div class="note" id="81325">  
  <a class="name">
  <strong class="user"><em>jphansen at uga dot edu</em></strong></a><div class="date" title="2008-02-22 07:04"><strong>6 years ago</strong></div>
  <div class="text" id="Hcom81325">
<div class="phpcode"><code><span class="html">
If you open a file with r+ and execute an fwrite(), writing less to the file than what it originally was, it will result in the difference being padded with the end of the file from the previous end of the file. Example:
<br>
<br><span class="default">&lt;?php
<br></span><span class="comment">// Open file for read and string modification
<br></span><span class="default">$file </span><span class="keyword">= </span><span class="string">"/test"</span><span class="keyword">;
<br></span><span class="default">$fh </span><span class="keyword">= </span><span class="default">fopen</span><span class="keyword">(</span><span class="default">$file</span><span class="keyword">, </span><span class="string">'r+'</span><span class="keyword">);
<br></span><span class="default">$contents </span><span class="keyword">= </span><span class="default">fread</span><span class="keyword">(</span><span class="default">$fh</span><span class="keyword">, </span><span class="default">filesize</span><span class="keyword">(</span><span class="default">$file</span><span class="keyword">));
<br></span><span class="default">$new_contents </span><span class="keyword">= </span><span class="default">str_replace</span><span class="keyword">(</span><span class="string">"hello world"</span><span class="keyword">, </span><span class="string">"hello"</span><span class="keyword">, </span><span class="default">$contents</span><span class="keyword">);
<br></span><span class="default">fclose</span><span class="keyword">(</span><span class="default">$fh</span><span class="keyword">);
<br>
<br></span><span class="comment">// Open file to write
<br></span><span class="default">$fh </span><span class="keyword">= </span><span class="default">fopen</span><span class="keyword">(</span><span class="default">$file</span><span class="keyword">, </span><span class="string">'r+'</span><span class="keyword">);
<br></span><span class="default">fwrite</span><span class="keyword">(</span><span class="default">$fh</span><span class="keyword">, </span><span class="default">$new_contents</span><span class="keyword">);
<br></span><span class="default">fclose</span><span class="keyword">(</span><span class="default">$fh</span><span class="keyword">);
<br></span><span class="default">?&gt;
<br></span>
<br>If the end of the file was "abcdefghij", you will notice that the difference in "hello world" and "hello", 6 characters, will be appended to the file, resulting in the new ending: "efghij". To obviate this, fopen() with +w instead, which truncates the file to zero length.</span>
</code></div>
  </div>
 </div>
  <div class="note" id="111831">  
  <a class="name">
  <strong class="user"><em>simon dot riget at gmail dot com</em></strong></a><div class="date" title="2013-04-02 09:41"><strong>1 year ago</strong></div>
  <div class="text" id="Hcom111831">
<div class="phpcode"><code><span class="html">
The following is an&nbsp; example of file locking used in a function to share an array between processes.<br>In this example the function reads the array, possibly remove stuff like spend semaphores and insert new stuff to share.<br>The file gets locked for writing thus making sure that two processes doesn't inadvertently delete each others data.<br><br>The function can be called multiple times during a script, which becomes increasingly important if you write HTML5 Server Sent Events and websockets apps, since the script dose not end when the page are loaded. (there are other issues with that like garbage collection and memory leaks)<br>Using the “c” mode of fopen, removes the (remote) change of a race condition to the file lock.<br><br>Be aware that the function filesize() is not working correctly when files are in cash memory. You could flush the cash or in this case, since the file size of IPC are neglectable, just give a very large number as length parameter to fread.<br><br><span class="default">&lt;?php<br></span><span class="keyword">function </span><span class="default">ipc</span><span class="keyword">(</span><span class="default">$new_record</span><span class="keyword">=</span><span class="string">""</span><span class="keyword">){<br>&nbsp; </span><span class="default">$update</span><span class="keyword">=</span><span class="default">false</span><span class="keyword">;<br><br>&nbsp; </span><span class="comment">// Open file with locking<br>&nbsp; </span><span class="default">$handle</span><span class="keyword">=</span><span class="default">fopen</span><span class="keyword">(</span><span class="string">"example.dat"</span><span class="keyword">,</span><span class="string">"c+"</span><span class="keyword">);<br>&nbsp; <br>&nbsp; </span><span class="comment">// Lock the file for writing<br>&nbsp; </span><span class="default">flock</span><span class="keyword">(</span><span class="default">$handle</span><span class="keyword">,</span><span class="default">LOCK_EX</span><span class="keyword">);<br><br>&nbsp; </span><span class="comment">// Get file size. <br>&nbsp; // you can either fluch the file cash to get an acurate number<br>&nbsp; // clearstatcache();<br>&nbsp; // Or use a large number&nbsp; &nbsp; <br><br>&nbsp; // Load event file into array<br>&nbsp; </span><span class="default">$contents</span><span class="keyword">=</span><span class="default">fread</span><span class="keyword">(</span><span class="default">$handle</span><span class="keyword">,</span><span class="default">10000000</span><span class="keyword">);<br><br>&nbsp; </span><span class="default">$ipc_array</span><span class="keyword">=</span><span class="default">json_decode</span><span class="keyword">(</span><span class="default">$contents</span><span class="keyword">,</span><span class="default">true</span><span class="keyword">);<br><br>&nbsp; </span><span class="comment">// Clean out old stuff<br>&nbsp; </span><span class="keyword">if(</span><span class="default">is_array</span><span class="keyword">(</span><span class="default">$ipc_array</span><span class="keyword">)){<br>&nbsp; &nbsp; </span><span class="default">$timeout</span><span class="keyword">=</span><span class="default">time</span><span class="keyword">()-</span><span class="default">60</span><span class="keyword">;&nbsp; <br>&nbsp; &nbsp; foreach(</span><span class="default">$ipc_array </span><span class="keyword">as </span><span class="default">$key</span><span class="keyword">=&gt;</span><span class="default">$record</span><span class="keyword">){<br>&nbsp; &nbsp; &nbsp; </span><span class="comment">// eg remove spend semaphores or timed out messages<br>&nbsp; &nbsp; &nbsp; </span><span class="keyword">if( </span><span class="default">$record</span><span class="keyword">[</span><span class="string">'time'</span><span class="keyword">] &lt; </span><span class="default">$timeout </span><span class="keyword">){<br>&nbsp; &nbsp; &nbsp; &nbsp; unset(</span><span class="default">$ipc_array</span><span class="keyword">[</span><span class="default">$key</span><span class="keyword">]);<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$update</span><span class="keyword">=</span><span class="default">true</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; }<br>&nbsp; &nbsp; }<br>&nbsp; }<br><br>&nbsp; </span><span class="comment">// Add new message<br>&nbsp; </span><span class="keyword">if(</span><span class="default">is_array</span><span class="keyword">(</span><span class="default">$new_record</span><span class="keyword">)){<br>&nbsp; &nbsp; </span><span class="default">$new_record</span><span class="keyword">[</span><span class="string">'time'</span><span class="keyword">]=</span><span class="default">time</span><span class="keyword">();<br>&nbsp; &nbsp; </span><span class="default">$ipc_array</span><span class="keyword">[]=</span><span class="default">$new_record</span><span class="keyword">;<br>&nbsp; &nbsp; </span><span class="default">$update</span><span class="keyword">=</span><span class="default">true</span><span class="keyword">;<br>&nbsp; }<br><br>&nbsp; </span><span class="comment">// Write file and end<br>&nbsp; </span><span class="keyword">if(</span><span class="default">$update</span><span class="keyword">){<br>&nbsp; &nbsp; </span><span class="comment">// Overwrite the old data<br>&nbsp; &nbsp; </span><span class="default">ftruncate</span><span class="keyword">(</span><span class="default">$handle</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">);<br>&nbsp; &nbsp; </span><span class="default">rewind</span><span class="keyword">(</span><span class="default">$handle</span><span class="keyword">);<br>&nbsp; <br>&nbsp; &nbsp; </span><span class="comment">// Write the new array to file<br>&nbsp; &nbsp; </span><span class="default">fwrite</span><span class="keyword">(</span><span class="default">$handle</span><span class="keyword">,</span><span class="default">json_encode</span><span class="keyword">(</span><span class="default">$ipc_array</span><span class="keyword">,</span><span class="default">JSON_NUMERIC_CHECK</span><span class="keyword">));<br>&nbsp; }<br><br>&nbsp; </span><span class="comment">// Unlock the file - you have to do it! it doesn't happen on fclose<br>&nbsp; </span><span class="default">flock</span><span class="keyword">(</span><span class="default">$handle</span><span class="keyword">,</span><span class="default">LOCK_UN</span><span class="keyword">);<br><br>&nbsp; </span><span class="comment">// Close the file&nbsp; &nbsp; &nbsp; <br>&nbsp; </span><span class="default">fclose</span><span class="keyword">(</span><span class="default">$handle</span><span class="keyword">);<br><br>&nbsp; return </span><span class="default">$ipc_array</span><span class="keyword">;<br>}<br><br></span><span class="comment">// Read messages<br></span><span class="default">$ipc</span><span class="keyword">=</span><span class="default">ipc</span><span class="keyword">();<br><br></span><span class="comment">// Show messages<br></span><span class="keyword">foreach( </span><span class="default">$ipc </span><span class="keyword">as </span><span class="default">$record</span><span class="keyword">)<br>&nbsp; echo </span><span class="default">$record</span><span class="keyword">[</span><span class="string">'message'</span><span class="keyword">] .</span><span class="string">"&lt;br&gt;\n"</span><span class="keyword">;<br><br></span><span class="comment">// Send a message<br></span><span class="default">$message</span><span class="keyword">[</span><span class="string">"message"</span><span class="keyword">]=</span><span class="string">"hello world."</span><span class="keyword">;<br></span><span class="default">$message</span><span class="keyword">[</span><span class="string">"foo"</span><span class="keyword">]=</span><span class="string">"bar"</span><span class="keyword">;<br></span><span class="default">$ipc</span><span class="keyword">=</span><span class="default">ipc</span><span class="keyword">(</span><span class="default">$message</span><span class="keyword">);<br></span><span class="default">?&gt;</span>
</span>
</code></div>
  </div>
 </div></div>

 
</section>    </section><!-- layout-content -->
        


  </div><!-- layout -->
         
  

    
 <!-- External and third party libraries. -->
 







<a id="toTop" href="javascript:;"><span id="toTopHover"></span><img width="40" height="40" alt="To Top" src="../../images/to-top%402x.png"></a>



<!-- Mirrored from php.net/manual/en/function.fopen.php by HTTrack Website Copier/3.x [XR&CO'2013], Thu, 28 Aug 2014 15:28:58 GMT -->


</body></html>