<html><!-- Mirrored from php.net/manual/en/function.eval.php by HTTrack Website Copier/3.x [XR&CO'2013], Thu, 28 Aug 2014 16:04:53 GMT --><!-- Added by HTTrack --><head><meta http-equiv="content-type" content="text/html;charset=utf-8"><!-- /Added by HTTrack -->


  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0"> 

  <title>eval</title>

 <link rel="shortcut icon" href="../../favicon.ico">
 <link rel="search" type="application/opensearchdescription+xml" href="http://php.net/phpnetimprovedsearch.src" title="Add PHP.net search">
 <link rel="alternate" type="application/atom+xml" href="http://php.net/releases/feed.php" title="PHP Release feed">
 <link rel="alternate" type="application/atom+xml" href="http://php.net/feed.atom" title="PHP: Hypertext Preprocessor">

 <link rel="canonical" href="function.eval.html">
 <link rel="shorturl" href="http://php.net/eval">
 <link rel="alternate" href="http://php.net/eval" hreflang="x-default">

 <link rel="contents" href="index-2.html">
 <link rel="index" href="ref.misc.html">
 <link rel="prev" href="function.die.html">
 <link rel="next" href="function.exit.html">

 <link rel="alternate" href="function.eval.html" hreflang="en">
 <link rel="alternate" href="http://php.net/manual/pt_BR/function.eval.php" hreflang="pt_BR">
 <link rel="alternate" href="http://php.net/manual/zh/function.eval.php" hreflang="zh">
 <link rel="alternate" href="http://php.net/manual/fr/function.eval.php" hreflang="fr">
 <link rel="alternate" href="http://php.net/manual/de/function.eval.php" hreflang="de">
 <link rel="alternate" href="http://php.net/manual/it/function.eval.php" hreflang="it">
 <link rel="alternate" href="http://php.net/manual/ja/function.eval.php" hreflang="ja">
 <link rel="alternate" href="http://php.net/manual/ro/function.eval.php" hreflang="ro">
 <link rel="alternate" href="http://php.net/manual/ru/function.eval.php" hreflang="ru">
 <link rel="alternate" href="http://php.net/manual/es/function.eval.php" hreflang="es">
 <link rel="alternate" href="http://php.net/manual/tr/function.eval.php" hreflang="tr">

<link rel="stylesheet" type="text/css" href="../../cached8fe1.css?t=1401250819&amp;f=/fonts/Fira/fira.css" media="screen">
<link rel="stylesheet" type="text/css" href="../../cached4b8d.css?t=1404368420&amp;f=/fonts/Font-Awesome/css/fontello.css" media="screen">
<link rel="stylesheet" type="text/css" href="../../cached5065.css?t=1403329232&amp;f=/styles/theme-base.css" media="screen">
<link rel="stylesheet" type="text/css" href="../../cachedc78d.css?t=1401249623&amp;f=/styles/theme-medium.css" media="screen">

 <!--[if lte IE 7]>
 <link rel="stylesheet" type="text/css" href="http://php.net/styles/workarounds.ie7.css" media="screen">
 <![endif]-->

 <!--[if lte IE 8]>
 <script type="text/javascript">
  window.brokenIE = true;
 </script>
 <![endif]-->

 <!--[if lte IE 9]>
 <link rel="stylesheet" type="text/css" href="http://php.net/styles/workarounds.ie9.css" media="screen">
 <![endif]-->

 <!--[if IE]>
 <script type="text/javascript" src="http://php.net/js/ext/html5.js"></script>
 <![endif]-->

 <base>

</head>
<body class="docs " style="">


<div class="headsup"><a href="http://php.net/index.php#id2014-08-28-1">PHP 5.6.0 released</a></div>
<nav id="trick"><div><dl>
<dt><a href="getting-started.html">Getting Started</a></dt>
	<dd><a href="introduction.html">Introduction</a></dd>
	<dd><a href="tutorial.html">A simple tutorial</a></dd>
<dt><a href="langref.html">Language Reference</a></dt>
	<dd><a href="language.basic-syntax.html">Basic syntax</a></dd>
	<dd><a href="language.types.html">Types</a></dd>
	<dd><a href="language.variables.html">Variables</a></dd>
	<dd><a href="language.constants.html">Constants</a></dd>
	<dd><a href="language.expressions.html">Expressions</a></dd>
	<dd><a href="language.operators.html">Operators</a></dd>
	<dd><a href="language.control-structures.html">Control Structures</a></dd>
	<dd><a href="language.functions.html">Functions</a></dd>
	<dd><a href="language.oop5.html">Classes and Objects</a></dd>
	<dd><a href="language.namespaces.html">Namespaces</a></dd>
	<dd><a href="language.exceptions.html">Exceptions</a></dd>
	<dd><a href="language.generators.html">Generators</a></dd>
	<dd><a href="language.references.html">References Explained</a></dd>
	<dd><a href="reserved.variables.html">Predefined Variables</a></dd>
	<dd><a href="reserved.exceptions.html">Predefined Exceptions</a></dd>
	<dd><a href="reserved.interfaces.html">Predefined Interfaces and Classes</a></dd>
	<dd><a href="context.html">Context options and parameters</a></dd>
	<dd><a href="wrappers.html">Supported Protocols and Wrappers</a></dd>
</dl>
<dl>
<dt><a href="security.html">Security</a></dt>
	<dd><a href="security.intro.html">Introduction</a></dd>
	<dd><a href="security.general.html">General considerations</a></dd>
	<dd><a href="security.cgi-bin.html">Installed as CGI binary</a></dd>
	<dd><a href="security.apache.html">Installed as an Apache module</a></dd>
	<dd><a href="security.filesystem.html">Filesystem Security</a></dd>
	<dd><a href="security.database.html">Database Security</a></dd>
	<dd><a href="security.errors.html">Error Reporting</a></dd>
	<dd><a href="security.globals.html">Using Register Globals</a></dd>
	<dd><a href="security.variables.html">User Submitted Data</a></dd>
	<dd><a href="security.magicquotes.html">Magic Quotes</a></dd>
	<dd><a href="security.hiding.html">Hiding PHP</a></dd>
	<dd><a href="security.current.html">Keeping Current</a></dd>
<dt><a href="features.html">Features</a></dt>
	<dd><a href="features.http-auth.html">HTTP authentication with PHP</a></dd>
	<dd><a href="features.cookies.html">Cookies</a></dd>
	<dd><a href="features.sessions.html">Sessions</a></dd>
	<dd><a href="features.xforms.html">Dealing with XForms</a></dd>
	<dd><a href="features.file-upload.html">Handling file uploads</a></dd>
	<dd><a href="features.remote-files.html">Using remote files</a></dd>
	<dd><a href="features.connection-handling.html">Connection handling</a></dd>
	<dd><a href="features.persistent-connections.html">Persistent Database Connections</a></dd>
	<dd><a href="features.safe-mode.html">Safe Mode</a></dd>
	<dd><a href="features.commandline.html">Command line usage</a></dd>
	<dd><a href="features.gc.html">Garbage Collection</a></dd>
	<dd><a href="features.dtrace.html">DTrace Dynamic Tracing</a></dd>
</dl>
<dl>
<dt><a href="funcref.html">Function Reference</a></dt>
	<dd><a href="refs.basic.php.html">Affecting PHP's Behaviour</a></dd>
	<dd><a href="refs.utilspec.audio.html">Audio Formats Manipulation</a></dd>
	<dd><a href="refs.remote.auth.html">Authentication Services</a></dd>
	<dd><a href="refs.utilspec.cmdline.html">Command Line Specific Extensions</a></dd>
	<dd><a href="refs.compression.html">Compression and Archive Extensions</a></dd>
	<dd><a href="refs.creditcard.html">Credit Card Processing</a></dd>
	<dd><a href="refs.crypto.html">Cryptography Extensions</a></dd>
	<dd><a href="refs.database.html">Database Extensions</a></dd>
	<dd><a href="refs.calendar.html">Date and Time Related Extensions</a></dd>
	<dd><a href="refs.fileprocess.file.html">File System Related Extensions</a></dd>
	<dd><a href="refs.international.html">Human Language and Character Encoding Support</a></dd>
	<dd><a href="refs.utilspec.image.html">Image Processing and Generation</a></dd>
	<dd><a href="refs.remote.mail.html">Mail Related Extensions</a></dd>
	<dd><a href="refs.math.html">Mathematical Extensions</a></dd>
	<dd><a href="refs.utilspec.nontext.html">Non-Text MIME Output</a></dd>
	<dd><a href="refs.fileprocess.process.html">Process Control Extensions</a></dd>
	<dd><a href="refs.basic.other.html">Other Basic Extensions</a></dd>
	<dd><a href="refs.remote.other.html">Other Services</a></dd>
	<dd><a href="refs.search.html">Search Engine Extensions</a></dd>
	<dd><a href="refs.utilspec.server.html">Server Specific Extensions</a></dd>
	<dd><a href="refs.basic.session.html">Session Extensions</a></dd>
	<dd><a href="refs.basic.text.html">Text Processing</a></dd>
	<dd><a href="refs.basic.vartype.html">Variable and Type Related Extensions</a></dd>
	<dd><a href="refs.webservice.html">Web Services</a></dd>
	<dd><a href="refs.utilspec.windows.html">Windows Only Extensions</a></dd>
	<dd><a href="refs.xml.html">XML Manipulation</a></dd>
</dl>
<dl>
<dt>Keyboard Shortcuts</dt><dt>?</dt>
<dd>This help</dd>
<dt>j</dt>
<dd>Next menu item</dd>
<dt>k</dt>
<dd>Previous menu item</dd>
<dt>g p</dt>
<dd>Previous man page</dd>
<dt>g n</dt>
<dd>Next man page</dd>
<dt>G</dt>
<dd>Scroll to bottom</dd>
<dt>g g</dt>
<dd>Scroll to top</dd>
<dt>g h</dt>
<dd>Goto homepage</dd>
<dt>g s</dt>
<dd>Goto search<br>(current page)</dd>
<dt>/</dt>
<dd>Focus search box</dd>
</dl></div></nav>
<div id="goto">
    <div class="search">
         <div class="text"></div>
         <div class="results"><ul></ul></div>
   </div>
</div>

  <div id="breadcrumbs" class="row-fluid">
          
              
        <ul class="breadcrumbs-container">
            <li><a href="index-2.html">PHP Manual</a></li>      <li><a href="funcref.html">Function Reference</a></li>      <li><a href="refs.basic.other.html">Other Basic Extensions</a></li>      <li><a href="book.misc.html">Misc.</a></li>      <li><a href="ref.misc.html">Misc. Functions</a></li>    </ul>
  </div>




<div id="layout">
  <section id="layout-content">
  <div id="function.eval" class="refentry">
 <div class="refnamediv">
  <h1 class="refname">eval</h1>
  <p class="verinfo">(PHP 4, PHP 5)</p><p class="refpurpose"><span class="refname">eval</span> — <span class="dc-title">Evaluate a string as PHP code</span></p>

 </div>
 
 <div class="refsect1 description" id="refsect1-function.eval-description">
  <h3 class="title">Description</h3>
  <div class="methodsynopsis dc-description">
   <span class="type"><a href="language.pseudo-types.html#language.types.mixed" class="type mixed">mixed</a></span> <span class="methodname"><strong>eval</strong></span>
    ( <span class="methodparam"><span class="type">string</span> <code class="parameter">$code</code></span>
   )</div>

  <p class="para rdfs-comment">
   Evaluates the given <code class="parameter">code</code> as PHP.
  </p>
  <div class="caution"><strong class="caution">Caution</strong>
   <p class="para">
    The <span class="function"><strong>eval()</strong></span> language construct is <em class="emphasis">very dangerous</em>
    because it allows execution of arbitrary PHP code. <em class="emphasis">Its use thus is
    discouraged.</em> If you have carefully verified that there is no other option
    than to use this construct, pay special attention <em class="emphasis">not to pass any user
    provided data</em> into it without properly validating it beforehand.
   </p>
  </div>
 </div>


 <div class="refsect1 parameters" id="refsect1-function.eval-parameters">
  <h3 class="title">Parameters</h3>
  <p class="para">
   </p><dl>

    
     <dt>
<code class="parameter">code</code></dt>

     <dd>

      <p class="para">
       Valid PHP code to be evaluated.
      </p>
      <p class="para">
       The code mustn't be wrapped in opening and closing
       <a href="language.basic-syntax.phpmode.html" class="link">PHP tags</a>, i.e.
       <em>'echo "Hi!";'</em> must be passed instead of
       <em>'&lt;? echo "Hi!"; &gt;'</em>. It is still possible to leave and
       reenter PHP mode though using the appropriate PHP tags, e.g.
       <em>'echo "In PHP mode!"; ?&gt;In HTML mode!&lt;? echo "Back in PHP mode!";'</em>.
      </p>
      <p class="para">
       Apart from that the passed code must be valid PHP. This includes that all statements
       must be properly terminated using a semicolon.
       <em>'echo "Hi!"'</em> for example will cause a parse error, whereas
       <em>'echo "Hi!";'</em> will work.
      </p>
      <p class="para">
       A <em>return</em> statement will immediately terminate the
       evaluation of the code. 
      </p>
      <p class="para">
       The code will be executed in the scope of the code calling <span class="function"><strong>eval()</strong></span>. Thus any
       variables defined or changed in the <span class="function"><strong>eval()</strong></span> call will remain visible after
       it terminates.
      </p>
     </dd>

    
   </dl>

  <p></p>
 </div>


 <div class="refsect1 returnvalues" id="refsect1-function.eval-returnvalues">
  <h3 class="title">Return Values</h3>
  <p class="para">
   <span class="function"><strong>eval()</strong></span> returns <strong><code>NULL</code></strong> unless 
   <em>return</em> is called in the evaluated code, in which case
   the value passed to <em>return</em> is returned. If there is a
   parse error in the evaluated code, <span class="function"><strong>eval()</strong></span> returns
   <strong><code>FALSE</code></strong> and execution of the following code continues normally. It is
   not possible to catch a parse error in <span class="function"><strong>eval()</strong></span>
   using <span class="function"><a href="function.set-error-handler.html" class="function">set_error_handler()</a></span>.
  </p>
 </div>


 <div class="refsect1 examples" id="refsect1-function.eval-examples">
  <h3 class="title">Examples</h3>
  <p class="para">
   </p><div class="example" id="example-3898">
    <p><strong>Example #1 <span class="function"><strong>eval()</strong></span> example - simple text merge</strong></p>
    <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br>$string&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #DD0000">'cup'</span><span style="color: #007700">;<br></span><span style="color: #0000BB">$name&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #DD0000">'coffee'</span><span style="color: #007700">;<br></span><span style="color: #0000BB">$str&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #DD0000">'This&nbsp;is&nbsp;a&nbsp;$string&nbsp;with&nbsp;my&nbsp;$name&nbsp;in&nbsp;it.'</span><span style="color: #007700">;<br>echo&nbsp;</span><span style="color: #0000BB">$str</span><span style="color: #007700">.&nbsp;</span><span style="color: #DD0000">"\n"</span><span style="color: #007700">;<br>eval(</span><span style="color: #DD0000">"\$str&nbsp;=&nbsp;\"</span><span style="color: #0000BB">$str</span><span style="color: #DD0000">\";"</span><span style="color: #007700">);<br>echo&nbsp;</span><span style="color: #0000BB">$str</span><span style="color: #007700">.&nbsp;</span><span style="color: #DD0000">"\n"</span><span style="color: #007700">;<br></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
    </div>

    <div class="example-contents"><p>The above example will output:</p></div>
    <div class="example-contents screen">
<div class="cdata"><pre>This is a $string with my $name in it.
This is a cup with my coffee in it.
</pre></div>
    </div>
   </div>
  <p></p>
 </div>


 <div class="refsect1 notes" id="refsect1-function.eval-notes">
  <h3 class="title">Notes</h3>

  <blockquote class="note"><p><strong class="note">Note</strong>: <span class="simpara">Because this is a
language construct and not a function, it cannot be called using
<a href="functions.variable-functions.html" class="link">variable functions</a>.</span>
</p></blockquote>

  <div class="tip"><strong class="tip">Tip</strong><p class="simpara">As with anything that outputs
its result directly to the browser, the <a href="book.outcontrol.html" class="link">output-control functions</a> can be used to capture
the output of this function, and save it in a
<span class="type"><a href="language.types.string.html" class="type string">string</a></span> (for example).</p></div>
  <blockquote class="note"><p><strong class="note">Note</strong>: 
   </p><p class="para">
    In case of a fatal error in the evaluated code, the whole script exits.
   </p>
  <p></p></blockquote>
 </div>


 <div class="refsect1 seealso" id="refsect1-function.eval-seealso">
  <h3 class="title">See Also</h3>
  <p class="para">
   </p><ul class="simplelist">
    <li class="member"><span class="function"><a href="function.call-user-func.html" class="function" rel="rdfs-seeAlso">call_user_func()</a> - Call the callback given by the first parameter</span></li>
   </ul>
  <p></p>
 </div>

</div>
<section id="usernotes">
 <div class="head"><h3 class="title">User Contributed Notes</h3></div><div id="allnotes">
  <div class="note" id="44008">  
  <a class="name"><strong class="user"><em>Anonymous</em></strong></a><div class="date" title="2004-07-12 09:37"><strong>10 years ago</strong></div>
  <div class="text" id="Hcom44008">
<div class="phpcode"><code><span class="html">
Kepp the following Quote in mind:<br><br>If eval() is the answer, you're almost certainly asking the<br>wrong question. -- Rasmus Lerdorf, BDFL of PHP</span>
</code></div>
  </div>
 </div>
  <div class="note" id="114731">  
  <a class="name">
  <strong class="user"><em>thomas at not dot my dot real dot domain dot com</em></strong></a><div class="date" title="2014-03-30 10:48"><strong>4 months ago</strong></div>
  <div class="text" id="Hcom114731">
<div class="phpcode"><code><span class="html">
eval() can easily be used in if-statements (in contrast to jkuckartz1984 at hotmail dot com): simply put a "return()" around the statement: if(eval('return($total'.$i.');')) ...<br><br>And in answer to the top-comment: I use eval() for my personal bug-fixes in e.g. open-source-software, where a function gets old code and new code as strings, so it can produce a bugreport (with some more added information) and the new code is evaled by eval(). Just a little overhead, but a nice way to keep all my changes together. So I think, there are some "right" questions where eval() is the (proper) answer.<br><br>At least I think, if you say "The eval() language construct is very dangerous because it allows execution of arbitrary PHP code." you just as well can say "PHP is very dangerous because it allows execution of arbitrary PHP code." The point is not to use any user provided data - that's all.</span>
</code></div>
  </div>
 </div>
  <div class="note" id="114921">  
  <a class="name">
  <strong class="user"><em>andrea at donboscoland dot it</em></strong></a><div class="date" title="2014-04-27 10:04"><strong>4 months ago</strong></div>
  <div class="text" id="Hcom114921">
<div class="phpcode"><code><span class="html">
Sorry, some corrections to my note... I've:<br>* removed the minus sign -? at the beginning and readded the |pi|π at the end like in previous examples;<br>* added some math functions;<br>* added the , in the operators: now it is possible to calculate pow(1,3) or rand(1,10);<br>* changed the $number definition to accept scientific notation like in:<br><a rel="nofollow" target="_blank">http://stackoverflow.com/questions/638565/parsing-scientific-notation-sensibly</a><br><br><span class="default">&lt;?php<br></span><span class="keyword">function </span><span class="default">calc</span><span class="keyword">(</span><span class="default">$equation</span><span class="keyword">)<br>{<br>&nbsp; &nbsp; </span><span class="comment">// Remove whitespaces<br>&nbsp; &nbsp; </span><span class="default">$equation </span><span class="keyword">= </span><span class="default">preg_replace</span><span class="keyword">(</span><span class="string">'/\s+/'</span><span class="keyword">, </span><span class="string">''</span><span class="keyword">, </span><span class="default">$equation</span><span class="keyword">);<br>&nbsp; &nbsp; echo </span><span class="string">"</span><span class="default">$equation</span><span class="string">\n"</span><span class="keyword">;<br><br>&nbsp; &nbsp; </span><span class="default">$number </span><span class="keyword">= </span><span class="string">'((?:0|[1-9]\d*)(?:\.\d*)?(?:[eE][+\-]?\d+)?|pi|π)'</span><span class="keyword">; </span><span class="comment">// What is a number<br><br>&nbsp; &nbsp; </span><span class="default">$functions </span><span class="keyword">= </span><span class="string">'(?:sinh?|cosh?|tanh?|acosh?|asinh?|atanh?|exp|log(10)?|deg2rad|rad2deg<br>|sqrt|pow|abs|intval|ceil|floor|round|(mt_)?rand|gmp_fact)'</span><span class="keyword">; </span><span class="comment">// Allowed PHP functions<br>&nbsp; &nbsp; </span><span class="default">$operators </span><span class="keyword">= </span><span class="string">'[\/*\^\+-,]'</span><span class="keyword">; </span><span class="comment">// Allowed math operators<br>&nbsp; &nbsp; </span><span class="default">$regexp </span><span class="keyword">= </span><span class="string">'/^([+-]?('</span><span class="keyword">.</span><span class="default">$number</span><span class="keyword">.</span><span class="string">'|'</span><span class="keyword">.</span><span class="default">$functions</span><span class="keyword">.</span><span class="string">'\s*\((?1)+\)|\((?1)+\))(?:'</span><span class="keyword">.</span><span class="default">$operators</span><span class="keyword">.</span><span class="string">'(?1))?)+$/'</span><span class="keyword">; </span><span class="comment">// Final regexp, heavily using recursive patterns<br><br>&nbsp; &nbsp; </span><span class="keyword">if (</span><span class="default">preg_match</span><span class="keyword">(</span><span class="default">$regexp</span><span class="keyword">, </span><span class="default">$equation</span><span class="keyword">))<br>&nbsp; &nbsp; {<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$equation </span><span class="keyword">= </span><span class="default">preg_replace</span><span class="keyword">(</span><span class="string">'!pi|π!'</span><span class="keyword">, </span><span class="string">'pi()'</span><span class="keyword">, </span><span class="default">$equation</span><span class="keyword">); </span><span class="comment">// Replace pi with pi function<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="keyword">echo </span><span class="string">"</span><span class="default">$equation</span><span class="string">\n"</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; eval(</span><span class="string">'$result = '</span><span class="keyword">.</span><span class="default">$equation</span><span class="keyword">.</span><span class="string">';'</span><span class="keyword">);<br>&nbsp; &nbsp; }<br>&nbsp; &nbsp; else<br>&nbsp; &nbsp; {<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$result </span><span class="keyword">= </span><span class="default">false</span><span class="keyword">;<br>&nbsp; &nbsp; }<br>&nbsp; &nbsp; return </span><span class="default">$result</span><span class="keyword">;<br>}<br></span><span class="default">?&gt;</span>
</span>
</code></div>
  </div>
 </div>
  <div class="note" id="114911">  
  <a class="name">
  <strong class="user"><em>jg estiot at gmail dot com</em></strong></a><div class="date" title="2014-04-25 03:27"><strong>4 months ago</strong></div>
  <div class="text" id="Hcom114911">
<div class="phpcode"><code><span class="html">
Eval() is no more dangerous than allowing SQL injection or other security flaws within your scripts. I feel it is unfair to single out eval() as "dangerous" when it is as dangerous as many other features of the PHP language if misused. <br><br>I am writing a powerful PHP Framework and without eval() I could not implement some of its very best features. <br><br>With power comes responsibility and it is up to each of us to ensure that no unfiltered user input ever ends up in eval().</span>
</code></div>
  </div>
 </div>
  <div class="note" id="107377">  
  <a class="name">
  <strong class="user"><em>bohwaz</em></strong></a><div class="date" title="2012-02-04 10:51"><strong>2 years ago</strong></div>
  <div class="text" id="Hcom107377">
<div class="phpcode"><code><span class="html">
If you want to allow math input and make sure that the input is proper mathematics and not some hacking code, you can try this:<br><br><span class="default">&lt;?php<br><br>$test </span><span class="keyword">= </span><span class="string">'2+3*pi'</span><span class="keyword">;<br><br></span><span class="comment">// Remove whitespaces<br></span><span class="default">$test </span><span class="keyword">= </span><span class="default">preg_replace</span><span class="keyword">(</span><span class="string">'/\s+/'</span><span class="keyword">, </span><span class="string">''</span><span class="keyword">, </span><span class="default">$test</span><span class="keyword">);<br><br></span><span class="default">$number </span><span class="keyword">= </span><span class="string">'(?:\d+(?:[,.]\d+)?|pi|π)'</span><span class="keyword">; </span><span class="comment">// What is a number<br></span><span class="default">$functions </span><span class="keyword">= </span><span class="string">'(?:sinh?|cosh?|tanh?|abs|acosh?|asinh?|atanh?|exp|log10|deg2rad|rad2deg|sqrt|ceil|floor|round)'</span><span class="keyword">; </span><span class="comment">// Allowed PHP functions<br></span><span class="default">$operators </span><span class="keyword">= </span><span class="string">'[+\/*\^%-]'</span><span class="keyword">; </span><span class="comment">// Allowed math operators<br></span><span class="default">$regexp </span><span class="keyword">= </span><span class="string">'/^(('</span><span class="keyword">.</span><span class="default">$number</span><span class="keyword">.</span><span class="string">'|'</span><span class="keyword">.</span><span class="default">$functions</span><span class="keyword">.</span><span class="string">'\s*\((?1)+\)|\((?1)+\))(?:'</span><span class="keyword">.</span><span class="default">$operators</span><span class="keyword">.</span><span class="string">'(?2))?)+$/'</span><span class="keyword">; </span><span class="comment">// Final regexp, heavily using recursive patterns<br><br></span><span class="keyword">if (</span><span class="default">preg_match</span><span class="keyword">(</span><span class="default">$regexp</span><span class="keyword">, </span><span class="default">$q</span><span class="keyword">))<br>{<br>&nbsp; &nbsp; </span><span class="default">$test </span><span class="keyword">= </span><span class="default">preg_replace</span><span class="keyword">(</span><span class="string">'!pi|π!'</span><span class="keyword">, </span><span class="string">'pi()'</span><span class="keyword">, </span><span class="default">$test</span><span class="keyword">); </span><span class="comment">// Replace pi with pi function<br>&nbsp; &nbsp; </span><span class="keyword">eval(</span><span class="string">'$result = '</span><span class="keyword">.</span><span class="default">$test</span><span class="keyword">.</span><span class="string">';'</span><span class="keyword">);<br>}<br>else<br>{<br>&nbsp; &nbsp; </span><span class="default">$result </span><span class="keyword">= </span><span class="default">false</span><span class="keyword">;<br>}<br><br></span><span class="default">?&gt;<br></span><br>I can't guarantee you absolutely that this will block every possible malicious code nor that it will block malformed code, but that's better than the matheval function below which will allow malformed code like '2+2+' which will throw an error.</span>
</code></div>
  </div>
 </div>
  <div class="note" id="114685">  
  <a class="name">
  <strong class="user"><em>Daniele Mams</em></strong></a><div class="date" title="2014-03-21 11:15"><strong>5 months ago</strong></div>
  <div class="text" id="Hcom114685">
<div class="phpcode"><code><span class="html">
This is another function that return true if $formula is a syntactically valid Math function, false otherwise.<br><br>NDR.<br>1) It not allows %, pi|π.<br>2) It allows this Math functions:<br>abs, atan, ceil, cot, cos, exp, gmp_fact, intval, sin, sqrt, tan, log, log10, rand, round.<br><br>I write it on pastebin.com because php.net not allow me to post long code.<br>enjoy it! :-)<br><a rel="nofollow" target="_blank">http://pastebin.com/EgwV7QdK</a></span>
</code></div>
  </div>
 </div>
  <div class="note" id="46382">  
  <a class="name">
  <strong class="user"><em>mahaixing at hotmail dot com</em></strong></a><div class="date" title="2004-10-08 08:49"><strong>9 years ago</strong></div>
  <div class="text" id="Hcom46382">
<div class="phpcode"><code><span class="html">
When using Dynamic Proxy design pattern we must create a class automaticly. Here is a sample code.
<br>
<br><span class="default">&lt;?php
<br>$clazz </span><span class="keyword">= </span><span class="string">"class SomeClass { var \$value = 'somevalue'; function show() { echo get_class(\$this);}}"</span><span class="keyword">;
<br>
<br>eval(</span><span class="default">$clazz</span><span class="keyword">);
<br>
<br></span><span class="default">$instance </span><span class="keyword">= new </span><span class="default">SomeClass</span><span class="keyword">;
<br>
<br></span><span class="comment">// Here output 'somevalue';
<br></span><span class="keyword">echo </span><span class="default">$instance</span><span class="keyword">-&gt;</span><span class="default">value</span><span class="keyword">;
<br>
<br>echo </span><span class="string">"&lt;br&gt;"</span><span class="keyword">;
<br>
<br></span><span class="comment">//Here output 'someclass'
<br></span><span class="default">$instance</span><span class="keyword">-&gt;</span><span class="default">show</span><span class="keyword">();
<br></span><span class="default">?&gt;</span>
</span>
</code></div>
  </div>
 </div>
  <div class="note" id="87296">  
  <a class="name">
  <strong class="user"><em>php at stock-consulting dot com</em></strong></a><div class="date" title="2008-11-28 08:16"><strong>5 years ago</strong></div>
  <div class="text" id="Hcom87296">
<div class="phpcode"><code><span class="html">
Magic constants like __FILE__ may not return what you expect if used inside eval()'d code. Instead, it'll answer something like "c:\directory\filename.php(123) : eval()'d code" (under Windows, obviously, checked with PHP5.2.6) - which can still be processed with a function like preg_replace to receive the filename of the file containing the eval().
<br>
<br>Example:
<br>
<br><span class="default">&lt;?php
<br>$filename </span><span class="keyword">= </span><span class="default">preg_replace</span><span class="keyword">(</span><span class="string">'@\(.*\(.*$@'</span><span class="keyword">, </span><span class="string">''</span><span class="keyword">, </span><span class="default">__FILE__</span><span class="keyword">);
<br>echo </span><span class="default">$filename</span><span class="keyword">;
<br></span><span class="default">?&gt;</span>
</span>
</code></div>
  </div>
 </div>
  <div class="note" id="106481">  
  <a class="name">
  <strong class="user"><em>socram8888 at gmail dot com</em></strong></a><div class="date" title="2011-11-12 12:18"><strong>2 years ago</strong></div>
  <div class="text" id="Hcom106481">
<div class="phpcode"><code><span class="html">
It may be a bit obvious, but if you don't want eval'd code to interfere with main code variables, all you have to do is to call an eval from another function like this:
<br>
<br><span class="default">&lt;?php
<br></span><span class="keyword">function </span><span class="default">localeval</span><span class="keyword">(</span><span class="default">$code</span><span class="keyword">) {
<br>&nbsp; &nbsp; return eval(</span><span class="default">$code</span><span class="keyword">);
<br>};
<br>
<br></span><span class="default">$a </span><span class="keyword">= </span><span class="string">"a"</span><span class="keyword">;
<br>echo </span><span class="string">'$a before eval code: ' </span><span class="keyword">. </span><span class="default">$a </span><span class="keyword">. </span><span class="string">"\n"</span><span class="keyword">; </span><span class="comment">// prints "a"
<br></span><span class="default">localeval</span><span class="keyword">(</span><span class="string">'$a = \'b\';'</span><span class="keyword">);
<br>echo </span><span class="string">'$a after localeval: ' </span><span class="keyword">. </span><span class="default">$a </span><span class="keyword">. </span><span class="string">"\n"</span><span class="keyword">; </span><span class="comment">// still prints "a"
<br></span><span class="keyword">eval(</span><span class="string">'$a = \'b\';'</span><span class="keyword">);
<br>echo </span><span class="string">'$a after eval: ' </span><span class="keyword">. </span><span class="default">$a </span><span class="keyword">. </span><span class="string">"\n"</span><span class="keyword">; </span><span class="comment">// prints "b"
<br></span><span class="default">?&gt;</span>
</span>
</code></div>
  </div>
 </div>
  <div class="note" id="97063">  
  <a class="name">
  <strong class="user"><em>darkhogg (foo) gmail (bar) com</em></strong></a><div class="date" title="2010-03-30 10:33"><strong>4 years ago</strong></div>
  <div class="text" id="Hcom97063">
<div class="phpcode"><code><span class="html">
The following code<br><br><span class="default">&lt;?php<br>&nbsp; &nbsp; </span><span class="keyword">eval( </span><span class="string">'?&gt; foo &lt;?php' </span><span class="keyword">);<br></span><span class="default">?&gt;<br></span><br>does not throw any error, but prints the opening tag.<br>Adding a space after the open tag fixes it:<br><br><span class="default">&lt;?php<br>&nbsp; &nbsp; </span><span class="keyword">eval( </span><span class="string">'?&gt; foo &lt;?php ' </span><span class="keyword">);<br></span><span class="default">?&gt;</span>
</span>
</code></div>
  </div>
 </div>
  <div class="note" id="114922">  
  <a class="name">
  <strong class="user"><em>andrea at donboscoland dot it</em></strong></a><div class="date" title="2014-04-27 03:03"><strong>4 months ago</strong></div>
  <div class="text" id="Hcom114922">
<div class="phpcode"><code><span class="html">
with reference to the problem of mathematic equations validation<br>, as an operator is not a good idea... i've removed the comma from operators and added the optional group (,(?1))? to validate functions like pow(2,3)<br><br>$operators = '[\/*\^\+-]'; // Allowed math operators<br><br>$regexp = '/^([+-]?('.$number.'|'.$functions.'\s*\((?1)+(,(?1))?\)|\((?1)+\))(?:'.$operators.'(?1))?)+$/'; // Final regexp, heavily using recursive patterns</span>
</code></div>
  </div>
 </div>
  <div class="note" id="114678">  
  <a class="name">
  <strong class="user"><em>Daniele Mams</em></strong></a><div class="date" title="2014-03-21 09:04"><strong>5 months ago</strong></div>
  <div class="text" id="Hcom114678">
<div class="phpcode"><code><span class="html">
Modified version of sooncj answer: your regex not allow something like this: 1-(1). So I modified your code: I change the 'Allowed PHP functions':<br><br><span class="default">&lt;?php<br></span><span class="keyword">function </span><span class="default">calc</span><span class="keyword">(</span><span class="default">$equation</span><span class="keyword">)<br>{<br>&nbsp; &nbsp; </span><span class="comment">// Remove whitespaces<br>&nbsp; &nbsp; </span><span class="default">$equation </span><span class="keyword">= </span><span class="default">preg_replace</span><span class="keyword">(</span><span class="string">'/\s+/'</span><span class="keyword">, </span><span class="string">''</span><span class="keyword">, </span><span class="default">$equation</span><span class="keyword">);<br>&nbsp; &nbsp; echo </span><span class="string">"</span><span class="default">$equation</span><span class="string">\n"</span><span class="keyword">;<br><br>&nbsp; &nbsp; </span><span class="default">$number </span><span class="keyword">= </span><span class="string">'(?:\d+(?:[,.]\d+)?|pi|π)'</span><span class="keyword">; </span><span class="comment">// What is a number<br>&nbsp; &nbsp; </span><span class="default">$functions </span><span class="keyword">= </span><span class="string">'(?:abs|atan|ceil|cos|exp|gmp_fact|intval|log(10)?|rand|round|sin|sqrt|tan)'</span><span class="keyword">; </span><span class="comment">// Allowed PHP functions<br>&nbsp; &nbsp; </span><span class="default">$operators </span><span class="keyword">= </span><span class="string">'[\/*\^\+-]'</span><span class="keyword">; </span><span class="comment">// Allowed math operators<br>&nbsp; &nbsp; </span><span class="default">$regexp </span><span class="keyword">= </span><span class="string">'/^([+-]?('</span><span class="keyword">.</span><span class="default">$number</span><span class="keyword">.</span><span class="string">'|'</span><span class="keyword">.</span><span class="default">$functions</span><span class="keyword">.</span><span class="string">'\s*\((?1)+\)|\((?1)+\))(?:'</span><span class="keyword">.</span><span class="default">$operators</span><span class="keyword">.</span><span class="string">'(?1))?)+$/'</span><span class="keyword">; </span><span class="comment">// Final regexp, heavily using recursive patterns<br><br>&nbsp; &nbsp; </span><span class="keyword">if (</span><span class="default">preg_match</span><span class="keyword">(</span><span class="default">$regexp</span><span class="keyword">, </span><span class="default">$equation</span><span class="keyword">))<br>&nbsp; &nbsp; {<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$equation </span><span class="keyword">= </span><span class="default">preg_replace</span><span class="keyword">(</span><span class="string">'!pi|π!'</span><span class="keyword">, </span><span class="string">'pi()'</span><span class="keyword">, </span><span class="default">$equation</span><span class="keyword">); </span><span class="comment">// Replace pi with pi function<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="keyword">echo </span><span class="string">"</span><span class="default">$equation</span><span class="string">\n"</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; eval(</span><span class="string">'$result = '</span><span class="keyword">.</span><span class="default">$equation</span><span class="keyword">.</span><span class="string">';'</span><span class="keyword">);<br>&nbsp; &nbsp; }<br>&nbsp; &nbsp; else<br>&nbsp; &nbsp; {<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$result </span><span class="keyword">= </span><span class="default">false</span><span class="keyword">;<br>&nbsp; &nbsp; }<br>&nbsp; &nbsp; return </span><span class="default">$result</span><span class="keyword">;<br>}<br></span><span class="default">?&gt;<br></span><br>This function allow also this 'strange' math function:<br>1) a-+b<br>2) a+-b<br>3) a++b&nbsp;&nbsp; &lt;&lt; PHP not allow this<br>4) a--b.&nbsp;&nbsp; &lt;&lt; PHP not allow this<br><br>But not allow with 3 '+' or '-':<br>1) a---b, a+++b, a-++b, a+--b, a+-+b, a-+-b.<br><br>Allow other Math functions.<br><br>For a++b or a--b i write another function that block that!</span>
</code></div>
  </div>
 </div>
  <div class="note" id="114272">  
  <a class="name">
  <strong class="user"><em>sooncj</em></strong></a><div class="date" title="2014-01-31 03:51"><strong>6 months ago</strong></div>
  <div class="text" id="Hcom114272">
<div class="phpcode"><code><span class="html">
Modified version of bohwaz's answer: with negative number support and removes the requirement of properly grouped (bracketed) expressions.<br><br><span class="default">&lt;?php<br></span><span class="keyword">function </span><span class="default">calc</span><span class="keyword">(</span><span class="default">$equation</span><span class="keyword">)<br>{<br>&nbsp; &nbsp; </span><span class="comment">// Remove whitespaces<br>&nbsp; &nbsp; </span><span class="default">$equation </span><span class="keyword">= </span><span class="default">preg_replace</span><span class="keyword">(</span><span class="string">'/\s+/'</span><span class="keyword">, </span><span class="string">''</span><span class="keyword">, </span><span class="default">$equation</span><span class="keyword">);<br>&nbsp; &nbsp; echo </span><span class="string">"</span><span class="default">$equation</span><span class="string">\n"</span><span class="keyword">;<br><br>&nbsp; &nbsp; </span><span class="default">$number </span><span class="keyword">= </span><span class="string">'(?:-?\d+(?:[,.]\d+)?|pi|π)'</span><span class="keyword">; </span><span class="comment">// What is a number<br>&nbsp; &nbsp; </span><span class="default">$functions </span><span class="keyword">= </span><span class="string">'(?:sinh?|cosh?|tanh?|abs|acosh?|asinh?|atanh?|exp|log10|deg2rad|rad2deg|sqrt|ceil|floor|round)'</span><span class="keyword">; </span><span class="comment">// Allowed PHP functions<br>&nbsp; &nbsp; </span><span class="default">$operators </span><span class="keyword">= </span><span class="string">'[+\/*\^%-]'</span><span class="keyword">; </span><span class="comment">// Allowed math operators<br>&nbsp; &nbsp; </span><span class="default">$regexp </span><span class="keyword">= </span><span class="string">'/^(('</span><span class="keyword">.</span><span class="default">$number</span><span class="keyword">.</span><span class="string">'|'</span><span class="keyword">.</span><span class="default">$functions</span><span class="keyword">.</span><span class="string">'\s*\((?1)+\)|\((?1)+\))(?:'</span><span class="keyword">.</span><span class="default">$operators</span><span class="keyword">.</span><span class="string">'(?1))?)+$/'</span><span class="keyword">; </span><span class="comment">// Final regexp, heavily using recursive patterns<br><br>&nbsp; &nbsp; </span><span class="keyword">if (</span><span class="default">preg_match</span><span class="keyword">(</span><span class="default">$regexp</span><span class="keyword">, </span><span class="default">$equation</span><span class="keyword">))<br>&nbsp; &nbsp; {<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$equation </span><span class="keyword">= </span><span class="default">preg_replace</span><span class="keyword">(</span><span class="string">'!pi|π!'</span><span class="keyword">, </span><span class="string">'pi()'</span><span class="keyword">, </span><span class="default">$equation</span><span class="keyword">); </span><span class="comment">// Replace pi with pi function<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="keyword">echo </span><span class="string">"</span><span class="default">$equation</span><span class="string">\n"</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; eval(</span><span class="string">'$result = '</span><span class="keyword">.</span><span class="default">$equation</span><span class="keyword">.</span><span class="string">';'</span><span class="keyword">);<br>&nbsp; &nbsp; }<br>&nbsp; &nbsp; else<br>&nbsp; &nbsp; {<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$result </span><span class="keyword">= </span><span class="default">false</span><span class="keyword">;<br>&nbsp; &nbsp; }<br>&nbsp; &nbsp; return </span><span class="default">$result</span><span class="keyword">;<br>}<br></span><span class="default">?&gt;</span>
</span>
</code></div>
  </div>
 </div>
  <div class="note" id="108091">  
  <a class="name">
  <strong class="user"><em>sc1n at yahoo dot com</em></strong></a><div class="date" title="2012-03-28 12:57"><strong>2 years ago</strong></div>
  <div class="text" id="Hcom108091">
<div class="phpcode"><code><span class="html">
If you would like to handle doing an eval on a string with mixed PHP and other stuff such as HTML, you can use the following:<br><br>Example:<br><br><span class="default">&lt;?php<br>$test_string </span><span class="keyword">= </span><span class="string">'A friendly llama &lt;?php 1 == 1 ? "spit on" : "hugged"; ?&gt; me'</span><span class="keyword">;<br><br></span><span class="default">$p </span><span class="keyword">= new </span><span class="default">PhpStringParser</span><span class="keyword">();<br>echo </span><span class="default">$p</span><span class="keyword">-&gt;</span><span class="default">parse</span><span class="keyword">(</span><span class="default">$mixed_string</span><span class="keyword">);<br></span><span class="default">?&gt;<br></span><br>Result:<br><br>A friendly llama spit on me<br><br>You can optionally make variables that are outside of the string you are parsing available to the eval level scope by passing them into the constructor.<br><br>Example:<br><br><span class="default">&lt;?php<br>$llama_action </span><span class="keyword">= </span><span class="string">'hugged'</span><span class="keyword">;<br></span><span class="default">$test_string </span><span class="keyword">= </span><span class="string">'A friendly llama &lt;?=$llama_action?&gt; me'</span><span class="keyword">;<br><br></span><span class="default">$p </span><span class="keyword">= new </span><span class="default">PhpStringParser</span><span class="keyword">(array(</span><span class="string">'llama_action'</span><span class="keyword">, </span><span class="default">$llama_action</span><span class="keyword">));<br>echo </span><span class="default">$p</span><span class="keyword">-&gt;</span><span class="default">parse</span><span class="keyword">(</span><span class="default">$mixed_string</span><span class="keyword">);<br></span><span class="default">?&gt;<br></span><br>Result:<br><br>A friendly llama hugged me<br><br><span class="default">&lt;?php<br><br></span><span class="keyword">class </span><span class="default">PhpStringParser<br></span><span class="keyword">{<br>&nbsp; &nbsp; protected </span><span class="default">$variables</span><span class="keyword">;<br><br>&nbsp; &nbsp; public function </span><span class="default">__construct</span><span class="keyword">(</span><span class="default">$variables </span><span class="keyword">= array())<br>&nbsp; &nbsp; {<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">variables </span><span class="keyword">= </span><span class="default">$variables</span><span class="keyword">;<br>&nbsp; &nbsp; }<br><br>&nbsp; &nbsp; protected function </span><span class="default">eval_block</span><span class="keyword">(</span><span class="default">$matches</span><span class="keyword">)<br>&nbsp; &nbsp; {<br>&nbsp; &nbsp; &nbsp; &nbsp; if( </span><span class="default">is_array</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">variables</span><span class="keyword">) &amp;&amp; </span><span class="default">count</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">variables</span><span class="keyword">) )<br>&nbsp; &nbsp; &nbsp; &nbsp; {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; foreach(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">variables </span><span class="keyword">as </span><span class="default">$var_name </span><span class="keyword">=&gt; </span><span class="default">$var_value</span><span class="keyword">)<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $</span><span class="default">$var_name </span><span class="keyword">= </span><span class="default">$var_value</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br>&nbsp; &nbsp; &nbsp; &nbsp; }<br><br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$eval_end </span><span class="keyword">= </span><span class="string">''</span><span class="keyword">;<br><br>&nbsp; &nbsp; &nbsp; &nbsp; if( </span><span class="default">$matches</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">] == </span><span class="string">'&lt;?=' </span><span class="keyword">|| </span><span class="default">$matches</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">] == </span><span class="string">'&lt;?php=' </span><span class="keyword">)<br>&nbsp; &nbsp; &nbsp; &nbsp; {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if( </span><span class="default">$matches</span><span class="keyword">[</span><span class="default">2</span><span class="keyword">][</span><span class="default">count</span><span class="keyword">(</span><span class="default">$matches</span><span class="keyword">[</span><span class="default">2</span><span class="keyword">]-</span><span class="default">1</span><span class="keyword">)] !== </span><span class="string">';' </span><span class="keyword">)<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$eval_end </span><span class="keyword">= </span><span class="string">';'</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br>&nbsp; &nbsp; &nbsp; &nbsp; }<br><br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$return_block </span><span class="keyword">= </span><span class="string">''</span><span class="keyword">;<br><br>&nbsp; &nbsp; &nbsp; &nbsp; eval(</span><span class="string">'$return_block = ' </span><span class="keyword">. </span><span class="default">$matches</span><span class="keyword">[</span><span class="default">2</span><span class="keyword">] . </span><span class="default">$eval_end</span><span class="keyword">);<br><br>&nbsp; &nbsp; &nbsp; &nbsp; return </span><span class="default">$return_block</span><span class="keyword">;<br>&nbsp; &nbsp; }<br><br>&nbsp; &nbsp; public function </span><span class="default">parse</span><span class="keyword">(</span><span class="default">$string</span><span class="keyword">)<br>&nbsp; &nbsp; {<br>&nbsp; &nbsp; &nbsp; &nbsp; return </span><span class="default">preg_replace_callback</span><span class="keyword">(</span><span class="string">'/(\&lt;\?=|\&lt;\?php=|\&lt;\?php)(.*?)\?\&gt;/'</span><span class="keyword">, array(&amp;</span><span class="default">$this</span><span class="keyword">, </span><span class="string">'eval_block'</span><span class="keyword">), </span><span class="default">$string</span><span class="keyword">);<br>&nbsp; &nbsp; }<br>}<br><br></span><span class="default">?&gt;</span>
</span>
</code></div>
  </div>
 </div>
  <div class="note" id="114916">  
  <a class="name">
  <strong class="user"><em>andrea at donboscoland dot it</em></strong></a><div class="date" title="2014-04-26 08:10"><strong>4 months ago</strong></div>
  <div class="text" id="Hcom114916">
<div class="phpcode"><code><span class="html">
Modified version of Daniele Mams's answer: I change the $number definition to accept scientific notation like in:<br><a rel="nofollow" target="_blank">http://stackoverflow.com/questions/638565/parsing-scientific-notation-sensibly</a><br><br><span class="default">&lt;?php<br></span><span class="keyword">function </span><span class="default">calc</span><span class="keyword">(</span><span class="default">$equation</span><span class="keyword">)<br>{<br>&nbsp; &nbsp; </span><span class="comment">// Remove whitespaces<br>&nbsp; &nbsp; </span><span class="default">$equation </span><span class="keyword">= </span><span class="default">preg_replace</span><span class="keyword">(</span><span class="string">'/\s+/'</span><span class="keyword">, </span><span class="string">''</span><span class="keyword">, </span><span class="default">$equation</span><span class="keyword">);<br>&nbsp; &nbsp; echo </span><span class="string">"</span><span class="default">$equation</span><span class="string">\n"</span><span class="keyword">;<br><br>&nbsp; &nbsp; </span><span class="default">$number </span><span class="keyword">= </span><span class="string">'(-?(?:0|[1-9]\d*)(?:\.\d*)?(?:[eE][+\-]?\d+)?)'</span><span class="keyword">; </span><span class="comment">// What is a number<br><br>&nbsp; &nbsp; </span><span class="default">$functions </span><span class="keyword">= </span><span class="string">'(?:abs|atan|ceil|cos|exp|gmp_fact|intval|log(10)?|rand|round|sin|sqrt|tan)'</span><span class="keyword">; </span><span class="comment">// Allowed PHP functions<br>&nbsp; &nbsp; </span><span class="default">$operators </span><span class="keyword">= </span><span class="string">'[\/*\^\+-]'</span><span class="keyword">; </span><span class="comment">// Allowed math operators<br>&nbsp; &nbsp; </span><span class="default">$regexp </span><span class="keyword">= </span><span class="string">'/^([+-]?('</span><span class="keyword">.</span><span class="default">$number</span><span class="keyword">.</span><span class="string">'|'</span><span class="keyword">.</span><span class="default">$functions</span><span class="keyword">.</span><span class="string">'\s*\((?1)+\)|\((?1)+\))(?:'</span><span class="keyword">.</span><span class="default">$operators</span><span class="keyword">.</span><span class="string">'(?1))?)+$/'</span><span class="keyword">; </span><span class="comment">// Final regexp, heavily using recursive patterns<br><br>&nbsp; &nbsp; </span><span class="keyword">if (</span><span class="default">preg_match</span><span class="keyword">(</span><span class="default">$regexp</span><span class="keyword">, </span><span class="default">$equation</span><span class="keyword">))<br>&nbsp; &nbsp; {<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$equation </span><span class="keyword">= </span><span class="default">preg_replace</span><span class="keyword">(</span><span class="string">'!pi|π!'</span><span class="keyword">, </span><span class="string">'pi()'</span><span class="keyword">, </span><span class="default">$equation</span><span class="keyword">); </span><span class="comment">// Replace pi with pi function<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="keyword">echo </span><span class="string">"</span><span class="default">$equation</span><span class="string">\n"</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; eval(</span><span class="string">'$result = '</span><span class="keyword">.</span><span class="default">$equation</span><span class="keyword">.</span><span class="string">';'</span><span class="keyword">);<br>&nbsp; &nbsp; }<br>&nbsp; &nbsp; else<br>&nbsp; &nbsp; {<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$result </span><span class="keyword">= </span><span class="default">false</span><span class="keyword">;<br>&nbsp; &nbsp; }<br>&nbsp; &nbsp; return </span><span class="default">$result</span><span class="keyword">;<br>}<br></span><span class="default">?&gt;</span>
</span>
</code></div>
  </div>
 </div>
  <div class="note" id="102698">  
  <a class="name">
  <strong class="user"><em>Mark Simon</em></strong></a><div class="date" title="2011-03-01 03:29"><strong>3 years ago</strong></div>
  <div class="text" id="Hcom102698">
<div class="phpcode"><code><span class="html">
I have looked for a simple way of forcing PHP to interpolate strings after the event (that is, after they have already been assigned, say from a text file).<br><br>The following seems to work:<br><br><span class="default">&lt;?php<br>&nbsp; &nbsp; $text</span><span class="keyword">=</span><span class="string">'$a + $b = $c'</span><span class="keyword">;<br>&nbsp; &nbsp; </span><span class="default">$a</span><span class="keyword">=</span><span class="default">2</span><span class="keyword">; </span><span class="default">$b</span><span class="keyword">=</span><span class="default">3</span><span class="keyword">; </span><span class="default">$c</span><span class="keyword">=</span><span class="default">$a</span><span class="keyword">+</span><span class="default">$b</span><span class="keyword">;<br>&nbsp; &nbsp; print eval(</span><span class="string">"return&lt;&lt;&lt;END\n</span><span class="default">$text</span><span class="string">\nEND;\n"</span><span class="keyword">);<br></span><span class="default">?&gt;<br></span><br>I have even tried it with some potentially evil code, but the context seems to preclude interpreting it as anything other than a string.<br><br>Mark</span>
</code></div>
  </div>
 </div>
  <div class="note" id="86884">  
  <a class="name">
  <strong class="user"><em>maurice at chandoo dot de</em></strong></a><div class="date" title="2008-11-07 03:20"><strong>5 years ago</strong></div>
  <div class="text" id="Hcom86884">
<div class="phpcode"><code><span class="html">
<span class="default">&lt;?php
<br></span><span class="keyword">function </span><span class="default">safe_eval</span><span class="keyword">(</span><span class="default">$code</span><span class="keyword">,&amp;</span><span class="default">$status</span><span class="keyword">) { </span><span class="comment">//status 0=failed,1=all clear
<br>&nbsp; &nbsp; //Signs
<br>&nbsp; &nbsp; &nbsp; &nbsp; //Can't assign stuff
<br>&nbsp; &nbsp; </span><span class="default">$bl_signs </span><span class="keyword">= array(</span><span class="string">"="</span><span class="keyword">);
<br>
<br>&nbsp; &nbsp; </span><span class="comment">//Language constructs
<br>&nbsp; &nbsp; </span><span class="default">$bl_constructs </span><span class="keyword">= array(</span><span class="string">"print"</span><span class="keyword">,</span><span class="string">"echo"</span><span class="keyword">,</span><span class="string">"require"</span><span class="keyword">,</span><span class="string">"include"</span><span class="keyword">,</span><span class="string">"if"</span><span class="keyword">,</span><span class="string">"else"</span><span class="keyword">,
<br></span><span class="string">"while"</span><span class="keyword">,</span><span class="string">"for"</span><span class="keyword">,</span><span class="string">"switch"</span><span class="keyword">,</span><span class="string">"exit"</span><span class="keyword">,</span><span class="string">"break"</span><span class="keyword">);&nbsp; &nbsp; 
<br>
<br>&nbsp; &nbsp; </span><span class="comment">//Functions
<br>&nbsp; &nbsp; </span><span class="default">$funcs </span><span class="keyword">= </span><span class="default">get_defined_functions</span><span class="keyword">();
<br>&nbsp; &nbsp; </span><span class="default">$funcs </span><span class="keyword">= </span><span class="default">array_merge</span><span class="keyword">(</span><span class="default">$funcs</span><span class="keyword">[</span><span class="string">'internal'</span><span class="keyword">],</span><span class="default">$funcs</span><span class="keyword">[</span><span class="string">'user'</span><span class="keyword">]);
<br>
<br>&nbsp; &nbsp; </span><span class="comment">//Functions allowed&nbsp; &nbsp; &nbsp; &nbsp; 
<br>&nbsp; &nbsp; &nbsp; &nbsp; //Math cant be evil, can it?
<br>&nbsp; &nbsp; </span><span class="default">$whitelist </span><span class="keyword">= array(</span><span class="string">"pow"</span><span class="keyword">,</span><span class="string">"exp"</span><span class="keyword">,</span><span class="string">"abs"</span><span class="keyword">,</span><span class="string">"sin"</span><span class="keyword">,</span><span class="string">"cos"</span><span class="keyword">,</span><span class="string">"tan"</span><span class="keyword">);
<br>&nbsp; &nbsp; 
<br>&nbsp; &nbsp; </span><span class="comment">//Remove whitelist elements
<br>&nbsp; &nbsp; </span><span class="keyword">foreach(</span><span class="default">$whitelist </span><span class="keyword">as </span><span class="default">$f</span><span class="keyword">) {
<br>&nbsp; &nbsp; &nbsp; &nbsp; unset(</span><span class="default">$funcs</span><span class="keyword">[</span><span class="default">array_search</span><span class="keyword">(</span><span class="default">$f</span><span class="keyword">,</span><span class="default">$funcs</span><span class="keyword">)]);&nbsp; &nbsp; 
<br>&nbsp; &nbsp; }
<br>&nbsp; &nbsp; </span><span class="comment">//Append '(' to prevent confusion (e.g. array() and array_fill())
<br>&nbsp; &nbsp; </span><span class="keyword">foreach(</span><span class="default">$funcs </span><span class="keyword">as </span><span class="default">$key </span><span class="keyword">=&gt; </span><span class="default">$val</span><span class="keyword">) {
<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$funcs</span><span class="keyword">[</span><span class="default">$key</span><span class="keyword">] = </span><span class="default">$val</span><span class="keyword">.</span><span class="string">"("</span><span class="keyword">;
<br>&nbsp; &nbsp; }
<br>&nbsp; &nbsp; </span><span class="default">$blacklist </span><span class="keyword">= </span><span class="default">array_merge</span><span class="keyword">(</span><span class="default">$bl_signs</span><span class="keyword">,</span><span class="default">$bl_constructs</span><span class="keyword">,</span><span class="default">$funcs</span><span class="keyword">);
<br>&nbsp; &nbsp; 
<br>&nbsp; &nbsp; </span><span class="comment">//Check
<br>&nbsp; &nbsp; </span><span class="default">$status</span><span class="keyword">=</span><span class="default">1</span><span class="keyword">;
<br>&nbsp; &nbsp; foreach(</span><span class="default">$blacklist </span><span class="keyword">as </span><span class="default">$nono</span><span class="keyword">) {
<br>&nbsp; &nbsp; &nbsp; &nbsp; if(</span><span class="default">strpos</span><span class="keyword">(</span><span class="default">$code</span><span class="keyword">,</span><span class="default">$nono</span><span class="keyword">) !== </span><span class="default">false</span><span class="keyword">) {
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$status </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">;
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; return </span><span class="default">0</span><span class="keyword">;
<br>&nbsp; &nbsp; &nbsp; &nbsp; }
<br>&nbsp; &nbsp; }
<br>
<br>&nbsp; &nbsp; </span><span class="comment">//Eval
<br>&nbsp; &nbsp; </span><span class="keyword">return @eval(</span><span class="default">$code</span><span class="keyword">);
<br>}
<br></span><span class="default">?&gt;
<br></span>
<br>Note: Try to include this after all of your other self-defined functions and consider whether the blacklist is appropriate for your purpose
<br>
<br>I wouldn't recommend this function if you're going to use eval extensively in your script. However, it's worth a try if you are going to put user input into eval</span>
</code></div>
  </div>
 </div>
  <div class="note" id="75389">  
  <a class="name">
  <strong class="user"><em>udo dot schroeter at gmail dot com</em></strong></a><div class="date" title="2007-05-26 11:40"><strong>7 years ago</strong></div>
  <div class="text" id="Hcom75389">
<div class="phpcode"><code><span class="html">
Safer Eval<br><br>eval() is used way to often. It slows down code, makes it harder to maintain and it created security risks. However, sometimes, I found myself wishing I could allow some user-controlled scripting in my software, without giving access to dangerous functions. <br><br>That's what the following class does: it uses PHP's tokenizer to parse a script, compares every function call against a list of allowed functions. Only if the script is "clean", it gets eval'd.<br><br><span class="default">&lt;?php<br>&nbsp; </span><span class="keyword">class </span><span class="default">SaferScript </span><span class="keyword">{<br>&nbsp; &nbsp; var </span><span class="default">$source</span><span class="keyword">, </span><span class="default">$allowedCalls</span><span class="keyword">;<br>&nbsp; &nbsp; <br>&nbsp; &nbsp; function </span><span class="default">SaferScript</span><span class="keyword">(</span><span class="default">$scriptText</span><span class="keyword">) {<br>&nbsp; &nbsp; &nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">source </span><span class="keyword">= </span><span class="default">$scriptText</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">allowedCalls </span><span class="keyword">= array();&nbsp; &nbsp; &nbsp; <br>&nbsp; &nbsp; }<br>&nbsp; <br>&nbsp; &nbsp; function </span><span class="default">allowHarmlessCalls</span><span class="keyword">() {<br>&nbsp; &nbsp; &nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">allowedCalls </span><span class="keyword">= </span><span class="default">explode</span><span class="keyword">(</span><span class="string">','</span><span class="keyword">, <br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="string">'explode,implode,date,time,round,trunc,rand,ceil,floor,srand,'</span><span class="keyword">.<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="string">'strtolower,strtoupper,substr,stristr,strpos,print,print_r'</span><span class="keyword">);&nbsp; &nbsp; <br>&nbsp; &nbsp; }<br>&nbsp; &nbsp; <br>&nbsp; &nbsp; function </span><span class="default">parse</span><span class="keyword">() {<br>&nbsp; &nbsp; &nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">parseErrors </span><span class="keyword">= array();<br>&nbsp; &nbsp; &nbsp; </span><span class="default">$tokens </span><span class="keyword">= </span><span class="default">token_get_all</span><span class="keyword">(</span><span class="string">'&lt;?'</span><span class="keyword">.</span><span class="string">'php '</span><span class="keyword">.</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">source</span><span class="keyword">.</span><span class="string">' ?'</span><span class="keyword">.</span><span class="string">'&gt;'</span><span class="keyword">);&nbsp; &nbsp; <br>&nbsp; &nbsp; &nbsp; </span><span class="default">$vcall </span><span class="keyword">= </span><span class="string">''</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; <br>&nbsp; &nbsp; &nbsp; foreach (</span><span class="default">$tokens </span><span class="keyword">as </span><span class="default">$token</span><span class="keyword">) {<br>&nbsp; &nbsp; &nbsp; &nbsp; if (</span><span class="default">is_array</span><span class="keyword">(</span><span class="default">$token</span><span class="keyword">)) {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$id </span><span class="keyword">= </span><span class="default">$token</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">];<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; switch (</span><span class="default">$id</span><span class="keyword">) {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; case(</span><span class="default">T_VARIABLE</span><span class="keyword">): { </span><span class="default">$vcall </span><span class="keyword">.= </span><span class="string">'v'</span><span class="keyword">; break; }<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; case(</span><span class="default">T_STRING</span><span class="keyword">): { </span><span class="default">$vcall </span><span class="keyword">.= </span><span class="string">'s'</span><span class="keyword">; }<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; case(</span><span class="default">T_REQUIRE_ONCE</span><span class="keyword">): case(</span><span class="default">T_REQUIRE</span><span class="keyword">): case(</span><span class="default">T_NEW</span><span class="keyword">): case(</span><span class="default">T_RETURN</span><span class="keyword">): <br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; case(</span><span class="default">T_BREAK</span><span class="keyword">): case(</span><span class="default">T_CATCH</span><span class="keyword">): case(</span><span class="default">T_CLONE</span><span class="keyword">): case(</span><span class="default">T_EXIT</span><span class="keyword">): <br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; case(</span><span class="default">T_PRINT</span><span class="keyword">): case(</span><span class="default">T_GLOBAL</span><span class="keyword">): case(</span><span class="default">T_ECHO</span><span class="keyword">): case(</span><span class="default">T_INCLUDE_ONCE</span><span class="keyword">): <br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; case(</span><span class="default">T_INCLUDE</span><span class="keyword">): case(</span><span class="default">T_EVAL</span><span class="keyword">): case(</span><span class="default">T_FUNCTION</span><span class="keyword">): { <br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if (</span><span class="default">array_search</span><span class="keyword">(</span><span class="default">$token</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">], </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">allowedCalls</span><span class="keyword">) === </span><span class="default">false</span><span class="keyword">)<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">parseErrors</span><span class="keyword">[] = </span><span class="string">'illegal call: '</span><span class="keyword">.</span><span class="default">$token</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">];<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br>&nbsp; &nbsp; &nbsp; &nbsp; }&nbsp; &nbsp;&nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; else <br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$vcall </span><span class="keyword">.= </span><span class="default">$token</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; }<br>&nbsp; &nbsp; &nbsp; <br>&nbsp; &nbsp; &nbsp; if (</span><span class="default">stristr</span><span class="keyword">(</span><span class="default">$vcall</span><span class="keyword">, </span><span class="string">'v('</span><span class="keyword">) != </span><span class="string">''</span><span class="keyword">) <br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">parseErrors</span><span class="keyword">[] = array(</span><span class="string">'illegal dynamic function call'</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; <br>&nbsp; &nbsp; &nbsp; return(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">parseErrors</span><span class="keyword">);<br>&nbsp; &nbsp; }<br>&nbsp; <br>&nbsp; &nbsp; function </span><span class="default">execute</span><span class="keyword">(</span><span class="default">$parameters </span><span class="keyword">= array()) {<br>&nbsp; &nbsp; &nbsp; foreach (</span><span class="default">$parameters </span><span class="keyword">as </span><span class="default">$k </span><span class="keyword">=&gt; </span><span class="default">$v</span><span class="keyword">)<br>&nbsp; &nbsp; &nbsp; &nbsp; $</span><span class="default">$k </span><span class="keyword">= </span><span class="default">$v</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; if (</span><span class="default">sizeof</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">parseErrors</span><span class="keyword">) == </span><span class="default">0</span><span class="keyword">)<br>&nbsp; &nbsp; &nbsp; &nbsp; eval(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">source</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; else<br>&nbsp; &nbsp; &nbsp; &nbsp; print(</span><span class="string">'cannot execute, script contains errors'</span><span class="keyword">);<br>&nbsp; &nbsp; }&nbsp; <br>&nbsp; }<br></span><span class="default">?&gt;<br></span><br>Usage example:<br><span class="default">&lt;?php<br>&nbsp; $ls </span><span class="keyword">= new </span><span class="default">SaferScript</span><span class="keyword">(</span><span class="string">'horribleCode();'</span><span class="keyword">);<br>&nbsp; </span><span class="default">$ls</span><span class="keyword">-&gt;</span><span class="default">allowHarmlessCalls</span><span class="keyword">();<br>&nbsp; </span><span class="default">print_r</span><span class="keyword">(</span><span class="default">$ls</span><span class="keyword">-&gt;</span><span class="default">parse</span><span class="keyword">());<br>&nbsp; </span><span class="default">$ls</span><span class="keyword">-&gt;</span><span class="default">execute</span><span class="keyword">();<br></span><span class="default">?&gt;<br></span><br>Of course it is not entirely safe, but it's a start ;-)</span>
</code></div>
  </div>
 </div>
  <div class="note" id="61247">  
  <a class="name">
  <strong class="user"><em>jkuckartz1984 at hotmail dot com</em></strong></a><div class="date" title="2006-01-29 04:01"><strong>8 years ago</strong></div>
  <div class="text" id="Hcom61247">
<div class="phpcode"><code><span class="html">
Might you have to do eval in if statements, you will find it's quite some task to make it work.<br><br>The only way to make it work is to make a reference to the eval'd variable. This example will show the different usage of eval in if-statements. It simply becomes clear that an eval() in an if() is not working as you want to.<br><br><span class="default">&lt;?php<br>$total2</span><span class="keyword">=</span><span class="default">5</span><span class="keyword">;<br></span><span class="default">$total3</span><span class="keyword">=</span><span class="default">0</span><span class="keyword">;<br></span><span class="default">$i</span><span class="keyword">=</span><span class="default">2</span><span class="keyword">;<br>if (eval(</span><span class="string">"\$total"</span><span class="keyword">.</span><span class="default">$i</span><span class="keyword">.</span><span class="string">";"</span><span class="keyword">)) {<br>&nbsp; &nbsp; echo </span><span class="string">"eval: total2 is full&lt;br&gt;"</span><span class="keyword">;<br>} else {<br>&nbsp; &nbsp; echo </span><span class="string">"eval: total2 is empty&lt;br&gt;"</span><span class="keyword">;<br>}<br></span><span class="comment">// returns "empty"<br>// eval without the ";" will generate a warning<br><br></span><span class="default">$str</span><span class="keyword">=</span><span class="string">"\$refer=&amp;\$total"</span><span class="keyword">.</span><span class="default">$i</span><span class="keyword">.</span><span class="string">";"</span><span class="keyword">;<br>eval(</span><span class="default">$str</span><span class="keyword">);<br>if (</span><span class="default">$refer</span><span class="keyword">) {<br>&nbsp; &nbsp; echo </span><span class="string">"eval: total2 is full&lt;br&gt;"</span><span class="keyword">;<br>} else {<br>&nbsp; &nbsp; echo </span><span class="string">"eval: total2 is empty&lt;br&gt;"</span><span class="keyword">;<br>}<br></span><span class="comment">// returns "full"<br></span><span class="default">?&gt;</span>
</span>
</code></div>
  </div>
 </div>
  <div class="note" id="53706">  
  <a class="name">
  <strong class="user"><em>1413 at blargh dot com</em></strong></a><div class="date" title="2005-06-09 12:58"><strong>9 years ago</strong></div>
  <div class="text" id="Hcom53706">
<div class="phpcode"><code><span class="html">
Just a note when using eval and expecting return values - the eval()'ed string must do the returning.&nbsp; Take the following example script:<br><br><span class="default">&lt;?php<br><br></span><span class="keyword">function </span><span class="default">ReturnArray</span><span class="keyword">()<br>{<br>&nbsp; return array(</span><span class="string">"foo"</span><span class="keyword">=&gt;</span><span class="default">1</span><span class="keyword">, </span><span class="string">"bar"</span><span class="keyword">=&gt;</span><span class="default">2</span><span class="keyword">);<br>}<br><br></span><span class="default">$test </span><span class="keyword">= eval(</span><span class="string">"ReturnArray();"</span><span class="keyword">);<br>print(</span><span class="string">"Got back </span><span class="default">$test</span><span class="string"> ("</span><span class="keyword">.</span><span class="default">count</span><span class="keyword">(</span><span class="default">$test</span><span class="keyword">).</span><span class="string">")\n"</span><span class="keyword">);<br><br></span><span class="default">$test </span><span class="keyword">= eval(</span><span class="string">"return ReturnArray();"</span><span class="keyword">);<br>print(</span><span class="string">"Got back </span><span class="default">$test</span><span class="string"> ("</span><span class="keyword">.</span><span class="default">count</span><span class="keyword">(</span><span class="default">$test</span><span class="keyword">).</span><span class="string">")\n"</span><span class="keyword">);<br><br></span><span class="default">?&gt;<br></span><br>You will get back:<br><br>Got back&nbsp; (0)<br>Got back Array (2)<br><br>This ran me afoul for a little bit, but is the way eval() is supposed to work (eval is evaluating a new PHP script).</span>
</code></div>
  </div>
 </div>
  <div class="note" id="50421">  
  <a class="name">
  <strong class="user"><em>francois at bonzon dot com</em></strong></a><div class="date" title="2005-02-27 07:20"><strong>9 years ago</strong></div>
  <div class="text" id="Hcom50421">
<div class="phpcode"><code><span class="html">
An obvious security reminder, which I think wasn't yet mentioned here. Special care is required when variables entered by the user are passed to the eval() function. You should validate those user inputs, and really make sure they have the format you expect.<br><br>E.g., if you evaluate math expressions with something like<br><br><span class="default">&lt;?php<br>&nbsp; </span><span class="keyword">eval(</span><span class="string">"\$result = </span><span class="default">$equation</span><span class="string">;"</span><span class="keyword">);<br></span><span class="default">?&gt;<br></span><br>without any check on the $equation variable, a bad user could enter in the $equation field<br><br>""; echo file_get_contents('/etc/passwd')<br><br>- or whatever PHP code he wants! - which would evaluate to<br><br><span class="default">&lt;?php<br>&nbsp; $result </span><span class="keyword">= </span><span class="string">""</span><span class="keyword">; echo </span><span class="default">file_get_contents</span><span class="keyword">(</span><span class="string">'/etc/passwd'</span><span class="keyword">);<br></span><span class="default">?&gt;<br></span><br>and seriously compromising your security!</span>
</code></div>
  </div>
 </div>
  <div class="note" id="44760">  
  <a class="name">
  <strong class="user"><em>evildictaitor at hotmail dot com</em></strong></a><div class="date" title="2004-08-15 01:00"><strong>10 years ago</strong></div>
  <div class="text" id="Hcom44760">
<div class="phpcode"><code><span class="html">
Be careful when using eval() on heavy usage sites in PHP 4.0+ as it takes vastly longer to activate due to the limitations of the Zend engine.<br><br>The Zend engine changes the PHP to a binary structure at the START of the file, and then parses it. Every time an eval is called, however, it has to reactivate the parsing procedure and convert the eval()'d code into usable binary format again.<br><br>Basically, if you eval() code, it takes as long as calling a new php page with the same code inside.</span>
</code></div>
  </div>
 </div>
  <div class="note" id="92603">  
  <a class="name">
  <strong class="user"><em>cmr at expansys dot com</em></strong></a><div class="date" title="2009-07-31 12:20"><strong>5 years ago</strong></div>
  <div class="text" id="Hcom92603">
<div class="phpcode"><code><span class="html">
Fixed matheval function when percentage is less than 10:
<br>
<br><span class="default">&lt;?php
<br></span><span class="keyword">function </span><span class="default">matheval</span><span class="keyword">(</span><span class="default">$equation</span><span class="keyword">)
<br>&nbsp; {
<br>&nbsp; &nbsp; </span><span class="default">$equation </span><span class="keyword">= </span><span class="default">preg_replace</span><span class="keyword">(</span><span class="string">"/[^0-9+\-.*\/()%]/"</span><span class="keyword">,</span><span class="string">""</span><span class="keyword">,</span><span class="default">$equation</span><span class="keyword">);
<br>&nbsp; &nbsp; </span><span class="comment">// fix percentage calcul when percentage value &lt; 10
<br>&nbsp; &nbsp; </span><span class="default">$equation </span><span class="keyword">= </span><span class="default">preg_replace</span><span class="keyword">(</span><span class="string">"/([+-])([0-9]{1})(%)/"</span><span class="keyword">,</span><span class="string">"*(1\$1.0\$2)"</span><span class="keyword">,</span><span class="default">$equation</span><span class="keyword">);
<br>&nbsp; &nbsp; </span><span class="comment">// calc percentage
<br>&nbsp; &nbsp; </span><span class="default">$equation </span><span class="keyword">= </span><span class="default">preg_replace</span><span class="keyword">(</span><span class="string">"/([+-])([0-9]+)(%)/"</span><span class="keyword">,</span><span class="string">"*(1\$1.\$2)"</span><span class="keyword">,</span><span class="default">$equation</span><span class="keyword">);
<br>&nbsp; &nbsp; </span><span class="comment">// you could use str_replace on this next line
<br>&nbsp; &nbsp; // if you really, really want to fine-tune this equation
<br>&nbsp; &nbsp; </span><span class="default">$equation </span><span class="keyword">= </span><span class="default">preg_replace</span><span class="keyword">(</span><span class="string">"/([0-9]+)(%)/"</span><span class="keyword">,</span><span class="string">".\$1"</span><span class="keyword">,</span><span class="default">$equation</span><span class="keyword">);
<br>&nbsp; &nbsp; if ( </span><span class="default">$equation </span><span class="keyword">== </span><span class="string">"" </span><span class="keyword">)
<br>&nbsp; &nbsp; {
<br>&nbsp; &nbsp; &nbsp; </span><span class="default">$return </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">;
<br>&nbsp; &nbsp; }
<br>&nbsp; &nbsp; else
<br>&nbsp; &nbsp; {
<br>&nbsp; &nbsp; &nbsp; eval(</span><span class="string">"\$return=" </span><span class="keyword">. </span><span class="default">$equation </span><span class="keyword">. </span><span class="string">";" </span><span class="keyword">);
<br>&nbsp; &nbsp; }
<br>&nbsp; &nbsp; return </span><span class="default">$return</span><span class="keyword">;
<br>&nbsp; }
<br></span><span class="default">?&gt;</span>
</span>
</code></div>
  </div>
 </div>
  <div class="note" id="99891">  
  <a class="name">
  <strong class="user"><em>php at rijkvanwel dot nl</em></strong></a><div class="date" title="2010-09-13 07:41"><strong>3 years ago</strong></div>
  <div class="text" id="Hcom99891">
<div class="phpcode"><code><span class="html">
To catch a parse error in eval()'ed code with a custom error handler, use error_get_last() (PHP &gt;= 5.2.0).<br><br><span class="default">&lt;?php<br>$return </span><span class="keyword">= eval( </span><span class="string">'parse error' </span><span class="keyword">);<br><br>if ( </span><span class="default">$return </span><span class="keyword">=== </span><span class="default">false </span><span class="keyword">&amp;&amp; ( </span><span class="default">$error </span><span class="keyword">= </span><span class="default">error_get_last</span><span class="keyword">() ) ) {<br>&nbsp; &nbsp; </span><span class="default">myErrorHandler</span><span class="keyword">( </span><span class="default">$error</span><span class="keyword">[</span><span class="string">'type'</span><span class="keyword">], </span><span class="default">$error</span><span class="keyword">[</span><span class="string">'message'</span><span class="keyword">], </span><span class="default">$error</span><span class="keyword">[</span><span class="string">'file'</span><span class="keyword">], </span><span class="default">$error</span><span class="keyword">[</span><span class="string">'line'</span><span class="keyword">], </span><span class="default">null </span><span class="keyword">);<br><br>&nbsp; &nbsp; </span><span class="comment">// Since the "execution of the following code continues normally", as stated in the manual,<br>&nbsp; &nbsp; // we still have to exit explicitly in case of an error<br>&nbsp; &nbsp; </span><span class="keyword">exit;<br>}<br></span><span class="default">?&gt;</span>
</span>
</code></div>
  </div>
 </div>
  <div class="note" id="84140">  
  <a class="name">
  <strong class="user"><em>marco at harddisk dot is-a-geek dot org</em></strong></a><div class="date" title="2008-06-30 10:44"><strong>6 years ago</strong></div>
  <div class="text" id="Hcom84140">
<div class="phpcode"><code><span class="html">
eval does not work reliably in conjunction with global, at least not in the cygwin port version.<br><br>So:<br><span class="default">&lt;?PHP<br></span><span class="keyword">class </span><span class="default">foo </span><span class="keyword">{<br>&nbsp; </span><span class="comment">//my class...<br></span><span class="keyword">}<br>function </span><span class="default">load_module</span><span class="keyword">(</span><span class="default">$module</span><span class="keyword">) {<br>&nbsp; eval(</span><span class="string">"global \$"</span><span class="keyword">.</span><span class="default">$module</span><span class="keyword">.</span><span class="string">"_var;"</span><span class="keyword">);<br>&nbsp; eval(</span><span class="string">"\$"</span><span class="keyword">.</span><span class="default">$module</span><span class="keyword">.</span><span class="string">"_var=&amp;new foo();"</span><span class="keyword">);<br>&nbsp; </span><span class="comment">//various stuff ... ...<br></span><span class="keyword">}<br></span><span class="default">load_module</span><span class="keyword">(</span><span class="string">"foo"</span><span class="keyword">);<br></span><span class="default">?&gt;<br></span><br>becomes to working:<br><br><span class="default">&lt;?PHP<br></span><span class="keyword">class </span><span class="default">foo </span><span class="keyword">{<br>&nbsp; </span><span class="comment">//my class...<br></span><span class="keyword">}<br>function </span><span class="default">load_module</span><span class="keyword">(</span><span class="default">$module</span><span class="keyword">) {<br>&nbsp; eval(</span><span class="string">'$GLOBALS["'</span><span class="keyword">.</span><span class="default">$module</span><span class="keyword">.</span><span class="string">'_var"]=&amp;new foo();'</span><span class="keyword">);<br>&nbsp; </span><span class="comment">//various stuff ... ...<br></span><span class="keyword">}<br></span><span class="default">load_module</span><span class="keyword">(</span><span class="string">"foo"</span><span class="keyword">);<br></span><span class="default">?&gt;<br></span><br>Note in the 2nd example, you _always_ need to use $GLOBALS[$module] to access the variable!</span>
</code></div>
  </div>
 </div>
  <div class="note" id="81376">  
  <a class="name">
  <strong class="user"><em>Ipseno at yahoo dot com</em></strong></a><div class="date" title="2008-02-25 10:24"><strong>6 years ago</strong></div>
  <div class="text" id="Hcom81376">
<div class="phpcode"><code><span class="html">
If you attempt to call a user defined function in eval() and .php files are obfuscated by Zend encoder, it will result in a fatal error.<br><br>Use a call_user_func() inside eval() to call your personal hand made functions.<br><br>This is user function<br><span class="default">&lt;?php<br><br></span><span class="keyword">function </span><span class="default">square_it</span><span class="keyword">(</span><span class="default">$nmb</span><span class="keyword">)<br>{<br>&nbsp; &nbsp; return </span><span class="default">$nmb </span><span class="keyword">* </span><span class="default">$nmb</span><span class="keyword">;<br>}<br><br></span><span class="default">?&gt;<br></span><br>//Checking if eval sees it?<br><span class="default">&lt;?php<br><br>$code </span><span class="keyword">= </span><span class="default">var_export</span><span class="keyword">( </span><span class="default">function_exists</span><span class="keyword">(</span><span class="string">'square_it'</span><span class="keyword">) );<br><br>eval( </span><span class="default">$code </span><span class="keyword">);&nbsp; &nbsp; </span><span class="comment">//returns TRUE - so yes it does!<br><br></span><span class="default">?&gt;<br></span><br>This will result in a fatal error:<br>PHP Fatal error:&nbsp; Call to undefined function square_it()<br><span class="default">&lt;?php<br><br>$code </span><span class="keyword">= </span><span class="string">'echo square_it(55);' </span><span class="keyword">;<br><br>eval( </span><span class="default">$code </span><span class="keyword">);<br><br></span><span class="default">?&gt;<br></span><br>This will work<br><span class="default">&lt;?php<br><br>$code </span><span class="keyword">= </span><span class="string">'echo call_user_func(\'square_it\', 55);' </span><span class="keyword">;<br><br>eval( </span><span class="default">$code </span><span class="keyword">);<br><br></span><span class="default">?&gt;</span>
</span>
</code></div>
  </div>
 </div>
  <div class="note" id="66631">  
  <a class="name">
  <strong class="user"><em>burninleo at gmx dot net</em></strong></a><div class="date" title="2006-05-25 05:51"><strong>8 years ago</strong></div>
  <div class="text" id="Hcom66631">
<div class="phpcode"><code><span class="html">
The only way to retreive information on parse errors in eval'd code seems to be the output buffering.<br><br><span class="default">&lt;?PHP<br></span><span class="comment">// Append a return true to php-code to check on errors<br></span><span class="default">$code</span><span class="keyword">.= </span><span class="string">"\nreturn true;"</span><span class="keyword">;<br></span><span class="comment">// Send any output to buffer<br></span><span class="default">ob_start</span><span class="keyword">();<br></span><span class="comment">// Do eval()<br></span><span class="default">$check </span><span class="keyword">= eval(</span><span class="default">$code</span><span class="keyword">);<br></span><span class="default">$output </span><span class="keyword">= </span><span class="default">ob_get_contents</span><span class="keyword">();<br></span><span class="default">ob_end_clean</span><span class="keyword">();<br></span><span class="comment">// Send output or report errors<br></span><span class="keyword">if (</span><span class="default">$check </span><span class="keyword">=== </span><span class="default">true</span><span class="keyword">) {<br>&nbsp; echo </span><span class="default">$output</span><span class="keyword">;<br>} else {<br>&nbsp; </span><span class="comment">// Manually parse output for errors and<br>&nbsp; // generate usable information for the user<br>&nbsp; // especially content of error-lines.<br>&nbsp; </span><span class="default">$pattern </span><span class="keyword">= </span><span class="string">'/^\s*Parse error\s*:(.+) in (.+) on line (\d+)\s*$/m'</span><span class="keyword">;<br>&nbsp; </span><span class="default">etc </span><span class="keyword">...<br>}</span>
</span>
</code></div>
  </div>
 </div></div>

 
</section>    </section><!-- layout-content -->
        


  </div><!-- layout -->
         
  

    
 <!-- External and third party libraries. -->
 







<a id="toTop" href="javascript:;"><span id="toTopHover"></span><img width="40" height="40" alt="To Top" src="../../images/to-top%402x.png"></a>



<!-- Mirrored from php.net/manual/en/function.eval.php by HTTrack Website Copier/3.x [XR&CO'2013], Thu, 28 Aug 2014 16:04:53 GMT -->


</body></html>