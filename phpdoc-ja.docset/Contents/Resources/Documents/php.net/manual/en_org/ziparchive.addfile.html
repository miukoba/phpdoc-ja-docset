<html><!-- Mirrored from php.net/manual/en/ziparchive.addfile.php by HTTrack Website Copier/3.x [XR&CO'2013], Thu, 28 Aug 2014 16:15:48 GMT --><!-- Added by HTTrack --><head><meta http-equiv="content-type" content="text/html;charset=utf-8"><!-- /Added by HTTrack -->


  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0"> 

  <title>ZipArchive::addFile</title>

 <link rel="shortcut icon" href="../../favicon.ico">
 <link rel="search" type="application/opensearchdescription+xml" href="http://php.net/phpnetimprovedsearch.src" title="Add PHP.net search">
 <link rel="alternate" type="application/atom+xml" href="http://php.net/releases/feed.php" title="PHP Release feed">
 <link rel="alternate" type="application/atom+xml" href="http://php.net/feed.atom" title="PHP: Hypertext Preprocessor">

 <link rel="canonical" href="ziparchive.addfile.html">
 <link rel="shorturl" href="ziparchive.addfile.html">
 <link rel="alternate" href="ziparchive.addfile.html" hreflang="x-default">

 <link rel="contents" href="index-2.html">
 <link rel="index" href="class.ziparchive.html">
 <link rel="prev" href="ziparchive.addemptydir.html">
 <link rel="next" href="ziparchive.addfromstring.html">

 <link rel="alternate" href="ziparchive.addfile.html" hreflang="en">
 <link rel="alternate" href="http://php.net/manual/pt_BR/ziparchive.addfile.php" hreflang="pt_BR">
 <link rel="alternate" href="http://php.net/manual/zh/ziparchive.addfile.php" hreflang="zh">
 <link rel="alternate" href="http://php.net/manual/fr/ziparchive.addfile.php" hreflang="fr">
 <link rel="alternate" href="http://php.net/manual/de/ziparchive.addfile.php" hreflang="de">
 <link rel="alternate" href="http://php.net/manual/it/ziparchive.addfile.php" hreflang="it">
 <link rel="alternate" href="http://php.net/manual/ja/ziparchive.addfile.php" hreflang="ja">
 <link rel="alternate" href="http://php.net/manual/ro/ziparchive.addfile.php" hreflang="ro">
 <link rel="alternate" href="http://php.net/manual/ru/ziparchive.addfile.php" hreflang="ru">
 <link rel="alternate" href="http://php.net/manual/es/ziparchive.addfile.php" hreflang="es">
 <link rel="alternate" href="http://php.net/manual/tr/ziparchive.addfile.php" hreflang="tr">

<link rel="stylesheet" type="text/css" href="../../cached8fe1.css?t=1401250819&amp;f=/fonts/Fira/fira.css" media="screen">
<link rel="stylesheet" type="text/css" href="../../cached4b8d.css?t=1404368420&amp;f=/fonts/Font-Awesome/css/fontello.css" media="screen">
<link rel="stylesheet" type="text/css" href="../../cached5065.css?t=1403329232&amp;f=/styles/theme-base.css" media="screen">
<link rel="stylesheet" type="text/css" href="../../cachedc78d.css?t=1401249623&amp;f=/styles/theme-medium.css" media="screen">

 <!--[if lte IE 7]>
 <link rel="stylesheet" type="text/css" href="http://php.net/styles/workarounds.ie7.css" media="screen">
 <![endif]-->

 <!--[if lte IE 8]>
 <script type="text/javascript">
  window.brokenIE = true;
 </script>
 <![endif]-->

 <!--[if lte IE 9]>
 <link rel="stylesheet" type="text/css" href="http://php.net/styles/workarounds.ie9.css" media="screen">
 <![endif]-->

 <!--[if IE]>
 <script type="text/javascript" src="http://php.net/js/ext/html5.js"></script>
 <![endif]-->

 <base>

</head>
<body class="docs " style="">


<div class="headsup"><a href="http://php.net/index.php#id2014-08-28-1">PHP 5.6.0 released</a></div>
<nav id="trick"><div><dl>
<dt><a href="getting-started.html">Getting Started</a></dt>
	<dd><a href="introduction.html">Introduction</a></dd>
	<dd><a href="tutorial.html">A simple tutorial</a></dd>
<dt><a href="langref.html">Language Reference</a></dt>
	<dd><a href="language.basic-syntax.html">Basic syntax</a></dd>
	<dd><a href="language.types.html">Types</a></dd>
	<dd><a href="language.variables.html">Variables</a></dd>
	<dd><a href="language.constants.html">Constants</a></dd>
	<dd><a href="language.expressions.html">Expressions</a></dd>
	<dd><a href="language.operators.html">Operators</a></dd>
	<dd><a href="language.control-structures.html">Control Structures</a></dd>
	<dd><a href="language.functions.html">Functions</a></dd>
	<dd><a href="language.oop5.html">Classes and Objects</a></dd>
	<dd><a href="language.namespaces.html">Namespaces</a></dd>
	<dd><a href="language.exceptions.html">Exceptions</a></dd>
	<dd><a href="language.generators.html">Generators</a></dd>
	<dd><a href="language.references.html">References Explained</a></dd>
	<dd><a href="reserved.variables.html">Predefined Variables</a></dd>
	<dd><a href="reserved.exceptions.html">Predefined Exceptions</a></dd>
	<dd><a href="reserved.interfaces.html">Predefined Interfaces and Classes</a></dd>
	<dd><a href="context.html">Context options and parameters</a></dd>
	<dd><a href="wrappers.html">Supported Protocols and Wrappers</a></dd>
</dl>
<dl>
<dt><a href="security.html">Security</a></dt>
	<dd><a href="security.intro.html">Introduction</a></dd>
	<dd><a href="security.general.html">General considerations</a></dd>
	<dd><a href="security.cgi-bin.html">Installed as CGI binary</a></dd>
	<dd><a href="security.apache.html">Installed as an Apache module</a></dd>
	<dd><a href="security.filesystem.html">Filesystem Security</a></dd>
	<dd><a href="security.database.html">Database Security</a></dd>
	<dd><a href="security.errors.html">Error Reporting</a></dd>
	<dd><a href="security.globals.html">Using Register Globals</a></dd>
	<dd><a href="security.variables.html">User Submitted Data</a></dd>
	<dd><a href="security.magicquotes.html">Magic Quotes</a></dd>
	<dd><a href="security.hiding.html">Hiding PHP</a></dd>
	<dd><a href="security.current.html">Keeping Current</a></dd>
<dt><a href="features.html">Features</a></dt>
	<dd><a href="features.http-auth.html">HTTP authentication with PHP</a></dd>
	<dd><a href="features.cookies.html">Cookies</a></dd>
	<dd><a href="features.sessions.html">Sessions</a></dd>
	<dd><a href="features.xforms.html">Dealing with XForms</a></dd>
	<dd><a href="features.file-upload.html">Handling file uploads</a></dd>
	<dd><a href="features.remote-files.html">Using remote files</a></dd>
	<dd><a href="features.connection-handling.html">Connection handling</a></dd>
	<dd><a href="features.persistent-connections.html">Persistent Database Connections</a></dd>
	<dd><a href="features.safe-mode.html">Safe Mode</a></dd>
	<dd><a href="features.commandline.html">Command line usage</a></dd>
	<dd><a href="features.gc.html">Garbage Collection</a></dd>
	<dd><a href="features.dtrace.html">DTrace Dynamic Tracing</a></dd>
</dl>
<dl>
<dt><a href="funcref.html">Function Reference</a></dt>
	<dd><a href="refs.basic.php.html">Affecting PHP's Behaviour</a></dd>
	<dd><a href="refs.utilspec.audio.html">Audio Formats Manipulation</a></dd>
	<dd><a href="refs.remote.auth.html">Authentication Services</a></dd>
	<dd><a href="refs.utilspec.cmdline.html">Command Line Specific Extensions</a></dd>
	<dd><a href="refs.compression.html">Compression and Archive Extensions</a></dd>
	<dd><a href="refs.creditcard.html">Credit Card Processing</a></dd>
	<dd><a href="refs.crypto.html">Cryptography Extensions</a></dd>
	<dd><a href="refs.database.html">Database Extensions</a></dd>
	<dd><a href="refs.calendar.html">Date and Time Related Extensions</a></dd>
	<dd><a href="refs.fileprocess.file.html">File System Related Extensions</a></dd>
	<dd><a href="refs.international.html">Human Language and Character Encoding Support</a></dd>
	<dd><a href="refs.utilspec.image.html">Image Processing and Generation</a></dd>
	<dd><a href="refs.remote.mail.html">Mail Related Extensions</a></dd>
	<dd><a href="refs.math.html">Mathematical Extensions</a></dd>
	<dd><a href="refs.utilspec.nontext.html">Non-Text MIME Output</a></dd>
	<dd><a href="refs.fileprocess.process.html">Process Control Extensions</a></dd>
	<dd><a href="refs.basic.other.html">Other Basic Extensions</a></dd>
	<dd><a href="refs.remote.other.html">Other Services</a></dd>
	<dd><a href="refs.search.html">Search Engine Extensions</a></dd>
	<dd><a href="refs.utilspec.server.html">Server Specific Extensions</a></dd>
	<dd><a href="refs.basic.session.html">Session Extensions</a></dd>
	<dd><a href="refs.basic.text.html">Text Processing</a></dd>
	<dd><a href="refs.basic.vartype.html">Variable and Type Related Extensions</a></dd>
	<dd><a href="refs.webservice.html">Web Services</a></dd>
	<dd><a href="refs.utilspec.windows.html">Windows Only Extensions</a></dd>
	<dd><a href="refs.xml.html">XML Manipulation</a></dd>
</dl>
<dl>
<dt>Keyboard Shortcuts</dt><dt>?</dt>
<dd>This help</dd>
<dt>j</dt>
<dd>Next menu item</dd>
<dt>k</dt>
<dd>Previous menu item</dd>
<dt>g p</dt>
<dd>Previous man page</dd>
<dt>g n</dt>
<dd>Next man page</dd>
<dt>G</dt>
<dd>Scroll to bottom</dd>
<dt>g g</dt>
<dd>Scroll to top</dd>
<dt>g h</dt>
<dd>Goto homepage</dd>
<dt>g s</dt>
<dd>Goto search<br>(current page)</dd>
<dt>/</dt>
<dd>Focus search box</dd>
</dl></div></nav>
<div id="goto">
    <div class="search">
         <div class="text"></div>
         <div class="results"><ul></ul></div>
   </div>
</div>

  <div id="breadcrumbs" class="row-fluid">
          
              
        <ul class="breadcrumbs-container">
            <li><a href="index-2.html">PHP Manual</a></li>      <li><a href="funcref.html">Function Reference</a></li>      <li><a href="refs.compression.html">Compression and Archive Extensions</a></li>      <li><a href="book.zip.html">Zip</a></li>      <li><a href="class.ziparchive.html">ZipArchive</a></li>    </ul>
  </div>




<div id="layout">
  <section id="layout-content">
  <div id="ziparchive.addfile" class="refentry">
 <div class="refnamediv">
  <h1 class="refname">ZipArchive::addFile</h1>
  <p class="verinfo">(PHP 5 &gt;= 5.2.0, PECL zip &gt;= 1.1.0)</p><p class="refpurpose"><span class="refname">ZipArchive::addFile</span> — <span class="dc-title">Adds a file to a ZIP archive from the given path</span></p>

 </div>
 <div class="refsect1 description" id="refsect1-ziparchive.addfile-description">
  <h3 class="title">Description</h3>
  <div class="methodsynopsis dc-description">
   <span class="type">bool</span> <span class="methodname"><strong>ZipArchive::addFile</strong></span>
    ( <span class="methodparam"><span class="type">string</span> <code class="parameter">$filename</code></span>
   [, <span class="methodparam"><span class="type">string</span> <code class="parameter">$localname</code><span class="initializer"> = <strong><code>NULL</code></strong></span></span>
   [, <span class="methodparam"><span class="type">int</span> <code class="parameter">$start</code><span class="initializer"> = 0</span></span>
   [, <span class="methodparam"><span class="type">int</span> <code class="parameter">$length</code><span class="initializer"> = 0</span></span>
  ]]] )</div>

  <p class="para rdfs-comment">
   Adds a file to a ZIP archive from a given path.
  </p>
 </div>

 <div class="refsect1 parameters" id="refsect1-ziparchive.addfile-parameters">
  <h3 class="title">Parameters</h3>
  <p class="para">
   </p><dl>

    
     <dt>
<code class="parameter">filename</code></dt>

     <dd>

      <p class="para">
       The path to the file to add.
      </p>
     </dd>

    
    
     <dt>
<code class="parameter">localname</code></dt>

     <dd>

      <p class="para">
       If supplied, this is the local name inside the ZIP archive that will override the <code class="parameter">filename</code>.
      </p>
     </dd>

    
    
     <dt>
<code class="parameter">start</code></dt>

     <dd>

      <p class="para">
       This parameter is not used but is required to extend <a href="class.ziparchive.html" class="classname">ZipArchive</a>.
      </p>
     </dd>

    
    
     <dt>
<code class="parameter">length</code></dt>

     <dd>

      <p class="para">
       This parameter is not used but is required to extend <a href="class.ziparchive.html" class="classname">ZipArchive</a>.
      </p>
     </dd>

    
   </dl>

  <p></p>
 </div>

 <div class="refsect1 returnvalues" id="refsect1-ziparchive.addfile-returnvalues">
  <h3 class="title">Return Values</h3>
  <p class="para">
   Returns <strong><code>TRUE</code></strong> on success or <strong><code>FALSE</code></strong> on failure.
  </p>
 </div>

 <div class="refsect1 examples" id="refsect1-ziparchive.addfile-examples">
  <h3 class="title">Examples</h3>
    <p class="para">
     This example opens a ZIP file archive
     <var class="filename">test.zip</var> and add
     the file <var class="filename">/path/to/index.txt</var>.
     as <var class="filename">newname.txt</var>.
    </p>
    <div class="example" id="example-816">
     <p><strong>Example #1 Open and add</strong></p>
     <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br>$zip&nbsp;</span><span style="color: #007700">=&nbsp;new&nbsp;</span><span style="color: #0000BB">ZipArchive</span><span style="color: #007700">;<br>if&nbsp;(</span><span style="color: #0000BB">$zip</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">open</span><span style="color: #007700">(</span><span style="color: #DD0000">'test.zip'</span><span style="color: #007700">)&nbsp;===&nbsp;</span><span style="color: #0000BB">TRUE</span><span style="color: #007700">)&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$zip</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">addFile</span><span style="color: #007700">(</span><span style="color: #DD0000">'/path/to/index.txt'</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">'newname.txt'</span><span style="color: #007700">);<br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$zip</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">close</span><span style="color: #007700">();<br>&nbsp;&nbsp;&nbsp;&nbsp;echo&nbsp;</span><span style="color: #DD0000">'ok'</span><span style="color: #007700">;<br>}&nbsp;else&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;echo&nbsp;</span><span style="color: #DD0000">'failed'</span><span style="color: #007700">;<br>}<br></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
     </div>

    </div>
   </div>

 <div class="refsect1 notes" id="refsect1-ziparchive.addfile-notes">
  <h3 class="title">Notes</h3>
  <blockquote class="note"><p><strong class="note">Note</strong>: 
   </p><p class="para">
    When a file is set to be added to the archive, PHP will lock the file. The
    lock is only released once the <a href="class.ziparchive.html" class="classname">ZipArchive</a> object
    has been closed, either via <span class="methodname"><a href="ziparchive.close.html" class="methodname">ZipArchive::close()</a></span> or
    the <a href="class.ziparchive.html" class="classname">ZipArchive</a> object being destroyed. This may
    prevent you from being able to delete the file being added until after the
    lock has been released.
   </p>
  <p></p></blockquote>
 </div>

</div>
<section id="usernotes">
 <div class="head"><h3 class="title">User Contributed Notes</h3></div><div id="allnotes">
  <div class="note" id="96382">  
  <a class="name">
  <strong class="user"><em>jayarjo</em></strong></a><div class="date" title="2010-02-24 01:44"><strong>4 years ago</strong></div>
  <div class="text" id="Hcom96382">
<div class="phpcode"><code><span class="html">
It is not obvious, since there are no noticeable examples around, but you can use $localname (second parameter) to define and control file/directory structure inside the zip. Use it if you do not want files to be included with their absolute directory tree.
<br>
<br><span class="default">&lt;?php
<br>
<br>$zip</span><span class="keyword">-&gt;</span><span class="default">addFile</span><span class="keyword">(</span><span class="default">$abs_path</span><span class="keyword">, </span><span class="default">$relative_path</span><span class="keyword">);
<br>
<br></span><span class="default">?&gt;</span>
</span>
</code></div>
  </div>
 </div>
  <div class="note" id="101605">  
  <a class="name">
  <strong class="user"><em>john factorial</em></strong></a><div class="date" title="2010-12-29 12:57"><strong>3 years ago</strong></div>
  <div class="text" id="Hcom101605">
<div class="phpcode"><code><span class="html">
Beware: calling $zip-&gt;addFile() on a file that doesn't exist will succeed and return TRUE, delaying the failure until you make the final $zip-&gt;close() call, which will return FALSE and potentially leave you scratching your head.<br><br>If you're adding multiple files to a zip and your $zip-&gt;close() call is returning FALSE, ensure that all the files you added actually exist.<br><br>It's also a good idea to check each file with file_exists() or is_readable() before calling $zip-&gt;addFile() on it.</span>
</code></div>
  </div>
 </div>
  <div class="note" id="95725">  
  <a class="name">
  <strong class="user"><em>Anonymous</em></strong></a><div class="date" title="2010-01-18 10:30"><strong>4 years ago</strong></div>
  <div class="text" id="Hcom95725">
<div class="phpcode"><code><span class="html">
On my system (Windows), I found that ZipArchive uses IBM850 encoding for filenames (localname). For filenames with special characters such as (é) &amp;eacute; which appears at 0xE9 in the ISO-8859-1, it is at 0x82 in IBM850. I had to call iconv('ISO-8859-1', 'IBM850', 'Québec') to get correct file names.</span>
</code></div>
  </div>
 </div>
  <div class="note" id="97596">  
  <a class="name">
  <strong class="user"><em>camuc at camuc dot net</em></strong></a><div class="date" title="2010-04-27 08:23"><strong>4 years ago</strong></div>
  <div class="text" id="Hcom97596">
<div class="phpcode"><code><span class="html">
In some versions of this library you NEED to add the "localfile" parameter or the file will not show in the Zip folder.</span>
</code></div>
  </div>
 </div>
  <div class="note" id="93090">  
  <a class="name">
  <strong class="user"><em>peter at boring dot ch</em></strong></a><div class="date" title="2009-08-22 06:10"><strong>5 years ago</strong></div>
  <div class="text" id="Hcom93090">
<div class="phpcode"><code><span class="html">
Here's a little extension to ZipArchive that handles directories recursively:
<br>
<br><span class="default">&lt;?php
<br>
<br></span><span class="keyword">class </span><span class="default">Zipper </span><span class="keyword">extends </span><span class="default">ZipArchive </span><span class="keyword">{
<br>&nbsp; &nbsp; 
<br>public function </span><span class="default">addDir</span><span class="keyword">(</span><span class="default">$path</span><span class="keyword">) {
<br>&nbsp; &nbsp; print </span><span class="string">'adding ' </span><span class="keyword">. </span><span class="default">$path </span><span class="keyword">. </span><span class="string">'&lt;br&gt;'</span><span class="keyword">;
<br>&nbsp; &nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">addEmptyDir</span><span class="keyword">(</span><span class="default">$path</span><span class="keyword">);
<br>&nbsp; &nbsp; </span><span class="default">$nodes </span><span class="keyword">= </span><span class="default">glob</span><span class="keyword">(</span><span class="default">$path </span><span class="keyword">. </span><span class="string">'/*'</span><span class="keyword">);
<br>&nbsp; &nbsp; foreach (</span><span class="default">$nodes </span><span class="keyword">as </span><span class="default">$node</span><span class="keyword">) {
<br>&nbsp; &nbsp; &nbsp; &nbsp; print </span><span class="default">$node </span><span class="keyword">. </span><span class="string">'&lt;br&gt;'</span><span class="keyword">;
<br>&nbsp; &nbsp; &nbsp; &nbsp; if (</span><span class="default">is_dir</span><span class="keyword">(</span><span class="default">$node</span><span class="keyword">)) {
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">addDir</span><span class="keyword">(</span><span class="default">$node</span><span class="keyword">);
<br>&nbsp; &nbsp; &nbsp; &nbsp; } else if (</span><span class="default">is_file</span><span class="keyword">(</span><span class="default">$node</span><span class="keyword">))&nbsp; {
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">addFile</span><span class="keyword">(</span><span class="default">$node</span><span class="keyword">);
<br>&nbsp; &nbsp; &nbsp; &nbsp; }
<br>&nbsp; &nbsp; }
<br>}
<br>&nbsp; &nbsp; 
<br>} </span><span class="comment">// class Zipper
<br>
<br></span><span class="default">?&gt;</span>
</span>
</code></div>
  </div>
 </div>
  <div class="note" id="110513">  
  <a class="name">
  <strong class="user"><em>Dean Rather</em></strong></a><div class="date" title="2012-10-31 03:47"><strong>1 year ago</strong></div>
  <div class="text" id="Hcom110513">
<div class="phpcode"><code><span class="html">
This add directory function does not require that you create a new wrapper class, and also does not add the entire file directory tree into your zip file.<br><br><span class="default">&lt;?php<br><br></span><span class="keyword">public function </span><span class="default">addDirectoryToZip</span><span class="keyword">(</span><span class="default">$zip</span><span class="keyword">, </span><span class="default">$dir</span><span class="keyword">, </span><span class="default">$base</span><span class="keyword">)<br>{<br>&nbsp; &nbsp; </span><span class="default">$newFolder </span><span class="keyword">= </span><span class="default">str_replace</span><span class="keyword">(</span><span class="default">$base</span><span class="keyword">, </span><span class="string">''</span><span class="keyword">, </span><span class="default">$dir</span><span class="keyword">);<br>&nbsp; &nbsp; </span><span class="default">$zip</span><span class="keyword">-&gt;</span><span class="default">addEmptyDir</span><span class="keyword">(</span><span class="default">$newFolder</span><span class="keyword">);<br>&nbsp; &nbsp; foreach(</span><span class="default">glob</span><span class="keyword">(</span><span class="default">$dir </span><span class="keyword">. </span><span class="string">'/*'</span><span class="keyword">) as </span><span class="default">$file</span><span class="keyword">)<br>&nbsp; &nbsp; {<br>&nbsp; &nbsp; &nbsp; &nbsp; if(</span><span class="default">is_dir</span><span class="keyword">(</span><span class="default">$file</span><span class="keyword">))<br>&nbsp; &nbsp; &nbsp; &nbsp; {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$zip </span><span class="keyword">= </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">addDirectoryToZip</span><span class="keyword">(</span><span class="default">$zip</span><span class="keyword">, </span><span class="default">$file</span><span class="keyword">, </span><span class="default">$base</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; }<br>&nbsp; &nbsp; &nbsp; &nbsp; else<br>&nbsp; &nbsp; &nbsp; &nbsp; {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$newFile </span><span class="keyword">= </span><span class="default">str_replace</span><span class="keyword">(</span><span class="default">$base</span><span class="keyword">, </span><span class="string">''</span><span class="keyword">, </span><span class="default">$file</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$zip</span><span class="keyword">-&gt;</span><span class="default">addFile</span><span class="keyword">(</span><span class="default">$file</span><span class="keyword">, </span><span class="default">$newFile</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; }<br>&nbsp; &nbsp; }<br>&nbsp; &nbsp; return </span><span class="default">$zip</span><span class="keyword">;<br>}<br><br></span><span class="default">?&gt;</span>
</span>
</code></div>
  </div>
 </div>
  <div class="note" id="89813">  
  <a class="name">
  <strong class="user"><em>garcia at no_span dot krautzer-lynn dot com</em></strong></a><div class="date" title="2009-03-24 06:31"><strong>5 years ago</strong></div>
  <div class="text" id="Hcom89813">
<div class="phpcode"><code><span class="html">
If you add files that have an absolut path, like for example:<br>/mnt/repository/my_file.pdf<br>the standard windows zip utility will not be able to extract the files. The first slash trips the zip utility. You have to add relative file paths or use a symbolic link.</span>
</code></div>
  </div>
 </div>
  <div class="note" id="80933">  
  <a class="name">
  <strong class="user"><em>mike at thetroubleshooters dot dk</em></strong></a><div class="date" title="2008-02-07 07:20"><strong>6 years ago</strong></div>
  <div class="text" id="Hcom80933">
<div class="phpcode"><code><span class="html">
What is worse is that when you run out of filedescriptors it seems to fail silently, I have not been able to find any errors in any logfiles.</span>
</code></div>
  </div>
 </div>
  <div class="note" id="112044">  
  <a class="name">
  <strong class="user"><em>kris at blacksuitmedia [do/t/] c0m</em></strong></a><div class="date" title="2013-04-25 08:41"><strong>1 year ago</strong></div>
  <div class="text" id="Hcom112044">
<div class="phpcode"><code><span class="html">
I had a huge number of files and folders that I needed to zip on a linux web server. I was running into timeout problems and file enumerator issues, as well as file handler limit issues (ulimit). I used a script to solve u limit offered by Farzad Ghanei first (ZipArchiveImproved), but closing and reopening his way didn't do the trick for me. <br><br>I eventually did a simple call to a $filelimit variable I created that records file handler limit I want my script to hit before it closes and reopens the file. <br><span class="default">&lt;?php<br>$filelimit </span><span class="keyword">= </span><span class="default">255</span><span class="keyword">;<br><br>if (</span><span class="default">$zip</span><span class="keyword">-&gt;</span><span class="default">numFiles </span><span class="keyword">== </span><span class="default">$filelimit</span><span class="keyword">) {</span><span class="default">$zip</span><span class="keyword">-&gt;</span><span class="default">close</span><span class="keyword">(); </span><span class="default">$zip</span><span class="keyword">-&gt;</span><span class="default">open</span><span class="keyword">(</span><span class="default">$file</span><span class="keyword">) or die (</span><span class="string">"Error: Could not reopen Zip"</span><span class="keyword">);}<br></span><span class="default">?&gt;<br></span><br>This made some progress for me, timeouts were gone, but when calling<br><span class="default">&lt;?php $zip</span><span class="keyword">-&gt;</span><span class="default">addFile</span><span class="keyword">(</span><span class="default">$filepath</span><span class="keyword">, </span><span class="default">$archivefilepath</span><span class="keyword">); </span><span class="default">?&gt;<br></span>after the reopening of the Zip, I got an error. I echoed the <span class="default">&lt;?php $zip</span><span class="keyword">-&gt;</span><span class="default">numFiles</span><span class="keyword">; </span><span class="default">?&gt;</span> and found that after reopening, the numFile enum reset to '0'. <br><br>A few more goose-chases later, I tried addFromString with some better results, but did not get it working 100% until I actually coupled addFromString with addFile! My working scripting for the add files function on massive file-folder structures looks like so: <br><br><span class="default">&lt;?php <br>$sourcefolder </span><span class="keyword">= /</span><span class="default">rel</span><span class="keyword">/</span><span class="default">path</span><span class="keyword">/</span><span class="default">to</span><span class="keyword">/</span><span class="default">source</span><span class="keyword">/</span><span class="default">folder</span><span class="keyword">/</span><span class="default">on</span><span class="keyword">/</span><span class="default">server</span><span class="keyword">/<br><br></span><span class="default">$dirlist </span><span class="keyword">= new </span><span class="default">RecursiveDirectoryIterator</span><span class="keyword">(</span><span class="default">$sourcefolder</span><span class="keyword">);<br><br></span><span class="default">$filelist </span><span class="keyword">= new </span><span class="default">RecursiveIteratorIterator</span><span class="keyword">(</span><span class="default">$dirlist</span><span class="keyword">);<br><br></span><span class="comment">//how many file can be added before a reopen is forced?<br></span><span class="default">$filelimit </span><span class="keyword">= </span><span class="default">245</span><span class="keyword">; <br><br></span><span class="comment">// Defines the action<br></span><span class="default">$file </span><span class="keyword">= </span><span class="default">tempnam</span><span class="keyword">(</span><span class="string">"tmp"</span><span class="keyword">, </span><span class="string">"zip"</span><span class="keyword">);<br></span><span class="default">$zip </span><span class="keyword">= new </span><span class="default">ZipArchive</span><span class="keyword">();<br><br></span><span class="comment">// This creates and then gives the option to save the zip file<br><br></span><span class="keyword">if (</span><span class="default">$zip</span><span class="keyword">-&gt;</span><span class="default">open</span><span class="keyword">(</span><span class="default">$file</span><span class="keyword">, </span><span class="default">ZipArchive</span><span class="keyword">::</span><span class="default">OVERWRITE</span><span class="keyword">) !== </span><span class="default">TRUE</span><span class="keyword">) {<br><br>&nbsp; &nbsp; die (</span><span class="string">"Could not open archive"</span><span class="keyword">);<br><br>}<br><br></span><span class="comment">// adds files to the file list<br></span><span class="keyword">foreach (</span><span class="default">$filelist </span><span class="keyword">as </span><span class="default">$key</span><span class="keyword">=&gt;</span><span class="default">$value</span><span class="keyword">) {<br><br>&nbsp; &nbsp; </span><span class="comment">//fix archive paths<br>&nbsp; &nbsp; </span><span class="default">$path </span><span class="keyword">= </span><span class="default">str_replace</span><span class="keyword">(</span><span class="default">$sourcefolder</span><span class="keyword">, </span><span class="string">""</span><span class="keyword">, </span><span class="default">$key</span><span class="keyword">); </span><span class="comment">//remove the source path from the $key to return only the file-folder structure from the root of the source folder<br>&nbsp; &nbsp; </span><span class="keyword">if (!</span><span class="default">file_exists</span><span class="keyword">(</span><span class="default">$key</span><span class="keyword">)) { die(</span><span class="default">$key</span><span class="keyword">.</span><span class="string">' does not exist. Please contact your administrator or try again later.'</span><span class="keyword">); }<br>&nbsp; &nbsp; &nbsp; if (!</span><span class="default">is_readable</span><span class="keyword">(</span><span class="default">$key</span><span class="keyword">)) { die(</span><span class="default">$key</span><span class="keyword">.</span><span class="string">' not readable. Please contact your administrator or try again later.'</span><span class="keyword">); }&nbsp; &nbsp;&nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if (</span><span class="default">$zip</span><span class="keyword">-&gt;</span><span class="default">numFiles </span><span class="keyword">== </span><span class="default">$filelimit</span><span class="keyword">) {</span><span class="default">$zip</span><span class="keyword">-&gt;</span><span class="default">close</span><span class="keyword">(); </span><span class="default">$zip</span><span class="keyword">-&gt;</span><span class="default">open</span><span class="keyword">(</span><span class="default">$file</span><span class="keyword">) or die (</span><span class="string">"Error: Could not reopen Zip"</span><span class="keyword">);}<br><br>&nbsp; &nbsp; </span><span class="default">$zip</span><span class="keyword">-&gt;</span><span class="default">addFromString</span><span class="keyword">(</span><span class="default">$path</span><span class="keyword">, </span><span class="default">$key</span><span class="keyword">) or die (</span><span class="string">"ERROR: Could not add file: </span><span class="default">$key</span><span class="string"> &lt;/br&gt; numFile:"</span><span class="keyword">.</span><span class="default">$zip</span><span class="keyword">-&gt;</span><span class="default">numFiles</span><span class="keyword">);<br>&nbsp; &nbsp; </span><span class="default">$zip</span><span class="keyword">-&gt;</span><span class="default">addFile</span><span class="keyword">(</span><span class="default">realpath</span><span class="keyword">(</span><span class="default">$key</span><span class="keyword">), </span><span class="default">$path</span><span class="keyword">) or die (</span><span class="string">"ERROR: Could not add file: </span><span class="default">$key</span><span class="string"> &lt;/br&gt; numFile:"</span><span class="keyword">.</span><span class="default">$zip</span><span class="keyword">-&gt;</span><span class="default">numFiles</span><span class="keyword">);<br>&nbsp; &nbsp; <br>}<br><br></span><span class="comment">// closes the archive<br></span><span class="default">$zip</span><span class="keyword">-&gt;</span><span class="default">close</span><span class="keyword">();<br><br></span><span class="comment">//make local temp file a .zip, rename, and move to output dir<br></span><span class="default">rename </span><span class="keyword">(</span><span class="default">$file</span><span class="keyword">, </span><span class="string">"./" </span><span class="keyword">. </span><span class="default">$outputfolder </span><span class="keyword">. </span><span class="string">"/" </span><span class="keyword">. </span><span class="default">$zipfilename</span><span class="keyword">);<br></span><span class="default">?&gt;<br></span>I hope this may help someone else.</span>
</code></div>
  </div>
 </div>
  <div class="note" id="108193">  
  <a class="name">
  <strong class="user"><em>ptipti at gala dot net</em></strong></a><div class="date" title="2012-04-06 12:12"><strong>2 years ago</strong></div>
  <div class="text" id="Hcom108193">
<div class="phpcode"><code><span class="html">
Another surprise, which took a lot of trouble. So that after you add a file to the archive it can be safely removed, took advantage of such construction:<br><br>if (!is_file ($archive)) :<br>&nbsp; &nbsp; $result = $zip-&gt;open ($archive, ZipArchive::CREATE);<br>else :<br>&nbsp; &nbsp; $result = $zip-&gt;open ($archive);<br>endif;<br>if ($result === TRUE) :<br>&nbsp; &nbsp; if (($zip-&gt;addFile ($file, $filename)) === TRUE) :<br>&nbsp; &nbsp; &nbsp; &nbsp; $theoreticaly_added = TRUE;<br>&nbsp; &nbsp; endif;<br>&nbsp; &nbsp; if ((($zip-&gt;close ()) === TRUE) &amp;&amp; $theoreticaly_added) :<br>&nbsp; &nbsp; &nbsp; &nbsp; unlink ($file);<br>&nbsp; &nbsp; endif;<br>endif;<br><br>Now the files will not disappear. But perhaps there is a simpler solution, which gives 100% guarantee?</span>
</code></div>
  </div>
 </div>
  <div class="note" id="107550">  
  <a class="name">
  <strong class="user"><em>sp at read dot eu</em></strong></a><div class="date" title="2012-02-16 08:25"><strong>2 years ago</strong></div>
  <div class="text" id="Hcom107550">
<div class="phpcode"><code><span class="html">
Note that using addFile() will change the order of the files within the zip, in fact within the index of the zip. Does not matter much, except if you loop the index and use addFile() within that loop : it will likely give messy results.<br><br>Example : <br><span class="default">&lt;?php<br>$zip </span><span class="keyword">= new </span><span class="default">ZipArchive</span><span class="keyword">;<br>if (</span><span class="default">$zip</span><span class="keyword">-&gt;</span><span class="default">open</span><span class="keyword">(</span><span class="string">'somefile.zip'</span><span class="keyword">) === </span><span class="default">TRUE</span><span class="keyword">) {<br>&nbsp; for (</span><span class="default">$i </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">; </span><span class="default">$i </span><span class="keyword">&lt; </span><span class="default">$zip</span><span class="keyword">-&gt;</span><span class="default">numFiles</span><span class="keyword">; </span><span class="default">$i</span><span class="keyword">++) { <br>&nbsp; &nbsp; if (</span><span class="default">forsomereason</span><span class="keyword">()) { <br>&nbsp; &nbsp; &nbsp; </span><span class="default">addFile</span><span class="keyword">(</span><span class="string">'./somenewfile.ext'</span><span class="keyword">, </span><span class="default">$zip</span><span class="keyword">-&gt;</span><span class="default">getNameIndex</span><span class="keyword">(</span><span class="default">$i</span><span class="keyword">));<br>&nbsp; &nbsp; }<br>&nbsp; }<br>}<br></span><span class="default">$zip</span><span class="keyword">-&gt;</span><span class="default">close</span><span class="keyword">();<br></span><span class="default">?&gt;<br></span><br>This code may loop for ever, depending on your forsomereason() function, or at least you're at risk.<br><br>Try something like this instead :<br><br><span class="default">&lt;?php<br>$zip </span><span class="keyword">= new </span><span class="default">ZipArchive</span><span class="keyword">;<br>if (</span><span class="default">$zip</span><span class="keyword">-&gt;</span><span class="default">open</span><span class="keyword">(</span><span class="string">'somefile.zip'</span><span class="keyword">) === </span><span class="default">TRUE</span><span class="keyword">) {<br>&nbsp; for (</span><span class="default">$i </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">; </span><span class="default">$i </span><span class="keyword">&lt; </span><span class="default">$zip</span><span class="keyword">-&gt;</span><span class="default">numFiles</span><span class="keyword">; </span><span class="default">$i</span><span class="keyword">++) { <br>&nbsp; &nbsp; if (</span><span class="default">forsomereason</span><span class="keyword">()) { <br>&nbsp; &nbsp; &nbsp; </span><span class="default">$couples</span><span class="keyword">[]=array(</span><span class="string">'filename'</span><span class="keyword">=&gt;</span><span class="string">'./somenewfile.ext'</span><span class="keyword">,</span><span class="string">'localname'</span><span class="keyword">=&gt;</span><span class="default">$zip</span><span class="keyword">-&gt;</span><span class="default">getNameIndex</span><span class="keyword">(</span><span class="default">$i</span><span class="keyword">));<br>&nbsp; &nbsp; }<br>&nbsp; }<br>}<br>foreach (</span><span class="default">$couples </span><span class="keyword">as </span><span class="default">$couple</span><span class="keyword">) </span><span class="default">$zip</span><span class="keyword">-&gt;</span><span class="default">addFile</span><span class="keyword">(</span><span class="default">$couple</span><span class="keyword">[</span><span class="string">'filename'</span><span class="keyword">],</span><span class="default">$couple</span><span class="keyword">[</span><span class="string">'localname'</span><span class="keyword">]);<br></span><span class="default">$zip</span><span class="keyword">-&gt;</span><span class="default">close</span><span class="keyword">();<br></span><span class="default">?&gt;<br></span><br>Hope it helps ;-)</span>
</code></div>
  </div>
 </div>
  <div class="note" id="100755">  
  <a class="name">
  <strong class="user"><em>aartdebruijn at gmail dot com</em></strong></a><div class="date" title="2010-11-04 06:37"><strong>3 years ago</strong></div>
  <div class="text" id="Hcom100755">
<div class="phpcode"><code><span class="html">
When adding a file to your zip, the file is opened and stays open.<br>When adding over 1024 files (depending on your open files limit) the server stops adding files, resulting in a status 11 in your zip Archive. There is no warning when exceeding this open files limit with addFiles.<br><br>Check your open files with ulimit -a<br><br>This kept me busy for some time.</span>
</code></div>
  </div>
 </div>
  <div class="note" id="84009">  
  <a class="name">
  <strong class="user"><em>wacher at freemail dot hu</em></strong></a><div class="date" title="2008-06-23 01:03"><strong>6 years ago</strong></div>
  <div class="text" id="Hcom84009">
<div class="phpcode"><code><span class="html">
The workaround above (file_get_contents) is very dangerous if you pack large files. (see memory limit).<br>Close/open the zip archive periodically instead of using file_get_contents().</span>
</code></div>
  </div>
 </div>
  <div class="note" id="83124">  
  <a class="name">
  <strong class="user"><em>stanleyshilov {} gmail.com</em></strong></a><div class="date" title="2008-05-11 12:05"><strong>6 years ago</strong></div>
  <div class="text" id="Hcom83124">
<div class="phpcode"><code><span class="html">
It should be noted that the example provided above is not accurate.<br><br>Unlike extractTo, zip_open does not return a boolean result, so the above example will always fail.</span>
</code></div>
  </div>
 </div>
  <div class="note" id="114769">  
  <a class="name">
  <strong class="user"><em>romuloum at hotmail dot com</em></strong></a><div class="date" title="2014-04-03 07:00"><strong>4 months ago</strong></div>
  <div class="text" id="Hcom114769">
<div class="phpcode"><code><span class="html">
If you have problem with windows explorer reading zipfile created by linux, try:<br>$oZip-&gt;addFile ( $file_name, " " . basename ( $file_name ) )<br>That space " " should solve.</span>
</code></div>
  </div>
 </div>
  <div class="note" id="74297">  
  <a class="name">
  <strong class="user"><em>Andreas R. newsgroups2005 at geekmail de</em></strong></a><div class="date" title="2007-04-03 06:29"><strong>7 years ago</strong></div>
  <div class="text" id="Hcom74297">
<div class="phpcode"><code><span class="html">
Currently the number of files that can be added using addFile to the ZIP archive (until it is closed) is limited by file descriptors limit. This is an easy workaround (on the bug links below you can find another workarounds):<br><span class="default">&lt;?php<br>&nbsp; &nbsp; </span><span class="comment">/** work around file descriptor number limitation (to avoid failure<br>&nbsp; &nbsp;&nbsp; * upon adding more than typically 253 or 1024 files to ZIP) */<br>&nbsp; &nbsp; </span><span class="keyword">function </span><span class="default">addFileToZip</span><span class="keyword">( </span><span class="default">$zip</span><span class="keyword">, </span><span class="default">$path</span><span class="keyword">, </span><span class="default">$zipEntryName </span><span class="keyword">) {<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="comment">// this would fail with status ZIPARCHIVE::ER_OPEN<br>&nbsp; &nbsp; &nbsp; &nbsp; // after certain number of files is added since<br>&nbsp; &nbsp; &nbsp; &nbsp; // ZipArchive internally stores the file descriptors of all the<br>&nbsp; &nbsp; &nbsp; &nbsp; // added files and only on close writes the contents to the ZIP file<br>&nbsp; &nbsp; &nbsp; &nbsp; // see: <a rel="nofollow" target="_blank">http://bugs.php.net/bug.php?id=40494</a><br>&nbsp; &nbsp; &nbsp; &nbsp; // and: <a rel="nofollow" target="_blank">http://pecl.php.net/bugs/bug.php?id=9443</a><br>&nbsp; &nbsp; &nbsp; &nbsp; // return $zip-&gt;addFile( $path, $zipEntryName );<br><br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$contents </span><span class="keyword">= </span><span class="default">file_get_contents</span><span class="keyword">( </span><span class="default">$path </span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; if ( </span><span class="default">$contents </span><span class="keyword">=== </span><span class="default">false </span><span class="keyword">) {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; return </span><span class="default">false</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; }<br>&nbsp; &nbsp; &nbsp; &nbsp; return </span><span class="default">$zip</span><span class="keyword">-&gt;</span><span class="default">addFromString</span><span class="keyword">( </span><span class="default">$zipEntryName</span><span class="keyword">, </span><span class="default">$contents </span><span class="keyword">);<br>&nbsp; &nbsp; }<br></span><span class="default">?&gt;</span>
</span>
</code></div>
  </div>
 </div>
  <div class="note" id="113446">  
  <a class="name">
  <strong class="user"><em>s dot eckert dot spam at gmx dot com</em></strong></a><div class="date" title="2013-10-11 03:27"><strong>10 months ago</strong></div>
  <div class="text" id="Hcom113446">
<div class="phpcode"><code><span class="html">
Note that there is no concept of "folders" for ZIP files. If you need to store data into folders, use forward slashes ("/") in $localname to separate folder(s) and the file name.<br><br>Example:<br>$zip-&gt;addFile("test.txt", "mainfolder/subfolder/test.txt");</span>
</code></div>
  </div>
 </div>
  <div class="note" id="113097">  
  <a class="name">
  <strong class="user"><em>arrtedone at gmail dot com</em></strong></a><div class="date" title="2013-08-29 08:19"><strong>11 months ago</strong></div>
  <div class="text" id="Hcom113097">
<div class="phpcode"><code><span class="html">
Note that ZipArchive::open() not return boolean value, but integer, for example :<br>$zip = new ZipArchive();<br>$filename = '/tmp/test.zip';<br>var_dum($zip-&gt;open($filename)); // return's : int (11)</span>
</code></div>
  </div>
 </div>
  <div class="note" id="97451">  
  <a class="name">
  <strong class="user"><em>pelpet at ic dot cz</em></strong></a><div class="date" title="2010-04-20 09:02"><strong>4 years ago</strong></div>
  <div class="text" id="Hcom97451">
<div class="phpcode"><code><span class="html">
<span class="default">&lt;?php<br>$zip</span><span class="keyword">=new </span><span class="default">ZipArchive</span><span class="keyword">;<br></span><span class="default">$zip</span><span class="keyword">-&gt;</span><span class="default">addFile</span><span class="keyword">(</span><span class="string">'path to the file'</span><span class="keyword">, </span><span class="string">'new name of the file'</span><span class="keyword">);<br></span><span class="default">?&gt;<br></span><br>What I have to do, when I wan't to have the file in the zip archive with it's name before archiving?<br>(Sorry, I'm from Czech Republic and I can't speak English very well, if I did anywhere mistake, so ignore that pease :-)</span>
</code></div>
  </div>
 </div>
  <div class="note" id="92835">  
  <a class="name">
  <strong class="user"><em>christophe dot braud at aquafadas dot com</em></strong></a><div class="date" title="2009-08-11 03:10"><strong>5 years ago</strong></div>
  <div class="text" id="Hcom92835">
<div class="phpcode"><code><span class="html">
If you have some warnings with ZipArchiveImproved since the last Ubuntu update, replace "self::CREATE" by "self::CREATE | self::OVERWRITE" in the reopen function<br><br>christophe</span>
</code></div>
  </div>
 </div>
  <div class="note" id="88600">  
  <a class="name">
  <strong class="user"><em>ss at littlerain dot com</em></strong></a><div class="date" title="2009-01-30 04:45"><strong>5 years ago</strong></div>
  <div class="text" id="Hcom88600">
<div class="phpcode"><code><span class="html">
Note that the file isn't actually added to the archive until the $zip-&gt;close() method is called. I spent a lot of time trying to figure out why no time() went by after adding large files via $zip-&gt;addFile() but would then time out the script.</span>
</code></div>
  </div>
 </div>
  <div class="note" id="88266">  
  <a class="name">
  <strong class="user"><em>Farzad Ghanei</em></strong></a><div class="date" title="2009-01-18 02:53"><strong>5 years ago</strong></div>
  <div class="text" id="Hcom88266">
<div class="phpcode"><code><span class="html">
here is a basic class that extends the ZipArchive to:<br>&nbsp; * add a functionality to report the ZIP file address (I needed it and I could not find out how in ZipArchive documentation).<br>&nbsp; * resolve the problem of adding so many files to the archive due file descriptor limit. the ZipArchiveImproved::addFile() handles this.<br><br><span class="default">&lt;?php<br></span><span class="comment">/**<br> * ZipArchiveImproved extends ZipArchive to add some information about the zip file and some functionality.<br> * <br> *<br> *<br> * @author Farzad Ghanei<br> * @uses ZipArchive<br> * @version 1.0.0 2009-01-18<br> */<br><br></span><span class="keyword">class </span><span class="default">ZipArchiveImproved </span><span class="keyword">extends </span><span class="default">ZipArchive </span><span class="keyword">{<br>&nbsp; &nbsp; protected </span><span class="default">$_archiveFileName </span><span class="keyword">= </span><span class="default">null</span><span class="keyword">;<br>&nbsp; &nbsp; protected </span><span class="default">$_newAddedFilesCounter </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">;<br>&nbsp; &nbsp; protected </span><span class="default">$_newAddedFilesSize </span><span class="keyword">= </span><span class="default">100</span><span class="keyword">;<br>&nbsp; &nbsp; <br>&nbsp; &nbsp; </span><span class="comment">/**<br>&nbsp; &nbsp;&nbsp; * returns the name of the archive file.<br>&nbsp; &nbsp;&nbsp; *<br>&nbsp; &nbsp;&nbsp; * @return string<br>&nbsp; &nbsp;&nbsp; */<br>&nbsp; &nbsp; </span><span class="keyword">public function </span><span class="default">getArchiveFileName</span><span class="keyword">() {<br>&nbsp; &nbsp; &nbsp; &nbsp; return </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">_archiveFileName</span><span class="keyword">;<br>&nbsp; &nbsp; }<br><br>&nbsp; &nbsp; </span><span class="comment">/**<br>&nbsp; &nbsp;&nbsp; * returns the number of files that are going to be added to ZIP<br>&nbsp; &nbsp;&nbsp; * without reopenning the stream to file.<br>&nbsp; &nbsp;&nbsp; *<br>&nbsp; &nbsp;&nbsp; * @return int<br>&nbsp; &nbsp;&nbsp; */<br>&nbsp; &nbsp; </span><span class="keyword">public function </span><span class="default">getNewAddedFilesSize</span><span class="keyword">() {<br>&nbsp; &nbsp; &nbsp; &nbsp; return </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">_newAddedFilesSize</span><span class="keyword">;<br>&nbsp; &nbsp; }<br><br>&nbsp; &nbsp; </span><span class="comment">/**<br>&nbsp; &nbsp;&nbsp; * sets the number of files that are going to be added to ZIP<br>&nbsp; &nbsp;&nbsp; * without reopenning the stream to file. if no size is specified, default is 100.<br>&nbsp; &nbsp;&nbsp; *<br>&nbsp; &nbsp;&nbsp; * @param int<br>&nbsp; &nbsp;&nbsp; * @return ZipArchiveImproved self reference<br>&nbsp; &nbsp;&nbsp; */<br>&nbsp; &nbsp; </span><span class="keyword">public function </span><span class="default">setNewlAddedFilesSize</span><span class="keyword">(</span><span class="default">$size</span><span class="keyword">=</span><span class="default">100</span><span class="keyword">) {<br>&nbsp; &nbsp; &nbsp; &nbsp; if ( empty(</span><span class="default">$size</span><span class="keyword">) || !</span><span class="default">is_int</span><span class="keyword">(</span><span class="default">$size</span><span class="keyword">) || </span><span class="default">$size </span><span class="keyword">&lt; </span><span class="default">1</span><span class="keyword">) {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$size </span><span class="keyword">= </span><span class="default">100</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; }<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">_newAddedFilesSize </span><span class="keyword">= </span><span class="default">$size</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; return </span><span class="default">$this</span><span class="keyword">;<br>&nbsp; &nbsp; }<br><br>&nbsp; &nbsp; </span><span class="comment">/**<br>&nbsp; &nbsp;&nbsp; * opens a stream to a ZIP archive file. calls the ZipArchive::open() internally.<br>&nbsp; &nbsp;&nbsp; * overwrites ZipArchive::open() to add the archiveFileName functionality.<br>&nbsp; &nbsp;&nbsp; *<br>&nbsp; &nbsp;&nbsp; * @param string $fileName<br>&nbsp; &nbsp;&nbsp; * @param int $flags<br>&nbsp; &nbsp;&nbsp; * return mixed<br>&nbsp; &nbsp;&nbsp; */<br>&nbsp; &nbsp; </span><span class="keyword">public function </span><span class="default">open</span><span class="keyword">(</span><span class="default">$fileName</span><span class="keyword">, </span><span class="default">$flags</span><span class="keyword">) {<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">_archiveFileName </span><span class="keyword">= </span><span class="default">$fileName</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">_newAddedFilesCounter </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; return </span><span class="default">parent</span><span class="keyword">::</span><span class="default">open</span><span class="keyword">(</span><span class="default">$fileName</span><span class="keyword">,</span><span class="default">$flags</span><span class="keyword">);<br>&nbsp; &nbsp; }<br><br>&nbsp; &nbsp; </span><span class="comment">/**<br>&nbsp; &nbsp;&nbsp; * closes the stream to ZIP archive file. calls the ZipArchive::close() internally.<br>&nbsp; &nbsp;&nbsp; * overwrites ZipArchive::close() to add the archiveFileName functionality.<br>&nbsp; &nbsp;&nbsp; *<br>&nbsp; &nbsp;&nbsp; * @return bool<br>&nbsp; &nbsp;&nbsp; */<br>&nbsp; &nbsp; </span><span class="keyword">public function </span><span class="default">close</span><span class="keyword">() {<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">_archiveFileName </span><span class="keyword">= </span><span class="default">null</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">_newAddedFilesCounter </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; return </span><span class="default">parent</span><span class="keyword">::</span><span class="default">close</span><span class="keyword">();<br>&nbsp; &nbsp; }<br><br>&nbsp; &nbsp; </span><span class="comment">/**<br>&nbsp; &nbsp;&nbsp; * closes the connection to ZIP file and openes the connection again.<br>&nbsp; &nbsp;&nbsp; *<br>&nbsp; &nbsp;&nbsp; * @return bool<br>&nbsp; &nbsp;&nbsp; */<br>&nbsp; &nbsp; </span><span class="keyword">public function </span><span class="default">reopen</span><span class="keyword">() {<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$archiveFileName </span><span class="keyword">= </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">_archiveFileName</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; if ( !</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">close</span><span class="keyword">() ) {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; return </span><span class="default">false</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; }<br>&nbsp; &nbsp; &nbsp; &nbsp; return </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">open</span><span class="keyword">(</span><span class="default">$archiveFileName</span><span class="keyword">,</span><span class="default">self</span><span class="keyword">::</span><span class="default">CREATE</span><span class="keyword">);<br>&nbsp; &nbsp; }<br><br>&nbsp; &nbsp; </span><span class="comment">/**<br>&nbsp; &nbsp;&nbsp; * adds a file to a ZIP archive from the given path. calls the ZipArchive::addFile() internally.<br>&nbsp; &nbsp;&nbsp; * overwrites ZipArchive::addFile() to handle maximum file connections in operating systems.<br>&nbsp; &nbsp;&nbsp; *<br>&nbsp; &nbsp;&nbsp; * @param string $fileName the path to file to be added to archive<br>&nbsp; &nbsp;&nbsp; * @param string [optional] $localname the name of the file in the ZIP archive<br>&nbsp; &nbsp;&nbsp; * @return bool<br>&nbsp; &nbsp;&nbsp; */<br>&nbsp; &nbsp; </span><span class="keyword">public function </span><span class="default">addFile</span><span class="keyword">( </span><span class="default">$fileName </span><span class="keyword">) {<br>&nbsp; &nbsp; &nbsp; &nbsp; if (</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">_newAddedFilesCounter </span><span class="keyword">&gt;= </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">_newAddedFilesSize</span><span class="keyword">) {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">reopen</span><span class="keyword">();<br>&nbsp; &nbsp; &nbsp; &nbsp; }<br>&nbsp; &nbsp; &nbsp; &nbsp; if ( </span><span class="default">func_num_args</span><span class="keyword">() &gt; </span><span class="default">1 </span><span class="keyword">) {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$flags </span><span class="keyword">= </span><span class="default">func_get_arg</span><span class="keyword">(</span><span class="default">1</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$added </span><span class="keyword">= </span><span class="default">parent</span><span class="keyword">::</span><span class="default">addFile</span><span class="keyword">(</span><span class="default">$fileName</span><span class="keyword">,</span><span class="default">$flags</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if (</span><span class="default">$added</span><span class="keyword">) {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">_newAddedFilesCounter</span><span class="keyword">++;<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; return </span><span class="default">$added</span><span class="keyword">;<br>&nbsp; &nbsp; &nbsp; &nbsp; }<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$added </span><span class="keyword">= </span><span class="default">parent</span><span class="keyword">::</span><span class="default">addFile</span><span class="keyword">(</span><span class="default">$fileName</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; if (</span><span class="default">$added</span><span class="keyword">) {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">_newAddedFilesCounter</span><span class="keyword">++;<br>&nbsp; &nbsp; &nbsp; &nbsp; }<br>&nbsp; &nbsp; &nbsp; &nbsp; return </span><span class="default">$added</span><span class="keyword">;<br>&nbsp; &nbsp; } </span><span class="comment">// public function addFile()<br></span><span class="keyword">}<br></span><span class="default">?&gt;</span>
</span>
</code></div>
  </div>
 </div>
  <div class="note" id="87663">  
  <a class="name">
  <strong class="user"><em>marco at maranao dot ca</em></strong></a><div class="date" title="2008-12-15 10:45"><strong>5 years ago</strong></div>
  <div class="text" id="Hcom87663">
<div class="phpcode"><code><span class="html">
This is my workaround for the file descriptor limit by closing/opening the archive file periodically.
<br>
<br><span class="default">&lt;?php
<br></span><span class="keyword">if(</span><span class="default">$backup </span><span class="keyword">= new </span><span class="default">ZipArchive</span><span class="keyword">()) {
<br>&nbsp; &nbsp; if(</span><span class="default">$backup</span><span class="keyword">-&gt;</span><span class="default">open</span><span class="keyword">(</span><span class="default">$zip</span><span class="keyword">, </span><span class="default">ZIPARCHIVE</span><span class="keyword">::</span><span class="default">OVERWRITE</span><span class="keyword">) === </span><span class="default">true</span><span class="keyword">) {
<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$backup</span><span class="keyword">-&gt;</span><span class="default">addFile</span><span class="keyword">(</span><span class="default">$file</span><span class="keyword">[</span><span class="string">'realpath'</span><span class="keyword">], </span><span class="default">$file</span><span class="keyword">[</span><span class="string">'path'</span><span class="keyword">]);
<br>&nbsp; &nbsp; &nbsp; &nbsp; if((</span><span class="default">$count</span><span class="keyword">++) == </span><span class="default">200</span><span class="keyword">) { </span><span class="comment">// the file descriptor limit
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$backup</span><span class="keyword">-&gt;</span><span class="default">close</span><span class="keyword">();
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if(</span><span class="default">$backup </span><span class="keyword">= new </span><span class="default">ZipArchive</span><span class="keyword">()) {
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$backup</span><span class="keyword">-&gt;</span><span class="default">open</span><span class="keyword">(</span><span class="default">$zip</span><span class="keyword">);
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$count </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">;
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }
<br>&nbsp; &nbsp; &nbsp; &nbsp; }
<br>&nbsp; &nbsp; }
<br>&nbsp; &nbsp; </span><span class="default">$backup</span><span class="keyword">-&gt;</span><span class="default">close</span><span class="keyword">();
<br>}
<br></span><span class="default">?&gt;
<br></span>
<br>Hope it helps someone.</span>
</code></div>
  </div>
 </div>
  <div class="note" id="115030">  
  <a class="name">
  <strong class="user"><em>todd at toddwiggins dot com dot au</em></strong></a><div class="date" title="2014-05-15 03:31"><strong>3 months ago</strong></div>
  <div class="text" id="Hcom115030">
<div class="phpcode"><code><span class="html">
The addFile() method does not accept the "file://" protocol. Strip away "file://" and use the absolute path instead.<br><br>I assume that it also does not accept any other protocols, I was having issues trying to add files, other functions within the application I was building required the use of the protocol.<br><br>Also to note, the status code returned did not match any of the predefined error codes, and the status code was never the same. My assumption was a overflow on the variable as the status codes were around the minimum and maximum INT values.</span>
</code></div>
  </div>
 </div>
  <div class="note" id="114840">  
  <a class="name">
  <strong class="user"><em>frame86 at live dot com</em></strong></a><div class="date" title="2014-04-13 04:48"><strong>4 months ago</strong></div>
  <div class="text" id="Hcom114840">
<div class="phpcode"><code><span class="html">
The manual is lying.<br><br>"In short, it means you can first delete an added file after the archive is closed. "<br><br>Thats true but not by locking the file...<br>Warning! This method works asynchronous! <br><br>It seems that addFile() will return TRUE if the file stat command returns correctly, but the operation itself will not happen yet.<br><br>Instead, deleting a file is always possible. I have discovered this behaviour by using a temporary file and deleting it immediately after addFile() returns. The result was that no archive was created nor any file was added although every operation (creating,open(),addFile()) returned true before. The operation silenty fails.</span>
</code></div>
  </div>
 </div>
  <div class="note" id="108491">  
  <a class="name">
  <strong class="user"><em>shano</em></strong></a><div class="date" title="2012-05-01 02:21"><strong>2 years ago</strong></div>
  <div class="text" id="Hcom108491">
<div class="phpcode"><code><span class="html">
thought it might come in handy<br>recursively adds all directories and files within a directory<br><br>class zip extends ZipArchive {<br>&nbsp; &nbsp; <br>&nbsp; &nbsp; public function addDirectory($dir) { // adds directory<br>&nbsp; &nbsp; &nbsp; &nbsp; foreach(glob($dir . '/*') as $file) {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if(is_dir($file))<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $this-&gt;addDirectory($file);<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; else<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $this-&gt;addFile($file);<br>&nbsp; &nbsp; &nbsp; &nbsp; }<br>&nbsp; &nbsp; }<br>}</span>
</code></div>
  </div>
 </div>
  <div class="note" id="84529">  
  <a class="name">
  <strong class="user"><em>javierseixas at gmail dt com</em></strong></a><div class="date" title="2008-07-17 08:30"><strong>6 years ago</strong></div>
  <div class="text" id="Hcom84529">
<div class="phpcode"><code><span class="html">
I have had several problems trying adding files, because of a path problem. The error gived was this:<br><br>ZipArchive::addFile() [function.ZipArchive-addFile]: Unable to access &lt;path&gt;<br><br>I used an absolute root starting by "/", and it didn't work. Try starting your path with "./" (referencing the root of your site).</span>
</code></div>
  </div>
 </div></div>

 
</section>    </section><!-- layout-content -->
        


  </div><!-- layout -->
         
  

    
 <!-- External and third party libraries. -->
 







<a id="toTop" href="javascript:;"><span id="toTopHover"></span><img width="40" height="40" alt="To Top" src="../../images/to-top%402x.png"></a>



<!-- Mirrored from php.net/manual/en/ziparchive.addfile.php by HTTrack Website Copier/3.x [XR&CO'2013], Thu, 28 Aug 2014 16:15:48 GMT -->


</body></html>