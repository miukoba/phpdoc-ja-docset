<html><!-- Mirrored from php.net/manual/en/function.connection-aborted.php by HTTrack Website Copier/3.x [XR&CO'2013], Thu, 28 Aug 2014 15:29:37 GMT --><!-- Added by HTTrack --><head><meta http-equiv="content-type" content="text/html;charset=utf-8"><!-- /Added by HTTrack -->


  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0"> 

  <title>connection_aborted</title>

 <link rel="shortcut icon" href="../../favicon.ico">
 <link rel="search" type="application/opensearchdescription+xml" href="http://php.net/phpnetimprovedsearch.src" title="Add PHP.net search">
 <link rel="alternate" type="application/atom+xml" href="http://php.net/releases/feed.php" title="PHP Release feed">
 <link rel="alternate" type="application/atom+xml" href="http://php.net/feed.atom" title="PHP: Hypertext Preprocessor">

 <link rel="canonical" href="function.connection-aborted.html">
 <link rel="shorturl" href="http://php.net/connection-aborted">
 <link rel="alternate" href="http://php.net/connection-aborted" hreflang="x-default">

 <link rel="contents" href="index-2.html">
 <link rel="index" href="ref.misc.html">
 <link rel="prev" href="ref.misc.html">
 <link rel="next" href="function.connection-status.html">

 <link rel="alternate" href="function.connection-aborted.html" hreflang="en">
 <link rel="alternate" href="http://php.net/manual/pt_BR/function.connection-aborted.php" hreflang="pt_BR">
 <link rel="alternate" href="http://php.net/manual/zh/function.connection-aborted.php" hreflang="zh">
 <link rel="alternate" href="http://php.net/manual/fr/function.connection-aborted.php" hreflang="fr">
 <link rel="alternate" href="http://php.net/manual/de/function.connection-aborted.php" hreflang="de">
 <link rel="alternate" href="http://php.net/manual/it/function.connection-aborted.php" hreflang="it">
 <link rel="alternate" href="http://php.net/manual/ja/function.connection-aborted.php" hreflang="ja">
 <link rel="alternate" href="http://php.net/manual/ro/function.connection-aborted.php" hreflang="ro">
 <link rel="alternate" href="http://php.net/manual/ru/function.connection-aborted.php" hreflang="ru">
 <link rel="alternate" href="http://php.net/manual/es/function.connection-aborted.php" hreflang="es">
 <link rel="alternate" href="http://php.net/manual/tr/function.connection-aborted.php" hreflang="tr">

<link rel="stylesheet" type="text/css" href="../../cached8fe1.css?t=1401250819&amp;f=/fonts/Fira/fira.css" media="screen">
<link rel="stylesheet" type="text/css" href="../../cached4b8d.css?t=1404368420&amp;f=/fonts/Font-Awesome/css/fontello.css" media="screen">
<link rel="stylesheet" type="text/css" href="../../cached5065.css?t=1403329232&amp;f=/styles/theme-base.css" media="screen">
<link rel="stylesheet" type="text/css" href="../../cachedc78d.css?t=1401249623&amp;f=/styles/theme-medium.css" media="screen">

 <!--[if lte IE 7]>
 <link rel="stylesheet" type="text/css" href="http://php.net/styles/workarounds.ie7.css" media="screen">
 <![endif]-->

 <!--[if lte IE 8]>
 <script type="text/javascript">
  window.brokenIE = true;
 </script>
 <![endif]-->

 <!--[if lte IE 9]>
 <link rel="stylesheet" type="text/css" href="http://php.net/styles/workarounds.ie9.css" media="screen">
 <![endif]-->

 <!--[if IE]>
 <script type="text/javascript" src="http://php.net/js/ext/html5.js"></script>
 <![endif]-->

 <base>

</head>
<body class="docs " style="">


<div class="headsup"><a href="http://php.net/index.php#id2014-08-28-1">PHP 5.6.0 released</a></div>
<nav id="trick"><div><dl>
<dt><a href="getting-started.html">Getting Started</a></dt>
	<dd><a href="introduction.html">Introduction</a></dd>
	<dd><a href="tutorial.html">A simple tutorial</a></dd>
<dt><a href="langref.html">Language Reference</a></dt>
	<dd><a href="language.basic-syntax.html">Basic syntax</a></dd>
	<dd><a href="language.types.html">Types</a></dd>
	<dd><a href="language.variables.html">Variables</a></dd>
	<dd><a href="language.constants.html">Constants</a></dd>
	<dd><a href="language.expressions.html">Expressions</a></dd>
	<dd><a href="language.operators.html">Operators</a></dd>
	<dd><a href="language.control-structures.html">Control Structures</a></dd>
	<dd><a href="language.functions.html">Functions</a></dd>
	<dd><a href="language.oop5.html">Classes and Objects</a></dd>
	<dd><a href="language.namespaces.html">Namespaces</a></dd>
	<dd><a href="language.exceptions.html">Exceptions</a></dd>
	<dd><a href="language.generators.html">Generators</a></dd>
	<dd><a href="language.references.html">References Explained</a></dd>
	<dd><a href="reserved.variables.html">Predefined Variables</a></dd>
	<dd><a href="reserved.exceptions.html">Predefined Exceptions</a></dd>
	<dd><a href="reserved.interfaces.html">Predefined Interfaces and Classes</a></dd>
	<dd><a href="context.html">Context options and parameters</a></dd>
	<dd><a href="wrappers.html">Supported Protocols and Wrappers</a></dd>
</dl>
<dl>
<dt><a href="security.html">Security</a></dt>
	<dd><a href="security.intro.html">Introduction</a></dd>
	<dd><a href="security.general.html">General considerations</a></dd>
	<dd><a href="security.cgi-bin.html">Installed as CGI binary</a></dd>
	<dd><a href="security.apache.html">Installed as an Apache module</a></dd>
	<dd><a href="security.filesystem.html">Filesystem Security</a></dd>
	<dd><a href="security.database.html">Database Security</a></dd>
	<dd><a href="security.errors.html">Error Reporting</a></dd>
	<dd><a href="security.globals.html">Using Register Globals</a></dd>
	<dd><a href="security.variables.html">User Submitted Data</a></dd>
	<dd><a href="security.magicquotes.html">Magic Quotes</a></dd>
	<dd><a href="security.hiding.html">Hiding PHP</a></dd>
	<dd><a href="security.current.html">Keeping Current</a></dd>
<dt><a href="features.html">Features</a></dt>
	<dd><a href="features.http-auth.html">HTTP authentication with PHP</a></dd>
	<dd><a href="features.cookies.html">Cookies</a></dd>
	<dd><a href="features.sessions.html">Sessions</a></dd>
	<dd><a href="features.xforms.html">Dealing with XForms</a></dd>
	<dd><a href="features.file-upload.html">Handling file uploads</a></dd>
	<dd><a href="features.remote-files.html">Using remote files</a></dd>
	<dd><a href="features.connection-handling.html">Connection handling</a></dd>
	<dd><a href="features.persistent-connections.html">Persistent Database Connections</a></dd>
	<dd><a href="features.safe-mode.html">Safe Mode</a></dd>
	<dd><a href="features.commandline.html">Command line usage</a></dd>
	<dd><a href="features.gc.html">Garbage Collection</a></dd>
	<dd><a href="features.dtrace.html">DTrace Dynamic Tracing</a></dd>
</dl>
<dl>
<dt><a href="funcref.html">Function Reference</a></dt>
	<dd><a href="refs.basic.php.html">Affecting PHP's Behaviour</a></dd>
	<dd><a href="refs.utilspec.audio.html">Audio Formats Manipulation</a></dd>
	<dd><a href="refs.remote.auth.html">Authentication Services</a></dd>
	<dd><a href="refs.utilspec.cmdline.html">Command Line Specific Extensions</a></dd>
	<dd><a href="refs.compression.html">Compression and Archive Extensions</a></dd>
	<dd><a href="refs.creditcard.html">Credit Card Processing</a></dd>
	<dd><a href="refs.crypto.html">Cryptography Extensions</a></dd>
	<dd><a href="refs.database.html">Database Extensions</a></dd>
	<dd><a href="refs.calendar.html">Date and Time Related Extensions</a></dd>
	<dd><a href="refs.fileprocess.file.html">File System Related Extensions</a></dd>
	<dd><a href="refs.international.html">Human Language and Character Encoding Support</a></dd>
	<dd><a href="refs.utilspec.image.html">Image Processing and Generation</a></dd>
	<dd><a href="refs.remote.mail.html">Mail Related Extensions</a></dd>
	<dd><a href="refs.math.html">Mathematical Extensions</a></dd>
	<dd><a href="refs.utilspec.nontext.html">Non-Text MIME Output</a></dd>
	<dd><a href="refs.fileprocess.process.html">Process Control Extensions</a></dd>
	<dd><a href="refs.basic.other.html">Other Basic Extensions</a></dd>
	<dd><a href="refs.remote.other.html">Other Services</a></dd>
	<dd><a href="refs.search.html">Search Engine Extensions</a></dd>
	<dd><a href="refs.utilspec.server.html">Server Specific Extensions</a></dd>
	<dd><a href="refs.basic.session.html">Session Extensions</a></dd>
	<dd><a href="refs.basic.text.html">Text Processing</a></dd>
	<dd><a href="refs.basic.vartype.html">Variable and Type Related Extensions</a></dd>
	<dd><a href="refs.webservice.html">Web Services</a></dd>
	<dd><a href="refs.utilspec.windows.html">Windows Only Extensions</a></dd>
	<dd><a href="refs.xml.html">XML Manipulation</a></dd>
</dl>
<dl>
<dt>Keyboard Shortcuts</dt><dt>?</dt>
<dd>This help</dd>
<dt>j</dt>
<dd>Next menu item</dd>
<dt>k</dt>
<dd>Previous menu item</dd>
<dt>g p</dt>
<dd>Previous man page</dd>
<dt>g n</dt>
<dd>Next man page</dd>
<dt>G</dt>
<dd>Scroll to bottom</dd>
<dt>g g</dt>
<dd>Scroll to top</dd>
<dt>g h</dt>
<dd>Goto homepage</dd>
<dt>g s</dt>
<dd>Goto search<br>(current page)</dd>
<dt>/</dt>
<dd>Focus search box</dd>
</dl></div></nav>
<div id="goto">
    <div class="search">
         <div class="text"></div>
         <div class="results"><ul></ul></div>
   </div>
</div>

  <div id="breadcrumbs" class="row-fluid">
          
              
        <ul class="breadcrumbs-container">
            <li><a href="index-2.html">PHP Manual</a></li>      <li><a href="funcref.html">Function Reference</a></li>      <li><a href="refs.basic.other.html">Other Basic Extensions</a></li>      <li><a href="book.misc.html">Misc.</a></li>      <li><a href="ref.misc.html">Misc. Functions</a></li>    </ul>
  </div>




<div id="layout">
  <section id="layout-content">
  <div id="function.connection-aborted" class="refentry">
 <div class="refnamediv">
  <h1 class="refname">connection_aborted</h1>
  <p class="verinfo">(PHP 4, PHP 5)</p><p class="refpurpose"><span class="refname">connection_aborted</span> â€” <span class="dc-title">Check whether client disconnected</span></p>

 </div>
 
 <div class="refsect1 description" id="refsect1-function.connection-aborted-description">
  <h3 class="title">Description</h3>
  <div class="methodsynopsis dc-description">
   <span class="type">int</span> <span class="methodname"><strong>connection_aborted</strong></span>
    ( <span class="methodparam">void</span>
   )</div>

  <p class="para rdfs-comment">
   Checks whether the client disconnected.
  </p>
 </div>


 <div class="refsect1 returnvalues" id="refsect1-function.connection-aborted-returnvalues">
  <h3 class="title">Return Values</h3>
  <p class="para">
   Returns 1 if client disconnected, 0 otherwise.
  </p>
 </div>


 <div class="refsect1 seealso" id="refsect1-function.connection-aborted-seealso">
  <h3 class="title">See Also</h3>
  <p class="para">
   </p><ul class="simplelist">
    <li class="member"><span class="function"><a href="function.connection-status.html" class="function" rel="rdfs-seeAlso">connection_status()</a> - Returns connection status bitfield</span></li>
    <li class="member"><span class="function"><a href="function.ignore-user-abort.html" class="function" rel="rdfs-seeAlso">ignore_user_abort()</a> - Set whether a client disconnect should abort script execution</span></li>
    <li class="member">
     <a href="features.connection-handling.html" class="link">Connection Handling</a>
     for a complete description of connection handling in PHP.
    </li>
   </ul>
  <p></p>
 </div>


</div>
<section id="usernotes">
 <div class="head"><h3 class="title">User Contributed Notes</h3></div><div id="allnotes">
  <div class="note" id="111167">  
  <a class="name">
  <strong class="user"><em>nathanb at php dot net</em></strong></a><div class="date" title="2013-01-21 08:50"><strong>1 year ago</strong></div>
  <div class="text" id="Hcom111167">
<div class="phpcode"><code><span class="html">
A trick to detecting if a connection is closed without having to send data that will otherwise corrupt the stream of data (like a binary file) you can use a combination of chunking the data on HTTP/1.1 by sending a "0" ("zero") as a leading chunk size without anything else.<br><br>*NOTE* it's important to note that it's not a good idea to check the stream more then once every few seconds. By doing this you are potentially increasing the data sent to the user with no gain to the user.<br><br>A good reason to do it this way is if you are generating a report that takes a long time to run and takes a lot of server resources. This would allow the server to detect if a user canceled the download and do any cleanup without corrupting the file file being download.<br><br>Here is an example:<br><br><span class="default">&lt;?php<br>ignore_user_abort</span><span class="keyword">(</span><span class="default">true</span><span class="keyword">);<br></span><span class="default">header</span><span class="keyword">(</span><span class="string">'Transfer-Encoding:chunked'</span><span class="keyword">);<br></span><span class="default">ob_flush</span><span class="keyword">();<br></span><span class="default">flush</span><span class="keyword">();<br></span><span class="default">$start </span><span class="keyword">= </span><span class="default">microtime</span><span class="keyword">(</span><span class="default">true</span><span class="keyword">);<br></span><span class="default">$i </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">;<br></span><span class="comment">// Use this function to echo anything to the browser.<br></span><span class="keyword">function </span><span class="default">vPrint</span><span class="keyword">(</span><span class="default">$data</span><span class="keyword">){<br>&nbsp; &nbsp; if(</span><span class="default">strlen</span><span class="keyword">(</span><span class="default">$data</span><span class="keyword">))<br>&nbsp; &nbsp; &nbsp; &nbsp; echo </span><span class="default">dechex</span><span class="keyword">(</span><span class="default">strlen</span><span class="keyword">(</span><span class="default">$data</span><span class="keyword">)), </span><span class="string">"\r\n"</span><span class="keyword">, </span><span class="default">$data</span><span class="keyword">, </span><span class="string">"\r\n"</span><span class="keyword">;<br>&nbsp; &nbsp; </span><span class="default">ob_flush</span><span class="keyword">();<br>&nbsp; &nbsp; </span><span class="default">flush</span><span class="keyword">();<br>}<br></span><span class="comment">// You MUST execute this function after you are done streaming information to the browser.<br></span><span class="keyword">function </span><span class="default">endPacket</span><span class="keyword">(){<br>&nbsp; &nbsp; echo </span><span class="string">"0\r\n\r\n"</span><span class="keyword">;<br>&nbsp; &nbsp; </span><span class="default">ob_flush</span><span class="keyword">();<br>&nbsp; &nbsp; </span><span class="default">flush</span><span class="keyword">();<br>}<br>do{<br>&nbsp; &nbsp; echo </span><span class="string">"0"</span><span class="keyword">;<br>&nbsp; &nbsp; </span><span class="default">ob_flush</span><span class="keyword">();<br>&nbsp; &nbsp; </span><span class="default">flush</span><span class="keyword">();<br>&nbsp; &nbsp; if(</span><span class="default">connection_aborted</span><span class="keyword">()){<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="comment">// This happens when connection is closed<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">file_put_contents</span><span class="keyword">(</span><span class="string">'/tmp/test.tmp'</span><span class="keyword">, </span><span class="default">sprintf</span><span class="keyword">(</span><span class="string">"Conn Closed\nTime spent with connection open: %01.5f sec\nLoop itterations: %s\n\n"</span><span class="keyword">, </span><span class="default">microtime</span><span class="keyword">(</span><span class="default">true</span><span class="keyword">) - </span><span class="default">$start</span><span class="keyword">, </span><span class="default">$i</span><span class="keyword">), </span><span class="default">FILE_APPEND</span><span class="keyword">);<br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">endPacket</span><span class="keyword">();<br>&nbsp; &nbsp; &nbsp; &nbsp; exit;<br>&nbsp; &nbsp; }<br>&nbsp; &nbsp; </span><span class="default">usleep</span><span class="keyword">(</span><span class="default">50000</span><span class="keyword">);<br>&nbsp; &nbsp; </span><span class="default">vPrint</span><span class="keyword">(</span><span class="string">"I get echo'ed every itteration (every .5 second)&lt;br /&gt;\n"</span><span class="keyword">);<br>}while(</span><span class="default">$i</span><span class="keyword">++ &lt; </span><span class="default">200</span><span class="keyword">);<br></span><span class="default">endPacket</span><span class="keyword">();<br></span><span class="default">?&gt;</span>
</span>
</code></div>
  </div>
 </div>
  <div class="note" id="76048">  
  <a class="name">
  <strong class="user"><em>phpcoder at cyberpimp dot techlab dot info</em></strong></a><div class="date" title="2007-06-27 11:50"><strong>7 years ago</strong></div>
  <div class="text" id="Hcom76048">
<div class="phpcode"><code><span class="html">
Although the documentation indicates it returns an int, I found comparing the return value with numeric values does not seem to work.<br><br>Example (does not work):<br><span class="default">&lt;?php<br></span><span class="keyword">if (</span><span class="default">connection_aborted</span><span class="keyword">()==</span><span class="default">1</span><span class="keyword">) {<br></span><span class="default">fwrite</span><span class="keyword">(</span><span class="default">$filehandle</span><span class="keyword">, </span><span class="string">'aborted!'</span><span class="keyword">);<br>}<br></span><span class="default">?&gt;<br></span><br>You're better off just assuming it returns boolean<br><br>Example (does work):<br><span class="default">&lt;?php<br></span><span class="keyword">if (</span><span class="default">connection_aborted</span><span class="keyword">()) {<br></span><span class="default">fwrite</span><span class="keyword">(</span><span class="default">$filehandle</span><span class="keyword">, </span><span class="string">'aborted!'</span><span class="keyword">);<br>}<br></span><span class="default">?&gt;</span>
</span>
</code></div>
  </div>
 </div>
  <div class="note" id="94603">  
  <a class="name">
  <strong class="user"><em>rickyale at ig dot com dot br</em></strong></a><div class="date" title="2009-11-13 11:49"><strong>4 years ago</strong></div>
  <div class="text" id="Hcom94603">
<div class="phpcode"><code><span class="html">
(connection_aborted not working)<br>I had this problem years ago, now the problem came back after upgrading php... i tried everything i found and in the end the function ob_end_flush();&nbsp; on top of script as post in php bug track solved the problem. Im using windows 7 x64 / php 5.2.4 / apache 2.2.14 (win32)<br><br>try adding ob_end_flush(); on top of you script. <br>i read something about this but can't remember where, it was related to a bug or something. <br><br>hope this help.</span>
</code></div>
  </div>
 </div>
  <div class="note" id="95202">  
  <a class="name">
  <strong class="user"><em>Luciano</em></strong></a><div class="date" title="2009-12-18 01:01"><strong>4 years ago</strong></div>
  <div class="text" id="Hcom95202">
<div class="phpcode"><code><span class="html">
In order to detect a disconnection inside the script we need to flush the buffer (it is only when the the server tries to send the buffer content that it will see that the connection is broken).<br><br>Thus we need to use the ob_implicit_flush() function to flush automatically the buffer<br><br>This is an example of a disconnection detection :<br><br><span class="default">&lt;?php<br>&nbsp; </span><span class="comment">// enables the automatic flush<br>&nbsp; </span><span class="default">ob_implicit_flush</span><span class="keyword">();<br><br>&nbsp; function </span><span class="default">verifyCommunication</span><span class="keyword">() {<br>&nbsp; &nbsp; </span><span class="default">$status </span><span class="keyword">= (</span><span class="default">connection_aborted</span><span class="keyword">()?</span><span class="string">"not "</span><span class="keyword">:</span><span class="string">""</span><span class="keyword">) .</span><span class="string">"sent"</span><span class="keyword">;<br>&nbsp; &nbsp; </span><span class="default">persistCommunication</span><span class="keyword">(new </span><span class="default">Communication</span><span class="keyword">(</span><span class="default">$status</span><span class="keyword">));<br>&nbsp; }<br><br>&nbsp; </span><span class="comment">// we will check the communication state when the script finished<br>&nbsp; </span><span class="default">register_shutdown_function</span><span class="keyword">(</span><span class="default">verifyCommunication</span><span class="keyword">);<br>&nbsp; echo </span><span class="string">"blabla"</span><span class="keyword">;<br>&nbsp; </span><span class="comment">// this sleep is used to have time to break the connection on the client side<br>&nbsp; </span><span class="default">sleep</span><span class="keyword">(</span><span class="default">10</span><span class="keyword">);<br>&nbsp; echo</span><span class="string">"tata"</span><span class="keyword">;<br></span><span class="default">?&gt;<br></span><br>I use such a process to cancel a request if the client didn't get the acknowledgement because he will redo his request...</span>
</code></div>
  </div>
 </div></div>

 
</section>    </section><!-- layout-content -->
        


  </div><!-- layout -->
         
  

    
 <!-- External and third party libraries. -->
 







<a id="toTop" href="javascript:;"><span id="toTopHover"></span><img width="40" height="40" alt="To Top" src="../../images/to-top%402x.png"></a>



<!-- Mirrored from php.net/manual/en/function.connection-aborted.php by HTTrack Website Copier/3.x [XR&CO'2013], Thu, 28 Aug 2014 15:29:37 GMT -->


</body></html>