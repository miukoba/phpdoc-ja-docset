<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
 <head>
  <meta http-equiv="content-type" content="text/html; CHARSET=shift-jis">
  <title>ファイルをコピーする</title>

  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <link media="all" rel="stylesheet" type="text/css" href="style.css"/>
 </head>
 <body class="docs" class="docs"><div class="navbar navbar-fixed-top">
  <div class="navbar-inner clearfix">
    <ul class="nav" style="width: 100%">
      <li style="float: left;"><a href="function.clearstatcache.html">≪ clearstatcache</a></li>
      <li style="float: right;"><a href="function.delete.html">delete ≫</a></li>
    </ul>
  </div>
</div>
<div id="breadcrumbs" class="clearfix">
  <ul class="breadcrumbs-container">
    <li><a href="index.html">PHP Manual</a></li>
    <li><a href="ref.filesystem.html">ファイルシステム 関数</a></li>
    <li>ファイルをコピーする</li>
  </ul>
</div>
<div id="layout">
  <div id="layout-content"><div id="function.copy" class="refentry">
 <div class="refnamediv">
  <h1 class="refname">copy</h1>
  <p class="verinfo">(PHP 4, PHP 5)</p><p class="refpurpose"><span class="refname">copy</span> &mdash; <span class="dc-title">ファイルをコピーする</span></p>

 </div>
 
 <div class="refsect1 description" id="refsect1-function.copy-description">
  <h3 class="title">説明</h3>
  <div class="methodsynopsis dc-description">
   <span class="type">bool</span> <span class="methodname"><strong>copy</strong></span>
    ( <span class="methodparam"><span class="type">string</span> <code class="parameter">$source</code></span>
   , <span class="methodparam"><span class="type">string</span> <code class="parameter">$dest</code></span>
   [, <span class="methodparam"><span class="type">resource</span> <code class="parameter">$context</code></span>
  ] )</div>

  <p class="para rdfs-comment">
   ファイル <code class="parameter">source</code> を <code class="parameter">dest</code> にコピーします。
  </p>
  <p class="para">
   ファイルを移動したいならば、<span class="function"><a href="function.rename.html" class="function">rename()</a></span>
   関数を使用してください。
  </p>
 </div>


 <div class="refsect1 parameters" id="refsect1-function.copy-parameters">
  <h3 class="title">パラメータ</h3>
  <p class="para">
   <dl>

    
     <dt>
<code class="parameter">source</code></dt>

     <dd>

      <p class="para">
       コピー元ファイルへのパス。
      </p>
     </dd>

    
    
     <dt>
<code class="parameter">dest</code></dt>

     <dd>

      <p class="para">
       コピー先のパス。<code class="parameter">dest</code> が URL の場合、
       既存ファイルへの上書きをラッパーがサポートしていない場合にはコピーが失敗します。
      </p>
      <div class="warning"><strong class="warning">警告</strong>
       <p class="para">
        コピー先のファイルが既に存在する場合、上書きされます。
       </p>
      </div>
     </dd>

    
    
     <dt>
<code class="parameter">context</code></dt>

     <dd>

      <p class="para">
       <span class="function"><a href="function.stream-context-create.html" class="function">stream_context_create()</a></span>
       で作成した有効なコンテキストリソース。
      </p>
     </dd>

    
   </dl>

  </p>
 </div>


 <div class="refsect1 returnvalues" id="refsect1-function.copy-returnvalues">
  <h3 class="title">返り値</h3>
  <p class="para">
   成功した場合に <strong><code>TRUE</code></strong> を、失敗した場合に <strong><code>FALSE</code></strong> を返します。
  </p>
 </div>


 <div class="refsect1 changelog" id="refsect1-function.copy-changelog">
  <h3 class="title">変更履歴</h3>
  <p class="para">
   <table class="doctable informaltable">
    
     <thead>
      <tr>
       <th>バージョン</th>
       <th>説明</th>
      </tr>

     </thead>

     <tbody class="tbody">
      <tr>
       <td>5.3.0</td>
       <td>
        コンテキストのサポートが追加されました。
       </td>
      </tr>

      <tr>
       <td>4.3.0</td>
       <td>
        &quot;fopen wrappers&quot; が有効の場合は
        <code class="parameter">source</code> と <code class="parameter">dest</code>
        のどちらにも URL を指定することができます。
        詳細は <span class="function"><a href="function.fopen.html" class="function">fopen()</a></span> を参照ください。
       </td>
      </tr>

     </tbody>
    
   </table>

  </p>
 </div>


 <div class="refsect1 examples" id="refsect1-function.copy-examples">
  <h3 class="title">例</h3>
  <p class="para">
   <div class="example" id="example-2444">
    <p><strong>例1 <span class="function"><strong>copy()</strong></span> の例</strong></p>
    <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br />$file&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #DD0000">'example.txt'</span><span style="color: #007700">;<br /></span><span style="color: #0000BB">$newfile&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #DD0000">'example.txt.bak'</span><span style="color: #007700">;<br /><br />if&nbsp;(!</span><span style="color: #0000BB">copy</span><span style="color: #007700">(</span><span style="color: #0000BB">$file</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$newfile</span><span style="color: #007700">))&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;echo&nbsp;</span><span style="color: #DD0000">"failed&nbsp;to&nbsp;copy&nbsp;</span><span style="color: #0000BB">$file</span><span style="color: #DD0000">...\n"</span><span style="color: #007700">;<br />}<br /></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
    </div>

   </div>
  </p>
 </div>


 <div class="refsect1 seealso" id="refsect1-function.copy-seealso">
  <h3 class="title">参考</h3>
  <p class="para">
   <ul class="simplelist">
    <li class="member"><span class="function"><a href="function.move-uploaded-file.html" class="function" rel="rdfs-seeAlso">move_uploaded_file()</a> - アップロードされたファイルを新しい位置に移動する</span></li>
    <li class="member"><span class="function"><a href="function.rename.html" class="function" rel="rdfs-seeAlso">rename()</a> - ファイルをリネームする</span></li>
    <li class="member">マニュアルの <a href="features.file-upload.html" class="link">ファイルアップロード処理</a></li>
   </ul>
  </p>
 </div>


</div><div id="usernotes">
 <div class="head">
  <h3 class="title">User Contributed Notes</h3>
 </div>
<div id="allnotes">  <a name="115114""></a>
  <div class="note">
   <strong class="user">ASchmidt at Anamera dot net</strong>
   <a href="#115114" class="date">28-May-2014 10:49</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Below a code snippet for downloading a file from a web server to a local file.<br />
<br />
It demonstrates useful customizations of the request (such as setting a User-Agent and Referrer, often required by web sites), and how to download only files if the copy on the web site is newer than the local copy.<br />
<br />
It further demonstrates the processing of response headers (if set by server) to determine the timestamp and file name. The file type is checked because some servers return a 200 OK return code with a textual "not found" page, instead of a proper 404 return code.<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="comment">// $fURI:&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; URL to a file located on a web server<br />
// $target_file:&nbsp; &nbsp; Path to a local file&nbsp; &nbsp; <br />
<br />
</span><span class="keyword">if ( </span><span class="default">file_exists</span><span class="keyword">( </span><span class="default">$target_file </span><span class="keyword">) ) {<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$ifmodhdr </span><span class="keyword">= </span><span class="string">'If-Modified-Since: '</span><span class="keyword">.</span><span class="default">date</span><span class="keyword">( </span><span class="string">"r"</span><span class="keyword">, </span><span class="default">filemtime</span><span class="keyword">( </span><span class="default">$target_file </span><span class="keyword">) ).</span><span class="string">"\r\n"</span><span class="keyword">;<br />
}<br />
else {<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$ifmodhdr </span><span class="keyword">= </span><span class="string">''</span><span class="keyword">;<br />
}<br />
<br />
</span><span class="comment">// set request header for GET with referrer for modified files, that follows redirects&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br />
</span><span class="default">$arrRequestHeaders </span><span class="keyword">= array(<br />
&nbsp;&nbsp;&nbsp; </span><span class="string">'http'</span><span class="keyword">=&gt;array(<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="string">'method'&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="keyword">=&gt;</span><span class="string">'GET'</span><span class="keyword">,<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="string">'protocol_version'&nbsp; &nbsp; </span><span class="keyword">=&gt;</span><span class="default">1.1</span><span class="keyword">,<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="string">'follow_location'&nbsp; &nbsp; </span><span class="keyword">=&gt;</span><span class="default">1</span><span class="keyword">,<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="string">'header'</span><span class="keyword">=&gt;&nbsp; &nbsp; </span><span class="string">"User-Agent: Anamera-Feed/1.0\r\n" </span><span class="keyword">.<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="string">"Referer: </span><span class="default">$source</span><span class="string">\r\n" </span><span class="keyword">.<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$ifmodhdr<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">)<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; );<br />
</span><span class="default">$rc </span><span class="keyword">= </span><span class="default">copy</span><span class="keyword">( </span><span class="default">$fURI</span><span class="keyword">, </span><span class="default">$target_file</span><span class="keyword">, </span><span class="default">stream_context_create</span><span class="keyword">(</span><span class="default">$arrRequestHeaders</span><span class="keyword">) );<br />
<br />
</span><span class="comment">// HTTP request completed, preserve system error, if any<br />
</span><span class="keyword">if( </span><span class="default">$rc </span><span class="keyword">) {<br />
&nbsp;&nbsp;&nbsp; if ( </span><span class="default">fclose</span><span class="keyword">( </span><span class="default">$rc </span><span class="keyword">) ) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; unset( </span><span class="default">$err </span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; else {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$err </span><span class="keyword">= </span><span class="default">error_get_last</span><span class="keyword">();<br />
&nbsp;&nbsp;&nbsp; }<br />
}<br />
else {<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$err </span><span class="keyword">= </span><span class="default">error_get_last</span><span class="keyword">();<br />
}<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <br />
</span><span class="comment">// Parse HTTP Response Headers for&nbsp; HTTP Status, as well filename, type, date information<br />
// Need to start from rear, to get last set of headers after possible sets of redirection headers<br />
</span><span class="keyword">if ( </span><span class="default">$http_response_header </span><span class="keyword">) {<br />
&nbsp;&nbsp;&nbsp; for ( </span><span class="default">$i </span><span class="keyword">= </span><span class="default">sizeof</span><span class="keyword">(</span><span class="default">$http_response_header</span><span class="keyword">) - </span><span class="default">1</span><span class="keyword">; </span><span class="default">$i </span><span class="keyword">&gt;= </span><span class="default">0</span><span class="keyword">; </span><span class="default">$i</span><span class="keyword">-- ) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if ( </span><span class="default">preg_match</span><span class="keyword">(</span><span class="string">'@^http/\S+ (\S{3,}) (.+)$@i'</span><span class="keyword">, </span><span class="default">$http_response_header</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">], </span><span class="default">$http_status</span><span class="keyword">) &gt; </span><span class="default">0 </span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// HTTP Status header means we have reached beginning of response headers for last request<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">break;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; elseif ( </span><span class="default">preg_match</span><span class="keyword">(</span><span class="string">'@^(\S+):\s*(.+)\s*$@'</span><span class="keyword">, </span><span class="default">$http_response_header</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">], </span><span class="default">$arrHeader</span><span class="keyword">) &gt; </span><span class="default">0 </span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; switch ( </span><span class="default">$arrHeader</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">] ) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; case </span><span class="string">'Last-Modified'</span><span class="keyword">:<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if ( !isset(</span><span class="default">$http_content_modtime</span><span class="keyword">) ) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$http_content_modtime </span><span class="keyword">= </span><span class="default">strtotime</span><span class="keyword">( </span><span class="default">$arrHeader</span><span class="keyword">[</span><span class="default">2</span><span class="keyword">] );<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; break;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; case </span><span class="string">'Content-Type'</span><span class="keyword">:<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if ( !isset(</span><span class="default">$http_content_image_type</span><span class="keyword">) ) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if ( </span><span class="default">preg_match</span><span class="keyword">(</span><span class="string">'@^image/(\w+)@ims'</span><span class="keyword">, </span><span class="default">$arrHeader</span><span class="keyword">[</span><span class="default">2</span><span class="keyword">], </span><span class="default">$arrTokens</span><span class="keyword">) &gt; </span><span class="default">0 </span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if ( </span><span class="default">in_array</span><span class="keyword">(</span><span class="default">strtolower</span><span class="keyword">(</span><span class="default">$arrTokens</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">]), </span><span class="default">$arrValidTypes</span><span class="keyword">)) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$http_content_image_type </span><span class="keyword">= </span><span class="default">$arrTokens</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">];<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; break;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; } <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; throw new </span><span class="default">Exception</span><span class="keyword">( </span><span class="string">"Error accessing file </span><span class="default">$fURI</span><span class="string">; invalid content type: </span><span class="default">$arrHeader</span><span class="keyword">[</span><span class="default">2</span><span class="keyword">]</span><span class="string">"</span><span class="keyword">, </span><span class="default">2</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; break;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; case </span><span class="string">'Content-Disposition'</span><span class="keyword">:<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if ( !isset(</span><span class="default">$http_content_filename</span><span class="keyword">) &amp;&amp; </span><span class="default">preg_match</span><span class="keyword">(</span><span class="string">'@filename\\s*=\\s*(?|"([^"]+)"|([\\S]+));?@ims'</span><span class="keyword">, </span><span class="default">$arrHeader</span><span class="keyword">[</span><span class="default">2</span><span class="keyword">], </span><span class="default">$arrTokens</span><span class="keyword">) &gt; </span><span class="default">0 </span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$http_content_filename </span><span class="keyword">= </span><span class="default">basename</span><span class="keyword">(</span><span class="default">$arrTokens</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">]);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; break;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; }<br />
}<br />
<br />
if ( </span><span class="default">$http_status </span><span class="keyword">) {<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">// Make sure we have good HTTP Status<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">switch ( </span><span class="default">$http_status</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">] ) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; case </span><span class="string">'200'</span><span class="keyword">:<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// SUCCESS: HTTP Status is "200 OK"<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">break;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; case </span><span class="string">'304'</span><span class="keyword">:<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; throw new </span><span class="default">Exception</span><span class="keyword">( </span><span class="string">"Remote file not newer: </span><span class="default">$fURI</span><span class="string">"</span><span class="keyword">, </span><span class="default">$http_status</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">] );<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; break;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; case </span><span class="string">'404'</span><span class="keyword">:<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; throw new </span><span class="default">Exception</span><span class="keyword">( </span><span class="string">"Remote file not found: </span><span class="default">$fURI</span><span class="string">"</span><span class="keyword">, </span><span class="default">$http_status</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">] );<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; break;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; default:<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; throw new </span><span class="default">Exception</span><span class="keyword">( </span><span class="string">"HTTP Error, </span><span class="default">$http_status</span><span class="keyword">[</span><span class="default">2</span><span class="keyword">]</span><span class="string">, accessing </span><span class="default">$fURI</span><span class="string">"</span><span class="keyword">, </span><span class="default">$http_status</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">] );<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; break;<br />
&nbsp;&nbsp;&nbsp; }<br />
}<br />
elseif ( </span><span class="default">$err </span><span class="keyword">) {<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">// Protocol / Communication error<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">throw new </span><span class="default">Exception</span><span class="keyword">( </span><span class="default">$err</span><span class="keyword">[</span><span class="string">'message'</span><span class="keyword">]</span><span class="comment">/*."; Remote file: $fURI"*/</span><span class="keyword">, </span><span class="default">$err</span><span class="keyword">[</span><span class="string">'type'</span><span class="keyword">] );<br />
}<br />
else {<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">// No HTTP status and no error<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">throw new </span><span class="default">customException</span><span class="keyword">( </span><span class="string">"Unknown HTTP response accessing </span><span class="default">$fURI</span><span class="string">: </span><span class="default">$http_response_header</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">]</span><span class="string">"</span><span class="keyword">, -</span><span class="default">1 </span><span class="keyword">);<br />
}<br />
</span><span class="default">?&gt;<br />
</span><br />
Notes:<br />
1. Currently copy() does NOT appropriately handle the 304 response code. Instead of NOT performing a copy (possibly setting the RC), it will overwrite the target file with an zero length file.<br />
2. There may be a problem accessing a list of remote files when HTTP 1.1 protocol is used. If you experience time-out errors, try the default 1.0 protocol version.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="111833""></a>
  <div class="note">
   <strong class="user">absorbentshoulderman at gmail dot com</strong>
   <a href="#111833" class="date">03-Apr-2013 09:51</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
A nice simple trick if you need to make sure the folder exists first:<br />
<br />
<span class="default">&lt;?php<br />
<br />
$srcfile</span><span class="keyword">=</span><span class="string">'C:\File\Whatever\Path\Joe.txt'</span><span class="keyword">;<br />
</span><span class="default">$dstfile</span><span class="keyword">=</span><span class="string">'G:\Shared\Reports\Joe.txt'</span><span class="keyword">;<br />
</span><span class="default">mkdir</span><span class="keyword">(</span><span class="default">dirname</span><span class="keyword">(</span><span class="default">$dstfile</span><span class="keyword">), </span><span class="default">0777</span><span class="keyword">, </span><span class="default">true</span><span class="keyword">);<br />
</span><span class="default">copy</span><span class="keyword">(</span><span class="default">$srcfile</span><span class="keyword">, </span><span class="default">$dstfile</span><span class="keyword">);<br />
<br />
</span><span class="default">?&gt;<br />
</span><br />
That simple.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="104020""></a>
  <div class="note">
   <strong class="user">promaty at gmail dot com</strong>
   <a href="#104020" class="date">17-May-2011 08:13</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Here is a simple script that I use for removing and copying non-empty directories. Very useful when you are not sure what is the type of a file.<br />
<br />
I am using these for managing folders and zip archives for my website plugins.<br />
<br />
<span class="default">&lt;?php<br />
<br />
</span><span class="comment">// removes files and non-empty directories<br />
</span><span class="keyword">function </span><span class="default">rrmdir</span><span class="keyword">(</span><span class="default">$dir</span><span class="keyword">) {<br />
&nbsp; if (</span><span class="default">is_dir</span><span class="keyword">(</span><span class="default">$dir</span><span class="keyword">)) {<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$files </span><span class="keyword">= </span><span class="default">scandir</span><span class="keyword">(</span><span class="default">$dir</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; foreach (</span><span class="default">$files </span><span class="keyword">as </span><span class="default">$file</span><span class="keyword">)<br />
&nbsp;&nbsp;&nbsp; if (</span><span class="default">$file </span><span class="keyword">!= </span><span class="string">"." </span><span class="keyword">&amp;&amp; </span><span class="default">$file </span><span class="keyword">!= </span><span class="string">".."</span><span class="keyword">) </span><span class="default">rrmdir</span><span class="keyword">(</span><span class="string">"</span><span class="default">$dir</span><span class="string">/</span><span class="default">$file</span><span class="string">"</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">rmdir</span><span class="keyword">(</span><span class="default">$dir</span><span class="keyword">);<br />
&nbsp; }<br />
&nbsp; else if (</span><span class="default">file_exists</span><span class="keyword">(</span><span class="default">$dir</span><span class="keyword">)) </span><span class="default">unlink</span><span class="keyword">(</span><span class="default">$dir</span><span class="keyword">);<br />
} <br />
<br />
</span><span class="comment">// copies files and non-empty directories<br />
</span><span class="keyword">function </span><span class="default">rcopy</span><span class="keyword">(</span><span class="default">$src</span><span class="keyword">, </span><span class="default">$dst</span><span class="keyword">) {<br />
&nbsp; if (</span><span class="default">file_exists</span><span class="keyword">(</span><span class="default">$dst</span><span class="keyword">)) </span><span class="default">rrmdir</span><span class="keyword">(</span><span class="default">$dst</span><span class="keyword">);<br />
&nbsp; if (</span><span class="default">is_dir</span><span class="keyword">(</span><span class="default">$src</span><span class="keyword">)) {<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">mkdir</span><span class="keyword">(</span><span class="default">$dst</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$files </span><span class="keyword">= </span><span class="default">scandir</span><span class="keyword">(</span><span class="default">$src</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; foreach (</span><span class="default">$files </span><span class="keyword">as </span><span class="default">$file</span><span class="keyword">)<br />
&nbsp;&nbsp;&nbsp; if (</span><span class="default">$file </span><span class="keyword">!= </span><span class="string">"." </span><span class="keyword">&amp;&amp; </span><span class="default">$file </span><span class="keyword">!= </span><span class="string">".."</span><span class="keyword">) </span><span class="default">rcopy</span><span class="keyword">(</span><span class="string">"</span><span class="default">$src</span><span class="string">/</span><span class="default">$file</span><span class="string">"</span><span class="keyword">, </span><span class="string">"</span><span class="default">$dst</span><span class="string">/</span><span class="default">$file</span><span class="string">"</span><span class="keyword">); <br />
&nbsp; }<br />
&nbsp; else if (</span><span class="default">file_exists</span><span class="keyword">(</span><span class="default">$src</span><span class="keyword">)) </span><span class="default">copy</span><span class="keyword">(</span><span class="default">$src</span><span class="keyword">, </span><span class="default">$dst</span><span class="keyword">);<br />
}<br />
</span><span class="default">?&gt;<br />
</span><br />
Cheers!</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="103732""></a>
  <div class="note">
   <strong class="user">cory  at  veck dot ca</strong>
   <a href="#103732" class="date">30-Apr-2011 08:17</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
My own 'cp -R' written in PHP.<br />
<br />
Hopefully it will work for your situation. I'm using it in a web based file manager for my CMS.<br />
<br />
<span class="default">&lt;?php<br />
<br />
&nbsp;&nbsp;&nbsp; define</span><span class="keyword">(</span><span class="string">'DS'</span><span class="keyword">, </span><span class="default">DIRECTORY_SEPARATOR</span><span class="keyword">); </span><span class="comment">// I always use this short form in my code.<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">function </span><span class="default">copy_r</span><span class="keyword">( </span><span class="default">$path</span><span class="keyword">, </span><span class="default">$dest </span><span class="keyword">)<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if( </span><span class="default">is_dir</span><span class="keyword">(</span><span class="default">$path</span><span class="keyword">) )<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; @</span><span class="default">mkdir</span><span class="keyword">( </span><span class="default">$dest </span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$objects </span><span class="keyword">= </span><span class="default">scandir</span><span class="keyword">(</span><span class="default">$path</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if( </span><span class="default">sizeof</span><span class="keyword">(</span><span class="default">$objects</span><span class="keyword">) &gt; </span><span class="default">0 </span><span class="keyword">)<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; foreach( </span><span class="default">$objects </span><span class="keyword">as </span><span class="default">$file </span><span class="keyword">)<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if( </span><span class="default">$file </span><span class="keyword">== </span><span class="string">"." </span><span class="keyword">|| </span><span class="default">$file </span><span class="keyword">== </span><span class="string">".." </span><span class="keyword">)<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; continue;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// go on<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">if( </span><span class="default">is_dir</span><span class="keyword">( </span><span class="default">$path</span><span class="keyword">.</span><span class="default">DS</span><span class="keyword">.</span><span class="default">$file </span><span class="keyword">) )<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">copy_r</span><span class="keyword">( </span><span class="default">$path</span><span class="keyword">.</span><span class="default">DS</span><span class="keyword">.</span><span class="default">$file</span><span class="keyword">, </span><span class="default">$dest</span><span class="keyword">.</span><span class="default">DS</span><span class="keyword">.</span><span class="default">$file </span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; else<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">copy</span><span class="keyword">( </span><span class="default">$path</span><span class="keyword">.</span><span class="default">DS</span><span class="keyword">.</span><span class="default">$file</span><span class="keyword">, </span><span class="default">$dest</span><span class="keyword">.</span><span class="default">DS</span><span class="keyword">.</span><span class="default">$file </span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">true</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; elseif( </span><span class="default">is_file</span><span class="keyword">(</span><span class="default">$path</span><span class="keyword">) )<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">copy</span><span class="keyword">(</span><span class="default">$path</span><span class="keyword">, </span><span class="default">$dest</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; else<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">false</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; }<br />
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="102320""></a>
  <div class="note">
   <strong class="user">Yoga Wibowo Aji</strong>
   <a href="#102320" class="date">08-Feb-2011 06:22</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
you can try this code if you don't having permission to access the shell<br />
this code is alternative for file copy<br />
<br />
<span class="default">&lt;?php<br />
$source </span><span class="keyword">= </span><span class="string">'myfile.doc'</span><span class="keyword">;<br />
</span><span class="default">$destination </span><span class="keyword">= </span><span class="string">'clonefile.doc'</span><span class="keyword">;<br />
<br />
</span><span class="default">$data </span><span class="keyword">= </span><span class="default">file_get_contents</span><span class="keyword">(</span><span class="default">$source</span><span class="keyword">);<br />
<br />
</span><span class="default">$handle </span><span class="keyword">= </span><span class="default">fopen</span><span class="keyword">(</span><span class="default">$destination</span><span class="keyword">, </span><span class="string">"w"</span><span class="keyword">);<br />
</span><span class="default">fwrite</span><span class="keyword">(</span><span class="default">$handle</span><span class="keyword">, </span><span class="default">$data</span><span class="keyword">);<br />
</span><span class="default">fclose</span><span class="keyword">(</span><span class="default">$handle</span><span class="keyword">);<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="93245""></a>
  <div class="note">
   <strong class="user">eng-ayman at aymax dot net</strong>
   <a href="#93245" class="date">30-Aug-2009 02:48</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
some hosts disable copy() function and say its for security 
<br />

<br />
and for some copy is important so this is and simple function that do same as copy function effect 
<br />

<br />
how smart php can help us l like php 
<br />

<br />
<span class="default">&lt;?php
<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">function </span><span class="default">copyemz</span><span class="keyword">(</span><span class="default">$file1</span><span class="keyword">,</span><span class="default">$file2</span><span class="keyword">){
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$contentx </span><span class="keyword">=@</span><span class="default">file_get_contents</span><span class="keyword">(</span><span class="default">$file1</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$openedfile </span><span class="keyword">= </span><span class="default">fopen</span><span class="keyword">(</span><span class="default">$file2</span><span class="keyword">, </span><span class="string">"w"</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">fwrite</span><span class="keyword">(</span><span class="default">$openedfile</span><span class="keyword">, </span><span class="default">$contentx</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">fclose</span><span class="keyword">(</span><span class="default">$openedfile</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">$contentx </span><span class="keyword">=== </span><span class="default">FALSE</span><span class="keyword">) {
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$status</span><span class="keyword">=</span><span class="default">false</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }else </span><span class="default">$status</span><span class="keyword">=</span><span class="default">true</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; 
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">$status</span><span class="keyword">;
<br />
&nbsp;&nbsp;&nbsp; }
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="91256""></a>
  <div class="note">
   <strong class="user">Sina Salek</strong>
   <a href="#91256" class="date">02-Jun-2009 02:02</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Thanks for all the comments, i wrote this function for fully supporting file and directory copy. 
<br />
As you may have noticed there are feature that didn't have time to implement , but if you have time to implement them or even add more cool features, please notify me as well :). you can find me here <a href="http://sina.salek.ws/en/contact" rel="nofollow" target="_blank">http://sina.salek.ws/en/contact</a>
<br />

<br />
PS : It was very useful for me, hope you find it useful as well.
<br />

<br />
<span class="default">&lt;?php
<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">/**
<br />
&nbsp;&nbsp; &nbsp; * Copy file or folder from source to destination, it can do
<br />
&nbsp;&nbsp; &nbsp; * recursive copy as well and is very smart
<br />
&nbsp;&nbsp; &nbsp; * It recursively creates the dest file or directory path if there weren't exists
<br />
&nbsp;&nbsp; &nbsp; * Situtaions :
<br />
&nbsp;&nbsp; &nbsp; * - Src:/home/test/file.txt ,Dst:/home/test/b ,Result:/home/test/b -&gt; If source was file copy file.txt name with b as name to destination
<br />
&nbsp;&nbsp; &nbsp; * - Src:/home/test/file.txt ,Dst:/home/test/b/ ,Result:/home/test/b/file.txt -&gt; If source was file Creates b directory if does not exsits and copy file.txt into it
<br />
&nbsp;&nbsp; &nbsp; * - Src:/home/test ,Dst:/home/ ,Result:/home/test/** -&gt; If source was directory copy test directory and all of its content into dest&nbsp; &nbsp; &nbsp; 
<br />
&nbsp;&nbsp; &nbsp; * - Src:/home/test/ ,Dst:/home/ ,Result:/home/**-&gt; if source was direcotry copy its content to dest
<br />
&nbsp;&nbsp; &nbsp; * - Src:/home/test ,Dst:/home/test2 ,Result:/home/test2/** -&gt; if source was directoy copy it and its content to dest with test2 as name
<br />
&nbsp;&nbsp; &nbsp; * - Src:/home/test/ ,Dst:/home/test2 ,Result:-&gt;/home/test2/** if source was directoy copy it and its content to dest with test2 as name
<br />
&nbsp;&nbsp; &nbsp; * @todo
<br />
&nbsp;&nbsp; &nbsp; *&nbsp; &nbsp;&nbsp; - Should have rollback technique so it can undo the copy when it wasn't successful
<br />
&nbsp;&nbsp; &nbsp; *&nbsp; - Auto destination technique should be possible to turn off
<br />
&nbsp;&nbsp; &nbsp; *&nbsp; - Supporting callback function
<br />
&nbsp;&nbsp; &nbsp; *&nbsp; - May prevent some issues on shared enviroments : <a href="http://us3.php.net/umask " rel="nofollow" target="_blank">http://us3.php.net/umask </a>
<br />
&nbsp;&nbsp; &nbsp; * @param $source //file or folder
<br />
&nbsp;&nbsp; &nbsp; * @param $dest ///file or folder
<br />
&nbsp;&nbsp; &nbsp; * @param $options //folderPermission,filePermission
<br />
&nbsp;&nbsp; &nbsp; * @return boolean
<br />
&nbsp;&nbsp; &nbsp; */
<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">function </span><span class="default">smartCopy</span><span class="keyword">(</span><span class="default">$source</span><span class="keyword">, </span><span class="default">$dest</span><span class="keyword">, </span><span class="default">$options</span><span class="keyword">=array(</span><span class="string">'folderPermission'</span><span class="keyword">=&gt;</span><span class="default">0755</span><span class="keyword">,</span><span class="string">'filePermission'</span><span class="keyword">=&gt;</span><span class="default">0755</span><span class="keyword">))
<br />
&nbsp;&nbsp;&nbsp; {
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$result</span><span class="keyword">=</span><span class="default">false</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; 
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">is_file</span><span class="keyword">(</span><span class="default">$source</span><span class="keyword">)) {
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">$dest</span><span class="keyword">[</span><span class="default">strlen</span><span class="keyword">(</span><span class="default">$dest</span><span class="keyword">)-</span><span class="default">1</span><span class="keyword">]==</span><span class="string">'/'</span><span class="keyword">) {
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if (!</span><span class="default">file_exists</span><span class="keyword">(</span><span class="default">$dest</span><span class="keyword">)) {
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">cmfcDirectory</span><span class="keyword">::</span><span class="default">makeAll</span><span class="keyword">(</span><span class="default">$dest</span><span class="keyword">,</span><span class="default">$options</span><span class="keyword">[</span><span class="string">'folderPermission'</span><span class="keyword">],</span><span class="default">true</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$__dest</span><span class="keyword">=</span><span class="default">$dest</span><span class="keyword">.</span><span class="string">"/"</span><span class="keyword">.</span><span class="default">basename</span><span class="keyword">(</span><span class="default">$source</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; } else {
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$__dest</span><span class="keyword">=</span><span class="default">$dest</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$result</span><span class="keyword">=</span><span class="default">copy</span><span class="keyword">(</span><span class="default">$source</span><span class="keyword">, </span><span class="default">$__dest</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">chmod</span><span class="keyword">(</span><span class="default">$__dest</span><span class="keyword">,</span><span class="default">$options</span><span class="keyword">[</span><span class="string">'filePermission'</span><span class="keyword">]);
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; 
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; } elseif(</span><span class="default">is_dir</span><span class="keyword">(</span><span class="default">$source</span><span class="keyword">)) {
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">$dest</span><span class="keyword">[</span><span class="default">strlen</span><span class="keyword">(</span><span class="default">$dest</span><span class="keyword">)-</span><span class="default">1</span><span class="keyword">]==</span><span class="string">'/'</span><span class="keyword">) {
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">$source</span><span class="keyword">[</span><span class="default">strlen</span><span class="keyword">(</span><span class="default">$source</span><span class="keyword">)-</span><span class="default">1</span><span class="keyword">]==</span><span class="string">'/'</span><span class="keyword">) {
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">//Copy only contents
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">} else {
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">//Change parent itself and its contents
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$dest</span><span class="keyword">=</span><span class="default">$dest</span><span class="keyword">.</span><span class="default">basename</span><span class="keyword">(</span><span class="default">$source</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; @</span><span class="default">mkdir</span><span class="keyword">(</span><span class="default">$dest</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">chmod</span><span class="keyword">(</span><span class="default">$dest</span><span class="keyword">,</span><span class="default">$options</span><span class="keyword">[</span><span class="string">'filePermission'</span><span class="keyword">]);
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; } else {
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">$source</span><span class="keyword">[</span><span class="default">strlen</span><span class="keyword">(</span><span class="default">$source</span><span class="keyword">)-</span><span class="default">1</span><span class="keyword">]==</span><span class="string">'/'</span><span class="keyword">) {
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">//Copy parent directory with new name and all its content
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">@</span><span class="default">mkdir</span><span class="keyword">(</span><span class="default">$dest</span><span class="keyword">,</span><span class="default">$options</span><span class="keyword">[</span><span class="string">'folderPermission'</span><span class="keyword">]);
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">chmod</span><span class="keyword">(</span><span class="default">$dest</span><span class="keyword">,</span><span class="default">$options</span><span class="keyword">[</span><span class="string">'filePermission'</span><span class="keyword">]);
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; } else {
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">//Copy parent directory with new name and all its content
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">@</span><span class="default">mkdir</span><span class="keyword">(</span><span class="default">$dest</span><span class="keyword">,</span><span class="default">$options</span><span class="keyword">[</span><span class="string">'folderPermission'</span><span class="keyword">]);
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">chmod</span><span class="keyword">(</span><span class="default">$dest</span><span class="keyword">,</span><span class="default">$options</span><span class="keyword">[</span><span class="string">'filePermission'</span><span class="keyword">]);
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }
<br />

<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$dirHandle</span><span class="keyword">=</span><span class="default">opendir</span><span class="keyword">(</span><span class="default">$source</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; while(</span><span class="default">$file</span><span class="keyword">=</span><span class="default">readdir</span><span class="keyword">(</span><span class="default">$dirHandle</span><span class="keyword">))
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; {
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if(</span><span class="default">$file</span><span class="keyword">!=</span><span class="string">"." </span><span class="keyword">&amp;&amp; </span><span class="default">$file</span><span class="keyword">!=</span><span class="string">".."</span><span class="keyword">)
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; {
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if(!</span><span class="default">is_dir</span><span class="keyword">(</span><span class="default">$source</span><span class="keyword">.</span><span class="string">"/"</span><span class="keyword">.</span><span class="default">$file</span><span class="keyword">)) {
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$__dest</span><span class="keyword">=</span><span class="default">$dest</span><span class="keyword">.</span><span class="string">"/"</span><span class="keyword">.</span><span class="default">$file</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; } else {
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$__dest</span><span class="keyword">=</span><span class="default">$dest</span><span class="keyword">.</span><span class="string">"/"</span><span class="keyword">.</span><span class="default">$file</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">//echo "$source/$file ||| $__dest&lt;br /&gt;";
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$result</span><span class="keyword">=</span><span class="default">smartCopy</span><span class="keyword">(</span><span class="default">$source</span><span class="keyword">.</span><span class="string">"/"</span><span class="keyword">.</span><span class="default">$file</span><span class="keyword">, </span><span class="default">$__dest</span><span class="keyword">, </span><span class="default">$options</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">closedir</span><span class="keyword">(</span><span class="default">$dirHandle</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; 
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; } else {
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$result</span><span class="keyword">=</span><span class="default">false</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">$result</span><span class="keyword">;
<br />
&nbsp;&nbsp;&nbsp; }
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="91010""></a>
  <div class="note">
   <strong class="user">gimmicklessgpt at gmail dot com</strong>
   <a href="#91010" class="date">21-May-2009 01:04</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Here's a simple recursive function to copy entire directories
<br />

<br />
Note to do your own check to make sure the directory exists that you first call it on.
<br />

<br />
<span class="default">&lt;?php
<br />
</span><span class="keyword">function </span><span class="default">recurse_copy</span><span class="keyword">(</span><span class="default">$src</span><span class="keyword">,</span><span class="default">$dst</span><span class="keyword">) {
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$dir </span><span class="keyword">= </span><span class="default">opendir</span><span class="keyword">(</span><span class="default">$src</span><span class="keyword">);
<br />
&nbsp;&nbsp;&nbsp; @</span><span class="default">mkdir</span><span class="keyword">(</span><span class="default">$dst</span><span class="keyword">);
<br />
&nbsp;&nbsp;&nbsp; while(</span><span class="default">false </span><span class="keyword">!== ( </span><span class="default">$file </span><span class="keyword">= </span><span class="default">readdir</span><span class="keyword">(</span><span class="default">$dir</span><span class="keyword">)) ) {
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if (( </span><span class="default">$file </span><span class="keyword">!= </span><span class="string">'.' </span><span class="keyword">) &amp;&amp; ( </span><span class="default">$file </span><span class="keyword">!= </span><span class="string">'..' </span><span class="keyword">)) {
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if ( </span><span class="default">is_dir</span><span class="keyword">(</span><span class="default">$src </span><span class="keyword">. </span><span class="string">'/' </span><span class="keyword">. </span><span class="default">$file</span><span class="keyword">) ) {
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">recurse_copy</span><span class="keyword">(</span><span class="default">$src </span><span class="keyword">. </span><span class="string">'/' </span><span class="keyword">. </span><span class="default">$file</span><span class="keyword">,</span><span class="default">$dst </span><span class="keyword">. </span><span class="string">'/' </span><span class="keyword">. </span><span class="default">$file</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; else { 
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">copy</span><span class="keyword">(</span><span class="default">$src </span><span class="keyword">. </span><span class="string">'/' </span><span class="keyword">. </span><span class="default">$file</span><span class="keyword">,</span><span class="default">$dst </span><span class="keyword">. </span><span class="string">'/' </span><span class="keyword">. </span><span class="default">$file</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }
<br />
&nbsp;&nbsp;&nbsp; }
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">closedir</span><span class="keyword">(</span><span class="default">$dir</span><span class="keyword">);
<br />
}
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="88520""></a>
  <div class="note">
   <strong class="user">nensa at zeec dot biz</strong>
   <a href="#88520" class="date">27-Jan-2009 08:44</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
When I recently had to copy a few millions of small files (&lt; 1kb) from one NAS to another and for some reasons had to do that file by file I compared the following function with copy($src, $dest) and shell_exec("cp -r $src $dest").
<br />

<br />
Surprisingly stream_copy seamed to be slightly faster (at least in this specific context).
<br />

<br />
<span class="default">&lt;?php
<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">function </span><span class="default">stream_copy</span><span class="keyword">(</span><span class="default">$src</span><span class="keyword">, </span><span class="default">$dest</span><span class="keyword">)
<br />
&nbsp;&nbsp;&nbsp; {
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$fsrc </span><span class="keyword">= </span><span class="default">fopen</span><span class="keyword">(</span><span class="default">$src</span><span class="keyword">,</span><span class="string">'r'</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$fdest </span><span class="keyword">= </span><span class="default">fopen</span><span class="keyword">(</span><span class="default">$dest</span><span class="keyword">,</span><span class="string">'w+'</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$len </span><span class="keyword">= </span><span class="default">stream_copy_to_stream</span><span class="keyword">(</span><span class="default">$fsrc</span><span class="keyword">,</span><span class="default">$fdest</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">fclose</span><span class="keyword">(</span><span class="default">$fsrc</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">fclose</span><span class="keyword">(</span><span class="default">$fdest</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">$len</span><span class="keyword">;
<br />
&nbsp;&nbsp;&nbsp; }
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="87289""></a>
  <div class="note">
   <strong class="user">allasso residing at signalmesa dot com</strong>
   <a href="#87289" class="date">28-Nov-2008 12:15</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
As far as recursive copy, something like this seems to work fine for me:<br />
<br />
<span class="default">&lt;?php<br />
$output </span><span class="keyword">= </span><span class="default">shell_exec</span><span class="keyword">( </span><span class="string">" cp -r -a dir_source/* dir_dest 2&gt;&amp;1 " </span><span class="keyword">)<br />
echo </span><span class="default">$output<br />
?&gt;<br />
</span><br />
Of course you need to get all your permissions clear.&nbsp; You can do the necessary stuff to use variables.<br />
<br />
You could also do this to create the destination directory:<br />
<br />
<span class="default">&lt;?php<br />
shell_exec</span><span class="keyword">( </span><span class="string">" cp -r -a dir_source dir_dest 2&gt;&amp;1 " </span><span class="keyword">)<br />
</span><span class="default">?&gt;<br />
</span><br />
This will create a new directory called "dir_dest" if it does not already exist. This is a bit risky though if your situation is ambiguous, and you want to continue to make backups etc, 'cause if you do it twice you end up with: <br />
<br />
dir_destination/dir_source<br />
<br />
to avoid that one could do something like:<br />
<br />
<span class="default">&lt;?php<br />
shell_exec</span><span class="keyword">( </span><span class="string">" mkdir dir_dest;&nbsp; cp -r -a dir_source/* dir_dest 2&gt;&amp;1 " </span><span class="keyword">)<br />
</span><span class="default">?&gt;<br />
</span><br />
Maybe someone can tell me when or why it would be better to use all that PHP code I see here.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="84440""></a>
  <div class="note">
   <strong class="user">jim dot mcgowen at cox dot net</strong>
   <a href="#84440" class="date">14-Jul-2008 07:50</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
On Windows (not sure about Linux) copy will overwrite an existing file but will not change the case of the existing filename.<br />
<br />
In other words if I have a file named "Myfile.txt" and I overwrite it using copy with a file named "MyFile.txt" it will overwrite it but the filename will remain "Myfile.txt".<br />
<br />
If this is a problem (as it was for me) use unlink to delete the existing file first.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="83955""></a>
  <div class="note">
   <strong class="user">steve a h</strong>
   <a href="#83955" class="date">20-Jun-2008 11:44</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Don't forget; you can use copy on remote files, rather than doing messy fopen stuff.&nbsp; e.g.<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">if(!@</span><span class="default">copy</span><span class="keyword">(</span><span class="string">'<a href="http://someserver.com/somefile.zip" rel="nofollow" target="_blank">http://someserver.com/somefile.zip</a>'</span><span class="keyword">,</span><span class="string">'./somefile.zip'</span><span class="keyword">))<br />
{<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$errors</span><span class="keyword">= </span><span class="default">error_get_last</span><span class="keyword">();<br />
&nbsp;&nbsp;&nbsp; echo </span><span class="string">"COPY ERROR: "</span><span class="keyword">.</span><span class="default">$errors</span><span class="keyword">[</span><span class="string">'type'</span><span class="keyword">];<br />
&nbsp;&nbsp;&nbsp; echo </span><span class="string">"&lt;br /&gt;\n"</span><span class="keyword">.</span><span class="default">$errors</span><span class="keyword">[</span><span class="string">'message'</span><span class="keyword">];<br />
} else {<br />
&nbsp;&nbsp;&nbsp; echo </span><span class="string">"File copied from remote!"</span><span class="keyword">;<br />
}<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="83920""></a>
  <div class="note">
   <strong class="user">tom at r dot je</strong>
   <a href="#83920" class="date">18-Jun-2008 05:30</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
It's worth noting that copy() sets the destination file's last modified time/date.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="73219""></a>
  <div class="note">
   <strong class="user">jtaylor -at- ashevillenc -dot- com</strong>
   <a href="#73219" class="date">13-Feb-2007 09:48</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
It seems as though you can only use move_uploaded_file() once on a temporary file that has been uploaded through a form. Most likely the action this function takes destroys the temporary file after it has been moved, assuming permanent placement on a file system.<br />
<br />
Attempting to use the function again in the same PHP script will return false and not move the file.<br />
<br />
I ran into this when an image that was uploaded did not need resizing (smaller than a size threshold) and after moving the temporary upload to the "originals" directory, an attempt was made to again move the temporary file to another folder.<br />
<br />
This behavior is understandable, but be careful - in this instance, I simply used copy() on the file that was already uploaded.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="72644""></a>
  <div class="note">
   <strong class="user">mspreij</strong>
   <a href="#72644" class="date">27-Jan-2007 05:20</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
This function creates a new filename to use for a copy of the given filename, its behaviour was mostly sto^Wborrowed from how the OS X Finder (*1) does it.
<br />
Note it *doesn't* actually copy the file, it just returns the new name. I needed it to work regardless of data source (filesystem, ftp, etc).
<br />

<br />
It also tries to match the current name as neatly as possible:
<br />
foo.txt -&gt; foo copy.txt -&gt; foo copy 1.txt -&gt; foo copy 2.txt [etc]
<br />
foo.bar.baz.jpg -&gt; foo.bar.baz copy.jpg
<br />
foobar -&gt; foobar copy -&gt; foobar copy 1 [etc]
<br />
".txt" -&gt; .txt copy, and "txt." -&gt; txt. copy
<br />
file.longextension -&gt; file.longextension copy
<br />

<br />
It keeps trying until it finds a name that is not yet taken in $list, or until it looped 500 times (change as needed).
<br />

<br />
If the renamed file becomes longer than max filename length, it starts chopping away at the end of the part before where it adds " copy": reallylong...filename.txt -&gt; reallylong...filena copy.txt
<br />

<br />
<span class="default">&lt;?php
<br />

<br />
</span><span class="comment">// $orig = current name, of course
<br />
// $list = array of filenames in the target directory (if none given, it will still return a new name)
<br />
// $max = max length of filename
<br />
</span><span class="keyword">function </span><span class="default">duplicate_name</span><span class="keyword">(</span><span class="default">$orig</span><span class="keyword">, </span><span class="default">$list </span><span class="keyword">= array(), </span><span class="default">$max </span><span class="keyword">= </span><span class="default">64</span><span class="keyword">) {
<br />
&nbsp; </span><span class="default">$ext </span><span class="keyword">= </span><span class="string">''</span><span class="keyword">;
<br />
&nbsp; </span><span class="default">$counter </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">;
<br />
&nbsp; </span><span class="default">$list </span><span class="keyword">= (array) </span><span class="default">$list</span><span class="keyword">;
<br />
&nbsp; </span><span class="default">$max </span><span class="keyword">= (int) </span><span class="default">$max</span><span class="keyword">;
<br />
&nbsp; </span><span class="default">$newname </span><span class="keyword">= </span><span class="default">$orig</span><span class="keyword">;
<br />
&nbsp; do {
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$name </span><span class="keyword">= </span><span class="default">$newname</span><span class="keyword">; </span><span class="comment"># name in, newname out
<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">if (</span><span class="default">preg_match</span><span class="keyword">(</span><span class="string">'/ copy$| copy \d+$/'</span><span class="keyword">, </span><span class="default">$name</span><span class="keyword">, </span><span class="default">$matches</span><span class="keyword">)) {
<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="comment">// don't even check for extension, name ends with " copy[ digits]"
<br />
&nbsp;&nbsp;&nbsp; // preg hereunder matches anything with at least one period in the middle and an extension of 1-5 characters
<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">}elseif (</span><span class="default">preg_match</span><span class="keyword">(</span><span class="string">'/(.+)\.([^.]{1,5})$/'</span><span class="keyword">, </span><span class="default">$name</span><span class="keyword">, </span><span class="default">$parts</span><span class="keyword">)) {
<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="comment">// split to name &amp; extension
<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="keyword">list(</span><span class="default">$name</span><span class="keyword">, </span><span class="default">$ext</span><span class="keyword">) = array(</span><span class="default">$parts</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">], </span><span class="default">$parts</span><span class="keyword">[</span><span class="default">2</span><span class="keyword">]);
<br />
&nbsp;&nbsp;&nbsp; }
<br />
&nbsp;&nbsp;&nbsp; if (</span><span class="default">preg_match</span><span class="keyword">(</span><span class="string">'/ copy (\d+)$/'</span><span class="keyword">, </span><span class="default">$name</span><span class="keyword">, </span><span class="default">$digits</span><span class="keyword">)) {
<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="default">$newname </span><span class="keyword">= </span><span class="default">substr</span><span class="keyword">(</span><span class="default">$name</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, - </span><span class="default">strlen</span><span class="keyword">(</span><span class="default">$digits</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">])) . (</span><span class="default">$digits</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">] + </span><span class="default">1</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="comment"># $cutlen is only used for the bit at the end where it checks on max filename length
<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="default">$cutlen </span><span class="keyword">= </span><span class="default">6 </span><span class="keyword">+ </span><span class="default">strlen</span><span class="keyword">(</span><span class="default">$digits</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">]+</span><span class="default">1</span><span class="keyword">); </span><span class="comment">// ' copy ' + digits
<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">}elseif(</span><span class="default">preg_match</span><span class="keyword">(</span><span class="string">'/ copy$/'</span><span class="keyword">, </span><span class="default">$name</span><span class="keyword">, </span><span class="default">$digits</span><span class="keyword">)) {
<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="default">$newname </span><span class="keyword">= </span><span class="default">$name </span><span class="keyword">. </span><span class="string">' 1'</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="default">$cutlen </span><span class="keyword">= </span><span class="default">7</span><span class="keyword">; </span><span class="comment">// ' copy' + ' 1'
<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">}else{
<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="default">$newname </span><span class="keyword">= </span><span class="default">$name </span><span class="keyword">. </span><span class="string">' copy'</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="default">$cutlen </span><span class="keyword">= </span><span class="default">5</span><span class="keyword">; </span><span class="comment">// ' copy'
<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">}
<br />
&nbsp;&nbsp;&nbsp; if (</span><span class="default">$ext</span><span class="keyword">) {
<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="default">$newname </span><span class="keyword">.= </span><span class="string">'.' </span><span class="keyword">. </span><span class="default">$ext</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="default">$cutlen </span><span class="keyword">+= </span><span class="default">strlen</span><span class="keyword">(</span><span class="default">$ext</span><span class="keyword">) + </span><span class="default">1</span><span class="keyword">;
<br />
&nbsp;&nbsp;&nbsp; }
<br />
&nbsp;&nbsp;&nbsp; if (</span><span class="default">$max </span><span class="keyword">&gt; </span><span class="default">0</span><span class="keyword">) {
<br />
&nbsp;&nbsp; &nbsp;&nbsp; if (</span><span class="default">strlen</span><span class="keyword">(</span><span class="default">$newname</span><span class="keyword">) &gt; </span><span class="default">$max</span><span class="keyword">) {
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$newname </span><span class="keyword">= </span><span class="default">substr</span><span class="keyword">(</span><span class="default">$newname</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">max</span><span class="keyword">(</span><span class="default">$max </span><span class="keyword">- </span><span class="default">$cutlen</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">)) . </span><span class="default">substr</span><span class="keyword">(</span><span class="default">$newname</span><span class="keyword">, -</span><span class="default">$cutlen</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">strlen</span><span class="keyword">(</span><span class="default">$newname</span><span class="keyword">) &gt; </span><span class="default">$max</span><span class="keyword">) {echo </span><span class="string">"duplicate_name() error: Can't keep the new name under given max length.\n"</span><span class="keyword">; return </span><span class="default">false</span><span class="keyword">;}
<br />
&nbsp;&nbsp; &nbsp;&nbsp; }
<br />
&nbsp;&nbsp;&nbsp; }
<br />
&nbsp;&nbsp;&nbsp; if (</span><span class="default">$counter</span><span class="keyword">++ &gt; </span><span class="default">500</span><span class="keyword">) {echo </span><span class="string">"duplicate_name() error: Too many similarly named files or infinite while loop.\n"</span><span class="keyword">; return </span><span class="default">false</span><span class="keyword">;}
<br />
&nbsp; } while (</span><span class="default">in_array</span><span class="keyword">(</span><span class="default">$newname</span><span class="keyword">, </span><span class="default">$list</span><span class="keyword">));
<br />
&nbsp; return </span><span class="default">$newname</span><span class="keyword">;
<br />
}
<br />

<br />
</span><span class="default">?&gt;
<br />
</span>
<br />
*1) The Finder seems to check the extension vs a list of known extensions, this function considers it valid if it's 5 or fewer characters long.
<br />

<br />
ps. sorry for taking up so much space! :-)</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="62807""></a>
  <div class="note">
   <strong class="user">cooper at asu dot ntu-kpi dot kiev dot ua</strong>
   <a href="#62807" class="date">10-Mar-2006 01:32</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
It take me a long time to find out what the problem is when i've got an error on copy(). It DOESN'T create any directories. It only copies to existing path. So create directories before. Hope i'll help,</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="45357""></a>
  <div class="note">
   <strong class="user">simonr_at_orangutan_dot_co_dot_uk</strong>
   <a href="#45357" class="date">03-Sep-2004 10:54</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Having spent hours tacking down a copy() error: Permission denied , (and duly worrying about chmod on winXP) , its worth pointing out that the 'destination' needs to contain the actual file name ! --- NOT just the path to the folder you wish to copy into.......<br />
DOH !<br />
hope this saves somebody hours of fruitless debugging</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="45209""></a>
  <div class="note">
   <strong class="user">kadnan at yahoo dot com</strong>
   <a href="#45209" class="date">30-Aug-2004 07:30</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
you can also try xcopy command by using Shell to move/copy files/folders from one place to another
<br />
here is the code:
<br />

<br />
<span class="default">&lt;?php
<br />
exec</span><span class="keyword">(</span><span class="string">'xcopy c:\\myfolder d:\\myfolder /e/i'</span><span class="keyword">, </span><span class="default">$a</span><span class="keyword">, </span><span class="default">$a1</span><span class="keyword">);
<br />
</span><span class="default">?&gt;
<br />
</span>
<br />
by executing this command, it will move folder along with all contents to destination.
<br />

<br />
-adnan</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
</div>
</div>
</div></div></body></html>
