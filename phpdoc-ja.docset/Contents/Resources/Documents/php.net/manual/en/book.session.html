<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
 <head>
  <meta http-equiv="content-type" content="text/html; CHARSET=shift-jis">
  <title>セッション処理</title>

  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <link media="all" rel="stylesheet" type="text/css" href="style.css"/>
 </head>
 <body class="docs" class="docs"><div class="navbar navbar-fixed-top">
  <div class="navbar-inner clearfix">
    <ul class="nav" style="width: 100%">
      <li style="float: left;"><a href="function.msession-unlock.html">≪ msession_unlock</a></li>
      <li style="float: right;"><a href="intro.session.html">導入 ≫</a></li>
    </ul>
  </div>
</div>
<div id="breadcrumbs" class="clearfix">
  <ul class="breadcrumbs-container">
    <li><a href="index.html">PHP Manual</a></li>
    <li><a href="refs.basic.session.html">セッション関連</a></li>
    <li>セッション処理</li>
  </ul>
</div>
<div id="layout">
  <div id="layout-content"><div id="book.session" class="book">
 
 <h1 class="title">セッション処理</h1>
 

 
 
 

 







 

 








 









 








 









 









 







 








<ul class="chunklist chunklist_book"><li><a href="intro.session.html">導入</a></li><li><a href="session.setup.html">インストール/設定</a><ul class="chunklist chunklist_book chunklist_children"><li><a href="session.requirements.html">要件</a></li><li><a href="session.installation.html">インストール手順</a></li><li><a href="session.configuration.html">実行時設定</a></li><li><a href="session.resources.html">リソース型</a></li></ul></li><li><a href="session.constants.html">定義済み定数</a></li><li><a href="session.examples.html">例</a><ul class="chunklist chunklist_book chunklist_children"><li><a href="session.examples.basic.html">基本的な使用法</a></li><li><a href="session.idpassing.html">セッションIDの受渡し</a></li><li><a href="session.customhandler.html">カスタムセッションハンドラ</a></li></ul></li><li><a href="session.upload-progress.html">セッションのアップロード状況</a></li><li><a href="session.security.html">セッションとセキュリティ</a></li><li><a href="ref.session.html">セッション関数</a><ul class="chunklist chunklist_book chunklist_children"><li><a href="function.session-cache-expire.html">session_cache_expire</a> &mdash; 現在のキャッシュの有効期限を返す</li><li><a href="function.session-cache-limiter.html">session_cache_limiter</a> &mdash; 現在のキャッシュリミッタを取得または設定する</li><li><a href="function.session-commit.html">session_commit</a> &mdash; session_write_close のエイリアス</li><li><a href="function.session-decode.html">session_decode</a> &mdash; セッションエンコードされた文字列からセッションデータをデコードする</li><li><a href="function.session-destroy.html">session_destroy</a> &mdash; セッションに登録されたデータを全て破棄する</li><li><a href="function.session-encode.html">session_encode</a> &mdash; 現在のセッションデータを、セッションエンコードされた文字列に変換する</li><li><a href="function.session-get-cookie-params.html">session_get_cookie_params</a> &mdash; セッションクッキーのパラメータを得る</li><li><a href="function.session-id.html">session_id</a> &mdash; 現在のセッション ID を取得または設定する</li><li><a href="function.session-is-registered.html">session_is_registered</a> &mdash; 変数がセッションに登録されているかどうかを調べる</li><li><a href="function.session-module-name.html">session_module_name</a> &mdash; 現在のセッションモジュールを取得または設定する</li><li><a href="function.session-name.html">session_name</a> &mdash; 現在のセッション名を取得または設定する</li><li><a href="function.session-regenerate-id.html">session_regenerate_id</a> &mdash; 現在のセッションIDを新しく生成したものと置き換える</li><li><a href="function.session-register-shutdown.html">session_register_shutdown</a> &mdash; セッションのシャットダウン関数</li><li><a href="function.session-register.html">session_register</a> &mdash; 現在のセッションに1つ以上の変数を登録する</li><li><a href="function.session-save-path.html">session_save_path</a> &mdash; 現在のセッションデータ保存パスを取得または設定する</li><li><a href="function.session-set-cookie-params.html">session_set_cookie_params</a> &mdash; セッションクッキーパラメータを設定する</li><li><a href="function.session-set-save-handler.html">session_set_save_handler</a> &mdash; ユーザー定義のセッション保存関数を設定する</li><li><a href="function.session-start.html">session_start</a> &mdash; 新しいセッションを開始、あるいは既存のセッションを再開する</li><li><a href="function.session-status.html">session_status</a> &mdash; 現在のセッションの状態を返す</li><li><a href="function.session-unregister.html">session_unregister</a> &mdash; 現在のセッションから変数の登録を削除する</li><li><a href="function.session-unset.html">session_unset</a> &mdash; 全てのセッション変数を開放する</li><li><a href="function.session-write-close.html">session_write_close</a> &mdash; セッションデータを書き込んでセッションを終了する</li></ul></li><li><a href="class.sessionhandler.html">SessionHandler</a> &mdash; SessionHandler クラス<ul class="chunklist chunklist_book chunklist_children"><li><a href="sessionhandler.close.html">SessionHandler::close</a> &mdash; セッションを閉じる</li><li><a href="sessionhandler.destroy.html">SessionHandler::destroy</a> &mdash; セッションを破棄する</li><li><a href="sessionhandler.gc.html">SessionHandler::gc</a> &mdash; 古いセッションを削除する</li><li><a href="sessionhandler.open.html">SessionHandler::open</a> &mdash; セッションを開始する</li><li><a href="sessionhandler.read.html">SessionHandler::read</a> &mdash; セッションのデータを読み込む</li><li><a href="sessionhandler.write.html">SessionHandler::write</a> &mdash; セッションのデータを書き込む</li></ul></li><li><a href="class.sessionhandlerinterface.html">SessionHandlerInterface</a> &mdash; SessionHandlerInterface クラス<ul class="chunklist chunklist_book chunklist_children"><li><a href="sessionhandlerinterface.close.html">SessionHandlerInterface::close</a> &mdash; セッションを閉じる</li><li><a href="sessionhandlerinterface.destroy.html">SessionHandlerInterface::destroy</a> &mdash; セッションを破棄する</li><li><a href="sessionhandlerinterface.gc.html">SessionHandlerInterface::gc</a> &mdash; 古いセッションを削除する</li><li><a href="sessionhandlerinterface.open.html">SessionHandlerInterface::open</a> &mdash; セッションを開始する</li><li><a href="sessionhandlerinterface.read.html">SessionHandlerInterface::read</a> &mdash; セッションのデータを読み込む</li><li><a href="sessionhandlerinterface.write.html">SessionHandlerInterface::write</a> &mdash; セッションのデータを書き込む</li></ul></li></ul></div><div id="usernotes">
 <div class="head">
  <h3 class="title">User Contributed Notes</h3>
 </div>
<div id="allnotes">  <a name="103020""></a>
  <div class="note">
   <strong class="user">roberto at spadim dot com dot br</strong>
   <a href="#103020" class="date">21-Mar-2011 07:28</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
instead of memcache, you should consider using redis<br />
<a href="http://redis.io/commands" rel="nofollow" target="_blank">http://redis.io/commands</a><br />
<br />
it have KEYS command (<a href="http://redis.io/commands/keys" rel="nofollow" target="_blank">http://redis.io/commands/keys</a>) that can return all keys (like 'ls'/'dir' at php sessions directory)<br />
<br />
it allow replication too (cluster use)<br />
<br />
i don't know if anyone wrote a version of phpsessions using redis yet, but since memcache don't have KEYS command, it's hard to know if the users is connected (at app side) or what sessions still active (not expired/not logged)</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="102685""></a>
  <div class="note">
   <strong class="user">elephant at punx dot pl</strong>
   <a href="#102685" class="date">28-Feb-2011 08:51</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Please note, that database is NOT recommended for session storage. It can be a big performance bottleneck, especially in replicated environments.<br />
<br />
For saving sessions, file handler seems to be very effective for most setups, except those situations:<br />
&nbsp;- if performance is an issue, the directory which stores session files can be mounted as tmpfs (ram disk).<br />
&nbsp;- if sharing sessions across multiple webservers is needed (in clustered environments), use memcache for storing session information (tip: you can setup more than one instance of memcache eliminate single point of failure). This method, however, sets a limitation of session size to 64k (this should be enough for most applications)<br />
&nbsp;- don't use NFS for sharing session files between webservers, it does not handle locking correctly and can cause corruption of session data.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="90351""></a>
  <div class="note">
   <strong class="user">e dot mortoray at ecircle dot com</strong>
   <a href="#90351" class="date">17-Apr-2009 02:02</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
There is a nuance we found with session timing out although the user is still active in the session.&nbsp; The problem has to do with never modifying the session variable.
<br />

<br />
The GC will clear the session data files based on their last modification time.&nbsp; Thus if you never modify the session, you simply read from it, then the GC will eventually clean up.
<br />

<br />
To prevent this you need to ensure that your session is modified within the GC delete time.&nbsp; You can accomplish this like below.
<br />

<br />
<span class="default">&lt;?php
<br />
</span><span class="keyword">if( !isset(</span><span class="default">$_SESSION</span><span class="keyword">[</span><span class="string">'last_access'</span><span class="keyword">]) || (</span><span class="default">time</span><span class="keyword">() - </span><span class="default">$_SESSION</span><span class="keyword">[</span><span class="string">'last_access'</span><span class="keyword">]) &gt; </span><span class="default">60 </span><span class="keyword">)
<br />
&nbsp; </span><span class="default">$_SESSION</span><span class="keyword">[</span><span class="string">'last_access'</span><span class="keyword">] = </span><span class="default">time</span><span class="keyword">();
<br />
</span><span class="default">?&gt;
<br />
</span>
<br />
This will update the session every 60s to ensure that the modification date is altered.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="88230""></a>
  <div class="note">
   <strong class="user">Some Guy</strong>
   <a href="#88230" class="date">16-Jan-2009 01:26</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Just some notes - it seems that php does the session writing after the script exits.<br />
For example, if you set a bunch of session variables and then run session_regenerate_id() - the session variables are never written to the old session. The new session id is generated when you ask it to be generated, but the session exists only in memory until after the script exits - when the session is written and any and all session variables are written to it.<br />
<br />
This caused me some confusion, as I'm running sessions in an sql database rather than flat file, trying to do any manipulation of the session database directly in a script where you have run session_regenerate_id() will fail for the new session ID because the insert hasn't been done yet, and setting any session variables will only be written to the new session, even if set before you regenerate the session ID.<br />
<br />
Also - if using a database for sessions, make sure to use mysql_real_escape_string() before saving any session variables.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="84753""></a>
  <div class="note">
   <strong class="user">Madster</strong>
   <a href="#84753" class="date">28-Jul-2008 09:45</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
When you include a php file in your current script it's included, not processed separately, thus it's still within the same page and the current page hasn't finished processing.<br />
Thus, session is not set yet. This is the expected behaviour.<br />
<br />
If you need to load a page after setting session data, you should set session data and then send a redirection or refresh header (remember not to send anything, not even whitespace before sending headers).<br />
<br />
Always consider session data to be updated after the next page load (as in http request completed).</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
</div>
</div>
</div></div></body></html>
