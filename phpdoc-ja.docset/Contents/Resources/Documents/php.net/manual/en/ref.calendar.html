<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
 <head>
  <meta http-equiv="content-type" content="text/html; CHARSET=shift-jis">
  <title>カレンダー 関数</title>

  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <link media="all" rel="stylesheet" type="text/css" href="style.css"/>
 </head>
 <body class="docs" class="docs"><div class="navbar navbar-fixed-top">
  <div class="navbar-inner clearfix">
    <ul class="nav" style="width: 100%">
      <li style="float: left;"><a href="calendar.constants.html">≪ 定義済み定数</a></li>
      <li style="float: right;"><a href="function.cal-days-in-month.html">cal_days_in_month ≫</a></li>
    </ul>
  </div>
</div>
<div id="breadcrumbs" class="clearfix">
  <ul class="breadcrumbs-container">
    <li><a href="index.html">PHP Manual</a></li>
    <li><a href="book.calendar.html">カレンダー</a></li>
    <li>カレンダー 関数</li>
  </ul>
</div>
<div id="layout">
  <div id="layout-content"><div id="ref.calendar" class="reference">
  <h1 class="title">カレンダー 関数</h1>

































 
































































































 <h2>目次</h2><ul class="chunklist chunklist_reference"><li><a href="function.cal-days-in-month.html">cal_days_in_month</a> &mdash; 指定した年とカレンダーについて、月の日数を返す</li><li><a href="function.cal-from-jd.html">cal_from_jd</a> &mdash; ユリウス積算日からサポートされるカレンダーに変換する</li><li><a href="function.cal-info.html">cal_info</a> &mdash; 特定のカレンダーに関する情報を返す</li><li><a href="function.cal-to-jd.html">cal_to_jd</a> &mdash; サポートされるカレンダーからユリウス積算日に変換する</li><li><a href="function.easter-date.html">easter_date</a> &mdash; 指定した年における復活祭の真夜中のUnix時を得る</li><li><a href="function.easter-days.html">easter_days</a> &mdash; 指定した年において、3 月 21 日から復活祭までの日数を得る</li><li><a href="function.frenchtojd.html">FrenchToJD</a> &mdash; フランス革命暦をユリウス積算日に変換する</li><li><a href="function.gregoriantojd.html">GregorianToJD</a> &mdash; グレゴリウス日をユリウス積算日に変換する</li><li><a href="function.jddayofweek.html">JDDayOfWeek</a> &mdash; 曜日を返す</li><li><a href="function.jdmonthname.html">JDMonthName</a> &mdash; 月の名前を返す</li><li><a href="function.jdtofrench.html">JDToFrench</a> &mdash; ユリウス積算日をフランス革命暦(共和暦)に変換する</li><li><a href="function.jdtogregorian.html">JDToGregorian</a> &mdash; ユリウス積算日をグレゴリウス日に変換する</li><li><a href="function.jdtojewish.html">jdtojewish</a> &mdash; ユリウス積算日をユダヤ暦に変換する</li><li><a href="function.jdtojulian.html">JDToJulian</a> &mdash; ユリウス積算日をユリウス暦に変換する</li><li><a href="function.jdtounix.html">jdtounix</a> &mdash; ユリウス歴を Unix タイムスタンプに変換する</li><li><a href="function.jewishtojd.html">JewishToJD</a> &mdash; ユダヤ暦の日付けをユリウス積算日に変換する</li><li><a href="function.juliantojd.html">JulianToJD</a> &mdash; ユリウス暦をユリウス積算日に変換する</li><li><a href="function.unixtojd.html">unixtojd</a> &mdash; Unix タイムスタンプをユリウス歴に変換する</li></ul>
</div>
<div id="usernotes">
 <div class="head">
  <h3 class="title">User Contributed Notes</h3>
 </div>
<div id="allnotes">  <a name="79302""></a>
  <div class="note">
   <strong class="user">simon at chronolabs dot org dot au</strong>
   <a href="#79302" class="date">20-Nov-2007 09:20</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
<span class="default">&lt;?php<br />
<br />
</span><span class="comment">// You need to replace this section in Function EgyptianCalendar<br />
// As well as Function MayanTihkalCalendar<br />
</span><span class="default">$revolutionsperyear </span><span class="keyword">= </span><span class="default">$ttl_num </span><span class="keyword">/ </span><span class="default">$i</span><span class="keyword">;<br />
</span><span class="default">$numyears </span><span class="keyword">= </span><span class="default">floor</span><span class="keyword">((</span><span class="default">ceil</span><span class="keyword">(</span><span class="default">$roun</span><span class="keyword">) / </span><span class="default">$revolutionsperyear</span><span class="keyword">));<br />
</span><span class="default">$avg_num_month </span><span class="keyword">= </span><span class="default">$ttl_num_months</span><span class="keyword">/</span><span class="default">$i</span><span class="keyword">;<br />
</span><span class="default">$jtl </span><span class="keyword">= </span><span class="default">abs</span><span class="keyword">(</span><span class="default">abs</span><span class="keyword">(</span><span class="default">$roun</span><span class="keyword">) - </span><span class="default">ceil</span><span class="keyword">(</span><span class="default">$revolutionsperyear</span><span class="keyword">*(</span><span class="default">$numyears</span><span class="keyword">+</span><span class="default">1</span><span class="keyword">)));<br />
while(</span><span class="default">$month</span><span class="keyword">==</span><span class="default">0</span><span class="keyword">){<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$day</span><span class="keyword">=</span><span class="default">0</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$u</span><span class="keyword">=</span><span class="default">0</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; foreach(</span><span class="default">$monthusage </span><span class="keyword">as </span><span class="default">$key </span><span class="keyword">=&gt; </span><span class="default">$item</span><span class="keyword">){<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$t</span><span class="keyword">=</span><span class="default">0</span><span class="keyword">;&nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; foreach(</span><span class="default">$item </span><span class="keyword">as </span><span class="default">$numdays</span><span class="keyword">){<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$t</span><span class="keyword">++;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$tt</span><span class="keyword">=</span><span class="default">0</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; for(</span><span class="default">$sh</span><span class="keyword">=</span><span class="default">1</span><span class="keyword">;</span><span class="default">$sh</span><span class="keyword">&lt;=</span><span class="default">$numdays</span><span class="keyword">;</span><span class="default">$sh</span><span class="keyword">++){<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$ii</span><span class="keyword">=</span><span class="default">$ii</span><span class="keyword">+</span><span class="default">1</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$tt</span><span class="keyword">++;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">$ii</span><span class="keyword">==</span><span class="default">floor</span><span class="keyword">(</span><span class="default">$jtl</span><span class="keyword">)){<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">$roun</span><span class="keyword">&lt;</span><span class="default">0</span><span class="keyword">){<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$daynum </span><span class="keyword">= </span><span class="default">$tt</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$month </span><span class="keyword">= </span><span class="default">$t</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; } else {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$daynum </span><span class="keyword">= </span><span class="default">$numdays</span><span class="keyword">-(</span><span class="default">$tt</span><span class="keyword">-</span><span class="default">1</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$month </span><span class="keyword">= </span><span class="default">$avg_num_month</span><span class="keyword">-(</span><span class="default">$t</span><span class="keyword">-</span><span class="default">1</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$sequence </span><span class="keyword">= </span><span class="default">$key</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$nodaycount</span><span class="keyword">=</span><span class="default">true</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">$nodaycount</span><span class="keyword">==</span><span class="default">false</span><span class="keyword">)<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$day</span><span class="keyword">++;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$u</span><span class="keyword">++;<br />
&nbsp;&nbsp;&nbsp; }<br />
}<br />
</span><span class="default">?&gt;<br />
</span><br />
This section of code need to be changed in the calculation I noticed today in our RounCalendar we had a zero day this function will calculate the month and day correctly for the calendars, it is a pretty universe piece of code, I am sorry it wasn't properly tested and need some refactoring.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="79079""></a>
  <div class="note">
   <strong class="user">simon at chronolabs dot org dot au</strong>
   <a href="#79079" class="date">09-Nov-2007 08:44</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
This is the egyptian calendar which was the first 365 day calendar on the planet it has no leap year which makes it a little inaccurate but you can work on your own implementation of this code when you like, this is another implementation of the roun floating point code which is a universal code for generating date codec's you can make practically all calendars with this code the $pweight is based on my research on carbon date stamping etc of when egypt epoch or PPO was made, some people argue a few thousand years while other can date egypts epoch being around 30000 years ago!! This is on the basis of tidal marking on statues and momuments when the are was covered in water after construction from sea level rising.<br />
<br />
<span class="default">&lt;?php<br />
<br />
print_r</span><span class="keyword">(</span><span class="default">EgyptCalendar</span><span class="keyword">(</span><span class="default">time</span><span class="keyword">(),</span><span class="default">0</span><span class="keyword">));<br />
<br />
function </span><span class="default">EgyptianCalendar</span><span class="keyword">(</span><span class="default">$unix_time</span><span class="keyword">, </span><span class="default">$gmt</span><span class="keyword">, <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$poffset </span><span class="keyword">= </span><span class="string">'1970-02-26 7:45 PM'</span><span class="keyword">, <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$pweight </span><span class="keyword">= </span><span class="string">'-9777600.22222222223'</span><span class="keyword">, <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$defiency</span><span class="keyword">=</span><span class="string">'nonedeficient'</span><span class="keyword">, <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$timeset</span><span class="keyword">= array(</span><span class="string">"hours" </span><span class="keyword">=&gt; </span><span class="default">24</span><span class="keyword">, <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="string">"minutes" </span><span class="keyword">=&gt; </span><span class="default">60</span><span class="keyword">, <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="string">"seconds" </span><span class="keyword">=&gt; </span><span class="default">60</span><span class="keyword">))<br />
{<br />
</span><span class="comment">// Code Segment 1 - Calculate Floating Point<br />
</span><span class="default">$tme </span><span class="keyword">= </span><span class="default">$unix_time</span><span class="keyword">;<br />
<br />
if (</span><span class="default">$gmt</span><span class="keyword">&gt;</span><span class="default">0</span><span class="keyword">){</span><span class="default">$gmt</span><span class="keyword">=-</span><span class="default">$gmt</span><span class="keyword">;} else {</span><span class="default">$gmt</span><span class="keyword">=</span><span class="default">abs</span><span class="keyword">(</span><span class="default">$gmt</span><span class="keyword">);}<br />
<br />
</span><span class="default">$ptime </span><span class="keyword">= </span><span class="default">strtotime</span><span class="keyword">(</span><span class="default">$poffset</span><span class="keyword">)+(</span><span class="default">60</span><span class="keyword">*</span><span class="default">60</span><span class="keyword">*</span><span class="default">gmt</span><span class="keyword">);<br />
</span><span class="default">$weight </span><span class="keyword">= </span><span class="default">$pweight</span><span class="keyword">+(</span><span class="default">1</span><span class="keyword">*</span><span class="default">gmt</span><span class="keyword">);<br />
<br />
</span><span class="default">$egypt_xa </span><span class="keyword">= (</span><span class="default">$tme</span><span class="keyword">)/(</span><span class="default">24</span><span class="keyword">*</span><span class="default">60</span><span class="keyword">*</span><span class="default">60</span><span class="keyword">);<br />
</span><span class="default">$egypt_ya </span><span class="keyword">= </span><span class="default">$ptime</span><span class="keyword">/(</span><span class="default">24</span><span class="keyword">*</span><span class="default">60</span><span class="keyword">*</span><span class="default">60</span><span class="keyword">);<br />
</span><span class="default">$egypt </span><span class="keyword">= ((</span><span class="default">$egypt_xa </span><span class="keyword">-</span><span class="default">$egypt_ya</span><span class="keyword">) -<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$weight</span><span class="keyword">)+(</span><span class="default">microtime</span><span class="keyword">/</span><span class="default">999999</span><span class="keyword">);<br />
<br />
</span><span class="comment">// Code Segment 2 - Set month day arrays<br />
</span><span class="default">$nonedeficient </span><span class="keyword">= array(<br />
&nbsp;&nbsp; </span><span class="string">"seq1" </span><span class="keyword">=&gt; array(</span><span class="default">30</span><span class="keyword">,</span><span class="default">30</span><span class="keyword">,</span><span class="default">30</span><span class="keyword">,</span><span class="default">30</span><span class="keyword">,</span><span class="default">30</span><span class="keyword">,</span><span class="default">30</span><span class="keyword">,</span><span class="default">30</span><span class="keyword">,</span><span class="default">30</span><span class="keyword">,</span><span class="default">30</span><span class="keyword">,</span><span class="default">30</span><span class="keyword">,</span><span class="default">30</span><span class="keyword">,</span><span class="default">30</span><span class="keyword">,</span><span class="default">5</span><span class="keyword">));<br />
<br />
</span><span class="default">$monthnames </span><span class="keyword">= array(<br />
&nbsp;&nbsp; </span><span class="string">"seq1" </span><span class="keyword">=&gt; array(</span><span class="string">'Thoth'</span><span class="keyword">,</span><span class="string">'Phaophi'</span><span class="keyword">,</span><span class="string">'Athyr'</span><span class="keyword">,</span><span class="string">'Choiak'</span><span class="keyword">,<br />
&nbsp;&nbsp; </span><span class="string">'Tybi'</span><span class="keyword">, </span><span class="string">'Mecheir'</span><span class="keyword">,</span><span class="string">'Phamenoth'</span><span class="keyword">,</span><span class="string">'Pharmuthi'</span><span class="keyword">,</span><span class="string">'Pachon'</span><span class="keyword">,<br />
&nbsp;&nbsp; </span><span class="string">'Payni'</span><span class="keyword">,</span><span class="string">'Epiphi'</span><span class="keyword">,</span><span class="string">'Mesore'</span><span class="keyword">,</span><span class="string">'epagomenai'</span><span class="keyword">));<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <br />
</span><span class="default">$monthusage </span><span class="keyword">= isset(</span><span class="default">$defiency</span><span class="keyword">) ? ${</span><span class="default">$defiency</span><span class="keyword">} : </span><span class="default">$deficient</span><span class="keyword">;<br />
<br />
</span><span class="comment">// Code Segment 3 - Calculate month number, day number<br />
</span><span class="keyword">foreach(</span><span class="default">$monthusage </span><span class="keyword">as </span><span class="default">$key </span><span class="keyword">=&gt; </span><span class="default">$item</span><span class="keyword">){<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$i</span><span class="keyword">++;<br />
&nbsp;&nbsp;&nbsp; foreach(</span><span class="default">$item </span><span class="keyword">as </span><span class="default">$numdays</span><span class="keyword">){<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$ttl_num</span><span class="keyword">=</span><span class="default">$ttl_num</span><span class="keyword">+</span><span class="default">$numdays</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$ttl_num_months</span><span class="keyword">++;<br />
&nbsp;&nbsp;&nbsp; }<br />
}<br />
<br />
</span><span class="default">$revolutionsperyear </span><span class="keyword">= </span><span class="default">$ttl_num </span><span class="keyword">/ </span><span class="default">$i</span><span class="keyword">;<br />
</span><span class="default">$numyears </span><span class="keyword">= </span><span class="default">egyptd</span><span class="keyword">((</span><span class="default">floor</span><span class="keyword">(</span><span class="default">$egypt</span><span class="keyword">) / </span><span class="default">$revolutionsperyear</span><span class="keyword">),</span><span class="default">0</span><span class="keyword">);<br />
</span><span class="default">$avg_num_month </span><span class="keyword">= </span><span class="default">$ttl_num_months</span><span class="keyword">/</span><span class="default">$i</span><span class="keyword">;<br />
</span><span class="default">$jtl </span><span class="keyword">= </span><span class="default">abs</span><span class="keyword">(</span><span class="default">abs</span><span class="keyword">(</span><span class="default">$egypt</span><span class="keyword">) - <br />
&nbsp;&nbsp; &nbsp; &nbsp; </span><span class="default">ceil</span><span class="keyword">(</span><span class="default">$revolutionsperyear</span><span class="keyword">*(</span><span class="default">$numyears</span><span class="keyword">+</span><span class="default">1</span><span class="keyword">)));<br />
<br />
while(</span><span class="default">$month</span><span class="keyword">==</span><span class="default">0</span><span class="keyword">){<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$day</span><span class="keyword">=</span><span class="default">0</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$u</span><span class="keyword">=</span><span class="default">0</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; foreach(</span><span class="default">$monthusage </span><span class="keyword">as </span><span class="default">$key </span><span class="keyword">=&gt; </span><span class="default">$item</span><span class="keyword">){<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$t</span><span class="keyword">=</span><span class="default">0</span><span class="keyword">;&nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; foreach(</span><span class="default">$item </span><span class="keyword">as </span><span class="default">$numdays</span><span class="keyword">){<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$t</span><span class="keyword">++;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$tt</span><span class="keyword">=</span><span class="default">0</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; for(</span><span class="default">$sh</span><span class="keyword">=</span><span class="default">1</span><span class="keyword">;</span><span class="default">$sh</span><span class="keyword">&lt;=</span><span class="default">$numdays</span><span class="keyword">;</span><span class="default">$sh</span><span class="keyword">++){<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$ii</span><span class="keyword">=</span><span class="default">$ii</span><span class="keyword">+</span><span class="default">1</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$tt</span><span class="keyword">++;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">$ii</span><span class="keyword">==</span><span class="default">floor</span><span class="keyword">(</span><span class="default">$jtl</span><span class="keyword">)){<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">$egypt</span><span class="keyword">&gt;</span><span class="default">0</span><span class="keyword">){<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$daynum </span><span class="keyword">= </span><span class="default">$tt</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$month </span><span class="keyword">= </span><span class="default">$t</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; } else {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$daynum </span><span class="keyword">= </span><span class="default">$numdays</span><span class="keyword">-</span><span class="default">$tt</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$month </span><span class="keyword">= </span><span class="default">$avg_num_month</span><span class="keyword">-</span><span class="default">$t</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$sequence </span><span class="keyword">= </span><span class="default">$key</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$nodaycount</span><span class="keyword">=</span><span class="default">true</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">$nodaycount</span><span class="keyword">==</span><span class="default">false</span><span class="keyword">)<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$day</span><span class="keyword">++;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$u</span><span class="keyword">++;<br />
&nbsp;&nbsp;&nbsp; }<br />
}<br />
<br />
</span><span class="comment">//$numyears = abs($numyears);<br />
<br />
</span><span class="default">$timer </span><span class="keyword">= </span><span class="default">substr</span><span class="keyword">(</span><span class="default">$egypt</span><span class="keyword">, </span><span class="default">strpos</span><span class="keyword">(</span><span class="default">$egypt</span><span class="keyword">,</span><span class="string">'.'</span><span class="keyword">)+</span><span class="default">1</span><span class="keyword">,<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">strlen</span><span class="keyword">(</span><span class="default">$egypt</span><span class="keyword">)-</span><span class="default">strpos</span><span class="keyword">(</span><span class="default">$egypt</span><span class="keyword">,</span><span class="string">'.'</span><span class="keyword">)-</span><span class="default">1</span><span class="keyword">);<br />
</span><span class="default">$egypt_out</span><span class="keyword">= </span><span class="default">$numyears</span><span class="keyword">.</span><span class="string">'/'</span><span class="keyword">.</span><span class="default">$month</span><span class="keyword">.</span><span class="string">'/'</span><span class="keyword">.</span><span class="default">$daynum</span><span class="keyword">.</span><span class="string">' '</span><span class="keyword">.</span><span class="default">$day</span><span class="keyword">.</span><span class="string">'.'</span><span class="keyword">. <br />
&nbsp;&nbsp;&nbsp; </span><span class="default">floor</span><span class="keyword">(</span><span class="default">intval</span><span class="keyword">(</span><span class="default">substr</span><span class="keyword">(</span><span class="default">$timer</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">,</span><span class="default">2</span><span class="keyword">))/</span><span class="default">100</span><span class="keyword">*</span><span class="default">$timeset</span><span class="keyword">[</span><span class="string">'hours'</span><span class="keyword">]).</span><span class="string">':'</span><span class="keyword">. <br />
&nbsp;&nbsp;&nbsp; </span><span class="default">floor</span><span class="keyword">(</span><span class="default">intval</span><span class="keyword">(</span><span class="default">substr</span><span class="keyword">(</span><span class="default">$timer</span><span class="keyword">,</span><span class="default">2</span><span class="keyword">,</span><span class="default">2</span><span class="keyword">))/</span><span class="default">100</span><span class="keyword">*</span><span class="default">$timeset</span><span class="keyword">[</span><span class="string">'minutes'</span><span class="keyword">]).</span><span class="string">':'</span><span class="keyword">. <br />
&nbsp;&nbsp;&nbsp; </span><span class="default">floor</span><span class="keyword">(</span><span class="default">intval</span><span class="keyword">(</span><span class="default">substr</span><span class="keyword">(</span><span class="default">$timer</span><span class="keyword">,</span><span class="default">4</span><span class="keyword">,</span><span class="default">2</span><span class="keyword">))/</span><span class="default">100</span><span class="keyword">*</span><span class="default">$timeset</span><span class="keyword">[</span><span class="string">'seconds'</span><span class="keyword">]).</span><span class="string">'.'</span><span class="keyword">.<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">substr</span><span class="keyword">(</span><span class="default">$timer</span><span class="keyword">,</span><span class="default">6</span><span class="keyword">,</span><span class="default">strlen</span><span class="keyword">(</span><span class="default">$timer</span><span class="keyword">)-</span><span class="default">6</span><span class="keyword">);<br />
</span><span class="default">$egypt_obj </span><span class="keyword">= array(</span><span class="string">'year'</span><span class="keyword">=&gt;</span><span class="default">$numyears</span><span class="keyword">,<br />
&nbsp;&nbsp;&nbsp; </span><span class="string">'month'</span><span class="keyword">=&gt;</span><span class="default">$month</span><span class="keyword">, <br />
&nbsp;&nbsp;&nbsp; </span><span class="string">'mname' </span><span class="keyword">=&gt; </span><span class="default">$monthnames</span><span class="keyword">[</span><span class="default">$sequence</span><span class="keyword">][</span><span class="default">$month</span><span class="keyword">-</span><span class="default">1</span><span class="keyword">],<br />
&nbsp;&nbsp;&nbsp; </span><span class="string">'day'</span><span class="keyword">=&gt;</span><span class="default">$daynum</span><span class="keyword">, <br />
&nbsp;&nbsp;&nbsp; </span><span class="string">'jtl'</span><span class="keyword">=&gt;</span><span class="default">$jtl</span><span class="keyword">, <br />
&nbsp;&nbsp;&nbsp; </span><span class="string">'day_count'</span><span class="keyword">=&gt;</span><span class="default">$day</span><span class="keyword">,<br />
&nbsp;&nbsp;&nbsp; </span><span class="string">'hours'</span><span class="keyword">=&gt;</span><span class="default">floor</span><span class="keyword">(</span><span class="default">intval</span><span class="keyword">(</span><span class="default">substr</span><span class="keyword">(</span><span class="default">$timer</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">,</span><span class="default">2</span><span class="keyword">))/</span><span class="default">100<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="keyword">*</span><span class="default">$timeset</span><span class="keyword">[</span><span class="string">'hours'</span><span class="keyword">]),<br />
&nbsp;&nbsp;&nbsp; </span><span class="string">'minute'</span><span class="keyword">=&gt;</span><span class="default">floor</span><span class="keyword">(</span><span class="default">intval</span><span class="keyword">(</span><span class="default">substr</span><span class="keyword">(</span><span class="default">$timer</span><span class="keyword">,</span><span class="default">2</span><span class="keyword">,</span><span class="default">2</span><span class="keyword">))/</span><span class="default">100<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">*</span><span class="default">$timeset</span><span class="keyword">[</span><span class="string">'minutes'</span><span class="keyword">]),<br />
&nbsp;&nbsp;&nbsp; </span><span class="string">'seconds'</span><span class="keyword">=&gt;</span><span class="default">floor</span><span class="keyword">(</span><span class="default">intval</span><span class="keyword">(</span><span class="default">substr</span><span class="keyword">(</span><span class="default">$timer</span><span class="keyword">,</span><span class="default">4</span><span class="keyword">,</span><span class="default">2</span><span class="keyword">))/</span><span class="default">100<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="keyword">*</span><span class="default">$timeset</span><span class="keyword">[</span><span class="string">'seconds'</span><span class="keyword">]),<br />
&nbsp;&nbsp;&nbsp; </span><span class="string">'microtime'</span><span class="keyword">=&gt;</span><span class="default">substr</span><span class="keyword">(</span><span class="default">$timer</span><span class="keyword">,</span><span class="default">6</span><span class="keyword">,</span><span class="default">strlen</span><span class="keyword">(</span><span class="default">$timer</span><span class="keyword">)-</span><span class="default">6</span><span class="keyword">),<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="string">'strout'</span><span class="keyword">=&gt;</span><span class="default">$egypt_out</span><span class="keyword">);<br />
<br />
return </span><span class="default">$egypt_obj</span><span class="keyword">;<br />
}<br />
<br />
</span><span class="default">?&gt;<br />
</span><br />
btw in my previous post of the Mayan Tikal calendar the top part of the function was chopped off in my code cut and paste that is the line for the function which looks like, the top 3 line will need to be replace with:<br />
<br />
<span class="default">&lt;?php<br />
<br />
print_r</span><span class="keyword">(</span><span class="default">MayanTikalCalendar</span><span class="keyword">(</span><span class="default">time</span><span class="keyword">(),</span><span class="default">0</span><span class="keyword">));<br />
<br />
function </span><span class="default">MayanTikalCalendar</span><span class="keyword">(</span><span class="default">$unix_time</span><span class="keyword">, </span><span class="default">$gmt</span><span class="keyword">, <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="79056""></a>
  <div class="note">
   <strong class="user">simon at chronolabs dot org dot au</strong>
   <a href="#79056" class="date">08-Nov-2007 02:27</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Well this is the second part, well more the second calendar of Maya the Tikal there is two of them one for long count, one for general date seeding, this is using an implementation of floating point time (roun).<br />
<br />
<span class="default">&lt;?php<br />
<br />
$maya </span><span class="keyword">= </span><span class="default">MayanTikalCalendar</span><span class="keyword">(</span><span class="default">time</span><span class="keyword">(),</span><span class="default">0</span><span class="keyword">);<br />
<br />
</span><span class="default">print_r</span><span class="keyword">(</span><span class="default">$maya</span><span class="keyword">);<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$poffset </span><span class="keyword">= </span><span class="string">'2012-12-21 8:24 PM'</span><span class="keyword">, <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$pweight </span><span class="keyword">= </span><span class="string">'-1872000.22222222223'</span><span class="keyword">, <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$defiency</span><span class="keyword">=</span><span class="string">'nonedeficient'</span><span class="keyword">, <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$timeset</span><span class="keyword">= array(</span><span class="string">"hours" </span><span class="keyword">=&gt; </span><span class="default">24</span><span class="keyword">, <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="string">"minutes" </span><span class="keyword">=&gt; </span><span class="default">60</span><span class="keyword">, <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="string">"seconds" </span><span class="keyword">=&gt; </span><span class="default">60</span><span class="keyword">))<br />
{<br />
</span><span class="comment">// Code Segment 1 - Calculate Floating Point<br />
</span><span class="default">$tme </span><span class="keyword">= </span><span class="default">$unix_time</span><span class="keyword">;<br />
if (</span><span class="default">$gmt</span><span class="keyword">&gt;</span><span class="default">0</span><span class="keyword">){ </span><span class="default">$gmt</span><span class="keyword">=-</span><span class="default">$gmt</span><span class="keyword">; } else { </span><span class="default">$gmt</span><span class="keyword">=</span><span class="default">abs</span><span class="keyword">(</span><span class="default">$gmt</span><span class="keyword">); }<br />
<br />
</span><span class="default">$ptime </span><span class="keyword">= </span><span class="default">strtotime</span><span class="keyword">(</span><span class="default">$poffset</span><span class="keyword">)+(</span><span class="default">60</span><span class="keyword">*</span><span class="default">60</span><span class="keyword">*</span><span class="default">gmt</span><span class="keyword">);<br />
</span><span class="default">$maya_xa </span><span class="keyword">= (</span><span class="default">$tme</span><span class="keyword">)/(</span><span class="default">24</span><span class="keyword">*</span><span class="default">60</span><span class="keyword">*</span><span class="default">60</span><span class="keyword">);<br />
</span><span class="default">$maya_ya </span><span class="keyword">= </span><span class="default">$ptime</span><span class="keyword">/(</span><span class="default">24</span><span class="keyword">*</span><span class="default">60</span><span class="keyword">*</span><span class="default">60</span><span class="keyword">);<br />
</span><span class="default">$maya </span><span class="keyword">= ((</span><span class="default">$maya_xa </span><span class="keyword">-</span><span class="default">$maya_ya</span><span class="keyword">) - </span><span class="default">$pweight</span><span class="keyword">)+(</span><span class="default">microtime</span><span class="keyword">/</span><span class="default">999999</span><span class="keyword">);<br />
<br />
</span><span class="comment">// Code Segment 2 - Set month day arrays<br />
</span><span class="default">$nonedeficient </span><span class="keyword">= array(<br />
</span><span class="string">"seq1" </span><span class="keyword">=&gt; array(</span><span class="default">20</span><span class="keyword">,</span><span class="default">20</span><span class="keyword">,</span><span class="default">20</span><span class="keyword">,</span><span class="default">20</span><span class="keyword">,</span><span class="default">20</span><span class="keyword">,</span><span class="default">20</span><span class="keyword">,</span><span class="default">20</span><span class="keyword">,</span><span class="default">20</span><span class="keyword">,</span><span class="default">20</span><span class="keyword">,<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">20</span><span class="keyword">,</span><span class="default">20</span><span class="keyword">,</span><span class="default">20</span><span class="keyword">,</span><span class="default">20</span><span class="keyword">,</span><span class="default">20</span><span class="keyword">,</span><span class="default">20</span><span class="keyword">,</span><span class="default">20</span><span class="keyword">,</span><span class="default">20</span><span class="keyword">,</span><span class="default">20</span><span class="keyword">,</span><span class="default">5</span><span class="keyword">));<br />
<br />
</span><span class="default">$monthnames </span><span class="keyword">= array(</span><span class="string">"seq1" </span><span class="keyword">=&gt; array(<br />
&nbsp;</span><span class="string">'Pop'</span><span class="keyword">, </span><span class="string">'Uo'</span><span class="keyword">, </span><span class="string">'Zip'</span><span class="keyword">, </span><span class="string">'Zot\'z'</span><span class="keyword">, </span><span class="string">'Tzec'</span><span class="keyword">, </span><span class="string">'Xul'</span><span class="keyword">, <br />
&nbsp;</span><span class="string">'Yaxkin'</span><span class="keyword">, </span><span class="string">'Mol'</span><span class="keyword">, </span><span class="string">'Ch\'en'</span><span class="keyword">, </span><span class="string">'Yax'</span><span class="keyword">, </span><span class="string">'Zac'</span><span class="keyword">, </span><span class="string">'Ceh'</span><span class="keyword">, <br />
&nbsp;</span><span class="string">'Mac'</span><span class="keyword">, </span><span class="string">'Kankin'</span><span class="keyword">, </span><span class="string">'Muan'</span><span class="keyword">, </span><span class="string">'Pax'</span><span class="keyword">, </span><span class="string">'Kayab'</span><span class="keyword">, <br />
&nbsp;</span><span class="string">'Cumku'</span><span class="keyword">, </span><span class="string">'Uayeb'</span><span class="keyword">));<br />
</span><span class="default">$daynames </span><span class="keyword">= array(</span><span class="string">"seq1" </span><span class="keyword">=&gt; array(<br />
&nbsp;</span><span class="string">'Imix'</span><span class="keyword">, </span><span class="string">'Ik'</span><span class="keyword">, </span><span class="string">'Akbal'</span><span class="keyword">, </span><span class="string">'Kan'</span><span class="keyword">, </span><span class="string">'Chicchan'</span><span class="keyword">, <br />
&nbsp;</span><span class="string">'Cimi'</span><span class="keyword">,</span><span class="string">'Manik'</span><span class="keyword">, </span><span class="string">'Lamat'</span><span class="keyword">, </span><span class="string">'Muluc'</span><span class="keyword">, </span><span class="string">'Oc'</span><span class="keyword">, <br />
&nbsp;</span><span class="string">'Chuen'</span><span class="keyword">, </span><span class="string">'Eb'</span><span class="keyword">, </span><span class="string">'Ben'</span><span class="keyword">, </span><span class="string">'Ix'</span><span class="keyword">, </span><span class="string">'Men'</span><span class="keyword">, <br />
&nbsp;</span><span class="string">'Cib'</span><span class="keyword">, </span><span class="string">'Caban'</span><span class="keyword">, </span><span class="string">'Etz\'nab'</span><span class="keyword">, </span><span class="string">'Cauac'</span><span class="keyword">, </span><span class="string">'Ahau'</span><span class="keyword">));<br />
</span><span class="default">$monthusage </span><span class="keyword">= isset(</span><span class="default">$defiency</span><span class="keyword">) ? ${</span><span class="default">$defiency</span><span class="keyword">} : </span><span class="default">$deficient</span><span class="keyword">;<br />
<br />
</span><span class="comment">// Code Segment 3 - Calculate month number, day numbers etc<br />
</span><span class="keyword">foreach(</span><span class="default">$monthusage </span><span class="keyword">as </span><span class="default">$key </span><span class="keyword">=&gt; </span><span class="default">$item</span><span class="keyword">){<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$i</span><span class="keyword">++;<br />
&nbsp;&nbsp;&nbsp; foreach(</span><span class="default">$item </span><span class="keyword">as </span><span class="default">$numdays</span><span class="keyword">){<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$ttl_num</span><span class="keyword">=</span><span class="default">$ttl_num</span><span class="keyword">+</span><span class="default">$numdays</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$ttl_num_months</span><span class="keyword">++;<br />
&nbsp;&nbsp;&nbsp; }<br />
}<br />
<br />
</span><span class="default">$revolutionsperyear </span><span class="keyword">= </span><span class="default">$ttl_num </span><span class="keyword">/ </span><span class="default">$i</span><span class="keyword">;<br />
</span><span class="default">$numyears </span><span class="keyword">= (</span><span class="default">round</span><span class="keyword">((</span><span class="default">floor</span><span class="keyword">(</span><span class="default">$maya</span><span class="keyword">) / </span><span class="default">$revolutionsperyear</span><span class="keyword">),</span><span class="default">0</span><span class="keyword">));<br />
</span><span class="default">$avg_num_month </span><span class="keyword">= </span><span class="default">$ttl_num_months</span><span class="keyword">/</span><span class="default">$i</span><span class="keyword">;<br />
</span><span class="default">$jtl </span><span class="keyword">= </span><span class="default">abs</span><span class="keyword">(</span><span class="default">abs</span><span class="keyword">(</span><span class="default">$maya</span><span class="keyword">) - <br />
&nbsp;&nbsp; &nbsp; &nbsp; </span><span class="default">ceil</span><span class="keyword">(</span><span class="default">$revolutionsperyear</span><span class="keyword">*(</span><span class="default">$numyears</span><span class="keyword">+</span><span class="default">1</span><span class="keyword">)));<br />
<br />
while(</span><span class="default">$month</span><span class="keyword">==</span><span class="default">0</span><span class="keyword">){<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$day</span><span class="keyword">=</span><span class="default">0</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$u</span><span class="keyword">=</span><span class="default">0</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; foreach(</span><span class="default">$monthusage </span><span class="keyword">as </span><span class="default">$key </span><span class="keyword">=&gt; </span><span class="default">$item</span><span class="keyword">){<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$t</span><span class="keyword">=</span><span class="default">0</span><span class="keyword">;&nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; foreach(</span><span class="default">$item </span><span class="keyword">as </span><span class="default">$numdays</span><span class="keyword">){<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$t</span><span class="keyword">++;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$tt</span><span class="keyword">=</span><span class="default">0</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; for(</span><span class="default">$sh</span><span class="keyword">=</span><span class="default">1</span><span class="keyword">;</span><span class="default">$sh</span><span class="keyword">&lt;=</span><span class="default">$numdays</span><span class="keyword">;</span><span class="default">$sh</span><span class="keyword">++){<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$ii</span><span class="keyword">=</span><span class="default">$ii</span><span class="keyword">+</span><span class="default">1</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$tt</span><span class="keyword">++;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">$ii</span><span class="keyword">==</span><span class="default">floor</span><span class="keyword">(</span><span class="default">$jtl</span><span class="keyword">)){<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">$maya</span><span class="keyword">&gt;</span><span class="default">0</span><span class="keyword">){<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$daynum </span><span class="keyword">= </span><span class="default">$tt</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$month </span><span class="keyword">= </span><span class="default">$t</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; } else {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$daynum </span><span class="keyword">= </span><span class="default">$numdays</span><span class="keyword">-</span><span class="default">$tt</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$month </span><span class="keyword">= </span><span class="default">$avg_num_month</span><span class="keyword">-</span><span class="default">$t</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$sequence </span><span class="keyword">= </span><span class="default">$key</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$nodaycount</span><span class="keyword">=</span><span class="default">true</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">$nodaycount</span><span class="keyword">==</span><span class="default">false</span><span class="keyword">)<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$day</span><span class="keyword">++;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$u</span><span class="keyword">++;<br />
&nbsp;&nbsp;&nbsp; }<br />
}<br />
<br />
</span><span class="default">$timer </span><span class="keyword">= </span><span class="default">substr</span><span class="keyword">(</span><span class="default">$maya</span><span class="keyword">, </span><span class="default">strpos</span><span class="keyword">(</span><span class="default">$maya</span><span class="keyword">,</span><span class="string">'.'</span><span class="keyword">)+</span><span class="default">1</span><span class="keyword">,<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">strlen</span><span class="keyword">(</span><span class="default">$maya</span><span class="keyword">)-</span><span class="default">strpos</span><span class="keyword">(</span><span class="default">$maya</span><span class="keyword">,</span><span class="string">'.'</span><span class="keyword">)-</span><span class="default">1</span><span class="keyword">);<br />
</span><span class="default">$maya_out</span><span class="keyword">= </span><span class="default">$numyears</span><span class="keyword">.</span><span class="string">'/'</span><span class="keyword">.</span><span class="default">$month</span><span class="keyword">.</span><span class="string">'/'</span><span class="keyword">.</span><span class="default">$daynum</span><span class="keyword">.</span><span class="string">' '</span><span class="keyword">.</span><span class="default">$day</span><span class="keyword">.</span><span class="string">'.'</span><span class="keyword">. <br />
&nbsp; </span><span class="default">floor</span><span class="keyword">(</span><span class="default">intval</span><span class="keyword">(</span><span class="default">substr</span><span class="keyword">(</span><span class="default">$timer</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">,</span><span class="default">2</span><span class="keyword">))/</span><span class="default">100</span><span class="keyword">*</span><span class="default">$timeset</span><span class="keyword">[</span><span class="string">'hours'</span><span class="keyword">]).</span><span class="string">':'</span><span class="keyword">. <br />
&nbsp; </span><span class="default">floor</span><span class="keyword">(</span><span class="default">intval</span><span class="keyword">(</span><span class="default">substr</span><span class="keyword">(</span><span class="default">$timer</span><span class="keyword">,</span><span class="default">2</span><span class="keyword">,</span><span class="default">2</span><span class="keyword">))/</span><span class="default">100</span><span class="keyword">*</span><span class="default">$timeset</span><span class="keyword">[</span><span class="string">'minutes'</span><span class="keyword">]).</span><span class="string">':'</span><span class="keyword">. <br />
&nbsp; </span><span class="default">floor</span><span class="keyword">(</span><span class="default">intval</span><span class="keyword">(</span><span class="default">substr</span><span class="keyword">(</span><span class="default">$timer</span><span class="keyword">,</span><span class="default">4</span><span class="keyword">,</span><span class="default">2</span><span class="keyword">))/</span><span class="default">100</span><span class="keyword">*</span><span class="default">$timeset</span><span class="keyword">[</span><span class="string">'seconds'</span><span class="keyword">]).</span><span class="string">'.'</span><span class="keyword">.<br />
&nbsp; </span><span class="default">substr</span><span class="keyword">(</span><span class="default">$timer</span><span class="keyword">,</span><span class="default">6</span><span class="keyword">,</span><span class="default">strlen</span><span class="keyword">(</span><span class="default">$timer</span><span class="keyword">)-</span><span class="default">6</span><span class="keyword">);<br />
<br />
</span><span class="default">$maya_obj </span><span class="keyword">= array(<br />
&nbsp; </span><span class="string">'longcount'</span><span class="keyword">=&gt;</span><span class="default">MayanLongCount</span><span class="keyword">(</span><span class="default">$tme</span><span class="keyword">),</span><span class="string">'year'</span><span class="keyword">=&gt;</span><span class="default">abs</span><span class="keyword">(</span><span class="default">$numyears</span><span class="keyword">),<br />
&nbsp; </span><span class="string">'month'</span><span class="keyword">=&gt;</span><span class="default">$month</span><span class="keyword">, </span><span class="string">'mname' </span><span class="keyword">=&gt; </span><span class="default">$monthnames</span><span class="keyword">[</span><span class="default">$sequence</span><span class="keyword">][</span><span class="default">$month</span><span class="keyword">-</span><span class="default">1</span><span class="keyword">],<br />
&nbsp; </span><span class="string">'day'</span><span class="keyword">=&gt;</span><span class="default">$daynum</span><span class="keyword">, </span><span class="string">'dayname'</span><span class="keyword">=&gt;</span><span class="default">$daynames</span><span class="keyword">[</span><span class="default">$sequence</span><span class="keyword">][</span><span class="default">$daynum</span><span class="keyword">-</span><span class="default">1</span><span class="keyword">], <br />
&nbsp; </span><span class="string">'day'</span><span class="keyword">=&gt;</span><span class="default">$daynum</span><span class="keyword">, </span><span class="string">'jtl'</span><span class="keyword">=&gt;</span><span class="default">$jtl</span><span class="keyword">, </span><span class="string">'day_count'</span><span class="keyword">=&gt;</span><span class="default">$day</span><span class="keyword">,<br />
&nbsp; </span><span class="string">'hours'</span><span class="keyword">=&gt;&nbsp; &nbsp;&nbsp; </span><span class="default">floor</span><span class="keyword">(</span><span class="default">intval</span><span class="keyword">(</span><span class="default">substr</span><span class="keyword">(</span><span class="default">$timer</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">,</span><span class="default">2</span><span class="keyword">))/</span><span class="default">100<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="keyword">*</span><span class="default">$timeset</span><span class="keyword">[</span><span class="string">'hours'</span><span class="keyword">]),<br />
&nbsp; </span><span class="string">'minute'</span><span class="keyword">=&gt; </span><span class="default">floor</span><span class="keyword">(</span><span class="default">intval</span><span class="keyword">(</span><span class="default">substr</span><span class="keyword">(</span><span class="default">$timer</span><span class="keyword">,</span><span class="default">2</span><span class="keyword">,</span><span class="default">2</span><span class="keyword">))/</span><span class="default">100<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="keyword">*</span><span class="default">$timeset</span><span class="keyword">[</span><span class="string">'minutes'</span><span class="keyword">]),<br />
&nbsp; </span><span class="string">'seconds'</span><span class="keyword">=&gt;</span><span class="default">floor</span><span class="keyword">(</span><span class="default">intval</span><span class="keyword">(</span><span class="default">substr</span><span class="keyword">(</span><span class="default">$timer</span><span class="keyword">,</span><span class="default">4</span><span class="keyword">,</span><span class="default">2</span><span class="keyword">))/</span><span class="default">100<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="keyword">*</span><span class="default">$timeset</span><span class="keyword">[</span><span class="string">'seconds'</span><span class="keyword">]),<br />
&nbsp; </span><span class="string">'microtime'</span><span class="keyword">=&gt;</span><span class="default">substr</span><span class="keyword">(</span><span class="default">$timer</span><span class="keyword">,</span><span class="default">6</span><span class="keyword">,</span><span class="default">strlen</span><span class="keyword">(</span><span class="default">$timer</span><span class="keyword">)-</span><span class="default">6</span><span class="keyword">),<br />
&nbsp; </span><span class="string">'strout'</span><span class="keyword">=&gt;</span><span class="default">$maya_out</span><span class="keyword">);<br />
<br />
return </span><span class="default">$maya_obj</span><span class="keyword">;<br />
}<br />
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="79046""></a>
  <div class="note">
   <strong class="user">simon at chronolabs dot org dot au</strong>
   <a href="#79046" class="date">08-Nov-2007 07:00</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
This will return the mayan long count calendar which cycle reaches 13.0.0.0.0 in 2012, I have had to compress the changemaya function for this code library so if you want to space it out your more than welcome. It works with unix time. To call the routine use the following syntax. The mayan calendar is a day count that is around 5000 years old, it tracks our cestial position in the galaxy <br />
<br />
<span class="default">&lt;?php<br />
<br />
</span><span class="keyword">echo </span><span class="default">MayanLongCount</span><span class="keyword">(</span><span class="default">time</span><span class="keyword">());<br />
<br />
function </span><span class="default">MayanLongCount</span><span class="keyword">(</span><span class="default">$tme</span><span class="keyword">){<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$config </span><span class="keyword">= array(</span><span class="string">'ppo' </span><span class="keyword">=&gt; array(</span><span class="default">13</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">),<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="string">'epoch' </span><span class="keyword">=&gt; </span><span class="default">strtotime</span><span class="keyword">(</span><span class="string">'2012-12-21'</span><span class="keyword">));<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$diff</span><span class="keyword">=((</span><span class="default">$tme</span><span class="keyword">-</span><span class="default">$config</span><span class="keyword">[</span><span class="string">'epoch'</span><span class="keyword">])/(</span><span class="default">60</span><span class="keyword">*</span><span class="default">60</span><span class="keyword">*</span><span class="default">24</span><span class="keyword">));<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$ppo </span><span class="keyword">= </span><span class="default">changemaya</span><span class="keyword">(</span><span class="default">$config</span><span class="keyword">[</span><span class="string">'ppo'</span><span class="keyword">],</span><span class="default">ceil</span><span class="keyword">(</span><span class="default">$diff</span><span class="keyword">));<br />
<br />
&nbsp;&nbsp;&nbsp; return </span><span class="default">$ppo</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">].</span><span class="string">'.'</span><span class="keyword">.</span><span class="default">$ppo</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">].</span><span class="string">'.'</span><span class="keyword">.</span><span class="default">$ppo</span><span class="keyword">[</span><span class="default">2</span><span class="keyword">].</span><span class="string">'.'</span><span class="keyword">.</span><span class="default">$ppo</span><span class="keyword">[</span><span class="default">3</span><span class="keyword">].</span><span class="string">'.'</span><span class="keyword">.</span><span class="default">$ppo</span><span class="keyword">[</span><span class="default">4</span><span class="keyword">];<br />
}<br />
<br />
function </span><span class="default">changemaya</span><span class="keyword">(</span><span class="default">$ppo</span><span class="keyword">,</span><span class="default">$diff</span><span class="keyword">){<br />
if (</span><span class="default">$diff</span><span class="keyword">&gt;</span><span class="default">0</span><span class="keyword">) { </span><span class="default">$amount</span><span class="keyword">=</span><span class="default">1</span><span class="keyword">; } else { </span><span class="default">$amount</span><span class="keyword">=-</span><span class="default">1</span><span class="keyword">; }<br />
for (</span><span class="default">$sh</span><span class="keyword">=</span><span class="default">1</span><span class="keyword">;</span><span class="default">$sh</span><span class="keyword">&lt;</span><span class="default">abs</span><span class="keyword">(</span><span class="default">$diff</span><span class="keyword">);</span><span class="default">$sh</span><span class="keyword">++){ if (</span><span class="default">$ppo</span><span class="keyword">[</span><span class="default">4</span><span class="keyword">]+</span><span class="default">$amount</span><span class="keyword">&gt;</span><span class="default">20</span><span class="keyword">){<br />
if (</span><span class="default">$ppo</span><span class="keyword">[</span><span class="default">3</span><span class="keyword">]+</span><span class="default">$amount</span><span class="keyword">&gt;</span><span class="default">20</span><span class="keyword">){ if (</span><span class="default">$ppo</span><span class="keyword">[</span><span class="default">2</span><span class="keyword">]+</span><span class="default">$amount</span><span class="keyword">&gt;</span><span class="default">20</span><span class="keyword">){<br />
if (</span><span class="default">$ppo</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">]+</span><span class="default">$amount</span><span class="keyword">&gt;</span><span class="default">20</span><span class="keyword">){ if (</span><span class="default">$ppo</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">]+</span><span class="default">$amount</span><span class="keyword">&gt;</span><span class="default">20</span><span class="keyword">){<br />
</span><span class="default">$ppo</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">]=</span><span class="default">0</span><span class="keyword">; </span><span class="default">$ppo</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">]=</span><span class="default">0</span><span class="keyword">; </span><span class="default">$ppo</span><span class="keyword">[</span><span class="default">2</span><span class="keyword">]=</span><span class="default">0</span><span class="keyword">; </span><span class="default">$ppo</span><span class="keyword">[</span><span class="default">3</span><span class="keyword">]=</span><span class="default">0</span><span class="keyword">; </span><span class="default">$ppo</span><span class="keyword">[</span><span class="default">4</span><span class="keyword">]=</span><span class="default">0</span><span class="keyword">;<br />
} else { </span><span class="default">$ppo</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">]=</span><span class="default">0</span><span class="keyword">; </span><span class="default">$ppo</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">]=</span><span class="default">$ppo</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">]+</span><span class="default">$amount</span><span class="keyword">;}&nbsp; &nbsp; &nbsp; &nbsp; <br />
} else { </span><span class="default">$ppo</span><span class="keyword">[</span><span class="default">2</span><span class="keyword">]=</span><span class="default">0</span><span class="keyword">; </span><span class="default">$ppo</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">]=</span><span class="default">$ppo</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">]+</span><span class="default">$amount</span><span class="keyword">;&nbsp; &nbsp; }&nbsp; &nbsp; &nbsp; &nbsp; <br />
} else {</span><span class="default">$ppo</span><span class="keyword">[</span><span class="default">3</span><span class="keyword">]=</span><span class="default">0</span><span class="keyword">; </span><span class="default">$ppo</span><span class="keyword">[</span><span class="default">2</span><span class="keyword">]=</span><span class="default">$ppo</span><span class="keyword">[</span><span class="default">2</span><span class="keyword">]+</span><span class="default">$amount</span><span class="keyword">; }<br />
} else { </span><span class="default">$ppo</span><span class="keyword">[</span><span class="default">4</span><span class="keyword">]=</span><span class="default">0</span><span class="keyword">; </span><span class="default">$ppo</span><span class="keyword">[</span><span class="default">3</span><span class="keyword">]=</span><span class="default">$ppo</span><span class="keyword">[</span><span class="default">3</span><span class="keyword">]+</span><span class="default">$amount</span><span class="keyword">; }<br />
} elseif (</span><span class="default">$ppo</span><span class="keyword">[</span><span class="default">4</span><span class="keyword">]+</span><span class="default">$amount</span><span class="keyword">&lt;</span><span class="default">0</span><span class="keyword">){ if (</span><span class="default">$ppo</span><span class="keyword">[</span><span class="default">3</span><span class="keyword">]+</span><span class="default">$amount</span><span class="keyword">&lt;</span><span class="default">0</span><span class="keyword">){<br />
if (</span><span class="default">$ppo</span><span class="keyword">[</span><span class="default">2</span><span class="keyword">]+</span><span class="default">$amount</span><span class="keyword">&lt;</span><span class="default">0</span><span class="keyword">){&nbsp; &nbsp; if (</span><span class="default">$ppo</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">]+</span><span class="default">$amount</span><span class="keyword">&lt;</span><span class="default">0</span><span class="keyword">){<br />
if (</span><span class="default">$ppo</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">]+</span><span class="default">$amount</span><span class="keyword">&lt;</span><span class="default">0</span><span class="keyword">){&nbsp; &nbsp; </span><span class="default">$ppo</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">]=</span><span class="default">20</span><span class="keyword">;&nbsp; &nbsp; </span><span class="default">$ppo</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">]=</span><span class="default">0</span><span class="keyword">; <br />
</span><span class="default">$ppo</span><span class="keyword">[</span><span class="default">2</span><span class="keyword">]=</span><span class="default">0</span><span class="keyword">; </span><span class="default">$ppo</span><span class="keyword">[</span><span class="default">3</span><span class="keyword">]=</span><span class="default">0</span><span class="keyword">; </span><span class="default">$ppo</span><span class="keyword">[</span><span class="default">4</span><span class="keyword">]=</span><span class="default">0</span><span class="keyword">;<br />
} else { </span><span class="default">$ppo</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">]=</span><span class="default">20</span><span class="keyword">; </span><span class="default">$ppo</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">]=</span><span class="default">$ppo</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">]+</span><span class="default">$amount</span><span class="keyword">; }&nbsp; &nbsp; &nbsp; &nbsp; <br />
} else { </span><span class="default">$ppo</span><span class="keyword">[</span><span class="default">2</span><span class="keyword">]=</span><span class="default">20</span><span class="keyword">; </span><span class="default">$ppo</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">]=</span><span class="default">$ppo</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">]+</span><span class="default">$amount</span><span class="keyword">; }&nbsp; &nbsp; &nbsp; &nbsp; <br />
} else { </span><span class="default">$ppo</span><span class="keyword">[</span><span class="default">3</span><span class="keyword">]=</span><span class="default">20</span><span class="keyword">; </span><span class="default">$ppo</span><span class="keyword">[</span><span class="default">2</span><span class="keyword">]=</span><span class="default">$ppo</span><span class="keyword">[</span><span class="default">2</span><span class="keyword">]+</span><span class="default">$amount</span><span class="keyword">; }<br />
} else { </span><span class="default">$ppo</span><span class="keyword">[</span><span class="default">4</span><span class="keyword">]=</span><span class="default">20</span><span class="keyword">; </span><span class="default">$ppo</span><span class="keyword">[</span><span class="default">3</span><span class="keyword">]=</span><span class="default">$ppo</span><span class="keyword">[</span><span class="default">3</span><span class="keyword">]+</span><span class="default">$amount</span><span class="keyword">; }<br />
} else { </span><span class="default">$ppo</span><span class="keyword">[</span><span class="default">4</span><span class="keyword">]=</span><span class="default">$ppo</span><span class="keyword">[</span><span class="default">4</span><span class="keyword">]+</span><span class="default">$amount</span><span class="keyword">;}}<br />
&nbsp;&nbsp;&nbsp; return </span><span class="default">$ppo</span><span class="keyword">;<br />
}<br />
<br />
</span><span class="default">?&gt;<br />
</span><br />
Thanks!!</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="77664""></a>
  <div class="note">
   <strong class="user">schotm29 at hotmail dot com</strong>
   <a href="#77664" class="date">07-Sep-2007 03:00</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
fRay Fergusons light reimplimentation doesn't work all of the time, because of the inaccuracy in the calculations (it is quite accurate but not accurate enough for a live web app)</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="77159""></a>
  <div class="note">
   <strong class="user">david dot scourfield at llynfi dot co dot uk</strong>
   <a href="#77159" class="date">17-Aug-2007 12:13</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I created this function a while ago and needed it again recently, so had to trawl through some old files to find it. Thought I'd post it here in case anyone else finds it useful.<br />
<br />
<span class="default">&lt;?php<br />
<br />
</span><span class="comment">/*<br />
&nbsp;*&nbsp; &nbsp; Function to calculate which days are British bank holidays (England &amp; Wales) for a given year.<br />
&nbsp;*<br />
&nbsp;*&nbsp; &nbsp; Created by David Scourfield, 07 August 2006, and released into the public domain.<br />
&nbsp;*&nbsp; &nbsp; Anybody may use and/or modify this code.<br />
&nbsp;*<br />
&nbsp;*&nbsp; &nbsp; USAGE:<br />
&nbsp;*<br />
&nbsp;*&nbsp; &nbsp; array calculateBankHolidays(int $yr)<br />
&nbsp;*<br />
&nbsp;*&nbsp; &nbsp; ARGUMENTS<br />
&nbsp;*<br />
&nbsp;*&nbsp; &nbsp; $yr = 4 digit numeric representation of the year (eg 1997).<br />
&nbsp;*<br />
&nbsp;*&nbsp; &nbsp; RETURN VALUE<br />
&nbsp;*<br />
&nbsp;*&nbsp; &nbsp; Returns an array of strings where each string is a date of a bank holiday in the format "yyyy-mm-dd".<br />
&nbsp;*<br />
&nbsp;*&nbsp; &nbsp; See example below<br />
&nbsp;*<br />
&nbsp;*/<br />
<br />
</span><span class="keyword">function </span><span class="default">calculateBankHolidays</span><span class="keyword">(</span><span class="default">$yr</span><span class="keyword">) {<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$bankHols </span><span class="keyword">= Array();<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">// New year's:<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">switch ( </span><span class="default">date</span><span class="keyword">(</span><span class="string">"w"</span><span class="keyword">, </span><span class="default">strtotime</span><span class="keyword">(</span><span class="string">"</span><span class="default">$yr</span><span class="string">-01-01 12:00:00"</span><span class="keyword">)) ) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; case </span><span class="default">6</span><span class="keyword">:<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$bankHols</span><span class="keyword">[] = </span><span class="string">"</span><span class="default">$yr</span><span class="string">-01-03"</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; break;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; case </span><span class="default">0</span><span class="keyword">:<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$bankHols</span><span class="keyword">[] = </span><span class="string">"</span><span class="default">$yr</span><span class="string">-01-02"</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; break;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; default:<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$bankHols</span><span class="keyword">[] = </span><span class="string">"</span><span class="default">$yr</span><span class="string">-01-01"</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">// Good friday:<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$bankHols</span><span class="keyword">[] = </span><span class="default">date</span><span class="keyword">(</span><span class="string">"Y-m-d"</span><span class="keyword">, </span><span class="default">strtotime</span><span class="keyword">( </span><span class="string">"+"</span><span class="keyword">.(</span><span class="default">easter_days</span><span class="keyword">(</span><span class="default">$yr</span><span class="keyword">) - </span><span class="default">2</span><span class="keyword">).</span><span class="string">" days"</span><span class="keyword">, </span><span class="default">strtotime</span><span class="keyword">(</span><span class="string">"</span><span class="default">$yr</span><span class="string">-03-21 12:00:00"</span><span class="keyword">) ));<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">// Easter Monday:<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$bankHols</span><span class="keyword">[] = </span><span class="default">date</span><span class="keyword">(</span><span class="string">"Y-m-d"</span><span class="keyword">, </span><span class="default">strtotime</span><span class="keyword">( </span><span class="string">"+"</span><span class="keyword">.(</span><span class="default">easter_days</span><span class="keyword">(</span><span class="default">$yr</span><span class="keyword">) + </span><span class="default">1</span><span class="keyword">).</span><span class="string">" days"</span><span class="keyword">, </span><span class="default">strtotime</span><span class="keyword">(</span><span class="string">"</span><span class="default">$yr</span><span class="string">-03-21 12:00:00"</span><span class="keyword">) ));<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">// May Day:<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">if (</span><span class="default">$yr </span><span class="keyword">== </span><span class="default">1995</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$bankHols</span><span class="keyword">[] = </span><span class="string">"1995-05-08"</span><span class="keyword">; </span><span class="comment">// VE day 50th anniversary year exception<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">} else {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; switch (</span><span class="default">date</span><span class="keyword">(</span><span class="string">"w"</span><span class="keyword">, </span><span class="default">strtotime</span><span class="keyword">(</span><span class="string">"</span><span class="default">$yr</span><span class="string">-05-01 12:00:00"</span><span class="keyword">))) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; case </span><span class="default">0</span><span class="keyword">:<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$bankHols</span><span class="keyword">[] = </span><span class="string">"</span><span class="default">$yr</span><span class="string">-05-02"</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; break;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; case </span><span class="default">1</span><span class="keyword">:<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$bankHols</span><span class="keyword">[] = </span><span class="string">"</span><span class="default">$yr</span><span class="string">-05-01"</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; break;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; case </span><span class="default">2</span><span class="keyword">:<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$bankHols</span><span class="keyword">[] = </span><span class="string">"</span><span class="default">$yr</span><span class="string">-05-07"</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; break;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; case </span><span class="default">3</span><span class="keyword">:<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$bankHols</span><span class="keyword">[] = </span><span class="string">"</span><span class="default">$yr</span><span class="string">-05-06"</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; break;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; case </span><span class="default">4</span><span class="keyword">:<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$bankHols</span><span class="keyword">[] = </span><span class="string">"</span><span class="default">$yr</span><span class="string">-05-05"</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; break;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; case </span><span class="default">5</span><span class="keyword">:<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$bankHols</span><span class="keyword">[] = </span><span class="string">"</span><span class="default">$yr</span><span class="string">-05-04"</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; break;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; case </span><span class="default">6</span><span class="keyword">:<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$bankHols</span><span class="keyword">[] = </span><span class="string">"</span><span class="default">$yr</span><span class="string">-05-03"</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; break;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">// Whitsun:<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">if (</span><span class="default">$yr </span><span class="keyword">== </span><span class="default">2002</span><span class="keyword">) { </span><span class="comment">// exception year<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$bankHols</span><span class="keyword">[] = </span><span class="string">"2002-06-03"</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$bankHols</span><span class="keyword">[] = </span><span class="string">"2002-06-04"</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; } else {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; switch (</span><span class="default">date</span><span class="keyword">(</span><span class="string">"w"</span><span class="keyword">, </span><span class="default">strtotime</span><span class="keyword">(</span><span class="string">"</span><span class="default">$yr</span><span class="string">-05-31 12:00:00"</span><span class="keyword">))) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; case </span><span class="default">0</span><span class="keyword">:<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$bankHols</span><span class="keyword">[] = </span><span class="string">"</span><span class="default">$yr</span><span class="string">-05-25"</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; break;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; case </span><span class="default">1</span><span class="keyword">:<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$bankHols</span><span class="keyword">[] = </span><span class="string">"</span><span class="default">$yr</span><span class="string">-05-31"</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; break;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; case </span><span class="default">2</span><span class="keyword">:<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$bankHols</span><span class="keyword">[] = </span><span class="string">"</span><span class="default">$yr</span><span class="string">-05-30"</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; break;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; case </span><span class="default">3</span><span class="keyword">:<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$bankHols</span><span class="keyword">[] = </span><span class="string">"</span><span class="default">$yr</span><span class="string">-05-29"</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; break;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; case </span><span class="default">4</span><span class="keyword">:<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$bankHols</span><span class="keyword">[] = </span><span class="string">"</span><span class="default">$yr</span><span class="string">-05-28"</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; break;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; case </span><span class="default">5</span><span class="keyword">:<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$bankHols</span><span class="keyword">[] = </span><span class="string">"</span><span class="default">$yr</span><span class="string">-05-27"</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; break;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; case </span><span class="default">6</span><span class="keyword">:<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$bankHols</span><span class="keyword">[] = </span><span class="string">"</span><span class="default">$yr</span><span class="string">-05-26"</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; break;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">// Summer Bank Holiday:<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">switch (</span><span class="default">date</span><span class="keyword">(</span><span class="string">"w"</span><span class="keyword">, </span><span class="default">strtotime</span><span class="keyword">(</span><span class="string">"</span><span class="default">$yr</span><span class="string">-08-31 12:00:00"</span><span class="keyword">))) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; case </span><span class="default">0</span><span class="keyword">:<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$bankHols</span><span class="keyword">[] = </span><span class="string">"</span><span class="default">$yr</span><span class="string">-08-25"</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; break;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; case </span><span class="default">1</span><span class="keyword">:<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$bankHols</span><span class="keyword">[] = </span><span class="string">"</span><span class="default">$yr</span><span class="string">-08-31"</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; break;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; case </span><span class="default">2</span><span class="keyword">:<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$bankHols</span><span class="keyword">[] = </span><span class="string">"</span><span class="default">$yr</span><span class="string">-08-30"</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; break;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; case </span><span class="default">3</span><span class="keyword">:<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$bankHols</span><span class="keyword">[] = </span><span class="string">"</span><span class="default">$yr</span><span class="string">-08-29"</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; break;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; case </span><span class="default">4</span><span class="keyword">:<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$bankHols</span><span class="keyword">[] = </span><span class="string">"</span><span class="default">$yr</span><span class="string">-08-28"</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; break;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; case </span><span class="default">5</span><span class="keyword">:<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$bankHols</span><span class="keyword">[] = </span><span class="string">"</span><span class="default">$yr</span><span class="string">-08-27"</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; break;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; case </span><span class="default">6</span><span class="keyword">:<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$bankHols</span><span class="keyword">[] = </span><span class="string">"</span><span class="default">$yr</span><span class="string">-08-26"</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; break;<br />
&nbsp;&nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">// Christmas:<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">switch ( </span><span class="default">date</span><span class="keyword">(</span><span class="string">"w"</span><span class="keyword">, </span><span class="default">strtotime</span><span class="keyword">(</span><span class="string">"</span><span class="default">$yr</span><span class="string">-12-25 12:00:00"</span><span class="keyword">)) ) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; case </span><span class="default">5</span><span class="keyword">:<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$bankHols</span><span class="keyword">[] = </span><span class="string">"</span><span class="default">$yr</span><span class="string">-12-25"</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$bankHols</span><span class="keyword">[] = </span><span class="string">"</span><span class="default">$yr</span><span class="string">-12-28"</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; break;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; case </span><span class="default">6</span><span class="keyword">:<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$bankHols</span><span class="keyword">[] = </span><span class="string">"</span><span class="default">$yr</span><span class="string">-12-27"</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$bankHols</span><span class="keyword">[] = </span><span class="string">"</span><span class="default">$yr</span><span class="string">-12-28"</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; break;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; case </span><span class="default">0</span><span class="keyword">:<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$bankHols</span><span class="keyword">[] = </span><span class="string">"</span><span class="default">$yr</span><span class="string">-12-26"</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$bankHols</span><span class="keyword">[] = </span><span class="string">"</span><span class="default">$yr</span><span class="string">-12-27"</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; break;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; default:<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$bankHols</span><span class="keyword">[] = </span><span class="string">"</span><span class="default">$yr</span><span class="string">-12-25"</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$bankHols</span><span class="keyword">[] = </span><span class="string">"</span><span class="default">$yr</span><span class="string">-12-26"</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">// Millenium eve<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">if (</span><span class="default">$yr </span><span class="keyword">== </span><span class="default">1999</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$bankHols</span><span class="keyword">[] = </span><span class="string">"1999-12-31"</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp;&nbsp; return </span><span class="default">$bankHols</span><span class="keyword">;<br />
<br />
}<br />
<br />
</span><span class="comment">/*<br />
&nbsp;*&nbsp; &nbsp; EXAMPLE:<br />
&nbsp;*<br />
&nbsp;*/<br />
<br />
</span><span class="default">header</span><span class="keyword">(</span><span class="string">"Content-type: text/plain"</span><span class="keyword">); <br />
<br />
</span><span class="default">$bankHolsThisYear </span><span class="keyword">= </span><span class="default">calculateBankHolidays</span><span class="keyword">(</span><span class="default">2007</span><span class="keyword">);<br />
<br />
</span><span class="default">print_r</span><span class="keyword">(</span><span class="default">$bankHolsThisYear</span><span class="keyword">);<br />
<br />
</span><span class="default">?&gt;<br />
</span><br />
Will output this result:<br />
<br />
Array<br />
(<br />
&nbsp;&nbsp;&nbsp; [0] =&gt; 2007-01-01<br />
&nbsp;&nbsp;&nbsp; [1] =&gt; 2007-04-06<br />
&nbsp;&nbsp;&nbsp; [2] =&gt; 2007-04-09<br />
&nbsp;&nbsp;&nbsp; [3] =&gt; 2007-05-07<br />
&nbsp;&nbsp;&nbsp; [4] =&gt; 2007-05-28<br />
&nbsp;&nbsp;&nbsp; [5] =&gt; 2007-08-27<br />
&nbsp;&nbsp;&nbsp; [6] =&gt; 2007-12-25<br />
&nbsp;&nbsp;&nbsp; [7] =&gt; 2007-12-26<br />
)</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="54234""></a>
  <div class="note">
   <strong class="user">amichauer at gmx dot de</strong>
   <a href="#54234" class="date">28-Jun-2005 06:46</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
<span class="default">&lt;?php<br />
<br />
</span><span class="keyword">class </span><span class="default">HijriCalendar<br />
</span><span class="keyword">{<br />
&nbsp;&nbsp;&nbsp; function </span><span class="default">monthName</span><span class="keyword">(</span><span class="default">$i</span><span class="keyword">) </span><span class="comment">// $i = 1..12<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">{<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; static </span><span class="default">$month&nbsp; </span><span class="keyword">= array(<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="string">"M?x?rr?m"</span><span class="keyword">, </span><span class="string">"Safar"</span><span class="keyword">, </span><span class="string">"Rabig-?l-?ww?l"</span><span class="keyword">, </span><span class="string">"Rabig-?l-Ax?r"</span><span class="keyword">,<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="string">"C?m?d-?l-?ww?l"</span><span class="keyword">, </span><span class="string">"C?m?d-?l-Ax?r"</span><span class="keyword">, </span><span class="string">"Rac?b"</span><span class="keyword">, </span><span class="string">"???b?n"</span><span class="keyword">,<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="string">"Ramazan"</span><span class="keyword">, </span><span class="string">"??w?l"</span><span class="keyword">, </span><span class="string">"Z?-?l-Q??d?"</span><span class="keyword">, </span><span class="string">"Z?-?l-Xicc?"<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">$month</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">-</span><span class="default">1</span><span class="keyword">];<br />
&nbsp;&nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp;&nbsp; function </span><span class="default">GregorianToHijri</span><span class="keyword">(</span><span class="default">$time </span><span class="keyword">= </span><span class="default">null</span><span class="keyword">)<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">$time </span><span class="keyword">=== </span><span class="default">null</span><span class="keyword">) </span><span class="default">$time </span><span class="keyword">= </span><span class="default">time</span><span class="keyword">();<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$m </span><span class="keyword">= </span><span class="default">date</span><span class="keyword">(</span><span class="string">'m'</span><span class="keyword">, </span><span class="default">$time</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$d </span><span class="keyword">= </span><span class="default">date</span><span class="keyword">(</span><span class="string">'d'</span><span class="keyword">, </span><span class="default">$time</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$y </span><span class="keyword">= </span><span class="default">date</span><span class="keyword">(</span><span class="string">'Y'</span><span class="keyword">, </span><span class="default">$time</span><span class="keyword">);<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">HijriCalendar</span><span class="keyword">::</span><span class="default">JDToHijri</span><span class="keyword">(<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">cal_to_jd</span><span class="keyword">(</span><span class="default">CAL_GREGORIAN</span><span class="keyword">, </span><span class="default">$m</span><span class="keyword">, </span><span class="default">$d</span><span class="keyword">, </span><span class="default">$y</span><span class="keyword">));<br />
&nbsp;&nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp;&nbsp; function </span><span class="default">HijriToGregorian</span><span class="keyword">(</span><span class="default">$m</span><span class="keyword">, </span><span class="default">$d</span><span class="keyword">, </span><span class="default">$y</span><span class="keyword">)<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">jd_to_cal</span><span class="keyword">(</span><span class="default">CAL_GREGORIAN</span><span class="keyword">,<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">HijriCalendar</span><span class="keyword">::</span><span class="default">HijriToJD</span><span class="keyword">(</span><span class="default">$m</span><span class="keyword">, </span><span class="default">$d</span><span class="keyword">, </span><span class="default">$y</span><span class="keyword">));<br />
&nbsp;&nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment"># Julian Day Count To Hijri<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">function </span><span class="default">JDToHijri</span><span class="keyword">(</span><span class="default">$jd</span><span class="keyword">)<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$jd </span><span class="keyword">= </span><span class="default">$jd </span><span class="keyword">- </span><span class="default">1948440 </span><span class="keyword">+ </span><span class="default">10632</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$n&nbsp; </span><span class="keyword">= (int)((</span><span class="default">$jd </span><span class="keyword">- </span><span class="default">1</span><span class="keyword">) / </span><span class="default">10631</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$jd </span><span class="keyword">= </span><span class="default">$jd </span><span class="keyword">- </span><span class="default">10631 </span><span class="keyword">* </span><span class="default">$n </span><span class="keyword">+ </span><span class="default">354</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$j&nbsp; </span><span class="keyword">= ((int)((</span><span class="default">10985 </span><span class="keyword">- </span><span class="default">$jd</span><span class="keyword">) / </span><span class="default">5316</span><span class="keyword">)) *<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; ((int)(</span><span class="default">50 </span><span class="keyword">* </span><span class="default">$jd </span><span class="keyword">/ </span><span class="default">17719</span><span class="keyword">)) +<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; ((int)(</span><span class="default">$jd </span><span class="keyword">/ </span><span class="default">5670</span><span class="keyword">)) *<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; ((int)(</span><span class="default">43 </span><span class="keyword">* </span><span class="default">$jd </span><span class="keyword">/ </span><span class="default">15238</span><span class="keyword">));<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$jd </span><span class="keyword">= </span><span class="default">$jd </span><span class="keyword">- ((int)((</span><span class="default">30 </span><span class="keyword">- </span><span class="default">$j</span><span class="keyword">) / </span><span class="default">15</span><span class="keyword">)) *<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; ((int)((</span><span class="default">17719 </span><span class="keyword">* </span><span class="default">$j</span><span class="keyword">) / </span><span class="default">50</span><span class="keyword">)) -<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; ((int)(</span><span class="default">$j </span><span class="keyword">/ </span><span class="default">16</span><span class="keyword">)) *<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; ((int)((</span><span class="default">15238 </span><span class="keyword">* </span><span class="default">$j</span><span class="keyword">) / </span><span class="default">43</span><span class="keyword">)) + </span><span class="default">29</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$m&nbsp; </span><span class="keyword">= (int)(</span><span class="default">24 </span><span class="keyword">* </span><span class="default">$jd </span><span class="keyword">/ </span><span class="default">709</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$d&nbsp; </span><span class="keyword">= </span><span class="default">$jd </span><span class="keyword">- (int)(</span><span class="default">709 </span><span class="keyword">* </span><span class="default">$m </span><span class="keyword">/ </span><span class="default">24</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$y&nbsp; </span><span class="keyword">= </span><span class="default">30</span><span class="keyword">*</span><span class="default">$n </span><span class="keyword">+ </span><span class="default">$j </span><span class="keyword">- </span><span class="default">30</span><span class="keyword">;<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return array(</span><span class="default">$m</span><span class="keyword">, </span><span class="default">$d</span><span class="keyword">, </span><span class="default">$y</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment"># Hijri To Julian Day Count<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">function </span><span class="default">HijriToJD</span><span class="keyword">(</span><span class="default">$m</span><span class="keyword">, </span><span class="default">$d</span><span class="keyword">, </span><span class="default">$y</span><span class="keyword">)<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return (int)((</span><span class="default">11 </span><span class="keyword">* </span><span class="default">$y </span><span class="keyword">+ </span><span class="default">3</span><span class="keyword">) / </span><span class="default">30</span><span class="keyword">) +<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">354 </span><span class="keyword">* </span><span class="default">$y </span><span class="keyword">+ </span><span class="default">30 </span><span class="keyword">* </span><span class="default">$m </span><span class="keyword">-<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; (int)((</span><span class="default">$m </span><span class="keyword">- </span><span class="default">1</span><span class="keyword">) / </span><span class="default">2</span><span class="keyword">) + </span><span class="default">$d </span><span class="keyword">+ </span><span class="default">1948440 </span><span class="keyword">- </span><span class="default">385</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }<br />
};<br />
<br />
</span><span class="default">$hijri </span><span class="keyword">= </span><span class="default">HijriCalendar</span><span class="keyword">::</span><span class="default">GregorianToHijri</span><span class="keyword">( </span><span class="default">time</span><span class="keyword">() );<br />
echo </span><span class="default">$hijri</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">].</span><span class="string">'. '</span><span class="keyword">.</span><span class="default">HijriCalendar</span><span class="keyword">::</span><span class="default">monthName</span><span class="keyword">(</span><span class="default">$hijri</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">]).</span><span class="string">' '</span><span class="keyword">.</span><span class="default">$hijri</span><span class="keyword">[</span><span class="default">2</span><span class="keyword">];<br />
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="36257""></a>
  <div class="note">
   <strong class="user">jthome at fcgov dot com</strong>
   <a href="#36257" class="date">02-Oct-2003 08:38</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Had a similar problem as curlee, except I needed to create a JDE_ERP date.&nbsp; [format is CYYDDD]<br />
<br />
<span class="default">&lt;?php<br />
<br />
</span><span class="keyword">function </span><span class="default">jde_date_create</span><span class="keyword">(</span><span class="default">$month</span><span class="keyword">, </span><span class="default">$day</span><span class="keyword">, </span><span class="default">$year</span><span class="keyword">){<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">/*<br />
&nbsp;&nbsp;&nbsp; *&nbsp; NOTE: $month and $day CANNOT have leading zeroes, <br />
&nbsp;&nbsp;&nbsp; *&nbsp; &nbsp; &nbsp; &nbsp; $year must be'YYYY' format<br />
&nbsp;&nbsp;&nbsp; */<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$jde_year_prefix </span><span class="keyword">= </span><span class="default">substr</span><span class="keyword">(</span><span class="default">$year</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">1</span><span class="keyword">) - </span><span class="default">1</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$jde_year_suffix </span><span class="keyword">= </span><span class="default">substr</span><span class="keyword">(</span><span class="default">$year</span><span class="keyword">, -</span><span class="default">2</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">//note that valid years for mktime are 1902-2037<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$timestamp </span><span class="keyword">= </span><span class="default">mktime</span><span class="keyword">(</span><span class="default">0</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">,</span><span class="default">$month</span><span class="keyword">, </span><span class="default">$day</span><span class="keyword">, </span><span class="default">$year</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$baseline_timestamp </span><span class="keyword">= </span><span class="default">mktime</span><span class="keyword">(</span><span class="default">0</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">,</span><span class="default">1</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">,</span><span class="default">$year</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$day_count </span><span class="keyword">= </span><span class="default">round</span><span class="keyword">((</span><span class="default">$timestamp </span><span class="keyword">- </span><span class="default">$baseline_timestamp</span><span class="keyword">)/</span><span class="default">86400</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$day_count_padded </span><span class="keyword">= </span><span class="default">str_pad</span><span class="keyword">(</span><span class="default">$day_count</span><span class="keyword">,</span><span class="default">3</span><span class="keyword">,</span><span class="string">"0"</span><span class="keyword">,</span><span class="default">STR_PAD_LEFT</span><span class="keyword">);<br />
<br />
&nbsp;&nbsp;&nbsp; return (</span><span class="default">$jde_year_prefix </span><span class="keyword">. </span><span class="default">$jde_year_suffix </span><span class="keyword">. </span><span class="default">$day_count_padded</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; <br />
}<br />
<br />
echo </span><span class="default">jde_date_create</span><span class="keyword">(</span><span class="default">6</span><span class="keyword">,</span><span class="default">25</span><span class="keyword">,</span><span class="default">2000</span><span class="keyword">);</span><span class="comment">// will return '103176'<br />
<br />
</span><span class="default">?&gt;<br />
</span><br />
--<br />
Jim</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="35392""></a>
  <div class="note">
   <strong class="user">curlee at mindspring dot com</strong>
   <a href="#35392" class="date">29-Aug-2003 05:55</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I solved a problem with Julian dates that are used in the JD Edwards ERP package (running on AS/400).&nbsp; The Julian format for this system is as follows:&nbsp; CYYDDD 
<br />

<br />
Where C is 0 for 1900 and 1 for 2000
<br />
DDD is the day of the year count
<br />

<br />
I used the mktime built-in php function to convert dates to the normal DD/MM/YYYY format.&nbsp; This function will convert dates that are between 1970 and 2038 (limitation of unix timestamps and the mktime function)
<br />

<br />
The $jde_date var needs to be a 6 len STRING.... if you use a numeric var type it will drop the leading 0 for any date that represents 1900.... this will botch the substr functions and thus make the whole thing wrong.&nbsp; 
<br />

<br />
<span class="default">&lt;?php
<br />
</span><span class="keyword">function </span><span class="default">jde_date_conv</span><span class="keyword">(</span><span class="default">$jde_date</span><span class="keyword">)
<br />
{
<br />

<br />
</span><span class="default">$ct </span><span class="keyword">= </span><span class="default">substr</span><span class="keyword">(</span><span class="default">$jde_date</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">,</span><span class="default">1</span><span class="keyword">);
<br />
</span><span class="default">$yr </span><span class="keyword">= </span><span class="default">substr</span><span class="keyword">(</span><span class="default">$jde_date</span><span class="keyword">,</span><span class="default">1</span><span class="keyword">,</span><span class="default">2</span><span class="keyword">);
<br />
</span><span class="default">$dy </span><span class="keyword">= </span><span class="default">substr</span><span class="keyword">(</span><span class="default">$jde_date</span><span class="keyword">,</span><span class="default">3</span><span class="keyword">,</span><span class="default">3</span><span class="keyword">);
<br />

<br />
if(</span><span class="default">$ct </span><span class="keyword">== </span><span class="default">0</span><span class="keyword">) </span><span class="default">$yr_pfx </span><span class="keyword">= </span><span class="default">19</span><span class="keyword">;
<br />
if(</span><span class="default">$ct </span><span class="keyword">== </span><span class="default">1</span><span class="keyword">) </span><span class="default">$yr_pfx </span><span class="keyword">= </span><span class="default">20</span><span class="keyword">;
<br />

<br />
</span><span class="default">$tlt_yr </span><span class="keyword">= </span><span class="default">$yr_pfx</span><span class="keyword">.</span><span class="default">$yr</span><span class="keyword">;
<br />

<br />
</span><span class="default">$base_time </span><span class="keyword">= </span><span class="default">mktime</span><span class="keyword">(</span><span class="default">0</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">,</span><span class="default">1</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">,</span><span class="default">$tlt_yr</span><span class="keyword">);
<br />

<br />
</span><span class="default">$unix_time </span><span class="keyword">= (</span><span class="default">$dy </span><span class="keyword">* </span><span class="default">86400</span><span class="keyword">) + </span><span class="default">$base_time</span><span class="keyword">;
<br />

<br />
return </span><span class="default">date</span><span class="keyword">(</span><span class="string">"m/d/Y" </span><span class="keyword">, </span><span class="default">$unix_time</span><span class="keyword">);
<br />
}
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
</div>
</div>
</div></div></body></html>
