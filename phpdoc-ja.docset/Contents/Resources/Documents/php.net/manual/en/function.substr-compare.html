<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
 <head>
  <meta http-equiv="content-type" content="text/html; CHARSET=shift-jis">
  <title>指定した位置から指定した長さの 2 つの文字列について、バイナリ対応で比較する</title>

  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <link media="all" rel="stylesheet" type="text/css" href="style.css"/>
 </head>
 <body class="docs" class="docs"><div class="navbar navbar-fixed-top">
  <div class="navbar-inner clearfix">
    <ul class="nav" style="width: 100%">
      <li style="float: left;"><a href="function.strtr.html">≪ strtr</a></li>
      <li style="float: right;"><a href="function.substr-count.html">substr_count ≫</a></li>
    </ul>
  </div>
</div>
<div id="breadcrumbs" class="clearfix">
  <ul class="breadcrumbs-container">
    <li><a href="index.html">PHP Manual</a></li>
    <li><a href="ref.strings.html">String 関数</a></li>
    <li>指定した位置から指定した長さの 2 つの文字列について、バイナリ対応で比較する</li>
  </ul>
</div>
<div id="layout">
  <div id="layout-content"><div id="function.substr-compare" class="refentry">
 <div class="refnamediv">
  <h1 class="refname">substr_compare</h1>
  <p class="verinfo">(PHP 5)</p><p class="refpurpose"><span class="refname">substr_compare</span> &mdash; <span class="dc-title">指定した位置から指定した長さの 2 つの文字列について、バイナリ対応で比較する</span></p>

 </div>
 
 <div class="refsect1 description" id="refsect1-function.substr-compare-description">
  <h3 class="title">説明</h3>
  <div class="methodsynopsis dc-description">
   <span class="type">int</span> <span class="methodname"><strong>substr_compare</strong></span>
    ( <span class="methodparam"><span class="type">string</span> <code class="parameter">$main_str</code></span>
   , <span class="methodparam"><span class="type">string</span> <code class="parameter">$str</code></span>
   , <span class="methodparam"><span class="type">int</span> <code class="parameter">$offset</code></span>
   [, <span class="methodparam"><span class="type">int</span> <code class="parameter">$length</code></span>
   [, <span class="methodparam"><span class="type">bool</span> <code class="parameter">$case_insensitivity</code><span class="initializer"> = false</span></span>
  ]] )</div>

  <p class="para rdfs-comment">
   <span class="function"><strong>substr_compare()</strong></span> は、<code class="parameter">main_str</code>
   の <code class="parameter">offset</code> 文字目以降の最大
   <code class="parameter">length</code> 文字を、<code class="parameter">str</code>
   と比較します。
  </p>
 </div>


 <div class="refsect1 parameters" id="refsect1-function.substr-compare-parameters">
  <h3 class="title">パラメータ</h3>
  <p class="para">
   <dl>

    
     <dt>
<code class="parameter">main_str</code></dt>

     <dd>

      <p class="para">
       比較したい最初の文字列。
      </p>
     </dd>

    
    
     <dt>
<code class="parameter">str</code></dt>

     <dd>

      <p class="para">
       比較したい二番目の文字列。
      </p>
     </dd>

    
    
     <dt>
<code class="parameter">offset</code></dt>

     <dd>

      <p class="para">
       比較を開始する位置。
       負の値を指定した場合は、文字列の最後から数えます。
      </p>
     </dd>

    
    
     <dt>
<code class="parameter">length</code></dt>

     <dd>

      <p class="para">
       比較する長さ。デフォルト値は、
       <code class="parameter">main_str</code> の長さから <code class="parameter">offset</code> を引いたものと
       <code class="parameter">str</code> の長さのうち、長いほうです。
      </p>
     </dd>

    
    
     <dt>
<code class="parameter">case_insensitivity</code></dt>

     <dd>

      <p class="para">
       <code class="parameter">case_insensitivity</code> が <strong><code>TRUE</code></strong> の場合、
       大文字小文字を区別せずに比較します。
      </p>
     </dd>

    
   </dl>

  </p>
 </div>


 <div class="refsect1 returnvalues" id="refsect1-function.substr-compare-returnvalues">
  <h3 class="title">返り値</h3>
  <p class="para">
   <code class="parameter">main_str</code> の <code class="parameter">offset</code>
   以降が <code class="parameter">str</code> より小さい場合に負の数、
   <code class="parameter">str</code> より大きい場合に正の数、
   等しい場合に 0 を返します。<code class="parameter">offset</code> が
   <code class="parameter">main_str</code> の長さ以上であるか、あるいは <code class="parameter">length</code>
   が設定されていて 1 未満である場合、<span class="function"><strong>substr_compare()</strong></span>
   は警告を表示して <strong><code>FALSE</code></strong> を返します。
  </p>
 </div>


 <div class="refsect1 changelog" id="refsect1-function.substr-compare-changelog">
  <h3 class="title">変更履歴</h3>
  <p class="para">
   <table class="doctable informaltable">
    
     <thead>
      <tr>
       <th>バージョン</th>
       <th>説明</th>
      </tr>

     </thead>

     <tbody class="tbody">
      <tr>
       <td>5.1.0</td>
       <td>
        負の <code class="parameter">offset</code> を使用できるようになりました。
       </td>
      </tr>

     </tbody>
    
   </table>

  </p>
 </div>


 <div class="refsect1 examples" id="refsect1-function.substr-compare-examples">
  <h3 class="title">例</h3>
  <p class="para">
   <div class="example" id="example-5024">
    <p><strong>例1 <span class="function"><strong>substr_compare()</strong></span> の例</strong></p>
    <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br /></span><span style="color: #007700">echo&nbsp;</span><span style="color: #0000BB">substr_compare</span><span style="color: #007700">(</span><span style="color: #DD0000">"abcde"</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">"bc"</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">1</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">2</span><span style="color: #007700">);&nbsp;</span><span style="color: #FF8000">//&nbsp;0<br /></span><span style="color: #007700">echo&nbsp;</span><span style="color: #0000BB">substr_compare</span><span style="color: #007700">(</span><span style="color: #DD0000">"abcde"</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">"de"</span><span style="color: #007700">,&nbsp;-</span><span style="color: #0000BB">2</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">2</span><span style="color: #007700">);&nbsp;</span><span style="color: #FF8000">//&nbsp;0<br /></span><span style="color: #007700">echo&nbsp;</span><span style="color: #0000BB">substr_compare</span><span style="color: #007700">(</span><span style="color: #DD0000">"abcde"</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">"bcg"</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">1</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">2</span><span style="color: #007700">);&nbsp;</span><span style="color: #FF8000">//&nbsp;0<br /></span><span style="color: #007700">echo&nbsp;</span><span style="color: #0000BB">substr_compare</span><span style="color: #007700">(</span><span style="color: #DD0000">"abcde"</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">"BC"</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">1</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">2</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">true</span><span style="color: #007700">);&nbsp;</span><span style="color: #FF8000">//&nbsp;0<br /></span><span style="color: #007700">echo&nbsp;</span><span style="color: #0000BB">substr_compare</span><span style="color: #007700">(</span><span style="color: #DD0000">"abcde"</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">"bc"</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">1</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">3</span><span style="color: #007700">);&nbsp;</span><span style="color: #FF8000">//&nbsp;1<br /></span><span style="color: #007700">echo&nbsp;</span><span style="color: #0000BB">substr_compare</span><span style="color: #007700">(</span><span style="color: #DD0000">"abcde"</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">"cd"</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">1</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">2</span><span style="color: #007700">);&nbsp;</span><span style="color: #FF8000">//&nbsp;-1<br /></span><span style="color: #007700">echo&nbsp;</span><span style="color: #0000BB">substr_compare</span><span style="color: #007700">(</span><span style="color: #DD0000">"abcde"</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">"abc"</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">5</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">1</span><span style="color: #007700">);&nbsp;</span><span style="color: #FF8000">//&nbsp;警告<br /></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
    </div>

   </div>
  </p>
 </div>


 <div class="refsect1 seealso" id="refsect1-function.substr-compare-seealso">
  <h3 class="title">参考</h3>
  <p class="para">
   <ul class="simplelist">
    <li class="member"><span class="function"><a href="function.strncmp.html" class="function" rel="rdfs-seeAlso">strncmp()</a> - 最初の n 文字についてバイナリセーフな文字列比較を行う</span></li>
   </ul>
  </p>
 </div>


</div><div id="usernotes">
 <div class="head">
  <h3 class="title">User Contributed Notes</h3>
 </div>
<div id="allnotes">  <a name="110859""></a>
  <div class="note">
   <strong class="user">jimmetry at gmail dot com</strong>
   <a href="#110859" class="date">16-Dec-2012 09:31</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
When you came to this page, you may have been looking for something a little simpler: A function that can check if a small string exists within a larger string starting at a particular index. Using substr_compare() for this can leave your code messy, because you need to check that your string is long enough (to avoid the warning), manually specify the length of the short string, and like many of the string functions, perform an integer comparison to answer a true/false question.<br />
<br />
I put together a simple function to return true if $str exists within $mainStr. If $loc is specified, the $str must begin at that index. If not, the entire $mainStr will be searched.<br />
<br />
<span class="default">&lt;?php<br />
<br />
</span><span class="keyword">function </span><span class="default">contains_substr</span><span class="keyword">(</span><span class="default">$mainStr</span><span class="keyword">, </span><span class="default">$str</span><span class="keyword">, </span><span class="default">$loc </span><span class="keyword">= </span><span class="default">false</span><span class="keyword">) {<br />
&nbsp;&nbsp;&nbsp; if (</span><span class="default">$loc </span><span class="keyword">=== </span><span class="default">false</span><span class="keyword">) return (</span><span class="default">strpos</span><span class="keyword">(</span><span class="default">$mainStr</span><span class="keyword">, </span><span class="default">$str</span><span class="keyword">) !== </span><span class="default">false</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; if (</span><span class="default">strlen</span><span class="keyword">(</span><span class="default">$mainStr</span><span class="keyword">) &lt; </span><span class="default">strlen</span><span class="keyword">(</span><span class="default">$str</span><span class="keyword">)) return </span><span class="default">false</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; if ((</span><span class="default">$loc </span><span class="keyword">+ </span><span class="default">strlen</span><span class="keyword">(</span><span class="default">$str</span><span class="keyword">)) &gt; </span><span class="default">strlen</span><span class="keyword">(</span><span class="default">$mainStr</span><span class="keyword">)) return </span><span class="default">false</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; return (</span><span class="default">strcmp</span><span class="keyword">(</span><span class="default">substr</span><span class="keyword">(</span><span class="default">$mainStr</span><span class="keyword">, </span><span class="default">$loc</span><span class="keyword">, </span><span class="default">strlen</span><span class="keyword">(</span><span class="default">$str</span><span class="keyword">)), </span><span class="default">$str</span><span class="keyword">) == </span><span class="default">0</span><span class="keyword">);<br />
}<br />
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="109636""></a>
  <div class="note">
   <strong class="user">Skyborne</strong>
   <a href="#109636" class="date">03-Aug-2012 10:55</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Take note of the `length` parameter: "The default value is the largest of the length of the str compared to the length of main_str less the offset."<br />
<br />
This is *not* the length of str as you might (I always) expect, so if you leave it out, you'll get unexpected results.&nbsp; Example:<br />
<br />
<span class="default">&lt;?php<br />
$hash </span><span class="keyword">= </span><span class="string">'$5$lalalalalalalala$crypt.output.here'</span><span class="keyword">;<br />
</span><span class="default">var_dump</span><span class="keyword">(</span><span class="default">substr_compare</span><span class="keyword">(</span><span class="default">$hash</span><span class="keyword">, </span><span class="string">'$5$'</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">)); </span><span class="comment"># int(34)<br />
</span><span class="default">var_dump</span><span class="keyword">(</span><span class="default">substr_compare</span><span class="keyword">(</span><span class="default">$hash</span><span class="keyword">, </span><span class="string">'$5$'</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">3</span><span class="keyword">)); </span><span class="comment"># int(0)<br />
</span><span class="default">var_dump</span><span class="keyword">(</span><span class="default">PHP_VERSION</span><span class="keyword">); </span><span class="comment"># string(6) "5.3.14"<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="53084""></a>
  <div class="note">
   <strong class="user">sleek</strong>
   <a href="#53084" class="date">23-May-2005 02:07</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Modified version of the original posted function. Use this one:<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">if (!</span><span class="default">function_exists</span><span class="keyword">(</span><span class="string">'substr_compare'</span><span class="keyword">)) {<br />
&nbsp;&nbsp;&nbsp; function </span><span class="default">substr_compare</span><span class="keyword">(</span><span class="default">$main_str</span><span class="keyword">, </span><span class="default">$str</span><span class="keyword">, </span><span class="default">$offset</span><span class="keyword">, </span><span class="default">$length </span><span class="keyword">= </span><span class="default">NULL</span><span class="keyword">, </span><span class="default">$case_insensitivity </span><span class="keyword">= </span><span class="default">false</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$offset </span><span class="keyword">= (int) </span><span class="default">$offset</span><span class="keyword">;<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// Throw a warning because the offset is invalid<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">if (</span><span class="default">$offset </span><span class="keyword">&gt;= </span><span class="default">strlen</span><span class="keyword">(</span><span class="default">$main_str</span><span class="keyword">)) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">trigger_error</span><span class="keyword">(</span><span class="string">'The start position cannot exceed initial string length.'</span><span class="keyword">, </span><span class="default">E_USER_WARNING</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">false</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// We are comparing the first n-characters of each string, so let's use the PHP function to do it<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">if (</span><span class="default">$offset </span><span class="keyword">== </span><span class="default">0 </span><span class="keyword">&amp;&amp; </span><span class="default">is_int</span><span class="keyword">(</span><span class="default">$length</span><span class="keyword">) &amp;&amp; </span><span class="default">$case_insensitivity </span><span class="keyword">=== </span><span class="default">true</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">strncasecmp</span><span class="keyword">(</span><span class="default">$main_str</span><span class="keyword">, </span><span class="default">$str</span><span class="keyword">, </span><span class="default">$length</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// Get the substring that we are comparing<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">if (</span><span class="default">is_int</span><span class="keyword">(</span><span class="default">$length</span><span class="keyword">)) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$main_substr </span><span class="keyword">= </span><span class="default">substr</span><span class="keyword">(</span><span class="default">$main_str</span><span class="keyword">, </span><span class="default">$offset</span><span class="keyword">, </span><span class="default">$length</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$str_substr </span><span class="keyword">= </span><span class="default">substr</span><span class="keyword">(</span><span class="default">$str</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">$length</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; } else {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$main_substr </span><span class="keyword">= </span><span class="default">substr</span><span class="keyword">(</span><span class="default">$main_str</span><span class="keyword">, </span><span class="default">$offset</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$str_substr </span><span class="keyword">= </span><span class="default">$str</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// Return a case-insensitive comparison of the two strings<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">if (</span><span class="default">$case_insensitivity </span><span class="keyword">=== </span><span class="default">true</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">strcasecmp</span><span class="keyword">(</span><span class="default">$main_substr</span><span class="keyword">, </span><span class="default">$str_substr</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// Return a case-sensitive comparison of the two strings<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">return </span><span class="default">strcmp</span><span class="keyword">(</span><span class="default">$main_substr</span><span class="keyword">, </span><span class="default">$str_substr</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; }<br />
}<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
</div>
</div>
</div></div></body></html>
