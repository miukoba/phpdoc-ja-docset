<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
 <head>
  <meta http-equiv="content-type" content="text/html; CHARSET=shift-jis">
  <title>データベースへの接続を返す</title>

  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <link media="all" rel="stylesheet" type="text/css" href="style.css"/>
 </head>
 <body class="docs" class="docs"><div class="navbar navbar-fixed-top">
  <div class="navbar-inner clearfix">
    <ul class="nav" style="width: 100%">
      <li style="float: left;"><a href="function.db2-conn-errormsg.html">≪ db2_conn_errormsg</a></li>
      <li style="float: right;"><a href="function.db2-cursor-type.html">db2_cursor_type ≫</a></li>
    </ul>
  </div>
</div>
<div id="breadcrumbs" class="clearfix">
  <ul class="breadcrumbs-container">
    <li><a href="index.html">PHP Manual</a></li>
    <li><a href="ref.ibm-db2.html">IBM DB2 関数</a></li>
    <li>データベースへの接続を返す</li>
  </ul>
</div>
<div id="layout">
  <div id="layout-content"><div id="function.db2-connect" class="refentry">
 <div class="refnamediv">
  <h1 class="refname">db2_connect</h1>
  <p class="verinfo">(PECL ibm_db2 &gt;= 1.0.0)</p><p class="refpurpose"><span class="refname">db2_connect</span> &mdash; <span class="dc-title">
   データベースへの接続を返す
  </span></p>

 </div>
 <div class="refsect1 description" id="refsect1-function.db2-connect-description">
  <h3 class="title">説明</h3>
  <div class="methodsynopsis dc-description">
   <span class="type">resource</span> <span class="methodname"><strong>db2_connect</strong></span>
    ( <span class="methodparam"><span class="type">string</span> <code class="parameter">$database</code></span>
   , <span class="methodparam"><span class="type">string</span> <code class="parameter">$username</code></span>
   , <span class="methodparam"><span class="type">string</span> <code class="parameter">$password</code></span>
   [, <span class="methodparam"><span class="type">array</span> <code class="parameter">$options</code></span>
  ] )</div>


  <p class="para rdfs-comment">
   IBM DB2 Universal Database、IBM Cloudscape
   あるいは Apache Derby データベースへの新しい接続を作成します。
  </p>

 </div>

 <div class="refsect1 parameters" id="refsect1-function.db2-connect-parameters">
  <h3 class="title">パラメータ</h3>
  <p class="para">
   <dl>

    
     <dt>
<code class="parameter">database</code></dt>

     <dd>

      <p class="para">
       データベースへのカタログ接続の場合には、<code class="parameter">database</code>
       は DB2 クライアントカタログ内でのデータベースエイリアスを表します。
      </p>
      <p class="para">
       データベースへの非カタログ接続の場合には、
       <code class="parameter">database</code> は以下のような形式の接続文字列を表します。
       <pre class="literallayout">DATABASE=<code class="parameter">database</code>;HOSTNAME=<code class="parameter">hostname</code>;PORT=<code class="parameter">port</code>;PROTOCOL=TCPIP;UID=<code class="parameter">username</code>;PWD=<code class="parameter">password</code>;</pre>
       それぞれのパラメータは以下の内容を表します。
       <dl>

        
         <dt>
<code class="parameter">database</code></dt>

         <dd>

          <p class="para">
           データベースの名前。
          </p>
         </dd>

        
        
         <dt>
<code class="parameter">hostname</code></dt>

         <dd>

          <p class="para">
           データベースサーバーのホスト名あるいは IP アドレス。
          </p>
         </dd>

        
        
         <dt>
<code class="parameter">port</code></dt>

         <dd>

          <p class="para">
           データベースが要求を待ち受ける TCP/IP ポート。
          </p>
         </dd>

        
        
         <dt>
<code class="parameter">username</code></dt>

         <dd>

          <p class="para">
           データベースに接続するユーザー名。
          </p>
         </dd>

        
        
         <dt>
<code class="parameter">password</code></dt>

         <dd>

          <p class="para">
           データベースに接続するパスワード。
          </p>
         </dd>

        
       </dl>

      </p>
     </dd>

    
    
     <dt>
<code class="parameter">username</code></dt>

     <dd>

      <p class="para">
       データベースに接続するユーザー名。
      </p>
      <p class="para">
       カタログでない接続の場合は、<strong><code>NULL</code></strong> あるいは空の文字列を渡す必要があります。
      </p>
     </dd>

    
    
     <dt>
<code class="parameter">password</code></dt>

     <dd>

      <p class="para">
       データベースに接続するパスワード。
      </p>
      <p class="para">
       カタログでない接続の場合は、<strong><code>NULL</code></strong> あるいは空の文字列を渡す必要があります。
      </p>
     </dd>

    
    
     <dt>
<code class="parameter">options</code></dt>

     <dd>

      <p class="para">
       接続の振る舞いを指定する接続オプションの連想配列。
       使用可能なキーは以下のとおりです。
       <dl>

        
         <dt>
<code class="parameter">autocommit</code></dt>

         <dd>

          <p class="para">
           <em>DB2_AUTOCOMMIT_ON</em> を渡すと、
           この接続ハンドルで自動コミットを有効にします。
          </p>
          <p class="para">
           <em>DB2_AUTOCOMMIT_OFF</em> を渡すと、
           この接続ハンドルで自動コミットを無効にします。
          </p>
         </dd>

        
        
         <dt>
<code class="parameter">DB2_ATTR_CASE</code></dt>

         <dd>

          <p class="para">
           <em>DB2_CASE_NATURAL</em> を渡すと、
           カラム名の大文字小文字を変換せずに返します。
          </p>
          <p class="para">
           <em>DB2_CASE_LOWER</em> を渡すと、
           カラム名を小文字に変換して返します。
          </p>
          <p class="para">
           <em>DB2_CASE_UPPER</em> を渡すと、
           カラム名を大文字に変換して返します。
          </p>
         </dd>

        
        
         <dt>
<code class="parameter">CURSOR</code></dt>

         <dd>

          <p class="para">
           <em>DB2_FORWARD_ONLY</em> を渡すと、
           ステートメントリソースで前進のみのカーソルを使用します。
           これはデフォルトのカーソル型であり、
           すべてのデータベースサーバーでサポートされています。
          </p>
          <p class="para">
           <em>DB2_SCROLLABLE</em> を渡すと、
           ステートメントリソースでスクロール可能なカーソルを使用します。
           このモードでは結果セット内の行へのランダムアクセスが可能となりますが、
           現在は IBM DB2 Universal Database でしかサポートされていません。
          </p>
         </dd>

        
       </dl>

      </p>
      <p class="para">
       以下の新しいオプションは、ibm_db2 のバージョン 1.7.0 以降で使用可能です。
       <dl>

        
         <dt>
<code class="parameter">trustedcontext</code></dt>

         <dd>

          <p class="para">
           DB2_TRUSTED_CONTEXT_ENABLE を渡すと、この接続ハンドルでの信頼済みコンテキストを有効にします。
           このパラメータを <span class="function"><a href="function.db2-set-option.html" class="function">db2_set_option()</a></span> で設定することはできません。
          </p>
          <p class="para">
           このキーは、カタログ接続の場合 (たとえローカルデータベースであっても)
           あるいは接続時に完全な DSN を指定した場合にのみ動作します。
          </p>
          <p class="para">
           データベースをカタログするには次のコマンドを実行します。
          </p>
          <p class="para">
           <pre class="literallayout">db2 catalog tcpip node loopback remote &lt;SERVERNAME&gt; server &lt;SERVICENAME&gt;
db2 catalog database &lt;LOCALDBNAME&gt; as &lt;REMOTEDBNAME&gt; at node loopback
db2 &quot;update dbm cfg using svcename &lt;SERVICENAME&gt;&quot;
db2set DB2COMM=TCPIP</pre>
          </p>
         </dd>

                     
      </dl>

      </p>     
      <p class="para">
       以下の新しい i5/OS オプションは、ibm_db2 のバージョン 1.5.1 以降で使用可能です。
       <dl>

        
         <dt>
<code class="parameter">i5_lib</code></dt>

         <dd>

          <p class="para">
           未解決のファイル参照を解決する際に使用するデフォルトのライブラリを指定します。
           システムのネーミングモードを使用している接続の場合は、これは無効です。
          </p>
         </dd>

        
        
         <dt>
<code class="parameter">i5_naming</code></dt>

         <dd>

          <p class="para">
           <em>DB2_I5_NAMING_ON</em> は、DB2 UDB CLI iSeries 
           のシステムネーミングモードを有効にします。ファイルの識別の際、
           区切り文字としてスラッシュ (/) を使用します。
           識別されないファイルの解決には、ジョブのライブラリ一覧を使用します。
          </p>
          <p class="para">
           <em>DB2_I5_NAMING_OFF</em> は、DB2 UDB CLI
           のデフォルトのネーミングモード (SQL ネーミング) を無効にします。
           ファイルの識別の際、区切り文字としてピリオド (.) を使用します。
           識別されないファイルの解決には、
           デフォルトのライブラリあるいは現在のユーザー ID を使用します。
          </p>
         </dd>

        
        
         <dt>
<code class="parameter">i5_commit</code></dt>

         <dd>

          <p class="para">
           <code class="parameter">i5_commit</code> 属性は、
           <span class="function"><strong>db2_connect()</strong></span> の前に設定しなければなりません。
           接続が確立された後にこの値が変更され、その接続がリモートデータソースに対するものだった場合は、
           その接続ハンドルに対してもう一度 <span class="function"><strong>db2_connect()</strong></span>
           がコールされるまで変更は反映されません。
           <blockquote class="note"><p><strong class="note">注意</strong>: 
            <p class="para">
             php.ini の設定は <code class="parameter">ibm_db2.i5_allow_commit</code>==0
             あるいは <em>DB2_I5_TXN_NO_COMMIT</em> がデフォルトです。
             しかし、その設定よりも <code class="parameter">i5_commit</code>
             オプションの内容のほうが優先されます。
            </p>
           </p></blockquote>           
          </p>
          <p class="para">
           <em>DB2_I5_TXN_NO_COMMIT</em> - コミットの管理を使用しません。
          </p>
          <p class="para">
           <em>DB2_I5_TXN_READ_UNCOMMITTED</em> - ダーティリード、
           反復不能読み取り、ファントムリードが発生する可能性があります。
          </p>
          <p class="para">
           <em>DB2_I5_TXN_READ_COMMITTED</em> - ダーティリードは発生しません。
           反復不能読み取り、ファントムリードが発生する可能性があります。
          </p>
          <p class="para">
           <em>DB2_I5_TXN_REPEATABLE_READ</em> - ダーティリード、
           反復不能読み取りは発生しません。
           ファントムリードが発生する可能性があります。
          </p>
          <p class="para">
           <em>DB2_I5_TXN_SERIALIZABLE</em> -
           トランザクションの一貫性を保持します。
           ダーティリード、反復不能読み取り、ファントムリードは発生しません。
          </p>
         </dd>

        
        
         <dt>
<code class="parameter">i5_query_optimize</code></dt>

         <dd>

          <p class="para">
            <em>DB2_FIRST_IO</em> 
            すべてのクエリは、結果の一行目をできるだけ早く返すように最適化されます。
            これが有効なのは、出力の制御をユーザーが行う場合です。出力の制御とは、
            たとえば、出力の最初のページを見てそこで処理を停止させるなどのことです。
            OPTIMIZE FOR nnn ROWS 句を指定したクエリは、その指定が優先されます。
          </p>
          <p class="para">
           <em>DB2_ALL_IO</em>
           すべてのクエリは、結果全体をできるだけ短時間で取得できるように最適化されます。
           これは、結果をファイルや帳票に書き出す場合に有用なオプションです。
           あるいは出力データを順次処理するインターフェイスなどにも有用です。
           OPTIMIZE FOR nnn ROWS 句を指定したクエリは、その指定が優先されます。
           これはデフォルトの設定です。
          </p>
         </dd>

        
        
         <dt>
<code class="parameter">i5_dbcs_alloc</code></dt>

         <dd>

          <p class="para">
           <em>DB2_I5_DBCS_ALLOC_ON</em> は、
           DBCS トランザクションカラムサイズ用の DB2 6X アロケーションを有効にします。
          </p>
          <p class="para">
           <em>DB2_I5_DBCS_ALLOC_OFF</em> は、
           DBCS トランザクションカラムサイズ用の DB2 6X アロケーションを無効にします。
          </p>
          <p class="para">
           注意: php.ini では <code class="parameter">ibm_db2.i5_dbcs_alloc</code>==0 あるいは
           <em>DB2_I5_DBCS_ALLOC_OFF</em> がデフォルト設定となっています。
           しかし、<code class="parameter">i5_dbcs_alloc</code> の値のほうが優先されます。
          </p>
         </dd>

        
        
         <dt>
<code class="parameter">i5_date_fmt</code></dt>

         <dd>

          <p class="para">
           <em>DB2_I5_FMT_ISO</em> - 国際標準化機構 (ISO) の日付書式
           yyyy-mm-dd を使用します。デフォルトです。
          </p>
          <p class="para">
           <em>DB2_I5_FMT_USA</em> - 合衆国の日付書式 mm/dd/yyyy を使用します。
          </p>
          <p class="para">
           <em>DB2_I5_FMT_EUR</em> - 欧州の日付書式 dd.mm.yyyy を使用します。
          </p>
          <p class="para">
           <em>DB2_I5_FMT_JIS</em> - 日本工業規格 (JIS) の日付書式 yyyy-mm-dd を使用します。
          </p>
          <p class="para">
           <em>DB2_I5_FMT_MDY</em> - 日付書式 mm/dd/yyyy を使用します。
          </p>
          <p class="para">
           <em>DB2_I5_FMT_DMY</em> - 日付書式 dd/mm/yyyy を使用します。
          </p>
          <p class="para">
           <em>DB2_I5_FMT_YMD</em> - 日付書式 yy/mm/dd を使用します。
          </p>
          <p class="para">
           <em>DB2_I5_FMT_JUL</em> - ユリウス日 yy/ddd を使用します。
          </p>
          <p class="para">
           <em>DB2_I5_FMT_JOB</em> - そのジョブのデフォルトを使用します。
          </p>
         </dd>

        
        
         <dt>
<code class="parameter">i5_date_sep</code></dt>

         <dd>

          <p class="para">
           <em>DB2_I5_SEP_SLASH</em> - スラッシュ ( / ) を日付の区切り文字として使用します。
           デフォルトです。
          </p>
          <p class="para">
           <em>DB2_I5_SEP_DASH</em> - ダッシュ ( - ) を日付の区切り文字として使用します。
          </p>
          <p class="para">
           <em>DB2_I5_SEP_PERIOD</em> - ピリオド ( . ) を日付の区切り文字として使用します。
          </p>
          <p class="para">
           <em>DB2_I5_SEP_COMMA</em> - カンマ ( , ) を日付の区切り文字として使用します。
          </p>
          <p class="para">
           <em>DB2_I5_SEP_BLANK</em> - ブランクを日付の区切り文字として使用します。
          </p>
          <p class="para">
           <em>DB2_I5_SEP_JOB</em> - そのジョブのデフォルトを使用します。
          </p>
         </dd>

        
        
         <dt>
<code class="parameter">i5_time_fmt</code></dt>

         <dd>

          <p class="para">
           <em>DB2_I5_FMT_ISO</em> - 国際標準化機構 (ISO) の時刻書式
           hh.mm.ss を使用します。デフォルトです。
          </p>
          <p class="para">
           <em>DB2_I5_FMT_USA</em> - 合衆国の時刻書式
           hh:mmxx を使用します。xx には AM あるいは PM が入ります。
          </p>
          <p class="para">
           <em>DB2_I5_FMT_EUR</em> - 欧州の時刻書式 hh.mm.ss 
           を使用します。
          </p>
          <p class="para">
           <em>DB2_I5_FMT_JIS</em> - 日本工業規格 (JIS) の時刻書式
           hh:mm:ss を使用します。
          </p>
          <p class="para">
           <em>DB2_I5_FMT_HMS</em> - hh:mm:ss を使用します。
          </p>
         </dd>

        
        
         <dt>
<code class="parameter">i5_time_sep</code></dt>

         <dd>

          <p class="para">
           <em>DB2_I5_SEP_COLON</em> - コロン ( : ) を時刻の区切り文字として使用します。
           デフォルトです。
          </p>
          <p class="para">
           <em>DB2_I5_SEP_PERIOD</em> - ピリオド ( . ) を時刻の区切り文字として使用します。
          </p>
          <p class="para">
           <em>DB2_I5_SEP_COMMA</em> - カンマ ( , ) を時刻の区切り文字として使用します。
          </p>
          <p class="para">
           <em>DB2_I5_SEP_BLANK</em> - ブランクを時刻の区切り文字として使用します。
          </p>
          <p class="para">
           <em>DB2_I5_SEP_JOB</em> - そのジョブのデフォルトを使用します。
          </p>
         </dd>

        
        
         <dt>
<code class="parameter">i5_decimal_sep</code></dt>

         <dd>

          <p class="para">
           <em>DB2_I5_SEP_PERIOD</em> - ピリオド ( . ) を小数点として使用します。
           デフォルトです。
          </p>
          <p class="para">
           <em>DB2_I5_SEP_COMMA</em> - カンマ ( , ) を小数点として使用します。
          </p>
          <p class="para">
           <em>DB2_I5_SEP_JOB</em> - そのジョブのデフォルトを使用します。
          </p>
         </dd>

        
       </dl>

      </p>
      <p class="para">
       以下の新しい i5/OS オプションは、ibm_db2 のバージョン 1.8.0 以降で使用可能です。
       <dl>

        
         <dt>
<code class="parameter">i5_libl</code></dt>

         <dd>

          <p class="para">
           ファイル参照を解決する際に用いるライブラリ一覧を表す文字。
           ライブラリ一覧の項目を指定する際は、空白で区切って
           &#039;i5_libl&#039;=&gt;&quot;MYLIB YOURLIB ANYLIB&quot; のようにします。
          </p>
          <blockquote class="note"><p><strong class="note">注意</strong>: 
           <p class="para">
            <code class="parameter">i5_libl</code> は qsys2/qcmdexc(&#039;cmd&#039;,cmdlen) をコールします。
            これは i5/OS V5R4 以降でのみ使用可能です。
           </p>
          </p></blockquote>
         </dd>

                 
       </dl>

      </p>
     </dd>

    
   </dl>

  </p>
 </div>

 <div class="refsect1 returnvalues" id="refsect1-function.db2-connect-returnvalues">
  <h3 class="title">返り値</h3>
  <p class="para">
   接続に成功した場合は接続ハンドルリソースを返します。
   接続に失敗した場合は、<span class="function"><strong>db2_connect()</strong></span>
   は <strong><code>FALSE</code></strong> を返します。
  </p>
 </div>


 <div class="refsect1 examples" id="refsect1-function.db2-connect-examples">
  <h3 class="title">例</h3>
  <p class="para">
   <div class="example" id="example-1193">
    <p><strong>例1 カタログ接続の作成</strong></p>
    <div class="example-contents"><p>
     カタログ接続を行うには、DB2 コマンドラインプロセッサ (CLP)
     あるいは DB2 Configuration Assistant を使用して
     事前に対象データベースをカタログしておく必要があります。
    </p></div>
    <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br />$database&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #DD0000">'SAMPLE'</span><span style="color: #007700">;<br /></span><span style="color: #0000BB">$user&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #DD0000">'db2inst1'</span><span style="color: #007700">;<br /></span><span style="color: #0000BB">$password&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #DD0000">'ibmdb2'</span><span style="color: #007700">;<br /><br /></span><span style="color: #0000BB">$conn&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">db2_connect</span><span style="color: #007700">(</span><span style="color: #0000BB">$database</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$user</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$password</span><span style="color: #007700">);<br /><br />if&nbsp;(</span><span style="color: #0000BB">$conn</span><span style="color: #007700">)&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;echo&nbsp;</span><span style="color: #DD0000">"接続に成功しました。"</span><span style="color: #007700">;<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">db2_close</span><span style="color: #007700">(</span><span style="color: #0000BB">$conn</span><span style="color: #007700">);<br />}<br />else&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;echo&nbsp;</span><span style="color: #DD0000">"接続に失敗しました。"</span><span style="color: #007700">;<br />}<br /></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
    </div>

    <div class="example-contents"><p>上の例の出力は以下となります。</p></div>
    <div class="example-contents screen">
<div class="cdata"><pre>
接続に成功しました。
</pre></div>
    </div>
   </div>
   <div class="example" id="example-1194">
    <p><strong>例2 非カタログ接続の作成</strong></p>
    <div class="example-contents"><p>
     非カタログ接続の場合は、データベースに動的に接続することができます。
    </p></div>
    <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br />$database&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #DD0000">'SAMPLE'</span><span style="color: #007700">;<br /></span><span style="color: #0000BB">$user&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #DD0000">'db2inst1'</span><span style="color: #007700">;<br /></span><span style="color: #0000BB">$password&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #DD0000">'ibmdb2'</span><span style="color: #007700">;<br /></span><span style="color: #0000BB">$hostname&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #DD0000">'localhost'</span><span style="color: #007700">;<br /></span><span style="color: #0000BB">$port&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">50000</span><span style="color: #007700">;<br /><br /></span><span style="color: #0000BB">$conn_string&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #DD0000">"DRIVER={IBM&nbsp;DB2&nbsp;ODBC&nbsp;DRIVER};DATABASE=</span><span style="color: #0000BB">$database</span><span style="color: #DD0000">;"&nbsp;</span><span style="color: #007700">.<br />&nbsp;&nbsp;</span><span style="color: #DD0000">"HOSTNAME=</span><span style="color: #0000BB">$hostname</span><span style="color: #DD0000">;PORT=</span><span style="color: #0000BB">$port</span><span style="color: #DD0000">;PROTOCOL=TCPIP;UID=</span><span style="color: #0000BB">$user</span><span style="color: #DD0000">;PWD=</span><span style="color: #0000BB">$password</span><span style="color: #DD0000">;"</span><span style="color: #007700">;<br /></span><span style="color: #0000BB">$conn&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">db2_connect</span><span style="color: #007700">(</span><span style="color: #0000BB">$conn_string</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">''</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">''</span><span style="color: #007700">);<br /><br />if&nbsp;(</span><span style="color: #0000BB">$conn</span><span style="color: #007700">)&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;echo&nbsp;</span><span style="color: #DD0000">"接続に成功しました。"</span><span style="color: #007700">;<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">db2_close</span><span style="color: #007700">(</span><span style="color: #0000BB">$conn</span><span style="color: #007700">);<br />}<br />else&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;echo&nbsp;</span><span style="color: #DD0000">"接続に失敗しました。"</span><span style="color: #007700">;<br />}<br /></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
    </div>

    <div class="example-contents"><p>上の例の出力は以下となります。</p></div>
    <div class="example-contents screen">
<div class="cdata"><pre>
接続に成功しました。
</pre></div>
    </div>
   </div>
   <div class="example" id="example-1195">
    <p><strong>例3 自動コミットをデフォルトで無効にした接続の作成</strong></p>
    <div class="example-contents"><p>
     オプションの配列を <span class="function"><strong>db2_connect()</strong></span>
     に渡すことで、接続ハンドルのデフォルトの振る舞いを変更できます。
    </p></div>
    <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br />$database&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #DD0000">'SAMPLE'</span><span style="color: #007700">;<br /></span><span style="color: #0000BB">$user&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #DD0000">'db2inst1'</span><span style="color: #007700">;<br /></span><span style="color: #0000BB">$password&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #DD0000">'ibmdb2'</span><span style="color: #007700">;<br /></span><span style="color: #0000BB">$options&nbsp;</span><span style="color: #007700">=&nbsp;array(</span><span style="color: #DD0000">'autocommit'&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #0000BB">DB2_AUTOCOMMIT_OFF</span><span style="color: #007700">);<br /><br /></span><span style="color: #0000BB">$conn&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">db2_connect</span><span style="color: #007700">(</span><span style="color: #0000BB">$database</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$user</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$password</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$options</span><span style="color: #007700">);<br /><br />if&nbsp;(</span><span style="color: #0000BB">$conn</span><span style="color: #007700">)&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;echo&nbsp;</span><span style="color: #DD0000">"接続に成功しました。\n"</span><span style="color: #007700">;<br />&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(</span><span style="color: #0000BB">db2_autocommit</span><span style="color: #007700">(</span><span style="color: #0000BB">$conn</span><span style="color: #007700">))&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;echo&nbsp;</span><span style="color: #DD0000">"自動コミットが有効です。\n"</span><span style="color: #007700">;<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br />&nbsp;&nbsp;&nbsp;&nbsp;else&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;echo&nbsp;</span><span style="color: #DD0000">"自動コミットは無効です。\n"</span><span style="color: #007700">;<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">db2_close</span><span style="color: #007700">(</span><span style="color: #0000BB">$conn</span><span style="color: #007700">);<br />}<br />else&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;echo&nbsp;</span><span style="color: #DD0000">"接続に失敗しました。"</span><span style="color: #007700">;<br />}<br /></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
    </div>

    <div class="example-contents"><p>上の例の出力は以下となります。</p></div>
    <div class="example-contents screen">
<div class="cdata"><pre>
接続に成功しました。
自動コミットは無効です。
</pre></div>
    </div>
   </div>
   <div class="example" id="example-1196">
    <p><strong>例4 i5/OS best performance</strong></p>
    <div class="example-contents"><p>
     i5/OS で最高のパフォーマンスを引き出すためには、ibm_db2 1.5.1
     を使用した PHP アプリケーションで
     <span class="function"><strong>db2_connect()</strong></span>
     にデフォルトのホスト、ユーザー ID およびパスワードを使用します。
    </p></div>
    <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br />&nbsp;&nbsp;$library&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #DD0000">"ADC"</span><span style="color: #007700">;<br />&nbsp;&nbsp;</span><span style="color: #0000BB">$i5&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">db2_connect</span><span style="color: #007700">(</span><span style="color: #DD0000">""</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">""</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">""</span><span style="color: #007700">,&nbsp;array(</span><span style="color: #DD0000">"i5_lib"</span><span style="color: #007700">=&gt;</span><span style="color: #DD0000">"qsys2"</span><span style="color: #007700">));<br />&nbsp;&nbsp;</span><span style="color: #0000BB">$result&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">db2_exec</span><span style="color: #007700">(</span><span style="color: #0000BB">$i5</span><span style="color: #007700">,&nbsp;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #DD0000">"select&nbsp;*&nbsp;from&nbsp;systables&nbsp;where&nbsp;table_schema&nbsp;=&nbsp;'</span><span style="color: #0000BB">$library</span><span style="color: #DD0000">'"</span><span style="color: #007700">);<br />&nbsp;&nbsp;while&nbsp;(</span><span style="color: #0000BB">$row&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">db2_fetch_both</span><span style="color: #007700">(</span><span style="color: #0000BB">$result</span><span style="color: #007700">))&nbsp;{&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;echo&nbsp;</span><span style="color: #0000BB">$row</span><span style="color: #007700">[</span><span style="color: #DD0000">'TABLE_NAME'</span><span style="color: #007700">].</span><span style="color: #DD0000">"&lt;/br&gt;"</span><span style="color: #007700">;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br />&nbsp;&nbsp;}&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br />&nbsp;&nbsp;</span><span style="color: #0000BB">db2_close</span><span style="color: #007700">(</span><span style="color: #0000BB">$i5</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
    </div>

    <div class="example-contents"><p>上の例の出力は以下となります。</p></div>
    <div class="example-contents screen">
<div class="cdata"><pre>
ANIMALS
NAMES
PICTURES
</pre></div>
    </div>
   </div>
   <div class="example" id="example-1197">
    <p><strong>例5 信頼済みコンテキストの使用</strong></p>
    <div class="example-contents"><p>
     次の例は、信頼済みのコンテキストを有効にしてユーザーを変更し、現在のユーザー ID
     を取得するものです。
    </p></div>
    <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br /><br />$database&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #DD0000">"SAMPLE"</span><span style="color: #007700">;<br /></span><span style="color: #0000BB">$hostname&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #DD0000">"localhost"</span><span style="color: #007700">;<br /></span><span style="color: #0000BB">$port&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">50000</span><span style="color: #007700">;<br /></span><span style="color: #0000BB">$authID&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #DD0000">"db2inst1"</span><span style="color: #007700">;<br /></span><span style="color: #0000BB">$auth_pass&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #DD0000">"ibmdb2"</span><span style="color: #007700">;<br /><br /></span><span style="color: #0000BB">$tc_user&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #DD0000">"tcuser"</span><span style="color: #007700">;<br /></span><span style="color: #0000BB">$tc_pass&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #DD0000">"tcpassword"</span><span style="color: #007700">;<br /><br /></span><span style="color: #0000BB">$dsn&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #DD0000">"DATABASE=</span><span style="color: #0000BB">$database</span><span style="color: #DD0000">;HOSTNAME=</span><span style="color: #0000BB">$hostname</span><span style="color: #DD0000">;PORT=</span><span style="color: #0000BB">$port</span><span style="color: #DD0000">;<br />&nbsp;&nbsp;PROTOCOL=TCPIP;UID=</span><span style="color: #0000BB">$authID</span><span style="color: #DD0000">;PWD=</span><span style="color: #0000BB">$auth_pass</span><span style="color: #DD0000">;"</span><span style="color: #007700">;<br /></span><span style="color: #0000BB">$options&nbsp;</span><span style="color: #007700">=&nbsp;array&nbsp;(</span><span style="color: #DD0000">"trustedcontext"&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #0000BB">DB2_TRUSTED_CONTEXT_ENABLE</span><span style="color: #007700">);<br /><br /></span><span style="color: #0000BB">$tc_conn&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">db2_connect</span><span style="color: #007700">(</span><span style="color: #0000BB">$dsn</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">""</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">""</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$options</span><span style="color: #007700">);<br />if(</span><span style="color: #0000BB">$tc_conn</span><span style="color: #007700">)&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;echo&nbsp;</span><span style="color: #DD0000">"Explicit&nbsp;trusted&nbsp;connection&nbsp;succeeded.\n"</span><span style="color: #007700">;<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;if(</span><span style="color: #0000BB">db2_get_option</span><span style="color: #007700">(</span><span style="color: #0000BB">$tc_conn</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">"trustedcontext"</span><span style="color: #007700">))&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$userBefore&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">db2_get_option</span><span style="color: #007700">(</span><span style="color: #0000BB">$tc_conn</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">"trusted_user"</span><span style="color: #007700">);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">//&nbsp;user&nbsp;1&nbsp;で何らかの作業をします<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;信頼済みユーザーに切り替えます<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$parameters&nbsp;</span><span style="color: #007700">=&nbsp;array(</span><span style="color: #DD0000">"trusted_user"&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #0000BB">$tc_user</span><span style="color: #007700">,&nbsp;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #DD0000">"trusted_password"&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #0000BB">$tcuser_pass</span><span style="color: #007700">);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$res&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">db2_set_option&nbsp;</span><span style="color: #007700">(</span><span style="color: #0000BB">$tc_conn</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$parameters</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">1</span><span style="color: #007700">);<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$userAfter&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">db2_get_option</span><span style="color: #007700">(</span><span style="color: #0000BB">$tc_conn</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">"trusted_user"</span><span style="color: #007700">);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">//&nbsp;信頼済みユーザーとして何らかの作業をします<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">if(</span><span style="color: #0000BB">$userBefore&nbsp;</span><span style="color: #007700">!=&nbsp;</span><span style="color: #0000BB">$userAfter</span><span style="color: #007700">)&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;echo&nbsp;</span><span style="color: #DD0000">"User&nbsp;has&nbsp;been&nbsp;switched."&nbsp;</span><span style="color: #007700">.&nbsp;</span><span style="color: #DD0000">"\n"</span><span style="color: #007700">;&nbsp;&nbsp;&nbsp;&nbsp;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">db2_close</span><span style="color: #007700">(</span><span style="color: #0000BB">$tc_conn</span><span style="color: #007700">);<br />}<br />else&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;echo&nbsp;</span><span style="color: #DD0000">"Explicit&nbsp;trusted&nbsp;connection&nbsp;failed.\n"</span><span style="color: #007700">;<br />}<br /></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
    </div>

    <div class="example-contents"><p>上の例の出力は以下となります。</p></div>
    <div class="example-contents screen">
<div class="cdata"><pre>
Explicit trusted connection succeeded.
User has been switched.
</pre></div>
    </div>
   </div>
  </p>
 </div>


 <div class="refsect1 seealso" id="refsect1-function.db2-connect-seealso">
  <h3 class="title">参考</h3>
  <p class="para">
   <ul class="simplelist">
    <li class="member"><span class="function"><a href="function.db2-close.html" class="function" rel="rdfs-seeAlso">db2_close()</a> - データベース接続を閉じる</span></li>
    <li class="member"><span class="function"><a href="function.db2-pconnect.html" class="function" rel="rdfs-seeAlso">db2_pconnect()</a> - データベースへの持続的接続を返す</span></li>
   </ul>
  </p>
 </div>



</div><div id="usernotes">
 <div class="head">
  <h3 class="title">User Contributed Notes</h3>
 </div>
 <div class="note">There are no user contributed notes for this page.</div>
</div>
</div></div></body></html>
