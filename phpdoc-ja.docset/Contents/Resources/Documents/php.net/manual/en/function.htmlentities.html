<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
 <head>
  <meta http-equiv="content-type" content="text/html; CHARSET=shift-jis">
  <title>適用可能な文字を全て HTML エンティティに変換する</title>

  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <link media="all" rel="stylesheet" type="text/css" href="style.css"/>
 </head>
 <body class="docs" class="docs"><div class="navbar navbar-fixed-top">
  <div class="navbar-inner clearfix">
    <ul class="nav" style="width: 100%">
      <li style="float: left;"><a href="function.html-entity-decode.html">≪ html_entity_decode</a></li>
      <li style="float: right;"><a href="function.htmlspecialchars-decode.html">htmlspecialchars_decode ≫</a></li>
    </ul>
  </div>
</div>
<div id="breadcrumbs" class="clearfix">
  <ul class="breadcrumbs-container">
    <li><a href="index.html">PHP Manual</a></li>
    <li><a href="ref.strings.html">String 関数</a></li>
    <li>適用可能な文字を全て HTML エンティティに変換する</li>
  </ul>
</div>
<div id="layout">
  <div id="layout-content"><div id="function.htmlentities" class="refentry">
 <div class="refnamediv">
  <h1 class="refname">htmlentities</h1>
  <p class="verinfo">(PHP 4, PHP 5)</p><p class="refpurpose"><span class="refname">htmlentities</span> &mdash; <span class="dc-title">適用可能な文字を全て HTML エンティティに変換する</span></p>

 </div>
 
 <div class="refsect1 description" id="refsect1-function.htmlentities-description">
  <h3 class="title">説明</h3>
  <div class="methodsynopsis dc-description">
   <span class="type">string</span> <span class="methodname"><strong>htmlentities</strong></span>
    ( <span class="methodparam"><span class="type">string</span> <code class="parameter">$string</code></span>
   [, <span class="methodparam"><span class="type">int</span> <code class="parameter">$flags</code><span class="initializer"> = ENT_COMPAT | ENT_HTML401</span></span>
   [, <span class="methodparam"><span class="type">string</span> <code class="parameter">$encoding</code><span class="initializer"> = &quot;UTF-8&quot;</span></span>
   [, <span class="methodparam"><span class="type">bool</span> <code class="parameter">$double_encode</code><span class="initializer"> = true</span></span>
  ]]] )</div>

  <p class="para rdfs-comment">
   この関数は<span class="function"><a href="function.htmlspecialchars.html" class="function">htmlspecialchars()</a></span>と同じですが、
   HTML エンティティと等価な意味を有する文字をHTMLエンティティに変換します。
  </p>
  <p class="para">
   もしデコード (逆の処理) をしたい場合、
   <span class="function"><a href="function.html-entity-decode.html" class="function">html_entity_decode()</a></span> を使用することができます。
  </p>
 </div>


 <div class="refsect1 parameters" id="refsect1-function.htmlentities-parameters">
  <h3 class="title">パラメータ</h3>
  <p class="para">
   <dl>

    
     <dt>
<code class="parameter">string</code></dt>

     <dd>

      <p class="para">
       入力文字列。
      </p>
     </dd>

    
    
     <dt>
<code class="parameter">flags</code></dt>

     <dd>

      <p class="para">
       以下のフラグを組み合わせたビットマスクです。
       クォートや無効な符号単位シーケンス、そして文書型の扱いを指定します。
       デフォルトは <em>ENT_COMPAT | ENT_HTML401</em> です。
       <table class="doctable table">
        <caption><strong>利用可能な <code class="parameter">flags</code> 定数</strong></caption>
        
         <thead>
          <tr>
           <th>定数名</th>
           <th>説明</th>
          </tr>

         </thead>

         <tbody class="tbody">
          <tr>
           <td><strong><code>ENT_COMPAT</code></strong></td>
           <td>ダブルクオートは変換しますがシングルクオートは変換しません。</td>
          </tr>

          <tr>
           <td><strong><code>ENT_QUOTES</code></strong></td>
           <td>シングルクオートとダブルクオートを共に変換します。</td>
          </tr>

          <tr>
           <td><strong><code>ENT_NOQUOTES</code></strong></td>
           <td>シングルクオートとダブルクオートは共に変換されません。</td>
          </tr>

          <tr>
           <td><strong><code>ENT_IGNORE</code></strong></td>
           <td>
            無効な符号単位シーケンスを含む文字列を渡したときに、
            空の文字列を返すのではなく無効な部分を切り捨てるようになります。
            このフラグは使わないようにしましょう。
            <a href="http://unicode.org/reports/tr36/#Deletion_of_Noncharacters" class="link external" title="Link : http://unicode.org/reports/tr36/#Deletion_of_Noncharacters">&raquo;&nbsp;セキュリティの問題が発生する可能性があります</a>。
           </td>
          </tr>

          <tr>
           <td><strong><code>ENT_SUBSTITUTE</code></strong></td>
           <td>
            無効な符号単位シーケンスを含む文字列を渡したときに、
            空の文字列を返すのではなく Unicode の置換文字に置き換えます。
            UTF-8 の場合は U+FFFD、それ以外の場合は &amp;#FFFD; となります。
           </td>
          </tr>

          <tr>
           <td><strong><code>ENT_DISALLOWED</code></strong></td>
           <td>
            指定した文書型において無効な符号位置を、Unicode の代替文字である
            U+FFFD (UTF-8) あるいは &amp;#FFFD; で置き換えます。
            これを設定しなければ、無効な符号位置をそのまま残します。
            これは、外部コンテンツを埋め込んだ XML 文書を整形式に保つために有用です。
           </td>
          </tr>

          <tr>
           <td><strong><code>ENT_HTML401</code></strong></td>
           <td>
            コードを HTML 4.01 として処理します。
           </td>
          </tr>

          <tr>
           <td><strong><code>ENT_XML1</code></strong></td>
           <td>
            コードを XML 1 として処理します。
           </td>
          </tr>

          <tr>
           <td><strong><code>ENT_XHTML</code></strong></td>
           <td>
            コードを XHTML として処理します。
           </td>
          </tr>

          <tr>
           <td><strong><code>ENT_HTML5</code></strong></td>
           <td>
            コードを HTML 5 として処理します。
           </td>
          </tr>

         </tbody>
        
       </table>

      </p>
     </dd>

    
    
     <dt>
<code class="parameter">encoding</code></dt>

     <dd>

      <p class="para">
       <span class="function"><a href="function.htmlspecialchars.html" class="function">htmlspecialchars()</a></span>と同様に、<span class="function"><strong>htmlentities()</strong></span> はオプションの3番目の引数
       <code class="parameter">charset</code> をとり、変換に使用されるエンコーディングを指定可能です。
       PHP 5.6.0 以降では、デフォルト値として <a href="ini.core.html#ini.default-charset" class="link">default_charset</a>
       の値を使います。それ以前のデフォルト値は、
       PHP 5.4.0 より前のバージョンでは
       ISO-8859-1、そして PHP 5.4.0 以降では UTF-8 でした。
       この引数は表向きには任意指定となっていますが、コードにあわせて正しい値を指定しておくことを強く推奨します。
      </p>
      


<p class="para">
 以下の文字セットをサポートします。
 <table class="doctable table">
  <caption><strong>サポートする文字セット</strong></caption>
  
   <thead>
    <tr>
     <th>文字セット</th>
     <th>エイリアス</th>
     <th>説明</th>
    </tr>

   </thead>

   <tbody class="tbody">
    <tr>
     <td>ISO-8859-1</td>
     <td>ISO8859-1</td>
     <td>
      西欧、Latin-1
     </td>
    </tr>

    <tr>
     <td>ISO-8859-5</td>
     <td>ISO8859-5</td>
     <td>
      ほとんど使われないキリル文字セット (Latin/Cyrillic)。
     </td>
    </tr>

   <tr>
     <td>ISO-8859-15</td>
     <td>ISO8859-15</td>
     <td>
      西欧、Latin-9 。Latin-1(ISO-8859-1) に欠けている
      ユーロ記号やフランス・フィンランドの文字を追加したもの。
     </td>
    </tr>

    <tr>
     <td>UTF-8</td>
     <td class="empty">&nbsp;</td>
     <td>
      ASCII 互換のマルチバイト 8 ビット Unicode 。
     </td>
    </tr>

    <tr>
     <td>cp866</td>
     <td>ibm866, 866</td>
     <td>
      DOS 固有のキリル文字セット。
     </td>
    </tr>

    <tr>
     <td>cp1251</td>
     <td>Windows-1251, win-1251, 1251</td>
     <td>
      Windows 固有のキリル文字セット。
     </td>
    </tr>

    <tr>
     <td>cp1252</td>
     <td>Windows-1252, 1252</td>
     <td>
      西欧のための Windows 固有の文字セット。
     </td>
    </tr>

    <tr>
     <td>KOI8-R</td>
     <td>koi8-ru, koi8r</td>
     <td>
      ロシア語。
     </td>
    </tr>

    <tr>
     <td>BIG5</td>
     <td>950</td>
     <td>
      繁体字中国語。主に台湾で使用されます。
     </td>
    </tr>

    <tr>
     <td>GB2312</td>
     <td>936</td>
     <td>
      簡体字中国語。国の標準文字セットです。
     </td>
    </tr>

    <tr>
     <td>BIG5-HKSCS</td>
     <td class="empty">&nbsp;</td>
     <td>
      Big5 に香港の拡張を含めたもの。繁体字中国語。
     </td>
    </tr>

    <tr>
     <td>Shift_JIS</td>
     <td>SJIS, SJIS-win, cp932, 932</td>
     <td>
      日本語。
     </td>
    </tr>

    <tr>
     <td>EUC-JP</td>
     <td>EUCJP, eucJP-win</td>
     <td>
      日本語。
     </td>
    </tr>

    <tr>
     <td>MacRoman</td>
     <td class="empty">&nbsp;</td>
     <td>
      Mac OS で使われる文字セット。
     </td>
    </tr>

    <tr>
     <td><em>&#039;&#039;</em></td>
     <td class="empty">&nbsp;</td>
     <td>
      空文字列を指定すると、
      スクリプトのエンコーディング (Zend multibyte)、
      <a href="ini.core.html#ini.default-charset" class="link">default_charset</a>、
      そして現在のロケール (<span class="function"><a href="function.nl-langinfo.html" class="function">nl_langinfo()</a></span> および
      <span class="function"><a href="function.setlocale.html" class="function">setlocale()</a></span> を参照ください)
      の順でエンコーディングを検出します。
      この方法はおすすめしません。
     </td>
    </tr>

   </tbody>
  
 </table>

 <blockquote class="note"><p><strong class="note">注意</strong>: 
  <span class="simpara">
   これら以外の文字セットは理解できません。
   かわりにデフォルトのエンコーディングを使用し、警告を発生させます。
  </span>
 </p></blockquote>
</p>


     </dd>

    
    
     <dt>
<code class="parameter">double_encode</code></dt>

     <dd>

      <p class="para">
       <code class="parameter">double_encode</code> をオフにすると、PHP
       は既存の html エンティティをエンコードしません。
       デフォルトでは、既存のエンティティも含めてすべてを変換します。
      </p>
     </dd>

    
   </dl>

  </p>
 </div>


 <div class="refsect1 returnvalues" id="refsect1-function.htmlentities-returnvalues">
  <h3 class="title">返り値</h3>
  <p class="para">
   エンコードした文字列を返します。
  </p>
  <p class="para">
   入力文字列の中に、指定した <code class="parameter">encoding</code> で無効な符号単位シーケンスが含まれる場合は、
   <strong><code>ENT_IGNORE</code></strong> あるいは
   <strong><code>ENT_SUBSTITUTE</code></strong> フラグが設定されていない限りは空文字列を返します。
  </p>
 </div>


 <div class="refsect1 changelog" id="refsect1-function.htmlentities-changelog">
  <h3 class="title">変更履歴</h3>
  <p class="para">
   <table class="doctable informaltable">
    
     <thead>
      <tr>
       <th>バージョン</th>
       <th>説明</th>
      </tr>

     </thead>

     <tbody class="tbody">
      <tr>
       <td>5.4.0</td>
       <td>
        <code class="parameter">encoding</code> パラメータのデフォルトが
        UTF-8 に変わりました。
       </td>
      </tr>

      <tr>
       <td>5.4.0</td>
       <td>
        定数 <strong><code>ENT_SUBSTITUTE</code></strong>、<strong><code>ENT_DISALLOWED</code></strong>、
        <strong><code>ENT_HTML401</code></strong>、<strong><code>ENT_XML1</code></strong>、
        <strong><code>ENT_XHTML</code></strong> および <strong><code>ENT_HTML5</code></strong> が追加されました。
       </td>
      </tr>

      <tr>
       <td>5.3.0</td>
       <td>
        定数 <strong><code>ENT_IGNORE</code></strong> が追加されました。
       </td>
      </tr>

      <tr>
       <td>5.2.3</td>
       <td>
        <code class="parameter">double_encode</code> パラメータが追加されました。
       </td>
      </tr>

     </tbody>
    
   </table>

  </p>
 </div>


 <div class="refsect1 examples" id="refsect1-function.htmlentities-examples">
  <h3 class="title">例</h3>
  <p class="para">
   <div class="example" id="example-4946">
    <p><strong>例1 <span class="function"><strong>htmlentities()</strong></span> の例</strong></p>
    <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br />$str&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #DD0000">"A&nbsp;'quote'&nbsp;is&nbsp;&lt;b&gt;bold&lt;/b&gt;"</span><span style="color: #007700">;<br /><br /></span><span style="color: #FF8000">//&nbsp;出力:&nbsp;A&nbsp;'quote'&nbsp;is&nbsp;&amp;lt;b&amp;gt;bold&amp;lt;/b&amp;gt;<br /></span><span style="color: #007700">echo&nbsp;</span><span style="color: #0000BB">htmlentities</span><span style="color: #007700">(</span><span style="color: #0000BB">$str</span><span style="color: #007700">);<br /><br /></span><span style="color: #FF8000">//&nbsp;出力:&nbsp;A&nbsp;&amp;#039;quote&amp;#039;&nbsp;is&nbsp;&amp;lt;b&amp;gt;bold&amp;lt;/b&amp;gt;<br /></span><span style="color: #007700">echo&nbsp;</span><span style="color: #0000BB">htmlentities</span><span style="color: #007700">(</span><span style="color: #0000BB">$str</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">ENT_QUOTES</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
    </div>

   </div>
  </p>
  
  <p class="para">
   <div class="example" id="example-4947">
    <p><strong>例2 <strong><code>ENT_IGNORE</code></strong> の使用例</strong></p>
    <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br />$str&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #DD0000">"\x8F!!!"</span><span style="color: #007700">;<br /><br /></span><span style="color: #FF8000">//&nbsp;出力:&nbsp;空の文字列<br /></span><span style="color: #007700">echo&nbsp;</span><span style="color: #0000BB">htmlentities</span><span style="color: #007700">(</span><span style="color: #0000BB">$str</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">ENT_QUOTES</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">"UTF-8"</span><span style="color: #007700">);<br /><br /></span><span style="color: #FF8000">//&nbsp;出力:&nbsp;"!!!"<br /></span><span style="color: #007700">echo&nbsp;</span><span style="color: #0000BB">htmlentities</span><span style="color: #007700">(</span><span style="color: #0000BB">$str</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">ENT_QUOTES&nbsp;</span><span style="color: #007700">|&nbsp;</span><span style="color: #0000BB">ENT_IGNORE</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">"UTF-8"</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
    </div>

   </div>
  </p>
 </div>


 <div class="refsect1 seealso" id="refsect1-function.htmlentities-seealso">
  <h3 class="title">参考</h3>
  <p class="para">
   <ul class="simplelist">
    <li class="member"><span class="function"><a href="function.html-entity-decode.html" class="function" rel="rdfs-seeAlso">html_entity_decode()</a> - HTML エンティティを適切な文字に変換する</span></li>
    <li class="member"><span class="function"><a href="function.get-html-translation-table.html" class="function" rel="rdfs-seeAlso">get_html_translation_table()</a> - htmlspecialchars および htmlentities で使用される変換テーブルを返す</span></li>
    <li class="member"><span class="function"><a href="function.htmlspecialchars.html" class="function" rel="rdfs-seeAlso">htmlspecialchars()</a> - 特殊文字を HTML エンティティに変換する</span></li>
    <li class="member"><span class="function"><a href="function.nl2br.html" class="function" rel="rdfs-seeAlso">nl2br()</a> - 改行文字の前に HTML の改行タグを挿入する</span></li>
    <li class="member"><span class="function"><a href="function.urlencode.html" class="function" rel="rdfs-seeAlso">urlencode()</a> - 文字列を URL エンコードする</span></li>
   </ul>
  </p>
 </div>


</div><div id="usernotes">
 <div class="head">
  <h3 class="title">User Contributed Notes</h3>
 </div>
<div id="allnotes">  <a name="114041""></a>
  <div class="note">
   <strong class="user">hajo-p</strong>
   <a href="#114041" class="date">06-Jan-2014 02:18</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
The flag ENT_HTML5 also strips newline chars like \n with htmlentities while htmlspecialchars is not affected by that.<br />
<br />
If you want to use nl2br on that string afterwards you might end up searching the problem like i did. This does not apply to other flags like e.g. ENT_XHTML which confused me.<br />
<br />
Tested this with PHP 5.4 / 5.5 / 5.6-dev with same results, so it seems that this is an intended "feature".</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="113268""></a>
  <div class="note">
   <strong class="user">rq</strong>
   <a href="#113268" class="date">19-Sep-2013 10:37</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
For use of html&nbsp; tags, ampersands, etc. in xml document<br />
<br />
(f.e.<br />
<br />
&lt;xml&gt;<br />
<br />
&lt;xmltag1&gt;&lt;span class="data1"&gt; data 1&lt;/span&gt; &amp; data2&lt;/xmltag1&gt;<br />
<br />
&lt;/xml&gt;<br />
<br />
)<br />
<br />
one can use the CDATA brackets:<br />
<br />
&lt;xmltag1&gt;&lt;![CDATA[&lt;span class="data1"&gt; data 1&lt;/span&gt; &amp; data2]]&gt;&lt;/xmltag1&gt;<br />
<br />
-rq</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="108222""></a>
  <div class="note">
   <strong class="user">ustimenko dot alexander at gmail dot com</strong>
   <a href="#108222" class="date">09-Apr-2012 11:15</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
For those Spanish (and not only) folks, that want their national letters back after htmlentities :)<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">protected function </span><span class="default">_decodeAccented</span><span class="keyword">(</span><span class="default">$encodedValue</span><span class="keyword">, </span><span class="default">$options </span><span class="keyword">= array()) {<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$options </span><span class="keyword">+= array(<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="string">'quote'&nbsp; &nbsp;&nbsp; </span><span class="keyword">=&gt; </span><span class="default">ENT_NOQUOTES</span><span class="keyword">,<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="string">'encoding'&nbsp; </span><span class="keyword">=&gt; </span><span class="string">'UTF-8'</span><span class="keyword">,<br />
&nbsp;&nbsp;&nbsp; );<br />
&nbsp;&nbsp;&nbsp; return </span><span class="default">preg_replace_callback</span><span class="keyword">(<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="string">'/&amp;\w(acute|uml|tilde);/'</span><span class="keyword">,<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">create_function</span><span class="keyword">(<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="string">'$m'</span><span class="keyword">,<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="string">'return html_entity_decode($m[0], ' </span><span class="keyword">. </span><span class="default">$options</span><span class="keyword">[</span><span class="string">'quote'</span><span class="keyword">] . </span><span class="string">', "' </span><span class="keyword">.<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$options</span><span class="keyword">[</span><span class="string">'encoding'</span><span class="keyword">] . </span><span class="string">'");'<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">),<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$encodedValue<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">);<br />
}<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="107985""></a>
  <div class="note">
   <strong class="user">n at erui dot eu</strong>
   <a href="#107985" class="date">20-Mar-2012 09:46</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
html entities does not encode all unicode characters. It encodes what it can [all of latin1], and the others slip through. &amp;#1033; is the nasty I use. I have searched for a function which encodes everything, but in the end I wrote this. This is as simple as I can get it. Consult an ansii table to custom include/omit chars you want/don't. I'm sure it's not that fast.<br />
<br />
// Unicode-proof htmlentities. <br />
// Returns 'normal' chars as chars and weirdos as numeric html entites.<br />
function superentities( $str ){<br />
&nbsp;&nbsp;&nbsp; // get rid of existing entities else double-escape<br />
&nbsp;&nbsp;&nbsp; $str = html_entity_decode(stripslashes($str),ENT_QUOTES,'UTF-8'); <br />
&nbsp;&nbsp;&nbsp; $ar = preg_split('/(?&lt;!^)(?!$)/u', $str );&nbsp; // return array of every multi-byte character<br />
&nbsp;&nbsp;&nbsp; foreach ($ar as $c){<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $o = ord($c);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if ( (strlen($c) &gt; 1) || /* multi-byte [unicode] */<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; ($o &lt;32 || $o &gt; 126) || /* &lt;- control / latin weirdos -&gt; */<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; ($o &gt;33 &amp;&amp; $o &lt; 40) ||/* quotes + ambersand */<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; ($o &gt;59 &amp;&amp; $o &lt; 63) /* html */<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; ) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; // convert to numeric entity<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $c = mb_encode_numericentity($c,array (0x0, 0xffff, 0, 0xffff), 'UTF-8');<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $str2 .= $c;<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; return $str2;<br />
}</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="106929""></a>
  <div class="note">
   <strong class="user">wd at NOSPAMwd dot it</strong>
   <a href="#106929" class="date">19-Dec-2011 11:20</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Hi there,<br />
<br />
after several and several tests, I figured out that dot:<br />
<br />
- htmlentities() function remove characters like "a","e",etc when you specify a flag and a charset<br />
<br />
- htmlentities() function DOES NOT remove characters like those above when you DO NOT specify anything<br />
<br />
So, let's assume that..<br />
<br />
<span class="default">&lt;?php<br />
<br />
$str </span><span class="keyword">= </span><span class="string">"Heeellooo"</span><span class="keyword">;<br />
<br />
</span><span class="default">$res_1 </span><span class="keyword">= </span><span class="default">htmlentities</span><span class="keyword">(</span><span class="default">$str</span><span class="keyword">, </span><span class="default">ENT_QUOTES</span><span class="keyword">, </span><span class="string">"UTF-8"</span><span class="keyword">);<br />
</span><span class="default">$res_2 </span><span class="keyword">= </span><span class="default">htmlentities</span><span class="keyword">(</span><span class="default">$str</span><span class="keyword">);<br />
<br />
echo </span><span class="default">var_dump</span><span class="keyword">(</span><span class="default">$res_1</span><span class="keyword">); </span><span class="comment">// Result: string '' (length=0)<br />
</span><span class="keyword">echo </span><span class="default">var_dump</span><span class="keyword">(</span><span class="default">$res_2</span><span class="keyword">); </span><span class="comment">// string 'H&amp;egrave;&amp;egrave;&amp;egrave;llooo' (length=30)<br />
<br />
</span><span class="default">?&gt;<br />
</span><br />
I used this for a textarea content for comments. Anyway, note that using the "$res_2" form the function will leave unconverted single/double quotes. At this point you should use str_replace() function to perform the characters but be careful because..<br />
<br />
<span class="default">&lt;?php<br />
<br />
$str </span><span class="keyword">= </span><span class="string">"'Heeellooo'"</span><span class="keyword">;<br />
<br />
</span><span class="default">$res_2 </span><span class="keyword">= </span><span class="default">str_replace</span><span class="keyword">(</span><span class="string">"'"</span><span class="keyword">,</span><span class="string">"&amp;#039;"</span><span class="keyword">,</span><span class="default">$str</span><span class="keyword">);<br />
</span><span class="default">$res_2 </span><span class="keyword">= </span><span class="default">htmlentities</span><span class="keyword">(</span><span class="default">$str</span><span class="keyword">);<br />
echo </span><span class="default">var_dump</span><span class="keyword">(</span><span class="default">$res_2</span><span class="keyword">); </span><span class="comment">// string '&amp;amp;#039;H&amp;egrave;&amp;egrave;&amp;egrave;llooo&amp;amp;#039;'<br />
<br />
</span><span class="default">$res_3 </span><span class="keyword">= </span><span class="default">htmlentities</span><span class="keyword">(</span><span class="default">$str</span><span class="keyword">);<br />
</span><span class="default">$res_3 </span><span class="keyword">= </span><span class="default">str_replace</span><span class="keyword">(</span><span class="string">"'"</span><span class="keyword">,</span><span class="string">"&amp;#039;"</span><span class="keyword">,</span><span class="default">$res_3</span><span class="keyword">);<br />
echo </span><span class="default">var_dump</span><span class="keyword">(</span><span class="default">$res_3</span><span class="keyword">); </span><span class="comment">// string '&amp;#039;H&amp;egrave;&amp;egrave;&amp;egrave;llooo&amp;#039;' --&gt; Nice<br />
</span><span class="default">?&gt;<br />
</span><br />
Hope it will helps you.<br />
<br />
Regards,<br />
W.D.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="106535""></a>
  <div class="note">
   <strong class="user">steve at mcdragonsoftware dot com</strong>
   <a href="#106535" class="date">17-Nov-2011 05:59</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I'm glad 5.4 has xml support, but many of us are working with older installations, some of us still have to use PHP4. If you're like me you've been frustrated with trying to use htmlentites/htmlspecial chars with xml output. I was hoping to find an option to force numeric encoding, lacking that, I have written my own xmlencode function, which I now offer:
<br />

<br />
usage: 
<br />

<br />
$string xmlencode( $string )
<br />

<br />
it will use htmlspecialchars for the valid xml entities amp, quote, lt, gt, (apos) and return the numeric entity for all other non alpha-numeric characters.
<br />

<br />
-------------------------------------------
<br />

<br />
<span class="default">&lt;?php 
<br />
</span><span class="keyword">if( !</span><span class="default">function_exists</span><span class="keyword">( </span><span class="string">'xmlentities' </span><span class="keyword">) ) {
<br />
&nbsp;&nbsp;&nbsp; function </span><span class="default">xmlentities</span><span class="keyword">( </span><span class="default">$string </span><span class="keyword">) {
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$not_in_list </span><span class="keyword">= </span><span class="string">"A-Z0-9a-z\s_-"</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">preg_replace_callback</span><span class="keyword">( </span><span class="string">"/[^</span><span class="keyword">{</span><span class="default">$not_in_list</span><span class="keyword">}</span><span class="string">]/" </span><span class="keyword">, </span><span class="string">'get_xml_entity_at_index_0' </span><span class="keyword">, </span><span class="default">$string </span><span class="keyword">);
<br />
&nbsp;&nbsp;&nbsp; }
<br />
&nbsp;&nbsp;&nbsp; function </span><span class="default">get_xml_entity_at_index_0</span><span class="keyword">( </span><span class="default">$CHAR </span><span class="keyword">) {
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if( !</span><span class="default">is_string</span><span class="keyword">( </span><span class="default">$CHAR</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">] ) || ( </span><span class="default">strlen</span><span class="keyword">( </span><span class="default">$CHAR</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">] ) &gt; </span><span class="default">1 </span><span class="keyword">) ) {
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; die( </span><span class="string">"function: 'get_xml_entity_at_index_0' requires data type: 'char' (single character). '</span><span class="keyword">{</span><span class="default">$CHAR</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">]}</span><span class="string">' does not match this type." </span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; switch( </span><span class="default">$CHAR</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">] ) {
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; case </span><span class="string">"'"</span><span class="keyword">:&nbsp; &nbsp; case </span><span class="string">'"'</span><span class="keyword">:&nbsp; &nbsp; case </span><span class="string">'&amp;'</span><span class="keyword">:&nbsp; &nbsp; case </span><span class="string">'&lt;'</span><span class="keyword">:&nbsp; &nbsp; case </span><span class="string">'&gt;'</span><span class="keyword">:
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">htmlspecialchars</span><span class="keyword">( </span><span class="default">$CHAR</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">], </span><span class="default">ENT_QUOTES </span><span class="keyword">);&nbsp; &nbsp; break;
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; default:
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">numeric_entity_4_char</span><span class="keyword">(</span><span class="default">$CHAR</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">]);&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; break;
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }&nbsp; &nbsp; &nbsp; &nbsp; 
<br />
&nbsp;&nbsp;&nbsp; }
<br />
&nbsp;&nbsp;&nbsp; function </span><span class="default">numeric_entity_4_char</span><span class="keyword">( </span><span class="default">$char </span><span class="keyword">) {
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="string">"&amp;#"</span><span class="keyword">.</span><span class="default">str_pad</span><span class="keyword">(</span><span class="default">ord</span><span class="keyword">(</span><span class="default">$char</span><span class="keyword">), </span><span class="default">3</span><span class="keyword">, </span><span class="string">'0'</span><span class="keyword">, </span><span class="default">STR_PAD_LEFT</span><span class="keyword">).</span><span class="string">";"</span><span class="keyword">;
<br />
&nbsp;&nbsp;&nbsp; }&nbsp; &nbsp; 
<br />
}
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="104288""></a>
  <div class="note">
   <strong class="user">Waygood</strong>
   <a href="#104288" class="date">06-Jun-2011 11:09</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
When putting values inside comment tags &lt;!-- --&gt; you should replace -- with &amp;#45;&amp;#45; too, as this would end your tag and show the rest of the comment.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="103486""></a>
  <div class="note">
   <strong class="user">robin at robinwinslow dot co dot uk</strong>
   <a href="#103486" class="date">15-Apr-2011 05:14</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
htmlentities seems to have changed at some point between version 5.1.6 and 5.3.3, such that it now returns an empty string for anything containing a pound sign:<br />
<br />
$ php -v<br />
PHP 5.1.6 (cli) (built: May 22 2008 09:08:44)<br />
$ php -r "echo htmlentities('£hello', null, 'utf-8');"<br />
&amp;pound;hello<br />
$<br />
<br />
$ php -v<br />
PHP 5.3.3 (cli) (built: Aug 19 2010 12:07:49)<br />
$ php -r "echo htmlentities('£hello', null, 'utf-8');"<br />
$<br />
<br />
(Returns an empty string the second time)<br />
<br />
Just a heads up.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="102621""></a>
  <div class="note">
   <strong class="user">admin at wapforum dot rs</strong>
   <a href="#102621" class="date">24-Feb-2011 10:11</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
A useful little function to convert the symbols in the different inputs.<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">function </span><span class="default">ConvertSimbols</span><span class="keyword">(</span><span class="default">$var</span><span class="keyword">, </span><span class="default">$ConvertQuotes </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">) {<br />
if (</span><span class="default">$ConvertQuotes </span><span class="keyword">&gt; </span><span class="default">0</span><span class="keyword">) {<br />
</span><span class="default">$var </span><span class="keyword">= </span><span class="default">htmlentities</span><span class="keyword">(</span><span class="default">$var</span><span class="keyword">, </span><span class="default">ENT_NOQUOTES</span><span class="keyword">, </span><span class="string">'UTF-8'</span><span class="keyword">);<br />
</span><span class="default">$var </span><span class="keyword">= </span><span class="default">str_replace</span><span class="keyword">(</span><span class="string">'\"'</span><span class="keyword">, </span><span class="string">''</span><span class="keyword">, </span><span class="default">$var</span><span class="keyword">);<br />
</span><span class="default">$var </span><span class="keyword">= </span><span class="default">str_replace</span><span class="keyword">(</span><span class="string">"\'"</span><span class="keyword">, </span><span class="string">''</span><span class="keyword">, </span><span class="default">$var</span><span class="keyword">);<br />
} else {<br />
</span><span class="default">$var </span><span class="keyword">= </span><span class="default">htmlentities</span><span class="keyword">(</span><span class="default">$var</span><span class="keyword">, </span><span class="default">ENT_QUOTES</span><span class="keyword">, </span><span class="string">'UTF-8'</span><span class="keyword">);<br />
}<br />
return </span><span class="default">$var</span><span class="keyword">;<br />
}<br />
</span><span class="default">?&gt;<br />
</span><br />
Usage with quotes for example message:<br />
<br />
$message = ConvertSimbols($message);<br />
<br />
Usage without quotes for example link:<br />
<br />
$link = ConvertSimbols($link, 1);</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="102363""></a>
  <div class="note">
   <strong class="user">kindrosker at gmail dot com</strong>
   <a href="#102363" class="date">10-Feb-2011 02:31</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
All Codes list<br />
<br />
array('A'=&gt;'&amp;Agrave;', 'a'=&gt;'&amp;agrave;', 'A'=&gt;'&amp;Aacute;', 'a'=&gt;'&amp;aacute;', 'A'=&gt;'&amp;Acirc;', 'a'=&gt;'&amp;acirc;', 'A'=&gt;'&amp;Atilde;', 'a'=&gt;'&amp;atilde;', 'A'=&gt;'&amp;Auml;', 'a'=&gt;'&amp;auml;', 'A'=&gt;'&amp;Aring;', 'a'=&gt;'&amp;aring;', 'A'=&gt;'&amp;AElig;', 'a'=&gt;'&amp;aelig;', 'C'=&gt;'&amp;Ccedil;', 'c'=&gt;'&amp;ccedil;', 'D'=&gt;'&amp;ETH;', 'd'=&gt;'&amp;eth;', 'E'=&gt;'&amp;Egrave;', 'e'=&gt;'&amp;egrave;', 'E'=&gt;'&amp;Eacute;', 'e'=&gt;'&amp;eacute;', 'E'=&gt;'&amp;Ecirc;', 'e'=&gt;'&amp;ecirc;', 'E'=&gt;'&amp;Euml;', 'e'=&gt;'&amp;euml;', 'I'=&gt;'&amp;Igrave;', 'i'=&gt;'&amp;igrave;', 'I'=&gt;'&amp;Iacute;', 'i'=&gt;'&amp;iacute;', 'I'=&gt;'&amp;Icirc;', 'i'=&gt;'&amp;icirc;', 'I'=&gt;'&amp;Iuml;', 'i'=&gt;'&amp;iuml;', 'N'=&gt;'&amp;Ntilde;', 'n'=&gt;'&amp;ntilde;', 'O'=&gt;'&amp;Ograve;', 'o'=&gt;'&amp;ograve;', 'O'=&gt;'&amp;Oacute;', 'o'=&gt;'&amp;oacute;', 'O'=&gt;'&amp;Ocirc;', 'o'=&gt;'&amp;ocirc;', 'O'=&gt;'&amp;Otilde;', 'o'=&gt;'&amp;otilde;', 'O'=&gt;'&amp;Ouml;', 'o'=&gt;'&amp;ouml;', 'O'=&gt;'&amp;Oslash;', 'o'=&gt;'&amp;oslash;', '?'=&gt;'&amp;OElig;', '?'=&gt;'&amp;oelig;', 's'=&gt;'&amp;szlig;', 'T'=&gt;'&amp;THORN;', 't'=&gt;'&amp;thorn;', 'U'=&gt;'&amp;Ugrave;', 'u'=&gt;'&amp;ugrave;', 'U'=&gt;'&amp;Uacute;', 'u'=&gt;'&amp;uacute;', 'U'=&gt;'&amp;Ucirc;', 'u'=&gt;'&amp;ucirc;', 'U'=&gt;'&amp;Uuml;', 'u'=&gt;'&amp;uuml;', 'Y'=&gt;'&amp;Yacute;', 'y'=&gt;'&amp;yacute;', '?'=&gt;'&amp;Yuml;', 'y'=&gt;'&amp;yuml;');</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="100778""></a>
  <div class="note">
   <strong class="user">galert420 at gmail dot com</strong>
   <a href="#100778" class="date">05-Nov-2010 07:24</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Croatian entites
<br />

<br />
<span class="default">&lt;?php
<br />
$ent </span><span class="keyword">= array(
<br />
&nbsp;&nbsp;&nbsp; </span><span class="string">'?'</span><span class="keyword">=&gt;</span><span class="string">'&amp;#262;'</span><span class="keyword">,
<br />
&nbsp;&nbsp;&nbsp; </span><span class="string">'?'</span><span class="keyword">=&gt;</span><span class="string">'&amp;#263;'</span><span class="keyword">,
<br />
&nbsp;&nbsp;&nbsp; </span><span class="string">'?'</span><span class="keyword">=&gt;</span><span class="string">'&amp;#268;'</span><span class="keyword">,
<br />
&nbsp;&nbsp;&nbsp; </span><span class="string">'?'</span><span class="keyword">=&gt;</span><span class="string">'&amp;#269;'</span><span class="keyword">,
<br />
&nbsp;&nbsp;&nbsp; </span><span class="string">'?'</span><span class="keyword">=&gt;</span><span class="string">'&amp;#272'</span><span class="keyword">,
<br />
&nbsp;&nbsp;&nbsp; </span><span class="string">'?'</span><span class="keyword">=&gt;</span><span class="string">'&amp;#273'</span><span class="keyword">,
<br />
&nbsp;&nbsp;&nbsp; </span><span class="string">'?'</span><span class="keyword">=&gt;</span><span class="string">'&amp;#352'</span><span class="keyword">,
<br />
&nbsp;&nbsp;&nbsp; </span><span class="string">'?'</span><span class="keyword">=&gt;</span><span class="string">'&amp;#353'</span><span class="keyword">,
<br />
&nbsp;&nbsp;&nbsp; </span><span class="string">'?'</span><span class="keyword">=&gt;</span><span class="string">'&amp;#381'</span><span class="keyword">,
<br />
&nbsp;&nbsp;&nbsp; </span><span class="string">'?'</span><span class="keyword">=&gt;</span><span class="string">'&amp;#382'
<br />
</span><span class="keyword">);
<br />

<br />
echo </span><span class="default">strtr</span><span class="keyword">(</span><span class="string">'??????????'</span><span class="keyword">, </span><span class="default">$ent</span><span class="keyword">);
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="100388""></a>
  <div class="note">
   <strong class="user">php dot net at softmoon-webware dot com</strong>
   <a href="#100388" class="date">12-Oct-2010 11:32</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
<span class="default">&lt;?php <br />
$HTML_ENTS</span><span class="keyword">=array(</span><span class="string">"quot"</span><span class="keyword">, </span><span class="string">"amp"</span><span class="keyword">, </span><span class="string">"apos"</span><span class="keyword">, </span><span class="string">"lt"</span><span class="keyword">, </span><span class="string">"gt"</span><span class="keyword">, </span><span class="string">"nbsp"</span><span class="keyword">, </span><span class="string">"iexcl"</span><span class="keyword">, </span><span class="string">"cent"</span><span class="keyword">,<br />
</span><span class="string">"pound"</span><span class="keyword">,</span><span class="string">"curren"</span><span class="keyword">, </span><span class="string">"yen"</span><span class="keyword">, </span><span class="string">"brvbar"</span><span class="keyword">, </span><span class="string">"sect"</span><span class="keyword">, </span><span class="string">"uml"</span><span class="keyword">, </span><span class="string">"copy"</span><span class="keyword">, </span><span class="string">"ordf"</span><span class="keyword">, </span><span class="string">"laquo"</span><span class="keyword">,<br />
</span><span class="string">"not"</span><span class="keyword">, </span><span class="string">"shy"</span><span class="keyword">, </span><span class="string">"reg"</span><span class="keyword">, </span><span class="string">"macr"</span><span class="keyword">, </span><span class="string">"deg"</span><span class="keyword">, </span><span class="string">"plusmn"</span><span class="keyword">, </span><span class="string">"sup2"</span><span class="keyword">, </span><span class="string">"sup3"</span><span class="keyword">, </span><span class="string">"acute"</span><span class="keyword">,<br />
</span><span class="string">"micro"</span><span class="keyword">, </span><span class="string">"para"</span><span class="keyword">, </span><span class="string">"middot"</span><span class="keyword">, </span><span class="string">"cedil"</span><span class="keyword">, </span><span class="string">"sup1"</span><span class="keyword">, </span><span class="string">"ordm"</span><span class="keyword">, </span><span class="string">"raquo"</span><span class="keyword">, </span><span class="string">"frac14"</span><span class="keyword">,<br />
</span><span class="string">"frac12"</span><span class="keyword">, </span><span class="string">"frac34"</span><span class="keyword">, </span><span class="string">"iquest"</span><span class="keyword">, </span><span class="string">"Agrave"</span><span class="keyword">, </span><span class="string">"Aacute"</span><span class="keyword">, </span><span class="string">"Acirc"</span><span class="keyword">, </span><span class="string">"Atilde"</span><span class="keyword">, </span><span class="string">"Auml"</span><span class="keyword">,<br />
</span><span class="string">"Aring"</span><span class="keyword">, </span><span class="string">"AElig"</span><span class="keyword">, </span><span class="string">"Ccedil"</span><span class="keyword">, </span><span class="string">"Egrave"</span><span class="keyword">, </span><span class="string">"Eacute"</span><span class="keyword">, </span><span class="string">"Ecirc"</span><span class="keyword">, </span><span class="string">"Euml"</span><span class="keyword">, </span><span class="string">"Igrave"</span><span class="keyword">,<br />
</span><span class="string">"Iacute"</span><span class="keyword">, </span><span class="string">"Icirc"</span><span class="keyword">, </span><span class="string">"Iuml"</span><span class="keyword">, </span><span class="string">"ETH"</span><span class="keyword">, </span><span class="string">"Ntilde"</span><span class="keyword">, </span><span class="string">"Ograve"</span><span class="keyword">, </span><span class="string">"Oacute"</span><span class="keyword">, </span><span class="string">"Ocirc"</span><span class="keyword">,<br />
</span><span class="string">"Otilde"</span><span class="keyword">, </span><span class="string">"Ouml"</span><span class="keyword">, </span><span class="string">"times"</span><span class="keyword">, </span><span class="string">"Oslash"</span><span class="keyword">, </span><span class="string">"Ugrave"</span><span class="keyword">, </span><span class="string">"Uacute"</span><span class="keyword">, </span><span class="string">"Ucirc"</span><span class="keyword">, </span><span class="string">"Uuml"</span><span class="keyword">,<br />
</span><span class="string">"Yacute"</span><span class="keyword">, </span><span class="string">"THORN"</span><span class="keyword">, </span><span class="string">"szlig"</span><span class="keyword">, </span><span class="string">"agrave"</span><span class="keyword">, </span><span class="string">"aacute"</span><span class="keyword">, </span><span class="string">"acirc"</span><span class="keyword">, </span><span class="string">"atilde"</span><span class="keyword">, </span><span class="string">"auml"</span><span class="keyword">,<br />
</span><span class="string">"aring"</span><span class="keyword">, </span><span class="string">"aelig"</span><span class="keyword">, </span><span class="string">"ccedil"</span><span class="keyword">, </span><span class="string">"egrave"</span><span class="keyword">, </span><span class="string">"eacute"</span><span class="keyword">, </span><span class="string">"ecirc"</span><span class="keyword">, </span><span class="string">"euml"</span><span class="keyword">, </span><span class="string">"igrave"</span><span class="keyword">,<br />
</span><span class="string">"iacute"</span><span class="keyword">, </span><span class="string">"icirc"</span><span class="keyword">, </span><span class="string">"iuml"</span><span class="keyword">, </span><span class="string">"eth"</span><span class="keyword">, </span><span class="string">"ntilde"</span><span class="keyword">, </span><span class="string">"ograve"</span><span class="keyword">, </span><span class="string">"oacute"</span><span class="keyword">, </span><span class="string">"ocirc"</span><span class="keyword">,<br />
</span><span class="string">"otilde"</span><span class="keyword">, </span><span class="string">"ouml"</span><span class="keyword">, </span><span class="string">"divide"</span><span class="keyword">, </span><span class="string">"oslash"</span><span class="keyword">, </span><span class="string">"ugrave"</span><span class="keyword">, </span><span class="string">"uacute"</span><span class="keyword">, </span><span class="string">"ucirc"</span><span class="keyword">, </span><span class="string">"uuml"</span><span class="keyword">,<br />
</span><span class="string">"yacute"</span><span class="keyword">, </span><span class="string">"thorn"</span><span class="keyword">, </span><span class="string">"yuml"</span><span class="keyword">, </span><span class="string">"OElig"</span><span class="keyword">, </span><span class="string">"oelig"</span><span class="keyword">, </span><span class="string">"Scaron"</span><span class="keyword">, </span><span class="string">"scaron"</span><span class="keyword">, </span><span class="string">"Yuml"</span><span class="keyword">,<br />
</span><span class="string">"fnof"</span><span class="keyword">, </span><span class="string">"circ"</span><span class="keyword">, </span><span class="string">"tilde"</span><span class="keyword">, </span><span class="string">"Alpha"</span><span class="keyword">, </span><span class="string">"Beta"</span><span class="keyword">, </span><span class="string">"Gamma"</span><span class="keyword">, </span><span class="string">"Delta"</span><span class="keyword">, </span><span class="string">"Epsilon"</span><span class="keyword">,<br />
</span><span class="string">"Zeta"</span><span class="keyword">, </span><span class="string">"Eta"</span><span class="keyword">, </span><span class="string">"Theta"</span><span class="keyword">, </span><span class="string">"Iota"</span><span class="keyword">, </span><span class="string">"Kappa"</span><span class="keyword">, </span><span class="string">"Lambda"</span><span class="keyword">, </span><span class="string">"Mu"</span><span class="keyword">, </span><span class="string">"Nu"</span><span class="keyword">, </span><span class="string">"Xi"</span><span class="keyword">,<br />
</span><span class="string">"Omicron"</span><span class="keyword">, </span><span class="string">"Pi"</span><span class="keyword">, </span><span class="string">"Rho"</span><span class="keyword">, </span><span class="string">"Sigma"</span><span class="keyword">, </span><span class="string">"Tau"</span><span class="keyword">, </span><span class="string">"Upsilon"</span><span class="keyword">, </span><span class="string">"Phi"</span><span class="keyword">, </span><span class="string">"Chi"</span><span class="keyword">, </span><span class="string">"Psi"</span><span class="keyword">,<br />
</span><span class="string">"Omega"</span><span class="keyword">, </span><span class="string">"alpha"</span><span class="keyword">, </span><span class="string">"beta"</span><span class="keyword">, </span><span class="string">"gamma"</span><span class="keyword">, </span><span class="string">"delta"</span><span class="keyword">, </span><span class="string">"epsilon"</span><span class="keyword">, </span><span class="string">"zeta"</span><span class="keyword">, </span><span class="string">"eta"</span><span class="keyword">,<br />
</span><span class="string">"theta"</span><span class="keyword">, </span><span class="string">"iota"</span><span class="keyword">, </span><span class="string">"kappa"</span><span class="keyword">, </span><span class="string">"lambda"</span><span class="keyword">, </span><span class="string">"mu"</span><span class="keyword">, </span><span class="string">"nu"</span><span class="keyword">, </span><span class="string">"xi"</span><span class="keyword">, </span><span class="string">"omicron"</span><span class="keyword">, </span><span class="string">"pi"</span><span class="keyword">,<br />
</span><span class="string">"rho"</span><span class="keyword">, </span><span class="string">"sigmaf"</span><span class="keyword">, </span><span class="string">"sigma"</span><span class="keyword">, </span><span class="string">"tau"</span><span class="keyword">, </span><span class="string">"upsilon"</span><span class="keyword">, </span><span class="string">"phi"</span><span class="keyword">, </span><span class="string">"chi"</span><span class="keyword">, </span><span class="string">"psi"</span><span class="keyword">, </span><span class="string">"omega"</span><span class="keyword">,<br />
</span><span class="string">"thetasym"</span><span class="keyword">, </span><span class="string">"upsih"</span><span class="keyword">, </span><span class="string">"piv"</span><span class="keyword">, </span><span class="string">"ensp"</span><span class="keyword">, </span><span class="string">"emsp"</span><span class="keyword">, </span><span class="string">"thinsp"</span><span class="keyword">, </span><span class="string">"zwnj"</span><span class="keyword">, </span><span class="string">"zwj"</span><span class="keyword">, </span><span class="string">"lrm"</span><span class="keyword">,<br />
</span><span class="string">"rlm"</span><span class="keyword">, </span><span class="string">"ndash"</span><span class="keyword">, </span><span class="string">"mdash"</span><span class="keyword">, </span><span class="string">"lsquo"</span><span class="keyword">, </span><span class="string">"rsquo"</span><span class="keyword">, </span><span class="string">"sbquo"</span><span class="keyword">, </span><span class="string">"ldquo"</span><span class="keyword">, </span><span class="string">"rdquo"</span><span class="keyword">,<br />
</span><span class="string">"bdquo"</span><span class="keyword">, </span><span class="string">"dagger"</span><span class="keyword">, </span><span class="string">"Dagger"</span><span class="keyword">, </span><span class="string">"bull"</span><span class="keyword">, </span><span class="string">"hellip"</span><span class="keyword">, </span><span class="string">"permil"</span><span class="keyword">, </span><span class="string">"prime"</span><span class="keyword">, </span><span class="string">"Prime"</span><span class="keyword">,<br />
</span><span class="string">"lsaquo"</span><span class="keyword">, </span><span class="string">"rsaquo"</span><span class="keyword">, </span><span class="string">"oline"</span><span class="keyword">, </span><span class="string">"frasl"</span><span class="keyword">, </span><span class="string">"euro"</span><span class="keyword">, </span><span class="string">"image"</span><span class="keyword">, </span><span class="string">"weierp"</span><span class="keyword">, </span><span class="string">"real"</span><span class="keyword">,<br />
</span><span class="string">"trade"</span><span class="keyword">, </span><span class="string">"alefsym"</span><span class="keyword">, </span><span class="string">"larr"</span><span class="keyword">, </span><span class="string">"uarr"</span><span class="keyword">, </span><span class="string">"rarr"</span><span class="keyword">, </span><span class="string">"darr"</span><span class="keyword">, </span><span class="string">"harr"</span><span class="keyword">, </span><span class="string">"crarr"</span><span class="keyword">, </span><span class="string">"lArr"</span><span class="keyword">,<br />
</span><span class="string">"uArr"</span><span class="keyword">, </span><span class="string">"rArr"</span><span class="keyword">, </span><span class="string">"dArr"</span><span class="keyword">, </span><span class="string">"hArr"</span><span class="keyword">, </span><span class="string">"forall"</span><span class="keyword">, </span><span class="string">"part"</span><span class="keyword">, </span><span class="string">"exist"</span><span class="keyword">, </span><span class="string">"empty"</span><span class="keyword">, </span><span class="string">"nabla"</span><span class="keyword">,<br />
</span><span class="string">"isin"</span><span class="keyword">, </span><span class="string">"notin"</span><span class="keyword">, </span><span class="string">"ni"</span><span class="keyword">, </span><span class="string">"prod"</span><span class="keyword">, </span><span class="string">"sum"</span><span class="keyword">, </span><span class="string">"minus"</span><span class="keyword">, </span><span class="string">"lowast"</span><span class="keyword">, </span><span class="string">"radic"</span><span class="keyword">, </span><span class="string">"prop"</span><span class="keyword">,<br />
</span><span class="string">"infin"</span><span class="keyword">, </span><span class="string">"ang"</span><span class="keyword">, </span><span class="string">"and"</span><span class="keyword">, </span><span class="string">"or"</span><span class="keyword">, </span><span class="string">"cap"</span><span class="keyword">, </span><span class="string">"cup"</span><span class="keyword">, </span><span class="string">"int"</span><span class="keyword">, </span><span class="string">"there4"</span><span class="keyword">, </span><span class="string">"sim"</span><span class="keyword">, </span><span class="string">"cong"</span><span class="keyword">,<br />
</span><span class="string">"asymp"</span><span class="keyword">, </span><span class="string">"ne"</span><span class="keyword">, </span><span class="string">"equiv"</span><span class="keyword">, </span><span class="string">"le"</span><span class="keyword">, </span><span class="string">"ge"</span><span class="keyword">, </span><span class="string">"sub"</span><span class="keyword">, </span><span class="string">"sup"</span><span class="keyword">, </span><span class="string">"nsub"</span><span class="keyword">, </span><span class="string">"sube"</span><span class="keyword">, </span><span class="string">"supe"</span><span class="keyword">,<br />
</span><span class="string">"oplus"</span><span class="keyword">, </span><span class="string">"otimes"</span><span class="keyword">, </span><span class="string">"perp"</span><span class="keyword">, </span><span class="string">"sdot"</span><span class="keyword">, </span><span class="string">"lceil"</span><span class="keyword">, </span><span class="string">"rceil"</span><span class="keyword">, </span><span class="string">"lfloor"</span><span class="keyword">,<br />
</span><span class="string">"rfloor"</span><span class="keyword">, </span><span class="string">"lang"</span><span class="keyword">, </span><span class="string">"rang"</span><span class="keyword">, </span><span class="string">"loz"</span><span class="keyword">, </span><span class="string">"spades"</span><span class="keyword">, </span><span class="string">"clubs"</span><span class="keyword">, </span><span class="string">"hearts"</span><span class="keyword">, </span><span class="string">"diams"</span><span class="keyword">);<br />
<br />
</span><span class="comment">// The selection of tags below is optimized for use with a webmaster's database,<br />
// --NOT-- to process user POSTs from the World Wide Web<br />
//&nbsp; for inclusion on a public page.<br />
<br />
//&nbsp; NOT included:<br />
//&nbsp;&nbsp; form,&nbsp; input,&nbsp; select,&nbsp; option,&nbsp; label,&nbsp; optgroup,&nbsp; textarea,&nbsp; area,&nbsp; map,<br />
//&nbsp;&nbsp; html,&nbsp; head,&nbsp; style,&nbsp; link,&nbsp; meta,&nbsp; base,&nbsp; body,&nbsp; isindex,<br />
//&nbsp;&nbsp; frame,&nbsp; frameset,&nbsp; noframes<br />
//&nbsp; (include those above at your wish,&nbsp; remove those below at your wish)<br />
</span><span class="default">$HTML_TAGS</span><span class="keyword">=array(</span><span class="string">"a"</span><span class="keyword">, </span><span class="string">"abbr"</span><span class="keyword">, </span><span class="string">"acronym"</span><span class="keyword">, </span><span class="string">"address"</span><span class="keyword">, </span><span class="string">"applet"</span><span class="keyword">, </span><span class="string">"b"</span><span class="keyword">, </span><span class="string">"basefont"</span><span class="keyword">,<br />
</span><span class="string">"bdo"</span><span class="keyword">, </span><span class="string">"big"</span><span class="keyword">, </span><span class="string">"blockquote"</span><span class="keyword">, </span><span class="string">"br"</span><span class="keyword">, </span><span class="string">"button"</span><span class="keyword">, </span><span class="string">"caption"</span><span class="keyword">, </span><span class="string">"center"</span><span class="keyword">, </span><span class="string">"cite"</span><span class="keyword">,<br />
</span><span class="string">"code"</span><span class="keyword">, </span><span class="string">"col"</span><span class="keyword">, </span><span class="string">"colgroup"</span><span class="keyword">, </span><span class="string">"dd"</span><span class="keyword">, </span><span class="string">"del"</span><span class="keyword">, </span><span class="string">"dfn"</span><span class="keyword">, </span><span class="string">"dir"</span><span class="keyword">, </span><span class="string">"div"</span><span class="keyword">, </span><span class="string">"dl"</span><span class="keyword">, </span><span class="string">"dt"</span><span class="keyword">, </span><span class="string">"em"</span><span class="keyword">,<br />
</span><span class="string">"embed"</span><span class="keyword">, </span><span class="string">"fieldset"</span><span class="keyword">, </span><span class="string">"font"</span><span class="keyword">, </span><span class="string">"h1"</span><span class="keyword">, </span><span class="string">"h2"</span><span class="keyword">, </span><span class="string">"h3"</span><span class="keyword">, </span><span class="string">"h4"</span><span class="keyword">, </span><span class="string">"h5"</span><span class="keyword">, </span><span class="string">"h6"</span><span class="keyword">, </span><span class="string">"hr"</span><span class="keyword">, </span><span class="string">"i"</span><span class="keyword">,<br />
</span><span class="string">"iframe"</span><span class="keyword">, </span><span class="string">"img"</span><span class="keyword">, </span><span class="string">"ins"</span><span class="keyword">, </span><span class="string">"kbd"</span><span class="keyword">, </span><span class="string">"legend"</span><span class="keyword">, </span><span class="string">"li"</span><span class="keyword">, </span><span class="string">"menu"</span><span class="keyword">, </span><span class="string">"noembed"</span><span class="keyword">, </span><span class="string">"noscript"</span><span class="keyword">,<br />
</span><span class="string">"object"</span><span class="keyword">, </span><span class="string">"ol"</span><span class="keyword">, </span><span class="string">"p"</span><span class="keyword">, </span><span class="string">"param"</span><span class="keyword">, </span><span class="string">"pre"</span><span class="keyword">, </span><span class="string">"q"</span><span class="keyword">, </span><span class="string">"s"</span><span class="keyword">, </span><span class="string">"samp"</span><span class="keyword">, </span><span class="string">"script"</span><span class="keyword">, </span><span class="string">"small"</span><span class="keyword">,<br />
</span><span class="string">"span"</span><span class="keyword">, </span><span class="string">"strike"</span><span class="keyword">, </span><span class="string">"strong"</span><span class="keyword">, </span><span class="string">"sub"</span><span class="keyword">, </span><span class="string">"sup"</span><span class="keyword">, </span><span class="string">"table"</span><span class="keyword">, </span><span class="string">"tbody"</span><span class="keyword">, </span><span class="string">"td"</span><span class="keyword">, </span><span class="string">"tfoot"</span><span class="keyword">,<br />
</span><span class="string">"th"</span><span class="keyword">, </span><span class="string">"thead"</span><span class="keyword">, </span><span class="string">"title"</span><span class="keyword">, </span><span class="string">"tr"</span><span class="keyword">, </span><span class="string">"tt"</span><span class="keyword">, </span><span class="string">"u"</span><span class="keyword">, </span><span class="string">"ul"</span><span class="keyword">, </span><span class="string">"var"</span><span class="keyword">);<br />
<br />
</span><span class="default">$Xchars </span><span class="keyword">= array(<br />
&nbsp;</span><span class="default">128 </span><span class="keyword">=&gt; </span><span class="string">'&amp;#8364;'</span><span class="keyword">,<br />
&nbsp;</span><span class="default">130 </span><span class="keyword">=&gt; </span><span class="string">'&amp;#8218;'</span><span class="keyword">,<br />
&nbsp;</span><span class="default">131 </span><span class="keyword">=&gt; </span><span class="string">'&amp;#402;'</span><span class="keyword">,<br />
&nbsp;</span><span class="default">132 </span><span class="keyword">=&gt; </span><span class="string">'&amp;#8222;'</span><span class="keyword">,<br />
&nbsp;</span><span class="default">133 </span><span class="keyword">=&gt; </span><span class="string">'&amp;#8230;'</span><span class="keyword">,<br />
&nbsp;</span><span class="default">134 </span><span class="keyword">=&gt; </span><span class="string">'&amp;#8224;'</span><span class="keyword">,<br />
&nbsp;</span><span class="default">135 </span><span class="keyword">=&gt; </span><span class="string">'&amp;#8225;'</span><span class="keyword">,<br />
&nbsp;</span><span class="default">136 </span><span class="keyword">=&gt; </span><span class="string">'&amp;#710;'</span><span class="keyword">,<br />
&nbsp;</span><span class="default">137 </span><span class="keyword">=&gt; </span><span class="string">'&amp;#8240;'</span><span class="keyword">,<br />
&nbsp;</span><span class="default">138 </span><span class="keyword">=&gt; </span><span class="string">'&amp;#352;'</span><span class="keyword">,<br />
&nbsp;</span><span class="default">139 </span><span class="keyword">=&gt; </span><span class="string">'&amp;#8249;'</span><span class="keyword">,<br />
&nbsp;</span><span class="default">140 </span><span class="keyword">=&gt; </span><span class="string">'&amp;#338;'</span><span class="keyword">,<br />
&nbsp;</span><span class="default">142 </span><span class="keyword">=&gt; </span><span class="string">'&amp;#381;'</span><span class="keyword">,<br />
&nbsp;</span><span class="default">145 </span><span class="keyword">=&gt; </span><span class="string">'&amp;#8216;'</span><span class="keyword">,<br />
&nbsp;</span><span class="default">146 </span><span class="keyword">=&gt; </span><span class="string">'&amp;#8217;'</span><span class="keyword">,<br />
&nbsp;</span><span class="default">147 </span><span class="keyword">=&gt; </span><span class="string">'&amp;#8220;'</span><span class="keyword">,<br />
&nbsp;</span><span class="default">148 </span><span class="keyword">=&gt; </span><span class="string">'&amp;#8221;'</span><span class="keyword">,<br />
&nbsp;</span><span class="default">149 </span><span class="keyword">=&gt; </span><span class="string">'&amp;#8226;'</span><span class="keyword">,<br />
&nbsp;</span><span class="default">150 </span><span class="keyword">=&gt; </span><span class="string">'&amp;#8211;'</span><span class="keyword">,<br />
&nbsp;</span><span class="default">151 </span><span class="keyword">=&gt; </span><span class="string">'&amp;#8212;'</span><span class="keyword">,<br />
&nbsp;</span><span class="default">152 </span><span class="keyword">=&gt; </span><span class="string">'&amp;#732;'</span><span class="keyword">,<br />
&nbsp;</span><span class="default">153 </span><span class="keyword">=&gt; </span><span class="string">'&amp;#8482;'</span><span class="keyword">,<br />
&nbsp;</span><span class="default">154 </span><span class="keyword">=&gt; </span><span class="string">'&amp;#353;'</span><span class="keyword">,<br />
&nbsp;</span><span class="default">155 </span><span class="keyword">=&gt; </span><span class="string">'&amp;#8250;'</span><span class="keyword">,<br />
&nbsp;</span><span class="default">156 </span><span class="keyword">=&gt; </span><span class="string">'&amp;#339;'</span><span class="keyword">,<br />
&nbsp;</span><span class="default">158 </span><span class="keyword">=&gt; </span><span class="string">'&amp;#382;'</span><span class="keyword">,<br />
&nbsp;</span><span class="default">159 </span><span class="keyword">=&gt; </span><span class="string">'&amp;#376;'</span><span class="keyword">);<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="100186""></a>
  <div class="note">
   <strong class="user">drallen at cs dot uwaterloo dot ca</strong>
   <a href="#100186" class="date">30-Sep-2010 01:11</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
A pointer to <a href="http://www.php.net/manual/en/function.mb-convert-encoding.php if your intention is to translate *all* characters in a charset to their corresponding HTML entities, not just named characters. Non-named characters will be replaced with HTML numeric encoding. eg:" rel="nofollow" target="_blank">http://www.php.net/manual/en/function.mb-convert-encoding.php if your intention is to translate *all* characters in a charset to their corresponding HTML entities, not just named characters. Non-named characters will be replaced with HTML numeric encoding. eg:</a><br />
<br />
$text = mb_convert_encoding($text, 'HTML-ENTITIES', "UTF-8");</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="99984""></a>
  <div class="note">
   <strong class="user">h_guillaume at hotmail dot com</strong>
   <a href="#99984" class="date">17-Sep-2010 10:14</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I use this function to encode all the xml entities and also all the &amp;something; that are not defined in xml like &amp;trade;<br />
You can also decode what you encode with my decode function.<br />
My function works a little like the htmlentities.<br />
You can also add other string to the array if you want to exclude them from the encoding.<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">function </span><span class="default">xml_entity_decode</span><span class="keyword">(</span><span class="default">$text</span><span class="keyword">, </span><span class="default">$charset </span><span class="keyword">= </span><span class="string">'Windows-1252'</span><span class="keyword">){<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">// Double decode, so if the value was &amp;amp;trade; it will become Trademark<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$text </span><span class="keyword">= </span><span class="default">html_entity_decode</span><span class="keyword">(</span><span class="default">$text</span><span class="keyword">, </span><span class="default">ENT_COMPAT</span><span class="keyword">, </span><span class="default">$charset</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$text </span><span class="keyword">= </span><span class="default">html_entity_decode</span><span class="keyword">(</span><span class="default">$text</span><span class="keyword">, </span><span class="default">ENT_COMPAT</span><span class="keyword">, </span><span class="default">$charset</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; return </span><span class="default">$text</span><span class="keyword">;<br />
}<br />
<br />
function </span><span class="default">xml_entities</span><span class="keyword">(</span><span class="default">$text</span><span class="keyword">, </span><span class="default">$charset </span><span class="keyword">= </span><span class="string">'Windows-1252'</span><span class="keyword">){<br />
&nbsp;&nbsp; &nbsp; </span><span class="comment">// Debug and Test<br />
&nbsp;&nbsp;&nbsp; // $text = "test &amp;amp; &amp;trade; &amp;amp;trade; abc &amp;reg; &amp;amp;reg; &amp;#45;";<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; // First we encode html characters that are also invalid in xml<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$text </span><span class="keyword">= </span><span class="default">htmlentities</span><span class="keyword">(</span><span class="default">$text</span><span class="keyword">, </span><span class="default">ENT_COMPAT</span><span class="keyword">, </span><span class="default">$charset</span><span class="keyword">, </span><span class="default">false</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">// XML character entity array from Wiki<br />
&nbsp;&nbsp;&nbsp; // Note: &amp;apos; is useless in UTF-8 or in UTF-16<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$arr_xml_special_char </span><span class="keyword">= array(</span><span class="string">"&amp;quot;"</span><span class="keyword">,</span><span class="string">"&amp;amp;"</span><span class="keyword">,</span><span class="string">"&amp;apos;"</span><span class="keyword">,</span><span class="string">"&amp;lt;"</span><span class="keyword">,</span><span class="string">"&amp;gt;"</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">// Building the regex string to exclude all strings with xml special char<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$arr_xml_special_char_regex </span><span class="keyword">= </span><span class="string">"(?"</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; foreach(</span><span class="default">$arr_xml_special_char </span><span class="keyword">as </span><span class="default">$key </span><span class="keyword">=&gt; </span><span class="default">$value</span><span class="keyword">){<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$arr_xml_special_char_regex </span><span class="keyword">.= </span><span class="string">"(?!</span><span class="default">$value</span><span class="string">)"</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$arr_xml_special_char_regex </span><span class="keyword">.= </span><span class="string">")"</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">// Scan the array for &amp;something_not_xml; syntax<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$pattern </span><span class="keyword">= </span><span class="string">"/</span><span class="default">$arr_xml_special_char_regex</span><span class="string">&amp;([a-zA-Z0-9]+;)/"</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">// Replace the &amp;something_not_xml; with &amp;amp;something_not_xml;<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$replacement </span><span class="keyword">= </span><span class="string">'&amp;amp;${1}'</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; return </span><span class="default">preg_replace</span><span class="keyword">(</span><span class="default">$pattern</span><span class="keyword">, </span><span class="default">$replacement</span><span class="keyword">, </span><span class="default">$text</span><span class="keyword">);<br />
}<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="99896""></a>
  <div class="note">
   <strong class="user">Sijmen Ruwhof</strong>
   <a href="#99896" class="date">13-Sep-2010 09:18</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
An important note below about using this function to secure your application against Cross Site Scripting (XSS) vulnerabilities.<br />
<br />
When printing user input in an attribute of an HTML tag, the default configuration of htmlEntities() doesn't protect you against XSS, when using single quotes to define the border of the tag's attribute-value. XSS is then possible by injecting a single quote:<br />
<br />
<span class="default">&lt;?php<br />
$_GET</span><span class="keyword">[</span><span class="string">'a'</span><span class="keyword">] = </span><span class="string">"#000' onload='alert(document.cookie)"</span><span class="keyword">;<br />
</span><span class="default">?&gt;<br />
</span><br />
XSS possible (insecure):<br />
<br />
<span class="default">&lt;?php<br />
$href </span><span class="keyword">= </span><span class="default">htmlEntities</span><span class="keyword">(</span><span class="default">$_GET</span><span class="keyword">[</span><span class="string">'a'</span><span class="keyword">]);<br />
print </span><span class="string">"&lt;body bgcolor='</span><span class="default">$href</span><span class="string">'&gt;"</span><span class="keyword">; </span><span class="comment"># results in: &lt;body bgcolor='#000' onload='alert(document.cookie)'&gt;<br />
</span><span class="default">?&gt;<br />
</span><br />
Use the 'ENT_QUOTES' quote style option, to ensure no XSS is possible and your application is secure:<br />
<br />
<span class="default">&lt;?php<br />
$href </span><span class="keyword">= </span><span class="default">htmlEntities</span><span class="keyword">(</span><span class="default">$_GET</span><span class="keyword">[</span><span class="string">'a'</span><span class="keyword">], </span><span class="default">ENT_QUOTES</span><span class="keyword">);<br />
print </span><span class="string">"&lt;body bgcolor='</span><span class="default">$href</span><span class="string">'&gt;"</span><span class="keyword">; </span><span class="comment"># results in: &lt;body bgcolor='#000&amp;#039; onload=&amp;#039;alert(document.cookie)'&gt;<br />
</span><span class="default">?&gt;<br />
</span><br />
The 'ENT_QUOTES' option doesn't protect you against javascript evaluation in certain tag's attributes, like the 'href' attribute of the 'a' tag. When clicked on the link below, the given JavaScript will get executed:<br />
<br />
<span class="default">&lt;?php<br />
$_GET</span><span class="keyword">[</span><span class="string">'a'</span><span class="keyword">] = </span><span class="string">'javascript:alert(document.cookie)'</span><span class="keyword">;<br />
</span><span class="default">$href </span><span class="keyword">= </span><span class="default">htmlEntities</span><span class="keyword">(</span><span class="default">$_GET</span><span class="keyword">[</span><span class="string">'a'</span><span class="keyword">], </span><span class="default">ENT_QUOTES</span><span class="keyword">);<br />
print </span><span class="string">"&lt;a href='</span><span class="default">$href</span><span class="string">'&gt;link&lt;/a&gt;"</span><span class="keyword">; </span><span class="comment"># results in: &lt;a href='javascript:alert(document.cookie)'&gt;link&lt;/a&gt;<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="97891""></a>
  <div class="note">
   <strong class="user">Wired</strong>
   <a href="#97891" class="date">14-May-2010 02:22</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I needed a simple little function to take a string and convert extended ascii characters into html entities. I couldn't find a function for this so I whipped one up.<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="comment">/* Convert Extended ASCII Characters to HTML Entities */<br />
</span><span class="keyword">function </span><span class="default">ascii2entities</span><span class="keyword">(</span><span class="default">$string</span><span class="keyword">){<br />
&nbsp;&nbsp;&nbsp; for(</span><span class="default">$i</span><span class="keyword">=</span><span class="default">128</span><span class="keyword">;</span><span class="default">$i</span><span class="keyword">&lt;=</span><span class="default">255</span><span class="keyword">;</span><span class="default">$i</span><span class="keyword">++){<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$entity </span><span class="keyword">= </span><span class="default">htmlentities</span><span class="keyword">(</span><span class="default">chr</span><span class="keyword">(</span><span class="default">$i</span><span class="keyword">), </span><span class="default">ENT_QUOTES</span><span class="keyword">, </span><span class="string">'cp1252'</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$temp </span><span class="keyword">= </span><span class="default">substr</span><span class="keyword">(</span><span class="default">$entity</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">1</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$temp </span><span class="keyword">.= </span><span class="default">substr</span><span class="keyword">(</span><span class="default">$entity</span><span class="keyword">, -</span><span class="default">1</span><span class="keyword">, </span><span class="default">1</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">$temp </span><span class="keyword">!= </span><span class="string">'&amp;;'</span><span class="keyword">){<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$string </span><span class="keyword">= </span><span class="default">str_replace</span><span class="keyword">(</span><span class="default">chr</span><span class="keyword">(</span><span class="default">$i</span><span class="keyword">), </span><span class="string">''</span><span class="keyword">, </span><span class="default">$string</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; else{<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$string </span><span class="keyword">= </span><span class="default">str_replace</span><span class="keyword">(</span><span class="default">chr</span><span class="keyword">(</span><span class="default">$i</span><span class="keyword">), </span><span class="default">$entity</span><span class="keyword">, </span><span class="default">$string</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; return </span><span class="default">$string</span><span class="keyword">;<br />
}<br />
<br />
echo </span><span class="default">ascii2entities</span><span class="keyword">(</span><span class="string">"?"</span><span class="keyword">);<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="97215""></a>
  <div class="note">
   <strong class="user">phil at lavin dot me dot uk</strong>
   <a href="#97215" class="date">08-Apr-2010 05:34</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
The following will make a string completely safe for XML:<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">function </span><span class="default">philsXMLClean</span><span class="keyword">(</span><span class="default">$strin</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$strout </span><span class="keyword">= </span><span class="default">null</span><span class="keyword">;<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; for (</span><span class="default">$i </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">; </span><span class="default">$i </span><span class="keyword">&lt; </span><span class="default">strlen</span><span class="keyword">(</span><span class="default">$strin</span><span class="keyword">); </span><span class="default">$i</span><span class="keyword">++) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$ord </span><span class="keyword">= </span><span class="default">ord</span><span class="keyword">(</span><span class="default">$strin</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">]);<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if ((</span><span class="default">$ord </span><span class="keyword">&gt; </span><span class="default">0 </span><span class="keyword">&amp;&amp; </span><span class="default">$ord </span><span class="keyword">&lt; </span><span class="default">32</span><span class="keyword">) || (</span><span class="default">$ord </span><span class="keyword">&gt;= </span><span class="default">127</span><span class="keyword">)) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$strout </span><span class="keyword">.= </span><span class="string">"&amp;amp;#</span><span class="keyword">{</span><span class="default">$ord</span><span class="keyword">}</span><span class="string">;"</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; else {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; switch (</span><span class="default">$strin</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">]) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; case </span><span class="string">'&lt;'</span><span class="keyword">:<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$strout </span><span class="keyword">.= </span><span class="string">'&amp;lt;'</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; break;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; case </span><span class="string">'&gt;'</span><span class="keyword">:<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$strout </span><span class="keyword">.= </span><span class="string">'&amp;gt;'</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; break;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; case </span><span class="string">'&amp;'</span><span class="keyword">:<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$strout </span><span class="keyword">.= </span><span class="string">'&amp;amp;'</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; break;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; case </span><span class="string">'"'</span><span class="keyword">:<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$strout </span><span class="keyword">.= </span><span class="string">'&amp;quot;'</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; break;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; default:<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$strout </span><span class="keyword">.= </span><span class="default">$strin</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">];<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">$strout</span><span class="keyword">;<br />
}<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="93892""></a>
  <div class="note">
   <strong class="user">sirarthur at sirarthur dot info</strong>
   <a href="#93892" class="date">05-Oct-2009 10:05</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
When happens that you want to encode special characters but not the HTML tags using this function you've two options:<br />
<br />
a) Build your own function and go replace by character; eg.<br />
<br />
<span class="default">&lt;?php<br />
&nbsp; </span><span class="keyword">for(</span><span class="default">$i </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">; </span><span class="default">$i </span><span class="keyword">&lt; </span><span class="default">strlen</span><span class="keyword">(</span><span class="default">$string</span><span class="keyword">); </span><span class="default">$i</span><span class="keyword">++){<br />
&nbsp;&nbsp; &nbsp; switch(</span><span class="default">substr</span><span class="keyword">(</span><span class="default">$string</span><span class="keyword">,</span><span class="default">$i</span><span class="keyword">,</span><span class="default">1</span><span class="keyword">)){<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">//..... A VERY HUGE switch here with all characters to encode.<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">}<br />
&nbsp;}<br />
</span><span class="default">?&gt;<br />
</span><br />
b) use this function and simple restore the html tags afterwards. Which gives you a 6 line function as follow:<br />
<br />
<span class="default">&lt;?php<br />
&nbsp; </span><span class="keyword">function </span><span class="default">keephtml</span><span class="keyword">(</span><span class="default">$string</span><span class="keyword">){<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$res </span><span class="keyword">= </span><span class="default">htmlentities</span><span class="keyword">(</span><span class="default">$string</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$res </span><span class="keyword">= </span><span class="default">str_replace</span><span class="keyword">(</span><span class="string">"&amp;lt;"</span><span class="keyword">,</span><span class="string">"&lt;"</span><span class="keyword">,</span><span class="default">$res</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$res </span><span class="keyword">= </span><span class="default">str_replace</span><span class="keyword">(</span><span class="string">"&amp;gt;"</span><span class="keyword">,</span><span class="string">"&gt;"</span><span class="keyword">,</span><span class="default">$res</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$res </span><span class="keyword">= </span><span class="default">str_replace</span><span class="keyword">(</span><span class="string">"&amp;quot;"</span><span class="keyword">,</span><span class="string">'"'</span><span class="keyword">,</span><span class="default">$res</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$res </span><span class="keyword">= </span><span class="default">str_replace</span><span class="keyword">(</span><span class="string">"&amp;amp;"</span><span class="keyword">,</span><span class="string">'&amp;'</span><span class="keyword">,</span><span class="default">$res</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">$res</span><span class="keyword">;<br />
}<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="92105""></a>
  <div class="note">
   <strong class="user">montana</strong>
   <a href="#92105" class="date">09-Jul-2009 06:54</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
under what circumstances would someone want a ntilde [n] to be converted into "A±" as htmlentities does?<br />
the correct method of translation should return the accurate NCR for the multibyte unicode sequence <br />
which in this case is &amp;#241;<br />
<br />
<span class="default">&lt;?php<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">//simple task: convert everything from utf-8 into an NCR[numeric character reference]<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">class </span><span class="default">unicode_replace_entities </span><span class="keyword">{<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; public function </span><span class="default">UTF8entities</span><span class="keyword">(</span><span class="default">$content</span><span class="keyword">=</span><span class="string">""</span><span class="keyword">) { <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$contents </span><span class="keyword">= </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">unicode_string_to_array</span><span class="keyword">(</span><span class="default">$content</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$swap </span><span class="keyword">= </span><span class="string">""</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$iCount </span><span class="keyword">= </span><span class="default">count</span><span class="keyword">(</span><span class="default">$contents</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; for (</span><span class="default">$o</span><span class="keyword">=</span><span class="default">0</span><span class="keyword">;</span><span class="default">$o</span><span class="keyword">&lt;</span><span class="default">$iCount</span><span class="keyword">;</span><span class="default">$o</span><span class="keyword">++) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$contents</span><span class="keyword">[</span><span class="default">$o</span><span class="keyword">] = </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">unicode_entity_replace</span><span class="keyword">(</span><span class="default">$contents</span><span class="keyword">[</span><span class="default">$o</span><span class="keyword">]);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$swap </span><span class="keyword">.= </span><span class="default">$contents</span><span class="keyword">[</span><span class="default">$o</span><span class="keyword">];<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">mb_convert_encoding</span><span class="keyword">(</span><span class="default">$swap</span><span class="keyword">,</span><span class="string">"UTF-8"</span><span class="keyword">); </span><span class="comment">//not really necessary, but why not.<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">}<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; public function </span><span class="default">unicode_string_to_array</span><span class="keyword">( </span><span class="default">$string </span><span class="keyword">) { </span><span class="comment">//adjwilli<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$strlen </span><span class="keyword">= </span><span class="default">mb_strlen</span><span class="keyword">(</span><span class="default">$string</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; while (</span><span class="default">$strlen</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$array</span><span class="keyword">[] = </span><span class="default">mb_substr</span><span class="keyword">( </span><span class="default">$string</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">1</span><span class="keyword">, </span><span class="string">"UTF-8" </span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$string </span><span class="keyword">= </span><span class="default">mb_substr</span><span class="keyword">( </span><span class="default">$string</span><span class="keyword">, </span><span class="default">1</span><span class="keyword">, </span><span class="default">$strlen</span><span class="keyword">, </span><span class="string">"UTF-8" </span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$strlen </span><span class="keyword">= </span><span class="default">mb_strlen</span><span class="keyword">( </span><span class="default">$string </span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">$array</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; public function </span><span class="default">unicode_entity_replace</span><span class="keyword">(</span><span class="default">$c</span><span class="keyword">) { </span><span class="comment">//m. perez <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$h </span><span class="keyword">= </span><span class="default">ord</span><span class="keyword">(</span><span class="default">$c</span><span class="keyword">{</span><span class="default">0</span><span class="keyword">});&nbsp; &nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">$h </span><span class="keyword">&lt;= </span><span class="default">0x7F</span><span class="keyword">) { <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">$c</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; } else if (</span><span class="default">$h </span><span class="keyword">&lt; </span><span class="default">0xC2</span><span class="keyword">) { <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">$c</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">$h </span><span class="keyword">&lt;= </span><span class="default">0xDF</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$h </span><span class="keyword">= (</span><span class="default">$h </span><span class="keyword">&amp; </span><span class="default">0x1F</span><span class="keyword">) &lt;&lt; </span><span class="default">6 </span><span class="keyword">| (</span><span class="default">ord</span><span class="keyword">(</span><span class="default">$c</span><span class="keyword">{</span><span class="default">1</span><span class="keyword">}) &amp; </span><span class="default">0x3F</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$h </span><span class="keyword">= </span><span class="string">"&amp;#" </span><span class="keyword">. </span><span class="default">$h </span><span class="keyword">. </span><span class="string">";"</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">$h</span><span class="keyword">; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; } else if (</span><span class="default">$h </span><span class="keyword">&lt;= </span><span class="default">0xEF</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$h </span><span class="keyword">= (</span><span class="default">$h </span><span class="keyword">&amp; </span><span class="default">0x0F</span><span class="keyword">) &lt;&lt; </span><span class="default">12 </span><span class="keyword">| (</span><span class="default">ord</span><span class="keyword">(</span><span class="default">$c</span><span class="keyword">{</span><span class="default">1</span><span class="keyword">}) &amp; </span><span class="default">0x3F</span><span class="keyword">) &lt;&lt; </span><span class="default">6 </span><span class="keyword">| (</span><span class="default">ord</span><span class="keyword">(</span><span class="default">$c</span><span class="keyword">{</span><span class="default">2</span><span class="keyword">}) &amp; </span><span class="default">0x3F</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$h </span><span class="keyword">= </span><span class="string">"&amp;#" </span><span class="keyword">. </span><span class="default">$h </span><span class="keyword">. </span><span class="string">";"</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">$h</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; } else if (</span><span class="default">$h </span><span class="keyword">&lt;= </span><span class="default">0xF4</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$h </span><span class="keyword">= (</span><span class="default">$h </span><span class="keyword">&amp; </span><span class="default">0x0F</span><span class="keyword">) &lt;&lt; </span><span class="default">18 </span><span class="keyword">| (</span><span class="default">ord</span><span class="keyword">(</span><span class="default">$c</span><span class="keyword">{</span><span class="default">1</span><span class="keyword">}) &amp; </span><span class="default">0x3F</span><span class="keyword">) &lt;&lt; </span><span class="default">12 </span><span class="keyword">| (</span><span class="default">ord</span><span class="keyword">(</span><span class="default">$c</span><span class="keyword">{</span><span class="default">2</span><span class="keyword">}) &amp; </span><span class="default">0x3F</span><span class="keyword">) &lt;&lt; </span><span class="default">6 </span><span class="keyword">| (</span><span class="default">ord</span><span class="keyword">(</span><span class="default">$c</span><span class="keyword">{</span><span class="default">3</span><span class="keyword">}) &amp; </span><span class="default">0x3F</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$h </span><span class="keyword">= </span><span class="string">"&amp;#" </span><span class="keyword">. </span><span class="default">$h </span><span class="keyword">. </span><span class="string">";"</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">$h</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; }</span><span class="comment">//<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; //utf-8 environment&nbsp; &nbsp; <br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$content </span><span class="keyword">= </span><span class="string">"&lt;strong&gt;bano bano bano&lt;/strong&gt;日本語 = nihongo da ze.&lt;br /&gt;"</span><span class="keyword">;<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$oUnicodeReplace </span><span class="keyword">= new </span><span class="default">unicode_replace_entities</span><span class="keyword">();<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$content </span><span class="keyword">= </span><span class="default">$oUnicodeReplace</span><span class="keyword">-&gt;</span><span class="default">UTF8entities</span><span class="keyword">(</span><span class="default">$content</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; echo </span><span class="string">"&lt;br /&gt;Result:&lt;br /&gt;"</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; echo </span><span class="default">$content</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$source </span><span class="keyword">= </span><span class="default">htmlentities</span><span class="keyword">(</span><span class="default">$content</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; echo </span><span class="string">"&lt;br /&gt;htmlentities of resulting data:&lt;br /&gt;"</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; echo </span><span class="default">$source</span><span class="keyword">;<br />
<br />
&nbsp;&nbsp;&nbsp; echo </span><span class="string">"&lt;br /&gt;&lt;br /&gt;Note: Entities get replaced with 'literals' in textarea FF3&lt;br /&gt;&lt;br /&gt;"</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; echo </span><span class="string">"&lt;textarea style='width:300px;height:150px;'&gt;"</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; echo </span><span class="default">$content</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; echo </span><span class="string">"&lt;/textarea&gt;"</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; echo </span><span class="string">"&lt;br /&gt;&lt;br /&gt;For editing NCR's rather than 'literals' in a textarea&lt;br /&gt;&lt;br /&gt;"</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; echo </span><span class="string">"&lt;textarea style='width:300px;height:150px;'&gt;"</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; echo </span><span class="default">preg_replace</span><span class="keyword">(</span><span class="string">"/(&amp;#)+/"</span><span class="keyword">,</span><span class="string">"&amp;amp;#"</span><span class="keyword">,</span><span class="default">$content</span><span class="keyword">);&nbsp; <br />
&nbsp;&nbsp;&nbsp; echo </span><span class="string">"&lt;/textarea&gt;"</span><span class="keyword">;<br />
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="92104""></a>
  <div class="note">
   <strong class="user">brianhamner at yahoo dot com</strong>
   <a href="#92104" class="date">09-Jul-2009 06:26</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If you want something simple that actually works, try this. Strips MS word and other entities and returns a clear data string:
<br />

<br />
<span class="default">&lt;?php
<br />
</span><span class="comment">//call this function
<br />

<br />
</span><span class="keyword">function </span><span class="default">DoHTMLEntities </span><span class="keyword">(</span><span class="default">$string</span><span class="keyword">) {
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$trans_tbl</span><span class="keyword">[</span><span class="default">chr</span><span class="keyword">(</span><span class="default">145</span><span class="keyword">)] = </span><span class="string">'&amp;#8216;'</span><span class="keyword">;
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$trans_tbl</span><span class="keyword">[</span><span class="default">chr</span><span class="keyword">(</span><span class="default">146</span><span class="keyword">)] = </span><span class="string">'&amp;#8217;'</span><span class="keyword">;
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$trans_tbl</span><span class="keyword">[</span><span class="default">chr</span><span class="keyword">(</span><span class="default">147</span><span class="keyword">)] = </span><span class="string">'&amp;#8220;'</span><span class="keyword">;
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$trans_tbl</span><span class="keyword">[</span><span class="default">chr</span><span class="keyword">(</span><span class="default">148</span><span class="keyword">)] = </span><span class="string">'&amp;#8221;'</span><span class="keyword">;
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$trans_tbl</span><span class="keyword">[</span><span class="default">chr</span><span class="keyword">(</span><span class="default">142</span><span class="keyword">)] = </span><span class="string">'&amp;eacute;'</span><span class="keyword">;
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$trans_tbl</span><span class="keyword">[</span><span class="default">chr</span><span class="keyword">(</span><span class="default">150</span><span class="keyword">)] = </span><span class="string">'&amp;#8211;'</span><span class="keyword">;
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$trans_tbl</span><span class="keyword">[</span><span class="default">chr</span><span class="keyword">(</span><span class="default">151</span><span class="keyword">)] = </span><span class="string">'&amp;#8212;'</span><span class="keyword">;
<br />
&nbsp;&nbsp;&nbsp; return </span><span class="default">strtr </span><span class="keyword">(</span><span class="default">$string</span><span class="keyword">, </span><span class="default">$trans_tbl</span><span class="keyword">);
<br />
}
<br />

<br />
</span><span class="comment">//insert your string variable here
<br />

<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$foo </span><span class="keyword">= </span><span class="default">str_replace</span><span class="keyword">(</span><span class="string">"\r\n\r\n"</span><span class="keyword">,</span><span class="string">""</span><span class="keyword">,</span><span class="default">htmlentities</span><span class="keyword">(</span><span class="default">$your_string</span><span class="keyword">));
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$foo2 </span><span class="keyword">= </span><span class="default">str_replace</span><span class="keyword">(</span><span class="string">"\r\n"</span><span class="keyword">,</span><span class="string">" "</span><span class="keyword">,</span><span class="default">$foo</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$foo3 </span><span class="keyword">= </span><span class="default">str_replace</span><span class="keyword">(</span><span class="string">" &amp; "</span><span class="keyword">,</span><span class="string">"&amp;amp;"</span><span class="keyword">,</span><span class="default">$foo2</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; echo </span><span class="default">DoHTMLEntities </span><span class="keyword">(</span><span class="default">$foo3</span><span class="keyword">);
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="90893""></a>
  <div class="note">
   <strong class="user">mzvarik at gmail dot com</strong>
   <a href="#90893" class="date">15-May-2009 02:03</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
CZECH entities:
<br />

<br />
<span class="default">&lt;?php
<br />
$ent </span><span class="keyword">= array(
<br />
&nbsp;&nbsp;&nbsp; </span><span class="string">'?' </span><span class="keyword">=&gt; </span><span class="string">'&amp;#283;'</span><span class="keyword">,
<br />
&nbsp;&nbsp;&nbsp; </span><span class="string">'?' </span><span class="keyword">=&gt; </span><span class="string">'&amp;#282;'</span><span class="keyword">,
<br />
&nbsp;&nbsp;&nbsp; </span><span class="string">'?' </span><span class="keyword">=&gt; </span><span class="string">'&amp;#353;'</span><span class="keyword">,
<br />
&nbsp;&nbsp;&nbsp; </span><span class="string">'?' </span><span class="keyword">=&gt; </span><span class="string">'&amp;#352;'</span><span class="keyword">,
<br />
&nbsp;&nbsp;&nbsp; </span><span class="string">'?' </span><span class="keyword">=&gt; </span><span class="string">'&amp;#269;'</span><span class="keyword">,
<br />
&nbsp;&nbsp;&nbsp; </span><span class="string">'?' </span><span class="keyword">=&gt; </span><span class="string">'&amp;#268;'</span><span class="keyword">,
<br />
&nbsp;&nbsp;&nbsp; </span><span class="string">'?' </span><span class="keyword">=&gt; </span><span class="string">'&amp;#345;'</span><span class="keyword">,
<br />
&nbsp;&nbsp;&nbsp; </span><span class="string">'?' </span><span class="keyword">=&gt; </span><span class="string">'&amp;#344;'</span><span class="keyword">,
<br />
&nbsp;&nbsp;&nbsp; </span><span class="string">'?' </span><span class="keyword">=&gt; </span><span class="string">'&amp;#382;'</span><span class="keyword">,
<br />
&nbsp;&nbsp;&nbsp; </span><span class="string">'?' </span><span class="keyword">=&gt; </span><span class="string">'&amp;#381;'</span><span class="keyword">,
<br />
&nbsp;&nbsp;&nbsp; </span><span class="string">'y' </span><span class="keyword">=&gt; </span><span class="string">'&amp;#253;'</span><span class="keyword">,
<br />
&nbsp;&nbsp;&nbsp; </span><span class="string">'Y' </span><span class="keyword">=&gt; </span><span class="string">'&amp;#221;'</span><span class="keyword">,
<br />
&nbsp;&nbsp;&nbsp; </span><span class="string">'a' </span><span class="keyword">=&gt; </span><span class="string">'&amp;#225;'</span><span class="keyword">,
<br />
&nbsp;&nbsp;&nbsp; </span><span class="string">'A' </span><span class="keyword">=&gt; </span><span class="string">'&amp;#193;'</span><span class="keyword">,
<br />
&nbsp;&nbsp;&nbsp; </span><span class="string">'i' </span><span class="keyword">=&gt; </span><span class="string">'&amp;#237;'</span><span class="keyword">,
<br />
&nbsp;&nbsp;&nbsp; </span><span class="string">'I' </span><span class="keyword">=&gt; </span><span class="string">'&amp;#205;'</span><span class="keyword">,
<br />
&nbsp;&nbsp;&nbsp; </span><span class="string">'e' </span><span class="keyword">=&gt; </span><span class="string">'&amp;#233;'</span><span class="keyword">,
<br />
&nbsp;&nbsp;&nbsp; </span><span class="string">'E' </span><span class="keyword">=&gt; </span><span class="string">'&amp;#201;'</span><span class="keyword">,
<br />
&nbsp;&nbsp;&nbsp; </span><span class="string">'u' </span><span class="keyword">=&gt; </span><span class="string">'&amp;#250;'</span><span class="keyword">,
<br />
&nbsp;&nbsp;&nbsp; </span><span class="string">'?' </span><span class="keyword">=&gt; </span><span class="string">'&amp;#367;'</span><span class="keyword">,
<br />
&nbsp;&nbsp;&nbsp; </span><span class="string">'?' </span><span class="keyword">=&gt; </span><span class="string">'&amp;#366;'</span><span class="keyword">,
<br />
&nbsp;&nbsp;&nbsp; </span><span class="string">'?' </span><span class="keyword">=&gt; </span><span class="string">'&amp;#271;'</span><span class="keyword">,
<br />
&nbsp;&nbsp;&nbsp; </span><span class="string">'?' </span><span class="keyword">=&gt; </span><span class="string">'&amp;#270;'</span><span class="keyword">,
<br />
&nbsp;&nbsp;&nbsp; </span><span class="string">'?' </span><span class="keyword">=&gt; </span><span class="string">'&amp;#357;'</span><span class="keyword">,
<br />
&nbsp;&nbsp;&nbsp; </span><span class="string">'?' </span><span class="keyword">=&gt; </span><span class="string">'&amp;#356;'</span><span class="keyword">,
<br />
&nbsp;&nbsp;&nbsp; </span><span class="string">'?' </span><span class="keyword">=&gt; </span><span class="string">'&amp;#328;'</span><span class="keyword">,
<br />
&nbsp;&nbsp;&nbsp; </span><span class="string">'?' </span><span class="keyword">=&gt; </span><span class="string">'&amp;#327;'
<br />
</span><span class="keyword">);
<br />

<br />
echo </span><span class="default">strtr</span><span class="keyword">(</span><span class="string">'?????yaieu?????????YAIEU????'</span><span class="keyword">, </span><span class="default">$ent</span><span class="keyword">);
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="88169""></a>
  <div class="note">
   <strong class="user">gunter [dot] sammet [at] gmail [dot] com</strong>
   <a href="#88169" class="date">13-Jan-2009 07:48</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Had a heck of a time to get my rss entities right. using htmlentities didn't work and using html_entity_decode didn't work either. Ended up writing a custom function to encode and decode. It might still need some work but I thought to share it because I couldn't find anything on the net. Always open for suggestions to improve it! Here it is:
<br />

<br />
<span class="default">&lt;?php
<br />
&nbsp; $entity_custom_from </span><span class="keyword">= </span><span class="default">false</span><span class="keyword">;
<br />
&nbsp; </span><span class="default">$entity_custom_to </span><span class="keyword">= </span><span class="default">false</span><span class="keyword">;
<br />
&nbsp; function </span><span class="default">html_entity_decode_encode_rss</span><span class="keyword">(</span><span class="default">$data</span><span class="keyword">) {
<br />
&nbsp;&nbsp;&nbsp; global </span><span class="default">$entity_custom_from</span><span class="keyword">, </span><span class="default">$entity_custom_to</span><span class="keyword">;
<br />
&nbsp;&nbsp;&nbsp; if(!</span><span class="default">is_array</span><span class="keyword">(</span><span class="default">$entity_custom_from</span><span class="keyword">) || !</span><span class="default">is_array</span><span class="keyword">(</span><span class="default">$entity_custom_to</span><span class="keyword">)){
<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="default">$array_position </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp;&nbsp; foreach (</span><span class="default">get_html_translation_table</span><span class="keyword">(</span><span class="default">HTML_ENTITIES</span><span class="keyword">) as </span><span class="default">$key </span><span class="keyword">=&gt; </span><span class="default">$value</span><span class="keyword">) {
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">//print("&lt;br /&gt;key: $key, value: $value &lt;br /&gt;\n");
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">switch (</span><span class="default">$value</span><span class="keyword">) {
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// These ones we can skip
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">case </span><span class="string">'&amp;nbsp;'</span><span class="keyword">:
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; break;
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; case </span><span class="string">'&amp;gt;'</span><span class="keyword">:
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; case </span><span class="string">'&amp;lt;'</span><span class="keyword">:
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; case </span><span class="string">'&amp;quot;'</span><span class="keyword">:
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; case </span><span class="string">'&amp;apos;'</span><span class="keyword">:
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; case </span><span class="string">'&amp;amp;'</span><span class="keyword">:
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$entity_custom_from</span><span class="keyword">[</span><span class="default">$array_position</span><span class="keyword">] = </span><span class="default">$key</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$entity_custom_to</span><span class="keyword">[</span><span class="default">$array_position</span><span class="keyword">] = </span><span class="default">$value</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$array_position</span><span class="keyword">++;
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; break;
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; default:
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$entity_custom_from</span><span class="keyword">[</span><span class="default">$array_position</span><span class="keyword">] = </span><span class="default">$value</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$entity_custom_to</span><span class="keyword">[</span><span class="default">$array_position</span><span class="keyword">] = </span><span class="default">$key</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$array_position</span><span class="keyword">++;
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }
<br />
&nbsp;&nbsp; &nbsp;&nbsp; }
<br />
&nbsp;&nbsp;&nbsp; }
<br />
&nbsp;&nbsp;&nbsp; return </span><span class="default">str_replace</span><span class="keyword">(</span><span class="default">$entity_custom_from</span><span class="keyword">, </span><span class="default">$entity_custom_to</span><span class="keyword">, </span><span class="default">$data</span><span class="keyword">);
<br />
&nbsp; }
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="86409""></a>
  <div class="note">
   <strong class="user">Tom Walter</strong>
   <a href="#86409" class="date">17-Oct-2008 04:14</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Note that as of 5.2.5 it appears that if the input string contains a character that is not valid for the output encoding you've specified, then this function returns null.<br />
<br />
You might expect it to just strip the invalid char, but it doesn't.<br />
<br />
You can strip the chars yourself like so:<br />
<br />
iconv('utf-8','utf-8',$str);<br />
<br />
You can combine that with htmlentities also:<br />
<br />
$str = htmlentities(iconv('UTF-8', 'UTF-8//IGNORE', $str, ENT_QUOTES, 'UTF-8');<br />
<br />
Should give you a string with htmlentities encoded to utf-8, and any unsupported chars stripped.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="85884""></a>
  <div class="note">
   <strong class="user">Kenneth Kin Lum</strong>
   <a href="#85884" class="date">23-Sep-2008 01:47</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
use htmlspecialchars() if you are passing in a usual ASCII string.&nbsp; It is faster than htmlentities().<br />
<br />
For example, if you are just doing <br />
<br />
htmlentities('&lt;div style="background: #fff"&gt;&lt;/div&gt;');<br />
<br />
then you can just use htmlspecialchars().&nbsp; htmlentities() will look for all possible ways to convert string into html entities, such as &amp;copy; or &amp;eacute; (which is e with an acute accent on top).<br />
<br />
Note that ASCII is just 7 bit, which is 0x00 to 0x7F.&nbsp; htmlspecialchars() will handle characters inside this range already.&nbsp; htmlentities() is for the 8-bit Latin-1 (ISO-8859-1) to handle European characters, or for UTF-8 when the 3rd argument is "UTF-8" to handle UTF-8 characters, or other types of encodings using different values for the 3rd argument passed into htmlentities().</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="84612""></a>
  <div class="note">
   <strong class="user">snevi at im dot com dot ve</strong>
   <a href="#84612" class="date">22-Jul-2008 03:10</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
correction to my previous post and improvement of the function: (the post was changed by the html parser and the characters displays as they should not)
<br />

<br />
<span class="default">&lt;?php
<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">function </span><span class="default">XMLEntities</span><span class="keyword">(</span><span class="default">$string</span><span class="keyword">)
<br />
&nbsp;&nbsp;&nbsp; {
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$string </span><span class="keyword">= </span><span class="default">preg_replace</span><span class="keyword">(</span><span class="string">'/[^\x09\x0A\x0D\x20-\x7F]/e'</span><span class="keyword">, </span><span class="string">'_privateXMLEntities("$0")'</span><span class="keyword">, </span><span class="default">$string</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">$string</span><span class="keyword">;
<br />
&nbsp;&nbsp;&nbsp; }
<br />

<br />
&nbsp;&nbsp;&nbsp; function </span><span class="default">_privateXMLEntities</span><span class="keyword">(</span><span class="default">$num</span><span class="keyword">)
<br />
&nbsp;&nbsp;&nbsp; {
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$chars </span><span class="keyword">= array(
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">128 </span><span class="keyword">=&gt; </span><span class="string">'&amp;#8364;'</span><span class="keyword">,
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">130 </span><span class="keyword">=&gt; </span><span class="string">'&amp;#8218;'</span><span class="keyword">,
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">131 </span><span class="keyword">=&gt; </span><span class="string">'&amp;#402;'</span><span class="keyword">,
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">132 </span><span class="keyword">=&gt; </span><span class="string">'&amp;#8222;'</span><span class="keyword">,
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">133 </span><span class="keyword">=&gt; </span><span class="string">'&amp;#8230;'</span><span class="keyword">,
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">134 </span><span class="keyword">=&gt; </span><span class="string">'&amp;#8224;'</span><span class="keyword">,
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">135 </span><span class="keyword">=&gt; </span><span class="string">'&amp;#8225;'</span><span class="keyword">,
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">136 </span><span class="keyword">=&gt; </span><span class="string">'&amp;#710;'</span><span class="keyword">,
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">137 </span><span class="keyword">=&gt; </span><span class="string">'&amp;#8240;'</span><span class="keyword">,
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">138 </span><span class="keyword">=&gt; </span><span class="string">'&amp;#352;'</span><span class="keyword">,
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">139 </span><span class="keyword">=&gt; </span><span class="string">'&amp;#8249;'</span><span class="keyword">,
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">140 </span><span class="keyword">=&gt; </span><span class="string">'&amp;#338;'</span><span class="keyword">,
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">142 </span><span class="keyword">=&gt; </span><span class="string">'&amp;#381;'</span><span class="keyword">,
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">145 </span><span class="keyword">=&gt; </span><span class="string">'&amp;#8216;'</span><span class="keyword">,
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">146 </span><span class="keyword">=&gt; </span><span class="string">'&amp;#8217;'</span><span class="keyword">,
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">147 </span><span class="keyword">=&gt; </span><span class="string">'&amp;#8220;'</span><span class="keyword">,
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">148 </span><span class="keyword">=&gt; </span><span class="string">'&amp;#8221;'</span><span class="keyword">,
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">149 </span><span class="keyword">=&gt; </span><span class="string">'&amp;#8226;'</span><span class="keyword">,
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">150 </span><span class="keyword">=&gt; </span><span class="string">'&amp;#8211;'</span><span class="keyword">,
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">151 </span><span class="keyword">=&gt; </span><span class="string">'&amp;#8212;'</span><span class="keyword">,
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">152 </span><span class="keyword">=&gt; </span><span class="string">'&amp;#732;'</span><span class="keyword">,
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">153 </span><span class="keyword">=&gt; </span><span class="string">'&amp;#8482;'</span><span class="keyword">,
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">154 </span><span class="keyword">=&gt; </span><span class="string">'&amp;#353;'</span><span class="keyword">,
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">155 </span><span class="keyword">=&gt; </span><span class="string">'&amp;#8250;'</span><span class="keyword">,
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">156 </span><span class="keyword">=&gt; </span><span class="string">'&amp;#339;'</span><span class="keyword">,
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">158 </span><span class="keyword">=&gt; </span><span class="string">'&amp;#382;'</span><span class="keyword">,
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">159 </span><span class="keyword">=&gt; </span><span class="string">'&amp;#376;'</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$num </span><span class="keyword">= </span><span class="default">ord</span><span class="keyword">(</span><span class="default">$num</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return ((</span><span class="default">$num </span><span class="keyword">&gt; </span><span class="default">127 </span><span class="keyword">&amp;&amp; </span><span class="default">$num </span><span class="keyword">&lt; </span><span class="default">160</span><span class="keyword">) ? </span><span class="default">$chars</span><span class="keyword">[</span><span class="default">$num</span><span class="keyword">] : </span><span class="string">"&amp;#"</span><span class="keyword">.</span><span class="default">$num</span><span class="keyword">.</span><span class="string">";" </span><span class="keyword">);
<br />
&nbsp;&nbsp;&nbsp; } 
<br />
</span><span class="default">?&gt;
<br />
</span>
<br />
in the previous post, to correct the HEX values that are not rendered, the program use a for each cicle, but that introduces a mayor complexity in execution time, so, we use the ability to call functions in the preg_replace second parameter, and ceate another funcion that evaluates the ord of the character given, and if it is between 127 and 160 it returns the modified HEX value to be understood by the browser and not brake the XML
<br />
(this work with dynamic XML generated form php with dynamic data from any source)
<br />

<br />
p.d: the '&amp;'(&amp;) should appear in this post as a single ampersand character and not as the html entity</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="84327""></a>
  <div class="note">
   <strong class="user">keenskelly at gmail dot com</strong>
   <a href="#84327" class="date">09-Jul-2008 07:00</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Correction to my previous post: the set of ENTITY declarations must be inside a &lt;!DOCTYPE element; also &amp;nbsp; is NOT pre-defined in XML and must be left in the entity list. I also extended the list with the windows 1252 character set using a sample function borrowed from php.net user comments and extended with euro entity which we need for our app. Here is the final code that is in our production app:
<br />

<br />
<span class="default">&lt;?php
<br />

<br />
</span><span class="comment">// Generate a list of entity declarations from the HTML_ENTITIES set that PHP knows about to dump into the document
<br />
</span><span class="keyword">function </span><span class="default">htmlentities_entities</span><span class="keyword">() {
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$output </span><span class="keyword">= </span><span class="string">"&lt;!DOCTYPE html [\n"</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; foreach (</span><span class="default">get_html_translation_table_CP1252</span><span class="keyword">(</span><span class="default">HTML_ENTITIES</span><span class="keyword">) as </span><span class="default">$value</span><span class="keyword">) {
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$name </span><span class="keyword">= </span><span class="default">substr</span><span class="keyword">(</span><span class="default">$value</span><span class="keyword">, </span><span class="default">1</span><span class="keyword">, </span><span class="default">strlen</span><span class="keyword">(</span><span class="default">$value</span><span class="keyword">) - </span><span class="default">2</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; switch (</span><span class="default">$name</span><span class="keyword">) {
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// These ones we can skip because they're built into XML
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">case </span><span class="string">'gt'</span><span class="keyword">:
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; case </span><span class="string">'lt'</span><span class="keyword">:
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; case </span><span class="string">'quot'</span><span class="keyword">:
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; case </span><span class="string">'apos'</span><span class="keyword">:
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; case </span><span class="string">'amp'</span><span class="keyword">: break;
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; default: </span><span class="default">$output </span><span class="keyword">.= </span><span class="string">"&lt;!ENTITY </span><span class="keyword">{</span><span class="default">$name</span><span class="keyword">}</span><span class="string"> \"&amp;</span><span class="keyword">{</span><span class="default">$name</span><span class="keyword">}</span><span class="string">;\"&gt;\n"</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$output </span><span class="keyword">.= </span><span class="string">"]&gt;\n"</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return(</span><span class="default">$output</span><span class="keyword">);
<br />
}
<br />

<br />
</span><span class="comment">// ref: <a href="http://php.net/manual/en/function.get-html-translation-table.php#76564" rel="nofollow" target="_blank">http://php.net/manual/en/function.get-html-translation-table.php#76564</a>
<br />
</span><span class="keyword">function </span><span class="default">get_html_translation_table_CP1252</span><span class="keyword">(</span><span class="default">$type</span><span class="keyword">) {
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$trans </span><span class="keyword">= </span><span class="default">get_html_translation_table</span><span class="keyword">(</span><span class="default">$type</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$trans</span><span class="keyword">[</span><span class="default">chr</span><span class="keyword">(</span><span class="default">130</span><span class="keyword">)] = </span><span class="string">'&amp;sbquo;'</span><span class="keyword">;&nbsp; &nbsp; </span><span class="comment">// Single Low-9 Quotation Mark
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$trans</span><span class="keyword">[</span><span class="default">chr</span><span class="keyword">(</span><span class="default">131</span><span class="keyword">)] = </span><span class="string">'&amp;fnof;'</span><span class="keyword">;&nbsp; &nbsp; </span><span class="comment">// Latin Small Letter F With Hook
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$trans</span><span class="keyword">[</span><span class="default">chr</span><span class="keyword">(</span><span class="default">132</span><span class="keyword">)] = </span><span class="string">'&amp;bdquo;'</span><span class="keyword">;&nbsp; &nbsp; </span><span class="comment">// Double Low-9 Quotation Mark
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$trans</span><span class="keyword">[</span><span class="default">chr</span><span class="keyword">(</span><span class="default">133</span><span class="keyword">)] = </span><span class="string">'&amp;hellip;'</span><span class="keyword">;&nbsp; &nbsp; </span><span class="comment">// Horizontal Ellipsis
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$trans</span><span class="keyword">[</span><span class="default">chr</span><span class="keyword">(</span><span class="default">134</span><span class="keyword">)] = </span><span class="string">'&amp;dagger;'</span><span class="keyword">;&nbsp; &nbsp; </span><span class="comment">// Dagger
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$trans</span><span class="keyword">[</span><span class="default">chr</span><span class="keyword">(</span><span class="default">135</span><span class="keyword">)] = </span><span class="string">'&amp;Dagger;'</span><span class="keyword">;&nbsp; &nbsp; </span><span class="comment">// Double Dagger
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$trans</span><span class="keyword">[</span><span class="default">chr</span><span class="keyword">(</span><span class="default">136</span><span class="keyword">)] = </span><span class="string">'&amp;circ;'</span><span class="keyword">;&nbsp; &nbsp; </span><span class="comment">// Modifier Letter Circumflex Accent
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$trans</span><span class="keyword">[</span><span class="default">chr</span><span class="keyword">(</span><span class="default">137</span><span class="keyword">)] = </span><span class="string">'&amp;permil;'</span><span class="keyword">;&nbsp; &nbsp; </span><span class="comment">// Per Mille Sign
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$trans</span><span class="keyword">[</span><span class="default">chr</span><span class="keyword">(</span><span class="default">138</span><span class="keyword">)] = </span><span class="string">'&amp;Scaron;'</span><span class="keyword">;&nbsp; &nbsp; </span><span class="comment">// Latin Capital Letter S With Caron
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$trans</span><span class="keyword">[</span><span class="default">chr</span><span class="keyword">(</span><span class="default">139</span><span class="keyword">)] = </span><span class="string">'&amp;lsaquo;'</span><span class="keyword">;&nbsp; &nbsp; </span><span class="comment">// Single Left-Pointing Angle Quotation Mark
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$trans</span><span class="keyword">[</span><span class="default">chr</span><span class="keyword">(</span><span class="default">140</span><span class="keyword">)] = </span><span class="string">'&amp;OElig;'</span><span class="keyword">;&nbsp; &nbsp; </span><span class="comment">// Latin Capital Ligature OE
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$trans</span><span class="keyword">[</span><span class="default">chr</span><span class="keyword">(</span><span class="default">145</span><span class="keyword">)] = </span><span class="string">'&amp;lsquo;'</span><span class="keyword">;&nbsp; &nbsp; </span><span class="comment">// Left Single Quotation Mark
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$trans</span><span class="keyword">[</span><span class="default">chr</span><span class="keyword">(</span><span class="default">146</span><span class="keyword">)] = </span><span class="string">'&amp;rsquo;'</span><span class="keyword">;&nbsp; &nbsp; </span><span class="comment">// Right Single Quotation Mark
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$trans</span><span class="keyword">[</span><span class="default">chr</span><span class="keyword">(</span><span class="default">147</span><span class="keyword">)] = </span><span class="string">'&amp;ldquo;'</span><span class="keyword">;&nbsp; &nbsp; </span><span class="comment">// Left Double Quotation Mark
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$trans</span><span class="keyword">[</span><span class="default">chr</span><span class="keyword">(</span><span class="default">148</span><span class="keyword">)] = </span><span class="string">'&amp;rdquo;'</span><span class="keyword">;&nbsp; &nbsp; </span><span class="comment">// Right Double Quotation Mark
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$trans</span><span class="keyword">[</span><span class="default">chr</span><span class="keyword">(</span><span class="default">149</span><span class="keyword">)] = </span><span class="string">'&amp;bull;'</span><span class="keyword">;&nbsp; &nbsp; </span><span class="comment">// Bullet
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$trans</span><span class="keyword">[</span><span class="default">chr</span><span class="keyword">(</span><span class="default">150</span><span class="keyword">)] = </span><span class="string">'&amp;ndash;'</span><span class="keyword">;&nbsp; &nbsp; </span><span class="comment">// En Dash
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$trans</span><span class="keyword">[</span><span class="default">chr</span><span class="keyword">(</span><span class="default">151</span><span class="keyword">)] = </span><span class="string">'&amp;mdash;'</span><span class="keyword">;&nbsp; &nbsp; </span><span class="comment">// Em Dash
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$trans</span><span class="keyword">[</span><span class="default">chr</span><span class="keyword">(</span><span class="default">152</span><span class="keyword">)] = </span><span class="string">'&amp;tilde;'</span><span class="keyword">;&nbsp; &nbsp; </span><span class="comment">// Small Tilde
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$trans</span><span class="keyword">[</span><span class="default">chr</span><span class="keyword">(</span><span class="default">153</span><span class="keyword">)] = </span><span class="string">'&amp;trade;'</span><span class="keyword">;&nbsp; &nbsp; </span><span class="comment">// Trade Mark Sign
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$trans</span><span class="keyword">[</span><span class="default">chr</span><span class="keyword">(</span><span class="default">154</span><span class="keyword">)] = </span><span class="string">'&amp;scaron;'</span><span class="keyword">;&nbsp; &nbsp; </span><span class="comment">// Latin Small Letter S With Caron
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$trans</span><span class="keyword">[</span><span class="default">chr</span><span class="keyword">(</span><span class="default">155</span><span class="keyword">)] = </span><span class="string">'&amp;rsaquo;'</span><span class="keyword">;&nbsp; &nbsp; </span><span class="comment">// Single Right-Pointing Angle Quotation Mark
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$trans</span><span class="keyword">[</span><span class="default">chr</span><span class="keyword">(</span><span class="default">156</span><span class="keyword">)] = </span><span class="string">'&amp;oelig;'</span><span class="keyword">;&nbsp; &nbsp; </span><span class="comment">// Latin Small Ligature OE
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$trans</span><span class="keyword">[</span><span class="default">chr</span><span class="keyword">(</span><span class="default">159</span><span class="keyword">)] = </span><span class="string">'&amp;Yuml;'</span><span class="keyword">;&nbsp; &nbsp; </span><span class="comment">// Latin Capital Letter Y With Diaeresis
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$trans</span><span class="keyword">[</span><span class="string">'euro'</span><span class="keyword">] = </span><span class="string">'&amp;euro;'</span><span class="keyword">;&nbsp; &nbsp; </span><span class="comment">// euro currency symbol
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">ksort</span><span class="keyword">(</span><span class="default">$trans</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">$trans</span><span class="keyword">;
<br />
}
<br />

<br />
</span><span class="default">?&gt;
<br />
</span>
<br />
[EDIT BY danbrown AT php DOT net: The user's original note contained the following text:
<br />

<br />
"So here's something fun: if you create an XML document in PHP and use htmlentities() to encode text data, then later want to read and parse the same document with PHP's xml_parse(), unless you include entity declarations into the generated document, the parser will stop on the unknown entities.
<br />

<br />
To account for this, I created a small function to take the translation table and turn it into XML &lt;!ENTITY&gt; definitions. I insert this output into the XML document immediately after the &lt;?xml?&gt; line and the parse errors magically vanish"
<br />
]</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="82534""></a>
  <div class="note">
   <strong class="user">za at byza dot it</strong>
   <a href="#82534" class="date">15-Apr-2008 06:15</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Trouble when using files with different charset?
<br />

<br />
htmlentities and html_entity_decode can be used to translate between charset! 
<br />

<br />
Sample function:
<br />

<br />
<span class="default">&lt;?php
<br />
</span><span class="keyword">function </span><span class="default">utf2latin</span><span class="keyword">(</span><span class="default">$text</span><span class="keyword">) {
<br />
&nbsp;&nbsp; </span><span class="default">$text</span><span class="keyword">=</span><span class="default">htmlentities</span><span class="keyword">(</span><span class="default">$text</span><span class="keyword">,</span><span class="default">ENT_COMPAT</span><span class="keyword">,</span><span class="string">'UTF-8'</span><span class="keyword">);
<br />
&nbsp;&nbsp; return </span><span class="default">html_entity_decode</span><span class="keyword">(</span><span class="default">$text</span><span class="keyword">,</span><span class="default">ENT_COMPAT</span><span class="keyword">,</span><span class="string">'ISO-8859-1'</span><span class="keyword">);
<br />
}
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="78503""></a>
  <div class="note">
   <strong class="user">marktpitman at gmail dot com</strong>
   <a href="#78503" class="date">15-Oct-2007 04:21</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I just thought I would add that if you're using the default charset, htmlentities will not correctly return the trademark ( &trade; ) sign.
<br />

<br />
Instead it will return something like this: a?¢
<br />

<br />
If you need the trademark symbol, use:
<br />

<br />
<span class="default">&lt;?php htmlentities</span><span class="keyword">( </span><span class="default">$html</span><span class="keyword">, </span><span class="default">ENT_QUOTES</span><span class="keyword">, </span><span class="string">"UTF-8" </span><span class="keyword">); </span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="74711""></a>
  <div class="note">
   <strong class="user">D. Gasser</strong>
   <a href="#74711" class="date">24-Apr-2007 07:40</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
When using UTF-8 as charset, you'll have to set UTF-8 in braces, otherwise the varaible is not recognized.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="73708""></a>
  <div class="note">
   <strong class="user">q (dot) rendeiro (at) gmail (dot) com</strong>
   <a href="#73708" class="date">07-Mar-2007 01:41</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I've seen lots of functions to convert all the entities, but I needed to do a fulltext search in a db field that had named entities instead of numeric entities (edited by tinymce), so I searched the tinymce source and found a string with the value-&gt;entity mapping. So, i wrote the following function to encode the user's query with named entities.<br />
<br />
The string I used is different of the original, because i didn't want to convert ' or ". The string is too long, so I had to cut it. To get the original check TinyMCE source and search for nbsp or other entity ;)<br />
<br />
<span class="default">&lt;?php<br />
<br />
$entities_unmatched </span><span class="keyword">= </span><span class="default">explode</span><span class="keyword">(</span><span class="string">','</span><span class="keyword">, </span><span class="string">'160,nbsp,161,iexcl,162,cent, [...] '</span><span class="keyword">);<br />
</span><span class="default">$even </span><span class="keyword">= </span><span class="default">1</span><span class="keyword">;<br />
foreach(</span><span class="default">$entities_unmatched </span><span class="keyword">as </span><span class="default">$c</span><span class="keyword">) {<br />
&nbsp;&nbsp;&nbsp; if(</span><span class="default">$even</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$ord </span><span class="keyword">= </span><span class="default">$c</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; } else {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$entities_table</span><span class="keyword">[</span><span class="default">$ord</span><span class="keyword">] = </span><span class="default">$c</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$even </span><span class="keyword">= </span><span class="default">1 </span><span class="keyword">- </span><span class="default">$even</span><span class="keyword">;<br />
}<br />
<br />
function </span><span class="default">encode_named_entities</span><span class="keyword">(</span><span class="default">$str</span><span class="keyword">) {<br />
&nbsp;&nbsp;&nbsp; global </span><span class="default">$entities_table</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$encoded_str </span><span class="keyword">= </span><span class="string">''</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; for(</span><span class="default">$i </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">; </span><span class="default">$i </span><span class="keyword">&lt; </span><span class="default">strlen</span><span class="keyword">(</span><span class="default">$str</span><span class="keyword">); </span><span class="default">$i</span><span class="keyword">++) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$ent </span><span class="keyword">= @</span><span class="default">$entities_table</span><span class="keyword">[</span><span class="default">ord</span><span class="keyword">(</span><span class="default">$str</span><span class="keyword">{</span><span class="default">$i</span><span class="keyword">})];<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if(</span><span class="default">$ent</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$encoded_str </span><span class="keyword">.= </span><span class="string">"&amp;</span><span class="default">$ent</span><span class="string">;"</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; } else {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$encoded_str </span><span class="keyword">.= </span><span class="default">$str</span><span class="keyword">{</span><span class="default">$i</span><span class="keyword">};<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; return </span><span class="default">$encoded_str</span><span class="keyword">;<br />
}<br />
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="70964""></a>
  <div class="note">
   <strong class="user">realcj at g mail dt com</strong>
   <a href="#70964" class="date">06-Nov-2006 07:41</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If you are building a loadvars page for Flash and have problems with special chars such as " &amp; ", " ' " etc, you should escape them for flash:
<br />

<br />
Try trace(escape("&amp;")); in flash' actionscript to see the escape code for &amp;;
<br />

<br />
% = %25
<br />
&amp; = %26
<br />
' = %27
<br />

<br />
<span class="default">&lt;?php
<br />
</span><span class="keyword">function </span><span class="default">flashentities</span><span class="keyword">(</span><span class="default">$string</span><span class="keyword">){
<br />
return </span><span class="default">str_replace</span><span class="keyword">(array(</span><span class="string">"&amp;"</span><span class="keyword">,</span><span class="string">"'"</span><span class="keyword">),array(</span><span class="string">"%26"</span><span class="keyword">,</span><span class="string">"%27"</span><span class="keyword">),</span><span class="default">$string</span><span class="keyword">);
<br />
}
<br />
</span><span class="default">?&gt;
<br />
</span>
<br />
Those are the two that concerned me. YMMV.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="68479""></a>
  <div class="note">
   <strong class="user">daviscabral[arroba]gmail[ponto]com</strong>
   <a href="#68479" class="date">28-Jul-2006 09:52</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
unhtmlentities for all entities:<br />
<br />
<span class="default">&lt;?php<br />
<br />
</span><span class="keyword">function </span><span class="default">unhtmlentities </span><span class="keyword">(</span><span class="default">$string</span><span class="keyword">) {<br />
&nbsp;&nbsp; </span><span class="default">$trans_tbl1 </span><span class="keyword">= </span><span class="default">get_html_translation_table </span><span class="keyword">(</span><span class="default">HTML_ENTITIES</span><span class="keyword">);<br />
&nbsp;&nbsp; foreach ( </span><span class="default">$trans_tbl1 </span><span class="keyword">as </span><span class="default">$ascii </span><span class="keyword">=&gt; </span><span class="default">$htmlentitie </span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$trans_tbl2</span><span class="keyword">[</span><span class="default">$ascii</span><span class="keyword">] = </span><span class="string">'&amp;#'</span><span class="keyword">.</span><span class="default">ord</span><span class="keyword">(</span><span class="default">$ascii</span><span class="keyword">).</span><span class="string">';'</span><span class="keyword">;<br />
&nbsp;&nbsp; }<br />
&nbsp;&nbsp; </span><span class="default">$trans_tbl1 </span><span class="keyword">= </span><span class="default">array_flip </span><span class="keyword">(</span><span class="default">$trans_tbl1</span><span class="keyword">);<br />
&nbsp;&nbsp; </span><span class="default">$trans_tbl2 </span><span class="keyword">= </span><span class="default">array_flip </span><span class="keyword">(</span><span class="default">$trans_tbl2</span><span class="keyword">);<br />
&nbsp;&nbsp; return </span><span class="default">strtr </span><span class="keyword">(</span><span class="default">strtr </span><span class="keyword">(</span><span class="default">$string</span><span class="keyword">, </span><span class="default">$trans_tbl1</span><span class="keyword">), </span><span class="default">$trans_tbl2</span><span class="keyword">);<br />
}<br />
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="68322""></a>
  <div class="note">
   <strong class="user">info at pirandot dot de</strong>
   <a href="#68322" class="date">22-Jul-2006 04:14</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
The data returned by a text input field is ready to be used in a data base query when enclosed in single quotes, e.g.
<br />
<span class="default">&lt;?php
<br />
&nbsp;&nbsp; mysql_query </span><span class="keyword">(</span><span class="string">"SELECT * FROM Article WHERE id = '</span><span class="default">$data</span><span class="string">'"</span><span class="keyword">);
<br />
</span><span class="default">?&gt;
<br />
</span>But you will get problems when writing back this data into the input field's value,
<br />
<span class="default">&lt;?php
<br />
&nbsp;&nbsp; </span><span class="keyword">echo </span><span class="string">"&lt;input name='data' type='text' value='</span><span class="default">$data</span><span class="string">'&gt;"</span><span class="keyword">;
<br />
</span><span class="default">?&gt;
<br />
</span>because hmtl codes would be interpreted and escape sequences would cause strange output.
<br />

<br />
The following function may help:
<br />
<span class="default">&lt;?php
<br />
</span><span class="keyword">function </span><span class="default">deescape </span><span class="keyword">(</span><span class="default">$s</span><span class="keyword">, </span><span class="default">$charset</span><span class="keyword">=</span><span class="string">'UTF-8'</span><span class="keyword">)
<br />
{
<br />
&nbsp;&nbsp; </span><span class="comment">//&nbsp; don't interpret html codes and don't convert quotes
<br />
&nbsp;&nbsp; </span><span class="default">$s&nbsp; </span><span class="keyword">=&nbsp; </span><span class="default">htmlentities </span><span class="keyword">(</span><span class="default">$s</span><span class="keyword">, </span><span class="default">ENT_NOQUOTES</span><span class="keyword">, </span><span class="default">$charset</span><span class="keyword">);
<br />

<br />
&nbsp;&nbsp; </span><span class="comment">//&nbsp; delete the inserted backslashes except those for protecting single quotes
<br />
&nbsp;&nbsp; </span><span class="default">$s&nbsp; </span><span class="keyword">=&nbsp; </span><span class="default">preg_replace </span><span class="keyword">(</span><span class="string">"/\\\\([^'])/e"</span><span class="keyword">, </span><span class="string">'"&amp;#" . ord("$1") . ";"'</span><span class="keyword">, </span><span class="default">$s</span><span class="keyword">);
<br />

<br />
&nbsp;&nbsp; </span><span class="comment">//&nbsp; delete the backslashes inserted for protecting single quotes
<br />
&nbsp;&nbsp; </span><span class="default">$s&nbsp; </span><span class="keyword">=&nbsp; </span><span class="default">str_replace </span><span class="keyword">(</span><span class="string">"\\'"</span><span class="keyword">, </span><span class="string">"&amp;#" </span><span class="keyword">. </span><span class="default">ord </span><span class="keyword">(</span><span class="string">"'"</span><span class="keyword">) . </span><span class="string">";"</span><span class="keyword">, </span><span class="default">$s</span><span class="keyword">);
<br />

<br />
&nbsp;&nbsp; return&nbsp; </span><span class="default">$s</span><span class="keyword">;
<br />
}
<br />
</span><span class="default">?&gt;
<br />
</span>Try some input like:&nbsp; a'b"c\d\'e\"f\\g&amp;x#27;h&nbsp; to test ...</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="65200""></a>
  <div class="note">
   <strong class="user">anonymous</strong>
   <a href="#65200" class="date">26-Apr-2006 09:38</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
This function will encode anything that is non Standard ASCII (that is, that is above #127 in the ascii table)
<br />

<br />
<span class="default">&lt;?php
<br />
</span><span class="comment">// allhtmlentities : mainly based on "chars_encode()"&nbsp; by Tim Burgan &lt;timburgan@gmail.com&gt; [<a href="http://www.php.net/htmlentities]" rel="nofollow" target="_blank">http://www.php.net/htmlentities]</a>
<br />
</span><span class="keyword">function </span><span class="default">allhtmlentities</span><span class="keyword">(</span><span class="default">$string</span><span class="keyword">) {
<br />
&nbsp;&nbsp;&nbsp; if ( </span><span class="default">strlen</span><span class="keyword">(</span><span class="default">$string</span><span class="keyword">) == </span><span class="default">0 </span><span class="keyword">) 
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">$string</span><span class="keyword">;
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$result </span><span class="keyword">= </span><span class="string">''</span><span class="keyword">;
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$string </span><span class="keyword">= </span><span class="default">htmlentities</span><span class="keyword">(</span><span class="default">$string</span><span class="keyword">, </span><span class="default">HTML_ENTITIES</span><span class="keyword">);
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$string </span><span class="keyword">= </span><span class="default">preg_split</span><span class="keyword">(</span><span class="string">"//"</span><span class="keyword">, </span><span class="default">$string</span><span class="keyword">, -</span><span class="default">1</span><span class="keyword">, </span><span class="default">PREG_SPLIT_NO_EMPTY</span><span class="keyword">);
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$ord </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">;
<br />
&nbsp;&nbsp;&nbsp; for ( </span><span class="default">$i </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">; </span><span class="default">$i </span><span class="keyword">&lt; </span><span class="default">count</span><span class="keyword">(</span><span class="default">$string</span><span class="keyword">); </span><span class="default">$i</span><span class="keyword">++ ) {
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$ord </span><span class="keyword">= </span><span class="default">ord</span><span class="keyword">(</span><span class="default">$string</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">]);
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if ( </span><span class="default">$ord </span><span class="keyword">&gt; </span><span class="default">127 </span><span class="keyword">) {
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$string</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">] = </span><span class="string">'&amp;#' </span><span class="keyword">. </span><span class="default">$ord </span><span class="keyword">. </span><span class="string">';'</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }
<br />
&nbsp;&nbsp;&nbsp; }
<br />
&nbsp;&nbsp;&nbsp; return </span><span class="default">implode</span><span class="keyword">(</span><span class="string">''</span><span class="keyword">,</span><span class="default">$string</span><span class="keyword">);
<br />
}
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="58863""></a>
  <div class="note">
   <strong class="user">edo at edwaa dot com</strong>
   <a href="#58863" class="date">18-Nov-2005 05:48</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
A version of the xml entities function below. This one replaces the "prime" character (′) with which I had difficulties.
<br />

<br />
<span class="default">&lt;?php
<br />
</span><span class="comment">// XML Entity Mandatory Escape Characters
<br />
</span><span class="keyword">function </span><span class="default">xmlentities</span><span class="keyword">(</span><span class="default">$string</span><span class="keyword">) {
<br />
&nbsp;&nbsp; return </span><span class="default">str_replace </span><span class="keyword">( array ( </span><span class="string">'&amp;'</span><span class="keyword">, </span><span class="string">'"'</span><span class="keyword">, </span><span class="string">"'"</span><span class="keyword">, </span><span class="string">'&lt;'</span><span class="keyword">, </span><span class="string">'&gt;'</span><span class="keyword">, </span><span class="string">'?' </span><span class="keyword">), array ( </span><span class="string">'&amp;amp;' </span><span class="keyword">, </span><span class="string">'&amp;quot;'</span><span class="keyword">, </span><span class="string">'&amp;apos;' </span><span class="keyword">, </span><span class="string">'&amp;lt;' </span><span class="keyword">, </span><span class="string">'&amp;gt;'</span><span class="keyword">, </span><span class="string">'&amp;apos;' </span><span class="keyword">), </span><span class="default">$string </span><span class="keyword">);
<br />
}
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="57825""></a>
  <div class="note">
   <strong class="user">info at bleed dot ws</strong>
   <a href="#57825" class="date">15-Oct-2005 07:42</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
here the centralized version of htmlentities() for multibyte.<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">function </span><span class="default">mb_htmlentities</span><span class="keyword">(</span><span class="default">$string</span><span class="keyword">)<br />
{<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$string </span><span class="keyword">= </span><span class="default">htmlentities</span><span class="keyword">(</span><span class="default">$string</span><span class="keyword">, </span><span class="default">ENT_COMPAT</span><span class="keyword">, </span><span class="default">mb_internal_encoding</span><span class="keyword">());<br />
&nbsp;&nbsp;&nbsp; return </span><span class="default">$string</span><span class="keyword">;<br />
} <br />
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="42020""></a>
  <div class="note">
   <strong class="user">jake_mcmahon at hotmail dot com</strong>
   <a href="#42020" class="date">29-Apr-2004 11:29</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
This fuction is particularly useful against XSS (cross-site-scripting-). XSS makes use of holes in code, whether it be in Javascript or PHP. XSS often, if not always, uses HTML entities to do its evil deeds, so this function in co-operation with your scripts (particularly search or submitting scripts) is a very useful tool in combatting "H4X0rz".</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="41152""></a>
  <div class="note">
   <strong class="user">wwb at 3dwargamer dot net</strong>
   <a href="#41152" class="date">01-Apr-2004 01:49</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
htmlentites is a very handy function, but it fails to fix one thing which I deal with alot: word 'smart' quotes and emdashes.
<br />

<br />
The below function replaces the funky double quotes with &amp;quot;, funky single quotes with standard single quotes and fixes emdashes.
<br />

<br />
<span class="default">&lt;?php
<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">function </span><span class="default">CleanupSmartQuotes</span><span class="keyword">(</span><span class="default">$text</span><span class="keyword">)
<br />
&nbsp;&nbsp;&nbsp; {
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$badwordchars</span><span class="keyword">=array(
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">chr</span><span class="keyword">(</span><span class="default">145</span><span class="keyword">),
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">chr</span><span class="keyword">(</span><span class="default">146</span><span class="keyword">),
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">chr</span><span class="keyword">(</span><span class="default">147</span><span class="keyword">),
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">chr</span><span class="keyword">(</span><span class="default">148</span><span class="keyword">),
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">chr</span><span class="keyword">(</span><span class="default">151</span><span class="keyword">)
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; );
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$fixedwordchars</span><span class="keyword">=array(
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="string">"'"</span><span class="keyword">,
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="string">"'"</span><span class="keyword">,
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="string">'&amp;quot;'</span><span class="keyword">,
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="string">'&amp;quot;'</span><span class="keyword">,
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="string">'&amp;mdash;'
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">str_replace</span><span class="keyword">(</span><span class="default">$badwordchars</span><span class="keyword">,</span><span class="default">$fixedwordchars</span><span class="keyword">,</span><span class="default">$text</span><span class="keyword">);
<br />
&nbsp;&nbsp;&nbsp; }
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="28197""></a>
  <div class="note">
   <strong class="user">Bassie (:</strong>
   <a href="#28197" class="date">06-Jan-2003 01:07</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Note that you'll have use htmlentities() before any other function who'll edit text like nl2br().<br />
<br />
If you use nl2br() first, the htmlentities() function will change &lt; br &gt; to &amp;lt;br&amp;gt;.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
</div>
</div>
</div></div></body></html>
