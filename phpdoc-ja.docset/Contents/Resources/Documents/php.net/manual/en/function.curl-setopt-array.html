<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
 <head>
  <meta http-equiv="content-type" content="text/html; CHARSET=shift-jis">
  <title>CURL 転送用の複数のオプションを設定する</title>

  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <link media="all" rel="stylesheet" type="text/css" href="style.css"/>
 </head>
 <body class="docs" class="docs"><div class="navbar navbar-fixed-top">
  <div class="navbar-inner clearfix">
    <ul class="nav" style="width: 100%">
      <li style="float: left;"><a href="function.curl-reset.html">≪ curl_reset</a></li>
      <li style="float: right;"><a href="function.curl-setopt.html">curl_setopt ≫</a></li>
    </ul>
  </div>
</div>
<div id="breadcrumbs" class="clearfix">
  <ul class="breadcrumbs-container">
    <li><a href="index.html">PHP Manual</a></li>
    <li><a href="ref.curl.html">cURL 関数</a></li>
    <li>CURL 転送用の複数のオプションを設定する</li>
  </ul>
</div>
<div id="layout">
  <div id="layout-content"><div id="function.curl-setopt-array" class="refentry">
 <div class="refnamediv">
  <h1 class="refname">curl_setopt_array</h1>
  <p class="verinfo">(PHP 5 &gt;= 5.1.3)</p><p class="refpurpose"><span class="refname">curl_setopt_array</span> &mdash; <span class="dc-title">CURL 転送用の複数のオプションを設定する</span></p>

 </div>
 <div class="refsect1 description" id="refsect1-function.curl-setopt-array-description">
  <h3 class="title">説明</h3>
  <div class="methodsynopsis dc-description">
   <span class="type">bool</span> <span class="methodname"><strong>curl_setopt_array</strong></span>
    ( <span class="methodparam"><span class="type">resource</span> <code class="parameter">$ch</code></span>
   , <span class="methodparam"><span class="type">array</span> <code class="parameter">$options</code></span>
   )</div>

  <p class="para rdfs-comment">
   cURL セッション用の複数のオプションを設定します。
   この関数が便利なのは大量の cURL オプションを設定する場合で、
   何度も繰り返して <span class="function"><a href="function.curl-setopt.html" class="function">curl_setopt()</a></span> をコールせずにすみます。
  </p>
 </div>


 <div class="refsect1 parameters" id="refsect1-function.curl-setopt-array-parameters">
  <h3 class="title">パラメータ</h3>
  <p class="para">
   <dl>

    <dt>
<code class="parameter">ch</code>
</dt>
<dd>
<p class="para"><span class="function"><a href="function.curl-init.html" class="function">curl_init()</a></span>
が返す cURL ハンドル。</p></dd>

    
     <dt>
<code class="parameter">options</code></dt>

     <dd>

      <p class="para">
       設定するオプションとその値を指定した配列。キーとして使用できるのは、
       有効な <span class="function"><a href="function.curl-setopt.html" class="function">curl_setopt()</a></span> 定数か、
       その定数に対応する整数値だけです。
      </p>
     </dd>

    
   </dl>

  </p>
 </div>


 <div class="refsect1 returnvalues" id="refsect1-function.curl-setopt-array-returnvalues">
  <h3 class="title">返り値</h3>
  <p class="para">
   すべてのオプションがうまく設定できた場合に <strong><code>TRUE</code></strong> を返します。
   うまく設定できないオプションがあった時点で即時に <strong><code>FALSE</code></strong>
   が返され、<code class="parameter">options</code>
   配列に含まれるそれ以降のオプションは無視されます。
  </p>
 </div>


 <div class="refsect1 examples" id="refsect1-function.curl-setopt-array-examples">
  <h3 class="title">例</h3>
  <p class="para">
   <div class="example" id="example-4334">
    <p><strong>例1 
     新規に CURL セッションを初期化、ウェブページを取得する
    </strong></p>
    <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br /></span><span style="color: #FF8000">//&nbsp;新しい&nbsp;cURL&nbsp;リソースを作成します<br /></span><span style="color: #0000BB">$ch&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">curl_init</span><span style="color: #007700">();<br /><br /></span><span style="color: #FF8000">//&nbsp;URL&nbsp;その他のオプションを適切に設定します<br /></span><span style="color: #0000BB">$options&nbsp;</span><span style="color: #007700">=&nbsp;array(</span><span style="color: #0000BB">CURLOPT_URL&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #DD0000">'http://www.example.com/'</span><span style="color: #007700">,<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">CURLOPT_HEADER&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #0000BB">false<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">);<br /><br /></span><span style="color: #0000BB">curl_setopt_array</span><span style="color: #007700">(</span><span style="color: #0000BB">$ch</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$options</span><span style="color: #007700">);<br /><br /></span><span style="color: #FF8000">//&nbsp;URL&nbsp;の内容を取得し、ブラウザに渡します<br /></span><span style="color: #0000BB">curl_exec</span><span style="color: #007700">(</span><span style="color: #0000BB">$ch</span><span style="color: #007700">);<br /><br /></span><span style="color: #FF8000">//&nbsp;cURL&nbsp;リソースを閉じ、システムリソースを開放します<br /></span><span style="color: #0000BB">curl_close</span><span style="color: #007700">(</span><span style="color: #0000BB">$ch</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
    </div>

   </div>
  </p>
  <p class="para">
   PHP 5.1.3 より前のバージョンでこの関数と同等の操作をするには、次のようにします。
  </p>
  <p class="para">
   <div class="example" id="example-4335">
    <p><strong>例2 <span class="function"><strong>curl_setopt_array()</strong></span> の独自実装</strong></p>
    <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br /></span><span style="color: #007700">if&nbsp;(!</span><span style="color: #0000BB">function_exists</span><span style="color: #007700">(</span><span style="color: #DD0000">'curl_setopt_array'</span><span style="color: #007700">))&nbsp;{<br />&nbsp;&nbsp;&nbsp;function&nbsp;</span><span style="color: #0000BB">curl_setopt_array</span><span style="color: #007700">(&amp;</span><span style="color: #0000BB">$ch</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$curl_options</span><span style="color: #007700">)<br />&nbsp;&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;foreach&nbsp;(</span><span style="color: #0000BB">$curl_options&nbsp;</span><span style="color: #007700">as&nbsp;</span><span style="color: #0000BB">$option&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #0000BB">$value</span><span style="color: #007700">)&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(!</span><span style="color: #0000BB">curl_setopt</span><span style="color: #007700">(</span><span style="color: #0000BB">$ch</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$option</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$value</span><span style="color: #007700">))&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;</span><span style="color: #0000BB">false</span><span style="color: #007700">;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;</span><span style="color: #0000BB">true</span><span style="color: #007700">;<br />&nbsp;&nbsp;&nbsp;}<br />}<br /></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
    </div>

   </div>
  </p>
 </div>


 <div class="refsect1 notes" id="refsect1-function.curl-setopt-array-notes">
  <h3 class="title">注意</h3>
  <blockquote class="note"><p><strong class="note">注意</strong>: 
   <p class="para">
    <span class="function"><a href="function.curl-setopt.html" class="function">curl_setopt()</a></span> と同様、配列を
    <strong><code>CURLOPT_POST</code></strong> に渡すとデータを
    <em class="emphasis">multipart/form-data</em> でエンコードします。
    一方 URL エンコードされた文字列を渡すと、データを
    <em class="emphasis">application/x-www-form-urlencoded</em> でエンコードします。
   </p>
  </p></blockquote>
 </div>


 <div class="refsect1 seealso" id="refsect1-function.curl-setopt-array-seealso">
  <h3 class="title">参考</h3>
  <p class="para">
   <ul class="simplelist">
    <li class="member"><span class="function"><a href="function.curl-setopt.html" class="function" rel="rdfs-seeAlso">curl_setopt()</a> - cURL 転送用オプションを設定する</span></li>
   </ul>
  </p>
 </div>

</div><div id="usernotes">
 <div class="head">
  <h3 class="title">User Contributed Notes</h3>
 </div>
<div id="allnotes">  <a name="104369""></a>
  <div class="note">
   <strong class="user">loop4u at gmail dot com</strong>
   <a href="#104369" class="date">11-Jun-2011 04:59</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
it should be noted that when using CURLOPT_POSTFIELDS in a loop, CURLOPT_POSTFIELDS appends to the sting. You can use unset() if you don't want this sort of behavior.
<br />

<br />
<span class="default">&lt;?php
<br />
</span><span class="comment">//this will append postfields
<br />

<br />
</span><span class="keyword">while(</span><span class="default">true</span><span class="keyword">) {
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$options </span><span class="keyword">= array(</span><span class="default">CURLOPT_POSTFIELDS </span><span class="keyword">=&gt; </span><span class="string">'foo=bar&amp;foo2=bar'</span><span class="keyword">);
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$ch </span><span class="keyword">= </span><span class="default">curl_init</span><span class="keyword">(</span><span class="string">"<a href="http://www.example.com" rel="nofollow" target="_blank">http://www.example.com</a>"</span><span class="keyword">);
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">curl_setopt_array</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">, </span><span class="default">$options</span><span class="keyword">);
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">curl_exec</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">);
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">curl_close</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">);
<br />
}
<br />

<br />
</span><span class="comment">//this will NOT append postfields
<br />
</span><span class="keyword">while(</span><span class="default">true</span><span class="keyword">) {
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$options </span><span class="keyword">= array(</span><span class="default">CURLOPT_POSTFIELDS </span><span class="keyword">=&gt; </span><span class="string">'foo=bar&amp;foo2=bar'</span><span class="keyword">);
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$ch </span><span class="keyword">= </span><span class="default">curl_init</span><span class="keyword">(</span><span class="string">"<a href="http://www.example.com" rel="nofollow" target="_blank">http://www.example.com</a>"</span><span class="keyword">);
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">curl_setopt_array</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">, </span><span class="default">$options</span><span class="keyword">);
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">curl_exec</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">);
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">curl_close</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">);
<br />
&nbsp;&nbsp;&nbsp; unset(</span><span class="default">$options</span><span class="keyword">[</span><span class="default">CURLOPT_POSTFIELDS</span><span class="keyword">]);
<br />
}
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="98208""></a>
  <div class="note">
   <strong class="user">anthon at piwik dot org</strong>
   <a href="#98208" class="date">01-Jun-2010 03:52</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Starting in PHP 5.2.0, CURLOPT_FOLLOWLOCATION can't be set via curl_setopt_array() (or curl_setopt()) when either safe_mode is enabled or open_basedir is set.&nbsp; In these cases, the order of CURLOPT_* settings in the array can be important.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="89850""></a>
  <div class="note">
   <strong class="user">maran dot emil at gmail dot com</strong>
   <a href="#89850" class="date">25-Mar-2009 08:54</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
In case that you need to read SSL page content from https with curl, this function can help you:
<br />

<br />
<span class="default">&lt;?php
<br />

<br />
</span><span class="keyword">function </span><span class="default">get_web_page</span><span class="keyword">( </span><span class="default">$url</span><span class="keyword">,</span><span class="default">$curl_data </span><span class="keyword">)
<br />
{
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$options </span><span class="keyword">= array(
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">CURLOPT_RETURNTRANSFER </span><span class="keyword">=&gt; </span><span class="default">true</span><span class="keyword">,&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// return web page
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">CURLOPT_HEADER&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">=&gt; </span><span class="default">false</span><span class="keyword">,&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="comment">// don't return headers
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">CURLOPT_FOLLOWLOCATION </span><span class="keyword">=&gt; </span><span class="default">true</span><span class="keyword">,&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// follow redirects
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">CURLOPT_ENCODING&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">=&gt; </span><span class="string">""</span><span class="keyword">,&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// handle all encodings
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">CURLOPT_USERAGENT&nbsp; &nbsp; &nbsp; </span><span class="keyword">=&gt; </span><span class="string">"spider"</span><span class="keyword">,&nbsp; &nbsp;&nbsp; </span><span class="comment">// who am i
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">CURLOPT_AUTOREFERER&nbsp; &nbsp; </span><span class="keyword">=&gt; </span><span class="default">true</span><span class="keyword">,&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// set referer on redirect
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">CURLOPT_CONNECTTIMEOUT </span><span class="keyword">=&gt; </span><span class="default">120</span><span class="keyword">,&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="comment">// timeout on connect
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">CURLOPT_TIMEOUT&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="keyword">=&gt; </span><span class="default">120</span><span class="keyword">,&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="comment">// timeout on response
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">CURLOPT_MAXREDIRS&nbsp; &nbsp; &nbsp; </span><span class="keyword">=&gt; </span><span class="default">10</span><span class="keyword">,&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// stop after 10 redirects
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">CURLOPT_POST&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="keyword">=&gt; </span><span class="default">1</span><span class="keyword">,&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="comment">// i am sending post data
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">CURLOPT_POSTFIELDS&nbsp; &nbsp;&nbsp; </span><span class="keyword">=&gt; </span><span class="default">$curl_data</span><span class="keyword">,&nbsp; &nbsp; </span><span class="comment">// this are my post vars
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">CURLOPT_SSL_VERIFYHOST </span><span class="keyword">=&gt; </span><span class="default">0</span><span class="keyword">,&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="comment">// don't verify ssl
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">CURLOPT_SSL_VERIFYPEER </span><span class="keyword">=&gt; </span><span class="default">false</span><span class="keyword">,&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="comment">//
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">CURLOPT_VERBOSE&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="keyword">=&gt; </span><span class="default">1&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="comment">//
<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">);
<br />

<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$ch&nbsp; &nbsp; &nbsp; </span><span class="keyword">= </span><span class="default">curl_init</span><span class="keyword">(</span><span class="default">$url</span><span class="keyword">);
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">curl_setopt_array</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">,</span><span class="default">$options</span><span class="keyword">);
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$content </span><span class="keyword">= </span><span class="default">curl_exec</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">);
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$err&nbsp; &nbsp;&nbsp; </span><span class="keyword">= </span><span class="default">curl_errno</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">);
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$errmsg&nbsp; </span><span class="keyword">= </span><span class="default">curl_error</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">) ;
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$header&nbsp; </span><span class="keyword">= </span><span class="default">curl_getinfo</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">);
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">curl_close</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">);
<br />

<br />
&nbsp; </span><span class="comment">//&nbsp; $header['errno']&nbsp;&nbsp; = $err;
<br />
&nbsp; //&nbsp; $header['errmsg']&nbsp; = $errmsg;
<br />
&nbsp; //&nbsp; $header['content'] = $content;
<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">return </span><span class="default">$header</span><span class="keyword">;
<br />
}
<br />

<br />
</span><span class="default">$curl_data </span><span class="keyword">= </span><span class="string">"var1=60&amp;var2=test"</span><span class="keyword">;
<br />
</span><span class="default">$url </span><span class="keyword">= </span><span class="string">"https://www.example.com"</span><span class="keyword">;
<br />
</span><span class="default">$response </span><span class="keyword">= </span><span class="default">get_web_page</span><span class="keyword">(</span><span class="default">$url</span><span class="keyword">,</span><span class="default">$curl_data</span><span class="keyword">);
<br />

<br />
print </span><span class="string">'&lt;pre&gt;'</span><span class="keyword">;
<br />
</span><span class="default">print_r</span><span class="keyword">(</span><span class="default">$response</span><span class="keyword">);
<br />

<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="87342""></a>
  <div class="note">
   <strong class="user">fnjordy at gmail dot com</strong>
   <a href="#87342" class="date">01-Dec-2008 08:48</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
There is no CURLOPT_MAXFILESIZE in the PHP module but it's function only works with Content-Length headers anyway.&nbsp; There are two ways of checking download sizes, one is after the download is complete using filesize(), the other is as the download is running allowing you to terminate before wasting time and disk space.
<br />

<br />
<span class="default">&lt;?php
<br />
$GLOBALS</span><span class="keyword">[</span><span class="string">'file_size'</span><span class="keyword">] = </span><span class="default">0</span><span class="keyword">;
<br />
</span><span class="default">$GLOBALS</span><span class="keyword">[</span><span class="string">'max_file_size'</span><span class="keyword">] = </span><span class="default">1024 </span><span class="keyword">* </span><span class="default">1024</span><span class="keyword">;
<br />
function </span><span class="default">on_curl_header</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">, </span><span class="default">$header</span><span class="keyword">)
<br />
{
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$trimmed </span><span class="keyword">= </span><span class="default">rtrim</span><span class="keyword">(</span><span class="default">$header</span><span class="keyword">);&nbsp; &nbsp; 
<br />
&nbsp;&nbsp;&nbsp; if (</span><span class="default">preg_match</span><span class="keyword">(</span><span class="string">'/^Content-Length: (\d+)$/'</span><span class="keyword">, </span><span class="default">$trimmed</span><span class="keyword">, </span><span class="default">$matches</span><span class="keyword">))
<br />
&nbsp;&nbsp;&nbsp; {
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$file_size </span><span class="keyword">= </span><span class="default">$matches</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">];
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">$file_size </span><span class="keyword">&gt; </span><span class="default">$GLOBALS</span><span class="keyword">[</span><span class="string">'max_file_size'</span><span class="keyword">]) {
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// handle error here.
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">}
<br />
&nbsp;&nbsp;&nbsp; }
<br />
&nbsp;&nbsp;&nbsp; return </span><span class="default">strlen</span><span class="keyword">(</span><span class="default">$header</span><span class="keyword">);
<br />
}
<br />

<br />
function </span><span class="default">on_curl_write</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">, </span><span class="default">$data</span><span class="keyword">)
<br />
{
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$bytes </span><span class="keyword">= </span><span class="default">strlen</span><span class="keyword">(</span><span class="default">$data</span><span class="keyword">);
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$GLOBALS</span><span class="keyword">[</span><span class="string">'file_size'</span><span class="keyword">] += </span><span class="default">$bytes</span><span class="keyword">;
<br />
&nbsp;&nbsp;&nbsp; if (</span><span class="default">$GLOBALS</span><span class="keyword">[</span><span class="string">'file_size'</span><span class="keyword">] &gt; </span><span class="default">$GLOBALS</span><span class="keyword">[</span><span class="string">'max_file_size'</span><span class="keyword">]) {
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// handle error here.
<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">}
<br />
&nbsp;&nbsp;&nbsp; return </span><span class="default">$bytes</span><span class="keyword">;
<br />
}
<br />

<br />
</span><span class="default">$ch </span><span class="keyword">= </span><span class="default">curl_init</span><span class="keyword">();
<br />
</span><span class="default">$options </span><span class="keyword">= array(</span><span class="default">CURLOPT_URL&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="keyword">=&gt; </span><span class="string">'<a href="http://www.php.net/" rel="nofollow" target="_blank">http://www.php.net/</a>'</span><span class="keyword">,
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">CURLOPT_HEADER&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="keyword">=&gt; </span><span class="default">false</span><span class="keyword">,
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">CURLOPT_HEADERFUNCTION&nbsp; &nbsp; </span><span class="keyword">=&gt; </span><span class="string">'on_curl_header'</span><span class="keyword">,
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">CURLOPT_WRITEFUNCTION&nbsp; &nbsp; </span><span class="keyword">=&gt; </span><span class="string">'on_curl_write'</span><span class="keyword">);
<br />
</span><span class="default">curl_setopt_array</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">, </span><span class="default">$options</span><span class="keyword">);
<br />
</span><span class="default">curl_exec</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">);
<br />
</span><span class="comment">// ...
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="68122""></a>
  <div class="note">
   <strong class="user">bendavis78 at gmail dot com</strong>
   <a href="#68122" class="date">14-Jul-2006 12:58</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
You can use CURLOPT_HEADERFUNCTION&nbsp; with a callback inside an object.&nbsp; This makes is it easy to capture the headers for later use.&nbsp; For example:
<br />

<br />
<span class="default">&lt;?php
<br />
</span><span class="keyword">class </span><span class="default">Test
<br />
</span><span class="keyword">{
<br />
&nbsp;&nbsp;&nbsp; public </span><span class="default">$headers</span><span class="keyword">;
<br />

<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">//...
<br />

<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">public function </span><span class="default">exec</span><span class="keyword">(</span><span class="default">$opts</span><span class="keyword">)
<br />
&nbsp;&nbsp;&nbsp; {
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">headers </span><span class="keyword">= array();
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$opts</span><span class="keyword">[</span><span class="default">CURLOPT_HEADERFUNCTION</span><span class="keyword">] = array(</span><span class="default">$this</span><span class="keyword">, </span><span class="string">'_setHeader'</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$ch </span><span class="keyword">= </span><span class="default">curl_init</span><span class="keyword">();
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">curl_setopt_array</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">, </span><span class="default">$opts</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">curl_exec</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">);
<br />
&nbsp;&nbsp;&nbsp; }
<br />

<br />
&nbsp;&nbsp;&nbsp; private function </span><span class="default">_setHeader</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">, </span><span class="default">$header</span><span class="keyword">)
<br />
&nbsp;&nbsp;&nbsp; {
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">headers</span><span class="keyword">[] = </span><span class="default">$header</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">strlen</span><span class="keyword">(</span><span class="default">$header</span><span class="keyword">);
<br />
&nbsp;&nbsp;&nbsp; }
<br />

<br />
&nbsp;&nbsp;&nbsp; 
<br />
}
<br />

<br />
</span><span class="default">$test </span><span class="keyword">= new </span><span class="default">Test</span><span class="keyword">();
<br />
</span><span class="default">$opts </span><span class="keyword">= array(
<br />
&nbsp;&nbsp; </span><span class="comment">//... your curl opts here
<br />
</span><span class="keyword">);
<br />
</span><span class="default">$data </span><span class="keyword">= </span><span class="default">$test</span><span class="keyword">-&gt;</span><span class="default">exec</span><span class="keyword">(</span><span class="default">$opts</span><span class="keyword">);
<br />
</span><span class="default">print_r</span><span class="keyword">(</span><span class="default">$test</span><span class="keyword">-&gt;</span><span class="default">headers</span><span class="keyword">);
<br />
</span><span class="default">?&gt;
<br />
</span>
<br />
...something like that
<br />

<br />
(This works in php v. 5.1.4)</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
</div>
</div>
</div></div></body></html>
