<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
 <head>
  <meta http-equiv="content-type" content="text/html; CHARSET=shift-jis">
  <title>バイナリの IPTC ブロックのタグをパースする</title>

  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <link media="all" rel="stylesheet" type="text/css" href="style.css"/>
 </head>
 <body class="docs" class="docs"><div class="navbar navbar-fixed-top">
  <div class="navbar-inner clearfix">
    <ul class="nav" style="width: 100%">
      <li style="float: left;"><a href="function.iptcembed.html">≪ iptcembed</a></li>
      <li style="float: right;"><a href="function.jpeg2wbmp.html">jpeg2wbmp ≫</a></li>
    </ul>
  </div>
</div>
<div id="breadcrumbs" class="clearfix">
  <ul class="breadcrumbs-container">
    <li><a href="index.html">PHP Manual</a></li>
    <li><a href="ref.image.html">GD および Image 関数</a></li>
    <li>バイナリの IPTC ブロックのタグをパースする</li>
  </ul>
</div>
<div id="layout">
  <div id="layout-content"><div id="function.iptcparse" class="refentry">
 <div class="refnamediv">
  <h1 class="refname">iptcparse</h1>
  <p class="verinfo">(PHP 4, PHP 5)</p><p class="refpurpose"><span class="refname">iptcparse</span> &mdash; <span class="dc-title">バイナリの IPTC ブロックのタグをパースする</span></p>

 </div>
 <div class="refsect1 description" id="refsect1-function.iptcparse-description">
  <h3 class="title">説明</h3>
  <div class="methodsynopsis dc-description">
   <span class="type">array</span> <span class="methodname"><strong>iptcparse</strong></span>
    ( <span class="methodparam"><span class="type">string</span> <code class="parameter">$iptcblock</code></span>
   )</div>

  <p class="para rdfs-comment">
   <a href="http://www.iptc.org/" class="link external" title="Link : http://www.iptc.org/">&raquo;&nbsp;IPTC</a> ブロックをパースします。
  </p>
 </div>

 <div class="refsect1 parameters" id="refsect1-function.iptcparse-parameters">
  <h3 class="title">パラメータ</h3>
  <p class="para">
   <dl>

    
     <dt>
<code class="parameter">iptcblock</code></dt>

     <dd>

      <p class="para">
       バイナリ IPTC ブロック。
      </p>
     </dd>

    
   </dl>

  </p>
 </div>

 <div class="refsect1 returnvalues" id="refsect1-function.iptcparse-returnvalues">
  <h3 class="title">返り値</h3>
  <p class="para">
   タグマーカーをインデックスとし、その値を保持する配列を返します。
   エラー時や IPTC データが見つからなかったときは <strong><code>FALSE</code></strong> を返します。
  </p>
 </div>

 <div class="refsect1 examples" id="refsect1-function.iptcparse-examples">
  <h3 class="title">例</h3>
  <p class="para">
   <div class="example" id="example-3387">
    <p><strong>例1 iptcparse() を <span class="function"><a href="function.getimagesize.html" class="function">getimagesize()</a></span> と組み合わせる使用法</strong></p>
    <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br />$size&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">getimagesize</span><span style="color: #007700">(</span><span style="color: #DD0000">'./test.jpg'</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$info</span><span style="color: #007700">);<br />if(isset(</span><span style="color: #0000BB">$info</span><span style="color: #007700">[</span><span style="color: #DD0000">'APP13'</span><span style="color: #007700">]))<br />{<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$iptc&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">iptcparse</span><span style="color: #007700">(</span><span style="color: #0000BB">$info</span><span style="color: #007700">[</span><span style="color: #DD0000">'APP13'</span><span style="color: #007700">]);<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">var_dump</span><span style="color: #007700">(</span><span style="color: #0000BB">$iptc</span><span style="color: #007700">);<br />}<br /></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
    </div>

   </div>
  </p>
 </div>


 <div class="refsect1 notes" id="refsect1-function.iptcparse-notes">
  <h3 class="title">注意</h3>
  <blockquote class="note"><p><strong class="note">注意</strong>: <p class="para">この関数は、GD 画像ライブラリを必要としません。</p></p></blockquote>
 </div>


</div><div id="usernotes">
 <div class="head">
  <h3 class="title">User Contributed Notes</h3>
 </div>
<div id="allnotes">  <a name="113148""></a>
  <div class="note">
   <strong class="user">tomasz at trejderowski dot pl</strong>
   <a href="#113148" class="date">05-Sep-2013 10:39</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I've managed to update "pkrohn at daemonize dot com" array, after 12 years since initial publication.<br />
<br />
If you want to change some of IPCT header-strings into something more human-readable, try to use array similar to this:<br />
<br />
$iptcHeaderArray = array<br />
(<br />
&nbsp;&nbsp;&nbsp; '2#005'=&gt;'DocumentTitle',<br />
&nbsp;&nbsp;&nbsp; '2#010'=&gt;'Urgency',<br />
&nbsp;&nbsp;&nbsp; '2#015'=&gt;'Category',<br />
&nbsp;&nbsp;&nbsp; '2#020'=&gt;'Subcategories',<br />
&nbsp;&nbsp;&nbsp; '2#040'=&gt;'SpecialInstructions',<br />
&nbsp;&nbsp;&nbsp; '2#055'=&gt;'CreationDate',<br />
&nbsp;&nbsp;&nbsp; '2#080'=&gt;'AuthorByline',<br />
&nbsp;&nbsp;&nbsp; '2#085'=&gt;'AuthorTitle',<br />
&nbsp;&nbsp;&nbsp; '2#090'=&gt;'City',<br />
&nbsp;&nbsp;&nbsp; '2#095'=&gt;'State',<br />
&nbsp;&nbsp;&nbsp; '2#101'=&gt;'Country',<br />
&nbsp;&nbsp;&nbsp; '2#103'=&gt;'OTR',<br />
&nbsp;&nbsp;&nbsp; '2#105'=&gt;'Headline',<br />
&nbsp;&nbsp;&nbsp; '2#110'=&gt;'Source',<br />
&nbsp;&nbsp;&nbsp; '2#115'=&gt;'PhotoSource',<br />
&nbsp;&nbsp;&nbsp; '2#116'=&gt;'Copyright',<br />
&nbsp;&nbsp;&nbsp; '2#120'=&gt;'Caption',<br />
&nbsp;&nbsp;&nbsp; '2#122'=&gt;'CaptionWriter'<br />
);</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="105025""></a>
  <div class="note">
   <strong class="user">www.peterdebruin.net</strong>
   <a href="#105025" class="date">22-Jul-2011 10:12</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Nowadays IPTC captions may be encoded in UTF-8.
<br />
In that case, IPTC tag CodedCharacterSet would be set to "ESC % G".
<br />
This tag has tag marker "1#090".
<br />
To decode such a caption into simple ISO-8859-1, you could use the following code:
<br />

<br />
<span class="default">&lt;?php
<br />
$IPTC_Caption </span><span class="keyword">= </span><span class="string">""</span><span class="keyword">;
<br />
</span><span class="default">$size </span><span class="keyword">= </span><span class="default">getimagesize</span><span class="keyword">( </span><span class="default">$image_path</span><span class="keyword">, </span><span class="default">$info </span><span class="keyword">);
<br />
if (isset(</span><span class="default">$info</span><span class="keyword">[</span><span class="string">"APP13"</span><span class="keyword">])) {
<br />
&nbsp;&nbsp;&nbsp; if(</span><span class="default">$iptc </span><span class="keyword">= </span><span class="default">iptcparse</span><span class="keyword">( </span><span class="default">$info</span><span class="keyword">[</span><span class="string">"APP13"</span><span class="keyword">] ) ) {
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$IPTC_Caption </span><span class="keyword">= </span><span class="default">str_replace</span><span class="keyword">( </span><span class="string">"\000"</span><span class="keyword">, </span><span class="string">""</span><span class="keyword">, </span><span class="default">$iptc</span><span class="keyword">[</span><span class="string">"2#120"</span><span class="keyword">][</span><span class="default">0</span><span class="keyword">] );
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if(isset(</span><span class="default">$iptc</span><span class="keyword">[</span><span class="string">"1#090"</span><span class="keyword">]) &amp;&amp; </span><span class="default">$iptc</span><span class="keyword">[</span><span class="string">"1#090"</span><span class="keyword">][</span><span class="default">0</span><span class="keyword">] == </span><span class="string">"\x1B%G"</span><span class="keyword">)
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$IPTC_Caption </span><span class="keyword">= </span><span class="default">utf8_decode</span><span class="keyword">(</span><span class="default">$IPTC_Caption</span><span class="keyword">);
<br />
&nbsp;&nbsp;&nbsp; }
<br />
}
<br />
</span><span class="default">?&gt;
<br />
</span>
<br />
Of course, this will only preserve ISO-8859-1 characters.
<br />
For proper Unicode support, you should convert UTF-8 byte sequences into HTML character entities, or encode the whole web page in UTF-8.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="45360""></a>
  <div class="note">
   <strong class="user">michael wells</strong>
   <a href="#45360" class="date">03-Sep-2004 02:06</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
To import IPTC keywords (which are stored in an array) into a scalar, try this sort of approach:<br />
<br />
$keywordcount = count($iptc["2#025"]);<br />
for ($i=0; $i&lt;$keywordcount; $i++) $keywords .= $iptc["2#025"][$i] . " ";<br />
<br />
(you could strip the trailing space if you wanted).<br />
<br />
If you are importing data from some Mac applications, they may put chr(213) into strings to access a closing quote character. This prints as a captial O with a tilde above it in a web browser or on Windows. You can fix this with:<br />
<br />
function ConvertChars($in)<br />
{<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return str_replace(chr(213),"'",$in);<br />
}<br />
<br />
We use aspects of this code at www.thirdlight.com when parsing IPTC tags. XMP seems to be the better solution these days (being XML based is a great improvement!!).</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="44547""></a>
  <div class="note">
   <strong class="user">evan at nospam dot ozhiker dot com</strong>
   <a href="#44547" class="date">09-Aug-2004 06:57</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
You might have noticed that several metadata fields in Photoshop are not available via IPTC. <br />
<br />
I have written a library "PHP JPEG Metadata Toolkit" which fixes this problem as it allows reading, writing and interpreting of virtually any type of metadata, including these missing fields.<br />
<br />
Try it out, and download it at: <br />
<a href="http://www.ozhiker.com/electronics/pjmt/index.html" rel="nofollow" target="_blank">http://www.ozhiker.com/electronics/pjmt/index.html</a></span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="39650""></a>
  <div class="note">
   
   <a href="#39650" class="date">06-Feb-2004 08:17</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
View all availiable IPCT Data<br />
<br />
function output_iptc_data( $image_path ) {&nbsp; &nbsp; <br />
&nbsp;&nbsp;&nbsp; $size = getimagesize ( $image_path, $info);&nbsp; &nbsp; &nbsp; &nbsp; <br />
&nbsp;&nbsp; &nbsp; if(is_array($info)) {&nbsp; &nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $iptc = iptcparse($info["APP13"]);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; foreach (array_keys($iptc) as $s) {&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $c = count ($iptc[$s]);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; for ($i=0; $i &lt;$c; $i++) <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; echo $s.' = '.$iptc[$s][$i].'&lt;br&gt;';<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br />
&nbsp;&nbsp;&nbsp; }&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <br />
}</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="25992""></a>
  <div class="note">
   <strong class="user">Scin</strong>
   <a href="#25992" class="date">15-Oct-2002 12:52</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If you are not sure where a particular value you entered into the IPTC block in photoshop or any other software is being stored, simply run a foreach loop thru the block and find out:<br />
<br />
(Insert a new paragraph in the beggening of the first echo)<br />
<br />
$size = GetImageSize ("testimg.jpg", &amp;$info);<br />
$iptc = iptcparse($info["APP13"]);<br />
<br />
foreach($iptc as $key =&gt; $value)<br />
{<br />
&nbsp;&nbsp;&nbsp; echo "&lt;b&gt;IPTC Key:&lt;/b&gt; $key &lt;b&gt;Contents:&lt;/b&gt; ";<br />
&nbsp;&nbsp;&nbsp; foreach($value as $innerkey =&gt; $innervalue)<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if( ($innerkey+1) != count($value) )<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; echo "$innervalue, ";<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; else<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; echo "$innervalue";<br />
&nbsp;&nbsp;&nbsp; }<br />
}</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="21032""></a>
  <div class="note">
   
   <a href="#21032" class="date">26-Apr-2002 04:28</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Just to add to the above response, he missed a couple of IPTC tags:<br />
<br />
Keywords:<br />
$iptc["2#025"][n];&nbsp;&nbsp; (there is a list of keywords)<br />
<br />
Caption Writer:<br />
$iptc["2#122"][0];<br />
<br />
Just figured I'd note it, as the keywords can be quite important for database applications.&nbsp; I got these by extracting IPTC tags from a Photoshop 6.0 file, so hopefully they are standardized ;)</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="14063""></a>
  <div class="note">
   <strong class="user">pkrohn at daemonize dot com</strong>
   <a href="#14063" class="date">16-Jul-2001 01:35</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
This took me longer than it ought to to figure out. Very handy for handling a stream of photos where the info you want is in the IPTC header. This example passes by reference, for which PHP4 will yell at you. If your need to write into the header, check out the Image::IPTCInfo Perl module.
<br />

<br />
$size = GetImageSize ("$image_name",&amp;$info);
<br />
$iptc = iptcparse ($info["APP13"]);
<br />
if (isset($info["APP13"])) {
<br />
&nbsp;&nbsp;&nbsp; $iptc = iptcparse($info["APP13"]){
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if (is_array($iptc)) {
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $caption = $iptc["2#120"][0];
<br />
&nbsp;&nbsp;&nbsp; $graphic_name = $iptc["2#005"][0];
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $urgency = $iptc["2#010"][0];&nbsp; &nbsp; 
<br />
&nbsp;&nbsp;&nbsp; $category = $iptc["2#015"][0];&nbsp; &nbsp; 
<br />
&nbsp;&nbsp;&nbsp; // note that sometimes supp_categories contans multiple entries
<br />
$supp_categories = $iptc["2#020"][0];
<br />
$spec_instr = $iptc["2#040"][0];
<br />
$creation_date = $iptc["2#055"][0];
<br />
$photog = $iptc["2#080"][0];
<br />
$credit_byline_title = $iptc["2#085"][0];
<br />
$city = $iptc["2#090"][0];
<br />
$state = $iptc["2#095"][0];
<br />
$country = $iptc["2#101"][0];
<br />
$otr = $iptc["2#103"][0];
<br />
$headline = $iptc["2#105"][0];
<br />
$source = $iptc["2#110"][0];
<br />
$photo_source = $iptc["2#115"][0];
<br />
$caption = $iptc["2#120"][0];&nbsp; &nbsp; }}</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
</div>
</div>
</div></div></body></html>
