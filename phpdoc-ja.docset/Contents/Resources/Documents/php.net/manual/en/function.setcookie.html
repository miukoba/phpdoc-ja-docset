<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
 <head>
  <meta http-equiv="content-type" content="text/html; CHARSET=shift-jis">
  <title>クッキーを送信する</title>

  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <link media="all" rel="stylesheet" type="text/css" href="style.css"/>
 </head>
 <body class="docs" class="docs"><div class="navbar navbar-fixed-top">
  <div class="navbar-inner clearfix">
    <ul class="nav" style="width: 100%">
      <li style="float: left;"><a href="function.pfsockopen.html">≪ pfsockopen</a></li>
      <li style="float: right;"><a href="function.setrawcookie.html">setrawcookie ≫</a></li>
    </ul>
  </div>
</div>
<div id="breadcrumbs" class="clearfix">
  <ul class="breadcrumbs-container">
    <li><a href="index.html">PHP Manual</a></li>
    <li><a href="ref.network.html">ネットワーク 関数</a></li>
    <li>クッキーを送信する</li>
  </ul>
</div>
<div id="layout">
  <div id="layout-content"><div id="function.setcookie" class="refentry">
 <div class="refnamediv">
  <h1 class="refname">setcookie</h1>
  <p class="verinfo">(PHP 4, PHP 5)</p><p class="refpurpose"><span class="refname">setcookie</span> &mdash; <span class="dc-title">クッキーを送信する</span></p>

 </div>
 
 <div class="refsect1 description" id="refsect1-function.setcookie-description">
  <h3 class="title">説明</h3>
  <div class="methodsynopsis dc-description">
   <span class="type">bool</span> <span class="methodname"><strong>setcookie</strong></span>
    ( <span class="methodparam"><span class="type">string</span> <code class="parameter">$name</code></span>
   [, <span class="methodparam"><span class="type">string</span> <code class="parameter">$value</code></span>
   [, <span class="methodparam"><span class="type">int</span> <code class="parameter">$expire</code><span class="initializer"> = 0</span></span>
   [, <span class="methodparam"><span class="type">string</span> <code class="parameter">$path</code></span>
   [, <span class="methodparam"><span class="type">string</span> <code class="parameter">$domain</code></span>
   [, <span class="methodparam"><span class="type">bool</span> <code class="parameter">$secure</code><span class="initializer"> = false</span></span>
   [, <span class="methodparam"><span class="type">bool</span> <code class="parameter">$httponly</code><span class="initializer"> = false</span></span>
  ]]]]]] )</div>

  <p class="para rdfs-comment">
   <span class="function"><strong>setcookie()</strong></span> は、その他のヘッダ情報と共に
   送信するクッキーを定義します。 ほかのヘッダ情報と同様に、
   クッキーは、スクリプトによる他のあらゆる出力よりも<em class="emphasis">前に</em>
   送信される必要があります（これはHTTPプロトコルの制約です）。
   <em>&lt;html&gt;</em> や <em>&lt;head&gt;</em> タグはもちろん
   空白も含め、あらゆる出力よりも前にこの関数をコールするようにしなければなりません。
  </p>
  <p class="para">
   一度クッキーが送信されると、次のページのロードからは
   <var class="varname"><var class="varname"><a href="reserved.variables.cookies.html" class="classname">$_COOKIE</a></var></var> や
   <var class="varname"><var class="varname">$HTTP_COOKIE_VARS</var></var> 配列によってクッキーにアクセスできます。
   <var class="varname"><var class="varname"><a href="reserved.variables.cookies.html" class="classname">$_COOKIE</a></var></var> のような
   <a href="language.variables.superglobals.html" class="link">スーパーグローバル</a> は
   PHP 4.1.0 以降で有効となることに注意してください。
   クッキーの値は <var class="varname"><var class="varname"><a href="reserved.variables.request.html" class="classname">$_REQUEST</a></var></var>
   配列からもアクセスできます。
  </p>
 </div>


 <div class="refsect1 parameters" id="refsect1-function.setcookie-parameters">
  <h3 class="title">パラメータ</h3>
  <p class="para">
   <code class="parameter">name</code> 以外の全ての引数はオプションです。
   全ての引数に関して引数の指定をスキップするために空文字列
   (<em class="emphasis">&quot;&quot;</em>) とすることが可能です。
   <code class="parameter">expire</code> および <code class="parameter">secure</code>
   は数値なので、空文字列でスキップすることはできません。代わりにゼロ
   (<em class="emphasis">0</em>) を使用してください。
  </p>
  <p class="para">
   <span class="function"><strong>setcookie()</strong></span> の各パラメータがどのように作用するのかを知るには
   <a href="http://www.faqs.org/rfcs/rfc6265" class="link external" title="Link : http://www.faqs.org/rfcs/rfc6265">&raquo;&nbsp;RFC 6265</a> を参照ください。
   <dl>

    
     <dt>
<code class="parameter">name</code></dt>

     <dd>

      <p class="para">
       クッキーの名前。
      </p>
     </dd>

    
    
     <dt>
<code class="parameter">value</code></dt>

     <dd>

      <p class="para">
       クッキーの値。この値はクライアントのコンピュータに保存されますので、
       重要な情報は格納しないでください。
       <code class="parameter">name</code> が <em>&#039;cookiename&#039;</em> だとすると、
       その値は <var class="varname"><var class="varname"><a href="reserved.variables.cookies.html" class="classname">$_COOKIE['cookiename']</a></var></var> で取得することができます。
      </p>
     </dd>

    
    
     <dt>
<code class="parameter">expire</code></dt>

     <dd>

      <p class="para">
       クッキーの有効期限。これは Unix タイムスタンプなので
       Epoch（1970 年 1 月 1 日）からの経過秒数となります。
       <span class="function"><a href="function.time.html" class="function">time()</a></span> または
       <span class="function"><a href="function.mktime.html" class="function">mktime()</a></span> 関数により
       返された現在のUNIX標準時に、期限としたい必要な秒数を加算したものを
       利用することができるでしょう。
       <em>time()+60*60*24*30</em>
       はクッキーの有効期限を 30 日後にセットします。
       0 を設定したり省略したりした場合は、クッキーはセッションの最後
       (つまりブラウザを閉じるとき) が有効期限となります。
      </p>
      <p class="para">
       <blockquote class="note"><p><strong class="note">注意</strong>: 
        <p class="para">
         <code class="parameter">expire</code> パラメータには、<em>Wdy, DD-Mon-YYYY
         HH:MM:SS GMT</em> といった形式ではなく Unix
         タイムスタンプを渡していることにお気づきでしょうか。
         これは、PHP の内部で自動的に変換を行っているからです。
        </p>
       </p></blockquote>
      </p>
     </dd>

    
    
     <dt>
<code class="parameter">path</code></dt>

     <dd>

      <p class="para">
       サーバー上での、クッキーを有効としたいパス
       <em>&#039;/&#039;</em> をセットすると、クッキーは
       <code class="parameter">domain</code> 配下の全てで有効となります。
       <em>&#039;/foo/&#039;</em> をセットすると、クッキーは
       <em>/foo/</em> ディレクトリとそのサブディレクトリ配下
       (例えば <em>/foo/bar/</em>) で有効となります。
       デフォルト値は、クッキーがセットされたときのカレントディレクトリです。
      </p>
     </dd>

    
    
     <dt>
<code class="parameter">domain</code></dt>

     <dd>

      <p class="para">
       クッキーが有効なドメイン。ドメインを
       <em>&#039;www.example.com&#039;</em> に設定すると、
       <em>www</em> サブドメインおよびその上位のサブドメインでクッキーが使えるようになります。
       より低レベルのドメイン、たとえば
       <em>&#039;example.com&#039;</em> でクッキーを有効にすると、その上位にある
       <em>&#039;www.example.com&#039;</em> などのサブドメインでもクッキーが有効になります。
       
       古いブラウザの中には、非推奨になった
       <a href="http://www.faqs.org/rfcs/rfc2109" class="link external" title="Link : http://www.faqs.org/rfcs/rfc2109">&raquo;&nbsp;RFC 2109</a> を実装しているものが未だに残っているかもしれません。
       そのようなブラウザでは、すべてのサブドメインにマッチさせるためには先頭に
       <em>.</em> が必要となります。
      </p>
     </dd>

    
    
     <dt>
<code class="parameter">secure</code></dt>

     <dd>

      <p class="para">
       クライアントからのセキュアな HTTPS 接続の場合にのみクッキーが送信されるようにします。
       <strong><code>TRUE</code></strong> を設定すると、セキュアな接続が存在する場合にのみクッキーを設定します。
       サーバー側では、このようにセキュアな接続の場合にのみクッキーを送信するという処理は
       プログラマの責任で行うことになります
       (たとえば <var class="varname"><var class="varname"><a href="reserved.variables.server.html" class="classname">$_SERVER["HTTPS"]</a></var></var> の内容を使用します)。
      </p>
     </dd>

    
    
     <dt>
<code class="parameter">httponly</code></dt>

     <dd>

      <p class="para">
       <strong><code>TRUE</code></strong> を設定すると、HTTP を通してのみクッキーにアクセスできるようになります。
       つまり、JavaScript のようなスクリプト言語からはアクセスできなくなるということです。
       この設定を使用すると、XSS 攻撃によって ID を盗まれる危険性を減らせる
       (が、すべてのブラウザがこの設定をサポートしているというわけではありません)
       と言われていますが、これはしばしば議論の対象となります。
       PHP 5.2.0 で追加されました。
       <strong><code>TRUE</code></strong> あるいは <strong><code>FALSE</code></strong> で指定します。
      </p>
     </dd>

    
   </dl>

  </p>
 </div>


 <div class="refsect1 returnvalues" id="refsect1-function.setcookie-returnvalues">
  <h3 class="title">返り値</h3>
  <p class="para">
   もしもこの関数をコールする前に何らかの出力がある場合には、
   <span class="function"><strong>setcookie()</strong></span> は失敗し <strong><code>FALSE</code></strong> を返します。
   <span class="function"><strong>setcookie()</strong></span> が正常に実行されると、<strong><code>TRUE</code></strong> を返します。
   この関数では、ユーザーがクッキーを受け入れたかどうかを判断することはできません。
  </p>
 </div>


 <div class="refsect1 examples" id="refsect1-function.setcookie-examples">
  <h3 class="title">例</h3>
  <p class="para">
   以下はクッキーを送信する例です。
   <div class="example" id="example-4599">
    <p><strong>例1 <span class="function"><strong>setcookie()</strong></span> での送信の例</strong></p>
    <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br />$value&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #DD0000">'something&nbsp;from&nbsp;somewhere'</span><span style="color: #007700">;<br /><br /></span><span style="color: #0000BB">setcookie</span><span style="color: #007700">(</span><span style="color: #DD0000">"TestCookie"</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$value</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">setcookie</span><span style="color: #007700">(</span><span style="color: #DD0000">"TestCookie"</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$value</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">time</span><span style="color: #007700">()+</span><span style="color: #0000BB">3600</span><span style="color: #007700">);&nbsp;&nbsp;</span><span style="color: #FF8000">/*&nbsp;有効期限は一時間です&nbsp;*/<br /></span><span style="color: #0000BB">setcookie</span><span style="color: #007700">(</span><span style="color: #DD0000">"TestCookie"</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$value</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">time</span><span style="color: #007700">()+</span><span style="color: #0000BB">3600</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">"/~rasmus/"</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">"example.com"</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">1</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
    </div>

   </div>
  </p>
  <p class="para">
   クッキーの value の部分は、クッキーの送信を行う際に自動的に
   URL エンコードされ、またクッキーを受信した際は、自動的にデコード
   されてクッキー名と同じ名前の変数に格納されることに注意してください。
   この挙動が気に入らない場合、もし PHP 5 を使用しているなら
   代わりに <span class="function"><a href="function.setrawcookie.html" class="function">setrawcookie()</a></span> を使ってください。
   スクリプト内部で TestCookie の内容を見たい場合は、
   以下のいずれかの例を使用します。
  </p>
  <p class="para">
   <div class="informalexample">
    <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br /></span><span style="color: #FF8000">//&nbsp;個々のクッキーを表示します<br /></span><span style="color: #007700">echo&nbsp;</span><span style="color: #0000BB">$_COOKIE</span><span style="color: #007700">[</span><span style="color: #DD0000">"TestCookie"</span><span style="color: #007700">];<br />echo&nbsp;</span><span style="color: #0000BB">$HTTP_COOKIE_VARS</span><span style="color: #007700">[</span><span style="color: #DD0000">"TestCookie"</span><span style="color: #007700">];<br /><br /></span><span style="color: #FF8000">//&nbsp;デバッグ／テスト用には、全てのクッキーを見る方法があります。<br /></span><span style="color: #0000BB">print_r</span><span style="color: #007700">(</span><span style="color: #0000BB">$_COOKIE</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
    </div>

   </div>
  </p>
  <p class="para">
   <div class="example" id="example-4600">
    <p><strong>例2 <span class="function"><strong>setcookie()</strong></span> による削除の例</strong></p>
    <div class="example-contents"><p>
     クッキーを削除する場合には、ブラウザの削除機構を起動するために
     必ず有効期限を過去に設定する必要があります。
     次に、先ほどの例で送信したクッキーを削除する例を示します。
    </p></div>
    <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br /></span><span style="color: #FF8000">//&nbsp;有効期限を一時間前に設定します<br /></span><span style="color: #0000BB">setcookie&nbsp;</span><span style="color: #007700">(</span><span style="color: #DD0000">"TestCookie"</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">""</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">time</span><span style="color: #007700">()&nbsp;-&nbsp;</span><span style="color: #0000BB">3600</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">setcookie&nbsp;</span><span style="color: #007700">(</span><span style="color: #DD0000">"TestCookie"</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">""</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">time</span><span style="color: #007700">()&nbsp;-&nbsp;</span><span style="color: #0000BB">3600</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">"/~rasmus/"</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">"example.com"</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">1</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
    </div>

   </div>
  </p>
  <p class="para">
   <div class="example" id="example-4601">
    <p><strong>例3 <span class="function"><strong>setcookie()</strong></span> と配列</strong></p>
    <div class="example-contents"><p>
     クッキー名で配列を記述することにより、クッキーの配列を設定することも可能です。
     これにより配列要素と同数のクッキーを設定されますが、
     クッキーがスクリプトに受信された際に、
     値はクッキー名を有する配列に置きかえられます。
    </p></div>
    <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br /></span><span style="color: #FF8000">//&nbsp;クッキーを設定します<br /></span><span style="color: #0000BB">setcookie</span><span style="color: #007700">(</span><span style="color: #DD0000">"cookie[three]"</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">"cookiethree"</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">setcookie</span><span style="color: #007700">(</span><span style="color: #DD0000">"cookie[two]"</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">"cookietwo"</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">setcookie</span><span style="color: #007700">(</span><span style="color: #DD0000">"cookie[one]"</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">"cookieone"</span><span style="color: #007700">);<br /><br /></span><span style="color: #FF8000">//&nbsp;ページを再読み込みした後に、表示します<br /></span><span style="color: #007700">if&nbsp;(isset(</span><span style="color: #0000BB">$_COOKIE</span><span style="color: #007700">[</span><span style="color: #DD0000">'cookie'</span><span style="color: #007700">]))&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;foreach&nbsp;(</span><span style="color: #0000BB">$_COOKIE</span><span style="color: #007700">[</span><span style="color: #DD0000">'cookie'</span><span style="color: #007700">]&nbsp;as&nbsp;</span><span style="color: #0000BB">$name&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #0000BB">$value</span><span style="color: #007700">)&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$name&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">htmlspecialchars</span><span style="color: #007700">(</span><span style="color: #0000BB">$name</span><span style="color: #007700">);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$value&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">htmlspecialchars</span><span style="color: #007700">(</span><span style="color: #0000BB">$value</span><span style="color: #007700">);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;echo&nbsp;</span><span style="color: #DD0000">"</span><span style="color: #0000BB">$name</span><span style="color: #DD0000">&nbsp;:&nbsp;</span><span style="color: #0000BB">$value</span><span style="color: #DD0000">&nbsp;&lt;br&nbsp;/&gt;\n"</span><span style="color: #007700">;<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br />}<br /></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
    </div>

    <div class="example-contents"><p>上の例の出力は以下となります。</p></div>
    <div class="example-contents screen">
<div class="cdata"><pre>
three : cookiethree
two : cookietwo
one : cookieone
</pre></div>
    </div>
   </div>
  </p>
 </div>


 <div class="refsect1 changelog" id="refsect1-function.setcookie-changelog">
  <h3 class="title">変更履歴</h3>
  <p class="para">
   <table class="doctable informaltable">
    
     <thead>
      <tr>
       <th>バージョン</th>
       <th>説明</th>
      </tr>

     </thead>

     <tbody class="tbody">
      <tr>
       <td>5.5.0</td>
       <td>
        クライアントに送出する Set-Cookie ヘッダに、Max-Age 属性も含めるようになりました。
       </td>
      </tr>

      <tr>
       <td>5.2.0</td>
       <td>
 <code class="parameter">httponly</code> パラメータが追加されました。
       </td>
      </tr>

     </tbody>
    
   </table>

  </p>
 </div>


 <div class="refsect1 notes" id="refsect1-function.setcookie-notes">
  <h3 class="title">注意</h3>
  <blockquote class="note"><p><strong class="note">注意</strong>: 
   <p class="para">
    この関数をコールする前でも出力できるように、
    スクリプトの全ての出力をサーバー内にバッファリングさせることができます。
    そのためには、<span class="function"><a href="function.ob-start.html" class="function">ob_start()</a></span> や <span class="function"><a href="function.ob-end-flush.html" class="function">ob_end_flush()</a></span>
    を使用するか、あるいは <var class="filename">php.ini</var> やサーバー設定ファイルの <em>output_buffering</em>
    を使用します。
   </p>
  </p></blockquote>
  <blockquote class="note"><p><strong class="note">注意</strong>: 
   <p class="para">
    PHPの <a href="ini.core.html#ini.register-globals" class="link">register_globals</a>
    ディレクティブが <em>on</em> になっている場合、
    クッキーは変数にも登録されています。
    以下の例では、<var class="varname"><var class="varname">$TestCookie</var></var> 変数が存在します。
    <var class="varname"><var class="varname"><a href="reserved.variables.cookies.html" class="classname">$_COOKIE</a></var></var> の使用することを推奨します。
   </p>
  </p></blockquote>
  <p class="para">
   陥りやすい失敗
   <ul class="itemizedlist">
    <li class="listitem">
     <span class="simpara">
      クッキーは、クッキーを有効にするために次にページをロードするまで
      アクセスすることができません。クッキーが正常にセットされたか
      テストするために、クッキーの有効期限が切れる前に次のページを
      ロードしてクッキーをチェックしてください。
      有効期限は <code class="parameter">expire</code> 引数でセットされます。
      クッキーの利用についてデバッグするのに良い方法は
      <em>print_r($_COOKIE);</em> をコールすることです。
     </span>
    </li>
    <li class="listitem">
     <span class="simpara">
      クッキーは設定されたものと同じパラメータで削除する必要があります。
      値が空文字列あるいは <strong><code>FALSE</code></strong> で、その他の全ての引数が前に setcookie
      をコールした時と同じである場合に、指定された名前のクッキーが
      リモートクライアント上から削除されます。
      内部的な動作として、これは値を &#039;deleted&#039; に変更した上で有効期限を
      1 年前に設定しています。
     </span>
    </li>
    <li class="listitem">
     <span class="simpara">
      クッキーの値として <strong><code>FALSE</code></strong> を設定すると、クッキーを削除しようとします。
      そのため、boolean 値は使用できません。その代わりとして、
      <strong><code>FALSE</code></strong> ではなく <em class="emphasis">0</em>、そして <strong><code>TRUE</code></strong>
      ではなく <em class="emphasis">1</em> を使用します。
     </span>
    </li>
    <li class="listitem">
     <span class="simpara">
      クッキー名で配列を記述することにより、
      クッキーの配列を設定することも可能ですが、複数のクッキー
      がユーザーのシステム上に保存されることになります。
      <span class="function"><a href="function.explode.html" class="function">explode()</a></span> を使用して
      ひとつのクッキー上に複数の名前と値をセットすることも
      考慮してください。<span class="function"><a href="function.serialize.html" class="function">serialize()</a></span>
      の使用はセキュリティーホールになり得るため、
      この目的のために使用することはお勧めしません。
     </span>
    </li>
   </ul>
  </p>
  <p class="simpara">
   <span class="function"><strong>setcookie()</strong></span> を複数回コールした場合は、コールした順番で実行されます。
  </p>
 </div>


 <div class="refsect1 seealso" id="refsect1-function.setcookie-seealso">
  <h3 class="title">参考</h3>
  <p class="para">
   <ul class="simplelist">
    <li class="member"><span class="function"><a href="function.header.html" class="function" rel="rdfs-seeAlso">header()</a> - 生の HTTP ヘッダを送信する</span></li>
    <li class="member"><span class="function"><a href="function.setrawcookie.html" class="function" rel="rdfs-seeAlso">setrawcookie()</a> - 値を URL エンコードせずにクッキーを送信する</span></li>
    <li class="member"><a href="features.cookies.html" class="link">クッキー</a></li>
    <li class="member"><a href="http://www.faqs.org/rfcs/rfc6265" class="link external" title="Link : http://www.faqs.org/rfcs/rfc6265">&raquo;&nbsp;RFC 6265</a></li>
    <li class="member"><a href="http://www.faqs.org/rfcs/rfc2109" class="link external" title="Link : http://www.faqs.org/rfcs/rfc2109">&raquo;&nbsp;RFC 2109</a></li>
   </ul>
  </p>
 </div>


</div><div id="usernotes">
 <div class="head">
  <h3 class="title">User Contributed Notes</h3>
 </div>
<div id="allnotes">  <a name="115356""></a>
  <div class="note">
   <strong class="user">ellert at vankoperen dot nl</strong>
   <a href="#115356" class="date">11-Jul-2014 07:58</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Caveat: if you use URL RewriteRules to get stuff like this: domain.com/bla/stuf/etc into parameters, you might run into a hickup when setting cookies.<br />
At least in my setup a change in one of the parameters resulted in the cookie not being 'there' anymore.<br />
The fix is simple: specify the domain. '/' will usualy do fine.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="113475""></a>
  <div class="note">
   <strong class="user">jbouvet at absolunet dot com</strong>
   <a href="#113475" class="date">16-Oct-2013 11:46</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
When deleting a cookie that was set in Javascript, add the path to the setcookie function, like so :<br />
<br />
setCookie('cookie_name', '', time()-3600, '/');</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="110324""></a>
  <div class="note">
   <strong class="user">herrkampfgarten at gmail dot com</strong>
   <a href="#110324" class="date">11-Oct-2012 05:08</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Please note that setting the expiry to some timestamp in the past is a common way to get rid of a cookie. However, depending on the value you might set to "invalidate" a cookie immediately, this may pose a threat to the privacy of your user's data, especially when it comes to session cookies. <br />
<br />
If you write "0" and "expire-in-the-past" into a session cookie, it remains on the client-side until the clean-up mechanism of the browser hits. (That might be anything from no-time to a very long time. I'm not even thinking of app-based mobile browsers that won't close properly or do their best to ignore standards and RFCs and stuff...)<br />
<br />
So, if you have sufficiently messed up your ways of picking up existing session IDs and write-closing their data to your server, the session's data might move from file "sess_(random)" to "sess_0", because that is exactly the identifier that is referred in the cookie.<br />
<br />
From now on (at least until your server decides to clean up) there is data laying open wide to anyone requesting the session "0". Which may happen by accident (i.e. another user gains an own "0"-cookie) or malice (i.e. forgery).<br />
<br />
Long story short, ALWAYS use an empty string instead of a "0" value for invalidating a session cookie.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="110193""></a>
  <div class="note">
   <strong class="user">walterquez</strong>
   <a href="#110193" class="date">29-Sep-2012 01:43</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Instead of this:
<br />
<span class="default">&lt;?php setcookie</span><span class="keyword">( </span><span class="string">"TestCookie"</span><span class="keyword">, </span><span class="default">$value</span><span class="keyword">, </span><span class="default">time</span><span class="keyword">()+(</span><span class="default">60</span><span class="keyword">*</span><span class="default">60</span><span class="keyword">*</span><span class="default">24</span><span class="keyword">*</span><span class="default">30</span><span class="keyword">) ); </span><span class="default">?&gt;
<br />
</span>
<br />
You can this:
<br />
<span class="default">&lt;?php setcookie</span><span class="keyword">( </span><span class="string">"TestCookie"</span><span class="keyword">, </span><span class="default">$value</span><span class="keyword">, </span><span class="default">strtotime</span><span class="keyword">( </span><span class="string">'+30 days' </span><span class="keyword">) ); </span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="109880""></a>
  <div class="note">
   <strong class="user">danielpopescu93 at gmail dot com</strong>
   <a href="#109880" class="date">30-Aug-2012 11:43</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Hei, so here is what problem I had, maybe it will help someone in the future:<br />
I couldn't delete a cookie, not even set it a different value. I think that is because it had a name following the rule FirstSecondThird. So it had uppercase letters. <br />
After I modified the name everithing worked. <br />
<br />
Another note:<br />
Just for safety you should put what you want to put in the cookie in a var first.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="109173""></a>
  <div class="note">
   <strong class="user">Bachsau</strong>
   <a href="#109173" class="date">26-Jun-2012 10:49</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Want to remove a cookie?<br />
<br />
Many people do it the complicated way:<br />
setcookie('name', 'content', time()-3600);<br />
<br />
But why do you make it so complicated and risk it not working, when the client's time is wrong? Why fiddle around with time();<br />
<br />
Here's the easiest way to unset a cookie:<br />
setcookie('name', 'content', 1);<br />
<br />
Thats it.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="105738""></a>
  <div class="note">
   <strong class="user">vanclute at gmail dot com</strong>
   <a href="#105738" class="date">11-Sep-2011 08:05</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I have been tearing my hair out wondering why a cookie would not delete.&nbsp; Despite countless discussions of reasons this can happen all over the internet, none of them addresses my case.&nbsp; Here is what was happening:<br />
<br />
My cookies have been formed kindof as an array, and the name of the cookie to be deleted is being passed in a variable, so I was using this to attempt to delete the cookie (stripped to the minimum for simplicity of the example):<br />
<br />
<span class="default">&lt;?php<br />
&nbsp;&nbsp;&nbsp; setcookie</span><span class="keyword">(</span><span class="string">"</span><span class="default">$cookiename</span><span class="keyword">[</span><span class="default">id</span><span class="keyword">]</span><span class="string">"</span><span class="keyword">);<br />
</span><span class="default">?&gt;<br />
</span><br />
But it simply would not work.&nbsp; Ultimately what DID work was this:<br />
<br />
<span class="default">&lt;?php<br />
&nbsp;&nbsp;&nbsp; setcookie</span><span class="keyword">(</span><span class="default">$cookiename</span><span class="keyword">.</span><span class="string">"[id]"</span><span class="keyword">);<br />
</span><span class="default">?&gt;<br />
</span><br />
So I had to concatenate the variable to the "element id" and then the cookies deleted without any issue.<br />
<br />
I hope this saves someone else from a sleepless night!!<br />
<br />
Jonathan</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="105120""></a>
  <div class="note">
   <strong class="user">mkmohsinali at gmail dot com</strong>
   <a href="#105120" class="date">28-Jul-2011 08:01</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
#cookies.php<br />
/*This code will demonstrate use of cookies with PHP<br />
It is very easy to understand and is better for beginner to<br />
understand and get idea about power of cookies when used<br />
with PHP.Here we give user a form to choose colors he/she<br />
likes for website and when he/she visits site again within one<br />
hour his/her settings are saved and read from cookie <br />
and he/she doesn't have to set the page color and page<br />
text color again.You can change time from 3600<br />
seconds to whatever you deem appropriate in your case.<br />
if you don't understand anything please email me*/<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="comment">#checking if form has been submitted<br />
</span><span class="keyword">if (isset(</span><span class="default">$_POST</span><span class="keyword">[</span><span class="string">'submitted'</span><span class="keyword">])){<br />
</span><span class="comment">#if yes (form is submitted) assign values from POST array to variables<br />
</span><span class="default">$newbgColor</span><span class="keyword">=</span><span class="default">$_POST</span><span class="keyword">[</span><span class="string">'bgColor'</span><span class="keyword">];<br />
</span><span class="default">$newtxtColor</span><span class="keyword">=</span><span class="default">$_POST</span><span class="keyword">[</span><span class="string">'txtColor'</span><span class="keyword">];<br />
</span><span class="comment">#set cookies<br />
</span><span class="default">setcookie</span><span class="keyword">(</span><span class="string">"bgColor"</span><span class="keyword">,</span><span class="default">$newbgColor</span><span class="keyword">,</span><span class="default">time</span><span class="keyword">()+</span><span class="default">3600</span><span class="keyword">);<br />
</span><span class="default">setcookie</span><span class="keyword">(</span><span class="string">"txtColor"</span><span class="keyword">,</span><span class="default">$newtxtColor</span><span class="keyword">,</span><span class="default">time</span><span class="keyword">()+</span><span class="default">3600</span><span class="keyword">);<br />
<br />
}<br />
</span><span class="comment">#in case user has come for first time and cookies are not set then<br />
</span><span class="keyword">if ((!isset(</span><span class="default">$_COOKIE</span><span class="keyword">[</span><span class="string">'bgColor'</span><span class="keyword">]) ) &amp;&amp; (!isset(</span><span class="default">$_COOKIE</span><span class="keyword">[</span><span class="string">'txtColor'</span><span class="keyword">]))){<br />
</span><span class="default">$bgColor </span><span class="keyword">= </span><span class="string">"Black"</span><span class="keyword">;<br />
</span><span class="default">$txtColor</span><span class="keyword">=</span><span class="string">"White"</span><span class="keyword">;<br />
}<br />
</span><span class="comment">#if cookies are set then use them<br />
</span><span class="keyword">else{<br />
</span><span class="default">$bgColor </span><span class="keyword">= </span><span class="default">$_COOKIE</span><span class="keyword">[</span><span class="string">'bgColor'</span><span class="keyword">];<br />
</span><span class="default">$txtColor </span><span class="keyword">= </span><span class="default">$_COOKIE</span><span class="keyword">[</span><span class="string">'txtColor'</span><span class="keyword">];<br />
}<br />
</span><span class="default">?&gt;<br />
</span>&lt;!-- HTML Page--&gt;<br />
&lt;html&gt;<br />
&lt;body bgcolor="<span class="default">&lt;?php </span><span class="keyword">echo </span><span class="default">$bgColor ?&gt;</span>" text="<span class="default">&lt;?php </span><span class="keyword">echo </span><span class="default">$txtColor ?&gt;</span>"&gt; <br />
&lt;form action= "<span class="default">&lt;?php </span><span class="keyword">echo </span><span class="default">$_SERVER</span><span class="keyword">[</span><span class="string">'PHP_SELF'</span><span class="keyword">]; </span><span class="default">?&gt;</span>" method ="POST"&gt;<br />
&lt;p&gt;Body Color:&lt;/p&gt;<br />
&lt;select name=bgColor&gt;<br />
&lt;option value ="Red"&gt;Red&lt;/option&gt;<br />
&lt;option value ="Green" selected&gt;Green&lt;/option&gt;<br />
&lt;option value ="Blue"&gt;Blue&lt;/option&gt;<br />
&lt;option value ="Yellow"&gt;Yellow&lt;/option&gt;<br />
&lt;option value ="Black"&gt;Black&lt;/option&gt;<br />
&lt;option value ="Brown"&gt;Brown&lt;/option&gt;<br />
&lt;option value ="White"&gt;White&lt;/option&gt;<br />
&lt;/select&gt;<br />
&lt;p&gt;Text Color:&lt;/p&gt;<br />
&lt;select name=txtColor&gt;<br />
&lt;tion value ="Red"&gt;Red&lt;/option&gt;<br />
&lt;option value ="Green" selected&gt;Green&lt;/option&gt;<br />
&lt;option value ="Blue"&gt;Blue&lt;/option&gt;<br />
&lt;option value ="Yellow"&gt;Yellow&lt;/option&gt;<br />
&lt;option value ="Black"&gt;Black&lt;/option&gt;<br />
&lt;option value ="Brown"&gt;Brown&lt;/option&gt;<br />
&lt;option value ="White"&gt;White&lt;/option&gt;<br />
&lt;/select&gt;<br />
&lt;input type ="hidden" name="submitted" value="true"&gt;&lt;/br&gt;<br />
&lt;input type="submit" value="remind"&gt;<br />
&lt;/form&gt;<br />
&lt;/body&gt;<br />
&lt;/html&gt;</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="104885""></a>
  <div class="note">
   <strong class="user">MrXCol</strong>
   <a href="#104885" class="date">13-Jul-2011 05:27</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If you're having problem with IE not accepting session cookies this could help:<br />
<br />
It seems the IE (6, 7, 8 and 9) do not accept the part 'Expire=0' when setting a session cookie. To fix it just don't put any expire at all. The default behavior when the 'Expire' is not set is to set the cookie as a session one. <br />
<br />
(Firefox doesn't complains, btw.)</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="104198""></a>
  <div class="note">
   <strong class="user">chris at styl dot ee</strong>
   <a href="#104198" class="date">31-May-2011 05:10</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I was searching for a simple example of creating a cookie, storing a random number and updating it on refresh. I couldn't find one so I had to figure it out on my own....<br />
<br />
- - - - <br />
One thing to *NOTE* is technically you can't update a cookie, you can only overwrite it with a new one with the same name.<br />
<br />
- - - -<br />
<br />
This creates a random number, stores it in a cookie, then references it on refresh, checks for duplicates and does necessary correction, then stores it again, rinse and repeat...<br />
<br />
<span class="default">&lt;?php<br />
ob_start</span><span class="keyword">();<br />
</span><span class="default">$MaxCount </span><span class="keyword">= </span><span class="default">4</span><span class="keyword">;</span><span class="comment">// set the max of the counter, in my tests "4" = (0,1,2,3) I adjusted below (+1) to get a "real" 4 (0,1,2,3,4) this is in reality 5 keys to humans, you can adjust script to eliminate "0", but my script makes use of the "0"<br />
<br />
</span><span class="default">$random </span><span class="keyword">=(</span><span class="default">rand</span><span class="keyword">()%(</span><span class="default">$MaxCount</span><span class="keyword">+</span><span class="default">1</span><span class="keyword">));</span><span class="comment">//give me a random number limited by the max, adding "1" because computers start counting at "0"<br />
<br />
</span><span class="keyword">if(!isset(</span><span class="default">$_COOKIE</span><span class="keyword">[</span><span class="string">'random'</span><span class="keyword">])){</span><span class="comment">// check if random number cookie is not set<br />
&nbsp;&nbsp;&nbsp; //echo"not set";<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">setcookie</span><span class="keyword">(</span><span class="string">'random'</span><span class="keyword">, </span><span class="default">$random</span><span class="keyword">);</span><span class="comment">//set the cookie for the first time<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">}else{<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$lastRandom</span><span class="keyword">= </span><span class="default">$_COOKIE</span><span class="keyword">[</span><span class="string">'random'</span><span class="keyword">]; </span><span class="comment">//hold the last number if it was set before<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">if(</span><span class="default">$lastRandom </span><span class="keyword">== </span><span class="default">$random</span><span class="keyword">){</span><span class="comment">//some logic to avoid repeats<br />
&nbsp;&nbsp; &nbsp; </span><span class="keyword">if(</span><span class="default">$random </span><span class="keyword">&lt; </span><span class="default">$MaxCount</span><span class="keyword">){</span><span class="comment">//if below max, add 1<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$random</span><span class="keyword">++;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">//echo "under the max, adding 1, ";&nbsp; &nbsp; <br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">}elseif(</span><span class="default">$random </span><span class="keyword">&gt;= (</span><span class="default">$MaxCount</span><span class="keyword">-</span><span class="default">1</span><span class="keyword">)){</span><span class="comment">// if for some reason the random number is more than max or equal to it -1, and an additional -1 for max count in initial var (so in reality this -1 from intial max var, and -1 from $random which should be the same number)<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$random</span><span class="keyword">--;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">//echo "hit the max, subtracting 1, ";<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">}else{<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$random</span><span class="keyword">++;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">//echo "no case match, adding 1, ";&nbsp; &nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">}<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">//echo "(".$lastRandom.", ".$random. "), they matched initally - was it fixed?";<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">}else{<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">//echo "(".$lastRandom.", ".$random. "), they DO NOT match";<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">setcookie</span><span class="keyword">(</span><span class="string">'random'</span><span class="keyword">, </span><span class="default">$random</span><span class="keyword">);&nbsp; &nbsp; <br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">//echo"is set: {$_COOKIE['random']}";<br />
</span><span class="keyword">}<br />
<br />
</span><span class="default">ob_end_flush</span><span class="keyword">();<br />
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="103629""></a>
  <div class="note">
   <strong class="user">bocian941 at pawno dot pl</strong>
   <a href="#103629" class="date">24-Apr-2011 09:51</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
My 2 functions to use "live cookies":
<br />

<br />
<span class="default">&lt;?php
<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">function </span><span class="default">SetCookieLive</span><span class="keyword">(</span><span class="default">$name</span><span class="keyword">, </span><span class="default">$value</span><span class="keyword">=</span><span class="string">''</span><span class="keyword">, </span><span class="default">$expire </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">, </span><span class="default">$path </span><span class="keyword">= </span><span class="string">''</span><span class="keyword">, </span><span class="default">$domain</span><span class="keyword">=</span><span class="string">''</span><span class="keyword">, </span><span class="default">$secure</span><span class="keyword">=</span><span class="default">false</span><span class="keyword">, </span><span class="default">$httponly</span><span class="keyword">=</span><span class="default">false</span><span class="keyword">)
<br />
&nbsp;&nbsp;&nbsp; {
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$_COOKIE</span><span class="keyword">[</span><span class="default">$name</span><span class="keyword">] = </span><span class="default">$value</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">setcookie</span><span class="keyword">(</span><span class="default">$name</span><span class="keyword">, </span><span class="default">$value</span><span class="keyword">, </span><span class="default">$expire</span><span class="keyword">, </span><span class="default">$path</span><span class="keyword">, </span><span class="default">$domain</span><span class="keyword">, </span><span class="default">$secure</span><span class="keyword">, </span><span class="default">$httponly</span><span class="keyword">);
<br />
&nbsp;&nbsp;&nbsp; }
<br />

<br />
&nbsp;&nbsp;&nbsp; function </span><span class="default">RemoveCookieLive</span><span class="keyword">(</span><span class="default">$name</span><span class="keyword">)
<br />
&nbsp;&nbsp;&nbsp; {
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; unset(</span><span class="default">$_COOKIE</span><span class="keyword">[</span><span class="default">$name</span><span class="keyword">]);
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">setcookie</span><span class="keyword">(</span><span class="default">$name</span><span class="keyword">, </span><span class="default">NULL</span><span class="keyword">, -</span><span class="default">1</span><span class="keyword">);
<br />
&nbsp;&nbsp;&nbsp; }
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="102436""></a>
  <div class="note">
   <strong class="user">jacobkamphansen at gmail dot com</strong>
   <a href="#102436" class="date">14-Feb-2011 02:05</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I've been pulling my hair for a couple of minutes (read: hours) and finally figured out why setcookie in my case, returned the "headers already sent"-error:<br />
<br />
The file in question was orignally saved as ANSI in Notepad and worked flawlessly, but when saved with UTF-8-encoding, it didn't work. So after trying phpDesigner 7, I was able to both save the file in UTF-8 AND remove the BOM (byte-order-mark which is output BEFORE the cookie is set and thereby fails everything).</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="102352""></a>
  <div class="note">
   <strong class="user">jdknock (at) gMaIl (dot) com</strong>
   <a href="#102352" class="date">10-Feb-2011 06:08</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
IE7 can have trouble with settings cookies that are embedded in an iframe. The problem lies with a W3C standard called Platform for Privacy Preferences or P3P for short.
<br />

<br />
To overcome, include the header:
<br />

<br />
header('P3P:CP="IDC DSP COR ADM DEVi TAIi PSA PSD IVAi IVDi CONi HIS OUR IND CNT"');
<br />

<br />
before setting the cookie.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="100174""></a>
  <div class="note">
   <strong class="user">karamfil dot pc at gmail dot com</strong>
   <a href="#100174" class="date">29-Sep-2010 02:10</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Beware of underscores in the hostname, because IE won't save cookies.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="100094""></a>
  <div class="note">
   <strong class="user">RC</strong>
   <a href="#100094" class="date">24-Sep-2010 04:50</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
For those of your banging your head as to why a cookie is not present when Internet Explorer 6 prints, the explanation is quite interesting. After a bit of investigation, a cookie with an expiration time other than 0 fails to be passed from IE6 to the server when printing. A cookie with an expiration time of 0 is sent.<br />
<br />
Therefore:<br />
<br />
setcookie("TestCookie", $value, time()+3600); //will not be sent from Print / Print Preview in IE6<br />
<br />
setcookie("TestCookie", $value, 0); //will be sent from Print / Print Preview in IE6<br />
<br />
I'll let everyone figure out who's bright idea it was to not send normal expiring cookies when printing in IE6...</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="99845""></a>
  <div class="note">
   <strong class="user">Anonymous</strong>
   <a href="#99845" class="date">10-Sep-2010 12:20</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
A period in a cookie name (like user.name) seems to show up in the $_COOKIE array as an underscore (so user_name). This means that for example $_COOKIE["user_name"] must be used to read a cookie that has been set with setcookie("user.name" ...), which is already rather confusing. <br />
<br />
Furthermore the variable $_COOKIE["user_name"] will retain the value set by setcookie("user.name" ...) and no amount of calling setcookie("user_name" ...) will alter this value. This is rather trivially fixed by clearing the "user.name" cookie, but it can take a while to realize this since there's only "user_name" in $_COOKIE.<br />
<br />
Hope this saves someone some time.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="97944""></a>
  <div class="note">
   <strong class="user">jay at w3prodigy dot com</strong>
   <a href="#97944" class="date">17-May-2010 09:31</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
You can also delete cookies by supplying setcookie an empty value.<br />
<br />
setcookie("w3p_cookie", "");</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="94398""></a>
  <div class="note">
   <strong class="user">dbessoudo at gmail dot com</strong>
   <a href="#94398" class="date">02-Nov-2009 05:58</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
setcookie - value = "deleted" on IE<br />
<br />
&nbsp; setcookie(session_name(), '', time()-42000, '/');<br />
<br />
When "setcookie" is passed an empty value (ie, ''), it changes the value to the string "deleted" and sets the date to exactly one year and one second in the past, ignoring the expiration parameter.*<br />
<br />
So, I'm guessing that if a client machine has its time set to more than a year in the past or if the browser is somehow broken, then a site visitor could potentially send a PHPSESSID with a value of "deleted".&nbsp; This will cause PHP to create a "sess_deleted" file in the sessions directory.<br />
<br />
In my case, I was seeing several incidents per minute, with each user clobbering the other's session data causing all kinds of security and identity issues.&nbsp; Two changes seemed to have solved the problem:<br />
<br />
1) Use session_id() in place of '' in setcookie, as well as pick a date that's far in the past (in this case Jan 1, 1970, 8:00:01AM):<br />
<br />
&nbsp;&nbsp;&nbsp; setcookie(session_name(), session_id(), 1, '/');<br />
<br />
2) Use session_regenerate_id() when logging a user in or otherwise changing their authority level.<br />
<br />
Hope this helps somebody.<br />
<br />
Rob<br />
<br />
* Here is the relevant code in head.c:<br />
<br />
&nbsp;&nbsp;&nbsp; if (value &amp;&amp; value_len == 0) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; /*&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; * MSIE doesn't delete a cookie when you set it to a null value&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; * so in order to force cookies to be deleted, even on MSIE, we&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; * pick an expiry date 1 year and 1 second in the past&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; */<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; time_t t = time(NULL) - 31536001;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; dt = php_format_date("D, d-M-Y H:i:s T", sizeof("D, d-M-Y H:i:s T")-1, t, 0 TSRMLS_CC);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; sprintf(cookie, "Set-Cookie: %s=deleted; expires=%s", name, dt);</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="94390""></a>
  <div class="note">
   <strong class="user">Eric</strong>
   <a href="#94390" class="date">02-Nov-2009 07:57</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
The server my php code is running on has sessions disabled so I am forced to store a fair bit of arbitrary data in cookies.&nbsp; Using array names was impractical and problematic, so I implemented a splitting routine.&nbsp; I do not serialize any class instances, just arrays and simple objects.
<br />

<br />
In a nutshell, when setting a cookie value, I serialize it, gzcompress it, base64 encode it, break it into pieces and store it as a set of cookies.&nbsp; To fetch the cookie value I get the named piece then iterate through piece names rebuilding the base64 data, then reverse the rest of the process.&nbsp; The only other trick is deleting the pieces correctly.
<br />

<br />
Sessions are better, but if they are not available this is a viable alternative.&nbsp; I chose gz over bz for compression because it looked faster with only slightly worse ratios.
<br />

<br />
Here is a simplified version of my implementation.&nbsp; This is a good starting point but is not suitable for most uses.&nbsp; For example, the domain and path are hard coded and no return values are checked for validity.
<br />

<br />
<span class="default">&lt;?php
<br />
define</span><span class="keyword">( </span><span class="string">'COOKIE_PORTIONS' </span><span class="keyword">, </span><span class="string">'_piece_' </span><span class="keyword">);
<br />

<br />
function </span><span class="default">clearpieces</span><span class="keyword">( </span><span class="default">$inKey </span><span class="keyword">, </span><span class="default">$inFirst </span><span class="keyword">) {
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$expire </span><span class="keyword">= </span><span class="default">time</span><span class="keyword">()-</span><span class="default">3600</span><span class="keyword">;
<br />
&nbsp;&nbsp;&nbsp; 
<br />
&nbsp;&nbsp;&nbsp; for ( </span><span class="default">$index </span><span class="keyword">= </span><span class="default">$inFirst </span><span class="keyword">; </span><span class="default">array_key_exists</span><span class="keyword">( </span><span class="default">$inKey</span><span class="keyword">.</span><span class="default">COOKIE_PORTIONS</span><span class="keyword">.</span><span class="default">$index </span><span class="keyword">, </span><span class="default">$_COOKIE </span><span class="keyword">) ; </span><span class="default">$index </span><span class="keyword">+= </span><span class="default">1 </span><span class="keyword">) {
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">setcookie</span><span class="keyword">( </span><span class="default">$inKey</span><span class="keyword">.</span><span class="default">COOKIE_PORTIONS</span><span class="keyword">.</span><span class="default">$index </span><span class="keyword">, </span><span class="string">'' </span><span class="keyword">, </span><span class="default">$expire </span><span class="keyword">, </span><span class="string">'/' </span><span class="keyword">, </span><span class="string">'' </span><span class="keyword">, </span><span class="default">0 </span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; unset( </span><span class="default">$_COOKIE</span><span class="keyword">[</span><span class="default">$inKey</span><span class="keyword">.</span><span class="default">COOKIE_PORTIONS</span><span class="keyword">.</span><span class="default">$index</span><span class="keyword">] );
<br />
&nbsp;&nbsp;&nbsp; }
<br />
}
<br />

<br />
function </span><span class="default">clearcookie</span><span class="keyword">( </span><span class="default">$inKey </span><span class="keyword">) {
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">clearpieces</span><span class="keyword">( </span><span class="default">$inKey </span><span class="keyword">, </span><span class="default">1 </span><span class="keyword">);
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">setcookie</span><span class="keyword">( </span><span class="default">$inKey </span><span class="keyword">, </span><span class="string">'' </span><span class="keyword">, </span><span class="default">time</span><span class="keyword">()-</span><span class="default">3600 </span><span class="keyword">, </span><span class="string">'/' </span><span class="keyword">, </span><span class="string">'' </span><span class="keyword">, </span><span class="default">0 </span><span class="keyword">);
<br />
&nbsp;&nbsp;&nbsp; unset( </span><span class="default">$_COOKIE</span><span class="keyword">[</span><span class="default">$inKey</span><span class="keyword">] );
<br />
}
<br />

<br />
function </span><span class="default">storecookie</span><span class="keyword">( </span><span class="default">$inKey </span><span class="keyword">, </span><span class="default">$inValue </span><span class="keyword">, </span><span class="default">$inExpire </span><span class="keyword">) {
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$decode </span><span class="keyword">= </span><span class="default">serialize</span><span class="keyword">( </span><span class="default">$inValue </span><span class="keyword">);
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$decode </span><span class="keyword">= </span><span class="default">gzcompress</span><span class="keyword">( </span><span class="default">$decode </span><span class="keyword">);
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$decode </span><span class="keyword">= </span><span class="default">base64_encode</span><span class="keyword">( </span><span class="default">$decode </span><span class="keyword">);
<br />
&nbsp;&nbsp;&nbsp; 
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$split </span><span class="keyword">= </span><span class="default">str_split</span><span class="keyword">( </span><span class="default">$decode </span><span class="keyword">, </span><span class="default">4000 </span><span class="keyword">);</span><span class="comment">//4k pieces
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$count </span><span class="keyword">= </span><span class="default">count</span><span class="keyword">( </span><span class="default">$split </span><span class="keyword">);
<br />
&nbsp;&nbsp;&nbsp; 
<br />
&nbsp;&nbsp;&nbsp; for ( </span><span class="default">$index </span><span class="keyword">= </span><span class="default">0 </span><span class="keyword">; </span><span class="default">$index </span><span class="keyword">&lt; </span><span class="default">$count </span><span class="keyword">; </span><span class="default">$index </span><span class="keyword">+= </span><span class="default">1 </span><span class="keyword">) {
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$result </span><span class="keyword">= </span><span class="default">setcookie</span><span class="keyword">( ( </span><span class="default">$index </span><span class="keyword">&gt; </span><span class="default">0 </span><span class="keyword">) ? </span><span class="default">$inKey</span><span class="keyword">.</span><span class="default">COOKIE_PORTIONS</span><span class="keyword">.</span><span class="default">$index </span><span class="keyword">: </span><span class="default">$inKey </span><span class="keyword">, </span><span class="default">$split</span><span class="keyword">[</span><span class="default">$index</span><span class="keyword">] , </span><span class="default">$inExpire </span><span class="keyword">, </span><span class="string">'/' </span><span class="keyword">, </span><span class="string">'' </span><span class="keyword">, </span><span class="default">0 </span><span class="keyword">);
<br />
&nbsp;&nbsp;&nbsp; }
<br />
&nbsp;&nbsp;&nbsp; 
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">clearpieces</span><span class="keyword">( </span><span class="default">$inKey </span><span class="keyword">, </span><span class="default">$count </span><span class="keyword">);
<br />
}
<br />

<br />
function </span><span class="default">fetchcookie</span><span class="keyword">( </span><span class="default">$inKey </span><span class="keyword">) {
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$decode </span><span class="keyword">= </span><span class="default">$_COOKIE</span><span class="keyword">[</span><span class="default">$inKey</span><span class="keyword">];
<br />
&nbsp;&nbsp;&nbsp; 
<br />
&nbsp;&nbsp;&nbsp; for ( </span><span class="default">$index </span><span class="keyword">= </span><span class="default">1 </span><span class="keyword">; </span><span class="default">array_key_exists</span><span class="keyword">( </span><span class="default">$inKey</span><span class="keyword">.</span><span class="default">COOKIE_PORTIONS</span><span class="keyword">.</span><span class="default">$index </span><span class="keyword">, </span><span class="default">$_COOKIE </span><span class="keyword">) ; </span><span class="default">$index </span><span class="keyword">+= </span><span class="default">1 </span><span class="keyword">) {
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$decode </span><span class="keyword">.= </span><span class="default">$_COOKIE</span><span class="keyword">[</span><span class="default">$inKey</span><span class="keyword">.</span><span class="default">COOKIE_PORTIONS</span><span class="keyword">.</span><span class="default">$index</span><span class="keyword">];
<br />
&nbsp;&nbsp;&nbsp; }
<br />
&nbsp;&nbsp;&nbsp; 
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$decode </span><span class="keyword">= </span><span class="default">base64_decode</span><span class="keyword">( </span><span class="default">$decode </span><span class="keyword">);
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$decode </span><span class="keyword">= </span><span class="default">gzuncompress</span><span class="keyword">( </span><span class="default">$decode </span><span class="keyword">);
<br />
&nbsp;&nbsp;&nbsp; 
<br />
&nbsp;&nbsp;&nbsp; return </span><span class="default">unserialize</span><span class="keyword">( </span><span class="default">$decode </span><span class="keyword">);
<br />
}
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="91140""></a>
  <div class="note">
   <strong class="user">laffen</strong>
   <a href="#91140" class="date">27-May-2009 10:49</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Note that the $_COOKIE variable not will hold multiple cookies with the same name. It is legitimate to set two cookies with the same name to the same host where the sub domain is different. <br />
<span class="default">&lt;?php<br />
setcookie</span><span class="keyword">(</span><span class="string">"testcookie"</span><span class="keyword">, </span><span class="string">"value1hostonly"</span><span class="keyword">, </span><span class="default">time</span><span class="keyword">(), </span><span class="string">"/"</span><span class="keyword">, </span><span class="string">".example.com"</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">true</span><span class="keyword">);<br />
</span><span class="default">setcookie</span><span class="keyword">(</span><span class="string">"testcookie"</span><span class="keyword">, </span><span class="string">"value2subdom"</span><span class="keyword">, </span><span class="default">time</span><span class="keyword">(), </span><span class="string">"/"</span><span class="keyword">, </span><span class="string">"subdom.example.com"</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">true</span><span class="keyword">);<br />
</span><span class="default">?&gt;<br />
</span>The next request from the browser will have both cookies in the $_SERVER['HTTP_COOKIE'] variable, but only one of them will be found in the $_COOKIE variable. Requests to subdom.example.com will have both cookies, while browser request to example.com or www.example.com only sends the cookie with the "value1hostonly" value.<br />
<br />
<span class="default">&lt;?php<br />
$kaker </span><span class="keyword">= </span><span class="default">explode</span><span class="keyword">(</span><span class="string">";"</span><span class="keyword">, </span><span class="default">$_SERVER</span><span class="keyword">[</span><span class="string">'HTTP_COOKIE'</span><span class="keyword">]);<br />
foreach(</span><span class="default">$kaker </span><span class="keyword">as </span><span class="default">$val</span><span class="keyword">){<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$k </span><span class="keyword">= </span><span class="default">explode</span><span class="keyword">(</span><span class="string">"="</span><span class="keyword">, </span><span class="default">$val</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; echo </span><span class="default">trim</span><span class="keyword">(</span><span class="default">$k</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">]) . </span><span class="string">" =&gt; " </span><span class="keyword">. </span><span class="default">$k</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">];<br />
}<br />
<br />
</span><span class="comment">// output<br />
</span><span class="default">testcookie </span><span class="keyword">=&gt; </span><span class="default">value1hostonly<br />
testcookie </span><span class="keyword">=&gt; </span><span class="default">value2subdom<br />
<br />
?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="84721""></a>
  <div class="note">
   <strong class="user">php at gigadepot dot com</strong>
   <a href="#84721" class="date">27-Jul-2008 07:17</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If you use a multiple cookie name with the function bellow
<br />

<br />
example : 
<br />

<br />
createcookie("member[name]","jack");
<br />

<br />
don't work with array
<br />

<br />
error with "rawurlencode($name)"
<br />

<br />
I'm use : createcookie(array('member'=&gt;'name'),'jack');
<br />

<br />
<span class="default">&lt;?php
<br />
createCookie</span><span class="keyword">(</span><span class="default">$name</span><span class="keyword">, </span><span class="default">$value</span><span class="keyword">=</span><span class="string">''</span><span class="keyword">, </span><span class="default">$maxage</span><span class="keyword">=</span><span class="default">0</span><span class="keyword">, </span><span class="default">$path</span><span class="keyword">=</span><span class="string">''</span><span class="keyword">,</span><span class="default">$domain</span><span class="keyword">=</span><span class="string">''</span><span class="keyword">, </span><span class="default">$secure</span><span class="keyword">=</span><span class="default">false</span><span class="keyword">, </span><span class="default">$HTTPOnly</span><span class="keyword">=</span><span class="default">false</span><span class="keyword">) 
<br />
&nbsp;&nbsp;&nbsp; {
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if(</span><span class="default">is_array</span><span class="keyword">(</span><span class="default">$name</span><span class="keyword">))
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; {
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; list(</span><span class="default">$k</span><span class="keyword">,</span><span class="default">$v</span><span class="keyword">)&nbsp; &nbsp; =&nbsp; &nbsp; </span><span class="default">each</span><span class="keyword">(</span><span class="default">$name</span><span class="keyword">);
<br />

<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$name&nbsp; &nbsp; </span><span class="keyword">=&nbsp; &nbsp; </span><span class="default">$k</span><span class="keyword">.</span><span class="string">'['</span><span class="keyword">.</span><span class="default">$v</span><span class="keyword">.</span><span class="string">']'</span><span class="keyword">;
<br />

<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$ob </span><span class="keyword">= </span><span class="default">ini_get</span><span class="keyword">(</span><span class="string">'output_buffering'</span><span class="keyword">); 
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// Abort the method if headers have already been sent, except when output buffering has been enabled 
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">if ( </span><span class="default">headers_sent</span><span class="keyword">() &amp;&amp; (bool) </span><span class="default">$ob </span><span class="keyword">=== </span><span class="default">false </span><span class="keyword">|| </span><span class="default">strtolower</span><span class="keyword">(</span><span class="default">$ob</span><span class="keyword">) == </span><span class="string">'off' </span><span class="keyword">) 
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">false</span><span class="keyword">; 
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if ( !empty(</span><span class="default">$domain</span><span class="keyword">) ) 
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; {
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// Fix the domain to accept domains with and without 'www.'. 
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">if ( </span><span class="default">strtolower</span><span class="keyword">( </span><span class="default">substr</span><span class="keyword">(</span><span class="default">$domain</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">4</span><span class="keyword">) ) == </span><span class="string">'www.' </span><span class="keyword">) </span><span class="default">$domain </span><span class="keyword">= </span><span class="default">substr</span><span class="keyword">(</span><span class="default">$domain</span><span class="keyword">, </span><span class="default">4</span><span class="keyword">); 
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// Add the dot prefix to ensure compatibility with subdomains 
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">if ( </span><span class="default">substr</span><span class="keyword">(</span><span class="default">$domain</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">1</span><span class="keyword">) != </span><span class="string">'.' </span><span class="keyword">) </span><span class="default">$domain </span><span class="keyword">= </span><span class="string">'.'</span><span class="keyword">.</span><span class="default">$domain</span><span class="keyword">; 
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// Remove port information. 
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$port </span><span class="keyword">= </span><span class="default">strpos</span><span class="keyword">(</span><span class="default">$domain</span><span class="keyword">, </span><span class="string">':'</span><span class="keyword">); 
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if ( </span><span class="default">$port </span><span class="keyword">!== </span><span class="default">false </span><span class="keyword">) </span><span class="default">$domain </span><span class="keyword">= </span><span class="default">substr</span><span class="keyword">(</span><span class="default">$domain</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">$port</span><span class="keyword">); 
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// Prevent "headers already sent" error with utf8 support (BOM) 
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; //if ( utf8_support ) header('Content-Type: text/html; CHARSET=shift-jis'); 
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">if(</span><span class="default">is_array</span><span class="keyword">(</span><span class="default">$name</span><span class="keyword">))
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; {
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">header</span><span class="keyword">(</span><span class="string">'Set-Cookie: '</span><span class="keyword">.</span><span class="default">$name</span><span class="keyword">.</span><span class="string">'='</span><span class="keyword">.</span><span class="default">rawurlencode</span><span class="keyword">(</span><span class="default">$value</span><span class="keyword">) 
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; .(empty(</span><span class="default">$domain</span><span class="keyword">) ? </span><span class="string">'' </span><span class="keyword">: </span><span class="string">'; Domain='</span><span class="keyword">.</span><span class="default">$domain</span><span class="keyword">) 
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; .(empty(</span><span class="default">$maxage</span><span class="keyword">) ? </span><span class="string">'' </span><span class="keyword">: </span><span class="string">'; Max-Age='</span><span class="keyword">.</span><span class="default">$maxage</span><span class="keyword">) 
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; .(empty(</span><span class="default">$path</span><span class="keyword">) ? </span><span class="string">'' </span><span class="keyword">: </span><span class="string">'; Path='</span><span class="keyword">.</span><span class="default">$path</span><span class="keyword">) 
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; .(!</span><span class="default">$secure </span><span class="keyword">? </span><span class="string">'' </span><span class="keyword">: </span><span class="string">'; Secure'</span><span class="keyword">) 
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; .(!</span><span class="default">$HTTPOnly </span><span class="keyword">? </span><span class="string">'' </span><span class="keyword">: </span><span class="string">'; HttpOnly'</span><span class="keyword">), </span><span class="default">false</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }else{
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">header</span><span class="keyword">(</span><span class="string">'Set-Cookie: '</span><span class="keyword">.</span><span class="default">rawurlencode</span><span class="keyword">(</span><span class="default">$name</span><span class="keyword">).</span><span class="string">'='</span><span class="keyword">.</span><span class="default">rawurlencode</span><span class="keyword">(</span><span class="default">$value</span><span class="keyword">) 
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; .(empty(</span><span class="default">$domain</span><span class="keyword">) ? </span><span class="string">'' </span><span class="keyword">: </span><span class="string">'; Domain='</span><span class="keyword">.</span><span class="default">$domain</span><span class="keyword">) 
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; .(empty(</span><span class="default">$maxage</span><span class="keyword">) ? </span><span class="string">'' </span><span class="keyword">: </span><span class="string">'; Max-Age='</span><span class="keyword">.</span><span class="default">$maxage</span><span class="keyword">) 
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; .(empty(</span><span class="default">$path</span><span class="keyword">) ? </span><span class="string">'' </span><span class="keyword">: </span><span class="string">'; Path='</span><span class="keyword">.</span><span class="default">$path</span><span class="keyword">) 
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; .(!</span><span class="default">$secure </span><span class="keyword">? </span><span class="string">'' </span><span class="keyword">: </span><span class="string">'; Secure'</span><span class="keyword">) 
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; .(!</span><span class="default">$HTTPOnly </span><span class="keyword">? </span><span class="string">'' </span><span class="keyword">: </span><span class="string">'; HttpOnly'</span><span class="keyword">), </span><span class="default">false</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">true</span><span class="keyword">; 
<br />
&nbsp;&nbsp;&nbsp; }
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="81398""></a>
  <div class="note">
   <strong class="user">isooik at gmail-antispam dot com</strong>
   <a href="#81398" class="date">26-Feb-2008 02:18</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Here's a more advanced version of the php setcookie() alternative function:
<br />

<br />
<span class="default">&lt;?php
<br />

<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">/**
<br />
&nbsp;&nbsp; &nbsp; * A better alternative (RFC 2109 compatible) to the php setcookie() function
<br />
&nbsp;&nbsp; &nbsp; *
<br />
&nbsp;&nbsp; &nbsp; * @param string Name of the cookie
<br />
&nbsp;&nbsp; &nbsp; * @param string Value of the cookie
<br />
&nbsp;&nbsp; &nbsp; * @param int Lifetime of the cookie
<br />
&nbsp;&nbsp; &nbsp; * @param string Path where the cookie can be used
<br />
&nbsp;&nbsp; &nbsp; * @param string Domain which can read the cookie
<br />
&nbsp;&nbsp; &nbsp; * @param bool Secure mode?
<br />
&nbsp;&nbsp; &nbsp; * @param bool Only allow HTTP usage?
<br />
&nbsp;&nbsp; &nbsp; * @return bool True or false whether the method has successfully run
<br />
&nbsp;&nbsp; &nbsp; */
<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">function </span><span class="default">createCookie</span><span class="keyword">(</span><span class="default">$name</span><span class="keyword">, </span><span class="default">$value</span><span class="keyword">=</span><span class="string">''</span><span class="keyword">, </span><span class="default">$maxage</span><span class="keyword">=</span><span class="default">0</span><span class="keyword">, </span><span class="default">$path</span><span class="keyword">=</span><span class="string">''</span><span class="keyword">, </span><span class="default">$domain</span><span class="keyword">=</span><span class="string">''</span><span class="keyword">, </span><span class="default">$secure</span><span class="keyword">=</span><span class="default">false</span><span class="keyword">, </span><span class="default">$HTTPOnly</span><span class="keyword">=</span><span class="default">false</span><span class="keyword">)
<br />
&nbsp;&nbsp;&nbsp; {
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$ob </span><span class="keyword">= </span><span class="default">ini_get</span><span class="keyword">(</span><span class="string">'output_buffering'</span><span class="keyword">);
<br />

<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// Abort the method if headers have already been sent, except when output buffering has been enabled
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">if ( </span><span class="default">headers_sent</span><span class="keyword">() &amp;&amp; (bool) </span><span class="default">$ob </span><span class="keyword">=== </span><span class="default">false </span><span class="keyword">|| </span><span class="default">strtolower</span><span class="keyword">(</span><span class="default">$ob</span><span class="keyword">) == </span><span class="string">'off' </span><span class="keyword">)
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">false</span><span class="keyword">;
<br />

<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if ( !empty(</span><span class="default">$domain</span><span class="keyword">) )
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; {
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// Fix the domain to accept domains with and without 'www.'.
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">if ( </span><span class="default">strtolower</span><span class="keyword">( </span><span class="default">substr</span><span class="keyword">(</span><span class="default">$domain</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">4</span><span class="keyword">) ) == </span><span class="string">'www.' </span><span class="keyword">) </span><span class="default">$domain </span><span class="keyword">= </span><span class="default">substr</span><span class="keyword">(</span><span class="default">$domain</span><span class="keyword">, </span><span class="default">4</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// Add the dot prefix to ensure compatibility with subdomains
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">if ( </span><span class="default">substr</span><span class="keyword">(</span><span class="default">$domain</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">1</span><span class="keyword">) != </span><span class="string">'.' </span><span class="keyword">) </span><span class="default">$domain </span><span class="keyword">= </span><span class="string">'.'</span><span class="keyword">.</span><span class="default">$domain</span><span class="keyword">;
<br />

<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// Remove port information.
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$port </span><span class="keyword">= </span><span class="default">strpos</span><span class="keyword">(</span><span class="default">$domain</span><span class="keyword">, </span><span class="string">':'</span><span class="keyword">);
<br />

<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if ( </span><span class="default">$port </span><span class="keyword">!== </span><span class="default">false </span><span class="keyword">) </span><span class="default">$domain </span><span class="keyword">= </span><span class="default">substr</span><span class="keyword">(</span><span class="default">$domain</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">$port</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }
<br />

<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// Prevent "headers already sent" error with utf8 support (BOM)
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; //if ( utf8_support ) header('Content-Type: text/html; CHARSET=shift-jis');
<br />

<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">header</span><span class="keyword">(</span><span class="string">'Set-Cookie: '</span><span class="keyword">.</span><span class="default">rawurlencode</span><span class="keyword">(</span><span class="default">$name</span><span class="keyword">).</span><span class="string">'='</span><span class="keyword">.</span><span class="default">rawurlencode</span><span class="keyword">(</span><span class="default">$value</span><span class="keyword">)
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; .(empty(</span><span class="default">$domain</span><span class="keyword">) ? </span><span class="string">'' </span><span class="keyword">: </span><span class="string">'; Domain='</span><span class="keyword">.</span><span class="default">$domain</span><span class="keyword">)
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; .(empty(</span><span class="default">$maxage</span><span class="keyword">) ? </span><span class="string">'' </span><span class="keyword">: </span><span class="string">'; Max-Age='</span><span class="keyword">.</span><span class="default">$maxage</span><span class="keyword">)
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; .(empty(</span><span class="default">$path</span><span class="keyword">) ? </span><span class="string">'' </span><span class="keyword">: </span><span class="string">'; Path='</span><span class="keyword">.</span><span class="default">$path</span><span class="keyword">)
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; .(!</span><span class="default">$secure </span><span class="keyword">? </span><span class="string">'' </span><span class="keyword">: </span><span class="string">'; Secure'</span><span class="keyword">)
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; .(!</span><span class="default">$HTTPOnly </span><span class="keyword">? </span><span class="string">'' </span><span class="keyword">: </span><span class="string">'; HttpOnly'</span><span class="keyword">), </span><span class="default">false</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">true</span><span class="keyword">;
<br />
&nbsp;&nbsp;&nbsp; }
<br />

<br />
</span><span class="default">?&gt;
<br />
</span>
<br />
Regards,
<br />
Isaak</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="79350""></a>
  <div class="note">
   <strong class="user">soeren dot spreng at gmail dot com</strong>
   <a href="#79350" class="date">22-Nov-2007 11:35</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Beware: The Internet Explorer doesn't accept Cookies with an expiretime, which is to long. time() + time() for example doesn't work and the Cookie won't be created!</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="78624""></a>
  <div class="note">
   <strong class="user">mikeh at view22 dot com</strong>
   <a href="#78624" class="date">19-Oct-2007 08:56</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Observed: session cookies were expiring even though the session was still active.&nbsp; (To test, set a cookie expiry of 5 seconds and keep hitting the page every second.&nbsp; The session will expire and create a new SESSID after 5 seconds despite the fact that you hit the page only a second ago.)
<br />

<br />
Calling this function before starting the session fixed it.&nbsp; It copies the cookie contents back to itself while forcing an update to the expiry time in the cookie.
<br />

<br />
<span class="default">&lt;?php
<br />
</span><span class="keyword">function </span><span class="default">FreshenSessionCookie</span><span class="keyword">(</span><span class="default">$lifetimeSeconds</span><span class="keyword">, </span><span class="default">$cookieName </span><span class="keyword">= </span><span class="string">'PHPSESSID'</span><span class="keyword">) 
<br />
{
<br />
&nbsp;&nbsp;&nbsp; if (isset(</span><span class="default">$_COOKIE</span><span class="keyword">[</span><span class="default">$cookieName</span><span class="keyword">]))
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; {
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$data </span><span class="keyword">= </span><span class="default">$_COOKIE</span><span class="keyword">[</span><span class="default">$cookieName</span><span class="keyword">];
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$timeout </span><span class="keyword">= </span><span class="default">time</span><span class="keyword">()+</span><span class="default">$lifetimeSeconds</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">setcookie</span><span class="keyword">(</span><span class="default">$cookieName</span><span class="keyword">, </span><span class="default">$data</span><span class="keyword">,&nbsp; </span><span class="default">$timeout</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }
<br />
}
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="77276""></a>
  <div class="note">
   <strong class="user">cwillard at fastmail dot fm</strong>
   <a href="#77276" class="date">22-Aug-2007 04:55</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If you're looking to set multiple values in your cookie (rather than setting multiple cookies) you might find these useful.<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">function </span><span class="default">build_cookie</span><span class="keyword">(</span><span class="default">$var_array</span><span class="keyword">) {<br />
&nbsp; if (</span><span class="default">is_array</span><span class="keyword">(</span><span class="default">$var_array</span><span class="keyword">)) {<br />
&nbsp;&nbsp;&nbsp; foreach (</span><span class="default">$var_array </span><span class="keyword">as </span><span class="default">$index </span><span class="keyword">=&gt; </span><span class="default">$data</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="default">$out</span><span class="keyword">.= (</span><span class="default">$data</span><span class="keyword">!=</span><span class="string">""</span><span class="keyword">) ? </span><span class="default">$index</span><span class="keyword">.</span><span class="string">"="</span><span class="keyword">.</span><span class="default">$data</span><span class="keyword">.</span><span class="string">"|" </span><span class="keyword">: </span><span class="string">""</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp; }<br />
&nbsp; return </span><span class="default">rtrim</span><span class="keyword">(</span><span class="default">$out</span><span class="keyword">,</span><span class="string">"|"</span><span class="keyword">);<br />
}<br />
<br />
function </span><span class="default">break_cookie </span><span class="keyword">(</span><span class="default">$cookie_string</span><span class="keyword">) {<br />
&nbsp; </span><span class="default">$array</span><span class="keyword">=</span><span class="default">explode</span><span class="keyword">(</span><span class="string">"|"</span><span class="keyword">,</span><span class="default">$cookie_string</span><span class="keyword">);<br />
&nbsp; foreach (</span><span class="default">$array </span><span class="keyword">as </span><span class="default">$i</span><span class="keyword">=&gt;</span><span class="default">$stuff</span><span class="keyword">) {<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$stuff</span><span class="keyword">=</span><span class="default">explode</span><span class="keyword">(</span><span class="string">"="</span><span class="keyword">,</span><span class="default">$stuff</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$array</span><span class="keyword">[</span><span class="default">$stuff</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">]]=</span><span class="default">$stuff</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">];<br />
&nbsp;&nbsp;&nbsp; unset(</span><span class="default">$array</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">]);<br />
&nbsp; }<br />
&nbsp; return </span><span class="default">$array</span><span class="keyword">;<br />
}<br />
</span><span class="default">?&gt;<br />
</span>Hopefully someone finds these useful.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="76395""></a>
  <div class="note">
   <strong class="user">bluewaterbob</strong>
   <a href="#76395" class="date">13-Jul-2007 08:51</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
if you are having problems seeing cookies sometimes or deleting cookies sometimes, despite following the advice below, make sure you are setting the cookie with the domain argument. Set it with the dot before the domain as the examples show: ".example.com".&nbsp; I wasn't specifying the domain, and finally realized I was setting the cookie when the browser url had the <a href="http://www.example.com and later trying to delete it when the url didn" rel="nofollow" target="_blank">http://www.example.com and later trying to delete it when the url didn</a>'t have the www. ie. <a href="http://example.com. This also caused the page to be unable to find the cookie when the www. wasn" rel="nofollow" target="_blank">http://example.com. This also caused the page to be unable to find the cookie when the www. wasn</a>'t in the domain.&nbsp; (When you add the domain argument to the setcookie code that creates the cookie, make sure you also add it to the code that deletes the cookie.)</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="75343""></a>
  <div class="note">
   <strong class="user">jonathan dot bergeron at rve dot ulaval dot ca</strong>
   <a href="#75343" class="date">24-May-2007 09:05</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
About the delete part, I found that Firefox only remove the cookie when you submit the same values for all parameters, except the date, which sould be in the past. Submiting blank values didn't work for me.
<br />

<br />
Example :
<br />
- set -
<br />

<br />
<span class="default">&lt;?php setcookie</span><span class="keyword">( </span><span class="string">"name"</span><span class="keyword">, </span><span class="string">"value"</span><span class="keyword">, </span><span class="string">"future_timestamp"</span><span class="keyword">, </span><span class="string">"path"</span><span class="keyword">, </span><span class="string">"domain" </span><span class="keyword">); </span><span class="default">?&gt;
<br />
</span>
<br />
- delete -
<br />
<span class="default">&lt;?php setcookie</span><span class="keyword">( </span><span class="string">"name"</span><span class="keyword">, </span><span class="string">"value"</span><span class="keyword">, </span><span class="string">"past_timestamp"</span><span class="keyword">, </span><span class="string">"path"</span><span class="keyword">, </span><span class="string">"domain" </span><span class="keyword">); </span><span class="default">?&gt;
<br />
</span>
<br />
Jonathan</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="74231""></a>
  <div class="note">
   <strong class="user">Marcin Wiazowski</strong>
   <a href="#74231" class="date">30-Mar-2007 09:08</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
'session.cookie_domain' should be set to empty string for all local domain names, not only for 'localhost' (but should not be empty for local IP addresses):<br />
<br />
<span class="default">&lt;?php<br />
ini_set</span><span class="keyword">(</span><span class="string">'session.cookie_domain'</span><span class="keyword">, (</span><span class="default">strpos</span><span class="keyword">(</span><span class="default">$_SERVER</span><span class="keyword">[</span><span class="string">'HTTP_HOST'</span><span class="keyword">],</span><span class="string">'.'</span><span class="keyword">) !== </span><span class="default">false</span><span class="keyword">) ? </span><span class="default">$_SERVER</span><span class="keyword">[</span><span class="string">'HTTP_HOST'</span><span class="keyword">] : </span><span class="string">''</span><span class="keyword">);<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="74126""></a>
  <div class="note">
   <strong class="user">mike</strong>
   <a href="#74126" class="date">26-Mar-2007 05:00</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Be careful of using the same cookie name in subdirectories. Setting a simple cookie 
<br />

<br />
<span class="default">&lt;?php setcookie</span><span class="keyword">(</span><span class="string">"region"</span><span class="keyword">, </span><span class="default">$_GET</span><span class="keyword">[</span><span class="string">'set_region'</span><span class="keyword">]); </span><span class="default">?&gt;
<br />
</span>
<br />
both in the root / and for instance in this case /admin/ will create 2 cookies with different paths. In reading the cookies back only the first one is read regardless of path.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="74046""></a>
  <div class="note">
   
   <a href="#74046" class="date">21-Mar-2007 11:40</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
if you only want to do something once per unique visitor, you can test if a cookie is set, and if not, set the cookie and perform the action. This being the poorman's version, it has a problem, where if a user is blocking cookies they will appear as a first time visitor each time. What you can do to avoid this is to set a test cookie first and check that it exists. If it exists, then check to see if your second cookie has been set. If the first one is set, but the second isn't, then you know this is a first time visitor.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="73484""></a>
  <div class="note">
   <strong class="user">gabe at fijiwebdesign dot com</strong>
   <a href="#73484" class="date">25-Feb-2007 04:25</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If you want to delete all cookies on your domain, you may want to use the value of:<br />
<br />
<span class="default">&lt;?php $_SERVER</span><span class="keyword">[</span><span class="string">'HTTP_COOKIE'</span><span class="keyword">] </span><span class="default">?&gt;<br />
</span><br />
rather than:<br />
<br />
<span class="default">&lt;?php $_COOKIE ?&gt;<br />
</span><br />
to dertermine the cookie names. <br />
If cookie names are in Array notation, eg: user[username] <br />
Then PHP will automatically create a corresponding array in $_COOKIE. Instead use $_SERVER['HTTP_COOKIE'] as it mirrors the actual HTTP Request header. <br />
<br />
<span class="default">&lt;?php<br />
<br />
</span><span class="comment">// unset cookies<br />
</span><span class="keyword">if (isset(</span><span class="default">$_SERVER</span><span class="keyword">[</span><span class="string">'HTTP_COOKIE'</span><span class="keyword">])) {<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$cookies </span><span class="keyword">= </span><span class="default">explode</span><span class="keyword">(</span><span class="string">';'</span><span class="keyword">, </span><span class="default">$_SERVER</span><span class="keyword">[</span><span class="string">'HTTP_COOKIE'</span><span class="keyword">]);<br />
&nbsp;&nbsp;&nbsp; foreach(</span><span class="default">$cookies </span><span class="keyword">as </span><span class="default">$cookie</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$parts </span><span class="keyword">= </span><span class="default">explode</span><span class="keyword">(</span><span class="string">'='</span><span class="keyword">, </span><span class="default">$cookie</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$name </span><span class="keyword">= </span><span class="default">trim</span><span class="keyword">(</span><span class="default">$parts</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">]);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">setcookie</span><span class="keyword">(</span><span class="default">$name</span><span class="keyword">, </span><span class="string">''</span><span class="keyword">, </span><span class="default">time</span><span class="keyword">()-</span><span class="default">1000</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">setcookie</span><span class="keyword">(</span><span class="default">$name</span><span class="keyword">, </span><span class="string">''</span><span class="keyword">, </span><span class="default">time</span><span class="keyword">()-</span><span class="default">1000</span><span class="keyword">, </span><span class="string">'/'</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; }<br />
}<br />
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="73107""></a>
  <div class="note">
   
   <a href="#73107" class="date">09-Feb-2007 02:13</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
something that wasn't made clear to me here and totally confused me for a while was that domain names must contain at least two dots (.), hence 'localhost' is invalid and the browser will refuse to set the cookie! instead for localhost you should use false.<br />
<br />
to make your code work on both localhost and a proper domain, you can do this:<br />
<br />
<span class="default">&lt;?php<br />
<br />
$domain </span><span class="keyword">= (</span><span class="default">$_SERVER</span><span class="keyword">[</span><span class="string">'HTTP_HOST'</span><span class="keyword">] != </span><span class="string">'localhost'</span><span class="keyword">) ? </span><span class="default">$_SERVER</span><span class="keyword">[</span><span class="string">'HTTP_HOST'</span><span class="keyword">] : </span><span class="default">false</span><span class="keyword">;<br />
</span><span class="default">setcookie</span><span class="keyword">(</span><span class="string">'cookiename'</span><span class="keyword">, </span><span class="string">'data'</span><span class="keyword">, </span><span class="default">time</span><span class="keyword">()+</span><span class="default">60</span><span class="keyword">*</span><span class="default">60</span><span class="keyword">*</span><span class="default">24</span><span class="keyword">*</span><span class="default">365</span><span class="keyword">, </span><span class="string">'/'</span><span class="keyword">, </span><span class="default">$domain</span><span class="keyword">, </span><span class="default">false</span><span class="keyword">);<br />
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="72456""></a>
  <div class="note">
   <strong class="user">ahmetantmen at msn dot com</strong>
   <a href="#72456" class="date">19-Jan-2007 12:36</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
You can be sure about the cookie files contents weren't changed.<br />
<br />
<span class="default">&lt;?php<br />
<br />
$Seperator </span><span class="keyword">= </span><span class="string">'--'</span><span class="keyword">;<br />
</span><span class="default">$uniqueID </span><span class="keyword">= </span><span class="string">'Ju?hG&amp;F0yh9?=/6*GVfd-d8u6f86hp'</span><span class="keyword">;<br />
</span><span class="default">$Data </span><span class="keyword">= </span><span class="string">'Ahmet '</span><span class="keyword">.</span><span class="default">md5</span><span class="keyword">(</span><span class="string">'123456789'</span><span class="keyword">);<br />
<br />
</span><span class="default">setcookie</span><span class="keyword">(</span><span class="string">'VerifyUser'</span><span class="keyword">, </span><span class="default">$Data</span><span class="keyword">.</span><span class="default">$Seperator</span><span class="keyword">.</span><span class="default">md5</span><span class="keyword">(</span><span class="default">$Data</span><span class="keyword">.</span><span class="default">$uniqueID</span><span class="keyword">));<br />
<br />
if (</span><span class="default">$_COOKIE</span><span class="keyword">) {<br />
&nbsp;&nbsp; </span><span class="default">$Cut </span><span class="keyword">= </span><span class="default">explode</span><span class="keyword">(</span><span class="default">$Seperator</span><span class="keyword">, </span><span class="default">$_COOKIE</span><span class="keyword">[</span><span class="string">'VerifyUser'</span><span class="keyword">]);<br />
&nbsp;&nbsp; if (</span><span class="default">md5</span><span class="keyword">(</span><span class="default">$Cut</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">].</span><span class="default">$uniqueID</span><span class="keyword">) === </span><span class="default">$Cut</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">]) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; </span><span class="default">$_COOKIE</span><span class="keyword">[</span><span class="string">'VerifyUser'</span><span class="keyword">] = </span><span class="default">$Cut</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">];<br />
&nbsp;&nbsp; } else {<br />
&nbsp;&nbsp; &nbsp; &nbsp; die(</span><span class="string">'Cookie data is invalid!!!'</span><span class="keyword">);<br />
&nbsp;&nbsp; }<br />
}<br />
<br />
echo </span><span class="default">$_COOKIE</span><span class="keyword">[</span><span class="string">'VerifyUser'</span><span class="keyword">];<br />
<br />
</span><span class="default">?&gt;<br />
</span><br />
Create a unique id for your site and create a hash with md5($Data.$uniqueID). Attacker can understant that it must be re-hash after change cookie content.<br />
But doesn't. Because cannot guess your unique id. Seperate your hash and data with seperator and send that cookie. Control that hash of returned value and your unique id's is same returned hash. Otherwise you have to stop attack. Sorry for my poor english!</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="72313""></a>
  <div class="note">
   <strong class="user">stovenator at gmail dot com</strong>
   <a href="#72313" class="date">13-Jan-2007 03:54</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If you are having issues with IE7 and setcookie(), be sure to verify that the cookie is set via http for http sites, and https for https site. <br />
<br />
Also, if the time is incorrect on your server, IE7 will also disallow those cookies from being set.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="72180""></a>
  <div class="note">
   
   <a href="#72180" class="date">05-Jan-2007 10:33</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If you ever find yourself in a situation where you need to overwrite a non-PHP application's session cookie, you can do that with the following line:
<br />

<br />
<span class="default">&lt;?php
<br />
header</span><span class="keyword">(</span><span class="string">"Set-Cookie: SIDNAME=</span><span class="default">$overwrite</span><span class="string">; path=/; secure"</span><span class="keyword">);
<br />
</span><span class="default">?&gt;
<br />
</span>
<br />
I couldn't get setcookie() to do this for all major web browsers, but manually sending the header did the trick. Note: Remove secure if you aren't mandating SSL connections.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="71743""></a>
  <div class="note">
   <strong class="user">kurtubba at gmail dot com</strong>
   <a href="#71743" class="date">14-Dec-2006 02:12</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
When setting a top level domain ex ".mydomain.com" you must add the secure arg so it should look like
<br />

<br />
<span class="default">&lt;?php
<br />
setcookie</span><span class="keyword">(</span><span class="string">"TestCookie"</span><span class="keyword">, </span><span class="default">$value</span><span class="keyword">, </span><span class="default">time</span><span class="keyword">()+</span><span class="default">3600</span><span class="keyword">, </span><span class="string">"/"</span><span class="keyword">, </span><span class="string">".example.com"</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">);
<br />
</span><span class="default">?&gt;
<br />
</span>
<br />

<br />
ignoring the secure arg makes IE ignores the cookie
<br />
to get the top level domain use
<br />

<br />
<span class="default">&lt;?php
<br />
$myDomain </span><span class="keyword">= </span><span class="default">ereg_replace</span><span class="keyword">(</span><span class="string">'^[^\.]*\.([^\.]*)\.(.*)$'</span><span class="keyword">, </span><span class="string">'\1.\2'</span><span class="keyword">,</span><span class="default">$_SERVER</span><span class="keyword">[</span><span class="string">'HTTP_HOST'</span><span class="keyword">]);
<br />
</span><span class="default">?&gt;
<br />
</span>
<br />

<br />
to avoid localhost switch use
<br />

<br />
<span class="default">&lt;?php
<br />
$phpCkDmn </span><span class="keyword">= </span><span class="default">$_SERVER</span><span class="keyword">[</span><span class="string">'HTTP_HOST'</span><span class="keyword">] != </span><span class="string">"localhost" </span><span class="keyword">? </span><span class="default">$myDomain </span><span class="keyword">: </span><span class="default">false</span><span class="keyword">;
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="71591""></a>
  <div class="note">
   <strong class="user">paul nospam AT nospam sitepoint dot com</strong>
   <a href="#71591" class="date">07-Dec-2006 05:59</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Note when setting "array cookies" that a separate cookie is set for each element of the array.<br />
<br />
On high traffic sites, this can substantially increase the size of subsequent HTTP requests from clients (including requests for static content on the same domain).<br />
<br />
More importantly though, the cookie specification says that browsers need only accept 20 cookies per domain.&nbsp; This limit is increased to 50 by Firefox, and to 30 by Opera, but IE6 and IE7 enforce the limit of 20 cookie per domain.&nbsp; Any cookies beyond this limit will either knock out an older cookie or be ignored/rejected by the browser.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="70959""></a>
  <div class="note">
   <strong class="user">hansel at gretel dot com</strong>
   <a href="#70959" class="date">06-Nov-2006 05:12</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
The following code snippet combines abdullah's and Charles Martin's examples into a powerful combination function (and fixes at least one bug in the process):<br />
<br />
<span class="default">&lt;?php<br />
&nbsp; </span><span class="keyword">function </span><span class="default">set_cookie_fix_domain</span><span class="keyword">(</span><span class="default">$Name</span><span class="keyword">, </span><span class="default">$Value </span><span class="keyword">= </span><span class="string">''</span><span class="keyword">, </span><span class="default">$Expires </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">, </span><span class="default">$Path </span><span class="keyword">= </span><span class="string">''</span><span class="keyword">, </span><span class="default">$Domain </span><span class="keyword">= </span><span class="string">''</span><span class="keyword">, </span><span class="default">$Secure </span><span class="keyword">= </span><span class="default">false</span><span class="keyword">, </span><span class="default">$HTTPOnly </span><span class="keyword">= </span><span class="default">false</span><span class="keyword">)<br />
&nbsp; {<br />
&nbsp;&nbsp;&nbsp; if (!empty(</span><span class="default">$Domain</span><span class="keyword">))<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="comment">// Fix the domain to accept domains with and without 'www.'.<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="keyword">if (</span><span class="default">strtolower</span><span class="keyword">(</span><span class="default">substr</span><span class="keyword">(</span><span class="default">$Domain</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">4</span><span class="keyword">)) == </span><span class="string">'www.'</span><span class="keyword">)&nbsp; </span><span class="default">$Domain </span><span class="keyword">= </span><span class="default">substr</span><span class="keyword">(</span><span class="default">$Domain</span><span class="keyword">, </span><span class="default">4</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="default">$Domain </span><span class="keyword">= </span><span class="string">'.' </span><span class="keyword">. </span><span class="default">$Domain</span><span class="keyword">;<br />
<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="comment">// Remove port information.<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="default">$Port </span><span class="keyword">= </span><span class="default">strpos</span><span class="keyword">(</span><span class="default">$Domain</span><span class="keyword">, </span><span class="string">':'</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp;&nbsp; if (</span><span class="default">$Port </span><span class="keyword">!== </span><span class="default">false</span><span class="keyword">)&nbsp; </span><span class="default">$Domain </span><span class="keyword">= </span><span class="default">substr</span><span class="keyword">(</span><span class="default">$Domain</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">$Port</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">header</span><span class="keyword">(</span><span class="string">'Set-Cookie: ' </span><span class="keyword">. </span><span class="default">rawurlencode</span><span class="keyword">(</span><span class="default">$Name</span><span class="keyword">) . </span><span class="string">'=' </span><span class="keyword">. </span><span class="default">rawurlencode</span><span class="keyword">(</span><span class="default">$Value</span><span class="keyword">)<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; . (empty(</span><span class="default">$Expires</span><span class="keyword">) ? </span><span class="string">'' </span><span class="keyword">: </span><span class="string">'; expires=' </span><span class="keyword">. </span><span class="default">gmdate</span><span class="keyword">(</span><span class="string">'D, d-M-Y H:i:s'</span><span class="keyword">, </span><span class="default">$Expires</span><span class="keyword">) . </span><span class="string">' GMT'</span><span class="keyword">)<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; . (empty(</span><span class="default">$Path</span><span class="keyword">) ? </span><span class="string">'' </span><span class="keyword">: </span><span class="string">'; path=' </span><span class="keyword">. </span><span class="default">$Path</span><span class="keyword">)<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; . (empty(</span><span class="default">$Domain</span><span class="keyword">) ? </span><span class="string">'' </span><span class="keyword">: </span><span class="string">'; domain=' </span><span class="keyword">. </span><span class="default">$Domain</span><span class="keyword">)<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; . (!</span><span class="default">$Secure </span><span class="keyword">? </span><span class="string">'' </span><span class="keyword">: </span><span class="string">'; secure'</span><span class="keyword">)<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; . (!</span><span class="default">$HTTPOnly </span><span class="keyword">? </span><span class="string">'' </span><span class="keyword">: </span><span class="string">'; HttpOnly'</span><span class="keyword">), </span><span class="default">false</span><span class="keyword">);<br />
&nbsp; }<br />
</span><span class="default">?&gt;<br />
</span><br />
Basically, if the domain parameter is supplied, it is converted to support a broader range of domains.&nbsp; This behavior may or may not be desireable (e.g. could be a security problem depending on the server) but it makes cookie handling oh-so-much-nicer (IMO).</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="68666""></a>
  <div class="note">
   <strong class="user">adruff at gmail dot com</strong>
   <a href="#68666" class="date">06-Aug-2006 07:14</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If you intend to use persistent cookies (vice session cookies that are deleted when the browser is closed) be aware:<br />
1) Firefox appears to require that you include all paramaters, or it will ignore the expiration and treat the cookie as a session cookie<br />
2) My version of firefox (1.5.0.6) defaults to 'keep cookies until i close firefox' , which essentially makes every cookie a session cookie. This of course sucks for devs, but i suppose is supposed to be a security feature for the end user. If the user wants to configure firefox to respect the expiration date and retain cookies beyond the session, the user must change it to 'keep cookies until they expire'.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="67191""></a>
  <div class="note">
   <strong class="user">gareth at gw126 dot com</strong>
   <a href="#67191" class="date">05-Jun-2006 04:38</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
You can use cookies to prevent a browser refresh repeating some action from a form post... (providing the client is cookie enabled!)
<br />

<br />
<span class="default">&lt;?php
<br />
</span><span class="comment">//Flag up repeat actions (like credit card transaction, etc)
<br />
</span><span class="keyword">if(</span><span class="default">count</span><span class="keyword">(</span><span class="default">$_POST</span><span class="keyword">)&gt;</span><span class="default">0</span><span class="keyword">) {
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$lastpost</span><span class="keyword">= isset(</span><span class="default">$_COOKIE</span><span class="keyword">[</span><span class="string">'lastpost'</span><span class="keyword">]) ? </span><span class="default">$_COOKIE</span><span class="keyword">[</span><span class="string">'lastpost'</span><span class="keyword">] : </span><span class="string">''</span><span class="keyword">;
<br />
&nbsp;&nbsp;&nbsp; if(</span><span class="default">$lastpost</span><span class="keyword">!=</span><span class="default">md5</span><span class="keyword">(</span><span class="default">serialize</span><span class="keyword">(</span><span class="default">$_POST</span><span class="keyword">))) {
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">setcookie</span><span class="keyword">(</span><span class="string">'lastpost'</span><span class="keyword">, </span><span class="default">md5</span><span class="keyword">(</span><span class="default">serialize</span><span class="keyword">(</span><span class="default">$_POST</span><span class="keyword">)));
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$_POST</span><span class="keyword">[</span><span class="string">'_REPEATED'</span><span class="keyword">]=</span><span class="default">0</span><span class="keyword">;
<br />
&nbsp;&nbsp;&nbsp; } else {
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$_POST</span><span class="keyword">[</span><span class="string">'_REPEATED'</span><span class="keyword">]=</span><span class="default">1</span><span class="keyword">;
<br />
&nbsp;&nbsp;&nbsp; }
<br />
}
<br />

<br />
</span><span class="comment">//At this point, if $_POST['_REPEATED']==1, then&nbsp; the user
<br />
//has hit the refresh button; so don't do any actions that you don't
<br />
//want to repeat!
<br />
</span><span class="default">?&gt;
<br />
</span>
<br />
Hope that helps :)
<br />

<br />
Gareth</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="55380""></a>
  <div class="note">
   <strong class="user">simon at ruderich dot com</strong>
   <a href="#55380" class="date">01-Aug-2005 11:21</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If you want to delete a session cookie, you can do it with this code:<br />
<br />
<span class="default">&lt;?php<br />
&nbsp; session_start</span><span class="keyword">();<br />
<br />
&nbsp; </span><span class="comment">// many code<br />
<br />
&nbsp; </span><span class="default">$sessionName </span><span class="keyword">= </span><span class="default">session_name</span><span class="keyword">();<br />
&nbsp; </span><span class="default">$sessionCookie </span><span class="keyword">= </span><span class="default">session_get_cookie_params</span><span class="keyword">();<br />
<br />
&nbsp; </span><span class="default">session_destroy</span><span class="keyword">();<br />
<br />
&nbsp; </span><span class="default">setcookie</span><span class="keyword">(</span><span class="default">$sessionName</span><span class="keyword">, </span><span class="default">false</span><span class="keyword">, </span><span class="default">$sessionCookie</span><span class="keyword">[</span><span class="string">'lifetime'</span><span class="keyword">], </span><span class="default">$sessionCookie</span><span class="keyword">[</span><span class="string">'path'</span><span class="keyword">], </span><span class="default">$sessionCookie</span><span class="keyword">[</span><span class="string">'domain'</span><span class="keyword">], </span><span class="default">$sessionCookie</span><span class="keyword">[</span><span class="string">'secure'</span><span class="keyword">]);<br />
&nbsp;</span><span class="default">?&gt;<br />
</span><br />
This works also well if the session cookie params or the session name were changed.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="52648""></a>
  <div class="note">
   <strong class="user">terry at scribendi dot com</strong>
   <a href="#52648" class="date">08-May-2005 04:07</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
A few comments have suggested using serialize() to set object or array data into a cookie.&nbsp; There are a couple of reasons to be carefull with that technique:<br />
<br />
Security: If the cookie is human readable, then it is also fairly easy for end users to play around with it.&nbsp; Wrapping your cookie setting and getting in an encryption routine will prevent tampering, and make sure that your cookies don't make any sense to any client-side exploits or other sites they get sent to thanks to browser bugs.<br />
<br />
Bulk: If you serialize even a fairly simple class, then you get a lot of data.&nbsp; Large cookies will make browser requests fat and slow, and some browsers have a limit on cookie size, so think about what data you really need to persist, and create __sleep() and __wakeup() methods to package the data into the shortest possible form.&nbsp; You can get better and faster results when you write your own __sleep() and __wakup() to implode() or pack() your data, than by using zlib compress() on the serialized object.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="51705""></a>
  <div class="note">
   <strong class="user">Carl V</strong>
   <a href="#51705" class="date">08-Apr-2005 05:29</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If you want to delete all the cookies set by your domain, you may run the following:<br />
<br />
<span class="default">&lt;?php<br />
$cookiesSet </span><span class="keyword">= </span><span class="default">array_keys</span><span class="keyword">(</span><span class="default">$_COOKIE</span><span class="keyword">);<br />
for (</span><span class="default">$x</span><span class="keyword">=</span><span class="default">0</span><span class="keyword">;</span><span class="default">$x</span><span class="keyword">&lt;</span><span class="default">count</span><span class="keyword">(</span><span class="default">$cookiesSet</span><span class="keyword">);</span><span class="default">$x</span><span class="keyword">++) </span><span class="default">setcookie</span><span class="keyword">(</span><span class="default">$cookiesSet</span><span class="keyword">[</span><span class="default">$x</span><span class="keyword">],</span><span class="string">""</span><span class="keyword">,</span><span class="default">time</span><span class="keyword">()-</span><span class="default">1</span><span class="keyword">);<br />
</span><span class="default">?&gt;<br />
</span><br />
Very useful when doing logout scripts and the cookie name may have changed (long story).</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="50957""></a>
  <div class="note">
   <strong class="user">Alchaemist</strong>
   <a href="#50957" class="date">15-Mar-2005 12:36</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
setcookie + header Location + IIS 5 = Trouble<br />
<br />
It took me a long time to figure out what was causing a missing cookie in one system while it worked perfectly in another...<br />
<br />
See this one: <a href="http://support.microsoft.com/kb/q176113/" rel="nofollow" target="_blank">http://support.microsoft.com/kb/q176113/</a><br />
<br />
In short, this WILL NEVER WORK IN IIS 5:<br />
<span class="default">&lt;?php<br />
header</span><span class="keyword">(</span><span class="string">"Pragma: no-cache"</span><span class="keyword">);<br />
</span><span class="default">header</span><span class="keyword">(</span><span class="string">'Location: <a href="http://www.example.com/" rel="nofollow" target="_blank">http://www.example.com/</a>'</span><span class="keyword">);<br />
</span><span class="default">setcookie</span><span class="keyword">(</span><span class="string">'AA'</span><span class="keyword">,</span><span class="string">'1'</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">,</span><span class="string">'/'</span><span class="keyword">);<br />
</span><span class="default">setcookie</span><span class="keyword">(</span><span class="string">'BB'</span><span class="keyword">,</span><span class="string">'2'</span><span class="keyword">,</span><span class="default">time</span><span class="keyword">() + </span><span class="default">24 </span><span class="keyword">* </span><span class="default">3600</span><span class="keyword">,</span><span class="string">'/'</span><span class="keyword">);<br />
</span><span class="default">?&gt;<br />
</span><br />
You will ONLY get the Location Header, everything else will be "cut out" by IIS 5 CGI implementation.<br />
<br />
Solutions:<br />
1- Migrate to Apache/IIS6/Whatever<br />
2- Use a Non Parsed Header Script (nph-*.php)<br />
3- Try with header('Refresh: 0; $URL');<br />
<br />
I hope this helps somebody not to spend hours knocking his/her head.<br />
<br />
Alchaemist</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="37732""></a>
  <div class="note">
   <strong class="user">apex at xepa dot nl</strong>
   <a href="#37732" class="date">25-Nov-2003 03:59</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Note on setting cookies allowing access to sites:
<br />

<br />
If you are not using something "personal" from the computer that you are sending the cookie too watch out.&nbsp; Via javascript it is possible to steal cookies from other users.&nbsp; Thus allowing the stealer to login to your site as another user that might not have access otherwise.&nbsp; Try to add something like the user's ip in the cookie and allowing access from that ip only with the stored cookie data.
<br />

<br />
[Editor's note: ... or simply use sessions. You can't be sure that the visitor will use the same IP the next visit. Not even on the next request (thanks to proxy servers)]</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="36202""></a>
  <div class="note">
   <strong class="user"></strong>
   <a href="#36202" class="date">01-Oct-2003 01:13</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
When using your cookies on a webserver that is not on the standard port 80, you should NOT include the :[port] in the "Cookie domain" parameter, since this would not be recognized correctly.
<br />
I had the issue working on a project that runs on multiple servers (development, production, etc.). One of the servers is running on a different port (together with other websites that run on the same server but on different ports).</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="35647""></a>
  <div class="note">
   <strong class="user">dave at fubra dot com</strong>
   <a href="#35647" class="date">09-Sep-2003 09:36</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
There are several characters that dont work correctly if part of the cookie name, I in particular ran into problems using = as part of the cookie name ie/
<br />

<br />
<span class="default">&lt;?php setcookie</span><span class="keyword">(</span><span class="string">'dE4fR='</span><span class="keyword">, </span><span class="default">$foo</span><span class="keyword">); </span><span class="default">?&gt;
<br />
</span>
<br />
this was as a result of base64_encode() ing a variable to use as the name. The cookie was being set fine but the = is stored as a little square character in the cookie which prevent proper retreival.
<br />

<br />
The solution for me was to use md5() instead of base64_encode() but any other method which avoids the = sign should also solve the problem</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="31170""></a>
  <div class="note">
   <strong class="user">soreman at abv dot bg</strong>
   <a href="#31170" class="date">12-Apr-2003 12:26</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If you experience problems on Microsoft Information Server (IIS) when setting a cookie via PHP and when PHP is running as a CGI binary it is not setting the cookie. After spending many hours on what the problem is here is what happens:<br />
<br />
When you invoke setcookie and redirect to another page you will not have your cookie set, because it seems that IIS doesn't set the cookie unless you actually send some contents to the browser. Therefore if you want to set a cookie and then redirect to another page you will have to do the redirection via JavaScript and/or HTML if you want your script to work on IIS.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="27819""></a>
  <div class="note">
   <strong class="user">mleer at sp dot nl</strong>
   <a href="#27819" class="date">19-Dec-2002 11:50</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
P3P is a good idea. But.
<br />
IE 6 features an inadequate definition of third party cookies.
<br />
If your site is hosted on server A and your PHP stuff is coming in a framesetting from server B your setcookie-attempts will be blocked when default privacy settings are deployed. Your secondparty-cookie will be regarded as a thirdparty-cookie.
<br />

<br />
So what you do is not read the P3P-Internet Explorer 6-manual at MS but send a header like
<br />

<br />
<span class="default">&lt;?php
<br />
header</span><span class="keyword">(</span><span class="string">'P3P: CP="NOI ADM DEV PSAi COM NAV OUR OTRo STP IND DEM"'</span><span class="keyword">);
<br />
</span><span class="default">?&gt;
<br />
</span>
<br />
before doing the setcookie-thing. This will enable your cookie to survive any IE-6 privacy settings.
<br />

<br />
You won't do this if you're working for some doubleclick institution, because if you do, you... you...well... you are not a very nice person!</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
</div>
</div>
</div></div></body></html>
