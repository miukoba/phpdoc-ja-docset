<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
 <head>
  <meta http-equiv="content-type" content="text/html; CHARSET=shift-jis">
  <title>オブジェクトと参照</title>

  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <link media="all" rel="stylesheet" type="text/css" href="style.css"/>
 </head>
 <body class="docs" class="docs"><div class="navbar navbar-fixed-top">
  <div class="navbar-inner clearfix">
    <ul class="nav" style="width: 100%">
      <li style="float: left;"><a href="language.oop5.late-static-bindings.html">≪ 遅延静的束縛 (Late Static Bindings)</a></li>
      <li style="float: right;"><a href="language.oop5.serialization.html">オブジェクトのシリアライズ ≫</a></li>
    </ul>
  </div>
</div>
<div id="breadcrumbs" class="clearfix">
  <ul class="breadcrumbs-container">
    <li><a href="index.html">PHP Manual</a></li>
    <li><a href="language.oop5.html">クラスとオブジェクト</a></li>
    <li>オブジェクトと参照</li>
  </ul>
</div>
<div id="layout">
  <div id="layout-content"><div id="language.oop5.references" class="sect1">
  <h2 class="title">オブジェクトと参照</h2>
  <p class="para">
   PHP 5 でのオブジェクト指向プログラミングのポイントとしてよく言われるのは
   「オブジェクトはデフォルトでは参照渡しとなります」ということです。
   しかし、正確には少し異なります。
   この節では、いくつかの例を用いてその誤解をといていきます。
  </p>

  <p class="para">
   PHP の参照は一種のエイリアスで、ふたつの異なる変数に同じ値を書き込めるものです。
   PHP 5 以降、オブジェクト変数の値にオブジェクト自身は含まれなくなりました。
   含まれるのはオブジェクトの ID のみで、
   これを用いて実際のオブジェクトにアクセスできるようになっています。
   オブジェクトが引数として渡されたり返り値となったり
   あるいは別の変数に代入されたりした場合、
   それはエイリアスではありません。ID のコピーを保持し、
   同じオブジェクトを指すようになるのです。
  </p>

  <div class="example" id="example-250">
   <p><strong>例1 参照とオブジェクト</strong></p>
   <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br /></span><span style="color: #007700">class&nbsp;</span><span style="color: #0000BB">A&nbsp;</span><span style="color: #007700">{<br />&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;</span><span style="color: #0000BB">$foo&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">1</span><span style="color: #007700">;<br />}&nbsp;&nbsp;<br /><br /></span><span style="color: #0000BB">$a&nbsp;</span><span style="color: #007700">=&nbsp;new&nbsp;</span><span style="color: #0000BB">A</span><span style="color: #007700">;<br /></span><span style="color: #0000BB">$b&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$a</span><span style="color: #007700">;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">//&nbsp;$a&nbsp;と&nbsp;$b&nbsp;は同じ&nbsp;ID&nbsp;を持つコピーです<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;($a)&nbsp;=&nbsp;($b)&nbsp;=&nbsp;&lt;id&gt;<br /></span><span style="color: #0000BB">$b</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">foo&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">2</span><span style="color: #007700">;<br />echo&nbsp;</span><span style="color: #0000BB">$a</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">foo</span><span style="color: #007700">.</span><span style="color: #DD0000">"\n"</span><span style="color: #007700">;<br /><br /><br /></span><span style="color: #0000BB">$c&nbsp;</span><span style="color: #007700">=&nbsp;new&nbsp;</span><span style="color: #0000BB">A</span><span style="color: #007700">;<br /></span><span style="color: #0000BB">$d&nbsp;</span><span style="color: #007700">=&nbsp;&amp;</span><span style="color: #0000BB">$c</span><span style="color: #007700">;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">//&nbsp;$c&nbsp;と&nbsp;$d&nbsp;は参照です<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;($c,$d)&nbsp;=&nbsp;&lt;id&gt;<br /><br /></span><span style="color: #0000BB">$d</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">foo&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">2</span><span style="color: #007700">;<br />echo&nbsp;</span><span style="color: #0000BB">$c</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">foo</span><span style="color: #007700">.</span><span style="color: #DD0000">"\n"</span><span style="color: #007700">;<br /><br /><br /></span><span style="color: #0000BB">$e&nbsp;</span><span style="color: #007700">=&nbsp;new&nbsp;</span><span style="color: #0000BB">A</span><span style="color: #007700">;<br /><br />function&nbsp;</span><span style="color: #0000BB">foo</span><span style="color: #007700">(</span><span style="color: #0000BB">$obj</span><span style="color: #007700">)&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">//&nbsp;($obj)&nbsp;=&nbsp;($e)&nbsp;=&nbsp;&lt;id&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$obj</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">foo&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">2</span><span style="color: #007700">;<br />}<br /><br /></span><span style="color: #0000BB">foo</span><span style="color: #007700">(</span><span style="color: #0000BB">$e</span><span style="color: #007700">);<br />echo&nbsp;</span><span style="color: #0000BB">$e</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">foo</span><span style="color: #007700">.</span><span style="color: #DD0000">"\n"</span><span style="color: #007700">;<br /><br /></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
   </div>

   <div class="example-contents"><p>上の例の出力は以下となります。</p></div>
   <div class="example-contents screen">
<div class="cdata"><pre>
2
2
2
</pre></div>
   </div>
  </div>
 </div><div id="usernotes">
 <div class="head">
  <h3 class="title">User Contributed Notes</h3>
 </div>
<div id="allnotes">  <a name="113103""></a>
  <div class="note">
   <strong class="user">akam at akameng dot com</strong>
   <a href="#113103" class="date">30-Aug-2013 06:30</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Object is being referenced even after the original object deleted, so be careful when copying objects into your array. <br />
<br />
<span class="default">&lt;?php<br />
$result </span><span class="keyword">= </span><span class="default">json_decode</span><span class="keyword">(</span><span class="string">' {"1":1377809496,"2":1377813096}'</span><span class="keyword">);<br />
</span><span class="default">$copy1</span><span class="keyword">[</span><span class="string">'object'</span><span class="keyword">] = </span><span class="default">$result</span><span class="keyword">;<br />
</span><span class="default">$copy2</span><span class="keyword">[</span><span class="string">'object'</span><span class="keyword">] = </span><span class="default">$result</span><span class="keyword">;<br />
<br />
unset(</span><span class="default">$result</span><span class="keyword">);<br />
<br />
</span><span class="comment">//now lets change $copy1['object'][1] to 'test';<br />
</span><span class="default">$copy1</span><span class="keyword">[</span><span class="string">'object'</span><span class="keyword">]-&gt;{</span><span class="string">"1"</span><span class="keyword">} = </span><span class="string">'test'</span><span class="keyword">;<br />
<br />
echo (</span><span class="default">$copy1 </span><span class="keyword">=== </span><span class="default">$copy2</span><span class="keyword">) ? </span><span class="string">"Yes" </span><span class="keyword">: </span><span class="string">"No"</span><span class="keyword">;<br />
</span><span class="default">print_r</span><span class="keyword">(</span><span class="default">$copy2</span><span class="keyword">);<br />
</span><span class="comment">/*<br />
Array<br />
(<br />
&nbsp;&nbsp;&nbsp; [API] =&gt; stdClass Object<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; (<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [1] =&gt; test<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [2] =&gt; 1377813096<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; )<br />
<br />
)<br />
*/<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="112285""></a>
  <div class="note">
   <strong class="user">cesoid at gmail dot com</strong>
   <a href="#112285" class="date">28-May-2013 01:45</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Comparing an alias to a pointer is like comparing a spoken word to the neurochemistry of the speaker. You know that the speaker can use two different words to refer to the same thing, but what's going on in their brain to make this work is something you don't want to have to think about every time they speak. (If you're programming in assembly or, less so, in C++, you're out of luck there.)<br />
<br />
Likewise, PHP *the language* and a given php interpretor are not the same thing, and this post and most of these comments leave that out in the explanation. An alias/reference is a part of the language, a pointer is a part of how the computer makes the reference work. You often have little guarantee that an interpreter will continue working the same way internally.<br />
<br />
From a functional point of view the internals of the interpreter *do* matter for optimization, but *don't* matter in terms of the end result of the program. A higher level programming language such as PHP is supposed to try to hide such details from the programmer so that they can write clearer, more manageable code, and do it quickly.<br />
<br />
Unfortunately, years ago, using pass-by-reference a lot actually was very useful in terms of optimizing. Fortunately, that ended years ago, so now we no longer need to perform a reference assignment and hope that we remember not to change one variable when the other one is supposed to stay the same. By the time you read this the php that is sending these words to you may be running on a server that uses some kind of new exotic technology for which the word "pointer" no longer accurately describes anything, because the server stores both the program state and instructions intermingled in non-sequential atoms bonded into molecules which work by randomly bouncing off each other at high speeds, thereby exchanging atoms and crossbreeding their instructions and information in such a way as to, in aggregate, successfully run php 5 code. But the code itself will still have references that work the same way they did before, and you will therefore not have to think about whether the machine I just described makes any sense at all.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="109737""></a>
  <div class="note">
   <strong class="user">Jon Whitener</strong>
   <a href="#109737" class="date">15-Aug-2012 10:55</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
The use of clone may get you the behavior you expect when passing an object to a function, as shown below using DateTime objects as examples.<br />
<br />
<span class="default">&lt;?php<br />
date_default_timezone_set</span><span class="keyword">( </span><span class="string">"America/Detroit" </span><span class="keyword">);<br />
<br />
</span><span class="default">$a </span><span class="keyword">= new </span><span class="default">DateTime</span><span class="keyword">;<br />
echo </span><span class="string">"a = " </span><span class="keyword">. </span><span class="default">$a</span><span class="keyword">-&gt;</span><span class="default">format</span><span class="keyword">(</span><span class="string">'Y-m-j'</span><span class="keyword">) . </span><span class="string">"\n"</span><span class="keyword">;<br />
<br />
</span><span class="comment">// This might not give what you expect...<br />
</span><span class="default">$b </span><span class="keyword">= </span><span class="default">upDate</span><span class="keyword">( </span><span class="default">$a </span><span class="keyword">); </span><span class="comment">// a and b both updated<br />
</span><span class="keyword">echo </span><span class="string">"a = " </span><span class="keyword">. </span><span class="default">$a</span><span class="keyword">-&gt;</span><span class="default">format</span><span class="keyword">(</span><span class="string">'Y-m-j'</span><span class="keyword">) . </span><span class="string">", b = " </span><span class="keyword">. </span><span class="default">$b</span><span class="keyword">-&gt;</span><span class="default">format</span><span class="keyword">(</span><span class="string">'Y-m-j'</span><span class="keyword">) . </span><span class="string">"\n"</span><span class="keyword">;<br />
</span><span class="default">$a</span><span class="keyword">-&gt;</span><span class="default">modify</span><span class="keyword">( </span><span class="string">"+ 1 day" </span><span class="keyword">); </span><span class="comment">// a and b both modified<br />
</span><span class="keyword">echo </span><span class="string">"a = " </span><span class="keyword">. </span><span class="default">$a</span><span class="keyword">-&gt;</span><span class="default">format</span><span class="keyword">(</span><span class="string">'Y-m-j'</span><span class="keyword">) . </span><span class="string">", b = " </span><span class="keyword">. </span><span class="default">$b</span><span class="keyword">-&gt;</span><span class="default">format</span><span class="keyword">(</span><span class="string">'Y-m-j'</span><span class="keyword">) . </span><span class="string">"\n"</span><span class="keyword">; <br />
<br />
</span><span class="comment">// This might be what you want...<br />
</span><span class="default">$c </span><span class="keyword">= </span><span class="default">upDateClone</span><span class="keyword">( </span><span class="default">$a </span><span class="keyword">); </span><span class="comment">// only c updated, a left alone<br />
</span><span class="keyword">echo </span><span class="string">"a = " </span><span class="keyword">. </span><span class="default">$a</span><span class="keyword">-&gt;</span><span class="default">format</span><span class="keyword">(</span><span class="string">'Y-m-j'</span><span class="keyword">) . </span><span class="string">", c = " </span><span class="keyword">. </span><span class="default">$c</span><span class="keyword">-&gt;</span><span class="default">format</span><span class="keyword">(</span><span class="string">'Y-m-j'</span><span class="keyword">) . </span><span class="string">"\n"</span><span class="keyword">;<br />
<br />
function </span><span class="default">upDate</span><span class="keyword">( </span><span class="default">$datetime </span><span class="keyword">) {<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$datetime</span><span class="keyword">-&gt;</span><span class="default">modify</span><span class="keyword">( </span><span class="string">"+ 1 day" </span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; return </span><span class="default">$datetime</span><span class="keyword">;<br />
}<br />
<br />
function </span><span class="default">upDateClone</span><span class="keyword">( </span><span class="default">$datetime </span><span class="keyword">) {<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$dt </span><span class="keyword">= clone </span><span class="default">$datetime</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$dt</span><span class="keyword">-&gt;</span><span class="default">modify</span><span class="keyword">( </span><span class="string">"+ 1 day" </span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; return </span><span class="default">$dt</span><span class="keyword">;<br />
}<br />
</span><span class="default">?&gt;<br />
</span><br />
The above would output something like:<br />
<br />
a = 2012-08-15<br />
a = 2012-08-16, b = 2012-08-16<br />
a = 2012-08-17, b = 2012-08-17<br />
a = 2012-08-17, c = 2012-08-18</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="109052""></a>
  <div class="note">
   <strong class="user">kristof at viewranger dot com</strong>
   <a href="#109052" class="date">16-Jun-2012 11:07</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I hope this clarifies references a bit more:<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">class </span><span class="default">A </span><span class="keyword">{<br />
&nbsp;&nbsp;&nbsp; public </span><span class="default">$foo </span><span class="keyword">= </span><span class="default">1</span><span class="keyword">;<br />
}&nbsp; <br />
<br />
</span><span class="default">$a </span><span class="keyword">= new </span><span class="default">A</span><span class="keyword">;<br />
</span><span class="default">$b </span><span class="keyword">= </span><span class="default">$a</span><span class="keyword">;<br />
</span><span class="default">$a</span><span class="keyword">-&gt;</span><span class="default">foo </span><span class="keyword">= </span><span class="default">2</span><span class="keyword">;<br />
</span><span class="default">$a </span><span class="keyword">= </span><span class="default">NULL</span><span class="keyword">;<br />
echo </span><span class="default">$b</span><span class="keyword">-&gt;</span><span class="default">foo</span><span class="keyword">.</span><span class="string">"\n"</span><span class="keyword">; </span><span class="comment">// 2<br />
<br />
</span><span class="default">$c </span><span class="keyword">= new </span><span class="default">A</span><span class="keyword">;<br />
</span><span class="default">$d </span><span class="keyword">= &amp;</span><span class="default">$c</span><span class="keyword">;<br />
</span><span class="default">$c</span><span class="keyword">-&gt;</span><span class="default">foo </span><span class="keyword">= </span><span class="default">2</span><span class="keyword">;<br />
</span><span class="default">$c </span><span class="keyword">= </span><span class="default">NULL</span><span class="keyword">;<br />
echo </span><span class="default">$d</span><span class="keyword">-&gt;</span><span class="default">foo</span><span class="keyword">.</span><span class="string">"\n"</span><span class="keyword">; </span><span class="comment">// Notice:&nbsp; Trying to get property of non-object...<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="106643""></a>
  <div class="note">
   <strong class="user">Anonymous</strong>
   <a href="#106643" class="date">24-Nov-2011 04:57</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
this example could help:<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">class </span><span class="default">A </span><span class="keyword">{<br />
&nbsp;&nbsp;&nbsp; public </span><span class="default">$testA </span><span class="keyword">= </span><span class="default">1</span><span class="keyword">;<br />
}&nbsp; <br />
<br />
class </span><span class="default">B </span><span class="keyword">{<br />
&nbsp;&nbsp;&nbsp; public </span><span class="default">$testB </span><span class="keyword">= </span><span class="string">"class B"</span><span class="keyword">;<br />
}&nbsp; <br />
<br />
</span><span class="default">$a </span><span class="keyword">= new </span><span class="default">A</span><span class="keyword">;<br />
</span><span class="default">$b </span><span class="keyword">= </span><span class="default">$a</span><span class="keyword">;&nbsp; &nbsp;&nbsp; <br />
</span><span class="default">$b</span><span class="keyword">-&gt;</span><span class="default">testA </span><span class="keyword">= </span><span class="default">2</span><span class="keyword">;<br />
<br />
</span><span class="default">$c </span><span class="keyword">= new </span><span class="default">B</span><span class="keyword">;<br />
</span><span class="default">$a </span><span class="keyword">= </span><span class="default">$c</span><span class="keyword">;<br />
<br />
</span><span class="default">$a</span><span class="keyword">-&gt;</span><span class="default">testB </span><span class="keyword">= </span><span class="string">"Changed Class B"</span><span class="keyword">;<br />
<br />
echo </span><span class="string">"&lt;br/&gt; object a: "</span><span class="keyword">; </span><span class="default">var_dump</span><span class="keyword">(</span><span class="default">$a</span><span class="keyword">);<br />
echo </span><span class="string">"&lt;br/&gt; object b: "</span><span class="keyword">; </span><span class="default">var_dump</span><span class="keyword">(</span><span class="default">$b</span><span class="keyword">);<br />
echo </span><span class="string">"&lt;br/&gt; object c: "</span><span class="keyword">; </span><span class="default">var_dump</span><span class="keyword">(</span><span class="default">$c</span><span class="keyword">);<br />
<br />
</span><span class="comment">// by reference <br />
<br />
</span><span class="default">$aa </span><span class="keyword">= new </span><span class="default">A</span><span class="keyword">;<br />
</span><span class="default">$bb </span><span class="keyword">= &amp;</span><span class="default">$aa</span><span class="keyword">;&nbsp; &nbsp;&nbsp; <br />
</span><span class="default">$bb</span><span class="keyword">-&gt;</span><span class="default">testA </span><span class="keyword">= </span><span class="default">2</span><span class="keyword">;<br />
<br />
</span><span class="default">$cc </span><span class="keyword">= new </span><span class="default">B</span><span class="keyword">;<br />
</span><span class="default">$aa </span><span class="keyword">= </span><span class="default">$cc</span><span class="keyword">;<br />
<br />
</span><span class="default">$aa</span><span class="keyword">-&gt;</span><span class="default">testB </span><span class="keyword">= </span><span class="string">"Changed Class B"</span><span class="keyword">;<br />
<br />
echo </span><span class="string">"&lt;br/&gt; object aa: "</span><span class="keyword">; </span><span class="default">var_dump</span><span class="keyword">(</span><span class="default">$aa</span><span class="keyword">);<br />
echo </span><span class="string">"&lt;br/&gt; object bb: "</span><span class="keyword">; </span><span class="default">var_dump</span><span class="keyword">(</span><span class="default">$bb</span><span class="keyword">);<br />
echo </span><span class="string">"&lt;br/&gt; object cc: "</span><span class="keyword">; </span><span class="default">var_dump</span><span class="keyword">(</span><span class="default">$cc</span><span class="keyword">);<br />
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="102242""></a>
  <div class="note">
   <strong class="user">Rob Marscher</strong>
   <a href="#102242" class="date">03-Feb-2011 06:33</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Here's an example I created that helped me understand the difference between passing objects by reference and by value in php 5.<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">class </span><span class="default">A </span><span class="keyword">{<br />
&nbsp;&nbsp;&nbsp; public </span><span class="default">$foo </span><span class="keyword">= </span><span class="string">'empty'</span><span class="keyword">;<br />
}<br />
class </span><span class="default">B </span><span class="keyword">{<br />
&nbsp;&nbsp;&nbsp; public </span><span class="default">$foo </span><span class="keyword">= </span><span class="string">'empty'</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; public </span><span class="default">$bar </span><span class="keyword">= </span><span class="string">'hello'</span><span class="keyword">;<br />
}<br />
<br />
function </span><span class="default">normalAssignment</span><span class="keyword">(</span><span class="default">$obj</span><span class="keyword">) {<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$obj</span><span class="keyword">-&gt;</span><span class="default">foo </span><span class="keyword">= </span><span class="string">'changed'</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$obj </span><span class="keyword">= new </span><span class="default">B</span><span class="keyword">;<br />
}<br />
<br />
function </span><span class="default">referenceAssignment</span><span class="keyword">(&amp;</span><span class="default">$obj</span><span class="keyword">) {<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$obj</span><span class="keyword">-&gt;</span><span class="default">foo </span><span class="keyword">= </span><span class="string">'changed'</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$obj </span><span class="keyword">= new </span><span class="default">B</span><span class="keyword">;<br />
}<br />
<br />
</span><span class="default">$a </span><span class="keyword">= new </span><span class="default">A</span><span class="keyword">;<br />
</span><span class="default">normalAssignment</span><span class="keyword">(</span><span class="default">$a</span><span class="keyword">);<br />
echo </span><span class="default">get_class</span><span class="keyword">(</span><span class="default">$a</span><span class="keyword">), </span><span class="string">"\n"</span><span class="keyword">;<br />
echo </span><span class="string">"foo = </span><span class="keyword">{</span><span class="default">$a</span><span class="keyword">-&gt;</span><span class="default">foo</span><span class="keyword">}</span><span class="string">\n"</span><span class="keyword">;<br />
<br />
</span><span class="default">referenceAssignment</span><span class="keyword">(</span><span class="default">$a</span><span class="keyword">);<br />
echo </span><span class="default">get_class</span><span class="keyword">(</span><span class="default">$a</span><span class="keyword">), </span><span class="string">"\n"</span><span class="keyword">;<br />
echo </span><span class="string">"foo = </span><span class="keyword">{</span><span class="default">$a</span><span class="keyword">-&gt;</span><span class="default">foo</span><span class="keyword">}</span><span class="string">\n"</span><span class="keyword">;<br />
echo </span><span class="string">"bar = </span><span class="keyword">{</span><span class="default">$a</span><span class="keyword">-&gt;</span><span class="default">bar</span><span class="keyword">}</span><span class="string">\n"</span><span class="keyword">;<br />
<br />
</span><span class="comment">/*<br />
prints:<br />
A<br />
foo = changed<br />
B<br />
foo = empty<br />
bar = hello<br />
*/<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="101900""></a>
  <div class="note">
   <strong class="user">Anonymous</strong>
   <a href="#101900" class="date">17-Jan-2011 05:51</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
There seems to be some confusion here. The distinction between pointers and references is not particularly helpful.<br />
The behavior in some of the "comprehensive" examples already posted can be explained in simpler unifying terms. Hayley's code, for example, is doing EXACTLY what you should expect it should. (Using &gt;= 5.3)<br />
<br />
First principle:<br />
A pointer stores a memory address to access an object. Any time an object is assigned, a pointer is generated. (I haven't delved TOO deeply into the Zend engine yet, but as far as I can see, this applies)<br />
<br />
2nd principle, and source of the most confusion:<br />
Passing a variable to a function is done by default as a value pass, ie, you are working with a copy. "But objects are passed by reference!" A common misconception both here and in the Java world. I never said a copy OF WHAT. The default passing is done by value. Always. WHAT is being copied and passed, however, is the pointer. When using the "-&gt;", you will of course be accessing the same internals as the original variable in the caller function. Just using "=" will only play with copies.<br />
<br />
3rd principle:<br />
"&amp;" automatically and permanently sets another variable name/pointer to the same memory address as something else until you decouple them. It is correct to use the term "alias" here. Think of it as joining two pointers at the hip until forcibly separated with "unset()". This functionality exists both in the same scope and when an argument is passed to a function. Often the passed argument is called a "reference," due to certain distinctions between "passing by value" and "passing by reference" that were clearer in C and C++.<br />
<br />
Just remember: pointers to objects, not objects themselves, are passed to functions. These pointers are COPIES of the original unless you use "&amp;" in your parameter list to actually pass the originals. Only when you dig into the internals of an object will the originals change.<br />
<br />
Example:<br />
<br />
<span class="default">&lt;?php<br />
<br />
</span><span class="comment">//The two are meant to be the same<br />
</span><span class="default">$a </span><span class="keyword">= </span><span class="string">"Clark Kent"</span><span class="keyword">; </span><span class="comment">//a==Clark Kent<br />
</span><span class="default">$b </span><span class="keyword">= &amp;</span><span class="default">$a</span><span class="keyword">; </span><span class="comment">//The two will now share the same fate.<br />
<br />
</span><span class="default">$b</span><span class="keyword">=</span><span class="string">"Superman"</span><span class="keyword">; </span><span class="comment">// $a=="Superman" too.<br />
</span><span class="keyword">echo </span><span class="default">$a</span><span class="keyword">; <br />
echo </span><span class="default">$a</span><span class="keyword">=</span><span class="string">"Clark Kent"</span><span class="keyword">; </span><span class="comment">// $b=="Clark Kent" too.<br />
</span><span class="keyword">unset(</span><span class="default">$b</span><span class="keyword">); </span><span class="comment">// $b divorced from $a<br />
</span><span class="default">$b</span><span class="keyword">=</span><span class="string">"Bizarro"</span><span class="keyword">;<br />
echo </span><span class="default">$a</span><span class="keyword">; </span><span class="comment">// $a=="Clark Kent" still, since $b is a free agent pointer now.<br />
<br />
//The two are NOT meant to be the same.<br />
</span><span class="default">$c</span><span class="keyword">=</span><span class="string">"King"</span><span class="keyword">;<br />
</span><span class="default">$d</span><span class="keyword">=</span><span class="string">"Pretender to the Throne"</span><span class="keyword">;<br />
echo </span><span class="default">$c</span><span class="keyword">.</span><span class="string">"\n"</span><span class="keyword">; </span><span class="comment">// $c=="King"<br />
</span><span class="keyword">echo </span><span class="default">$d</span><span class="keyword">.</span><span class="string">"\n"</span><span class="keyword">; </span><span class="comment">// $d=="Pretender to the Throne"<br />
</span><span class="default">swapByValue</span><span class="keyword">(</span><span class="default">$c</span><span class="keyword">, </span><span class="default">$d</span><span class="keyword">);<br />
echo </span><span class="default">$c</span><span class="keyword">.</span><span class="string">"\n"</span><span class="keyword">; </span><span class="comment">// $c=="King"<br />
</span><span class="keyword">echo </span><span class="default">$d</span><span class="keyword">.</span><span class="string">"\n"</span><span class="keyword">; </span><span class="comment">// $d=="Pretender to the Throne"<br />
</span><span class="default">swapByRef</span><span class="keyword">(</span><span class="default">$c</span><span class="keyword">, </span><span class="default">$d</span><span class="keyword">);<br />
echo </span><span class="default">$c</span><span class="keyword">.</span><span class="string">"\n"</span><span class="keyword">; </span><span class="comment">// $c=="Pretender to the Throne"<br />
</span><span class="keyword">echo </span><span class="default">$d</span><span class="keyword">.</span><span class="string">"\n"</span><span class="keyword">; </span><span class="comment">// $d=="King"<br />
<br />
</span><span class="keyword">function </span><span class="default">swapByValue</span><span class="keyword">(</span><span class="default">$x</span><span class="keyword">, </span><span class="default">$y</span><span class="keyword">){<br />
</span><span class="default">$temp</span><span class="keyword">=</span><span class="default">$x</span><span class="keyword">;<br />
</span><span class="default">$x</span><span class="keyword">=</span><span class="default">$y</span><span class="keyword">;<br />
</span><span class="default">$y</span><span class="keyword">=</span><span class="default">$temp</span><span class="keyword">;<br />
</span><span class="comment">//All this beautiful work will disappear<br />
//because it was done on COPIES of pointers.<br />
//The originals pointers still point as they did.<br />
</span><span class="keyword">}<br />
<br />
function </span><span class="default">swapByRef</span><span class="keyword">(&amp;</span><span class="default">$x</span><span class="keyword">, &amp;</span><span class="default">$y</span><span class="keyword">){<br />
&nbsp;</span><span class="default">$temp</span><span class="keyword">=</span><span class="default">$x</span><span class="keyword">;<br />
&nbsp;</span><span class="default">$x</span><span class="keyword">=</span><span class="default">$y</span><span class="keyword">;<br />
&nbsp;</span><span class="default">$y</span><span class="keyword">=</span><span class="default">$temp</span><span class="keyword">;<br />
&nbsp;</span><span class="comment">//Note the parameter list: now we switched 'em REAL good.<br />
</span><span class="keyword">}<br />
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="97052""></a>
  <div class="note">
   <strong class="user">Hayley Watson</strong>
   <a href="#97052" class="date">30-Mar-2010 04:21</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Using &amp;$this can result in some weird and counter-intuitive behaviour - it starts lying to you.<br />
<br />
<span class="default">&lt;?php<br />
<br />
</span><span class="keyword">class </span><span class="default">Bar<br />
</span><span class="keyword">{<br />
&nbsp;&nbsp;&nbsp; public </span><span class="default">$prop </span><span class="keyword">= </span><span class="default">42</span><span class="keyword">;<br />
}<br />
<br />
class </span><span class="default">Foo<br />
</span><span class="keyword">{<br />
&nbsp;&nbsp;&nbsp; public </span><span class="default">$prop </span><span class="keyword">= </span><span class="default">17</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; function </span><span class="default">boom</span><span class="keyword">()<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$bar </span><span class="keyword">= &amp;</span><span class="default">$this</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; echo </span><span class="string">"\$bar is an alias of \$this, a Foo.\n"</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; echo </span><span class="string">'$this is a '</span><span class="keyword">, </span><span class="default">get_class</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">), </span><span class="string">'; $bar is a '</span><span class="keyword">, </span><span class="default">get_class</span><span class="keyword">(</span><span class="default">$bar</span><span class="keyword">), </span><span class="string">"\n"</span><span class="keyword">;<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; echo </span><span class="string">"Are they the same object? "</span><span class="keyword">, (</span><span class="default">$bar </span><span class="keyword">=== </span><span class="default">$this </span><span class="keyword">? </span><span class="string">"Yes\n" </span><span class="keyword">: </span><span class="string">"No\n"</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; echo </span><span class="string">"Are they equal? "</span><span class="keyword">, (</span><span class="default">$bar </span><span class="keyword">=== </span><span class="default">$this </span><span class="keyword">? </span><span class="string">"Yes\n" </span><span class="keyword">: </span><span class="string">"No\n"</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; echo </span><span class="string">'$this says its prop value is '</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; echo </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">prop</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; echo </span><span class="string">' and $bar says it is '</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; echo </span><span class="default">$bar</span><span class="keyword">-&gt;</span><span class="default">prop</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; echo </span><span class="string">"\n"</span><span class="keyword">;<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; echo </span><span class="string">"\n"</span><span class="keyword">;<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$bar </span><span class="keyword">= new </span><span class="default">Bar</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; echo </span><span class="string">"\$bar has been made into a new Bar.\n"</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; echo </span><span class="string">'$this is a '</span><span class="keyword">, </span><span class="default">get_class</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">), </span><span class="string">'; $bar is a '</span><span class="keyword">, </span><span class="default">get_class</span><span class="keyword">(</span><span class="default">$bar</span><span class="keyword">), </span><span class="string">"\n"</span><span class="keyword">;<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; echo </span><span class="string">"Are they the same object? "</span><span class="keyword">, (</span><span class="default">$bar </span><span class="keyword">=== </span><span class="default">$this </span><span class="keyword">? </span><span class="string">"Yes\n" </span><span class="keyword">: </span><span class="string">"No\n"</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; echo </span><span class="string">"Are they equal? "</span><span class="keyword">, (</span><span class="default">$bar </span><span class="keyword">=== </span><span class="default">$this </span><span class="keyword">? </span><span class="string">"Yes\n" </span><span class="keyword">: </span><span class="string">"No\n"</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; echo </span><span class="string">'$this says its prop value is '</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; echo </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">prop</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; echo </span><span class="string">' and $bar says it is '</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; echo </span><span class="default">$bar</span><span class="keyword">-&gt;</span><span class="default">prop</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; echo </span><span class="string">"\n"</span><span class="keyword">;<br />
<br />
&nbsp;&nbsp;&nbsp; }<br />
}<br />
<br />
</span><span class="default">$t </span><span class="keyword">= new </span><span class="default">Foo</span><span class="keyword">;<br />
</span><span class="default">$t</span><span class="keyword">-&gt;</span><span class="default">boom</span><span class="keyword">();<br />
</span><span class="default">?&gt;<br />
</span>In the above $this claims to be a Bar (in fact it claims to be the very same object that $bar is), while still having all the properties and methods of a Foo.<br />
<br />
Fortunately it doesn't persist beyond the method where you committed the faux pas.<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">echo </span><span class="default">get_class</span><span class="keyword">(</span><span class="default">$t</span><span class="keyword">), </span><span class="string">"\t"</span><span class="keyword">, </span><span class="default">$t</span><span class="keyword">-&gt;</span><span class="default">prop</span><span class="keyword">;<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="95522""></a>
  <div class="note">
   <strong class="user">miklcct at gmail dot com</strong>
   <a href="#95522" class="date">07-Jan-2010 10:34</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Notes on reference:<br />
A reference is not a pointer. However, an object handle IS a pointer. Example:<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">class </span><span class="default">Foo </span><span class="keyword">{<br />
&nbsp; private static </span><span class="default">$used</span><span class="keyword">;<br />
&nbsp; private </span><span class="default">$id</span><span class="keyword">;<br />
&nbsp; public function </span><span class="default">__construct</span><span class="keyword">() {<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$id </span><span class="keyword">= </span><span class="default">$used</span><span class="keyword">++;<br />
&nbsp; }<br />
&nbsp; public function </span><span class="default">__clone</span><span class="keyword">() {<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$id </span><span class="keyword">= </span><span class="default">$used</span><span class="keyword">++;<br />
&nbsp; }<br />
}<br />
<br />
</span><span class="default">$a </span><span class="keyword">= new </span><span class="default">Foo</span><span class="keyword">; </span><span class="comment">// $a is a pointer pointing to Foo object 0<br />
</span><span class="default">$b </span><span class="keyword">= </span><span class="default">$a</span><span class="keyword">; </span><span class="comment">// $b is a pointer pointing to Foo object 0, however, $b is a copy of $a<br />
</span><span class="default">$c </span><span class="keyword">= &amp;</span><span class="default">$a</span><span class="keyword">; </span><span class="comment">// $c and $a are now references of a pointer pointing to Foo object 0<br />
</span><span class="default">$a </span><span class="keyword">= new </span><span class="default">Foo</span><span class="keyword">; </span><span class="comment">// $a and $c are now references of a pointer pointing to Foo object 1, $b is still a pointer pointing to Foo object 0<br />
</span><span class="keyword">unset(</span><span class="default">$a</span><span class="keyword">); </span><span class="comment">// A reference with reference count 1 is automatically converted back to a value. Now $c is a pointer to Foo object 1<br />
</span><span class="default">$a </span><span class="keyword">= &amp;</span><span class="default">$b</span><span class="keyword">; </span><span class="comment">// $a and $b are now references of a pointer pointing to Foo object 0<br />
</span><span class="default">$a </span><span class="keyword">= </span><span class="default">NULL</span><span class="keyword">; </span><span class="comment">// $a and $b now become a reference to NULL. Foo object 0 can be garbage collected now<br />
</span><span class="keyword">unset(</span><span class="default">$b</span><span class="keyword">); </span><span class="comment">// $b no longer exists and $a is now NULL<br />
</span><span class="default">$a </span><span class="keyword">= clone </span><span class="default">$c</span><span class="keyword">; </span><span class="comment">// $a is now a pointer to Foo object 2, $c remains a pointer to Foo object 1<br />
</span><span class="keyword">unset(</span><span class="default">$c</span><span class="keyword">); </span><span class="comment">// Foo object 1 can be garbage collected now.<br />
</span><span class="default">$c </span><span class="keyword">= </span><span class="default">$a</span><span class="keyword">; </span><span class="comment">// $c and $a are pointers pointing to Foo object 2<br />
</span><span class="keyword">unset(</span><span class="default">$a</span><span class="keyword">); </span><span class="comment">// Foo object 2 is still pointed by $c<br />
</span><span class="default">$a </span><span class="keyword">= &amp;</span><span class="default">$c</span><span class="keyword">; </span><span class="comment">// Foo object 2 has 1 pointers pointing to it only, that pointer has 2 references: $a and $c;<br />
</span><span class="keyword">const </span><span class="default">ABC </span><span class="keyword">= </span><span class="default">TRUE</span><span class="keyword">;<br />
if(</span><span class="default">ABC</span><span class="keyword">) {<br />
&nbsp; </span><span class="default">$a </span><span class="keyword">= </span><span class="default">NULL</span><span class="keyword">; </span><span class="comment">// Foo object 2 can be garbage collected now because $a and $c are now a reference to the same NULL value<br />
</span><span class="keyword">} else {<br />
&nbsp; unset(</span><span class="default">$a</span><span class="keyword">); </span><span class="comment">// Foo object 2 is still pointed to $c<br />
</span><span class="keyword">}</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="92955""></a>
  <div class="note">
   <strong class="user">mjung at poczta dot onet dot pl</strong>
   <a href="#92955" class="date">16-Aug-2009 07:25</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Ultimate explanation to object references:<br />
NOTE: wording 'points to' could be easily replaced with 'refers ' and is used loosly.<br />
<span class="default">&lt;?php<br />
$a1 </span><span class="keyword">= new </span><span class="default">A</span><span class="keyword">(</span><span class="default">1</span><span class="keyword">);&nbsp; </span><span class="comment">// $a1 == handle1-1 to A(1)<br />
</span><span class="default">$a2 </span><span class="keyword">= </span><span class="default">$a1</span><span class="keyword">;&nbsp; &nbsp;&nbsp; </span><span class="comment">// $a2 == handle1-2 to A(1) - assigned by value (copy)<br />
</span><span class="default">$a3 </span><span class="keyword">= &amp;</span><span class="default">$a1</span><span class="keyword">;&nbsp; </span><span class="comment">// $a3 points to $a1 (handle1-1)<br />
</span><span class="default">$a3 </span><span class="keyword">= </span><span class="default">null</span><span class="keyword">;&nbsp; &nbsp; &nbsp; </span><span class="comment">// makes $a1==null, $a3 (still) points to $a1, $a2 == handle1-2 (same object instance A(1))<br />
</span><span class="default">$a2 </span><span class="keyword">= </span><span class="default">null</span><span class="keyword">;&nbsp; &nbsp; &nbsp; </span><span class="comment">// makes $a2 == null<br />
</span><span class="default">$a1 </span><span class="keyword">= new </span><span class="default">A</span><span class="keyword">(</span><span class="default">2</span><span class="keyword">); </span><span class="comment">//makes $a1 == handle2-1 to new object and $a3 (still) points to $a1 =&gt; handle2-1 (new object), so value of $a1 and $a3 is the new object and $a2 == null<br />
//By reference:<br />
</span><span class="default">$a4 </span><span class="keyword">= &amp;new </span><span class="default">A</span><span class="keyword">(</span><span class="default">4</span><span class="keyword">);&nbsp; </span><span class="comment">//$a4 points to handle4-1 to A(4)<br />
</span><span class="default">$a5 </span><span class="keyword">= </span><span class="default">$a4</span><span class="keyword">;&nbsp;&nbsp; </span><span class="comment">// $a5 == handle4-2 to A(4) (copy)<br />
</span><span class="default">$a6 </span><span class="keyword">= &amp;</span><span class="default">$a4</span><span class="keyword">;&nbsp; </span><span class="comment">//$a6 points to (handle4-1), not to $a4 (reference to reference references the referenced object handle4-1 not the reference itself)<br />
<br />
</span><span class="default">$a4 </span><span class="keyword">= &amp;new </span><span class="default">A</span><span class="keyword">(</span><span class="default">40</span><span class="keyword">); </span><span class="comment">// $a4 points to handle40-1, $a5 == handle4-2 and $a6 still points to handle4-1 to A(4)<br />
</span><span class="default">$a6 </span><span class="keyword">= </span><span class="default">null</span><span class="keyword">;&nbsp; </span><span class="comment">// sets handle4-1 to null; $a5 == handle4-2 = A(4); $a4 points to handle40-1; $a6 points to null<br />
</span><span class="default">$a6 </span><span class="keyword">=&amp;</span><span class="default">$a4</span><span class="keyword">; </span><span class="comment">// $a6 points to handle40-1<br />
</span><span class="default">$a7 </span><span class="keyword">= &amp;</span><span class="default">$a6</span><span class="keyword">; </span><span class="comment">//$a7 points to handle40-1<br />
</span><span class="default">$a8 </span><span class="keyword">= &amp;</span><span class="default">$a7</span><span class="keyword">; </span><span class="comment">//$a8 points to handle40-1<br />
</span><span class="default">$a5 </span><span class="keyword">= </span><span class="default">$a7</span><span class="keyword">;&nbsp; </span><span class="comment">//$a5 == handle40-2 (copy)<br />
</span><span class="default">$a6 </span><span class="keyword">= </span><span class="default">null</span><span class="keyword">; </span><span class="comment">//makes handle40-1 null, all variables pointing to (hanlde40-1 ==null) are null, except ($a5 == handle40-2 = A(40))<br />
</span><span class="default">?&gt;<br />
</span>Hope this helps.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="91627""></a>
  <div class="note">
   <strong class="user">Aaron Bond</strong>
   <a href="#91627" class="date">20-Jun-2009 03:08</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I've bumped into a behavior that helped clarify the difference between objects and identifiers for me.<br />
<br />
When we hand off an object variable, we get an identifier to that object's value.&nbsp; This means that if I were to mutate the object from a passed variable, ALL variables originating from that instance of the object will change.&nbsp; <br />
<br />
HOWEVER, if I set that object variable to new instance, it replaces the identifier itself with a new identifier and leaves the old instance in tact.<br />
<br />
Take the following example:<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">class </span><span class="default">A </span><span class="keyword">{<br />
&nbsp;&nbsp;&nbsp; public </span><span class="default">$foo </span><span class="keyword">= </span><span class="default">1</span><span class="keyword">;<br />
}&nbsp; <br />
<br />
class </span><span class="default">B </span><span class="keyword">{<br />
&nbsp;&nbsp;&nbsp; public function </span><span class="default">foo</span><span class="keyword">(</span><span class="default">A $bar</span><span class="keyword">)<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$bar</span><span class="keyword">-&gt;</span><span class="default">foo </span><span class="keyword">= </span><span class="default">42</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; public function </span><span class="default">bar</span><span class="keyword">(</span><span class="default">A $bar</span><span class="keyword">)<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$bar </span><span class="keyword">= new </span><span class="default">A</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }<br />
}<br />
<br />
</span><span class="default">$f </span><span class="keyword">= new </span><span class="default">A</span><span class="keyword">;<br />
</span><span class="default">$g </span><span class="keyword">= new </span><span class="default">B</span><span class="keyword">;<br />
echo </span><span class="default">$f</span><span class="keyword">-&gt;</span><span class="default">foo </span><span class="keyword">. </span><span class="string">"\n"</span><span class="keyword">;<br />
<br />
</span><span class="default">$g</span><span class="keyword">-&gt;</span><span class="default">foo</span><span class="keyword">(</span><span class="default">$f</span><span class="keyword">);<br />
echo </span><span class="default">$f</span><span class="keyword">-&gt;</span><span class="default">foo </span><span class="keyword">. </span><span class="string">"\n"</span><span class="keyword">;<br />
<br />
</span><span class="default">$g</span><span class="keyword">-&gt;</span><span class="default">bar</span><span class="keyword">(</span><span class="default">$f</span><span class="keyword">);<br />
echo </span><span class="default">$f</span><span class="keyword">-&gt;</span><span class="default">foo </span><span class="keyword">. </span><span class="string">"\n"</span><span class="keyword">;<br />
<br />
</span><span class="default">?&gt;<br />
</span><br />
If object variables were always references, we'd expect the following output:<br />
1<br />
42<br />
1<br />
<br />
However, we get:<br />
1<br />
42<br />
42<br />
<br />
The reason for this is simple.&nbsp; In the bar function of the B class, we replace the identifier you passed in, which identified the same instance of the A class as your $f variable, with a brand new A class identifier.&nbsp; Creating a new instance of A doesn't mutate $f because $f wasn't passed as a reference.<br />
<br />
To get the reference behavior, one would have to enter the following for class B:<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">class </span><span class="default">B </span><span class="keyword">{<br />
&nbsp;&nbsp;&nbsp; public function </span><span class="default">foo</span><span class="keyword">(</span><span class="default">A $bar</span><span class="keyword">)<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$bar</span><span class="keyword">-&gt;</span><span class="default">foo </span><span class="keyword">= </span><span class="default">42</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; public function </span><span class="default">bar</span><span class="keyword">(</span><span class="default">A </span><span class="keyword">&amp;</span><span class="default">$bar</span><span class="keyword">)<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$bar </span><span class="keyword">= new </span><span class="default">A</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }<br />
}<br />
</span><span class="default">?&gt;<br />
</span><br />
The foo function doesn't require a reference, because it is MUTATING an object instance that $bar identifies.&nbsp; But bar will be REPLACING the object instance.&nbsp; If only an identifier is passed, the variable identifier will be overwritten but the object instance will be left in place.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="86374""></a>
  <div class="note">
   <strong class="user">Ivan Bertona</strong>
   <a href="#86374" class="date">15-Oct-2008 05:45</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
A point that in my opinion is not stressed enough in the manual page is that in PHP5, passing an object as an argument of a function call with no use of the &amp; operator means passing BY VALUE an unique identifier for that object (intended as instance of a class), which will be stored in another variable that has function scope.<br />
<br />
This behaviour is the same used in Java, where indeed there is no notion of passing arguments by reference. On the other hand, in PHP you can pass a value by reference (in PHP we refer to references as "aliases"), and this poses a threat if you are not aware of what you are really doing. Please consider these two classes:<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">class </span><span class="default">A <br />
</span><span class="keyword">{<br />
&nbsp;&nbsp;&nbsp; function </span><span class="default">__toString</span><span class="keyword">() {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="string">"Class A"</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }<br />
}<br />
&nbsp;&nbsp;&nbsp; <br />
class </span><span class="default">B<br />
</span><span class="keyword">{<br />
&nbsp;&nbsp;&nbsp; function </span><span class="default">__toString</span><span class="keyword">() {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="string">"Class B"</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }<br />
}<br />
</span><span class="default">?&gt;<br />
</span><br />
In the first test case we make two objects out of the classes A and B, then swap the variables using a temp one and the normal assignment operator (=).<br />
<br />
<span class="default">&lt;?php<br />
$a </span><span class="keyword">= new </span><span class="default">A</span><span class="keyword">();<br />
</span><span class="default">$b </span><span class="keyword">= new </span><span class="default">B</span><span class="keyword">();<br />
&nbsp;&nbsp;&nbsp; <br />
</span><span class="default">$temp </span><span class="keyword">= </span><span class="default">$a</span><span class="keyword">;<br />
</span><span class="default">$a </span><span class="keyword">= </span><span class="default">$b</span><span class="keyword">;<br />
</span><span class="default">$b </span><span class="keyword">= </span><span class="default">$temp</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; <br />
print(</span><span class="string">'$a: ' </span><span class="keyword">. </span><span class="default">$a </span><span class="keyword">. </span><span class="string">"\n"</span><span class="keyword">);<br />
print(</span><span class="string">'$b: ' </span><span class="keyword">. </span><span class="default">$b </span><span class="keyword">. </span><span class="string">"\n"</span><span class="keyword">);<br />
</span><span class="default">?&gt;<br />
</span><br />
As expected the script will output:<br />
<br />
$a: Class B<br />
$b: Class A<br />
<br />
Now consider the following snippet. It is similar to the former but the assignment $a = &amp;$b makes $a an ALIAS of $b.<br />
<br />
<span class="default">&lt;?php<br />
$a </span><span class="keyword">= new </span><span class="default">A</span><span class="keyword">();<br />
</span><span class="default">$b </span><span class="keyword">= new </span><span class="default">B</span><span class="keyword">();<br />
&nbsp;&nbsp;&nbsp; <br />
</span><span class="default">$temp </span><span class="keyword">= </span><span class="default">$a</span><span class="keyword">;<br />
</span><span class="default">$a </span><span class="keyword">= &amp;</span><span class="default">$b</span><span class="keyword">;<br />
</span><span class="default">$b </span><span class="keyword">= </span><span class="default">$temp</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; <br />
print(</span><span class="string">'$a: ' </span><span class="keyword">. </span><span class="default">$a </span><span class="keyword">. </span><span class="string">"\n"</span><span class="keyword">);<br />
print(</span><span class="string">'$b: ' </span><span class="keyword">. </span><span class="default">$b </span><span class="keyword">. </span><span class="string">"\n"</span><span class="keyword">);<br />
</span><span class="default">?&gt;<br />
</span><br />
This script will output:<br />
<br />
$a: Class A<br />
$b: Class A<br />
<br />
That is, modifying $b reflects the same assignment on $a... The two variables end pointing to the same object, and the other one is lost. To sum up is a good practice NOT using aliasing when handling PHP5 objects, unless your are really really sure of what you are doing.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="86050""></a>
  <div class="note">
   <strong class="user">lazybones_senior</strong>
   <a href="#86050" class="date">01-Oct-2008 03:57</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
WHOA... KEEP IT SIMPLE!<br />
<br />
In regards to secure_admin's note: You've used OOP to simplify PHP's ability to create and use object references. Now use PHP's static keyword to simplify your OOP.<br />
<br />
<span class="default">&lt;?php<br />
<br />
</span><span class="keyword">class </span><span class="default">DataModelControl </span><span class="keyword">{<br />
&nbsp; protected static </span><span class="default">$data </span><span class="keyword">= </span><span class="default">256</span><span class="keyword">; </span><span class="comment">// default value; <br />
&nbsp; </span><span class="keyword">protected </span><span class="default">$name</span><span class="keyword">;<br />
<br />
&nbsp; public function </span><span class="default">__construct</span><span class="keyword">(</span><span class="default">$dmcName</span><span class="keyword">) {<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">name </span><span class="keyword">= </span><span class="default">$dmcName</span><span class="keyword">;<br />
&nbsp; }<br />
<br />
&nbsp; public static function </span><span class="default">setData</span><span class="keyword">(</span><span class="default">$dmcData</span><span class="keyword">) {<br />
&nbsp;&nbsp;&nbsp; if(</span><span class="default">is_numeric</span><span class="keyword">(</span><span class="default">$dmcData</span><span class="keyword">)) {<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="default">self</span><span class="keyword">::</span><span class="default">$data </span><span class="keyword">= </span><span class="default">$dmcData</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp; }<br />
<br />
&nbsp; public function </span><span class="default">__toString</span><span class="keyword">() {<br />
&nbsp;&nbsp;&nbsp; return </span><span class="string">"DataModelControl [name=</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">name</span><span class="string">, data=" </span><span class="keyword">. </span><span class="default">self</span><span class="keyword">::</span><span class="default">$data </span><span class="keyword">. </span><span class="string">"]"</span><span class="keyword">;<br />
&nbsp; }&nbsp;&nbsp; <br />
}<br />
<br />
</span><span class="comment"># create several instances of DataModelControl...<br />
</span><span class="default">$dmc1 </span><span class="keyword">= new </span><span class="default">DataModelControl</span><span class="keyword">(</span><span class="string">'dmc1'</span><span class="keyword">);<br />
</span><span class="default">$dmc2 </span><span class="keyword">= new </span><span class="default">DataModelControl</span><span class="keyword">(</span><span class="string">'dmc2'</span><span class="keyword">);<br />
</span><span class="default">$dmc3 </span><span class="keyword">= new </span><span class="default">DataModelControl</span><span class="keyword">(</span><span class="string">'dmc3'</span><span class="keyword">);<br />
echo </span><span class="default">$dmc1 </span><span class="keyword">. </span><span class="string">'&lt;br&gt;'</span><span class="keyword">;<br />
echo </span><span class="default">$dmc2 </span><span class="keyword">. </span><span class="string">'&lt;br&gt;'</span><span class="keyword">;<br />
echo </span><span class="default">$dmc3 </span><span class="keyword">. </span><span class="string">'&lt;br&gt;&lt;br&gt;'</span><span class="keyword">;<br />
<br />
</span><span class="comment"># To change data, use any DataModelControl object...<br />
</span><span class="default">$dmc2</span><span class="keyword">-&gt;</span><span class="default">setData</span><span class="keyword">(</span><span class="default">512</span><span class="keyword">);<br />
</span><span class="comment"># Or, call setData() directly from the class...<br />
</span><span class="default">DataModelControl</span><span class="keyword">::</span><span class="default">setData</span><span class="keyword">(</span><span class="default">1024</span><span class="keyword">);<br />
echo </span><span class="default">$dmc1 </span><span class="keyword">. </span><span class="string">'&lt;br&gt;'</span><span class="keyword">;<br />
echo </span><span class="default">$dmc2 </span><span class="keyword">. </span><span class="string">'&lt;br&gt;'</span><span class="keyword">;<br />
echo </span><span class="default">$dmc3 </span><span class="keyword">. </span><span class="string">'&lt;br&gt;&lt;br&gt;'</span><span class="keyword">;<br />
</span><span class="default">?&gt;<br />
</span><br />
&nbsp;DataModelControl [name=dmc1, data=256]<br />
&nbsp;DataModelControl [name=dmc2, data=256]<br />
&nbsp;DataModelControl [name=dmc3, data=256]<br />
<br />
&nbsp;DataModelControl [name=dmc1, data=1024]<br />
&nbsp;DataModelControl [name=dmc2, data=1024]<br />
&nbsp;DataModelControl [name=dmc3, data=1024]<br />
<br />
... even better! Now, PHP creates one copy of $data, that is shared amongst all DataModelControl objects.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="86042""></a>
  <div class="note">
   <strong class="user">wbcarts at juno dot com</strong>
   <a href="#86042" class="date">30-Sep-2008 10:23</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
A BIT DILUTED... but it's alright!<br />
<br />
In the PHP example above, the function foo($obj), will actually create a $foo property to "any object" passed to it - which brings some confusion to me:<br />
&nbsp; $obj = new stdClass();<br />
&nbsp; foo($obj);&nbsp; &nbsp; // tags on a $foo property to the object<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; // why is this method here?<br />
Furthermore, in OOP, it is not a good idea for "global functions" to operate on an object's properties... and it is not a good idea for your class objects to let them. To illustrate the point, the example should be:<br />
<br />
<span class="default">&lt;?php<br />
<br />
</span><span class="keyword">class </span><span class="default">A </span><span class="keyword">{<br />
&nbsp; protected </span><span class="default">$foo </span><span class="keyword">= </span><span class="default">1</span><span class="keyword">;<br />
<br />
&nbsp; public function </span><span class="default">getFoo</span><span class="keyword">() {<br />
&nbsp;&nbsp;&nbsp; return </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">foo</span><span class="keyword">;<br />
&nbsp; }<br />
<br />
&nbsp; public function </span><span class="default">setFoo</span><span class="keyword">(</span><span class="default">$val</span><span class="keyword">) {<br />
&nbsp;&nbsp;&nbsp; if(</span><span class="default">$val </span><span class="keyword">&gt; </span><span class="default">0 </span><span class="keyword">&amp;&amp; </span><span class="default">$val </span><span class="keyword">&lt; </span><span class="default">10</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">foo </span><span class="keyword">= </span><span class="default">$val</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp; }<br />
<br />
&nbsp; public function </span><span class="default">__toString</span><span class="keyword">() {<br />
&nbsp;&nbsp;&nbsp; return </span><span class="string">"A [foo=</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">foo</span><span class="string">]"</span><span class="keyword">;<br />
&nbsp; }<br />
}<br />
<br />
</span><span class="default">$a </span><span class="keyword">= new </span><span class="default">A</span><span class="keyword">();<br />
</span><span class="default">$b </span><span class="keyword">= </span><span class="default">$a</span><span class="keyword">;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="comment">// $a and $b are copies of the same identifier<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; // ($a) = ($b) = &lt;id&gt;<br />
</span><span class="default">$b</span><span class="keyword">-&gt;</span><span class="default">setFoo</span><span class="keyword">(</span><span class="default">2</span><span class="keyword">);<br />
echo </span><span class="default">$a</span><span class="keyword">-&gt;</span><span class="default">getFoo</span><span class="keyword">() . </span><span class="string">'&lt;br&gt;'</span><span class="keyword">;<br />
<br />
</span><span class="default">$c </span><span class="keyword">= new </span><span class="default">A</span><span class="keyword">();<br />
</span><span class="default">$d </span><span class="keyword">= &amp;</span><span class="default">$c</span><span class="keyword">;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// $c and $d are references<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; // ($c,$d) = &lt;id&gt;<br />
</span><span class="default">$d</span><span class="keyword">-&gt;</span><span class="default">setFoo</span><span class="keyword">(</span><span class="default">2</span><span class="keyword">);<br />
echo </span><span class="default">$c </span><span class="keyword">. </span><span class="string">'&lt;br&gt;'</span><span class="keyword">;<br />
<br />
</span><span class="default">$e </span><span class="keyword">= new </span><span class="default">A</span><span class="keyword">();<br />
</span><span class="default">$e</span><span class="keyword">-&gt;</span><span class="default">setFoo</span><span class="keyword">(</span><span class="default">16</span><span class="keyword">);&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// will be ignored<br />
</span><span class="keyword">echo </span><span class="default">$e</span><span class="keyword">;<br />
<br />
</span><span class="default">?&gt;<br />
</span> - - -<br />
&nbsp;2<br />
&nbsp;A [foo=2]<br />
&nbsp;A [foo=1]<br />
&nbsp;- - -<br />
Because the global function foo() has been deleted, class A is more defined, robust and will handle all foo operations... and only for objects of type A. I can now take it for granted and see clearly that your are talking about "A" objects and their references. But it still reminds me too much of cloning and object comparisons, which to me borders on machine-like programming and not object-oriented programming, which is a totally different way to think.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
</div>
</div>
</div></div></body></html>
