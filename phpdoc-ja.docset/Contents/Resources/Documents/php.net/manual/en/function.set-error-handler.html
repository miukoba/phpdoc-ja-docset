<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
 <head>
  <meta http-equiv="content-type" content="text/html; CHARSET=shift-jis">
  <title>ユーザー定義のエラーハンドラ関数を設定する</title>

  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <link media="all" rel="stylesheet" type="text/css" href="style.css"/>
 </head>
 <body class="docs" class="docs"><div class="navbar navbar-fixed-top">
  <div class="navbar-inner clearfix">
    <ul class="nav" style="width: 100%">
      <li style="float: left;"><a href="function.restore-exception-handler.html">≪ restore_exception_handler</a></li>
      <li style="float: right;"><a href="function.set-exception-handler.html">set_exception_handler ≫</a></li>
    </ul>
  </div>
</div>
<div id="breadcrumbs" class="clearfix">
  <ul class="breadcrumbs-container">
    <li><a href="index.html">PHP Manual</a></li>
    <li><a href="ref.errorfunc.html">エラー処理関数</a></li>
    <li>ユーザー定義のエラーハンドラ関数を設定する</li>
  </ul>
</div>
<div id="layout">
  <div id="layout-content"><div id="function.set-error-handler" class="refentry">
 <div class="refnamediv">
  <h1 class="refname">set_error_handler</h1>
  <p class="verinfo">(PHP 4 &gt;= 4.0.1, PHP 5)</p><p class="refpurpose"><span class="refname">set_error_handler</span> &mdash; <span class="dc-title">ユーザー定義のエラーハンドラ関数を設定する</span></p>

 </div>

 <div class="refsect1 description" id="refsect1-function.set-error-handler-description">
  <h3 class="title">説明</h3>
  <div class="methodsynopsis dc-description">
   <span class="type"><a href="language.pseudo-types.html#language.types.mixed" class="type mixed">mixed</a></span> <span class="methodname"><strong>set_error_handler</strong></span>
    ( <span class="methodparam"><span class="type"><a href="language.types.callable.html" class="type callable">callable</a></span> <code class="parameter">$error_handler</code></span>
   [, <span class="methodparam"><span class="type">int</span> <code class="parameter">$error_types</code><span class="initializer"> = E_ALL | E_STRICT</span></span>
  ] )</div>

  <p class="para rdfs-comment">
   スクリプトのエラー処理を行うユーザー関数
   (<code class="parameter">error_handler</code>)を設定します。
  </p>
  <p class="para">
   この関数は、実行時のエラー処理をユーザーが定義するために使用します。
   例えば、致命的なエラーの際にデータやファイルを消去する必要があるような
   アプリケーションや、ある条件のもとに
   (<span class="function"><a href="function.trigger-error.html" class="function">trigger_error()</a></span>を使用して)エラーを発生する必要がある
   アプリケーションがこの場合にあたります。
  </p>
  <p class="para">
   コールバック関数が <strong><code>FALSE</code></strong> を返さない限り、<code class="parameter">error_types</code>
   で指定した型のエラーでは PHP 標準のエラーハンドラが完全にバイパスされることに注意してください。
   <span class="function"><a href="function.error-reporting.html" class="function">error_reporting()</a></span> の設定にかかわらず、どのような場合でも
   ユーザーが設定したエラーハンドラがコールされます。ただし、この場合でも
   ハンドラで <span class="function"><a href="function.error-reporting.html" class="function">error_reporting()</a></span> のカレントの値を読み、
   それにあわせて適切に動作させることは可能です。エラーを発生した命令の前に
   <a href="language.operators.errorcontrol.html" class="link">@ エラー制御演算子
   </a> が付加されている場合、この値は 0 となることには注意しましょう。
  </p>
  <p class="para">
   ユーザーハンドラ関数は、必要に応じて <span class="function"><a href="function.die.html" class="function">die()</a></span> を
   コールする責任があることにも注意しましょう。エラーハンドラ関数が
   リターンした場合、スクリプトの実行は、エラーを発生した命令の次の命令に
   継続されます。
  </p>
  <p class="para">
   以下のエラータイプは、ユーザー定義の関数では扱えません。
   <strong><code>E_ERROR</code></strong>, <strong><code>E_PARSE</code></strong>,
   <strong><code>E_CORE_ERROR</code></strong>, <strong><code>E_CORE_WARNING</code></strong>,
   <strong><code>E_COMPILE_ERROR</code></strong>,
   <strong><code>E_COMPILE_WARNING</code></strong> および
   <span class="function"><strong>set_error_handler()</strong></span> がコールされたファイルで発生した
   大半の <strong><code>E_STRICT</code></strong> 。
  </p>
  <p class="para">
   (ファイルアップロードのように)スクリプトが実行される前にエラーが
   発生した場合、カスタムエラーハンドラはコールされません。
   これは、その時点では登録されていないためです。
  </p>
 </div>


 <div class="refsect1 parameters" id="refsect1-function.set-error-handler-parameters">
  <h3 class="title">パラメータ</h3>
  <p class="para">
   <dl>

    
     <dt>
<code class="parameter">error_handler</code></dt>

     <dd>

      <p class="para">
       次のシグネチャに従うコールバック。
       <strong><code>NULL</code></strong> を渡すと、ハンドラをデフォルトの状態に戻せます。
       関数名のかわりにオブジェクトへのリファレンスとメソッド名を含む配列を指定することもできます。
      </p>
      <p class="para">
       <div class="methodsynopsis dc-description">
        <span class="type">bool</span> <span class="methodname"><span class="replaceable">handler</span></span>
         ( <span class="methodparam"><span class="type">int</span> <code class="parameter">$errno</code></span>
        , <span class="methodparam"><span class="type">string</span> <code class="parameter">$errstr</code></span>
        [, <span class="methodparam"><span class="type">string</span> <code class="parameter">$errfile</code></span>
        [, <span class="methodparam"><span class="type">int</span> <code class="parameter">$errline</code></span>
        [, <span class="methodparam"><span class="type">array</span> <code class="parameter">$errcontext</code></span>
       ]]] )</div>

       <dl>

        
         <dt>
<code class="parameter">errno</code></dt>

         <dd>

          <span class="simpara">
           最初のパラメータ <code class="parameter">errno</code> は、発生させる
           エラーのレベルを整数で格納します。
          </span>
         </dd>

        
        
         <dt>
<code class="parameter">errstr</code></dt>

         <dd>

          <span class="simpara">
           2 番目のパラメータ <code class="parameter">errstr</code> は、
           エラーメッセージを文字列で格納します。
          </span>
         </dd>

        
        
         <dt>
<code class="parameter">errfile</code></dt>

         <dd>

          <span class="simpara">
           3 番目のパラメータ <code class="parameter">errfile</code> はオプションで、
           エラーが発生したファイルの名前を文字列で格納します。
          </span>
         </dd>

        
        
         <dt>
<code class="parameter">errline</code></dt>

         <dd>

          <span class="simpara">
           4 番目のパラメータ <code class="parameter">errline</code> はオプションで、
           エラーが発生した行番号を整数で格納します。
          </span>
         </dd>

        
        
         <dt>
<code class="parameter">errcontext</code></dt>

         <dd>

          <span class="simpara">
           5 番目のパラメータ <code class="parameter">errcontext</code> はオプションで、
           エラーが発生した場所のアクティブシンボルテーブルを指す配列です。
           つまり、エラーが発生したスコープ内でのすべての変数の内容を格納した
           配列が <code class="parameter">errcontext</code> だということです。
           ユーザーエラーハンドラは、決してエラーコンテキストを書き換えては
           いけません。
          </span>
         </dd>

        
       </dl>

      </p>
      <p class="para">
       この関数が <strong><code>FALSE</code></strong> を返した場合は、通常のエラーハンドラが処理を引き継ぎます。
      </p>
     </dd>

    
    
     <dt>
<code class="parameter">error_types</code></dt>

     <dd>

      <p class="para">
       設定パラメータ
       <a href="errorfunc.configuration.html#ini.error-reporting" class="link">error_reporting</a>
       で表示するエラーを制御するのと全く同様に、
       <code class="parameter">error_handler</code> の起動を制御する際に
       使用可能です。
       このマスクを指定しない場合、
       <code class="parameter">error_handler</code> は
       <a href="errorfunc.configuration.html#ini.error-reporting" class="link">error_reporting</a> の設定によらず
       全てのエラーに関してコールされます。
      </p>
     </dd>

    
   </dl>

  </p>
 </div>


 <div class="refsect1 returnvalues" id="refsect1-function.set-error-handler-returnvalues">
  <h3 class="title">返り値</h3>
  <p class="para">
   前に定義されたエラーハンドラ(ある場合)を含む文字列を返します。
   組み込みのエラーハンドラを使用している場合は <strong><code>NULL</code></strong> を返します。
   また、無効なコールバックなどでエラーとなった場合も <strong><code>NULL</code></strong> を返します。
   前に定義されたハンドラがクラスメソッドの場合、この関数は、
   クラスとメソッド名からなる添字配列を返します。
  </p>
 </div>


 <div class="refsect1 changelog" id="refsect1-function.set-error-handler-changelog">
  <h3 class="title">変更履歴</h3>
  <p class="para">
   <table class="doctable informaltable">
    
     <thead>
      <tr>
       <th>バージョン</th>
       <th>説明</th>
      </tr>

     </thead>

     <tbody class="tbody">
      <tr>
       <td>5.5.0</td>
       <td>
        <code class="parameter">error_handler</code> に <strong><code>NULL</code></strong> を渡せるようになりました。
       </td>
      </tr>

      <tr>
       <td>5.2.0</td>
       <td>
        <var class="varname"><var class="varname"><a href="reserved.variables.phperrormsg.html" class="classname">$php_errormsg</a></var></var>
        の内容を設定するため、エラーハンドラは必ず <strong><code>FALSE</code></strong>
        を返さなければなりません。
       </td>
      </tr>

     </tbody>
    
   </table>

  </p>
 </div>


 <div class="refsect1 examples" id="refsect1-function.set-error-handler-examples">
  <h3 class="title">例</h3>
  <p class="para">
   <div class="example" id="example-474">
    <p><strong>例1 
     <span class="function"><strong>set_error_handler()</strong></span> および
     <span class="function"><a href="function.trigger-error.html" class="function">trigger_error()</a></span> によるエラー処理
    </strong></p>
    <div class="example-contents"><p>
     以下の例では、エラーを発生させることによる内部例外の処理や
     それらをユーザー定義関数で処理する方法を説明します。
    </p></div>
    <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br /></span><span style="color: #FF8000">//&nbsp;エラーハンドラ関数<br /></span><span style="color: #007700">function&nbsp;</span><span style="color: #0000BB">myErrorHandler</span><span style="color: #007700">(</span><span style="color: #0000BB">$errno</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$errstr</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$errfile</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$errline</span><span style="color: #007700">)<br />{<br />&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(!(</span><span style="color: #0000BB">error_reporting</span><span style="color: #007700">()&nbsp;&amp;&nbsp;</span><span style="color: #0000BB">$errno</span><span style="color: #007700">))&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">//&nbsp;error_reporting&nbsp;設定に含まれていないエラーコードです<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">return;<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;switch&nbsp;(</span><span style="color: #0000BB">$errno</span><span style="color: #007700">)&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;case&nbsp;</span><span style="color: #0000BB">E_USER_ERROR</span><span style="color: #007700">:<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;echo&nbsp;</span><span style="color: #DD0000">"&lt;b&gt;My&nbsp;ERROR&lt;/b&gt;&nbsp;[</span><span style="color: #0000BB">$errno</span><span style="color: #DD0000">]&nbsp;</span><span style="color: #0000BB">$errstr</span><span style="color: #DD0000">&lt;br&nbsp;/&gt;\n"</span><span style="color: #007700">;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;echo&nbsp;</span><span style="color: #DD0000">"&nbsp;&nbsp;Fatal&nbsp;error&nbsp;on&nbsp;line&nbsp;</span><span style="color: #0000BB">$errline</span><span style="color: #DD0000">&nbsp;in&nbsp;file&nbsp;</span><span style="color: #0000BB">$errfile</span><span style="color: #DD0000">"</span><span style="color: #007700">;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;echo&nbsp;</span><span style="color: #DD0000">",&nbsp;PHP&nbsp;"&nbsp;</span><span style="color: #007700">.&nbsp;</span><span style="color: #0000BB">PHP_VERSION&nbsp;</span><span style="color: #007700">.&nbsp;</span><span style="color: #DD0000">"&nbsp;("&nbsp;</span><span style="color: #007700">.&nbsp;</span><span style="color: #0000BB">PHP_OS&nbsp;</span><span style="color: #007700">.&nbsp;</span><span style="color: #DD0000">")&lt;br&nbsp;/&gt;\n"</span><span style="color: #007700">;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;echo&nbsp;</span><span style="color: #DD0000">"Aborting...&lt;br&nbsp;/&gt;\n"</span><span style="color: #007700">;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;exit(</span><span style="color: #0000BB">1</span><span style="color: #007700">);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;break;<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;case&nbsp;</span><span style="color: #0000BB">E_USER_WARNING</span><span style="color: #007700">:<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;echo&nbsp;</span><span style="color: #DD0000">"&lt;b&gt;My&nbsp;WARNING&lt;/b&gt;&nbsp;[</span><span style="color: #0000BB">$errno</span><span style="color: #DD0000">]&nbsp;</span><span style="color: #0000BB">$errstr</span><span style="color: #DD0000">&lt;br&nbsp;/&gt;\n"</span><span style="color: #007700">;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;break;<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;case&nbsp;</span><span style="color: #0000BB">E_USER_NOTICE</span><span style="color: #007700">:<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;echo&nbsp;</span><span style="color: #DD0000">"&lt;b&gt;My&nbsp;NOTICE&lt;/b&gt;&nbsp;[</span><span style="color: #0000BB">$errno</span><span style="color: #DD0000">]&nbsp;</span><span style="color: #0000BB">$errstr</span><span style="color: #DD0000">&lt;br&nbsp;/&gt;\n"</span><span style="color: #007700">;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;break;<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;default:<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;echo&nbsp;</span><span style="color: #DD0000">"Unknown&nbsp;error&nbsp;type:&nbsp;[</span><span style="color: #0000BB">$errno</span><span style="color: #DD0000">]&nbsp;</span><span style="color: #0000BB">$errstr</span><span style="color: #DD0000">&lt;br&nbsp;/&gt;\n"</span><span style="color: #007700">;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;break;<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">/*&nbsp;PHP&nbsp;の内部エラーハンドラを実行しません&nbsp;*/<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">return&nbsp;</span><span style="color: #0000BB">true</span><span style="color: #007700">;<br />}<br /><br /></span><span style="color: #FF8000">//&nbsp;エラー処理のテスト用関数<br /></span><span style="color: #007700">function&nbsp;</span><span style="color: #0000BB">scale_by_log</span><span style="color: #007700">(</span><span style="color: #0000BB">$vect</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$scale</span><span style="color: #007700">)<br />{<br />&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(!</span><span style="color: #0000BB">is_numeric</span><span style="color: #007700">(</span><span style="color: #0000BB">$scale</span><span style="color: #007700">)&nbsp;||&nbsp;</span><span style="color: #0000BB">$scale&nbsp;</span><span style="color: #007700">&lt;=&nbsp;</span><span style="color: #0000BB">0</span><span style="color: #007700">)&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">trigger_error</span><span style="color: #007700">(</span><span style="color: #DD0000">"log(x)&nbsp;for&nbsp;x&nbsp;&lt;=&nbsp;0&nbsp;is&nbsp;undefined,&nbsp;you&nbsp;used:&nbsp;scale&nbsp;=&nbsp;</span><span style="color: #0000BB">$scale</span><span style="color: #DD0000">"</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">E_USER_ERROR</span><span style="color: #007700">);<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(!</span><span style="color: #0000BB">is_array</span><span style="color: #007700">(</span><span style="color: #0000BB">$vect</span><span style="color: #007700">))&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">trigger_error</span><span style="color: #007700">(</span><span style="color: #DD0000">"Incorrect&nbsp;input&nbsp;vector,&nbsp;array&nbsp;of&nbsp;values&nbsp;expected"</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">E_USER_WARNING</span><span style="color: #007700">);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;</span><span style="color: #0000BB">null</span><span style="color: #007700">;<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$temp&nbsp;</span><span style="color: #007700">=&nbsp;array();<br />&nbsp;&nbsp;&nbsp;&nbsp;foreach(</span><span style="color: #0000BB">$vect&nbsp;</span><span style="color: #007700">as&nbsp;</span><span style="color: #0000BB">$pos&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #0000BB">$value</span><span style="color: #007700">)&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(!</span><span style="color: #0000BB">is_numeric</span><span style="color: #007700">(</span><span style="color: #0000BB">$value</span><span style="color: #007700">))&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">trigger_error</span><span style="color: #007700">(</span><span style="color: #DD0000">"Value&nbsp;at&nbsp;position&nbsp;</span><span style="color: #0000BB">$pos</span><span style="color: #DD0000">&nbsp;is&nbsp;not&nbsp;a&nbsp;number,&nbsp;using&nbsp;0&nbsp;(zero)"</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">E_USER_NOTICE</span><span style="color: #007700">);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$value&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">0</span><span style="color: #007700">;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$temp</span><span style="color: #007700">[</span><span style="color: #0000BB">$pos</span><span style="color: #007700">]&nbsp;=&nbsp;</span><span style="color: #0000BB">log</span><span style="color: #007700">(</span><span style="color: #0000BB">$scale</span><span style="color: #007700">)&nbsp;*&nbsp;</span><span style="color: #0000BB">$value</span><span style="color: #007700">;<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;</span><span style="color: #0000BB">$temp</span><span style="color: #007700">;<br />}<br /><br /></span><span style="color: #FF8000">//&nbsp;定義したエラーハンドラを設定する<br /></span><span style="color: #0000BB">$old_error_handler&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">set_error_handler</span><span style="color: #007700">(</span><span style="color: #DD0000">"myErrorHandler"</span><span style="color: #007700">);<br /><br /></span><span style="color: #FF8000">//&nbsp;エラーを発生します。まず、数値でない項目が混ざった配列を定義します。<br /></span><span style="color: #007700">echo&nbsp;</span><span style="color: #DD0000">"vector&nbsp;a\n"</span><span style="color: #007700">;<br /></span><span style="color: #0000BB">$a&nbsp;</span><span style="color: #007700">=&nbsp;array(</span><span style="color: #0000BB">2</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">3</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">"foo"</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">5.5</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">43.3</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">21.11</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">print_r</span><span style="color: #007700">(</span><span style="color: #0000BB">$a</span><span style="color: #007700">);<br /><br /></span><span style="color: #FF8000">//&nbsp;二番目の配列を生成します。<br /></span><span style="color: #007700">echo&nbsp;</span><span style="color: #DD0000">"----\nvector&nbsp;b&nbsp;-&nbsp;a&nbsp;notice&nbsp;(b&nbsp;=&nbsp;log(PI)&nbsp;*&nbsp;a)\n"</span><span style="color: #007700">;<br /></span><span style="color: #FF8000">/*&nbsp;Value&nbsp;at&nbsp;position&nbsp;$pos&nbsp;is&nbsp;not&nbsp;a&nbsp;number,&nbsp;using&nbsp;0&nbsp;(zero)&nbsp;*/<br /></span><span style="color: #0000BB">$b&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">scale_by_log</span><span style="color: #007700">(</span><span style="color: #0000BB">$a</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">M_PI</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">print_r</span><span style="color: #007700">(</span><span style="color: #0000BB">$b</span><span style="color: #007700">);<br /><br /></span><span style="color: #FF8000">//&nbsp;配列の代わりに文字列を渡しており、問題を発生します。<br /></span><span style="color: #007700">echo&nbsp;</span><span style="color: #DD0000">"----\nvector&nbsp;c&nbsp;-&nbsp;a&nbsp;warning\n"</span><span style="color: #007700">;<br /></span><span style="color: #FF8000">/*&nbsp;Incorrect&nbsp;input&nbsp;vector,&nbsp;array&nbsp;of&nbsp;values&nbsp;expected&nbsp;*/<br /></span><span style="color: #0000BB">$c&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">scale_by_log</span><span style="color: #007700">(</span><span style="color: #DD0000">"not&nbsp;array"</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">2.3</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">var_dump</span><span style="color: #007700">(</span><span style="color: #0000BB">$c</span><span style="color: #007700">);&nbsp;</span><span style="color: #FF8000">//&nbsp;NULL<br /><br />//&nbsp;ゼロまたは負数の対数が定義されないという致命的なエラーを発生します。<br /></span><span style="color: #007700">echo&nbsp;</span><span style="color: #DD0000">"----\nvector&nbsp;d&nbsp;-&nbsp;fatal&nbsp;error\n"</span><span style="color: #007700">;<br /></span><span style="color: #FF8000">/*&nbsp;log(x)&nbsp;for&nbsp;x&nbsp;&lt;=&nbsp;0&nbsp;is&nbsp;undefined,&nbsp;you&nbsp;used:&nbsp;scale&nbsp;=&nbsp;$scale"&nbsp;*/<br /></span><span style="color: #0000BB">$d&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">scale_by_log</span><span style="color: #007700">(</span><span style="color: #0000BB">$a</span><span style="color: #007700">,&nbsp;-</span><span style="color: #0000BB">2.5</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">var_dump</span><span style="color: #007700">(</span><span style="color: #0000BB">$d</span><span style="color: #007700">);&nbsp;</span><span style="color: #FF8000">//&nbsp;ここには到達しません<br /></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
    </div>

    <div class="example-contents"><p>上の例の出力は、
たとえば以下のようになります。</p></div>
    <div class="example-contents screen">
<div class="cdata"><pre>
vector a
Array
(
    [0] =&gt; 2
    [1] =&gt; 3
    [2] =&gt; foo
    [3] =&gt; 5.5
    [4] =&gt; 43.3
    [5] =&gt; 21.11
)
----
vector b - a notice (b = log(PI) * a)
&lt;b&gt;My NOTICE&lt;/b&gt; [1024] Value at position 2 is not a number, using 0 (zero)&lt;br /&gt;
Array
(
    [0] =&gt; 2.2894597716988
    [1] =&gt; 3.4341896575482
    [2] =&gt; 0
    [3] =&gt; 6.2960143721717
    [4] =&gt; 49.566804057279
    [5] =&gt; 24.165247890281
)
----
vector c - a warning
&lt;b&gt;My WARNING&lt;/b&gt; [512] Incorrect input vector, array of values expected&lt;br /&gt;
NULL
----
vector d - fatal error
&lt;b&gt;My ERROR&lt;/b&gt; [256] log(x) for x &lt;= 0 is undefined, you used: scale = -2.5&lt;br /&gt;
  Fatal error on line 35 in file trigger_error.php, PHP 5.2.1 (FreeBSD)&lt;br /&gt;
Aborting...&lt;br /&gt;
</pre></div>
    </div>
   </div>
  </p>
 </div>


 <div class="refsect1 seealso" id="refsect1-function.set-error-handler-seealso">
  <h3 class="title">参考</h3>
  <p class="para">
   <ul class="simplelist">
    <li class="member"><a href="class.errorexception.html" class="classname">ErrorException</a></li>
    <li class="member"><span class="function"><a href="function.error-reporting.html" class="function" rel="rdfs-seeAlso">error_reporting()</a> - 出力する PHP エラーの種類を設定する</span></li>
    <li class="member"><span class="function"><a href="function.restore-error-handler.html" class="function" rel="rdfs-seeAlso">restore_error_handler()</a> - 以前のエラーハンドラ関数を回復する</span></li>
    <li class="member"><span class="function"><a href="function.trigger-error.html" class="function" rel="rdfs-seeAlso">trigger_error()</a> - ユーザーレベルのエラー/警告/通知メッセージを生成する</span></li>
    <li class="member"><a href="errorfunc.constants.html" class="link">エラーレベル定数</a></li>
    <li class="member"><a href="language.pseudo-types.html#language.types.callback" class="link">callback</a> 型に関する情報</li>
   </ul>
  </p>
 </div>

</div><div id="usernotes">
 <div class="head">
  <h3 class="title">User Contributed Notes</h3>
 </div>
<div id="allnotes">  <a name="114399""></a>
  <div class="note">
   <strong class="user">dannykopping at gmail dot com</strong>
   <a href="#114399" class="date">16-Feb-2014 06:52</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Keep in mind that, when attempting to set a statically-defined error handler on a namespaced class in PHP &gt;= 5.3, you need to use the class namespace:<br />
<br />
<span class="default">&lt;?php<br />
set_error_handler</span><span class="keyword">(</span><span class="string">'\\My\\Namespace\\Bob::errorHandler'</span><span class="keyword">);<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="113567""></a>
  <div class="note">
   <strong class="user">jtrick77 at gmail dot com</strong>
   <a href="#113567" class="date">31-Oct-2013 06:13</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
For anyone interested in the actual translated error codes and their meanings:<br />
<br />
1&nbsp; &nbsp; E_ERROR (integer)&nbsp; &nbsp;&nbsp; Fatal run-time errors. These indicate errors that can not be recovered from, such as a memory allocation problem. Execution of the script is halted.&nbsp; &nbsp;&nbsp; <br />
2&nbsp; &nbsp; E_WARNING (integer)&nbsp; &nbsp;&nbsp; Run-time warnings (non-fatal errors). Execution of the script is not halted.&nbsp; &nbsp;&nbsp; <br />
4&nbsp; &nbsp; E_PARSE (integer)&nbsp; &nbsp;&nbsp; Compile-time parse errors. Parse errors should only be generated by the parser.&nbsp; &nbsp;&nbsp; <br />
8&nbsp; &nbsp; E_NOTICE (integer)&nbsp; &nbsp;&nbsp; Run-time notices. Indicate that the script encountered something that could indicate an error, but could also happen in the normal course of running a script.&nbsp; &nbsp;&nbsp; <br />
16&nbsp; &nbsp; E_CORE_ERROR (integer)&nbsp; &nbsp;&nbsp; Fatal errors that occur during PHP's initial startup. This is like an E_ERROR, except it is generated by the core of PHP.&nbsp; &nbsp;&nbsp; <br />
32&nbsp; &nbsp; E_CORE_WARNING (integer)&nbsp; &nbsp;&nbsp; Warnings (non-fatal errors) that occur during PHP's initial startup. This is like an E_WARNING, except it is generated by the core of PHP.&nbsp; &nbsp;&nbsp; <br />
64&nbsp; &nbsp; E_COMPILE_ERROR (integer)&nbsp; &nbsp;&nbsp; Fatal compile-time errors. This is like an E_ERROR, except it is generated by the Zend Scripting Engine.&nbsp; &nbsp;&nbsp; <br />
128&nbsp; &nbsp; E_COMPILE_WARNING (integer)&nbsp; &nbsp;&nbsp; Compile-time warnings (non-fatal errors). This is like an E_WARNING, except it is generated by the Zend Scripting Engine.&nbsp; &nbsp;&nbsp; <br />
256&nbsp; &nbsp; E_USER_ERROR (integer)&nbsp; &nbsp;&nbsp; User-generated error message. This is like an E_ERROR, except it is generated in PHP code by using the PHP function trigger_error().&nbsp; &nbsp;&nbsp; <br />
512&nbsp; &nbsp; E_USER_WARNING (integer)&nbsp; &nbsp;&nbsp; User-generated warning message. This is like an E_WARNING, except it is generated in PHP code by using the PHP function trigger_error().&nbsp; &nbsp;&nbsp; <br />
1024&nbsp; &nbsp; E_USER_NOTICE (integer)&nbsp; &nbsp;&nbsp; User-generated notice message. This is like an E_NOTICE, except it is generated in PHP code by using the PHP function trigger_error().&nbsp; &nbsp;&nbsp; <br />
2048&nbsp; &nbsp; E_STRICT (integer)&nbsp; &nbsp;&nbsp; Enable to have PHP suggest changes to your code which will ensure the best interoperability and forward compatibility of your code.&nbsp; &nbsp; Since PHP 5 but not included in E_ALL until PHP 5.4.0<br />
4096&nbsp; &nbsp; E_RECOVERABLE_ERROR (integer)&nbsp; &nbsp;&nbsp; Catchable fatal error. It indicates that a probably dangerous error occurred, but did not leave the Engine in an unstable state. If the error is not caught by a user defined handle (see also set_error_handler()), the application aborts as it was an E_ERROR.&nbsp; &nbsp; Since PHP 5.2.0<br />
8192&nbsp; &nbsp; E_DEPRECATED (integer)&nbsp; &nbsp;&nbsp; Run-time notices. Enable this to receive warnings about code that will not work in future versions.&nbsp; &nbsp; Since PHP 5.3.0<br />
16384&nbsp; &nbsp; E_USER_DEPRECATED (integer)&nbsp; &nbsp;&nbsp; User-generated warning message. This is like an E_DEPRECATED, except it is generated in PHP code by using the PHP function trigger_error().&nbsp; &nbsp; Since PHP 5.3.0<br />
32767&nbsp; &nbsp; E_ALL (integer)&nbsp; &nbsp;&nbsp; All errors and warnings, as supported, except of level E_STRICT prior to PHP 5.4.0.&nbsp; &nbsp;&nbsp; 32767 in PHP 5.4.x, 30719 in PHP 5.3.x, 6143 in PHP 5.2.x, 2047 previously<br />
<br />
(Copied from <a href="http://php.net/manual/en/errorfunc.constants.php" rel="nofollow" target="_blank">http://php.net/manual/en/errorfunc.constants.php</a>)</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="113517""></a>
  <div class="note">
   <strong class="user">nicolas dot grekas+php at gmail dot com</strong>
   <a href="#113517" class="date">24-Oct-2013 06:34</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If you want to be sure that the native PHP error handler is called without resetting the handler stack (as set_error_handler(null) does), you can simply call set_error_handler with $error_types set to zero. This can be especially use full in conjunction with e.g. error_get_last():<br />
<br />
<span class="default">&lt;?php<br />
<br />
</span><span class="comment">// var_dump or anything else, as this will never be called because of the 0<br />
</span><span class="default">set_error_handler</span><span class="keyword">(</span><span class="string">'var_dump'</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">);<br />
@</span><span class="default">$undef_var</span><span class="keyword">;<br />
</span><span class="default">restore_error_handler</span><span class="keyword">();<br />
<br />
</span><span class="comment">// error_get_last() is now in a well known state:<br />
// Undefined variable: undef_var<br />
<br />
</span><span class="keyword">... </span><span class="comment">// Do something<br />
<br />
</span><span class="default">$e </span><span class="keyword">= </span><span class="default">error_get_last</span><span class="keyword">();<br />
<br />
...<br />
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="113252""></a>
  <div class="note">
   <strong class="user">phil at propcom dot co dot uk</strong>
   <a href="#113252" class="date">18-Sep-2013 05:38</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
It is important to note that the registered SPL autoloader will NOT be called if an E_STRICT error triggers the error handler which, in turn, tries to use classes which are not yet loaded. <br />
<br />
In this instance, you should manually load classes required by the error handler.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="112881""></a>
  <div class="note">
   <strong class="user">elad dot yosifon at gmail dot com</strong>
   <a href="#112881" class="date">01-Aug-2013 08:42</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
<span class="default">&lt;?php<br />
</span><span class="comment">/**<br />
&nbsp;* throw exceptions based on E_* error types<br />
&nbsp;*/<br />
</span><span class="default">set_error_handler</span><span class="keyword">(function (</span><span class="default">$err_severity</span><span class="keyword">, </span><span class="default">$err_msg</span><span class="keyword">, </span><span class="default">$err_file</span><span class="keyword">, </span><span class="default">$err_line</span><span class="keyword">, array </span><span class="default">$err_context</span><span class="keyword">)<br />
{<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">// error was suppressed with the @-operator<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">if (</span><span class="default">0 </span><span class="keyword">=== </span><span class="default">error_reporting</span><span class="keyword">()) { return </span><span class="default">false</span><span class="keyword">;}<br />
&nbsp;&nbsp;&nbsp; switch(</span><span class="default">$err_severity</span><span class="keyword">)<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; case </span><span class="default">E_ERROR</span><span class="keyword">:&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; throw new </span><span class="default">ErrorException&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="keyword">(</span><span class="default">$err_msg</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">$err_severity</span><span class="keyword">, </span><span class="default">$err_file</span><span class="keyword">, </span><span class="default">$err_line</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; case </span><span class="default">E_WARNING</span><span class="keyword">:&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; throw new </span><span class="default">WarningException&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="keyword">(</span><span class="default">$err_msg</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">$err_severity</span><span class="keyword">, </span><span class="default">$err_file</span><span class="keyword">, </span><span class="default">$err_line</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; case </span><span class="default">E_PARSE</span><span class="keyword">:&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; throw new </span><span class="default">ParseException&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="keyword">(</span><span class="default">$err_msg</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">$err_severity</span><span class="keyword">, </span><span class="default">$err_file</span><span class="keyword">, </span><span class="default">$err_line</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; case </span><span class="default">E_NOTICE</span><span class="keyword">:&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; throw new </span><span class="default">NoticeException&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">(</span><span class="default">$err_msg</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">$err_severity</span><span class="keyword">, </span><span class="default">$err_file</span><span class="keyword">, </span><span class="default">$err_line</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; case </span><span class="default">E_CORE_ERROR</span><span class="keyword">:&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; throw new </span><span class="default">CoreErrorException&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="keyword">(</span><span class="default">$err_msg</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">$err_severity</span><span class="keyword">, </span><span class="default">$err_file</span><span class="keyword">, </span><span class="default">$err_line</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; case </span><span class="default">E_CORE_WARNING</span><span class="keyword">:&nbsp; &nbsp; &nbsp; &nbsp; throw new </span><span class="default">CoreWarningException&nbsp; &nbsp; &nbsp; </span><span class="keyword">(</span><span class="default">$err_msg</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">$err_severity</span><span class="keyword">, </span><span class="default">$err_file</span><span class="keyword">, </span><span class="default">$err_line</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; case </span><span class="default">E_COMPILE_ERROR</span><span class="keyword">:&nbsp; &nbsp; &nbsp;&nbsp; throw new </span><span class="default">CompileErrorException&nbsp; &nbsp;&nbsp; </span><span class="keyword">(</span><span class="default">$err_msg</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">$err_severity</span><span class="keyword">, </span><span class="default">$err_file</span><span class="keyword">, </span><span class="default">$err_line</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; case </span><span class="default">E_COMPILE_WARNING</span><span class="keyword">:&nbsp; &nbsp;&nbsp; throw new </span><span class="default">CoreWarningException&nbsp; &nbsp; &nbsp; </span><span class="keyword">(</span><span class="default">$err_msg</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">$err_severity</span><span class="keyword">, </span><span class="default">$err_file</span><span class="keyword">, </span><span class="default">$err_line</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; case </span><span class="default">E_USER_ERROR</span><span class="keyword">:&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; throw new </span><span class="default">UserErrorException&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="keyword">(</span><span class="default">$err_msg</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">$err_severity</span><span class="keyword">, </span><span class="default">$err_file</span><span class="keyword">, </span><span class="default">$err_line</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; case </span><span class="default">E_USER_WARNING</span><span class="keyword">:&nbsp; &nbsp; &nbsp; &nbsp; throw new </span><span class="default">UserWarningException&nbsp; &nbsp; &nbsp; </span><span class="keyword">(</span><span class="default">$err_msg</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">$err_severity</span><span class="keyword">, </span><span class="default">$err_file</span><span class="keyword">, </span><span class="default">$err_line</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; case </span><span class="default">E_USER_NOTICE</span><span class="keyword">:&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; throw new </span><span class="default">UserNoticeException&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">(</span><span class="default">$err_msg</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">$err_severity</span><span class="keyword">, </span><span class="default">$err_file</span><span class="keyword">, </span><span class="default">$err_line</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; case </span><span class="default">E_STRICT</span><span class="keyword">:&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; throw new </span><span class="default">StrictException&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">(</span><span class="default">$err_msg</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">$err_severity</span><span class="keyword">, </span><span class="default">$err_file</span><span class="keyword">, </span><span class="default">$err_line</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; case </span><span class="default">E_RECOVERABLE_ERROR</span><span class="keyword">:&nbsp;&nbsp; throw new </span><span class="default">RecoverableErrorException </span><span class="keyword">(</span><span class="default">$err_msg</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">$err_severity</span><span class="keyword">, </span><span class="default">$err_file</span><span class="keyword">, </span><span class="default">$err_line</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; case </span><span class="default">E_DEPRECATED</span><span class="keyword">:&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; throw new </span><span class="default">DeprecatedException&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">(</span><span class="default">$err_msg</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">$err_severity</span><span class="keyword">, </span><span class="default">$err_file</span><span class="keyword">, </span><span class="default">$err_line</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; case </span><span class="default">E_USER_DEPRECATED</span><span class="keyword">:&nbsp; &nbsp;&nbsp; throw new </span><span class="default">UserDeprecatedException&nbsp;&nbsp; </span><span class="keyword">(</span><span class="default">$err_msg</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">$err_severity</span><span class="keyword">, </span><span class="default">$err_file</span><span class="keyword">, </span><span class="default">$err_line</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; }<br />
});<br />
<br />
class </span><span class="default">WarningException&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="keyword">extends </span><span class="default">ErrorException </span><span class="keyword">{}<br />
class </span><span class="default">ParseException&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="keyword">extends </span><span class="default">ErrorException </span><span class="keyword">{}<br />
class </span><span class="default">NoticeException&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">extends </span><span class="default">ErrorException </span><span class="keyword">{}<br />
class </span><span class="default">CoreErrorException&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="keyword">extends </span><span class="default">ErrorException </span><span class="keyword">{}<br />
class </span><span class="default">CoreWarningException&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="keyword">extends </span><span class="default">ErrorException </span><span class="keyword">{}<br />
class </span><span class="default">CompileErrorException&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">extends </span><span class="default">ErrorException </span><span class="keyword">{}<br />
class </span><span class="default">CompileWarningException&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">extends </span><span class="default">ErrorException </span><span class="keyword">{}<br />
class </span><span class="default">UserErrorException&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="keyword">extends </span><span class="default">ErrorException </span><span class="keyword">{}<br />
class </span><span class="default">UserWarningException&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="keyword">extends </span><span class="default">ErrorException </span><span class="keyword">{}<br />
class </span><span class="default">UserNoticeException&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">extends </span><span class="default">ErrorException </span><span class="keyword">{}<br />
class </span><span class="default">StrictException&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">extends </span><span class="default">ErrorException </span><span class="keyword">{}<br />
class </span><span class="default">RecoverableErrorException&nbsp; &nbsp;&nbsp; </span><span class="keyword">extends </span><span class="default">ErrorException </span><span class="keyword">{}<br />
class </span><span class="default">DeprecatedException&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">extends </span><span class="default">ErrorException </span><span class="keyword">{}<br />
class </span><span class="default">UserDeprecatedException&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">extends </span><span class="default">ErrorException </span><span class="keyword">{}</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="112348""></a>
  <div class="note">
   <strong class="user">Jacob Slomp</strong>
   <a href="#112348" class="date">05-Jun-2013 07:56</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
This might be handy if you don't want your clients to see the errors, and you do want to be one step ahead of them.<br />
<br />
It emails you the errors even if it's a parse error.<br />
<br />
set_error_handler() doesn't work for what I wanted.<br />
<br />
<span class="default">&lt;?php<br />
ini_set</span><span class="keyword">(</span><span class="string">'log_errors'</span><span class="keyword">,</span><span class="default">TRUE</span><span class="keyword">);<br />
</span><span class="default">ini_set</span><span class="keyword">(</span><span class="string">'error_log'</span><span class="keyword">,</span><span class="string">'tiny_uploads/errors.txt'</span><span class="keyword">);<br />
<br />
if(</span><span class="default">$_SERVER</span><span class="keyword">[</span><span class="string">'REMOTE_ADDR'</span><span class="keyword">] != </span><span class="string">"YOUR IP ADDRESS"</span><span class="keyword">){<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">ini_set</span><span class="keyword">(</span><span class="string">'display_errors'</span><span class="keyword">,</span><span class="default">false</span><span class="keyword">);<br />
}<br />
&nbsp;&nbsp; <br />
function </span><span class="default">byebye</span><span class="keyword">(){<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$dir </span><span class="keyword">= </span><span class="default">dirname</span><span class="keyword">(</span><span class="default">__FILE__</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if(</span><span class="default">file_exists</span><span class="keyword">(</span><span class="default">$dir</span><span class="keyword">.</span><span class="string">"/tiny_uploads/errors.txt"</span><span class="keyword">)){<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$errors </span><span class="keyword">= </span><span class="default">file_get_contents</span><span class="keyword">(</span><span class="default">$dir</span><span class="keyword">.</span><span class="string">"/tiny_uploads/errors.txt"</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if(</span><span class="default">trim</span><span class="keyword">(</span><span class="default">$errors</span><span class="keyword">)){<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$head </span><span class="keyword">= </span><span class="string">"From: php_errors@"</span><span class="keyword">.</span><span class="default">str_replace</span><span class="keyword">(</span><span class="string">'www.'</span><span class="keyword">,</span><span class="string">''</span><span class="keyword">,</span><span class="default">$_SERVER</span><span class="keyword">[</span><span class="string">'HTTP_HOST'</span><span class="keyword">]).</span><span class="string">"\r\n"</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$errors </span><span class="keyword">.= </span><span class="string">"---------------------------------------------\n\n"</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$errors </span><span class="keyword">.= </span><span class="string">"\n\nServer Info:\n\n"</span><span class="keyword">.</span><span class="default">print_r</span><span class="keyword">(</span><span class="default">$_SERVER</span><span class="keyword">, </span><span class="default">1</span><span class="keyword">).</span><span class="string">"\n\n"</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$errors </span><span class="keyword">.= </span><span class="string">"---------------------------------------------\n\n"</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$errors </span><span class="keyword">.= </span><span class="string">"\n\nCOOKIE:\n\n"</span><span class="keyword">.</span><span class="default">print_r</span><span class="keyword">(</span><span class="default">$_COOKIE</span><span class="keyword">, </span><span class="default">1</span><span class="keyword">).</span><span class="string">"\n\n"</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$errors </span><span class="keyword">.= </span><span class="string">"---------------------------------------------\n\n"</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$errors </span><span class="keyword">.= </span><span class="string">"\n\nPOST:\n\n"</span><span class="keyword">.</span><span class="default">print_r</span><span class="keyword">(</span><span class="default">$_POST</span><span class="keyword">, </span><span class="default">1</span><span class="keyword">).</span><span class="string">"\n\n"</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$errors </span><span class="keyword">.= </span><span class="string">"---------------------------------------------\n\n"</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$errors </span><span class="keyword">.= </span><span class="string">"\n\nGET:\n\n"</span><span class="keyword">.</span><span class="default">print_r</span><span class="keyword">(</span><span class="default">$_GET</span><span class="keyword">, </span><span class="default">1</span><span class="keyword">).</span><span class="string">"\n\n"</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">mail</span><span class="keyword">(</span><span class="string">"YOUR@EMAIL.COM"</span><span class="keyword">,</span><span class="string">"PHP Error "</span><span class="keyword">.</span><span class="default">$_SERVER</span><span class="keyword">[</span><span class="string">'HTTP_HOST'</span><span class="keyword">].</span><span class="string">""</span><span class="keyword">, </span><span class="default">$errors </span><span class="keyword">, </span><span class="default">$head</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$fp </span><span class="keyword">= </span><span class="default">fopen</span><span class="keyword">(</span><span class="default">$dir</span><span class="keyword">.</span><span class="string">"/tiny_uploads/errors.txt"</span><span class="keyword">,</span><span class="string">"w+"</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">fputs</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">, </span><span class="string">""</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">fclose</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">);&nbsp; &nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }&nbsp; &nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
}<br />
</span><span class="default">register_shutdown_function</span><span class="keyword">(</span><span class="string">"byebye"</span><span class="keyword">);<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="112291""></a>
  <div class="note">
   <strong class="user">Philip</strong>
   <a href="#112291" class="date">29-May-2013 04:10</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
By this function alone you can not catch fatal errors, there is a simple work around. Below is part of my error.php file which handles errors and exceptions in the application. Before someone complains I'll add that I do not care that I am using globals, this file is part of my mini framework and without the 'config' variable the application would crash anyways.<br />
<br />
<span class="default">&lt;?php<br />
<br />
</span><span class="comment">/**<br />
&nbsp;* Error handler, passes flow over the exception logger with new ErrorException.<br />
&nbsp;*/<br />
</span><span class="keyword">function </span><span class="default">log_error</span><span class="keyword">( </span><span class="default">$num</span><span class="keyword">, </span><span class="default">$str</span><span class="keyword">, </span><span class="default">$file</span><span class="keyword">, </span><span class="default">$line</span><span class="keyword">, </span><span class="default">$context </span><span class="keyword">= </span><span class="default">null </span><span class="keyword">)<br />
{<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">log_exception</span><span class="keyword">( new </span><span class="default">ErrorException</span><span class="keyword">( </span><span class="default">$str</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">$num</span><span class="keyword">, </span><span class="default">$file</span><span class="keyword">, </span><span class="default">$line </span><span class="keyword">) );<br />
}<br />
<br />
</span><span class="comment">/**<br />
&nbsp;* Uncaught exception handler.<br />
&nbsp;*/<br />
</span><span class="keyword">function </span><span class="default">log_exception</span><span class="keyword">( </span><span class="default">Exception $e </span><span class="keyword">)<br />
{<br />
&nbsp;&nbsp;&nbsp; global </span><span class="default">$config</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; if ( </span><span class="default">$config</span><span class="keyword">[</span><span class="string">"debug"</span><span class="keyword">] == </span><span class="default">true </span><span class="keyword">)<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; print </span><span class="string">"&lt;div style='text-align: center;'&gt;"</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; print </span><span class="string">"&lt;h2 style='color: rgb(190, 50, 50);'&gt;Exception Occured:&lt;/h2&gt;"</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; print </span><span class="string">"&lt;table style='width: 800px; display: inline-block;'&gt;"</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; print </span><span class="string">"&lt;tr style='background-color:rgb(230,230,230);'&gt;&lt;th style='width: 80px;'&gt;Type&lt;/th&gt;&lt;td&gt;" </span><span class="keyword">. </span><span class="default">get_class</span><span class="keyword">( </span><span class="default">$e </span><span class="keyword">) . </span><span class="string">"&lt;/td&gt;&lt;/tr&gt;"</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; print </span><span class="string">"&lt;tr style='background-color:rgb(240,240,240);'&gt;&lt;th&gt;Message&lt;/th&gt;&lt;td&gt;</span><span class="keyword">{</span><span class="default">$e</span><span class="keyword">-&gt;</span><span class="default">getMessage</span><span class="keyword">()}</span><span class="string">&lt;/td&gt;&lt;/tr&gt;"</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; print </span><span class="string">"&lt;tr style='background-color:rgb(230,230,230);'&gt;&lt;th&gt;File&lt;/th&gt;&lt;td&gt;</span><span class="keyword">{</span><span class="default">$e</span><span class="keyword">-&gt;</span><span class="default">getFile</span><span class="keyword">()}</span><span class="string">&lt;/td&gt;&lt;/tr&gt;"</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; print </span><span class="string">"&lt;tr style='background-color:rgb(240,240,240);'&gt;&lt;th&gt;Line&lt;/th&gt;&lt;td&gt;</span><span class="keyword">{</span><span class="default">$e</span><span class="keyword">-&gt;</span><span class="default">getLine</span><span class="keyword">()}</span><span class="string">&lt;/td&gt;&lt;/tr&gt;"</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; print </span><span class="string">"&lt;/table&gt;&lt;/div&gt;"</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; else<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$message </span><span class="keyword">= </span><span class="string">"Type: " </span><span class="keyword">. </span><span class="default">get_class</span><span class="keyword">( </span><span class="default">$e </span><span class="keyword">) . </span><span class="string">"; Message: </span><span class="keyword">{</span><span class="default">$e</span><span class="keyword">-&gt;</span><span class="default">getMessage</span><span class="keyword">()}</span><span class="string">; File: </span><span class="keyword">{</span><span class="default">$e</span><span class="keyword">-&gt;</span><span class="default">getFile</span><span class="keyword">()}</span><span class="string">; Line: </span><span class="keyword">{</span><span class="default">$e</span><span class="keyword">-&gt;</span><span class="default">getLine</span><span class="keyword">()}</span><span class="string">;"</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">file_put_contents</span><span class="keyword">( </span><span class="default">$config</span><span class="keyword">[</span><span class="string">"app_dir"</span><span class="keyword">] . </span><span class="string">"/tmp/logs/exceptions.log"</span><span class="keyword">, </span><span class="default">$message </span><span class="keyword">. </span><span class="default">PHP_EOL</span><span class="keyword">, </span><span class="default">FILE_APPEND </span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">header</span><span class="keyword">( </span><span class="string">"Location: </span><span class="keyword">{</span><span class="default">$config</span><span class="keyword">[</span><span class="string">"error_page"</span><span class="keyword">]}</span><span class="string">" </span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; exit();<br />
}<br />
<br />
</span><span class="comment">/**<br />
&nbsp;* Checks for a fatal error, work around for set_error_handler not working on fatal errors.<br />
&nbsp;*/<br />
</span><span class="keyword">function </span><span class="default">check_for_fatal</span><span class="keyword">()<br />
{<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$error </span><span class="keyword">= </span><span class="default">error_get_last</span><span class="keyword">();<br />
&nbsp;&nbsp;&nbsp; if ( </span><span class="default">$error</span><span class="keyword">[</span><span class="string">"type"</span><span class="keyword">] == </span><span class="default">E_ERROR </span><span class="keyword">)<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">log_error</span><span class="keyword">( </span><span class="default">$error</span><span class="keyword">[</span><span class="string">"type"</span><span class="keyword">], </span><span class="default">$error</span><span class="keyword">[</span><span class="string">"message"</span><span class="keyword">], </span><span class="default">$error</span><span class="keyword">[</span><span class="string">"file"</span><span class="keyword">], </span><span class="default">$error</span><span class="keyword">[</span><span class="string">"line"</span><span class="keyword">] );<br />
}<br />
<br />
</span><span class="default">register_shutdown_function</span><span class="keyword">( </span><span class="string">"check_for_fatal" </span><span class="keyword">);<br />
</span><span class="default">set_error_handler</span><span class="keyword">( </span><span class="string">"log_error" </span><span class="keyword">);<br />
</span><span class="default">set_exception_handler</span><span class="keyword">( </span><span class="string">"log_exception" </span><span class="keyword">);<br />
</span><span class="default">ini_set</span><span class="keyword">( </span><span class="string">"display_errors"</span><span class="keyword">, </span><span class="string">"off" </span><span class="keyword">);<br />
</span><span class="default">error_reporting</span><span class="keyword">( </span><span class="default">E_ALL </span><span class="keyword">);</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="106061""></a>
  <div class="note">
   <strong class="user">dorphalsig at NOSPAMgmail dot com</strong>
   <a href="#106061" class="date">06-Oct-2011 08:25</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
This actually works to catch Fatal errors...
<br />

<br />
<span class="default">&lt;?php
<br />
</span><span class="keyword">function </span><span class="default">shutdown</span><span class="keyword">()
<br />
{
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$a</span><span class="keyword">=</span><span class="default">error_get_last</span><span class="keyword">();
<br />
&nbsp;&nbsp;&nbsp; if(</span><span class="default">$a</span><span class="keyword">==</span><span class="default">null</span><span class="keyword">)&nbsp;&nbsp; 
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; echo </span><span class="string">"No errors"</span><span class="keyword">;
<br />
&nbsp;&nbsp;&nbsp; else
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">print_r</span><span class="keyword">(</span><span class="default">$a</span><span class="keyword">);
<br />
&nbsp;&nbsp;&nbsp; 
<br />
}
<br />
</span><span class="default">register_shutdown_function</span><span class="keyword">(</span><span class="string">'shutdown'</span><span class="keyword">);
<br />
</span><span class="default">ini_set</span><span class="keyword">(</span><span class="string">'max_execution_time'</span><span class="keyword">,</span><span class="default">1 </span><span class="keyword">);
<br />
</span><span class="default">sleep</span><span class="keyword">(</span><span class="default">3</span><span class="keyword">);
<br />
</span><span class="default">?&gt;
<br />
</span>
<br />
it will output
<br />
Array ( [type] =&gt; 1 [message] =&gt; Maximum execution time of 1 second exceeded [file] =&gt; /path/to/file_name.php [line] =&gt; 136 )</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="101533""></a>
  <div class="note">
   <strong class="user">francois vespa</strong>
   <a href="#101533" class="date">23-Dec-2010 12:27</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
This is a note when using php from the terminal (the CLI interface). From the command line, even if you have some kind of error user handler function so STDERR will not display, fatal errors will still cause the PHP interpreter to display error text. There is nothing you can do about that php-wise. If using UNIX/Linux, you can add " 2&gt;/dev/null" at the end of your command to force STDERR not to show</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="99193""></a>
  <div class="note">
   <strong class="user">periklis</strong>
   <a href="#99193" class="date">02-Aug-2010 05:09</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
How to handle fatal errors in php 5.2:
<br />

<br />
<span class="default">&lt;?php
<br />
register_shutdown_function</span><span class="keyword">(</span><span class="string">'shutdownFunction'</span><span class="keyword">);
<br />
function </span><span class="default">shutDownFunction</span><span class="keyword">() { 
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$error </span><span class="keyword">= </span><span class="default">error_get_last</span><span class="keyword">();
<br />
&nbsp;&nbsp;&nbsp; if (</span><span class="default">$error</span><span class="keyword">[</span><span class="string">'type'</span><span class="keyword">] == </span><span class="default">1</span><span class="keyword">) {
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">//do your stuff&nbsp; &nbsp;&nbsp; 
<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">} 
<br />
}
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="98094""></a>
  <div class="note">
   <strong class="user">contact [a] ionisis [.] com</strong>
   <a href="#98094" class="date">26-May-2010 12:54</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
There seems to be no way to access to access the _POST, _GET, etc if you call trigger_error from within a function inside a class file.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="98051""></a>
  <div class="note">
   <strong class="user">devermin at ti0n dot net</strong>
   <a href="#98051" class="date">23-May-2010 12:46</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
At work I have some code with errors that uncatched are the causes of integrity loss (people calling web services with file_get_contents that fails silently and afterwards insert garbage in the database). 
<br />

<br />
here is the solution I found to transform a specific set of errors into exception and afterwards be able to selectively act (with the error code) regarding categories :&nbsp; 
<br />

<br />
<span class="default">&lt;?php
<br />
ini_set</span><span class="keyword">(</span><span class="string">'error_reporting'</span><span class="keyword">,</span><span class="default">E_ALL</span><span class="keyword">^</span><span class="default">E_NOTICE</span><span class="keyword">);
<br />

<br />
</span><span class="comment">## first 10 bits reserved for the initial error number
<br />
</span><span class="default">define</span><span class="keyword">(</span><span class="string">'EMASK'</span><span class="keyword">,(~</span><span class="default">0</span><span class="keyword">)&lt;&lt;</span><span class="default">10</span><span class="keyword">);
<br />
</span><span class="default">define</span><span class="keyword">(</span><span class="string">'ECODEMASK'</span><span class="keyword">,~</span><span class="default">EMASK</span><span class="keyword">);
<br />
</span><span class="comment">## categories 
<br />
</span><span class="default">define</span><span class="keyword">(</span><span class="string">'IOERROR'</span><span class="keyword">, </span><span class="default">1</span><span class="keyword">&lt;&lt;</span><span class="default">10</span><span class="keyword">);
<br />
</span><span class="default">define</span><span class="keyword">(</span><span class="string">'EMPTYPARMS'</span><span class="keyword">, </span><span class="default">1</span><span class="keyword">&lt;&lt;</span><span class="default">11</span><span class="keyword">);
<br />
</span><span class="default">define</span><span class="keyword">(</span><span class="string">'FAILURE'</span><span class="keyword">, </span><span class="default">1</span><span class="keyword">&lt;&lt;</span><span class="default">12</span><span class="keyword">);
<br />
</span><span class="comment">## string error patterns =&gt; code 
<br />

<br />
</span><span class="default">$catch_me</span><span class="keyword">=array(
<br />
&nbsp;&nbsp;&nbsp; </span><span class="string">"/^(file_get_contents)\((.*)\).*failed to open stream: (.*)/ " </span><span class="keyword">=&gt; 
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; array ( </span><span class="string">'mesg' </span><span class="keyword">=&gt; </span><span class="string">"IO::Failed to open stream with"</span><span class="keyword">,
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="string">'code' </span><span class="keyword">=&gt; </span><span class="default">IOERROR </span><span class="keyword">| </span><span class="default">FAILURE
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">),
<br />
&nbsp;&nbsp;&nbsp; </span><span class="string">"/^fopen\(.*\): Filename cannot be empty/" </span><span class="keyword">=&gt; 
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; array( </span><span class="string">'msg' </span><span class="keyword">=&gt; </span><span class="string">"Parameters::empty"</span><span class="keyword">,
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="string">'code' </span><span class="keyword">=&gt; </span><span class="default">EMPTYPARMS
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">)
<br />
&nbsp;&nbsp;&nbsp; );
<br />
function </span><span class="default">error_2_exception</span><span class="keyword">(</span><span class="default">$errno</span><span class="keyword">, </span><span class="default">$errstr</span><span class="keyword">, </span><span class="default">$errfile</span><span class="keyword">, </span><span class="default">$errline</span><span class="keyword">,</span><span class="default">$context</span><span class="keyword">) {
<br />
&nbsp;&nbsp;&nbsp; global </span><span class="default">$catch_me</span><span class="keyword">;
<br />
&nbsp;&nbsp;&nbsp; foreach (</span><span class="default">$catch_me </span><span class="keyword">as </span><span class="default">$regexp&nbsp; </span><span class="keyword">=&gt; </span><span class="default">$res</span><span class="keyword">) {
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if(</span><span class="default">preg_match</span><span class="keyword">(</span><span class="default">$regexp</span><span class="keyword">,</span><span class="default">$errstr</span><span class="keyword">,</span><span class="default">$match</span><span class="keyword">)){
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; throw new </span><span class="default">Exception</span><span class="keyword">(</span><span class="default">$res</span><span class="keyword">[</span><span class="string">'mesg'</span><span class="keyword">],</span><span class="default">$res</span><span class="keyword">[</span><span class="string">'code'</span><span class="keyword">]|( </span><span class="default">$errno </span><span class="keyword">&amp; </span><span class="default">EMASK </span><span class="keyword">) );
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }
<br />
&nbsp;&nbsp;&nbsp; }
<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">/* switch back to PHP internal error handler&nbsp; */
<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">return </span><span class="default">false</span><span class="keyword">;
<br />
}
<br />
</span><span class="comment">## =&gt; want to catch this one
<br />
</span><span class="default">$f</span><span class="keyword">=</span><span class="default">file_get_contents</span><span class="keyword">(</span><span class="string">"mlsdkfm"</span><span class="keyword">);
<br />
</span><span class="comment">## dont want to break existing wrong behaviour yet (so not caught)
<br />
</span><span class="default">$f</span><span class="keyword">=</span><span class="default">file_get_contents</span><span class="keyword">(</span><span class="string">''</span><span class="keyword">);
<br />
</span><span class="comment">## magic
<br />
</span><span class="default">set_error_handler</span><span class="keyword">(</span><span class="string">"error_2_exception"</span><span class="keyword">);
<br />
</span><span class="comment">## behaviour remains the same
<br />
</span><span class="default">$f</span><span class="keyword">=</span><span class="default">file_get_contents</span><span class="keyword">(</span><span class="string">''</span><span class="keyword">);
<br />
try { 
<br />
</span><span class="comment">## web services that dont work now raise an exception \o/
<br />
</span><span class="default">$f</span><span class="keyword">=</span><span class="default">file_get_contents</span><span class="keyword">(</span><span class="string">"mlsdkfm"</span><span class="keyword">);
<br />
} catch(</span><span class="default">Exception $e</span><span class="keyword">) {
<br />
</span><span class="comment">## and I can group my exception by category
<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">echo ( </span><span class="default">$e</span><span class="keyword">-&gt;</span><span class="default">getCode</span><span class="keyword">() &amp; </span><span class="default">FAILURE </span><span class="keyword">)&nbsp; ? </span><span class="string">"\nEPIC FAIL\n" </span><span class="keyword">: </span><span class="string">"\nbegnine"</span><span class="keyword">;
<br />
}
<br />

<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="95206""></a>
  <div class="note">
   <strong class="user">kalle at meizo dot com</strong>
   <a href="#95206" class="date">18-Dec-2009 03:11</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
This may be of help to someone, who is/was looking for a way to get a backtrace of fatal errors such as maximum memory allocation issues, which can not be handled with user-defined functions, to pin-point the problem:
<br />

<br />
On a server hosting many sites that share common PHP includes, I set in one spot:
<br />

<br />
<span class="default">&lt;?php
<br />
</span><span class="keyword">@</span><span class="default">ini_set </span><span class="keyword">(</span><span class="string">"error_log"</span><span class="keyword">, </span><span class="string">"/my/path/php.err-" </span><span class="keyword">. </span><span class="default">$_SERVER </span><span class="keyword">[</span><span class="string">"HTTP_HOST"</span><span class="keyword">] . </span><span class="string">"-" </span><span class="keyword">. </span><span class="default">$_SERVER </span><span class="keyword">[</span><span class="string">"REMOTE_ADDR"</span><span class="keyword">] . </span><span class="string">"-" </span><span class="keyword">. </span><span class="default">$_SERVER </span><span class="keyword">[</span><span class="string">"REQUEST_METHOD"</span><span class="keyword">] . </span><span class="string">"-" </span><span class="keyword">. </span><span class="default">str_replace </span><span class="keyword">(</span><span class="string">"/"</span><span class="keyword">, </span><span class="string">"|"</span><span class="keyword">, </span><span class="default">$_SERVER </span><span class="keyword">[</span><span class="string">"REQUEST_URI"</span><span class="keyword">]));
<br />
</span><span class="default">?&gt;
<br />
</span>
<br />
I actually used some additional information too from my software that I omitted, but that way, you'll find errors sorted more neatly in for example:-
<br />

<br />
/my/path/php.err-website.com-127.0.0.1-GET-path|index.html?xyz 
<br />

<br />
And that at least helped me tremendously to then further pin-point where the problem is, as opposed to before just seeing the out of memory and not knowing which site/page it was on (as the PHP error only contains the very latest PHP code where it ran out of memory, which usually is just a shared included file, not the actual page).</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="91918""></a>
  <div class="note">
   <strong class="user">quickshiftin at gmail dot com</strong>
   <a href="#91918" class="date">01-Jul-2009 04:59</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
using the output_buffer as a way to trap fatal errors from php itself, like E_ERROR, cannot offer a complete solution, b/c output buffering is disabled on the cli since 4.3.5 ..</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="91535""></a>
  <div class="note">
   <strong class="user">nizamgok at gmail dot com</strong>
   <a href="#91535" class="date">16-Jun-2009 04:27</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I have realized that a few people here mentioned that you cannot capture parse errors (type 4, E_PARSE). This is not true. Here is how I do. I hope this helps someone.
<br />

<br />
1) Create a "auto_prepend.php" file in the web root and add this:
<br />

<br />
<span class="default">&lt;?php
<br />
register_shutdown_function</span><span class="keyword">(</span><span class="string">'error_alert'</span><span class="keyword">);
<br />

<br />
function </span><span class="default">error_alert</span><span class="keyword">()
<br />
{
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if(</span><span class="default">is_null</span><span class="keyword">(</span><span class="default">$e </span><span class="keyword">= </span><span class="default">error_get_last</span><span class="keyword">()) === </span><span class="default">false</span><span class="keyword">)
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; {
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">mail</span><span class="keyword">(</span><span class="string">'your.email@example.com'</span><span class="keyword">, </span><span class="string">'Error from auto_prepend'</span><span class="keyword">, </span><span class="default">print_r</span><span class="keyword">(</span><span class="default">$e</span><span class="keyword">, </span><span class="default">true</span><span class="keyword">));
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }
<br />
}
<br />
</span><span class="default">?&gt;
<br />
</span>
<br />
2) Then add this "php_value auto_prepend_file /www/auto_prepend.php" to your .htaccess file in the web root.
<br />

<br />
* make sure you change the email address and the path to the file.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="90874""></a>
  <div class="note">
   <strong class="user">nsg</strong>
   <a href="#90874" class="date">14-May-2009 01:58</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If using E_USER_ERROR in conjunction with a custom error-handler, we are faced with an annoying choice:<br />
<br />
If you choose to die() on such errors, __destruct()ors can still function, but we can't then return false and have the inbuilt handler log the error.<br />
<br />
If you return false thus allowing the error to be logged, the script will halt, exit() style, and __destruct()'s won't happen.<br />
<br />
It seems the only solutions in such a case is to a) log your own errors, or b) don't use E_USER_ERROR.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="88401""></a>
  <div class="note">
   <strong class="user">Marcelius</strong>
   <a href="#88401" class="date">22-Jan-2009 02:41</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Another way to catch PHP's fatal errors:<br />
<br />
<span class="default">&lt;?php<br />
&nbsp;&nbsp;&nbsp; error_reporting</span><span class="keyword">(</span><span class="default">E_ALL</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">ini_set</span><span class="keyword">(</span><span class="string">'display_errors'</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">);<br />
<br />
&nbsp;&nbsp;&nbsp; function </span><span class="default">shutdown</span><span class="keyword">(){<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$isError </span><span class="keyword">= </span><span class="default">false</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">$error </span><span class="keyword">= </span><span class="default">error_get_last</span><span class="keyword">()){<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; switch(</span><span class="default">$error</span><span class="keyword">[</span><span class="string">'type'</span><span class="keyword">]){<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; case </span><span class="default">E_ERROR</span><span class="keyword">:<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; case </span><span class="default">E_CORE_ERROR</span><span class="keyword">:<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; case </span><span class="default">E_COMPILE_ERROR</span><span class="keyword">:<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; case </span><span class="default">E_USER_ERROR</span><span class="keyword">:<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$isError </span><span class="keyword">= </span><span class="default">true</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; break;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">$isError</span><span class="keyword">){<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; echo </span><span class="string">"Script execution halted (</span><span class="keyword">{</span><span class="default">$error</span><span class="keyword">[</span><span class="string">'message'</span><span class="keyword">]}</span><span class="string">)"</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; } else {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; echo </span><span class="string">"Script completed"</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">register_shutdown_function</span><span class="keyword">(</span><span class="string">'shutdown'</span><span class="keyword">);<br />
</span><span class="default">?&gt;<br />
</span><br />
Note that this will only catch runtime errors. So calling a method in a non existing class, or declaring a function twice does not trigger the shutdown handler.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="84345""></a>
  <div class="note">
   <strong class="user">wfinn at riverbed dot com</strong>
   <a href="#84345" class="date">10-Jul-2008 03:15</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
"The following error types cannot be handled with a user defined function: E_ERROR, E_PARSE, E_CORE_ERROR, E_CORE_WARNING, E_COMPILE_ERROR, E_COMPILE_WARNING, and most of E_STRICT raised in the file where set_error_handler() is called."<br />
<br />
This is not exactly true.&nbsp; set_error_handler() can't handle them, but ob_start() can handle at least E_ERROR.<br />
<br />
<span class="default">&lt;?php<br />
<br />
</span><span class="keyword">function </span><span class="default">error_handler</span><span class="keyword">(</span><span class="default">$output</span><span class="keyword">)<br />
{<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$error </span><span class="keyword">= </span><span class="default">error_get_last</span><span class="keyword">();<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$output </span><span class="keyword">= </span><span class="string">""</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; foreach (</span><span class="default">$error </span><span class="keyword">as </span><span class="default">$info </span><span class="keyword">=&gt; </span><span class="default">$string</span><span class="keyword">)<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$output </span><span class="keyword">.= </span><span class="string">"</span><span class="keyword">{</span><span class="default">$info</span><span class="keyword">}</span><span class="string">: </span><span class="keyword">{</span><span class="default">$string</span><span class="keyword">}</span><span class="string">\n"</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; return </span><span class="default">$output</span><span class="keyword">;<br />
}<br />
<br />
</span><span class="default">ob_start</span><span class="keyword">(</span><span class="string">'error_handler'</span><span class="keyword">);<br />
<br />
</span><span class="default">will_this_undefined_function_raise_an_error</span><span class="keyword">();<br />
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="82454""></a>
  <div class="note">
   <strong class="user">jonbarnett at gmail dot com</strong>
   <a href="#82454" class="date">11-Apr-2008 04:42</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Per the comment below:<br />
<br />
There's no problem with static class functions.<br />
<br />
The proper way to set a callback for a static class function is:<br />
<br />
array("Classname", "functionname")<br />
<br />
The class name is a string.&nbsp; If you don't quote the string, PHP treats it as a barestring and triggers a notice.<br />
<br />
/manual/en/language.pseudo-types.php</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="81565""></a>
  <div class="note">
   <strong class="user">etienne at perval dot fr</strong>
   <a href="#81565" class="date">04-Mar-2008 12:17</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Note that this function may return NULL in some cases, even when there are no errors.<br />
For instance, this is the case when you call this function for the first time: the function returns NULL simply because there is no previous error handler defined.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="80883""></a>
  <div class="note">
   <strong class="user">m0sh3 at hotmail dot com</strong>
   <a href="#80883" class="date">05-Feb-2008 06:33</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Looks like there's no way to distinguish between catched exceptions thrown by internal classes and real warnings in custom error handlers:<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">function </span><span class="default">handleError</span><span class="keyword">(</span><span class="default">$n</span><span class="keyword">, </span><span class="default">$m</span><span class="keyword">, </span><span class="default">$f</span><span class="keyword">, </span><span class="default">$l</span><span class="keyword">) {<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">//no difference between excpetions and E_WARNING<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">echo </span><span class="string">"user error handler: e_warning="</span><span class="keyword">.</span><span class="default">E_WARNING</span><span class="keyword">.</span><span class="string">"&nbsp; num="</span><span class="keyword">.</span><span class="default">$n</span><span class="keyword">.</span><span class="string">" msg="</span><span class="keyword">.</span><span class="default">$m</span><span class="keyword">.</span><span class="string">" line="</span><span class="keyword">.</span><span class="default">$l</span><span class="keyword">.</span><span class="string">"\n"</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; return </span><span class="default">true</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">//change to return false to make the "catch" block execute;<br />
</span><span class="keyword">}<br />
</span><span class="default">set_error_handler</span><span class="keyword">(</span><span class="string">'handleError'</span><span class="keyword">);<br />
</span><span class="comment">//turn off to make try/catch work normally<br />
<br />
//uncomment this for a regular warning<br />
</span><span class="default">timezone_open</span><span class="keyword">(</span><span class="default">1202229163</span><span class="keyword">);<br />
<br />
</span><span class="comment">//comment this whole try/catch out to see new DateTimeZone outside of a try / catch<br />
//behavior is the same if you have set a custom error handler<br />
<br />
//echo new DateTimeZone(1202229163);<br />
<br />
//*<br />
</span><span class="keyword">try {<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$z </span><span class="keyword">= new </span><span class="default">DateTimeZone</span><span class="keyword">(</span><span class="default">1202229163</span><span class="keyword">);<br />
} catch (</span><span class="default">Exception $e</span><span class="keyword">) {<br />
&nbsp;&nbsp;&nbsp; echo </span><span class="string">"caught"</span><span class="keyword">;<br />
}<br />
</span><span class="comment">// */<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="80205""></a>
  <div class="note">
   <strong class="user">webmaster at paramiliar dot com</strong>
   <a href="#80205" class="date">04-Jan-2008 08:03</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
We needed to use an error handler to handle SQL errors while passing the query along so the query is also logged and this is what we came up with, its kind of an ugly bridge but it works 100%<br />
<br />
<span class="default">&lt;?php<br />
<br />
</span><span class="keyword">function </span><span class="default">myErrorHandler</span><span class="keyword">(</span><span class="default">$errno</span><span class="keyword">, </span><span class="default">$errstr</span><span class="keyword">, </span><span class="default">$errfile</span><span class="keyword">, </span><span class="default">$errline</span><span class="keyword">){<br />
&nbsp;&nbsp;&nbsp; switch (</span><span class="default">$errno</span><span class="keyword">) {<br />
&nbsp;&nbsp;&nbsp; case </span><span class="default">E_USER_ERROR</span><span class="keyword">:<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">$errstr </span><span class="keyword">== </span><span class="string">"(SQL)"</span><span class="keyword">){<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// handling an sql error<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">echo </span><span class="string">"&lt;b&gt;SQL Error&lt;/b&gt; [</span><span class="default">$errno</span><span class="string">] " </span><span class="keyword">. </span><span class="default">SQLMESSAGE </span><span class="keyword">. </span><span class="string">"&lt;br /&gt;\n"</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; echo </span><span class="string">"Query : " </span><span class="keyword">. </span><span class="default">SQLQUERY </span><span class="keyword">. </span><span class="string">"&lt;br /&gt;\n"</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; echo </span><span class="string">"On line " </span><span class="keyword">. </span><span class="default">SQLERRORLINE </span><span class="keyword">. </span><span class="string">" in file " </span><span class="keyword">. </span><span class="default">SQLERRORFILE </span><span class="keyword">. </span><span class="string">" "</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; echo </span><span class="string">", PHP " </span><span class="keyword">. </span><span class="default">PHP_VERSION </span><span class="keyword">. </span><span class="string">" (" </span><span class="keyword">. </span><span class="default">PHP_OS </span><span class="keyword">. </span><span class="string">")&lt;br /&gt;\n"</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; echo </span><span class="string">"Aborting...&lt;br /&gt;\n"</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; } else {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; echo </span><span class="string">"&lt;b&gt;My ERROR&lt;/b&gt; [</span><span class="default">$errno</span><span class="string">] </span><span class="default">$errstr</span><span class="string">&lt;br /&gt;\n"</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; echo </span><span class="string">"&nbsp; Fatal error on line </span><span class="default">$errline</span><span class="string"> in file </span><span class="default">$errfile</span><span class="string">"</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; echo </span><span class="string">", PHP " </span><span class="keyword">. </span><span class="default">PHP_VERSION </span><span class="keyword">. </span><span class="string">" (" </span><span class="keyword">. </span><span class="default">PHP_OS </span><span class="keyword">. </span><span class="string">")&lt;br /&gt;\n"</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; echo </span><span class="string">"Aborting...&lt;br /&gt;\n"</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; exit(</span><span class="default">1</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; break;<br />
<br />
&nbsp;&nbsp;&nbsp; case </span><span class="default">E_USER_WARNING</span><span class="keyword">:<br />
&nbsp;&nbsp;&nbsp; case </span><span class="default">E_USER_NOTICE</span><span class="keyword">:<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">/* Don't execute PHP internal error handler */<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">return </span><span class="default">true</span><span class="keyword">;<br />
}<br />
<br />
</span><span class="comment">// function to test the error handling<br />
<br />
</span><span class="keyword">function </span><span class="default">sqlerrorhandler</span><span class="keyword">(</span><span class="default">$ERROR</span><span class="keyword">, </span><span class="default">$QUERY</span><span class="keyword">, </span><span class="default">$PHPFILE</span><span class="keyword">, </span><span class="default">$LINE</span><span class="keyword">){<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">define</span><span class="keyword">(</span><span class="string">"SQLQUERY"</span><span class="keyword">, </span><span class="default">$QUERY</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">define</span><span class="keyword">(</span><span class="string">"SQLMESSAGE"</span><span class="keyword">, </span><span class="default">$ERROR</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">define</span><span class="keyword">(</span><span class="string">"SQLERRORLINE"</span><span class="keyword">, </span><span class="default">$LINE</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">define</span><span class="keyword">(</span><span class="string">"SQLERRORFILE"</span><span class="keyword">, </span><span class="default">$PHPFILE</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">trigger_error</span><span class="keyword">(</span><span class="string">"(SQL)"</span><span class="keyword">, </span><span class="default">E_USER_ERROR</span><span class="keyword">);<br />
}<br />
<br />
</span><span class="default">set_error_handler</span><span class="keyword">(</span><span class="string">"myErrorHandler"</span><span class="keyword">);<br />
<br />
</span><span class="comment">// trigger an sql error<br />
</span><span class="default">$query </span><span class="keyword">= </span><span class="string">"SELECT * FROM tbl LIMIT 1"</span><span class="keyword">;<br />
</span><span class="default">$sql </span><span class="keyword">= @</span><span class="default">mysql_query</span><span class="keyword">(</span><span class="default">$query</span><span class="keyword">)<br />
&nbsp;&nbsp;&nbsp; or </span><span class="default">sqlerrorhandler</span><span class="keyword">(</span><span class="string">"("</span><span class="keyword">.</span><span class="default">mysql_errno</span><span class="keyword">().</span><span class="string">") "</span><span class="keyword">.</span><span class="default">mysql_error</span><span class="keyword">(), </span><span class="default">$query</span><span class="keyword">, </span><span class="default">$_SERVER</span><span class="keyword">[</span><span class="string">'PHP_SELF'</span><span class="keyword">], </span><span class="default">__LINE__</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; <br />
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="77997""></a>
  <div class="note">
   <strong class="user">michal dot kocarek at NO_SPAM dot seznam dot cz</strong>
   <a href="#77997" class="date">23-Sep-2007 11:55</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Be aware of efficiency and speed of your scripts!<br />
<br />
If you use old-fashioned non-strict variable calling (example follows...), your custom error handler function degrades the script speed very big (especially for bigger projects). Because of for every "use of undefined constant" or "undefined variable" E_NOTICEs will be called your own custom error handler function.<br />
<br />
&lt;?<br />
if ($form_variable) { ///&lt; E_NOTICE Undefined variable<br />
&nbsp;&nbsp; // process form stuff<br />
}<br />
$foo[bar] = $const_array[baz]; ///&lt; 2x E_NOTICE Use of undefined constant bar, baz<br />
<br />
if (!$d) { // declare default $d ///&lt; E_NOTICE Undefined variable<br />
&nbsp;&nbsp; $d = 5;<br />
}<br />
?&gt;<br />
<br />
As you can see in this poor example, badly writted scripts decrease the performace very big 'cause of the error handler is called almost everytime. So use custom-error-handler on heavily used pages only if you are writing scripts strictly. (Example follows:)<br />
&lt;?<br />
if (isset($form_variable) &amp;&amp; $form_variable != null) {<br />
&nbsp;&nbsp; // process form stuff<br />
}<br />
$foo['bar'] = $const_array['baz'];<br />
<br />
if (!isset($d) || $d == null) {<br />
&nbsp;&nbsp; $d = 5;<br />
}<br />
?&gt;</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="76900""></a>
  <div class="note">
   <strong class="user">ash</strong>
   <a href="#76900" class="date">04-Aug-2007 12:38</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
error handling function that handles both errors and exceptions; also features a backtrace including possible function arguments.<br />
<br />
<span class="default">&lt;?php<br />
<br />
$cfg </span><span class="keyword">= array();<br />
</span><span class="default">$cfg</span><span class="keyword">[</span><span class="string">'debug'</span><span class="keyword">] = </span><span class="default">1</span><span class="keyword">;<br />
</span><span class="default">$cfg</span><span class="keyword">[</span><span class="string">'adminEmail'</span><span class="keyword">] = </span><span class="string">'name@domain.tld'</span><span class="keyword">;<br />
<br />
function </span><span class="default">errorHandler</span><span class="keyword">(</span><span class="default">$errno</span><span class="keyword">, </span><span class="default">$errstr</span><span class="keyword">=</span><span class="string">''</span><span class="keyword">, </span><span class="default">$errfile</span><span class="keyword">=</span><span class="string">''</span><span class="keyword">, </span><span class="default">$errline</span><span class="keyword">=</span><span class="string">''</span><span class="keyword">)<br />
{<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">// if error has been supressed with an @<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">if (</span><span class="default">error_reporting</span><span class="keyword">() == </span><span class="default">0</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return;<br />
&nbsp;&nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp;&nbsp; global </span><span class="default">$cfg</span><span class="keyword">;<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">// check if function has been called by an exception<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">if(</span><span class="default">func_num_args</span><span class="keyword">() == </span><span class="default">5</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// called by trigger_error()<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$exception </span><span class="keyword">= </span><span class="default">null</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; list(</span><span class="default">$errno</span><span class="keyword">, </span><span class="default">$errstr</span><span class="keyword">, </span><span class="default">$errfile</span><span class="keyword">, </span><span class="default">$errline</span><span class="keyword">) = </span><span class="default">func_get_args</span><span class="keyword">();<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$backtrace </span><span class="keyword">= </span><span class="default">array_reverse</span><span class="keyword">(</span><span class="default">debug_backtrace</span><span class="keyword">());<br />
<br />
&nbsp;&nbsp;&nbsp; }else {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// caught exception<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$exc </span><span class="keyword">= </span><span class="default">func_get_arg</span><span class="keyword">(</span><span class="default">0</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$errno </span><span class="keyword">= </span><span class="default">$exc</span><span class="keyword">-&gt;</span><span class="default">getCode</span><span class="keyword">();<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$errstr </span><span class="keyword">= </span><span class="default">$exc</span><span class="keyword">-&gt;</span><span class="default">getMessage</span><span class="keyword">();<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$errfile </span><span class="keyword">= </span><span class="default">$exc</span><span class="keyword">-&gt;</span><span class="default">getFile</span><span class="keyword">();<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$errline </span><span class="keyword">= </span><span class="default">$exc</span><span class="keyword">-&gt;</span><span class="default">getLine</span><span class="keyword">();<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$backtrace </span><span class="keyword">= </span><span class="default">$exc</span><span class="keyword">-&gt;</span><span class="default">getTrace</span><span class="keyword">();<br />
&nbsp;&nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$errorType </span><span class="keyword">= array (<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">E_ERROR&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="keyword">=&gt; </span><span class="string">'ERROR'</span><span class="keyword">,<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">E_WARNING&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="keyword">=&gt; </span><span class="string">'WARNING'</span><span class="keyword">,<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">E_PARSE&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="keyword">=&gt; </span><span class="string">'PARSING ERROR'</span><span class="keyword">,<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">E_NOTICE&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">=&gt; </span><span class="string">'NOTICE'</span><span class="keyword">,<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">E_CORE_ERROR&nbsp; &nbsp;&nbsp; </span><span class="keyword">=&gt; </span><span class="string">'CORE ERROR'</span><span class="keyword">,<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">E_CORE_WARNING&nbsp;&nbsp; </span><span class="keyword">=&gt; </span><span class="string">'CORE WARNING'</span><span class="keyword">,<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">E_COMPILE_ERROR&nbsp; </span><span class="keyword">=&gt; </span><span class="string">'COMPILE ERROR'</span><span class="keyword">,<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">E_COMPILE_WARNING </span><span class="keyword">=&gt; </span><span class="string">'COMPILE WARNING'</span><span class="keyword">,<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">E_USER_ERROR&nbsp; &nbsp;&nbsp; </span><span class="keyword">=&gt; </span><span class="string">'USER ERROR'</span><span class="keyword">,<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">E_USER_WARNING&nbsp;&nbsp; </span><span class="keyword">=&gt; </span><span class="string">'USER WARNING'</span><span class="keyword">,<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">E_USER_NOTICE&nbsp; &nbsp; </span><span class="keyword">=&gt; </span><span class="string">'USER NOTICE'</span><span class="keyword">,<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">E_STRICT&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">=&gt; </span><span class="string">'STRICT NOTICE'</span><span class="keyword">,<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">E_RECOVERABLE_ERROR&nbsp; </span><span class="keyword">=&gt; </span><span class="string">'RECOVERABLE ERROR'<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="keyword">);<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">// create error message<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">if (</span><span class="default">array_key_exists</span><span class="keyword">(</span><span class="default">$errno</span><span class="keyword">, </span><span class="default">$errorType</span><span class="keyword">)) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$err </span><span class="keyword">= </span><span class="default">$errorType</span><span class="keyword">[</span><span class="default">$errno</span><span class="keyword">];<br />
&nbsp;&nbsp;&nbsp; } else {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$err </span><span class="keyword">= </span><span class="string">'CAUGHT EXCEPTION'</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$errMsg </span><span class="keyword">= </span><span class="string">"</span><span class="default">$err</span><span class="string">: </span><span class="default">$errstr</span><span class="string"> in </span><span class="default">$errfile</span><span class="string"> on line </span><span class="default">$errline</span><span class="string">"</span><span class="keyword">;<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">// start backtrace<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">foreach (</span><span class="default">$backtrace </span><span class="keyword">as </span><span class="default">$v</span><span class="keyword">) {<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if (isset(</span><span class="default">$v</span><span class="keyword">[</span><span class="string">'class'</span><span class="keyword">])) {<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$trace </span><span class="keyword">= </span><span class="string">'in class '</span><span class="keyword">.</span><span class="default">$v</span><span class="keyword">[</span><span class="string">'class'</span><span class="keyword">].</span><span class="string">'::'</span><span class="keyword">.</span><span class="default">$v</span><span class="keyword">[</span><span class="string">'function'</span><span class="keyword">].</span><span class="string">'('</span><span class="keyword">;<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if (isset(</span><span class="default">$v</span><span class="keyword">[</span><span class="string">'args'</span><span class="keyword">])) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$separator </span><span class="keyword">= </span><span class="string">''</span><span class="keyword">;<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; foreach(</span><span class="default">$v</span><span class="keyword">[</span><span class="string">'args'</span><span class="keyword">] as </span><span class="default">$arg </span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$trace </span><span class="keyword">.= </span><span class="string">"</span><span class="default">$separator</span><span class="string">"</span><span class="keyword">.</span><span class="default">getArgument</span><span class="keyword">(</span><span class="default">$arg</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$separator </span><span class="keyword">= </span><span class="string">', '</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$trace </span><span class="keyword">.= </span><span class="string">')'</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; elseif (isset(</span><span class="default">$v</span><span class="keyword">[</span><span class="string">'function'</span><span class="keyword">]) &amp;&amp; empty(</span><span class="default">$trace</span><span class="keyword">)) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$trace </span><span class="keyword">= </span><span class="string">'in function '</span><span class="keyword">.</span><span class="default">$v</span><span class="keyword">[</span><span class="string">'function'</span><span class="keyword">].</span><span class="string">'('</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if (!empty(</span><span class="default">$v</span><span class="keyword">[</span><span class="string">'args'</span><span class="keyword">])) {<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$separator </span><span class="keyword">= </span><span class="string">''</span><span class="keyword">;<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; foreach(</span><span class="default">$v</span><span class="keyword">[</span><span class="string">'args'</span><span class="keyword">] as </span><span class="default">$arg </span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$trace </span><span class="keyword">.= </span><span class="string">"</span><span class="default">$separator</span><span class="string">"</span><span class="keyword">.</span><span class="default">getArgument</span><span class="keyword">(</span><span class="default">$arg</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$separator </span><span class="keyword">= </span><span class="string">', '</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$trace </span><span class="keyword">.= </span><span class="string">')'</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">// display error msg, if debug is enabled<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">if(</span><span class="default">$cfg</span><span class="keyword">[</span><span class="string">'debug'</span><span class="keyword">] == </span><span class="default">1</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; echo </span><span class="string">'&lt;h2&gt;Debug Msg&lt;/h2&gt;'</span><span class="keyword">.</span><span class="default">nl2br</span><span class="keyword">(</span><span class="default">$errMsg</span><span class="keyword">).</span><span class="string">'&lt;br /&gt;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; Trace: '</span><span class="keyword">.</span><span class="default">nl2br</span><span class="keyword">(</span><span class="default">$trace</span><span class="keyword">).</span><span class="string">'&lt;br /&gt;'</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">// what to do<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">switch (</span><span class="default">$errno</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; case </span><span class="default">E_NOTICE</span><span class="keyword">:<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; case </span><span class="default">E_USER_NOTICE</span><span class="keyword">:<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; break;<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; default:<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if(</span><span class="default">$cfg</span><span class="keyword">[</span><span class="string">'debug'</span><span class="keyword">] == </span><span class="default">0</span><span class="keyword">){<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// send email to admin<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">if(!empty(</span><span class="default">$cfg</span><span class="keyword">[</span><span class="string">'adminEmail'</span><span class="keyword">])) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; @</span><span class="default">mail</span><span class="keyword">(</span><span class="default">$cfg</span><span class="keyword">[</span><span class="string">'adminEmail'</span><span class="keyword">],</span><span class="string">'critical error on '</span><span class="keyword">.</span><span class="default">$_SERVER</span><span class="keyword">[</span><span class="string">'HTTP_HOST'</span><span class="keyword">], </span><span class="default">$errorText</span><span class="keyword">,<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="string">'From: Error Handler'</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// end and display error msg<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">exit(</span><span class="default">displayClientMessage</span><span class="keyword">());<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; else<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; exit(</span><span class="string">'&lt;p&gt;aborting.&lt;/p&gt;'</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; break;<br />
<br />
&nbsp;&nbsp;&nbsp; }<br />
<br />
} </span><span class="comment">// end of errorHandler()<br />
<br />
</span><span class="keyword">function </span><span class="default">displayClientMessage</span><span class="keyword">()<br />
{<br />
&nbsp;&nbsp;&nbsp; echo </span><span class="string">'some html page with error message'</span><span class="keyword">;<br />
<br />
}<br />
<br />
function </span><span class="default">getArgument</span><span class="keyword">(</span><span class="default">$arg</span><span class="keyword">)<br />
{<br />
&nbsp;&nbsp;&nbsp; switch (</span><span class="default">strtolower</span><span class="keyword">(</span><span class="default">gettype</span><span class="keyword">(</span><span class="default">$arg</span><span class="keyword">))) {<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; case </span><span class="string">'string'</span><span class="keyword">:<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return( </span><span class="string">'"'</span><span class="keyword">.</span><span class="default">str_replace</span><span class="keyword">( array(</span><span class="string">"\n"</span><span class="keyword">), array(</span><span class="string">''</span><span class="keyword">), </span><span class="default">$arg </span><span class="keyword">).</span><span class="string">'"' </span><span class="keyword">);<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; case </span><span class="string">'boolean'</span><span class="keyword">:<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return (bool)</span><span class="default">$arg</span><span class="keyword">;<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; case </span><span class="string">'object'</span><span class="keyword">:<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="string">'object('</span><span class="keyword">.</span><span class="default">get_class</span><span class="keyword">(</span><span class="default">$arg</span><span class="keyword">).</span><span class="string">')'</span><span class="keyword">;<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; case </span><span class="string">'array'</span><span class="keyword">:<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$ret </span><span class="keyword">= </span><span class="string">'array('</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$separtor </span><span class="keyword">= </span><span class="string">''</span><span class="keyword">;<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; foreach (</span><span class="default">$arg </span><span class="keyword">as </span><span class="default">$k </span><span class="keyword">=&gt; </span><span class="default">$v</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$ret </span><span class="keyword">.= </span><span class="default">$separtor</span><span class="keyword">.</span><span class="default">getArgument</span><span class="keyword">(</span><span class="default">$k</span><span class="keyword">).</span><span class="string">' =&gt; '</span><span class="keyword">.</span><span class="default">getArgument</span><span class="keyword">(</span><span class="default">$v</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$separtor </span><span class="keyword">= </span><span class="string">', '</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$ret </span><span class="keyword">.= </span><span class="string">')'</span><span class="keyword">;<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">$ret</span><span class="keyword">;<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; case </span><span class="string">'resource'</span><span class="keyword">:<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="string">'resource('</span><span class="keyword">.</span><span class="default">get_resource_type</span><span class="keyword">(</span><span class="default">$arg</span><span class="keyword">).</span><span class="string">')'</span><span class="keyword">;<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; default:<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">var_export</span><span class="keyword">(</span><span class="default">$arg</span><span class="keyword">, </span><span class="default">true</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; }<br />
}<br />
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="76495""></a>
  <div class="note">
   <strong class="user">Thomas</strong>
   <a href="#76495" class="date">18-Jul-2007 10:57</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Be careful with error-handlers if you are using require() with a function as argument, like<br />
<span class="default">&lt;?php <br />
&nbsp; </span><span class="keyword">require(</span><span class="default">foo</span><span class="keyword">(</span><span class="default">$foo</span><span class="keyword">));<br />
</span><span class="default">?&gt;<br />
</span>If the result of the function isn't a valid file to be included, you wont get any errormessage, but your script will crash without any output (see the bug-database for further details: <a href="http://bugs.php.net/bug.php?id=41862" rel="nofollow" target="_blank">http://bugs.php.net/bug.php?id=41862</a>).</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="76026""></a>
  <div class="note">
   <strong class="user">stepheneliotdewey at GmailDotCom</strong>
   <a href="#76026" class="date">27-Jun-2007 06:26</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Additional note based on some further testing:<br />
<br />
Although errcontext is effectively an array passed by reference to your custom error handling function, you cannot simply copy it over to another variable, because that variable will also act like a reference to errcontext, almost like an object.<br />
<br />
Instead, the only way I can find to copy the errcontext array to a separate variable so that you can actually modify its values without changing the surrounding variable context, is to copy it piece-by-piece with a foreach loop. Not the most efficient way of working, but then again, errors are hopefully exceptional enough for you that performance will not be an overriding concern in this case.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="76025""></a>
  <div class="note">
   <strong class="user">stepheneliotdewey at GmailDotCom</strong>
   <a href="#76025" class="date">27-Jun-2007 05:48</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
The manual states:<br />
<br />
"errcontext will contain an array of every variable that existed in the scope the error was triggered in. User error handler must not modify error context."<br />
<br />
But do you know WHY you must not modify the error context? It appears that errcontext is (in effect if not literally) created by taking $GLOBALS and adding the non-global local variables as additional entries in that array, then passing the whole thing *by reference*.<br />
<br />
(You can prove this to be true if you set up a custom error handler and then print_r($errcontext) within it, because $GLOBALS will be printed as a recursive array).<br />
<br />
In other words, the language in the manual is misleading, because errcontext is NOT a copy of the variables that existed when the error WAS triggered, but rather is a reference to the *existing LIVE variables* in the calling script.<br />
<br />
This includes superglobal variables like $_SERVER, $_POST, $_GET, etc., as well as all user-defined variables in scope.<br />
<br />
The significance of that is that if you modify errcontext, you will be modifying those other variables, not just for the life of your error handling function, but for the life of the calling script as well.<br />
<br />
That doesn't matter if you plan to halt execution in your error handling function, but it will lead to unexpected behavior if you modify $errcontext and then return to the program's normal flow after handling the error, because the variables will stay modified. For example, if you unset $_SERVER in your custom error handling function, it will remain unset once the function is over and you have returned to the page that generated the error.<br />
<br />
This should be made clearer in the manual, starting by marking errhandler with an ampersand (&amp;) for passage by reference in the "Parameters" section above, like so:<br />
<br />
handler ( int $errno, string $errstr [, string $errfile [, int $errline [, array &amp;$errcontext]]] )</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="75881""></a>
  <div class="note">
   <strong class="user">gotrunko at hotmail dot com</strong>
   <a href="#75881" class="date">20-Jun-2007 10:26</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
To ereg error in a text file<br />
<br />
<span class="default">&lt;?php<br />
$log_file</span><span class="keyword">=</span><span class="string">"log.txt"</span><span class="keyword">;<br />
<br />
</span><span class="default">set_error_handler</span><span class="keyword">(</span><span class="default">log_handler</span><span class="keyword">);<br />
<br />
function </span><span class="default">log_handler </span><span class="keyword">( </span><span class="default">$errno</span><span class="keyword">, </span><span class="default">$errstr</span><span class="keyword">,&nbsp; </span><span class="default">$errfile</span><span class="keyword">, </span><span class="default">$errline</span><span class="keyword">, </span><span class="default">$errcontext </span><span class="keyword">)<br />
{<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$context </span><span class="keyword">= </span><span class="default">var_export</span><span class="keyword">(</span><span class="default">$errcontext</span><span class="keyword">, </span><span class="default">TRUE</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">log_error_ereg</span><span class="keyword">(</span><span class="string">"errno:</span><span class="default">$errno</span><span class="string"> (</span><span class="default">$errstr</span><span class="string">) file:</span><span class="default">$errfile</span><span class="string">, line:</span><span class="default">$errline</span><span class="string">, context:</span><span class="default">$context</span><span class="string">\n"</span><span class="keyword">);<br />
}<br />
<br />
function </span><span class="default">log_error_ereg</span><span class="keyword">(</span><span class="default">$mess</span><span class="keyword">)<br />
{<br />
&nbsp;&nbsp;&nbsp; global </span><span class="default">$log_file</span><span class="keyword">;<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$fd </span><span class="keyword">= </span><span class="default">fopen</span><span class="keyword">(</span><span class="default">$log_file</span><span class="keyword">, </span><span class="string">'a'</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; if(!</span><span class="default">$fd</span><span class="keyword">)<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; echo </span><span class="string">"&lt;pre&gt;</span><span class="default">$mess</span><span class="string">&lt;/pre&gt;"</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; else<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if(!</span><span class="default">fwrite</span><span class="keyword">(</span><span class="default">$fd</span><span class="keyword">, </span><span class="default">date</span><span class="keyword">(</span><span class="string">'Y-m-d H:i:s'</span><span class="keyword">).</span><span class="string">" ERR : \n</span><span class="default">$mess</span><span class="string">\n\n"</span><span class="keyword">))<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; echo </span><span class="string">"&lt;pre&gt;</span><span class="default">$mess</span><span class="string">&lt;/pre&gt;"</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">fclose</span><span class="keyword">(</span><span class="default">$fd</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; }<br />
}<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="75169""></a>
  <div class="note">
   <strong class="user">greg sidberry[poetics5 at yahoo dot com]</strong>
   <a href="#75169" class="date">16-May-2007 07:32</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I was using a class, and needed to have a function within it handle php errors. <br />
<br />
The following code will allow you to call a class function of already defined object while maintaining access to all the objects current data .<br />
============================<br />
<br />
set_error_handler("classPassPHPError");<br />
<br />
$ObjectName="test";<br />
<br />
$test-&gt;new className;<br />
<br />
function classPassPHPError($errno, $errstr, $errfile, $errline){<br />
global $ObjectName;<br />
<br />
eval("global \$".$ObjectName.";");<br />
eval("\$object=\$".$ObjectName.";");<br />
<br />
$object-&gt;phpErrorHandler($errno, $errstr, $errfile, $errline);<br />
$object=null;<br />
}</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="74881""></a>
  <div class="note">
   <strong class="user">silkensedai at online dot fr</strong>
   <a href="#74881" class="date">02-May-2007 09:37</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
i made an error handler that print also the backtrace and that can die on some errors. It can be useful if you want to die on every error you find.<br />
<br />
<span class="default">&lt;?php<br />
<br />
</span><span class="keyword">function </span><span class="default">my_error_handler</span><span class="keyword">(</span><span class="default">$errno</span><span class="keyword">, </span><span class="default">$errstr</span><span class="keyword">, </span><span class="default">$errfile</span><span class="keyword">, </span><span class="default">$errline</span><span class="keyword">){<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$errno </span><span class="keyword">= </span><span class="default">$errno </span><span class="keyword">&amp; </span><span class="default">error_reporting</span><span class="keyword">();<br />
&nbsp;&nbsp;&nbsp; if(</span><span class="default">$errno </span><span class="keyword">== </span><span class="default">0</span><span class="keyword">) return;<br />
&nbsp;&nbsp;&nbsp; if(!</span><span class="default">defined</span><span class="keyword">(</span><span class="string">'E_STRICT'</span><span class="keyword">))&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">define</span><span class="keyword">(</span><span class="string">'E_STRICT'</span><span class="keyword">, </span><span class="default">2048</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; if(!</span><span class="default">defined</span><span class="keyword">(</span><span class="string">'E_RECOVERABLE_ERROR'</span><span class="keyword">)) </span><span class="default">define</span><span class="keyword">(</span><span class="string">'E_RECOVERABLE_ERROR'</span><span class="keyword">, </span><span class="default">4096</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; print </span><span class="string">"&lt;pre&gt;\n&lt;b&gt;"</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; switch(</span><span class="default">$errno</span><span class="keyword">){<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; case </span><span class="default">E_ERROR</span><span class="keyword">:&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; print </span><span class="string">"Error"</span><span class="keyword">;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; break;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; case </span><span class="default">E_WARNING</span><span class="keyword">:&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; print </span><span class="string">"Warning"</span><span class="keyword">;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; break;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; case </span><span class="default">E_PARSE</span><span class="keyword">:&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; print </span><span class="string">"Parse Error"</span><span class="keyword">;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; break;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; case </span><span class="default">E_NOTICE</span><span class="keyword">:&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; print </span><span class="string">"Notice"</span><span class="keyword">;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; break;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; case </span><span class="default">E_CORE_ERROR</span><span class="keyword">:&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; print </span><span class="string">"Core Error"</span><span class="keyword">;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; break;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; case </span><span class="default">E_CORE_WARNING</span><span class="keyword">:&nbsp; &nbsp; &nbsp; &nbsp; print </span><span class="string">"Core Warning"</span><span class="keyword">;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; break;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; case </span><span class="default">E_COMPILE_ERROR</span><span class="keyword">:&nbsp; &nbsp; &nbsp;&nbsp; print </span><span class="string">"Compile Error"</span><span class="keyword">;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; break;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; case </span><span class="default">E_COMPILE_WARNING</span><span class="keyword">:&nbsp; &nbsp;&nbsp; print </span><span class="string">"Compile Warning"</span><span class="keyword">;&nbsp; &nbsp; &nbsp; &nbsp; break;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; case </span><span class="default">E_USER_ERROR</span><span class="keyword">:&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; print </span><span class="string">"User Error"</span><span class="keyword">;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; break;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; case </span><span class="default">E_USER_WARNING</span><span class="keyword">:&nbsp; &nbsp; &nbsp; &nbsp; print </span><span class="string">"User Warning"</span><span class="keyword">;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; break;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; case </span><span class="default">E_USER_NOTICE</span><span class="keyword">:&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; print </span><span class="string">"User Notice"</span><span class="keyword">;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; break;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; case </span><span class="default">E_STRICT</span><span class="keyword">:&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; print </span><span class="string">"Strict Notice"</span><span class="keyword">;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; break;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; case </span><span class="default">E_RECOVERABLE_ERROR</span><span class="keyword">:&nbsp;&nbsp; print </span><span class="string">"Recoverable Error"</span><span class="keyword">;&nbsp; &nbsp; &nbsp; break;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; default:&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; print </span><span class="string">"Unknown error (</span><span class="default">$errno</span><span class="string">)"</span><span class="keyword">; break;<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; print </span><span class="string">":&lt;/b&gt; &lt;i&gt;</span><span class="default">$errstr</span><span class="string">&lt;/i&gt; in &lt;b&gt;</span><span class="default">$errfile</span><span class="string">&lt;/b&gt; on line &lt;b&gt;</span><span class="default">$errline</span><span class="string">&lt;/b&gt;\n"</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; if(</span><span class="default">function_exists</span><span class="keyword">(</span><span class="string">'debug_backtrace'</span><span class="keyword">)){<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">//print "backtrace:\n";<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$backtrace </span><span class="keyword">= </span><span class="default">debug_backtrace</span><span class="keyword">();<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">array_shift</span><span class="keyword">(</span><span class="default">$backtrace</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; foreach(</span><span class="default">$backtrace </span><span class="keyword">as </span><span class="default">$i</span><span class="keyword">=&gt;</span><span class="default">$l</span><span class="keyword">){<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; print </span><span class="string">"[</span><span class="default">$i</span><span class="string">] in function &lt;b&gt;</span><span class="keyword">{</span><span class="default">$l</span><span class="keyword">[</span><span class="string">'class'</span><span class="keyword">]}{</span><span class="default">$l</span><span class="keyword">[</span><span class="string">'type'</span><span class="keyword">]}{</span><span class="default">$l</span><span class="keyword">[</span><span class="string">'function'</span><span class="keyword">]}</span><span class="string">&lt;/b&gt;"</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if(</span><span class="default">$l</span><span class="keyword">[</span><span class="string">'file'</span><span class="keyword">]) print </span><span class="string">" in &lt;b&gt;</span><span class="keyword">{</span><span class="default">$l</span><span class="keyword">[</span><span class="string">'file'</span><span class="keyword">]}</span><span class="string">&lt;/b&gt;"</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if(</span><span class="default">$l</span><span class="keyword">[</span><span class="string">'line'</span><span class="keyword">]) print </span><span class="string">" on line &lt;b&gt;</span><span class="keyword">{</span><span class="default">$l</span><span class="keyword">[</span><span class="string">'line'</span><span class="keyword">]}</span><span class="string">&lt;/b&gt;"</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; print </span><span class="string">"\n"</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; print </span><span class="string">"\n&lt;/pre&gt;"</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; if(isset(</span><span class="default">$GLOBALS</span><span class="keyword">[</span><span class="string">'error_fatal'</span><span class="keyword">])){<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if(</span><span class="default">$GLOBALS</span><span class="keyword">[</span><span class="string">'error_fatal'</span><span class="keyword">] &amp; </span><span class="default">$errno</span><span class="keyword">) die(</span><span class="string">'fatal'</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; }<br />
}<br />
<br />
function </span><span class="default">error_fatal</span><span class="keyword">(</span><span class="default">$mask </span><span class="keyword">= </span><span class="default">NULL</span><span class="keyword">){<br />
&nbsp;&nbsp;&nbsp; if(!</span><span class="default">is_null</span><span class="keyword">(</span><span class="default">$mask</span><span class="keyword">)){<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$GLOBALS</span><span class="keyword">[</span><span class="string">'error_fatal'</span><span class="keyword">] = </span><span class="default">$mask</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }elseif(!isset(</span><span class="default">$GLOBALS</span><span class="keyword">[</span><span class="string">'die_on'</span><span class="keyword">])){<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$GLOBALS</span><span class="keyword">[</span><span class="string">'error_fatal'</span><span class="keyword">] = </span><span class="default">0</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; return </span><span class="default">$GLOBALS</span><span class="keyword">[</span><span class="string">'error_fatal'</span><span class="keyword">];<br />
}<br />
<br />
</span><span class="default">?&gt;<br />
</span><br />
Usage :<br />
<br />
<span class="default">&lt;?php<br />
error_reporting</span><span class="keyword">(</span><span class="default">E_ALL</span><span class="keyword">);&nbsp; &nbsp; &nbsp; </span><span class="comment">// will report all errors<br />
</span><span class="default">set_error_handler</span><span class="keyword">(</span><span class="string">'my_error_handler'</span><span class="keyword">);<br />
</span><span class="default">error_fatal</span><span class="keyword">(</span><span class="default">E_ALL</span><span class="keyword">^</span><span class="default">E_NOTICE</span><span class="keyword">); </span><span class="comment">// will die on any error except E_NOTICE<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="73239""></a>
  <div class="note">
   <strong class="user">elven_rangers at yahoo dot com</strong>
   <a href="#73239" class="date">14-Feb-2007 01:22</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Unfortunately, none of the procedures described here by other users to catch all errors work.<br />
<br />
Then again this would be impossible as parse errors are triggered before the code is interpreted and executed so no code solution is possible (just as the documentation says).<br />
<br />
You can test them easily against this simple code:<br />
<br />
some_function_that_doesnt_exist();<br />
<br />
using it in this form will trigger a Fatal Error (call to undefined function), which can't be caught by using your custom defined handler but *can* be caught by using the solutions presented by other programmers.<br />
<br />
if you remove the ; from the end will trigger a Parse Error (syntax error), which *can't* be caught by any of these solutions. If this called is however places as the last line of code, just before the ?&gt; then it will again generate a Fatal Error (call to undefined function).<br />
<br />
if you further remove the () then you'll get a Notice (undefined constant) which can be caught by the manual method of defining a custom error handler.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="70702""></a>
  <div class="note">
   <strong class="user">mail at chernousov dot com</strong>
   <a href="#70702" class="date">24-Oct-2006 12:52</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
When fatal error occurs, class destructors are not executed.<br />
<br />
&lt;?<br />
<br />
class someClass {<br />
&nbsp; function __construct() {<br />
&nbsp;&nbsp;&nbsp; echo '__construct()';<br />
&nbsp; }<br />
<br />
&nbsp; function __destruct() {<br />
&nbsp;&nbsp;&nbsp; echo '__destruct()';<br />
&nbsp; }<br />
}<br />
<br />
$someClass = new someClass();<br />
someNonExistentFunction();<br />
<br />
?&gt;<br />
<br />
Result will be:<br />
<br />
__construct()<br />
Fatal error: Call to undefined function someNonExistentFunction() in tes.php on line 14</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="70066""></a>
  <div class="note">
   <strong class="user">alexey.kupershtokh.gmail</strong>
   <a href="#70066" class="date">02-Oct-2006 09:07</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
2errd<br />
I've got more convenient and safe error to exception converter:<br />
<br />
class CustomException extends Exception { <br />
&nbsp; public static function errorHandlerCallback($code, $string, $file, $line, $context) {<br />
&nbsp;&nbsp;&nbsp; $e = new self($string, $code);<br />
&nbsp;&nbsp;&nbsp; $e-&gt;line = $line;<br />
&nbsp;&nbsp;&nbsp; $e-&gt;file = $file;<br />
&nbsp;&nbsp;&nbsp; throw $e;<br />
&nbsp; }<br />
} <br />
set_error_handler(array("CustomException", "errorHandlerCallback"), E_ALL);</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="69218""></a>
  <div class="note">
   <strong class="user">dk at brightbyte dot de</strong>
   <a href="#69218" class="date">28-Aug-2006 01:09</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Sometimes, you want to "catch" only some errors, and let the default handler deal with the result. I just found out that (at least in PHP 5), the default handler will be called if you return false (not 0 or NULL or '', but false) from your custom handler. This allows for "chaining" handlers.<br />
<br />
The fature was suggested in this thread:<br />
<a href="http://www.zend.com/lists/php-dev/200405/msg00491.html - the initial suggestion was to call the default handler if true is returned, but this was changed later on, apperently." rel="nofollow" target="_blank">http://www.zend.com/lists/php-dev/200405/msg00491.html - the initial suggestion was to call the default handler if true is returned, but this was changed later on, apperently.</a></span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="68470""></a>
  <div class="note">
   <strong class="user">jla</strong>
   <a href="#68470" class="date">28-Jul-2006 01:16</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Other option to "handle" ALL errors<br />
<br />
set_error_handler("yourHandler");<br />
<br />
// Parse,Compile, Core, etc... Errors<br />
ini_set('html_errors',false);<br />
ini_set('error_prepend_string','&lt;html&gt;&lt;head&gt;&lt;META http-equiv="refresh" content="0;URL=/error.php?msg=');<br />
ini_set('error_append_string','"&gt;&lt;/head&gt;&lt;/html&gt;');</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="65805""></a>
  <div class="note">
   <strong class="user">kariedoo</strong>
   <a href="#65805" class="date">08-May-2006 10:07</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
function errorlog($type, $info, $file, $row)<br />
{<br />
&nbsp;&nbsp; if ($handle = fopen("./log/ftp_error.log", "a")) <br />
&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp;&nbsp; @fwrite($handle, date("Y-m-d H:i:s")." "--&gt; $type: $info FILE: $file -&nbsp; Row $row\r\n" );<br />
&nbsp;&nbsp; &nbsp;&nbsp; @fclose($handle);<br />
&nbsp;&nbsp; }//end if<br />
}//end function<br />
<br />
### in the error logging code for example ftp: ###<br />
<br />
set_error_handler("errorlog");&nbsp; //set your own Handler<br />
&nbsp;<br />
$this-&gt;connect = ftp_connect(TXTCONNECT);<br />
$this-&gt;login = ftp_login($this-&gt;connect, TXTID, FTPPASS);<br />
$this-&gt;systype= ftp_systype($this-&gt;connect);<br />
<br />
restore_error_handler(); //restore the old handler<br />
<br />
------------------<br />
content in file<br />
------------------<br />
<br />
2006-05-08 09:36:02 2: ftp_login(): Login incorrect. FILE: /html/cgi-bin/test/classes/ftp.class.php - Row 63</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="64023""></a>
  <div class="note">
   <strong class="user">docey</strong>
   <a href="#64023" class="date">05-Apr-2006 09:50</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
if you wan't to know the current error-handler<br />
set use something like this:<br />
<br />
$current_errorhandler = set_error_handler("myerrorhandler");<br />
restore_error_handler();<br />
<br />
this will set your custom error_handler and return<br />
the name of the previous set error handler. by <br />
calling restore_error_handler, you remove your <br />
custom error_handler and set the error_handler that<br />
was set back again.<br />
<br />
this way you can also switch back to php-default error-handler <br />
without knowing how many error-handler already <br />
are set, by using a loop till an empty string is <br />
returned. because an empty string means <br />
"no error-handler set" wich means php's default <br />
errorhandler is set back. <br />
<br />
like in this code below:<br />
<br />
function restore_phperrorhandler()<br />
{<br />
&nbsp;// get current error handler.<br />
&nbsp;$previous_errorhandler = <br />
&nbsp;set_error_handler("myerrorhandler");<br />
&nbsp;restore_error_handler();<br />
<br />
&nbsp;$max_loops = 20;<br />
&nbsp;$cur_loops = 0;<br />
&nbsp;&nbsp; &nbsp; <br />
&nbsp;// if current error handler is not already php's or fails.<br />
&nbsp;&nbsp;&nbsp; if(($previous_errorhandler != NULL) OR <br />
&nbsp;&nbsp; &nbsp;&nbsp; ($previous_errorhandler != "")){<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; while($previous_errorhandler != ""){<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; $cur_loops = $cur_loops + 1;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; // check if not exceeding infinit loop.<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if($cur_loops &gt;= $max_loops){<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; trigger_error("Restoring exceeds max. loops.",<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; E_USER_WARNING);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; return false;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; //switch to previous handler.<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; restore_error_handler();<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; // get its name and switch to it again.<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $previous_errorhandler = <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; set_error_handler("myerrorhandler");<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; restore_error_handler();<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; // check if getting errorhandler failed.<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if($previous_errorhandler == NULL){<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; trigger_error("Failed to get prev. error handler",<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; E_USER_WARNING);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return false;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; // empty string = php-default error handler<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }elseif($previous_errorhandler == ""){<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; return true;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; }else{<br />
&nbsp;&nbsp; &nbsp;&nbsp; trigger_error("Current Error-Handler is default.",<br />
&nbsp;&nbsp; &nbsp;&nbsp; E_USER_NOTICE);<br />
&nbsp;&nbsp; &nbsp; return true;<br />
&nbsp;&nbsp;&nbsp; }<br />
}<br />
<br />
this function will loop and return true when no <br />
error handler is left. leaving php-default handler<br />
in controll again. this is usefull if you want to<br />
disable your own error-handler but be sure that<br />
php's is handling your error's and not any other <br />
error-handler.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="61289""></a>
  <div class="note">
   <strong class="user">errd</strong>
   <a href="#61289" class="date">30-Jan-2006 02:52</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
In errors to exceptions conversion below I found some incorrect stuff. File and line properties of Exception point to line and file where Exception is thrown, but not where real error is occured.<br />
<br />
Impoved errors to exceptions converting:<br />
+ Fixed filename of exception handled<br />
+ Fixed code line of exception handled<br />
<br />
<span class="default">&lt;?php <br />
<br />
</span><span class="keyword">class </span><span class="default">CustomException </span><span class="keyword">extends </span><span class="default">Exception </span><span class="keyword">{ <br />
&nbsp;&nbsp;&nbsp; public function </span><span class="default">setLine</span><span class="keyword">(</span><span class="default">$line</span><span class="keyword">) {&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">line</span><span class="keyword">=</span><span class="default">$line</span><span class="keyword">; <br />
&nbsp;&nbsp;&nbsp; } <br />
&nbsp;&nbsp; &nbsp; <br />
&nbsp;&nbsp;&nbsp; public function </span><span class="default">setFile</span><span class="keyword">(</span><span class="default">$file</span><span class="keyword">) { <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">file</span><span class="keyword">=</span><span class="default">$file</span><span class="keyword">; <br />
&nbsp;&nbsp;&nbsp; } <br />
} <br />
<br />
function </span><span class="default">exceptionsHandler</span><span class="keyword">(</span><span class="default">$code</span><span class="keyword">, </span><span class="default">$string</span><span class="keyword">, </span><span class="default">$file</span><span class="keyword">, </span><span class="default">$line</span><span class="keyword">) {&nbsp; <br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$exception</span><span class="keyword">=new </span><span class="default">CustomException</span><span class="keyword">(</span><span class="default">$string</span><span class="keyword">, </span><span class="default">$code</span><span class="keyword">); <br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$exception</span><span class="keyword">-&gt;</span><span class="default">setLine</span><span class="keyword">(</span><span class="default">$line</span><span class="keyword">); <br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$exception</span><span class="keyword">-&gt;</span><span class="default">setFile</span><span class="keyword">(</span><span class="default">$file</span><span class="keyword">); <br />
&nbsp;&nbsp;&nbsp; throw </span><span class="default">$exception</span><span class="keyword">; <br />
}&nbsp; <br />
<br />
</span><span class="default">set_error_handler</span><span class="keyword">(</span><span class="string">'exceptionsHandler'</span><span class="keyword">, </span><span class="default">E_ALL</span><span class="keyword">); <br />
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="61043""></a>
  <div class="note">
   
   <a href="#61043" class="date">24-Jan-2006 10:19</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
To honor the value of PHP's error_reporting() function, use:<br />
<br />
&lt;?<br />
&nbsp; if( ($level &amp; error_reporting()) == 0 ) return;<br />
?&gt;</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="60394""></a>
  <div class="note">
   <strong class="user">Gulopine</strong>
   <a href="#60394" class="date">05-Jan-2006 06:36</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Also note that even though the documentation states "errcontext will contain an array of every variable that existed in the scope the error was triggered in," that is not the case for $this in an instantiated object, as of PHP 5.1.1.<br />
<br />
<span class="default">&lt;?php<br />
<br />
</span><span class="keyword">function </span><span class="default">error_function</span><span class="keyword">(</span><span class="default">$errno</span><span class="keyword">, </span><span class="default">$errstr</span><span class="keyword">, </span><span class="default">$errfile</span><span class="keyword">, </span><span class="default">$errline</span><span class="keyword">, </span><span class="default">$errcontext</span><span class="keyword">) {<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">print_r</span><span class="keyword">(</span><span class="default">$errcontext</span><span class="keyword">);<br />
}<br />
<br />
</span><span class="default">set_error_handler</span><span class="keyword">(</span><span class="string">'error_function'</span><span class="keyword">);<br />
<br />
class </span><span class="default">test_class </span><span class="keyword">{<br />
&nbsp;&nbsp;&nbsp; private </span><span class="default">$id</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; function </span><span class="default">__construct</span><span class="keyword">(</span><span class="default">$id</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">id </span><span class="keyword">= </span><span class="default">$id</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">trigger_error</span><span class="keyword">(</span><span class="string">'Test error'</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; }<br />
}<br />
<br />
</span><span class="default">$test </span><span class="keyword">= new </span><span class="default">test_class</span><span class="keyword">(</span><span class="default">5</span><span class="keyword">);<br />
<br />
</span><span class="default">?&gt;<br />
</span><br />
Result:<br />
<br />
Array<br />
(<br />
&nbsp;&nbsp;&nbsp; [id] =&gt; 5<br />
)<br />
<br />
I discovered this when trying to write an error handler that would log the class the error occured in, as it was triggered from a function in a parent class extended by several individual classes.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="57045""></a>
  <div class="note">
   <strong class="user">ia [AT] zoznam [DOT] sk</strong>
   <a href="#57045" class="date">22-Sep-2005 01:33</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
as reply to dawiddr at gmail dot com:<br />
<br />
Be careful with this when using __autoload(). When there is some error during parsing the file included in __autoload() so an exception is thrown, it results in following error:<br />
<br />
Fatal error:&nbsp; Function __autoload(ClassName) threw an exception of type 'Exception' in /network/webroot/dev/test.php on line 121<br />
<br />
It is because exceptions can't be thrown in __autoload().<br />
See __autoload() documentation (<a href="http://www.php.net/autoload" rel="nofollow" target="_blank">http://www.php.net/autoload</a>) and bug #31102 (<a href="http://bugs.php.net/bug.php?id=31102&amp;edit=3" rel="nofollow" target="_blank">http://bugs.php.net/bug.php?id=31102&amp;edit=3</a>)</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="56073""></a>
  <div class="note">
   <strong class="user">florian at siweho dot de</strong>
   <a href="#56073" class="date">22-Aug-2005 09:26</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
@ mmtache at yahoo dot com<br />
you have to use<br />
if(error_reporting() != 0){<br />
&nbsp;&nbsp; .... (yourOwnHandler)<br />
<br />
instead of<br />
if(error_reporting()){<br />
&nbsp;&nbsp; ....<br />
<br />
in PHP5. then operations like this "@fopen" won't show an error-message</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="55409""></a>
  <div class="note">
   <strong class="user">eregon at eregon dot info</strong>
   <a href="#55409" class="date">02-Aug-2005 06:35</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
It is not possible to handle fatal errors with own handler. Even if you have set your own handler, fatal error will be always handled by PHP's default handler. The reason is the script may be in unstable state after fatal error occurence (details here: <a href="http://marc.theaimsgroup.com/?l=php-dev&amp;m=97673386418430&amp;w=2" rel="nofollow" target="_blank">http://marc.theaimsgroup.com/?l=php-dev&amp;m=97673386418430&amp;w=2</a>).</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="54482""></a>
  <div class="note">
   <strong class="user">dawiddr at gmail dot com</strong>
   <a href="#54482" class="date">06-Jul-2005 01:01</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
In PHP5, if you want to have exceptions thrown instead of normal errors - you could use an error handler, which throw exceptions:<br />
<br />
<span class="default">&lt;?php<br />
<br />
</span><span class="keyword">function </span><span class="default">handler</span><span class="keyword">(</span><span class="default">$errno</span><span class="keyword">, </span><span class="default">$errstr</span><span class="keyword">, </span><span class="default">$errfile</span><span class="keyword">, </span><span class="default">$errline</span><span class="keyword">) <br />
{<br />
&nbsp;&nbsp;&nbsp; print </span><span class="string">"Error handled!\n"</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; throw new </span><span class="default">Exception</span><span class="keyword">(</span><span class="default">$errstr</span><span class="keyword">, </span><span class="default">$errno</span><span class="keyword">);<br />
}<br />
<br />
</span><span class="default">set_error_handler</span><span class="keyword">(</span><span class="string">'handler'</span><span class="keyword">);<br />
<br />
try<br />
{<br />
&nbsp;&nbsp;&nbsp; print </span><span class="default">2 </span><span class="keyword">/ </span><span class="default">0</span><span class="keyword">; </span><span class="comment">// simple error - division by zero<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">print </span><span class="string">"This will never be printed"</span><span class="keyword">;<br />
}<br />
catch (</span><span class="default">Exception $e</span><span class="keyword">)<br />
{<br />
&nbsp;&nbsp;&nbsp; print </span><span class="string">"Exception catched:\n"</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; print </span><span class="string">"Code: "</span><span class="keyword">.</span><span class="default">$e</span><span class="keyword">-&gt;</span><span class="default">getCode</span><span class="keyword">().</span><span class="string">"\n"</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; print </span><span class="string">"Message: "</span><span class="keyword">.</span><span class="default">$e</span><span class="keyword">-&gt;</span><span class="default">getMessage</span><span class="keyword">().</span><span class="string">"\n"</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; print </span><span class="string">"Line: "</span><span class="keyword">.</span><span class="default">$e</span><span class="keyword">-&gt;</span><span class="default">getLine</span><span class="keyword">();<br />
}<br />
<br />
</span><span class="default">?&gt;<br />
</span><br />
Result:<br />
<br />
Error handled!<br />
Exception catched:<br />
Code: 2<br />
Message: Division by zero<br />
Line: 6<br />
<br />
As you see, exception is catched like it have been thrown by division by zero - in try/catch clause. But line numer and backtrace shows, that is was thrown by the error handler.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="53426""></a>
  <div class="note">
   <strong class="user">frank at ethisoft dot nl</strong>
   <a href="#53426" class="date">01-Jun-2005 12:11</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Perhaps it is worth mentioning that in <br />
PHP5 <br />
both set_error_handler &amp; set_exception_handler can be called with an array containing 2 arguments:<br />
1) var&nbsp; ==&gt; object<br />
2) string ==&gt; name of handler function in object<br />
<br />
EXAMPLE:<br />
<span class="default">&lt;?php<br />
set_error_handler&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">(array(</span><span class="default">$object</span><span class="keyword">, </span><span class="string">'handler_function'</span><span class="keyword">));<br />
</span><span class="default">set_exception_handler&nbsp; &nbsp; &nbsp; </span><span class="keyword">(array(</span><span class="default">$object</span><span class="keyword">, </span><span class="string">'handler_function'</span><span class="keyword">));<br />
</span><span class="default">?&gt;<br />
</span><br />
Both can point to the same object and handler_function so that both error and exception handling, which are very much alike usually, can be done by only 1 dedicated class.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="51291""></a>
  <div class="note">
   <strong class="user">jgiglio at netmar dot com</strong>
   <a href="#51291" class="date">26-Mar-2005 05:02</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
set_error_handler also overrides the default behavior of postgresql which is to shoot HTML errors to the browser on a query failure or other database error.<br />
<br />
I can't find a list of symbolic $errno names for postgres errors, but a normal "bad query" throws an errno of 2.<br />
<br />
Be careful to not use an empty default case in your errno case statement if you use postgresql, and expect php to generate DB errors automatically.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="48933""></a>
  <div class="note">
   <strong class="user">Steffen Staehle</strong>
   <a href="#48933" class="date">12-Jan-2005 11:29</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Two notes on using set_error_handler() on behaviour that I noticed when migrating an application from php 4.2.1 to php 4.3.9 (I do not yet have php 5.0 available, this might not apply there!).<br />
<br />
1. setting the system error handler<br />
<br />
If you want to set the standard php error handler again, after having set your own error handler, this works in php 4.2.1 by passing in an empty string:<br />
<br />
<span class="default">&lt;?php<br />
<br />
&nbsp;&nbsp; </span><span class="keyword">function </span><span class="default">my_handler</span><span class="keyword">(</span><span class="default">$log_level</span><span class="keyword">, </span><span class="default">$log_text</span><span class="keyword">, </span><span class="default">$error_file</span><span class="keyword">, </span><span class="default">$error_line</span><span class="keyword">)<br />
&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="comment">// if an error occurs here, the standard error<br />
&nbsp;&nbsp; &nbsp;&nbsp; // would be called (to avoid recursion)<br />
<br />
&nbsp;&nbsp; &nbsp;&nbsp; // do something useful<br />
&nbsp;&nbsp; &nbsp;&nbsp; // ...<br />
&nbsp;&nbsp; </span><span class="keyword">}<br />
<br />
&nbsp;&nbsp; </span><span class="default">$last_handler </span><span class="keyword">= </span><span class="default">set_error_handler</span><span class="keyword">(</span><span class="string">"my_handler"</span><span class="keyword">);<br />
<br />
&nbsp;&nbsp; </span><span class="comment">// after this, $last_handler == ""<br />
<br />
&nbsp;&nbsp; // restore standard error handler<br />
<br />
&nbsp;&nbsp; </span><span class="default">$last_handler </span><span class="keyword">= </span><span class="default">set_error_handler</span><span class="keyword">(</span><span class="string">""</span><span class="keyword">);<br />
<br />
&nbsp;&nbsp; </span><span class="comment">// after this, $last_handler == "my_handler"<br />
<br />
</span><span class="default">?&gt;<br />
</span><br />
The very same code now raises an error in php 4.3.9:<br />
<br />
&nbsp;&nbsp; set_error_handler() expects argument 1, '', to be a valid callback<br />
<br />
(Since the return value of the first call to set_error_handler() is still the empty string "", I don't see how this can be done any more. I don't really need this, because I use my own handlers as shown below, but it might be good to be aware of this.)<br />
<br />
2. setting your own 'second level' handler<br />
<br />
If you have set your own error handler, and want to replace it by another one (other than the standard php error handler) while it is being executed, note that the return value of set_error_handler when used INSIDE the error handler is "" instead of the name of the previous handler! This is not too surprising, because during execution of your self defined error handler, php replaces it with the standard php error handler to avoid infinite loops in case of problems inside the handler. This is only interesting if you want nested handlers as I do. Background of my design:<br />
<br />
&nbsp;&nbsp; 1st level handler: log into DB<br />
&nbsp;&nbsp; 2nd level handler: log into flat file (if log into DB fails)<br />
&nbsp;&nbsp; 3rd level handler: print to stdout (if log into flat file fails) (this is the sytem handler, finally).<br />
<br />
<span class="default">&lt;?php<br />
<br />
&nbsp;&nbsp; </span><span class="keyword">function </span><span class="default">my_fallback_handler</span><span class="keyword">(</span><span class="default">$log_level</span><span class="keyword">, </span><span class="default">$log_text</span><span class="keyword">, </span><span class="default">$error_file</span><span class="keyword">, </span><span class="default">$error_line</span><span class="keyword">)<br />
&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="comment">// if an error occurs here, the standard error<br />
&nbsp;&nbsp; &nbsp;&nbsp; // would be called (to avoid recursion)<br />
<br />
&nbsp;&nbsp; &nbsp;&nbsp; // do something useful<br />
&nbsp;&nbsp; &nbsp;&nbsp; // ...<br />
<br />
&nbsp;&nbsp; </span><span class="keyword">} </span><span class="comment">// my_fallback_handler<br />
<br />
&nbsp;&nbsp; </span><span class="keyword">function </span><span class="default">my_handler</span><span class="keyword">(</span><span class="default">$log_level</span><span class="keyword">, </span><span class="default">$log_text</span><span class="keyword">, </span><span class="default">$error_file</span><span class="keyword">, </span><span class="default">$error_line</span><span class="keyword">)<br />
&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="comment">// if an error occurs here, the standard error<br />
&nbsp;&nbsp; &nbsp;&nbsp; // would be called (to avoid recursion)<br />
<br />
&nbsp;&nbsp; &nbsp;&nbsp; // but we want to have a fallback handler different<br />
&nbsp;&nbsp; &nbsp;&nbsp; // to the standard error handler<br />
<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="default">$last_handler </span><span class="keyword">= </span><span class="default">set_error_handler</span><span class="keyword">(</span><span class="string">"my_fallback_handler"</span><span class="keyword">);<br />
<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="comment">// I expected $last_handler == "my_handler" <br />
&nbsp;&nbsp; &nbsp;&nbsp; // (which it would outside my_handler())<br />
&nbsp;&nbsp; &nbsp;&nbsp; // but here it is the empty string ""<br />
<br />
&nbsp;&nbsp; &nbsp;&nbsp; // do something useful<br />
&nbsp;&nbsp; &nbsp;&nbsp; // ...<br />
<br />
&nbsp;&nbsp; &nbsp;&nbsp; // now set the 1st level handler again:<br />
&nbsp;&nbsp; &nbsp;&nbsp; // (do NOT use $last_handler as argument,<br />
&nbsp;&nbsp; &nbsp;&nbsp; // because it equals "")<br />
<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="default">$last_handler </span><span class="keyword">= </span><span class="default">set_error_handler</span><span class="keyword">(</span><span class="string">"my_handler"</span><span class="keyword">);<br />
<br />
&nbsp;&nbsp; } </span><span class="comment">// my_handler<br />
<br />
&nbsp;&nbsp; </span><span class="default">$last_handler </span><span class="keyword">= </span><span class="default">set_error_handler</span><span class="keyword">(</span><span class="string">"my_handler"</span><span class="keyword">);<br />
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="44594""></a>
  <div class="note">
   <strong class="user">Sukender</strong>
   <a href="#44594" class="date">10-Aug-2004 05:29</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
In PHP5, ou can ask for the default handler to be called after your custom handler by returning "false". See this pseudo-code :<br />
&lt;?<br />
function MyHandler($errno, $errstr, $errfile, $errline, $errcontext) {<br />
&nbsp;&nbsp;&nbsp; my_handling_code;&nbsp; &nbsp; &nbsp; &nbsp; // Do something, such as sending an email to the admin<br />
&nbsp;&nbsp;&nbsp; if (i_want_to_call_the_default_handler) return false;&nbsp; &nbsp; &nbsp; &nbsp; // will invoke the default error handler just after<br />
&nbsp;&nbsp;&nbsp; else return true;&nbsp; &nbsp; &nbsp; &nbsp; // This will NOT invoke it (= you've properly handled the error)<br />
}<br />
set_error_handler("MyHandler");<br />
?&gt;<br />
<br />
I have not tested the functionality, but I think that the php.ini directive "log_errors" keeps working, but *only* when you call the default handler (= retrun false).<br />
<br />
&gt;&gt;&gt; Source : Mailing list thread about "re-invoking default error handler" at <a href="http://www.zend.com/lists/php-dev/200405/msg00491.html (be careful about the first post : " rel="nofollow" target="_blank">http://www.zend.com/lists/php-dev/200405/msg00491.html (be careful about the first post : </a>"true" and "false" are switched - because it's only a proposition).</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="43674""></a>
  <div class="note">
   <strong class="user">Joe</strong>
   <a href="#43674" class="date">30-Jun-2004 07:26</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
When a custom error handler is set, the php.ini directive "log_errors" stops working.&nbsp; I'm guessing to favor your custom handler.&nbsp; You can still log your errors with the "error_log" function, but it doesn't happen when you have a custom error handler.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="41784""></a>
  <div class="note">
   <strong class="user">Cezary Tomczak</strong>
   <a href="#41784" class="date">22-Apr-2004 10:25</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Here is a script to debug / display errors in a nice way: <a href="http://gosu.pl/demo/ErrorHandler/ErrorHandler.zip" rel="nofollow" target="_blank">http://gosu.pl/demo/ErrorHandler/ErrorHandler.zip</a><br />
<br />
Example of displaying an error: <a href="http://gosu.pl/demo/ErrorHandler/example1.html" rel="nofollow" target="_blank">http://gosu.pl/demo/ErrorHandler/example1.html</a><br />
Example of displaying source of the file where the error appeared: <a href="http://gosu.pl/demo/ErrorHandler/example2.html" rel="nofollow" target="_blank">http://gosu.pl/demo/ErrorHandler/example2.html</a><br />
<br />
Displaying error: generates a backtrace, show file / line, show function / arguments (and values), source of the file</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="41672""></a>
  <div class="note">
   <strong class="user">erwin at isiz dot nl</strong>
   <a href="#41672" class="date">19-Apr-2004 03:51</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
@sijmen at digitized dot nl<br />
That's not true. The reference operator does have effect, when used correctly.<br />
<br />
Your code doesn't use the reference operator in the set_error_handler function, but it does when creating the new error object. In your case, you have to use the reference operator two times.<br />
<br />
When calling the set_error_handler function<br />
<br />
<span class="default">&lt;?php<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; set_error_handler</span><span class="keyword">(array(&amp;</span><span class="default">$this</span><span class="keyword">, </span><span class="string">'handler'</span><span class="keyword">));<br />
</span><span class="default">?&gt;<br />
</span><br />
and when creating the class<br />
<br />
<span class="default">&lt;?php<br />
$eh </span><span class="keyword">= &amp;new </span><span class="default">error</span><span class="keyword">;<br />
</span><span class="default">?&gt;<br />
</span><br />
In that case the same error class will be used and the output will be following:<br />
Error! <br />
!!<br />
<br />
Hope this helps.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="41497""></a>
  <div class="note">
   <strong class="user">mightye (at) mightye (dot) org</strong>
   <a href="#41497" class="date">12-Apr-2004 11:18</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
You can't use this functionality to catch parse errors in included, required, or eval()'d code.&nbsp; Parse errors seem to exist on a deeper level.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="41423""></a>
  <div class="note">
   <strong class="user">sijmen at digitized dot nl</strong>
   <a href="#41423" class="date">09-Apr-2004 04:47</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
@jayp at groovejob dot com<br />
As I said before, the reference operator doesn't have any effect on the the error handler. <br />
<br />
Proof of concepts:<br />
<a href="http://trouby.digitized.nl/set_error_handler2.php" rel="nofollow" target="_blank">http://trouby.digitized.nl/set_error_handler2.php</a><br />
<a href="http://trouby.digitized.nl/set_error_handler2.php?source=1" rel="nofollow" target="_blank">http://trouby.digitized.nl/set_error_handler2.php?source=1</a></span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="41232""></a>
  <div class="note">
   <strong class="user">jayp at groovejob dot com</strong>
   <a href="#41232" class="date">03-Apr-2004 06:28</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
In response to sijmen at digitized dot nl:<br />
<br />
Instead of <br />
<br />
$eh = new error;<br />
<br />
use<br />
<br />
$eh =&amp; new error();<br />
<br />
The new operator returns a copy of the error object, so the error handler that is set in the constructor is tied to a different object instance than the instance returned by "new".&nbsp; To make sure you are working with the exact same object instance that you think you are, it's best to use the reference object when creating instances of objects, like so:<br />
<br />
$oMyObject =&amp; new MyObject();<br />
<br />
HTH,<br />
<br />
Jay</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="41108""></a>
  <div class="note">
   <strong class="user">sijmen at digitized dot nl</strong>
   <a href="#41108" class="date">30-Mar-2004 04:23</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
@skyrl at free dot fr<br />
It seems that the reference operator '&amp;' doesn't have any effect. That's why I submitted the comment. <br />
<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">class </span><span class="default">error </span><span class="keyword">{<br />
&nbsp;&nbsp;&nbsp; var </span><span class="default">$error</span><span class="keyword">;<br />
<br />
&nbsp;&nbsp;&nbsp; function </span><span class="default">error</span><span class="keyword">() {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">setIni</span><span class="keyword">();<br />
&nbsp;&nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp;&nbsp; function </span><span class="default">handler</span><span class="keyword">() {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; echo </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">error</span><span class="keyword">.</span><span class="string">'!!'</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp;&nbsp; function </span><span class="default">setText</span><span class="keyword">(</span><span class="default">$text</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">error </span><span class="keyword">= </span><span class="default">$text</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp;&nbsp; function </span><span class="default">setIni</span><span class="keyword">() {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">set_error_handler</span><span class="keyword">(array(&amp;</span><span class="default">$this</span><span class="keyword">, </span><span class="string">'handler'</span><span class="keyword">)); </span><span class="comment">// The '&amp;' operator doesn't have any effect<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">}<br />
}<br />
<br />
</span><span class="default">$eh </span><span class="keyword">= new </span><span class="default">error</span><span class="keyword">;<br />
</span><span class="default">$eh</span><span class="keyword">-&gt;</span><span class="default">setText</span><span class="keyword">(</span><span class="string">'Error! &lt;br&gt;'</span><span class="keyword">); </span><span class="comment">// Will not get set<br />
<br />
</span><span class="default">trigger_error</span><span class="keyword">(</span><span class="string">'text'</span><span class="keyword">, </span><span class="default">E_USER_ERROR</span><span class="keyword">); </span><span class="comment">// prints '!!'<br />
</span><span class="default">?&gt;<br />
</span><br />
Proof of concept<br />
<a href="http://trouby.digitized.nl/set_error_handler.php" rel="nofollow" target="_blank">http://trouby.digitized.nl/set_error_handler.php</a><br />
<a href="http://trouby.digitized.nl/set_error_handler.php?source=1" rel="nofollow" target="_blank">http://trouby.digitized.nl/set_error_handler.php?source=1</a></span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="41091""></a>
  <div class="note">
   <strong class="user">skyrl at free dot fr</strong>
   <a href="#41091" class="date">30-Mar-2004 04:00</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
in reaction to the last '29-Mar-2004 11:13' post, just have to say that's normal the values are not "saved" in your error handler object. because the error object of the handler is not the same object as the one you instantiate...<br />
<br />
You have to write set_error_handler(array(&amp;this, 'my_error_handler')). The &amp; is important for php to know that your error handler belongs to the same instance you allocate.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="41085""></a>
  <div class="note">
   
   <a href="#41085" class="date">30-Mar-2004 01:13</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
It seems that when you're letting PHP know that you have a custom&nbsp; error handler, you're not able to -update/set new- variables inside the class. Example:
<br />

<br />
<span class="default">&lt;?php
<br />
</span><span class="keyword">class </span><span class="default">error </span><span class="keyword">{
<br />
&nbsp;&nbsp; var </span><span class="default">$error</span><span class="keyword">;
<br />

<br />
&nbsp;&nbsp; function </span><span class="default">error</span><span class="keyword">() {
<br />
&nbsp;&nbsp; &nbsp; &nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">setIni</span><span class="keyword">();&nbsp; &nbsp; </span><span class="comment">// this causes PHP to ignore all other changes to the class.
<br />
&nbsp;&nbsp; </span><span class="keyword">}
<br />

<br />
&nbsp;&nbsp; function </span><span class="default">handler</span><span class="keyword">() {
<br />
&nbsp;&nbsp; &nbsp; &nbsp; echo </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">error</span><span class="keyword">.</span><span class="string">'!!'</span><span class="keyword">;
<br />
&nbsp;&nbsp; }
<br />

<br />
&nbsp;&nbsp; function </span><span class="default">setText</span><span class="keyword">(</span><span class="default">$text</span><span class="keyword">) {
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">error </span><span class="keyword">= </span><span class="default">$text</span><span class="keyword">;
<br />
&nbsp;&nbsp; }
<br />

<br />
&nbsp;&nbsp; function </span><span class="default">setIni</span><span class="keyword">() {
<br />
&nbsp;&nbsp; &nbsp; &nbsp; </span><span class="default">set_error_handler</span><span class="keyword">(array(</span><span class="default">$this</span><span class="keyword">, </span><span class="string">'handler'</span><span class="keyword">));
<br />
&nbsp;&nbsp; }
<br />
}
<br />

<br />
</span><span class="default">$eh </span><span class="keyword">= new </span><span class="default">error</span><span class="keyword">;
<br />
</span><span class="default">$eh</span><span class="keyword">-&gt;</span><span class="default">setText</span><span class="keyword">(</span><span class="string">'Error! &lt;br&gt;'</span><span class="keyword">);&nbsp; </span><span class="comment">// this will not be saved
<br />

<br />
</span><span class="default">trigger_error</span><span class="keyword">(</span><span class="string">'text'</span><span class="keyword">, </span><span class="default">E_USER_ERROR</span><span class="keyword">);
<br />
</span><span class="comment">// prints '!!'
<br />
</span><span class="default">?&gt;
<br />
</span>
<br />
How it should be done:
<br />
<span class="default">&lt;?php
<br />
</span><span class="keyword">class </span><span class="default">error </span><span class="keyword">{
<br />
&nbsp;&nbsp; var </span><span class="default">$error</span><span class="keyword">;
<br />

<br />
&nbsp;&nbsp; function </span><span class="default">error</span><span class="keyword">() {
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="comment">// dont let PHP know of our error handler yet
<br />
&nbsp;&nbsp; </span><span class="keyword">}
<br />

<br />
&nbsp;&nbsp; function </span><span class="default">handler</span><span class="keyword">() {
<br />
&nbsp;&nbsp; &nbsp; &nbsp; echo </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">error</span><span class="keyword">.</span><span class="string">'!!'</span><span class="keyword">;
<br />
&nbsp;&nbsp; }
<br />

<br />
&nbsp;&nbsp; function </span><span class="default">setText</span><span class="keyword">(</span><span class="default">$text</span><span class="keyword">) {
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">error </span><span class="keyword">= </span><span class="default">$text</span><span class="keyword">;
<br />
&nbsp;&nbsp; }
<br />

<br />
&nbsp;&nbsp; function </span><span class="default">setIni</span><span class="keyword">() {
<br />
&nbsp;&nbsp; &nbsp; &nbsp; </span><span class="default">set_error_handler</span><span class="keyword">(array(</span><span class="default">$this</span><span class="keyword">, </span><span class="string">'handler'</span><span class="keyword">));
<br />
&nbsp;&nbsp; }
<br />
}
<br />

<br />
</span><span class="default">$eh </span><span class="keyword">= new </span><span class="default">error</span><span class="keyword">;
<br />
</span><span class="default">$eh</span><span class="keyword">-&gt;</span><span class="default">setText</span><span class="keyword">(</span><span class="string">'Error! &lt;br&gt;'</span><span class="keyword">);&nbsp; </span><span class="comment">// this WILL work
<br />
</span><span class="default">$eh</span><span class="keyword">-&gt;</span><span class="default">setIni</span><span class="keyword">();&nbsp; </span><span class="comment">// call this method when you're ready with configuring the class. All other methods that will be called will have no effect on the errorHandling by PHP
<br />

<br />
</span><span class="default">trigger_error</span><span class="keyword">(</span><span class="string">'text'</span><span class="keyword">, </span><span class="default">E_USER_ERROR</span><span class="keyword">);
<br />
</span><span class="comment">// prints 'Error! &lt;br&gt;!!'
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="37459""></a>
  <div class="note">
   <strong class="user">phpmanual at NO_SPHAMnetebb dot com</strong>
   <a href="#37459" class="date">16-Nov-2003 05:19</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Given this code:<br />
<br />
class CallbackClass {<br />
&nbsp;&nbsp;&nbsp; function CallbackFunction() {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; // refers to $this<br />
&nbsp;&nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp;&nbsp; function StaticFunction() {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; // doesn't refer to $this<br />
&nbsp;&nbsp;&nbsp; }<br />
}<br />
<br />
function NonClassFunction() {<br />
}<br />
<br />
there appear to be 3 ways to set a callback function in PHP (using set_error_handler() as an example):<br />
<br />
1: set_error_handler('NonClassFunction');<br />
<br />
2: set_error_handler(array('CallbackClass', 'StaticFunction'));<br />
<br />
3: $o =&amp; new CallbackClass();<br />
&nbsp;&nbsp; set_error_handler(array($o, 'CallbackFunction'));<br />
<br />
The following may also prove useful:<br />
<br />
class CallbackClass {<br />
&nbsp;&nbsp;&nbsp; function CallbackClass() {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; set_error_handler(array(&amp;$this, 'CallbackFunction')); // the &amp; is important<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; function CallbackFunction() {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; // refers to $this<br />
&nbsp;&nbsp;&nbsp; }<br />
}<br />
<br />
The documentation is not clear in outlining these three examples.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="30663""></a>
  <div class="note">
   <strong class="user">Thomas Staunton</strong>
   <a href="#30663" class="date">25-Mar-2003 01:11</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
The best way, I have found to use a class/object as an error handler is to define a class, add your desired error handling function into the constructor and then call set_error_handler() to the name of your function, thats it. e.g. <br />
<br />
Class Error {<br />
<br />
&nbsp; Function Error() {<br />
&nbsp;&nbsp;&nbsp; Function HandleError($n, $m, $f, $l){<br />
&nbsp;&nbsp; &nbsp;&nbsp; print_r(debug_backtrace());<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; set_error_handler('HandleError');<br />
&nbsp; }<br />
}</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="30230""></a>
  <div class="note">
   <strong class="user">bob at db dot org</strong>
   <a href="#30230" class="date">11-Mar-2003 10:09</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
The documentation on this page kindly offers the following on using (class) methods as error handlers:<br />
<br />
Note:&nbsp; Instead of a function name, an array containing an object reference and a method name can also be supplied. (Since PHP 4.3.0)<br />
<br />
Since that's all it says about the subject, I thought I'd offer a sample implementation to show how this can be used:<br />
<br />
<span class="default">&lt;?php<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">class </span><span class="default">error </span><span class="keyword">{<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; var </span><span class="default">$conf</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; var </span><span class="default">$lang</span><span class="keyword">;<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; function </span><span class="default">error</span><span class="keyword">(</span><span class="default">$conf</span><span class="keyword">, </span><span class="default">$lang</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">conf </span><span class="keyword">= </span><span class="default">$conf</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">lang </span><span class="keyword">= </span><span class="default">$lang</span><span class="keyword">;<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">set_error_handler</span><span class="keyword">(array(&amp;</span><span class="default">$this</span><span class="keyword">, </span><span class="string">'handler'</span><span class="keyword">));<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; function </span><span class="default">handler</span><span class="keyword">(</span><span class="default">$no</span><span class="keyword">, </span><span class="default">$str</span><span class="keyword">, </span><span class="default">$file</span><span class="keyword">, </span><span class="default">$line</span><span class="keyword">, </span><span class="default">$ctx</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; echo </span><span class="string">'&lt;pre&gt;'</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; echo </span><span class="string">'no&nbsp;&nbsp; : ' </span><span class="keyword">. </span><span class="default">$no </span><span class="keyword">. </span><span class="string">"\n"</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; echo </span><span class="string">'str&nbsp; : ' </span><span class="keyword">. </span><span class="default">$str </span><span class="keyword">. </span><span class="string">"\n"</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; echo </span><span class="string">'file : ' </span><span class="keyword">. </span><span class="default">$file </span><span class="keyword">. </span><span class="string">"\n"</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; echo </span><span class="string">'line : ' </span><span class="keyword">. </span><span class="default">$line </span><span class="keyword">. </span><span class="string">"\n"</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; echo </span><span class="string">'ctx&nbsp; : '</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">print_r</span><span class="keyword">(</span><span class="default">$ctx</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; echo </span><span class="string">'&lt;/pre&gt;'</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="29315""></a>
  <div class="note">
   <strong class="user">mmtache at yahoo dot com</strong>
   <a href="#29315" class="date">09-Feb-2003 10:06</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
The @ operator sets the error_reporting() value to 0.<br />
This means you can use it with your own Error Handler too. for example:<br />
<br />
function userErrorHandler($errno, $errmsg, $filename, $linenum, $vars) {<br />
&nbsp;&nbsp; if (error_reporting())<br />
echo $errmsg;<br />
&nbsp;&nbsp;&nbsp; }<br />
set_error_handler("userErrorHandler");<br />
<br />
function test(){<br />
trigger_error("Error Message", E_USER_WARNING);<br />
}<br />
<br />
@test(); // doesn't output anything</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="22282""></a>
  <div class="note">
   <strong class="user">roy</strong>
   <a href="#22282" class="date">13-Jun-2002 01:08</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Useful thing to note - if your error handler throws an error in itself, PHP is smart enough to use the deault error handler to handle it. This way, you don't end up in infinite flaming loops of death. This seems to be true, at least, in PHP 4.2. <br />
<br />
('Course, there are ways to create your handler to handle even this situation, but it's probably best left this way for general purposes.)</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="21932""></a>
  <div class="note">
   <strong class="user">publicmail at macfreek dot nl</strong>
   <a href="#21932" class="date">31-May-2002 06:34</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Note: If you have a custom error handler and use assert(), you MUST set:<br />
<br />
assert_options (ASSERT_WARNING, 0);<br />
<br />
Otherwise, no output whatsoever will ever be shown if an assert fails.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="19521""></a>
  <div class="note">
   <strong class="user">ned at wgtech dot com</strong>
   <a href="#19521" class="date">01-Mar-2002 08:52</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Just spent two days trying to find some method where a class can handle errors thrown at my convienience. After fighting with the pitfalls of this problem this is what I came up with. Hope it helps someone else save a little time. Its nice because all instances of this class will point to the same array that stores the errors.<br />
<br />
class ApplicationObject {<br />
&nbsp;&nbsp;&nbsp; var $error_List;<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; function ApplicationObject() {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; set_error_handler('trapError');<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $this-&gt;error_List = &amp;trapError();<br />
&nbsp;&nbsp;&nbsp; }<br />
<br />
}<br />
<br />
function &amp;trapError() {<br />
&nbsp;&nbsp;&nbsp; static $error_Vals = array();<br />
<br />
&nbsp;&nbsp;&nbsp; if (func_num_args()==5) { // Error Event has been passed<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $error_Vals[] = array(&nbsp; &nbsp; 'err_no' =&gt; func_get_arg(0), 'err_text' =&gt; func_get_arg(1), 'err_file' =&gt; func_get_arg(2), 'err_line' =&gt; func_get_arg(3), 'err_vars'=&gt;func_get_arg(4));<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; if (func_num_args()==0) { // Setup call. Return reference<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return $error_Vals;<br />
&nbsp;&nbsp;&nbsp; }<br />
}</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
</div>
</div>
</div></div></body></html>
