<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
 <head>
  <meta http-equiv="content-type" content="text/html; CHARSET=shift-jis">
  <title>MySQL クエリを送信する</title>

  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <link media="all" rel="stylesheet" type="text/css" href="style.css"/>
 </head>
 <body class="docs" class="docs"><div class="navbar navbar-fixed-top">
  <div class="navbar-inner clearfix">
    <ul class="nav" style="width: 100%">
      <li style="float: left;"><a href="function.mysql-ping.html">≪ mysql_ping</a></li>
      <li style="float: right;"><a href="function.mysql-real-escape-string.html">mysql_real_escape_string ≫</a></li>
    </ul>
  </div>
</div>
<div id="breadcrumbs" class="clearfix">
  <ul class="breadcrumbs-container">
    <li><a href="index.html">PHP Manual</a></li>
    <li><a href="ref.mysql.html">MySQL 関数</a></li>
    <li>MySQL クエリを送信する</li>
  </ul>
</div>
<div id="layout">
  <div id="layout-content"><div id="function.mysql-query" class="refentry">
 <div class="refnamediv">
  <h1 class="refname">mysql_query</h1>
  <p class="verinfo">(PHP 4, PHP 5)</p><p class="refpurpose"><span class="refname">mysql_query</span> &mdash; <span class="dc-title">MySQL クエリを送信する</span></p>

 </div>

 <div id="function.mysql-query-refsynopsisdiv">
  <div class="warning"><strong class="warning">警告</strong>
   <p class="para">
この拡張モジュールは PHP 5.5.0 で非推奨になりました。将来のバージョンで削除される予定です。
<a href="book.mysqli.html" class="link">MySQLi</a> あるいは
<a href="ref.pdo-mysql.html" class="link">PDO_MySQL</a> を使うべきです。詳細な情報は
<a href="mysqlinfo.api.choosing.html" class="link">MySQL: API の選択</a> や
<a href="faq.databases.html#faq.databases.mysql.deprecated" class="link">それに関連する FAQ</a> を参照ください。
この関数の代替として、これらが使えます。</p>
   <ul class="simplelist">
    <li class="member"><span class="function"><a href="mysqli.query.html" class="function">mysqli_query()</a></span></li>
    <li class="member"><span class="methodname"><a href="pdo.query.html" class="methodname">PDO::query()</a></span></li>
   </ul>
  </div>
 </div>

 <div class="refsect1 description" id="refsect1-function.mysql-query-description">
  <h3 class="title">説明</h3>
  <div class="methodsynopsis dc-description">
   <span class="type"><a href="language.pseudo-types.html#language.types.mixed" class="type mixed">mixed</a></span> <span class="methodname"><strong>mysql_query</strong></span>
    ( <span class="methodparam"><span class="type">string</span> <code class="parameter">$query</code></span>
   [, <span class="methodparam"><span class="type">resource</span> <code class="parameter">$link_identifier</code><span class="initializer"> = NULL</span></span>
  ] )</div>

  <p class="para rdfs-comment">
   <span class="function"><strong>mysql_query()</strong></span> は、
   ひとつのクエリを送信します (複数クエリの送信はサポートしません)。
   送信先は、<code class="parameter">link_identifier</code>
   で指定したサーバー上にある、現在アクティブなデータベースです。
  </p>
 </div>


 <div class="refsect1 parameters" id="refsect1-function.mysql-query-parameters">
  <h3 class="title">パラメータ</h3>
  <p class="para">
   <dl>

    
     <dt>
<code class="parameter">query</code></dt>

     <dd>

      <p class="para">
       SQL クエリ。
      </p>
      <p class="para">
       クエリ文字列は、セミコロンで終えてはいけません。
       クエリ内のデータは <a href="function.mysql-real-escape-string.html" class="link">適切にエスケープ</a>
       する必要があります。
      </p>
     </dd>

    
    <dt>
<code class="parameter">
link_identifier</code></dt>
<dd>
<p class="para">MySQL 接続。
指定されない場合、<span class="function"><a href="function.mysql-connect.html" class="function">mysql_connect()</a></span> により直近にオープンされたリンクが
指定されたと仮定されます。そのようなリンクがない場合、引数を指定せずに
<span class="function"><a href="function.mysql-connect.html" class="function">mysql_connect()</a></span> がコールした時と同様にリンクを確立します。
リンクが見付からない、または、確立できない場合、
<strong><code>E_WARNING</code></strong> レベルのエラーが生成されます。</p></dd>


   </dl>

  </p>
 </div>


 <div class="refsect1 returnvalues" id="refsect1-function.mysql-query-returnvalues">
  <h3 class="title">返り値</h3>
  <p class="para">
   SELECT, SHOW, DESCRIBE や EXPLAIN 文、その他結果セットを返す文では、
   <span class="function"><strong>mysql_query()</strong></span> は成功した場合に
   <span class="type"><a href="language.types.resource.html" class="type resource">resource</a></span> を返します。エラー時には <strong><code>FALSE</code></strong> を返します。
  </p>
  <p class="para">
   それ以外の SQL 文 INSERT, UPDATE, DELETE, DROP などでは、
   <span class="function"><strong>mysql_query()</strong></span> は成功した場合に
   <strong><code>TRUE</code></strong> 、エラー時に <strong><code>FALSE</code></strong> を返します。
  </p>
  <p class="para">
   返された結果にアクセスするためには、結果リソースを
   <span class="function"><a href="function.mysql-fetch-array.html" class="function">mysql_fetch_array()</a></span> やその他の関数に渡します。
  </p>
  <p class="para">
   SELECT 文によって返された行の数を知るには
   <span class="function"><a href="function.mysql-num-rows.html" class="function">mysql_num_rows()</a></span> を用います。また
   DELETE, INSERT, REPLACE, または UPDATE 文で変更された行の数を
   知るには <span class="function"><a href="function.mysql-affected-rows.html" class="function">mysql_affected_rows()</a></span> を用います。
  </p>
  <p class="para">
   クエリが参照するテーブルにアクセスする権限がない場合も
   <span class="function"><strong>mysql_query()</strong></span>は失敗し、<strong><code>FALSE</code></strong> が返されます。
  </p>
 </div>


 <div class="refsect1 examples" id="refsect1-function.mysql-query-examples">
  <h3 class="title">例</h3>
  <p class="para">
   <div class="example" id="example-1686">
    <p><strong>例1 間違ったクエリ</strong></p>
    <div class="example-contents"><p>
     次のクエリは文法的に間違っているので、
     <span class="function"><strong>mysql_query()</strong></span>は失敗し <strong><code>FALSE</code></strong>を返します。
    </p></div>
    <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br />$result&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">mysql_query</span><span style="color: #007700">(</span><span style="color: #DD0000">'SELECT&nbsp;*&nbsp;WHERE&nbsp;1=1'</span><span style="color: #007700">);<br />if&nbsp;(!</span><span style="color: #0000BB">$result</span><span style="color: #007700">)&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;die(</span><span style="color: #DD0000">'Invalid&nbsp;query:&nbsp;'&nbsp;</span><span style="color: #007700">.&nbsp;</span><span style="color: #0000BB">mysql_error</span><span style="color: #007700">());<br />}<br /><br /></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
    </div>

   </div>
  </p>
  <p class="para">
   <div class="example" id="example-1687">
    <p><strong>例2 正しいクエリ</strong></p>
    <div class="example-contents"><p>
     次のクエリは正しいので、<span class="function"><strong>mysql_query()</strong></span>
     は <span class="type"><a href="language.types.resource.html" class="type resource">resource</a></span> を返します。
    </p></div>
    <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br /></span><span style="color: #FF8000">//&nbsp;これはユーザーが指定する。たとえば<br /></span><span style="color: #0000BB">$firstname&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #DD0000">'fred'</span><span style="color: #007700">;<br /></span><span style="color: #0000BB">$lastname&nbsp;&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #DD0000">'fox'</span><span style="color: #007700">;<br /><br /></span><span style="color: #FF8000">//&nbsp;クエリの作成<br />//&nbsp;これは&nbsp;SQL&nbsp;クエリを実行する最良の方法です。<br />//&nbsp;さらなる例は、mysql_real_escape_string()&nbsp;を参照ください。<br /></span><span style="color: #0000BB">$query&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">sprintf</span><span style="color: #007700">(</span><span style="color: #DD0000">"SELECT&nbsp;firstname,&nbsp;lastname,&nbsp;address,&nbsp;age&nbsp;FROM&nbsp;friends&nbsp;<br />&nbsp;&nbsp;&nbsp;&nbsp;WHERE&nbsp;firstname='%s'&nbsp;AND&nbsp;lastname='%s'"</span><span style="color: #007700">,<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">mysql_real_escape_string</span><span style="color: #007700">(</span><span style="color: #0000BB">$firstname</span><span style="color: #007700">),<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">mysql_real_escape_string</span><span style="color: #007700">(</span><span style="color: #0000BB">$lastname</span><span style="color: #007700">));<br /><br /></span><span style="color: #FF8000">//&nbsp;クエリの実行<br /></span><span style="color: #0000BB">$result&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">mysql_query</span><span style="color: #007700">(</span><span style="color: #0000BB">$query</span><span style="color: #007700">);<br /><br /></span><span style="color: #FF8000">//&nbsp;結果のチェック<br />//&nbsp;MySQL&nbsp;に送られたクエリと返ってきたエラーをそのまま表示します。デバッグに便利です。<br /></span><span style="color: #007700">if&nbsp;(!</span><span style="color: #0000BB">$result</span><span style="color: #007700">)&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$message&nbsp;&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #DD0000">'Invalid&nbsp;query:&nbsp;'&nbsp;</span><span style="color: #007700">.&nbsp;</span><span style="color: #0000BB">mysql_error</span><span style="color: #007700">()&nbsp;.&nbsp;</span><span style="color: #DD0000">"\n"</span><span style="color: #007700">;<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$message&nbsp;</span><span style="color: #007700">.=&nbsp;</span><span style="color: #DD0000">'Whole&nbsp;query:&nbsp;'&nbsp;</span><span style="color: #007700">.&nbsp;</span><span style="color: #0000BB">$query</span><span style="color: #007700">;<br />&nbsp;&nbsp;&nbsp;&nbsp;die(</span><span style="color: #0000BB">$message</span><span style="color: #007700">);<br />}<br /><br /></span><span style="color: #FF8000">//&nbsp;結果の利用<br />//&nbsp;$result&nbsp;をそのまま出力してもリソースの内部の情報にはアクセスできません。<br />//&nbsp;結果にたいして&nbsp;MySQL&nbsp;の関数を適用する必要があります。<br />//&nbsp;mysql_result(),&nbsp;mysql_fetch_array(),&nbsp;mysql_fetch_row()&nbsp;なども参照ください。<br /></span><span style="color: #007700">while&nbsp;(</span><span style="color: #0000BB">$row&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">mysql_fetch_assoc</span><span style="color: #007700">(</span><span style="color: #0000BB">$result</span><span style="color: #007700">))&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;echo&nbsp;</span><span style="color: #0000BB">$row</span><span style="color: #007700">[</span><span style="color: #DD0000">'firstname'</span><span style="color: #007700">];<br />&nbsp;&nbsp;&nbsp;&nbsp;echo&nbsp;</span><span style="color: #0000BB">$row</span><span style="color: #007700">[</span><span style="color: #DD0000">'lastname'</span><span style="color: #007700">];<br />&nbsp;&nbsp;&nbsp;&nbsp;echo&nbsp;</span><span style="color: #0000BB">$row</span><span style="color: #007700">[</span><span style="color: #DD0000">'address'</span><span style="color: #007700">];<br />&nbsp;&nbsp;&nbsp;&nbsp;echo&nbsp;</span><span style="color: #0000BB">$row</span><span style="color: #007700">[</span><span style="color: #DD0000">'age'</span><span style="color: #007700">];<br />}<br /><br /></span><span style="color: #FF8000">//&nbsp;結果セットに関連付けられているリソースの開放<br />//&nbsp;これは、スクリプトが終了する際に自動的に実行されます。<br /></span><span style="color: #0000BB">mysql_free_result</span><span style="color: #007700">(</span><span style="color: #0000BB">$result</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
    </div>

   </div>
  </p>
 </div>


 <div class="refsect1 seealso" id="refsect1-function.mysql-query-seealso">
  <h3 class="title">参考</h3>
  <p class="para">
   <ul class="simplelist">
    <li class="member"><span class="function"><a href="function.mysql-connect.html" class="function" rel="rdfs-seeAlso">mysql_connect()</a> - MySQL サーバーへの接続をオープンする</span></li>
    <li class="member"><span class="function"><a href="function.mysql-error.html" class="function" rel="rdfs-seeAlso">mysql_error()</a> - 直近に実行された MySQL 操作のエラーメッセージを返す</span></li>
    <li class="member"><span class="function"><a href="function.mysql-real-escape-string.html" class="function" rel="rdfs-seeAlso">mysql_real_escape_string()</a> - SQL 文中で用いる文字列の特殊文字をエスケープする</span></li>
    <li class="member"><span class="function"><a href="function.mysql-result.html" class="function" rel="rdfs-seeAlso">mysql_result()</a> - 結果データを得る</span></li>
    <li class="member"><span class="function"><a href="function.mysql-fetch-assoc.html" class="function" rel="rdfs-seeAlso">mysql_fetch_assoc()</a> - 連想配列として結果の行を取得する</span></li>
    <li class="member"><span class="function"><a href="function.mysql-unbuffered-query.html" class="function" rel="rdfs-seeAlso">mysql_unbuffered_query()</a> - MySQL に SQL クエリを送信するが、結果に対してのフェッチやバッファリングは行わない</span></li>
   </ul>
  </p>
 </div>


</div><div id="usernotes">
 <div class="head">
  <h3 class="title">User Contributed Notes</h3>
 </div>
<div id="allnotes">  <a name="113538""></a>
  <div class="note">
   <strong class="user">deepakshahji at ymail dot com</strong>
   <a href="#113538" class="date">27-Oct-2013 09:40</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
can any help me to connect mysql php with following code<br />
<span class="default">&lt;?php<br />
$empname</span><span class="keyword">=</span><span class="default">$_POST</span><span class="keyword">[</span><span class="string">'$name'</span><span class="keyword">];<br />
</span><span class="default">$empid</span><span class="keyword">=</span><span class="default">10</span><span class="keyword">;<br />
</span><span class="default">$ebp</span><span class="keyword">=</span><span class="default">2500</span><span class="keyword">;<br />
</span><span class="default">$ta</span><span class="keyword">=</span><span class="default">12</span><span class="keyword">*</span><span class="default">$ebp</span><span class="keyword">;<br />
echo </span><span class="default">$empname</span><span class="keyword">;<br />
echo </span><span class="default">$empid</span><span class="keyword">;<br />
</span><span class="default">$query </span><span class="keyword">=</span><span class="string">"INSERT INTO emp"</span><span class="keyword">(</span><span class="default">ID</span><span class="keyword">,</span><span class="default">NAME</span><span class="keyword">,</span><span class="default">BP</span><span class="keyword">,</span><span class="default">TA</span><span class="keyword">) </span><span class="string">"VALUES" </span><span class="keyword">(</span><span class="string">'$empid'</span><span class="keyword">,</span><span class="string">'$empname'</span><span class="keyword">,</span><span class="string">'$ebp'</span><span class="keyword">,</span><span class="string">'$ta'</span><span class="keyword">) <br />
</span><span class="default">$inserts</span><span class="keyword">=</span><span class="default">mysql_query</span><span class="keyword">(</span><span class="default">$query</span><span class="keyword">);<br />
if(!</span><span class="default">$inserts</span><span class="keyword">)<br />
{<br />
</span><span class="default">$message </span><span class="keyword">= </span><span class="string">'INVALId query:' </span><span class="keyword">.</span><span class="default">mysql_error</span><span class="keyword">().</span><span class="string">"\n"</span><span class="keyword">;<br />
</span><span class="default">$message </span><span class="keyword">.= </span><span class="string">'whole query' </span><span class="keyword">.</span><span class="default">$query</span><span class="keyword">;<br />
die(</span><span class="default">$message</span><span class="keyword">);<br />
}<br />
while(</span><span class="default">$row </span><span class="keyword">= </span><span class="default">mysql_fetch_assoc</span><span class="keyword">(</span><span class="default">$inserts</span><span class="keyword">)) <br />
{<br />
echo </span><span class="default">$row</span><span class="keyword">[</span><span class="string">"empname"</span><span class="keyword">];<br />
echo </span><span class="default">$row</span><span class="keyword">[</span><span class="string">"empid"</span><span class="keyword">];<br />
echo </span><span class="default">$row</span><span class="keyword">[</span><span class="string">"ebp"</span><span class="keyword">];<br />
echo </span><span class="default">$row</span><span class="keyword">[</span><span class="string">"ta"</span><span class="keyword">];<br />
}<br />
</span><span class="default">?&gt;<br />
&lt;?php<br />
&nbsp; </span><span class="keyword">include(</span><span class="string">"header.php"</span><span class="keyword">);<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="108160""></a>
  <div class="note">
   <strong class="user">mwwaygoo at hotmail dot com</strong>
   <a href="#108160" class="date">03-Apr-2012 11:16</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I much prefer to use the same syntax for single INSERT, REPLACE and UPDATE queries as it is easier to read and keeps my code shorter (no seperate building of insert and update values)<br />
<br />
INSERT INTO table SET x='1', y=3<br />
UPDATE table SET x='2' WHERE y=3<br />
<br />
So if your using a function to build your query, you will only ever need to code the "field=value, field2=value2" part for any query.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="101945""></a>
  <div class="note">
   <strong class="user">elephant</strong>
   <a href="#101945" class="date">19-Jan-2011 05:49</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
you can speed up your query by using multiple insert simultaneously using this syntax:<br />
<br />
"INSERT INTO table (id,box) VALUES (1,'box1'),(2,'box2'),(3,'box3')"</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="101488""></a>
  <div class="note">
   <strong class="user">ddlshack [at] gmail.dot.com</strong>
   <a href="#101488" class="date">20-Dec-2010 06:12</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Use this to neatly insert data into a mysql table:<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">function </span><span class="default">mysql_insert</span><span class="keyword">(</span><span class="default">$table</span><span class="keyword">, </span><span class="default">$inserts</span><span class="keyword">) {<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$values </span><span class="keyword">= </span><span class="default">array_map</span><span class="keyword">(</span><span class="string">'mysql_real_escape_string'</span><span class="keyword">, </span><span class="default">array_values</span><span class="keyword">(</span><span class="default">$inserts</span><span class="keyword">));<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$keys </span><span class="keyword">= </span><span class="default">array_keys</span><span class="keyword">(</span><span class="default">$inserts</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; return </span><span class="default">mysql_query</span><span class="keyword">(</span><span class="string">'INSERT INTO `'</span><span class="keyword">.</span><span class="default">$table</span><span class="keyword">.</span><span class="string">'` (`'</span><span class="keyword">.</span><span class="default">implode</span><span class="keyword">(</span><span class="string">'`,`'</span><span class="keyword">, </span><span class="default">$keys</span><span class="keyword">).</span><span class="string">'`) VALUES (\''</span><span class="keyword">.</span><span class="default">implode</span><span class="keyword">(</span><span class="string">'\',\''</span><span class="keyword">, </span><span class="default">$values</span><span class="keyword">).</span><span class="string">'\')'</span><span class="keyword">);<br />
}<br />
</span><span class="default">?&gt;<br />
</span><br />
For example:<br />
<br />
<span class="default">&lt;?php<br />
<br />
mysql_insert</span><span class="keyword">(</span><span class="string">'cars'</span><span class="keyword">, array(<br />
&nbsp;&nbsp;&nbsp; </span><span class="string">'make' </span><span class="keyword">=&gt; </span><span class="string">'Aston Martin'</span><span class="keyword">,<br />
&nbsp;&nbsp;&nbsp; </span><span class="string">'model' </span><span class="keyword">=&gt; </span><span class="string">'DB9'</span><span class="keyword">,<br />
&nbsp;&nbsp;&nbsp; </span><span class="string">'year' </span><span class="keyword">=&gt; </span><span class="string">'2009'</span><span class="keyword">,<br />
));<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="93774""></a>
  <div class="note">
   <strong class="user">Richie (at) RichieBartlett.com</strong>
   <a href="#93774" class="date">28-Sep-2009 01:43</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
For those of you whom spent hours bashing your brains against the keyboard wondering why your non-English characters are output as question marks... Try the following:
<br />

<br />
<span class="default">&lt;?php
<br />

<br />
$db </span><span class="keyword">= </span><span class="default">mysql_connect</span><span class="keyword">(</span><span class="string">'YOUR_DB_ADDRESS'</span><span class="keyword">,</span><span class="string">'YOUR_DB_USER'</span><span class="keyword">,</span><span class="string">'YOUR_DB_PASS'</span><span class="keyword">) or die(</span><span class="string">"Database error"</span><span class="keyword">);
<br />
</span><span class="default">mysql_select_db</span><span class="keyword">(</span><span class="string">'YOUR_DB'</span><span class="keyword">, </span><span class="default">$db</span><span class="keyword">);
<br />

<br />
</span><span class="comment">//SOLUTION::&nbsp; add this comment before your 1st query -- force multiLanuage support
<br />
</span><span class="default">$result </span><span class="keyword">= </span><span class="default">mysql_query</span><span class="keyword">(</span><span class="string">"set names 'utf8'"</span><span class="keyword">);
<br />

<br />
</span><span class="default">$query </span><span class="keyword">= </span><span class="string">"select * from YOUR_DB_TABLE"</span><span class="keyword">;
<br />
</span><span class="default">$result </span><span class="keyword">= </span><span class="default">mysql_query</span><span class="keyword">(</span><span class="default">$query</span><span class="keyword">);
<br />

<br />
</span><span class="comment">//-THE_REST_IS_UP_TO_YOU-
<br />

<br />
</span><span class="default">?&gt;
<br />
</span>
<br />
Simply run the query "set names 'utf8' " against the MySQL DB and your output should appear correct.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="91791""></a>
  <div class="note">
   <strong class="user">Anonymous</strong>
   <a href="#91791" class="date">25-Jun-2009 05:18</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
When processing a RENAME TABLE query, PHP apparently always returns false, no matter if the query was successfully processed or not.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="89281""></a>
  <div class="note">
   <strong class="user">Andy McReed</strong>
   <a href="#89281" class="date">01-Mar-2009 09:28</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Even though executing multiple queries from one string isn't possible with the mysql_query method there is a way to do it which i found on this guys site (<a href="http://www.dev-explorer.com/articles/multiple-mysql-queries" rel="nofollow" target="_blank">http://www.dev-explorer.com/articles/multiple-mysql-queries</a>). Basically you just explode your SQL string by the semicolon (;) separating the queries and then loop through the resulting array executing each one individually. Saves you from having lines and lines of function calls in your code.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="88602""></a>
  <div class="note">
   <strong class="user">ialsoagree</strong>
   <a href="#88602" class="date">31-Jan-2009 05:24</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
When you run a select statement and receive a response, the data types of your response will be a string regardless of the data type of the column.<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="comment">// Query to select an int column<br />
</span><span class="default">$query </span><span class="keyword">= </span><span class="string">'SELECT user_id FROM users WHERE user_id = 1'</span><span class="keyword">;<br />
</span><span class="default">$result </span><span class="keyword">= </span><span class="default">mysql_query</span><span class="keyword">(</span><span class="default">$query</span><span class="keyword">);<br />
</span><span class="default">$array </span><span class="keyword">= </span><span class="default">mysql_fetch_assoc</span><span class="keyword">(</span><span class="default">$result</span><span class="keyword">);<br />
<br />
</span><span class="comment">// Echoes: string<br />
</span><span class="keyword">echo </span><span class="default">gettype</span><span class="keyword">(</span><span class="default">$array</span><span class="keyword">[</span><span class="string">'user_id'</span><span class="keyword">]);<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="88282""></a>
  <div class="note">
   <strong class="user">girishpadia at gmail dot com</strong>
   <a href="#88282" class="date">19-Jan-2009 08:01</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Hello all,<br />
<br />
I have extended mysql_query function to have more flexibility. It is a php file say "run_query.php". Include this file in your php application. To use this follow this steps.<br />
<br />
1) Create a table in mysql with the following structure.<br />
<br />
CREATE TABLE `errorlog` ( <br />
`query` varchar(5000) default NULL, <br />
`error` varchar(5000) default NULL <br />
)<br />
<br />
2) Create a php file and paste following code. Save the file (say file name is run_query.php).<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">function </span><span class="default">mysql_query_</span><span class="keyword">(</span><span class="default">$query</span><span class="keyword">)<br />
{<br />
&nbsp;&nbsp;&nbsp; include </span><span class="string">"pass1.php"</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$curdate </span><span class="keyword">= </span><span class="default">date</span><span class="keyword">(</span><span class="string">"d-m-Y H:i:s"</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; if(</span><span class="default">mysql_query</span><span class="keyword">(</span><span class="default">$query</span><span class="keyword">) == </span><span class="default">true</span><span class="keyword">)<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if(</span><span class="default">substr</span><span class="keyword">(</span><span class="default">strtoupper</span><span class="keyword">(</span><span class="default">$query</span><span class="keyword">),</span><span class="default">0</span><span class="keyword">,</span><span class="default">6</span><span class="keyword">) == </span><span class="string">'INSERT' </span><span class="keyword">|| </span><span class="default">substr</span><span class="keyword">(</span><span class="default">strtoupper</span><span class="keyword">(</span><span class="default">$query</span><span class="keyword">),</span><span class="default">0</span><span class="keyword">,</span><span class="default">5</span><span class="keyword">) == </span><span class="string">'UPDATE' </span><span class="keyword">|| </span><span class="default">substr</span><span class="keyword">(</span><span class="default">strtoupper</span><span class="keyword">(</span><span class="default">$query</span><span class="keyword">),</span><span class="default">0</span><span class="keyword">,</span><span class="default">5</span><span class="keyword">) == </span><span class="string">'DELETE'</span><span class="keyword">)<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$fp</span><span class="keyword">=</span><span class="default">fopen</span><span class="keyword">(</span><span class="string">"trans.sql"</span><span class="keyword">,</span><span class="string">"a"</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if(</span><span class="default">$fp</span><span class="keyword">==</span><span class="default">null</span><span class="keyword">)<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; {<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; die(</span><span class="string">"File cannot be opened. Try again !!!"</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$printline </span><span class="keyword">= </span><span class="string">"/* </span><span class="default">$curdate</span><span class="string"> : */ </span><span class="default">$query</span><span class="string"> ;"</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">fprintf</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">,</span><span class="string">"\r\n%s"</span><span class="keyword">,</span><span class="default">$printline</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">fclose</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">true</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; else<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">mysql_query</span><span class="keyword">(</span><span class="default">$query</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; else<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$error </span><span class="keyword">= </span><span class="default">mysql_error</span><span class="keyword">();<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$error </span><span class="keyword">= </span><span class="default">addslashes</span><span class="keyword">(</span><span class="default">$error</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$query </span><span class="keyword">= </span><span class="default">addslashes</span><span class="keyword">(</span><span class="default">$query</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">mysql_query</span><span class="keyword">(</span><span class="string">"insert into errorlog values('</span><span class="default">$query</span><span class="string">','</span><span class="default">$error</span><span class="string">')"</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">false</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }<br />
}<br />
</span><span class="default">?&gt;</span> <br />
<br />
3) Include this file in your any php application.<br />
4) Use mysql_query_ function instead of mysql_query function.<br />
<br />
Advantages.<br />
<br />
1) You can log query and error in your database table (errorlog).<br />
<br />
2) A sql file created/appendended whenever any Data manipulation query is fired. So you can have a complete transaction log in query format.<br />
<br />
3) This sql file will help you in "point in time recovery" in case of the database is crashed.<br />
<br />
Your views ,comments and updation in this function are welcome. <br />
<br />
girishpadia@gmail.com</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="86447""></a>
  <div class="note">
   <strong class="user">Anonymous</strong>
   <a href="#86447" class="date">19-Oct-2008 11:22</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Relying in external functions doesn't help you in learning programming, that is calling external functions without having an idea of their use.<br />
<br />
<span class="default">&lt;?PHP<br />
</span><span class="keyword">function </span><span class="default">mysql_queryf</span><span class="keyword">(</span><span class="default">$string</span><span class="keyword">)<br />
{<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$args </span><span class="keyword">= </span><span class="default">func_get_args</span><span class="keyword">();<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">array_shift</span><span class="keyword">(</span><span class="default">$args</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$len </span><span class="keyword">= </span><span class="default">strlen</span><span class="keyword">(</span><span class="default">$string</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$sql_query </span><span class="keyword">= </span><span class="string">""</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$args_i </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; for(</span><span class="default">$i </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">; </span><span class="default">$i </span><span class="keyword">&lt; </span><span class="default">$len</span><span class="keyword">; </span><span class="default">$i</span><span class="keyword">++)<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if(</span><span class="default">$string</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">] == </span><span class="string">"%"</span><span class="keyword">)<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$char </span><span class="keyword">= </span><span class="default">$string</span><span class="keyword">[</span><span class="default">$i </span><span class="keyword">+ </span><span class="default">1</span><span class="keyword">];<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$i</span><span class="keyword">++;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; switch(</span><span class="default">$char</span><span class="keyword">)<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; case </span><span class="string">"%"</span><span class="keyword">:<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$sql_query </span><span class="keyword">.= </span><span class="default">$char</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; break;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; case </span><span class="string">"u"</span><span class="keyword">:<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$sql_query </span><span class="keyword">.= </span><span class="string">"'" </span><span class="keyword">. </span><span class="default">intval</span><span class="keyword">(</span><span class="default">$args</span><span class="keyword">[</span><span class="default">$args_i</span><span class="keyword">]) . </span><span class="string">"'"</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; break;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; case </span><span class="string">"s"</span><span class="keyword">:<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$sql_query </span><span class="keyword">.= </span><span class="string">"'" </span><span class="keyword">. </span><span class="default">mysql_real_escape_string</span><span class="keyword">(</span><span class="default">$args</span><span class="keyword">[</span><span class="default">$args_i</span><span class="keyword">]) . </span><span class="string">"'"</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; break;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; case </span><span class="string">"x"</span><span class="keyword">:<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$sql_query </span><span class="keyword">.= </span><span class="string">"'" </span><span class="keyword">. </span><span class="default">dechex</span><span class="keyword">(</span><span class="default">$args</span><span class="keyword">[</span><span class="default">$args_i</span><span class="keyword">]) . </span><span class="string">"'"</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; break;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if(</span><span class="default">$char </span><span class="keyword">!= </span><span class="string">"x"</span><span class="keyword">)<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$args_i</span><span class="keyword">++;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; else<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$sql_query </span><span class="keyword">.= </span><span class="default">$string</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">];<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; return </span><span class="default">mysql_query</span><span class="keyword">(</span><span class="default">$sql_query</span><span class="keyword">);<br />
}<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="85876""></a>
  <div class="note">
   <strong class="user">lanbotdevman</strong>
   <a href="#85876" class="date">22-Sep-2008 05:01</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I modified a bit script originally posted by <br />
ix at nivelzero dot ro<br />
14-Aug-2005 01:07<br />
<br />
This allows using large .sql files without getting 'memory size exhausted' error.<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">function </span><span class="default">parse_mysql_dump</span><span class="keyword">(</span><span class="default">$url</span><span class="keyword">) {<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$handle </span><span class="keyword">= @</span><span class="default">fopen</span><span class="keyword">(</span><span class="default">$url</span><span class="keyword">, </span><span class="string">"r"</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$query </span><span class="keyword">= </span><span class="string">""</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; while(!</span><span class="default">feof</span><span class="keyword">(</span><span class="default">$handle</span><span class="keyword">)) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$sql_line </span><span class="keyword">= </span><span class="default">fgets</span><span class="keyword">(</span><span class="default">$handle</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">trim</span><span class="keyword">(</span><span class="default">$sql_line</span><span class="keyword">) != </span><span class="string">"" </span><span class="keyword">&amp;&amp; </span><span class="default">strpos</span><span class="keyword">(</span><span class="default">$sql_line</span><span class="keyword">, </span><span class="string">"--"</span><span class="keyword">) === </span><span class="default">false</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$query </span><span class="keyword">.= </span><span class="default">$sql_line</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">preg_match</span><span class="keyword">(</span><span class="string">"/;[\040]*\$/"</span><span class="keyword">, </span><span class="default">$sql_line</span><span class="keyword">)) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$result </span><span class="keyword">= </span><span class="default">mysql_query</span><span class="keyword">(</span><span class="default">$query</span><span class="keyword">) or die(</span><span class="default">mysql_error</span><span class="keyword">());<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$query </span><span class="keyword">= </span><span class="string">""</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; }<br />
}<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="85807""></a>
  <div class="note">
   <strong class="user">Mr. Tim</strong>
   <a href="#85807" class="date">18-Sep-2008 08:42</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
It should be noted that mysql_query can generate an E_WARNING (not documented).&nbsp; The warning that I hit was when the db user did not have permission to execute a UDF. <br />
<br />
Expected behavior would be like an Invalid SQL statement, where there is no E_WARNING generated by mysql_query.<br />
<br />
Warning: mysql_query() [function.mysql-query]: Unable to save result set in filename.php<br />
<br />
The mysql_errno is 1370 and the mysql_error is:<br />
<br />
execute command denied to user 'username'@'%' for routine 'database_name.MyUDF'</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="84962""></a>
  <div class="note">
   <strong class="user">i dot prasoon at gmail dot com</strong>
   <a href="#84962" class="date">07-Aug-2008 05:07</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
The function formToDB($table, $exceptions = '', $sql_type = 'insert', $sql_condition = NULL) is not working properly. Problem with exceptional fields is there.<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; I modified this function and now it is working properly. Here is the changed function - <br />
<br />
function formToDB($table, $exceptions = '', $sql_type = 'insert', $sql_condition = NULL) {<br />
<br />
&nbsp; // define some vars<br />
&nbsp; $fields = '';<br />
&nbsp; $values = '';<br />
&nbsp;<br />
&nbsp; // format input fields into sql<br />
&nbsp; foreach ($_POST as $field =&gt; $value) {<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; if (!strstr($exceptions,$field)) {<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp;&nbsp; $value = mysql_real_escape_string($value);<br />
&nbsp;&nbsp; &nbsp;&nbsp; if ($sql_type == 'insert') {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $fields .= "$field, ";<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $values .= "'$value', ";<br />
&nbsp;&nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp;&nbsp; else {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $fields .= "$field = '$value', ";<br />
&nbsp;&nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp; }<br />
&nbsp;<br />
&nbsp; // remove trailing ", " from $fields and $values<br />
&nbsp; $fields = preg_replace('/, $/', '', $fields);<br />
&nbsp; $values = preg_replace('/, $/', '', $values);<br />
&nbsp;<br />
&nbsp; // create sql statement<br />
&nbsp; if ($sql_type == 'insert') {<br />
&nbsp;&nbsp;&nbsp; $sql = "INSERT INTO $table ($fields) VALUES ($values)";<br />
&nbsp; }<br />
&nbsp; elseif ($sql_type == 'update') {<br />
&nbsp;&nbsp;&nbsp; if (!isset($sql_condition)) {<br />
&nbsp;&nbsp; &nbsp;&nbsp; echo 'ERROR: You must enter a sql condition!';<br />
&nbsp;&nbsp; &nbsp;&nbsp; exit;<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; $sql = "UPDATE $table SET $fields WHERE $sql_condition";<br />
&nbsp; }<br />
&nbsp; else {<br />
&nbsp;&nbsp;&nbsp; echo 'ERROR: Invalid input for argument $sql_type: must be "insert" or "update"';<br />
&nbsp;&nbsp;&nbsp; exit;<br />
&nbsp; }<br />
&nbsp;<br />
&nbsp; // execute sql<br />
&nbsp; if (mysql_query($sql)) {<br />
&nbsp;&nbsp;&nbsp; return true;<br />
&nbsp; }<br />
&nbsp; else {<br />
&nbsp;&nbsp;&nbsp; //echo mysql_error();<br />
&nbsp;&nbsp;&nbsp; return false;<br />
&nbsp; }<br />
<br />
}</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="84605""></a>
  <div class="note">
   <strong class="user">pascalxusPLEASENOSPAM at yahoo dot com</strong>
   <a href="#84605" class="date">21-Jul-2008 09:16</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Here is an example of using the mysql_query in the context of connecting to a database.
<br />

<br />
<span class="default">&lt;?php
<br />
&nbsp; </span><span class="keyword">function </span><span class="default">connect</span><span class="keyword">( </span><span class="default">$dbName </span><span class="keyword">)
<br />
&nbsp; {
<br />
&nbsp;&nbsp;&nbsp; do {
<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="default">$databaseResponse </span><span class="keyword">= </span><span class="default">mysql_connect</span><span class="keyword">(
<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="string">"example.com"</span><span class="keyword">, </span><span class="string">"username"</span><span class="keyword">, </span><span class="string">"password" </span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="default">sleep</span><span class="keyword">(</span><span class="default">1</span><span class="keyword">);
<br />
&nbsp;&nbsp;&nbsp; } while( </span><span class="default">$databaseResponse </span><span class="keyword">=== </span><span class="default">false </span><span class="keyword">);
<br />

<br />
&nbsp;&nbsp;&nbsp; @ </span><span class="default">$selectResult </span><span class="keyword">= </span><span class="default">mysql_select_db</span><span class="keyword">( </span><span class="default">$dbName </span><span class="keyword">) or </span><span class="default">dieFunc</span><span class="keyword">();
<br />
&nbsp; }
<br />

<br />
&nbsp; function </span><span class="default">executeQuery</span><span class="keyword">( </span><span class="default">$query</span><span class="keyword">, </span><span class="default">$db </span><span class="keyword">)
<br />
&nbsp; {
<br />
&nbsp;&nbsp; &nbsp;&nbsp; if( </span><span class="default">$db </span><span class="keyword">!= </span><span class="string">"" </span><span class="keyword">) </span><span class="default">connect</span><span class="keyword">( </span><span class="default">$db </span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp;&nbsp; else </span><span class="default">connect</span><span class="keyword">( </span><span class="string">"pascal_crm" </span><span class="keyword">);
<br />

<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="default">$result</span><span class="keyword">= </span><span class="default">mysql_query</span><span class="keyword">( </span><span class="default">$query </span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="default">$err&nbsp;&nbsp; </span><span class="keyword">= </span><span class="default">mysql_error</span><span class="keyword">();
<br />
&nbsp;&nbsp; &nbsp;&nbsp; if( </span><span class="default">$err </span><span class="keyword">!= </span><span class="string">"" </span><span class="keyword">) echo </span><span class="string">"error=</span><span class="default">$err</span><span class="string">&nbsp; "</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="default">mysql_close</span><span class="keyword">();
<br />
&nbsp;&nbsp; &nbsp;&nbsp; return </span><span class="default">$result</span><span class="keyword">;
<br />
&nbsp; }
<br />

<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="83884""></a>
  <div class="note">
   <strong class="user">fernandoleal at loytek dot com</strong>
   <a href="#83884" class="date">17-Jun-2008 12:28</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Dunno if is it a bug but when you are working with replications servers and work with multiple databases queries if you don't select the database it will only insert,update,delete into the master and bypass the slave, I think it its because it doesn't insert the sql on the binary log so the work around its to just call mysql_select_db <br />
MYSQL : 5.0.51a-log<br />
PHP: 5.2.6<br />
Example:<br />
<span class="default">&lt;?php<br />
</span><span class="comment">#Inserts only to master<br />
</span><span class="default">$link</span><span class="keyword">=</span><span class="default">mysql_connect</span><span class="keyword">(</span><span class="string">'host'</span><span class="keyword">,</span><span class="string">'user'</span><span class="keyword">,</span><span class="string">'pass'</span><span class="keyword">);<br />
</span><span class="default">$sql </span><span class="keyword">=</span><span class="string">"INSERT INTO mysql.host (host) VALUES ('localhost');"<br />
</span><span class="default">var_dump</span><span class="keyword">(</span><span class="default">mysql_query</span><span class="keyword">(</span><span class="default">$sql</span><span class="keyword">,</span><span class="default">$link</span><span class="keyword">));<br />
<br />
</span><span class="comment">#The Working Way Master - Slave<br />
</span><span class="default">$link2</span><span class="keyword">=</span><span class="default">mysql_connect</span><span class="keyword">(</span><span class="string">'host'</span><span class="keyword">,</span><span class="string">'user'</span><span class="keyword">,</span><span class="string">'pass'</span><span class="keyword">);<br />
</span><span class="default">$select_db </span><span class="keyword">= </span><span class="default">mysql_select_db</span><span class="keyword">(</span><span class="string">'mysql'</span><span class="keyword">, </span><span class="default">$link2</span><span class="keyword">);<br />
</span><span class="default">var_dump</span><span class="keyword">(</span><span class="default">mysql_query</span><span class="keyword">(</span><span class="default">$sql</span><span class="keyword">,</span><span class="default">$link2</span><span class="keyword">));&nbsp;&nbsp; <br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="82495""></a>
  <div class="note">
   <strong class="user">uramihsayibok, gmail, com</strong>
   <a href="#82495" class="date">13-Apr-2008 10:46</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Similar to the queryf() posted by sk89q, I've found this small function quite handy.<br />
<br />
Just please, please, PLEASE remember to escape your strings!<br />
<span class="default">&lt;?php<br />
<br />
</span><span class="keyword">function </span><span class="default">mysql_queryf</span><span class="keyword">(</span><span class="default">$query</span><span class="keyword">) {<br />
&nbsp;&nbsp;&nbsp; if (</span><span class="default">func_num_args</span><span class="keyword">()&gt;</span><span class="default">1</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$args</span><span class="keyword">=</span><span class="default">func_get_args</span><span class="keyword">();<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$query</span><span class="keyword">=</span><span class="default">call_user_func_array</span><span class="keyword">(</span><span class="string">"sprintf"</span><span class="keyword">,</span><span class="default">$args</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; return </span><span class="default">mysql_query</span><span class="keyword">(</span><span class="default">$query</span><span class="keyword">);<br />
}<br />
<br />
</span><span class="comment">// Allows for things like<br />
</span><span class="default">$resultset</span><span class="keyword">=</span><span class="default">mysql_queryf</span><span class="keyword">(</span><span class="string">"SELECT * FROM `table` WHERE `id`=%u LIMIT 1"</span><span class="keyword">, </span><span class="default">$_GET</span><span class="keyword">[</span><span class="string">"id"</span><span class="keyword">]);<br />
</span><span class="comment">// $_GET["id"] will be converted to an integer: 0 if it's invalid<br />
<br />
</span><span class="default">?&gt;<br />
</span>With a little modification it can handle a $connection resource too.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="82429""></a>
  <div class="note">
   <strong class="user">rogier</strong>
   <a href="#82429" class="date">10-Apr-2008 03:55</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
For all you programmers out there getting the 'Command out of synch' errors when executing a stored procedure call:<br />
<br />
There are known bugs related to this issue, and the best workaround for avoiding this error seems to be switching to mysqli.<br />
<br />
Still, I needed mysql to also handle these calls correctly.<br />
The error is normally related to wrong function call sequences, though the bug report at&nbsp; <a href="http://bugs.php.net/bug.php?id=39727 shows otherwise." rel="nofollow" target="_blank">http://bugs.php.net/bug.php?id=39727 shows otherwise.</a><br />
<br />
For me, after commenting out hundreds of lines and several introspection calls to parse the procedure information (using information_schema and 'SHOW' extensions), I still got the same error.<br />
The first result is returned, because I initiated my connection using the MYSQL_MULTI_RESULTS value of 131072 (forget this and you will never get any output, but an error message stating mysql cannot return results in this context)<br />
<br />
After testing with this code (sproc2 simply calls 'SELECT * FROM sometable'), I found the error must be in the mysql library/extension. Somehow, mysql does not handle multiple resultsets correctly, or is at least missing some functionality related to handling multiple results.<br />
<br />
<span class="default">&lt;?php<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">//...<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$rs </span><span class="keyword">= </span><span class="default">mysql_query</span><span class="keyword">(</span><span class="string">'CALL sproc2(500)'</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; while ((</span><span class="default">$row</span><span class="keyword">=</span><span class="default">mysql_fetch_assoc</span><span class="keyword">(</span><span class="default">$rs</span><span class="keyword">))!==</span><span class="default">false</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">print_r</span><span class="keyword">(</span><span class="default">$row</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">mysql_free_result</span><span class="keyword">(</span><span class="default">$rs</span><span class="keyword">);<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$rs </span><span class="keyword">= </span><span class="default">mysql_query</span><span class="keyword">(</span><span class="string">'CALL sproc2(500)'</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; print </span><span class="default">mysql_error</span><span class="keyword">(); </span><span class="comment">//the notorious 'command out of synch' message :(<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">while ((</span><span class="default">$row</span><span class="keyword">=</span><span class="default">mysql_fetch_assoc</span><span class="keyword">(</span><span class="default">$rs</span><span class="keyword">))!==</span><span class="default">false</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">print_r</span><span class="keyword">(</span><span class="default">$row</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">mysql_free_result</span><span class="keyword">(</span><span class="default">$rs</span><span class="keyword">);<br />
</span><span class="default">?&gt;<br />
</span><br />
After spending hours debugging my code (the full library is already over the MB), the only solution seemed to be to CLOSE the connection after the first call, and reopening it before the second. <br />
<br />
So if you ever make a uniform database accessing interface and implement stored procedures/prepared statements (or classes for it), this could be a solution if you really wish to enable stored procedures.<br />
<br />
Still, be aware that this is really a serious flaw in your design (and IMHO, the mysql extension)<br />
<br />
Also see the documentation for mysqli on mysqli_query, which seems to be working fine.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="81348""></a>
  <div class="note">
   <strong class="user">kriskra at gmail dot com</strong>
   <a href="#81348" class="date">23-Feb-2008 08:06</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Here is a small neat function to print out the mysql result as a html table:<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">function </span><span class="default">echo_result</span><span class="keyword">(</span><span class="default">$result</span><span class="keyword">) {<br />
&nbsp; </span><span class="default">?&gt;</span>&lt;table&gt;&lt;tr&gt;&lt;?<br />
&nbsp; if(! $result) { ?&gt;&lt;th&gt;result not valid&lt;/th&gt;&lt;? }<br />
&nbsp; else {<br />
&nbsp;&nbsp;&nbsp; $i = 0;<br />
&nbsp;&nbsp;&nbsp; while ($i &lt; mysql_num_fields($result)) {<br />
&nbsp;&nbsp; &nbsp;&nbsp; $meta = mysql_fetch_field($result, $i);<br />
&nbsp;&nbsp; &nbsp;&nbsp; ?&gt;&lt;th style="white-space:nowrap"&gt;<span class="default">&lt;?=$meta</span><span class="keyword">-&gt;</span><span class="default">name?&gt;</span>&lt;/th&gt;&lt;?<br />
&nbsp;&nbsp; &nbsp;&nbsp; $i++;<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; ?&gt;&lt;/tr&gt;&lt;?<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; if(mysql_num_rows($result) == 0) { <br />
&nbsp;&nbsp; &nbsp;&nbsp; ?&gt;&lt;tr&gt;&lt;td colspan="<span class="default">&lt;?=mysql_num_fields</span><span class="keyword">(</span><span class="default">$result</span><span class="keyword">)</span><span class="default">?&gt;</span>"&gt;<br />
&nbsp;&nbsp; &nbsp;&nbsp; &lt;strong&gt;&lt;center&gt;no result&lt;/center&gt;&lt;/strong&gt;<br />
&nbsp;&nbsp; &nbsp;&nbsp; &lt;/td&gt;&lt;/tr&gt;&lt;? <br />
&nbsp;&nbsp;&nbsp; } else<br />
&nbsp;&nbsp; &nbsp;&nbsp; while($row=mysql_fetch_assoc($result)) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; ?&gt;&lt;tr style="white-space:nowrap"&gt;&lt;?<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; foreach($row as $key=&gt;$value) { ?&gt;&lt;td&gt;<span class="default">&lt;?=$value?&gt;</span>&lt;/td&gt;&lt;? }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; ?&gt;&lt;/tr&gt;&lt;?<br />
&nbsp;&nbsp; &nbsp;&nbsp; }<br />
&nbsp; }<br />
&nbsp; ?&gt;&lt;/table&gt;&lt;?<br />
}<br />
?&gt;</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="81188""></a>
  <div class="note">
   <strong class="user">sk89q</strong>
   <a href="#81188" class="date">17-Feb-2008 10:56</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
sprintf+mysql_query which auto-escapes.<br />
<br />
Usage:<br />
<span class="default">&lt;?php<br />
$db</span><span class="keyword">-&gt;</span><span class="default">queryf</span><span class="keyword">(</span><span class="string">"SELECT `m`.`name` FROM `test`.`members` WHERE `name`=%s OR `id`=%d OR `sex` IN (%a)"</span><span class="keyword">, </span><span class="string">"Evil 'injection'"</span><span class="keyword">, </span><span class="string">'NaN'</span><span class="keyword">, array(</span><span class="string">'male'</span><span class="keyword">, </span><span class="string">'female'</span><span class="keyword">, </span><span class="string">'both'</span><span class="keyword">, </span><span class="string">'other'</span><span class="keyword">, </span><span class="string">"Alien quote'man"</span><span class="keyword">));<br />
</span><span class="default">?&gt;<br />
</span><br />
To be put into a class, and don't forget to change the $this-&gt;query() and $this-&gt;escape() functions accordingly.<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">function </span><span class="default">queryf</span><span class="keyword">(</span><span class="default">$sql</span><span class="keyword">)<br />
{&nbsp; &nbsp; <br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$args </span><span class="keyword">= </span><span class="default">func_get_args</span><span class="keyword">();<br />
&nbsp;&nbsp;&nbsp; @</span><span class="default">array_shift</span><span class="keyword">(</span><span class="default">$args</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">queryf_args </span><span class="keyword">= </span><span class="default">$args</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">queryf_i </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$query </span><span class="keyword">= </span><span class="default">preg_replace_callback</span><span class="keyword">(</span><span class="string">"#%(.)#"</span><span class="keyword">, array(</span><span class="default">$this</span><span class="keyword">, </span><span class="string">'queryf_format'</span><span class="keyword">), </span><span class="default">$sql</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; return </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">query</span><span class="keyword">(</span><span class="default">$query</span><span class="keyword">);<br />
}<br />
<br />
function </span><span class="default">queryf_format</span><span class="keyword">(</span><span class="default">$m</span><span class="keyword">)<br />
{&nbsp; &nbsp; <br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$args </span><span class="keyword">= </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">queryf_args</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$i </span><span class="keyword">= &amp;</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">queryf_i</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; switch(</span><span class="default">$m</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">])<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; case </span><span class="string">'%'</span><span class="keyword">:<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="string">"%"</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; case </span><span class="string">'a'</span><span class="keyword">:<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$s </span><span class="keyword">= array();<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$arr </span><span class="keyword">= </span><span class="default">$args</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">++];<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; foreach(</span><span class="default">$arr </span><span class="keyword">as </span><span class="default">$x</span><span class="keyword">)<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$s</span><span class="keyword">[] = </span><span class="string">"'"</span><span class="keyword">.</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">escape</span><span class="keyword">(</span><span class="default">$x</span><span class="keyword">).</span><span class="string">"'"</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">implode</span><span class="keyword">(</span><span class="string">","</span><span class="keyword">, </span><span class="default">$s</span><span class="keyword">);;=<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; case </span><span class="string">'s'</span><span class="keyword">:<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="string">"'"</span><span class="keyword">.</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">escape</span><span class="keyword">(</span><span class="default">$args</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">++]).</span><span class="string">"'"</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; case </span><span class="string">'d'</span><span class="keyword">:<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="string">""</span><span class="keyword">.</span><span class="default">intval</span><span class="keyword">(</span><span class="default">$args</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">++]).</span><span class="string">""</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; default:<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">trigger_error</span><span class="keyword">(</span><span class="string">"Bad type specifier: </span><span class="keyword">{</span><span class="default">$m</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">]}</span><span class="string">"</span><span class="keyword">, </span><span class="default">E_USER_ERROR</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; }<br />
}<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="79255""></a>
  <div class="note">
   <strong class="user">masteracc0 at aol dot com</strong>
   <a href="#79255" class="date">17-Nov-2007 07:00</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Keep in mind when dealing with PHP &amp; MySQL that sending a null-terminated string to a MySQL query can be misleading if you use echo($sql) in PHP because the null terminator may not be visible.<br />
<br />
For example (this assumes connection is already made),<br />
$string1 = "mystring\0";<br />
$string2 = "mystring";<br />
<br />
$query1 = "SELECT * FROM table WHERE mystring='".$string1."'"<br />
$query2 = "SELECT * FROM table WHERE mystring='".$string2."'"<br />
&nbsp;<br />
$result1 = mysql_query($query1);<br />
<br />
$result2 = mysql_query($query2);<br />
<br />
//$result1 IS NOT EQUAL TO $result2 but will not provide an error<br />
<br />
//but printing these queries to the screen will provide the same result<br />
echo($result1);<br />
echo($result2);<br />
<br />
Not knowing this could lead to some mind-numbing troubleshooting when dealing with any strings with a null terminator.&nbsp; So now you know! :)</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="77949""></a>
  <div class="note">
   <strong class="user">patrick at ciphertek dot com</strong>
   <a href="#77949" class="date">21-Sep-2007 07:28</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If you spend a lot of time writing pages that take input from a form and insert it into a database, this function will save you time!<br />
<br />
Please Note: You have to name your form fields the same as their corresponding table column is named in mysql for this to work.<br />
<br />
<span class="default">&lt;?php<br />
<br />
</span><span class="comment">// $table - name of the mysql table you are querying<br />
// $exceptions - fields that will not be inserted into table<br />
//&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; i.e. 'submit, action, '; (note trailing comma and space!)<br />
// $sql_type - has to be 'insert' or 'update'<br />
// $sql_condition - have to define this if $sql_type = 'update'<br />
//&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; i.e. "userID = '".$_POST['userID']."'"<br />
</span><span class="keyword">function </span><span class="default">formToDB</span><span class="keyword">(</span><span class="default">$table</span><span class="keyword">, </span><span class="default">$exceptions </span><span class="keyword">= </span><span class="string">''</span><span class="keyword">, </span><span class="default">$sql_type </span><span class="keyword">= </span><span class="string">'insert'</span><span class="keyword">, </span><span class="default">$sql_condition </span><span class="keyword">= </span><span class="default">NULL</span><span class="keyword">) {<br />
<br />
&nbsp; </span><span class="comment">// define some vars<br />
&nbsp; </span><span class="default">$fields </span><span class="keyword">= </span><span class="string">''</span><span class="keyword">;<br />
&nbsp; </span><span class="default">$values </span><span class="keyword">= </span><span class="string">''</span><span class="keyword">;<br />
&nbsp; <br />
&nbsp; </span><span class="comment">// format input fields into sql<br />
&nbsp; </span><span class="keyword">foreach (</span><span class="default">$_POST </span><span class="keyword">as </span><span class="default">$field </span><span class="keyword">=&gt; </span><span class="default">$value</span><span class="keyword">) {<br />
&nbsp;&nbsp;&nbsp; if (!</span><span class="default">preg_match</span><span class="keyword">(</span><span class="string">"/</span><span class="default">$field</span><span class="string">, /"</span><span class="keyword">, </span><span class="default">$exceptions</span><span class="keyword">)) {<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="default">$value </span><span class="keyword">= </span><span class="default">mysql_real_escape_string</span><span class="keyword">(</span><span class="default">$value</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp;&nbsp; if (</span><span class="default">$sql_type </span><span class="keyword">== </span><span class="string">'insert'</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$fields </span><span class="keyword">.= </span><span class="string">"</span><span class="default">$field</span><span class="string">, "</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$values </span><span class="keyword">.= </span><span class="string">"'</span><span class="default">$value</span><span class="string">', "</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp;&nbsp; else {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$fields </span><span class="keyword">.= </span><span class="string">"</span><span class="default">$field</span><span class="string"> = '</span><span class="default">$value</span><span class="string">', "</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp; }<br />
&nbsp; <br />
&nbsp; </span><span class="comment">// remove trailing ", " from $fields and $values<br />
&nbsp; </span><span class="default">$fields </span><span class="keyword">= </span><span class="default">preg_replace</span><span class="keyword">(</span><span class="string">'/, $/'</span><span class="keyword">, </span><span class="string">''</span><span class="keyword">, </span><span class="default">$fields</span><span class="keyword">);<br />
&nbsp; </span><span class="default">$values </span><span class="keyword">= </span><span class="default">preg_replace</span><span class="keyword">(</span><span class="string">'/, $/'</span><span class="keyword">, </span><span class="string">''</span><span class="keyword">, </span><span class="default">$values</span><span class="keyword">);<br />
&nbsp; <br />
&nbsp; </span><span class="comment">// create sql statement<br />
&nbsp; </span><span class="keyword">if (</span><span class="default">$sql_type </span><span class="keyword">== </span><span class="string">'insert'</span><span class="keyword">) {<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$sql </span><span class="keyword">= </span><span class="string">"INSERT INTO </span><span class="default">$table</span><span class="string"> (</span><span class="default">$fields</span><span class="string">) VALUES (</span><span class="default">$values</span><span class="string">)"</span><span class="keyword">;<br />
&nbsp; }<br />
&nbsp; elseif (</span><span class="default">$sql_type </span><span class="keyword">== </span><span class="string">'update'</span><span class="keyword">) {<br />
&nbsp;&nbsp;&nbsp; if (!isset(</span><span class="default">$sql_condition</span><span class="keyword">)) {<br />
&nbsp;&nbsp; &nbsp;&nbsp; echo </span><span class="string">'ERROR: You must enter a sql condition!'</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp;&nbsp; exit;<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$sql </span><span class="keyword">= </span><span class="string">"UPDATE </span><span class="default">$table</span><span class="string"> SET </span><span class="default">$fields</span><span class="string"> WHERE </span><span class="default">$sql_condition</span><span class="string">"</span><span class="keyword">;<br />
&nbsp; }<br />
&nbsp; else {<br />
&nbsp;&nbsp;&nbsp; echo </span><span class="string">'ERROR: Invalid input for argument $sql_type: must be "insert" or "update"'</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; exit;<br />
&nbsp; }<br />
&nbsp; <br />
&nbsp; </span><span class="comment">// execute sql<br />
&nbsp; </span><span class="keyword">if (</span><span class="default">mysql_query</span><span class="keyword">(</span><span class="default">$sql</span><span class="keyword">)) {<br />
&nbsp;&nbsp;&nbsp; return </span><span class="default">true</span><span class="keyword">;<br />
&nbsp; }<br />
&nbsp; else {<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">//echo mysql_error();<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">return </span><span class="default">false</span><span class="keyword">;<br />
&nbsp; }<br />
<br />
} </span><span class="comment">// end of function formToDB()<br />
<br />
// Example for inserting new row<br />
</span><span class="default">formToDB</span><span class="keyword">(</span><span class="string">'users'</span><span class="keyword">, </span><span class="string">'submit, '</span><span class="keyword">);<br />
<br />
</span><span class="comment">// Example for updating existing row<br />
</span><span class="default">formToDB</span><span class="keyword">(</span><span class="string">'users'</span><span class="keyword">, </span><span class="string">'submit, userID, '</span><span class="keyword">, </span><span class="string">'update'</span><span class="keyword">, </span><span class="string">"userID = '"</span><span class="keyword">.</span><span class="default">$_POST</span><span class="keyword">[</span><span class="string">'userID'</span><span class="keyword">].</span><span class="string">"'"</span><span class="keyword">);<br />
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="77350""></a>
  <div class="note">
   <strong class="user">ollitech at gmail dot com</strong>
   <a href="#77350" class="date">25-Aug-2007 07:53</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Running an invalid delete query may not return false.<br />
<br />
Invalid because no such record exists.<br />
<br />
Code;<br />
<br />
[php]<br />
&nbsp;&nbsp;&nbsp; //&nbsp; execute it<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $result=mysql_query($sql_delete_byindex);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if(!$result||$result==FALSE){<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; echo("&lt;h1&gt;Error occured while removing listing #: &lt;i&gt;".$rec_index."&lt;/i&gt; &lt;/H1&gt;");&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }else if($result==TRUE){<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; echo("&lt;h1&gt;Listing #: &lt;i&gt;".$rec_index."&lt;/i&gt; Deleted!&lt;/H1&gt;");<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; echo "&lt;a href=\"index.php\"&gt;Go to Start Page&lt;/a&gt;";<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
[/php]<br />
<br />
Query;<br />
[code]<br />
$sql_delete_byindex = "DELETE FROM `$mysql_table` WHERE `index` = '".$rec_index."' AND `key` = '".$key."'";&nbsp; &nbsp; <br />
[/code]<br />
<br />
result will be TRUE</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="76991""></a>
  <div class="note">
   <strong class="user">halion at gmail dot com</strong>
   <a href="#76991" class="date">09-Aug-2007 11:53</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
mysql_query doesnt support multiple queries, a way round this is to use innodb and transactions<br />
<br />
this db class/function will accept an array of arrays of querys, it will auto check every line for affected rows in db, if one is 0 it will rollback and return false, else it will commit and return true, the call to the function is simple and is easy to read etc<br />
----------<br />
<br />
class MySQLDB<br />
{<br />
&nbsp;&nbsp; private $connection;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; // The MySQL database connection<br />
<br />
&nbsp;&nbsp; /* Class constructor */<br />
&nbsp;&nbsp; function MySQLDB(){<br />
&nbsp;&nbsp; &nbsp;&nbsp; /* Make connection to database */<br />
&nbsp;&nbsp; &nbsp;&nbsp; $this-&gt;connection = mysql_connect(DB_SERVER, DB_USER, DB_PASS) or die(mysql_error());<br />
&nbsp;&nbsp; &nbsp;&nbsp; mysql_select_db(DB_NAME, $this-&gt;connection) or die(mysql_error());<br />
&nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp; /* Transactions functions */<br />
<br />
&nbsp;&nbsp; function begin(){<br />
&nbsp;&nbsp; &nbsp;&nbsp; $null = mysql_query("START TRANSACTION", $this-&gt;connection);<br />
&nbsp;&nbsp; &nbsp;&nbsp; return mysql_query("BEGIN", $this-&gt;connection);<br />
&nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp; function commit(){<br />
&nbsp;&nbsp; &nbsp;&nbsp; return mysql_query("COMMIT", $this-&gt;connection);<br />
&nbsp;&nbsp; }<br />
&nbsp;&nbsp; <br />
&nbsp;&nbsp; function rollback(){<br />
&nbsp;&nbsp; &nbsp;&nbsp; return mysql_query("ROLLBACK", $this-&gt;connection);<br />
&nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp; function transaction($q_array){<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; $retval = 1;<br />
<br />
&nbsp;&nbsp; &nbsp;&nbsp; $this-&gt;begin();<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; foreach($q_array as $qa){<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $result = mysql_query($qa['query'], $this-&gt;connection);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if(mysql_affected_rows() == 0){ $retval = 0; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; }<br />
<br />
&nbsp;&nbsp; &nbsp;&nbsp; if($retval == 0){<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; $this-&gt;rollback();<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; return false;<br />
&nbsp;&nbsp; &nbsp;&nbsp; }else{<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; $this-&gt;commit();<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; return true;<br />
&nbsp;&nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; }<br />
<br />
};<br />
<br />
/* Create database connection object */<br />
$database = new MySQLDB;<br />
<br />
// then from anywhere else simply put the transaction queries in an array or arrays like this:<br />
<br />
&nbsp;&nbsp; function function(){<br />
&nbsp;&nbsp; &nbsp;&nbsp; global $database;<br />
<br />
&nbsp;&nbsp; &nbsp;&nbsp; $q = array ( <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; array("query" =&gt; "UPDATE table WHERE something = 'something'"),<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; array("query" =&gt; "UPDATE table WHERE something_else = 'something_else'"),<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; array("query" =&gt; "DELETE FROM table WHERE something_else2 = 'something_else2'"),<br />
&nbsp;&nbsp; &nbsp;&nbsp; );<br />
<br />
&nbsp;&nbsp; &nbsp;&nbsp; $database-&gt;transaction($q);<br />
<br />
&nbsp;&nbsp; }</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="76848""></a>
  <div class="note">
   <strong class="user">jack dot whoami at gmail dot com</strong>
   <a href="#76848" class="date">02-Aug-2007 03:13</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Simulating an atomic operation for application locks using mysql.<br />
<br />
$link = mysql_connect('localhost', 'user', 'pass');<br />
if (!$link) {<br />
&nbsp;&nbsp;&nbsp; die('Not connected : ' . mysql_error());<br />
}<br />
<br />
// make foo the current db<br />
$db_selected = mysql_select_db('foo', $link);<br />
if (!$db_selected) {<br />
&nbsp;&nbsp;&nbsp; die ('Can\'t use foo : ' . mysql_error());<br />
}<br />
<br />
$q = "update `table` set `LOCK`='F' where `ID`='1'";<br />
$lock = mysql_affected_rows();<br />
<br />
If we assume<br />
&nbsp;&nbsp; &nbsp; NOT LOCKED = "" (empty string)<br />
&nbsp;&nbsp; &nbsp; LOCKED = 'F'<br />
<br />
then if the column LOCK had a value other than F (normally should be an empty string) the update statement sets it to F and set the affected rows to 1. Which mean than we got the lock.<br />
If affected rows return 0 then the value of that column was already F and somebody else has the lock.<br />
<br />
The secret lies in the following statement taken from the mysql manual:<br />
"If you set a column to the value it currently has, MySQL notices this and does not update it."<br />
<br />
Of course all this is possible if the all application processes agree on the locking algorithm.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="73755""></a>
  <div class="note">
   <strong class="user">JustinB at harvest dot org</strong>
   <a href="#73755" class="date">09-Mar-2007 01:01</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If you're looking to create a dynamic dropdown list or pull the possible values of an ENUM field for other reasons, here's a handy function:<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="comment">// Function to Return All Possible ENUM Values for a Field<br />
</span><span class="keyword">function </span><span class="default">getEnumValues</span><span class="keyword">(</span><span class="default">$table</span><span class="keyword">, </span><span class="default">$field</span><span class="keyword">) {<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$enum_array </span><span class="keyword">= array();<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$query </span><span class="keyword">= </span><span class="string">'SHOW COLUMNS FROM `' </span><span class="keyword">. </span><span class="default">$table </span><span class="keyword">. </span><span class="string">'` LIKE "' </span><span class="keyword">. </span><span class="default">$field </span><span class="keyword">. </span><span class="string">'"'</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$result </span><span class="keyword">= </span><span class="default">mysql_query</span><span class="keyword">(</span><span class="default">$query</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$row </span><span class="keyword">= </span><span class="default">mysql_fetch_row</span><span class="keyword">(</span><span class="default">$result</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">preg_match_all</span><span class="keyword">(</span><span class="string">'/\'(.*?)\'/'</span><span class="keyword">, </span><span class="default">$row</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">], </span><span class="default">$enum_array</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; if(!empty(</span><span class="default">$enum_array</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">])) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// Shift array keys to match original enumerated index in MySQL (allows for use of index values instead of strings)<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">foreach(</span><span class="default">$enum_array</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">] as </span><span class="default">$mkey </span><span class="keyword">=&gt; </span><span class="default">$mval</span><span class="keyword">) </span><span class="default">$enum_fields</span><span class="keyword">[</span><span class="default">$mkey</span><span class="keyword">+</span><span class="default">1</span><span class="keyword">] = </span><span class="default">$mval</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">$enum_fields</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; else return array(); </span><span class="comment">// Return an empty array to avoid possible errors/warnings if array is passed to foreach() without first being checked with !empty().<br />
</span><span class="keyword">}<br />
</span><span class="default">?&gt;<br />
</span><br />
This function asumes an existing MySQL connection and that desired DB is already selected.<br />
<br />
Since this function returns an array with the original enumerated index numbers, you can use these in any later UPDATEs or INSERTS in your script instead of having to deal with the string values.&nbsp; Also, since these are integers, you can typecast them as such using (int) when building your queries--which is much easer for SQL injection filtering than a string value.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="73357""></a>
  <div class="note">
   <strong class="user">massiv at nerdshack dot com</strong>
   <a href="#73357" class="date">19-Feb-2007 03:29</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Small change in mysql_dump function, to remove the ";" char at the end of the query.<br />
<br />
&lt;?<br />
&nbsp; function parse_mysql_dump($url, $ignoreerrors = false) {<br />
&nbsp;&nbsp; $file_content = file($url);<br />
&nbsp;&nbsp; //print_r($file_content);<br />
&nbsp;&nbsp; $query = "";<br />
&nbsp;&nbsp; foreach($file_content as $sql_line) {<br />
&nbsp;&nbsp; &nbsp; $tsl = trim($sql_line);<br />
&nbsp;&nbsp; &nbsp; if (($sql_line != "") &amp;&amp; (substr($tsl, 0, 2) != "--") &amp;&amp; (substr($tsl, 0, 1) != "#")) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; $query .= $sql_line;<br />
&nbsp;&nbsp; &nbsp; &nbsp; if(preg_match("/;\s*$/", $sql_line)) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; $query = str_replace(";", "", "$query");<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; $result = mysql_query($query);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; if (!$result &amp;&amp; !$ignoreerrors) die(mysql_error());<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; $query = "";<br />
&nbsp;&nbsp; &nbsp; &nbsp; }<br />
&nbsp;&nbsp; &nbsp; }<br />
&nbsp;&nbsp; }<br />
&nbsp; }<br />
?&gt;<br />
<br />
... Massimo</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="71793""></a>
  <div class="note">
   <strong class="user">noah at missionecommerce dot com</strong>
   <a href="#71793" class="date">16-Dec-2006 03:26</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I got so tired of having to type out all the 11 letters in "mysql_query()" and even more tired of having to iterate through the result set....<br />
<br />
So I created the perfect little all purpose wrapper function, called "q()";<br />
<br />
&lt;?<br />
function q($query,$assoc=1) {<br />
&nbsp;&nbsp;&nbsp; $r = @mysql_query($query);<br />
&nbsp;&nbsp;&nbsp; if( mysql_errno() ) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $error = 'MYSQL ERROR #'.mysql_errno().' : &lt;small&gt;' . mysql_error(). '&lt;/small&gt;&lt;br&gt;&lt;VAR&gt;$query&lt;/VAR&gt;';<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; echo($error); return FALSE;<br />
&nbsp;&nbsp;&nbsp; } <br />
&nbsp;&nbsp;&nbsp; if( strtolower(substr($query,0,6)) != 'select' ) return array(mysql_affected_rows(),mysql_insert_id());<br />
&nbsp;&nbsp;&nbsp; $count = @mysql_num_rows($r);<br />
&nbsp;&nbsp;&nbsp; if( !$count ) return 0;<br />
&nbsp;&nbsp;&nbsp; if( $count == 1 ) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if( $assoc ) $f = mysql_fetch_assoc($r);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; else $f = mysql_fetch_row($r);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; mysql_free_result($r);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if( count($f) == 1 ) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; list($key) = array_keys($f);&nbsp; &nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return $f[$key];<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; } else {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $all = array();<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $all[] = $f;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return $all;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; } else {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $all = array();<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; for( $i = 0; $i &lt; $count; $i++ ) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if( $assoc ) $f = mysql_fetch_assoc($r);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; else $f = mysql_fetch_row($r);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $all[] = $f;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; mysql_free_result($r);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return $all;<br />
&nbsp;&nbsp;&nbsp; }<br />
}<br />
<br />
?&gt;<br />
<br />
Example:<br />
<br />
&lt;?<br />
$r = q('Select id,foo FROM blah');<br />
echo $r[0]['id']; // first row, field 'id' <br />
<br />
// for single field single row selects<br />
// only the value is returned <br />
$count = q('SELECT count(*) from blah');<br />
// $count is the number<br />
?&gt;<br />
<br />
Returns affected_rows and/or insert_id for anything other than select's. If you dont want field name keys then pass 0 for second parameter.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="71387""></a>
  <div class="note">
   <strong class="user">babba at nurfuerspam dot de</strong>
   <a href="#71387" class="date">26-Nov-2006 12:42</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Following function creates a minimal update query by comparing two arrays with old and new values (phpmyadmin-like). An easy way to use it in your forms is to print out the old values in hidden fields with name old[$key] and name the visible form fields new[$key]. Feel free to send comments via mail.<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">function </span><span class="default">getUpdateString</span><span class="keyword">(</span><span class="default">$tablename</span><span class="keyword">, </span><span class="default">$whereclause</span><span class="keyword">, </span><span class="default">$old</span><span class="keyword">, </span><span class="default">$new</span><span class="keyword">) {<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$changedvalues </span><span class="keyword">= </span><span class="string">""</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; foreach(</span><span class="default">$old </span><span class="keyword">as </span><span class="default">$key </span><span class="keyword">=&gt; </span><span class="default">$oldvalue</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$newvalue </span><span class="keyword">= </span><span class="default">$new</span><span class="keyword">[</span><span class="default">$key</span><span class="keyword">];<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if(</span><span class="default">$oldvalue </span><span class="keyword">!= </span><span class="default">$newvalue</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if(</span><span class="default">$changedvalues </span><span class="keyword">!= </span><span class="string">""</span><span class="keyword">)<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$changedvalues </span><span class="keyword">.= </span><span class="string">", "</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$changedvalues </span><span class="keyword">.= </span><span class="string">"`"</span><span class="keyword">.</span><span class="default">$key</span><span class="keyword">.</span><span class="string">"`="</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if(!</span><span class="default">is_numeric</span><span class="keyword">(</span><span class="default">$newvalue</span><span class="keyword">))<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$changedvalues </span><span class="keyword">.= </span><span class="string">"'"</span><span class="keyword">.</span><span class="default">$newvalue</span><span class="keyword">.</span><span class="string">"'"</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; else<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$changedvalues </span><span class="keyword">.= </span><span class="default">$newvalue</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; if(</span><span class="default">$changedvalues </span><span class="keyword">== </span><span class="string">""</span><span class="keyword">)<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="string">""</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; return </span><span class="string">"UPDATE "</span><span class="keyword">.</span><span class="default">$tablename</span><span class="keyword">. </span><span class="string">" SET "</span><span class="keyword">.</span><span class="default">$changedvalues</span><span class="keyword">.</span><span class="string">" WHERE "</span><span class="keyword">.</span><span class="default">$whereclause</span><span class="keyword">;<br />
}<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="70686""></a>
  <div class="note">
   <strong class="user">axiak at mit dot edu</strong>
   <a href="#70686" class="date">24-Oct-2006 02:13</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Gconner at sgi...<br />
<br />
your function breaks when you give it a question mark!<br />
Here's a function which correctly implements what I think you want. I'm using it in a pet project of mine.<br />
<br />
The code:<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">function </span><span class="default">mysql_prepare </span><span class="keyword">(</span><span class="default">$query</span><span class="keyword">, </span><span class="default">$phs </span><span class="keyword">= array()) {<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$phs </span><span class="keyword">= </span><span class="default">array_map</span><span class="keyword">(</span><span class="default">create_function</span><span class="keyword">(</span><span class="string">'$ph'</span><span class="keyword">,<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="string">'return "\'".mysql_real_escape_string($ph)."\'";'</span><span class="keyword">), </span><span class="default">$phs</span><span class="keyword">);<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$curpos </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$curph&nbsp; </span><span class="keyword">= </span><span class="default">count</span><span class="keyword">(</span><span class="default">$phs</span><span class="keyword">)-</span><span class="default">1</span><span class="keyword">;<br />
<br />
&nbsp;&nbsp;&nbsp; for (</span><span class="default">$i</span><span class="keyword">=</span><span class="default">strlen</span><span class="keyword">(</span><span class="default">$query</span><span class="keyword">)-</span><span class="default">1</span><span class="keyword">; </span><span class="default">$i</span><span class="keyword">&gt;</span><span class="default">0</span><span class="keyword">; </span><span class="default">$i</span><span class="keyword">--) {<br />
<br />
&nbsp;&nbsp; &nbsp;&nbsp; if (</span><span class="default">$query</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">] !== </span><span class="string">'?'</span><span class="keyword">)&nbsp; continue;<br />
&nbsp;&nbsp; &nbsp;&nbsp; if (</span><span class="default">$curph </span><span class="keyword">&lt; </span><span class="default">0 </span><span class="keyword">|| !isset(</span><span class="default">$phs</span><span class="keyword">[</span><span class="default">$curph</span><span class="keyword">]))<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$query </span><span class="keyword">= </span><span class="default">substr_replace</span><span class="keyword">(</span><span class="default">$query</span><span class="keyword">, </span><span class="string">'NULL'</span><span class="keyword">, </span><span class="default">$i</span><span class="keyword">, </span><span class="default">1</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp;&nbsp; else<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$query </span><span class="keyword">= </span><span class="default">substr_replace</span><span class="keyword">(</span><span class="default">$query</span><span class="keyword">, </span><span class="default">$phs</span><span class="keyword">[</span><span class="default">$curph</span><span class="keyword">], </span><span class="default">$i</span><span class="keyword">, </span><span class="default">1</span><span class="keyword">);<br />
<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="default">$curph</span><span class="keyword">--;<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; unset(</span><span class="default">$curpos</span><span class="keyword">, </span><span class="default">$curph</span><span class="keyword">, </span><span class="default">$phs</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; return </span><span class="default">$query</span><span class="keyword">;<br />
}<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="70132""></a>
  <div class="note">
   <strong class="user">veyita_angi at hotmail dot com</strong>
   <a href="#70132" class="date">04-Oct-2006 06:35</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
this could be a nice way to print values from 2 tables with a foreign key. i have not yet tested correctly but it should work fine.<br />
<br />
$buscar = mysql_query("SELECT k.*, e.Clasificacion FROM cat_plan_k k, cat_equipo e WHERE Tipo='$tipo' AND k.ID_Eq=a.ID_Eq"); <br />
&nbsp;&nbsp;&nbsp; while ($row=mysql_fetch_array($buscar))<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $nombre = "e.Clasificacion"; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $row[$nombre] = $Clasific; echo $row[$nombre].'convertido en '.$Clasific;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br />
&nbsp;&nbsp;&nbsp; mysql_free_result($buscar);</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="69365""></a>
  <div class="note">
   <strong class="user">cc+php at c2se dot com</strong>
   <a href="#69365" class="date">02-Sep-2006 02:39</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Here's a parameterised query function for MySQL similar to pg_query_params, I've been using something similar for a while now and while there is a slight drop in speed, it's far better than making a mistake escaping the parameters of your query and allowing an SQL injection attack on your server.<br />
<br />
<span class="default">&lt;?php&nbsp;&nbsp; </span><span class="comment"># Parameterised query implementation for MySQL (similar PostgreSQL's PHP function pg_query_params)<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; # Example: mysql_query_params( "SELECT * FROM my_table WHERE col1=$1 AND col2=$2", array( 42, "It's ok" ) );<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">if( !</span><span class="default">function_exists</span><span class="keyword">( </span><span class="string">'mysql_query_params' </span><span class="keyword">) ) {<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; function </span><span class="default">mysql_query_params__callback</span><span class="keyword">( </span><span class="default">$at </span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; global </span><span class="default">$mysql_query_params__parameters</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">$mysql_query_params__parameters</span><span class="keyword">[ </span><span class="default">$at</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">]-</span><span class="default">1 </span><span class="keyword">];<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; function </span><span class="default">mysql_query_params</span><span class="keyword">( </span><span class="default">$query</span><span class="keyword">, </span><span class="default">$parameters</span><span class="keyword">=array(), </span><span class="default">$database</span><span class="keyword">=</span><span class="default">false </span><span class="keyword">) {<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// Escape parameters as required &amp; build parameters for callback function<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">global </span><span class="default">$mysql_query_params__parameters</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; foreach( </span><span class="default">$parameters </span><span class="keyword">as </span><span class="default">$k</span><span class="keyword">=&gt;</span><span class="default">$v </span><span class="keyword">)<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$parameters</span><span class="keyword">[</span><span class="default">$k</span><span class="keyword">] = ( </span><span class="default">is_int</span><span class="keyword">( </span><span class="default">$v </span><span class="keyword">) ? </span><span class="default">$v </span><span class="keyword">: ( </span><span class="default">NULL</span><span class="keyword">===</span><span class="default">$v </span><span class="keyword">? </span><span class="string">'NULL' </span><span class="keyword">: </span><span class="string">"'"</span><span class="keyword">.</span><span class="default">mysql_real_escape_string</span><span class="keyword">( </span><span class="default">$v </span><span class="keyword">).</span><span class="string">"'" </span><span class="keyword">) );<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$mysql_query_params__parameters </span><span class="keyword">= </span><span class="default">$parameters</span><span class="keyword">;<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// Call using mysql_query<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">if( </span><span class="default">false</span><span class="keyword">===</span><span class="default">$database </span><span class="keyword">)<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">mysql_query</span><span class="keyword">( </span><span class="default">preg_replace_callback</span><span class="keyword">( </span><span class="string">'/\$([0-9]+)/'</span><span class="keyword">, </span><span class="string">'mysql_query_params__callback'</span><span class="keyword">, </span><span class="default">$query </span><span class="keyword">) );<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; else&nbsp; &nbsp; return </span><span class="default">mysql_query</span><span class="keyword">( </span><span class="default">preg_replace_callback</span><span class="keyword">( </span><span class="string">'/\$([0-9]+)/'</span><span class="keyword">, </span><span class="string">'mysql_query_params__callback'</span><span class="keyword">, </span><span class="default">$query </span><span class="keyword">), </span><span class="default">$database </span><span class="keyword">);<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="69280""></a>
  <div class="note">
   <strong class="user">joe</strong>
   <a href="#69280" class="date">29-Aug-2006 09:45</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
alteration to the script reposted by<br />
webmaster at vs2055067 dot vserver dot de<br />
<br />
&nbsp;&nbsp; $fields = implode(array_keys($toAdd), ',');<br />
&nbsp;&nbsp; $values = "'".implode(array_values($toAdd), "','")."'";<br />
<br />
should really be<br />
<br />
&nbsp;&nbsp; $fields = "`".implode(array_keys($toAdd), '`,`')."`";<br />
&nbsp;&nbsp; $values = "'".implode(array_values($toAdd), "','")."'";<br />
<br />
as keys like `desc` (short for description) cause errors</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="68455""></a>
  <div class="note">
   <strong class="user">webmaster at vs2055067 dot vserver dot de</strong>
   <a href="#68455" class="date">27-Jul-2006 05:03</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
in the first note the function doesn't work and the other function is pretty complicated. Here is the corrected version of the first one and a function for update.<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">function </span><span class="default">mysql_insert</span><span class="keyword">(</span><span class="default">$table</span><span class="keyword">, </span><span class="default">$toAdd</span><span class="keyword">){<br />
<br />
&nbsp;&nbsp; </span><span class="default">$fields </span><span class="keyword">= </span><span class="default">implode</span><span class="keyword">(</span><span class="default">array_keys</span><span class="keyword">(</span><span class="default">$toAdd</span><span class="keyword">), </span><span class="string">','</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$values </span><span class="keyword">= </span><span class="string">"'"</span><span class="keyword">.</span><span class="default">implode</span><span class="keyword">(</span><span class="default">array_values</span><span class="keyword">(</span><span class="default">$toAdd</span><span class="keyword">), </span><span class="string">"','"</span><span class="keyword">).</span><span class="string">"'"</span><span class="keyword">; </span><span class="comment"># better<br />
<br />
&nbsp;&nbsp; </span><span class="default">$q </span><span class="keyword">= </span><span class="string">'INSERT INTO `'</span><span class="keyword">.</span><span class="default">$table</span><span class="keyword">.</span><span class="string">'` ('</span><span class="keyword">.</span><span class="default">$fields</span><span class="keyword">.</span><span class="string">') VALUES ('</span><span class="keyword">.</span><span class="default">$values</span><span class="keyword">.</span><span class="string">')'</span><span class="keyword">;<br />
&nbsp;&nbsp; </span><span class="default">$res </span><span class="keyword">= </span><span class="default">mysql_query</span><span class="keyword">(</span><span class="default">$q</span><span class="keyword">)OR die(</span><span class="default">mysql_error</span><span class="keyword">());<br />
<br />
&nbsp;&nbsp; return </span><span class="default">true</span><span class="keyword">;<br />
&nbsp;&nbsp; <br />
&nbsp;&nbsp; </span><span class="comment">//-- Example of usage<br />
&nbsp;&nbsp; //$tToAdd = array('id'=&gt;3, 'name'=&gt;'Yo', 'salary' =&gt; 5000);<br />
&nbsp;&nbsp; //insertIntoDB('myTable', $tToAdd)<br />
</span><span class="keyword">}<br />
<br />
function </span><span class="default">mysql_update</span><span class="keyword">(</span><span class="default">$table</span><span class="keyword">, </span><span class="default">$update</span><span class="keyword">, </span><span class="default">$where</span><span class="keyword">){<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$fields </span><span class="keyword">= </span><span class="default">array_keys</span><span class="keyword">(</span><span class="default">$update</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$values </span><span class="keyword">= </span><span class="default">array_values</span><span class="keyword">(</span><span class="default">$update</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; </span><span class="default">$i</span><span class="keyword">=</span><span class="default">0</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; </span><span class="default">$query</span><span class="keyword">=</span><span class="string">"UPDATE "</span><span class="keyword">.</span><span class="default">$table</span><span class="keyword">.</span><span class="string">" SET "</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; while(</span><span class="default">$fields</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">]){<br />
&nbsp;&nbsp; &nbsp; &nbsp; if(</span><span class="default">$i</span><span class="keyword">&lt;</span><span class="default">0</span><span class="keyword">){</span><span class="default">$query</span><span class="keyword">.=</span><span class="string">", "</span><span class="keyword">;}<br />
&nbsp;&nbsp; &nbsp; </span><span class="default">$query</span><span class="keyword">.=</span><span class="default">$fields</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">].</span><span class="string">" = '"</span><span class="keyword">.</span><span class="default">$values</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">].</span><span class="string">"'"</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; </span><span class="default">$i</span><span class="keyword">++;<br />
&nbsp;&nbsp; &nbsp; }<br />
&nbsp;&nbsp; &nbsp; </span><span class="default">$query</span><span class="keyword">.=</span><span class="string">" WHERE "</span><span class="keyword">.</span><span class="default">$where</span><span class="keyword">.</span><span class="string">" LIMIT 1;"</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; </span><span class="default">mysql_query</span><span class="keyword">(</span><span class="default">$query</span><span class="keyword">) or die(</span><span class="default">mysql_error</span><span class="keyword">());<br />
&nbsp;&nbsp; &nbsp; return </span><span class="default">true</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; <br />
&nbsp;&nbsp; &nbsp; </span><span class="comment">//Example<br />
&nbsp;&nbsp; &nbsp; // mysql_update('myTable', $anarray, "type = 'main'")<br />
<br />
</span><span class="keyword">}<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="67943""></a>
  <div class="note">
   <strong class="user">rob desbois</strong>
   <a href="#67943" class="date">07-Jul-2006 11:38</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Note that the 'source' command used in the mysql client program is *not* a feature of the server but of the client.<br />
This means that you cannot do<br />
&nbsp;&nbsp; mysql_query('source myfile.sql');<br />
You will get a syntax error. Use LOAD DATA INFILE as an alternative.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="67193""></a>
  <div class="note">
   <strong class="user">cedric ___at___ sadai ___dot___ net</strong>
   <a href="#67193" class="date">05-Jun-2006 05:26</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
This is a quick way for adding data to a table. It is the same way than PEAR::DB, so if you are working on a server without PEAR, it enables you to keep up with your habits.<br />
<br />
<span class="default">&lt;?php<br />
<br />
</span><span class="keyword">function&nbsp; &nbsp; </span><span class="default">insertIntoDB</span><span class="keyword">(</span><span class="default">$table</span><span class="keyword">, </span><span class="default">$toAdd</span><span class="keyword">)<br />
{<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$fields </span><span class="keyword">= </span><span class="default">implode</span><span class="keyword">(</span><span class="default">array_keys</span><span class="keyword">(</span><span class="default">$toAdd</span><span class="keyword">), </span><span class="string">','</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$values </span><span class="keyword">= </span><span class="default">implode</span><span class="keyword">(</span><span class="default">array_values</span><span class="keyword">(</span><span class="default">$toAdd</span><span class="keyword">), </span><span class="string">','</span><span class="keyword">);<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$q </span><span class="keyword">= </span><span class="string">'INSERT INTO `'</span><span class="keyword">.</span><span class="default">$table</span><span class="keyword">.</span><span class="string">'` ('</span><span class="keyword">.</span><span class="default">$fields</span><span class="keyword">.</span><span class="string">') VALUES ('</span><span class="keyword">.</span><span class="default">$values</span><span class="keyword">.</span><span class="string">')'</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$res </span><span class="keyword">= </span><span class="default">mysql_query</span><span class="keyword">(</span><span class="default">$q</span><span class="keyword">)OR die(</span><span class="default">mysql_error</span><span class="keyword">());<br />
<br />
&nbsp;&nbsp;&nbsp; return&nbsp; &nbsp; </span><span class="default">true</span><span class="keyword">;<br />
}<br />
<br />
</span><span class="comment">//-- Example of usage<br />
</span><span class="default">$tToAdd </span><span class="keyword">= array(</span><span class="string">'id'</span><span class="keyword">=&gt;</span><span class="default">3</span><span class="keyword">, </span><span class="string">'name'</span><span class="keyword">=&gt;</span><span class="string">'Yo'</span><span class="keyword">, </span><span class="string">'salary' </span><span class="keyword">=&gt; </span><span class="default">5000</span><span class="keyword">);<br />
</span><span class="default">insertIntoDB</span><span class="keyword">(</span><span class="string">'myTable'</span><span class="keyword">, </span><span class="default">$tToAdd</span><span class="keyword">)<br />
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="63363""></a>
  <div class="note">
   <strong class="user">matt</strong>
   <a href="#63363" class="date">21-Mar-2006 12:45</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Just realised I posted the wrong functions. Oops! <br />
<br />
Here you go....<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">function </span><span class="default">compile_insert_string</span><span class="keyword">(</span><span class="default">$data</span><span class="keyword">) <br />
{&nbsp; &nbsp; <br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$field_names&nbsp; </span><span class="keyword">= </span><span class="string">""</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$field_values </span><span class="keyword">= </span><span class="string">""</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; foreach (</span><span class="default">$data </span><span class="keyword">as </span><span class="default">$k </span><span class="keyword">=&gt; </span><span class="default">$v</span><span class="keyword">) <br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$v </span><span class="keyword">= </span><span class="default">preg_replace</span><span class="keyword">( </span><span class="string">"/'/"</span><span class="keyword">, </span><span class="string">"\\'"</span><span class="keyword">, </span><span class="default">$v </span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">//$v = preg_replace( "/#/", "\\#", $v );<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$field_names&nbsp; </span><span class="keyword">.= </span><span class="string">"</span><span class="default">$k</span><span class="string">,"</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$field_values </span><span class="keyword">.= </span><span class="string">"'</span><span class="default">$v</span><span class="string">',"</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$field_names&nbsp; </span><span class="keyword">= </span><span class="default">preg_replace</span><span class="keyword">( </span><span class="string">"/,$/" </span><span class="keyword">, </span><span class="string">"" </span><span class="keyword">, </span><span class="default">$field_names&nbsp; </span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$field_values </span><span class="keyword">= </span><span class="default">preg_replace</span><span class="keyword">( </span><span class="string">"/,$/" </span><span class="keyword">, </span><span class="string">"" </span><span class="keyword">, </span><span class="default">$field_values </span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; return array(</span><span class="string">'FIELD_NAMES'&nbsp; </span><span class="keyword">=&gt; </span><span class="default">$field_names</span><span class="keyword">,<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="string">'FIELD_VALUES' </span><span class="keyword">=&gt; </span><span class="default">$field_values</span><span class="keyword">,<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; );<br />
}<br />
<br />
</span><span class="comment">//------------------------------------------<br />
// insert_query<br />
//<br />
// Wrapper for an insert query<br />
//------------------------------------------<br />
<br />
</span><span class="keyword">function </span><span class="default">insert_query</span><span class="keyword">(</span><span class="default">$data</span><span class="keyword">, </span><span class="default">$table</span><span class="keyword">)<br />
{<br />
&nbsp;&nbsp;&nbsp; if (!</span><span class="default">is_array</span><span class="keyword">(</span><span class="default">$data</span><span class="keyword">) or </span><span class="default">count</span><span class="keyword">(</span><span class="default">$data</span><span class="keyword">) &lt; </span><span class="default">1</span><span class="keyword">)<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">fatal_error</span><span class="keyword">(</span><span class="string">"Insert data missing"</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$insert </span><span class="keyword">= </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">compile_insert_string</span><span class="keyword">(</span><span class="default">$data</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$query </span><span class="keyword">= </span><span class="string">"INSERT INTO </span><span class="keyword">{</span><span class="default">$table</span><span class="keyword">}</span><span class="string"> ("</span><span class="keyword">.</span><span class="default">$insert</span><span class="keyword">[</span><span class="string">'FIELD_NAMES'</span><span class="keyword">].</span><span class="string">") VALUES ("</span><span class="keyword">.</span><span class="default">$insert</span><span class="keyword">[</span><span class="string">'FIELD_VALUES'</span><span class="keyword">].</span><span class="string">")"</span><span class="keyword">;<br />
<br />
&nbsp;&nbsp;&nbsp; return </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">query</span><span class="keyword">(</span><span class="default">$query</span><span class="keyword">);<br />
}<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="62815""></a>
  <div class="note">
   <strong class="user">yankee at gmeil dot com</strong>
   <a href="#62815" class="date">10-Mar-2006 11:07</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Another shorter possibility to print options of an ENUM as &lt;select&gt;-tag:<br />
<span class="default">&lt;?php<br />
$result</span><span class="keyword">=</span><span class="default">mysql_query</span><span class="keyword">(</span><span class="string">'SHOW COLUMNS FROM &lt;your table&gt; WHERE field=\'&lt;you column&gt;\''</span><span class="keyword">);<br />
while (</span><span class="default">$row</span><span class="keyword">=</span><span class="default">mysql_fetch_row</span><span class="keyword">(</span><span class="default">$result</span><span class="keyword">))<br />
{<br />
&nbsp;&nbsp; foreach(</span><span class="default">explode</span><span class="keyword">(</span><span class="string">"','"</span><span class="keyword">,</span><span class="default">substr</span><span class="keyword">(</span><span class="default">$row</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">],</span><span class="default">6</span><span class="keyword">,-</span><span class="default">2</span><span class="keyword">)) as </span><span class="default">$v</span><span class="keyword">)<br />
&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; print(</span><span class="string">"&lt;option&gt;</span><span class="default">$v</span><span class="string">&lt;/option&gt;"</span><span class="keyword">);<br />
&nbsp;&nbsp; }<br />
}<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="62497""></a>
  <div class="note">
   <strong class="user">gconnor at sgi dot com</strong>
   <a href="#62497" class="date">02-Mar-2006 02:19</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I happily grabbed and used the "mysql_prepare()" function given in the first note above.&nbsp; All is well.<br />
<br />
I made a slight tweak so that I could feed in NULL values without getting an empty string (or 0) instead.<br />
<br />
&nbsp;&nbsp; // mysql_query() wrapper. takes two arguments. first<br />
&nbsp;&nbsp; // is the query with '?' placeholders in it. second argument<br />
&nbsp;&nbsp; // is an array containing the values to substitute in place<br />
&nbsp;&nbsp; // of the placeholders (in order, of course).<br />
&nbsp;&nbsp; // Pass NULL constant in array to get unquoted word NULL<br />
&nbsp;&nbsp; function mysql_prepare ($query, $phs = array()) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; foreach ($phs as $ph) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if ( isset($ph) ) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $ph = "'" . mysql_real_escape_string($ph) . "'";<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; } else {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $ph = "NULL" ;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $query = substr_replace(<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $query, $ph, strpos($query, '?'), 1<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; );<br />
&nbsp;&nbsp; &nbsp; &nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; return mysql_query($query);<br />
&nbsp;&nbsp; }<br />
<br />
Sample function call:<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; // Check to see if all variables are defined<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if ( isset($f_hostid,$f_eventid,$f_owner,$f_comment) ) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; // For numeric values, blank means NULL<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if ( $f_eventid=="" ) { $f_eventid = NULL ; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $result = mysql_prepare(<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; 'UPDATE Hosts SET event_id=?, owner=?, comment=? WHERE id=?',<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; array( $f_eventid,$f_owner,$f_comment, $f_hostid )<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; );<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if (!$result) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $message&nbsp; = 'Error while updating: ' . mysql_error() . "&lt;br /&gt;\n";<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; die($message);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; echo "Update successful. &lt;br /&gt;\n" ;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; } else {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; echo "Missing value.&nbsp; Update failed... check form logic. &lt;br /&gt;\n" ;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="62247""></a>
  <div class="note">
   
   <a href="#62247" class="date">23-Feb-2006 08:11</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If, like me, you come from perl, you may not like having to use sprintf to 'simulate' placeholders that the DBI package from perl provides. I have created the following wrapper function for mysql_query() that allows you to use '?' characters to substitute values in your DB queries. Note that this is not how DBI in perl handles placeholders, but it's pretty similar.<br />
<br />
<span class="default">&lt;?php<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">// mysql_query() wrapper. takes two arguments. first<br />
&nbsp;&nbsp;&nbsp; // is the query with '?' placeholders in it. second argument<br />
&nbsp;&nbsp;&nbsp; // is an array containing the values to substitute in place<br />
&nbsp;&nbsp;&nbsp; // of the placeholders (in order, of course).<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">function </span><span class="default">mysql_prepare </span><span class="keyword">(</span><span class="default">$query</span><span class="keyword">, </span><span class="default">$phs </span><span class="keyword">= array()) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; foreach (</span><span class="default">$phs </span><span class="keyword">as </span><span class="default">$ph</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$ph </span><span class="keyword">= </span><span class="string">"'" </span><span class="keyword">. </span><span class="default">mysql_real_escape_string</span><span class="keyword">(</span><span class="default">$ph</span><span class="keyword">) . </span><span class="string">"'"</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$query </span><span class="keyword">= </span><span class="default">substr_replace</span><span class="keyword">(<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$query</span><span class="keyword">, </span><span class="default">$ph</span><span class="keyword">, </span><span class="default">strpos</span><span class="keyword">(</span><span class="default">$query</span><span class="keyword">, </span><span class="string">'?'</span><span class="keyword">), </span><span class="default">1<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">mysql_query</span><span class="keyword">(</span><span class="default">$query</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">// sample usage<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">list(</span><span class="default">$user</span><span class="keyword">, </span><span class="default">$passwd</span><span class="keyword">) = array(</span><span class="string">'myuser'</span><span class="keyword">, </span><span class="string">'mypass'</span><span class="keyword">);<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$sth </span><span class="keyword">= </span><span class="default">mysql_prepare</span><span class="keyword">(<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="string">'select userid from users where userid=? and passwd=?'</span><span class="keyword">,<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; array(</span><span class="default">$user</span><span class="keyword">, </span><span class="default">sha1</span><span class="keyword">(</span><span class="default">$passwd</span><span class="keyword">))<br />
&nbsp;&nbsp;&nbsp; );<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$row </span><span class="keyword">= </span><span class="default">mysql_fetch_row</span><span class="keyword">(</span><span class="default">$sth</span><span class="keyword">);<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">// successfull username &amp; password authentication<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">if (</span><span class="default">$row </span><span class="keyword">!== </span><span class="default">false</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; echo </span><span class="string">"logging in as '</span><span class="keyword">{</span><span class="default">$row</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">]}</span><span class="string">'!\n"</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">// oops, wrong userid or passwd<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">else {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; echo </span><span class="string">"Invalid username and password combination.\n"</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="62227""></a>
  <div class="note">
   <strong class="user">brjann at no dot gmail dot spam dot com</strong>
   <a href="#62227" class="date">22-Feb-2006 11:07</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Using mysql 4 w/o stored procedures can become quite tedious, especially when writing a lot of standard sql-statements all the time.<br />
<br />
These two functions, standardSQLInsert and standardSQLUpdate, handle most of my uncomplex cases of&nbsp; updating and inserting into tables. Note the use of the quote_smart function, described at <a href="http://php.net/mysql_real_escape_string, making all queries safe." rel="nofollow" target="_blank">http://php.net/mysql_real_escape_string, making all queries safe.</a><br />
<br />
<span class="default">&lt;?php<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">function </span><span class="default">standardSQLInsert</span><span class="keyword">(</span><span class="default">$strTableName</span><span class="keyword">, </span><span class="default">$arrValuePairs</span><span class="keyword">){<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$strSeparator </span><span class="keyword">= </span><span class="string">''</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$strCols </span><span class="keyword">= </span><span class="string">''</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$strValues </span><span class="keyword">= </span><span class="string">''</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; foreach (</span><span class="default">$arrValuePairs </span><span class="keyword">as </span><span class="default">$strCol </span><span class="keyword">=&gt; </span><span class="default">$strValue</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$strCols </span><span class="keyword">= </span><span class="default">$strCols</span><span class="keyword">.</span><span class="default">$strSeparator</span><span class="keyword">.</span><span class="default">$strCol</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$strValues </span><span class="keyword">= </span><span class="default">$strValues</span><span class="keyword">.</span><span class="default">$strSeparator</span><span class="keyword">.</span><span class="default">quote_smart</span><span class="keyword">(</span><span class="default">$strValue</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$strSeparator </span><span class="keyword">= </span><span class="string">','</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">mysql_query</span><span class="keyword">(</span><span class="string">"INSERT INTO </span><span class="default">$strTableName</span><span class="string"> (</span><span class="default">$strCols</span><span class="string">) VALUES(</span><span class="default">$strValues</span><span class="string">)"</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp;&nbsp; function </span><span class="default">standardSQLUpdate</span><span class="keyword">(</span><span class="default">$strTableName</span><span class="keyword">, </span><span class="default">$arrValuePairs</span><span class="keyword">, </span><span class="default">$arrConditionPairs</span><span class="keyword">){<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$strSeparator </span><span class="keyword">= </span><span class="string">''</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$strSetStatements </span><span class="keyword">= </span><span class="string">''</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$strUpdateConditions </span><span class="keyword">= </span><span class="string">''</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; foreach (</span><span class="default">$arrValuePairs </span><span class="keyword">as </span><span class="default">$strCol </span><span class="keyword">=&gt; </span><span class="default">$strValue</span><span class="keyword">){<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$strSetStatements </span><span class="keyword">= </span><span class="default">$strSetStatements</span><span class="keyword">.</span><span class="default">$strSeparator</span><span class="keyword">.</span><span class="default">$strCol</span><span class="keyword">.</span><span class="string">'='</span><span class="keyword">.</span><span class="default">quote_smart</span><span class="keyword">(</span><span class="default">$strValue</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$strSeparator </span><span class="keyword">= </span><span class="string">','</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$strSeparator </span><span class="keyword">= </span><span class="string">''</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; foreach (</span><span class="default">$arrConditionPairs </span><span class="keyword">as </span><span class="default">$strCol </span><span class="keyword">=&gt; </span><span class="default">$strValue</span><span class="keyword">){<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$strUpdateConditions </span><span class="keyword">= </span><span class="default">$strUpdateConditions</span><span class="keyword">.</span><span class="default">$strSeparator</span><span class="keyword">.</span><span class="default">$strCol</span><span class="keyword">.</span><span class="string">'='</span><span class="keyword">.</span><span class="default">quote_smart</span><span class="keyword">(</span><span class="default">$strValue</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$strSeparator </span><span class="keyword">= </span><span class="string">' AND '</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$strUpdateConditions </span><span class="keyword">= </span><span class="string">'('</span><span class="keyword">.</span><span class="default">$strUpdateConditions</span><span class="keyword">.</span><span class="string">')'</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">mysql_query</span><span class="keyword">(</span><span class="string">"UPDATE </span><span class="default">$strTableName</span><span class="string"> SET </span><span class="default">$strSetStatements</span><span class="string"> WHERE </span><span class="default">$strUpdateConditions</span><span class="string">"</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; }<br />
<br />
</span><span class="comment">//example<br />
</span><span class="default">$arrValuePairs </span><span class="keyword">= array(</span><span class="string">'Col1' </span><span class="keyword">=&gt; </span><span class="string">'Value1'</span><span class="keyword">, </span><span class="string">'Col2' </span><span class="keyword">=&gt; </span><span class="string">'Value2'</span><span class="keyword">);<br />
</span><span class="default">$arrConditionPairs </span><span class="keyword">= array(</span><span class="string">'Col3' </span><span class="keyword">=&gt; </span><span class="string">'Value3'</span><span class="keyword">, </span><span class="string">'Col4' </span><span class="keyword">=&gt; </span><span class="string">'Value4'</span><span class="keyword">);<br />
<br />
</span><span class="default">standardSQLInsert</span><span class="keyword">(</span><span class="string">'mytable'</span><span class="keyword">,</span><span class="default">$arrValuePairs</span><span class="keyword">);<br />
</span><span class="comment">//yields "INSERT INTO mytable (Col1,Col2) VALUES ('Value1','Value2')"<br />
<br />
</span><span class="default">standardSQLUpdate</span><span class="keyword">(</span><span class="string">'mytable'</span><span class="keyword">,</span><span class="default">$arrValuePairs</span><span class="keyword">,</span><span class="default">$arrConditionPairs</span><span class="keyword">);<br />
</span><span class="comment">//yields "UPDATE mytable SET Col1 = 'Value1', Col2 = 'Value2' WHERE (Col3 = 'Value3' AND Col4 = 'Value4')"<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="59857""></a>
  <div class="note">
   <strong class="user">Harmor</strong>
   <a href="#59857" class="date">18-Dec-2005 02:32</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Modification of hipsurgery submission.&nbsp; Here's a utility function that will return an array of a table.&nbsp; Don't forget to connect to the DB before calling this function.<br />
<span class="default">&lt;?php<br />
</span><span class="comment">//Returns an array[columnName] = value of a $table_name<br />
</span><span class="keyword">function </span><span class="default">table_to_array</span><span class="keyword">(</span><span class="default">$table_name</span><span class="keyword">)<br />
{<br />
&nbsp; </span><span class="default">$columns </span><span class="keyword">= array();<br />
<br />
&nbsp; </span><span class="default">$result_all</span><span class="keyword">= </span><span class="default">mysql_query</span><span class="keyword">(</span><span class="string">"SELECT * FROM </span><span class="default">$table_name</span><span class="string">"</span><span class="keyword">);<br />
&nbsp; </span><span class="default">$result_columns </span><span class="keyword">= </span><span class="default">mysql_query</span><span class="keyword">(</span><span class="string">"SHOW COLUMNS FROM </span><span class="default">$table_name</span><span class="string">"</span><span class="keyword">);<br />
<br />
&nbsp; </span><span class="comment">//get the columns from the table into $colums[]&nbsp; <br />
&nbsp; </span><span class="keyword">while (</span><span class="default">$columnRow </span><span class="keyword">= </span><span class="default">mysql_fetch_array</span><span class="keyword">(</span><span class="default">$result_columns</span><span class="keyword">, </span><span class="default">MYSQL_ASSOC</span><span class="keyword">))<br />
&nbsp; {<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$columns</span><span class="keyword">[] = </span><span class="default">$columnRow<br />
&nbsp; </span><span class="keyword">}<br />
<br />
&nbsp; while (</span><span class="default">$data </span><span class="keyword">= </span><span class="default">mysql_fetch_assoc</span><span class="keyword">(</span><span class="default">$result_all</span><span class="keyword">, </span><span class="default">MYSQL_ASSOC</span><span class="keyword">))<br />
&nbsp; {<br />
&nbsp;&nbsp;&nbsp; foreach (</span><span class="default">$columns </span><span class="keyword">as </span><span class="default">$column_name</span><span class="keyword">)<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="default">$array</span><span class="keyword">[</span><span class="default">$column_name</span><span class="keyword">] = </span><span class="default">$data</span><span class="keyword">[</span><span class="default">$column_name</span><span class="keyword">];<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp; }<br />
return </span><span class="default">$array</span><span class="keyword">;<br />
}<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="58483""></a>
  <div class="note">
   <strong class="user">hipsurgery at gmail dot com</strong>
   <a href="#58483" class="date">05-Nov-2005 07:30</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
This function will take the contents of any MySQL table, given only the table name, and return it as an index / associative multi-dimensional array in the form of:<br />
<br />
$array[$row_number][$column_name] = $value;<br />
<br />
I've found this very useful when you don't want to parse the table's contents in to HTML tags during a mysql_fetch_array() iteration.<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">function </span><span class="default">db_to_array</span><span class="keyword">(</span><span class="default">$table_name</span><span class="keyword">) {<br />
<br />
</span><span class="default">$cols </span><span class="keyword">= array();<br />
</span><span class="default">$x</span><span class="keyword">=</span><span class="default">0</span><span class="keyword">;<br />
</span><span class="default">$this_row</span><span class="keyword">=</span><span class="default">0</span><span class="keyword">;<br />
<br />
</span><span class="default">mysql_connect</span><span class="keyword">(</span><span class="default">HOST</span><span class="keyword">,</span><span class="default">USERNAME</span><span class="keyword">,</span><span class="default">PASSWORD</span><span class="keyword">);<br />
@</span><span class="default">mysql_select_db</span><span class="keyword">(</span><span class="default">DATABASE</span><span class="keyword">) or die( </span><span class="string">"Unable to select database"</span><span class="keyword">);<br />
<br />
</span><span class="default">$result_all</span><span class="keyword">=</span><span class="default">mysql_query</span><span class="keyword">(</span><span class="string">"SELECT * FROM </span><span class="default">$table_name</span><span class="string">"</span><span class="keyword">);<br />
</span><span class="default">$result_cols </span><span class="keyword">= </span><span class="default">mysql_query</span><span class="keyword">(</span><span class="string">"SHOW COLUMNS FROM </span><span class="default">$table_name</span><span class="string">"</span><span class="keyword">);<br />
<br />
</span><span class="default">mysql_close</span><span class="keyword">();<br />
<br />
</span><span class="default">$numfields </span><span class="keyword">= </span><span class="default">mysql_num_fields</span><span class="keyword">(</span><span class="default">$result_all</span><span class="keyword">);<br />
<br />
for(</span><span class="default">$i</span><span class="keyword">=</span><span class="default">0</span><span class="keyword">;</span><span class="default">$i</span><span class="keyword">&lt;</span><span class="default">mysql_num_rows</span><span class="keyword">(</span><span class="default">$result_cols</span><span class="keyword">);</span><span class="default">$i</span><span class="keyword">++)<br />
&nbsp; {<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$cols</span><span class="keyword">[] = </span><span class="default">mysql_result</span><span class="keyword">(</span><span class="default">$result_cols</span><span class="keyword">, </span><span class="default">$i</span><span class="keyword">);<br />
&nbsp; }<br />
<br />
while (</span><span class="default">$data </span><span class="keyword">= </span><span class="default">mysql_fetch_assoc</span><span class="keyword">(</span><span class="default">$result_all</span><span class="keyword">))<br />
&nbsp; {<br />
&nbsp;&nbsp;&nbsp; if (</span><span class="default">$x</span><span class="keyword">&lt;</span><span class="default">$numfields</span><span class="keyword">)<br />
&nbsp;&nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$x</span><span class="keyword">++;<br />
&nbsp;&nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; else<br />
&nbsp;&nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$x </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this_row</span><span class="keyword">++;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; }<br />
<br />
&nbsp;&nbsp;&nbsp; foreach (</span><span class="default">$cols </span><span class="keyword">as </span><span class="default">$col_name</span><span class="keyword">)<br />
&nbsp;&nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$array</span><span class="keyword">[</span><span class="default">$this_row</span><span class="keyword">][</span><span class="default">$col_name</span><span class="keyword">] = </span><span class="default">$data</span><span class="keyword">[</span><span class="default">$col_name</span><span class="keyword">];<br />
&nbsp;&nbsp; &nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">mysql_data_seek</span><span class="keyword">(</span><span class="default">$result_all</span><span class="keyword">, </span><span class="default">$this_row</span><span class="keyword">); <br />
&nbsp; <br />
&nbsp; }<br />
<br />
return </span><span class="default">$array</span><span class="keyword">;<br />
<br />
}<br />
<br />
</span><span class="comment">// Test the function...<br />
<br />
</span><span class="default">$test_array </span><span class="keyword">= </span><span class="default">db_to_array</span><span class="keyword">(</span><span class="string">"shows"</span><span class="keyword">);<br />
<br />
foreach (</span><span class="default">$test_array </span><span class="keyword">as </span><span class="default">$outer_key </span><span class="keyword">=&gt; </span><span class="default">$single_array</span><span class="keyword">)<br />
&nbsp; {<br />
&nbsp;&nbsp;&nbsp; foreach (</span><span class="default">$single_array </span><span class="keyword">as </span><span class="default">$inner_key </span><span class="keyword">=&gt; </span><span class="default">$value</span><span class="keyword">)<br />
&nbsp;&nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; echo </span><span class="string">"\$test_array[</span><span class="default">$outer_key</span><span class="string">][</span><span class="default">$inner_key</span><span class="string">] = </span><span class="default">$value</span><span class="string">&lt;br /&gt;"</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp;&nbsp; }&nbsp; <br />
&nbsp; }<br />
</span><span class="default">?&gt;<br />
</span><br />
I'm just a hobbyist, so feel free to comment on my code or (worse!) tell me that there's some native PHP function that already does this!</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="58155""></a>
  <div class="note">
   <strong class="user">congaz at yahoo dot dk</strong>
   <a href="#58155" class="date">25-Oct-2005 11:46</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Here's a little trick to help you keep track of MySQL table/column names, and the values you want to insert/select.<br />
<br />
I always use constants instead of variables for my table/column names. The script that define the constants can then dynamically be set to initialize different table/column names if needed. However, here comes the trick.<br />
<br />
Say you have an Insert statement like this:<br />
<span class="default">&lt;?=<br />
</span><span class="comment">// define(TABLE_DOCUMENT, 'table_name');<br />
// define(COL_DOC_PUBLIC, 'column_name');<br />
// etc....<br />
<br />
</span><span class="default">$sql </span><span class="keyword">=&nbsp; &nbsp;&nbsp; </span><span class="string">"INSERT INTO "</span><span class="keyword">.</span><span class="default">TABLE_DOCUMENT</span><span class="keyword">.</span><span class="string">"<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; ("</span><span class="keyword">.</span><span class="default">COL_DOC_PUBLIC</span><span class="keyword">.</span><span class="string">", "</span><span class="keyword">.</span><span class="default">COL_DOC_UPLOAD_TSTAMP</span><span class="keyword">.</span><span class="string">", "</span><span class="keyword">.</span><span class="default">COL_DOC_CREATOR_NAME</span><span class="keyword">.</span><span class="string">") VALUES ("</span><span class="keyword">.</span><span class="default">$doc_public</span><span class="keyword">.</span><span class="string">", "</span><span class="keyword">.</span><span class="default">$doc_upload_tstamp</span><span class="keyword">.</span><span class="string">", "</span><span class="keyword">.</span><span class="default">$doc_name</span><span class="keyword">.</span><span class="string">")"</span><span class="keyword">;<br />
</span><span class="default">?&gt;<br />
</span>Now, with long insert statements, I find it easy to loose track of which values goes with which column names. If I somehow could use the constants as variable names, keeping track of all that sql mishmash would be quite a lot easier.<br />
<br />
As it turns out, constants names can be used as variable variables (not quite the correct definition when we're actually dealing with constants, but what the heck).<br />
<br />
So,the sql above could instead be like this:<br />
<span class="default">&lt;?=<br />
</span><span class="keyword">${</span><span class="default">COL_DOC_PUBLIC</span><span class="keyword">} = </span><span class="default">$doc_public</span><span class="keyword">;<br />
${</span><span class="default">COL_DOC_UPLOAD_TSTAMP</span><span class="keyword">} = </span><span class="default">$doc_upload_tstamp</span><span class="keyword">;<br />
${</span><span class="default">COL_DOC_CREATOR_NAME</span><span class="keyword">} = </span><span class="default">$doc_name</span><span class="keyword">;<br />
<br />
</span><span class="default">$sql </span><span class="keyword">=&nbsp; &nbsp;&nbsp; </span><span class="string">"INSERT INTO "</span><span class="keyword">.</span><span class="default">TABLE_DOCUMENT</span><span class="keyword">.</span><span class="string">"<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; ("</span><span class="keyword">.</span><span class="default">COL_DOC_PUBLIC</span><span class="keyword">.</span><span class="string">", "</span><span class="keyword">.</span><span class="default">COL_DOC_UPLOAD_TSTAMP</span><span class="keyword">.</span><span class="string">", "</span><span class="keyword">.</span><span class="default">COL_DOC_CREATOR_NAME</span><span class="keyword">.</span><span class="string">") VALUES ("</span><span class="keyword">.${</span><span class="default">COL_DOC_PUBLIC</span><span class="keyword">}.</span><span class="string">", "</span><span class="keyword">.${</span><span class="default">COL_DOC_UPLOAD_TSTAMP</span><span class="keyword">}.</span><span class="string">", "</span><span class="keyword">.${</span><span class="default">COL_DOC_CREATOR_NAME</span><span class="keyword">}.</span><span class="string">")"</span><span class="keyword">;<br />
</span><span class="default">?&gt;<br />
</span>This little trick made things alot easier for me - especially when dealing with extended querys, where you might have to use the same values in severel insert/select statements. Another thing is, that you can wait to use addslashes()/my_sql_real_escape_string until you create the "variable constants" - thus the task of remebering which values have been prepared to be used in an sql-statement has become fool-proof.<br />
<br />
Hope somebody finds this usefull...</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="57377""></a>
  <div class="note">
   <strong class="user">php at arcannon dot com</strong>
   <a href="#57377" class="date">02-Oct-2005 12:30</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I believe there is a typo in celtic at raven-blue dot com version with:<br />
<br />
if (($sql != "") &amp;&amp; (substr($tsl, 0, 2) != "--") &amp;&amp; (substr($tsl, 0, 1) != "#")) {<br />
<br />
I think you really ment: <br />
<br />
if (($tsl != "") &amp;&amp; (substr($tsl, 0, 2) != "--") &amp;&amp; (substr($tsl, 0, 1) != "#")) {<br />
<br />
I changed the $sql to $tsl</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="56636""></a>
  <div class="note">
   <strong class="user">celtic at raven-blue dot com</strong>
   <a href="#56636" class="date">10-Sep-2005 04:03</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Here's a revision of ix at nivelzero -and- thomas at pixur's code. This SQL dump parser fixes the check for comments that was present in the old (ie. a '--' located anywhere in the string would make it ignore that line!), and adds the check for the # comment. That had me thinking.<br />
<br />
<span class="default">&lt;?php<br />
&nbsp; </span><span class="keyword">function </span><span class="default">parse_mysql_dump</span><span class="keyword">(</span><span class="default">$url</span><span class="keyword">, </span><span class="default">$ignoreerrors </span><span class="keyword">= </span><span class="default">false</span><span class="keyword">) {<br />
&nbsp;&nbsp; </span><span class="default">$file_content </span><span class="keyword">= </span><span class="default">file</span><span class="keyword">(</span><span class="default">$url</span><span class="keyword">);<br />
&nbsp;&nbsp; </span><span class="default">$query </span><span class="keyword">= </span><span class="string">""</span><span class="keyword">;<br />
&nbsp;&nbsp; foreach(</span><span class="default">$file_content </span><span class="keyword">as </span><span class="default">$sql_line</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; </span><span class="default">$tsl </span><span class="keyword">= </span><span class="default">trim</span><span class="keyword">(</span><span class="default">$sql_line</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; if ((</span><span class="default">$sql </span><span class="keyword">!= </span><span class="string">""</span><span class="keyword">) &amp;&amp; (</span><span class="default">substr</span><span class="keyword">(</span><span class="default">$tsl</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">2</span><span class="keyword">) != </span><span class="string">"--"</span><span class="keyword">) &amp;&amp; (</span><span class="default">substr</span><span class="keyword">(</span><span class="default">$tsl</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">1</span><span class="keyword">) != </span><span class="string">"#"</span><span class="keyword">)) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; </span><span class="default">$query </span><span class="keyword">.= </span><span class="default">$sql_line</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; if(</span><span class="default">preg_match</span><span class="keyword">(</span><span class="string">"/;\s*$/"</span><span class="keyword">, </span><span class="default">$sql_line</span><span class="keyword">)) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$result </span><span class="keyword">= </span><span class="default">mysql_query</span><span class="keyword">(</span><span class="default">$query</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; if (!</span><span class="default">$result </span><span class="keyword">&amp;&amp; !</span><span class="default">$ignoreerrors</span><span class="keyword">) die(</span><span class="default">mysql_error</span><span class="keyword">());<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$query </span><span class="keyword">= </span><span class="string">""</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; }<br />
&nbsp;&nbsp; &nbsp; }<br />
&nbsp;&nbsp; }<br />
&nbsp; }<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="55811""></a>
  <div class="note">
   <strong class="user">ix at nivelzero dot ro</strong>
   <a href="#55811" class="date">14-Aug-2005 12:07</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
here's a script for parsing a *.sql file (tested only on dumps created with phpMyAdmin) which is short and simple (why do people say "here's a short and simple script" and it has a 100 lines?). the script skips comments and allows ; to be present within the querys<br />
<br />
<span class="default">&lt;?php<br />
&nbsp; </span><span class="keyword">function </span><span class="default">parse_mysql_dump</span><span class="keyword">(</span><span class="default">$url</span><span class="keyword">){<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$file_content </span><span class="keyword">= </span><span class="default">file</span><span class="keyword">(</span><span class="default">$url</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$query </span><span class="keyword">= </span><span class="string">""</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; foreach(</span><span class="default">$file_content </span><span class="keyword">as </span><span class="default">$sql_line</span><span class="keyword">){<br />
&nbsp;&nbsp; &nbsp;&nbsp; if(</span><span class="default">trim</span><span class="keyword">(</span><span class="default">$sql_line</span><span class="keyword">) != </span><span class="string">"" </span><span class="keyword">&amp;&amp; </span><span class="default">strpos</span><span class="keyword">(</span><span class="default">$sql_line</span><span class="keyword">, </span><span class="string">"--"</span><span class="keyword">) === </span><span class="default">false</span><span class="keyword">){<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$query </span><span class="keyword">.= </span><span class="default">$sql_line</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if(</span><span class="default">preg_match</span><span class="keyword">(</span><span class="string">"/;[\040]*\$/"</span><span class="keyword">, </span><span class="default">$sql_line</span><span class="keyword">)){<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$result </span><span class="keyword">= </span><span class="default">mysql_query</span><span class="keyword">(</span><span class="default">$query</span><span class="keyword">)or die(</span><span class="default">mysql_error</span><span class="keyword">());<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$query </span><span class="keyword">= </span><span class="string">""</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp; }<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="52427""></a>
  <div class="note">
   <strong class="user">wjyong at sh163 dot net</strong>
   <a href="#52427" class="date">01-May-2005 01:21</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
The following query is not valid as expected:<br />
<span class="default">&lt;?php<br />
$username </span><span class="keyword">= </span><span class="string">'dicteworld'</span><span class="keyword">;<br />
</span><span class="default">$username</span><span class="keyword">{</span><span class="default">4</span><span class="keyword">} = </span><span class="string">''</span><span class="keyword">;<br />
</span><span class="default">$sql </span><span class="keyword">= </span><span class="string">"SELECT * FROM `user` WHERE `User` = '</span><span class="default">$username</span><span class="string">'"</span><span class="keyword">;<br />
print(</span><span class="default">$sql</span><span class="keyword">); </span><span class="comment">// Result: SELECT * FROM `user` WHERE `User` = 'dictworld'<br />
</span><span class="default">$res </span><span class="keyword">= </span><span class="default">mysql_query</span><span class="keyword">(</span><span class="default">$query</span><span class="keyword">);<br />
</span><span class="default">$row </span><span class="keyword">= </span><span class="default">mysql_fetch_array</span><span class="keyword">(</span><span class="default">$res</span><span class="keyword">);<br />
</span><span class="default">print_r</span><span class="keyword">(</span><span class="default">$row</span><span class="keyword">);</span><span class="comment">// Result: still return Array(), supposed that the user 'dictworld' exists.<br />
</span><span class="default">?&gt;<br />
</span>Pay more attention that null string '' is equivalent to '\0',therefore SQL statement above is equivalent to SELECT * FROM `user` WHERE `User` = 'dict\0world',though printing string is right.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="49375""></a>
  <div class="note">
   <strong class="user">jon at websandbox dot net</strong>
   <a href="#49375" class="date">26-Jan-2005 02:25</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I think it's important to note (for newbies, like me especially) that an empty result is not the same as an error:<br />
<span class="default">&lt;?php<br />
</span><span class="comment">/* 'bar' is an empty table in the db */<br />
</span><span class="default">$rs </span><span class="keyword">= </span><span class="default">mysql_query</span><span class="keyword">(</span><span class="string">"SELECT `foo` FROM `bar`"</span><span class="keyword">)<br />
if(</span><span class="default">$rs</span><span class="keyword">) {<br />
&nbsp; echo </span><span class="default">mysql_num_rows</span><span class="keyword">(</span><span class="default">$rs</span><span class="keyword">); </span><span class="comment">//outputs: 0<br />
</span><span class="keyword">}<br />
<br />
</span><span class="comment">/* malformed query /*<br />
$rs = mysql_query("SELECT `foo` FRO `bar`");<br />
if($rs) {<br />
&nbsp; echo "This will never be echoed";<br />
}<br />
?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="47516""></a>
  <div class="note">
   <strong class="user">andregodin at gmail dot com</strong>
   <a href="#47516" class="date">18-Nov-2004 10:03</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Another "dumping" function but with the optional possibility to choose wich field_name to be dumped.&nbsp; "Have Fun and please email me if you do optimization of this code"<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">function </span><span class="default">mysql_format</span><span class="keyword">(</span><span class="default">$strTemp</span><span class="keyword">){<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">//Format sql sentence for insert<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$bad_chars</span><span class="keyword">= array(</span><span class="string">"\\"</span><span class="keyword">, </span><span class="string">"'"</span><span class="keyword">, </span><span class="string">"\""</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$good_chars </span><span class="keyword">= array(</span><span class="string">"\\\\"</span><span class="keyword">, </span><span class="string">"''"</span><span class="keyword">, </span><span class="string">"\"\""</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; return </span><span class="default">str_replace</span><span class="keyword">(</span><span class="default">$bad_chars</span><span class="keyword">, </span><span class="default">$good_chars</span><span class="keyword">, </span><span class="default">$strTemp</span><span class="keyword">);<br />
}<br />
<br />
function </span><span class="default">mysql_dump_table</span><span class="keyword">(){<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">/*******************\<br />
&nbsp;&nbsp;&nbsp; *&nbsp; MYSQL_DUMP_TABLE&nbsp; *********************************\<br />
&nbsp;&nbsp;&nbsp; *&nbsp; Param?tres :&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; *<br />
&nbsp;&nbsp;&nbsp; *&nbsp; &nbsp; 1- Table Name&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; *<br />
&nbsp;&nbsp;&nbsp; *&nbsp;&nbsp; 2- Field(s) (in string format) Name to be dumped&nbsp; *<br />
&nbsp;&nbsp;&nbsp; *&nbsp; &nbsp; &nbsp;&nbsp; If empty, all field will be dumped&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; *<br />
&nbsp;&nbsp;&nbsp; \******************************************************/<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">if (!(</span><span class="default">func_num_args</span><span class="keyword">())) die (</span><span class="string">"&lt;b&gt;mysql_dump_table&lt;/b&gt;: Need At Least A Table Name"</span><span class="keyword">);<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$arg_list </span><span class="keyword">= </span><span class="default">func_get_args</span><span class="keyword">();<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$arrReturn </span><span class="keyword">= </span><span class="string">""</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$strTblName </span><span class="keyword">= </span><span class="default">mysql_format</span><span class="keyword">(</span><span class="string">"`</span><span class="keyword">{</span><span class="default">$arg_list</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">]}</span><span class="string">`"</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$strFields </span><span class="keyword">= </span><span class="string">"*"</span><span class="keyword">;<br />
<br />
&nbsp;&nbsp;&nbsp; if (</span><span class="default">func_num_args</span><span class="keyword">() &gt; </span><span class="default">1</span><span class="keyword">){<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$strFields </span><span class="keyword">= </span><span class="string">""</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; for (</span><span class="default">$noArg</span><span class="keyword">=</span><span class="default">1</span><span class="keyword">; </span><span class="default">$noArg</span><span class="keyword">&lt;</span><span class="default">func_num_args</span><span class="keyword">(); </span><span class="default">$noArg</span><span class="keyword">++){<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">$strFields</span><span class="keyword">) </span><span class="default">$strFields </span><span class="keyword">.= </span><span class="string">", "</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$strFields </span><span class="keyword">.= </span><span class="string">"`</span><span class="default">$arg_list</span><span class="keyword">[</span><span class="default">$noArg</span><span class="keyword">]</span><span class="string">`"</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$result </span><span class="keyword">= </span><span class="default">mysql_query</span><span class="keyword">(</span><span class="string">"SELECT </span><span class="default">$strFields</span><span class="string"> FROM </span><span class="default">$strTblName</span><span class="string">"</span><span class="keyword">) or die (</span><span class="string">"Incapable d'ex?cuter la requ?te"</span><span class="keyword">);<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$nbRecord </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; while (</span><span class="default">$row </span><span class="keyword">= </span><span class="default">mysql_fetch_assoc</span><span class="keyword">(</span><span class="default">$result</span><span class="keyword">)){<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$strFieldsNames </span><span class="keyword">= </span><span class="string">""</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$strFieldsValues </span><span class="keyword">= </span><span class="string">""</span><span class="keyword">;<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; foreach (</span><span class="default">$row </span><span class="keyword">as </span><span class="default">$field_name </span><span class="keyword">=&gt; </span><span class="default">$field_value</span><span class="keyword">){<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">$strFieldsNames</span><span class="keyword">) </span><span class="default">$strFieldsNames </span><span class="keyword">.= </span><span class="string">", "</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$strFieldsNames </span><span class="keyword">.= </span><span class="string">"`</span><span class="default">$field_name</span><span class="string">`"</span><span class="keyword">;<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if(</span><span class="default">$strFieldsValues</span><span class="keyword">) </span><span class="default">$strFieldsValues </span><span class="keyword">.= </span><span class="string">", "</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$strFieldsValues </span><span class="keyword">.= </span><span class="string">"'" </span><span class="keyword">. </span><span class="default">mysql_format</span><span class="keyword">(</span><span class="default">$field_value</span><span class="keyword">) . </span><span class="string">"'"</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$arrReturn</span><span class="keyword">[</span><span class="default">$nbRecord</span><span class="keyword">++] = </span><span class="string">"INSERT INTO </span><span class="default">$strTblName</span><span class="string">(</span><span class="default">$strFieldsNames</span><span class="string">) values(</span><span class="default">$strFieldsValues</span><span class="string">);"</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">mysql_free_result</span><span class="keyword">(</span><span class="default">$result</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; return </span><span class="default">$arrReturn</span><span class="keyword">;<br />
}<br />
<br />
require_once(</span><span class="string">"config_connexion_db_test.php"</span><span class="keyword">);<br />
<br />
</span><span class="comment">/****************<br />
* AUTRE EXEMPLE&nbsp; **********************************************<br />
*&nbsp; &nbsp; Vous pouvez d?cider d'afficher quelques champs seulements *<br />
*&nbsp; en sp?cifiant les champs d?sir?&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; *<br />
**************************************************************/<br />
</span><span class="default">$db </span><span class="keyword">= </span><span class="default">mysql_connect</span><span class="keyword">(</span><span class="default">DBTEST_HOST</span><span class="keyword">, </span><span class="default">DBTEST_USER</span><span class="keyword">, </span><span class="default">DBTEST_PASSWORD</span><span class="keyword">) or die(</span><span class="string">"Impossible de se connecter : "</span><span class="keyword">);<br />
</span><span class="default">mysql_select_db</span><span class="keyword">(</span><span class="default">DBTEST_NAME</span><span class="keyword">, </span><span class="default">$db</span><span class="keyword">);<br />
<br />
</span><span class="default">$result </span><span class="keyword">= </span><span class="default">mysql_dump_table</span><span class="keyword">(</span><span class="string">"tbl_produits"</span><span class="keyword">, </span><span class="string">"code_produit"</span><span class="keyword">, </span><span class="string">"description"</span><span class="keyword">);<br />
<br />
foreach (</span><span class="default">$result </span><span class="keyword">as </span><span class="default">$sentence</span><span class="keyword">){<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">//Afficher chaque ?l?ment du tableau<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">print </span><span class="string">"</span><span class="default">$sentence</span><span class="string">&lt;br&gt;"</span><span class="keyword">;<br />
}<br />
</span><span class="default">mysql_close</span><span class="keyword">(</span><span class="default">$db</span><span class="keyword">);<br />
<br />
</span><span class="comment">//Retourne<br />
/********************************************************<br />
INSERT INTO `tbl_produits`(`code_produit`,`description`) VALUES('produit1', 'don\'t have description');<br />
INSERT INTO `tbl_produits`(`code_produit`,`description`) VALUES('produit2', 'without \"description\" too');<br />
INSERT INTO `tbl_produits`(`code_produit`,`description`) VALUES('produit3', '1\\3 more than before');<br />
...<br />
...<br />
*********************************************************/<br />
<br />
</span><span class="default">?&gt;<br />
</span>PHP is a very nice language! <br />
Andr? Godin :)</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="45573""></a>
  <div class="note">
   <strong class="user">me at harveyball dot com</strong>
   <a href="#45573" class="date">11-Sep-2004 10:13</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Just thought id post this as i couldnt find a nice and simple way of dumping data from a mysql database and all the functions i found were way overly complicated so i wrote this one and thought id post it for others to use.<br />
<br />
//$link is the link to the database file<br />
//$db_name is the name of the database you want to dump<br />
//$current_time is just a reference of time()<br />
<br />
//returns $thesql which is a string of all the insert into statements<br />
<br />
function dumpData()<br />
{<br />
global $link,$db_name,$current_time;<br />
$thesql="";<br />
$thesql.="#SQL DATA FOR $mdb_name \n";<br />
$thesql.="#BACK UP DATE ". date("d/m/Y G:i.s",$current_time)." \n";<br />
$result = mysql_list_tables($mdb_name); <br />
while ($row = mysql_fetch_row($result))<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp;&nbsp; $getdata=mysql_query("SELECT * FROM $row[0]");<br />
&nbsp;&nbsp;&nbsp; while ($row1=mysql_fetch_array($getdata))<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $thesql.="INSERT INTO `$row[0]` VALUES (";<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $getcols = mysql_list_fields($mdb_name,$row[0],$link);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; for($c=0;$c&lt;mysql_num_fields($getcols);$c++)<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if (strstr(mysql_field_type($getdata,$c),'blob')) $row1[$c]=bin2hex($row1[$c]);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; //Binary null fix if ever needed<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if ($row1[$c]=="0x") $row1[$c]="0x1";<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; //delimit the apostrophies for mysql compatability<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $row1[$c]=str_replace("'","''",$row1[$c]); <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if (strstr(mysql_field_type($getdata,$c),'blob')) <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $thesql.="0x$row1[$c]";<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; else<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $thesql.="'$row1[$c]'";<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if ($c&lt;mysql_num_fields($getcols)-1) $thesql.=",";<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $thesql.=");;\n";<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; }<br />
return $thesql;&nbsp; &nbsp; <br />
}<br />
<br />
Please note the sql statements are terminated with ;; not a ; this is so when you want to do a multiple query you can tokenise the sql string with a ;; which allows your data to contain a ;<br />
<br />
If you want to run the multiple query then use this simple function which i wrote due to not being able to find a decent way of doing it<br />
<br />
//$q is the query string ($thesql returned string)<br />
//$link is the link to the database connection<br />
//returns true or false depending on whether a single query is executed allows you to check to see if any queries were ran<br />
<br />
function multiple_query($q,$link)<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp;&nbsp; $tok = strtok($q, ";;\n");<br />
&nbsp;&nbsp;&nbsp; while ($tok)<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $results=mysql_query("$tok",$link);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $tok = strtok(";;\n");<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; return $results;<br />
&nbsp;&nbsp;&nbsp; }</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="37870""></a>
  <div class="note">
   <strong class="user">Predrag Supurovic</strong>
   <a href="#37870" class="date">01-Dec-2003 01:52</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If you need to execute sevaral SQL commands in a row (usually called batcg SQL) using PHP you canot use mysql_query() since it can execute single command only.<br />
<br />
Here is simple but effective function that can run batch SQL commands. Take cere, if string contains semicolon (;) anywhere except as command delimiter (within string expression for example) function will not work.<br />
<br />
function mysql_exec_batch ($p_query, $p_transaction_safe = true) {<br />
&nbsp; if ($p_transaction_safe) {<br />
&nbsp;&nbsp; &nbsp;&nbsp; $p_query = 'START TRANSACTION;' . $p_query . '; COMMIT;';<br />
&nbsp;&nbsp;&nbsp; };<br />
&nbsp; $query_split = preg_split ("/[;]+/", $p_query);<br />
&nbsp; foreach ($query_split as $command_line) {<br />
&nbsp;&nbsp;&nbsp; $command_line = trim($command_line);<br />
&nbsp;&nbsp;&nbsp; if ($command_line != '') {<br />
&nbsp;&nbsp; &nbsp;&nbsp; $query_result = mysql_query($command_line);<br />
&nbsp;&nbsp; &nbsp;&nbsp; if ($query_result == 0) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; break;<br />
&nbsp;&nbsp; &nbsp;&nbsp; };<br />
&nbsp;&nbsp;&nbsp; };<br />
&nbsp; };<br />
&nbsp; return $query_result;<br />
}</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="31707""></a>
  <div class="note">
   <strong class="user">chris at hotmail dot com</strong>
   <a href="#31707" class="date">01-May-2003 03:28</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Windows programmers, keep in mind that although table names in Windows queries are not case sensitive, many *NIX versions of Mysql require the correct table name case (perhaps others as well). So you're better off using the right case from the beginning, in case you ever decide to go with a *NIX server.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="31381""></a>
  <div class="note">
   <strong class="user">davidc at edeca dot net</strong>
   <a href="#31381" class="date">19-Apr-2003 09:30</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Regarding the idea for returning all possible values of an enum field, the mySQL manual says that "SHOW COLUMNS FROM table LIKE column" should be used to do this.<br />
<br />
The function below (presumes db connection) will return an array of the possible values of an enum.<br />
<br />
function GetEnumValues($Table,$Column)<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp;&nbsp; $dbSQL = "SHOW COLUMNS FROM ".$Table." LIKE '".$Column."'";<br />
&nbsp;&nbsp;&nbsp; $dbQuery = mysql_query($dbSQL);<br />
<br />
&nbsp;&nbsp;&nbsp; $dbRow = mysql_fetch_assoc($dbQuery);<br />
&nbsp;&nbsp;&nbsp; $EnumValues = $dbRow["Type"];<br />
<br />
&nbsp;&nbsp;&nbsp; $EnumValues = substr($EnumValues, 6, strlen($EnumValues)-8); <br />
&nbsp;&nbsp;&nbsp; $EnumValues = str_replace("','",",",$EnumValues);<br />
<br />
&nbsp;&nbsp;&nbsp; return explode(",",$EnumValues);<br />
&nbsp;&nbsp;&nbsp; }<br />
<br />
Cavaets:<br />
<br />
1) If the LIKE matches more than one column you get the enum from the first, so be careful with the $Column argument<br />
2) You can't have ',' as part of one of the enums (I guess mySQL would escape this, but I haven't tried)<br />
3) If the field isn't an enum you'll get garbage back!<br />
<br />
This is just a quick example to show how to do it, some tidying up needs to be done (ie checking if the field is actually an enum) before it is perfect.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="31078""></a>
  <div class="note">
   
   <a href="#31078" class="date">09-Apr-2003 09:43</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Until this function prohibits them, watch out for SQL comments (--) in your input.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="30783""></a>
  <div class="note">
   <strong class="user">allen a brooker gb net</strong>
   <a href="#30783" class="date">28-Mar-2003 02:35</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
One way to reduce the dangers of queries like the dlete command above that dletes the whole DB is to use limits wherever possible. <br />
<br />
EG. If you have a routine that is only deisnged to delete 1 record, add 'LIMIT 1' to the end of the command. This way you'll only lose one record if someone does something stupid.<br />
<br />
You should also check all input, especially if it is sent using GET. ie. make sure that $_GET['id'] is not NULL or == "", is a number that is positive, not 0 (generally, I know this doesn't apply to some table types, but it applies to the default) and is within the valid range for that field.<br />
<br />
Just don't trust ANY data that is sent to your script.<br />
<br />
HTH<br />
Allen</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="2984""></a>
  <div class="note">
   <strong class="user">nikhil-php at nols dot com</strong>
   <a href="#2984" class="date">02-Jan-2000 09:38</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
When trying to INSERT or UPDATE and trying to put a large amount of text or data (blob) into a mysql table you might run into problems.
<br />

<br />
In mysql.err you might see:
<br />
Packet too large (73904)
<br />

<br />
To fix you just have to start up mysql with the option -O max_allowed_packet=maxsize 
<br />

<br />
You would just replace maxsize with the max size you want to insert, the default is 65536</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
</div>
</div>
</div></div></body></html>
