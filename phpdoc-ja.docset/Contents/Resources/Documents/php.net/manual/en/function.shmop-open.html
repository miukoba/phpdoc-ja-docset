<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
 <head>
  <meta http-equiv="content-type" content="text/html; CHARSET=shift-jis">
  <title>共有メモリブロックを作成またはオープンする</title>

  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <link media="all" rel="stylesheet" type="text/css" href="style.css"/>
 </head>
 <body class="docs" class="docs"><div class="navbar navbar-fixed-top">
  <div class="navbar-inner clearfix">
    <ul class="nav" style="width: 100%">
      <li style="float: left;"><a href="function.shmop-delete.html">≪ shmop_delete</a></li>
      <li style="float: right;"><a href="function.shmop-read.html">shmop_read ≫</a></li>
    </ul>
  </div>
</div>
<div id="breadcrumbs" class="clearfix">
  <ul class="breadcrumbs-container">
    <li><a href="index.html">PHP Manual</a></li>
    <li><a href="ref.shmop.html">共有メモリ関数</a></li>
    <li>共有メモリブロックを作成またはオープンする</li>
  </ul>
</div>
<div id="layout">
  <div id="layout-content"><div id="function.shmop-open" class="refentry">
 <div class="refnamediv">
  <h1 class="refname">shmop_open</h1>
  <p class="verinfo">(PHP 4 &gt;= 4.0.4, PHP 5)</p><p class="refpurpose"><span class="refname">shmop_open</span> &mdash; <span class="dc-title">共有メモリブロックを作成またはオープンする</span></p>

 </div>
 <div class="refsect1 description" id="refsect1-function.shmop-open-description">
  <h3 class="title">説明</h3>
  <div class="methodsynopsis dc-description">
   <span class="type">int</span> <span class="methodname"><strong>shmop_open</strong></span>
    ( <span class="methodparam"><span class="type">int</span> <code class="parameter">$key</code></span>
   , <span class="methodparam"><span class="type">string</span> <code class="parameter">$flags</code></span>
   , <span class="methodparam"><span class="type">int</span> <code class="parameter">$mode</code></span>
   , <span class="methodparam"><span class="type">int</span> <code class="parameter">$size</code></span>
   )</div>

  <p class="para rdfs-comment">
   <span class="function"><strong>shmop_open()</strong></span> は共有メモリブロックを作成または
   オープンします。
  </p>
 </div>

 <div class="refsect1 parameters" id="refsect1-function.shmop-open-parameters">
  <h3 class="title">パラメータ</h3>
  <p class="para">
   <dl>

    
     <dt>
<code class="parameter">key</code></dt>

     <dd>

      <p class="para">
       共有メモリブロックのシステム ID であり、10 進数または
       16 進数で指定することが可能です。
      </p>
     </dd>

    
    
     <dt>
<code class="parameter">flags</code></dt>

     <dd>

      <p class="para">
       フラグに設定できる内容は、次のとおりです。
       <ul class="itemizedlist">
        <li class="listitem">
         <span class="simpara">
          &quot;a&quot; アクセス用(shmat に SHM_RDONLY を設定する)
          既存の共有メモリセグメントを読み込み専用でオープンする必要がある場合に
          このフラグを使用してください。
         </span>
        </li>
        <li class="listitem">
         <span class="simpara">
          &quot;c&quot; 作成用(IPC_CREATE を設定する)
          新規に共有メモリセグメントが必要な場合にこのフラグを使用してください。
          もし同じキーのセグメントがすでに存在する場合、それを読み書きモードで
          オープンしようと試みます。
         </span>
        </li>
        <li class="listitem">
         <span class="simpara">
          &quot;w&quot; 読み込み &amp; 書き込みアクセス用
          共有メモリセグメントの読み込みや書き込みの必要がある場合にこのフラグを
          使用してください。たいていの場合はこのフラグを使用します。
         </span>
        </li>
        <li class="listitem">
         <span class="simpara">
          &quot;n&quot; 新規メモリセグメントの作成用(IPC_CREATE|IPC_EXCL を設定する)
          新規に共有メモリセグメントが必要で、もし同じフラグのセグメントが
          存在するときには失敗させたい場合にこのフラグを使用してください。
          セキュリティを確保するために、このフラグは有用です。これを使用する
          ことで、条件の競合による問題を避けることが可能です。
         </span>
        </li>
       </ul>
      </p>
     </dd>

    
    
     <dt>
<code class="parameter">mode</code></dt>

     <dd>

      <p class="para">
         共有メモリセグメントに設定したい
         許可属性で、ファイルに関する許可属性と同様なものです。許可属性は、
         例えば <em>0644</em> のような 8 進数形式で渡す必要があります。
      </p>
     </dd>

    
    
     <dt>
<code class="parameter">size</code></dt>

     <dd>

      <p class="para">
       作成したい共有メモリブロックの大きさをバイト数で指定します。
      </p>
     </dd>

    
   </dl>

   <blockquote class="note"><p><strong class="note">注意</strong>: 
    <p class="para">
     注意: 既存のメモリセグメントをオープンする場合には、3 番目および
     4 番目の引数には 0 を指定する必要があります。成功時に
    </p>
   </p></blockquote>
  </p>
 </div>

 <div class="refsect1 returnvalues" id="refsect1-function.shmop-open-returnvalues">
  <h3 class="title">返り値</h3>
  <p class="para">
   成功した場合は、<span class="function"><strong>shmop_open()</strong></span> は
   作成した共有メモリセグメントにアクセスするために使用する ID を返します。
   失敗した場合に <strong><code>FALSE</code></strong> を返します。
  </p>
 </div>

 <div class="refsect1 examples" id="refsect1-function.shmop-open-examples">
  <h3 class="title">例</h3>
  <p class="para">
   <div class="example" id="example-3826">
    <p><strong>例1 共有メモリブロックを新規に作成する</strong></p>
    <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br />$shm_key&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">ftok</span><span style="color: #007700">(</span><span style="color: #0000BB">__FILE__</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">'t'</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">$shm_id&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">shmop_open</span><span style="color: #007700">(</span><span style="color: #0000BB">$shm_key</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">"c"</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">0644</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">100</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
    </div>

   </div>
  </p>
  <p class="para">
   この例は、<span class="function"><a href="function.ftok.html" class="function">ftok()</a></span> が返すシステム ID
   の共有メモリブロックをオープンします。
  </p>
 </div>

 <div class="refsect1 seealso" id="refsect1-function.shmop-open-seealso">
  <h3 class="title">参考</h3>
  <p class="para">
   <ul class="simplelist">
    <li class="member"><span class="function"><a href="function.shmop-close.html" class="function" rel="rdfs-seeAlso">shmop_close()</a> - 共有メモリブロックを閉じる</span></li>
    <li class="member"><span class="function"><a href="function.shmop-delete.html" class="function" rel="rdfs-seeAlso">shmop_delete()</a> - 共有メモリブロックを削除する</span></li>
   </ul>
  </p>
 </div>

</div><div id="usernotes">
 <div class="head">
  <h3 class="title">User Contributed Notes</h3>
 </div>
<div id="allnotes">  <a name="113542""></a>
  <div class="note">
   <strong class="user">thanks at forthefish dot com</strong>
   <a href="#113542" class="date">28-Oct-2013 03:24</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
These shared memory functions are kind of silly on Windows where sem_get() and friends nor any sort of synchronization object is available (as of PHP 5.5.5) to perform proper locking prior to access.&nbsp; A core PHP dev needs to write some wrappers for sem_get() for Windows as they did for shmop to really round out this feature.<br />
<br />
The implementation of shmop for Windows is pretty slick - the author basically ported variations of POSIX functions to Windows equivalent prototypes.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="102644""></a>
  <div class="note">
   <strong class="user">a</strong>
   <a href="#102644" class="date">26-Feb-2011 01:31</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
On win xp 32bit php 5.2.6 recreation of shared memory block with the same id but bigger size fails. 
<br />

<br />
<span class="default">&lt;?php
<br />
$shm_key </span><span class="keyword">= </span><span class="default">0xff3</span><span class="keyword">;
<br />
</span><span class="default">$shm_id </span><span class="keyword">= </span><span class="default">shmop_open</span><span class="keyword">(</span><span class="default">$shm_key</span><span class="keyword">, </span><span class="string">"c"</span><span class="keyword">, </span><span class="default">0666</span><span class="keyword">, </span><span class="default">128</span><span class="keyword">);
<br />
</span><span class="default">shmop_delete</span><span class="keyword">(</span><span class="default">$shm_id</span><span class="keyword">);
<br />
</span><span class="default">shmop_close</span><span class="keyword">(</span><span class="default">$shm_id</span><span class="keyword">);
<br />
</span><span class="default">$shm_id </span><span class="keyword">= </span><span class="default">shmop_open</span><span class="keyword">(</span><span class="default">$shm_key</span><span class="keyword">, </span><span class="string">"c"</span><span class="keyword">, </span><span class="default">0666</span><span class="keyword">, </span><span class="default">32</span><span class="keyword">);
<br />
</span><span class="default">shmop_delete</span><span class="keyword">(</span><span class="default">$shm_id</span><span class="keyword">);
<br />
</span><span class="default">shmop_close</span><span class="keyword">(</span><span class="default">$shm_id</span><span class="keyword">);
<br />
</span><span class="default">$shm_id </span><span class="keyword">= </span><span class="default">shmop_open</span><span class="keyword">(</span><span class="default">$shm_key</span><span class="keyword">, </span><span class="string">"c"</span><span class="keyword">, </span><span class="default">0666</span><span class="keyword">, </span><span class="default">1024</span><span class="keyword">); </span><span class="comment">// on win32 fails there
<br />
</span><span class="default">shmop_delete</span><span class="keyword">(</span><span class="default">$shm_id</span><span class="keyword">);
<br />
</span><span class="default">shmop_close</span><span class="keyword">(</span><span class="default">$shm_id</span><span class="keyword">);
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="85423""></a>
  <div class="note">
   <strong class="user">DinosauRUS</strong>
   <a href="#85423" class="date">29-Aug-2008 12:24</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If you faced with any problem you're going to solve with shared memmory, but your server doesn't support it, you can use files instead. I've wrote simple wrapper for this and its suites for me. Hope it will be usefull for you too.<br />
<br />
<span class="default">&lt;?php<br />
<br />
define</span><span class="keyword">(</span><span class="default">kSHARED_FOLDER</span><span class="keyword">, </span><span class="string">"shared/"</span><span class="keyword">);<br />
</span><span class="default">define</span><span class="keyword">(</span><span class="default">kSHARED_MAX_ATTEMPS</span><span class="keyword">, </span><span class="default">10</span><span class="keyword">);<br />
</span><span class="default">define</span><span class="keyword">(</span><span class="default">kSESSION_SHARED</span><span class="keyword">, </span><span class="string">"shared_"</span><span class="keyword">);<br />
<br />
class </span><span class="default">Shared </span><span class="keyword">{<br />
&nbsp;&nbsp;&nbsp; var </span><span class="default">$id </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; var </span><span class="default">$filename </span><span class="keyword">= </span><span class="string">''</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; var </span><span class="default">$filepointer</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; var </span><span class="default">$data </span><span class="keyword">= array();<br />
&nbsp;&nbsp;&nbsp; var </span><span class="default">$date </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; function </span><span class="default">Shared</span><span class="keyword">(</span><span class="default">$id</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">id </span><span class="keyword">= </span><span class="default">$id</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">filename </span><span class="keyword">= </span><span class="default">kSHARED_FOLDER</span><span class="keyword">.</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">id</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if(empty(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">filename</span><span class="keyword">))<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; print </span><span class="string">"no filename"</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">false</span><span class="keyword">;&nbsp; &nbsp; &nbsp; &nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">date </span><span class="keyword">= </span><span class="default">$_SESSION</span><span class="keyword">[</span><span class="default">kSESSION_SHARED</span><span class="keyword">.</span><span class="default">$id</span><span class="keyword">];<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; function </span><span class="default">clear</span><span class="keyword">() {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">id </span><span class="keyword">== </span><span class="default">null</span><span class="keyword">)<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">false</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$counter </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">ignore_user_abort</span><span class="keyword">(</span><span class="default">true</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if((</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">filepointer </span><span class="keyword">= @</span><span class="default">fopen</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">filename</span><span class="keyword">, </span><span class="string">"w"</span><span class="keyword">)) == </span><span class="default">false</span><span class="keyword">) {&nbsp; &nbsp; &nbsp; &nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">ignore_user_abort</span><span class="keyword">(</span><span class="default">false</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">false</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; while(</span><span class="default">true</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">$counter </span><span class="keyword">&gt;= </span><span class="default">kSHARED_MAX_ATTEMPS</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">fclose</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">filepointer</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">ignore_user_abort</span><span class="keyword">(</span><span class="default">false</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">false</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if(</span><span class="default">flock</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">filepointer</span><span class="keyword">, </span><span class="default">LOCK_EX</span><span class="keyword">) == </span><span class="default">false</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$counter</span><span class="keyword">++;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">usleep</span><span class="keyword">(</span><span class="default">rand</span><span class="keyword">(</span><span class="default">1</span><span class="keyword">, </span><span class="default">25000</span><span class="keyword">));<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; else<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; break;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if(</span><span class="default">flock</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">filepointer</span><span class="keyword">, </span><span class="default">LOCK_UN</span><span class="keyword">) == </span><span class="default">false</span><span class="keyword">) {&nbsp; &nbsp; &nbsp; &nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">ignore_user_abort</span><span class="keyword">(</span><span class="default">false</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">false</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; unset(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">data</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">data </span><span class="keyword">= array();<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">fclose</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">filepointer</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">date </span><span class="keyword">= </span><span class="default">$_SESSION</span><span class="keyword">[</span><span class="default">kSESSION_SHARED</span><span class="keyword">.</span><span class="default">$id</span><span class="keyword">] = </span><span class="default">filemtime</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">filename</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">ignore_user_abort</span><span class="keyword">(</span><span class="default">false</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">true</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; function </span><span class="default">setObjectForKey</span><span class="keyword">(</span><span class="default">$value</span><span class="keyword">, </span><span class="default">$key</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">id </span><span class="keyword">== </span><span class="default">null</span><span class="keyword">)<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">false</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$counter </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">ignore_user_abort</span><span class="keyword">(</span><span class="default">true</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if((</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">filepointer </span><span class="keyword">= @</span><span class="default">fopen</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">filename</span><span class="keyword">, </span><span class="string">"a+"</span><span class="keyword">)) == </span><span class="default">false</span><span class="keyword">) {&nbsp; &nbsp; &nbsp; &nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">ignore_user_abort</span><span class="keyword">(</span><span class="default">false</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; print </span><span class="string">"can not open file&lt;br&gt;"</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">false</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; while(</span><span class="default">true</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">$counter </span><span class="keyword">&gt;= </span><span class="default">kSHARED_MAX_ATTEMPS</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">fclose</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">filepointer</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; print(</span><span class="string">"1 aborted..."</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">ignore_user_abort</span><span class="keyword">(</span><span class="default">false</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">false</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$block</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if(</span><span class="default">flock</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">filepointer</span><span class="keyword">, </span><span class="default">LOCK_EX</span><span class="keyword">, </span><span class="default">$block</span><span class="keyword">) == </span><span class="default">false</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$counter</span><span class="keyword">++;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; print(</span><span class="string">"1 waiting..."</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">usleep</span><span class="keyword">(</span><span class="default">rand</span><span class="keyword">(</span><span class="default">1</span><span class="keyword">, </span><span class="default">25000</span><span class="keyword">));<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; else<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; break;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$data </span><span class="keyword">= </span><span class="default">file_get_contents</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">filename</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$array </span><span class="keyword">= array();<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if (!empty(</span><span class="default">$data</span><span class="keyword">))<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$array </span><span class="keyword">= </span><span class="default">unserialize</span><span class="keyword">(</span><span class="default">$data</span><span class="keyword">);<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$array</span><span class="keyword">[</span><span class="default">$key</span><span class="keyword">] = </span><span class="default">$value</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$data </span><span class="keyword">= </span><span class="default">serialize</span><span class="keyword">(</span><span class="default">$array</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">ftruncate</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">filepointer</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">fseek</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">filepointer</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">SEEK_SET</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">fwrite</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">filepointer</span><span class="keyword">, </span><span class="default">$data</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">data </span><span class="keyword">= </span><span class="default">$array</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if(</span><span class="default">flock</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">filepointer</span><span class="keyword">, </span><span class="default">LOCK_UN</span><span class="keyword">) == </span><span class="default">false</span><span class="keyword">) {&nbsp; &nbsp; &nbsp; &nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">ignore_user_abort</span><span class="keyword">(</span><span class="default">false</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">false</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">fclose</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">filepointer</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">date </span><span class="keyword">= </span><span class="default">$_SESSION</span><span class="keyword">[</span><span class="default">kSESSION_SHARED</span><span class="keyword">.</span><span class="default">$id</span><span class="keyword">] = </span><span class="default">filemtime</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">filename</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">ignore_user_abort</span><span class="keyword">(</span><span class="default">false</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">true</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; function </span><span class="default">getObjectForKey</span><span class="keyword">(</span><span class="default">$key</span><span class="keyword">)&nbsp; &nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">id </span><span class="keyword">== </span><span class="default">null</span><span class="keyword">)<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">null</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$counter </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">ignore_user_abort</span><span class="keyword">(</span><span class="default">true</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if((</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">filepointer </span><span class="keyword">= @</span><span class="default">fopen</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">filename</span><span class="keyword">, </span><span class="string">"a+"</span><span class="keyword">)) == </span><span class="default">false</span><span class="keyword">) {&nbsp; &nbsp; &nbsp; &nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">ignore_user_abort</span><span class="keyword">(</span><span class="default">false</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; print(</span><span class="string">"can not open&lt;br&gt;"</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">null</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">date </span><span class="keyword">== </span><span class="default">filemtime</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">filename</span><span class="keyword">)) {&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">fclose</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">filepointer</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">data</span><span class="keyword">[</span><span class="default">$key</span><span class="keyword">];<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; while(</span><span class="default">true</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">$counter </span><span class="keyword">&gt;= </span><span class="default">kSHARED_MAX_ATTEMPS</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">fclose</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">filepointer</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">ignore_user_abort</span><span class="keyword">(</span><span class="default">false</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; print(</span><span class="string">"2 aborted&lt;br&gt;"</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">null</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if(</span><span class="default">flock</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">filepointer</span><span class="keyword">,&nbsp; </span><span class="default">LOCK_SH </span><span class="keyword">) == </span><span class="default">false</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$counter</span><span class="keyword">++;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; print(</span><span class="string">"2 waiting...&lt;br&gt;"</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">usleep</span><span class="keyword">(</span><span class="default">rand</span><span class="keyword">(</span><span class="default">1</span><span class="keyword">, </span><span class="default">25000</span><span class="keyword">));<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; else<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; break;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">fseek</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">filepointer</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$data </span><span class="keyword">= </span><span class="default">file_get_contents</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">filename</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$array </span><span class="keyword">= array();<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if (!empty(</span><span class="default">$data</span><span class="keyword">))<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$array </span><span class="keyword">= </span><span class="default">unserialize</span><span class="keyword">(</span><span class="default">$data</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$data </span><span class="keyword">= </span><span class="default">$array</span><span class="keyword">[</span><span class="default">$key</span><span class="keyword">];<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">data </span><span class="keyword">= </span><span class="default">$array</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if(</span><span class="default">flock</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">filepointer</span><span class="keyword">, </span><span class="default">LOCK_UN</span><span class="keyword">) == </span><span class="default">false</span><span class="keyword">) {&nbsp; &nbsp; &nbsp; &nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">ignore_user_abort</span><span class="keyword">(</span><span class="default">false</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">$data</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">fclose</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">filepointer</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">date </span><span class="keyword">= </span><span class="default">$_SESSION</span><span class="keyword">[</span><span class="default">kSESSION_SHARED</span><span class="keyword">.</span><span class="default">$id</span><span class="keyword">] = </span><span class="default">filemtime</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">filename</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">ignore_user_abort</span><span class="keyword">(</span><span class="default">false</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">$data</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }<br />
}<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="79430""></a>
  <div class="note">
   <strong class="user">erelsgl at gmail dot com</strong>
   <a href="#79430" class="date">27-Nov-2007 12:04</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
=== Checking if a shared memory exists ===<br />
The solution provided by Mitchell_Shnier at ieee dot orgZ doesn't work on my computer - I get a warning "Invalid flag ac".<br />
<br />
In order to check if a shared-memory exists, you just have to open it with the "a" or "w" flag, while hiding the warnings using the "@" operator:<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">@</span><span class="default">$shid </span><span class="keyword">= </span><span class="default">shmop_open</span><span class="keyword">(</span><span class="default">$systemId</span><span class="keyword">, </span><span class="string">"a"</span><span class="keyword">, </span><span class="default">0666</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">);<br />
if (!empty(</span><span class="default">$shid</span><span class="keyword">)) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; ... </span><span class="default">shared memory exists<br />
</span><span class="keyword">} else {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; ... </span><span class="default">shared memory doesn</span><span class="string">'t exist<br />
}<br />
?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="48743""></a>
  <div class="note">
   <strong class="user">Craig Manley</strong>
   <a href="#48743" class="date">06-Jan-2005 02:19</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
To: macmaster at pobox dot com:<br />
<br />
To clear up some new confusion: you said the shm key is 8 bytes long. As far as I know it's 4 bytes (32bits).<br />
Check out the output of ipcs on Linux below to see what I mean.<br />
<br />
------ Shared Memory Segments --------<br />
key&nbsp; &nbsp; &nbsp; &nbsp; shmid&nbsp; &nbsp; &nbsp; owner&nbsp; &nbsp; &nbsp; perms&nbsp; &nbsp; &nbsp; bytes&nbsp; &nbsp; &nbsp; nattch&nbsp; &nbsp;&nbsp; status&nbsp; &nbsp; &nbsp; <br />
0x6e6a694d 65538&nbsp; &nbsp; &nbsp; mijnbel&nbsp;&nbsp; 644&nbsp; &nbsp; &nbsp; &nbsp; 65536&nbsp; &nbsp; &nbsp; 0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <br />
0x326e794d 98307&nbsp; &nbsp; &nbsp; mijnbel&nbsp;&nbsp; 644&nbsp; &nbsp; &nbsp; &nbsp; 65536&nbsp; &nbsp; &nbsp; 0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <br />
0x62417347 131076&nbsp; &nbsp;&nbsp; smsklap&nbsp;&nbsp; 644&nbsp; &nbsp; &nbsp; &nbsp; 65536&nbsp; &nbsp; &nbsp; 0</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="39541""></a>
  <div class="note">
   <strong class="user">daniele_dll at yahoo dot it</strong>
   <a href="#39541" class="date">01-Feb-2004 10:28</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
There is a little ftok function. This function isn't included into php for windows so i've grabbed it directly from linux glibc 2.3.2 source code. I hope that this can be useful.<br />
There is the code:<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">function </span><span class="default">ftok</span><span class="keyword">(</span><span class="default">$pathname</span><span class="keyword">, </span><span class="default">$proj_id</span><span class="keyword">) {<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$st </span><span class="keyword">= @</span><span class="default">stat</span><span class="keyword">(</span><span class="default">$pathname</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; if (!</span><span class="default">$st</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return -</span><span class="default">1</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$key </span><span class="keyword">= </span><span class="default">sprintf</span><span class="keyword">(</span><span class="string">"%u"</span><span class="keyword">, ((</span><span class="default">$st</span><span class="keyword">[</span><span class="string">'ino'</span><span class="keyword">] &amp; </span><span class="default">0xffff</span><span class="keyword">) | ((</span><span class="default">$st</span><span class="keyword">[</span><span class="string">'dev'</span><span class="keyword">] &amp; </span><span class="default">0xff</span><span class="keyword">) &lt;&lt; </span><span class="default">16</span><span class="keyword">) | ((</span><span class="default">$proj_id </span><span class="keyword">&amp; </span><span class="default">0xff</span><span class="keyword">) &lt;&lt; </span><span class="default">24</span><span class="keyword">)));<br />
&nbsp;&nbsp;&nbsp; return </span><span class="default">$key</span><span class="keyword">;<br />
}<br />
<br />
echo </span><span class="default">ftok</span><span class="keyword">(</span><span class="default">$_SERVER</span><span class="keyword">[</span><span class="string">"SCRIPT_FILENAME"</span><span class="keyword">], </span><span class="default">250</span><span class="keyword">);<br />
</span><span class="default">?&gt;<br />
</span><br />
sorry for my english :)</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="35361""></a>
  <div class="note">
   <strong class="user">Chris Petersen</strong>
   <a href="#35361" class="date">28-Aug-2003 08:18</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Be warned that if you try to shmop_open with a key set to zero, shmop_open will seemingly work, and you can write to it, but you will not be able to read from it or delete it.&nbsp; If you're not careful, you can continue doing this - creating more and more shared memory blocks at "zero" until eventually you WILL start getting errors saying that php can't access or create the shared memory block, and you will have to restart your machine to free up all of those "zero" blocks.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="16651""></a>
  <div class="note">
   <strong class="user">Mitchell_Shnier at ieee dot orgZ</strong>
   <a href="#16651" class="date">08-Nov-2001 02:51</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
To check whether a particular shared memory segment is already created, you need to concatenate the "a" and "c" flags. For example (where $SystemKey is the Unix key used by the other process(es) with which you want to share this memory segment)...&lt;BR&gt;
<br />
$shm_id = shmop_open($SystemKey, "ac", 0, 0);
<br />
if ($shm_id) {
<br />
&nbsp;&nbsp; #it is already created
<br />
} else {
<br />
&nbsp;&nbsp; #you need to create it with shmop_open using "c" only
<br />
}&lt;BR&gt;
<br />
Using only "a" does not work (just as using only IPC_EXCL in the Unix shmget() call is meaningless). Also, use the ipcs shell command to see your shared memory segments.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
</div>
</div>
</div></div></body></html>
