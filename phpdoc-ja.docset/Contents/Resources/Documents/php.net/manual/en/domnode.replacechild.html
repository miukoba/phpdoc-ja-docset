<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
 <head>
  <meta http-equiv="content-type" content="text/html; CHARSET=shift-jis">
  <title>子を置き換える</title>

  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <link media="all" rel="stylesheet" type="text/css" href="style.css"/>
 </head>
 <body class="docs" class="docs"><div class="navbar navbar-fixed-top">
  <div class="navbar-inner clearfix">
    <ul class="nav" style="width: 100%">
      <li style="float: left;"><a href="domnode.removechild.html">≪ DOMNode::removeChild</a></li>
      <li style="float: right;"><a href="class.domnodelist.html">DOMNodeList ≫</a></li>
    </ul>
  </div>
</div>
<div id="breadcrumbs" class="clearfix">
  <ul class="breadcrumbs-container">
    <li><a href="index.html">PHP Manual</a></li>
    <li><a href="class.domnode.html">DOMNode</a></li>
    <li>子を置き換える</li>
  </ul>
</div>
<div id="layout">
  <div id="layout-content"><div id="domnode.replacechild" class="refentry">
 <div class="refnamediv">
  <h1 class="refname">DOMNode::replaceChild</h1>
  <p class="verinfo">(PHP 5)</p><p class="refpurpose"><span class="refname">DOMNode::replaceChild</span> &mdash; <span class="dc-title">
   子を置き換える
  </span></p>

 </div>
 <div class="refsect1 description" id="refsect1-domnode.replacechild-description">
  <h3 class="title">説明</h3>
  <div class="methodsynopsis dc-description">
   <span class="modifier">public</span> <span class="type"><a href="class.domnode.html" class="type DOMNode">DOMNode</a></span> <span class="methodname"><strong>DOMNode::replaceChild</strong></span>
    ( <span class="methodparam"><span class="type"><a href="class.domnode.html" class="type DOMNode">DOMNode</a></span> <code class="parameter">$newnode</code></span>
   , <span class="methodparam"><span class="type"><a href="class.domnode.html" class="type DOMNode">DOMNode</a></span> <code class="parameter">$oldnode</code></span>
   )</div>

  <p class="para rdfs-comment">
   この関数は、子要素 <code class="parameter">oldnode</code> を新しいノードに
   置き換えます。もし新しいノードがすでに子要素であった場合は、
   それがふたたび追加されることはありません。置き換えに成功すると、
   置き換え前のノードが返されます。
  </p>
 </div>

 <div class="refsect1 parameters" id="refsect1-domnode.replacechild-parameters">
  <h3 class="title">パラメータ</h3>
  <p class="para">
   <dl>

    
     <dt>
<code class="parameter">newnode</code></dt>

     <dd>

      <p class="para">
       新しいノード。対象ドキュメントのメンバ、
       すなわち、DOMDocument-&gt;createXXX() メソッドのひとつで作成されたものか
       <a href="domdocument.importnode.html" class="xref">DOMDocument::importNode</a> で
       ドキュメントにインポートされたものである必要があります。
      </p>
     </dd>

    
    
     <dt>
<code class="parameter">oldnode</code></dt>

     <dd>

      <p class="para">
       古いノード。
      </p>
     </dd>

    
   </dl>

  </p>
 </div>

 <div class="refsect1 returnvalues" id="refsect1-domnode.replacechild-returnvalues">
  <h3 class="title">返り値</h3>
  <p class="para">
   古いノード、あるいはエラーが発生した場合は <strong><code>FALSE</code></strong> を返します。
  </p>
 </div>

 <div class="refsect1 errors" id="refsect1-domnode.replacechild-errors">
  <h3 class="title">エラー / 例外</h3>
  <p class="para">
   <dl>

    
     <dt>
<strong><code>DOM_NO_MODIFICATION_ALLOWED_ERR</code></strong></dt>

     <dd>

      <p class="para">
       このノードが読み込み専用であったり、挿入されるノードの以前の親が
       読み込み専用であった場合に発生します。
      </p>
     </dd>

    
    
     <dt>
<strong><code>DOM_HIERARCHY_REQUEST_ERR</code></strong></dt>

     <dd>

      <p class="para">
       <code class="parameter">newnode</code> で指定した型の子ノードを
       保持することが許可されていない場合、あるいは追加しようとしている
       ノードが自分自身やその祖先であった場合に発生します。
      </p>
     </dd>

    
    
     <dt>
<strong><code>DOM_WRONG_DOCUMENT_ERR</code></strong></dt>

     <dd>

      <p class="para">
       <code class="parameter">newnode</code> が、このノードとは別の
       ドキュメントで作成されたものである場合に発生します。
      </p>
     </dd>

    
    
     <dt>
<strong><code>DOM_NOT_FOUND</code></strong></dt>

     <dd>

      <p class="para">
       <code class="parameter">oldnode</code> がこのノードの子でない場合に発生します。
      </p>
     </dd>

    
   </dl>

  </p>
 </div>

 <div class="refsect1 seealso" id="refsect1-domnode.replacechild-seealso">
  <h3 class="title">参考</h3>
  <p class="para">
   <ul class="simplelist">
    <li class="member"><span class="methodname"><a href="domnode.appendchild.html" class="methodname" rel="rdfs-seeAlso">DOMNode::appendChild()</a> - 子要素群の最後に新しい子要素を追加する</span></li>
    <li class="member"><span class="methodname"><a href="domnode.removechild.html" class="methodname" rel="rdfs-seeAlso">DOMNode::removeChild()</a> - 子要素群から子要素を削除する</span></li>
   </ul>
  </p>
 </div>

</div><div id="usernotes">
 <div class="head">
  <h3 class="title">User Contributed Notes</h3>
 </div>
<div id="allnotes">  <a name="50500""></a>
  <div class="note">
   <strong class="user">jb at jbpros dot com</strong>
   <a href="#50500" class="date">02-Mar-2005 05:08</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If you are trying to replace more than one node at once, you have to be careful about iterating over the DOMNodeList.&nbsp; If the old node has a different name from the new node, it will be removed from the list once it has been replaced.&nbsp; Use a regressive loop:
<br />

<br />
<span class="default">&lt;?php
<br />

<br />
$xml </span><span class="keyword">= new </span><span class="default">DOMDocument</span><span class="keyword">;
<br />
</span><span class="default">$xml</span><span class="keyword">-&gt;</span><span class="default">load</span><span class="keyword">(</span><span class="string">'docfile.xml'</span><span class="keyword">);
<br />

<br />
</span><span class="default">$elements </span><span class="keyword">= </span><span class="default">$xml</span><span class="keyword">-&gt;</span><span class="default">getElementsByTagNameNS</span><span class="keyword">(</span><span class="string">'<a href="http://www.example.com/NS/" rel="nofollow" target="_blank">http://www.example.com/NS/</a>'</span><span class="keyword">, </span><span class="string">'*'</span><span class="keyword">);
<br />
</span><span class="default">$i </span><span class="keyword">= </span><span class="default">$elements</span><span class="keyword">-&gt;</span><span class="default">length </span><span class="keyword">- </span><span class="default">1</span><span class="keyword">;
<br />
while (</span><span class="default">$i </span><span class="keyword">&gt; -</span><span class="default">1</span><span class="keyword">) {
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$element </span><span class="keyword">= </span><span class="default">$elements</span><span class="keyword">-&gt;</span><span class="default">item</span><span class="keyword">(</span><span class="default">$i</span><span class="keyword">);
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$ignore </span><span class="keyword">= </span><span class="default">false</span><span class="keyword">;
<br />

<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$newelement </span><span class="keyword">= </span><span class="default">$xml</span><span class="keyword">&gt;</span><span class="default">createTextNode</span><span class="keyword">(</span><span class="string">'Some new node!'</span><span class="keyword">);
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$element</span><span class="keyword">-&gt;</span><span class="default">parentNode</span><span class="keyword">-&gt;</span><span class="default">replaceChild</span><span class="keyword">(</span><span class="default">$newelement</span><span class="keyword">, </span><span class="default">$element</span><span class="keyword">);
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$i</span><span class="keyword">--;
<br />
}
<br />

<br />
</span><span class="default">?&gt;
<br />
</span>
<br />
The loop counter ($i) will always be in the list's interval as removed elements indexes are above the counter.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="48485""></a>
  <div class="note">
   <strong class="user">aidan at php dot net</strong>
   <a href="#48485" class="date">26-Dec-2004 11:17</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Here is a simple example for replacing a node:<br />
<br />
Let's define our XML like so:<br />
<br />
<span class="default">&lt;?php<br />
$xml </span><span class="keyword">= &lt;&lt;&lt;XML<br />
</span><span class="string">&lt;?xml version="1.0"?&gt;<br />
&lt;root&gt;<br />
&nbsp; &lt;parent&gt;<br />
&nbsp;&nbsp; &nbsp; &lt;child&gt;bar&lt;/child&gt;<br />
&nbsp;&nbsp; &nbsp; &lt;child&gt;foo&lt;/child&gt;<br />
&nbsp; &lt;/parent&gt;<br />
&lt;/root&gt;<br />
</span><span class="keyword">XML;<br />
</span><span class="default">?&gt;<br />
</span><br />
If we wanted to replace the entire &lt;parent&gt; node, we could do something like this:<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="comment">// Create a new document fragment to hold the new &lt;parent&gt; node<br />
</span><span class="default">$parent </span><span class="keyword">= new </span><span class="default">DomDocument</span><span class="keyword">;<br />
</span><span class="default">$parent_node </span><span class="keyword">= </span><span class="default">$parent </span><span class="keyword">-&gt;</span><span class="default">createElement</span><span class="keyword">(</span><span class="string">'parent'</span><span class="keyword">);<br />
<br />
</span><span class="comment">// Add some children<br />
</span><span class="default">$parent_node</span><span class="keyword">-&gt;</span><span class="default">appendChild</span><span class="keyword">(</span><span class="default">$parent</span><span class="keyword">-&gt;</span><span class="default">createElement</span><span class="keyword">(</span><span class="string">'child'</span><span class="keyword">, </span><span class="string">'somevalue'</span><span class="keyword">));<br />
</span><span class="default">$parent_node</span><span class="keyword">-&gt;</span><span class="default">appendChild</span><span class="keyword">(</span><span class="default">$parent</span><span class="keyword">-&gt;</span><span class="default">createElement</span><span class="keyword">(</span><span class="string">'child'</span><span class="keyword">, </span><span class="string">'anothervalue'</span><span class="keyword">));<br />
<br />
</span><span class="comment">// Add the keywordset into the new document<br />
// The $parent variable now holds the new node as a document fragment<br />
</span><span class="default">$parent</span><span class="keyword">-&gt;</span><span class="default">appendChild</span><span class="keyword">(</span><span class="default">$parent_node</span><span class="keyword">);<br />
</span><span class="default">?&gt;<br />
</span><br />
Next, we need to locate the old node:<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="comment">// Load the XML<br />
</span><span class="default">$dom </span><span class="keyword">= new </span><span class="default">DomDocument</span><span class="keyword">;<br />
</span><span class="default">$dom</span><span class="keyword">-&gt;</span><span class="default">loadXML</span><span class="keyword">(</span><span class="default">$xml</span><span class="keyword">);<br />
<br />
</span><span class="comment">// Locate the old parent node<br />
</span><span class="default">$xpath </span><span class="keyword">= new </span><span class="default">DOMXpath</span><span class="keyword">(</span><span class="default">$dom</span><span class="keyword">);<br />
</span><span class="default">$nodelist </span><span class="keyword">= </span><span class="default">$xpath</span><span class="keyword">-&gt;</span><span class="default">query</span><span class="keyword">(</span><span class="string">'/root/parent'</span><span class="keyword">);<br />
</span><span class="default">$oldnode </span><span class="keyword">= </span><span class="default">$nodelist</span><span class="keyword">-&gt;</span><span class="default">item</span><span class="keyword">(</span><span class="default">0</span><span class="keyword">);<br />
</span><span class="default">?&gt;<br />
</span><br />
We then import and replace the new node:<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="comment">// Load the $parent document fragment into the current document<br />
</span><span class="default">$newnode </span><span class="keyword">= </span><span class="default">$dom</span><span class="keyword">-&gt;</span><span class="default">importNode</span><span class="keyword">(</span><span class="default">$parent</span><span class="keyword">-&gt;</span><span class="default">documentElement</span><span class="keyword">, </span><span class="default">true</span><span class="keyword">);<br />
<br />
</span><span class="comment">// Replace<br />
</span><span class="default">$oldnode</span><span class="keyword">-&gt;</span><span class="default">parentNode</span><span class="keyword">-&gt;</span><span class="default">replaceChild</span><span class="keyword">(</span><span class="default">$newnode</span><span class="keyword">, </span><span class="default">$oldnode</span><span class="keyword">);<br />
<br />
</span><span class="comment">// Display<br />
</span><span class="keyword">echo </span><span class="default">$dom</span><span class="keyword">-&gt;</span><span class="default">saveXML</span><span class="keyword">();<br />
</span><span class="default">?&gt;<br />
</span><br />
Our new node is successfully imported:<br />
<br />
&lt;?xml version="1.0"?&gt;<br />
&lt;root&gt;<br />
&lt;parent&gt;&lt;child&gt;somevalue&lt;/child&gt;&lt;child&gt;anothervalue&lt;/child&gt;&lt;/parent&gt;<br />
&lt;/root&gt;</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="45921""></a>
  <div class="note">
   <strong class="user">franp at free dot fr</strong>
   <a href="#45921" class="date">23-Sep-2004 05:39</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
1) If your XPath query returns a NodeList including a unique item, or if you know for sure the order of the items returned, you can use the "item(n)" syntax instead of the "foreach" syntax.
<br />
This can greatly improve you code lisibility.
<br />
s the method name implies, replaceChild cannot replace a node itself but a child of a node.
<br />
The trick is to use replaceChild on the parent node of your Xpath query result.
<br />

<br />
&lt;?xml version="1.0" ?&gt;
<br />
&lt;action&gt;
<br />
&nbsp;&lt;actionGlobal&gt;
<br />
&nbsp; &lt;actionGlobalFR&gt;sometext&lt;/actionGlobalFR&gt;
<br />
&nbsp;&lt;actionGlobal&gt;
<br />
&lt;/action&gt;
<br />

<br />
$frag = $doc-&gt;createElement("actionGlobalFR");&nbsp;&nbsp; 
<br />
$fragA = $doc-&gt;createTextNode("anothertext");
<br />
$frag-&gt;appendChild($fragA);
<br />
&nbsp;&nbsp; &nbsp;&nbsp; 
<br />
$xpResult = $xp-&gt;query("/action/actionGlobal/actionGlobalFR");&nbsp;&nbsp; 
<br />
$blipblip = $xpResult-&gt;item(0)-&gt;parentNode-&gt;replaceChild($ajout, $xpResult-&gt;item(0));
<br />

<br />
2) Also, as the method name implies, replaceChild cannot replace a node itself but a child of a node.
<br />
Still it is possible to replace a node pointed by XPath istead of its child. 
<br />
The trick is to use replaceChild on the parent node of your Xpath query result.
<br />

<br />
&lt;?xml version="1.0" ?&gt;
<br />
&lt;action&gt;
<br />
&nbsp; &lt;FR&gt;French Text&lt;/FR&gt;
<br />
&lt;/action&gt;
<br />

<br />
<span class="default">&lt;?php
<br />
$frag </span><span class="keyword">= </span><span class="default">$doc</span><span class="keyword">-&gt;</span><span class="default">createElement</span><span class="keyword">(</span><span class="string">"EN"</span><span class="keyword">);&nbsp;&nbsp; 
<br />
</span><span class="default">$fragA </span><span class="keyword">= </span><span class="default">$doc</span><span class="keyword">-&gt;</span><span class="default">createTextNode</span><span class="keyword">(</span><span class="string">"English Text"</span><span class="keyword">);
<br />
</span><span class="default">$frag</span><span class="keyword">-&gt;</span><span class="default">appendChild</span><span class="keyword">(</span><span class="default">$fragA</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp;&nbsp; 
<br />
</span><span class="default">$xpResult </span><span class="keyword">= </span><span class="default">$xp</span><span class="keyword">-&gt;</span><span class="default">query</span><span class="keyword">(</span><span class="string">"/action/FR"</span><span class="keyword">);&nbsp;&nbsp; 
<br />
</span><span class="default">$blipblip </span><span class="keyword">= </span><span class="default">$xpResult</span><span class="keyword">-&gt;</span><span class="default">item</span><span class="keyword">(</span><span class="default">0</span><span class="keyword">)-&gt;</span><span class="default">parentNode</span><span class="keyword">-&gt;</span><span class="default">replaceChild</span><span class="keyword">(</span><span class="default">$fragA</span><span class="keyword">, </span><span class="default">$xpResult</span><span class="keyword">-&gt;</span><span class="default">item</span><span class="keyword">(</span><span class="default">0</span><span class="keyword">));
<br />
</span><span class="default">?&gt;
<br />
</span>
<br />
Et voil? !
<br />

<br />
This produces :
<br />
&lt;?xml version="1.0" ?&gt;
<br />
&lt;action&gt;
<br />
&nbsp; &lt;EN&gt;English Text&lt;/EN&gt;
<br />
&lt;/action&gt;
<br />

<br />
....................................................
<br />

<br />
3) Also, be carefull, you CANNOT replace a node that doesn't exist.
<br />
While this may seems obvious, it is easy to forget.
<br />

<br />
Consider this :
<br />
&lt;?xml version="1.0" ?&gt;
<br />
&lt;action&gt;
<br />
&nbsp; &lt;EN&gt;&lt;/EN&gt;
<br />
&lt;/action&gt;
<br />

<br />
You cannot use replaceChild() to turn this into :
<br />
&lt;?xml version="1.0" ?&gt;
<br />
&lt;action&gt;
<br />
&nbsp; &lt;EN&gt;Some text&lt;/EN&gt;
<br />
&lt;/action&gt;
<br />

<br />
The reason is that since the &lt;EN&gt;&lt;/EN&gt; element is empty, it has no child (this is clearer to understand if you consider that &lt;EN&gt;&lt;/EN&gt; can be written &lt;EN /&gt;).
<br />
The fact that you intend to put some text inbetween &lt;EN&gt; and &lt;/EN&gt; does not change the fact that it has no text yet, thus no child yet.
<br />
When dealing with DOM, do not take your dream for the reality. The DOM parser doen't care about your dreams. If an element is currently empty, it has no child, whatever you intend to fill in.
<br />

<br />
Thus, the solution to teh problem is to use appendChild intead of replaceChild :
<br />

<br />
<span class="default">&lt;?php
<br />
$fragA </span><span class="keyword">= </span><span class="default">$doc</span><span class="keyword">-&gt;</span><span class="default">createTextNode</span><span class="keyword">(</span><span class="string">"Some Text"</span><span class="keyword">);
<br />
</span><span class="default">$xpResult </span><span class="keyword">= </span><span class="default">$xp</span><span class="keyword">-&gt;</span><span class="default">query</span><span class="keyword">(</span><span class="string">"/action/EN"</span><span class="keyword">);&nbsp;&nbsp; 
<br />
</span><span class="default">$blipblip </span><span class="keyword">= </span><span class="default">$xpResult</span><span class="keyword">-&gt;</span><span class="default">item</span><span class="keyword">(</span><span class="default">0</span><span class="keyword">)-&gt;</span><span class="default">appendChild</span><span class="keyword">(</span><span class="default">$fragA</span><span class="keyword">);
<br />
</span><span class="default">?&gt;
<br />
</span>
<br />
This produces the awaited :
<br />
&lt;?xml version="1.0" ?&gt;
<br />
&lt;action&gt;
<br />
&nbsp; &lt;EN&gt;Some Text&lt;/EN&gt;
<br />
&lt;/action&gt;
<br />

<br />
....................................................
<br />

<br />
4) Note that the description of replaceChild in the doc is wrong. Arguments have been inverted.
<br />
The correct description is :
<br />
object DOMNode-&gt;replaceChild (object newnode, object oldnode)</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
</div>
</div>
</div></div></body></html>
