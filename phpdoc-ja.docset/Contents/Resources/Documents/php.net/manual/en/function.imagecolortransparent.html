<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
 <head>
  <meta http-equiv="content-type" content="text/html; CHARSET=shift-jis">
  <title>透明色を定義する</title>

  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <link media="all" rel="stylesheet" type="text/css" href="style.css"/>
 </head>
 <body class="docs" class="docs"><div class="navbar navbar-fixed-top">
  <div class="navbar-inner clearfix">
    <ul class="nav" style="width: 100%">
      <li style="float: left;"><a href="function.imagecolorstotal.html">≪ imagecolorstotal</a></li>
      <li style="float: right;"><a href="function.imageconvolution.html">imageconvolution ≫</a></li>
    </ul>
  </div>
</div>
<div id="breadcrumbs" class="clearfix">
  <ul class="breadcrumbs-container">
    <li><a href="index.html">PHP Manual</a></li>
    <li><a href="ref.image.html">GD および Image 関数</a></li>
    <li>透明色を定義する</li>
  </ul>
</div>
<div id="layout">
  <div id="layout-content"><div id="function.imagecolortransparent" class="refentry">
 <div class="refnamediv">
  <h1 class="refname">imagecolortransparent</h1>
  <p class="verinfo">(PHP 4, PHP 5)</p><p class="refpurpose"><span class="refname">imagecolortransparent</span> &mdash; <span class="dc-title">透明色を定義する</span></p>

 </div>
 <div class="refsect1 description" id="refsect1-function.imagecolortransparent-description">
  <h3 class="title">説明</h3>
  <div class="methodsynopsis dc-description">
   <span class="type">int</span> <span class="methodname"><strong>imagecolortransparent</strong></span>
    ( <span class="methodparam"><span class="type">resource</span> <code class="parameter">$image</code></span>
   [, <span class="methodparam"><span class="type">int</span> <code class="parameter">$color</code></span>
  ] )</div>

  <p class="para rdfs-comment">
   指定した画像 <code class="parameter">image</code>
   上の透明色を設定します。
  </p>
 </div>

 <div class="refsect1 parameters" id="refsect1-function.imagecolortransparent-parameters">
  <h3 class="title">パラメータ</h3>
  <p class="para">
   <dl>

    <dt>
<code class="parameter">
image</code></dt>
<dd>
<p class="para"><span class="function"><a href="function.imagecreatetruecolor.html" class="function">imagecreatetruecolor()</a></span>
のような画像作成関数が返す画像リソース。</p></dd>

    
     <dt>
<code class="parameter">color</code></dt>

     <dd>

      <p class="para">
       <span class="function"><a href="function.imagecolorallocate.html" class="function">imagecolorallocate()</a></span> で指定した色 ID。
      </p>
     </dd>

    
   </dl>

  </p>
 </div>

 <div class="refsect1 returnvalues" id="refsect1-function.imagecolortransparent-returnvalues">
  <h3 class="title">返り値</h3>
  <p class="para">
   新しい透明色の ID (指定しなかった場合は現在設定されている ID)
   を返します。<code class="parameter">color</code> を指定せず、
   さらに現在の透明色も設定されていない場合は -1 を返します。
  </p>
 </div>

 <div class="refsect1 examples" id="refsect1-function.imagecolortransparent-examples">
  <h3 class="title">例</h3>
  <p class="para">
   <div class="example" id="example-3291">
    <p><strong>例1 <span class="function"><strong>imagecolortransparent()</strong></span> の例</strong></p>
    <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br /></span><span style="color: #FF8000">//&nbsp;55x30&nbsp;の画像を作成します<br /></span><span style="color: #0000BB">$im&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">imagecreatetruecolor</span><span style="color: #007700">(</span><span style="color: #0000BB">55</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">30</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">$red&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">imagecolorallocate</span><span style="color: #007700">(</span><span style="color: #0000BB">$im</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">255</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">0</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">0</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">$black&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">imagecolorallocate</span><span style="color: #007700">(</span><span style="color: #0000BB">$im</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">0</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">0</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">0</span><span style="color: #007700">);<br /><br /></span><span style="color: #FF8000">//&nbsp;背景を透明にします<br /></span><span style="color: #0000BB">imagecolortransparent</span><span style="color: #007700">(</span><span style="color: #0000BB">$im</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$black</span><span style="color: #007700">);<br /><br /></span><span style="color: #FF8000">//&nbsp;赤い矩形を描画します<br /></span><span style="color: #0000BB">imagefilledrectangle</span><span style="color: #007700">(</span><span style="color: #0000BB">$im</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">4</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">4</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">50</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">25</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$red</span><span style="color: #007700">);<br /><br /></span><span style="color: #FF8000">//&nbsp;画像を保存します<br /></span><span style="color: #0000BB">imagepng</span><span style="color: #007700">(</span><span style="color: #0000BB">$im</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">'./imagecolortransparent.png'</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">imagedestroy</span><span style="color: #007700">(</span><span style="color: #0000BB">$im</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
    </div>

    <div class="example-contents"><p>上の例の出力は、
たとえば以下のようになります。</p></div>
    <div class="mediaobject">
     
     <div class="imageobject">
      <img src="images/21009b70229598c6a80eef8b45bf282b-imagecolortransparent.png" alt="出力例 : imagecolortransparent()" width="55" height="30" />
     </div>
    </div>
   </div>
  </p>
 </div>

 <div class="refsect1 notes" id="refsect1-function.imagecolortransparent-notes">
  <h3 class="title">注意</h3>
  <blockquote class="note"><p><strong class="note">注意</strong>: 
   <p class="para">
    透過性は <span class="function"><a href="function.imagecopymerge.html" class="function">imagecopymerge()</a></span> かつ True
    カラーの場合のみコピーされます。<span class="function"><a href="function.imagecopy.html" class="function">imagecopy()</a></span>
    もしくはパレットイメージの場合はコピーされません。
   </p>
  </p></blockquote>
  <blockquote class="note"><p><strong class="note">注意</strong>: 
   <p class="para">
    透明色は画像のプロパティであり、色のプロパティではありません。
    ある色を透明色と定義したら、画像上で既にその色で着色されてる領域も
    透明になります。
   </p>
  </p></blockquote>
 </div>

</div><div id="usernotes">
 <div class="head">
  <h3 class="title">User Contributed Notes</h3>
 </div>
<div id="allnotes">  <a name="107237""></a>
  <div class="note">
   <strong class="user">john at jbwalker dot com</strong>
   <a href="#107237" class="date">24-Jan-2012 05:42</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
A transparent background with text doesn't seem to work very well because of the antialiasing . But I tried the following kluge and it turned out very well:
<br />

<br />
<span class="default">&lt;?php
<br />
&nbsp;&nbsp; $im </span><span class="keyword">= </span><span class="default">imagecreatetruecolor</span><span class="keyword">(</span><span class="default">100</span><span class="keyword">,</span><span class="default">20</span><span class="keyword">);
<br />
&nbsp;&nbsp; </span><span class="default">$almostblack </span><span class="keyword">= </span><span class="default">imagecolorallocate</span><span class="keyword">(</span><span class="default">$im</span><span class="keyword">,</span><span class="default">254</span><span class="keyword">,</span><span class="default">254</span><span class="keyword">,</span><span class="default">254</span><span class="keyword">);
<br />
&nbsp;&nbsp; </span><span class="default">imagefill</span><span class="keyword">(</span><span class="default">$im</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">,</span><span class="default">$almostblack</span><span class="keyword">);
<br />
&nbsp;&nbsp; </span><span class="default">$black </span><span class="keyword">= </span><span class="default">imagecolorallocate</span><span class="keyword">(</span><span class="default">$im</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">);
<br />
&nbsp;&nbsp; </span><span class="default">imagecolortransparent</span><span class="keyword">(</span><span class="default">$im</span><span class="keyword">,</span><span class="default">$almostblack</span><span class="keyword">);
<br />
&nbsp;&nbsp; </span><span class="comment">//... set x and y..
<br />
&nbsp;&nbsp; </span><span class="default">imagettftext</span><span class="keyword">(</span><span class="default">$im</span><span class="keyword">,</span><span class="default">8</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">,</span><span class="default">$x</span><span class="keyword">,</span><span class="default">$y</span><span class="keyword">,</span><span class="default">$black</span><span class="keyword">,</span><span class="string">"calibri.ttf"</span><span class="keyword">,</span><span class="default">$txt</span><span class="keyword">);
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="104554""></a>
  <div class="note">
   <strong class="user">email at vladislav dot net</strong>
   <a href="#104554" class="date">22-Jun-2011 11:42</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Pay attention, that some GIF images may not include a transparent color. A good example of forced transparency in resized GIF image was given by markglibres at yahoo dot com 29-Mar-2009 02:48. But sometimes the transparent color in GIF images can be not set. The problem is, that the color you force to be transparent can be used in the original GIF as opaque and you will loose that color in resized image. The solution is not to use some default transparent color and to leave the resized image without transparent color (the same as original GIF). I used (nearly) the following code to make resized GIF images trnsparent&nbsp; only when the transparency is needed:<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="comment">/* ... */<br />
<br />
</span><span class="default">$img </span><span class="keyword">= </span><span class="default">ImageCreateFromGIF</span><span class="keyword">(</span><span class="default">$f</span><span class="keyword">); </span><span class="comment">/* create image from existing GIF: original image file name $f you may take from where you need */<br />
</span><span class="default">$transparent_index </span><span class="keyword">= </span><span class="default">ImageColorTransparent</span><span class="keyword">(</span><span class="default">$img</span><span class="keyword">); </span><span class="comment">/* gives the index of current transparent color or -1 */<br />
</span><span class="keyword">if(</span><span class="default">$transparent_index</span><span class="keyword">!=(-</span><span class="default">1</span><span class="keyword">)) </span><span class="default">$transparent_color </span><span class="keyword">= </span><span class="default">ImageColorsForIndex</span><span class="keyword">(</span><span class="default">$img</span><span class="keyword">,</span><span class="default">$transparent_index</span><span class="keyword">);<br />
<br />
</span><span class="comment">/* ... */<br />
<br />
</span><span class="default">$img_resized </span><span class="keyword">= </span><span class="default">ImageCreateTrueColor</span><span class="keyword">( </span><span class="default">$nw</span><span class="keyword">, </span><span class="default">$nh </span><span class="keyword">); </span><span class="comment">/* (the new width $nw and height $nh must be defined before) */<br />
</span><span class="keyword">if(!empty(</span><span class="default">$transparent_color</span><span class="keyword">)) </span><span class="comment">/* simple check to find wether transparent color was set or not */<br />
</span><span class="keyword">{<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$transparent_new </span><span class="keyword">= </span><span class="default">ImageColorAllocate</span><span class="keyword">( </span><span class="default">$img_resized</span><span class="keyword">, </span><span class="default">$transparent_color</span><span class="keyword">[</span><span class="string">'red'</span><span class="keyword">], </span><span class="default">$transparent_color</span><span class="keyword">[</span><span class="string">'green'</span><span class="keyword">], </span><span class="default">$transparent_color</span><span class="keyword">[</span><span class="string">'blue'</span><span class="keyword">] );<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$transparent_new_index </span><span class="keyword">= </span><span class="default">ImageColorTransparent</span><span class="keyword">( </span><span class="default">$img_resized</span><span class="keyword">, </span><span class="default">$transparent_new </span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">ImageFill</span><span class="keyword">( </span><span class="default">$img_resized</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">, </span><span class="default">$transparent_new_index </span><span class="keyword">); </span><span class="comment">/* don't forget to fill the new image with the transparent color */<br />
</span><span class="keyword">}<br />
list(</span><span class="default">$w</span><span class="keyword">,</span><span class="default">$h</span><span class="keyword">) = </span><span class="default">GetImageSize</span><span class="keyword">(</span><span class="default">$f</span><span class="keyword">); </span><span class="comment">/* defines the original width $w and height $h */<br />
</span><span class="keyword">if( </span><span class="default">ImageCopyResized</span><span class="keyword">( </span><span class="default">$img_resized</span><span class="keyword">, </span><span class="default">$img</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">, </span><span class="default">$nw</span><span class="keyword">,</span><span class="default">$nh</span><span class="keyword">, </span><span class="default">$w</span><span class="keyword">,</span><span class="default">$h </span><span class="keyword">) ) </span><span class="comment">/* resized copying and replacing the original image */<br />
</span><span class="keyword">{<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">ImageDestroy</span><span class="keyword">(</span><span class="default">$img</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$img </span><span class="keyword">= </span><span class="default">$img_resized</span><span class="keyword">;<br />
}<br />
<br />
</span><span class="comment">/* ... */<br />
<br />
</span><span class="default">header</span><span class="keyword">(</span><span class="string">'Content-Type: image/gif'</span><span class="keyword">);<br />
</span><span class="default">ImageGIF</span><span class="keyword">(</span><span class="default">$img</span><span class="keyword">);<br />
</span><span class="default">ImageDestroy</span><span class="keyword">(</span><span class="default">$img</span><span class="keyword">);<br />
</span><span class="default">?&gt;<br />
</span><br />
P.S.<br />
If there some errors, I hope you could understood the idea.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="100200""></a>
  <div class="note">
   <strong class="user">admin at fastproxyservers dot org</strong>
   <a href="#100200" class="date">30-Sep-2010 06:00</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I would like to share with others how to make PNG image transparent. I have tried almost all examples described on that page but none of them work for me. Finally I found the solution, but there is a bit cheating :) but who cares if it works?
<br />

<br />
So when I tried to allocate white (as an example) color as a transparent, it worked randomly (lets say 1 in 10 examples). That in turn pushed me to the idea that the problem is that white color is already exist in color palette. So if I try to add another white color with DIFFERENT index as a transparent, that will cause error.
<br />

<br />
So I found the solution, instead of adding new index, I searched for the white color's index in the color palette and made it defined as transparent :) The best idea is to use not a white but left bottom corner as transparent color (I guess that s standard for some other software languages).
<br />

<br />
<span class="default">&lt;?php
<br />
$index </span><span class="keyword">= </span><span class="default">imagecolorexact</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">image</span><span class="keyword">, </span><span class="default">255</span><span class="keyword">, </span><span class="default">255</span><span class="keyword">, </span><span class="default">255</span><span class="keyword">);
<br />
</span><span class="default">imagecolortransparent</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">image</span><span class="keyword">, </span><span class="default">$index</span><span class="keyword">);
<br />
</span><span class="default">?&gt;
<br />
</span>
<br />
All you need is to add that two lines before outputting your result.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="91053""></a>
  <div class="note">
   <strong class="user">ajamal</strong>
   <a href="#91053" class="date">22-May-2009 03:06</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
This might be of importance to newbies...If you are trying to create GIF's with transparencies, stick to the 216 colour pallet for all colours on the image... or transparencies wont work...at the very least yo will get dithering...</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="89927""></a>
  <div class="note">
   <strong class="user">markglibres at yahoo dot com</strong>
   <a href="#89927" class="date">29-Mar-2009 03:48</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I've made a very simple script that will retain transparency of images especially when resizing.
<br />

<br />
NOTE: Transparency is only supported on GIF and PNG files.
<br />

<br />
Parameters:
<br />

<br />
$new_image = image resource identifier such as returned by imagecreatetruecolor(). must be passed by reference
<br />
$image_source = image resource identifier returned by imagecreatefromjpeg, imagecreatefromgif and imagecreatefrompng. must be passed by reference
<br />

<br />
<span class="default">&lt;?php
<br />
</span><span class="keyword">function </span><span class="default">setTransparency</span><span class="keyword">(</span><span class="default">$new_image</span><span class="keyword">,</span><span class="default">$image_source</span><span class="keyword">)
<br />
&nbsp;&nbsp;&nbsp; {
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; 
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$transparencyIndex </span><span class="keyword">= </span><span class="default">imagecolortransparent</span><span class="keyword">(</span><span class="default">$image_source</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$transparencyColor </span><span class="keyword">= array(</span><span class="string">'red' </span><span class="keyword">=&gt; </span><span class="default">255</span><span class="keyword">, </span><span class="string">'green' </span><span class="keyword">=&gt; </span><span class="default">255</span><span class="keyword">, </span><span class="string">'blue' </span><span class="keyword">=&gt; </span><span class="default">255</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">$transparencyIndex </span><span class="keyword">&gt;= </span><span class="default">0</span><span class="keyword">) {
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$transparencyColor&nbsp; &nbsp; </span><span class="keyword">= </span><span class="default">imagecolorsforindex</span><span class="keyword">(</span><span class="default">$image_source</span><span class="keyword">, </span><span class="default">$transparencyIndex</span><span class="keyword">);&nbsp; &nbsp; 
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; 
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$transparencyIndex&nbsp; &nbsp; </span><span class="keyword">= </span><span class="default">imagecolorallocate</span><span class="keyword">(</span><span class="default">$new_image</span><span class="keyword">, </span><span class="default">$transparencyColor</span><span class="keyword">[</span><span class="string">'red'</span><span class="keyword">], </span><span class="default">$transparencyColor</span><span class="keyword">[</span><span class="string">'green'</span><span class="keyword">], </span><span class="default">$transparencyColor</span><span class="keyword">[</span><span class="string">'blue'</span><span class="keyword">]);
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">imagefill</span><span class="keyword">(</span><span class="default">$new_image</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">$transparencyIndex</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">imagecolortransparent</span><span class="keyword">(</span><span class="default">$new_image</span><span class="keyword">, </span><span class="default">$transparencyIndex</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; 
<br />
&nbsp;&nbsp;&nbsp; } 
<br />
</span><span class="default">?&gt;
<br />
</span>
<br />

<br />
Sample Usage: (resizing)
<br />

<br />
<span class="default">&lt;?php
<br />
$image_source </span><span class="keyword">= </span><span class="default">imagecreatefrompng</span><span class="keyword">(</span><span class="string">'test.png'</span><span class="keyword">);
<br />
</span><span class="default">$new_image </span><span class="keyword">= </span><span class="default">imagecreatetruecolor</span><span class="keyword">(</span><span class="default">$width</span><span class="keyword">, </span><span class="default">$height</span><span class="keyword">);
<br />
</span><span class="default">setTransparency</span><span class="keyword">(</span><span class="default">$new_image</span><span class="keyword">,</span><span class="default">$image_source</span><span class="keyword">);
<br />
</span><span class="default">imagecopyresampled</span><span class="keyword">(</span><span class="default">$new_image</span><span class="keyword">, </span><span class="default">$image_source</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">$new_width</span><span class="keyword">, </span><span class="default">$new_height</span><span class="keyword">, </span><span class="default">$old_width</span><span class="keyword">, </span><span class="default">$old_height</span><span class="keyword">);
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="88173""></a>
  <div class="note">
   <strong class="user">designovermatter at gmail dot com</strong>
   <a href="#88173" class="date">14-Jan-2009 01:03</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I was searching for a PHP code that makes transparent rounded corners and found none. So had to write my own:
<br />

<br />
<span class="default">&lt;?php
<br />

<br />
$image </span><span class="keyword">= </span><span class="string">"v.png"</span><span class="keyword">;
<br />
</span><span class="default">$corner </span><span class="keyword">= </span><span class="default">40</span><span class="keyword">;
<br />

<br />
</span><span class="default">file_exists</span><span class="keyword">(</span><span class="default">$image</span><span class="keyword">) or die(</span><span class="string">"No such file: "</span><span class="keyword">.</span><span class="default">$image</span><span class="keyword">); </span><span class="comment">//check if image exists before processing
<br />

<br />
</span><span class="default">$dim </span><span class="keyword">= </span><span class="default">getimagesize</span><span class="keyword">(</span><span class="default">$image</span><span class="keyword">);
<br />

<br />
</span><span class="comment">//create from type handle
<br />
</span><span class="keyword">if(</span><span class="default">$dim</span><span class="keyword">[</span><span class="default">2</span><span class="keyword">] == </span><span class="default">1</span><span class="keyword">) </span><span class="default">$new </span><span class="keyword">= </span><span class="default">imagecreatefromjpeg</span><span class="keyword">(</span><span class="default">$image</span><span class="keyword">);
<br />
elseif(</span><span class="default">$dim</span><span class="keyword">[</span><span class="default">2</span><span class="keyword">] == </span><span class="default">2</span><span class="keyword">) </span><span class="default">$new </span><span class="keyword">= </span><span class="default">imagecreatefromgif</span><span class="keyword">(</span><span class="default">$image</span><span class="keyword">);
<br />
elseif(</span><span class="default">$dim</span><span class="keyword">[</span><span class="default">2</span><span class="keyword">] == </span><span class="default">3</span><span class="keyword">) </span><span class="default">$new </span><span class="keyword">= </span><span class="default">imagecreatefrompng</span><span class="keyword">(</span><span class="default">$image</span><span class="keyword">);
<br />
else die(</span><span class="string">"Unsupported format: "</span><span class="keyword">.</span><span class="default">$dim</span><span class="keyword">[</span><span class="default">2</span><span class="keyword">]);
<br />

<br />
</span><span class="comment">//find colorcode
<br />
</span><span class="default">$palette </span><span class="keyword">= </span><span class="default">imagecreatetruecolor</span><span class="keyword">(</span><span class="default">$dim</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">], </span><span class="default">$dim</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">]);
<br />
</span><span class="default">$found </span><span class="keyword">= </span><span class="default">false</span><span class="keyword">;
<br />
while(</span><span class="default">$found </span><span class="keyword">== </span><span class="default">false</span><span class="keyword">) {
<br />
&nbsp;&nbsp;&nbsp; 
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$r </span><span class="keyword">= </span><span class="default">rand</span><span class="keyword">(</span><span class="default">0</span><span class="keyword">, </span><span class="default">255</span><span class="keyword">);
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$g </span><span class="keyword">= </span><span class="default">rand</span><span class="keyword">(</span><span class="default">0</span><span class="keyword">, </span><span class="default">255</span><span class="keyword">);
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$b </span><span class="keyword">= </span><span class="default">rand</span><span class="keyword">(</span><span class="default">0</span><span class="keyword">, </span><span class="default">255</span><span class="keyword">);
<br />
&nbsp;&nbsp;&nbsp; 
<br />
&nbsp;&nbsp;&nbsp; if(</span><span class="default">imagecolorexact</span><span class="keyword">(</span><span class="default">$new</span><span class="keyword">, </span><span class="default">$r</span><span class="keyword">, </span><span class="default">$g</span><span class="keyword">, </span><span class="default">$b</span><span class="keyword">) != (-</span><span class="default">1</span><span class="keyword">)) {
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; 
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$colorcode </span><span class="keyword">= </span><span class="default">imagecolorallocate</span><span class="keyword">(</span><span class="default">$palette</span><span class="keyword">, </span><span class="default">$r</span><span class="keyword">, </span><span class="default">$g</span><span class="keyword">, </span><span class="default">$b</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$found </span><span class="keyword">= </span><span class="default">true</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; 
<br />
&nbsp;&nbsp;&nbsp; }
<br />
&nbsp;&nbsp;&nbsp; 
<br />
}
<br />

<br />
</span><span class="comment">//draw corners
<br />
</span><span class="default">imagearc</span><span class="keyword">(</span><span class="default">$new</span><span class="keyword">, </span><span class="default">$corner</span><span class="keyword">-</span><span class="default">1</span><span class="keyword">, </span><span class="default">$corner</span><span class="keyword">-</span><span class="default">1</span><span class="keyword">, </span><span class="default">$corner</span><span class="keyword">*</span><span class="default">2</span><span class="keyword">, </span><span class="default">$corner</span><span class="keyword">*</span><span class="default">2</span><span class="keyword">, </span><span class="default">180</span><span class="keyword">, </span><span class="default">270</span><span class="keyword">, </span><span class="default">$colorcode</span><span class="keyword">);
<br />
</span><span class="default">imagefilltoborder</span><span class="keyword">(</span><span class="default">$new</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">$colorcode</span><span class="keyword">, </span><span class="default">$colorcode</span><span class="keyword">);
<br />

<br />
</span><span class="default">imagearc</span><span class="keyword">(</span><span class="default">$new</span><span class="keyword">, </span><span class="default">$dim</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">]-</span><span class="default">$corner</span><span class="keyword">, </span><span class="default">$corner</span><span class="keyword">-</span><span class="default">1</span><span class="keyword">, </span><span class="default">$corner</span><span class="keyword">*</span><span class="default">2</span><span class="keyword">, </span><span class="default">$corner</span><span class="keyword">*</span><span class="default">2</span><span class="keyword">, </span><span class="default">270</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">$colorcode</span><span class="keyword">);
<br />
</span><span class="default">imagefilltoborder</span><span class="keyword">(</span><span class="default">$new</span><span class="keyword">, </span><span class="default">$dim</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">], </span><span class="default">0</span><span class="keyword">, </span><span class="default">$colorcode</span><span class="keyword">, </span><span class="default">$colorcode</span><span class="keyword">);
<br />

<br />
</span><span class="default">imagearc</span><span class="keyword">(</span><span class="default">$new</span><span class="keyword">, </span><span class="default">$corner</span><span class="keyword">-</span><span class="default">1</span><span class="keyword">, </span><span class="default">$dim</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">]-</span><span class="default">$corner</span><span class="keyword">, </span><span class="default">$corner</span><span class="keyword">*</span><span class="default">2</span><span class="keyword">, </span><span class="default">$corner</span><span class="keyword">*</span><span class="default">2</span><span class="keyword">, </span><span class="default">90</span><span class="keyword">, </span><span class="default">180</span><span class="keyword">, </span><span class="default">$colorcode</span><span class="keyword">);
<br />
</span><span class="default">imagefilltoborder</span><span class="keyword">(</span><span class="default">$new</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">$dim</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">], </span><span class="default">$colorcode</span><span class="keyword">, </span><span class="default">$colorcode</span><span class="keyword">);
<br />

<br />
</span><span class="default">imagearc</span><span class="keyword">(</span><span class="default">$new</span><span class="keyword">, </span><span class="default">$dim</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">]-</span><span class="default">$corner</span><span class="keyword">, </span><span class="default">$dim</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">]-</span><span class="default">$corner</span><span class="keyword">, </span><span class="default">$corner</span><span class="keyword">*</span><span class="default">2</span><span class="keyword">, </span><span class="default">$corner</span><span class="keyword">*</span><span class="default">2</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">90</span><span class="keyword">, </span><span class="default">$colorcode</span><span class="keyword">);
<br />
</span><span class="default">imagefilltoborder</span><span class="keyword">(</span><span class="default">$new</span><span class="keyword">, </span><span class="default">$dim</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">], </span><span class="default">$dim</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">], </span><span class="default">$colorcode</span><span class="keyword">, </span><span class="default">$colorcode</span><span class="keyword">);
<br />

<br />
</span><span class="default">imagecolortransparent</span><span class="keyword">(</span><span class="default">$new</span><span class="keyword">, </span><span class="default">$colorcode</span><span class="keyword">); </span><span class="comment">//make corners transparent
<br />

<br />
//display rounded image
<br />
</span><span class="default">header</span><span class="keyword">(</span><span class="string">"Content: image/png"</span><span class="keyword">);
<br />
</span><span class="default">imagepng</span><span class="keyword">(</span><span class="default">$new</span><span class="keyword">);
<br />
</span><span class="default">imagedestroy</span><span class="keyword">(</span><span class="default">$new</span><span class="keyword">); 
<br />

<br />
</span><span class="default">?&gt;
<br />
</span>
<br />
It draws an arc and fills to border with a colorcode - a color that doesnot exist in current image, to make it transparent in the end.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="86593""></a>
  <div class="note">
   <strong class="user">steved at HaHaHa dot com dot au</strong>
   <a href="#86593" class="date">25-Oct-2008 07:28</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
How to center your text both vertically and horizontally in a GD image:
<br />

<br />
<span class="default">&lt;?php
<br />
</span><span class="comment">//get box size
<br />
</span><span class="default">$box </span><span class="keyword">= </span><span class="default">imagettfbbox</span><span class="keyword">(</span><span class="default">$titlesize</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">$titlefont</span><span class="keyword">, </span><span class="default">$title</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; 
<br />
</span><span class="comment">//Find out the width and height of the text box
<br />
</span><span class="default">$textW </span><span class="keyword">= </span><span class="default">$box</span><span class="keyword">[</span><span class="default">2</span><span class="keyword">] - </span><span class="default">$box</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">];
<br />
</span><span class="default">$textH </span><span class="keyword">= </span><span class="default">$box</span><span class="keyword">[</span><span class="default">5</span><span class="keyword">] - </span><span class="default">$box</span><span class="keyword">[</span><span class="default">3</span><span class="keyword">];
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; 
<br />
</span><span class="comment">// Calculate the positions
<br />
</span><span class="default">$positionLeft </span><span class="keyword">= (</span><span class="default">$width </span><span class="keyword">- </span><span class="default">$textW</span><span class="keyword">)/</span><span class="default">2</span><span class="keyword">;
<br />
</span><span class="default">$positionTop </span><span class="keyword">= ((</span><span class="default">$height </span><span class="keyword">- </span><span class="default">$textH</span><span class="keyword">)/</span><span class="default">2</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; 
<br />
</span><span class="comment">// Add some text
<br />
</span><span class="keyword">if(</span><span class="default">$align</span><span class="keyword">==</span><span class="string">"center"</span><span class="keyword">){&nbsp; &nbsp; 
<br />
</span><span class="default">imagettftext</span><span class="keyword">(</span><span class="default">$pic</span><span class="keyword">, </span><span class="default">size</span><span class="keyword">, </span><span class="default">angle</span><span class="keyword">, </span><span class="default">$positionLeft</span><span class="keyword">, </span><span class="default">$positionTop</span><span class="keyword">, </span><span class="default">colour</span><span class="keyword">, </span><span class="default">font</span><span class="keyword">, </span><span class="default">message</span><span class="keyword">);
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="85678""></a>
  <div class="note">
   <strong class="user">cca220v</strong>
   <a href="#85678" class="date">11-Sep-2008 11:47</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I found out the hard way that for two png's with alpha transparency to correctly stack you need to explicitly re-enable alpha blending.<br />
<br />
$img=imagecreatetruecolor($dx,$dy);<br />
$img1=imagecreatefrompng($png1); //first layer<br />
$img2=imagecreatefrompng($png2); //second layer (smaller image)<br />
<br />
imagealphablending($img, false);<br />
$transparent = imagecolorallocatealpha($img, 0, 0, 0, 127);<br />
imagefill($img, 0, 0, $transparent);<br />
imagesavealpha($img,true);<br />
imagealphablending($img, true); //removing this causes the second layer's transparency to go trough the 1st layer erasing it (the image &gt;is&lt; transparent there ... as is the 2nd layer ... but not the 1st so it should not be transparent)<br />
<br />
imagecopyresampled($img,$img1,<br />
imagecopyresampled($img,$img2,</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="82223""></a>
  <div class="note">
   <strong class="user">yousuf at philipz dot com</strong>
   <a href="#82223" class="date">01-Apr-2008 08:45</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Well 8-bit gif and png files can have multiple transparent colors, so detecting the transparent color by manually looking into the file or using imagecolortransparent and using the detected rgb color as the background color when imagecopy'ing (or other image copying functions) on a true color image will not work. The only means of getting the transparent pixels to appear is to copy the pixel colors one by one to a new true color image. Here's some code i wrote to do this.<br />
<br />
$original_image = @imagecreatefromgif( $original_image_file );<br />
<br />
$original_image_width = imagesx( $original_image );<br />
$original_image_height = imagesy( $original_image );<br />
<br />
if ( !imageistruecolor($original_image) ) {<br />
&nbsp;&nbsp; # detects if its non-true color image<br />
&nbsp;&nbsp; if ( imagecolortransparent($original_image) &gt;= 0 ) {<br />
&nbsp;&nbsp; &nbsp;&nbsp; # detects if any of the color palette has been set to transparent<br />
&nbsp;&nbsp; &nbsp;&nbsp; $truecolor = imagecreatetruecolor( $original_image_width, $original_image_height );<br />
&nbsp;&nbsp; &nbsp;&nbsp; for ($x = 0; $x &lt; $original_image_width; $x++) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; for ($y = 0; $y &lt; $original_image_height; $y++) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $color_index = ImageColorAt($original_image, $x, $y);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if ( !$color_palette[$color_index] ) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $rgb = imagecolorsforindex($original_image, $color_index);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $color_to_set = imagecolorallocate($truecolor, $rgb['red'], $rgb['green'], $rgb['blue']);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $color_palette[$color_index] = $color_to_set;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; } else {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $color_to_set = $color_palette[$color_index];<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; imagesetpixel($truecolor, $x, $y, $color_to_set);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; }<br />
&nbsp;&nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp;&nbsp; imagedestroy($original_image);<br />
&nbsp;&nbsp; &nbsp;&nbsp; $original_image = $truecolor;<br />
&nbsp;&nbsp; }<br />
}</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="82096""></a>
  <div class="note">
   <strong class="user">kroccamen, gmail</strong>
   <a href="#82096" class="date">27-Mar-2008 02:56</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Sorry, below should be:<br />
<br />
<span class="default">&lt;?php<br />
$is_alpha </span><span class="keyword">= </span><span class="default">ord </span><span class="keyword">(</span><span class="default">file_get_contents </span><span class="keyword">(</span><span class="default">$file_path</span><span class="keyword">, </span><span class="default">false</span><span class="keyword">, </span><span class="default">null</span><span class="keyword">, </span><span class="default">25</span><span class="keyword">, </span><span class="default">1</span><span class="keyword">)) &amp; </span><span class="default">4</span><span class="keyword">;<br />
</span><span class="default">?&gt;<br />
</span><br />
much better :)<br />
Both types 4 (greyscale transparent png), and 6 (colour transparent png) have bit 4 set, so there's no need to bitwise twice and there's no need for == as the return value will be 4 or 0, which is easily interpreted as true or false elsewhere in your code.<br />
<br />
note: file_get_contents isn't reading the whole file in this instance, just 1 byte on its own and that's it, so you can be assured this is fast and safe.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="82032""></a>
  <div class="note">
   <strong class="user">kroccamen, gmail</strong>
   <a href="#82032" class="date">25-Mar-2008 01:44</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
@wesley gunn:<br />
Thank you very, very much for the code to determine if a PNG is 24 or 32-bit :)<br />
Here's an improved version in one line without using a file-handle<br />
<br />
<span class="default">&lt;?php<br />
$is_alpha </span><span class="keyword">= ((</span><span class="default">ord </span><span class="keyword">(<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">file_get_contents </span><span class="keyword">(</span><span class="default">$filename</span><span class="keyword">, </span><span class="default">false</span><span class="keyword">, </span><span class="default">null</span><span class="keyword">, </span><span class="default">25</span><span class="keyword">, </span><span class="default">1</span><span class="keyword">)<br />
) &amp; </span><span class="default">6</span><span class="keyword">) &amp; </span><span class="default">4</span><span class="keyword">) == </span><span class="default">4</span><span class="keyword">;<br />
</span><span class="default">?&gt;<br />
</span><br />
Gives true for a PNG with alpha, false otherwise.<br />
This cannot detect 8-bit PNGs with transparency, but you could do that by searching the file contents for the presence of "PLTE" *AND* "tRNS".</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="81713""></a>
  <div class="note">
   <strong class="user">tomas at cimax dot com</strong>
   <a href="#81713" class="date">10-Mar-2008 09:19</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
On some versions you must set the index number of that color in color pallete rather than the color! So if you allocate color with imagecolorallocate, that this color gets 0 index on color pallete so than you must call: imagecolortransparent ( resource $image , 0 ) to make the image transparent!</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="81439""></a>
  <div class="note">
   <strong class="user">Anonymous</strong>
   <a href="#81439" class="date">28-Feb-2008 11:52</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I came across some images that have transparent color allocated even if they don't have any transparent pixels (transparent color is unused).</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="80935""></a>
  <div class="note">
   <strong class="user">fmkaiba at optonline dot net</strong>
   <a href="#80935" class="date">07-Feb-2008 05:05</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
This is my 'perfect' (i use that word lightly) thumbnail generation script, switch '$transparency' to true to have it do its best to handle transparency in gifs and pngs. this code is built off of comments and advice of everyone else here, and i do not deserve full credit. So far this handles every error i can throw at it.<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">function </span><span class="default">createthumb</span><span class="keyword">(</span><span class="default">$name</span><span class="keyword">, </span><span class="default">$newname</span><span class="keyword">, </span><span class="default">$new_w</span><span class="keyword">, </span><span class="default">$new_h</span><span class="keyword">, </span><span class="default">$border</span><span class="keyword">=</span><span class="default">false</span><span class="keyword">, </span><span class="default">$transparency</span><span class="keyword">=</span><span class="default">true</span><span class="keyword">, </span><span class="default">$base64</span><span class="keyword">=</span><span class="default">false</span><span class="keyword">) {<br />
&nbsp;&nbsp;&nbsp; if(</span><span class="default">file_exists</span><span class="keyword">(</span><span class="default">$newname</span><span class="keyword">))<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; @</span><span class="default">unlink</span><span class="keyword">(</span><span class="default">$newname</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; if(!</span><span class="default">file_exists</span><span class="keyword">(</span><span class="default">$name</span><span class="keyword">))<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">false</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$arr </span><span class="keyword">= </span><span class="default">split</span><span class="keyword">(</span><span class="string">"\."</span><span class="keyword">,</span><span class="default">$name</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$ext </span><span class="keyword">= </span><span class="default">$arr</span><span class="keyword">[</span><span class="default">count</span><span class="keyword">(</span><span class="default">$arr</span><span class="keyword">)-</span><span class="default">1</span><span class="keyword">];<br />
<br />
&nbsp;&nbsp;&nbsp; if(</span><span class="default">$ext</span><span class="keyword">==</span><span class="string">"jpeg" </span><span class="keyword">|| </span><span class="default">$ext</span><span class="keyword">==</span><span class="string">"jpg"</span><span class="keyword">){<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$img </span><span class="keyword">= @</span><span class="default">imagecreatefromjpeg</span><span class="keyword">(</span><span class="default">$name</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; } elseif(</span><span class="default">$ext</span><span class="keyword">==</span><span class="string">"png"</span><span class="keyword">){<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$img </span><span class="keyword">= @</span><span class="default">imagecreatefrompng</span><span class="keyword">(</span><span class="default">$name</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; } elseif(</span><span class="default">$ext</span><span class="keyword">==</span><span class="string">"gif"</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$img </span><span class="keyword">= @</span><span class="default">imagecreatefromgif</span><span class="keyword">(</span><span class="default">$name</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; if(!</span><span class="default">$img</span><span class="keyword">)<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">false</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$old_x </span><span class="keyword">= </span><span class="default">imageSX</span><span class="keyword">(</span><span class="default">$img</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$old_y </span><span class="keyword">= </span><span class="default">imageSY</span><span class="keyword">(</span><span class="default">$img</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; if(</span><span class="default">$old_x </span><span class="keyword">&lt; </span><span class="default">$new_w </span><span class="keyword">&amp;&amp; </span><span class="default">$old_y </span><span class="keyword">&lt; </span><span class="default">$new_h</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$thumb_w </span><span class="keyword">= </span><span class="default">$old_x</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$thumb_h </span><span class="keyword">= </span><span class="default">$old_y</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; } elseif (</span><span class="default">$old_x </span><span class="keyword">&gt; </span><span class="default">$old_y</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$thumb_w </span><span class="keyword">= </span><span class="default">$new_w</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$thumb_h </span><span class="keyword">= </span><span class="default">floor</span><span class="keyword">((</span><span class="default">$old_y</span><span class="keyword">*(</span><span class="default">$new_h</span><span class="keyword">/</span><span class="default">$old_x</span><span class="keyword">)));<br />
&nbsp;&nbsp;&nbsp; } elseif (</span><span class="default">$old_x </span><span class="keyword">&lt; </span><span class="default">$old_y</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$thumb_w </span><span class="keyword">= </span><span class="default">floor</span><span class="keyword">(</span><span class="default">$old_x</span><span class="keyword">*(</span><span class="default">$new_w</span><span class="keyword">/</span><span class="default">$old_y</span><span class="keyword">));<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$thumb_h </span><span class="keyword">= </span><span class="default">$new_h</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; } elseif (</span><span class="default">$old_x </span><span class="keyword">== </span><span class="default">$old_y</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$thumb_w </span><span class="keyword">= </span><span class="default">$new_w</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$thumb_h </span><span class="keyword">= </span><span class="default">$new_h</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$thumb_w </span><span class="keyword">= (</span><span class="default">$thumb_w</span><span class="keyword">&lt;</span><span class="default">1</span><span class="keyword">) ? </span><span class="default">1 </span><span class="keyword">: </span><span class="default">$thumb_w</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$thumb_h </span><span class="keyword">= (</span><span class="default">$thumb_h</span><span class="keyword">&lt;</span><span class="default">1</span><span class="keyword">) ? </span><span class="default">1 </span><span class="keyword">: </span><span class="default">$thumb_h</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$new_img </span><span class="keyword">= </span><span class="default">ImageCreateTrueColor</span><span class="keyword">(</span><span class="default">$thumb_w</span><span class="keyword">, </span><span class="default">$thumb_h</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; if(</span><span class="default">$transparency</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if(</span><span class="default">$ext</span><span class="keyword">==</span><span class="string">"png"</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">imagealphablending</span><span class="keyword">(</span><span class="default">$new_img</span><span class="keyword">, </span><span class="default">false</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$colorTransparent </span><span class="keyword">= </span><span class="default">imagecolorallocatealpha</span><span class="keyword">(</span><span class="default">$new_img</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">127</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">imagefill</span><span class="keyword">(</span><span class="default">$new_img</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">$colorTransparent</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">imagesavealpha</span><span class="keyword">(</span><span class="default">$new_img</span><span class="keyword">, </span><span class="default">true</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; } elseif(</span><span class="default">$ext</span><span class="keyword">==</span><span class="string">"gif"</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$trnprt_indx </span><span class="keyword">= </span><span class="default">imagecolortransparent</span><span class="keyword">(</span><span class="default">$img</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">$trnprt_indx </span><span class="keyword">&gt;= </span><span class="default">0</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">//its transparent<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$trnprt_color </span><span class="keyword">= </span><span class="default">imagecolorsforindex</span><span class="keyword">(</span><span class="default">$img</span><span class="keyword">, </span><span class="default">$trnprt_indx</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$trnprt_indx </span><span class="keyword">= </span><span class="default">imagecolorallocate</span><span class="keyword">(</span><span class="default">$new_img</span><span class="keyword">, </span><span class="default">$trnprt_color</span><span class="keyword">[</span><span class="string">'red'</span><span class="keyword">], </span><span class="default">$trnprt_color</span><span class="keyword">[</span><span class="string">'green'</span><span class="keyword">], </span><span class="default">$trnprt_color</span><span class="keyword">[</span><span class="string">'blue'</span><span class="keyword">]);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">imagefill</span><span class="keyword">(</span><span class="default">$new_img</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">$trnprt_indx</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">imagecolortransparent</span><span class="keyword">(</span><span class="default">$new_img</span><span class="keyword">, </span><span class="default">$trnprt_indx</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; } else {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">Imagefill</span><span class="keyword">(</span><span class="default">$new_img</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">imagecolorallocate</span><span class="keyword">(</span><span class="default">$new_img</span><span class="keyword">, </span><span class="default">255</span><span class="keyword">, </span><span class="default">255</span><span class="keyword">, </span><span class="default">255</span><span class="keyword">));<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; </span><span class="default">imagecopyresampled</span><span class="keyword">(</span><span class="default">$new_img</span><span class="keyword">, </span><span class="default">$img</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">, </span><span class="default">$thumb_w</span><span class="keyword">, </span><span class="default">$thumb_h</span><span class="keyword">, </span><span class="default">$old_x</span><span class="keyword">, </span><span class="default">$old_y</span><span class="keyword">); <br />
&nbsp;&nbsp;&nbsp; if(</span><span class="default">$border</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$black </span><span class="keyword">= </span><span class="default">imagecolorallocate</span><span class="keyword">(</span><span class="default">$new_img</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">imagerectangle</span><span class="keyword">(</span><span class="default">$new_img</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">, </span><span class="default">$thumb_w</span><span class="keyword">, </span><span class="default">$thumb_h</span><span class="keyword">, </span><span class="default">$black</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; if(</span><span class="default">$base64</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">ob_start</span><span class="keyword">();<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">imagepng</span><span class="keyword">(</span><span class="default">$new_img</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$img </span><span class="keyword">= </span><span class="default">ob_get_contents</span><span class="keyword">();<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">ob_end_clean</span><span class="keyword">();<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$return </span><span class="keyword">= </span><span class="default">base64_encode</span><span class="keyword">(</span><span class="default">$img</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; } else {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if(</span><span class="default">$ext</span><span class="keyword">==</span><span class="string">"jpeg" </span><span class="keyword">|| </span><span class="default">$ext</span><span class="keyword">==</span><span class="string">"jpg"</span><span class="keyword">){<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">imagejpeg</span><span class="keyword">(</span><span class="default">$new_img</span><span class="keyword">, </span><span class="default">$newname</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$return </span><span class="keyword">= </span><span class="default">true</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; } elseif(</span><span class="default">$ext</span><span class="keyword">==</span><span class="string">"png"</span><span class="keyword">){<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">imagepng</span><span class="keyword">(</span><span class="default">$new_img</span><span class="keyword">, </span><span class="default">$newname</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$return </span><span class="keyword">= </span><span class="default">true</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; } elseif(</span><span class="default">$ext</span><span class="keyword">==</span><span class="string">"gif"</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">imagegif</span><span class="keyword">(</span><span class="default">$new_img</span><span class="keyword">, </span><span class="default">$newname</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$return </span><span class="keyword">= </span><span class="default">true</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">imagedestroy</span><span class="keyword">(</span><span class="default">$new_img</span><span class="keyword">); <br />
&nbsp;&nbsp;&nbsp; </span><span class="default">imagedestroy</span><span class="keyword">(</span><span class="default">$img</span><span class="keyword">); <br />
&nbsp;&nbsp;&nbsp; return </span><span class="default">$return</span><span class="keyword">;<br />
}<br />
</span><span class="comment">//example useage<br />
</span><span class="default">createthumb</span><span class="keyword">(</span><span class="string">"img.gif"</span><span class="keyword">, </span><span class="string">"tn_img.gif"</span><span class="keyword">, </span><span class="default">64</span><span class="keyword">,</span><span class="default">64</span><span class="keyword">,</span><span class="default">true</span><span class="keyword">, </span><span class="default">true</span><span class="keyword">, </span><span class="default">false</span><span class="keyword">);<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="79145""></a>
  <div class="note">
   <strong class="user">wesley dot gunn at email dot it</strong>
   <a href="#79145" class="date">13-Nov-2007 06:27</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
a simple way to check png with alpha channel reading IHDR PNG HEADER<br />
<br />
$readPng =&nbsp; &nbsp; fopen&nbsp; &nbsp; ($argSourceImagePath, "rb");<br />
$readAlp =&nbsp; &nbsp; fread&nbsp; &nbsp; ($readPng, 52);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; fclose&nbsp; &nbsp; ($readPng);<br />
<br />
if(substr(bin2hex($readAlp),50,2) == "04" || substr(bin2hex($readAlp),50,2) == "06")<br />
echo("Png has alpha");</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="78379""></a>
  <div class="note">
   <strong class="user">Rob</strong>
   <a href="#78379" class="date">09-Oct-2007 04:55</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
This block of code should preserve transparency when resizing an image using the GD library.<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="comment">/**<br />
&nbsp;* Try to preserve transparency info<br />
&nbsp;* $orig_type - Original Image Type<br />
&nbsp;* $orig_img&nbsp; - GD Image Resource for original image<br />
&nbsp;* $new_img&nbsp;&nbsp; - GD Image Resource for resized image<br />
&nbsp;*/<br />
<br />
// Transparency only available for GIFs &amp; PNGs<br />
</span><span class="keyword">if ( (</span><span class="default">$orig_type </span><span class="keyword">== </span><span class="default">IMAGETYPE_GIF</span><span class="keyword">) || (</span><span class="default">$orig_type </span><span class="keyword">== </span><span class="default">IMAGETYPE_PNG</span><span class="keyword">) ) {<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$trnprt_indx </span><span class="keyword">= </span><span class="default">imagecolortransparent</span><span class="keyword">(</span><span class="default">$orig_img</span><span class="keyword">);<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">// If we have a specific transparent color<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">if (</span><span class="default">$trnprt_indx </span><span class="keyword">&gt;= </span><span class="default">0</span><span class="keyword">) {<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// Get the original image's transparent color's RGB values<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$trnprt_color&nbsp; &nbsp; </span><span class="keyword">= </span><span class="default">imagecolorsforindex</span><span class="keyword">(</span><span class="default">$orig_img</span><span class="keyword">, </span><span class="default">$trnprt_indx</span><span class="keyword">);<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// Allocate the same color in the new image resource<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$trnprt_indx&nbsp; &nbsp; </span><span class="keyword">= </span><span class="default">imagecolorallocate</span><span class="keyword">(</span><span class="default">$new_img</span><span class="keyword">, </span><span class="default">$trnprt_color</span><span class="keyword">[</span><span class="string">'red'</span><span class="keyword">], </span><span class="default">$trnprt_color</span><span class="keyword">[</span><span class="string">'green'</span><span class="keyword">], </span><span class="default">$trnprt_color</span><span class="keyword">[</span><span class="string">'blue'</span><span class="keyword">]);<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// Completely fill the background of the new image with allocated color.<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">imagefill</span><span class="keyword">(</span><span class="default">$new_img</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">$trnprt_indx</span><span class="keyword">);<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// Set the background color for new image to transparent<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">imagecolortransparent</span><span class="keyword">(</span><span class="default">$new_img</span><span class="keyword">, </span><span class="default">$trnprt_indx</span><span class="keyword">);<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">// Always make a transparent background color for PNGs that don't have one allocated already<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">} elseif (</span><span class="default">$orig_type </span><span class="keyword">== </span><span class="default">IMAGETYPE_PNG</span><span class="keyword">) {<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// Turn off transparency blending (temporarily)<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">imagealphablending</span><span class="keyword">(</span><span class="default">$new_img</span><span class="keyword">, </span><span class="default">false</span><span class="keyword">);<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// Create a new transparent color for image<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$color </span><span class="keyword">= </span><span class="default">imagecolorallocatealpha</span><span class="keyword">(</span><span class="default">$new_img</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">127</span><span class="keyword">);<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// Completely fill the background of the new image with allocated color.<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">imagefill</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">new_img</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">$color</span><span class="keyword">);<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// Restore transparency blending<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">imagesavealpha</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">new_img</span><span class="keyword">, </span><span class="default">true</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; }<br />
}<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="77733""></a>
  <div class="note">
   <strong class="user">kevinoe at gmail</strong>
   <a href="#77733" class="date">11-Sep-2007 10:39</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
To resize a transparent image into a thumbnail while keeping its transparency. The quality of the thumbnail is pretty bad though.. but it is transparent.<br />
<br />
$image = ImageCreateFromGIF('transparentimage.gif');<br />
$img_width = ImagesX($image);<br />
$img_height = ImagesY($image);<br />
<br />
$new_width = '100';<br />
$new_height = ($new_width * $img_height) / $img_width;<br />
<br />
$resized = imagecreatetruecolor($new_width, $new_height);<br />
<br />
$colorTransparent = imagecolortransparent($image);<br />
imagepalettecopy($image, $resized);<br />
imagefill($resized, 0, 0, $colorTransparent);<br />
imagecolortransparent($resized, $colorTransparent);<br />
<br />
imagetruecolortopalette($resized, true, 256);<br />
<br />
imagecopyresized($resized, $image, 0, 0, 0, 0, $new_width, $new_height, $img_width, $img_height);</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="77099""></a>
  <div class="note">
   <strong class="user">Mikasto</strong>
   <a href="#77099" class="date">15-Aug-2007 01:53</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
To resize transparent PNG (if image is transparent &amp; ImageColorTransparent() returns -1):<br />
1) create a new image with the new sizes<br />
2) make the new image all transparent<br />
3) turn off the alpha blending for the new image (to keep the alpha channel when copy data)<br />
4) do copyresampled or copyresized into new image<br />
<br />
PHP code:<br />
// 1<br />
$im2 = ImageCreateTrueColor($w, $h);<br />
// 2<br />
ImageColorTransparent($im2, ImageColorAllocate($im2, 0, 0, 0));<br />
// 3<br />
ImageAlphaBlending($im2, false);<br />
// 4<br />
ImageCopyResampled($im2, $im, 0, 0, 0, 0, $w, $h, ImageSX($im), ImageSY($im));</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="76407""></a>
  <div class="note">
   <strong class="user">erik at vectorsector dot net</strong>
   <a href="#76407" class="date">13-Jul-2007 06:20</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
This script creates transparency for a unspecific RBG color for an already created PNG image.&nbsp; It also includes script of overlay text that does not get ruined in the process. <br />
<br />
<span class="default">&lt;?php<br />
<br />
header</span><span class="keyword">(</span><span class="string">"Content-type: image/png"</span><span class="keyword">);<br />
</span><span class="default">$image </span><span class="keyword">= </span><span class="default">imagecreatetruecolor</span><span class="keyword">(</span><span class="default">250</span><span class="keyword">, </span><span class="default">250</span><span class="keyword">);<br />
</span><span class="default">$string </span><span class="keyword">= </span><span class="default">$_GET</span><span class="keyword">[</span><span class="string">'text'</span><span class="keyword">];<br />
</span><span class="default">$im&nbsp; &nbsp;&nbsp; </span><span class="keyword">= </span><span class="default">imagecreatefrompng</span><span class="keyword">(</span><span class="string">"dynIcon.png"</span><span class="keyword">);<br />
</span><span class="default">$img </span><span class="keyword">= </span><span class="default">imagecreatetruecolor</span><span class="keyword">(</span><span class="default">16</span><span class="keyword">,</span><span class="default">16</span><span class="keyword">);<br />
</span><span class="default">$orange </span><span class="keyword">= </span><span class="default">imagecolorallocate</span><span class="keyword">(</span><span class="default">$im</span><span class="keyword">, </span><span class="default">220</span><span class="keyword">, </span><span class="default">210</span><span class="keyword">, </span><span class="default">60</span><span class="keyword">);<br />
</span><span class="default">$bg_color </span><span class="keyword">= </span><span class="default">imagecolorat</span><span class="keyword">(</span><span class="default">$im</span><span class="keyword">,</span><span class="default">1</span><span class="keyword">,</span><span class="default">1</span><span class="keyword">);<br />
</span><span class="default">$px&nbsp; &nbsp;&nbsp; </span><span class="keyword">= (</span><span class="default">imagesx</span><span class="keyword">(</span><span class="default">$im</span><span class="keyword">) - </span><span class="default">3 </span><span class="keyword">* </span><span class="default">strlen</span><span class="keyword">(</span><span class="default">$string</span><span class="keyword">)) / </span><span class="default">2</span><span class="keyword">;<br />
</span><span class="default">imagecolortransparent</span><span class="keyword">(</span><span class="default">$im</span><span class="keyword">, </span><span class="default">$bg_color</span><span class="keyword">);<br />
</span><span class="default">imagestring</span><span class="keyword">(</span><span class="default">$im</span><span class="keyword">, </span><span class="default">3</span><span class="keyword">, </span><span class="default">$px</span><span class="keyword">, </span><span class="default">5</span><span class="keyword">, </span><span class="default">$string</span><span class="keyword">, </span><span class="default">$orange</span><span class="keyword">);<br />
</span><span class="default">imagepng</span><span class="keyword">(</span><span class="default">$im</span><span class="keyword">);<br />
</span><span class="default">imagedestroy</span><span class="keyword">(</span><span class="default">$im</span><span class="keyword">);<br />
<br />
</span><span class="default">?&gt;</span> <br />
<br />
Use $bg_color = imagecolorat($im,1,1); for instance, if you made the transparent color in photoshop by clearing out all the color leaving you with the checkered background showing you it's empty.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="71763""></a>
  <div class="note">
   <strong class="user">cinymini</strong>
   <a href="#71763" class="date">14-Dec-2006 08:17</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
When you use palette images (created with imagecreate()), the first color allocated is the background color. This color cannot be used for transparency. So if you want to make the background transparent, first allocate a dummy background color, then allocate the real background color and declare this is as transparent.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="71237""></a>
  <div class="note">
   <strong class="user">glenn at bengeweb dot co dot nz</strong>
   <a href="#71237" class="date">18-Nov-2006 05:03</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
in reference to webmaster at webnetwizard dotco dotuk who had a rather complicated method of determining if a GIF had any transparency set ...<br />
<br />
imagecolortransparent will return -1 if no transparency is found.<br />
<br />
eg:<br />
<br />
$transColorIndexMain = imageColorTransparent($mainImgObj);<br />
if ($transColorIndexMain &gt;= 0 ) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; # GIF has transparency ... ;<br />
}<br />
<br />
Current PHP Version: 4.4.4<br />
[GD Version] =&gt; bundled (2.0.28 compatible)</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="67944""></a>
  <div class="note">
   <strong class="user">Blaine Ehrhart</strong>
   <a href="#67944" class="date">07-Jul-2006 11:59</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
This script creates transparency for a specific RBG color for an already created GIF image. <br />
<span class="default">&lt;?php<br />
&nbsp;&nbsp;&nbsp; $im </span><span class="keyword">= </span><span class="default">imagecreatefromgif</span><span class="keyword">(</span><span class="string">'trans.gif'</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$img </span><span class="keyword">= </span><span class="default">imagecreatetruecolor</span><span class="keyword">(</span><span class="default">16</span><span class="keyword">,</span><span class="default">16</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$trans </span><span class="keyword">= </span><span class="default">imagecolorallocate</span><span class="keyword">(</span><span class="default">$img</span><span class="keyword">,</span><span class="default">255</span><span class="keyword">,</span><span class="default">99</span><span class="keyword">,</span><span class="default">140</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">imagecolortransparent</span><span class="keyword">(</span><span class="default">$img</span><span class="keyword">,</span><span class="default">$trans</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">imagecopy</span><span class="keyword">(</span><span class="default">$img</span><span class="keyword">,</span><span class="default">$im</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">,</span><span class="default">16</span><span class="keyword">,</span><span class="default">16</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">imagetruecolortopalette</span><span class="keyword">(</span><span class="default">$img</span><span class="keyword">, </span><span class="default">true</span><span class="keyword">, </span><span class="default">256</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">imageinterlace</span><span class="keyword">(</span><span class="default">$img</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">imagegif</span><span class="keyword">(</span><span class="default">$img</span><span class="keyword">,</span><span class="string">'trans.gif'</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">imagedestroy</span><span class="keyword">(</span><span class="default">$img</span><span class="keyword">);<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="57950""></a>
  <div class="note">
   <strong class="user">Joachim Kruyswijk</strong>
   <a href="#57950" class="date">20-Oct-2005 01:20</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
A negative color number will turn antialiasing off, but even a positive number chosen for transparency may affect antialiasing. If the text (created with imagettftext) in your image looks horrible, try using a higher color number.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="57939""></a>
  <div class="note">
   <strong class="user">contact at wdschools dot com</strong>
   <a href="#57939" class="date">19-Oct-2005 06:02</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Transparent GIF w/ text from TTF Font<br />
------------------------------------- <br />
$image = imagecreatetruecolor(192, 36);<br />
$trans_color = imagecolorallocate($image, 255, 0, 0);<br />
$color = imagecolorallocate($image, 255, 255, 255);<br />
imagecolortransparent($image, $trans_color);<br />
imagettftext($image, 10, 0, 10, 23, $color, "impact.ttf", " MENU ITEM");<br />
imagegif($image, "output.gif");<br />
imagedestroy($image);</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="53703""></a>
  <div class="note">
   <strong class="user">ingrid</strong>
   <a href="#53703" class="date">09-Jun-2005 06:37</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
This script should take an animated GIF whit a white background transparancy, put some white=transparant text on it, and can be used in any page using the filename and the normal image tags.<br />
<br />
Everything works well, exept the animation. The GIF animation stands still. Don't know how to keep the animation&nbsp; animated. Is it possible in PHP?<br />
<br />
<span class="default">&lt;?php<br />
<br />
$TextFile </span><span class="keyword">= </span><span class="string">"teller.txt"</span><span class="keyword">;<br />
</span><span class="default">$Count </span><span class="keyword">= </span><span class="default">trim</span><span class="keyword">(</span><span class="default">file_get_contents</span><span class="keyword">(</span><span class="default">$TextFile</span><span class="keyword">));<br />
</span><span class="default">$FP </span><span class="keyword">= </span><span class="default">fopen</span><span class="keyword">(</span><span class="default">$TextFile</span><span class="keyword">, </span><span class="string">"r"</span><span class="keyword">);<br />
</span><span class="default">$Count</span><span class="keyword">=</span><span class="default">fgets</span><span class="keyword">(</span><span class="default">$FP</span><span class="keyword">, </span><span class="default">4096</span><span class="keyword">);<br />
</span><span class="default">fclose </span><span class="keyword">(</span><span class="default">$FP</span><span class="keyword">);<br />
</span><span class="default">settype</span><span class="keyword">(</span><span class="default">$Count</span><span class="keyword">, </span><span class="string">"integer"</span><span class="keyword">);<br />
</span><span class="default">$Count</span><span class="keyword">++;<br />
if (</span><span class="default">$FP </span><span class="keyword">= </span><span class="default">fopen </span><span class="keyword">(</span><span class="default">$TextFile</span><span class="keyword">, </span><span class="string">"w"</span><span class="keyword">)){<br />
</span><span class="default">fwrite </span><span class="keyword">(</span><span class="default">$FP</span><span class="keyword">, </span><span class="default">$Count</span><span class="keyword">);<br />
</span><span class="default">fclose </span><span class="keyword">(</span><span class="default">$FP</span><span class="keyword">);<br />
}<br />
<br />
</span><span class="default">$image </span><span class="keyword">= </span><span class="string">"blad.gif"</span><span class="keyword">;<br />
</span><span class="default">$im&nbsp; &nbsp; </span><span class="keyword">= </span><span class="default">imagecreatefromgif</span><span class="keyword">(</span><span class="default">$image</span><span class="keyword">);<br />
</span><span class="default">$white </span><span class="keyword">= </span><span class="default">imageColorAllocate </span><span class="keyword">(</span><span class="default">$im</span><span class="keyword">, </span><span class="default">255</span><span class="keyword">, </span><span class="default">255</span><span class="keyword">, </span><span class="default">255</span><span class="keyword">);<br />
</span><span class="default">$trans </span><span class="keyword">= </span><span class="default">imagecolortransparent</span><span class="keyword">(</span><span class="default">$im</span><span class="keyword">,</span><span class="default">$white</span><span class="keyword">);<br />
</span><span class="default">$hit </span><span class="keyword">= </span><span class="string">"</span><span class="default">$Count</span><span class="string">"</span><span class="keyword">;<br />
</span><span class="default">$ip </span><span class="keyword">= </span><span class="default">$_SERVER</span><span class="keyword">[</span><span class="string">"REMOTE_ADDR"</span><span class="keyword">];<br />
<br />
</span><span class="default">ImageString</span><span class="keyword">(</span><span class="default">$im</span><span class="keyword">, </span><span class="default">2</span><span class="keyword">, </span><span class="default">30</span><span class="keyword">, </span><span class="default">60</span><span class="keyword">,&nbsp; </span><span class="string">" je bent bezoeker "</span><span class="keyword">, </span><span class="default">$white</span><span class="keyword">);<br />
</span><span class="default">ImageString</span><span class="keyword">(</span><span class="default">$im</span><span class="keyword">, </span><span class="default">3</span><span class="keyword">, </span><span class="default">20</span><span class="keyword">, </span><span class="default">80</span><span class="keyword">, </span><span class="string">" </span><span class="default">$ip</span><span class="string">.</span><span class="default">$hit</span><span class="string">"</span><span class="keyword">, </span><span class="default">$trans</span><span class="keyword">);<br />
<br />
</span><span class="default">header</span><span class="keyword">(</span><span class="string">"Content-Type: image/gif"</span><span class="keyword">);<br />
</span><span class="default">Imagegif</span><span class="keyword">(</span><span class="default">$im</span><span class="keyword">,</span><span class="string">''</span><span class="keyword">,</span><span class="default">100</span><span class="keyword">);<br />
</span><span class="default">ImageDestroy </span><span class="keyword">(</span><span class="default">$im</span><span class="keyword">);<br />
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="52080""></a>
  <div class="note">
   <strong class="user">thomas at nindel dot net</strong>
   <a href="#52080" class="date">20-Apr-2005 07:02</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I wanted to have non-rectangular images being displayed on various website-backgrounds. piece of cake with png-24 and sane browsers, but not with IE. GIF-files are useless since they tend to have ugly edges.<br />
<br />
So that's what i came up with, a script to merge a given PNG-24 against a background-image. The script only merges areas of partial transparency (think anti-aliased edges) of the PNG onto the background-image, leaving 100% transparent areas as they are. output is a 256-color gif with transparency.<br />
<br />
<span class="default">&lt;?PHP<br />
&nbsp; </span><span class="keyword">function </span><span class="default">alphaishMerge</span><span class="keyword">(&amp;</span><span class="default">$img_unten</span><span class="keyword">, &amp;</span><span class="default">$img_oben</span><span class="keyword">, &amp;</span><span class="default">$transCol</span><span class="keyword">) {<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$sx </span><span class="keyword">= </span><span class="default">imagesx</span><span class="keyword">(</span><span class="default">$img_unten</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$sy </span><span class="keyword">= </span><span class="default">imagesy</span><span class="keyword">(</span><span class="default">$img_oben</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">// just be sure<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">imagealphablending</span><span class="keyword">(</span><span class="default">$img_unten</span><span class="keyword">, </span><span class="default">TRUE</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">imagealphablending</span><span class="keyword">(</span><span class="default">$img_oben</span><span class="keyword">, </span><span class="default">TRUE</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">// imagecopy respects alpha channels<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">imagecopy</span><span class="keyword">(</span><span class="default">$img_unten</span><span class="keyword">, </span><span class="default">$img_oben</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">$sx</span><span class="keyword">, </span><span class="default">$sy</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; for (</span><span class="default">$x </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">; </span><span class="default">$x </span><span class="keyword">&lt; </span><span class="default">$sx</span><span class="keyword">; </span><span class="default">$x</span><span class="keyword">++) {<br />
&nbsp;&nbsp; &nbsp;&nbsp; for (</span><span class="default">$y </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">; </span><span class="default">$y </span><span class="keyword">&lt; </span><span class="default">$sy</span><span class="keyword">; </span><span class="default">$y</span><span class="keyword">++) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// get RGBA of upper image<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$pxloben </span><span class="keyword">= </span><span class="default">imagecolorat</span><span class="keyword">(</span><span class="default">$img_oben</span><span class="keyword">, </span><span class="default">$x</span><span class="keyword">, </span><span class="default">$y</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$pxloben </span><span class="keyword">= </span><span class="default">imagecolorsforindex</span><span class="keyword">(</span><span class="default">$img_oben</span><span class="keyword">, </span><span class="default">$pxloben</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">$pxloben</span><span class="keyword">[</span><span class="string">'alpha'</span><span class="keyword">] == </span><span class="default">127</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// if this pixel is fully transparent...<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; // ...set it to the transparent color <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">imagesetpixel</span><span class="keyword">(</span><span class="default">$img_unten</span><span class="keyword">,</span><span class="default">$x</span><span class="keyword">,</span><span class="default">$y</span><span class="keyword">,</span><span class="default">$transCol</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp; }<br />
&nbsp; <br />
&nbsp; </span><span class="comment">// images have to be the same size<br />
&nbsp; </span><span class="default">$bg_file </span><span class="keyword">= </span><span class="string">"background.jpg"</span><span class="keyword">;<br />
&nbsp; </span><span class="default">$png_file </span><span class="keyword">=</span><span class="string">"kauscha.png"</span><span class="keyword">;<br />
<br />
&nbsp; </span><span class="comment">// background-image (jpg)<br />
&nbsp; </span><span class="default">$img_bg </span><span class="keyword">= </span><span class="default">imagecreatefromjpeg</span><span class="keyword">(</span><span class="default">$bg_file</span><span class="keyword">);<br />
&nbsp; <br />
&nbsp; </span><span class="comment">// image which is supposed to be put on the background (PNG-24)<br />
&nbsp; </span><span class="default">$img_png </span><span class="keyword">= </span><span class="default">imagecreatefrompng</span><span class="keyword">(</span><span class="default">$png_file</span><span class="keyword">);<br />
&nbsp; <br />
&nbsp; </span><span class="comment">// This color is the one getting transparent in the gif-file<br />
&nbsp; </span><span class="default">$transCol </span><span class="keyword">= </span><span class="default">imagecolorallocate</span><span class="keyword">(</span><span class="default">$img_bg</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">);<br />
<br />
&nbsp; </span><span class="comment">// magic<br />
&nbsp; </span><span class="default">alphaishMerge</span><span class="keyword">(</span><span class="default">$img_bg</span><span class="keyword">, </span><span class="default">$img_png</span><span class="keyword">, </span><span class="default">$transCol</span><span class="keyword">);<br />
&nbsp; <br />
&nbsp; </span><span class="comment">// reduce color depth<br />
&nbsp; </span><span class="default">imagetruecolortopalette</span><span class="keyword">(</span><span class="default">$img_bg</span><span class="keyword">, </span><span class="default">FALSE</span><span class="keyword">, </span><span class="default">255</span><span class="keyword">);<br />
&nbsp; <br />
&nbsp; </span><span class="comment">// make it transparent<br />
&nbsp; </span><span class="default">$transCol </span><span class="keyword">= </span><span class="default">imagecolortransparent</span><span class="keyword">(</span><span class="default">$img_bg</span><span class="keyword">, </span><span class="default">$transCol</span><span class="keyword">);<br />
&nbsp; <br />
&nbsp; </span><span class="default">header</span><span class="keyword">(</span><span class="string">"Content-type: image/gif"</span><span class="keyword">);<br />
&nbsp; </span><span class="default">imagegif</span><span class="keyword">(</span><span class="default">$img_bg</span><span class="keyword">);<br />
</span><span class="default">?&gt;<br />
</span><br />
i hope thats useful for anyone.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="51471""></a>
  <div class="note">
   <strong class="user">partyheld at HATESPAMgmail dot com</strong>
   <a href="#51471" class="date">31-Mar-2005 06:35</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Fred wrote:<br />
<span class="default">&lt;?php<br />
$file</span><span class="keyword">[</span><span class="string">'signatur'</span><span class="keyword">]=&nbsp; &nbsp; &nbsp; </span><span class="default">substr</span><span class="keyword">(</span><span class="default">$result</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">,</span><span class="default">3</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$file</span><span class="keyword">[</span><span class="string">'version'</span><span class="keyword">]=&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">substr</span><span class="keyword">(</span><span class="default">$result</span><span class="keyword">,</span><span class="default">3</span><span class="keyword">,</span><span class="default">3</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$file</span><span class="keyword">[</span><span class="string">'width'</span><span class="keyword">]=&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">ord</span><span class="keyword">(</span><span class="default">substr</span><span class="keyword">(</span><span class="default">$result</span><span class="keyword">,</span><span class="default">6</span><span class="keyword">,</span><span class="default">1</span><span class="keyword">))+</span><span class="default">ord</span><span class="keyword">(</span><span class="default">substr</span><span class="keyword">(</span><span class="default">$result</span><span class="keyword">,</span><span class="default">7</span><span class="keyword">,</span><span class="default">1</span><span class="keyword">))*</span><span class="default">256</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$file</span><span class="keyword">[</span><span class="string">'height'</span><span class="keyword">]=&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">ord</span><span class="keyword">(</span><span class="default">substr</span><span class="keyword">(</span><span class="default">$result</span><span class="keyword">,</span><span class="default">8</span><span class="keyword">,</span><span class="default">1</span><span class="keyword">))+</span><span class="default">ord</span><span class="keyword">(</span><span class="default">substr</span><span class="keyword">(</span><span class="default">$rsult</span><span class="keyword">,</span><span class="default">9</span><span class="keyword">,</span><span class="default">1</span><span class="keyword">))*</span><span class="default">256</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$file</span><span class="keyword">[</span><span class="string">'flag'</span><span class="keyword">]=&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">ord</span><span class="keyword">(</span><span class="default">substr</span><span class="keyword">(</span><span class="default">$result</span><span class="keyword">,</span><span class="default">10</span><span class="keyword">,</span><span class="default">1</span><span class="keyword">))&gt;&gt;</span><span class="default">7</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$file</span><span class="keyword">[</span><span class="string">'trans_red'</span><span class="keyword">]=&nbsp; &nbsp; &nbsp; </span><span class="default">ord</span><span class="keyword">(</span><span class="default">substr</span><span class="keyword">(</span><span class="default">$result</span><span class="keyword">,</span><span class="default">ord</span><span class="keyword">(</span><span class="default">substr</span><span class="keyword">(</span><span class="default">$result</span><span class="keyword">,</span><span class="default">11</span><span class="keyword">))*</span><span class="default">3</span><span class="keyword">,</span><span class="default">1</span><span class="keyword">));<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$file</span><span class="keyword">[</span><span class="string">'trans_green'</span><span class="keyword">]=&nbsp; &nbsp; </span><span class="default">ord</span><span class="keyword">(</span><span class="default">substr</span><span class="keyword">(</span><span class="default">$result</span><span class="keyword">,</span><span class="default">ord</span><span class="keyword">(</span><span class="default">substr</span><span class="keyword">(</span><span class="default">$result</span><span class="keyword">,</span><span class="default">11</span><span class="keyword">))*</span><span class="default">3</span><span class="keyword">+</span><span class="default">1</span><span class="keyword">,</span><span class="default">1</span><span class="keyword">));<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$file</span><span class="keyword">[</span><span class="string">'trans_blue'</span><span class="keyword">]=&nbsp; &nbsp; </span><span class="default">ord</span><span class="keyword">(</span><span class="default">substr</span><span class="keyword">(</span><span class="default">$result</span><span class="keyword">,</span><span class="default">ord</span><span class="keyword">(</span><span class="default">substr</span><span class="keyword">(</span><span class="default">$result</span><span class="keyword">,</span><span class="default">11</span><span class="keyword">))*</span><span class="default">3</span><span class="keyword">+</span><span class="default">2</span><span class="keyword">,</span><span class="default">1</span><span class="keyword">)) ;<br />
</span><span class="default">?&gt;<br />
</span><br />
You should write such code like this:<br />
<br />
<span class="default">&lt;?php<br />
&nbsp;&nbsp; $file </span><span class="keyword">= array(<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="string">"signatur"&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">=&gt; </span><span class="default">substr </span><span class="keyword">(</span><span class="default">$result</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">3</span><span class="keyword">),<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="string">"version"&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="keyword">=&gt; </span><span class="default">substr </span><span class="keyword">(</span><span class="default">$result</span><span class="keyword">, </span><span class="default">3</span><span class="keyword">, </span><span class="default">3</span><span class="keyword">),<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="string">"width"&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="keyword">=&gt; </span><span class="default">ord </span><span class="keyword">(</span><span class="default">substr </span><span class="keyword">(</span><span class="default">$result</span><span class="keyword">, </span><span class="default">6</span><span class="keyword">, </span><span class="default">1</span><span class="keyword">)) + </span><span class="default">ord </span><span class="keyword">(</span><span class="default">substr </span><span class="keyword">(</span><span class="default">$result</span><span class="keyword">, </span><span class="default">7</span><span class="keyword">, </span><span class="default">1</span><span class="keyword">)) * </span><span class="default">256</span><span class="keyword">,<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="string">"height"&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">=&gt; </span><span class="default">ord </span><span class="keyword">(</span><span class="default">substr </span><span class="keyword">(</span><span class="default">$result</span><span class="keyword">, </span><span class="default">8</span><span class="keyword">, </span><span class="default">1</span><span class="keyword">)) + </span><span class="default">ord</span><span class="keyword">(</span><span class="default">substr </span><span class="keyword">(</span><span class="default">$result</span><span class="keyword">, </span><span class="default">9</span><span class="keyword">, </span><span class="default">1</span><span class="keyword">)) * </span><span class="default">256</span><span class="keyword">,<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="string">"flag"&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">=&gt; </span><span class="default">ord </span><span class="keyword">(</span><span class="default">substr </span><span class="keyword">(</span><span class="default">$result</span><span class="keyword">, </span><span class="default">10</span><span class="keyword">, </span><span class="default">1</span><span class="keyword">)) &gt;&gt; </span><span class="default">7</span><span class="keyword">,<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="string">"trans_red"&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="keyword">=&gt; </span><span class="default">ord </span><span class="keyword">(</span><span class="default">substr </span><span class="keyword">(</span><span class="default">$result</span><span class="keyword">, </span><span class="default">ord </span><span class="keyword">(</span><span class="default">substr </span><span class="keyword">(</span><span class="default">$result</span><span class="keyword">, </span><span class="default">11</span><span class="keyword">)) * </span><span class="default">3</span><span class="keyword">,</span><span class="default">1</span><span class="keyword">)),<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="string">"trans_green"&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="keyword">=&gt; </span><span class="default">ord </span><span class="keyword">(</span><span class="default">substr </span><span class="keyword">(</span><span class="default">$result</span><span class="keyword">, </span><span class="default">ord </span><span class="keyword">(</span><span class="default">substr</span><span class="keyword">(</span><span class="default">$result</span><span class="keyword">, </span><span class="default">11</span><span class="keyword">)) * </span><span class="default">3 </span><span class="keyword">+ </span><span class="default">1</span><span class="keyword">, </span><span class="default">1</span><span class="keyword">)),<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="string">"trans_blue"&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">=&gt; </span><span class="default">ord </span><span class="keyword">(</span><span class="default">substr </span><span class="keyword">(</span><span class="default">$result</span><span class="keyword">, </span><span class="default">ord </span><span class="keyword">(</span><span class="default">substr</span><span class="keyword">(</span><span class="default">$result</span><span class="keyword">, </span><span class="default">11</span><span class="keyword">)) * </span><span class="default">3 </span><span class="keyword">+ </span><span class="default">2</span><span class="keyword">, </span><span class="default">1</span><span class="keyword">))<br />
&nbsp;&nbsp; &nbsp;&nbsp; );<br />
</span><span class="default">?&gt;<br />
</span><br />
And there's a typo in line 4, sayin "rsult" instead of "result". I've got no time for checking your code any further, sorry.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="51349""></a>
  <div class="note">
   <strong class="user">raiserle</strong>
   <a href="#51349" class="date">28-Mar-2005 05:52</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
it goes also more simply<br />
i rather work with arrays<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">if(!</span><span class="default">function_exists</span><span class="keyword">(</span><span class="string">'gif_info'</span><span class="keyword">))<br />
{<br />
&nbsp;&nbsp;&nbsp; function </span><span class="default">gif_info</span><span class="keyword">(</span><span class="default">$filename</span><span class="keyword">)<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$fp</span><span class="keyword">=&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">fopen</span><span class="keyword">(</span><span class="default">$filename</span><span class="keyword">,</span><span class="string">'rb'</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$result</span><span class="keyword">=&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">fread</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">,</span><span class="default">13</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$file</span><span class="keyword">[</span><span class="string">'signatur'</span><span class="keyword">]=&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">substr</span><span class="keyword">(</span><span class="default">$result</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">,</span><span class="default">3</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$file</span><span class="keyword">[</span><span class="string">'version'</span><span class="keyword">]=&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">substr</span><span class="keyword">(</span><span class="default">$result</span><span class="keyword">,</span><span class="default">3</span><span class="keyword">,</span><span class="default">3</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$file</span><span class="keyword">[</span><span class="string">'width'</span><span class="keyword">]=&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">ord</span><span class="keyword">(</span><span class="default">substr</span><span class="keyword">(</span><span class="default">$result</span><span class="keyword">,</span><span class="default">6</span><span class="keyword">,</span><span class="default">1</span><span class="keyword">))+</span><span class="default">ord</span><span class="keyword">(</span><span class="default">substr</span><span class="keyword">(</span><span class="default">$result</span><span class="keyword">,</span><span class="default">7</span><span class="keyword">,</span><span class="default">1</span><span class="keyword">))*</span><span class="default">256</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$file</span><span class="keyword">[</span><span class="string">'height'</span><span class="keyword">]=&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">ord</span><span class="keyword">(</span><span class="default">substr</span><span class="keyword">(</span><span class="default">$result</span><span class="keyword">,</span><span class="default">8</span><span class="keyword">,</span><span class="default">1</span><span class="keyword">))+</span><span class="default">ord</span><span class="keyword">(</span><span class="default">substr</span><span class="keyword">(</span><span class="default">$rsult</span><span class="keyword">,</span><span class="default">9</span><span class="keyword">,</span><span class="default">1</span><span class="keyword">))*</span><span class="default">256</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$file</span><span class="keyword">[</span><span class="string">'flag'</span><span class="keyword">]=&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">ord</span><span class="keyword">(</span><span class="default">substr</span><span class="keyword">(</span><span class="default">$result</span><span class="keyword">,</span><span class="default">10</span><span class="keyword">,</span><span class="default">1</span><span class="keyword">))&gt;&gt;</span><span class="default">7</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$file</span><span class="keyword">[</span><span class="string">'trans_red'</span><span class="keyword">]=&nbsp; &nbsp; &nbsp; </span><span class="default">ord</span><span class="keyword">(</span><span class="default">substr</span><span class="keyword">(</span><span class="default">$result</span><span class="keyword">,</span><span class="default">ord</span><span class="keyword">(</span><span class="default">substr</span><span class="keyword">(</span><span class="default">$result</span><span class="keyword">,</span><span class="default">11</span><span class="keyword">))*</span><span class="default">3</span><span class="keyword">,</span><span class="default">1</span><span class="keyword">));<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$file</span><span class="keyword">[</span><span class="string">'trans_green'</span><span class="keyword">]=&nbsp; &nbsp; </span><span class="default">ord</span><span class="keyword">(</span><span class="default">substr</span><span class="keyword">(</span><span class="default">$result</span><span class="keyword">,</span><span class="default">ord</span><span class="keyword">(</span><span class="default">substr</span><span class="keyword">(</span><span class="default">$result</span><span class="keyword">,</span><span class="default">11</span><span class="keyword">))*</span><span class="default">3</span><span class="keyword">+</span><span class="default">1</span><span class="keyword">,</span><span class="default">1</span><span class="keyword">));<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$file</span><span class="keyword">[</span><span class="string">'trans_blue'</span><span class="keyword">]=&nbsp; &nbsp;&nbsp; </span><span class="default">ord</span><span class="keyword">(</span><span class="default">substr</span><span class="keyword">(</span><span class="default">$result</span><span class="keyword">,</span><span class="default">ord</span><span class="keyword">(</span><span class="default">substr</span><span class="keyword">(</span><span class="default">$result</span><span class="keyword">,</span><span class="default">11</span><span class="keyword">))*</span><span class="default">3</span><span class="keyword">+</span><span class="default">2</span><span class="keyword">,</span><span class="default">1</span><span class="keyword">)) ;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">fclose</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; return </span><span class="default">$file</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }<br />
}<br />
</span><span class="default">print_r</span><span class="keyword">(</span><span class="default">gif_info</span><span class="keyword">(</span><span class="default">$_FILES</span><span class="keyword">[</span><span class="string">'files'</span><span class="keyword">][</span><span class="string">'temp_name'</span><span class="keyword">]));<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="51023""></a>
  <div class="note">
   <strong class="user">talkback at codesponge dot com</strong>
   <a href="#51023" class="date">17-Mar-2005 12:41</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Only one color may be transparent in one image.&nbsp; The last call to imagecolortransparent will be the color that is set to transparent.<br />
<br />
I am processing button images that have a slightly different fill color than the background color outside the border of the button. I was hoping that I could just make both of those colors transparent and solve the problem.<br />
<br />
Hope this tidbit of info will save you some time.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="49024""></a>
  <div class="note">
   <strong class="user">fred at webblake dot net</strong>
   <a href="#49024" class="date">14-Jan-2005 05:17</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Wow! I am actually surprized there are no functions to retrieve transparency information from the image. I assume I'm not missing anything since there are all kinds of notes about how to get around this limitation. At any rate, here is some code to read the gif file and retrieve the missing information. The code will speak volumes.<br />
<br />
<span class="default">&lt;?php<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">class </span><span class="default">GifInfo<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">{<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; var </span><span class="default">$m_transparentRed</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; var </span><span class="default">$m_transparentGreen</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; var </span><span class="default">$m_transparentBlue</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; var </span><span class="default">$m_signature</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; var </span><span class="default">$m_version</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; var </span><span class="default">$m_width</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; var </span><span class="default">$m_height</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; var </span><span class="default">$m_width</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; var </span><span class="default">$m_height</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; var </span><span class="default">$m_colorFlag</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; var </span><span class="default">$m_backgroundIndex</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; function </span><span class="default">GifInfo</span><span class="keyword">(</span><span class="default">$filename</span><span class="keyword">)<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; {<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$fp&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">= </span><span class="default">fopen</span><span class="keyword">(</span><span class="default">$filename</span><span class="keyword">,</span><span class="string">"rb"</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$result&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">= </span><span class="default">fread</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">,</span><span class="default">13</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">m_signature&nbsp; &nbsp;&nbsp; </span><span class="keyword">= </span><span class="default">substr</span><span class="keyword">(</span><span class="default">$result</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">,</span><span class="default">3</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">m_version&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">= </span><span class="default">substr</span><span class="keyword">(</span><span class="default">$result</span><span class="keyword">,</span><span class="default">3</span><span class="keyword">,</span><span class="default">3</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">m_width&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">= </span><span class="default">ord</span><span class="keyword">(</span><span class="default">substr</span><span class="keyword">(</span><span class="default">$result</span><span class="keyword">,</span><span class="default">6</span><span class="keyword">,</span><span class="default">1</span><span class="keyword">)) + </span><span class="default">ord</span><span class="keyword">(</span><span class="default">substr</span><span class="keyword">(</span><span class="default">$result</span><span class="keyword">,</span><span class="default">7</span><span class="keyword">,</span><span class="default">1</span><span class="keyword">)) * </span><span class="default">256</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">m_height&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">= </span><span class="default">ord</span><span class="keyword">(</span><span class="default">substr</span><span class="keyword">(</span><span class="default">$result</span><span class="keyword">,</span><span class="default">8</span><span class="keyword">,</span><span class="default">1</span><span class="keyword">)) + </span><span class="default">ord</span><span class="keyword">(</span><span class="default">substr</span><span class="keyword">(</span><span class="default">$result</span><span class="keyword">,</span><span class="default">9</span><span class="keyword">,</span><span class="default">1</span><span class="keyword">)) * </span><span class="default">256</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">m_colorFlag&nbsp; &nbsp; </span><span class="keyword">= </span><span class="default">ord</span><span class="keyword">(</span><span class="default">substr</span><span class="keyword">(</span><span class="default">$result</span><span class="keyword">,</span><span class="default">10</span><span class="keyword">,</span><span class="default">1</span><span class="keyword">)) &gt;&gt; </span><span class="default">7</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">m_background&nbsp; &nbsp;&nbsp; </span><span class="keyword">= </span><span class="default">ord</span><span class="keyword">(</span><span class="default">substr</span><span class="keyword">(</span><span class="default">$result</span><span class="keyword">,</span><span class="default">11</span><span class="keyword">));<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">m_colorFlag</span><span class="keyword">)<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$tableSizeNeeded </span><span class="keyword">= (</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">m_background </span><span class="keyword">+ </span><span class="default">1</span><span class="keyword">) * </span><span class="default">3</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$result </span><span class="keyword">= </span><span class="default">fread</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">,</span><span class="default">$tableSizeNeeded</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">m_transparentRed&nbsp; &nbsp;&nbsp; </span><span class="keyword">= </span><span class="default">ord</span><span class="keyword">(</span><span class="default">substr</span><span class="keyword">(</span><span class="default">$result</span><span class="keyword">,</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">m_background </span><span class="keyword">* </span><span class="default">3</span><span class="keyword">,</span><span class="default">1</span><span class="keyword">));<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">m_transparentGreen&nbsp; &nbsp;&nbsp; </span><span class="keyword">= </span><span class="default">ord</span><span class="keyword">(</span><span class="default">substr</span><span class="keyword">(</span><span class="default">$result</span><span class="keyword">,</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">m_background </span><span class="keyword">* </span><span class="default">3 </span><span class="keyword">+ </span><span class="default">1</span><span class="keyword">,</span><span class="default">1</span><span class="keyword">));&nbsp; &nbsp; &nbsp; &nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">m_transparentBlue&nbsp; &nbsp;&nbsp; </span><span class="keyword">= </span><span class="default">ord</span><span class="keyword">(</span><span class="default">substr</span><span class="keyword">(</span><span class="default">$result</span><span class="keyword">,</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">m_background </span><span class="keyword">* </span><span class="default">3 </span><span class="keyword">+ </span><span class="default">2</span><span class="keyword">,</span><span class="default">1</span><span class="keyword">));&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">fclose</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; }<br />
</span><span class="default">?&gt;<br />
</span><br />
And to use this class....<br />
<br />
<span class="default">&lt;?php<br />
&nbsp;&nbsp; $size </span><span class="keyword">= </span><span class="default">getimagesize</span><span class="keyword">(</span><span class="default">$userfile</span><span class="keyword">);<br />
<br />
&nbsp;&nbsp; </span><span class="default">$img2 </span><span class="keyword">= </span><span class="default">ImageCreate</span><span class="keyword">(</span><span class="default">$w</span><span class="keyword">,</span><span class="default">$h</span><span class="keyword">);&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br />
&nbsp;&nbsp; </span><span class="default">$gi </span><span class="keyword">= new </span><span class="default">GifInfo</span><span class="keyword">(</span><span class="default">$userfile</span><span class="keyword">);<br />
<br />
&nbsp;&nbsp; if(</span><span class="default">$gi</span><span class="keyword">-&gt;</span><span class="default">m_version </span><span class="keyword">== </span><span class="string">'89a' </span><span class="keyword">&amp;&amp; </span><span class="default">$gi</span><span class="keyword">-&gt;</span><span class="default">m_colorFlag </span><span class="keyword">== </span><span class="default">1</span><span class="keyword">)<br />
&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="default">$transparent </span><span class="keyword">= </span><span class="default">imagecolorallocate</span><span class="keyword">(</span><span class="default">$img2</span><span class="keyword">, <br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="default">$gi</span><span class="keyword">-&gt;</span><span class="default">m_transparentRed</span><span class="keyword">,<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="default">$gi</span><span class="keyword">-&gt;</span><span class="default">m_transparentGreen</span><span class="keyword">,<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="default">$gi</span><span class="keyword">-&gt;</span><span class="default">m_transparentBlue</span><span class="keyword">);&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br />
<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="default">imagecolortransparent </span><span class="keyword">(</span><span class="default">$img2</span><span class="keyword">,</span><span class="default">$transparent</span><span class="keyword">);<br />
&nbsp;&nbsp; }<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="48912""></a>
  <div class="note">
   <strong class="user">webmaster at webnetwizard dotco dotuk</strong>
   <a href="#48912" class="date">11-Jan-2005 10:24</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I'm feeling particularly altruistic today, so here is the code to accompany the text I submitted about a script that 'intelligently' detects if an uploaded GIF has transparency or not, and creates a thumbnail accordingly:<br />
<br />
&nbsp;&nbsp;&nbsp; if (move_uploaded_file($_FILES['userfile']['tmp_name'], $uploadfile))<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp;&nbsp; $note = "Image was successfully uploaded.\n";<br />
&nbsp;&nbsp; &nbsp;&nbsp; // Now create thumbnail version of the uploaded image and save it to<br />
&nbsp;&nbsp; &nbsp;&nbsp; // folder "$fixPath/images/thumbs". First, we need to create a<br />
&nbsp;&nbsp; &nbsp;&nbsp; // resource "handle" for a copy of the uploaded image<br />
&nbsp;&nbsp; &nbsp;&nbsp; $img_error = false;<br />
&nbsp;&nbsp; &nbsp;&nbsp; list($width, $height, $type) = getimagesize($uploadfile);<br />
&nbsp;&nbsp; &nbsp;&nbsp; switch($type) // Allowed types: image/gif,image/jpeg,image/x-png<br />
&nbsp;&nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; case 1: // GIF<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $src = @imagecreatefromgif($uploadfile);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if (!$src)<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $img_error = true;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; break;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; case 2: // JPEG<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; .<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; .<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; .<br />
&nbsp;&nbsp; &nbsp;&nbsp; case 3: // PNG<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; .<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; .<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; . <br />
&nbsp;&nbsp; &nbsp; &nbsp; default:<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $img_error = true;<br />
&nbsp;&nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp;&nbsp; // resource handle for source image now in $src<br />
&nbsp;&nbsp; &nbsp;&nbsp; // Now calculate scaling factor and put in $sf<br />
&nbsp;&nbsp; &nbsp;&nbsp; if(!$img_error)<br />
&nbsp;&nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if($width &gt;= $height &amp;&amp; $width &gt; 100)<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $sf = $width / 100;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; elseif($height &gt; 100)<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $sf = $height / 100;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; else<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $sf = 1;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $newwidth = intval($width / $sf);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $newheight = intval($height / $sf);<br />
&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; switch($type) // Allowed types: image/gif,image/jpeg,image/x-png<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; case 1: // GIF<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $tpcolor = imagecolorat($src, 0, 0);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; // in the real world, you'd better test all four corners, not just one!<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $dest = imagecreate($newwidth, $newheight);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; // $dest automatically has a black fill...<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; imagepalettecopy($dest, $src);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; imagecopyresized($dest, $src, 0, 0, 0, 0, $newwidth, $newheight,<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $width, $height);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $pixel_over_black = imagecolorat($dest, 0, 0);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; // ...but now make the fill white...<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $bg = imagecolorallocate($dest, 255, 255, 255);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; imagefilledrectangle($dest, 0, 0, $newwidth, $newheight,<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $bg);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; imagecopyresized($dest, $src, 0, 0, 0, 0, $newwidth, $newheight,<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $width, $height);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $pixel_over_white = imagecolorat($dest, 0, 0);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; // ...to test if transparency causes the fill color to show through:<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if($pixel_over_black != $pixel_over_white)<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; // Background IS transparent<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; imagefilledrectangle($dest, 0, 0, $newwidth, $newheight,<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $tpcolor);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; imagecopyresized($dest, $src, 0, 0, 0, 0, $newwidth,<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $newheight, $width, $height);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; imagecolortransparent($dest, $tpcolor);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; imagegif($dest, "$fixPath/images/thumbs/$userfile");<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; else // Background (most probably) NOT transparent<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; imagegif($dest, "$fixPath/images/thumbs/$userfile");<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; break;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; case 2: // JPEG<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; .<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; .<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; .<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; case 3: // PNG<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; .<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; .<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; .<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; break;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; imagedestroy($src);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; imagedestroy($dest);<br />
&nbsp;&nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp;&nbsp; else<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $note = "Error: Uploaded image but could not create thumbnail";<br />
&nbsp;&nbsp; &nbsp;&nbsp; header("location: $fixPath/index.php?next=$next&amp;nb=$nb&amp;userfile=$userfile");<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; else<br />
&nbsp;&nbsp; &nbsp;&nbsp; $note = "Could not find anything to upload\n";</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="48900""></a>
  <div class="note">
   <strong class="user">webmaster at webnetwizard dotco dotuk</strong>
   <a href="#48900" class="date">11-Jan-2005 03:09</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
After much devious mindbending, I have found a way to test any GIF for presence of background transparency. This ability is essential for my application which uploads any of GIF, JPEG or PNG and simultaneously creates a thumbnail of identical image type and identical filename (full size and thumbnail versions being stored in different folders).<br />
After uploading and moving the image in the usual way, a switch($image_type) statement ensures that the optimum code is used to generate the thumbnail; regardless of image type.<br />
The problem with the GIF type is that those with transparent backgrounds need to be treated differently to those without. When I don't detect GIF transparency, I either end up with all transparent GIF's having black backgrounds, or all GIF's get converted to transparent background - even if they weren't transparent in the original.<br />
But how to detect transparency in the original? It finally occurred to me that I could test for transparency programmatically by overlaying a copy of the original image over an all-black image, record the color value at particular pixel locations and then repeat the process by overlaying a copy of the original image over an all-white image, recording the color values at identical pixel locations and comparing these with the first set of values.<br />
If the two sets of values correlate exactly, and if sensible sampling points are used, the image can be treated as non-transparent. If the two sets of values show differences, the image should be treated as having a transparent background.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="46142""></a>
  <div class="note">
   <strong class="user">emilus at galeria-m dot art dot pl</strong>
   <a href="#46142" class="date">30-Sep-2004 11:02</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
To resize or copy image (gif [with gd&gt;=2.0.28] or png) with transparency.<br />
-Take current transparency color<br />
-create a new image with palette like old one and fill new image with transparent color<br />
-set transparent color<br />
-copy resized image<br />
<br />
$colorTransparent = imagecolortransparent($im);<br />
$im2 = imagecreate($new_w,$new_h);<br />
imagepalettecopy($im2,$im);<br />
imagefill($im2,0,0,$colorTransparent);<br />
imagecolortransparent($im2, $colorTransparent);<br />
imagecopyresized($im2,$im,0,0,0,0,$new_w,$new_h,$imsx,$imsy);</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="46030""></a>
  <div class="note">
   <strong class="user">php_comment et 5mm de</strong>
   <a href="#46030" class="date">27-Sep-2004 07:02</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
In fact this function can be used for two purposes:<br />
<br />
A.) to work with transparency while dealing with images in php (see watermark example)<br />
<br />
B.) to create a partially transparent picture<br />
<br />
For A.) one can work with truecolor images with some regulations, but B.) can only be used with palette-based images (= indexed = created with imagecreate not imagecreatetruecolor) and formats that support transparency (png, gif).<br />
<br />
For instance if you want to cut out a color out of a give picture that is in truecolor, use the following method to first convert it to palette-based image, assign the transparency and give it to the browser as png:<br />
<br />
&lt;?<br />
$img = imagecreatefromjpeg('test.jpg');<br />
imagetruecolortopalette($img, false, 256); // convert<br />
<br />
$white = imagecolorresolve($img, 255, 255, 255); // resolve given palette entry<br />
imagecolortransparent($img, $white);<br />
<br />
header("Content-type: image/png");<br />
imagepng($img);<br />
?&gt;</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="40474""></a>
  <div class="note">
   <strong class="user">shelley_hina at yahoo dot com</strong>
   <a href="#40474" class="date">04-Mar-2004 08:35</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
It took me a while to figure this out. I added visual web thumbnail preview graphic from <a href="http://www.thumbshots.org and http://www.thumbshots.com to my customer sites to visualize web pages. Then I needed to create a small blank transparent PNG image if the thumbshot is not available. You can do this easily using imagecolortransparent function. It came out really nice and fast. It" rel="nofollow" target="_blank">http://www.thumbshots.org and http://www.thumbshots.com to my customer sites to visualize web pages. Then I needed to create a small blank transparent PNG image if the thumbshot is not available. You can do this easily using imagecolortransparent function. It came out really nice and fast. It</a>'s very cool stuff and highly recommended library for all your web site needs!<br />
<br />
// Use GD library to create transparent color PNG image of the pixel size<br />
$ImgGD = imagecreate(120, 90);<br />
$ImgWhite = imagecolorallocate($ImgGD, 255, 255, 255);<br />
imagefill($ImgGD, 0, 0, $ImgWhite);<br />
imagecolortransparent($ImgGD, $ImgWhite);<br />
<br />
// Capture STDOUT to buffer<br />
ob_start();<br />
imagepng($ImgGD);<br />
$Image = ob_get_contents();<br />
ob_end_clean();<br />
<br />
// Remember to free your memory<br />
imagedestroy($ImgGD);<br />
<br />
// Print image to web browser.<br />
print $Image</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="37420""></a>
  <div class="note">
   <strong class="user">php at kybert dot com</strong>
   <a href="#37420" class="date">14-Nov-2003 02:30</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
i had problems with the example by sandhawk at spies dot com because my png overlay, and the jpeg canvas were using different color depths, so, this function corrects this:<br />
<br />
[code]<br />
function WatermarkImage($CanvasImage, $WatermarkImage /* MUST BE PHG */, $Opacity=10, $Quality=75)<br />
{<br />
&nbsp;&nbsp;&nbsp; // create true color canvas image:<br />
&nbsp;&nbsp;&nbsp; $canvas_src = imagecreatefromjpeg($CanvasImage);<br />
&nbsp;&nbsp;&nbsp; $canvas_w = ImageSX($canvas_src);<br />
&nbsp;&nbsp;&nbsp; $canvas_h = ImageSY($canvas_src);<br />
&nbsp;&nbsp;&nbsp; $canvas_img = imagecreatetruecolor($canvas_w, $canvas_h);<br />
&nbsp;&nbsp;&nbsp; imagecopy($canvas_img, $canvas_src, 0,0,0,0, $canvas_w, $canvas_h);<br />
&nbsp;&nbsp;&nbsp; imagedestroy($canvas_src);&nbsp; &nbsp; // no longer needed<br />
<br />
&nbsp;&nbsp;&nbsp; // create true color overlay image:<br />
&nbsp;&nbsp;&nbsp; $overlay_src = imagecreatefrompng($WatermarkImage);<br />
&nbsp;&nbsp;&nbsp; $overlay_w = ImageSX($overlay_src);<br />
&nbsp;&nbsp;&nbsp; $overlay_h = ImageSY($overlay_src);<br />
&nbsp;&nbsp;&nbsp; $overlay_img = imagecreatetruecolor($overlay_w, $overlay_h);<br />
&nbsp;&nbsp;&nbsp; imagecopy($overlay_img, $overlay_src, 0,0,0,0, $overlay_w, $overlay_h);<br />
&nbsp;&nbsp;&nbsp; imagedestroy($overlay_src);&nbsp; &nbsp; // no longer needed<br />
<br />
&nbsp;&nbsp;&nbsp; // setup transparent color (pick one):<br />
&nbsp;&nbsp;&nbsp; $black&nbsp;&nbsp; = imagecolorallocate($overlay_img, 0x00, 0x00, 0x00);<br />
&nbsp;&nbsp;&nbsp; $white&nbsp;&nbsp; = imagecolorallocate($overlay_img, 0xFF, 0xFF, 0xFF);<br />
&nbsp;&nbsp;&nbsp; $magenta = imagecolorallocate($overlay_img, 0xFF, 0x00, 0xFF);&nbsp; &nbsp; <br />
&nbsp;&nbsp;&nbsp; // and use it here:<br />
&nbsp;&nbsp;&nbsp; imagecolortransparent($overlay_img, $white);<br />
<br />
&nbsp;&nbsp;&nbsp; // copy and merge the overlay image and the canvas image:<br />
&nbsp;&nbsp;&nbsp; imagecopymerge($canvas_img, $overlay_img, 0,0,0,0, $overlay_w, $overlay_h, $Opacity);<br />
<br />
&nbsp;&nbsp;&nbsp; // output:<br />
&nbsp;&nbsp;&nbsp; header("Content-type: image/jpeg");<br />
&nbsp;&nbsp;&nbsp; imagejpeg($canvas_img, '', $Quality);<br />
<br />
&nbsp;&nbsp;&nbsp; imagedestroy($overlay_img);<br />
&nbsp;&nbsp;&nbsp; imagedestroy($canvas_img);<br />
}<br />
<br />
// call function with opcity set to 50% and 95% quality<br />
WatermarkImage("canvas.jpg", "overlay.png", 50, 95);<br />
<br />
[/code]</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="36411""></a>
  <div class="note">
   <strong class="user">creator79&gt;&gt;web&gt;&gt;de</strong>
   <a href="#36411" class="date">09-Oct-2003 03:44</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Hi!<br />
I'm using GDLib 1.6.3 so far I know.<br />
You can have transparency on any defined color on any image type when using the imagecolorclosest($im, $R, $G, $B) function instead of imagecolorallocate() or imagecolorexact().</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="34642""></a>
  <div class="note">
   <strong class="user">calar at gamigo dot de</strong>
   <a href="#34642" class="date">02-Aug-2003 03:53</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
ok some works...<br />
<br />
i had a test-sytem with GDLib, phpinfo shows me this version:<br />
"GD Version&nbsp; 2.0 or higher" so far no porblems with: imageColorTransparent<br />
<br />
Then we had to copy ouer codes to another sever on this server phpinfo shots me version:<br />
"GD Version&nbsp; bundled (2.0.12 compatible)"<br />
<br />
The jpg was wrong and nothing was transparent.<br />
The point is, you have to use: imagecopymerge<br />
<br />
Don't if its true on any system just work on <br />
SUSE 8.2<br />
PHP 4.3.2</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="30423""></a>
  <div class="note">
   <strong class="user">cladiniz at zipmail dot com dot br</strong>
   <a href="#30423" class="date">18-Mar-2003 03:19</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If you have a transparent PNG , in PHP 4.3.1 , GD 2.0 , you don't need to set the transparency anymore , it's automatic ...</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="30094""></a>
  <div class="note">
   <strong class="user">sandhawk at spies dot com</strong>
   <a href="#30094" class="date">06-Mar-2003 08:04</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
here's a little snippet of code that i got for getting images to overlay with transparency(based off text overlay above).<br />
<br />
$olay_img = imagecreatefromPNG("overlay.png); //NOTE I recomment you use png for this, artifacts from jpeg images can look bad when you overlay them<br />
$src_img = ImageCreateFromJPEG("image.jpg");<br />
$src_w = ImageSX($src_img);<br />
$src_h = ImageSY($src_img);<br />
<br />
$can_img = imagecreatetruecolor($src_w, $src_h);<br />
<br />
$black = ImageColorAllocate ($olay_img, 0, 0, 0);<br />
<br />
ImageColorTransparent($olay_img, $black);<br />
<br />
imagecopy($can_img, $src_img, 0,0,0,0, $src_w, $src_h);<br />
imagecopymerge($can_img, $olay_img, 0,0,0,0, ImageSX($olay_img), ImageSY($olay_img),100); //Imagecopy won't work, you must used imagecopymerge<br />
<br />
ImageJPEG($can_img,'',100);<br />
<br />
imagedestroy($src_img);<br />
imagedestroy($olay_img);<br />
imagedestroy($can_img);</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="28035""></a>
  <div class="note">
   <strong class="user">Jonatan</strong>
   <a href="#28035" class="date">30-Dec-2002 07:35</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I have found that ImageColorTransparent() works on true color images if and only if the transparent color is black.<br />
(PHP 4.2.3/GD 2.0)</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="21248""></a>
  <div class="note">
   <strong class="user">marshall.AT.byterage.net</strong>
   <a href="#21248" class="date">05-May-2002 04:50</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
In response to the note above...<br />
<br />
ImageColorTransparent() does work on TrueColor images.&nbsp; I have it working myself but I do remember having to add an extra step somewhere.&nbsp; Anyways, here is how I overlay text on a jpeg.&nbsp; Don't forget, you need GD 2.x for true color to work.&nbsp; This example requires TTF support also.<br />
<br />
//<br />
// get src image and dimensions<br />
$src_img = ImageCreateFromJPEG("foo.jpg");<br />
$src_w = ImageSX($src_img);<br />
$src_h = ImageSY($src_img);<br />
//<br />
// create empty true color canvas, def bg is black<br />
$txt_img = ImageCreateTrueColor($src_w,$src_h);<br />
//<br />
// define colors<br />
$white = ImageColorAllocate ($txt_img, 255, 255, 255);<br />
$black = ImageColorAllocate ($txt_img, 0, 0, 0);<br />
//<br />
// add your white text<br />
ImageTTFText ($txt_img, 80, 25, 65, 350, $white, "impact.ttf", "Kung Fu");<br />
//<br />
// make black bg transparent<br />
ImageColorTransparent($txt_img, $black);<br />
//<br />
// merge text image onto src image<br />
ImageCopyMerge($src_img,$txt_img,0,0,0,0,$src_w,$src_h,30); // 30% opacity<br />
<br />
'Now' you can do resizing or whatever and output it.&nbsp; You need to create yet another blank image to resample.&nbsp; (Actually you can resize the image before the text overlay step with some small mods, but its REALLY messy if you want the output size to be dynamic)<br />
<br />
//<br />
// create empty true color canvas for resizing.<br />
$dst_img = ImageCreateTrueColor(100,100);<br />
//<br />
// resize<br />
ImageCopyResampled($dst_img,$src_img,0,0,0,0,100,100,$src_w,$src_h); <br />
//<br />
// output to browser.<br />
ImageJPEG($dst_img,'',70);&nbsp;&nbsp; // quality 70<br />
<br />
If someone could tell me a shorter way to do this, that would be sweet.&nbsp; The way it is now, it just feels like there is one too many steps to get this done.&nbsp; But I am glad it works at all!</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="17399""></a>
  <div class="note">
   
   <a href="#17399" class="date">07-Dec-2001 04:18</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
when a color is defined as transparent, anytime that color is used in another function (before or after transparency definition) will be transparent
<br />

<br />
ex:
<br />
$red = ImageColorAllocate ($im, 233, 14, 91);
<br />
$blue = ImageColorAllocate ($im, 0x20, 0x60, 0xaa);
<br />
imagefilledarc ($im, 100, 100, 80, 80, 0, 60, $blue, IMG_ARC_PIE);//arc is transparent even though is not defined yet
<br />
$trans=imagecolortransparent($im,$blue);//affects all occurances of blue, before and after this line
<br />

<br />
ALSO:
<br />
ImageString ($im, 10, 5, 5,&nbsp; "Transparent Text String", $blue);
<br />
---is equivalent to----
<br />
ImageString ($im, 10, 5, 5,&nbsp; "Transparent Text String", $trans);</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
</div>
</div>
</div></div></body></html>
