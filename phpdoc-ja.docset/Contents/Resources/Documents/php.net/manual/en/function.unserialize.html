<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
 <head>
  <meta http-equiv="content-type" content="text/html; CHARSET=shift-jis">
  <title>保存用表現から PHP の値を生成する</title>

  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <link media="all" rel="stylesheet" type="text/css" href="style.css"/>
 </head>
 <body class="docs" class="docs"><div class="navbar navbar-fixed-top">
  <div class="navbar-inner clearfix">
    <ul class="nav" style="width: 100%">
      <li style="float: left;"><a href="function.strval.html">≪ strval</a></li>
      <li style="float: right;"><a href="function.unset.html">unset ≫</a></li>
    </ul>
  </div>
</div>
<div id="breadcrumbs" class="clearfix">
  <ul class="breadcrumbs-container">
    <li><a href="index.html">PHP Manual</a></li>
    <li><a href="ref.var.html">変数操作 関数</a></li>
    <li>保存用表現から PHP の値を生成する</li>
  </ul>
</div>
<div id="layout">
  <div id="layout-content"><div id="function.unserialize" class="refentry">
 <div class="refnamediv">
  <h1 class="refname">unserialize</h1>
  <p class="verinfo">(PHP 4, PHP 5)</p><p class="refpurpose"><span class="refname">unserialize</span> &mdash; <span class="dc-title">
   保存用表現から PHP の値を生成する
  </span></p>

 </div>
 
 <div class="refsect1 description" id="refsect1-function.unserialize-description">
  <h3 class="title">説明</h3>
  <div class="methodsynopsis dc-description">
   <span class="type"><a href="language.pseudo-types.html#language.types.mixed" class="type mixed">mixed</a></span> <span class="methodname"><strong>unserialize</strong></span>
    ( <span class="methodparam"><span class="type">string</span> <code class="parameter">$str</code></span>
   )</div>

  <p class="simpara">
   <span class="function"><strong>unserialize()</strong></span> は、シリアル化された変数を
   PHP 変数値に戻す変換を行います。
  </p>
 </div>


 <div class="refsect1 parameters" id="refsect1-function.unserialize-parameters">
  <h3 class="title">パラメータ</h3>
  <p class="para">
   <dl>

    
     <dt>
<code class="parameter">str</code></dt>

     <dd>

      <p class="para">
       シリアル化された文字列。
      </p>
      <p class="para">
       もしアンシリアライズする変数がオブジェクトの場合、
       オブジェクトが無事再作成された後、PHP は自動的にメンバ関数
       <a href="language.oop5.magic.html#object.wakeup" class="link">__wakeup()</a>
       (存在していれば) をコールしようとします。
      </p>
      <p class="para">
       <blockquote class="note"><p><strong class="note">注意</strong>: 
        <strong>unserialize_callback_func ディレクティブ</strong><br />
        <p class="para">
         コールバック関数を設定することが可能です。(不完全な
         <span class="type"><a href="language.types.object.html" class="type object">object</a></span> &quot;__PHP_Incomplete_Class&quot;を得ることを防ぐため)
         コールバック関数は、非シリアル化する際に未定義のクラスをインスタ
         ンス化する必要がある場合にコールされます。
         &#039;<em>unserialize_callback_func</em>&#039;を定義するためには、
         <var class="filename">php.ini</var>, <span class="function"><a href="function.ini-set.html" class="function">ini_set()</a></span>, <var class="filename">.htaccess</var> を使用し
         てください。未定義のクラスをインスタンス化する度に、コールバック関
         数がコールされます。この機能を無効とするには、
         単純にこの設定を空にしてください。
        </p>
       </p></blockquote>
      </p>
     </dd>

    
   </dl>

  </p>
 </div>


 <div class="refsect1 returnvalues" id="refsect1-function.unserialize-returnvalues">
  <h3 class="title">返り値</h3>
  <p class="para">
   変換された値が返されます。その値は、
   <span class="type"><a href="language.types.boolean.html" class="type boolean">boolean</a></span>, <span class="type"><a href="language.types.integer.html" class="type integer">integer</a></span>, <span class="type"><a href="language.types.float.html" class="type float">float</a></span>,
   <span class="type"><a href="language.types.string.html" class="type string">string</a></span>, <span class="type"><a href="language.types.array.html" class="type array">array</a></span>, <span class="type"><a href="language.types.object.html" class="type object">object</a></span>
   のいずれかとなります。
  </p>
  <p class="para">
   渡された文字列が復元できなかった場合、<strong><code>FALSE</code></strong> を返して
   <strong><code>E_NOTICE</code></strong> を発生します。
  </p>
 </div>


 <div class="refsect1 examples" id="refsect1-function.unserialize-examples">
  <h3 class="title">例</h3>
  <p class="para">
   <div class="example" id="example-5380">
    <p><strong>例1 <span class="function"><strong>unserialize()</strong></span> の例</strong></p>
    <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br /></span><span style="color: #FF8000">//&nbsp;ここで、データベースから&nbsp;$session_data&nbsp;にセッションデータをロード<br />//&nbsp;するために&nbsp;unserialize()&nbsp;を使用します。<br />//&nbsp;この例は、serialize()&nbsp;で記述された例を補足するものです。<br /><br /></span><span style="color: #0000BB">$conn&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">odbc_connect</span><span style="color: #007700">(</span><span style="color: #DD0000">"webdb"</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">"php"</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">"chicken"</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">$stmt&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">odbc_prepare</span><span style="color: #007700">(</span><span style="color: #0000BB">$conn</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">"SELECT&nbsp;data&nbsp;FROM&nbsp;sessions&nbsp;WHERE&nbsp;id&nbsp;=&nbsp;?"</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">$sqldata&nbsp;</span><span style="color: #007700">=&nbsp;array(</span><span style="color: #0000BB">$_SERVER</span><span style="color: #007700">[</span><span style="color: #DD0000">'PHP_AUTH_USER'</span><span style="color: #007700">]);<br />if&nbsp;(!</span><span style="color: #0000BB">odbc_execute</span><span style="color: #007700">(</span><span style="color: #0000BB">$stmt</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$sqldata</span><span style="color: #007700">)&nbsp;||&nbsp;!</span><span style="color: #0000BB">odbc_fetch_into</span><span style="color: #007700">(</span><span style="color: #0000BB">$stmt</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$tmp</span><span style="color: #007700">))&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">//&nbsp;実行または取得が失敗した場合、空の配列で初期化します<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$session_data&nbsp;</span><span style="color: #007700">=&nbsp;array();<br />}&nbsp;else&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">//&nbsp;tmp[0]&nbsp;にシリアル化されたデータを保持している必要があります。<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$session_data&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">unserialize</span><span style="color: #007700">(</span><span style="color: #0000BB">$tmp</span><span style="color: #007700">[</span><span style="color: #0000BB">0</span><span style="color: #007700">]);<br />&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(!</span><span style="color: #0000BB">is_array</span><span style="color: #007700">(</span><span style="color: #0000BB">$session_data</span><span style="color: #007700">))&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">//&nbsp;何か問題があったため、空の配列で初期化します。<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$session_data&nbsp;</span><span style="color: #007700">=&nbsp;array();<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br />}<br /></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
    </div>

   </div>
  </p>
  <p class="para">
   <div class="example" id="example-5381">
    <p><strong>例2 unserialize_callback_func の例</strong></p>
    <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br />$serialized_object</span><span style="color: #007700">=</span><span style="color: #DD0000">'O:1:"a":1:{s:5:"value";s:3:"100";}'</span><span style="color: #007700">;<br /><br /></span><span style="color: #FF8000">//&nbsp;unserialize_callback_func&nbsp;ディレクティブは&nbsp;PHP&nbsp;4.2.0&nbsp;以降で利用可能<br /></span><span style="color: #0000BB">ini_set</span><span style="color: #007700">(</span><span style="color: #DD0000">'unserialize_callback_func'</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">'mycallback'</span><span style="color: #007700">);&nbsp;</span><span style="color: #FF8000">//&nbsp;独自のコールバック関数を設定する<br /><br /></span><span style="color: #007700">function&nbsp;</span><span style="color: #0000BB">mycallback</span><span style="color: #007700">(</span><span style="color: #0000BB">$classname</span><span style="color: #007700">)&nbsp;<br />{<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">//&nbsp;クラスが定義されているファイルをインクルードするだけです。<br />&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;どのクラス定義が必要になるのかを&nbsp;$classname&nbsp;で判断します。<br /></span><span style="color: #007700">}<br /></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
    </div>

   </div>
  </p>
 </div>


 <div class="refsect1 notes" id="refsect1-function.unserialize-notes">
  <h3 class="title">注意</h3>
  <div class="warning"><strong class="warning">警告</strong>
   <p class="para">
    エラーやシリアライズされた <strong><code>FALSE</code></strong> 値をアンシリアライズする場合、
    <strong><code>FALSE</code></strong> が返されます。この特殊なケースは
    <code class="parameter">str</code> を <em>serialize(false)</em>
    で比較する、もしくは <strong><code>E_NOTICE</code></strong>
    をキャッチすることで区別することができます。
   </p>
  </div>
  <div class="warning"><strong class="warning">警告</strong>
   <p class="para">
    ユーザーからの入力をそのまま <span class="function"><strong>unserialize()</strong></span> に渡してはいけません。
    アンシリアライズの時には、オブジェクトのインスタンス生成やオートローディングなどで
    コードが実行されることがあり、悪意のあるユーザーがこれを悪用するかもしれないからです。
    シリアル化したデータをユーザーに渡す必要がある場合は、安全で標準的なデータ交換フォーマットである
    JSON などを使うようにしましょう。
    <span class="function"><a href="function.json-decode.html" class="function">json_decode()</a></span> および <span class="function"><a href="function.json-encode.html" class="function">json_encode()</a></span>
    を利用します。
   </p>
  </div>
 </div>


 <div class="refsect1 seealso" id="refsect1-function.unserialize-seealso">
  <h3 class="title">参考</h3>
  <p class="para">
   <ul class="simplelist">
    <li class="member"><span class="function"><a href="function.serialize.html" class="function" rel="rdfs-seeAlso">serialize()</a> - 値の保存可能な表現を生成する</span></li>
    <li class="member"><a href="language.oop5.autoload.html" class="link">オブジェクトのオートローディング</a></li>
    <li class="member"><a href="var.configuration.html#unserialize-callback-func" class="link">unserialize_callback_func</a></li>
    <li class="member"><a href="language.oop5.magic.html#object.wakeup" class="link">__wakeup()</a></li>
   </ul>
  </p>
 </div>


</div><div id="usernotes">
 <div class="head">
  <h3 class="title">User Contributed Notes</h3>
 </div>
<div id="allnotes">  <a name="112894""></a>
  <div class="note">
   <strong class="user">ErnestV</strong>
   <a href="#112894" class="date">03-Aug-2013 10:05</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Just a note - if the serialized string contains a reference to a class that cannot be instantiated (e.g. being abstract) PHP will immediately die with a fatal error. If the unserialize() statement is preceded with a '@' to avoid cluttering the logs with warns or notices there will be absolutely no clue as to why the script stopped working. Cost me a couple of hours...</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="112823""></a>
  <div class="note">
   <strong class="user">Ray.Paseur often uses Gmail</strong>
   <a href="#112823" class="date">26-Jul-2013 10:41</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
In the Classes and Objects docs, there is this: In order to be able to unserialize() an object, the class of that object needs to be defined.<br />
<br />
Prior to PHP 5.3, this was not an issue.&nbsp; But after PHP 5.3 an object made by SimpleXML_Load_String() cannot be serialized.&nbsp; An attempt to do so will result in a run-time failure, throwing an exception.&nbsp; If you store such an object in $_SESSION, you will get a post-execution error that says this:<br />
<br />
Fatal error: Uncaught exception 'Exception' with message 'Serialization of 'SimpleXMLElement' is not allowed' in [no active file]:0 Stack trace: #0 {main} thrown in [no active file] on line 0<br />
<br />
The entire contents of the session will be lost.&nbsp; Hope this saves someone some time!<br />
<br />
<span class="default">&lt;?php </span><span class="comment">// RAY_temp_ser.php<br />
</span><span class="default">error_reporting</span><span class="keyword">(</span><span class="default">E_ALL</span><span class="keyword">);<br />
</span><span class="default">session_start</span><span class="keyword">();<br />
</span><span class="default">var_dump</span><span class="keyword">(</span><span class="default">$_SESSION</span><span class="keyword">);<br />
</span><span class="default">$_SESSION</span><span class="keyword">[</span><span class="string">'hello'</span><span class="keyword">] = </span><span class="string">'World'</span><span class="keyword">;<br />
</span><span class="default">var_dump</span><span class="keyword">(</span><span class="default">$_SESSION</span><span class="keyword">);<br />
<br />
</span><span class="comment">// AN XML STRING FOR TEST DATA<br />
</span><span class="default">$xml </span><span class="keyword">= </span><span class="string">'&lt;?xml version="1.0"?&gt;<br />
&lt;families&gt;<br />
&nbsp; &lt;parent&gt;<br />
&nbsp;&nbsp;&nbsp; &lt;child index="1" value="Category 1"&gt;Child One&lt;/child&gt;<br />
&nbsp; &lt;/parent&gt;<br />
&lt;/families&gt;'</span><span class="keyword">;<br />
<br />
</span><span class="comment">// MAKE AN OBJECT (GIVES SimpleXMLElement)<br />
</span><span class="default">$obj </span><span class="keyword">= </span><span class="default">SimpleXML_Load_String</span><span class="keyword">(</span><span class="default">$xml</span><span class="keyword">);<br />
<br />
</span><span class="comment">// STORE THE OBJECT IN THE SESSION<br />
</span><span class="default">$_SESSION</span><span class="keyword">[</span><span class="string">'obj'</span><span class="keyword">] = </span><span class="default">$obj</span><span class="keyword">;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="107886""></a>
  <div class="note">
   <strong class="user">suman dot jis at gmail dot com</strong>
   <a href="#107886" class="date">13-Mar-2012 06:12</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I was getting unserialize()&nbsp; Error at offset error.<br />
<br />
If you face similar problem&nbsp; then use the following procedure<br />
<br />
$auctionDetails = preg_replace('!s:(\d+):"(.*?)";!se', "'s:'.strlen('$2').':\"$2\";'", $dataArr[$i]['auction_details'] ); <br />
$auctionDetails = unserialize($auctionDetails);</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="105588""></a>
  <div class="note">
   <strong class="user">frank at interactinet dot com</strong>
   <a href="#105588" class="date">30-Aug-2011 06:32</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
When dealing with sessions, try session_decode($data) instead of unserialize($data).</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="105500""></a>
  <div class="note">
   <strong class="user">walf</strong>
   <a href="#105500" class="date">23-Aug-2011 05:22</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
a replacement for unserialize that returns whether it worked and populates the unserialized variable by reference:<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">function </span><span class="default">funserialize</span><span class="keyword">(</span><span class="default">$serialized</span><span class="keyword">, &amp;</span><span class="default">$into</span><span class="keyword">) {<br />
&nbsp;&nbsp;&nbsp; static </span><span class="default">$sfalse</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; if (</span><span class="default">$sfalse </span><span class="keyword">=== </span><span class="default">null</span><span class="keyword">)<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$sfalse </span><span class="keyword">= </span><span class="default">serialize</span><span class="keyword">(</span><span class="default">false</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$into </span><span class="keyword">= @</span><span class="default">unserialize</span><span class="keyword">(</span><span class="default">$serialized</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; return </span><span class="default">$into </span><span class="keyword">!== </span><span class="default">false </span><span class="keyword">|| </span><span class="default">rtrim</span><span class="keyword">(</span><span class="default">$serialized</span><span class="keyword">) === </span><span class="default">$sfalse</span><span class="keyword">;</span><span class="comment">//whitespace at end of serialized var is ignored by PHP<br />
</span><span class="keyword">}<br />
<br />
</span><span class="default">$s_foo </span><span class="keyword">= </span><span class="string">'b:0;'</span><span class="keyword">;<br />
</span><span class="default">var_dump</span><span class="keyword">(</span><span class="default">funserialize</span><span class="keyword">(</span><span class="default">$s_foo</span><span class="keyword">, </span><span class="default">$foo</span><span class="keyword">), </span><span class="default">$foo</span><span class="keyword">);<br />
<br />
</span><span class="default">$s_bar </span><span class="keyword">= </span><span class="string">'bar'</span><span class="keyword">;<br />
</span><span class="default">var_dump</span><span class="keyword">(</span><span class="default">funserialize</span><span class="keyword">(</span><span class="default">$s_bar</span><span class="keyword">, </span><span class="default">$bar</span><span class="keyword">), </span><span class="default">$bar</span><span class="keyword">);<br />
<br />
</span><span class="default">$s_foo </span><span class="keyword">= </span><span class="string">'a:0:{};'</span><span class="keyword">;<br />
</span><span class="default">var_dump</span><span class="keyword">(</span><span class="default">funserialize</span><span class="keyword">(</span><span class="default">$s_foo</span><span class="keyword">, </span><span class="default">$foo</span><span class="keyword">), </span><span class="default">$foo</span><span class="keyword">);<br />
<br />
</span><span class="default">?&gt;<br />
</span>gives:<br />
<br />
bool(true)<br />
bool(false)<br />
<br />
bool(false)<br />
bool(false)<br />
<br />
bool(true)<br />
array(0) {<br />
}</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="105190""></a>
  <div class="note">
   <strong class="user">MBa</strong>
   <a href="#105190" class="date">02-Aug-2011 12:49</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
To check if a string is serialized:<br />
<br />
$blSerialized=(@unserialize($sText)||$sText=='b:0;');</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="104479""></a>
  <div class="note">
   <strong class="user">chris at colourlovers dot com</strong>
   <a href="#104479" class="date">17-Jun-2011 02:31</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Anyone having trouble serializing data with SimpleXMLElement objects stored within it, check this out:<br />
<br />
This will traverse $data looking for any children which are instances of SimpleXMLElement, and will run -&gt;asXML() on them, turning them into a string and making them serializable. Other data will be left alone.<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">function </span><span class="default">exportNestedSimpleXML</span><span class="keyword">(</span><span class="default">$data</span><span class="keyword">) {<br />
&nbsp;&nbsp;&nbsp; if (</span><span class="default">is_scalar</span><span class="keyword">(</span><span class="default">$data</span><span class="keyword">) === </span><span class="default">false</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; foreach (</span><span class="default">$data </span><span class="keyword">as </span><span class="default">$k </span><span class="keyword">=&gt; </span><span class="default">$v</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">$v </span><span class="keyword">instanceof </span><span class="default">SimpleXMLElement</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$v </span><span class="keyword">= </span><span class="default">str_replace</span><span class="keyword">(</span><span class="string">"&amp;#13;"</span><span class="keyword">,</span><span class="string">"\r"</span><span class="keyword">,</span><span class="default">$v</span><span class="keyword">-&gt;</span><span class="default">asXML</span><span class="keyword">());<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; } else {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$v </span><span class="keyword">= </span><span class="default">exportNestedSimpleXML</span><span class="keyword">(</span><span class="default">$v</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">is_array</span><span class="keyword">(</span><span class="default">$data</span><span class="keyword">)) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$data</span><span class="keyword">[</span><span class="default">$k</span><span class="keyword">] = </span><span class="default">$v</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; } else if (</span><span class="default">is_object</span><span class="keyword">(</span><span class="default">$data</span><span class="keyword">)) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$data</span><span class="keyword">-&gt;</span><span class="default">$k </span><span class="keyword">= </span><span class="default">$v</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp;&nbsp; return </span><span class="default">$data</span><span class="keyword">;<br />
}<br />
<br />
</span><span class="default">$data </span><span class="keyword">= array (<br />
&nbsp;&nbsp;&nbsp; </span><span class="string">"baz" </span><span class="keyword">=&gt; array (<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="string">"foo" </span><span class="keyword">=&gt; new </span><span class="default">stdClass</span><span class="keyword">(),<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="string">"int" </span><span class="keyword">=&gt; </span><span class="default">123</span><span class="keyword">,<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="string">"str" </span><span class="keyword">=&gt; </span><span class="string">"asdf"</span><span class="keyword">,<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="string">"bar" </span><span class="keyword">=&gt; new </span><span class="default">SimpleXMLElement</span><span class="keyword">(</span><span class="string">'&lt;?xml version="1.0" encoding="UTF-8"?&gt;&lt;foo&gt;bar&lt;/foo&gt;'</span><span class="keyword">),<br />
&nbsp;&nbsp;&nbsp; )<br />
);<br />
<br />
</span><span class="default">var_dump</span><span class="keyword">(</span><span class="default">$data</span><span class="keyword">);<br />
</span><span class="comment">/*array(1) {<br />
&nbsp; ["baz"]=&gt;<br />
&nbsp; array(4) {<br />
&nbsp;&nbsp;&nbsp; ["foo"]=&gt;<br />
&nbsp;&nbsp;&nbsp; object(stdClass)#3 (0) {<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; ["int"]=&gt;<br />
&nbsp;&nbsp;&nbsp; int(123)<br />
&nbsp;&nbsp;&nbsp; ["str"]=&gt;<br />
&nbsp;&nbsp;&nbsp; string(4) "asdf"<br />
&nbsp;&nbsp;&nbsp; ["bar"]=&gt;<br />
&nbsp;&nbsp;&nbsp; object(SimpleXMLElement)#4 (1) {<br />
&nbsp;&nbsp; &nbsp;&nbsp; [0]=&gt;<br />
&nbsp;&nbsp; &nbsp;&nbsp; string(3) "bar"<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp; }<br />
}*/<br />
<br />
</span><span class="default">var_dump</span><span class="keyword">(</span><span class="default">exportNestedSimpleXML</span><span class="keyword">(</span><span class="default">$data</span><span class="keyword">));<br />
</span><span class="comment">/*array(1) {<br />
&nbsp; ["baz"]=&gt;<br />
&nbsp; array(4) {<br />
&nbsp;&nbsp;&nbsp; ["foo"]=&gt;<br />
&nbsp;&nbsp;&nbsp; object(stdClass)#3 (0) {<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; ["int"]=&gt;<br />
&nbsp;&nbsp;&nbsp; int(123)<br />
&nbsp;&nbsp;&nbsp; ["str"]=&gt;<br />
&nbsp;&nbsp;&nbsp; string(4) "asdf"<br />
&nbsp;&nbsp;&nbsp; ["bar"]=&gt;<br />
&nbsp;&nbsp;&nbsp; string(54) "&lt;?xml version="1.0" encoding="UTF-8"?&gt;<br />
&lt;foo&gt;bar&lt;/foo&gt;<br />
"<br />
&nbsp; }<br />
}<br />
*/<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="96938""></a>
  <div class="note">
   <strong class="user">daniel at fourstaples dot com</strong>
   <a href="#96938" class="date">24-Mar-2010 05:46</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Here's a simple function to get the class of a serialized string (that is, the type of object that will be returned if it's unserialized):<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">function </span><span class="default">get_serial_class</span><span class="keyword">(</span><span class="default">$serial</span><span class="keyword">) {<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$types </span><span class="keyword">= array(</span><span class="string">'s' </span><span class="keyword">=&gt; </span><span class="string">'string'</span><span class="keyword">, </span><span class="string">'a' </span><span class="keyword">=&gt; </span><span class="string">'array'</span><span class="keyword">, </span><span class="string">'b' </span><span class="keyword">=&gt; </span><span class="string">'bool'</span><span class="keyword">, </span><span class="string">'i' </span><span class="keyword">=&gt; </span><span class="string">'int'</span><span class="keyword">, </span><span class="string">'d' </span><span class="keyword">=&gt; </span><span class="string">'float'</span><span class="keyword">, </span><span class="string">'N;' </span><span class="keyword">=&gt; </span><span class="string">'NULL'</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$parts </span><span class="keyword">= </span><span class="default">explode</span><span class="keyword">(</span><span class="string">':'</span><span class="keyword">, </span><span class="default">$serial</span><span class="keyword">, </span><span class="default">4</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; return isset(</span><span class="default">$types</span><span class="keyword">[</span><span class="default">$parts</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">]]) ? </span><span class="default">$types</span><span class="keyword">[</span><span class="default">$parts</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">]] : </span><span class="default">trim</span><span class="keyword">(</span><span class="default">$parts</span><span class="keyword">[</span><span class="default">2</span><span class="keyword">], </span><span class="string">'"'</span><span class="keyword">); <br />
}<br />
</span><span class="default">?&gt;<br />
</span><br />
I use this when saving a serialized object to a cookie, to make sure it is the right type when I go to unserialize it.<br />
<br />
The type names are the same format/case as you would see if you did a var_dump().</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="96641""></a>
  <div class="note">
   <strong class="user">Fagzal</strong>
   <a href="#96641" class="date">09-Mar-2010 07:10</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
To all who have problem with quoting and slashes when storing serialized data in MySQL: you are probably doing it wrong.<br />
<br />
Use e.g. PDO with placeholders and the blob column type, and it will Just Work.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="93451""></a>
  <div class="note">
   <strong class="user">arbie samong</strong>
   <a href="#93451" class="date">10-Sep-2009 04:42</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
__PHP_Incomplete_Class Object Demystified
<br />

<br />
1. First take note of the output. A simple example:
<br />

<br />
__PHP_Incomplete_Class Object (
<br />
[__PHP_Incomplete_Class_Name] =&gt; SomeObject1
<br />
[obj1property1] =&gt; somevalue1 [obj1property2] =&gt; __PHP_Incomplete_Class Object ( [__PHP_Incomplete_Class_Name] =&gt; SomeObject2 [obj2property1] =&gt; somevalue1 [obj2property2] =&gt; Array (
<br />
['key1'] =&gt; somevalue3, ['key2'] =&gt; somevalue4 ) ) )
<br />

<br />
2. We analyze this and break it down. 
<br />
__PHP_Incomplete_Class Object tells you there is an object that needs to be declared somehow. 
<br />
__PHP_Incomplete_Class_Name simply tells you the expected class name. It is just one of the properties for now.
<br />

<br />
So we have:
<br />
a) an unknown object that has a class name SomeObject1 (first class)
<br />
b) it has 2 properties, namely obj1property1 and obj2property2
<br />
c) obj2property2 is itself an object whose class name is SomeObject2 (the second class)
<br />
d) SomeObject2 has two properties, obj2property1 and obj2property2
<br />
e) obj2property2 is an array that contains two elements
<br />

<br />
3. Now that we have an idea of the structure, we shall create class definitions based from it. We will just create properties for now, methods are not required as a minimum.
<br />

<br />
<span class="default">&lt;?php
<br />
</span><span class="keyword">class </span><span class="default">SomeObject1 </span><span class="keyword">{
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; public </span><span class="default">$obj1property1</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; public </span><span class="default">$obj1property2</span><span class="keyword">;
<br />
}
<br />
class </span><span class="default">SomeObject2 </span><span class="keyword">{
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; public </span><span class="default">$obj2property1</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; public </span><span class="default">$obj2property2</span><span class="keyword">;
<br />
}
<br />
</span><span class="default">?&gt;
<br />
</span>
<br />
4. Have that accessible to your script and it will solve the __PHP_Incomplete_Class Object problem as far as the output is concerned. Now you will have:
<br />

<br />
SomeObject1 ( [obj1property1] =&gt; somevalue1 [obj1property2] =&gt; SomeObject2 ( [obj2property1] =&gt; somevalue1 [obj2property2] =&gt; Array ( ['key1'] =&gt; somevalue3, ['key2'] =&gt; somevalue4 ) ) )
<br />

<br />
As you will notice, __PHP_Incomplete_Class Object is gone and replaced by the class name. The property __PHP_Incomplete_Class_Name is also removed.
<br />

<br />
5. As for the array property obj2property2, we can directly access that and just assume that it is an array and loop through it:
<br />

<br />
<span class="default">&lt;?php
<br />

<br />
</span><span class="comment">// this will be SomeObject1 
<br />
</span><span class="default">$data </span><span class="keyword">= </span><span class="default">unserialize</span><span class="keyword">(</span><span class="default">$serialized_data</span><span class="keyword">);
<br />

<br />
</span><span class="comment">// this will be SomeObject2
<br />
</span><span class="default">$data2 </span><span class="keyword">= </span><span class="default">$data</span><span class="keyword">-&gt;</span><span class="default">obj1property2</span><span class="keyword">();
<br />

<br />
foreach(</span><span class="default">$data2</span><span class="keyword">-&gt;</span><span class="default">obj2property2 </span><span class="keyword">as </span><span class="default">$key </span><span class="keyword">=&gt; </span><span class="default">$value</span><span class="keyword">):
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; print </span><span class="default">$key</span><span class="keyword">.</span><span class="string">' : '</span><span class="keyword">. </span><span class="default">$value </span><span class="keyword">.</span><span class="string">'&lt;br&gt;'</span><span class="keyword">; 
<br />
endforeach;
<br />

<br />
</span><span class="default">?&gt;
<br />
</span>
<br />
Outputs:
<br />
key1 : somevalue3
<br />
key2 : somevalue4
<br />

<br />
That's it. You can add more methods on the class declarations for the given properties, provided you keep your original output as basis for the data types.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="90120""></a>
  <div class="note">
   <strong class="user">w dot laurencine at teknoa dot net</strong>
   <a href="#90120" class="date">07-Apr-2009 02:54</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
When dealing with a string which contain "\r", it seems that the length is not evaluated correctly. The following solves the problem for me :<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="comment">// remove the \r caracters from the $unserialized string<br />
</span><span class="default">$unserialized </span><span class="keyword">= </span><span class="default">str_replace</span><span class="keyword">(</span><span class="string">"\r"</span><span class="keyword">,</span><span class="string">""</span><span class="keyword">,</span><span class="default">$unserialized</span><span class="keyword">);<br />
<br />
</span><span class="comment">// and then unserialize()<br />
</span><span class="default">unserialize</span><span class="keyword">(</span><span class="default">$unserialized</span><span class="keyword">);<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="85097""></a>
  <div class="note">
   <strong class="user">chris AT cmbuckley DOT co DOT uk</strong>
   <a href="#85097" class="date">14-Aug-2008 03:47</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
As mentioned in the notes, unserialize returns false in the event of an error and for boolean false. Here is the first solution mentioned, without using error handling:<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">function </span><span class="default">isSerialized</span><span class="keyword">(</span><span class="default">$str</span><span class="keyword">) {<br />
&nbsp;&nbsp;&nbsp; return (</span><span class="default">$str </span><span class="keyword">== </span><span class="default">serialize</span><span class="keyword">(</span><span class="default">false</span><span class="keyword">) || @</span><span class="default">unserialize</span><span class="keyword">(</span><span class="default">$str</span><span class="keyword">) !== </span><span class="default">false</span><span class="keyword">);<br />
}<br />
<br />
</span><span class="default">var_dump</span><span class="keyword">(</span><span class="default">isSerialized</span><span class="keyword">(</span><span class="string">'s:6:"foobar";'</span><span class="keyword">)); </span><span class="comment">// bool(true)<br />
</span><span class="default">var_dump</span><span class="keyword">(</span><span class="default">isSerialized</span><span class="keyword">(</span><span class="string">'foobar'</span><span class="keyword">));&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="comment">// bool(false)<br />
</span><span class="default">var_dump</span><span class="keyword">(</span><span class="default">isSerialized</span><span class="keyword">(</span><span class="string">'b:0;'</span><span class="keyword">));&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="comment">// bool(true)<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="74932""></a>
  <div class="note">
   <strong class="user">Ates Goral</strong>
   <a href="#74932" class="date">04-May-2007 08:02</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If instead of using JSON, you'd like to stick with PHP-style serialization, here's some JavaScript code I posted at <a href="http://magnetiq.com for serializing JavaScript objects in PHP fashion:" rel="nofollow" target="_blank">http://magnetiq.com for serializing JavaScript objects in PHP fashion:</a><br />
<br />
/* Returns the class name of the argument or undefined if<br />
&nbsp;&nbsp; it's not a valid JavaScript object.<br />
*/<br />
function getObjectClass(obj)<br />
{<br />
&nbsp;&nbsp;&nbsp; if (obj &amp;&amp; obj.constructor &amp;&amp; obj.constructor.toString)<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; var arr = obj.constructor.toString().match(<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; /function\s*(\w+)/);<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if (arr &amp;&amp; arr.length == 2)<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return arr[1];<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp;&nbsp; return undefined;<br />
}<br />
<br />
/* Serializes the given argument, PHP-style.<br />
<br />
&nbsp;&nbsp; The type mapping is as follows:<br />
<br />
&nbsp;&nbsp; JavaScript Type&nbsp; &nbsp; PHP Type<br />
&nbsp;&nbsp; ---------------&nbsp; &nbsp; --------<br />
&nbsp;&nbsp; Number&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; Integer or Decimal<br />
&nbsp;&nbsp; String&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; String<br />
&nbsp;&nbsp; Boolean&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Boolean<br />
&nbsp;&nbsp; Array&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Array<br />
&nbsp;&nbsp; Object&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; Object<br />
&nbsp;&nbsp; undefined&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Null<br />
<br />
&nbsp;&nbsp; The special JavaScript object null also becomes PHP Null.<br />
&nbsp;&nbsp; This function may not handle associative arrays or array<br />
&nbsp;&nbsp; objects with additional properties well.<br />
*/<br />
function phpSerialize(val)<br />
{<br />
&nbsp;&nbsp;&nbsp; switch (typeof(val))<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp;&nbsp; case "number":<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return (Math.floor(val) == val ? "i" : "d") + ":" +<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; val + ";";<br />
&nbsp;&nbsp;&nbsp; case "string":<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return "s:" + val.length + ":\"" + val + "\";";<br />
&nbsp;&nbsp;&nbsp; case "boolean":<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return "b:" + (val ? "1" : "0") + ";";<br />
&nbsp;&nbsp;&nbsp; case "object":<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if (val == null)<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return "N;";<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; else if ("length" in val)<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; var idxobj = { idx: -1 };<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return "a:" + val.length + ":{" + val.map(<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; function (item)<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; this.idx++;<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; var ser = phpSerialize(item);<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return ser ?<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; phpSerialize(this.idx) + ser :<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; false;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }, idxobj).filter(<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; function (item)<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return item;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }).join("") + "}";<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; else<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; var class_name = getObjectClass(val);<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if (class_name == undefined)<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return false;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; var props = new Array();<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; for (var prop in val)<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; var ser = phpSerialize(val[prop]);<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if (ser)<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; props.push(phpSerialize(prop) + ser);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return "O:" + class_name.length + ":\"" +<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; class_name + "\":" + props.length + ":{" +<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; props.join("") + "}";<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; case "undefined":<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return "N;";<br />
&nbsp;&nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp;&nbsp; return false;<br />
}<br />
<br />
On the client side, you can pass in a complex (nested) JavaScript object to the phpSerialize function to get a PHP-style serialized representation. This string can be posted back and directly passed to the unserialize function to yield a representation of the complex object in PHP realm. Use of this technique requires caution on security matters.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="73585""></a>
  <div class="note">
   <strong class="user">BenBE at omorphia dot de</strong>
   <a href="#73585" class="date">02-Mar-2007 03:20</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
When trying to serialize or unserialize recursive arrays or otherwise linked data you might find the undocumented R data type quite useful.<br />
<br />
If you want a array like the one produced with<br />
&lt;?<br />
$a = array();<br />
$a[0] =&amp; $a;<br />
?&gt;<br />
serialized you can store it using a string simular to this one:<br />
&lt;?<br />
$a = unserialize("a:1:{i:0;R:1;}");<br />
?&gt;<br />
<br />
Both sources will make $a hold an array that self-references itself in index 0.<br />
<br />
The argument for R is the index of the created sub-variable of the serialize-string beginning with 1.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="71846""></a>
  <div class="note">
   <strong class="user">double at dumpit dot com</strong>
   <a href="#71846" class="date">19-Dec-2006 02:09</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
This little function will check whether the serialized string is well formed. <br />
<br />
PHP &lt; 6 because i'd heard changes will be made in this php-intern function, <br />
maybe it could be edited easy for it.<br />
<br />
<span class="default">&lt;?php<br />
<br />
</span><span class="keyword">function </span><span class="default">wd_check_serialization</span><span class="keyword">( </span><span class="default">$string</span><span class="keyword">, &amp;</span><span class="default">$errmsg </span><span class="keyword">) <br />
{<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$str </span><span class="keyword">= </span><span class="string">'s'</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$array </span><span class="keyword">= </span><span class="string">'a'</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$integer </span><span class="keyword">= </span><span class="string">'i'</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$any </span><span class="keyword">= </span><span class="string">'[^}]*?'</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$count </span><span class="keyword">= </span><span class="string">'\d+'</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$content </span><span class="keyword">= </span><span class="string">'"(?:\\\";|.)*?";'</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$open_tag </span><span class="keyword">= </span><span class="string">'\{'</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$close_tag </span><span class="keyword">= </span><span class="string">'\}'</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$parameter </span><span class="keyword">= </span><span class="string">"(</span><span class="default">$str</span><span class="string">|</span><span class="default">$array</span><span class="string">|</span><span class="default">$integer</span><span class="string">|</span><span class="default">$any</span><span class="string">):(</span><span class="default">$count</span><span class="string">)" </span><span class="keyword">. </span><span class="string">"(?:[:](</span><span class="default">$open_tag</span><span class="string">|</span><span class="default">$content</span><span class="string">)|[;])"</span><span class="keyword">;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$preg </span><span class="keyword">= </span><span class="string">"/</span><span class="default">$parameter</span><span class="string">|(</span><span class="default">$close_tag</span><span class="string">)/"</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; if( !</span><span class="default">preg_match_all</span><span class="keyword">( </span><span class="default">$preg</span><span class="keyword">, </span><span class="default">$string</span><span class="keyword">, </span><span class="default">$matches </span><span class="keyword">) ) <br />
&nbsp;&nbsp;&nbsp; {&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$errmsg </span><span class="keyword">= </span><span class="string">'not a serialized string'</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">false</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }&nbsp; &nbsp; <br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$open_arrays </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; foreach( </span><span class="default">$matches</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">] AS </span><span class="default">$key </span><span class="keyword">=&gt; </span><span class="default">$value </span><span class="keyword">)<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if( !empty( </span><span class="default">$value </span><span class="keyword">) &amp;&amp; ( </span><span class="default">$value </span><span class="keyword">!= </span><span class="default">$array </span><span class="keyword">xor </span><span class="default">$value </span><span class="keyword">!= </span><span class="default">$str </span><span class="keyword">xor </span><span class="default">$value </span><span class="keyword">!= </span><span class="default">$integer </span><span class="keyword">) ) <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$errmsg </span><span class="keyword">= </span><span class="string">'undefined datatype'</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">false</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if( </span><span class="default">$value </span><span class="keyword">== </span><span class="default">$array </span><span class="keyword">)<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$open_arrays</span><span class="keyword">++;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if( </span><span class="default">$matches</span><span class="keyword">[</span><span class="default">3</span><span class="keyword">][</span><span class="default">$key</span><span class="keyword">] != </span><span class="string">'{' </span><span class="keyword">) <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$errmsg </span><span class="keyword">= </span><span class="string">'open tag expected'</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">false</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if( </span><span class="default">$value </span><span class="keyword">== </span><span class="string">'' </span><span class="keyword">)<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if( </span><span class="default">$matches</span><span class="keyword">[</span><span class="default">4</span><span class="keyword">][</span><span class="default">$key</span><span class="keyword">] != </span><span class="string">'}' </span><span class="keyword">) <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$errmsg </span><span class="keyword">= </span><span class="string">'close tag expected'</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">false</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$open_arrays</span><span class="keyword">--;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if( </span><span class="default">$value </span><span class="keyword">== </span><span class="default">$str </span><span class="keyword">)<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$aVar </span><span class="keyword">= </span><span class="default">ltrim</span><span class="keyword">( </span><span class="default">$matches</span><span class="keyword">[</span><span class="default">3</span><span class="keyword">][</span><span class="default">$key</span><span class="keyword">], </span><span class="string">'"' </span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$aVar </span><span class="keyword">= </span><span class="default">rtrim</span><span class="keyword">( </span><span class="default">$aVar</span><span class="keyword">, </span><span class="string">'";' </span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if( </span><span class="default">strlen</span><span class="keyword">( </span><span class="default">$aVar </span><span class="keyword">) != </span><span class="default">$matches</span><span class="keyword">[</span><span class="default">2</span><span class="keyword">][</span><span class="default">$key</span><span class="keyword">] ) <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$errmsg </span><span class="keyword">= </span><span class="string">'stringlen for string not match'</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">false</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if( </span><span class="default">$value </span><span class="keyword">== </span><span class="default">$integer </span><span class="keyword">)<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if( !empty( </span><span class="default">$matches</span><span class="keyword">[</span><span class="default">3</span><span class="keyword">][</span><span class="default">$key</span><span class="keyword">] ) ) <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$errmsg </span><span class="keyword">= </span><span class="string">'unexpected data'</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">false</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if( !</span><span class="default">is_integer</span><span class="keyword">( (int)</span><span class="default">$matches</span><span class="keyword">[</span><span class="default">2</span><span class="keyword">][</span><span class="default">$key</span><span class="keyword">] ) ) <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$errmsg </span><span class="keyword">= </span><span class="string">'integer expected'</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">false</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; }&nbsp; &nbsp; &nbsp; &nbsp; <br />
&nbsp;&nbsp;&nbsp; if( </span><span class="default">$open_arrays </span><span class="keyword">!= </span><span class="default">0 </span><span class="keyword">) <br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$errmsg </span><span class="keyword">= </span><span class="string">'wrong setted arrays'</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">false</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; return </span><span class="default">true</span><span class="keyword">;<br />
}<br />
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="68748""></a>
  <div class="note">
   <strong class="user">Are Pedersen</strong>
   <a href="#68748" class="date">09-Aug-2006 10:46</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Be aware that if useing serialize/unserialize in a serverfarm with both 32bit and 64bit servers you can get unexpected results.<br />
<br />
Ex: if you serialize an integer with value of 2147483648 on a 64bit system and then unserialize it on a 32bit system you will get the value -2147483648 instead. This is because an integer on 32bit cannot be above 2147483647 so it wraps.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="65687""></a>
  <div class="note">
   <strong class="user">chad 0x40 herballure 0x2e com</strong>
   <a href="#65687" class="date">05-May-2006 06:08</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
When unserializing in PHP5 (behavior observed with 5.1.2), __autoload() will be checked first, and unserialize_callback_func called only if __autoload failed to load the class definition.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="55845""></a>
  <div class="note">
   <strong class="user">martin dot goldinger at netserver dot ch</strong>
   <a href="#55845" class="date">15-Aug-2005 01:48</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
When you use sessions, its very important to keep the sessiondata small, due to low performance with unserialize. Every class shoud extend from this class. The result will be, that no null Values are written to the sessiondata. It will increase performance.<br />
<br />
&lt;?<br />
class BaseObject<br />
{<br />
&nbsp;&nbsp;&nbsp; function __sleep()<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $vars = (array)$this;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; foreach ($vars as $key =&gt; $val)<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if (is_null($val))<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; unset($vars[$key]);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }&nbsp; &nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return array_keys($vars);<br />
&nbsp;&nbsp;&nbsp; }<br />
};<br />
?&gt;</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="46796""></a>
  <div class="note">
   <strong class="user">Chris Hayes (chris at hypersites dot com)</strong>
   <a href="#46796" class="date">23-Oct-2004 06:27</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
In reply to the earlier post about having to include object definitions *before* using unserialize.&nbsp; There is a workaround for this.<br />
<br />
When an object is serialized, the first bit of the string is actually the name of the class.&nbsp; When an unknown object is unserialized, this is maintained as a property.&nbsp; So if you serialize it again, you get back the exact same string as if you'd serialized the original object.&nbsp; Basically, to cut to the point...<br />
<br />
If you use<br />
<br />
$_SESSION['my_object'] = unserialize(serialize($_SESSION['my_object']))<br />
<br />
then you get back an object of the correct type, even if the session had originally loaded it as an object of type stdClass.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="37008""></a>
  <div class="note">
   <strong class="user">aderyn at nowhere dot tld</strong>
   <a href="#37008" class="date">30-Oct-2003 07:02</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
A quick note:<br />
If you store a serialized object in a session, you have to include the class _before_ you initialize (session_start()) the session.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
</div>
</div>
</div></div></body></html>
