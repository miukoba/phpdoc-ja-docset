<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
 <head>
  <meta http-equiv="content-type" content="text/html; CHARSET=shift-jis">
  <title>FTP サーバーからファイルをダウンロードし、オープン中のファイルに保存する</title>

  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <link media="all" rel="stylesheet" type="text/css" href="style.css"/>
 </head>
 <body class="docs" class="docs"><div class="navbar navbar-fixed-top">
  <div class="navbar-inner clearfix">
    <ul class="nav" style="width: 100%">
      <li style="float: left;"><a href="function.ftp-exec.html">≪ ftp_exec</a></li>
      <li style="float: right;"><a href="function.ftp-fput.html">ftp_fput ≫</a></li>
    </ul>
  </div>
</div>
<div id="breadcrumbs" class="clearfix">
  <ul class="breadcrumbs-container">
    <li><a href="index.html">PHP Manual</a></li>
    <li><a href="ref.ftp.html">FTP 関数</a></li>
    <li>FTP サーバーからファイルをダウンロードし、オープン中のファイルに保存する</li>
  </ul>
</div>
<div id="layout">
  <div id="layout-content"><div id="function.ftp-fget" class="refentry">
 <div class="refnamediv">
  <h1 class="refname">ftp_fget</h1>
  <p class="verinfo">(PHP 4, PHP 5)</p><p class="refpurpose"><span class="refname">ftp_fget</span> &mdash; <span class="dc-title">FTP サーバーからファイルをダウンロードし、オープン中のファイルに保存する</span></p>

 </div>
 <div class="refsect1 description" id="refsect1-function.ftp-fget-description">
  <h3 class="title">説明</h3>
  <div class="methodsynopsis dc-description">
   <span class="type">bool</span> <span class="methodname"><strong>ftp_fget</strong></span>
    ( <span class="methodparam"><span class="type">resource</span> <code class="parameter">$ftp_stream</code></span>
   , <span class="methodparam"><span class="type">resource</span> <code class="parameter">$handle</code></span>
   , <span class="methodparam"><span class="type">string</span> <code class="parameter">$remote_file</code></span>
   , <span class="methodparam"><span class="type">int</span> <code class="parameter">$mode</code></span>
   [, <span class="methodparam"><span class="type">int</span> <code class="parameter">$resumepos</code><span class="initializer"> = 0</span></span>
  ] )</div>

  <p class="para rdfs-comment">
   <span class="function"><strong>ftp_fget()</strong></span> は、FTP サーバーから
   <code class="parameter">remote_file</code> を取得し、指定したファイルポインタ
   <code class="parameter">fp</code> に書きこみます。
  </p>
 </div>

 <div class="refsect1 parameters" id="refsect1-function.ftp-fget-parameters">
  <h3 class="title">パラメータ</h3>
  <p class="para">
   <dl>

    
     <dt>
<code class="parameter">ftp_stream</code></dt>

     <dd>

      <p class="para">
       FTP 接続のリンク ID 。
      </p>
     </dd>

    
    
     <dt>
<code class="parameter">handle</code></dt>

     <dd>

      <p class="para">
       オープンされているファイルのポインタ。ここにデータが保存されます。
      </p>
     </dd>

    
    
     <dt>
<code class="parameter">remote_file</code></dt>

     <dd>

      <p class="para">
       リモートファイルのパス。
      </p>
     </dd>

    
    
     <dt>
<code class="parameter">mode</code></dt>

     <dd>

      <p class="para">
       転送モード。<strong><code>FTP_ASCII</code></strong> または
       <strong><code>FTP_BINARY</code></strong> のどちらかを指定する必要があります。
      </p>
     </dd>

    
    
     <dt>
<code class="parameter">resumepos</code></dt>

     <dd>

      <p class="para">
       リモートファイル中で、ダウンロードを開始する位置。
      </p>
     </dd>

    
   </dl>

  </p>
 </div>

 <div class="refsect1 returnvalues" id="refsect1-function.ftp-fget-returnvalues">
  <h3 class="title">返り値</h3>
  <p class="para">
   成功した場合に <strong><code>TRUE</code></strong> を、失敗した場合に <strong><code>FALSE</code></strong> を返します。
  </p>
 </div>

 <div class="refsect1 examples" id="refsect1-function.ftp-fget-examples">
  <h3 class="title">例</h3>
  <p class="para">
   <div class="example" id="example-4395">
    <p><strong>例1 <span class="function"><strong>ftp_fget()</strong></span> の例</strong></p>
    <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br /><br /></span><span style="color: #FF8000">//&nbsp;リモートファイルへのパス。<br /></span><span style="color: #0000BB">$remote_file&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #DD0000">'somefile.txt'</span><span style="color: #007700">;<br /></span><span style="color: #0000BB">$local_file&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #DD0000">'localfile.txt'</span><span style="color: #007700">;<br /><br /></span><span style="color: #FF8000">//&nbsp;書き込み用のファイルをオープンします。<br /></span><span style="color: #0000BB">$handle&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">fopen</span><span style="color: #007700">(</span><span style="color: #0000BB">$local_file</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">'w'</span><span style="color: #007700">);<br /><br /></span><span style="color: #FF8000">//&nbsp;接続を確立します。<br /></span><span style="color: #0000BB">$conn_id&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">ftp_connect</span><span style="color: #007700">(</span><span style="color: #0000BB">$ftp_server</span><span style="color: #007700">);<br /><br /></span><span style="color: #FF8000">//&nbsp;ユーザー名とパスワードを指定してログインします。<br /></span><span style="color: #0000BB">$login_result&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">ftp_login</span><span style="color: #007700">(</span><span style="color: #0000BB">$conn_id</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$ftp_user_name</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$ftp_user_pass</span><span style="color: #007700">);<br /><br /></span><span style="color: #FF8000">//&nbsp;$remote_file&nbsp;をダウンロードし、$handle&nbsp;に保存しようとします。<br /></span><span style="color: #007700">if&nbsp;(</span><span style="color: #0000BB">ftp_fget</span><span style="color: #007700">(</span><span style="color: #0000BB">$conn_id</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$handle</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$remote_file</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">FTP_ASCII</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">0</span><span style="color: #007700">))&nbsp;{<br />&nbsp;echo&nbsp;</span><span style="color: #DD0000">"</span><span style="color: #0000BB">$local_file</span><span style="color: #DD0000">&nbsp;への書き込みに成功しました\n"</span><span style="color: #007700">;<br />}&nbsp;else&nbsp;{<br />&nbsp;echo&nbsp;</span><span style="color: #DD0000">"</span><span style="color: #0000BB">$remote_file</span><span style="color: #DD0000">&nbsp;を&nbsp;</span><span style="color: #0000BB">$local_file</span><span style="color: #DD0000">&nbsp;にダウンロードする際に問題が発生しました\n"</span><span style="color: #007700">;<br />}<br /><br /></span><span style="color: #FF8000">//&nbsp;接続およびファイルハンドラを閉じます。<br /></span><span style="color: #0000BB">ftp_close</span><span style="color: #007700">(</span><span style="color: #0000BB">$conn_id</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">fclose</span><span style="color: #007700">(</span><span style="color: #0000BB">$handle</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
    </div>

   </div>
  </p>
 </div>

 <div class="refsect1 seealso" id="refsect1-function.ftp-fget-seealso">
  <h3 class="title">参考</h3>
  <p class="para">
   <ul class="simplelist">
    <li class="member"><span class="function"><a href="function.ftp-get.html" class="function" rel="rdfs-seeAlso">ftp_get()</a> - FTP サーバーからファイルをダウンロードする</span></li>
    <li class="member"><span class="function"><a href="function.ftp-nb-get.html" class="function" rel="rdfs-seeAlso">ftp_nb_get()</a> - FTP サーバーからファイルを取得し、ローカルファイルに書き込む（非ブロッキング）</span></li>
    <li class="member"><span class="function"><a href="function.ftp-nb-fget.html" class="function" rel="rdfs-seeAlso">ftp_nb_fget()</a> - FTP サーバーからファイルをダウンロードし、オープン中のファイルに保存する（非ブロッキング）</span></li>
   </ul>
  </p>
 </div>

</div><div id="usernotes">
 <div class="head">
  <h3 class="title">User Contributed Notes</h3>
 </div>
<div id="allnotes">  <a name="111548""></a>
  <div class="note">
   <strong class="user">mike at eastghost dot com</strong>
   <a href="#111548" class="date">03-Mar-2013 11:22</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
You might need to use ftp_pasv() if you're behind a firewall and receiving odd timeouts, file creation but now local data saving, etc.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="86107""></a>
  <div class="note">
   <strong class="user">broom at alturnanetworks dot com</strong>
   <a href="#86107" class="date">03-Oct-2008 01:49</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
<span class="default">&lt;?php
<br />
</span><span class="comment">/** 
<br />
&nbsp;* Function returns contents via FTP connection and returns it as string (right version...)
<br />
&nbsp;*/
<br />
</span><span class="keyword">function </span><span class="default">ftp_get_contents </span><span class="keyword">(</span><span class="default">$conn_id</span><span class="keyword">, </span><span class="default">$filename</span><span class="keyword">) {
<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">//Create temp handler:
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$tempHandle </span><span class="keyword">= </span><span class="default">fopen</span><span class="keyword">(</span><span class="string">'php://temp'</span><span class="keyword">, </span><span class="string">'r+'</span><span class="keyword">);
<br />
&nbsp;&nbsp;&nbsp; 
<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">//Get file from FTP:
<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">if (@</span><span class="default">ftp_fget</span><span class="keyword">(</span><span class="default">$conn_id</span><span class="keyword">, </span><span class="default">$tempHandle</span><span class="keyword">, </span><span class="default">$filename</span><span class="keyword">, </span><span class="default">FTP_ASCII</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">)) {
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">rewind</span><span class="keyword">(</span><span class="default">$tempHandle</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">stream_get_contents</span><span class="keyword">(</span><span class="default">$tempHandle</span><span class="keyword">);
<br />
&nbsp;&nbsp;&nbsp; } else {
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">false</span><span class="keyword">;
<br />
&nbsp;&nbsp;&nbsp; }
<br />
}
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="86106""></a>
  <div class="note">
   <strong class="user">broom at alturnanetworks dot com</strong>
   <a href="#86106" class="date">03-Oct-2008 01:18</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Another ftp_get_contents approach, using a temperary stream handler. Returns file contents as string. 
<br />

<br />
<span class="default">&lt;?php
<br />
</span><span class="keyword">function </span><span class="default">ftp_get_contents </span><span class="keyword">(</span><span class="default">$conn_id</span><span class="keyword">, </span><span class="default">$filename</span><span class="keyword">,
<br />
</span><span class="comment">//Create temp handler:
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$tempHandle </span><span class="keyword">= </span><span class="default">fopen</span><span class="keyword">(</span><span class="string">'php://temp'</span><span class="keyword">, </span><span class="string">'r+'</span><span class="keyword">);
<br />

<br />
</span><span class="comment">//Get file from FTP assuming that it exists:
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">ftp_fget</span><span class="keyword">(</span><span class="default">$conn_id</span><span class="keyword">, </span><span class="default">$tempHandle</span><span class="keyword">, </span><span class="default">$filename</span><span class="keyword">, </span><span class="default">FTP_ASCII</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">));
<br />

<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">//Getting detailed stats to check filesize:
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$fstats </span><span class="keyword">= </span><span class="default">fstat</span><span class="keyword">(</span><span class="default">$tempHandle</span><span class="keyword">);
<br />

<br />
&nbsp;&nbsp;&nbsp; return </span><span class="default">fread</span><span class="keyword">(</span><span class="default">$tempHandle</span><span class="keyword">, </span><span class="default">$fstats</span><span class="keyword">[</span><span class="string">'size'</span><span class="keyword">]);
<br />
}
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="80912""></a>
  <div class="note">
   <strong class="user">justrafi at gmail dot com</strong>
   <a href="#80912" class="date">06-Feb-2008 05:44</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I was in need to synchronize two folders on two separate servers, one is a Windows server, and the other is a Linux server. I created this short and sweet function to help me do this. PLEASE NOTICE: This will not copy folders, and probably will fail if remote folder contains anything else than files.<br />
<br />
function sync_folders($host, $port, $username, $password, $remote_dir, $local_dir, $passive_mode = true) {<br />
&nbsp;&nbsp;&nbsp; $conn_id = ftp_connect($host, $port);<br />
&nbsp;&nbsp;&nbsp; if (!$conn_id) return false; # fail to connect<br />
&nbsp;&nbsp;&nbsp; if (!ftp_login($conn_id, $username, $password)) { ftp_close($conn_id); return false; }&nbsp; # fail to login<br />
&nbsp;&nbsp;&nbsp; ftp_pasv($conn_id, $passive_mode);<br />
&nbsp;&nbsp;&nbsp; if (!ftp_chdir($conn_id, $remote_dir)) { ftp_close($conn_id); return false; } # fail to change dir<br />
&nbsp;&nbsp;&nbsp; if (substr($local_dir, -1) != '/') $local_dir .= '/';<br />
<br />
&nbsp;&nbsp;&nbsp; $list = ftp_nlist($conn_id, '.');<br />
&nbsp;&nbsp;&nbsp; sort($list);<br />
&nbsp;&nbsp;&nbsp; foreach ($list as $file) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if (!file_exists($local_dir . $file)) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $is_copied = ftp_get($conn_id, $local_dir . $file, $file, FTP_BINARY);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; ftp_close($conn_id);<br />
&nbsp;&nbsp;&nbsp; return true;<br />
}</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="24974""></a>
  <div class="note">
   <strong class="user">rodrigo-rocha at oi dot net dot br</strong>
   <a href="#24974" class="date">06-Sep-2002 04:56</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If you suply only a filename to the second parameter of function the ftp_get will open a pointer to the local file creating it and write to it.It's ok if your server dont execute for to mutch time and you dont get too many files but if you do it too many times the pointers created by ftp_get will not be closed and will end your opened files capacity at your server making it to do not open any more files until you restart it.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
</div>
</div>
</div></div></body></html>
