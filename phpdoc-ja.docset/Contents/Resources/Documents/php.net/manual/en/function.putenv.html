<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
 <head>
  <meta http-equiv="content-type" content="text/html; CHARSET=shift-jis">
  <title>環境変数の値を設定する</title>

  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <link media="all" rel="stylesheet" type="text/css" href="style.css"/>
 </head>
 <body class="docs" class="docs"><div class="navbar navbar-fixed-top">
  <div class="navbar-inner clearfix">
    <ul class="nav" style="width: 100%">
      <li style="float: left;"><a href="function.phpversion.html">≪ phpversion</a></li>
      <li style="float: right;"><a href="function.restore-include-path.html">restore_include_path ≫</a></li>
    </ul>
  </div>
</div>
<div id="breadcrumbs" class="clearfix">
  <ul class="breadcrumbs-container">
    <li><a href="index.html">PHP Manual</a></li>
    <li><a href="ref.info.html">PHP オプション/情報 関数</a></li>
    <li>環境変数の値を設定する</li>
  </ul>
</div>
<div id="layout">
  <div id="layout-content"><div id="function.putenv" class="refentry">
 <div class="refnamediv">
  <h1 class="refname">putenv</h1>
  <p class="verinfo">(PHP 4, PHP 5)</p><p class="refpurpose"><span class="refname">putenv</span> &mdash; <span class="dc-title">環境変数の値を設定する</span></p>

 </div>
 
 <div class="refsect1 description" id="refsect1-function.putenv-description">
  <h3 class="title">説明</h3>
  <div class="methodsynopsis dc-description">
   <span class="type">bool</span> <span class="methodname"><strong>putenv</strong></span>
    ( <span class="methodparam"><span class="type">string</span> <code class="parameter">$setting</code></span>
   )</div>

  <p class="para rdfs-comment">
   サーバーの環境変数に <code class="parameter">setting</code> を追加します。
   この環境変数は、カレントのリクエストを実行している間のみ存在します。
   リクエスト終了時、環境変数は元の状態に戻されます。
  </p>
  <p class="para">
   ある種の環境変数が変更されることは潜在的なセキュリティリスクとなる
   可能性があります。<em>safe_mode_allowed_env_vars</em> 
   ディレクティブには接頭辞のカンマ区切りのリストが含まれます。セーフ
   モードでは、ユーザーはこのディレクティブで指定された接頭辞で始まる名前
   を有する環境変数のみを変更可能となります。
   デフォルトでは、ユーザーは<em>PHP_</em> で始まる環境変数
   (例えば<em>PHP_FOO=BAR</em>)のみを変更可能です。注意:この
   ディレクティブが空の場合、PHPはユーザーに全ての環境変数を修正できる許可
   を与えてしまいます!
  </p>
  <p class="para">
   <em>safe_mode_protected_env_vars</em> ディレクティブには、
   カンマ区切りの環境変数のリストが含まれます。ユーザーは、この環境変数
   を<span class="function"><strong>putenv()</strong></span>により変更することができません。これら
   の変数は、<em>safe_mode_allowed_env_vars</em>が変更するこ
   とを許可している場合でも保護されます。
  </p>
 </div>


 <div class="refsect1 parameters" id="refsect1-function.putenv-parameters">
  <h3 class="title">パラメータ</h3>
  <p class="para">
   <dl>

    
     <dt>
<code class="parameter">setting</code></dt>

     <dd>

      <p class="para">
       <em>&quot;FOO=BAR&quot;</em> 形式の設定。
      </p>
     </dd>

    
   </dl>

  </p>
 </div>


 <div class="refsect1 returnvalues" id="refsect1-function.putenv-returnvalues">
  <h3 class="title">返り値</h3>
  <p class="para">
   成功した場合に <strong><code>TRUE</code></strong> を、失敗した場合に <strong><code>FALSE</code></strong> を返します。
  </p>
 </div>


 <div class="refsect1 examples" id="refsect1-function.putenv-examples">
  <h3 class="title">例</h3>
  <p class="para">
   <div class="example" id="example-535">
    <p><strong>例1 環境変数の設定</strong></p>
    <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br />putenv</span><span style="color: #007700">(</span><span style="color: #DD0000">"UNIQID=</span><span style="color: #0000BB">$uniqid</span><span style="color: #DD0000">"</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
    </div>

   </div>
  </p>
 </div>


 <div class="refsect1 notes" id="refsect1-function.putenv-notes">
  <h3 class="title">注意</h3>
  <div class="warning"><strong class="warning">警告</strong>
   <p class="para">
    <em>safe_mode_allowed_env_vars</em> ディレクティブおよび
    <em>safe_mode_protected_env_vars</em> ディレクティブは、
    <a href="features.safe-mode.html" class="link">セーフモード</a>
    が有効な場合にのみ効果があります!
   </p>
  </div>
 </div>


 <div class="refsect1 seealso" id="refsect1-function.putenv-seealso">
  <h3 class="title">参考</h3>
  <p class="para">
   <ul class="simplelist">
    <li class="member"><span class="function"><a href="function.getenv.html" class="function" rel="rdfs-seeAlso">getenv()</a> - 環境変数の値を取得する</span></li>
   </ul>
  </p>
 </div>


</div><div id="usernotes">
 <div class="head">
  <h3 class="title">User Contributed Notes</h3>
 </div>
<div id="allnotes">  <a name="108085""></a>
  <div class="note">
   <strong class="user">Anonymous Coder</strong>
   <a href="#108085" class="date">28-Mar-2012 03:28</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
It's the putenv() type of environment variables that get passed to a child process executed via exec().<br />
<br />
If you need to delete an existing environment variable so the child process does not see it, use:<br />
<br />
putenv('FOOBAR');<br />
<br />
That is, leave out both the "=" and a value.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="98540""></a>
  <div class="note">
   <strong class="user">php at keith tyler dot com</strong>
   <a href="#98540" class="date">22-Jun-2010 02:52</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
putenv/getenv, $_ENV, and phpinfo(INFO_ENVIRONMENT) are three completely distinct environment stores. doing putenv("x=y") does not affect $_ENV; but also doing $_ENV["x"]="y" likewise does not affect getenv("x"). And neither affect what is returned in phpinfo().<br />
<br />
Assuming the USER environment variable is defined as "dave" before running the following:<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">print </span><span class="string">"env is: "</span><span class="keyword">.</span><span class="default">$_ENV</span><span class="keyword">[</span><span class="string">"USER"</span><span class="keyword">].</span><span class="string">"\n"</span><span class="keyword">;<br />
print </span><span class="string">"(doing: putenv fred)\n"</span><span class="keyword">;<br />
</span><span class="default">putenv</span><span class="keyword">(</span><span class="string">"USER=fred"</span><span class="keyword">);<br />
print </span><span class="string">"env is: "</span><span class="keyword">.</span><span class="default">$_ENV</span><span class="keyword">[</span><span class="string">"USER"</span><span class="keyword">].</span><span class="string">"\n"</span><span class="keyword">;<br />
print </span><span class="string">"getenv is: "</span><span class="keyword">.</span><span class="default">getenv</span><span class="keyword">(</span><span class="string">"USER"</span><span class="keyword">).</span><span class="string">"\n"</span><span class="keyword">;<br />
print </span><span class="string">"(doing: set _env barney)\n"</span><span class="keyword">;<br />
</span><span class="default">$_ENV</span><span class="keyword">[</span><span class="string">"USER"</span><span class="keyword">]=</span><span class="string">"barney"</span><span class="keyword">;<br />
print </span><span class="string">"getenv is: "</span><span class="keyword">.</span><span class="default">getenv</span><span class="keyword">(</span><span class="string">"USER"</span><span class="keyword">).</span><span class="string">"\n"</span><span class="keyword">;<br />
print </span><span class="string">"env is: "</span><span class="keyword">.</span><span class="default">$_ENV</span><span class="keyword">[</span><span class="string">"USER"</span><span class="keyword">].</span><span class="string">"\n"</span><span class="keyword">;<br />
</span><span class="default">phpinfo</span><span class="keyword">(</span><span class="default">INFO_ENVIRONMENT</span><span class="keyword">);<br />
</span><span class="default">?&gt;<br />
</span><br />
prints:<br />
<br />
env is: dave<br />
(doing: putenv fred)<br />
env is: dave<br />
getenv is: fred<br />
(doing: set _env barney)<br />
getenv is: fred<br />
env is: barney<br />
phpinfo()<br />
<br />
Environment<br />
<br />
Variable =&gt; Value<br />
...<br />
USER =&gt; dave<br />
...</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="73308""></a>
  <div class="note">
   <strong class="user">JM</strong>
   <a href="#73308" class="date">17-Feb-2007 03:41</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
The other problem with the code from av01 at bugfix dot cc is that<br />
the behaviour is as per the comments here, not there:<br />
<span class="default">&lt;?php<br />
putenv</span><span class="keyword">(</span><span class="string">'MYVAR='</span><span class="keyword">); </span><span class="comment">// set MYVAR to an empty value.&nbsp; It is in the environment<br />
</span><span class="default">putenv</span><span class="keyword">(</span><span class="string">'MYVAR'</span><span class="keyword">); </span><span class="comment">// unset MYVAR.&nbsp; It is removed from the environment<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="49751""></a>
  <div class="note">
   <strong class="user">Iavor</strong>
   <a href="#49751" class="date">07-Feb-2005 11:06</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Compare to apache_setenv() and apache_getenv().<br />
<br />
I had a case setting an env var in VirtualHost which I tried to change with putenv() - but did not work.<br />
<br />
apache_setenv() worked.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="30774""></a>
  <div class="note">
   <strong class="user">cap at capsi dot com</strong>
   <a href="#30774" class="date">28-Mar-2003 07:18</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I've been using putenv with PHP 4.3.1 and Apache 2.0.44, but it does not seem to restore variables correctly. I'm getting +0100 and -0800 entries all across my Apache logs. Manually adding a putenv in page footers to restore the original value seems to fix things, but I still wish I could set the time zone for a specific request only.<br />
<br />
I'm not sure whether using putenv affects all threads within the process, that could be another problem.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="8496""></a>
  <div class="note">
   <strong class="user">david dot boyce at messagingdirect dot comnospam</strong>
   <a href="#8496" class="date">14-Sep-2000 07:23</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Environment variables are part of the underlying operating system's
<br />
way of doing things, and are used to pass information between a parent
<br />
process and its child, as well as to affect the way some internal
<br />
functions behave.&nbsp; They should not be regarded as ordinary PHP
<br />
variables.
<br />

<br />
A primary purpose of setting environment variables in a PHP script is
<br />
so that they are available to processes invoked by that script using
<br />
e.g. the system() function, and it's unlikely that they would need to
<br />
be changed for other reasons.
<br />

<br />
For example, if a particular system command required a special value
<br />
of the environment variable LD_LIBRARY_PATH to execute successfully,
<br />
then the following code might be used on a *NIX system:
<br />

<br />
<span class="default">&lt;?php
<br />
&nbsp;$saved </span><span class="keyword">= </span><span class="default">getenv</span><span class="keyword">(</span><span class="string">"LD_LIBRARY_PATH"</span><span class="keyword">);&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="comment">// save old value
<br />
&nbsp;</span><span class="default">$newld </span><span class="keyword">= </span><span class="string">"/extra/library/dir:/another/path/to/lib"</span><span class="keyword">;&nbsp; </span><span class="comment">// extra paths to add
<br />
&nbsp;</span><span class="keyword">if (</span><span class="default">$saved</span><span class="keyword">) { </span><span class="default">$newld </span><span class="keyword">.= </span><span class="string">":</span><span class="default">$saved</span><span class="string">"</span><span class="keyword">; }&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// append old paths if any
<br />
&nbsp;</span><span class="default">putenv</span><span class="keyword">(</span><span class="string">"LD_LIBRARY_PATH=</span><span class="default">$newld</span><span class="string">"</span><span class="keyword">);&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="comment">// set new value
<br />
&nbsp;</span><span class="default">system</span><span class="keyword">(</span><span class="string">"mycommand -with args"</span><span class="keyword">);&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="comment">// do system command; 
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; // mycommand is loaded using
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; // libs in the new path list
<br />
&nbsp;</span><span class="default">putenv</span><span class="keyword">(</span><span class="string">"LD_LIBRARY_PATH=</span><span class="default">$saved</span><span class="string">"</span><span class="keyword">);&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="comment">// restore old value
<br />
</span><span class="default">?&gt;
<br />
</span>
<br />
It will usually be appropriate to restore the old value after use;
<br />
LD_LIBRARY_PATH is a particularly good example of a variable which it
<br />
is important to restore immediately, as it is used by internal
<br />
functions.
<br />

<br />
If php.ini configuration allows, the values of environment variables
<br />
are made available as PHP global variables on entry to a script, but
<br />
these global variables are merely copies and do not track the actual
<br />
environment variables once the script is entered.&nbsp; Changing
<br />
$REMOTE_ADDR (or even $HTTP_ENV_VARS["REMOTE_ADDR"]) should not be
<br />
expected to affect the actual environment variable; this is why
<br />
putenv() is needed.
<br />

<br />
Finally, do not rely on environment variables maintaining the same
<br />
value from one script invocation to the next, especially if you have
<br />
used putenv().&nbsp; The result depends on many factors, such as CGI vs
<br />
apache module, and the exact way in which the environment is
<br />
manipulated before entering the script.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
</div>
</div>
</div></div></body></html>
