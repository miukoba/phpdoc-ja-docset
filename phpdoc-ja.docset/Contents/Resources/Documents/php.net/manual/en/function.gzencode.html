<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
 <head>
  <meta http-equiv="content-type" content="text/html; CHARSET=shift-jis">
  <title>gzip 圧縮された文字列を作成する</title>

  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <link media="all" rel="stylesheet" type="text/css" href="style.css"/>
 </head>
 <body class="docs" class="docs"><div class="navbar navbar-fixed-top">
  <div class="navbar-inner clearfix">
    <ul class="nav" style="width: 100%">
      <li style="float: left;"><a href="function.gzdeflate.html">≪ gzdeflate</a></li>
      <li style="float: right;"><a href="function.gzeof.html">gzeof ≫</a></li>
    </ul>
  </div>
</div>
<div id="breadcrumbs" class="clearfix">
  <ul class="breadcrumbs-container">
    <li><a href="index.html">PHP Manual</a></li>
    <li><a href="ref.zlib.html">Zlib 関数</a></li>
    <li>gzip 圧縮された文字列を作成する</li>
  </ul>
</div>
<div id="layout">
  <div id="layout-content"><div id="function.gzencode" class="refentry">
 <div class="refnamediv">
  <h1 class="refname">gzencode</h1>
  <p class="verinfo">(PHP 4 &gt;= 4.0.4, PHP 5)</p><p class="refpurpose"><span class="refname">gzencode</span> &mdash; <span class="dc-title">gzip 圧縮された文字列を作成する</span></p>

 </div>

 <div class="refsect1 description" id="refsect1-function.gzencode-description">
  <h3 class="title">説明</h3>
  <div class="methodsynopsis dc-description">
   <span class="type">string</span> <span class="methodname"><strong>gzencode</strong></span>
    ( <span class="methodparam"><span class="type">string</span> <code class="parameter">$data</code></span>
   [, <span class="methodparam"><span class="type">int</span> <code class="parameter">$level</code><span class="initializer"> = -1</span></span>
   [, <span class="methodparam"><span class="type">int</span> <code class="parameter">$encoding_mode</code><span class="initializer"> = FORCE_GZIP</span></span>
  ]] )</div>

  <p class="para rdfs-comment">
   この関数は、入力 <code class="parameter">data</code>を
   <strong class="command">gzip</strong> プログラムの出力と互換性のある形式で圧縮
   して返します。
  </p>
  <p class="para">
   GZIPファイルフォーマットに関する詳細な情報については、次のドキュ
   メントを参照ください。
   <a href="http://www.faqs.org/rfcs/rfc1952" class="link external" title="Link : http://www.faqs.org/rfcs/rfc1952">&raquo;&nbsp;GZIP file format specification
   version 4.3</a> (RFC 1952)
  </p>
 </div>


 <div class="refsect1 parameters" id="refsect1-function.gzencode-parameters">
  <h3 class="title">パラメータ</h3>
  <p class="para">
   <dl>

    
     <dt>
<code class="parameter">data</code></dt>

     <dd>

      <p class="para">
       エンコードするデータを指定します
      </p>
     </dd>

    
    
     <dt>
<code class="parameter">level</code></dt>

     <dd>

      <p class="para">
       圧縮レベルを指定します。
       圧縮をしない場合に 0、最大限の圧縮を行う場合に9を指定可能です。
       指定されない場合のデフォルト圧縮レベルは、
       zlib ライブラリのデフォルト圧縮レベルになります。
      </p>
     </dd>

    
    
     <dt>
<code class="parameter">encoding_mode</code></dt>

     <dd>

      <p class="para">
       エンコーディングモードを指定します。
       <strong><code>FORCE_GZIP</code></strong> (デフォルト) もしくは
       <strong><code>FORCE_DEFLATE</code></strong> を指定可能です。
      </p>
      <p class="para">
       PHP 5.4.0 より前のバージョンでは、<strong><code>FORCE_DEFLATE</code></strong>
       を使うと、gzip ファイルヘッダに続けて標準的な zlib 圧縮文字列
       (zlib ヘッダ込み) を出力していました。しかし、その後の crc32
       チェックサムはありませんでした。
      </p>
      <p class="para">
       PHP 5.4.0 以降は、<strong><code>FORCE_DEFLATE</code></strong> が
       RFC 1950 準拠の出力を生成するようになりました。zlib ヘッダ、圧縮したデータ、
       そして Adler チェックサムとなります。
      </p>
     </dd>

    
   </dl>

  </p>
 </div>


 <div class="refsect1 returnvalues" id="refsect1-function.gzencode-returnvalues">
  <h3 class="title">返り値</h3>
  <p class="para">
   エンコードされた文字列、もしくはエラー発生時に <strong><code>FALSE</code></strong>
  </p>
 </div>


 <div class="refsect1 changelog" id="refsect1-function.gzencode-changelog">
  <h3 class="title">変更履歴</h3>
  <p class="para">
   <table class="doctable informaltable">
    
     <thead>
      <tr>
       <th>バージョン</th>
       <th>説明</th>
      </tr>

     </thead>

     <tbody class="tbody">
      <tr>
       <td>5.4.0</td>
       <td>
        <strong><code>FORCE_DEFLATE</code></strong> が RFC 1950 準拠の出力を生成するようになりました。
        output.
       </td>
      </tr>

     </tbody>
    
   </table>

  </p>
 </div>


 <div class="refsect1 examples" id="refsect1-function.gzencode-examples">
  <h3 class="title">例</h3>
  <p class="para">
   結果データは標準的な .gz
   ファイルを構成するための適当なヘッダとデータ構造を含みます。
   <div class="example" id="example-850">
    <p><strong>例1 gzip ファイルの生成</strong></p>
    <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br />$data&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">implode</span><span style="color: #007700">(</span><span style="color: #DD0000">""</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">file</span><span style="color: #007700">(</span><span style="color: #DD0000">"bigfile.txt"</span><span style="color: #007700">));<br /></span><span style="color: #0000BB">$gzdata&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">gzencode</span><span style="color: #007700">(</span><span style="color: #0000BB">$data</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">9</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">$fp&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">fopen</span><span style="color: #007700">(</span><span style="color: #DD0000">"bigfile.txt.gz"</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">"w"</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">fwrite</span><span style="color: #007700">(</span><span style="color: #0000BB">$fp</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$gzdata</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">fclose</span><span style="color: #007700">(</span><span style="color: #0000BB">$fp</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
    </div>

   </div>
  </p>
 </div>


 <div class="refsect1 seealso" id="refsect1-function.gzencode-seealso">
  <h3 class="title">参考</h3>
  <p class="para">
   <ul class="simplelist">
    <li class="member"><span class="function"><a href="function.gzdecode.html" class="function" rel="rdfs-seeAlso">gzdecode()</a> - gzip 圧縮された文字列をデコードする</span></li>
    <li class="member"><span class="function"><a href="function.gzdeflate.html" class="function" rel="rdfs-seeAlso">gzdeflate()</a> - 文字列を deflate 圧縮する</span></li>
    <li class="member"><span class="function"><a href="function.gzinflate.html" class="function" rel="rdfs-seeAlso">gzinflate()</a> - deflate圧縮された文字列を解凍する</span></li>
    <li class="member"><span class="function"><a href="function.gzuncompress.html" class="function" rel="rdfs-seeAlso">gzuncompress()</a> - 圧縮された文字列を解凍する</span></li>
    <li class="member"><span class="function"><a href="function.gzcompress.html" class="function" rel="rdfs-seeAlso">gzcompress()</a> - 文字列を圧縮する</span></li>
    <li class="member">
     <a href="http://www.faqs.org/rfcs/rfc1950" class="link external" title="Link : http://www.faqs.org/rfcs/rfc1950">&raquo;&nbsp;
      ZLIB Compressed Data Format Specification (RFC 1950)
     </a>
    </li>
   </ul>
  </p>
 </div>


</div><div id="usernotes">
 <div class="head">
  <h3 class="title">User Contributed Notes</h3>
 </div>
<div id="allnotes">  <a name="105498""></a>
  <div class="note">
   <strong class="user">geompse at gmail dot com</strong>
   <a href="#105498" class="date">23-Aug-2011 12:24</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Had some trouble finding the correct way to send a Content-Length header with HTTP compression.<br />
The pitch is to use gzencode (not gzdeflaten not gzcompress).<br />
<br />
<span class="default">&lt;?php<br />
<br />
</span><span class="comment">// disable ZLIB ouput compression<br />
</span><span class="default">ini_set</span><span class="keyword">(</span><span class="string">'zlib.output_compression'</span><span class="keyword">,</span><span class="string">'Off'</span><span class="keyword">);<br />
<br />
</span><span class="comment">// compress data<br />
</span><span class="default">$gzipoutput </span><span class="keyword">= </span><span class="default">gzencode</span><span class="keyword">(</span><span class="default">$output</span><span class="keyword">,</span><span class="default">6</span><span class="keyword">);<br />
<br />
</span><span class="comment">// various headers, those with # are mandatory<br />
</span><span class="default">header</span><span class="keyword">(</span><span class="string">'Content-Type: application/x-download'</span><span class="keyword">);<br />
</span><span class="default">header</span><span class="keyword">(</span><span class="string">'Content-Encoding: gzip'</span><span class="keyword">); </span><span class="comment">#<br />
</span><span class="default">header</span><span class="keyword">(</span><span class="string">'Content-Length: '</span><span class="keyword">.</span><span class="default">strlen</span><span class="keyword">(</span><span class="default">$gzipoutput</span><span class="keyword">)); </span><span class="comment">#<br />
</span><span class="default">header</span><span class="keyword">(</span><span class="string">'Content-Disposition: attachment; filename="myfile.name"'</span><span class="keyword">);<br />
</span><span class="default">header</span><span class="keyword">(</span><span class="string">'Cache-Control: no-cache, no-store, max-age=0, must-revalidate'</span><span class="keyword">);<br />
</span><span class="default">header</span><span class="keyword">(</span><span class="string">'Pragma: no-cache'</span><span class="keyword">);<br />
<br />
</span><span class="comment">// output data<br />
</span><span class="keyword">echo </span><span class="default">$gzipoutput</span><span class="keyword">;<br />
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="104772""></a>
  <div class="note">
   <strong class="user">Sam Dowling</strong>
   <a href="#104772" class="date">06-Jul-2011 04:30</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
this is a benchmark test of gzencode (.txt file)<br />
----------------------------------------------<br />
original file size = 3.29 MB (3,459,978 bytes)<br />
compress lvl 1 = 1.09 MB (1,144,006 bytes)<br />
compress lvl 2 = 1.06 MB (1,119,518 bytes)<br />
compress lvl 3 = 1.03 MB (1,085,567 bytes)<br />
compress lvl 4 = 953 KB (976,538 bytes)<br />
compress lvl 5 = 909 KB (931,486 bytes)<br />
compress lvl 6 = 910 KB (932,516 bytes)<br />
compress lvl 7 = 910 KB (932,608 bytes)<br />
compress lvl 8 = 910 KB (932,646 bytes)<br />
compress lvl 9 = 910 KB (932,652 bytes)<br />
----------------------------------------------</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="88435""></a>
  <div class="note">
   <strong class="user">getmequick at dot com</strong>
   <a href="#88435" class="date">23-Jan-2009 09:29</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
NOTE:<br />
<br />
doing like this and so on<br />
<br />
<span class="default">&lt;?php<br />
&nbsp; file_put_contents</span><span class="keyword">(</span><span class="string">'output.gz'</span><span class="keyword">, </span><span class="default">gzencode</span><span class="keyword">( </span><span class="default">file_get_contents</span><span class="keyword">(</span><span class="string">'input.file'</span><span class="keyword">),</span><span class="default">9</span><span class="keyword">));<br />
</span><span class="default">?&gt;<br />
</span><br />
(complete file reading)<br />
<br />
may cause memory overflow (Fatal error: Allowed memory size of ..), so it's better to read by parts/bytes.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="82880""></a>
  <div class="note">
   <strong class="user">katzlbtjunk at hotmail dot com</strong>
   <a href="#82880" class="date">30-Apr-2008 10:58</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Aaron G. 07-Aug-2004 03:29 posted the excellent function gzdecode() (SEE BELOW)<br />
BUGFIX: Change: if($flags &amp; 1) to ... if($flags &amp; 2)<br />
<br />
Unfortunately the function gzencode() does NOT append a CRC! So the previous version worked with output of gzencode but not with output of the gzip program itself.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="82520""></a>
  <div class="note">
   <strong class="user">gazj at nukemodified dot com</strong>
   <a href="#82520" class="date">15-Apr-2008 02:47</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
here is my clean up of supaplex %at% pcbkits %d0t% c0m<br />
submission above.<br />
<br />
function alt_gzdecode($gzdatadecode) {<br />
&nbsp; // seed with microseconds since last "whole" second.<br />
&nbsp; mt_srand((float)microtime()*1000000);<br />
&nbsp; $eh="/tmp/php-" . md5(mt_rand(0,mt_getrandmax())) . ".gz";<br />
&nbsp; if(file_exists($eh)){<br />
<br />
&nbsp; $gzf=fopen($eh,"w");<br />
&nbsp; fwrite($gzf,$gzdatadecode);<br />
&nbsp; fclose($gzf);<br />
<br />
&nbsp; $gzf = gzopen ($eh, "r");<br />
&nbsp; $gzdatadecode=gzpassthru($gzf);<br />
&nbsp; unlink($eh);<br />
<br />
&nbsp; return $gzdatadecode;<br />
&nbsp; }else{<br />
&nbsp; return 'File '.$eh.' was not found.';<br />
&nbsp; }<br />
}</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="68632""></a>
  <div class="note">
   <strong class="user">cbrunon at free dot fr</strong>
   <a href="#68632" class="date">04-Aug-2006 03:52</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Correct is:<br />
<span class="default">&lt;?php<br />
&nbsp; file_put_contents</span><span class="keyword">(</span><span class="string">'output.gz'</span><span class="keyword">, </span><span class="default">gzencode</span><span class="keyword">( </span><span class="default">file_get_contents</span><span class="keyword">(</span><span class="string">'input.file'</span><span class="keyword">),</span><span class="default">9</span><span class="keyword">));<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="20411""></a>
  <div class="note">
   <strong class="user">tychay at alumni dot caltech dot edu</strong>
   <a href="#20411" class="date">03-Apr-2002 11:53</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
The 10 byte string in gzencode is the standard gzip header. The first two bytes (1f 8b) define the return as a gzip file, the third byte (08) means that the body is compressed using the "deflate" algorithm. The rest is padding (00)'s.<br />
<br />
Technically, I believe one should check if the third byte is hex 08 and if so strip off the first ten bytes and last four bytes and run inflate on it. The last four bytes are file size and checksum bits.<br />
<br />
In practice, you can get away with just stripping the first 10 bytes and running inflate on it.<br />
<br />
Hope this helps,<br />
<br />
terry</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="19074""></a>
  <div class="note">
   <strong class="user">henryk at ploetzli dot ch</strong>
   <a href="#19074" class="date">15-Feb-2002 03:28</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Well, I was looking for a gzdecode too and didn't consider the temporary file example above to be very elegant. <br />
However, as is noted in the very first comment: gzencode() only adds a&nbsp; 10 byte header. <br />
<br />
I don't quite know what this header is supposed to be used for, but gzinflate() certainly doesn't like it, so I stripped it off:<br />
<br />
function my_gzdecode($string) {<br />
&nbsp; $string = substr($string, 10);<br />
&nbsp; return gzinflate($string);<br />
&nbsp;}<br />
<br />
That's useful to read HTTP-Connections that were compressed by mod_gzip.<br />
-- <br />
Henryk Pl?tz<br />
Gr??e aus Berlin</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="15411""></a>
  <div class="note">
   <strong class="user">mm.. oops? - amendum (yes, tested hehe.)</strong>
   <a href="#15411" class="date">09-Sep-2001 09:14</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
function alt_gzdecode($str) {
<br />
&nbsp; // seed with microseconds since last "whole" second
<br />
&nbsp; mt_srand((float)microtime()*1000000);
<br />
&nbsp; $eh="/tmp/php-" . md5(mt_rand(0,mt_getrandmax())) . ".gz";
<br />

<br />
&nbsp; $fd=fopen($eh,"w");
<br />
&nbsp; fwrite($fd,$str);
<br />
&nbsp; fclose($fd);
<br />

<br />
&nbsp; unset($str);
<br />

<br />
&nbsp; $fd = gzopen ($eh, "r");
<br />
&nbsp; while (1==1) {
<br />
&nbsp;&nbsp;&nbsp; $s=gzread($fd,10240);
<br />
&nbsp;&nbsp;&nbsp; if ("$s" == "") {
<br />
&nbsp;&nbsp; &nbsp;&nbsp; break;
<br />
&nbsp;&nbsp;&nbsp; }
<br />
&nbsp;&nbsp;&nbsp; $str=$str . $s;
<br />
&nbsp; }
<br />
&nbsp; unlink($eh);
<br />

<br />
&nbsp; return $str;
<br />
}</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="15410""></a>
  <div class="note">
   <strong class="user">&lt; supaplex %at% pcbkits %d0t% c0m &gt;</strong>
   <a href="#15410" class="date">09-Sep-2001 08:48</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I was almost discouraged when I didn't find a gzdecode() function!&nbsp; However, fear not, for I'll contribute my work... :)
<br />
function alt_gzdecode($str) {
<br />
&nbsp; // seed with microseconds since last "whole" second.
<br />
&nbsp; mt_srand((float)microtime()*1000000);
<br />
&nbsp; $eh="/tmp/php-" . md5(mt_rand(0,mt_getrandmax())) . ".gz";
<br />

<br />

<br />
&nbsp; $fd=fopen($eh,"w");
<br />
&nbsp; fwrite($fd,$str);
<br />
&nbsp; fclose($fd);
<br />

<br />
&nbsp; $fd = gzopen ($eh, "r");
<br />
&nbsp; $str=gzpassthru($fd);
<br />
&nbsp; unlink($eh);
<br />

<br />
&nbsp; return $str;
<br />
}
<br />

<br />
It's only ugly point is that it does not check to see if the file already exists.&nbsp; You may also have to adjust reference names like $str and $fd if they stomp on your code. (Sorry, but this is all you get atm! ;} )&nbsp; If your conserned about a race condition, cry for a internal gzdecode() function that actualy functions...
<br />
I spent about 3 hours straight debugging this problem.&nbsp; I know the input data was valid, becuase I validated it with MD5() to compare to the md5's I had made of the input data before hand.&nbsp; I'm not sure whats up with gzuncompress or gzinflate, but this works in its place . . .
<br />

<br />
Enjoy!</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
</div>
</div>
</div></div></body></html>
