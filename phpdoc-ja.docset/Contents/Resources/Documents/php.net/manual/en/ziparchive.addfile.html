<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
 <head>
  <meta http-equiv="content-type" content="text/html; CHARSET=shift-jis">
  <title>指定したパスからファイルを ZIP アーカイブに追加する</title>

  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <link media="all" rel="stylesheet" type="text/css" href="style.css"/>
 </head>
 <body class="docs" class="docs"><div class="navbar navbar-fixed-top">
  <div class="navbar-inner clearfix">
    <ul class="nav" style="width: 100%">
      <li style="float: left;"><a href="ziparchive.addemptydir.html">≪ ZipArchive::addEmptyDir</a></li>
      <li style="float: right;"><a href="ziparchive.addfromstring.html">ZipArchive::addFromString ≫</a></li>
    </ul>
  </div>
</div>
<div id="breadcrumbs" class="clearfix">
  <ul class="breadcrumbs-container">
    <li><a href="index.html">PHP Manual</a></li>
    <li><a href="class.ziparchive.html">ZipArchive</a></li>
    <li>指定したパスからファイルを ZIP アーカイブに追加する</li>
  </ul>
</div>
<div id="layout">
  <div id="layout-content"><div id="ziparchive.addfile" class="refentry">
 <div class="refnamediv">
  <h1 class="refname">ZipArchive::addFile</h1>
  <p class="verinfo">(PHP 5 &gt;= 5.2.0, PECL zip &gt;= 1.1.0)</p><p class="refpurpose"><span class="refname">ZipArchive::addFile</span> &mdash; <span class="dc-title">指定したパスからファイルを ZIP アーカイブに追加する</span></p>

 </div>
 <div class="refsect1 description" id="refsect1-ziparchive.addfile-description">
  <h3 class="title">説明</h3>
  <div class="methodsynopsis dc-description">
   <span class="type">bool</span> <span class="methodname"><strong>ZipArchive::addFile</strong></span>
    ( <span class="methodparam"><span class="type">string</span> <code class="parameter">$filename</code></span>
   [, <span class="methodparam"><span class="type">string</span> <code class="parameter">$localname</code><span class="initializer"> = <strong><code>NULL</code></strong></span></span>
   [, <span class="methodparam"><span class="type">int</span> <code class="parameter">$start</code><span class="initializer"> = 0</span></span>
   [, <span class="methodparam"><span class="type">int</span> <code class="parameter">$length</code><span class="initializer"> = 0</span></span>
  ]]] )</div>

  <p class="para rdfs-comment">
   指定したパスから、ファイルを ZIP アーカイブに追加します。
  </p>
 </div>

 <div class="refsect1 parameters" id="refsect1-ziparchive.addfile-parameters">
  <h3 class="title">パラメータ</h3>
  <p class="para">
   <dl>

    
     <dt>
<code class="parameter">filename</code></dt>

     <dd>

      <p class="para">
       追加するファイルへのパス。
      </p>
     </dd>

    
    
     <dt>
<code class="parameter">localname</code></dt>

     <dd>

      <p class="para">
       指定した場合は ZIP アーカイブ内部での名前となり、<code class="parameter">filename</code> を上書きします。
      </p>
     </dd>

    
    
     <dt>
<code class="parameter">start</code></dt>

     <dd>

      <p class="para">
       このパラメータは使いませんが、<a href="class.ziparchive.html" class="classname">ZipArchive</a> を継承するためには必要です。
      </p>
     </dd>

    
    
     <dt>
<code class="parameter">length</code></dt>

     <dd>

      <p class="para">
       このパラメータは使いませんが、<a href="class.ziparchive.html" class="classname">ZipArchive</a> を継承するためには必要です。
      </p>
     </dd>

    
   </dl>

  </p>
 </div>

 <div class="refsect1 returnvalues" id="refsect1-ziparchive.addfile-returnvalues">
  <h3 class="title">返り値</h3>
  <p class="para">
   成功した場合に <strong><code>TRUE</code></strong> を、失敗した場合に <strong><code>FALSE</code></strong> を返します。
  </p>
 </div>

 <div class="refsect1 examples" id="refsect1-ziparchive.addfile-examples">
  <h3 class="title">例</h3>
    <p class="para">
     この例は、ZIP ファイルアーカイブ <var class="filename">test.zip</var>
     をオープンし、ファイル <var class="filename">/path/to/index.txt</var>
     を <var class="filename">newname.txt</var> という名前で追加します。
    </p>
    <div class="example" id="example-815">
     <p><strong>例1 オープンおよび追加</strong></p>
     <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br />$zip&nbsp;</span><span style="color: #007700">=&nbsp;new&nbsp;</span><span style="color: #0000BB">ZipArchive</span><span style="color: #007700">;<br />if&nbsp;(</span><span style="color: #0000BB">$zip</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">open</span><span style="color: #007700">(</span><span style="color: #DD0000">'test.zip'</span><span style="color: #007700">)&nbsp;===&nbsp;</span><span style="color: #0000BB">TRUE</span><span style="color: #007700">)&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$zip</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">addFile</span><span style="color: #007700">(</span><span style="color: #DD0000">'/path/to/index.txt'</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">'newname.txt'</span><span style="color: #007700">);<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$zip</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">close</span><span style="color: #007700">();<br />&nbsp;&nbsp;&nbsp;&nbsp;echo&nbsp;</span><span style="color: #DD0000">'成功'</span><span style="color: #007700">;<br />}&nbsp;else&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;echo&nbsp;</span><span style="color: #DD0000">'失敗'</span><span style="color: #007700">;<br />}<br /></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
     </div>

    </div>
   </div>

 <div class="refsect1 notes" id="refsect1-ziparchive.addfile-notes">
  <h3 class="title">注意</h3>
  <blockquote class="note"><p><strong class="note">注意</strong>: 
   <p class="para">
    アーカイブにファイルを追加するよう設定すると、PHP はそのファイルをロックします。
    ロックが解除されるのは、<span class="methodname"><a href="ziparchive.close.html" class="methodname">ZipArchive::close()</a></span> を呼ぶなり
    <a href="class.ziparchive.html" class="classname">ZipArchive</a> オブジェクトを破棄するなりして
    <a href="class.ziparchive.html" class="classname">ZipArchive</a> オブジェクトが閉じられたときだけです。
    そのため、追加しようとしているファイルがロックが解除される前に削除されるようなことは起こりません。
   </p>
  </p></blockquote>
 </div>

</div><div id="usernotes">
 <div class="head">
  <h3 class="title">User Contributed Notes</h3>
 </div>
<div id="allnotes">  <a name="115030""></a>
  <div class="note">
   <strong class="user">todd at toddwiggins dot com dot au</strong>
   <a href="#115030" class="date">15-May-2014 12:31</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
The addFile() method does not accept the "file://" protocol. Strip away "file://" and use the absolute path instead.<br />
<br />
I assume that it also does not accept any other protocols, I was having issues trying to add files, other functions within the application I was building required the use of the protocol.<br />
<br />
Also to note, the status code returned did not match any of the predefined error codes, and the status code was never the same. My assumption was a overflow on the variable as the status codes were around the minimum and maximum INT values.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="114840""></a>
  <div class="note">
   <strong class="user">frame86 at live dot com</strong>
   <a href="#114840" class="date">13-Apr-2014 01:48</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
The manual is lying.<br />
<br />
"In short, it means you can first delete an added file after the archive is closed. "<br />
<br />
Thats true but not by locking the file...<br />
Warning! This method works asynchronous! <br />
<br />
It seems that addFile() will return TRUE if the file stat command returns correctly, but the operation itself will not happen yet.<br />
<br />
Instead, deleting a file is always possible. I have discovered this behaviour by using a temporary file and deleting it immediately after addFile() returns. The result was that no archive was created nor any file was added although every operation (creating,open(),addFile()) returned true before. The operation silenty fails.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="114769""></a>
  <div class="note">
   <strong class="user">romuloum at hotmail dot com</strong>
   <a href="#114769" class="date">04-Apr-2014 04:00</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If you have problem with windows explorer reading zipfile created by linux, try:<br />
$oZip-&gt;addFile ( $file_name, " " . basename ( $file_name ) )<br />
That space " " should solve.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="113446""></a>
  <div class="note">
   <strong class="user">s dot eckert dot spam at gmx dot com</strong>
   <a href="#113446" class="date">12-Oct-2013 12:27</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Note that there is no concept of "folders" for ZIP files. If you need to store data into folders, use forward slashes ("/") in $localname to separate folder(s) and the file name.<br />
<br />
Example:<br />
$zip-&gt;addFile("test.txt", "mainfolder/subfolder/test.txt");</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="113097""></a>
  <div class="note">
   <strong class="user">arrtedone at gmail dot com</strong>
   <a href="#113097" class="date">29-Aug-2013 05:19</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Note that ZipArchive::open() not return boolean value, but integer, for example :<br />
$zip = new ZipArchive();<br />
$filename = '/tmp/test.zip';<br />
var_dum($zip-&gt;open($filename)); // return's : int (11)</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="112044""></a>
  <div class="note">
   <strong class="user">kris at blacksuitmedia [do/t/] c0m</strong>
   <a href="#112044" class="date">26-Apr-2013 05:41</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I had a huge number of files and folders that I needed to zip on a linux web server. I was running into timeout problems and file enumerator issues, as well as file handler limit issues (ulimit). I used a script to solve u limit offered by Farzad Ghanei first (ZipArchiveImproved), but closing and reopening his way didn't do the trick for me. <br />
<br />
I eventually did a simple call to a $filelimit variable I created that records file handler limit I want my script to hit before it closes and reopens the file. <br />
<span class="default">&lt;?php<br />
$filelimit </span><span class="keyword">= </span><span class="default">255</span><span class="keyword">;<br />
<br />
if (</span><span class="default">$zip</span><span class="keyword">-&gt;</span><span class="default">numFiles </span><span class="keyword">== </span><span class="default">$filelimit</span><span class="keyword">) {</span><span class="default">$zip</span><span class="keyword">-&gt;</span><span class="default">close</span><span class="keyword">(); </span><span class="default">$zip</span><span class="keyword">-&gt;</span><span class="default">open</span><span class="keyword">(</span><span class="default">$file</span><span class="keyword">) or die (</span><span class="string">"Error: Could not reopen Zip"</span><span class="keyword">);}<br />
</span><span class="default">?&gt;<br />
</span><br />
This made some progress for me, timeouts were gone, but when calling<br />
<span class="default">&lt;?php $zip</span><span class="keyword">-&gt;</span><span class="default">addFile</span><span class="keyword">(</span><span class="default">$filepath</span><span class="keyword">, </span><span class="default">$archivefilepath</span><span class="keyword">); </span><span class="default">?&gt;<br />
</span>after the reopening of the Zip, I got an error. I echoed the <span class="default">&lt;?php $zip</span><span class="keyword">-&gt;</span><span class="default">numFiles</span><span class="keyword">; </span><span class="default">?&gt;</span> and found that after reopening, the numFile enum reset to '0'. <br />
<br />
A few more goose-chases later, I tried addFromString with some better results, but did not get it working 100% until I actually coupled addFromString with addFile! My working scripting for the add files function on massive file-folder structures looks like so: <br />
<br />
<span class="default">&lt;?php <br />
$sourcefolder </span><span class="keyword">= /</span><span class="default">rel</span><span class="keyword">/</span><span class="default">path</span><span class="keyword">/</span><span class="default">to</span><span class="keyword">/</span><span class="default">source</span><span class="keyword">/</span><span class="default">folder</span><span class="keyword">/</span><span class="default">on</span><span class="keyword">/</span><span class="default">server</span><span class="keyword">/<br />
<br />
</span><span class="default">$dirlist </span><span class="keyword">= new </span><span class="default">RecursiveDirectoryIterator</span><span class="keyword">(</span><span class="default">$sourcefolder</span><span class="keyword">);<br />
<br />
</span><span class="default">$filelist </span><span class="keyword">= new </span><span class="default">RecursiveIteratorIterator</span><span class="keyword">(</span><span class="default">$dirlist</span><span class="keyword">);<br />
<br />
</span><span class="comment">//how many file can be added before a reopen is forced?<br />
</span><span class="default">$filelimit </span><span class="keyword">= </span><span class="default">245</span><span class="keyword">; <br />
<br />
</span><span class="comment">// Defines the action<br />
</span><span class="default">$file </span><span class="keyword">= </span><span class="default">tempnam</span><span class="keyword">(</span><span class="string">"tmp"</span><span class="keyword">, </span><span class="string">"zip"</span><span class="keyword">);<br />
</span><span class="default">$zip </span><span class="keyword">= new </span><span class="default">ZipArchive</span><span class="keyword">();<br />
<br />
</span><span class="comment">// This creates and then gives the option to save the zip file<br />
<br />
</span><span class="keyword">if (</span><span class="default">$zip</span><span class="keyword">-&gt;</span><span class="default">open</span><span class="keyword">(</span><span class="default">$file</span><span class="keyword">, </span><span class="default">ZipArchive</span><span class="keyword">::</span><span class="default">OVERWRITE</span><span class="keyword">) !== </span><span class="default">TRUE</span><span class="keyword">) {<br />
<br />
&nbsp;&nbsp;&nbsp; die (</span><span class="string">"Could not open archive"</span><span class="keyword">);<br />
<br />
}<br />
<br />
</span><span class="comment">// adds files to the file list<br />
</span><span class="keyword">foreach (</span><span class="default">$filelist </span><span class="keyword">as </span><span class="default">$key</span><span class="keyword">=&gt;</span><span class="default">$value</span><span class="keyword">) {<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">//fix archive paths<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$path </span><span class="keyword">= </span><span class="default">str_replace</span><span class="keyword">(</span><span class="default">$sourcefolder</span><span class="keyword">, </span><span class="string">""</span><span class="keyword">, </span><span class="default">$key</span><span class="keyword">); </span><span class="comment">//remove the source path from the $key to return only the file-folder structure from the root of the source folder<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">if (!</span><span class="default">file_exists</span><span class="keyword">(</span><span class="default">$key</span><span class="keyword">)) { die(</span><span class="default">$key</span><span class="keyword">.</span><span class="string">' does not exist. Please contact your administrator or try again later.'</span><span class="keyword">); }<br />
&nbsp;&nbsp; &nbsp;&nbsp; if (!</span><span class="default">is_readable</span><span class="keyword">(</span><span class="default">$key</span><span class="keyword">)) { die(</span><span class="default">$key</span><span class="keyword">.</span><span class="string">' not readable. Please contact your administrator or try again later.'</span><span class="keyword">); }&nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">$zip</span><span class="keyword">-&gt;</span><span class="default">numFiles </span><span class="keyword">== </span><span class="default">$filelimit</span><span class="keyword">) {</span><span class="default">$zip</span><span class="keyword">-&gt;</span><span class="default">close</span><span class="keyword">(); </span><span class="default">$zip</span><span class="keyword">-&gt;</span><span class="default">open</span><span class="keyword">(</span><span class="default">$file</span><span class="keyword">) or die (</span><span class="string">"Error: Could not reopen Zip"</span><span class="keyword">);}<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$zip</span><span class="keyword">-&gt;</span><span class="default">addFromString</span><span class="keyword">(</span><span class="default">$path</span><span class="keyword">, </span><span class="default">$key</span><span class="keyword">) or die (</span><span class="string">"ERROR: Could not add file: </span><span class="default">$key</span><span class="string"> &lt;/br&gt; numFile:"</span><span class="keyword">.</span><span class="default">$zip</span><span class="keyword">-&gt;</span><span class="default">numFiles</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$zip</span><span class="keyword">-&gt;</span><span class="default">addFile</span><span class="keyword">(</span><span class="default">realpath</span><span class="keyword">(</span><span class="default">$key</span><span class="keyword">), </span><span class="default">$path</span><span class="keyword">) or die (</span><span class="string">"ERROR: Could not add file: </span><span class="default">$key</span><span class="string"> &lt;/br&gt; numFile:"</span><span class="keyword">.</span><span class="default">$zip</span><span class="keyword">-&gt;</span><span class="default">numFiles</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; <br />
}<br />
<br />
</span><span class="comment">// closes the archive<br />
</span><span class="default">$zip</span><span class="keyword">-&gt;</span><span class="default">close</span><span class="keyword">();<br />
<br />
</span><span class="comment">//make local temp file a .zip, rename, and move to output dir<br />
</span><span class="default">rename </span><span class="keyword">(</span><span class="default">$file</span><span class="keyword">, </span><span class="string">"./" </span><span class="keyword">. </span><span class="default">$outputfolder </span><span class="keyword">. </span><span class="string">"/" </span><span class="keyword">. </span><span class="default">$zipfilename</span><span class="keyword">);<br />
</span><span class="default">?&gt;<br />
</span>I hope this may help someone else.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="110513""></a>
  <div class="note">
   <strong class="user">Dean Rather</strong>
   <a href="#110513" class="date">31-Oct-2012 12:47</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
This add directory function does not require that you create a new wrapper class, and also does not add the entire file directory tree into your zip file.<br />
<br />
<span class="default">&lt;?php<br />
<br />
</span><span class="keyword">public function </span><span class="default">addDirectoryToZip</span><span class="keyword">(</span><span class="default">$zip</span><span class="keyword">, </span><span class="default">$dir</span><span class="keyword">, </span><span class="default">$base</span><span class="keyword">)<br />
{<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$newFolder </span><span class="keyword">= </span><span class="default">str_replace</span><span class="keyword">(</span><span class="default">$base</span><span class="keyword">, </span><span class="string">''</span><span class="keyword">, </span><span class="default">$dir</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$zip</span><span class="keyword">-&gt;</span><span class="default">addEmptyDir</span><span class="keyword">(</span><span class="default">$newFolder</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; foreach(</span><span class="default">glob</span><span class="keyword">(</span><span class="default">$dir </span><span class="keyword">. </span><span class="string">'/*'</span><span class="keyword">) as </span><span class="default">$file</span><span class="keyword">)<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if(</span><span class="default">is_dir</span><span class="keyword">(</span><span class="default">$file</span><span class="keyword">))<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$zip </span><span class="keyword">= </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">addDirectoryToZip</span><span class="keyword">(</span><span class="default">$zip</span><span class="keyword">, </span><span class="default">$file</span><span class="keyword">, </span><span class="default">$base</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; else<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$newFile </span><span class="keyword">= </span><span class="default">str_replace</span><span class="keyword">(</span><span class="default">$base</span><span class="keyword">, </span><span class="string">''</span><span class="keyword">, </span><span class="default">$file</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$zip</span><span class="keyword">-&gt;</span><span class="default">addFile</span><span class="keyword">(</span><span class="default">$file</span><span class="keyword">, </span><span class="default">$newFile</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; return </span><span class="default">$zip</span><span class="keyword">;<br />
}<br />
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="108491""></a>
  <div class="note">
   <strong class="user">shano</strong>
   <a href="#108491" class="date">01-May-2012 11:21</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
thought it might come in handy<br />
recursively adds all directories and files within a directory<br />
<br />
class zip extends ZipArchive {<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; public function addDirectory($dir) { // adds directory<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; foreach(glob($dir . '/*') as $file) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if(is_dir($file))<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $this-&gt;addDirectory($file);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; else<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $this-&gt;addFile($file);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; }<br />
}</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="108193""></a>
  <div class="note">
   <strong class="user">ptipti at gala dot net</strong>
   <a href="#108193" class="date">06-Apr-2012 09:12</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Another surprise, which took a lot of trouble. So that after you add a file to the archive it can be safely removed, took advantage of such construction:<br />
<br />
if (!is_file ($archive)) :<br />
&nbsp;&nbsp;&nbsp; $result = $zip-&gt;open ($archive, ZipArchive::CREATE);<br />
else :<br />
&nbsp;&nbsp;&nbsp; $result = $zip-&gt;open ($archive);<br />
endif;<br />
if ($result === TRUE) :<br />
&nbsp;&nbsp;&nbsp; if (($zip-&gt;addFile ($file, $filename)) === TRUE) :<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $theoreticaly_added = TRUE;<br />
&nbsp;&nbsp;&nbsp; endif;<br />
&nbsp;&nbsp;&nbsp; if ((($zip-&gt;close ()) === TRUE) &amp;&amp; $theoreticaly_added) :<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; unlink ($file);<br />
&nbsp;&nbsp;&nbsp; endif;<br />
endif;<br />
<br />
Now the files will not disappear. But perhaps there is a simpler solution, which gives 100% guarantee?</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="107550""></a>
  <div class="note">
   <strong class="user">sp at read dot eu</strong>
   <a href="#107550" class="date">17-Feb-2012 05:25</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Note that using addFile() will change the order of the files within the zip, in fact within the index of the zip. Does not matter much, except if you loop the index and use addFile() within that loop : it will likely give messy results.<br />
<br />
Example : <br />
<span class="default">&lt;?php<br />
$zip </span><span class="keyword">= new </span><span class="default">ZipArchive</span><span class="keyword">;<br />
if (</span><span class="default">$zip</span><span class="keyword">-&gt;</span><span class="default">open</span><span class="keyword">(</span><span class="string">'somefile.zip'</span><span class="keyword">) === </span><span class="default">TRUE</span><span class="keyword">) {<br />
&nbsp; for (</span><span class="default">$i </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">; </span><span class="default">$i </span><span class="keyword">&lt; </span><span class="default">$zip</span><span class="keyword">-&gt;</span><span class="default">numFiles</span><span class="keyword">; </span><span class="default">$i</span><span class="keyword">++) { <br />
&nbsp;&nbsp;&nbsp; if (</span><span class="default">forsomereason</span><span class="keyword">()) { <br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="default">addFile</span><span class="keyword">(</span><span class="string">'./somenewfile.ext'</span><span class="keyword">, </span><span class="default">$zip</span><span class="keyword">-&gt;</span><span class="default">getNameIndex</span><span class="keyword">(</span><span class="default">$i</span><span class="keyword">));<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp; }<br />
}<br />
</span><span class="default">$zip</span><span class="keyword">-&gt;</span><span class="default">close</span><span class="keyword">();<br />
</span><span class="default">?&gt;<br />
</span><br />
This code may loop for ever, depending on your forsomereason() function, or at least you're at risk.<br />
<br />
Try something like this instead :<br />
<br />
<span class="default">&lt;?php<br />
$zip </span><span class="keyword">= new </span><span class="default">ZipArchive</span><span class="keyword">;<br />
if (</span><span class="default">$zip</span><span class="keyword">-&gt;</span><span class="default">open</span><span class="keyword">(</span><span class="string">'somefile.zip'</span><span class="keyword">) === </span><span class="default">TRUE</span><span class="keyword">) {<br />
&nbsp; for (</span><span class="default">$i </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">; </span><span class="default">$i </span><span class="keyword">&lt; </span><span class="default">$zip</span><span class="keyword">-&gt;</span><span class="default">numFiles</span><span class="keyword">; </span><span class="default">$i</span><span class="keyword">++) { <br />
&nbsp;&nbsp;&nbsp; if (</span><span class="default">forsomereason</span><span class="keyword">()) { <br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="default">$couples</span><span class="keyword">[]=array(</span><span class="string">'filename'</span><span class="keyword">=&gt;</span><span class="string">'./somenewfile.ext'</span><span class="keyword">,</span><span class="string">'localname'</span><span class="keyword">=&gt;</span><span class="default">$zip</span><span class="keyword">-&gt;</span><span class="default">getNameIndex</span><span class="keyword">(</span><span class="default">$i</span><span class="keyword">));<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp; }<br />
}<br />
foreach (</span><span class="default">$couples </span><span class="keyword">as </span><span class="default">$couple</span><span class="keyword">) </span><span class="default">$zip</span><span class="keyword">-&gt;</span><span class="default">addFile</span><span class="keyword">(</span><span class="default">$couple</span><span class="keyword">[</span><span class="string">'filename'</span><span class="keyword">],</span><span class="default">$couple</span><span class="keyword">[</span><span class="string">'localname'</span><span class="keyword">]);<br />
</span><span class="default">$zip</span><span class="keyword">-&gt;</span><span class="default">close</span><span class="keyword">();<br />
</span><span class="default">?&gt;<br />
</span><br />
Hope it helps ;-)</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="101605""></a>
  <div class="note">
   <strong class="user">john factorial</strong>
   <a href="#101605" class="date">29-Dec-2010 09:57</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Beware: calling $zip-&gt;addFile() on a file that doesn't exist will succeed and return TRUE, delaying the failure until you make the final $zip-&gt;close() call, which will return FALSE and potentially leave you scratching your head.<br />
<br />
If you're adding multiple files to a zip and your $zip-&gt;close() call is returning FALSE, ensure that all the files you added actually exist.<br />
<br />
It's also a good idea to check each file with file_exists() or is_readable() before calling $zip-&gt;addFile() on it.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="100755""></a>
  <div class="note">
   <strong class="user">aartdebruijn at gmail dot com</strong>
   <a href="#100755" class="date">04-Nov-2010 03:37</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
When adding a file to your zip, the file is opened and stays open.<br />
When adding over 1024 files (depending on your open files limit) the server stops adding files, resulting in a status 11 in your zip Archive. There is no warning when exceeding this open files limit with addFiles.<br />
<br />
Check your open files with ulimit -a<br />
<br />
This kept me busy for some time.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="97596""></a>
  <div class="note">
   <strong class="user">camuc at camuc dot net</strong>
   <a href="#97596" class="date">27-Apr-2010 05:23</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
In some versions of this library you NEED to add the "localfile" parameter or the file will not show in the Zip folder.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="97451""></a>
  <div class="note">
   <strong class="user">pelpet at ic dot cz</strong>
   <a href="#97451" class="date">20-Apr-2010 06:02</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
<span class="default">&lt;?php<br />
$zip</span><span class="keyword">=new </span><span class="default">ZipArchive</span><span class="keyword">;<br />
</span><span class="default">$zip</span><span class="keyword">-&gt;</span><span class="default">addFile</span><span class="keyword">(</span><span class="string">'path to the file'</span><span class="keyword">, </span><span class="string">'new name of the file'</span><span class="keyword">);<br />
</span><span class="default">?&gt;<br />
</span><br />
What I have to do, when I wan't to have the file in the zip archive with it's name before archiving?<br />
(Sorry, I'm from Czech Republic and I can't speak English very well, if I did anywhere mistake, so ignore that pease :-)</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="96382""></a>
  <div class="note">
   <strong class="user">jayarjo</strong>
   <a href="#96382" class="date">24-Feb-2010 10:44</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
It is not obvious, since there are no noticeable examples around, but you can use $localname (second parameter) to define and control file/directory structure inside the zip. Use it if you do not want files to be included with their absolute directory tree.
<br />

<br />
<span class="default">&lt;?php
<br />

<br />
$zip</span><span class="keyword">-&gt;</span><span class="default">addFile</span><span class="keyword">(</span><span class="default">$abs_path</span><span class="keyword">, </span><span class="default">$relative_path</span><span class="keyword">);
<br />

<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="95725""></a>
  <div class="note">
   <strong class="user">Anonymous</strong>
   <a href="#95725" class="date">18-Jan-2010 07:30</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
On my system (Windows), I found that ZipArchive uses IBM850 encoding for filenames (localname). For filenames with special characters such as (e) &amp;eacute; which appears at 0xE9 in the ISO-8859-1, it is at 0x82 in IBM850. I had to call iconv('ISO-8859-1', 'IBM850', 'Quebec') to get correct file names.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="93090""></a>
  <div class="note">
   <strong class="user">peter at boring dot ch</strong>
   <a href="#93090" class="date">22-Aug-2009 03:10</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Here's a little extension to ZipArchive that handles directories recursively:
<br />

<br />
<span class="default">&lt;?php
<br />

<br />
</span><span class="keyword">class </span><span class="default">Zipper </span><span class="keyword">extends </span><span class="default">ZipArchive </span><span class="keyword">{
<br />
&nbsp;&nbsp;&nbsp; 
<br />
public function </span><span class="default">addDir</span><span class="keyword">(</span><span class="default">$path</span><span class="keyword">) {
<br />
&nbsp;&nbsp;&nbsp; print </span><span class="string">'adding ' </span><span class="keyword">. </span><span class="default">$path </span><span class="keyword">. </span><span class="string">'&lt;br&gt;'</span><span class="keyword">;
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">addEmptyDir</span><span class="keyword">(</span><span class="default">$path</span><span class="keyword">);
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$nodes </span><span class="keyword">= </span><span class="default">glob</span><span class="keyword">(</span><span class="default">$path </span><span class="keyword">. </span><span class="string">'/*'</span><span class="keyword">);
<br />
&nbsp;&nbsp;&nbsp; foreach (</span><span class="default">$nodes </span><span class="keyword">as </span><span class="default">$node</span><span class="keyword">) {
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; print </span><span class="default">$node </span><span class="keyword">. </span><span class="string">'&lt;br&gt;'</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">is_dir</span><span class="keyword">(</span><span class="default">$node</span><span class="keyword">)) {
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">addDir</span><span class="keyword">(</span><span class="default">$node</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; } else if (</span><span class="default">is_file</span><span class="keyword">(</span><span class="default">$node</span><span class="keyword">))&nbsp; {
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">addFile</span><span class="keyword">(</span><span class="default">$node</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }
<br />
&nbsp;&nbsp;&nbsp; }
<br />
}
<br />
&nbsp;&nbsp;&nbsp; 
<br />
} </span><span class="comment">// class Zipper
<br />

<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="92835""></a>
  <div class="note">
   <strong class="user">christophe dot braud at aquafadas dot com</strong>
   <a href="#92835" class="date">11-Aug-2009 12:10</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If you have some warnings with ZipArchiveImproved since the last Ubuntu update, replace "self::CREATE" by "self::CREATE | self::OVERWRITE" in the reopen function<br />
<br />
christophe</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="89813""></a>
  <div class="note">
   <strong class="user">garcia at no_span dot krautzer-lynn dot com</strong>
   <a href="#89813" class="date">24-Mar-2009 03:31</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If you add files that have an absolut path, like for example:<br />
/mnt/repository/my_file.pdf<br />
the standard windows zip utility will not be able to extract the files. The first slash trips the zip utility. You have to add relative file paths or use a symbolic link.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="88600""></a>
  <div class="note">
   <strong class="user">ss at littlerain dot com</strong>
   <a href="#88600" class="date">31-Jan-2009 01:45</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Note that the file isn't actually added to the archive until the $zip-&gt;close() method is called. I spent a lot of time trying to figure out why no time() went by after adding large files via $zip-&gt;addFile() but would then time out the script.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="88266""></a>
  <div class="note">
   <strong class="user">Farzad Ghanei</strong>
   <a href="#88266" class="date">18-Jan-2009 11:53</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
here is a basic class that extends the ZipArchive to:<br />
&nbsp; * add a functionality to report the ZIP file address (I needed it and I could not find out how in ZipArchive documentation).<br />
&nbsp; * resolve the problem of adding so many files to the archive due file descriptor limit. the ZipArchiveImproved::addFile() handles this.<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="comment">/**<br />
&nbsp;* ZipArchiveImproved extends ZipArchive to add some information about the zip file and some functionality.<br />
&nbsp;* <br />
&nbsp;*<br />
&nbsp;*<br />
&nbsp;* @author Farzad Ghanei<br />
&nbsp;* @uses ZipArchive<br />
&nbsp;* @version 1.0.0 2009-01-18<br />
&nbsp;*/<br />
<br />
</span><span class="keyword">class </span><span class="default">ZipArchiveImproved </span><span class="keyword">extends </span><span class="default">ZipArchive </span><span class="keyword">{<br />
&nbsp;&nbsp;&nbsp; protected </span><span class="default">$_archiveFileName </span><span class="keyword">= </span><span class="default">null</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; protected </span><span class="default">$_newAddedFilesCounter </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; protected </span><span class="default">$_newAddedFilesSize </span><span class="keyword">= </span><span class="default">100</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">/**<br />
&nbsp;&nbsp; &nbsp; * returns the name of the archive file.<br />
&nbsp;&nbsp; &nbsp; *<br />
&nbsp;&nbsp; &nbsp; * @return string<br />
&nbsp;&nbsp; &nbsp; */<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">public function </span><span class="default">getArchiveFileName</span><span class="keyword">() {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">_archiveFileName</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">/**<br />
&nbsp;&nbsp; &nbsp; * returns the number of files that are going to be added to ZIP<br />
&nbsp;&nbsp; &nbsp; * without reopenning the stream to file.<br />
&nbsp;&nbsp; &nbsp; *<br />
&nbsp;&nbsp; &nbsp; * @return int<br />
&nbsp;&nbsp; &nbsp; */<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">public function </span><span class="default">getNewAddedFilesSize</span><span class="keyword">() {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">_newAddedFilesSize</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">/**<br />
&nbsp;&nbsp; &nbsp; * sets the number of files that are going to be added to ZIP<br />
&nbsp;&nbsp; &nbsp; * without reopenning the stream to file. if no size is specified, default is 100.<br />
&nbsp;&nbsp; &nbsp; *<br />
&nbsp;&nbsp; &nbsp; * @param int<br />
&nbsp;&nbsp; &nbsp; * @return ZipArchiveImproved self reference<br />
&nbsp;&nbsp; &nbsp; */<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">public function </span><span class="default">setNewlAddedFilesSize</span><span class="keyword">(</span><span class="default">$size</span><span class="keyword">=</span><span class="default">100</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if ( empty(</span><span class="default">$size</span><span class="keyword">) || !</span><span class="default">is_int</span><span class="keyword">(</span><span class="default">$size</span><span class="keyword">) || </span><span class="default">$size </span><span class="keyword">&lt; </span><span class="default">1</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$size </span><span class="keyword">= </span><span class="default">100</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">_newAddedFilesSize </span><span class="keyword">= </span><span class="default">$size</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">$this</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">/**<br />
&nbsp;&nbsp; &nbsp; * opens a stream to a ZIP archive file. calls the ZipArchive::open() internally.<br />
&nbsp;&nbsp; &nbsp; * overwrites ZipArchive::open() to add the archiveFileName functionality.<br />
&nbsp;&nbsp; &nbsp; *<br />
&nbsp;&nbsp; &nbsp; * @param string $fileName<br />
&nbsp;&nbsp; &nbsp; * @param int $flags<br />
&nbsp;&nbsp; &nbsp; * return mixed<br />
&nbsp;&nbsp; &nbsp; */<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">public function </span><span class="default">open</span><span class="keyword">(</span><span class="default">$fileName</span><span class="keyword">, </span><span class="default">$flags</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">_archiveFileName </span><span class="keyword">= </span><span class="default">$fileName</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">_newAddedFilesCounter </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">parent</span><span class="keyword">::</span><span class="default">open</span><span class="keyword">(</span><span class="default">$fileName</span><span class="keyword">,</span><span class="default">$flags</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">/**<br />
&nbsp;&nbsp; &nbsp; * closes the stream to ZIP archive file. calls the ZipArchive::close() internally.<br />
&nbsp;&nbsp; &nbsp; * overwrites ZipArchive::close() to add the archiveFileName functionality.<br />
&nbsp;&nbsp; &nbsp; *<br />
&nbsp;&nbsp; &nbsp; * @return bool<br />
&nbsp;&nbsp; &nbsp; */<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">public function </span><span class="default">close</span><span class="keyword">() {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">_archiveFileName </span><span class="keyword">= </span><span class="default">null</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">_newAddedFilesCounter </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">parent</span><span class="keyword">::</span><span class="default">close</span><span class="keyword">();<br />
&nbsp;&nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">/**<br />
&nbsp;&nbsp; &nbsp; * closes the connection to ZIP file and openes the connection again.<br />
&nbsp;&nbsp; &nbsp; *<br />
&nbsp;&nbsp; &nbsp; * @return bool<br />
&nbsp;&nbsp; &nbsp; */<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">public function </span><span class="default">reopen</span><span class="keyword">() {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$archiveFileName </span><span class="keyword">= </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">_archiveFileName</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if ( !</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">close</span><span class="keyword">() ) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">false</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">open</span><span class="keyword">(</span><span class="default">$archiveFileName</span><span class="keyword">,</span><span class="default">self</span><span class="keyword">::</span><span class="default">CREATE</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">/**<br />
&nbsp;&nbsp; &nbsp; * adds a file to a ZIP archive from the given path. calls the ZipArchive::addFile() internally.<br />
&nbsp;&nbsp; &nbsp; * overwrites ZipArchive::addFile() to handle maximum file connections in operating systems.<br />
&nbsp;&nbsp; &nbsp; *<br />
&nbsp;&nbsp; &nbsp; * @param string $fileName the path to file to be added to archive<br />
&nbsp;&nbsp; &nbsp; * @param string [optional] $localname the name of the file in the ZIP archive<br />
&nbsp;&nbsp; &nbsp; * @return bool<br />
&nbsp;&nbsp; &nbsp; */<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">public function </span><span class="default">addFile</span><span class="keyword">( </span><span class="default">$fileName </span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">_newAddedFilesCounter </span><span class="keyword">&gt;= </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">_newAddedFilesSize</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">reopen</span><span class="keyword">();<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if ( </span><span class="default">func_num_args</span><span class="keyword">() &gt; </span><span class="default">1 </span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$flags </span><span class="keyword">= </span><span class="default">func_get_arg</span><span class="keyword">(</span><span class="default">1</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$added </span><span class="keyword">= </span><span class="default">parent</span><span class="keyword">::</span><span class="default">addFile</span><span class="keyword">(</span><span class="default">$fileName</span><span class="keyword">,</span><span class="default">$flags</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">$added</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">_newAddedFilesCounter</span><span class="keyword">++;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">$added</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$added </span><span class="keyword">= </span><span class="default">parent</span><span class="keyword">::</span><span class="default">addFile</span><span class="keyword">(</span><span class="default">$fileName</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">$added</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">_newAddedFilesCounter</span><span class="keyword">++;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">$added</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; } </span><span class="comment">// public function addFile()<br />
</span><span class="keyword">}<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="87663""></a>
  <div class="note">
   <strong class="user">marco at maranao dot ca</strong>
   <a href="#87663" class="date">15-Dec-2008 07:45</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
This is my workaround for the file descriptor limit by closing/opening the archive file periodically.
<br />

<br />
<span class="default">&lt;?php
<br />
</span><span class="keyword">if(</span><span class="default">$backup </span><span class="keyword">= new </span><span class="default">ZipArchive</span><span class="keyword">()) {
<br />
&nbsp;&nbsp;&nbsp; if(</span><span class="default">$backup</span><span class="keyword">-&gt;</span><span class="default">open</span><span class="keyword">(</span><span class="default">$zip</span><span class="keyword">, </span><span class="default">ZIPARCHIVE</span><span class="keyword">::</span><span class="default">OVERWRITE</span><span class="keyword">) === </span><span class="default">true</span><span class="keyword">) {
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$backup</span><span class="keyword">-&gt;</span><span class="default">addFile</span><span class="keyword">(</span><span class="default">$file</span><span class="keyword">[</span><span class="string">'realpath'</span><span class="keyword">], </span><span class="default">$file</span><span class="keyword">[</span><span class="string">'path'</span><span class="keyword">]);
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if((</span><span class="default">$count</span><span class="keyword">++) == </span><span class="default">200</span><span class="keyword">) { </span><span class="comment">// the file descriptor limit
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$backup</span><span class="keyword">-&gt;</span><span class="default">close</span><span class="keyword">();
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if(</span><span class="default">$backup </span><span class="keyword">= new </span><span class="default">ZipArchive</span><span class="keyword">()) {
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$backup</span><span class="keyword">-&gt;</span><span class="default">open</span><span class="keyword">(</span><span class="default">$zip</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$count </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }
<br />
&nbsp;&nbsp;&nbsp; }
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$backup</span><span class="keyword">-&gt;</span><span class="default">close</span><span class="keyword">();
<br />
}
<br />
</span><span class="default">?&gt;
<br />
</span>
<br />
Hope it helps someone.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="84529""></a>
  <div class="note">
   <strong class="user">javierseixas at gmail dt com</strong>
   <a href="#84529" class="date">17-Jul-2008 05:30</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I have had several problems trying adding files, because of a path problem. The error gived was this:<br />
<br />
ZipArchive::addFile() [function.ZipArchive-addFile]: Unable to access &lt;path&gt;<br />
<br />
I used an absolute root starting by "/", and it didn't work. Try starting your path with "./" (referencing the root of your site).</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="84009""></a>
  <div class="note">
   <strong class="user">wacher at freemail dot hu</strong>
   <a href="#84009" class="date">23-Jun-2008 10:03</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
The workaround above (file_get_contents) is very dangerous if you pack large files. (see memory limit).<br />
Close/open the zip archive periodically instead of using file_get_contents().</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="83124""></a>
  <div class="note">
   <strong class="user">stanleyshilov {} gmail.com</strong>
   <a href="#83124" class="date">11-May-2008 09:05</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
It should be noted that the example provided above is not accurate.<br />
<br />
Unlike extractTo, zip_open does not return a boolean result, so the above example will always fail.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="80933""></a>
  <div class="note">
   <strong class="user">mike at thetroubleshooters dot dk</strong>
   <a href="#80933" class="date">07-Feb-2008 04:20</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
What is worse is that when you run out of filedescriptors it seems to fail silently, I have not been able to find any errors in any logfiles.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="74297""></a>
  <div class="note">
   <strong class="user">Andreas R. newsgroups2005 at geekmail de</strong>
   <a href="#74297" class="date">04-Apr-2007 03:29</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Currently the number of files that can be added using addFile to the ZIP archive (until it is closed) is limited by file descriptors limit. This is an easy workaround (on the bug links below you can find another workarounds):<br />
<span class="default">&lt;?php<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">/** work around file descriptor number limitation (to avoid failure<br />
&nbsp;&nbsp; &nbsp; * upon adding more than typically 253 or 1024 files to ZIP) */<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">function </span><span class="default">addFileToZip</span><span class="keyword">( </span><span class="default">$zip</span><span class="keyword">, </span><span class="default">$path</span><span class="keyword">, </span><span class="default">$zipEntryName </span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// this would fail with status ZIPARCHIVE::ER_OPEN<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; // after certain number of files is added since<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; // ZipArchive internally stores the file descriptors of all the<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; // added files and only on close writes the contents to the ZIP file<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; // see: <a href="http://bugs.php.net/bug.php?id=40494" rel="nofollow" target="_blank">http://bugs.php.net/bug.php?id=40494</a><br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; // and: <a href="http://pecl.php.net/bugs/bug.php?id=9443" rel="nofollow" target="_blank">http://pecl.php.net/bugs/bug.php?id=9443</a><br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; // return $zip-&gt;addFile( $path, $zipEntryName );<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$contents </span><span class="keyword">= </span><span class="default">file_get_contents</span><span class="keyword">( </span><span class="default">$path </span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if ( </span><span class="default">$contents </span><span class="keyword">=== </span><span class="default">false </span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">false</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">$zip</span><span class="keyword">-&gt;</span><span class="default">addFromString</span><span class="keyword">( </span><span class="default">$zipEntryName</span><span class="keyword">, </span><span class="default">$contents </span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; }<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
</div>
</div>
</div></div></body></html>
