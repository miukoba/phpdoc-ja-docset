<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
 <head>
  <meta http-equiv="content-type" content="text/html; CHARSET=shift-jis">
  <title>生の HTTP ヘッダを送信する</title>

  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <link media="all" rel="stylesheet" type="text/css" href="style.css"/>
 </head>
 <body class="docs" class="docs"><div class="navbar navbar-fixed-top">
  <div class="navbar-inner clearfix">
    <ul class="nav" style="width: 100%">
      <li style="float: left;"><a href="function.header-remove.html">≪ header_remove</a></li>
      <li style="float: right;"><a href="function.headers-list.html">headers_list ≫</a></li>
    </ul>
  </div>
</div>
<div id="breadcrumbs" class="clearfix">
  <ul class="breadcrumbs-container">
    <li><a href="index.html">PHP Manual</a></li>
    <li><a href="ref.network.html">ネットワーク 関数</a></li>
    <li>生の HTTP ヘッダを送信する</li>
  </ul>
</div>
<div id="layout">
  <div id="layout-content"><div id="function.header" class="refentry">
 <div class="refnamediv">
  <h1 class="refname">header</h1>
  <p class="verinfo">(PHP 4, PHP 5)</p><p class="refpurpose"><span class="refname">header</span> &mdash; <span class="dc-title">生の HTTP ヘッダを送信する</span></p>

 </div>
 
 <div class="refsect1 description" id="refsect1-function.header-description">
  <h3 class="title">説明</h3>
  <div class="methodsynopsis dc-description">
   <span class="type"><span class="type void">void</span></span> <span class="methodname"><strong>header</strong></span>
    ( <span class="methodparam"><span class="type">string</span> <code class="parameter">$string</code></span>
   [, <span class="methodparam"><span class="type">bool</span> <code class="parameter">$replace</code><span class="initializer"> = true</span></span>
   [, <span class="methodparam"><span class="type">int</span> <code class="parameter">$http_response_code</code></span>
  ]] )</div>

  <p class="para rdfs-comment">
   <span class="function"><strong>header()</strong></span> は、生の
   <acronym title="Hypertext Transfer Protocol">HTTP</acronym> ヘッダを送信するために使用されます。
   <acronym title="Hypertext Transfer Protocol">HTTP</acronym> ヘッダについての詳細な情報は
   <a href="http://www.faqs.org/rfcs/rfc2616" class="link external" title="Link : http://www.faqs.org/rfcs/rfc2616">&raquo;&nbsp;HTTP/1.1 仕様</a>
   を参照ください。
  </p>
  <p class="para">
   覚えておいて頂きたいのは、<span class="function"><strong>header()</strong></span> 関数は、
   通常の HTML タグまたは PHP からの出力にかかわらず、すべての実際の
   出力の前にコールする必要があることです。
   頻出するエラーとして、<span class="function"><a href="function.include.html" class="function">include</a></span>
   または <span class="function"><a href="function.require.html" class="function">require</a></span> 関数、他のファイルをアクセスする関数に
   空白または空行があり、<span class="function"><strong>header()</strong></span> の前に出力が
   行われてしまうというものがあります。同じ問題は、単一の PHP/HTML
   ファイルを使用している場合でも存在します。
   <div class="informalexample">
    <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
&lt;html&gt;<br /><span style="color: #0000BB">&lt;?php<br /></span><span style="color: #FF8000">/*&nbsp;これはエラーとなります。この上に出力があることに注目してください。<br />&nbsp;*&nbsp;それはheader()のコールより前であるということになります&nbsp;*/<br /></span><span style="color: #0000BB">header</span><span style="color: #007700">(</span><span style="color: #DD0000">'Location:&nbsp;http://www.example.com/'</span><span style="color: #007700">);<br />exit;<br /></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
    </div>

   </div>
  </p>
 </div>


 <div class="refsect1 parameters" id="refsect1-function.header-parameters">
  <h3 class="title">パラメータ</h3>
  <p class="para">
   <dl>

    
     <dt>
<code class="parameter">string</code></dt>

     <dd>

      <p class="para">
       ヘッダ文字列。
      </p>
      <p class="para">
       特殊な header コールが 2 種類あります。最初のものは、
       文字列 &quot;<em>HTTP/</em>&quot;
       から始まる全てのヘッダ (大文字・小文字は区別されません) です。
       このヘッダは、送信する HTTP ステータスコードを示すために使用されます。
       例えば、存在しないファイルへのリクエストを処理するためにある PHP
       スクリプトを使用するよう (<em>ErrorDocument</em>
       ディレクティブにより) Apache を設定する場合、
       そのスクリプトが正しいステータスコードを返すようにする必要があります。
      </p>
      <p class="para">
       <div class="informalexample">
        <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br />header</span><span style="color: #007700">(</span><span style="color: #DD0000">"HTTP/1.0&nbsp;404&nbsp;Not&nbsp;Found"</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
        </div>

       </div>
      </p>
      <p class="para">
       2 番目の特別なヘッダは、&quot;Location:&quot;
       ヘッダです。このヘッダがブラウザに返されるだけではなく、
       ブラウザに <em>REDIRECT</em> (302) ステータスコードを返します
       (<em>201</em> や <em>3xx</em>
       ステータスコードが既に送信されていない場合にのみ)。
      </p>
      <p class="para">
       <div class="informalexample">
        <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br />header</span><span style="color: #007700">(</span><span style="color: #DD0000">"Location:&nbsp;http://www.example.com/"</span><span style="color: #007700">);&nbsp;</span><span style="color: #FF8000">/*&nbsp;ブラウザをリダイレクトします&nbsp;*/<br /><br />/*&nbsp;リダイレクトする際に、これ以降のコードが実行されないことを確認してください&nbsp;*/<br /></span><span style="color: #007700">exit;<br /></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
        </div>

       </div>
      </p>
     </dd>

    
    
     <dt>
<code class="parameter">replace</code></dt>

     <dd>

      <p class="para">
       オプションのパラメータ <code class="parameter">replace</code> は、ヘッダが
       前に送信された類似のヘッダを置換するか、または、同じ形式の二番目の
       ヘッダを追加するかどうかを指定します。デフォルトでは、この関数は
       置換を行ないますが、二番目の引数に <strong><code>FALSE</code></strong> を指定すると、同じ型の
       複数のヘッダを強制的に生成します。例えば、
      </p>
      <p class="para">
       <div class="informalexample">
        <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br />header</span><span style="color: #007700">(</span><span style="color: #DD0000">'WWW-Authenticate:&nbsp;Negotiate'</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">header</span><span style="color: #007700">(</span><span style="color: #DD0000">'WWW-Authenticate:&nbsp;NTLM'</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">false</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
        </div>

       </div>
      </p>
     </dd>

    
    
     <dt>
<code class="parameter">http_response_code</code></dt>

     <dd>

      <p class="para">
       HTTP レスポンスコードを強制的に指定の値にします。このパラメータが意味をなすのは
       <code class="parameter">string</code> が空文字列でないときだけであることに注意しましょう。
      </p>
     </dd>

    
   </dl>

  </p>
 </div>


 <div class="refsect1 returnvalues" id="refsect1-function.header-returnvalues">
  <h3 class="title">返り値</h3>
  <p class="para">
   値を返しません。
  </p>
 </div>


 <div class="refsect1 changelog" id="refsect1-function.header-changelog">
  <h3 class="title">変更履歴</h3>
  <p class="para">
   <table class="doctable informaltable">
    
     <thead>
      <tr>
       <th>バージョン</th>
       <th>説明</th>
      </tr>

     </thead>

     <tbody class="tbody">
      <tr>
       <td>5.1.2</td>
       <td>
        この関数は一度に複数のヘッダを送信できないようになりました。
        これは、ヘッダインジェクション攻撃への対策です。
       </td>
      </tr>

     </tbody>
    
   </table>

  </p>
 </div>


 <div class="refsect1 examples" id="refsect1-function.header-examples">
  <h3 class="title">例</h3>
  <p class="para">
   <div class="example" id="example-4590">
    <p><strong>例1 ダウンロードダイアログ</strong></p>
    <div class="example-contents"><p>
     PDF ファイルを生成した場合など、
     それをダウンロードするかの確認ダイアログを表示させたいことがあるでしょう。
     そんな場合は、<a href="http://www.faqs.org/rfcs/rfc2183" class="link external" title="Link : http://www.faqs.org/rfcs/rfc2183">&raquo;&nbsp;Content-Disposition</a>
     ヘッダを使用してファイル名を指定すると、ブラウザ側でダイアログを表示させることができます。
    </p></div>
    <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br /></span><span style="color: #FF8000">//&nbsp;PDFを出力します<br /></span><span style="color: #0000BB">header</span><span style="color: #007700">(</span><span style="color: #DD0000">'Content-type:&nbsp;application/pdf'</span><span style="color: #007700">);<br /><br /></span><span style="color: #FF8000">//&nbsp;downloaded.pdf&nbsp;という名前で保存させます<br /></span><span style="color: #0000BB">header</span><span style="color: #007700">(</span><span style="color: #DD0000">'Content-Disposition:&nbsp;attachment;&nbsp;filename="downloaded.pdf"'</span><span style="color: #007700">);<br /><br /></span><span style="color: #FF8000">//&nbsp;もとの&nbsp;PDF&nbsp;ソースは&nbsp;original.pdf&nbsp;です<br /></span><span style="color: #0000BB">readfile</span><span style="color: #007700">(</span><span style="color: #DD0000">'original.pdf'</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
    </div>

   </div>
  </p>
  <p class="para">
   <div class="example" id="example-4591">
    <p><strong>例2 キャッシュディレクティブ</strong></p>
    <div class="example-contents"><p>
     PHP スクリプトはしばしば動的に HTML を生成するため、クライアント
     ブラウザやサーバーおよびクライアントブラウザの間でプロキシがキャッシュを
     行ったりするべきではありません。多くのプロキシとクライアントでは、
     以下のコードにより強制的にキャッシュを無効にできます。
    </p></div>
    <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br />header</span><span style="color: #007700">(</span><span style="color: #DD0000">"Cache-Control:&nbsp;no-cache,&nbsp;must-revalidate"</span><span style="color: #007700">);&nbsp;</span><span style="color: #FF8000">//&nbsp;HTTP/1.1<br /></span><span style="color: #0000BB">header</span><span style="color: #007700">(</span><span style="color: #DD0000">"Expires:&nbsp;Sat,&nbsp;26&nbsp;Jul&nbsp;1997&nbsp;05:00:00&nbsp;GMT"</span><span style="color: #007700">);&nbsp;</span><span style="color: #FF8000">//&nbsp;過去の日付<br /></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
    </div>

    <div class="example-contents"><p>
     <blockquote class="note"><p><strong class="note">注意</strong>: 
      <p class="para">
       上記のヘッダを全て出力しなかったとしてもページのキャッシュが
       行われない場合があることに気付くかもしれません。デフォルトの
       ブラウザのキャッシュの動作をユーザーが変更できる手段はいくつもあります。
       上記のヘッダを送信することにより、スクリプトの出力がキャッシュされる
       可能性がある設定を上書きするべきです。
      </p>
      <p class="para">
       さらに、<span class="function"><a href="function.session-cache-limiter.html" class="function">session_cache_limiter()</a></span> および
       設定 <em>session.cache_limiter</em> を用いると、
       セッションが使用された際にキャッシュ関係の正しいヘッダを
       自動的に生成させることもできます。
      </p>
     </p></blockquote>
    </p></div>
   </div>
  </p>
 </div>


 <div class="refsect1 notes" id="refsect1-function.header-notes">
  <h3 class="title">注意</h3>
  <blockquote class="note"><p><strong class="note">注意</strong>: 
   <p class="para">
    ヘッダにアクセスできたりヘッダを出力したりするのは、
    それに対応した SAPI を使っている場合のみです。
   </p>
  </p></blockquote>

  <blockquote class="note"><p><strong class="note">注意</strong>: 
   <p class="para">
    出力のバッファリングを使用してこの問題を回避することができます。
    この場合、ブラウザへの出力が送信するまでサーバーに
    全てバッファリングされるオーバーヘッドがあります。出力バッファリングは、
    <span class="function"><a href="function.ob-start.html" class="function">ob_start()</a></span> と
    <span class="function"><a href="function.ob-end-flush.html" class="function">ob_end_flush()</a></span> をスクリプトでコールするか
    <var class="filename">php.ini</var> またはサーバー設定ファイルの設定ディレクティブ
    <em>output_buffering</em> を設定することにより
    行うことが可能です。
   </p>
  </p></blockquote>
  <blockquote class="note"><p><strong class="note">注意</strong>: 
   <p class="para">
    実際に <span class="function"><strong>header()</strong></span> が最初にコールされたか
    どうかにかかわらず、HTTP ステータスヘッダ行は
    クライアントに対し常に最初に送信されます。
    HTTP ヘッダが既に送信されていない限り、
    <span class="function"><strong>header()</strong></span> をコールすることでステータスは
    常に上書きされます。
   </p>
  </p></blockquote>
  <blockquote class="note"><p><strong class="note">注意</strong>: 
   <p class="para">
    Microsoft Internet Explorer 4.01 にはバグがあり、
    この方法が動作しません。これを解決する方法はありません。
    同様に Microsoft Internet Explorer 5.5 にもこれを妨げるバグがあります。
    こちらは、サービスパック 2 以降にアップグレードすることで対応できます。
   </p>
  </p></blockquote>
  <blockquote class="note"><p><strong class="note">注意</strong>: 
   <span class="simpara">
    <a href="ini.sect.safe-mode.html#ini.safe-mode" class="link">セーフモード</a>が有効な場合は、
    <em>WWW-Authenticate</em> ヘッダ (HTTP 認証に使用する)
    を設定した際に、スクリプトの uid が <em>realm</em>
    部に追加されます。
   </span>
  </p></blockquote>
  <blockquote class="note"><p><strong class="note">注意</strong>: 
   <p class="para">
    HTTP/1.1 では、スキーム、ホスト名、絶対パスを含む絶対
    <acronym title="Uniform Resource Identifier">URI</acronym> が <a href="http://www.w3.org/Protocols/rfc2616/rfc2616-sec14.html#sec14.30" class="link external" title="Link : http://www.w3.org/Protocols/rfc2616/rfc2616-sec14.html#sec14.30">&raquo;&nbsp;Location:</a>
    の引数として必要ですが、相対 URI を受け付けるクライアントもあります。
    通常は、相対 URI から絶対 URI を作成するためには
    <var class="varname"><var class="varname"><a href="reserved.variables.server.html" class="classname">$_SERVER['HTTP_HOST']</a></var></var>、
    <var class="varname"><var class="varname"><a href="reserved.variables.server.html" class="classname">$_SERVER['PHP_SELF']</a></var></var> および
    <span class="function"><a href="function.dirname.html" class="function">dirname()</a></span> を使用できます。
    <div class="informalexample">
     <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br /></span><span style="color: #FF8000">/*&nbsp;カレントディレクトリの別のページにリダイレクトします&nbsp;*/<br /></span><span style="color: #0000BB">$host&nbsp;&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$_SERVER</span><span style="color: #007700">[</span><span style="color: #DD0000">'HTTP_HOST'</span><span style="color: #007700">];<br /></span><span style="color: #0000BB">$uri&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">rtrim</span><span style="color: #007700">(</span><span style="color: #0000BB">dirname</span><span style="color: #007700">(</span><span style="color: #0000BB">$_SERVER</span><span style="color: #007700">[</span><span style="color: #DD0000">'PHP_SELF'</span><span style="color: #007700">]),&nbsp;</span><span style="color: #DD0000">'/\\'</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">$extra&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #DD0000">'mypage.php'</span><span style="color: #007700">;<br /></span><span style="color: #0000BB">header</span><span style="color: #007700">(</span><span style="color: #DD0000">"Location:&nbsp;http://</span><span style="color: #0000BB">$host$uri</span><span style="color: #DD0000">/</span><span style="color: #0000BB">$extra</span><span style="color: #DD0000">"</span><span style="color: #007700">);<br />exit;<br /></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
     </div>

    </div>
   </p>
  </p></blockquote>
  <blockquote class="note"><p><strong class="note">注意</strong>: 
   <p class="para">
    <a href="session.configuration.html#ini.session.use-trans-sid" class="link">session.use_trans_sid</a>
    が有効であったとしても、セッション ID が Location ヘッダとともに
    渡されることはありません。<strong><code>SID</code></strong> 定数を使用して
    手動で渡す必要があります。
   </p>
  </p></blockquote>
 </div>


 <div class="refsect1 seealso" id="refsect1-function.header-seealso">
  <h3 class="title">参考</h3>
  <p class="para">
   <ul class="simplelist">
    <li class="member"><span class="function"><a href="function.headers-sent.html" class="function" rel="rdfs-seeAlso">headers_sent()</a> - ヘッダが既に送信されているかどうかを調べる</span></li>
    <li class="member"><span class="function"><a href="function.setcookie.html" class="function" rel="rdfs-seeAlso">setcookie()</a> - クッキーを送信する</span></li>
    <li class="member"><span class="function"><a href="function.http-response-code.html" class="function" rel="rdfs-seeAlso">http_response_code()</a> - HTTP レスポンスコードを取得または設定</span></li>
    <li class="member">
     <a href="features.http-auth.html" class="link">HTTP
     認証</a>
    </li>
   </ul>
  </p>
 </div>


</div><div id="usernotes">
 <div class="head">
  <h3 class="title">User Contributed Notes</h3>
 </div>
<div id="allnotes">  <a name="114979""></a>
  <div class="note">
   <strong class="user">Anonymous</strong>
   <a href="#114979" class="date">09-May-2014 01:57</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
This is a simple function that you can use in many places if you need redirections:<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">function </span><span class="default">redirect</span><span class="keyword">(</span><span class="default">$link</span><span class="keyword">=</span><span class="default">false</span><span class="keyword">){<br />
if(!empty(</span><span class="default">$link</span><span class="keyword">))<br />
&nbsp;&nbsp;&nbsp; if(!</span><span class="default">headers_sent</span><span class="keyword">())<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">header</span><span class="keyword">(</span><span class="string">'Location: '</span><span class="keyword">.</span><span class="default">trim</span><span class="keyword">(</span><span class="default">$link</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; else die(</span><span class="string">'ERROR: Header data not send! Redirecting page is impossible! Contact System Administrator!'</span><span class="keyword">);<br />
else return </span><span class="default">false</span><span class="keyword">;<br />
}<br />
<br />
</span><span class="comment">// EXAMPLE:<br />
</span><span class="default">redirect</span><span class="keyword">(</span><span class="string">"<a href="http://www.php.net" rel="nofollow" target="_blank">http://www.php.net</a>"</span><span class="keyword">)<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="108766""></a>
  <div class="note">
   <strong class="user">ben at indietorrent dot org</strong>
   <a href="#108766" class="date">24-May-2012 02:34</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Be aware that sending binary files to the user-agent (browser) over an encrypted connection (SSL/TLS) will fail in IE (Internet Explorer) versions 5, 6, 7, and 8 if any of the following headers is included:<br />
<br />
Cache-control:no-store<br />
Cache-control:no-cache<br />
<br />
See: <a href="http://support.microsoft.com/kb/323308" rel="nofollow" target="_blank">http://support.microsoft.com/kb/323308</a><br />
<br />
Workaround: do not send those headers.<br />
<br />
Also, be aware that IE versions 5, 6, 7, and 8 double-compress already-compressed files and do not reverse the process correctly, so ZIP files and similar are corrupted on download.<br />
<br />
Workaround: disable compression (beyond text/html) for these particular versions of IE, e.g., using Apache's "BrowserMatch" directive. The following example disables compression in all versions of IE:<br />
<br />
BrowserMatch ".*MSIE.*" gzip-only-text/html</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="102009""></a>
  <div class="note">
   <strong class="user">cedric at gn dot apc dot org</strong>
   <a href="#102009" class="date">22-Jan-2011 08:47</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Setting a Location header "returns a REDIRECT (302) status code to the browser unless the 201 or a 3xx status code has already been set".&nbsp; If you are sending a response to a POST request, you might want to look at RFC 2616 sections 10.3.3 and 10.3.4.&nbsp;&nbsp; It is suggested that if you want the browser to immediately GET the resource in the Location header in this circumstance, you should use a 303 status code not the 302 (with the same link as hypertext in the body for very old browsers).&nbsp; This may have (rare) consequences as mentioned in bug 42969.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="99190""></a>
  <div class="note">
   <strong class="user">Cody G.</strong>
   <a href="#99190" class="date">02-Aug-2010 06:53</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
After lots of research and testing, I'd like to share my findings about my problems with Internet Explorer and file downloads.<br />
<br />
&nbsp; Take a look at this code, which replicates the normal download of a Javascript:<br />
<br />
<span class="default">&lt;?php<br />
&nbsp;</span><span class="keyword">if(</span><span class="default">strstr</span><span class="keyword">(</span><span class="default">$_SERVER</span><span class="keyword">[</span><span class="string">"HTTP_USER_AGENT"</span><span class="keyword">],</span><span class="string">"MSIE"</span><span class="keyword">)==</span><span class="default">false</span><span class="keyword">) {<br />
&nbsp; </span><span class="default">header</span><span class="keyword">(</span><span class="string">"Content-type: text/javascript"</span><span class="keyword">);<br />
&nbsp; </span><span class="default">header</span><span class="keyword">(</span><span class="string">"Content-Disposition: inline; filename=\"download.js\""</span><span class="keyword">);<br />
&nbsp; </span><span class="default">header</span><span class="keyword">(</span><span class="string">"Content-Length: "</span><span class="keyword">.</span><span class="default">filesize</span><span class="keyword">(</span><span class="string">"my-file.js"</span><span class="keyword">));<br />
&nbsp;} else {<br />
&nbsp; </span><span class="default">header</span><span class="keyword">(</span><span class="string">"Content-type: application/force-download"</span><span class="keyword">);<br />
&nbsp; </span><span class="default">header</span><span class="keyword">(</span><span class="string">"Content-Disposition: attachment; filename=\"download.js\""</span><span class="keyword">);<br />
&nbsp; </span><span class="default">header</span><span class="keyword">(</span><span class="string">"Content-Length: "</span><span class="keyword">.</span><span class="default">filesize</span><span class="keyword">(</span><span class="string">"my-file.js"</span><span class="keyword">));<br />
&nbsp;}<br />
&nbsp;</span><span class="default">header</span><span class="keyword">(</span><span class="string">"Expires: Fri, 01 Jan 2010 05:00:00 GMT"</span><span class="keyword">);<br />
&nbsp;if(</span><span class="default">strstr</span><span class="keyword">(</span><span class="default">$_SERVER</span><span class="keyword">[</span><span class="string">"HTTP_USER_AGENT"</span><span class="keyword">],</span><span class="string">"MSIE"</span><span class="keyword">)==</span><span class="default">false</span><span class="keyword">) {<br />
&nbsp; </span><span class="default">header</span><span class="keyword">(</span><span class="string">"Cache-Control: no-cache"</span><span class="keyword">);<br />
&nbsp; </span><span class="default">header</span><span class="keyword">(</span><span class="string">"Pragma: no-cache"</span><span class="keyword">);<br />
&nbsp;}<br />
&nbsp;include(</span><span class="string">"my-file.js"</span><span class="keyword">);<br />
</span><span class="default">?&gt;<br />
</span><br />
Now let me explain:<br />
<br />
&nbsp; I start out by checking for IE, then if not IE, I set Content-type (case-sensitive) to JS and set Content-Disposition (every header is case-sensitive from now on) to inline, because most browsers outside of IE like to display JS inline. (User may change settings). The Content-Length header is required by some browsers to activate download box. Then, if it is IE, the "application/force-download" Content-type is sometimes required to show the download box. Use this if you don't want your PDF to display in the browser (in IE). I use it here to make sure the box opens. Anyway, I set the Content-Disposition to attachment because I already know that the box will appear. Then I have the Content-Length again.<br />
<br />
&nbsp; Now, here's my big point. I have the Cache-Control and Pragma headers sent only if not IE. THESE HEADERS WILL PREVENT DOWNLOAD ON IE!!! Only use the Expires header, after all, it will require the file to be downloaded again the next time. This is not a bug! IE stores downloads in the Temporary Internet Files folder until the download is complete. I know this because once I downloaded a huge file to My Documents, but the Download Dialog box put it in the Temp folder and moved it at the end. Just think about it. If IE requires the file to be downloaded to the Temp folder, setting the Cache-Control and Pragma headers will cause an error!<br />
<br />
I hope this saves someone some time!<br />
~Cody G.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="97114""></a>
  <div class="note">
   <strong class="user">Marcel G</strong>
   <a href="#97114" class="date">02-Apr-2010 03:37</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Several times this one is asked on the net but an answer could not be found in the docs on php.net ...
<br />

<br />
If you want to redirect an user and tell him he will be redirected, e. g. "You will be redirected in about 5 secs. If not, click here." you cannot use header( 'Location: ...' ) as you can't sent any output before the headers are sent.
<br />

<br />
So, either you have to use the HTML meta refresh thingy or you use the following:
<br />

<br />
<span class="default">&lt;?php
<br />
&nbsp; header</span><span class="keyword">( </span><span class="string">"refresh:5;url=wherever.php" </span><span class="keyword">);
<br />
&nbsp; echo </span><span class="string">'You\'ll be redirected in about 5 secs. If not, click &lt;a href="wherever.php"&gt;here&lt;/a&gt;.'</span><span class="keyword">;
<br />
</span><span class="default">?&gt;
<br />
</span>
<br />
Hth someone</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="96017""></a>
  <div class="note">
   <strong class="user">Refugnic</strong>
   <a href="#96017" class="date">03-Feb-2010 02:43</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
My files are in a compressed state (bz2). When the user clicks the link, I want them to get the uncompressed version of the file.<br />
<br />
After decompressing the file, I ran into the problem, that the download dialog would always pop up, even when I told the dialog to 'Always perform this operation with this file type'.<br />
<br />
As I found out, the problem was in the header directive 'Content-Disposition', namely the 'attachment' directive.<br />
<br />
If you want your browser to simulate a plain link to a file, either change 'attachment' to 'inline' or omit it alltogether and you'll be fine.<br />
<br />
This took me a while to figure out and I hope it will help someone else out there, who runs into the same problem.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="95864""></a>
  <div class="note">
   <strong class="user">this dot person at joaocunha dot eti dot br</strong>
   <a href="#95864" class="date">26-Jan-2010 07:39</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
AVOID ZERO BYTE ORDER MARK!<br />
<br />
Header MUST be sent before EVERYTHING in the page. Even a single space will break your script. In my case, there was BOM setted in the encoding, so I opened the file with notepad++ and set the encoding to UTF-8 (no BOM) and voila, everything is working great now.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="94118""></a>
  <div class="note">
   <strong class="user">dev at omikrosys dot com</strong>
   <a href="#94118" class="date">17-Oct-2009 07:45</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Just to inform you all, do not get confused between Content-Transfer-Encoding and Content-Encoding<br />
<br />
Content-Transfer-Encoding specifies the encoding used to transfer the data within the HTTP protocol, like raw binary or base64. (binary is more compact than base64. base64 having 33% overhead).<br />
Eg Use:- header('Content-Transfer-Encoding: binary');<br />
<br />
Content-Encoding is used to apply things like gzip compression to the content/data.<br />
Eg Use:- header('Content-Encoding: gzip');</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="94114""></a>
  <div class="note">
   <strong class="user">scott at lucentminds dot com</strong>
   <a href="#94114" class="date">17-Oct-2009 01:42</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If you want to remove a header and keep it from being sent as part of the header response, just provide nothing as the header value after the header name. For example...<br />
<br />
PHP, by default, always returns the following header:<br />
<br />
"Content-Type: text/html"<br />
<br />
Which your entire header response will look like<br />
<br />
HTTP/1.1 200 OK<br />
Server: Apache/2.2.11 (Unix)<br />
X-Powered-By: PHP/5.2.8<br />
Date: Fri, 16 Oct 2009 23:05:07 GMT<br />
Content-Type: text/html; CHARSET=shift-jis<br />
Connection: close<br />
<br />
If you call the header name with no value like so...<br />
<br />
<span class="default">&lt;?php<br />
<br />
&nbsp;&nbsp;&nbsp; header</span><span class="keyword">( </span><span class="string">'Content-Type:' </span><span class="keyword">);<br />
<br />
</span><span class="default">?&gt;<br />
</span><br />
Your headers now look like this:<br />
<br />
HTTP/1.1 200 OK<br />
Server: Apache/2.2.11 (Unix)<br />
X-Powered-By: PHP/5.2.8<br />
Date: Fri, 16 Oct 2009 23:05:07 GMT<br />
Connection: close</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="92620""></a>
  <div class="note">
   <strong class="user">Anonymous</strong>
   <a href="#92620" class="date">31-Jul-2009 05:02</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I just want to add, becuase I see here lots of wrong formated headers.
<br />

<br />
1. All used headers have first letters uppercase, so you MUST follow this. For example:
<br />

<br />
Location, not location
<br />
Content-Type, not content-type, nor CONTENT-TYPE
<br />

<br />
2. Then there MUST be colon and space, like
<br />

<br />
good: header("Content-Type: text/plain");
<br />
wrong: header("Content-Type:text/plain");
<br />

<br />
3. Location header MUST be absolute uri with scheme, domain, port, path, etc.
<br />

<br />
good: header("Location: <a href="http://www.example.com/something.php?a=1" rel="nofollow" target="_blank">http://www.example.com/something.php?a=1</a>");
<br />

<br />
4. Relative URIs are NOT allowed
<br />

<br />
wrong:&nbsp; Location: /something.php?a=1
<br />
wrong:&nbsp; Location: ?a=1
<br />

<br />
It will make proxy server and http clients happier.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="92305""></a>
  <div class="note">
   <strong class="user">mjt at jpeto dot net</strong>
   <a href="#92305" class="date">18-Jul-2009 08:01</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I strongly recommend, that you use
<br />

<br />
header($_SERVER["SERVER_PROTOCOL"]." 404 Not Found");
<br />

<br />
instead of 
<br />

<br />
header("HTTP/1.1 404 Not Found");
<br />

<br />
I had big troubles with an Apache/2.0.59 (Unix) answering in HTTP/1.0 while I (accidentially) added a "HTTP/1.1 200 Ok" - Header.
<br />

<br />
Most of the pages were displayed correct, but on some of them apache added weird content to it:
<br />

<br />
A 4-digits HexCode on top of the page (before any output of my php script), seems to be some kind of checksum, because it changes from page to page and browser to browser. (same code for same page and browser)
<br />

<br />
"0" at the bottom of the page (after the complete output of my php script) 
<br />

<br />
It took me quite a while to find out about the wrong protocol in the HTTP-header.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="89452""></a>
  <div class="note">
   <strong class="user">Jamesb</strong>
   <a href="#89452" class="date">08-Mar-2009 02:25</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Here is a php script I wrote to stream a file and crypt it with a xor operation on the bytes and with a key :
<br />

<br />
The encryption works very good but the speed is decrease by 2, it is now 520KiB/s. The user is now asked for a md5 password (instead of keeping it in the code directly). There is some part in French because it's my native language so modify it as you want.
<br />

<br />
<span class="default">&lt;?php
<br />
</span><span class="comment">// Stream files and encrypt the data on-the-fly
<br />

<br />
// Settings
<br />
// -- File to stream
<br />
</span><span class="default">$file </span><span class="keyword">= </span><span class="string">"FILE_out"</span><span class="keyword">;
<br />
</span><span class="comment">// -- Reading buffer
<br />
</span><span class="default">$bufferlength </span><span class="keyword">= </span><span class="default">3840</span><span class="keyword">;
<br />
</span><span class="comment">// -- Key in hex
<br />
//$keychar = "9cdfb439c7876e703e307864c9167a15";
<br />

<br />
// Function: Convertion hex key in a string into binary
<br />
</span><span class="keyword">function </span><span class="default">hex2bin</span><span class="keyword">(</span><span class="default">$h</span><span class="keyword">) {
<br />
&nbsp;&nbsp;&nbsp; if (!</span><span class="default">is_string</span><span class="keyword">(</span><span class="default">$h</span><span class="keyword">)) return </span><span class="default">null</span><span class="keyword">;
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$r </span><span class="keyword">= array();
<br />
&nbsp;&nbsp;&nbsp; for (</span><span class="default">$a</span><span class="keyword">=</span><span class="default">0</span><span class="keyword">; (</span><span class="default">$a</span><span class="keyword">*</span><span class="default">2</span><span class="keyword">)&lt;</span><span class="default">strlen</span><span class="keyword">(</span><span class="default">$h</span><span class="keyword">); </span><span class="default">$a</span><span class="keyword">++) {
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$ta </span><span class="keyword">= </span><span class="default">hexdec</span><span class="keyword">(</span><span class="default">$h</span><span class="keyword">[</span><span class="default">2</span><span class="keyword">*</span><span class="default">$a</span><span class="keyword">]);
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$tb </span><span class="keyword">= </span><span class="default">hexdec</span><span class="keyword">(</span><span class="default">$h</span><span class="keyword">[(</span><span class="default">2</span><span class="keyword">*</span><span class="default">$a</span><span class="keyword">+</span><span class="default">1</span><span class="keyword">)]);
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$r</span><span class="keyword">[</span><span class="default">$a</span><span class="keyword">] = (int) ((</span><span class="default">$ta </span><span class="keyword">&lt;&lt; </span><span class="default">4</span><span class="keyword">) + </span><span class="default">$tb</span><span class="keyword">);
<br />
&nbsp;&nbsp;&nbsp; }
<br />
&nbsp;&nbsp;&nbsp; return </span><span class="default">$r</span><span class="keyword">;
<br />
}
<br />

<br />
</span><span class="comment">// Function to send the auth headers
<br />
</span><span class="keyword">function </span><span class="default">askPassword</span><span class="keyword">(</span><span class="default">$text</span><span class="keyword">=</span><span class="string">"Enter the password"</span><span class="keyword">) {
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">header</span><span class="keyword">(</span><span class="string">'WWW-Authenticate: Basic realm="'</span><span class="keyword">. </span><span class="default">utf8_decode</span><span class="keyword">(</span><span class="default">$text</span><span class="keyword">) .</span><span class="string">'"'</span><span class="keyword">);
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">header</span><span class="keyword">(</span><span class="string">'HTTP/1.0 401 Unauthorized'</span><span class="keyword">);
<br />
&nbsp;&nbsp;&nbsp; return </span><span class="default">1</span><span class="keyword">;
<br />
}
<br />

<br />
</span><span class="comment">// Key is asked at the first start
<br />
</span><span class="keyword">if (!isset(</span><span class="default">$_SERVER</span><span class="keyword">[</span><span class="string">'PHP_AUTH_PW'</span><span class="keyword">])) {
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">askPassword</span><span class="keyword">();
<br />
&nbsp;&nbsp;&nbsp; echo </span><span class="string">"Une cle est necessaire !&lt;br /&gt;"</span><span class="keyword">;
<br />
&nbsp;&nbsp;&nbsp; exit;
<br />
}
<br />
</span><span class="comment">// Get the key in hex
<br />
</span><span class="default">$keychar </span><span class="keyword">= </span><span class="default">$_SERVER</span><span class="keyword">[</span><span class="string">'PHP_AUTH_PW'</span><span class="keyword">];
<br />

<br />
</span><span class="comment">// Convert key and set the size of the key
<br />
</span><span class="default">$key </span><span class="keyword">= </span><span class="default">hex2bin</span><span class="keyword">(</span><span class="default">$keychar</span><span class="keyword">);
<br />
</span><span class="default">$keylength </span><span class="keyword">= </span><span class="default">count</span><span class="keyword">(</span><span class="default">$key</span><span class="keyword">);
<br />
</span><span class="comment">// Teste si la cle est valide en hex
<br />
</span><span class="keyword">if (</span><span class="default">$key </span><span class="keyword">== </span><span class="string">"" </span><span class="keyword">|| </span><span class="default">$keylength </span><span class="keyword">&lt;= </span><span class="default">4</span><span class="keyword">) {
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">askPassword</span><span class="keyword">(</span><span class="string">"Cle incorrecte !"</span><span class="keyword">);
<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">//echo "Cle incorrecte !&lt;br /&gt;";
<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">exit();
<br />
}
<br />
</span><span class="comment">// Teste si la cle est de longueur d'une puissance de 2
<br />
</span><span class="keyword">if ( (</span><span class="default">$keylength</span><span class="keyword">%</span><span class="default">2</span><span class="keyword">) != </span><span class="default">0</span><span class="keyword">) {
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">askPassword</span><span class="keyword">(</span><span class="string">"Cle de longueur incorrecte (multiple de 2 uniquement)"</span><span class="keyword">);
<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">//echo "Cle de longueur incorrecte (puissance de 2 uniquement)&lt;br /&gt;";
<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">exit();
<br />
}
<br />

<br />
</span><span class="comment">// Headers
<br />
</span><span class="default">header</span><span class="keyword">(</span><span class="string">"Content-Type: application/octet-stream; "</span><span class="keyword">);
<br />
</span><span class="default">header</span><span class="keyword">(</span><span class="string">"Content-Transfer-Encoding: binary"</span><span class="keyword">);
<br />
</span><span class="default">header</span><span class="keyword">(</span><span class="string">"Content-Length: " </span><span class="keyword">. </span><span class="default">filesize</span><span class="keyword">(</span><span class="default">$file</span><span class="keyword">) .</span><span class="string">"; "</span><span class="keyword">);
<br />
</span><span class="default">header</span><span class="keyword">(</span><span class="string">"filename=\""</span><span class="keyword">.</span><span class="default">$file</span><span class="keyword">.</span><span class="string">"\"; "</span><span class="keyword">);
<br />
</span><span class="default">flush</span><span class="keyword">(); </span><span class="comment">// this doesn't really matter.
<br />

<br />
// Opening the file in read-only
<br />
</span><span class="default">$fp </span><span class="keyword">= </span><span class="default">fopen</span><span class="keyword">(</span><span class="default">$file</span><span class="keyword">, </span><span class="string">"r"</span><span class="keyword">);
<br />
while (!</span><span class="default">feof</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">))
<br />
{
<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">// Read a buffer size of the file
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$buffer </span><span class="keyword">= </span><span class="default">fread</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">, </span><span class="default">$bufferlength</span><span class="keyword">);
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$j</span><span class="keyword">=</span><span class="default">0</span><span class="keyword">;
<br />
&nbsp;&nbsp;&nbsp; for (</span><span class="default">$i</span><span class="keyword">=</span><span class="default">0</span><span class="keyword">; </span><span class="default">$i </span><span class="keyword">&lt; </span><span class="default">$bufferlength</span><span class="keyword">; </span><span class="default">$i</span><span class="keyword">++) {
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// The key is read in loop to crypt the whole file
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">if (</span><span class="default">$i</span><span class="keyword">%</span><span class="default">$keylength </span><span class="keyword">== </span><span class="default">0</span><span class="keyword">) {
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$j</span><span class="keyword">=</span><span class="default">0</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// Apply a xor operation between the key and the file to crypt
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; // This operation eats a lots of CPU time (Stream at 1MiB/s on my server; Intel E2180)
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$tmp </span><span class="keyword">= </span><span class="default">pack</span><span class="keyword">(</span><span class="string">"C"</span><span class="keyword">, </span><span class="default">$key</span><span class="keyword">[</span><span class="default">$j</span><span class="keyword">]);
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$bufferE </span><span class="keyword">= ( </span><span class="default">$buffer</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">]^</span><span class="default">$tmp</span><span class="keyword">); </span><span class="comment">// &lt;==== Le fameux XOR
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; 
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; /*
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; echo "&lt;br /&gt;key[".$j."]: ";
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; var_dump($tmp);
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; echo "&lt;br /&gt;buffer[".$i."]: ";
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; var_dump($buffer[$i]);
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; echo "&lt;br /&gt;bufferE: ";
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; var_dump($bufferE);
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; echo "&lt;br /&gt;";
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; //*/
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; 
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; // Send the encrypted data
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">echo </span><span class="default">$bufferE</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// Clean the memory
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$bufferE </span><span class="keyword">= </span><span class="string">""</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$j</span><span class="keyword">++;
<br />
&nbsp;&nbsp;&nbsp; }
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$buffer </span><span class="keyword">= </span><span class="string">""</span><span class="keyword">;
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">flush</span><span class="keyword">(); </span><span class="comment">// this is essential for large downloads
<br />
&nbsp;&nbsp;&nbsp; /*
<br />
&nbsp;&nbsp;&nbsp; fclose($fp);
<br />
&nbsp;&nbsp;&nbsp; exit();
<br />
&nbsp;&nbsp;&nbsp; //*/
<br />
</span><span class="keyword">}
<br />
</span><span class="comment">// Close the file and it's finished
<br />
</span><span class="default">fclose</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">);
<br />

<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="87449""></a>
  <div class="note">
   <strong class="user">bebertjean at yahoo dot fr</strong>
   <a href="#87449" class="date">05-Dec-2008 02:46</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If using the 'header' function for the downloading of files, especially if you're passing the filename as a variable, remember to surround the filename with double quotes, otherwise you'll have problems in Firefox as soon as there's a space in the filename.<br />
<br />
So instead of typing:<br />
<br />
<span class="default">&lt;?php<br />
&nbsp; header</span><span class="keyword">(</span><span class="string">"Content-Disposition: attachment; filename=" </span><span class="keyword">. </span><span class="default">basename</span><span class="keyword">(</span><span class="default">$filename</span><span class="keyword">));<br />
</span><span class="default">?&gt;<br />
</span><br />
you should type:<br />
<br />
<span class="default">&lt;?php<br />
&nbsp; header</span><span class="keyword">(</span><span class="string">"Content-Disposition: attachment; filename=\"" </span><span class="keyword">. </span><span class="default">basename</span><span class="keyword">(</span><span class="default">$filename</span><span class="keyword">) . </span><span class="string">"\""</span><span class="keyword">);<br />
</span><span class="default">?&gt;<br />
</span><br />
If you don't do this then when the user clicks on the link for a file named "Example file with spaces.txt", then Firefox's Save As dialog box will give it the name "Example", and it will have no extension.<br />
<br />
See the page called "Filenames_with_spaces_are_truncated_upon_download" at <br />
<a href="http://kb.mozillazine.org/ for more information. (Sorry, the site won" rel="nofollow" target="_blank">http://kb.mozillazine.org/ for more information. (Sorry, the site won</a>'t let me post such a long link...)</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="87348""></a>
  <div class="note">
   <strong class="user">jamie</strong>
   <a href="#87348" class="date">01-Dec-2008 04:57</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
The encoding of a file is discovered by the Content-Type, either in the HTML meta tag or as part of the HTTP header. Thus, the server and browser does not need - nor expect - a Unicode file to begin with a BOM mark. BOMs can confuse *nix systems too. More info at <a href="http://unicode.org/faq/utf_bom.html#bom1" rel="nofollow" target="_blank">http://unicode.org/faq/utf_bom.html#bom1</a><br />
<br />
On another note: Safari can display CMYK images (at least the OS X version, because it uses the services of QuickTime)</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="86554""></a>
  <div class="note">
   <strong class="user">mzheng[no-spam-thx] at ariba dot com</strong>
   <a href="#86554" class="date">23-Oct-2008 05:50</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
For large files (100+ MBs), I found that it is essential to flush the file content ASAP, otherwise the download dialog doesn't show until a long time or never. <br />
<br />
<span class="default">&lt;?php<br />
header</span><span class="keyword">(</span><span class="string">"Content-Disposition: attachment; filename=" </span><span class="keyword">. </span><span class="default">urlencode</span><span class="keyword">(</span><span class="default">$file</span><span class="keyword">));&nbsp; &nbsp; <br />
</span><span class="default">header</span><span class="keyword">(</span><span class="string">"Content-Type: application/force-download"</span><span class="keyword">);<br />
</span><span class="default">header</span><span class="keyword">(</span><span class="string">"Content-Type: application/octet-stream"</span><span class="keyword">);<br />
</span><span class="default">header</span><span class="keyword">(</span><span class="string">"Content-Type: application/download"</span><span class="keyword">);<br />
</span><span class="default">header</span><span class="keyword">(</span><span class="string">"Content-Description: File Transfer"</span><span class="keyword">);&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <br />
</span><span class="default">header</span><span class="keyword">(</span><span class="string">"Content-Length: " </span><span class="keyword">. </span><span class="default">filesize</span><span class="keyword">(</span><span class="default">$file</span><span class="keyword">));<br />
</span><span class="default">flush</span><span class="keyword">(); </span><span class="comment">// this doesn't really matter.<br />
<br />
</span><span class="default">$fp </span><span class="keyword">= </span><span class="default">fopen</span><span class="keyword">(</span><span class="default">$file</span><span class="keyword">, </span><span class="string">"r"</span><span class="keyword">); <br />
while (!</span><span class="default">feof</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">))<br />
{<br />
&nbsp;&nbsp;&nbsp; echo </span><span class="default">fread</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">, </span><span class="default">65536</span><span class="keyword">); <br />
&nbsp;&nbsp;&nbsp; </span><span class="default">flush</span><span class="keyword">(); </span><span class="comment">// this is essential for large downloads<br />
</span><span class="keyword">}&nbsp; <br />
</span><span class="default">fclose</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">); <br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="85254""></a>
  <div class="note">
   <strong class="user">shutout2730 at yahoo dot com</strong>
   <a href="#85254" class="date">22-Aug-2008 08:57</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
It is important to note that headers are actually sent when the first byte is output to the browser. If you are replacing headers in your scripts, this means that the placement of echo/print statements and output buffers may actually impact which headers are sent. In the case of redirects, if you forget to terminate your script after sending the header, adding a buffer or sending a character may change which page your users are sent to.<br />
<br />
This redirects to 2.html since the second header replaces the first.<br />
<br />
<span class="default">&lt;?php<br />
header</span><span class="keyword">(</span><span class="string">"location: 1.html"</span><span class="keyword">); <br />
</span><span class="default">header</span><span class="keyword">(</span><span class="string">"location: 2.html"</span><span class="keyword">); </span><span class="comment">//replaces 1.html<br />
</span><span class="default">?&gt;<br />
</span><br />
This redirects to 1.html since the header is sent as soon as the echo happens. You also won't see any "headers already sent" errors because the browser follows the redirect before it can display the error.<br />
<br />
<span class="default">&lt;?php<br />
header</span><span class="keyword">(</span><span class="string">"location: 1.html"</span><span class="keyword">);<br />
echo </span><span class="string">"send data"</span><span class="keyword">; <br />
</span><span class="default">header</span><span class="keyword">(</span><span class="string">"location: 2.html"</span><span class="keyword">); </span><span class="comment">//1.html already sent <br />
</span><span class="default">?&gt;<br />
</span><br />
Wrapping the previous example in an output buffer actually changes the behavior of the script! This is because headers aren't sent until the output buffer is flushed.<br />
<br />
<span class="default">&lt;?php<br />
ob_start</span><span class="keyword">();<br />
</span><span class="default">header</span><span class="keyword">(</span><span class="string">"location: 1.html"</span><span class="keyword">); <br />
echo </span><span class="string">"send data"</span><span class="keyword">; <br />
</span><span class="default">header</span><span class="keyword">(</span><span class="string">"location: 2.html"</span><span class="keyword">); </span><span class="comment">//replaces 1.html<br />
</span><span class="default">ob_end_flush</span><span class="keyword">(); </span><span class="comment">//now the headers are sent<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="85146""></a>
  <div class="note">
   <strong class="user">sk89q</strong>
   <a href="#85146" class="date">17-Aug-2008 08:41</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
You can use HTTP's etags and last modified dates to ensure that you're not sending the browser data it already has cached.
<br />

<br />
<span class="default">&lt;?php
<br />
$last_modified_time </span><span class="keyword">= </span><span class="default">filemtime</span><span class="keyword">(</span><span class="default">$file</span><span class="keyword">);
<br />
</span><span class="default">$etag </span><span class="keyword">= </span><span class="default">md5_file</span><span class="keyword">(</span><span class="default">$file</span><span class="keyword">);
<br />

<br />
</span><span class="default">header</span><span class="keyword">(</span><span class="string">"Last-Modified: "</span><span class="keyword">.</span><span class="default">gmdate</span><span class="keyword">(</span><span class="string">"D, d M Y H:i:s"</span><span class="keyword">, </span><span class="default">$last_modified_time</span><span class="keyword">).</span><span class="string">" GMT"</span><span class="keyword">);
<br />
</span><span class="default">header</span><span class="keyword">(</span><span class="string">"Etag: </span><span class="default">$etag</span><span class="string">"</span><span class="keyword">);
<br />

<br />
if (@</span><span class="default">strtotime</span><span class="keyword">(</span><span class="default">$_SERVER</span><span class="keyword">[</span><span class="string">'HTTP_IF_MODIFIED_SINCE'</span><span class="keyword">]) == </span><span class="default">$last_modified_time </span><span class="keyword">||
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">trim</span><span class="keyword">(</span><span class="default">$_SERVER</span><span class="keyword">[</span><span class="string">'HTTP_IF_NONE_MATCH'</span><span class="keyword">]) == </span><span class="default">$etag</span><span class="keyword">) {
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">header</span><span class="keyword">(</span><span class="string">"HTTP/1.1 304 Not Modified"</span><span class="keyword">);
<br />
&nbsp;&nbsp;&nbsp; exit;
<br />
}
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="78470""></a>
  <div class="note">
   <strong class="user">Dylan at WeDefy dot com</strong>
   <a href="#78470" class="date">13-Oct-2007 05:17</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
A quick way to make redirects permanent or temporary is to make use of the $http_response_code parameter in header().<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="comment">// 301 Moved Permanently<br />
</span><span class="default">header</span><span class="keyword">(</span><span class="string">"Location: /foo.php"</span><span class="keyword">,</span><span class="default">TRUE</span><span class="keyword">,</span><span class="default">301</span><span class="keyword">);<br />
<br />
</span><span class="comment">// 302 Found<br />
</span><span class="default">header</span><span class="keyword">(</span><span class="string">"Location: /foo.php"</span><span class="keyword">,</span><span class="default">TRUE</span><span class="keyword">,</span><span class="default">302</span><span class="keyword">);<br />
</span><span class="default">header</span><span class="keyword">(</span><span class="string">"Location: /foo.php"</span><span class="keyword">);<br />
<br />
</span><span class="comment">// 303 See Other<br />
</span><span class="default">header</span><span class="keyword">(</span><span class="string">"Location: /foo.php"</span><span class="keyword">,</span><span class="default">TRUE</span><span class="keyword">,</span><span class="default">303</span><span class="keyword">);<br />
<br />
</span><span class="comment">// 307 Temporary Redirect<br />
</span><span class="default">header</span><span class="keyword">(</span><span class="string">"Location: /foo.php"</span><span class="keyword">,</span><span class="default">TRUE</span><span class="keyword">,</span><span class="default">307</span><span class="keyword">);<br />
</span><span class="default">?&gt;<br />
</span><br />
The HTTP status code changes the way browsers and robots handle redirects, so if you are using header(Location:) it's a good idea to set the status code at the same time.&nbsp; Browsers typically re-request a 307 page every time, cache a 302 page for the session, and cache a 301 page for longer, or even indefinitely.&nbsp; Search engines typically transfer "page rank" to the new location for 301 redirects, but not for 302, 303 or 307. If the status code is not specified, header('Location:') defaults to 302.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="76758""></a>
  <div class="note">
   <strong class="user">Kal</strong>
   <a href="#76758" class="date">29-Jul-2007 10:07</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I spent a long time trying to determine why Internet Explorer 7 wasn't prompting the user to save a download based on the filename specified on a "'Content-Disposition: attachment; filename=..." header line.<br />
<br />
I eventually determined that my Apache installation was adding an additional header: "Vary: Host", which was throwing IE - as per <a href="http://support.microsoft.com/kb/824847" rel="nofollow" target="_blank">http://support.microsoft.com/kb/824847</a><br />
<br />
I found manually setting the Vary header from within PHP as follows header('Vary: User-Agent'); allowed IE to behave as intended.<br />
<br />
Hope this saves someone else some time,<br />
<br />
- Kal</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="75507""></a>
  <div class="note">
   <strong class="user">nobileelpirata at hotmail dot com</strong>
   <a href="#75507" class="date">03-Jun-2007 12:04</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
This is the Headers to force a browser to use fresh content (no caching) in HTTP/1.0 and HTTP/1.1:
<br />

<br />
<span class="default">&lt;?PHP
<br />
header</span><span class="keyword">( </span><span class="string">'Expires: Sat, 26 Jul 1997 05:00:00 GMT' </span><span class="keyword">);
<br />
</span><span class="default">header</span><span class="keyword">( </span><span class="string">'Last-Modified: ' </span><span class="keyword">. </span><span class="default">gmdate</span><span class="keyword">( </span><span class="string">'D, d M Y H:i:s' </span><span class="keyword">) . </span><span class="string">' GMT' </span><span class="keyword">);
<br />
</span><span class="default">header</span><span class="keyword">( </span><span class="string">'Cache-Control: no-store, no-cache, must-revalidate' </span><span class="keyword">);
<br />
</span><span class="default">header</span><span class="keyword">( </span><span class="string">'Cache-Control: post-check=0, pre-check=0'</span><span class="keyword">, </span><span class="default">false </span><span class="keyword">);
<br />
</span><span class="default">header</span><span class="keyword">( </span><span class="string">'Pragma: no-cache' </span><span class="keyword">);
<br />

<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="61903""></a>
  <div class="note">
   <strong class="user">mandor at mandor dot net</strong>
   <a href="#61903" class="date">15-Feb-2006 02:14</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
When using PHP to output an image, it won't be cached by the client so if you don't want them to download the image each time they reload the page, you will need to emulate part of the HTTP protocol.<br />
<br />
Here's how:<br />
<br />
<span class="default">&lt;?php<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">// Test image.<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$fn </span><span class="keyword">= </span><span class="string">'/test/foo.png'</span><span class="keyword">;<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">// Getting headers sent by the client.<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$headers </span><span class="keyword">= </span><span class="default">apache_request_headers</span><span class="keyword">(); <br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">// Checking if the client is validating his cache and if it is current.<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">if (isset(</span><span class="default">$headers</span><span class="keyword">[</span><span class="string">'If-Modified-Since'</span><span class="keyword">]) &amp;&amp; (</span><span class="default">strtotime</span><span class="keyword">(</span><span class="default">$headers</span><span class="keyword">[</span><span class="string">'If-Modified-Since'</span><span class="keyword">]) == </span><span class="default">filemtime</span><span class="keyword">(</span><span class="default">$fn</span><span class="keyword">))) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// Client's cache IS current, so we just respond '304 Not Modified'.<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">header</span><span class="keyword">(</span><span class="string">'Last-Modified: '</span><span class="keyword">.</span><span class="default">gmdate</span><span class="keyword">(</span><span class="string">'D, d M Y H:i:s'</span><span class="keyword">, </span><span class="default">filemtime</span><span class="keyword">(</span><span class="default">$fn</span><span class="keyword">)).</span><span class="string">' GMT'</span><span class="keyword">, </span><span class="default">true</span><span class="keyword">, </span><span class="default">304</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; } else {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// Image not cached or cache outdated, we respond '200 OK' and output the image.<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">header</span><span class="keyword">(</span><span class="string">'Last-Modified: '</span><span class="keyword">.</span><span class="default">gmdate</span><span class="keyword">(</span><span class="string">'D, d M Y H:i:s'</span><span class="keyword">, </span><span class="default">filemtime</span><span class="keyword">(</span><span class="default">$fn</span><span class="keyword">)).</span><span class="string">' GMT'</span><span class="keyword">, </span><span class="default">true</span><span class="keyword">, </span><span class="default">200</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">header</span><span class="keyword">(</span><span class="string">'Content-Length: '</span><span class="keyword">.</span><span class="default">filesize</span><span class="keyword">(</span><span class="default">$fn</span><span class="keyword">));<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">header</span><span class="keyword">(</span><span class="string">'Content-Type: image/png'</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; print </span><span class="default">file_get_contents</span><span class="keyword">(</span><span class="default">$fn</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; }<br />
<br />
</span><span class="default">?&gt;<br />
</span><br />
That way foo.png will be properly cached by the client and you'll save bandwith. :)</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="37645""></a>
  <div class="note">
   <strong class="user">jp at webgraphe dot com</strong>
   <a href="#37645" class="date">22-Nov-2003 12:56</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
A call to session_write_close() before the statement
<br />

<br />
<span class="default">&lt;?php
<br />
&nbsp;&nbsp;&nbsp; header</span><span class="keyword">(</span><span class="string">"Location: URL"</span><span class="keyword">);
<br />
&nbsp;&nbsp;&nbsp; exit();
<br />
</span><span class="default">?&gt;
<br />
</span>
<br />
is recommended if you want to be sure the session is updated before proceeding to the redirection.
<br />

<br />
We encountered a situation where the script accessed by the redirection wasn't loading the session correctly because the precedent script hadn't the time to update it (we used a database handler).
<br />

<br />
JP.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="32569""></a>
  <div class="note">
   <strong class="user">bMindful at fleetingiamge dot org</strong>
   <a href="#32569" class="date">01-Jun-2003 12:08</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If you haven't used, HTTP Response 204 can be very convenient. 204 tells the server to immediately termiante this request. This is helpful if you want a javascript (or similar) client-side function to execute a server-side function without refreshing or changing the current webpage. Great for updating database, setting global variables, etc.
<br />

<br />
&nbsp;&nbsp; &nbsp; header("status: 204");&nbsp; (or the other call)
<br />
&nbsp;&nbsp; &nbsp; header("HTTP/1.0 204 No Response");</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
</div>
</div>
</div></div></body></html>
