<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
 <head>
  <meta http-equiv="content-type" content="text/html; CHARSET=shift-jis">
  <title>文字列をスラッシュでクォートする</title>

  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <link media="all" rel="stylesheet" type="text/css" href="style.css"/>
 </head>
 <body class="docs" class="docs"><div class="navbar navbar-fixed-top">
  <div class="navbar-inner clearfix">
    <ul class="nav" style="width: 100%">
      <li style="float: left;"><a href="function.addcslashes.html">≪ addcslashes</a></li>
      <li style="float: right;"><a href="function.bin2hex.html">bin2hex ≫</a></li>
    </ul>
  </div>
</div>
<div id="breadcrumbs" class="clearfix">
  <ul class="breadcrumbs-container">
    <li><a href="index.html">PHP Manual</a></li>
    <li><a href="ref.strings.html">String 関数</a></li>
    <li>文字列をスラッシュでクォートする</li>
  </ul>
</div>
<div id="layout">
  <div id="layout-content"><div id="function.addslashes" class="refentry">
 <div class="refnamediv">
  <h1 class="refname">addslashes</h1>
  <p class="verinfo">(PHP 4, PHP 5)</p><p class="refpurpose"><span class="refname">addslashes</span> &mdash; <span class="dc-title">文字列をスラッシュでクォートする</span></p>

 </div>
 
 <div class="refsect1 description" id="refsect1-function.addslashes-description">
  <h3 class="title">説明</h3>
  <div class="methodsynopsis dc-description">
   <span class="type">string</span> <span class="methodname"><strong>addslashes</strong></span>
    ( <span class="methodparam"><span class="type">string</span> <code class="parameter">$str</code></span>
   )</div>

  <p class="para rdfs-comment">
   エスケープすべき文字の前にバックスラッシュを付けて返します。
   エスケープすべき文字とは、シングルクォート(<em>&#039;</em>),
   ダブルクォート(<em>&quot;</em>),バックスラッシュ
   (<em>\</em>) ,NUL (<strong><code>NULL</code></strong> バイト) です。
  </p>
  <p class="para">
   <span class="function"><strong>addslashes()</strong></span> 関数 を使う例として、PHPが評価する文字列データを入力する場合が挙げられます。たとえば、<em>O&#039;reilly</em> というデータを $str に格納して評価する場合、$str をエスケープする(つまり eval(&quot;echo &#039;&quot;.addslashes($str).&quot;&#039;;&quot;); する) 必要があります。
  </p>
  <p class="para">
   セキュリティ上の理由で、データベースパラメータをエスケープするには DBMS 固有のエスケープ関数
   (たとえば MySQL 用の <span class="function"><a href="mysqli.real-escape-string.html" class="function">mysqli_real_escape_string()</a></span> や、
   PostgreSQL 用の <span class="function"><a href="function.pg-escape-literal.html" class="function">pg_escape_literal()</a></span>、<span class="function"><a href="function.pg-escape-string.html" class="function">pg_escape_string()</a></span>) を使うべきです。
   識別子(例: テーブル名やフィールド名)をエスケープするときは、データベースパラメータとは別の仕様をDBMSは使います。 
   PostgreSQL の <span class="function"><a href="function.pg-escape-identifier.html" class="function">pg_escape_identifier()</a></span> のように、DBMS によっては識別子用のエスケープ関数を提供しているものもありますが、全ての DBMS が提供しているわけではありません。
   提供されていない場合は、お使いのデータベースシステムのマニュアルを参照し、適切なエスケープ方法を調べるようにしてください。
  </p>
  <p class="para">
   お使いの DBMS がエスケープ関数を提供しておらず、 DBMS が 
   特別な文字をエスケープするのに <em>\</em> を使っている場合、
   その DBMS に適切なエスケープ方法である場合に限って、
   <span class="function"><strong>addslashes()</strong></span> 関数を使うことができます。
   ほとんどのデータベース上では、 <span class="function"><strong>addslashes()</strong></span>関数を
   パラメータのエスケープに使うと、セキュリティ問題が起きる原因となりうることに注意してください。
  </p>
  <p class="para">
   PHP 5.4 より前のバージョンでは、<a href="info.configuration.html#ini.magic-quotes-gpc" class="link">
   magic_quotes_gpc</a> が デフォルトで <em>on</em> だったため、
   原則として <span class="function"><strong>addslashes()</strong></span> 関数がすべての GET, POST, COOKIE のデータに対して実行されていました。
   <a href="info.configuration.html#ini.magic-quotes-gpc" class="link">magic_quotes_gpc</a> によって既にエスケープされた文字列に対して <span class="function"><strong>addslashes()</strong></span>関数 を絶対に実行してはいけません。2重エスケープになるからです。
   <span class="function"><a href="function.get-magic-quotes-gpc.html" class="function">get_magic_quotes_gpc()</a></span>関数 で既にエスケープが行われているかを簡単にチェックできます。
  </p>
 </div>


 <div class="refsect1 parameters" id="refsect1-function.addslashes-parameters">
  <h3 class="title">パラメータ</h3>
  <p class="para">
   <dl>

    
     <dt>
<code class="parameter">str</code></dt>

     <dd>

      <p class="para">
       エスケープしたい文字列。
      </p>
     </dd>

    
   </dl>

  </p>
 </div>


 <div class="refsect1 returnvalues" id="refsect1-function.addslashes-returnvalues">
  <h3 class="title">返り値</h3>
  <p class="para">
   エスケープされた文字列を返します。
  </p>
 </div>


 <div class="refsect1 examples" id="refsect1-function.addslashes-examples">
  <h3 class="title">例</h3>
  <p class="para">
   <div class="example" id="example-4927">
    <p><strong>例1 <span class="function"><strong>addslashes()</strong></span> の例</strong></p>
    <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br />$str&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #DD0000">"Is&nbsp;your&nbsp;name&nbsp;O'reilly?"</span><span style="color: #007700">;<br /><br /></span><span style="color: #FF8000">//&nbsp;出力:&nbsp;Is&nbsp;your&nbsp;name&nbsp;O\'reilly?<br /></span><span style="color: #007700">echo&nbsp;</span><span style="color: #0000BB">addslashes</span><span style="color: #007700">(</span><span style="color: #0000BB">$str</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
    </div>

   </div>
  </p>
 </div>

 
 <div class="refsect1 seealso" id="refsect1-function.addslashes-seealso">
  <h3 class="title">参考</h3>
  <p class="para">
   <ul class="simplelist">
    <li class="member"><span class="function"><a href="function.stripcslashes.html" class="function" rel="rdfs-seeAlso">stripcslashes()</a> - addcslashes でクォートされた文字列をアンクォートする</span></li>
    <li class="member"><span class="function"><a href="function.stripslashes.html" class="function" rel="rdfs-seeAlso">stripslashes()</a> - クォートされた文字列のクォート部分を取り除く</span></li>
    <li class="member"><span class="function"><a href="function.addcslashes.html" class="function" rel="rdfs-seeAlso">addcslashes()</a> - C 言語と同様にスラッシュで文字列をクォートする</span></li>
    <li class="member"><span class="function"><a href="function.htmlspecialchars.html" class="function" rel="rdfs-seeAlso">htmlspecialchars()</a> - 特殊文字を HTML エンティティに変換する</span></li>
    <li class="member"><span class="function"><a href="function.quotemeta.html" class="function" rel="rdfs-seeAlso">quotemeta()</a> - メタ文字をクォートする</span></li>
    <li class="member"><span class="function"><a href="function.get-magic-quotes-gpc.html" class="function" rel="rdfs-seeAlso">get_magic_quotes_gpc()</a> - magic_quotes_gpc の現在の設定を得る</span></li>
   </ul>
  </p>
 </div>


</div><div id="usernotes">
 <div class="head">
  <h3 class="title">User Contributed Notes</h3>
 </div>
<div id="allnotes">  <a name="114378""></a>
  <div class="note">
   <strong class="user">wyattstorch42 at outlook dot com</strong>
   <a href="#114378" class="date">14-Feb-2014 01:02</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
@ mark at hagers dot demon dot nl :<br />
<br />
You shouldn't use str_replace() for this. Use a function like htmlentities(), which will properly encode all user input for fields. That way, it will also work if the user types &amp;, &lt;, &gt;, etc.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="113386""></a>
  <div class="note">
   <strong class="user">David Spector</strong>
   <a href="#113386" class="date">04-Oct-2013 11:30</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If all you want to do is quote a string as you would normally do in PHP (for example, when returning an Ajax result, inside a json string value, or when building a URL with args), don't use addslashes (you don't want both " and ' escaped at the same time). Instead, just use this function:<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">function </span><span class="default">Quote</span><span class="keyword">(</span><span class="default">$Str</span><span class="keyword">) </span><span class="comment">// Double-quoting only<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">{<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$Str</span><span class="keyword">=</span><span class="default">str_replace</span><span class="keyword">(</span><span class="string">'"'</span><span class="keyword">,</span><span class="string">'\"'</span><span class="keyword">,</span><span class="default">$Str</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; return </span><span class="string">'"'</span><span class="keyword">.</span><span class="default">$Str</span><span class="keyword">.</span><span class="string">'"'</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; } </span><span class="comment">// Quote<br />
</span><span class="default">?&gt;<br />
</span><br />
Modify this easily to get a single-quoting function.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="108155""></a>
  <div class="note">
   <strong class="user">Lars</strong>
   <a href="#108155" class="date">03-Apr-2012 05:51</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Even for simple json string backslash encodings, do not use this function. Some tests may work fine, but in json the single quote (') must not be escaped.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="107661""></a>
  <div class="note">
   <strong class="user">qeremy [atta] gmail [dotta] com</strong>
   <a href="#107661" class="date">25-Feb-2012 12:11</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Actually I prefer to escape the SQL queries completely (then no more challenge for data security);<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">function </span><span class="default">escape_query</span><span class="keyword">(</span><span class="default">$str</span><span class="keyword">) {<br />
&nbsp;&nbsp;&nbsp; return </span><span class="default">strtr</span><span class="keyword">(</span><span class="default">$str</span><span class="keyword">, array(<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="string">"\0" </span><span class="keyword">=&gt; </span><span class="string">""</span><span class="keyword">,<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="string">"'"&nbsp; </span><span class="keyword">=&gt; </span><span class="string">"&amp;#39;"</span><span class="keyword">,<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="string">"\"" </span><span class="keyword">=&gt; </span><span class="string">"&amp;#34;"</span><span class="keyword">,<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="string">"\\" </span><span class="keyword">=&gt; </span><span class="string">"&amp;#92;"</span><span class="keyword">,<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// more secure<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="string">"&lt;"&nbsp; </span><span class="keyword">=&gt; </span><span class="string">"&amp;lt;"</span><span class="keyword">,<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="string">"&gt;"&nbsp; </span><span class="keyword">=&gt; </span><span class="string">"&amp;gt;"</span><span class="keyword">,<br />
&nbsp;&nbsp;&nbsp; ));<br />
}<br />
</span><span class="default">?&gt;<br />
</span><br />
// &amp;#39;&amp;#34;&amp;#92;<br />
echo escape_query("'\"\\\0");<br />
<br />
// &amp;lt;script&amp;gt;alert(1)&amp;lt;/script&amp;gt;<br />
echo escape_query("&lt;\0script&gt;alert(1)&lt;\0/script&gt;");<br />
<br />
// See more: www.asciitable.com</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="105395""></a>
  <div class="note">
   <strong class="user">boyaqb at gmail dot com</strong>
   <a href="#105395" class="date">15-Aug-2011 12:34</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
so you can use replace single quote and double quote with HTML Entities<br />
<br />
for example<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="comment">/**<br />
&nbsp;* replcae quotes to HTML entities by names or numbers<br />
&nbsp;*<br />
&nbsp;* @param (string) escaped string value<br />
&nbsp;* @param (string) default ='number' will be return to number entities you can use ='name' to return name entities<br />
&nbsp;* Note : don't use ='name' coz (&amp;apos;) (does not work in IE)<br />
&nbsp;*/<br />
</span><span class="keyword">function </span><span class="default">quote2entities</span><span class="keyword">(</span><span class="default">$string</span><span class="keyword">,</span><span class="default">$entities_type</span><span class="keyword">=</span><span class="string">'number'</span><span class="keyword">)<br />
{<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$search&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">= array(</span><span class="string">"\""</span><span class="keyword">,</span><span class="string">"'"</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$replace_by_entities_name&nbsp;&nbsp; </span><span class="keyword">= array(</span><span class="string">"&amp;quot;"</span><span class="keyword">,</span><span class="string">"&amp;apos;"</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$replace_by_entities_number </span><span class="keyword">= array(</span><span class="string">"&amp;#34;"</span><span class="keyword">,</span><span class="string">"&amp;#39;"</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$do </span><span class="keyword">= </span><span class="default">null</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; if (</span><span class="default">$entities_type </span><span class="keyword">== </span><span class="string">'number'</span><span class="keyword">)<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$do </span><span class="keyword">= </span><span class="default">str_replace</span><span class="keyword">(</span><span class="default">$search</span><span class="keyword">,</span><span class="default">$replace_by_entities_number</span><span class="keyword">,</span><span class="default">$string</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; else if (</span><span class="default">$entities_type </span><span class="keyword">== </span><span class="string">'name'</span><span class="keyword">)<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$do </span><span class="keyword">= </span><span class="default">str_replace</span><span class="keyword">(</span><span class="default">$search</span><span class="keyword">,</span><span class="default">$replace_by_entities_name</span><span class="keyword">,</span><span class="default">$string</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; else<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$do </span><span class="keyword">= </span><span class="default">addslashes</span><span class="keyword">(</span><span class="default">$string</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; return </span><span class="default">$do</span><span class="keyword">;<br />
}<br />
<br />
echo </span><span class="default">quote2entities</span><span class="keyword">(</span><span class="string">"I love 'PHP' for ever"</span><span class="keyword">);<br />
</span><span class="comment">// will return I love 'PHP' for ever in browsere<br />
// but in view code and database will be&nbsp; I love &amp;#34;PHP&amp;#34; for ever in source<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="103121""></a>
  <div class="note">
   <strong class="user">cliprz at gmail dot com</strong>
   <a href="#103121" class="date">27-Mar-2011 08:08</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
<span class="default">&lt;?php<br />
<br />
</span><span class="comment">/**<br />
&nbsp;* @desc add slashes if use MySQL and check if function addslashes is exits else<br />
&nbsp;* return to escape string in MySQL .<br />
&nbsp;* same way its return to stripslashes function<br />
&nbsp;* @param string $type any string u want to insert in MySQL and display from MySQL<br />
&nbsp;* @param string $type must be add to add slashes and strip to strip slashes<br />
&nbsp;* @author Yousef Ismaeil - cliprz@gmail.com<br />
&nbsp;*/<br />
</span><span class="keyword">function </span><span class="default">PHP_slashes</span><span class="keyword">(</span><span class="default">$string</span><span class="keyword">,</span><span class="default">$type</span><span class="keyword">=</span><span class="string">'add'</span><span class="keyword">)<br />
{<br />
&nbsp;&nbsp;&nbsp; if (</span><span class="default">$type </span><span class="keyword">== </span><span class="string">'add'</span><span class="keyword">)<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">get_magic_quotes_gpc</span><span class="keyword">())<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">$string</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; else<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">function_exists</span><span class="keyword">(</span><span class="string">'addslashes'</span><span class="keyword">))<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">addslashes</span><span class="keyword">(</span><span class="default">$string</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; else<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">mysql_real_escape_string</span><span class="keyword">(</span><span class="default">$string</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; else if (</span><span class="default">$type </span><span class="keyword">== </span><span class="string">'strip'</span><span class="keyword">)<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">stripslashes</span><span class="keyword">(</span><span class="default">$string</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; else<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; die(</span><span class="string">'error in PHP_slashes (mixed,add | strip)'</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; }<br />
}<br />
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="102188""></a>
  <div class="note">
   <strong class="user">svenr at selfhtml dot org</strong>
   <a href="#102188" class="date">01-Feb-2011 05:45</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
To output a PHP variable to Javascript, use json_encode().<br />
<br />
<span class="default">&lt;?php<br />
<br />
$var </span><span class="keyword">= </span><span class="string">"He said \"Hello O'Reilly\" &amp; disappeared.\nNext line..."</span><span class="keyword">;<br />
echo </span><span class="string">"alert("</span><span class="keyword">.</span><span class="default">json_encode</span><span class="keyword">(</span><span class="default">$var</span><span class="keyword">).</span><span class="string">");\n"</span><span class="keyword">;<br />
<br />
</span><span class="default">?&gt;<br />
</span><br />
Output:<br />
alert("He said \"Hello O'Reilly\" &amp; disappeared.\nNext line...") ;</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="98488""></a>
  <div class="note">
   <strong class="user">roysimke at microsoftsfirstmailprovider dot com</strong>
   <a href="#98488" class="date">18-Jun-2010 10:35</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Never use addslashes function to escape values you are going to send to mysql. use mysql_real_escape_string or pg_escape at least if you are not using prepared queries yet.<br />
<br />
keep in mind that single quote is not the only special character that can break your sql query. and quotes are the only thing which addslashes care.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="93139""></a>
  <div class="note">
   <strong class="user">DarkHunterj</strong>
   <a href="#93139" class="date">25-Aug-2009 02:11</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Based on:<br />
Danijel Pticar<br />
05-Aug-2009 05:22<br />
I recommend this extended version, to replace addslashes altogether(works for both strings and arrays):<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">function </span><span class="default">addslashesextended</span><span class="keyword">(&amp;</span><span class="default">$arr_r</span><span class="keyword">)<br />
{<br />
&nbsp;&nbsp;&nbsp; if(</span><span class="default">is_array</span><span class="keyword">(</span><span class="default">$arr_r</span><span class="keyword">))<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; foreach (</span><span class="default">$arr_r </span><span class="keyword">as &amp;</span><span class="default">$val</span><span class="keyword">)<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">is_array</span><span class="keyword">(</span><span class="default">$val</span><span class="keyword">) ? </span><span class="default">addslashesextended</span><span class="keyword">(</span><span class="default">$val</span><span class="keyword">):</span><span class="default">$val</span><span class="keyword">=</span><span class="default">addslashes</span><span class="keyword">(</span><span class="default">$val</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; unset(</span><span class="default">$val</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; else<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$arr_r</span><span class="keyword">=</span><span class="default">addslashes</span><span class="keyword">(</span><span class="default">$arr_r</span><span class="keyword">);<br />
}<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="92720""></a>
  <div class="note">
   <strong class="user">Danijel Pticar</strong>
   <a href="#92720" class="date">05-Aug-2009 07:22</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Hi,
<br />
I use this recursive function for POST. It handles multidimensional arrays.
<br />

<br />
<span class="default">&lt;?php
<br />
</span><span class="keyword">function </span><span class="default">as_array</span><span class="keyword">(&amp;</span><span class="default">$arr_r</span><span class="keyword">)
<br />
{
<br />
&nbsp;foreach (</span><span class="default">$arr_r </span><span class="keyword">as &amp;</span><span class="default">$val</span><span class="keyword">) </span><span class="default">is_array</span><span class="keyword">(</span><span class="default">$val</span><span class="keyword">) ? </span><span class="default">as_array</span><span class="keyword">(</span><span class="default">$val</span><span class="keyword">):</span><span class="default">$val</span><span class="keyword">=</span><span class="default">addslashes</span><span class="keyword">(</span><span class="default">$val</span><span class="keyword">);
<br />
&nbsp;unset(</span><span class="default">$val</span><span class="keyword">);
<br />
}
<br />

<br />
</span><span class="default">as_array</span><span class="keyword">(</span><span class="default">$_POST</span><span class="keyword">);
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="88771""></a>
  <div class="note">
   <strong class="user">leocullen at fastmail dot fm</strong>
   <a href="#88771" class="date">06-Feb-2009 10:06</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
this is my version of an addslashes function, useful for processing $_POST array:
<br />

<br />
<span class="default">&lt;?php
<br />
</span><span class="keyword">function </span><span class="default">add_slashes </span><span class="keyword">(</span><span class="default">$an_array</span><span class="keyword">) {
<br />
&nbsp; foreach (</span><span class="default">$an_array </span><span class="keyword">as </span><span class="default">$key </span><span class="keyword">=&gt; </span><span class="default">$value</span><span class="keyword">) {
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$new_array</span><span class="keyword">[</span><span class="default">$key</span><span class="keyword">] = </span><span class="default">addslashes</span><span class="keyword">(</span><span class="default">$an_array</span><span class="keyword">[</span><span class="default">$key</span><span class="keyword">]); 
<br />
&nbsp; }
<br />
}
<br />
</span><span class="default">?&gt;
<br />
</span>
<br />
then call it:
<br />

<br />
<span class="default">&lt;?php add_slashes</span><span class="keyword">(</span><span class="default">$_POST</span><span class="keyword">); </span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="87577""></a>
  <div class="note">
   <strong class="user">stuart at horuskol dot co dot uk</strong>
   <a href="#87577" class="date">11-Dec-2008 11:44</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Be careful on whether you use double or single quotes when creating the string to be escaped:<br />
<br />
$test = 'This is one line\r\nand this is another\r\nand this line has\ta tab';<br />
<br />
echo $test;<br />
echo "\r\n\r\n";<br />
echo addslashes($test);<br />
<br />
$test = "This is one line\r\nand this is another\r\nand this line has\ta tab";<br />
<br />
echo $test;<br />
echo "\r\n\r\n";<br />
echo addslashes($test);</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="87506""></a>
  <div class="note">
   <strong class="user">Taslim Sohel (sohel62 at yahoo dot com)</strong>
   <a href="#87506" class="date">08-Dec-2008 07:09</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
About Raymond and Aditya's post<br />
<br />
Following code can help you to add slashes with posted array.<br />
I just added a recursive function with Aditya's code.<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="comment">//create array to temporarily grab variables<br />
</span><span class="default">$input_arr </span><span class="keyword">= array();<br />
</span><span class="comment">//grabs the $_POST variables and adds slashes<br />
</span><span class="keyword">foreach (</span><span class="default">$_POST </span><span class="keyword">as </span><span class="default">$key </span><span class="keyword">=&gt; </span><span class="default">$input_arr</span><span class="keyword">) {<br />
&nbsp;&nbsp;&nbsp; if(</span><span class="default">is_array</span><span class="keyword">(</span><span class="default">$input_arr</span><span class="keyword">)){&nbsp; &nbsp; &nbsp; &nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$_POST</span><span class="keyword">[</span><span class="default">$key</span><span class="keyword">] = </span><span class="default">addslashes_array</span><span class="keyword">(</span><span class="default">$input_arr</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; }else{<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$_POST</span><span class="keyword">[</span><span class="default">$key</span><span class="keyword">] = </span><span class="default">addslashes</span><span class="keyword">(</span><span class="default">$input_arr</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; <br />
}<br />
<br />
</span><span class="comment">// Recursive Function to add slashes with posted array.<br />
</span><span class="keyword">function </span><span class="default">addslashes_array</span><span class="keyword">(</span><span class="default">$input_arr</span><span class="keyword">){<br />
&nbsp;&nbsp;&nbsp; if(</span><span class="default">is_array</span><span class="keyword">(</span><span class="default">$input_arr</span><span class="keyword">)){<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$tmp </span><span class="keyword">= array();<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; foreach (</span><span class="default">$input_arr </span><span class="keyword">as </span><span class="default">$key1 </span><span class="keyword">=&gt; </span><span class="default">$val</span><span class="keyword">){<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$tmp</span><span class="keyword">[</span><span class="default">$key1</span><span class="keyword">] = </span><span class="default">addslashes_array</span><span class="keyword">(</span><span class="default">$val</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">$tmp</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }else{<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">addslashes</span><span class="keyword">(</span><span class="default">$input_arr</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; }<br />
}<br />
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="84027""></a>
  <div class="note">
   <strong class="user">Raymond Hofman</strong>
   <a href="#84027" class="date">24-Jun-2008 09:14</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
In addition to the post made by Aditya P Bhatt below. This code works fine for posting a single string but does not work for posting arrays.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="82120""></a>
  <div class="note">
   <strong class="user">Aditya P Bhatt (adityabhai at gmail dot com)</strong>
   <a href="#82120" class="date">28-Mar-2008 06:59</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Automagically add slashes to $_POST variables. It helps to prevent some sql injection attacks. Also works with $_GET variables. <br />
<br />
FILE NAME: input_cl.php<br />
<span class="default">&lt;?php<br />
</span><span class="comment">//create array to temporarily grab variables<br />
</span><span class="default">$input_arr </span><span class="keyword">= array();<br />
</span><span class="comment">//grabs the $_POST variables and adds slashes<br />
</span><span class="keyword">foreach (</span><span class="default">$_POST </span><span class="keyword">as </span><span class="default">$key </span><span class="keyword">=&gt; </span><span class="default">$input_arr</span><span class="keyword">) {<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$_POST</span><span class="keyword">[</span><span class="default">$key</span><span class="keyword">] = </span><span class="default">addslashes</span><span class="keyword">(</span><span class="default">$input_arr</span><span class="keyword">);<br />
}<br />
</span><span class="default">?&gt;<br />
</span><br />
Just put this at the top of your script that gets the variables. Here is an example.<br />
<br />
Usage Example<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">include(</span><span class="string">"input_cl.php"</span><span class="keyword">);<br />
</span><span class="comment">// all $_POST variables have slashes added to them<br />
</span><span class="default">$f_name </span><span class="keyword">= </span><span class="default">$_POST</span><span class="keyword">[</span><span class="string">"f_name"</span><span class="keyword">];<br />
</span><span class="default">$l_name </span><span class="keyword">= </span><span class="default">$_POST</span><span class="keyword">[</span><span class="string">"l_name"</span><span class="keyword">];<br />
</span><span class="default">$phone_num </span><span class="keyword">= </span><span class="default">$_POST</span><span class="keyword">[</span><span class="string">"phone_num"</span><span class="keyword">];<br />
</span><span class="default">$address1 </span><span class="keyword">= </span><span class="default">$_POST</span><span class="keyword">[</span><span class="string">"address1"</span><span class="keyword">];<br />
</span><span class="default">$address2 </span><span class="keyword">= </span><span class="default">$_POST</span><span class="keyword">[</span><span class="string">"address2"</span><span class="keyword">];<br />
</span><span class="default">$city </span><span class="keyword">= </span><span class="default">$_POST</span><span class="keyword">[</span><span class="string">"city"</span><span class="keyword">];<br />
</span><span class="default">$State </span><span class="keyword">= </span><span class="default">$_POST</span><span class="keyword">[</span><span class="string">"State"</span><span class="keyword">];<br />
</span><span class="default">$zip </span><span class="keyword">= </span><span class="default">$_POST</span><span class="keyword">[</span><span class="string">"zip"</span><span class="keyword">];<br />
<br />
</span><span class="comment">//sql insert code goes here.<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="75347""></a>
  <div class="note">
   <strong class="user">Nate from RuggFamily.com</strong>
   <a href="#75347" class="date">25-May-2007 04:19</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If you want to add slashes to special symbols that would interfere with a regular expression (i.e., . \ + * ? [ ^ ] $ ( ) { } = ! &lt; &gt; | :), you should use the preg_quote() function.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="74801""></a>
  <div class="note">
   <strong class="user">yoder2 at purdue dot edu</strong>
   <a href="#74801" class="date">27-Apr-2007 09:23</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
to quote boris-pieper AT t-online DOT de, 15-Jan-2005 06:07,<br />
<br />
Note: You should use mysql_real_escape_string() (<a href="http://php.net/mysql_real_escape_string" rel="nofollow" target="_blank">http://php.net/mysql_real_escape_string</a>) if possible (PHP =&gt; 4.3.0) instead of mysql_escape_string().<br />
<br />
You may also want to us it instead of addslashes.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="74016""></a>
  <div class="note">
   <strong class="user">sam dot fullman at verizon</strong>
   <a href="#74016" class="date">20-Mar-2007 11:37</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
There are other functions "kind of" like this one but this should help adding slashes to a form post which also contains arrays (and you can't access runtime quotes), or you need to add slashes to an array which is already stripped:<br />
<br />
<span class="default">&lt;?php<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">function </span><span class="default">addslashes_array</span><span class="keyword">(</span><span class="default">$a</span><span class="keyword">){<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if(</span><span class="default">is_array</span><span class="keyword">(</span><span class="default">$a</span><span class="keyword">)){<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; foreach(</span><span class="default">$a </span><span class="keyword">as </span><span class="default">$n</span><span class="keyword">=&gt;</span><span class="default">$v</span><span class="keyword">){<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$b</span><span class="keyword">[</span><span class="default">$n</span><span class="keyword">]=</span><span class="default">addslashes_array</span><span class="keyword">(</span><span class="default">$v</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">$b</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }else{<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">addslashes</span><span class="keyword">(</span><span class="default">$a</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; }<br />
</span><span class="default">?&gt;<br />
</span><br />
note this does not add slashes to the keys - you could easily modify to do this..</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="73605""></a>
  <div class="note">
   <strong class="user">Adrian C</strong>
   <a href="#73605" class="date">03-Mar-2007 03:06</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
What happends when you add addslashes(addslashes($str))? This is not a good thing and it may be fixed:<br />
<br />
function checkaddslashes($str){&nbsp; &nbsp; &nbsp; &nbsp; <br />
&nbsp;&nbsp;&nbsp; if(strpos(str_replace("\'",""," $str"),"'")!=false)<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return addslashes($str);<br />
&nbsp;&nbsp;&nbsp; else<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return $str;<br />
}<br />
<br />
checkaddslashes("aa'bb");&nbsp; =&gt; aa\'bb<br />
checkaddslashes("aa\'bb"); =&gt; aa\'bb<br />
checkaddslashes("\'"); =&gt; \'<br />
checkaddslashes("'");&nbsp; =&gt; \'<br />
<br />
Hope this will help you</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="69574""></a>
  <div class="note">
   <strong class="user">pulstar at ig dot com dot br</strong>
   <a href="#69574" class="date">11-Sep-2006 04:50</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
May it is better use the function mysql_real_escape_string instead of addslashes when inserting data into a MySQL database. Check it at:<br />
<br />
<a href="http://www.php.net/manual/en/function.mysql-real-escape-string.php" rel="nofollow" target="_blank">http://www.php.net/manual/en/function.mysql-real-escape-string.php</a></span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="69020""></a>
  <div class="note">
   <strong class="user">joechrz at gmail dot com</strong>
   <a href="#69020" class="date">20-Aug-2006 02:36</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Here's an example of a function that prevents double-quoting, I'm surprised noone has put something like this up yet... (also works on arrays)<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">function </span><span class="default">escape_quotes</span><span class="keyword">(</span><span class="default">$receive</span><span class="keyword">) {<br />
&nbsp;&nbsp;&nbsp; if (!</span><span class="default">is_array</span><span class="keyword">(</span><span class="default">$receive</span><span class="keyword">))<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$thearray </span><span class="keyword">= array(</span><span class="default">$receive</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; else<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$thearray </span><span class="keyword">= </span><span class="default">$receive</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; foreach (</span><span class="default">array_keys</span><span class="keyword">(</span><span class="default">$thearray</span><span class="keyword">) as </span><span class="default">$string</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$thearray</span><span class="keyword">[</span><span class="default">$string</span><span class="keyword">] = </span><span class="default">addslashes</span><span class="keyword">(</span><span class="default">$thearray</span><span class="keyword">[</span><span class="default">$string</span><span class="keyword">]);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$thearray</span><span class="keyword">[</span><span class="default">$string</span><span class="keyword">] = </span><span class="default">preg_replace</span><span class="keyword">(</span><span class="string">"/[\\/]+/"</span><span class="keyword">,</span><span class="string">"/"</span><span class="keyword">,</span><span class="default">$thearray</span><span class="keyword">[</span><span class="default">$string</span><span class="keyword">]);<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; if (!</span><span class="default">is_array</span><span class="keyword">(</span><span class="default">$receive</span><span class="keyword">)) <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">$thearray</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">];<br />
&nbsp;&nbsp;&nbsp; else<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">$thearray</span><span class="keyword">;<br />
}<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="66509""></a>
  <div class="note">
   <strong class="user">Picky</strong>
   <a href="#66509" class="date">24-May-2006 09:55</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
This function is deprecated in PHP 4.0, according to this article:<br />
<br />
<a href="http://www.newsforge.com/article.pl?sid=06/05/23/2141246" rel="nofollow" target="_blank">http://www.newsforge.com/article.pl?sid=06/05/23/2141246</a><br />
<br />
Also, it is worth mentioning that PostgreSQL will soon start to block queries involving escaped single quotes using \ as the escape character, for some cases, which depends on the string's encoding.&nbsp; The standard way to escape quotes in SQL (not all SQL databases, mind you) is by changing single quotes into two single quotes (e.g, ' ' ' becomes ' '' ' for queries).<br />
<br />
You should look into other ways for escaping strings, such as "mysql_real_escape_string" (see the comment below), and other such database specific escape functions.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="58315""></a>
  <div class="note">
   <strong class="user">luciano at vittoretti dot com dot br</strong>
   <a href="#58315" class="date">31-Oct-2005 12:18</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Note, this function wont work with mssql or access queries.<br />
Use the function above (work with arrays too).<br />
<br />
function addslashes_mssql($str){<br />
&nbsp;&nbsp;&nbsp; if (is_array($str)) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; foreach($str AS $id =&gt; $value) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $str[$id] = addslashes_mssql($value);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; } else {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $str = str_replace("'", "''", $str);&nbsp; &nbsp; <br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; return $str;<br />
}<br />
<br />
function stripslashes_mssql($str){<br />
&nbsp;&nbsp;&nbsp; if (is_array($str)) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; foreach($str AS $id =&gt; $value) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $str[$id] = stripslashes_mssql($value);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; } else {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $str = str_replace("''", "'", $str);&nbsp; &nbsp; <br />
&nbsp;&nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp;&nbsp; return $str;<br />
}</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="57183""></a>
  <div class="note">
   <strong class="user">thisisroot at gmail dot com</strong>
   <a href="#57183" class="date">26-Sep-2005 06:30</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
In response to Krasimir Slavov and Luiz Miguel Axcar:<br />
<br />
There are several encoding schemes for inserting binary data into places it doesn't typically belong, such as databases and e-mail bodies. Check out the base64_encode() and convert_uuencode() functions for the details.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="56848""></a>
  <div class="note">
   <strong class="user">Krasimir Slavov kkslavov at yahoo dot com</strong>
   <a href="#56848" class="date">16-Sep-2005 08:51</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If you have problems with adding images or other binady data with addslashes() for php 4.3 &gt;= use:<br />
<br />
<span class="default">&lt;?php<br />
$search </span><span class="keyword">= array(</span><span class="string">"\x00"</span><span class="keyword">, </span><span class="string">"\x0a"</span><span class="keyword">, </span><span class="string">"\x0d"</span><span class="keyword">, </span><span class="string">"\x1a"</span><span class="keyword">, </span><span class="string">"\x09"</span><span class="keyword">);<br />
</span><span class="default">$replace </span><span class="keyword">= array(</span><span class="string">'\0'</span><span class="keyword">, </span><span class="string">'\n'</span><span class="keyword">, </span><span class="string">'\r'</span><span class="keyword">, </span><span class="string">'\Z' </span><span class="keyword">, </span><span class="string">'\t'</span><span class="keyword">);<br />
<br />
</span><span class="default">$chrData </span><span class="keyword">.= </span><span class="default">str_replace</span><span class="keyword">(</span><span class="default">$search</span><span class="keyword">, </span><span class="default">$replace</span><span class="keyword">, </span><span class="default">$Data </span><span class="keyword">);<br />
</span><span class="default">?&gt;<br />
</span><br />
and put in your SQL field='$chrData' ! please remark quotes</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="56401""></a>
  <div class="note">
   <strong class="user">Luiz Miguel Axcar (lmaxcar at yahoo dot com dot br)</strong>
   <a href="#56401" class="date">01-Sep-2005 03:16</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Hello,<br />
<br />
If you are getting trouble to SGDB write/read HTML data, try to use this:<br />
<br />
<span class="default">&lt;?php<br />
<br />
</span><span class="comment">//from html_entity_decode() manual page<br />
</span><span class="keyword">function </span><span class="default">unhtmlentities </span><span class="keyword">(</span><span class="default">$string</span><span class="keyword">) {<br />
&nbsp;&nbsp; </span><span class="default">$trans_tbl </span><span class="keyword">=</span><span class="default">get_html_translation_table </span><span class="keyword">(</span><span class="default">HTML_ENTITIES </span><span class="keyword">);<br />
&nbsp;&nbsp; </span><span class="default">$trans_tbl </span><span class="keyword">=</span><span class="default">array_flip </span><span class="keyword">(</span><span class="default">$trans_tbl </span><span class="keyword">);<br />
&nbsp;&nbsp; return </span><span class="default">strtr </span><span class="keyword">(</span><span class="default">$string </span><span class="keyword">,</span><span class="default">$trans_tbl </span><span class="keyword">);<br />
}<br />
<br />
</span><span class="comment">//read from db<br />
</span><span class="default">$content </span><span class="keyword">= </span><span class="default">stripslashes </span><span class="keyword">(</span><span class="default">htmlspecialchars </span><span class="keyword">(</span><span class="default">$field</span><span class="keyword">[</span><span class="string">'content'</span><span class="keyword">]));<br />
<br />
</span><span class="comment">//write to db<br />
</span><span class="default">$content </span><span class="keyword">= </span><span class="default">unhtmlentities </span><span class="keyword">(</span><span class="default">addslashes </span><span class="keyword">(</span><span class="default">trim </span><span class="keyword">(</span><span class="default">$_POST</span><span class="keyword">[</span><span class="string">'content'</span><span class="keyword">])));<br />
<br />
</span><span class="comment">//make sure result of function get_magic_quotes_gpc () == 0, you can get strange slashes in your content adding slashes twice<br />
<br />
//better to do this using addslashes<br />
</span><span class="default">$content </span><span class="keyword">= (! </span><span class="default">get_magic_quotes_gpc </span><span class="keyword">()) ? </span><span class="default">addslashes </span><span class="keyword">(</span><span class="default">$content</span><span class="keyword">) : </span><span class="default">$content</span><span class="keyword">;<br />
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="52435""></a>
  <div class="note">
   <strong class="user">unsafed</strong>
   <a href="#52435" class="date">01-May-2005 05:23</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
addslashes does NOT make your input safe for use in a database query! It only escapes according to what PHP defines, not what your database driver defines. Any use of this function to escape strings for use in a database is likely an error - mysql_real_escape_string, pg_escape_string, etc, should be used depending on your underlying database as each database has different escaping requirements. In particular, MySQL wants \n, \r and \x1a escaped which addslashes does NOT do. Therefore relying on addslashes is not a good idea at all and may make your code vulnerable to security risks. I really don't see what this function is supposed to do.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="47219""></a>
  <div class="note">
   <strong class="user">gv</strong>
   <a href="#47219" class="date">07-Nov-2004 02:23</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Regarding the previous note using addslashes/stripslahes with regular expressions and databases it looks as if the purpose of these functions gets mixed.<br />
<br />
addslahes encodes data to be sent to a database or something similar. Here you need addslashes because you send commands to the database as command strings that contain data and thus you have to escape characters that are special in the command language like SQL.<br />
<br />
Therefore the use of addslahses on a regex does properly store the regex in the database.<br />
<br />
stripslashes does the opposite: it decodes an addslashes encoded string. However, retrieving data from a database works differently: it does not go through some string interpretation because you actually retrieve your binary data in your variables. In other words: the data stored in your variable is the unmodified binary data that your database returned. You do not run stripslahes on data returned from a database. That way, the regexs are retrieved correctly, too.<br />
<br />
This is different from other data exchange like urlencoded strings that you exchange with your browser. Here the data channel uses the same encodings in both directions: therefore you have to encode data to be sent and you have to decode data received.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="46023""></a>
  <div class="note">
   <strong class="user">mark at hagers dot demon dot nl</strong>
   <a href="#46023" class="date">27-Sep-2004 12:34</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I was stumped for a long time by the fact that even when using addslashes and stripslashes explicitly on the field values double quotes (") still didn't seem to show up in strings read from a database. Until I looked at the source, and realised that the field value is just truncated at the first occurrence of a double quote. the remainder of the string is there (in the source), but is ignored when the form is displayed and submitted.<br />
<br />
This can easily be solved by replacing double quotes with "&amp;quot;" when building the form. like this:<br />
$fld_value =&nbsp; str_replace ( "\"", "&amp;quot;", $src_string ) ;<br />
The reverse replacement after the form submission is not necessary.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="33975""></a>
  <div class="note">
   <strong class="user">hazy underscore fakie at ringwraith dot org</strong>
   <a href="#33975" class="date">12-Jul-2003 08:23</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Note that when using addslashes() on a string that includes cyrillic characters, addslashes() totally mixes up the string, rendering it unusable.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="31107""></a>
  <div class="note">
   <strong class="user">phil at internetprojectmanagers dot com</strong>
   <a href="#31107" class="date">10-Apr-2003 03:46</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
re: problem with mcrypt, addslashes and mysql
<br />

<br />
Here is my solution to the problem of characters from mcrypt creating issues with mysql calls (due to characters which aren't cleaned up by addslashes).
<br />

<br />
Solution: simply convert your encryption string to hex, then back to binary when you are ready to decrypt.
<br />

<br />
<span class="default">&lt;?php
<br />
</span><span class="comment">// ie.
<br />
</span><span class="default">$encrypted </span><span class="keyword">= </span><span class="default">addslashes</span><span class="keyword">(</span><span class="default">$string</span><span class="keyword">);&nbsp; &nbsp; 
<br />
</span><span class="default">$encrypted </span><span class="keyword">= </span><span class="default">bin2hex</span><span class="keyword">(</span><span class="default">$encrypted</span><span class="keyword">);
<br />

<br />
</span><span class="comment">// ... then:
<br />
</span><span class="default">$decrypted </span><span class="keyword">= </span><span class="default">hex2bin</span><span class="keyword">(</span><span class="default">$encrypted</span><span class="keyword">);
<br />
</span><span class="default">$decrypted </span><span class="keyword">= </span><span class="default">stripslashes</span><span class="keyword">(</span><span class="default">$decrypted</span><span class="keyword">);
<br />

<br />
</span><span class="comment">// where hex2bin() is:
<br />
</span><span class="keyword">function </span><span class="default">hex2bin</span><span class="keyword">(</span><span class="default">$hexdata</span><span class="keyword">) {
<br />
&nbsp; </span><span class="default">$bindata</span><span class="keyword">=</span><span class="string">""</span><span class="keyword">;
<br />
&nbsp; 
<br />
&nbsp; for (</span><span class="default">$i</span><span class="keyword">=</span><span class="default">0</span><span class="keyword">;</span><span class="default">$i</span><span class="keyword">&lt;</span><span class="default">strlen</span><span class="keyword">(</span><span class="default">$hexdata</span><span class="keyword">);</span><span class="default">$i</span><span class="keyword">+=</span><span class="default">2</span><span class="keyword">) {
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$bindata</span><span class="keyword">.=</span><span class="default">chr</span><span class="keyword">(</span><span class="default">hexdec</span><span class="keyword">(</span><span class="default">substr</span><span class="keyword">(</span><span class="default">$hexdata</span><span class="keyword">,</span><span class="default">$i</span><span class="keyword">,</span><span class="default">2</span><span class="keyword">)));
<br />
&nbsp; }
<br />

<br />
&nbsp; return </span><span class="default">$bindata</span><span class="keyword">;
<br />
}
<br />
</span><span class="default">?&gt;
<br />
</span>
<br />
One word of caution: this will increase the length of your initial data string, so you will need to increase the field length for your mysql database.
<br />

<br />
Cheers, Phil
<br />
PS. I knew that I'd eventually be able to give something back to the site!</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="31105""></a>
  <div class="note">
   <strong class="user">phil at internetprojectmanagers dot com</strong>
   <a href="#31105" class="date">10-Apr-2003 01:47</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
re: encryption, addslashes and mysql<br />
<br />
Note that mcrypt encryption may add in an apostrophe from the ascii table which cannot be protected by addslashes. It may not even be on your keyboard.<br />
<br />
Because encryption strings are random, you may not discover it unless you test (or stumble?) on the correct sequence which inserts an apostrophe in the encrypted string. <br />
<br />
This means that testing is even more important where encryption is concerned. If I create a solution I'll post it here.<br />
<br />
Phil</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="28626""></a>
  <div class="note">
   <strong class="user">steve at teamITS dot com</strong>
   <a href="#28626" class="date">18-Jan-2003 02:53</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
For thelogrus, my testing shows the opposite--that a slashed string is stored correctly by MySQL.&nbsp; Consider<br />
<br />
insert into test (field1) values ('test\'test')<br />
<br />
...which is stored as "test'test".&nbsp; If you were posting "Sir'Weaser" from a form to your script and have magic_quotes_gpc on, then the string is slashed already so if you run addslashes() again you will be entering "Sir\\'Weaser" into MySQL.&nbsp; In that case "Sir\'Weaser" would be the correct output.<br />
<br />
In summary, addslashes() is not necessary if magic_quotes_gpc is on.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="26782""></a>
  <div class="note">
   <strong class="user">hoskerr at nukote dot com</strong>
   <a href="#26782" class="date">13-Nov-2002 12:16</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Beware of using addslashes() on input to the serialize() function.&nbsp;&nbsp; serialize() stores strings with their length; the length must match the stored string or unserialize() will fail.&nbsp; 
<br />

<br />
Such a mismatch can occur if you serialize the result of addslashes() and store it in a database; some databases (definitely including PostgreSQL) automagically strip backslashes from "special" chars in SELECT results, causing the returned string to be shorter than it was when it was serialized.
<br />

<br />
In other words, do this...
<br />

<br />
<span class="default">&lt;?php
<br />
$string</span><span class="keyword">=</span><span class="string">"O'Reilly"</span><span class="keyword">;
<br />
</span><span class="default">$ser</span><span class="keyword">=</span><span class="default">serialize</span><span class="keyword">(</span><span class="default">$string</span><span class="keyword">);&nbsp; &nbsp; </span><span class="comment"># safe -- won't count the slash
<br />
</span><span class="default">$result</span><span class="keyword">=</span><span class="default">addslashes</span><span class="keyword">(</span><span class="default">$ser</span><span class="keyword">); 
<br />
</span><span class="default">?&gt;
<br />
</span>
<br />
...and not this...
<br />

<br />
<span class="default">&lt;?php
<br />
$string</span><span class="keyword">=</span><span class="string">"O'Reilly"</span><span class="keyword">;
<br />
</span><span class="default">$add</span><span class="keyword">=</span><span class="default">addslashes</span><span class="keyword">(</span><span class="default">$string</span><span class="keyword">);&nbsp;&nbsp; </span><span class="comment"># RISKY!&nbsp; -- will count the slash
<br />
</span><span class="default">$result</span><span class="keyword">=</span><span class="default">serialize</span><span class="keyword">(</span><span class="default">$add</span><span class="keyword">);
<br />
</span><span class="default">?&gt;
<br />
</span>
<br />
In both cases, a backslash will be added after the apostrophe in "O'Reilly"; only in the second case will the backslash be included in the string length as recorded by serialize().
<br />

<br />
[Note to the maintainers: You may, at your option, want to link this note to serialize() as well as to addslashes().&nbsp; I'll refrain from doing such cross-posting myself...]</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="26432""></a>
  <div class="note">
   <strong class="user">php at slamb dot org</strong>
   <a href="#26432" class="date">30-Oct-2002 07:48</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
spamdunk at home dot com, your way is dangerous on PostgreSQL (and presumably MySQL). You're quite correct that ANSI SQL specifies using ' to escape, but those databases also support \ for escaping (in violation of the standard, I think). Which means that if they pass in a string that includes a "\'", you expand it to "\'''" (an escaped quote followed by a non-escaped quote. WRONG! Attackers can execute arbitrary SQL to drop your tables, make themselves administrators, whatever they want.)
<br />

<br />
The best way to be safe and correct is to:
<br />

<br />
- don't use magic quotes; this approach is bad. For starters, that's making the assumption that you will be using your input in a database query, which is arbitrary. (Why not escape all "&lt;"s with "&amp;lt;"s instead? Cross-site scripting attacks are quite common as well.) It's better to set up a way that does whatever escaping is correct for you when you use it, as below:
<br />

<br />
- when inserting into the database, use prepared statements with placeholders. For example, when using PEAR DB:
<br />

<br />
<span class="default">&lt;?php
<br />
&nbsp;&nbsp;&nbsp; $stmt </span><span class="keyword">= </span><span class="default">$dbh</span><span class="keyword">-&gt;</span><span class="default">prepare</span><span class="keyword">(</span><span class="string">'update mb_users set password = ? where username = ?'</span><span class="keyword">);
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$dbh</span><span class="keyword">-&gt;</span><span class="default">execute</span><span class="keyword">(</span><span class="default">$stmt</span><span class="keyword">, array(</span><span class="string">'12345'</span><span class="keyword">, </span><span class="string">'bob'</span><span class="keyword">));
<br />
</span><span class="default">?&gt;
<br />
</span>
<br />
Notice that there are no quotes around the ?s. It handles that for you automatically. It's guaranteed to be safe for your database. (Just ' on oracle, \ and ' on PostgreSQL, but you don't even have to think about it.)
<br />

<br />
Plus, if the database supports prepared statements (the soon-to-be-released PostgreSQL 7.3, Oracle, etc), several executes on the same prepare can be faster, since it can reuse the same query plan. If it doesn't (MySQL, etc), this way falls back to quoting code that's specifically written for your database, avoiding the problem I mentioned above.
<br />

<br />
(Pardon my syntax if it's off. I'm not really a PHP programmer; this is something I know from similar things in Java, Perl, PL/SQL, Python, Visual Basic, etc.)</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="20325""></a>
  <div class="note">
   <strong class="user">guy_AT_datalink_DOT_net_DOT_au</strong>
   <a href="#20325" class="date">30-Mar-2002 10:58</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If you're trying to escape quotes in a javascript event as such:<br />
<br />
&lt;img src="foo.gif" OnMouseOver="alert('&lt;? print $myString ?&gt;')"&gt;<br />
<br />
It helps to perform this first:<br />
<br />
$myString = str_replace("'", "\'", $myString);<br />
$myString = str_replace('"', "'+String.fromCharCode(34)+'", $myString);</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="12810""></a>
  <div class="note">
   <strong class="user">hybrid at n0spam dot pearlmagik dot com</strong>
   <a href="#12810" class="date">09-May-2001 07:46</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Remember to slash underscores (_) and percent signs (%), too, if you're going use the LIKE operator on the variable or you'll get some unexpected results.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="12268""></a>
  <div class="note">
   <strong class="user">php at NO_SPAMj-w3 dot com</strong>
   <a href="#12268" class="date">03-Apr-2001 12:18</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
As mentioned, magic_quotes_gpc automatically adds slashes to POST and GET data and these slashes don't go in the database.&nbsp; BUT, be careful of this. If you have a form with an error check, make sure you strip the slashes if your form remembers the OK fields, so the user doesn't view these automagically added slashes.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
</div>
</div>
</div></div></body></html>
