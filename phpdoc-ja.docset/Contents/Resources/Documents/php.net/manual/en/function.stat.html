<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
 <head>
  <meta http-equiv="content-type" content="text/html; CHARSET=shift-jis">
  <title>ファイルに関する情報を取得する</title>

  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <link media="all" rel="stylesheet" type="text/css" href="style.css"/>
 </head>
 <body class="docs" class="docs"><div class="navbar navbar-fixed-top">
  <div class="navbar-inner clearfix">
    <ul class="nav" style="width: 100%">
      <li style="float: left;"><a href="function.set-file-buffer.html">≪ set_file_buffer</a></li>
      <li style="float: right;"><a href="function.symlink.html">symlink ≫</a></li>
    </ul>
  </div>
</div>
<div id="breadcrumbs" class="clearfix">
  <ul class="breadcrumbs-container">
    <li><a href="index.html">PHP Manual</a></li>
    <li><a href="ref.filesystem.html">ファイルシステム 関数</a></li>
    <li>ファイルに関する情報を取得する</li>
  </ul>
</div>
<div id="layout">
  <div id="layout-content"><div id="function.stat" class="refentry">
 <div class="refnamediv">
  <h1 class="refname">stat</h1>
  <p class="verinfo">(PHP 4, PHP 5)</p><p class="refpurpose"><span class="refname">stat</span> &mdash; <span class="dc-title">ファイルに関する情報を取得する</span></p>

 </div>
 
 <div class="refsect1 description" id="refsect1-function.stat-description">
  <h3 class="title">説明</h3>
  <div class="methodsynopsis dc-description">
   <span class="type">array</span> <span class="methodname"><strong>stat</strong></span>
    ( <span class="methodparam"><span class="type">string</span> <code class="parameter">$filename</code></span>
   )</div>

  <p class="para rdfs-comment">
   <code class="parameter">filename</code>で指定されたファイルに
   ついての統計情報を取得します。
   <code class="parameter">filename</code> がシンボリックリンクの場合、
   シンボリックリンクではなくファイルの実体の統計情報が返されます。
  </p>
  <p class="para">
   <span class="function"><a href="function.lstat.html" class="function">lstat()</a></span>
   はシンボリックリンクの統計情報を返すという違いを除いて
   <span class="function"><strong>stat()</strong></span> と等価です。
  </p>
 </div>


 <div class="refsect1 parameters" id="refsect1-function.stat-parameters">
  <h3 class="title">パラメータ</h3>
  <p class="para">
   <dl>

    
     <dt>
<code class="parameter">filename</code></dt>

     <dd>

      <p class="para">
       ファイルへのパス。
      </p>
     </dd>

    
   </dl>

  </p>
 </div>


 <div class="refsect1 returnvalues" id="refsect1-function.stat-returnvalues">
  <h3 class="title">返り値</h3>
  <p class="para">
   <table class="doctable table">
    <caption><strong><span class="function"><strong>stat()</strong></span> と <span class="function"><a href="function.fstat.html" class="function">fstat()</a></span>
    の結果のフォーマット</strong></caption>
    
     <thead>
      <tr>
       <th>数値</th>
       <th>連想配列</th>
       <th>説明</th>
      </tr>

     </thead>

     <tbody class="tbody">
      <tr>
       <td>0</td>
       <td>dev</td>
       <td>デバイス番号</td>
      </tr>

      <tr>
       <td>1</td>
       <td>ino</td>
       <td>inode 番号(*)</td>
      </tr>

      <tr>
       <td>2</td>
       <td>mode</td>
       <td>inode プロテクトモード</td>
      </tr>

      <tr>
       <td>3</td>
       <td>nlink</td>
       <td>リンク数</td>
      </tr>

      <tr>
       <td>4</td>
       <td>uid</td>
       <td>所有者のユーザー ID(*)</td>
      </tr>

      <tr>
       <td>5</td>
       <td>gid</td>
       <td>所有者のグループ ID(*)</td>
      </tr>

      <tr>
       <td>6</td>
       <td>rdev</td>
       <td>inode デバイス の場合、デバイスの種類</td>
      </tr>

      <tr>
       <td>7</td>
       <td>size</td>
       <td>バイト単位のサイズ</td>
      </tr>

      <tr>
       <td>8</td>
       <td>atime</td>
       <td>最終アクセス時間 (Unix タイムスタンプ)</td>
      </tr>

      <tr>
       <td>9</td>
       <td>mtime</td>
       <td>最終修正時間 (Unix タイムスタンプ)</td>
      </tr>

      <tr>
       <td>10</td>
       <td>ctime</td>
       <td>最終 inode 変更時間 (Unix タイムスタンプ)</td>
      </tr>

      <tr>
       <td>11</td>
       <td>blksize</td>
       <td>ファイル IO のブロックサイズ(**)</td>
      </tr>

      <tr>
       <td>12</td>
       <td>blocks</td>
       <td>512 バイトのブロックの確保数(**)</td>
      </tr>

     </tbody>
    
   </table>

   * Windows では常に 0 となります。
  </p>
  <p class="para">
   ** st_blksize タイプをサポートするシステムでのみ有効です。
   その他のシステム(例えば Windows)では -1 を返します。
  </p>
  <p class="para">
   <span class="function"><strong>stat()</strong></span> はエラーの場合 <strong><code>FALSE</code></strong> を返します。
  </p>
  <blockquote class="note"><p><strong class="note">注意</strong>: <span class="simpara">
    PHP の数値型は符号付整数であり、
    多くのプラットフォームでは 32 ビットの整数を取るため、
    ファイルシステム関数の中には
    2GB より大きなファイルについては期待とは違う値を返すものがあります。
   </span></p></blockquote>
 </div>


 <div class="refsect1 errors" id="refsect1-function.stat-errors">
  <h3 class="title">エラー / 例外</h3>
  <p class="para">
   失敗した場合は <strong><code>E_WARNING</code></strong> が発生します。
  </p>
 </div>


 <div class="refsect1 examples" id="refsect1-function.stat-examples">
  <h3 class="title">例</h3>
  <p class="para">
   <div class="example" id="example-2523">
    <p><strong>例1 <span class="function"><strong>stat()</strong></span> の例</strong></p>
    <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br /></span><span style="color: #FF8000">/*&nbsp;ファイルの状態を取得します&nbsp;*/<br /></span><span style="color: #0000BB">$stat&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">stat</span><span style="color: #007700">(</span><span style="color: #DD0000">'C:\php\php.exe'</span><span style="color: #007700">);<br /><br /></span><span style="color: #FF8000">/*<br />&nbsp;*&nbsp;ファイルのアクセス日時を表示します。<br />&nbsp;*&nbsp;これは&nbsp;fileatime()&nbsp;をコールするのと同じです<br />&nbsp;*/<br /></span><span style="color: #007700">echo&nbsp;</span><span style="color: #DD0000">'アクセス日時:&nbsp;'&nbsp;</span><span style="color: #007700">.&nbsp;</span><span style="color: #0000BB">$stat</span><span style="color: #007700">[</span><span style="color: #DD0000">'atime'</span><span style="color: #007700">];<br /><br /></span><span style="color: #FF8000">/*<br />&nbsp;*&nbsp;ファイルの更新日時を表示します。<br />&nbsp;*&nbsp;これは&nbsp;filemtime()&nbsp;をコールするのと同じです<br />&nbsp;*/<br /></span><span style="color: #007700">echo&nbsp;</span><span style="color: #DD0000">'更新日時:&nbsp;'&nbsp;</span><span style="color: #007700">.&nbsp;</span><span style="color: #0000BB">$stat</span><span style="color: #007700">[</span><span style="color: #DD0000">'mtime'</span><span style="color: #007700">];<br /><br /></span><span style="color: #FF8000">/*&nbsp;デバイス番号を表示します&nbsp;*/<br /></span><span style="color: #007700">echo&nbsp;</span><span style="color: #DD0000">'デバイス番号:&nbsp;'&nbsp;</span><span style="color: #007700">.&nbsp;</span><span style="color: #0000BB">$stat</span><span style="color: #007700">[</span><span style="color: #DD0000">'dev'</span><span style="color: #007700">];<br /></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
    </div>

   </div>
  </p>
  <p class="para">
   <div class="example" id="example-2524">
    <p><strong>例2 <span class="function"><strong>stat()</strong></span> の情報を <span class="function"><a href="function.touch.html" class="function">touch()</a></span> と組み合わせる例</strong></p>
    <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br /></span><span style="color: #FF8000">/*&nbsp;ファイルの状態を取得します&nbsp;*/<br /></span><span style="color: #0000BB">$stat&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">stat</span><span style="color: #007700">(</span><span style="color: #DD0000">'C:\php\php.exe'</span><span style="color: #007700">);<br /><br /></span><span style="color: #FF8000">/*&nbsp;情報の取得に失敗した?&nbsp;*/<br /></span><span style="color: #007700">if&nbsp;(!</span><span style="color: #0000BB">$stat</span><span style="color: #007700">)&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;echo&nbsp;</span><span style="color: #DD0000">'stat()&nbsp;のコールに失敗しました...'</span><span style="color: #007700">;<br />}&nbsp;else&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">/*<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;アクセス日時を、現在のアクセス日時の<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;一週間後に設定します<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$atime&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$stat</span><span style="color: #007700">[</span><span style="color: #DD0000">'atime'</span><span style="color: #007700">]&nbsp;+&nbsp;</span><span style="color: #0000BB">604800</span><span style="color: #007700">;<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">/*&nbsp;ファイルを作成します&nbsp;*/<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">if&nbsp;(!</span><span style="color: #0000BB">touch</span><span style="color: #007700">(</span><span style="color: #DD0000">'some_file.txt'</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">time</span><span style="color: #007700">(),&nbsp;</span><span style="color: #0000BB">$atime</span><span style="color: #007700">))&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;echo&nbsp;</span><span style="color: #DD0000">'ファイルの作成に失敗しました...'</span><span style="color: #007700">;<br />&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;else&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;echo&nbsp;</span><span style="color: #DD0000">'touch()&nbsp;が成功しました...'</span><span style="color: #007700">;<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br />}<br /></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
    </div>

   </div>
  </p>
 </div>


 <div class="refsect1 notes" id="refsect1-function.stat-notes">
  <h3 class="title">注意</h3>
  <blockquote class="note"><p><strong class="note">注意</strong>: <p class="para">時刻の精度は、
ファイルシステムによって異なることがあります。</p></p></blockquote>
  <blockquote class="note"><p><strong class="note">注意</strong>: <span class="simpara">この関数の結果は
キャッシュされます。詳細は、<span class="function"><a href="function.clearstatcache.html" class="function">clearstatcache()</a></span>
を参照してください。</span></p></blockquote>
  <div class="tip"><strong class="tip">ヒント</strong><p class="simpara">
<em>PHP 5.0.0</em> 以降、この関数は、
<em class="emphasis">何らかの</em> URL ラッパーと組合せて使用することができます。
どのラッパーが <span class="function"><strong>stat()</strong></span> ファミリーをサポートしているかを調べるには
<a href="wrappers.html" class="xref">サポートするプロトコル/ラッパー</a> を参照してください。</p></div>
 </div>


 <div class="refsect1 seealso" id="refsect1-function.stat-seealso">
  <h3 class="title">参考</h3>
  <p class="para">
   <ul class="simplelist">
    <li class="member"><span class="function"><a href="function.lstat.html" class="function" rel="rdfs-seeAlso">lstat()</a> - ファイルあるいはシンボリックリンクの情報を取得する</span></li>
    <li class="member"><span class="function"><a href="function.fstat.html" class="function" rel="rdfs-seeAlso">fstat()</a> - オープンしたファイルポインタからファイルに関する情報を取得する</span></li>
    <li class="member"><span class="function"><a href="function.filemtime.html" class="function" rel="rdfs-seeAlso">filemtime()</a> - ファイルの更新時刻を取得する</span></li>
    <li class="member"><span class="function"><a href="function.filegroup.html" class="function" rel="rdfs-seeAlso">filegroup()</a> - ファイルのグループを取得する</span></li>
   </ul>
  </p>
 </div>


</div><div id="usernotes">
 <div class="head">
  <h3 class="title">User Contributed Notes</h3>
 </div>
<div id="allnotes">  <a name="114191""></a>
  <div class="note">
   <strong class="user">webmaster at askapache dot com</strong>
   <a href="#114191" class="date">23-Jan-2014 02:16</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
On GNU/Linux you can retrieve the number of currently running processes on the machine by doing a stat for hard links on the '/proc' directory like so:<br />
<br />
$ stat -c '%h' /proc<br />
118<br />
<br />
You can do the same thing in php by doing a stat on /proc and grabbing the [3] 'nlink' - number of links in the returned array.<br />
<br />
Here is the function I'm using, it does a clearstatcache() when called more than once.<br />
<br />
<span class="default">&lt;?php<br />
<br />
</span><span class="comment">/**<br />
&nbsp;* Returns the number of running processes<br />
&nbsp;*<br />
&nbsp;* @link <a href="http://php.net/clearstatcache" rel="nofollow" target="_blank">http://php.net/clearstatcache</a><br />
&nbsp;* @link <a href="http://php.net/stat&nbsp; Description of stat syntax." rel="nofollow" target="_blank">http://php.net/stat&nbsp; Description of stat syntax.</a><br />
&nbsp;* @author <a href="http://www.askapache.com/php/get-number-running-proccesses.html" rel="nofollow" target="_blank">http://www.askapache.com/php/get-number-running-proccesses.html</a><br />
&nbsp;* @return int<br />
&nbsp;*/<br />
</span><span class="keyword">function </span><span class="default">get_process_count</span><span class="keyword">() {<br />
&nbsp; static </span><span class="default">$ver</span><span class="keyword">, </span><span class="default">$runs </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">;<br />
&nbsp; <br />
&nbsp; </span><span class="comment">// check if php version supports clearstatcache params, but only check once<br />
&nbsp; </span><span class="keyword">if ( </span><span class="default">is_null</span><span class="keyword">( </span><span class="default">$ver </span><span class="keyword">) )<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$ver </span><span class="keyword">= </span><span class="default">version_compare</span><span class="keyword">( </span><span class="default">PHP_VERSION</span><span class="keyword">, </span><span class="string">'5.3.0'</span><span class="keyword">, </span><span class="string">'&gt;=' </span><span class="keyword">);<br />
&nbsp;<br />
&nbsp; </span><span class="comment">// Only call clearstatcache() if function called more than once */<br />
&nbsp; </span><span class="keyword">if ( </span><span class="default">$runs</span><span class="keyword">++ &gt; </span><span class="default">0 </span><span class="keyword">) { </span><span class="comment">// checks if $runs &gt; 0, then increments $runs by one.<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; // if php version is &gt;= 5.3.0<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">if ( </span><span class="default">$ver </span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="default">clearstatcache</span><span class="keyword">( </span><span class="default">true</span><span class="keyword">, </span><span class="string">'/proc' </span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; } else {<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="comment">// if php version is &lt; 5.3.0<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="default">clearstatcache</span><span class="keyword">();<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp; }<br />
&nbsp; <br />
&nbsp; </span><span class="default">$stat </span><span class="keyword">= </span><span class="default">stat</span><span class="keyword">( </span><span class="string">'/proc' </span><span class="keyword">);<br />
&nbsp;<br />
&nbsp; </span><span class="comment">// if stat succeeds and nlink value is present return it, otherwise return 0<br />
&nbsp; </span><span class="keyword">return ( ( </span><span class="default">false </span><span class="keyword">!== </span><span class="default">$stat </span><span class="keyword">&amp;&amp; isset( </span><span class="default">$stat</span><span class="keyword">[</span><span class="default">3</span><span class="keyword">] ) ) ? </span><span class="default">$stat</span><span class="keyword">[</span><span class="default">3</span><span class="keyword">] : </span><span class="default">0 </span><span class="keyword">);<br />
}<br />
<br />
</span><span class="default">?&gt;<br />
</span><br />
Example #1 get_process_count() example<br />
<br />
<span class="default">&lt;?php<br />
$num_procs </span><span class="keyword">= </span><span class="default">get_process_count</span><span class="keyword">();<br />
</span><span class="default">var_dump</span><span class="keyword">( </span><span class="default">$num_procs </span><span class="keyword">);<br />
</span><span class="default">?&gt;<br />
</span><br />
The above example will output:<br />
<br />
int(118)<br />
<br />
Which is the number of processes that were running.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="87603""></a>
  <div class="note">
   <strong class="user">digitalaudiorock at hotmail dot com</strong>
   <a href="#87603" class="date">12-Dec-2008 05:23</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Regarding the stat() on files larger than 2GB on 32 bit systems not working, note that the behavior appears to differ between Linux and Windows.&nbsp; Under Windows there's so way to know whether or not this failed.<br />
<br />
It's been my experience that under Linux, performing a stat() on files that are too large for the integer size generates a warning and returns false.&nbsp; However under Windows it silently truncates the high order bits of the size resulting in an incorrect number.&nbsp; The only way you'd ever know it failed is in the event that the truncation happened to leave the sign bit on resulting in a negative size.&nbsp; That is, there is _no_ reliable way to know it failed.<br />
<br />
This is true of filesize() as well.<br />
<br />
Tom</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="87241""></a>
  <div class="note">
   <strong class="user">webmaster at askapache dot com</strong>
   <a href="#87241" class="date">26-Nov-2008 10:20</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
This is a souped up 'stat' function based on <br />
many user-submitted code snippets and <br />
@ <a href="http://www.askapache.com/security/chmod-stat.html " rel="nofollow" target="_blank">http://www.askapache.com/security/chmod-stat.html </a><br />
<br />
Give it a filename, and it returns an array like stat. <br />
<br />
<span class="default">&lt;?php<br />
<br />
</span><span class="keyword">function </span><span class="default">alt_stat</span><span class="keyword">(</span><span class="default">$file</span><span class="keyword">) {<br />
&nbsp;<br />
&nbsp;</span><span class="default">clearstatcache</span><span class="keyword">();<br />
&nbsp;</span><span class="default">$ss</span><span class="keyword">=@</span><span class="default">stat</span><span class="keyword">(</span><span class="default">$file</span><span class="keyword">);<br />
&nbsp;if(!</span><span class="default">$ss</span><span class="keyword">) return </span><span class="default">false</span><span class="keyword">; </span><span class="comment">//Couldnt stat file<br />
&nbsp;<br />
&nbsp;</span><span class="default">$ts</span><span class="keyword">=array(<br />
&nbsp; </span><span class="default">0140000</span><span class="keyword">=&gt;</span><span class="string">'ssocket'</span><span class="keyword">,<br />
&nbsp; </span><span class="default">0120000</span><span class="keyword">=&gt;</span><span class="string">'llink'</span><span class="keyword">,<br />
&nbsp; </span><span class="default">0100000</span><span class="keyword">=&gt;</span><span class="string">'-file'</span><span class="keyword">,<br />
&nbsp; </span><span class="default">0060000</span><span class="keyword">=&gt;</span><span class="string">'bblock'</span><span class="keyword">,<br />
&nbsp; </span><span class="default">0040000</span><span class="keyword">=&gt;</span><span class="string">'ddir'</span><span class="keyword">,<br />
&nbsp; </span><span class="default">0020000</span><span class="keyword">=&gt;</span><span class="string">'cchar'</span><span class="keyword">,<br />
&nbsp; </span><span class="default">0010000</span><span class="keyword">=&gt;</span><span class="string">'pfifo'<br />
&nbsp;</span><span class="keyword">);<br />
&nbsp;<br />
&nbsp;</span><span class="default">$p</span><span class="keyword">=</span><span class="default">$ss</span><span class="keyword">[</span><span class="string">'mode'</span><span class="keyword">];<br />
&nbsp;</span><span class="default">$t</span><span class="keyword">=</span><span class="default">decoct</span><span class="keyword">(</span><span class="default">$ss</span><span class="keyword">[</span><span class="string">'mode'</span><span class="keyword">] &amp; </span><span class="default">0170000</span><span class="keyword">); </span><span class="comment">// File Encoding Bit<br />
&nbsp;<br />
&nbsp;</span><span class="default">$str </span><span class="keyword">=(</span><span class="default">array_key_exists</span><span class="keyword">(</span><span class="default">octdec</span><span class="keyword">(</span><span class="default">$t</span><span class="keyword">),</span><span class="default">$ts</span><span class="keyword">))?</span><span class="default">$ts</span><span class="keyword">[</span><span class="default">octdec</span><span class="keyword">(</span><span class="default">$t</span><span class="keyword">)]{</span><span class="default">0</span><span class="keyword">}:</span><span class="string">'u'</span><span class="keyword">;<br />
&nbsp;</span><span class="default">$str</span><span class="keyword">.=((</span><span class="default">$p</span><span class="keyword">&amp;</span><span class="default">0x0100</span><span class="keyword">)?</span><span class="string">'r'</span><span class="keyword">:</span><span class="string">'-'</span><span class="keyword">).((</span><span class="default">$p</span><span class="keyword">&amp;</span><span class="default">0x0080</span><span class="keyword">)?</span><span class="string">'w'</span><span class="keyword">:</span><span class="string">'-'</span><span class="keyword">);<br />
&nbsp;</span><span class="default">$str</span><span class="keyword">.=((</span><span class="default">$p</span><span class="keyword">&amp;</span><span class="default">0x0040</span><span class="keyword">)?((</span><span class="default">$p</span><span class="keyword">&amp;</span><span class="default">0x0800</span><span class="keyword">)?</span><span class="string">'s'</span><span class="keyword">:</span><span class="string">'x'</span><span class="keyword">):((</span><span class="default">$p</span><span class="keyword">&amp;</span><span class="default">0x0800</span><span class="keyword">)?</span><span class="string">'S'</span><span class="keyword">:</span><span class="string">'-'</span><span class="keyword">));<br />
&nbsp;</span><span class="default">$str</span><span class="keyword">.=((</span><span class="default">$p</span><span class="keyword">&amp;</span><span class="default">0x0020</span><span class="keyword">)?</span><span class="string">'r'</span><span class="keyword">:</span><span class="string">'-'</span><span class="keyword">).((</span><span class="default">$p</span><span class="keyword">&amp;</span><span class="default">0x0010</span><span class="keyword">)?</span><span class="string">'w'</span><span class="keyword">:</span><span class="string">'-'</span><span class="keyword">);<br />
&nbsp;</span><span class="default">$str</span><span class="keyword">.=((</span><span class="default">$p</span><span class="keyword">&amp;</span><span class="default">0x0008</span><span class="keyword">)?((</span><span class="default">$p</span><span class="keyword">&amp;</span><span class="default">0x0400</span><span class="keyword">)?</span><span class="string">'s'</span><span class="keyword">:</span><span class="string">'x'</span><span class="keyword">):((</span><span class="default">$p</span><span class="keyword">&amp;</span><span class="default">0x0400</span><span class="keyword">)?</span><span class="string">'S'</span><span class="keyword">:</span><span class="string">'-'</span><span class="keyword">));<br />
&nbsp;</span><span class="default">$str</span><span class="keyword">.=((</span><span class="default">$p</span><span class="keyword">&amp;</span><span class="default">0x0004</span><span class="keyword">)?</span><span class="string">'r'</span><span class="keyword">:</span><span class="string">'-'</span><span class="keyword">).((</span><span class="default">$p</span><span class="keyword">&amp;</span><span class="default">0x0002</span><span class="keyword">)?</span><span class="string">'w'</span><span class="keyword">:</span><span class="string">'-'</span><span class="keyword">);<br />
&nbsp;</span><span class="default">$str</span><span class="keyword">.=((</span><span class="default">$p</span><span class="keyword">&amp;</span><span class="default">0x0001</span><span class="keyword">)?((</span><span class="default">$p</span><span class="keyword">&amp;</span><span class="default">0x0200</span><span class="keyword">)?</span><span class="string">'t'</span><span class="keyword">:</span><span class="string">'x'</span><span class="keyword">):((</span><span class="default">$p</span><span class="keyword">&amp;</span><span class="default">0x0200</span><span class="keyword">)?</span><span class="string">'T'</span><span class="keyword">:</span><span class="string">'-'</span><span class="keyword">));<br />
&nbsp;<br />
&nbsp;</span><span class="default">$s</span><span class="keyword">=array(<br />
&nbsp;</span><span class="string">'perms'</span><span class="keyword">=&gt;array(<br />
&nbsp; </span><span class="string">'umask'</span><span class="keyword">=&gt;</span><span class="default">sprintf</span><span class="keyword">(</span><span class="string">"%04o"</span><span class="keyword">,@</span><span class="default">umask</span><span class="keyword">()),<br />
&nbsp; </span><span class="string">'human'</span><span class="keyword">=&gt;</span><span class="default">$str</span><span class="keyword">,<br />
&nbsp; </span><span class="string">'octal1'</span><span class="keyword">=&gt;</span><span class="default">sprintf</span><span class="keyword">(</span><span class="string">"%o"</span><span class="keyword">, (</span><span class="default">$ss</span><span class="keyword">[</span><span class="string">'mode'</span><span class="keyword">] &amp; </span><span class="default">000777</span><span class="keyword">)),<br />
&nbsp; </span><span class="string">'octal2'</span><span class="keyword">=&gt;</span><span class="default">sprintf</span><span class="keyword">(</span><span class="string">"0%o"</span><span class="keyword">, </span><span class="default">0777 </span><span class="keyword">&amp; </span><span class="default">$p</span><span class="keyword">),<br />
&nbsp; </span><span class="string">'decimal'</span><span class="keyword">=&gt;</span><span class="default">sprintf</span><span class="keyword">(</span><span class="string">"%04o"</span><span class="keyword">, </span><span class="default">$p</span><span class="keyword">),<br />
&nbsp; </span><span class="string">'fileperms'</span><span class="keyword">=&gt;@</span><span class="default">fileperms</span><span class="keyword">(</span><span class="default">$file</span><span class="keyword">),<br />
&nbsp; </span><span class="string">'mode1'</span><span class="keyword">=&gt;</span><span class="default">$p</span><span class="keyword">,<br />
&nbsp; </span><span class="string">'mode2'</span><span class="keyword">=&gt;</span><span class="default">$ss</span><span class="keyword">[</span><span class="string">'mode'</span><span class="keyword">]),<br />
&nbsp;<br />
&nbsp;</span><span class="string">'owner'</span><span class="keyword">=&gt;array(<br />
&nbsp; </span><span class="string">'fileowner'</span><span class="keyword">=&gt;</span><span class="default">$ss</span><span class="keyword">[</span><span class="string">'uid'</span><span class="keyword">],<br />
&nbsp; </span><span class="string">'filegroup'</span><span class="keyword">=&gt;</span><span class="default">$ss</span><span class="keyword">[</span><span class="string">'gid'</span><span class="keyword">],<br />
&nbsp; </span><span class="string">'owner'</span><span class="keyword">=&gt;<br />
&nbsp; (</span><span class="default">function_exists</span><span class="keyword">(</span><span class="string">'posix_getpwuid'</span><span class="keyword">))?<br />
&nbsp; @</span><span class="default">posix_getpwuid</span><span class="keyword">(</span><span class="default">$ss</span><span class="keyword">[</span><span class="string">'uid'</span><span class="keyword">]):</span><span class="string">''</span><span class="keyword">,<br />
&nbsp; </span><span class="string">'group'</span><span class="keyword">=&gt;<br />
&nbsp; (</span><span class="default">function_exists</span><span class="keyword">(</span><span class="string">'posix_getgrgid'</span><span class="keyword">))?<br />
&nbsp; @</span><span class="default">posix_getgrgid</span><span class="keyword">(</span><span class="default">$ss</span><span class="keyword">[</span><span class="string">'gid'</span><span class="keyword">]):</span><span class="string">''<br />
&nbsp; </span><span class="keyword">),<br />
&nbsp;<br />
&nbsp;</span><span class="string">'file'</span><span class="keyword">=&gt;array(<br />
&nbsp; </span><span class="string">'filename'</span><span class="keyword">=&gt;</span><span class="default">$file</span><span class="keyword">,<br />
&nbsp; </span><span class="string">'realpath'</span><span class="keyword">=&gt;(@</span><span class="default">realpath</span><span class="keyword">(</span><span class="default">$file</span><span class="keyword">) != </span><span class="default">$file</span><span class="keyword">) ? @</span><span class="default">realpath</span><span class="keyword">(</span><span class="default">$file</span><span class="keyword">) : </span><span class="string">''</span><span class="keyword">,<br />
&nbsp; </span><span class="string">'dirname'</span><span class="keyword">=&gt;@</span><span class="default">dirname</span><span class="keyword">(</span><span class="default">$file</span><span class="keyword">),<br />
&nbsp; </span><span class="string">'basename'</span><span class="keyword">=&gt;@</span><span class="default">basename</span><span class="keyword">(</span><span class="default">$file</span><span class="keyword">)<br />
&nbsp; ),<br />
<br />
&nbsp;</span><span class="string">'filetype'</span><span class="keyword">=&gt;array(<br />
&nbsp; </span><span class="string">'type'</span><span class="keyword">=&gt;</span><span class="default">substr</span><span class="keyword">(</span><span class="default">$ts</span><span class="keyword">[</span><span class="default">octdec</span><span class="keyword">(</span><span class="default">$t</span><span class="keyword">)],</span><span class="default">1</span><span class="keyword">),<br />
&nbsp; </span><span class="string">'type_octal'</span><span class="keyword">=&gt;</span><span class="default">sprintf</span><span class="keyword">(</span><span class="string">"%07o"</span><span class="keyword">, </span><span class="default">octdec</span><span class="keyword">(</span><span class="default">$t</span><span class="keyword">)),<br />
&nbsp; </span><span class="string">'is_file'</span><span class="keyword">=&gt;@</span><span class="default">is_file</span><span class="keyword">(</span><span class="default">$file</span><span class="keyword">),<br />
&nbsp; </span><span class="string">'is_dir'</span><span class="keyword">=&gt;@</span><span class="default">is_dir</span><span class="keyword">(</span><span class="default">$file</span><span class="keyword">),<br />
&nbsp; </span><span class="string">'is_link'</span><span class="keyword">=&gt;@</span><span class="default">is_link</span><span class="keyword">(</span><span class="default">$file</span><span class="keyword">),<br />
&nbsp; </span><span class="string">'is_readable'</span><span class="keyword">=&gt; @</span><span class="default">is_readable</span><span class="keyword">(</span><span class="default">$file</span><span class="keyword">),<br />
&nbsp; </span><span class="string">'is_writable'</span><span class="keyword">=&gt; @</span><span class="default">is_writable</span><span class="keyword">(</span><span class="default">$file</span><span class="keyword">)<br />
&nbsp; ),<br />
&nbsp; <br />
&nbsp;</span><span class="string">'device'</span><span class="keyword">=&gt;array(<br />
&nbsp; </span><span class="string">'device'</span><span class="keyword">=&gt;</span><span class="default">$ss</span><span class="keyword">[</span><span class="string">'dev'</span><span class="keyword">], </span><span class="comment">//Device<br />
&nbsp; </span><span class="string">'device_number'</span><span class="keyword">=&gt;</span><span class="default">$ss</span><span class="keyword">[</span><span class="string">'rdev'</span><span class="keyword">], </span><span class="comment">//Device number, if device.<br />
&nbsp; </span><span class="string">'inode'</span><span class="keyword">=&gt;</span><span class="default">$ss</span><span class="keyword">[</span><span class="string">'ino'</span><span class="keyword">], </span><span class="comment">//File serial number<br />
&nbsp; </span><span class="string">'link_count'</span><span class="keyword">=&gt;</span><span class="default">$ss</span><span class="keyword">[</span><span class="string">'nlink'</span><span class="keyword">], </span><span class="comment">//link count<br />
&nbsp; </span><span class="string">'link_to'</span><span class="keyword">=&gt;(</span><span class="default">$s</span><span class="keyword">[</span><span class="string">'type'</span><span class="keyword">]==</span><span class="string">'link'</span><span class="keyword">) ? @</span><span class="default">readlink</span><span class="keyword">(</span><span class="default">$file</span><span class="keyword">) : </span><span class="string">''<br />
&nbsp; </span><span class="keyword">),<br />
&nbsp;<br />
&nbsp;</span><span class="string">'size'</span><span class="keyword">=&gt;array(<br />
&nbsp; </span><span class="string">'size'</span><span class="keyword">=&gt;</span><span class="default">$ss</span><span class="keyword">[</span><span class="string">'size'</span><span class="keyword">], </span><span class="comment">//Size of file, in bytes.<br />
&nbsp; </span><span class="string">'blocks'</span><span class="keyword">=&gt;</span><span class="default">$ss</span><span class="keyword">[</span><span class="string">'blocks'</span><span class="keyword">], </span><span class="comment">//Number 512-byte blocks allocated<br />
&nbsp; </span><span class="string">'block_size'</span><span class="keyword">=&gt; </span><span class="default">$ss</span><span class="keyword">[</span><span class="string">'blksize'</span><span class="keyword">] </span><span class="comment">//Optimal block size for I/O.<br />
&nbsp; </span><span class="keyword">), <br />
&nbsp;<br />
&nbsp;</span><span class="string">'time'</span><span class="keyword">=&gt;array(<br />
&nbsp; </span><span class="string">'mtime'</span><span class="keyword">=&gt;</span><span class="default">$ss</span><span class="keyword">[</span><span class="string">'mtime'</span><span class="keyword">], </span><span class="comment">//Time of last modification<br />
&nbsp; </span><span class="string">'atime'</span><span class="keyword">=&gt;</span><span class="default">$ss</span><span class="keyword">[</span><span class="string">'atime'</span><span class="keyword">], </span><span class="comment">//Time of last access.<br />
&nbsp; </span><span class="string">'ctime'</span><span class="keyword">=&gt;</span><span class="default">$ss</span><span class="keyword">[</span><span class="string">'ctime'</span><span class="keyword">], </span><span class="comment">//Time of last status change<br />
&nbsp; </span><span class="string">'accessed'</span><span class="keyword">=&gt;@</span><span class="default">date</span><span class="keyword">(</span><span class="string">'Y M D H:i:s'</span><span class="keyword">,</span><span class="default">$ss</span><span class="keyword">[</span><span class="string">'atime'</span><span class="keyword">]),<br />
&nbsp; </span><span class="string">'modified'</span><span class="keyword">=&gt;@</span><span class="default">date</span><span class="keyword">(</span><span class="string">'Y M D H:i:s'</span><span class="keyword">,</span><span class="default">$ss</span><span class="keyword">[</span><span class="string">'mtime'</span><span class="keyword">]),<br />
&nbsp; </span><span class="string">'created'</span><span class="keyword">=&gt;@</span><span class="default">date</span><span class="keyword">(</span><span class="string">'Y M D H:i:s'</span><span class="keyword">,</span><span class="default">$ss</span><span class="keyword">[</span><span class="string">'ctime'</span><span class="keyword">])<br />
&nbsp; ),<br />
&nbsp;);<br />
&nbsp;<br />
&nbsp;</span><span class="default">clearstatcache</span><span class="keyword">();<br />
&nbsp;return </span><span class="default">$s</span><span class="keyword">;<br />
}<br />
<br />
</span><span class="default">?&gt;<br />
</span><br />
|=---------[ Example Output ]<br />
<br />
Array(<br />
[perms] =&gt; Array<br />
&nbsp; (<br />
&nbsp; [umask] =&gt; 0022<br />
&nbsp; [human] =&gt; -rw-r--r--<br />
&nbsp; [octal1] =&gt; 644<br />
&nbsp; [octal2] =&gt; 0644<br />
&nbsp; [decimal] =&gt; 100644<br />
&nbsp; [fileperms] =&gt; 33188<br />
&nbsp; [mode1] =&gt; 33188<br />
&nbsp; [mode2] =&gt; 33188<br />
&nbsp; )<br />
&nbsp;<br />
[filetype] =&gt; Array<br />
&nbsp; (<br />
&nbsp; [type] =&gt; file<br />
&nbsp; [type_octal] =&gt; 0100000<br />
&nbsp; [is_file] =&gt; 1<br />
&nbsp; [is_dir] =&gt;<br />
&nbsp; [is_link] =&gt;<br />
&nbsp; [is_readable] =&gt; 1<br />
&nbsp; [is_writable] =&gt; 1<br />
&nbsp; )<br />
&nbsp;<br />
[owner] =&gt; Array<br />
&nbsp; (<br />
&nbsp; [fileowner] =&gt; 035483<br />
&nbsp; [filegroup] =&gt; 23472<br />
&nbsp; [owner_name] =&gt; askapache<br />
&nbsp; [group_name] =&gt; grp22558<br />
&nbsp; )<br />
&nbsp;<br />
[file] =&gt; Array<br />
&nbsp; (<br />
&nbsp; [filename] =&gt; /home/askapache/askapache-stat/htdocs/ok/g.php<br />
&nbsp; [realpath] =&gt;<br />
&nbsp; [dirname] =&gt; /home/askapache/askapache-stat/htdocs/ok<br />
&nbsp; [basename] =&gt; g.php<br />
&nbsp; )<br />
&nbsp;<br />
[device] =&gt; Array<br />
&nbsp; (<br />
&nbsp; [device] =&gt; 25<br />
&nbsp; [device_number] =&gt; 0<br />
&nbsp; [inode] =&gt; 92455020<br />
&nbsp; [link_count] =&gt; 1<br />
&nbsp; [link_to] =&gt;<br />
&nbsp; )<br />
&nbsp;<br />
[size] =&gt; Array<br />
&nbsp; (<br />
&nbsp; [size] =&gt; 2652<br />
&nbsp; [blocks] =&gt; 8<br />
&nbsp; [block_size] =&gt; 8192<br />
&nbsp; )<br />
&nbsp;<br />
[time] =&gt; Array<br />
&nbsp; (<br />
&nbsp; [mtime] =&gt; 1227685253<br />
&nbsp; [atime] =&gt; 1227685138<br />
&nbsp; [ctime] =&gt; 1227685253<br />
&nbsp; [accessed] =&gt; 2008 Nov Tue 23:38:58<br />
&nbsp; [modified] =&gt; 2008 Nov Tue 23:40:53<br />
&nbsp; [created] =&gt; 2008 Nov Tue 23:40:53<br />
&nbsp; )<br />
)</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="84596""></a>
  <div class="note">
   <strong class="user">antonixyz at gmx dot net</strong>
   <a href="#84596" class="date">21-Jul-2008 11:19</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
<span class="default">&lt;?php
<br />
$stat </span><span class="keyword">= </span><span class="default">stat</span><span class="keyword">(</span><span class="default">$filepath</span><span class="keyword">);
<br />
</span><span class="default">$mode </span><span class="keyword">= </span><span class="default">$stat</span><span class="keyword">[</span><span class="default">2</span><span class="keyword">];
<br />
</span><span class="default">?&gt;
<br />
</span>is identical to:
<br />
<span class="default">&lt;?php $mode </span><span class="keyword">= </span><span class="default">fileperms</span><span class="keyword">(</span><span class="default">$filepath</span><span class="keyword">); </span><span class="default">?&gt;
<br />
</span>
<br />
at least on my linux box.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="82759""></a>
  <div class="note">
   <strong class="user">mail4rico at gmail dot com</strong>
   <a href="#82759" class="date">24-Apr-2008 08:19</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
In response to the note whose first line is:<br />
Re note posted by "admin at smitelli dot com"<br />
<br />
I believe you have the conversion backwards. You should add an hour to filemtime if the system is in DST and the file is not. Conversely, you should subtract an hour if the file time is DST and the current OS time is not.<br />
<br />
Here's a simplified, corrected version:<br />
<span class="default">&lt;?php<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">function </span><span class="default">getmodtime</span><span class="keyword">(</span><span class="default">$file</span><span class="keyword">) { </span><span class="comment">//returns the time a file was modified.<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$mtime </span><span class="keyword">= </span><span class="default">filemtime</span><span class="keyword">(</span><span class="default">$file</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">//date('I') returns 1 if DST is on and 0 if off.<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$diff </span><span class="keyword">= </span><span class="default">date</span><span class="keyword">(</span><span class="string">'I'</span><span class="keyword">)-</span><span class="default">date</span><span class="keyword">(</span><span class="string">'I'</span><span class="keyword">, </span><span class="default">$mtime</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">//diff =&nbsp; 0 if file-time and os-time are both in the same DST setting<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; //diff =&nbsp; 1 if os is DST and file is not<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; //diff = -1 if file is DST and os is not<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">return </span><span class="default">$mtime </span><span class="keyword">+ </span><span class="default">$diff</span><span class="keyword">*</span><span class="default">3600</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }<br />
</span><span class="default">?&gt;<br />
</span>Here's a test:<br />
<span class="default">&lt;?php<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">//create two dummy files:<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$file0 </span><span class="keyword">= </span><span class="string">'file1.txt'</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$file1 </span><span class="keyword">= </span><span class="string">'file2.txt'</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">file_put_contents</span><span class="keyword">(</span><span class="default">$file0</span><span class="keyword">, </span><span class="string">''</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">file_put_contents</span><span class="keyword">(</span><span class="default">$file1</span><span class="keyword">, </span><span class="string">''</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$time0</span><span class="keyword">=</span><span class="default">strtotime</span><span class="keyword">(</span><span class="string">'Jan 1 2008 10:00'</span><span class="keyword">); echo </span><span class="string">'Date0 (ST): ' </span><span class="keyword">. </span><span class="default">date</span><span class="keyword">(</span><span class="default">DATE_COOKIE</span><span class="keyword">, </span><span class="default">$time0</span><span class="keyword">).</span><span class="string">"\n"</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$time1</span><span class="keyword">=</span><span class="default">strtotime</span><span class="keyword">(</span><span class="string">'Aug 1 2008 10:00'</span><span class="keyword">); echo </span><span class="string">'Date1 (DT): ' </span><span class="keyword">. </span><span class="default">date</span><span class="keyword">(</span><span class="default">DATE_COOKIE</span><span class="keyword">, </span><span class="default">$time1</span><span class="keyword">).</span><span class="string">"\n"</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">touch</span><span class="keyword">(</span><span class="default">$file0</span><span class="keyword">, </span><span class="default">$time0</span><span class="keyword">); </span><span class="comment">//set file0 to Winter (Non-DST)<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">touch</span><span class="keyword">(</span><span class="default">$file1</span><span class="keyword">, </span><span class="default">$time1</span><span class="keyword">); </span><span class="comment">//set file1 to Summer (DST)<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$ftime0 </span><span class="keyword">= </span><span class="default">filemtime</span><span class="keyword">(</span><span class="default">$file0</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$ftime1 </span><span class="keyword">= </span><span class="default">filemtime</span><span class="keyword">(</span><span class="default">$file1</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; echo </span><span class="string">"\nUncorrected: \n"</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; echo </span><span class="string">'File 0: ' </span><span class="keyword">. (</span><span class="default">$ftime0</span><span class="keyword">-</span><span class="default">$time0</span><span class="keyword">) .</span><span class="string">"\n"</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; echo </span><span class="string">'File 1: ' </span><span class="keyword">. (</span><span class="default">$ftime1</span><span class="keyword">-</span><span class="default">$time1</span><span class="keyword">) .</span><span class="string">"\n"</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">//if your system adjusts for DST, then _one_ of the above should be 3600 or -3600, depending on the time of year<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$ftime0 </span><span class="keyword">= </span><span class="default">getmodtime</span><span class="keyword">(</span><span class="default">$file0</span><span class="keyword">); </span><span class="comment">//use filemtime correction<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$ftime1 </span><span class="keyword">= </span><span class="default">getmodtime</span><span class="keyword">(</span><span class="default">$file1</span><span class="keyword">); </span><span class="comment">//use filemtime correction<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">echo </span><span class="string">"\nCorrected: \n"</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; echo </span><span class="string">'File 0: ' </span><span class="keyword">. (</span><span class="default">$ftime0</span><span class="keyword">-</span><span class="default">$time0</span><span class="keyword">) .</span><span class="string">"\n"</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; echo </span><span class="string">'File 1: ' </span><span class="keyword">. (</span><span class="default">$ftime1</span><span class="keyword">-</span><span class="default">$time1</span><span class="keyword">) .</span><span class="string">"\n"</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">//both of the corrected values output should be 0.<br />
</span><span class="default">?&gt;<br />
</span><br />
Output:<br />
------------------------------<br />
(when run in summer)<br />
------------------------------<br />
Date0 (ST): Tuesday, 01-Jan-08 10:00:00 EST<br />
Date1 (DT): Friday, 01-Aug-08 10:00:00 EDT<br />
<br />
Uncorrected: <br />
File 0: -3600<br />
File 1: 0<br />
<br />
Corrected: <br />
File 0: 0<br />
File 1: 0<br />
------------------------------<br />
(when run in winter--dates omitted)<br />
------------------------------<br />
Uncorrected: <br />
File 0: 0<br />
File 1: 3600<br />
<br />
Corrected: <br />
File 0: 0<br />
File 1: 0<br />
<br />
In response to Re note posted by "admin at smitelli dot com",&nbsp; your version below gives the following output when substituted into my test:<br />
------------------------------<br />
(when run in summer--dates omitted)<br />
------------------------------<br />
Uncorrected: <br />
File 0: -3600<br />
File 1: 0<br />
<br />
Corrected: <br />
File 0: -7200<br />
File 1: 0<br />
------------------------------<br />
You can see that the operation is the opposite of what it should be.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="81534""></a>
  <div class="note">
   <strong class="user">Hellhound</strong>
   <a href="#81534" class="date">03-Mar-2008 11:16</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
To ignore index number or name specifics.. use:<br />
<br />
list($dev, $ino, $mode, $nlink, $uid, $gid, $rdev, $size, $atime, $mtime, $ctime, $blksize, $blocks)<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; = lstat($directory_element);</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="72725""></a>
  <div class="note">
   <strong class="user">JulieC</strong>
   <a href="#72725" class="date">31-Jan-2007 04:21</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
The dir_size function provided by "marting.dc AT gmail.com" works great, except the $mas variable is not initialized.&nbsp; Add:<br />
<br />
&nbsp;&nbsp; $mas = 0;<br />
<br />
before the while() loop.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="66175""></a>
  <div class="note">
   
   <a href="#66175" class="date">16-May-2006 07:10</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Re note posted by "admin at smitelli dot com"<br />
<br />
I'm not sure how that can work all year round since you have to modify both opposing inside and outside DST based on the actual files themselves, as well as the current DST setting for the system.<br />
<br />
e.g. using filemtime, same thing for stat.<br />
<br />
<span class="default">&lt;?php<br />
<br />
$mtime </span><span class="keyword">= </span><span class="default">filemtime</span><span class="keyword">(</span><span class="default">$file</span><span class="keyword">);<br />
<br />
if (</span><span class="default">date</span><span class="keyword">(</span><span class="string">'I'</span><span class="keyword">) == </span><span class="default">1</span><span class="keyword">) {<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">// Win DST is enabled, adjust standard time <br />
&nbsp;&nbsp;&nbsp; // files back to 'real' file UTC.<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">if (</span><span class="default">date</span><span class="keyword">(</span><span class="string">'I'</span><span class="keyword">, </span><span class="default">$mtime</span><span class="keyword">) == </span><span class="default">0</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$mtime </span><span class="keyword">-= </span><span class="default">3600</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }<br />
} else {<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">// Win DST is disabled, adjust daylight time <br />
&nbsp;&nbsp;&nbsp; // files forward to 'real' file UTC.<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">if (</span><span class="default">date</span><span class="keyword">(</span><span class="string">'I'</span><span class="keyword">, </span><span class="default">$mtime</span><span class="keyword">) == </span><span class="default">1</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$mtime </span><span class="keyword">+= </span><span class="default">3600</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }<br />
}<br />
<br />
echo </span><span class="default">gmdate</span><span class="keyword">(</span><span class="string">'Y-m-d H:i:s'</span><span class="keyword">, </span><span class="default">$mtime</span><span class="keyword">);<br />
<br />
</span><span class="default">?&gt;<br />
</span><br />
Just another example of why 'not' to use windows in a server room.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="61238""></a>
  <div class="note">
   <strong class="user">marting.dc AT gmail.com</strong>
   <a href="#61238" class="date">29-Jan-2006 02:08</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If you want to know a directory size, this function will help you:
<br />

<br />
<span class="default">&lt;?php
<br />
</span><span class="keyword">function </span><span class="default">dir_size</span><span class="keyword">(</span><span class="default">$dir</span><span class="keyword">)
<br />
{
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$handle </span><span class="keyword">= </span><span class="default">opendir</span><span class="keyword">(</span><span class="default">$dir</span><span class="keyword">);
<br />
&nbsp;&nbsp;&nbsp; 
<br />
&nbsp;&nbsp;&nbsp; while (</span><span class="default">$file </span><span class="keyword">= </span><span class="default">readdir</span><span class="keyword">(</span><span class="default">$handle</span><span class="keyword">)) {
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">$file </span><span class="keyword">!= </span><span class="string">'..' </span><span class="keyword">&amp;&amp; </span><span class="default">$file </span><span class="keyword">!= </span><span class="string">'.' </span><span class="keyword">&amp;&amp; !</span><span class="default">is_dir</span><span class="keyword">(</span><span class="default">$dir</span><span class="keyword">.</span><span class="string">'/'</span><span class="keyword">.</span><span class="default">$file</span><span class="keyword">)) {
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$mas </span><span class="keyword">+= </span><span class="default">filesize</span><span class="keyword">(</span><span class="default">$dir</span><span class="keyword">.</span><span class="string">'/'</span><span class="keyword">.</span><span class="default">$file</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; } else if (</span><span class="default">is_dir</span><span class="keyword">(</span><span class="default">$dir</span><span class="keyword">.</span><span class="string">'/'</span><span class="keyword">.</span><span class="default">$file</span><span class="keyword">) &amp;&amp; </span><span class="default">$file </span><span class="keyword">!= </span><span class="string">'..' </span><span class="keyword">&amp;&amp; </span><span class="default">$file </span><span class="keyword">!= </span><span class="string">'.'</span><span class="keyword">) {
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$mas </span><span class="keyword">+= </span><span class="default">dir_size</span><span class="keyword">(</span><span class="default">$dir</span><span class="keyword">.</span><span class="string">'/'</span><span class="keyword">.</span><span class="default">$file</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }
<br />
&nbsp;&nbsp;&nbsp; }
<br />
&nbsp;&nbsp;&nbsp; return </span><span class="default">$mas</span><span class="keyword">;
<br />
}
<br />
echo </span><span class="default">dir_size</span><span class="keyword">(</span><span class="string">'DIRECTORIO'</span><span class="keyword">).</span><span class="string">' Bytes'</span><span class="keyword">;
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="58404""></a>
  <div class="note">
   <strong class="user">admin at smitelli dot com</strong>
   <a href="#58404" class="date">03-Nov-2005 08:27</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
There's an important (yet little-known) problem with file dates on Windows and Daylight Savings. This affects the 'atime' and 'mtime' elements returned by stat(), and it also affects other filesystem-related functions such as fileatime() and filemtime().<br />
<br />
During the winter months (when Daylight Savings isn't in effect), Windows will report a certain timestamp for a given file. However, when summer comes and Daylight Savings starts, Windows will report a DIFFERENT timestamp! Even if the file hasn't been altered at all, Windows will shift every timestamp it reads forward one full hour during Daylight Savings.<br />
<br />
This all stems from the fact that M$ decided to use a hackneyed method of tracking file dates to make sure there are no ambiguous times during the "repeated hour" when DST ends in October, maintain compatibility with older FAT partitions, etc. An excellent description of what/why this is can be found at <a href="http://www.codeproject.com/datetime/dstbugs.asp" rel="nofollow" target="_blank">http://www.codeproject.com/datetime/dstbugs.asp</a><br />
<br />
This is noteworthy because *nix platforms don't have this problem. This could introduce some hard-to-track bugs if you're trying to move scripts that track file timestamps between platforms.<br />
<br />
I spent a fair amount of time trying to debug one of my own scripts that was suffering from this problem. I was storing file modification times in a MySQL table, then using that information to see which files had been altered since the last run of the script. After each Daylight Savings change, every single file the script saw was considered "changed" since the last run, since all the timestamps were off by +/- 3600 seconds.<br />
<br />
This one-liner is probably one of the most incorrect fixes that could ever be devised, but it's worked flawlessly in production-grade environments... Assuming $file_date is a Unix timestamp you've just read from a file:<br />
<br />
<span class="default">&lt;?php<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">if (</span><span class="default">date</span><span class="keyword">(</span><span class="string">'I'</span><span class="keyword">) == </span><span class="default">1</span><span class="keyword">) </span><span class="default">$file_date </span><span class="keyword">-= </span><span class="default">3600</span><span class="keyword">;<br />
</span><span class="default">?&gt;<br />
</span><br />
That will ensure that the timestamp you're working with is always consistently reported, regardless of whether the machine is in Daylight Savings or not.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="54999""></a>
  <div class="note">
   <strong class="user">com dot gmail at algofoogle</strong>
   <a href="#54999" class="date">22-Jul-2005 03:06</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Re note posted by "salisbm at hotmail dot com":<br />
<br />
S_IFDIR is not a single-bit flag. It is a constant that relies on the "S_IFMT" bitmask. This bitmask should be applied to the "mode" parameter before comparing with any of the other "S_IF..." constants, as indicated by stat.h:<br />
<br />
#define S_ISDIR(m)&nbsp; (((m) &amp; S_IFMT) == S_IFDIR)<br />
<br />
That is, this approach is incorrect:<br />
<br />
<span class="default">&lt;?php<br />
define</span><span class="keyword">(</span><span class="string">'S_IFDIR'</span><span class="keyword">,</span><span class="default">040000</span><span class="keyword">);<br />
if (</span><span class="default">$mode </span><span class="keyword">&amp; </span><span class="default">S_IFDIR</span><span class="keyword">)<br />
{<br />
&nbsp; </span><span class="comment">/*<br />
&nbsp;&nbsp;&nbsp; incorrect!<br />
&nbsp;&nbsp;&nbsp; format could be S_IFDIR, but also<br />
&nbsp;&nbsp;&nbsp; S_IFBLK, S_IFSOCK, or S_IFWHT.<br />
&nbsp; */<br />
</span><span class="keyword">}<br />
</span><span class="default">?&gt;<br />
</span><br />
...and should instead be:<br />
<br />
<span class="default">&lt;?php<br />
define</span><span class="keyword">(</span><span class="string">'S_IFMT'</span><span class="keyword">,</span><span class="default">0170000</span><span class="keyword">);<br />
</span><span class="default">define</span><span class="keyword">(</span><span class="string">'S_IFDIR'</span><span class="keyword">,</span><span class="default">040000</span><span class="keyword">);<br />
if (</span><span class="default">S_IFDIR </span><span class="keyword">== (</span><span class="default">$mode </span><span class="keyword">&amp; </span><span class="default">S_IFMT</span><span class="keyword">)) {&nbsp; </span><span class="comment">/* ... */&nbsp; </span><span class="keyword">}<br />
</span><span class="default">?&gt;<br />
</span><br />
As pointed out by "svend at svendtofte dot com", however, there is also the "is_dir" function for this purpose, along with "is_file" and "is_link" to cover the most common format types...</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="53614""></a>
  <div class="note">
   <strong class="user">mao at nospam dot com</strong>
   <a href="#53614" class="date">07-Jun-2005 02:53</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If you have ftp (and the related sftp) protocols disabled on your remote server, it can be hard figuring out how to 'stat' a remote file. The following works for me:<br />
<br />
<span class="default">&lt;?php&nbsp; <br />
<br />
$conn </span><span class="keyword">= </span><span class="default">ssh2_connect</span><span class="keyword">(</span><span class="default">$host</span><span class="keyword">, </span><span class="default">22</span><span class="keyword">);<br />
</span><span class="default">ssh2_auth_password</span><span class="keyword">(</span><span class="default">$conn</span><span class="keyword">, </span><span class="default">$user</span><span class="keyword">, </span><span class="default">$password</span><span class="keyword">);<br />
</span><span class="default">$stream </span><span class="keyword">= </span><span class="default">ssh2_exec</span><span class="keyword">(</span><span class="default">$conn</span><span class="keyword">, </span><span class="string">"stat </span><span class="default">$fileName</span><span class="string"> &gt; </span><span class="default">$remotedest</span><span class="string">"</span><span class="keyword">);<br />
</span><span class="default">ssh2_scp_recv</span><span class="keyword">(</span><span class="default">$conn</span><span class="keyword">, </span><span class="default">$remotedest</span><span class="keyword">, </span><span class="default">$localdest</span><span class="keyword">);<br />
</span><span class="default">$farray </span><span class="keyword">= </span><span class="default">file</span><span class="keyword">(</span><span class="default">$localdest</span><span class="keyword">);<br />
</span><span class="default">print_r</span><span class="keyword">(</span><span class="default">$farray</span><span class="keyword">);<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="47320""></a>
  <div class="note">
   
   <a href="#47320" class="date">11-Nov-2004 04:41</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If the 2GB limit is driving you crazy, you can use this complete hack.&nbsp; use in place of filesize()<br />
<br />
function file_size($file) {<br />
&nbsp; $size = filesize($file);<br />
&nbsp; if ( $size == 0)<br />
&nbsp;&nbsp;&nbsp; $size = exec("ls -l $file | awk '{print $5}'");<br />
&nbsp; return $size;<br />
}</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="46406""></a>
  <div class="note">
   <strong class="user">svend at svendtofte dot com</strong>
   <a href="#46406" class="date">10-Oct-2004 01:31</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
To the note of how you can figure out if a file is a folder or not, there is also the handy "is_dir" function.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="34919""></a>
  <div class="note">
   <strong class="user">salisbm at hotmail dot com</strong>
   <a href="#34919" class="date">12-Aug-2003 02:21</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I was curious how I could tell if a file was a directory... so I found on <a href="http://www.hmug.org/man/2/stat.html the following information about the mode bits:" rel="nofollow" target="_blank">http://www.hmug.org/man/2/stat.html the following information about the mode bits:</a><br />
#define S_IFMT 0170000&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; /* type of file */<br />
#define&nbsp; &nbsp; &nbsp; &nbsp; S_IFIFO&nbsp; 0010000&nbsp; /* named pipe (fifo) */<br />
#define&nbsp; &nbsp; &nbsp; &nbsp; S_IFCHR&nbsp; 0020000&nbsp; /* character special */<br />
#define&nbsp; &nbsp; &nbsp; &nbsp; S_IFDIR&nbsp; 0040000&nbsp; /* directory */<br />
#define&nbsp; &nbsp; &nbsp; &nbsp; S_IFBLK&nbsp; 0060000&nbsp; /* block special */<br />
#define&nbsp; &nbsp; &nbsp; &nbsp; S_IFREG&nbsp; 0100000&nbsp; /* regular */<br />
#define&nbsp; &nbsp; &nbsp; &nbsp; S_IFLNK&nbsp; 0120000&nbsp; /* symbolic link */<br />
#define&nbsp; &nbsp; &nbsp; &nbsp; S_IFSOCK 0140000&nbsp; /* socket */<br />
#define&nbsp; &nbsp; &nbsp; &nbsp; S_IFWHT&nbsp; 0160000&nbsp; /* whiteout */<br />
#define S_ISUID 0004000&nbsp; /* set user id on execution */<br />
#define S_ISGID 0002000&nbsp; /* set group id on execution */<br />
#define S_ISVTX 0001000&nbsp; /* save swapped text even after use */<br />
#define S_IRUSR 0000400&nbsp; /* read permission, owner */<br />
#define S_IWUSR 0000200&nbsp; /* write permission, owner */<br />
#define S_IXUSR 0000100&nbsp; /* execute/search permission, owner */<br />
<br />
Note that these numbers are in octal format.&nbsp; Then, to check to see if the file is a directory, after calling fstat, I do:<br />
<br />
if ($fstats[mode] &amp; 040000)<br />
&nbsp; ... this must be a directory</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="1213""></a>
  <div class="note">
   <strong class="user">ian at eiloart dot com</strong>
   <a href="#1213" class="date">23-Jul-1999 05:52</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Here's what the UNIX man page on stat has to say about the difference between a file change and&nbsp; a file modification:
<br />

<br />
st_mtime&nbsp; Time when data was last modified.&nbsp; Changed by&nbsp; the following&nbsp; functions:&nbsp;&nbsp; creat(),&nbsp; mknod(), pipe(), utime(), and write(2).
<br />

<br />
st_ctime&nbsp; Time when file status was last&nbsp; changed.&nbsp;&nbsp; Changed by&nbsp; the&nbsp; following&nbsp; functions: chmod(), chown(), creat(), link(2), mknod(), pipe(), unlink(2), utime(), and write().
<br />

<br />
So a modification is a change in the data, whereas a change also happens if you modify file permissions and so on.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
</div>
</div>
</div></div></body></html>
