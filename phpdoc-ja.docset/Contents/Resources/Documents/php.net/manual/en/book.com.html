<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
 <head>
  <meta http-equiv="content-type" content="text/html; CHARSET=shift-jis">
  <title>COM および .Net (Windows)</title>

  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <link media="all" rel="stylesheet" type="text/css" href="style.css"/>
 </head>
 <body class="docs" class="docs"><div class="navbar navbar-fixed-top">
  <div class="navbar-inner clearfix">
    <ul class="nav" style="width: 100%">
      <li style="float: left;"><a href="function.dotnet-load.html">≪ dotnet_load</a></li>
      <li style="float: right;"><a href="intro.com.html">導入 ≫</a></li>
    </ul>
  </div>
</div>
<div id="breadcrumbs" class="clearfix">
  <ul class="breadcrumbs-container">
    <li><a href="index.html">PHP Manual</a></li>
    <li><a href="refs.utilspec.windows.html">Windows 用のモジュール</a></li>
    <li>COM および .Net (Windows)</li>
  </ul>
</div>
<div id="layout">
  <div id="layout-content"><div id="book.com" class="book">
 
 <h1 class="title">COM および .Net (Windows)</h1>
 
 
 
 
 
 
 









 






 






 








 







 






 







 












<ul class="chunklist chunklist_book"><li><a href="intro.com.html">導入</a></li><li><a href="com.setup.html">インストール/設定</a><ul class="chunklist chunklist_book chunklist_children"><li><a href="com.requirements.html">要件</a></li><li><a href="com.installation.html">インストール手順</a></li><li><a href="com.configuration.html">実行時設定</a></li><li><a href="com.resources.html">リソース型</a></li></ul></li><li><a href="com.constants.html">定義済み定数</a></li><li><a href="com.error-handling.html">エラーおよびエラー処理</a></li><li><a href="com.examples.html">例</a><ul class="chunklist chunklist_book chunklist_children"><li><a href="com.examples.foreach.html">For Each</a></li><li><a href="com.examples.arrays.html">配列と配列形式の COM プロパティ</a></li></ul></li><li><a href="class.com.html">COM</a> &mdash; COM クラス</li><li><a href="class.dotnet.html">DOTNET</a> &mdash; DOTNET 説明</li><li><a href="class.variant.html">VARIANT</a> &mdash; VARIANT クラス</li><li><a href="ref.com.html">COM関数</a><ul class="chunklist chunklist_book chunklist_children"><li><a href="function.com-addref.html">com_addref</a> &mdash; コンポーネントの参照カウンタを増やす [非推奨]</li><li><a href="function.com-create-guid.html">com_create_guid</a> &mdash; グローバルユニーク ID (GUID) を生成する</li><li><a href="function.com-event-sink.html">com_event_sink</a> &mdash; COM オブジェクトのイベントを PHP オブジェクトに接続する</li><li><a href="function.com-get-active-object.html">com_get_active_object</a> &mdash; すでに実行中の COM オブジェクトのインスタンスへのハンドルを返す</li><li><a href="function.com-get.html">com_get</a> &mdash; COM コンポーネントのプロパティの値を得る [非推奨]</li><li><a href="function.com-invoke.html">com_invoke</a> &mdash; COM コンポーネントのメソッドをコールする [非推奨]</li><li><a href="function.com-isenum.html">com_isenum</a> &mdash; COM オブジェクトが IEnumVariant インターフェイスを実装しているかどうかを示す [非推奨]</li><li><a href="function.com-load-typelib.html">com_load_typelib</a> &mdash; タイプライブラリを読み込む</li><li><a href="function.com-load.html">com_load</a> &mdash; COM コンポーネントへの新規リファレンスを作成する [非推奨]</li><li><a href="function.com-message-pump.html">com_message_pump</a> &mdash; COM メッセージを処理し、timeoutms ミリ秒の間待つ</li><li><a href="function.com-print-typeinfo.html">com_print_typeinfo</a> &mdash; ディスパッチインターフェイスのために、PHP のクラス定義を出力する</li><li><a href="function.com-propget.html">com_propget</a> &mdash; com_get のエイリアス</li><li><a href="function.com-propput.html">com_propput</a> &mdash; com_set のエイリアス</li><li><a href="function.com-propset.html">com_propset</a> &mdash; com_set のエイリアス</li><li><a href="function.com-release.html">com_release</a> &mdash; コンポーネントリファレンスカウンタを減らす [廃止]</li><li><a href="function.com-set.html">com_set</a> &mdash; COM コンポーネントのプロパティに値を代入する</li><li><a href="function.variant-abs.html">variant_abs</a> &mdash; variant の絶対値を返す</li><li><a href="function.variant-add.html">variant_add</a> &mdash; 2 つの variant 値を「加算」し、結果を返す</li><li><a href="function.variant-and.html">variant_and</a> &mdash; 2 つの variant の論理積を計算し、結果を返す</li><li><a href="function.variant-cast.html">variant_cast</a> &mdash; variant を、別の型の新しい variant に変換する</li><li><a href="function.variant-cat.html">variant_cat</a> &mdash; 2 つの variant 値を連結し、その結果を返す</li><li><a href="function.variant-cmp.html">variant_cmp</a> &mdash; 2 つの variant を比較する</li><li><a href="function.variant-date-from-timestamp.html">variant_date_from_timestamp</a> &mdash; Unix タイムスタンプを、日付形式の variant で返す</li><li><a href="function.variant-date-to-timestamp.html">variant_date_to_timestamp</a> &mdash; 日付/時刻の variant 値を Unix タイムスタンプに変換する</li><li><a href="function.variant-div.html">variant_div</a> &mdash; 2 つの variant の除算結果を返す</li><li><a href="function.variant-eqv.html">variant_eqv</a> &mdash; 2 つの variant のビット値が等しいかどうかを調べる</li><li><a href="function.variant-fix.html">variant_fix</a> &mdash; variant の整数部を返す</li><li><a href="function.variant-get-type.html">variant_get_type</a> &mdash; variant オブジェクトの型を返す</li><li><a href="function.variant-idiv.html">variant_idiv</a> &mdash; variants を整数に変換し、除算の結果を返す</li><li><a href="function.variant-imp.html">variant_imp</a> &mdash; 2 つの variant のビット implication を行う</li><li><a href="function.variant-int.html">variant_int</a> &mdash; variant の整数部を返す</li><li><a href="function.variant-mod.html">variant_mod</a> &mdash; 2 つの variant の除算を行い、剰余を返す</li><li><a href="function.variant-mul.html">variant_mul</a> &mdash; 2 つの variant の乗算を行い、その結果を返す</li><li><a href="function.variant-neg.html">variant_neg</a> &mdash; variant の論理否定演算を行う</li><li><a href="function.variant-not.html">variant_not</a> &mdash; variant のビット否定演算を行う</li><li><a href="function.variant-or.html">variant_or</a> &mdash; 2 つの variant の論理和を計算する</li><li><a href="function.variant-pow.html">variant_pow</a> &mdash; 2 つの variant の累乗計算を行い、その結果を返す</li><li><a href="function.variant-round.html">variant_round</a> &mdash; 指定した桁で variant を丸める</li><li><a href="function.variant-set-type.html">variant_set_type</a> &mdash; variant を「その場で」別の型に変換する</li><li><a href="function.variant-set.html">variant_set</a> &mdash; variant オブジェクトに新しい値を代入する</li><li><a href="function.variant-sub.html">variant_sub</a> &mdash; 左の variant から右の variant を引き、その結果を返す</li><li><a href="function.variant-xor.html">variant_xor</a> &mdash; 2 つの variant の排他的論理和を計算する</li></ul></li></ul></div><div id="usernotes">
 <div class="head">
  <h3 class="title">User Contributed Notes</h3>
 </div>
<div id="allnotes">  <a name="109512""></a>
  <div class="note">
   <strong class="user">robert dot johnson at icap dot com</strong>
   <a href="#109512" class="date">24-Jul-2012 06:30</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
(From?) PHP 5.4.5 for Windows:<br />
<br />
If you are seeing this in your error log:<br />
<br />
Fatal error:&nbsp; Class 'COM' not found <br />
<br />
You require this in php.ini:<br />
<br />
[PHP_COM_DOTNET]<br />
extension=php_com_dotnet.dll<br />
<br />
Previously it was compiled as built-in on the Windows build.&nbsp; I assume this has happened because the com extension can now be built as a shared component.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="93699""></a>
  <div class="note">
   <strong class="user">Anonymous</strong>
   <a href="#93699" class="date">23-Sep-2009 02:00</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Add hyperlink at a Word Document's bookmark
<br />

<br />
<span class="default">&lt;?php
<br />
</span><span class="comment">// Create COM instance to word
<br />
&nbsp;&nbsp; &nbsp; &nbsp; </span><span class="keyword">function </span><span class="default">clsMSWord</span><span class="keyword">(</span><span class="default">$Visible </span><span class="keyword">= </span><span class="default">false</span><span class="keyword">)
<br />
&nbsp;&nbsp; &nbsp; &nbsp; {
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">handle </span><span class="keyword">= new </span><span class="default">COM</span><span class="keyword">(</span><span class="string">"word.application"</span><span class="keyword">) or die(</span><span class="string">"Unable to instanciate Word"</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">handle</span><span class="keyword">-&gt;</span><span class="default">Visible </span><span class="keyword">= </span><span class="default">$Visible</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp; }
<br />

<br />
function </span><span class="default">WriteHyperlink</span><span class="keyword">(</span><span class="default">$Bookmark</span><span class="keyword">,</span><span class="default">$Path</span><span class="keyword">,</span><span class="default">$Text</span><span class="keyword">)
<br />
&nbsp;&nbsp; &nbsp; &nbsp; {
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$objBookmark </span><span class="keyword">= </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">handle</span><span class="keyword">-&gt;</span><span class="default">ActiveDocument</span><span class="keyword">-&gt;</span><span class="default">Bookmarks</span><span class="keyword">(</span><span class="default">$Bookmark</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$range </span><span class="keyword">= </span><span class="default">$objBookmark</span><span class="keyword">-&gt;</span><span class="default">Range</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$objHyperlink </span><span class="keyword">= </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">handle</span><span class="keyword">-&gt;</span><span class="default">ActiveDocument</span><span class="keyword">-&gt;</span><span class="default">Hyperlinks</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$objHyperlink</span><span class="keyword">-&gt;</span><span class="default">add</span><span class="keyword">(</span><span class="default">$range</span><span class="keyword">,</span><span class="default">$Path</span><span class="keyword">,</span><span class="string">""</span><span class="keyword">,</span><span class="string">""</span><span class="keyword">,</span><span class="default">$Text</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
<br />
&nbsp;&nbsp; &nbsp; &nbsp; }
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="91161""></a>
  <div class="note">
   <strong class="user">Dave Bachtel</strong>
   <a href="#91161" class="date">27-May-2009 11:20</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Hello everybody!<br />
<br />
Here is some helpful advice for people attempting to use COM with Microsoft MapPoint 2006 or 2009 with PHP.<br />
<br />
If you are using apache, it MUST be running under the same credentials as a desktop user that has already installed/run mappoint or modifiy the service and select the "Allow Service to Interact with Desktop" option.&nbsp; Otherwise, it won't work due to the EULA popup having to be accepted.&nbsp; Mappoint 2004 works just fine, this only applies to 2006 and 2009.<br />
<br />
For troubleshooting, the error that appears in the System event viewer is:<br />
The server {31851F82-AFE6-11D2-A3C9-00C04F72F340} did not register with DCOM within the required timeout.<br />
<br />
The error generated by PHP, if you happen to get lucky and let the COM() function timeout by cranking up set_time_limit() timeout is:<br />
<span class="default">&lt;?php<br />
<br />
set_time_limit</span><span class="keyword">(</span><span class="default">1000</span><span class="keyword">) ;<br />
<br />
</span><span class="default">$mapoint </span><span class="keyword">=&nbsp; new </span><span class="default">COM</span><span class="keyword">(</span><span class="string">"MapPoint.Application"</span><span class="keyword">) or die(</span><span class="string">"Unable to instantiate Mappoint COM object"</span><span class="keyword">);<br />
<br />
</span><span class="default">?&gt;<br />
</span>Generates:<br />
Fatal error: Uncaught exception 'com_exception' with message 'Failed to create COM object `MapPoint.Application': Server execution failed ' in [somefile.php]:9 Stack trace: #0 [somefile.php](9): com-&gt;com('MapPoint.Applic...') #1 {main} thrown in [somefile.php] on line 9<br />
<br />
Also, if you have multiple versions of MapPoint installed, you will need to run:<br />
c:\path\to\mappoint\MapPoint.exe /registerserver <br />
<br />
(using the correct folder path) to select the right version of the com object to use.&nbsp; Gooood luck!</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="90076""></a>
  <div class="note">
   <strong class="user">acsandeep at gmail dot com</strong>
   <a href="#90076" class="date">05-Apr-2009 06:40</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If you are trying to get the properties of a Word document opened via COM object, you may need to define some constants in your script like so.
<br />

<br />
<span class="default">&lt;?php
<br />
define</span><span class="keyword">(</span><span class="string">'wdPropertyTitle'</span><span class="keyword">, </span><span class="default">1</span><span class="keyword">);
<br />
</span><span class="default">define</span><span class="keyword">(</span><span class="string">'wdPropertySubject'</span><span class="keyword">, </span><span class="default">2</span><span class="keyword">);
<br />
</span><span class="default">define</span><span class="keyword">(</span><span class="string">'wdPropertyAuthor'</span><span class="keyword">, </span><span class="default">3</span><span class="keyword">);
<br />
</span><span class="default">define</span><span class="keyword">(</span><span class="string">'wdPropertyKeywords'</span><span class="keyword">, </span><span class="default">4</span><span class="keyword">);
<br />
</span><span class="default">define</span><span class="keyword">(</span><span class="string">'wdPropertyComments'</span><span class="keyword">, </span><span class="default">5</span><span class="keyword">);
<br />
</span><span class="default">define</span><span class="keyword">(</span><span class="string">'wdPropertyTemplate'</span><span class="keyword">, </span><span class="default">6</span><span class="keyword">);
<br />
</span><span class="default">define</span><span class="keyword">(</span><span class="string">'wdPropertyLastAuthor'</span><span class="keyword">, </span><span class="default">7</span><span class="keyword">);
<br />

<br />
</span><span class="default">$word </span><span class="keyword">= new </span><span class="default">COM</span><span class="keyword">(</span><span class="string">"word.application"</span><span class="keyword">) or die (</span><span class="string">"Could not initialise MS Word object."</span><span class="keyword">);
<br />
</span><span class="default">$word</span><span class="keyword">-&gt;</span><span class="default">Documents</span><span class="keyword">-&gt;</span><span class="default">Open</span><span class="keyword">(</span><span class="default">realpath</span><span class="keyword">(</span><span class="string">"Sample.doc"</span><span class="keyword">));
<br />
</span><span class="default">$Author </span><span class="keyword">= </span><span class="default">$word</span><span class="keyword">-&gt;</span><span class="default">ActiveDocument</span><span class="keyword">-&gt;</span><span class="default">BuiltInDocumentProperties</span><span class="keyword">(</span><span class="default">wdPropertyAuthor</span><span class="keyword">);
<br />

<br />
echo </span><span class="default">$Author</span><span class="keyword">;
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="89657""></a>
  <div class="note">
   <strong class="user">long2hu3 ATT yahoo DOTT com</strong>
   <a href="#89657" class="date">18-Mar-2009 01:38</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
When you work with MS Excel, Word, ... and other applications, never forget that COM doesn't know their predefined constants, thus if you want to do sth. that would look like this in VB:<br />
<br />
With myRange.Borders(xlEdgeBottom)<br />
&nbsp;&nbsp;&nbsp; .LineStyle = xlContinuous<br />
&nbsp;&nbsp;&nbsp; .Weight = xlThin<br />
&nbsp;&nbsp;&nbsp; .ColorIndex = xlAutomatic<br />
End With<br />
<br />
you should either use numbers or define constants above, like this:<br />
<br />
<span class="default">&lt;?php<br />
<br />
define</span><span class="keyword">(</span><span class="string">'xlEdgeBottom'</span><span class="keyword">, </span><span class="default">9</span><span class="keyword">);<br />
</span><span class="default">define</span><span class="keyword">(</span><span class="string">'xlContinuous'</span><span class="keyword">, </span><span class="default">1</span><span class="keyword">);<br />
</span><span class="default">define</span><span class="keyword">(</span><span class="string">'xlThin'</span><span class="keyword">, </span><span class="default">2</span><span class="keyword">);<br />
</span><span class="default">define</span><span class="keyword">(</span><span class="string">'xlAutomatic'</span><span class="keyword">, -</span><span class="default">4105</span><span class="keyword">);<br />
<br />
</span><span class="default">$ex </span><span class="keyword">= new </span><span class="default">COM</span><span class="keyword">(</span><span class="string">"Excel.Application"</span><span class="keyword">, </span><span class="default">NULL</span><span class="keyword">, </span><span class="default">CP_UTF8</span><span class="keyword">) or Die (</span><span class="string">"Did not instantiate Excel"</span><span class="keyword">);<br />
</span><span class="default">$wb </span><span class="keyword">= </span><span class="default">$ex</span><span class="keyword">-&gt;</span><span class="default">Application</span><span class="keyword">-&gt;</span><span class="default">Workbooks</span><span class="keyword">-&gt;</span><span class="default">Add</span><span class="keyword">();<br />
</span><span class="default">$ws </span><span class="keyword">= </span><span class="default">$wb</span><span class="keyword">-&gt;</span><span class="default">Worksheets</span><span class="keyword">(</span><span class="default">1</span><span class="keyword">);<br />
<br />
</span><span class="default">$xra </span><span class="keyword">= </span><span class="default">$ws</span><span class="keyword">-&gt;</span><span class="default">Range</span><span class="keyword">(</span><span class="string">"A1:A6"</span><span class="keyword">);<br />
<br />
</span><span class="default">$bs </span><span class="keyword">= </span><span class="default">$xra</span><span class="keyword">-&gt;</span><span class="default">Borders</span><span class="keyword">(</span><span class="default">xlEdgeBottom</span><span class="keyword">);<br />
</span><span class="default">$bs</span><span class="keyword">-&gt;</span><span class="default">LineStyle </span><span class="keyword">= </span><span class="default">xlContinuous</span><span class="keyword">;<br />
</span><span class="default">$bs</span><span class="keyword">-&gt;</span><span class="default">Weight </span><span class="keyword">= </span><span class="default">xlThin</span><span class="keyword">;<br />
</span><span class="default">$bs</span><span class="keyword">-&gt;</span><span class="default">ColorIndex </span><span class="keyword">= </span><span class="default">xlAutomatic</span><span class="keyword">;<br />
<br />
</span><span class="default">?&gt;<br />
</span><br />
It is pointless to try to use text strings, i.e.<br />
<br />
<span class="default">&lt;?php<br />
<br />
$bs </span><span class="keyword">= </span><span class="default">$xra</span><span class="keyword">-&gt;</span><span class="default">Borders</span><span class="keyword">(</span><span class="string">'xlEdgeBottom'</span><span class="keyword">);<br />
</span><span class="default">$bs</span><span class="keyword">-&gt;</span><span class="default">Weight </span><span class="keyword">= </span><span class="string">'xlThin'</span><span class="keyword">;<br />
<br />
</span><span class="default">?&gt;<br />
</span><br />
this will cause an error: Unable to set property Weight of class Border ...</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="85328""></a>
  <div class="note">
   <strong class="user">ilayansmano at gmail dot com</strong>
   <a href="#85328" class="date">26-Aug-2008 10:39</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Extracting text from Word Documents via PHP and COM
<br />

<br />
<span class="default">&lt;?php
<br />
$word </span><span class="keyword">= new </span><span class="default">COM</span><span class="keyword">(</span><span class="string">"word.application"</span><span class="keyword">) or die (</span><span class="string">"Could not initialise MS Word object."</span><span class="keyword">);
<br />
</span><span class="default">$word</span><span class="keyword">-&gt;</span><span class="default">Documents</span><span class="keyword">-&gt;</span><span class="default">Open</span><span class="keyword">(</span><span class="default">realpath</span><span class="keyword">(</span><span class="string">"Sample.doc"</span><span class="keyword">));
<br />

<br />
</span><span class="comment">// Extract content.
<br />
</span><span class="default">$content </span><span class="keyword">= (string) </span><span class="default">$word</span><span class="keyword">-&gt;</span><span class="default">ActiveDocument</span><span class="keyword">-&gt;</span><span class="default">Content</span><span class="keyword">;
<br />

<br />
echo </span><span class="default">$content</span><span class="keyword">;
<br />

<br />
</span><span class="default">$word</span><span class="keyword">-&gt;</span><span class="default">ActiveDocument</span><span class="keyword">-&gt;</span><span class="default">Close</span><span class="keyword">(</span><span class="default">false</span><span class="keyword">);
<br />

<br />
</span><span class="default">$word</span><span class="keyword">-&gt;</span><span class="default">Quit</span><span class="keyword">();
<br />
</span><span class="default">$word </span><span class="keyword">= </span><span class="default">null</span><span class="keyword">;
<br />
unset(</span><span class="default">$word</span><span class="keyword">);
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
</div>
</div>
</div></div></body></html>
