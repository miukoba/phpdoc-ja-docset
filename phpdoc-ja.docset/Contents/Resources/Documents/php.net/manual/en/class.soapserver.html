<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
 <head>
  <meta http-equiv="content-type" content="text/html; CHARSET=shift-jis">
  <title>SoapServer クラス</title>

  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <link media="all" rel="stylesheet" type="text/css" href="style.css"/>
 </head>
 <body class="docs" class="docs"><div class="navbar navbar-fixed-top">
  <div class="navbar-inner clearfix">
    <ul class="nav" style="width: 100%">
      <li style="float: left;"><a href="soapclient.soapclient.html">≪ SoapClient::SoapClient</a></li>
      <li style="float: right;"><a href="soapserver.addfunction.html">SoapServer::addFunction ≫</a></li>
    </ul>
  </div>
</div>
<div id="breadcrumbs" class="clearfix">
  <ul class="breadcrumbs-container">
    <li><a href="index.html">PHP Manual</a></li>
    <li><a href="book.soap.html">SOAP</a></li>
    <li>SoapServer クラス</li>
  </ul>
</div>
<div id="layout">
  <div id="layout-content"><div id="class.soapserver" class="reference">

 <h1 class="title">SoapServer クラス</h1>
 

 <div class="partintro"><p class="verinfo">(PHP 5 &gt;= 5.0.1)</p>


  <div class="section" id="soapserver.intro">
   <h2 class="title">導入</h2>
   <p class="para">
    SoapServer クラスは <a href="http://www.w3.org/TR/soap11/" class="link external" title="Link : http://www.w3.org/TR/soap11/">&raquo;&nbsp;SOAP 1.1</a> および <a href="http://www.w3.org/TR/soap12/" class="link external" title="Link : http://www.w3.org/TR/soap12/">&raquo;&nbsp;SOAP 1.2</a> プロトコル用のサーバーとなります。
   WSDL サービス記述を使用することもしないこともできます。
   </p>
  </div>


  <div class="section" id="soapserver.synopsis">
   <h2 class="title">クラス概要</h2>


   <div class="classsynopsis">
    <div class="ooclass"></div>


    <div class="classsynopsisinfo">
     <span class="ooclass">
      <strong class="classname">SoapServer</strong>
     </span>
     {</div>

    
    <div class="classsynopsisinfo classsynopsisinfo_comment">/* メソッド */</div>
    <div class="methodsynopsis dc-description">
   <span class="modifier">public</span> <span class="type">void</span> <span class="methodname"><a href="soapserver.addfunction.html" class="methodname">addFunction</a></span>
    ( <span class="methodparam"><span class="type"><a href="language.pseudo-types.html#language.types.mixed" class="type mixed">mixed</a></span> <code class="parameter">$functions</code></span>
   )</div>
<div class="methodsynopsis dc-description">
   <span class="modifier">public</span> <span class="type">void</span> <span class="methodname"><a href="soapserver.addsoapheader.html" class="methodname">addSoapHeader</a></span>
    ( <span class="methodparam"><span class="type"><a href="class.soapheader.html" class="type SoapHeader">SoapHeader</a></span> <code class="parameter">$object</code></span>
   )</div>
<div class="methodsynopsis dc-description">
   <span class="modifier">public</span> <span class="methodname"><a href="soapserver.construct.html" class="methodname">__construct</a></span>
    ( <span class="methodparam"><span class="type"><a href="language.pseudo-types.html#language.types.mixed" class="type mixed">mixed</a></span> <code class="parameter">$wsdl</code></span>
   [, <span class="methodparam"><span class="type">array</span> <code class="parameter">$options</code></span>
  ] )</div>
<div class="methodsynopsis dc-description">
   <span class="modifier">public</span> <span class="type">void</span> <span class="methodname"><a href="soapserver.fault.html" class="methodname">fault</a></span>
    ( <span class="methodparam"><span class="type">string</span> <code class="parameter">$code</code></span>
   , <span class="methodparam"><span class="type">string</span> <code class="parameter">$string</code></span>
   [, <span class="methodparam"><span class="type">string</span> <code class="parameter">$actor</code></span>
   [, <span class="methodparam"><span class="type">string</span> <code class="parameter">$details</code></span>
   [, <span class="methodparam"><span class="type">string</span> <code class="parameter">$name</code></span>
  ]]] )</div>
<div class="methodsynopsis dc-description">
   <span class="modifier">public</span> <span class="type">array</span> <span class="methodname"><a href="soapserver.getfunctions.html" class="methodname">getFunctions</a></span>
    ( <span class="methodparam">void</span>
   )</div>
<div class="methodsynopsis dc-description">
   <span class="modifier">public</span> <span class="type">void</span> <span class="methodname"><a href="soapserver.handle.html" class="methodname">handle</a></span>
    ([ <span class="methodparam"><span class="type">string</span> <code class="parameter">$soap_request</code></span>
  ] )</div>
<div class="methodsynopsis dc-description">
   <span class="modifier">public</span> <span class="type">void</span> <span class="methodname"><a href="soapserver.setclass.html" class="methodname">setClass</a></span>
    ( <span class="methodparam"><span class="type">string</span> <code class="parameter">$class_name</code></span>
   [, <span class="methodparam"><span class="type"><a href="language.pseudo-types.html#language.types.mixed" class="type mixed">mixed</a></span> <code class="parameter">$args</code></span>
   [, <span class="methodparam"><span class="type"><a href="language.pseudo-types.html#language.types.mixed" class="type mixed">mixed</a></span> <code class="parameter">$...</code></span>
  ]] )</div>
<div class="methodsynopsis dc-description">
   <span class="modifier">public</span> <span class="type">void</span> <span class="methodname"><a href="soapserver.setobject.html" class="methodname">setObject</a></span>
    ( <span class="methodparam"><span class="type">object</span> <code class="parameter">$object</code></span>
   )</div>
<div class="methodsynopsis dc-description">
   <span class="modifier">public</span> <span class="type">void</span> <span class="methodname"><a href="soapserver.setpersistence.html" class="methodname">setPersistence</a></span>
    ( <span class="methodparam"><span class="type">int</span> <code class="parameter">$mode</code></span>
   )</div>
<div class="methodsynopsis dc-description">
   <span class="modifier">public</span> <span class="methodname"><a href="soapserver.soapserver.html" class="methodname">SoapServer</a></span>
    ( <span class="methodparam"><span class="type"><a href="language.pseudo-types.html#language.types.mixed" class="type mixed">mixed</a></span> <code class="parameter">$wsdl</code></span>
   [, <span class="methodparam"><span class="type">array</span> <code class="parameter">$options</code></span>
  ] )</div>

   }</div>


  </div>

 </div>

 

























































































<h2>目次</h2><ul class="chunklist chunklist_reference"><li><a href="soapserver.addfunction.html">SoapServer::addFunction</a> &mdash; SOAP リクエストによって処理される単一もしくはいくつかの関数を追加する</li><li><a href="soapserver.addsoapheader.html">SoapServer::addSoapHeader</a> &mdash; SOAP ヘッダをレスポンスに追加する</li><li><a href="soapserver.construct.html">SoapServer::__construct</a> &mdash; SoapServer コンストラクタ</li><li><a href="soapserver.fault.html">SoapServer::fault</a> &mdash; エラーを示す SoapServer フォールト を発行する</li><li><a href="soapserver.getfunctions.html">SoapServer::getFunctions</a> &mdash; 定義されている関数の一覧を返す</li><li><a href="soapserver.handle.html">SoapServer::handle</a> &mdash; SOAP リクエストを処理する</li><li><a href="soapserver.setclass.html">SoapServer::setClass</a> &mdash; SOAP リクエストを処理するクラスを設定する</li><li><a href="soapserver.setobject.html">SoapServer::setObject</a> &mdash; SOAP リクエストの処理に使用するオブジェクトを設定する</li><li><a href="soapserver.setpersistence.html">SoapServer::setPersistence</a> &mdash; SoapServer の持続モードを設定する</li><li><a href="soapserver.soapserver.html">SoapServer::SoapServer</a> &mdash; SoapServer コンストラクタ</li></ul>
</div>
<div id="usernotes">
 <div class="head">
  <h3 class="title">User Contributed Notes</h3>
 </div>
<div id="allnotes">  <a name="113210""></a>
  <div class="note">
   <strong class="user">s at dumdeedum dot com</strong>
   <a href="#113210" class="date">13-Sep-2013 02:32</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I was running PHP 5.3.2 and couldn't for the life of me get SOAP headers to work, no matter how carefully I built my class/wsdl/client.&nbsp; What finally fixed it was updating to the latest PHP.&nbsp; No idea if there was a bug somewhere or what, but it's never a bad idea to stay current and it might save you weeks of frustration!</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="109306""></a>
  <div class="note">
   <strong class="user">phpman dot fulter47 at recursor dot net</strong>
   <a href="#109306" class="date">05-Jul-2012 02:36</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
For those (like me) coming from other SOAP frameworks and getting confused:<br />
<br />
- A PHP SOAP server application created using the SoapServer class can not be used as a standalone SOAP server.<br />
It needs an HTTP server to receive SOAP requests, which must run a PHP engine to execute the PHP SOAP server script as a CGI.<br />
<br />
- For this reason, there are no settings in PHP that control the Interface/Port under which the SOAP server will wait for requests - it is the HTTP server who is responsible for that.<br />
<br />
- The "uri" parameter is an "id value", used as the namespace for the SOAP response. It is only required if no WSDL file is used (that contains this setting), i.e. "wsdl" is set to NULL. It does _not_ control the Hostname/Port under which the HTTP server will be reachable for requests.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="105448""></a>
  <div class="note">
   <strong class="user">php1221 at klox dot net</strong>
   <a href="#105448" class="date">18-Aug-2011 10:39</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
While there are plenty of mentions online that SoapServer doesn't support SOAP Headers, this isn't true.
<br />

<br />
In your class, if you declare a function with the name of the header, the function will be called when that header is received.
<br />

<br />
<span class="default">&lt;?php
<br />
</span><span class="keyword">class </span><span class="default">MySoapService </span><span class="keyword">{
<br />
&nbsp; private </span><span class="default">$user_is_valid</span><span class="keyword">;
<br />

<br />
&nbsp; function </span><span class="default">MyHeader</span><span class="keyword">(</span><span class="default">$header</span><span class="keyword">) {
<br />
&nbsp;&nbsp;&nbsp; if ((isset(</span><span class="default">$header</span><span class="keyword">-&gt;</span><span class="default">Username</span><span class="keyword">)) &amp;&amp; (isset(</span><span class="default">$header</span><span class="keyword">-&gt;</span><span class="default">Password</span><span class="keyword">))) {
<br />
&nbsp;&nbsp; &nbsp;&nbsp; if (</span><span class="default">ValidateUser</span><span class="keyword">(</span><span class="default">$header</span><span class="keyword">-&gt;</span><span class="default">Username</span><span class="keyword">, </span><span class="default">$header</span><span class="keyword">-&gt;</span><span class="default">Password</span><span class="keyword">)) {
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$user_is_valid </span><span class="keyword">= </span><span class="default">true</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp;&nbsp; }
<br />
&nbsp;&nbsp;&nbsp; }
<br />
&nbsp; }
<br />

<br />
&nbsp; function </span><span class="default">MySoapRequest</span><span class="keyword">(</span><span class="default">$request</span><span class="keyword">) {
<br />
&nbsp;&nbsp;&nbsp; if (</span><span class="default">$user_is_valid</span><span class="keyword">) {
<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="comment">// process request
<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">}
<br />
&nbsp;&nbsp;&nbsp; else {
<br />
&nbsp;&nbsp; &nbsp;&nbsp; throw new </span><span class="default">MyFault</span><span class="keyword">(</span><span class="string">"MySoapRequest"</span><span class="keyword">, </span><span class="string">"User not valid."</span><span class="keyword">);
<br />
&nbsp;&nbsp;&nbsp; }
<br />
&nbsp; }
<br />
}
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="101979""></a>
  <div class="note">
   <strong class="user">hawky83 at googlemail dot com</strong>
   <a href="#101979" class="date">21-Jan-2011 11:46</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Another simple example for SOAP_SERVER with errorhandling an params and wsdl:
<br />

<br />
SERVER (soap_all_srv.php):
<br />

<br />
<span class="default">&lt;?php 
<br />
</span><span class="comment">// PEAR::SOAP einbinden
<br />
</span><span class="keyword">require_once </span><span class="string">"SOAP/Server.php"</span><span class="keyword">;
<br />
</span><span class="default">$skiptrace </span><span class="keyword">=&amp; </span><span class="default">PEAR</span><span class="keyword">::</span><span class="default">getStaticProperty</span><span class="keyword">(</span><span class="string">'PEAR_Error'</span><span class="keyword">, </span><span class="string">'skiptrace'</span><span class="keyword">);
<br />
</span><span class="default">$skiptrace </span><span class="keyword">= </span><span class="default">true</span><span class="keyword">;
<br />

<br />
</span><span class="comment">// Service-Class
<br />
</span><span class="keyword">class </span><span class="default">mytimeserv </span><span class="keyword">{
<br />

<br />
&nbsp; </span><span class="comment">// __dispatch_map
<br />
&nbsp; </span><span class="keyword">public </span><span class="default">$__dispatch_map </span><span class="keyword">= array ();
<br />
&nbsp; 
<br />
&nbsp; </span><span class="comment">// In/Out param -&gt; __dispatch_map
<br />
&nbsp; </span><span class="keyword">public function </span><span class="default">__construct</span><span class="keyword">() {
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">__dispatch_map</span><span class="keyword">[</span><span class="string">"now"</span><span class="keyword">] =
<br />
&nbsp;&nbsp; &nbsp;&nbsp; array (</span><span class="string">"in" </span><span class="keyword">=&gt; array(</span><span class="string">"format" </span><span class="keyword">=&gt; </span><span class="string">"string"</span><span class="keyword">),
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="string">"out" </span><span class="keyword">=&gt; array(</span><span class="string">"time" </span><span class="keyword">=&gt; </span><span class="string">"string"</span><span class="keyword">));
<br />
&nbsp; }
<br />
&nbsp; 
<br />
&nbsp; </span><span class="comment">// get back __dispatch_map in __dispatch
<br />
&nbsp; </span><span class="keyword">public function </span><span class="default">__dispatch</span><span class="keyword">(</span><span class="default">$methodname</span><span class="keyword">) {
<br />
&nbsp; 
<br />
&nbsp;&nbsp;&nbsp; if (isset(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">__dispatch_map</span><span class="keyword">[</span><span class="default">$methodname</span><span class="keyword">])) {
<br />
&nbsp;&nbsp; &nbsp;&nbsp; return </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">__dispatch_map</span><span class="keyword">[</span><span class="default">$methodname</span><span class="keyword">];
<br />
&nbsp;&nbsp;&nbsp; }
<br />
&nbsp;&nbsp;&nbsp; 
<br />
&nbsp;&nbsp;&nbsp; return </span><span class="default">NULL</span><span class="keyword">;
<br />
&nbsp; }
<br />
&nbsp; 
<br />
&nbsp; </span><span class="comment">// servicemthod with parameters
<br />
&nbsp; </span><span class="keyword">function </span><span class="default">now </span><span class="keyword">(</span><span class="default">$format</span><span class="keyword">) {
<br />
&nbsp; 
<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">// formaterror?
<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">if ((</span><span class="default">$format </span><span class="keyword">== </span><span class="default">null</span><span class="keyword">) || (</span><span class="default">trim</span><span class="keyword">(</span><span class="default">$format</span><span class="keyword">) == </span><span class="string">""</span><span class="keyword">)) {
<br />
&nbsp;&nbsp;&nbsp; 
<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="comment">// send errormessage
<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="keyword">return new </span><span class="default">SOAP_Fault</span><span class="keyword">(</span><span class="string">"Kein Parameter angegeben"</span><span class="keyword">,</span><span class="string">"0815"</span><span class="keyword">, </span><span class="string">"Client"</span><span class="keyword">);
<br />
&nbsp;&nbsp;&nbsp; }
<br />
&nbsp;&nbsp;&nbsp; 
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">date_default_timezone_set</span><span class="keyword">(</span><span class="string">'Europe/Berlin'</span><span class="keyword">);
<br />
&nbsp;&nbsp;&nbsp; 
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$time </span><span class="keyword">= </span><span class="default">date </span><span class="keyword">(</span><span class="default">$format</span><span class="keyword">);
<br />
&nbsp;&nbsp;&nbsp; 
<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">// return SOAP-Obj.
<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">return (new </span><span class="default">SOAP_Value</span><span class="keyword">(</span><span class="string">'time'</span><span class="keyword">,</span><span class="string">'string'</span><span class="keyword">, </span><span class="default">$time</span><span class="keyword">));
<br />
&nbsp; }&nbsp; &nbsp; &nbsp;&nbsp; 
<br />
}
<br />

<br />
</span><span class="comment">// service-class
<br />
</span><span class="default">$service </span><span class="keyword">= new </span><span class="default">mytimeserv</span><span class="keyword">();
<br />

<br />
</span><span class="comment">// server
<br />
</span><span class="default">$ss </span><span class="keyword">= new </span><span class="default">SOAP_Server</span><span class="keyword">();
<br />

<br />
</span><span class="comment">// add service with name
<br />
</span><span class="default">$ss</span><span class="keyword">-&gt;</span><span class="default">addObjectMap </span><span class="keyword">(&amp;</span><span class="default">$service</span><span class="keyword">,</span><span class="string">"urn:mytimeserv"</span><span class="keyword">);
<br />

<br />
</span><span class="comment">// service or wsdl
<br />
</span><span class="keyword">if (isset(</span><span class="default">$_SERVER</span><span class="keyword">[</span><span class="string">"REQUEST_METHOD"</span><span class="keyword">])&amp;&amp; </span><span class="default">$_SERVER</span><span class="keyword">[</span><span class="string">"REQUEST_METHOD"</span><span class="keyword">] == </span><span class="string">"POST"</span><span class="keyword">) {
<br />

<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">// postdata -&gt; service
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$ss</span><span class="keyword">-&gt;</span><span class="default">service </span><span class="keyword">(</span><span class="default">$HTTP_RAW_POST_DATA</span><span class="keyword">);
<br />
&nbsp;&nbsp;&nbsp; 
<br />
} else {
<br />

<br />
&nbsp; </span><span class="comment">// wsdl-param in url
<br />
&nbsp; </span><span class="keyword">if (isset(</span><span class="default">$_SERVER</span><span class="keyword">[</span><span class="string">'QUERY_STRING'</span><span class="keyword">]) &amp;&amp; </span><span class="default">strcasecmp</span><span class="keyword">(</span><span class="default">$_SERVER</span><span class="keyword">[</span><span class="string">'QUERY_STRING'</span><span class="keyword">],</span><span class="string">'wsdl'</span><span class="keyword">) == </span><span class="default">0</span><span class="keyword">) {
<br />
&nbsp;&nbsp;&nbsp; 
<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">// DISCO_Server for WSDL 
<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">require_once </span><span class="string">"SOAP/Disco.php"</span><span class="keyword">;
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$disco </span><span class="keyword">= new </span><span class="default">SOAP_DISCO_Server </span><span class="keyword">(</span><span class="default">$ss</span><span class="keyword">,</span><span class="string">"mytimeserv"</span><span class="keyword">,</span><span class="string">"My Time Service"</span><span class="keyword">);
<br />
&nbsp;&nbsp;&nbsp; 
<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">// set HTML-Header 
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">header</span><span class="keyword">(</span><span class="string">"Content-type: text/xml"</span><span class="keyword">);
<br />
&nbsp;&nbsp;&nbsp; 
<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">// return wsdl
<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">print </span><span class="default">$disco</span><span class="keyword">-&gt;</span><span class="default">getWSDL </span><span class="keyword">();
<br />
&nbsp; }
<br />
}
<br />

<br />
</span><span class="default">?&gt;
<br />
</span>
<br />
CLIENT (soap_all_client.php) (for wsdl: <a href="http://example.com/soap_all_srv.php?wsdl" rel="nofollow" target="_blank">http://example.com/soap_all_srv.php?wsdl</a>):
<br />
<span class="default">&lt;?php
<br />

<br />
</span><span class="keyword">require_once </span><span class="string">"SOAP/Client.php"</span><span class="keyword">;
<br />

<br />
</span><span class="comment">// SOAP/WSDL
<br />
</span><span class="default">$sw </span><span class="keyword">= new </span><span class="default">SOAP_WSDL </span><span class="keyword">(</span><span class="string">"<a href="http://example.com/soap_all_srv.php?wsdl" rel="nofollow" target="_blank">http://example.com/soap_all_srv.php?wsdl</a>"</span><span class="keyword">);
<br />

<br />
</span><span class="comment">// Proxy-Obj.
<br />
</span><span class="default">$proxy </span><span class="keyword">= </span><span class="default">$sw</span><span class="keyword">-&gt;</span><span class="default">getProxy </span><span class="keyword">();
<br />

<br />
</span><span class="comment">// servicemthod
<br />
</span><span class="default">$erg </span><span class="keyword">= </span><span class="default">$proxy</span><span class="keyword">-&gt;</span><span class="default">now </span><span class="keyword">(</span><span class="string">"H:i:s"</span><span class="keyword">);
<br />

<br />
</span><span class="comment">// return
<br />
</span><span class="keyword">print </span><span class="default">$erg</span><span class="keyword">.</span><span class="string">"\n"</span><span class="keyword">;
<br />

<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="98227""></a>
  <div class="note">
   <strong class="user">mikkel at nsales dot dk</strong>
   <a href="#98227" class="date">03-Jun-2010 12:15</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If you want to return a custom object array from a nusoap webservice, you have to cast the objects to arrays like so:
<br />

<br />
<span class="default">&lt;?php
<br />
$users </span><span class="keyword">= array();
<br />
while(</span><span class="default">$res </span><span class="keyword">= </span><span class="default">$db_obj</span><span class="keyword">-&gt;</span><span class="default">fetch_row</span><span class="keyword">())
<br />
{
<br />
&nbsp; </span><span class="default">$user </span><span class="keyword">= new </span><span class="default">user</span><span class="keyword">();
<br />
&nbsp; </span><span class="default">$user</span><span class="keyword">-&gt;</span><span class="default">Id </span><span class="keyword">= </span><span class="default">$res</span><span class="keyword">[</span><span class="string">'id'</span><span class="keyword">];
<br />
&nbsp; </span><span class="default">$user</span><span class="keyword">-&gt;</span><span class="default">Username </span><span class="keyword">= </span><span class="default">$res</span><span class="keyword">[</span><span class="string">'username'</span><span class="keyword">];
<br />
&nbsp; </span><span class="default">$user</span><span class="keyword">-&gt;</span><span class="default">Email </span><span class="keyword">= </span><span class="default">$res</span><span class="keyword">[</span><span class="string">'email'</span><span class="keyword">];
<br />
&nbsp; 
<br />
&nbsp; </span><span class="default">$users</span><span class="keyword">[] = (array) </span><span class="default">$user</span><span class="keyword">;
<br />
}
<br />

<br />
return (</span><span class="default">$users</span><span class="keyword">);
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="98082""></a>
  <div class="note">
   <strong class="user">junk2cm at gmx dot de</strong>
   <a href="#98082" class="date">25-May-2010 09:54</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
As the SoapServer class lacks the possibility of dealing with SOAP-Headers, my following workaround is suitable to my needs when I had to do authentication via the SOAP-Headers:<br />
1. Use a class which handles SOAP requests and let the constructor of this class take the sent headers.<br />
2. Before invoking the SoapServer extract the SOAP-Header from the incoming raw data.<br />
3. When using setClass pass the extracted header to the handling class.<br />
<br />
In Your Server-Skript do things like this <br />
<span class="default">&lt;?php<br />
$hdr </span><span class="keyword">= </span><span class="default">file_get_contents</span><span class="keyword">(</span><span class="string">"php://input"</span><span class="keyword">);<br />
if (</span><span class="default">strpos</span><span class="keyword">(</span><span class="default">$hdr</span><span class="keyword">,</span><span class="string">'&lt;s:Header&gt;'</span><span class="keyword">)===</span><span class="default">false</span><span class="keyword">) {<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$hdr </span><span class="keyword">= </span><span class="default">null</span><span class="keyword">;<br />
} else {<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$hdr </span><span class="keyword">= </span><span class="default">explode</span><span class="keyword">(</span><span class="string">'&lt;s:Header&gt;'</span><span class="keyword">,</span><span class="default">$hdr</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$hdr </span><span class="keyword">= </span><span class="default">explode</span><span class="keyword">(</span><span class="string">'&lt;/s:Header&gt;'</span><span class="keyword">,</span><span class="default">$hdr</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">]);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$hdr </span><span class="keyword">= </span><span class="default">$hdr</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">];<br />
}<br />
</span><span class="default">$srv </span><span class="keyword">= new </span><span class="default">SoapServer</span><span class="keyword">(</span><span class="string">'Your_wsdl'</span><span class="keyword">);<br />
</span><span class="default">$srv</span><span class="keyword">-&gt;</span><span class="default">setClass</span><span class="keyword">(</span><span class="string">"ServiceClass"</span><span class="keyword">,</span><span class="default">$hdr</span><span class="keyword">);<br />
</span><span class="default">$srv</span><span class="keyword">-&gt;</span><span class="default">handle</span><span class="keyword">();<br />
</span><span class="default">?&gt;<br />
</span><br />
And the service class is like this:<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">class </span><span class="default">ServiceClass </span><span class="keyword">{<br />
&nbsp;&nbsp;&nbsp; var </span><span class="default">$IsAuthenticated</span><span class="keyword">;<br />
<br />
&nbsp;&nbsp;&nbsp; function </span><span class="default">__construct</span><span class="keyword">(</span><span class="default">$hdr</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">IsAuthenticated </span><span class="keyword">= </span><span class="default">false</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">$hdr</span><span class="keyword">!=</span><span class="default">null</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">header </span><span class="keyword">= </span><span class="default">simplexml_load_string</span><span class="keyword">(</span><span class="default">$hdr</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">//Your authentication stuff goes here...<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">}<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; function </span><span class="default">SomeFunctionOfTheService</span><span class="keyword">(</span><span class="default">$a</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">IsAuthenticated</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">//here Your function...<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">}<br />
&nbsp;&nbsp;&nbsp; }<br />
<br />
}<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="98021""></a>
  <div class="note">
   <strong class="user">carlos dot vini at gmail dot com</strong>
   <a href="#98021" class="date">20-May-2010 10:55</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
SoapServer does not support WSDL with literal/document. I have a class:
<br />

<br />
<span class="default">&lt;?php
<br />
</span><span class="keyword">class </span><span class="default">My_Soap </span><span class="keyword">{
<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">/**
<br />
&nbsp;&nbsp; &nbsp; * Returns Hello World.
<br />
&nbsp;&nbsp; &nbsp; * 
<br />
&nbsp;&nbsp; &nbsp; * @param string $world
<br />
&nbsp;&nbsp; &nbsp; * @return string
<br />
&nbsp;&nbsp; &nbsp; */
<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">public function </span><span class="default">getInterAdmins</span><span class="keyword">(</span><span class="default">$world</span><span class="keyword">) {
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="string">'hello' </span><span class="keyword">. </span><span class="default">$world</span><span class="keyword">;
<br />
&nbsp;&nbsp;&nbsp; }
<br />
}
<br />
</span><span class="default">?&gt;
<br />
</span>
<br />
To fix this I had to create proxy class:
<br />
<span class="default">&lt;?php
<br />
</span><span class="keyword">class </span><span class="default">My_Soap_LiteralDocumentProxy </span><span class="keyword">{
<br />
&nbsp;&nbsp; public function </span><span class="default">__call</span><span class="keyword">(</span><span class="default">$methodName</span><span class="keyword">, </span><span class="default">$args</span><span class="keyword">) {
<br />
&nbsp;&nbsp; &nbsp; &nbsp; </span><span class="default">$soapClass </span><span class="keyword">= new </span><span class="default">My_Soap</span><span class="keyword">();
<br />
&nbsp;&nbsp; &nbsp; &nbsp; </span><span class="default">$result </span><span class="keyword">= </span><span class="default">call_user_func_array</span><span class="keyword">(array(</span><span class="default">$soapClass</span><span class="keyword">, </span><span class="default">$methodName</span><span class="keyword">),&nbsp; </span><span class="default">$args</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">]);
<br />
&nbsp;&nbsp; &nbsp; &nbsp; return array(</span><span class="default">$methodName </span><span class="keyword">. </span><span class="string">'Result' </span><span class="keyword">=&gt; </span><span class="default">$result</span><span class="keyword">);
<br />
&nbsp;&nbsp; }
<br />
}
<br />
</span><span class="default">?&gt;
<br />
</span>
<br />
Now make sure that the WSDL is created using My_Soap. And that the Server is created using My_Soap_LiteralDocumentProxy:
<br />

<br />
<span class="default">&lt;?php
<br />

<br />
</span><span class="keyword">if (isset(</span><span class="default">$_GET</span><span class="keyword">[</span><span class="string">'wsdl'</span><span class="keyword">])) {
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$wsdl </span><span class="keyword">= new </span><span class="default">Zend_Soap_AutoDiscover</span><span class="keyword">(); </span><span class="comment">// It generates the WSDL
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$wsdl</span><span class="keyword">-&gt;</span><span class="default">setOperationBodyStyle</span><span class="keyword">(array(
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="string">'use' </span><span class="keyword">=&gt; </span><span class="string">'literal'
<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">));
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$wsdl</span><span class="keyword">-&gt;</span><span class="default">setBindingStyle</span><span class="keyword">(array(
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="string">'style' </span><span class="keyword">=&gt; </span><span class="string">'document'
<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">));
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$wsdl</span><span class="keyword">-&gt;</span><span class="default">setClass</span><span class="keyword">(</span><span class="string">'My_Soap'</span><span class="keyword">);
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$wsdl</span><span class="keyword">-&gt;</span><span class="default">handle</span><span class="keyword">();
<br />
} else {
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$server </span><span class="keyword">= new </span><span class="default">Zend_Soap_Server</span><span class="keyword">(</span><span class="string">'<a href="http://localhost/something/webservice.php?wsdl" rel="nofollow" target="_blank">http://localhost/something/webservice.php?wsdl</a>'</span><span class="keyword">);
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$server</span><span class="keyword">-&gt;</span><span class="default">setClass</span><span class="keyword">(</span><span class="string">'My_Soap_LiteralDocumentProxy'</span><span class="keyword">);
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$server</span><span class="keyword">-&gt;</span><span class="default">handle</span><span class="keyword">();
<br />
}
<br />

<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="95309""></a>
  <div class="note">
   <strong class="user">dsubar at interna dot com</strong>
   <a href="#95309" class="date">26-Dec-2009 06:49</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Do not put a SoapServer and a SoapClient in the same PHP file. This seems to cause arbitrary behavior. On the PHP interpreter in Eclipse, everything worked fine. Under MAMP, I got an undocumented error. In moving the client from the same file as the server, everything worked fine.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
</div>
</div>
</div></div></body></html>
