<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
 <head>
  <meta http-equiv="content-type" content="text/html; CHARSET=shift-jis">
  <title>再サンプリングを行いイメージの一部をコピー、伸縮する</title>

  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <link media="all" rel="stylesheet" type="text/css" href="style.css"/>
 </head>
 <body class="docs" class="docs"><div class="navbar navbar-fixed-top">
  <div class="navbar-inner clearfix">
    <ul class="nav" style="width: 100%">
      <li style="float: left;"><a href="function.imagecopymergegray.html">≪ imagecopymergegray</a></li>
      <li style="float: right;"><a href="function.imagecopyresized.html">imagecopyresized ≫</a></li>
    </ul>
  </div>
</div>
<div id="breadcrumbs" class="clearfix">
  <ul class="breadcrumbs-container">
    <li><a href="index.html">PHP Manual</a></li>
    <li><a href="ref.image.html">GD および Image 関数</a></li>
    <li>再サンプリングを行いイメージの一部をコピー、伸縮する</li>
  </ul>
</div>
<div id="layout">
  <div id="layout-content"><div id="function.imagecopyresampled" class="refentry">
 <div class="refnamediv">
  <h1 class="refname">imagecopyresampled</h1>
  <p class="verinfo">(PHP 4 &gt;= 4.0.6, PHP 5)</p><p class="refpurpose"><span class="refname">imagecopyresampled</span> &mdash; <span class="dc-title">再サンプリングを行いイメージの一部をコピー、伸縮する</span></p>

 </div>
 <div class="refsect1 description" id="refsect1-function.imagecopyresampled-description">
  <h3 class="title">説明</h3>
  <div class="methodsynopsis dc-description">
   <span class="type">bool</span> <span class="methodname"><strong>imagecopyresampled</strong></span>
    ( <span class="methodparam"><span class="type">resource</span> <code class="parameter">$dst_image</code></span>
   , <span class="methodparam"><span class="type">resource</span> <code class="parameter">$src_image</code></span>
   , <span class="methodparam"><span class="type">int</span> <code class="parameter">$dst_x</code></span>
   , <span class="methodparam"><span class="type">int</span> <code class="parameter">$dst_y</code></span>
   , <span class="methodparam"><span class="type">int</span> <code class="parameter">$src_x</code></span>
   , <span class="methodparam"><span class="type">int</span> <code class="parameter">$src_y</code></span>
   , <span class="methodparam"><span class="type">int</span> <code class="parameter">$dst_w</code></span>
   , <span class="methodparam"><span class="type">int</span> <code class="parameter">$dst_h</code></span>
   , <span class="methodparam"><span class="type">int</span> <code class="parameter">$src_w</code></span>
   , <span class="methodparam"><span class="type">int</span> <code class="parameter">$src_h</code></span>
   )</div>

  <p class="para rdfs-comment">
   <span class="function"><strong>imagecopyresampled()</strong></span> は、イメージの矩形の部分
   を別のイメージにコピーします。同時にピクセル値を滑らかに補間を行い、
   このため、特にサイズを小さくした場合には鮮明さが維持されます。
  </p>
  <p class="para">
   言い換えると、<span class="function"><strong>imagecopyresampled()</strong></span> は
   <code class="parameter">src_image</code>
   の座標 (<code class="parameter">src_x</code>,<code class="parameter">src_y</code>) にある
   幅 <code class="parameter">src_w</code>、高さ <code class="parameter">src_h</code>
   の矩形領域を受け取って、それを <code class="parameter">dst_image</code>
   の座標 (<code class="parameter">dst_x</code>,<code class="parameter">dst_y</code>)
   にある幅 <code class="parameter">dst_w</code>、高さ <code class="parameter">dst_h</code>
   の矩形領域に配置します。
  </p>
  <p class="para">
   コピー元とコピー先の座標、幅、高さが異なる場合には、
   適当なイメージ伸縮が行われます。座標は、左上を基準とします。
   この関数は、同じイメージ内の領域にコピーする場合にも使用可能です
   (<code class="parameter">dst_image</code> が <code class="parameter">src_image</code>
   と同じ場合) が、領域が重なる場合の結果は予測できません。
  </p>
 </div>

 <div class="refsect1 parameters" id="refsect1-function.imagecopyresampled-parameters">
  <h3 class="title">パラメータ</h3>
  <p class="para">
   <dl>

    
     <dt>
<code class="parameter">dst_image</code></dt>

     <dd>

      <p class="para">コピー先の画像リンクリソース。</p>
     </dd>

    
    
     <dt>
<code class="parameter">src_image</code></dt>

     <dd>

      <p class="para">コピー元の画像リンクリソース。</p>
     </dd>

    
    
     <dt>
<code class="parameter">dst_x</code></dt>

     <dd>

      <p class="para">
       コピー先の x 座標。
      </p>
     </dd>

    
    
     <dt>
<code class="parameter">dst_y</code></dt>

     <dd>

      <p class="para">
       コピー先の y 座標。
      </p>
     </dd>

    
    
     <dt>
<code class="parameter">src_x</code></dt>

     <dd>

      <p class="para">
       コピー元の x 座標。
      </p>
     </dd>

    
    
     <dt>
<code class="parameter">src_y</code></dt>

     <dd>

      <p class="para">
       コピー元の y 座標。
      </p>
     </dd>

    
    
     <dt>
<code class="parameter">dst_w</code></dt>

     <dd>

      <p class="para">
       コピー先の幅。
      </p>
     </dd>

    
    
     <dt>
<code class="parameter">dst_h</code></dt>

     <dd>

      <p class="para">
       コピー先の高さ。
      </p>
     </dd>

    
    
     <dt>
<code class="parameter">src_w</code></dt>

     <dd>

      <p class="para">コピー元の幅。</p>
     </dd>

    
    
     <dt>
<code class="parameter">src_h</code></dt>

     <dd>

      <p class="para">コピー元の高さ。</p>
     </dd>

    
   </dl>

  </p>
 </div>

 <div class="refsect1 returnvalues" id="refsect1-function.imagecopyresampled-returnvalues">
  <h3 class="title">返り値</h3>
  <p class="para">
   成功した場合に <strong><code>TRUE</code></strong> を、失敗した場合に <strong><code>FALSE</code></strong> を返します。
  </p>
 </div>

 <div class="refsect1 examples" id="refsect1-function.imagecopyresampled-examples">
  <h3 class="title">例</h3>
  <p class="para">
   <div class="example" id="example-3297">
    <p><strong>例1 単純な例</strong></p>
    <div class="example-contents"><p>
     この例は、イメージをオリジナルの半分のサイズに再サンプルします。
    </p></div>
    <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br /></span><span style="color: #FF8000">//&nbsp;ファイル<br /></span><span style="color: #0000BB">$filename&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #DD0000">'test.jpg'</span><span style="color: #007700">;<br /></span><span style="color: #0000BB">$percent&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">0.5</span><span style="color: #007700">;<br /><br /></span><span style="color: #FF8000">//&nbsp;コンテントタイプ<br /></span><span style="color: #0000BB">header</span><span style="color: #007700">(</span><span style="color: #DD0000">'Content-Type:&nbsp;image/jpeg'</span><span style="color: #007700">);<br /><br /></span><span style="color: #FF8000">//&nbsp;新規サイズを取得します<br /></span><span style="color: #007700">list(</span><span style="color: #0000BB">$width</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$height</span><span style="color: #007700">)&nbsp;=&nbsp;</span><span style="color: #0000BB">getimagesize</span><span style="color: #007700">(</span><span style="color: #0000BB">$filename</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">$new_width&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$width&nbsp;</span><span style="color: #007700">*&nbsp;</span><span style="color: #0000BB">$percent</span><span style="color: #007700">;<br /></span><span style="color: #0000BB">$new_height&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$height&nbsp;</span><span style="color: #007700">*&nbsp;</span><span style="color: #0000BB">$percent</span><span style="color: #007700">;<br /><br /></span><span style="color: #FF8000">//&nbsp;再サンプル<br /></span><span style="color: #0000BB">$image_p&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">imagecreatetruecolor</span><span style="color: #007700">(</span><span style="color: #0000BB">$new_width</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$new_height</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">$image&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">imagecreatefromjpeg</span><span style="color: #007700">(</span><span style="color: #0000BB">$filename</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">imagecopyresampled</span><span style="color: #007700">(</span><span style="color: #0000BB">$image_p</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$image</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">0</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">0</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">0</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">0</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$new_width</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$new_height</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$width</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$height</span><span style="color: #007700">);<br /><br /></span><span style="color: #FF8000">//&nbsp;出力<br /></span><span style="color: #0000BB">imagejpeg</span><span style="color: #007700">(</span><span style="color: #0000BB">$image_p</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">null</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">100</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
    </div>

    <div class="example-contents"><p>上の例の出力は、
たとえば以下のようになります。</p></div>
    <div class="mediaobject">
     
     <div class="imageobject">
      <img src="images/21009b70229598c6a80eef8b45bf282b-imagecopyresampled.jpg" alt="出力例 : 単純な例" width="47" height="25" />
     </div>
    </div>
   </div>
  </p>
  <p class="para">
   <div class="example" id="example-3298">
    <p><strong>例2 イメージを均等に再サンプルする</strong></p>
    <div class="example-contents"><p>
     この例は最大の幅もしくは高さが 200 ピクセルのイメージを表示します。
    </p></div>
    <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br /></span><span style="color: #FF8000">//&nbsp;ファイル<br /></span><span style="color: #0000BB">$filename&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #DD0000">'test.jpg'</span><span style="color: #007700">;<br /><br /></span><span style="color: #FF8000">//&nbsp;最大の高さ・幅を設定します<br /></span><span style="color: #0000BB">$width&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">200</span><span style="color: #007700">;<br /></span><span style="color: #0000BB">$height&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">200</span><span style="color: #007700">;<br /><br /></span><span style="color: #FF8000">//&nbsp;コンテントタイプ<br /></span><span style="color: #0000BB">header</span><span style="color: #007700">(</span><span style="color: #DD0000">'Content-Type:&nbsp;image/jpeg'</span><span style="color: #007700">);<br /><br /></span><span style="color: #FF8000">//&nbsp;新規サイズを取得します<br /></span><span style="color: #007700">list(</span><span style="color: #0000BB">$width_orig</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$height_orig</span><span style="color: #007700">)&nbsp;=&nbsp;</span><span style="color: #0000BB">getimagesize</span><span style="color: #007700">(</span><span style="color: #0000BB">$filename</span><span style="color: #007700">);<br /><br /></span><span style="color: #0000BB">$ratio_orig&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$width_orig</span><span style="color: #007700">/</span><span style="color: #0000BB">$height_orig</span><span style="color: #007700">;<br /><br />if&nbsp;(</span><span style="color: #0000BB">$width</span><span style="color: #007700">/</span><span style="color: #0000BB">$height&nbsp;</span><span style="color: #007700">&gt;&nbsp;</span><span style="color: #0000BB">$ratio_orig</span><span style="color: #007700">)&nbsp;{<br />&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$width&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$height</span><span style="color: #007700">*</span><span style="color: #0000BB">$ratio_orig</span><span style="color: #007700">;<br />}&nbsp;else&nbsp;{<br />&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$height&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$width</span><span style="color: #007700">/</span><span style="color: #0000BB">$ratio_orig</span><span style="color: #007700">;<br />}<br /><br /></span><span style="color: #FF8000">//&nbsp;再サンプル<br /></span><span style="color: #0000BB">$image_p&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">imagecreatetruecolor</span><span style="color: #007700">(</span><span style="color: #0000BB">$width</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$height</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">$image&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">imagecreatefromjpeg</span><span style="color: #007700">(</span><span style="color: #0000BB">$filename</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">imagecopyresampled</span><span style="color: #007700">(</span><span style="color: #0000BB">$image_p</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$image</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">0</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">0</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">0</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">0</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$width</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$height</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$width_orig</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$height_orig</span><span style="color: #007700">);<br /><br /></span><span style="color: #FF8000">//&nbsp;出力<br /></span><span style="color: #0000BB">imagejpeg</span><span style="color: #007700">(</span><span style="color: #0000BB">$image_p</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">null</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">100</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
    </div>

    <div class="example-contents"><p>上の例の出力は、
たとえば以下のようになります。</p></div>
    <div class="mediaobject">
     
     <div class="imageobject">
      <img src="images/21009b70229598c6a80eef8b45bf282b-imagecopyresampled_2.jpg" alt="出力例 : イメージを均等に再サンプルする" width="200" height="107" />
     </div>
    </div>
   </div>
  </p>
 </div>

 <div class="refsect1 notes" id="refsect1-function.imagecopyresampled-notes">
  <h3 class="title">注意</h3>
  <blockquote class="note"><p><strong class="note">注意</strong>: 
   <p class="para">
    パレットイメージの制限(255+1色)による問題があります。
    カラーの再サンプリングやフィルタリングには通常は255色以上の色が
    必要となります。再サンプルするピクセルとその色を計算するために
    ある種の近似計算が使用されます。パレットに新しい色を割り当てよう
    として失敗すると、(理論的に)最も近い色が選択されます。
    それは必ずしも常に可視色とは限りません。そのため、
    空白(あるいは不可視な)といった不可思議な結果がもたらされます。
    この問題を回避するには、<span class="function"><a href="function.imagecreatetruecolor.html" class="function">imagecreatetruecolor()</a></span>で
    生成されるようなTrueカラーイメージを目的のイメージとして
    使用してください。
   </p>
  </p></blockquote>
 </div>

 <div class="refsect1 seealso" id="refsect1-function.imagecopyresampled-seealso">
  <h3 class="title">参考</h3>
  <p class="para">
   <span class="function"><a href="function.imagecopyresized.html" class="function" rel="rdfs-seeAlso">imagecopyresized()</a> - 画像の一部をコピーしサイズを変更する</span>
  </p>
 </div>

</div><div id="usernotes">
 <div class="head">
  <h3 class="title">User Contributed Notes</h3>
 </div>
<div id="allnotes">  <a name="114758""></a>
  <div class="note">
   <strong class="user">julien at go-on-web dot com</strong>
   <a href="#114758" class="date">02-Apr-2014 05:59</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Windows does not accept floating width and height...<br />
<br />
So, in "Example #2 Resampling an image proportionally", prefer :<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">if (</span><span class="default">$width</span><span class="keyword">/</span><span class="default">$height </span><span class="keyword">&gt; </span><span class="default">$ratio_orig</span><span class="keyword">) {<br />
&nbsp;&nbsp; </span><span class="default">$width </span><span class="keyword">= </span><span class="default">round</span><span class="keyword">( </span><span class="default">$height</span><span class="keyword">*</span><span class="default">$ratio_orig </span><span class="keyword">);<br />
} else {<br />
&nbsp;&nbsp; </span><span class="default">$height </span><span class="keyword">= </span><span class="default">round</span><span class="keyword">( </span><span class="default">$width</span><span class="keyword">/</span><span class="default">$ratio_orig </span><span class="keyword">);<br />
}<br />
</span><span class="default">?&gt;<br />
</span>(used "round")<br />
otherwise your image wont be resized.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="114602""></a>
  <div class="note">
   <strong class="user">kazuya</strong>
   <a href="#114602" class="date">11-Mar-2014 11:24</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
<span class="default">&lt;?php<br />
<br />
$new_file </span><span class="keyword">= </span><span class="default">img_resize</span><span class="keyword">(</span><span class="string">"./img/"</span><span class="keyword">, </span><span class="string">"test.jpg"</span><span class="keyword">,</span><span class="string">"copy_test.jpg"</span><span class="keyword">,</span><span class="default">300</span><span class="keyword">);<br />
echo </span><span class="string">"&lt;IMG src = '</span><span class="default">$new_file</span><span class="string">'&gt;"</span><span class="keyword">;<br />
<br />
function </span><span class="default">img_resize</span><span class="keyword">(</span><span class="default">$path</span><span class="keyword">,</span><span class="default">$tmp_name</span><span class="keyword">,</span><span class="default">$new_name</span><span class="keyword">,</span><span class="default">$new_width</span><span class="keyword">){<br />
&nbsp;&nbsp;&nbsp; if (!</span><span class="default">file_exists</span><span class="keyword">(</span><span class="default">$path</span><span class="keyword">.</span><span class="default">$filename</span><span class="keyword">)){<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; echo </span><span class="string">"file not found!"</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; exit;<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; if (!</span><span class="default">is_writable</span><span class="keyword">(</span><span class="default">$path</span><span class="keyword">)){<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; echo </span><span class="string">"error:permission denied!"</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; exit;<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; list(</span><span class="default">$width</span><span class="keyword">, </span><span class="default">$height</span><span class="keyword">) = </span><span class="default">getimagesize</span><span class="keyword">(</span><span class="default">$path </span><span class="keyword">. </span><span class="default">$tmp_name</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$new_height </span><span class="keyword">= </span><span class="default">abs</span><span class="keyword">(</span><span class="default">$new_width </span><span class="keyword">* </span><span class="default">$height </span><span class="keyword">/ </span><span class="default">$width</span><span class="keyword">); <br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$image_p </span><span class="keyword">= </span><span class="default">imagecreatetruecolor</span><span class="keyword">(</span><span class="default">$new_width</span><span class="keyword">, </span><span class="default">$new_height</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$image </span><span class="keyword">= </span><span class="default">imagecreatefromjpeg</span><span class="keyword">(</span><span class="default">$path </span><span class="keyword">. </span><span class="default">$tmp_name</span><span class="keyword">); <br />
&nbsp;&nbsp;&nbsp; </span><span class="default">imagecopyresampled</span><span class="keyword">(</span><span class="default">$image_p</span><span class="keyword">, </span><span class="default">$image</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">,<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$new_width</span><span class="keyword">, </span><span class="default">$new_height</span><span class="keyword">, </span><span class="default">$width</span><span class="keyword">, </span><span class="default">$height</span><span class="keyword">); <br />
&nbsp;&nbsp;&nbsp; </span><span class="default">imagejpeg</span><span class="keyword">(</span><span class="default">$image_p</span><span class="keyword">, </span><span class="default">$path </span><span class="keyword">. </span><span class="default">$new_name</span><span class="keyword">); <br />
&nbsp;&nbsp;&nbsp; return </span><span class="default">$path</span><span class="keyword">.</span><span class="default">$new_name</span><span class="keyword">;<br />
}<br />
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="113009""></a>
  <div class="note">
   <strong class="user">sam at durosoft.com</strong>
   <a href="#113009" class="date">18-Aug-2013 03:18</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
The ultimate smart image re-sizing routine. You provide the original image, and a desired width and/or height. The function will intelligently re-size the original image to fit, centered, within the specified dimensions. Either width or height can be omitted to have the re-size "lock" only on width or height. Fantastic for thumbnail generation. Designed to work with PNG's.<br />
<br />
function resize_image_smart($orig, $dest_width=null, $dest_height=null)<br />
{<br />
&nbsp; $orig_width = imagesx($orig);<br />
&nbsp; $orig_height = imagesy($orig);<br />
&nbsp; $vertical_offset = 0;<br />
&nbsp; $horizontal_offset = 0;<br />
&nbsp; if($dest_width == null)<br />
&nbsp; {<br />
&nbsp;&nbsp;&nbsp; if($dest_height == null)<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp;&nbsp; die('$dest_width and $dest_height cant both be null!');<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; // height is locked<br />
&nbsp;&nbsp;&nbsp; $dest_width = $dest_height * $orig_width / $orig_height;<br />
&nbsp; } else {<br />
&nbsp;&nbsp;&nbsp; if($dest_height == null)<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp;&nbsp; // width is locked<br />
&nbsp;&nbsp; &nbsp;&nbsp; $dest_height = $dest_width * $orig_height / $orig_width;<br />
&nbsp;&nbsp;&nbsp; } else {<br />
&nbsp;&nbsp; &nbsp;&nbsp; // both dimensions are locked<br />
&nbsp;&nbsp; &nbsp;&nbsp; $vertical_offset = $dest_height - ($orig_height * $dest_width) / $orig_width;<br />
&nbsp;&nbsp; &nbsp;&nbsp; $horizontal_offset = $dest_width - ($dest_height * $orig_width) / $orig_height;<br />
&nbsp;&nbsp; &nbsp;&nbsp; if($vertical_offset &lt; 0) $vertical_offset = 0;<br />
&nbsp;&nbsp; &nbsp;&nbsp; if($horizontal_offset &lt; 0) $horizontal_offset = 0;<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp; }<br />
&nbsp; $img = imagecreatetruecolor($dest_width, $dest_height);<br />
&nbsp; imagesavealpha($img, true);<br />
&nbsp; imagealphablending($img, false);<br />
&nbsp; $transparent = imagecolorallocatealpha($img, 0, 0, 0, 127);<br />
&nbsp; imagefill($img, 0, 0, $transparent);<br />
&nbsp; imagecopyresampled($img, $orig, round($horizontal_offset / 2),<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; round($vertical_offset / 2),<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; 0,<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; 0,<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; round($dest_width - $horizontal_offset),<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; round($dest_height - $vertical_offset),<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $orig_width,<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $orig_height);<br />
&nbsp; return $img;<br />
}</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="112764""></a>
  <div class="note">
   <strong class="user">wbcarts at juno dot com</strong>
   <a href="#112764" class="date">21-Jul-2013 04:58</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
FOUR RECTANGLES -- The Tools to Use this Function Creatively<br />
<br />
A rectangle is not an image, but every image has a Rectangled boundary with x=0 and y=0. The width and height are obtained with the getimagesize function.<br />
<br />
Because this function allows subimage areas to be defined, there are actually four rectangled areas that we need to be aware of.<br />
<br />
* R1 -- Source Image Boundaries<br />
* R2 -- Source Copy Area Boundaries<br />
* R3 -- Destination Image Boundaries<br />
* R4 -- Destination Resampled Placement Area Boundaries<br />
<br />
+-----------------------+&nbsp; +-----------------+<br />
|&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; R1&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; |&nbsp; |&nbsp; &nbsp; &nbsp; &nbsp; R3&nbsp; &nbsp; &nbsp;&nbsp; |<br />
|&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; |&nbsp; |&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; |<br />
|&nbsp; &nbsp; +------------+&nbsp; &nbsp;&nbsp; |&nbsp; |&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; |<br />
|&nbsp; &nbsp; |&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; |&nbsp; &nbsp;&nbsp; |&nbsp; |&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; |<br />
|&nbsp; &nbsp; |&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; |&nbsp; &nbsp;&nbsp; |&nbsp; |&nbsp; &nbsp; &nbsp; +------+&nbsp;&nbsp; |<br />
|&nbsp; &nbsp; |&nbsp; &nbsp;&nbsp; R2&nbsp; &nbsp;&nbsp; |&nbsp; &nbsp;&nbsp; |&nbsp; |&nbsp; &nbsp; &nbsp; |&nbsp; &nbsp; &nbsp; |&nbsp;&nbsp; |<br />
|&nbsp; &nbsp; |&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; |&nbsp; &nbsp;&nbsp; |&nbsp; |&nbsp; &nbsp; &nbsp; |&nbsp; R4&nbsp; |&nbsp;&nbsp; |<br />
|&nbsp; &nbsp; |&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; |&nbsp; &nbsp;&nbsp; |&nbsp; |&nbsp; &nbsp; &nbsp; |&nbsp; &nbsp; &nbsp; |&nbsp;&nbsp; |<br />
|&nbsp; &nbsp; |&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; |&nbsp; &nbsp;&nbsp; |&nbsp; |&nbsp; &nbsp; &nbsp; +------+&nbsp;&nbsp; |<br />
|&nbsp; &nbsp; +------------+&nbsp; &nbsp;&nbsp; |&nbsp; |&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; |<br />
|&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; |&nbsp; +-----------------+<br />
|&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; |<br />
+-----------------------+<br />
<br />
R1 contains all of the original pixel data. If R2 goes outside of R1 in any direction, then R2 will contain stuff that doesn't help. A lot of the time R2 == R1 exactly.<br />
<br />
R3 defines the area that holds the resampled image data. If R4 goes outside of R3 in any direction, then the resampled image data in R4 will be clipped by R3. In other words, R3 has the final say as to which of R4's pixels will be included in the final image. Most of the time, R4 == R3.<br />
<br />
In the end, R2 (and the pixels in it) will be strecthed, squeezed, and placed exactly over R4.<br />
<br />
There are plenty of good examples on this page to create thumbnails etc. But what if R3 was not destined to be a thumbnail? What if we wanted to take the entire R1 image and shrink it to fit inside R2 for example, leaving the original picture as a border? With the knowledge we have just gained it is a simple matter of creating the Source &amp; Destination Images from the same .jpg file, then R2 should be equal to R1, and R4 should be smaller and completely inside R3.<br />
<br />
When we think of these rectangles as tools and not images, it becomes easier to see what's going on.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="112742""></a>
  <div class="note">
   <strong class="user">wbcarts at juno dot com</strong>
   <a href="#112742" class="date">19-Jul-2013 04:14</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
FOUR RECTANGLES<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $src_image&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $dst_image<br />
+------------+---------------------------------+&nbsp;&nbsp; +------------+--------------------+<br />
|&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; |&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; |&nbsp;&nbsp; |&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; |&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; |<br />
|&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; |&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; |&nbsp;&nbsp; |&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $dst_y&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; |<br />
|&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; |&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; |&nbsp;&nbsp; |&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; |&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; |<br />
|&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $src_y&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; |&nbsp;&nbsp; +-- $dst_x --+----$dst_width----+ |<br />
|&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; |&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; |&nbsp;&nbsp; |&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; |&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | |<br />
|&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; |&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; |&nbsp;&nbsp; |&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; |&nbsp; &nbsp; Resampled&nbsp; &nbsp;&nbsp; | |<br />
|&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; |&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; |&nbsp;&nbsp; |&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; |&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | |<br />
+-- $src_x --+------ $src_width ------+&nbsp; &nbsp; &nbsp; &nbsp; |&nbsp;&nbsp; |&nbsp; &nbsp; &nbsp;&nbsp; $dst_height&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; | |<br />
|&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; |&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; |&nbsp; &nbsp; &nbsp; &nbsp; |&nbsp;&nbsp; |&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; |&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | |<br />
|&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; |&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; |&nbsp; &nbsp; &nbsp; &nbsp; |&nbsp;&nbsp; |&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; |&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | |<br />
|&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; |&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; |&nbsp; &nbsp; &nbsp; &nbsp; |&nbsp;&nbsp; |&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; |&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | |<br />
|&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; |&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; |&nbsp; &nbsp; &nbsp; &nbsp; |&nbsp;&nbsp; |&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; +------------------+ |<br />
|&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; |&nbsp; &nbsp; &nbsp; &nbsp; Sample&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; |&nbsp; &nbsp; &nbsp; &nbsp; |&nbsp;&nbsp; |&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; |<br />
|&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; |&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; |&nbsp; &nbsp; &nbsp; &nbsp; |&nbsp;&nbsp; |&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; |<br />
|&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; |&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; |&nbsp; &nbsp; &nbsp; &nbsp; |&nbsp;&nbsp; |&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; |<br />
|&nbsp; &nbsp; &nbsp;&nbsp; $src_height&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; |&nbsp; &nbsp; &nbsp; &nbsp; |&nbsp;&nbsp; |&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; |<br />
|&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; |&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; |&nbsp; &nbsp; &nbsp; &nbsp; |&nbsp;&nbsp; +---------------------------------+<br />
|&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; |&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; |&nbsp; &nbsp; &nbsp; &nbsp; |<br />
|&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; |&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; |&nbsp; &nbsp; &nbsp; &nbsp; |<br />
|&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; +------------------------+&nbsp; &nbsp; &nbsp; &nbsp; |<br />
|&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; |<br />
|&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; |<br />
+----------------------------------------------+</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="112275""></a>
  <div class="note">
   <strong class="user">hoangvu4000 at gmail dot com</strong>
   <a href="#112275" class="date">27-May-2013 02:50</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
My complete function to resize an image&nbsp; with exif data
<br />

<br />
<span class="default">&lt;?php
<br />
</span><span class="keyword">function </span><span class="default">CreateThumbnail</span><span class="keyword">(</span><span class="default">$pic</span><span class="keyword">,</span><span class="default">$thumb</span><span class="keyword">,</span><span class="default">$thumbwidth</span><span class="keyword">, </span><span class="default">$quality </span><span class="keyword">= </span><span class="default">100</span><span class="keyword">)
<br />
{
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; 
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$im1</span><span class="keyword">=</span><span class="default">ImageCreateFromJPEG</span><span class="keyword">(</span><span class="default">$pic</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if(</span><span class="default">function_exists</span><span class="keyword">(</span><span class="string">"exif_read_data"</span><span class="keyword">)){
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$exif </span><span class="keyword">= </span><span class="default">exif_read_data</span><span class="keyword">(</span><span class="default">$pic</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if(!empty(</span><span class="default">$exif</span><span class="keyword">[</span><span class="string">'Orientation'</span><span class="keyword">])) {
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; switch(</span><span class="default">$exif</span><span class="keyword">[</span><span class="string">'Orientation'</span><span class="keyword">]) {
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; case </span><span class="default">8</span><span class="keyword">:
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$im1 </span><span class="keyword">= </span><span class="default">imagerotate</span><span class="keyword">(</span><span class="default">$im1</span><span class="keyword">,</span><span class="default">90</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; break;
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; case </span><span class="default">3</span><span class="keyword">:
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$im1 </span><span class="keyword">= </span><span class="default">imagerotate</span><span class="keyword">(</span><span class="default">$im1</span><span class="keyword">,</span><span class="default">180</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; break;
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; case </span><span class="default">6</span><span class="keyword">:
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$im1 </span><span class="keyword">= </span><span class="default">imagerotate</span><span class="keyword">(</span><span class="default">$im1</span><span class="keyword">,-</span><span class="default">90</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; break;
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; } 
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$info </span><span class="keyword">= @</span><span class="default">getimagesize</span><span class="keyword">(</span><span class="default">$pic</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; 
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$width </span><span class="keyword">= </span><span class="default">$info</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">];
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; 
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$w2</span><span class="keyword">=</span><span class="default">ImageSx</span><span class="keyword">(</span><span class="default">$im1</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$h2</span><span class="keyword">=</span><span class="default">ImageSy</span><span class="keyword">(</span><span class="default">$im1</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$w1 </span><span class="keyword">= (</span><span class="default">$thumbwidth </span><span class="keyword">&lt;= </span><span class="default">$info</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">]) ? </span><span class="default">$thumbwidth </span><span class="keyword">: </span><span class="default">$info</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">]&nbsp; ;
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; 
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$h1</span><span class="keyword">=</span><span class="default">floor</span><span class="keyword">(</span><span class="default">$h2</span><span class="keyword">*(</span><span class="default">$w1</span><span class="keyword">/</span><span class="default">$w2</span><span class="keyword">));
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$im2</span><span class="keyword">=</span><span class="default">imagecreatetruecolor</span><span class="keyword">(</span><span class="default">$w1</span><span class="keyword">,</span><span class="default">$h1</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; 
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">imagecopyresampled </span><span class="keyword">(</span><span class="default">$im2</span><span class="keyword">,</span><span class="default">$im1</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">,</span><span class="default">$w1</span><span class="keyword">,</span><span class="default">$h1</span><span class="keyword">,</span><span class="default">$w2</span><span class="keyword">,</span><span class="default">$h2</span><span class="keyword">); 
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$path</span><span class="keyword">=</span><span class="default">addslashes</span><span class="keyword">(</span><span class="default">$thumb</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">ImageJPEG</span><span class="keyword">(</span><span class="default">$im2</span><span class="keyword">,</span><span class="default">$path</span><span class="keyword">,</span><span class="default">$quality</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">ImageDestroy</span><span class="keyword">(</span><span class="default">$im1</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">ImageDestroy</span><span class="keyword">(</span><span class="default">$im2</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; 
<br />
}
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="110592""></a>
  <div class="note">
   <strong class="user">alex-thennstaett-remove at gmx dot net</strong>
   <a href="#110592" class="date">11-Nov-2012 02:06</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Having updated GD-Library from 2.0.35-r1 to 2.0.35-r3 using negative numbers for $dstX or $dstY started to produce unpredictable results, such as inserting shrinked images and enlarging $dstH or $dstW all by itself. While it did work fine previously, one should avoid using or calculating negative numbers for imagecopyresampled from the beginning.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="106256""></a>
  <div class="note">
   <strong class="user">jagarock at gmail dot com</strong>
   <a href="#106256" class="date">21-Oct-2011 10:27</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
A simple function that will crop xxx px from the bottom of the image.
<br />

<br />
<span class="default">&lt;?php
<br />
</span><span class="keyword">function </span><span class="default">cropBottom</span><span class="keyword">(</span><span class="default">$image</span><span class="keyword">,</span><span class="default">$bottom</span><span class="keyword">) {
<br />
list(</span><span class="default">$width</span><span class="keyword">, </span><span class="default">$height</span><span class="keyword">) = </span><span class="default">getimagesize</span><span class="keyword">(</span><span class="default">$image</span><span class="keyword">); 
<br />
</span><span class="default">$img </span><span class="keyword">= </span><span class="default">imagecreatefromjpeg</span><span class="keyword">(</span><span class="default">$image</span><span class="keyword">); 
<br />
</span><span class="default">$crop </span><span class="keyword">= </span><span class="default">imagecreatetruecolor</span><span class="keyword">(</span><span class="default">$width</span><span class="keyword">,</span><span class="default">$height</span><span class="keyword">-</span><span class="default">$bottom</span><span class="keyword">);
<br />
</span><span class="default">imagecopyresampled </span><span class="keyword">( </span><span class="default">$crop</span><span class="keyword">, </span><span class="default">$img</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">$width</span><span class="keyword">, </span><span class="default">$height</span><span class="keyword">, </span><span class="default">$width</span><span class="keyword">, </span><span class="default">$height </span><span class="keyword">);
<br />
</span><span class="default">imagejpeg</span><span class="keyword">(</span><span class="default">$crop</span><span class="keyword">,</span><span class="default">$image</span><span class="keyword">,</span><span class="default">85</span><span class="keyword">);
<br />
}
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="104028""></a>
  <div class="note">
   <strong class="user">promaty at gmail dot com</strong>
   <a href="#104028" class="date">18-May-2011 02:26</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Here is my ultimate image resizer that preserves transparency for gif's and png's and has an option to crop images to fixed dimensions (preserves image proportions by default)<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">function </span><span class="default">image_resize</span><span class="keyword">(</span><span class="default">$src</span><span class="keyword">, </span><span class="default">$dst</span><span class="keyword">, </span><span class="default">$width</span><span class="keyword">, </span><span class="default">$height</span><span class="keyword">, </span><span class="default">$crop</span><span class="keyword">=</span><span class="default">0</span><span class="keyword">){<br />
<br />
&nbsp; if(!list(</span><span class="default">$w</span><span class="keyword">, </span><span class="default">$h</span><span class="keyword">) = </span><span class="default">getimagesize</span><span class="keyword">(</span><span class="default">$src</span><span class="keyword">)) return </span><span class="string">"Unsupported picture type!"</span><span class="keyword">;<br />
<br />
&nbsp; </span><span class="default">$type </span><span class="keyword">= </span><span class="default">strtolower</span><span class="keyword">(</span><span class="default">substr</span><span class="keyword">(</span><span class="default">strrchr</span><span class="keyword">(</span><span class="default">$src</span><span class="keyword">,</span><span class="string">"."</span><span class="keyword">),</span><span class="default">1</span><span class="keyword">));<br />
&nbsp; if(</span><span class="default">$type </span><span class="keyword">== </span><span class="string">'jpeg'</span><span class="keyword">) </span><span class="default">$type </span><span class="keyword">= </span><span class="string">'jpg'</span><span class="keyword">;<br />
&nbsp; switch(</span><span class="default">$type</span><span class="keyword">){<br />
&nbsp;&nbsp;&nbsp; case </span><span class="string">'bmp'</span><span class="keyword">: </span><span class="default">$img </span><span class="keyword">= </span><span class="default">imagecreatefromwbmp</span><span class="keyword">(</span><span class="default">$src</span><span class="keyword">); break;<br />
&nbsp;&nbsp;&nbsp; case </span><span class="string">'gif'</span><span class="keyword">: </span><span class="default">$img </span><span class="keyword">= </span><span class="default">imagecreatefromgif</span><span class="keyword">(</span><span class="default">$src</span><span class="keyword">); break;<br />
&nbsp;&nbsp;&nbsp; case </span><span class="string">'jpg'</span><span class="keyword">: </span><span class="default">$img </span><span class="keyword">= </span><span class="default">imagecreatefromjpeg</span><span class="keyword">(</span><span class="default">$src</span><span class="keyword">); break;<br />
&nbsp;&nbsp;&nbsp; case </span><span class="string">'png'</span><span class="keyword">: </span><span class="default">$img </span><span class="keyword">= </span><span class="default">imagecreatefrompng</span><span class="keyword">(</span><span class="default">$src</span><span class="keyword">); break;<br />
&nbsp;&nbsp;&nbsp; default : return </span><span class="string">"Unsupported picture type!"</span><span class="keyword">;<br />
&nbsp; }<br />
<br />
&nbsp; </span><span class="comment">// resize<br />
&nbsp; </span><span class="keyword">if(</span><span class="default">$crop</span><span class="keyword">){<br />
&nbsp;&nbsp;&nbsp; if(</span><span class="default">$w </span><span class="keyword">&lt; </span><span class="default">$width </span><span class="keyword">or </span><span class="default">$h </span><span class="keyword">&lt; </span><span class="default">$height</span><span class="keyword">) return </span><span class="string">"Picture is too small!"</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$ratio </span><span class="keyword">= </span><span class="default">max</span><span class="keyword">(</span><span class="default">$width</span><span class="keyword">/</span><span class="default">$w</span><span class="keyword">, </span><span class="default">$height</span><span class="keyword">/</span><span class="default">$h</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$h </span><span class="keyword">= </span><span class="default">$height </span><span class="keyword">/ </span><span class="default">$ratio</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$x </span><span class="keyword">= (</span><span class="default">$w </span><span class="keyword">- </span><span class="default">$width </span><span class="keyword">/ </span><span class="default">$ratio</span><span class="keyword">) / </span><span class="default">2</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$w </span><span class="keyword">= </span><span class="default">$width </span><span class="keyword">/ </span><span class="default">$ratio</span><span class="keyword">;<br />
&nbsp; }<br />
&nbsp; else{<br />
&nbsp;&nbsp;&nbsp; if(</span><span class="default">$w </span><span class="keyword">&lt; </span><span class="default">$width </span><span class="keyword">and </span><span class="default">$h </span><span class="keyword">&lt; </span><span class="default">$height</span><span class="keyword">) return </span><span class="string">"Picture is too small!"</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$ratio </span><span class="keyword">= </span><span class="default">min</span><span class="keyword">(</span><span class="default">$width</span><span class="keyword">/</span><span class="default">$w</span><span class="keyword">, </span><span class="default">$height</span><span class="keyword">/</span><span class="default">$h</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$width </span><span class="keyword">= </span><span class="default">$w </span><span class="keyword">* </span><span class="default">$ratio</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$height </span><span class="keyword">= </span><span class="default">$h </span><span class="keyword">* </span><span class="default">$ratio</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$x </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">;<br />
&nbsp; }<br />
<br />
&nbsp; </span><span class="default">$new </span><span class="keyword">= </span><span class="default">imagecreatetruecolor</span><span class="keyword">(</span><span class="default">$width</span><span class="keyword">, </span><span class="default">$height</span><span class="keyword">);<br />
<br />
&nbsp; </span><span class="comment">// preserve transparency<br />
&nbsp; </span><span class="keyword">if(</span><span class="default">$type </span><span class="keyword">== </span><span class="string">"gif" </span><span class="keyword">or </span><span class="default">$type </span><span class="keyword">== </span><span class="string">"png"</span><span class="keyword">){<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">imagecolortransparent</span><span class="keyword">(</span><span class="default">$new</span><span class="keyword">, </span><span class="default">imagecolorallocatealpha</span><span class="keyword">(</span><span class="default">$new</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">127</span><span class="keyword">));<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">imagealphablending</span><span class="keyword">(</span><span class="default">$new</span><span class="keyword">, </span><span class="default">false</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">imagesavealpha</span><span class="keyword">(</span><span class="default">$new</span><span class="keyword">, </span><span class="default">true</span><span class="keyword">);<br />
&nbsp; }<br />
<br />
&nbsp; </span><span class="default">imagecopyresampled</span><span class="keyword">(</span><span class="default">$new</span><span class="keyword">, </span><span class="default">$img</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">$x</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">$width</span><span class="keyword">, </span><span class="default">$height</span><span class="keyword">, </span><span class="default">$w</span><span class="keyword">, </span><span class="default">$h</span><span class="keyword">);<br />
<br />
&nbsp; switch(</span><span class="default">$type</span><span class="keyword">){<br />
&nbsp;&nbsp;&nbsp; case </span><span class="string">'bmp'</span><span class="keyword">: </span><span class="default">imagewbmp</span><span class="keyword">(</span><span class="default">$new</span><span class="keyword">, </span><span class="default">$dst</span><span class="keyword">); break;<br />
&nbsp;&nbsp;&nbsp; case </span><span class="string">'gif'</span><span class="keyword">: </span><span class="default">imagegif</span><span class="keyword">(</span><span class="default">$new</span><span class="keyword">, </span><span class="default">$dst</span><span class="keyword">); break;<br />
&nbsp;&nbsp;&nbsp; case </span><span class="string">'jpg'</span><span class="keyword">: </span><span class="default">imagejpeg</span><span class="keyword">(</span><span class="default">$new</span><span class="keyword">, </span><span class="default">$dst</span><span class="keyword">); break;<br />
&nbsp;&nbsp;&nbsp; case </span><span class="string">'png'</span><span class="keyword">: </span><span class="default">imagepng</span><span class="keyword">(</span><span class="default">$new</span><span class="keyword">, </span><span class="default">$dst</span><span class="keyword">); break;<br />
&nbsp; }<br />
&nbsp; return </span><span class="default">true</span><span class="keyword">;<br />
}<br />
</span><span class="default">?&gt;<br />
</span><br />
Example that I use when uploading new images to the server.<br />
<br />
This saves the original picture in the form:<br />
original.type<br />
<br />
and creates a new thumbnail:<br />
100x100.type<br />
<br />
<span class="default">&lt;?php<br />
&nbsp; $pic_type </span><span class="keyword">= </span><span class="default">strtolower</span><span class="keyword">(</span><span class="default">strrchr</span><span class="keyword">(</span><span class="default">$picture</span><span class="keyword">[</span><span class="string">'name'</span><span class="keyword">],</span><span class="string">"."</span><span class="keyword">));<br />
&nbsp; </span><span class="default">$pic_name </span><span class="keyword">= </span><span class="string">"original</span><span class="default">$pic_type</span><span class="string">"</span><span class="keyword">;<br />
&nbsp; </span><span class="default">move_uploaded_file</span><span class="keyword">(</span><span class="default">$picture</span><span class="keyword">[</span><span class="string">'tmp_name'</span><span class="keyword">], </span><span class="default">$pic_name</span><span class="keyword">);<br />
&nbsp; if (</span><span class="default">true </span><span class="keyword">!== (</span><span class="default">$pic_error </span><span class="keyword">= @</span><span class="default">image_resize</span><span class="keyword">(</span><span class="default">$pic_name</span><span class="keyword">, </span><span class="string">"100x100</span><span class="default">$pic_type</span><span class="string">"</span><span class="keyword">, </span><span class="default">100</span><span class="keyword">, </span><span class="default">100</span><span class="keyword">, </span><span class="default">1</span><span class="keyword">))) {<br />
&nbsp;&nbsp;&nbsp; echo </span><span class="default">$pic_error</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">unlink</span><span class="keyword">(</span><span class="default">$pic_name</span><span class="keyword">);<br />
&nbsp; }<br />
&nbsp; else echo </span><span class="string">"OK!"</span><span class="keyword">;<br />
</span><span class="default">?&gt;<br />
</span><br />
Cheers!</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="98560""></a>
  <div class="note">
   <strong class="user">guru_boy87 at hotmail dot com</strong>
   <a href="#98560" class="date">23-Jun-2010 01:52</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Function to resize an image.
<br />

<br />
<span class="default">&lt;?php
<br />
</span><span class="keyword">function </span><span class="default">resizeImage</span><span class="keyword">(</span><span class="default">$originalImage</span><span class="keyword">,</span><span class="default">$toWidth</span><span class="keyword">,</span><span class="default">$toHeight</span><span class="keyword">)
<br />
{
<br />

<br />
&nbsp;&nbsp;&nbsp; list(</span><span class="default">$width</span><span class="keyword">, </span><span class="default">$height</span><span class="keyword">) = </span><span class="default">getimagesize</span><span class="keyword">(</span><span class="default">$originalImage</span><span class="keyword">);
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$xscale</span><span class="keyword">=</span><span class="default">$width</span><span class="keyword">/</span><span class="default">$toWidth</span><span class="keyword">;
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$yscale</span><span class="keyword">=</span><span class="default">$height</span><span class="keyword">/</span><span class="default">$toHeight</span><span class="keyword">;
<br />

<br />
&nbsp;&nbsp;&nbsp; if (</span><span class="default">$yscale</span><span class="keyword">&gt;</span><span class="default">$xscale</span><span class="keyword">){
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$new_width </span><span class="keyword">= </span><span class="default">round</span><span class="keyword">(</span><span class="default">$width </span><span class="keyword">* (</span><span class="default">1</span><span class="keyword">/</span><span class="default">$yscale</span><span class="keyword">));
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$new_height </span><span class="keyword">= </span><span class="default">round</span><span class="keyword">(</span><span class="default">$height </span><span class="keyword">* (</span><span class="default">1</span><span class="keyword">/</span><span class="default">$yscale</span><span class="keyword">));
<br />
&nbsp;&nbsp;&nbsp; }
<br />
&nbsp;&nbsp;&nbsp; else {
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$new_width </span><span class="keyword">= </span><span class="default">round</span><span class="keyword">(</span><span class="default">$width </span><span class="keyword">* (</span><span class="default">1</span><span class="keyword">/</span><span class="default">$xscale</span><span class="keyword">));
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$new_height </span><span class="keyword">= </span><span class="default">round</span><span class="keyword">(</span><span class="default">$height </span><span class="keyword">* (</span><span class="default">1</span><span class="keyword">/</span><span class="default">$xscale</span><span class="keyword">));
<br />
&nbsp;&nbsp;&nbsp; }
<br />
&nbsp;&nbsp;&nbsp; 
<br />
&nbsp;&nbsp;&nbsp; 
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$imageResized </span><span class="keyword">= </span><span class="default">imagecreatetruecolor</span><span class="keyword">(</span><span class="default">$new_width</span><span class="keyword">, </span><span class="default">$new_height</span><span class="keyword">);
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$imageTmp&nbsp; &nbsp;&nbsp; </span><span class="keyword">= </span><span class="default">imagecreatefromjpeg </span><span class="keyword">(</span><span class="default">$originalImage</span><span class="keyword">);
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">imagecopyresampled</span><span class="keyword">(</span><span class="default">$imageResized</span><span class="keyword">, </span><span class="default">$imageTmp</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">$new_width</span><span class="keyword">, </span><span class="default">$new_height</span><span class="keyword">, </span><span class="default">$width</span><span class="keyword">, </span><span class="default">$height</span><span class="keyword">);
<br />

<br />
&nbsp;&nbsp;&nbsp; return </span><span class="default">$imageResized</span><span class="keyword">;
<br />
&nbsp;&nbsp;&nbsp; 
<br />

<br />
}
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="94251""></a>
  <div class="note">
   <strong class="user">seifer at loveletslive dot com</strong>
   <a href="#94251" class="date">25-Oct-2009 02:27</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Okay so I saw that others have posted this already but I just messed around and made it so figured I would share it.<br />
<br />
Mine works, not to say others don't, I haven't tested them.<br />
<br />
This function creates a thumbnail of the specfied size.<br />
If the thumbnail is a different ration it will automatically crop the center of the source image.<br />
<br />
It works if the source image is bigger or smaller than the desired "cropped thumbnail."<br />
<br />
Here is the code...<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">function </span><span class="default">CroppedThumbnail</span><span class="keyword">(</span><span class="default">$imgSrc</span><span class="keyword">,</span><span class="default">$thumbnail_width</span><span class="keyword">,</span><span class="default">$thumbnail_height</span><span class="keyword">) { </span><span class="comment">//$imgSrc is a FILE - Returns an image resource.<br />
&nbsp;&nbsp;&nbsp; //getting the image dimensions&nbsp; <br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">list(</span><span class="default">$width_orig</span><span class="keyword">, </span><span class="default">$height_orig</span><span class="keyword">) = </span><span class="default">getimagesize</span><span class="keyword">(</span><span class="default">$imgSrc</span><span class="keyword">);&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$myImage </span><span class="keyword">= </span><span class="default">imagecreatefromjpeg</span><span class="keyword">(</span><span class="default">$imgSrc</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$ratio_orig </span><span class="keyword">= </span><span class="default">$width_orig</span><span class="keyword">/</span><span class="default">$height_orig</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; if (</span><span class="default">$thumbnail_width</span><span class="keyword">/</span><span class="default">$thumbnail_height </span><span class="keyword">&gt; </span><span class="default">$ratio_orig</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; </span><span class="default">$new_height </span><span class="keyword">= </span><span class="default">$thumbnail_width</span><span class="keyword">/</span><span class="default">$ratio_orig</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; </span><span class="default">$new_width </span><span class="keyword">= </span><span class="default">$thumbnail_width</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; } else {<br />
&nbsp;&nbsp; &nbsp; &nbsp; </span><span class="default">$new_width </span><span class="keyword">= </span><span class="default">$thumbnail_height</span><span class="keyword">*</span><span class="default">$ratio_orig</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; </span><span class="default">$new_height </span><span class="keyword">= </span><span class="default">$thumbnail_height</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$x_mid </span><span class="keyword">= </span><span class="default">$new_width</span><span class="keyword">/</span><span class="default">2</span><span class="keyword">;&nbsp; </span><span class="comment">//horizontal middle<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$y_mid </span><span class="keyword">= </span><span class="default">$new_height</span><span class="keyword">/</span><span class="default">2</span><span class="keyword">; </span><span class="comment">//vertical middle<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$process </span><span class="keyword">= </span><span class="default">imagecreatetruecolor</span><span class="keyword">(</span><span class="default">round</span><span class="keyword">(</span><span class="default">$new_width</span><span class="keyword">), </span><span class="default">round</span><span class="keyword">(</span><span class="default">$new_height</span><span class="keyword">)); <br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; </span><span class="default">imagecopyresampled</span><span class="keyword">(</span><span class="default">$process</span><span class="keyword">, </span><span class="default">$myImage</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">$new_width</span><span class="keyword">, </span><span class="default">$new_height</span><span class="keyword">, </span><span class="default">$width_orig</span><span class="keyword">, </span><span class="default">$height_orig</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$thumb </span><span class="keyword">= </span><span class="default">imagecreatetruecolor</span><span class="keyword">(</span><span class="default">$thumbnail_width</span><span class="keyword">, </span><span class="default">$thumbnail_height</span><span class="keyword">); <br />
&nbsp;&nbsp;&nbsp; </span><span class="default">imagecopyresampled</span><span class="keyword">(</span><span class="default">$thumb</span><span class="keyword">, </span><span class="default">$process</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, (</span><span class="default">$x_mid</span><span class="keyword">-(</span><span class="default">$thumbnail_width</span><span class="keyword">/</span><span class="default">2</span><span class="keyword">)), (</span><span class="default">$y_mid</span><span class="keyword">-(</span><span class="default">$thumbnail_height</span><span class="keyword">/</span><span class="default">2</span><span class="keyword">)), </span><span class="default">$thumbnail_width</span><span class="keyword">, </span><span class="default">$thumbnail_height</span><span class="keyword">, </span><span class="default">$thumbnail_width</span><span class="keyword">, </span><span class="default">$thumbnail_height</span><span class="keyword">);<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">imagedestroy</span><span class="keyword">(</span><span class="default">$process</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">imagedestroy</span><span class="keyword">(</span><span class="default">$myImage</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; return </span><span class="default">$thumb</span><span class="keyword">;<br />
}<br />
<br />
</span><span class="comment">//Create the thumbnail<br />
</span><span class="default">$newThumb </span><span class="keyword">= </span><span class="default">CroppedThumbnail</span><span class="keyword">(</span><span class="string">"MyImageName.jpg"</span><span class="keyword">,</span><span class="default">75</span><span class="keyword">,</span><span class="default">100</span><span class="keyword">);<br />
<br />
</span><span class="comment">// And display the image...<br />
</span><span class="default">header</span><span class="keyword">(</span><span class="string">'Content-type: image/jpeg'</span><span class="keyword">);<br />
</span><span class="default">imagejpeg</span><span class="keyword">(</span><span class="default">$newThumb</span><span class="keyword">);<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="94221""></a>
  <div class="note">
   <strong class="user">michael at heymichael dot com</strong>
   <a href="#94221" class="date">23-Oct-2009 07:08</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
imagecopyresampled() works amazingly well, but here is something NOT to try with it:<br />
<br />
The resize routine I wrote looks for pixel widths, and resizes images based on the notion that if their widths and heights are too big, so are their byte sizes. It worked out well at first.<br />
<br />
But when I saw huge byte-size images slipping through beneath my 1000px-wide benchmark, I figured I'd subject the smaller-width images to resizing if their filesize() exceeded 100K.<br />
<br />
The idea was that I'd "resize" them keeping their original widths and heights (i.e. in (1) below, $newW = $oldW, $newH = $oldH), and letting the "75" at (2) below reduce the byte size.<br />
<br />
DON'T try that. imagecopyresampled() will lock up the server trying to resize an 800px-wide image to a "new" width of 800px. (I caught that on my Windows server before ever putting it on the destination Linux server, so take that with a grain of salt.)<br />
<br />
I got around it by making $newW = ($picW * 0.99), etc. You get the byte-size reduction you want without locking up.<br />
<br />
(1) imagecopyresampled($image_p, $image, 0, 0, 0, 0, $newW, $newH, $picW, $picH);<br />
<br />
(2) imagejpeg($image_p, $theFile, 75);</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="93190""></a>
  <div class="note">
   <strong class="user">asgaroth dot belem at gmail dot com</strong>
   <a href="#93190" class="date">27-Aug-2009 09:42</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
In case you are having trouble ( like I did ) and getting some kind of noise in the resampled image.<br />
<br />
then changing imagecopyresampled() with imagecopyresized()&nbsp; removes the noise, found that here: <a href="http://bugs.php.net/bug.php?id=45030" rel="nofollow" target="_blank">http://bugs.php.net/bug.php?id=45030</a><br />
<br />
Do not ask me why. but it works.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="93166""></a>
  <div class="note">
   <strong class="user">asgaroth dot belem at gmail dot com</strong>
   <a href="#93166" class="date">26-Aug-2009 08:38</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
About preserving the&nbsp; transparency when resizing PNGs this was the only thing that worked for me:<br />
<br />
<span class="default">&lt;?php imagealphablending</span><span class="keyword">(</span><span class="default">$new_watermark</span><span class="keyword">, </span><span class="default">false</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$color </span><span class="keyword">= </span><span class="default">imagecolortransparent</span><span class="keyword">(</span><span class="default">$new_watermark</span><span class="keyword">, </span><span class="default">imagecolorallocatealpha</span><span class="keyword">(</span><span class="default">$new_watermark</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">127</span><span class="keyword">));<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">imagefill</span><span class="keyword">(</span><span class="default">$new_watermark</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">$color</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">imagesavealpha</span><span class="keyword">(</span><span class="default">$new_watermark</span><span class="keyword">, </span><span class="default">true</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">imagecopyresampled</span><span class="keyword">(</span><span class="default">$new_watermark</span><span class="keyword">, </span><span class="default">$watermark</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">$new_watermark_width</span><span class="keyword">, </span><span class="default">$new_watermark_height</span><span class="keyword">, </span><span class="default">imagesx</span><span class="keyword">(</span><span class="default">$watermark</span><span class="keyword">),</span><span class="default">imagesy</span><span class="keyword">(</span><span class="default">$watermark</span><span class="keyword">)); <br />
</span><span class="default">?&gt;<br />
</span><br />
Tried without success:<br />
<br />
<span class="default">&lt;?php imagealphablending</span><span class="keyword">(</span><span class="default">$new_watermark</span><span class="keyword">, </span><span class="default">false</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$color </span><span class="keyword">= </span><span class="default">imagecolortransparent</span><span class="keyword">(</span><span class="default">$new_watermark</span><span class="keyword">, </span><span class="default">imagecolorallocate</span><span class="keyword">(</span><span class="default">$new_watermark</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">));<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">imagefill</span><span class="keyword">(</span><span class="default">$new_watermark</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">$color</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">imagesavealpha</span><span class="keyword">(</span><span class="default">$new_watermark</span><span class="keyword">, </span><span class="default">true</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">imagecopyresampled</span><span class="keyword">(</span><span class="default">$new_watermark</span><span class="keyword">, </span><span class="default">$watermark</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">$new_watermark_width</span><span class="keyword">, </span><span class="default">$new_watermark_height</span><span class="keyword">, </span><span class="default">imagesx</span><span class="keyword">(</span><span class="default">$watermark</span><span class="keyword">),</span><span class="default">imagesy</span><span class="keyword">(</span><span class="default">$watermark</span><span class="keyword">));<br />
&nbsp;</span><span class="default">?&gt;<br />
</span><br />
hope it helps someone.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="90544""></a>
  <div class="note">
   <strong class="user">z3n666 at gmail dot com</strong>
   <a href="#90544" class="date">27-Apr-2009 08:19</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I was looking around and couldn't find a function that resizes images to any ratio without leaving a blank area, so i wrote this one. It's able to resize images to any size ratio, when the ratio is no match with the original it will crop proportional area on the original and resize it.
<br />

<br />
<span class="default">&lt;?php
<br />

<br />
</span><span class="keyword">function </span><span class="default">_ckdir</span><span class="keyword">(</span><span class="default">$fn</span><span class="keyword">) {
<br />
&nbsp;&nbsp;&nbsp; if (</span><span class="default">strpos</span><span class="keyword">(</span><span class="default">$fn</span><span class="keyword">,</span><span class="string">"/"</span><span class="keyword">) !== </span><span class="default">false</span><span class="keyword">) {
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$p</span><span class="keyword">=</span><span class="default">substr</span><span class="keyword">(</span><span class="default">$fn</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">,</span><span class="default">strrpos</span><span class="keyword">(</span><span class="default">$fn</span><span class="keyword">,</span><span class="string">"/"</span><span class="keyword">));
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if (!</span><span class="default">is_dir</span><span class="keyword">(</span><span class="default">$p</span><span class="keyword">)) {
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">_o</span><span class="keyword">(</span><span class="string">"Mkdir: "</span><span class="keyword">.</span><span class="default">$p</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">mkdir</span><span class="keyword">(</span><span class="default">$p</span><span class="keyword">,</span><span class="default">777</span><span class="keyword">,</span><span class="default">true</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }
<br />
&nbsp;&nbsp;&nbsp; }
<br />
}
<br />
function </span><span class="default">img_resizer</span><span class="keyword">(</span><span class="default">$src</span><span class="keyword">,</span><span class="default">$quality</span><span class="keyword">,</span><span class="default">$w</span><span class="keyword">,</span><span class="default">$h</span><span class="keyword">,</span><span class="default">$saveas</span><span class="keyword">) {
<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">/* v2.5 with auto crop */
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$r</span><span class="keyword">=</span><span class="default">1</span><span class="keyword">;
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$e</span><span class="keyword">=</span><span class="default">strtolower</span><span class="keyword">(</span><span class="default">substr</span><span class="keyword">(</span><span class="default">$src</span><span class="keyword">,</span><span class="default">strrpos</span><span class="keyword">(</span><span class="default">$src</span><span class="keyword">,</span><span class="string">"."</span><span class="keyword">)+</span><span class="default">1</span><span class="keyword">,</span><span class="default">3</span><span class="keyword">));
<br />
&nbsp;&nbsp;&nbsp; if ((</span><span class="default">$e </span><span class="keyword">== </span><span class="string">"jpg"</span><span class="keyword">) || (</span><span class="default">$e </span><span class="keyword">== </span><span class="string">"peg"</span><span class="keyword">)) {
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$OldImage</span><span class="keyword">=</span><span class="default">ImageCreateFromJpeg</span><span class="keyword">(</span><span class="default">$src</span><span class="keyword">) or </span><span class="default">$r</span><span class="keyword">=</span><span class="default">0</span><span class="keyword">;
<br />
&nbsp;&nbsp;&nbsp; } elseif (</span><span class="default">$e </span><span class="keyword">== </span><span class="string">"gif"</span><span class="keyword">) {
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$OldImage</span><span class="keyword">=</span><span class="default">ImageCreateFromGif</span><span class="keyword">(</span><span class="default">$src</span><span class="keyword">) or </span><span class="default">$r</span><span class="keyword">=</span><span class="default">0</span><span class="keyword">;
<br />
&nbsp;&nbsp;&nbsp; } elseif (</span><span class="default">$e </span><span class="keyword">== </span><span class="string">"bmp"</span><span class="keyword">) {
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$OldImage</span><span class="keyword">=</span><span class="default">ImageCreateFromwbmp</span><span class="keyword">(</span><span class="default">$src</span><span class="keyword">) or </span><span class="default">$r</span><span class="keyword">=</span><span class="default">0</span><span class="keyword">;
<br />
&nbsp;&nbsp;&nbsp; } elseif (</span><span class="default">$e </span><span class="keyword">== </span><span class="string">"png"</span><span class="keyword">) {
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$OldImage</span><span class="keyword">=</span><span class="default">ImageCreateFromPng</span><span class="keyword">(</span><span class="default">$src</span><span class="keyword">) or </span><span class="default">$r</span><span class="keyword">=</span><span class="default">0</span><span class="keyword">;
<br />
&nbsp;&nbsp;&nbsp; } else {
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">_o</span><span class="keyword">(</span><span class="string">"Not a Valid Image! ("</span><span class="keyword">.</span><span class="default">$e</span><span class="keyword">.</span><span class="string">") -- "</span><span class="keyword">.</span><span class="default">$src</span><span class="keyword">);</span><span class="default">$r</span><span class="keyword">=</span><span class="default">0</span><span class="keyword">;
<br />
&nbsp;&nbsp;&nbsp; }
<br />
&nbsp;&nbsp;&nbsp; if (</span><span class="default">$r</span><span class="keyword">) {
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; list(</span><span class="default">$width</span><span class="keyword">,</span><span class="default">$height</span><span class="keyword">)=</span><span class="default">getimagesize</span><span class="keyword">(</span><span class="default">$src</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// check if ratios match
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$_ratio</span><span class="keyword">=array(</span><span class="default">$width</span><span class="keyword">/</span><span class="default">$height</span><span class="keyword">,</span><span class="default">$w</span><span class="keyword">/</span><span class="default">$h</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">$_ratio</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">] != </span><span class="default">$_ratio</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">]) { </span><span class="comment">// crop image
<br />

<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; // find the right scale to use
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$_scale</span><span class="keyword">=</span><span class="default">min</span><span class="keyword">((float)(</span><span class="default">$width</span><span class="keyword">/</span><span class="default">$w</span><span class="keyword">),(float)(</span><span class="default">$height</span><span class="keyword">/</span><span class="default">$h</span><span class="keyword">));
<br />

<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// coords to crop
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$cropX</span><span class="keyword">=(float)(</span><span class="default">$width</span><span class="keyword">-(</span><span class="default">$_scale</span><span class="keyword">*</span><span class="default">$w</span><span class="keyword">));
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$cropY</span><span class="keyword">=(float)(</span><span class="default">$height</span><span class="keyword">-(</span><span class="default">$_scale</span><span class="keyword">*</span><span class="default">$h</span><span class="keyword">));&nbsp; &nbsp; 
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; 
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// cropped image size
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$cropW</span><span class="keyword">=(float)(</span><span class="default">$width</span><span class="keyword">-</span><span class="default">$cropX</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$cropH</span><span class="keyword">=(float)(</span><span class="default">$height</span><span class="keyword">-</span><span class="default">$cropY</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; 
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$crop</span><span class="keyword">=</span><span class="default">ImageCreateTrueColor</span><span class="keyword">(</span><span class="default">$cropW</span><span class="keyword">,</span><span class="default">$cropH</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// crop the middle part of the image to fit proportions
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">ImageCopy</span><span class="keyword">(
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$crop</span><span class="keyword">,
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$OldImage</span><span class="keyword">,
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">0</span><span class="keyword">,
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">0</span><span class="keyword">,
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; (int)(</span><span class="default">$cropX</span><span class="keyword">/</span><span class="default">2</span><span class="keyword">),
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; (int)(</span><span class="default">$cropY</span><span class="keyword">/</span><span class="default">2</span><span class="keyword">),
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$cropW</span><span class="keyword">,
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$cropH
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; 
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// do the thumbnail
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$NewThumb</span><span class="keyword">=</span><span class="default">ImageCreateTrueColor</span><span class="keyword">(</span><span class="default">$w</span><span class="keyword">,</span><span class="default">$h</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if (isset(</span><span class="default">$crop</span><span class="keyword">)) { </span><span class="comment">// been cropped
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">ImageCopyResampled</span><span class="keyword">(
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$NewThumb</span><span class="keyword">,
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$crop</span><span class="keyword">,
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">0</span><span class="keyword">,
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">0</span><span class="keyword">,
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">0</span><span class="keyword">,
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">0</span><span class="keyword">,
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$w</span><span class="keyword">,
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$h</span><span class="keyword">,
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$cropW</span><span class="keyword">,
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$cropH
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">ImageDestroy</span><span class="keyword">(</span><span class="default">$crop</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; } else { </span><span class="comment">// ratio match, regular resize
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">ImageCopyResampled</span><span class="keyword">(
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$NewThumb</span><span class="keyword">,
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$OldImage</span><span class="keyword">,
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">0</span><span class="keyword">,
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">0</span><span class="keyword">,
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">0</span><span class="keyword">,
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">0</span><span class="keyword">,
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$w</span><span class="keyword">,
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$h</span><span class="keyword">,
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$width</span><span class="keyword">,
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$height
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">_ckdir</span><span class="keyword">(</span><span class="default">$saveas</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">ImageJpeg</span><span class="keyword">(</span><span class="default">$NewThumb</span><span class="keyword">,</span><span class="default">$saveas</span><span class="keyword">,</span><span class="default">$quality</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">ImageDestroy</span><span class="keyword">(</span><span class="default">$NewThumb</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">ImageDestroy</span><span class="keyword">(</span><span class="default">$OldImage</span><span class="keyword">);
<br />
&nbsp;&nbsp;&nbsp; }
<br />
&nbsp;&nbsp;&nbsp; return </span><span class="default">$r</span><span class="keyword">;
<br />
}
<br />

<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="90038""></a>
  <div class="note">
   <strong class="user">satanas147 at gmail dot com</strong>
   <a href="#90038" class="date">02-Apr-2009 05:33</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Another add-on to previous php5 class for thumbnail (with a merge of Matt and Zorro's proposals).
<br />
This is dedicated to generate thumbnail on the fly for a webpage using the subclass thumbnail.
<br />
It saves the generated thumb as myimage_tn, in the same directory.
<br />
I'm quite new with php5, so I think this could be optimized, but it seems to work fine.
<br />

<br />
<span class="default">&lt;?php
<br />
</span><span class="comment">// Imaging
<br />
</span><span class="keyword">class </span><span class="default">imaging
<br />
</span><span class="keyword">{
<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">// Variables
<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">private </span><span class="default">$img_input</span><span class="keyword">;
<br />
&nbsp;&nbsp;&nbsp; private </span><span class="default">$img_output</span><span class="keyword">;
<br />
&nbsp;&nbsp;&nbsp; private </span><span class="default">$img_src</span><span class="keyword">;
<br />
&nbsp;&nbsp;&nbsp; private </span><span class="default">$format</span><span class="keyword">;
<br />
&nbsp;&nbsp;&nbsp; private </span><span class="default">$quality </span><span class="keyword">= </span><span class="default">80</span><span class="keyword">;
<br />
&nbsp;&nbsp;&nbsp; private </span><span class="default">$x_input</span><span class="keyword">;
<br />
&nbsp;&nbsp;&nbsp; private </span><span class="default">$y_input</span><span class="keyword">;
<br />
&nbsp;&nbsp;&nbsp; private </span><span class="default">$x_output</span><span class="keyword">;
<br />
&nbsp;&nbsp;&nbsp; private </span><span class="default">$y_output</span><span class="keyword">;
<br />
&nbsp;&nbsp;&nbsp; private </span><span class="default">$resize</span><span class="keyword">;
<br />

<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">// Set image
<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">public function </span><span class="default">set_img</span><span class="keyword">(</span><span class="default">$img</span><span class="keyword">)
<br />
&nbsp;&nbsp;&nbsp; {
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// Find format
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$ext </span><span class="keyword">= </span><span class="default">strtoupper</span><span class="keyword">(</span><span class="default">pathinfo</span><span class="keyword">(</span><span class="default">$img</span><span class="keyword">, </span><span class="default">PATHINFO_EXTENSION</span><span class="keyword">));
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// JPEG image
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">if(</span><span class="default">is_file</span><span class="keyword">(</span><span class="default">$img</span><span class="keyword">) &amp;&amp; (</span><span class="default">$ext </span><span class="keyword">== </span><span class="string">"JPG" </span><span class="keyword">OR </span><span class="default">$ext </span><span class="keyword">== </span><span class="string">"JPEG"</span><span class="keyword">))
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; {
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">format </span><span class="keyword">= </span><span class="default">$ext</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">img_input </span><span class="keyword">= </span><span class="default">ImageCreateFromJPEG</span><span class="keyword">(</span><span class="default">$img</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">img_src </span><span class="keyword">= </span><span class="default">$img</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// PNG image
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">elseif(</span><span class="default">is_file</span><span class="keyword">(</span><span class="default">$img</span><span class="keyword">) &amp;&amp; </span><span class="default">$ext </span><span class="keyword">== </span><span class="string">"PNG"</span><span class="keyword">)
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; {
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">format </span><span class="keyword">= </span><span class="default">$ext</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">img_input </span><span class="keyword">= </span><span class="default">ImageCreateFromPNG</span><span class="keyword">(</span><span class="default">$img</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">img_src </span><span class="keyword">= </span><span class="default">$img</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// GIF image
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">elseif(</span><span class="default">is_file</span><span class="keyword">(</span><span class="default">$img</span><span class="keyword">) &amp;&amp; </span><span class="default">$ext </span><span class="keyword">== </span><span class="string">"GIF"</span><span class="keyword">)
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; {
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">format </span><span class="keyword">= </span><span class="default">$ext</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">img_input </span><span class="keyword">= </span><span class="default">ImageCreateFromGIF</span><span class="keyword">(</span><span class="default">$img</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">img_src </span><span class="keyword">= </span><span class="default">$img</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// Get dimensions
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">x_input </span><span class="keyword">= </span><span class="default">imagesx</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">img_input</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">y_input </span><span class="keyword">= </span><span class="default">imagesy</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">img_input</span><span class="keyword">);
<br />
&nbsp;&nbsp;&nbsp; }
<br />

<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">// Set maximum image size (pixels)
<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">public function </span><span class="default">set_size</span><span class="keyword">(</span><span class="default">$max_x </span><span class="keyword">= </span><span class="default">100</span><span class="keyword">,</span><span class="default">$max_y </span><span class="keyword">= </span><span class="default">100</span><span class="keyword">)
<br />
&nbsp;&nbsp;&nbsp; {
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// Resize
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">if(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">x_input </span><span class="keyword">&gt; </span><span class="default">$max_x </span><span class="keyword">|| </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">y_input </span><span class="keyword">&gt; </span><span class="default">$max_y</span><span class="keyword">)
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; {
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$a</span><span class="keyword">= </span><span class="default">$max_x </span><span class="keyword">/ </span><span class="default">$max_y</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$b</span><span class="keyword">= </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">x_input </span><span class="keyword">/ </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">y_input</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">$a</span><span class="keyword">&lt;</span><span class="default">$b</span><span class="keyword">)
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; {
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">x_output </span><span class="keyword">= </span><span class="default">$max_x</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">y_output </span><span class="keyword">= (</span><span class="default">$max_x </span><span class="keyword">/ </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">x_input</span><span class="keyword">) * </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">y_input</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; else
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; {
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">y_output </span><span class="keyword">= </span><span class="default">$max_y</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">x_output </span><span class="keyword">= (</span><span class="default">$max_y </span><span class="keyword">/ </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">y_input</span><span class="keyword">) * </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">x_input</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// Ready
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">resize </span><span class="keyword">= </span><span class="default">TRUE</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// Don't resize&nbsp; &nbsp; &nbsp;&nbsp; 
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">else { </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">resize </span><span class="keyword">= </span><span class="default">FALSE</span><span class="keyword">; }
<br />
&nbsp;&nbsp;&nbsp; }
<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">// Set image quality (JPEG only)
<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">public function </span><span class="default">set_quality</span><span class="keyword">(</span><span class="default">$quality</span><span class="keyword">)
<br />
&nbsp;&nbsp;&nbsp; {
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if(</span><span class="default">is_int</span><span class="keyword">(</span><span class="default">$quality</span><span class="keyword">))
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; {
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">quality </span><span class="keyword">= </span><span class="default">$quality</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }
<br />
&nbsp;&nbsp;&nbsp; }
<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">// Save image
<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">public function </span><span class="default">save_img</span><span class="keyword">(</span><span class="default">$path</span><span class="keyword">)
<br />
&nbsp;&nbsp;&nbsp; {
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// Resize
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">if(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">resize</span><span class="keyword">)
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; {
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">img_output </span><span class="keyword">= </span><span class="default">ImageCreateTrueColor</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">x_output</span><span class="keyword">, </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">y_output</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">ImageCopyResampled</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">img_output</span><span class="keyword">, </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">img_input</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">x_output</span><span class="keyword">, </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">y_output</span><span class="keyword">, </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">x_input</span><span class="keyword">, </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">y_input</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// Save JPEG
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">if(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">format </span><span class="keyword">== </span><span class="string">"JPG" </span><span class="keyword">OR </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">format </span><span class="keyword">== </span><span class="string">"JPEG"</span><span class="keyword">)
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; {
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">resize</span><span class="keyword">) { </span><span class="default">imageJPEG</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">img_output</span><span class="keyword">, </span><span class="default">$path</span><span class="keyword">, </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">quality</span><span class="keyword">); }
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; else { </span><span class="default">copy</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">img_src</span><span class="keyword">, </span><span class="default">$path</span><span class="keyword">); }
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// Save PNG
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">elseif(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">format </span><span class="keyword">== </span><span class="string">"PNG"</span><span class="keyword">)
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; {
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">resize</span><span class="keyword">) { </span><span class="default">imagePNG</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">img_output</span><span class="keyword">, </span><span class="default">$path</span><span class="keyword">); }
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; else { </span><span class="default">copy</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">img_src</span><span class="keyword">, </span><span class="default">$path</span><span class="keyword">); }
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// Save GIF
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">elseif(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">format </span><span class="keyword">== </span><span class="string">"GIF"</span><span class="keyword">)
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; {
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">resize</span><span class="keyword">) { </span><span class="default">imageGIF</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">img_output</span><span class="keyword">, </span><span class="default">$path</span><span class="keyword">); }
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; else { </span><span class="default">copy</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">img_src</span><span class="keyword">, </span><span class="default">$path</span><span class="keyword">); }
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }
<br />
&nbsp;&nbsp;&nbsp; }
<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">// Get width
<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">public function </span><span class="default">get_width</span><span class="keyword">()
<br />
&nbsp;&nbsp;&nbsp; {
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">x_input</span><span class="keyword">;
<br />
&nbsp;&nbsp;&nbsp; }
<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">// Get height
<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">public function </span><span class="default">get_height</span><span class="keyword">()
<br />
&nbsp;&nbsp;&nbsp; {
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">y_input</span><span class="keyword">;
<br />
&nbsp;&nbsp;&nbsp; }
<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">// Clear image cache
<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">public function </span><span class="default">clear_cache</span><span class="keyword">()
<br />
&nbsp;&nbsp;&nbsp; {
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; @</span><span class="default">ImageDestroy</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">img_input</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; @</span><span class="default">ImageDestroy</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">img_output</span><span class="keyword">);
<br />
&nbsp;&nbsp;&nbsp; }
<br />
}
<br />
class </span><span class="default">thumbnail </span><span class="keyword">extends </span><span class="default">imaging </span><span class="keyword">{
<br />
&nbsp;&nbsp;&nbsp; private </span><span class="default">$image</span><span class="keyword">;
<br />
&nbsp;&nbsp;&nbsp; private </span><span class="default">$width</span><span class="keyword">;
<br />
&nbsp;&nbsp;&nbsp; private </span><span class="default">$height</span><span class="keyword">;
<br />
&nbsp;&nbsp;&nbsp; 
<br />
&nbsp;&nbsp;&nbsp; function </span><span class="default">__construct</span><span class="keyword">(</span><span class="default">$image</span><span class="keyword">,</span><span class="default">$width</span><span class="keyword">,</span><span class="default">$height</span><span class="keyword">) {
<br />
</span><span class="default">parent</span><span class="keyword">::</span><span class="default">set_img</span><span class="keyword">(</span><span class="default">$image</span><span class="keyword">);
<br />
</span><span class="default">parent</span><span class="keyword">::</span><span class="default">set_quality</span><span class="keyword">(</span><span class="default">80</span><span class="keyword">);
<br />
</span><span class="default">parent</span><span class="keyword">::</span><span class="default">set_size</span><span class="keyword">(</span><span class="default">$width</span><span class="keyword">,</span><span class="default">$height</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">thumbnail</span><span class="keyword">= </span><span class="default">pathinfo</span><span class="keyword">(</span><span class="default">$image</span><span class="keyword">, </span><span class="default">PATHINFO_DIRNAME</span><span class="keyword">).</span><span class="default">pathinfo</span><span class="keyword">(</span><span class="default">$image</span><span class="keyword">, </span><span class="default">PATHINFO_FILENAME</span><span class="keyword">).</span><span class="string">'_tn.'</span><span class="keyword">.</span><span class="default">pathinfo</span><span class="keyword">(</span><span class="default">$image</span><span class="keyword">, </span><span class="default">PATHINFO_EXTENSION</span><span class="keyword">);
<br />
</span><span class="default">parent</span><span class="keyword">::</span><span class="default">save_img</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">thumbnail</span><span class="keyword">);
<br />
</span><span class="default">parent</span><span class="keyword">::</span><span class="default">clear_cache</span><span class="keyword">();
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }
<br />
&nbsp;&nbsp;&nbsp; function </span><span class="default">__toString</span><span class="keyword">() {
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">thumbnail</span><span class="keyword">;
<br />
&nbsp;&nbsp;&nbsp; }
<br />
}
<br />

<br />
********
<br />
* </span><span class="default">DEMO </span><span class="keyword">*
<br />
********
<br />
</span><span class="default">$thumb </span><span class="keyword">= new </span><span class="default">thumbnail</span><span class="keyword">(</span><span class="string">'./image_dir/sub_dir/myimage.jpg'</span><span class="keyword">,</span><span class="default">100</span><span class="keyword">,</span><span class="default">100</span><span class="keyword">);
<br />
echo </span><span class="string">'&lt;img src=\''</span><span class="keyword">.</span><span class="default">$thumb</span><span class="keyword">.</span><span class="string">'\' alt=\'myimage\' title=\'myimage\'/&gt;'</span><span class="keyword">;
<br />

<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="89987""></a>
  <div class="note">
   <strong class="user">zuegs</strong>
   <a href="#89987" class="date">01-Apr-2009 07:52</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Resampling GIFs and retain transparency dosen't work always, as dependent on the resample factor the resulting resampled image has some pattern-noise that prevents "imagegif" to find all the transparent-pixels.<br />
One way to fix this, is to reset all pixels with high alpha to full-transparent:<br />
<span class="default">&lt;?php<br />
</span><span class="comment">// load/create images<br />
</span><span class="default">$img_src</span><span class="keyword">=</span><span class="default">imagecreatefromgif</span><span class="keyword">(</span><span class="default">$g_srcfile</span><span class="keyword">);<br />
</span><span class="default">$img_dst</span><span class="keyword">=</span><span class="default">imagecreatetruecolor</span><span class="keyword">(</span><span class="default">$g_iw</span><span class="keyword">,</span><span class="default">$g_ih</span><span class="keyword">);<br />
</span><span class="default">imagealphablending</span><span class="keyword">(</span><span class="default">$img_dst</span><span class="keyword">, </span><span class="default">false</span><span class="keyword">);<br />
<br />
</span><span class="comment">// get and reallocate transparency-color<br />
</span><span class="default">$transindex </span><span class="keyword">= </span><span class="default">imagecolortransparent</span><span class="keyword">(</span><span class="default">$img_src</span><span class="keyword">);<br />
if(</span><span class="default">$transindex </span><span class="keyword">&gt;= </span><span class="default">0</span><span class="keyword">) {<br />
&nbsp; </span><span class="default">$transcol </span><span class="keyword">= </span><span class="default">imagecolorsforindex</span><span class="keyword">(</span><span class="default">$img_src</span><span class="keyword">, </span><span class="default">$transindex</span><span class="keyword">);<br />
&nbsp; </span><span class="default">$transindex </span><span class="keyword">= </span><span class="default">imagecolorallocatealpha</span><span class="keyword">(</span><span class="default">$img_dst</span><span class="keyword">, </span><span class="default">$transcol</span><span class="keyword">[</span><span class="string">'red'</span><span class="keyword">], </span><span class="default">$transcol</span><span class="keyword">[</span><span class="string">'green'</span><span class="keyword">], </span><span class="default">$transcol</span><span class="keyword">[</span><span class="string">'blue'</span><span class="keyword">], </span><span class="default">127</span><span class="keyword">);<br />
&nbsp; </span><span class="default">imagefill</span><span class="keyword">(</span><span class="default">$img_dst</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">$transindex</span><span class="keyword">);<br />
}<br />
<br />
</span><span class="comment">// resample<br />
</span><span class="default">imagecopyresampled</span><span class="keyword">(</span><span class="default">$img_dst</span><span class="keyword">, </span><span class="default">$img_src</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">$g_iw</span><span class="keyword">, </span><span class="default">$g_ih</span><span class="keyword">, </span><span class="default">$g_is</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">], </span><span class="default">$g_is</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">]);<br />
<br />
</span><span class="comment">// restore transparency<br />
</span><span class="keyword">if(</span><span class="default">$transindex </span><span class="keyword">&gt;= </span><span class="default">0</span><span class="keyword">) {<br />
&nbsp; </span><span class="default">imagecolortransparent</span><span class="keyword">(</span><span class="default">$img_dst</span><span class="keyword">, </span><span class="default">$transindex</span><span class="keyword">);<br />
&nbsp; for(</span><span class="default">$y</span><span class="keyword">=</span><span class="default">0</span><span class="keyword">; </span><span class="default">$y</span><span class="keyword">&lt;</span><span class="default">$g_ih</span><span class="keyword">; ++</span><span class="default">$y</span><span class="keyword">)<br />
&nbsp;&nbsp;&nbsp; for(</span><span class="default">$x</span><span class="keyword">=</span><span class="default">0</span><span class="keyword">; </span><span class="default">$x</span><span class="keyword">&lt;</span><span class="default">$g_iw</span><span class="keyword">; ++</span><span class="default">$x</span><span class="keyword">)<br />
&nbsp;&nbsp; &nbsp;&nbsp; if(((</span><span class="default">imagecolorat</span><span class="keyword">(</span><span class="default">$img_dst</span><span class="keyword">, </span><span class="default">$x</span><span class="keyword">, </span><span class="default">$y</span><span class="keyword">)&gt;&gt;</span><span class="default">24</span><span class="keyword">) &amp; </span><span class="default">0x7F</span><span class="keyword">) &gt;= </span><span class="default">100</span><span class="keyword">) </span><span class="default">imagesetpixel</span><span class="keyword">(</span><span class="default">$img_dst</span><span class="keyword">, </span><span class="default">$x</span><span class="keyword">, </span><span class="default">$y</span><span class="keyword">, </span><span class="default">$transindex</span><span class="keyword">);<br />
<br />
</span><span class="comment">// save GIF<br />
</span><span class="default">imagetruecolortopalette</span><span class="keyword">(</span><span class="default">$img_dst</span><span class="keyword">, </span><span class="default">true</span><span class="keyword">, </span><span class="default">255</span><span class="keyword">);<br />
</span><span class="default">imagesavealpha</span><span class="keyword">(</span><span class="default">$img_dst</span><span class="keyword">, </span><span class="default">false</span><span class="keyword">);<br />
</span><span class="default">imagegif</span><span class="keyword">(</span><span class="default">$img_dst</span><span class="keyword">, </span><span class="default">$g_dstfile</span><span class="keyword">); <br />
</span><span class="default">imagedestroy</span><span class="keyword">(</span><span class="default">$img_dst</span><span class="keyword">); <br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="88263""></a>
  <div class="note">
   <strong class="user">Warren</strong>
   <a href="#88263" class="date">18-Jan-2009 08:15</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
This is a function I wrote for making thumbnails -&nbsp; it will accept a source *image resource* and destination *path*, plus the max dimension and whether the thumbnail should be square.
<br />

<br />
I chose to accept a resource as the source to make it a bit more efficient to create multiple sizes. For example:
<br />

<br />
<span class="default">&lt;?php
<br />
$src_im</span><span class="keyword">=@</span><span class="default">imagecreatefromjpeg</span><span class="keyword">(</span><span class="default">$pathtofile</span><span class="keyword">);
<br />
</span><span class="default">$large </span><span class="keyword">= </span><span class="default">resize</span><span class="keyword">(</span><span class="default">$src_im</span><span class="keyword">,</span><span class="default">$destination_large</span><span class="keyword">,</span><span class="default">1024</span><span class="keyword">);
<br />
@</span><span class="default">imagedestroy</span><span class="keyword">(</span><span class="default">$src_im</span><span class="keyword">);
<br />
</span><span class="default">$medium </span><span class="keyword">= </span><span class="default">resize</span><span class="keyword">(</span><span class="default">$large</span><span class="keyword">,</span><span class="default">$destination_medium</span><span class="keyword">,</span><span class="default">500</span><span class="keyword">);
<br />
@</span><span class="default">imagedestroy</span><span class="keyword">(</span><span class="default">$large</span><span class="keyword">);
<br />
</span><span class="default">$small </span><span class="keyword">= </span><span class="default">resize</span><span class="keyword">(</span><span class="default">$medium</span><span class="keyword">,</span><span class="default">$destination_small</span><span class="keyword">,</span><span class="default">125</span><span class="keyword">);
<br />
@</span><span class="default">imagedestroy</span><span class="keyword">(</span><span class="default">$medium</span><span class="keyword">);
<br />
</span><span class="default">$square </span><span class="keyword">= </span><span class="default">resize</span><span class="keyword">(</span><span class="default">$small</span><span class="keyword">,</span><span class="default">$destination_square</span><span class="keyword">,</span><span class="default">75</span><span class="keyword">,</span><span class="default">TRUE</span><span class="keyword">);
<br />
@</span><span class="default">imagedestroy</span><span class="keyword">(</span><span class="default">$small</span><span class="keyword">);
<br />
@</span><span class="default">imagedestroy</span><span class="keyword">(</span><span class="default">$square</span><span class="keyword">);
<br />

<br />
function </span><span class="default">resize</span><span class="keyword">(</span><span class="default">$src_im</span><span class="keyword">, </span><span class="default">$dpath</span><span class="keyword">, </span><span class="default">$maxd</span><span class="keyword">, </span><span class="default">$square</span><span class="keyword">=</span><span class="default">false</span><span class="keyword">) {
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$src_width </span><span class="keyword">= </span><span class="default">imagesx</span><span class="keyword">(</span><span class="default">$src_im</span><span class="keyword">);
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$src_height </span><span class="keyword">= </span><span class="default">imagesy</span><span class="keyword">(</span><span class="default">$src_im</span><span class="keyword">);
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$src_w</span><span class="keyword">=</span><span class="default">$src_width</span><span class="keyword">;
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$src_h</span><span class="keyword">=</span><span class="default">$src_height</span><span class="keyword">;
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$src_x</span><span class="keyword">=</span><span class="default">0</span><span class="keyword">;
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$src_y</span><span class="keyword">=</span><span class="default">0</span><span class="keyword">;
<br />
&nbsp;&nbsp;&nbsp; if(</span><span class="default">$square</span><span class="keyword">){
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$dst_w </span><span class="keyword">= </span><span class="default">$maxd</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$dst_h </span><span class="keyword">= </span><span class="default">$maxd</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if(</span><span class="default">$src_width</span><span class="keyword">&gt;</span><span class="default">$src_height</span><span class="keyword">){
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$src_x </span><span class="keyword">= </span><span class="default">ceil</span><span class="keyword">((</span><span class="default">$src_width</span><span class="keyword">-</span><span class="default">$src_height</span><span class="keyword">)/</span><span class="default">2</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$src_w</span><span class="keyword">=</span><span class="default">$src_height</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$src_h</span><span class="keyword">=</span><span class="default">$src_height</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }else{
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$src_y </span><span class="keyword">= </span><span class="default">ceil</span><span class="keyword">((</span><span class="default">$src_height</span><span class="keyword">-</span><span class="default">$src_width</span><span class="keyword">)/</span><span class="default">2</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$src_w</span><span class="keyword">=</span><span class="default">$src_width</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$src_h</span><span class="keyword">=</span><span class="default">$src_width</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }
<br />
&nbsp;&nbsp;&nbsp; }else{
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if(</span><span class="default">$src_width</span><span class="keyword">&gt;</span><span class="default">$src_height</span><span class="keyword">){
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$dst_w</span><span class="keyword">=</span><span class="default">$maxd</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$dst_h</span><span class="keyword">=</span><span class="default">floor</span><span class="keyword">(</span><span class="default">$src_height</span><span class="keyword">*(</span><span class="default">$dst_w</span><span class="keyword">/</span><span class="default">$src_width</span><span class="keyword">));
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }else{
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$dst_h</span><span class="keyword">=</span><span class="default">$maxd</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$dst_w</span><span class="keyword">=</span><span class="default">floor</span><span class="keyword">(</span><span class="default">$src_width</span><span class="keyword">*(</span><span class="default">$dst_h</span><span class="keyword">/</span><span class="default">$src_height</span><span class="keyword">));
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }
<br />
&nbsp;&nbsp;&nbsp; }
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$dst_im</span><span class="keyword">=@</span><span class="default">imagecreatetruecolor</span><span class="keyword">(</span><span class="default">$dst_w</span><span class="keyword">,</span><span class="default">$dst_h</span><span class="keyword">);
<br />
&nbsp;&nbsp;&nbsp; @</span><span class="default">imagecopyresampled</span><span class="keyword">(</span><span class="default">$dst_im</span><span class="keyword">, </span><span class="default">$src_im</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">$src_x</span><span class="keyword">, </span><span class="default">$src_y</span><span class="keyword">, </span><span class="default">$dst_w</span><span class="keyword">, </span><span class="default">$dst_h</span><span class="keyword">, </span><span class="default">$src_w</span><span class="keyword">, </span><span class="default">$src_h</span><span class="keyword">);
<br />
&nbsp;&nbsp;&nbsp; @</span><span class="default">imagejpeg</span><span class="keyword">(</span><span class="default">$dst_im</span><span class="keyword">,</span><span class="default">$dpath</span><span class="keyword">);
<br />
&nbsp;&nbsp;&nbsp; return </span><span class="default">$dst_im</span><span class="keyword">;
<br />
}
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="87881""></a>
  <div class="note">
   <strong class="user">MBorgPL at gmail dot com</strong>
   <a href="#87881" class="date">28-Dec-2008 07:53</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Another addition to zorroswordsman at gmail dot com's resize class. <br />
<br />
The function takes $_FILES['sent_image'] as 1st parameter. The 2nd is complete destination path. <br />
<br />
It only moves images. <br />
<br />
It returns destination path if succeeded, and false if any error occurred. <br />
<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">public function </span><span class="default">move_image</span><span class="keyword">(</span><span class="default">$tmp_img</span><span class="keyword">, </span><span class="default">$dest_img</span><span class="keyword">)<br />
{<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">//verifies if the uploaded file is an image<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">if (</span><span class="default">strpos</span><span class="keyword">(</span><span class="default">$tmp_img</span><span class="keyword">[</span><span class="string">'type'</span><span class="keyword">], </span><span class="string">'image'</span><span class="keyword">) !== </span><span class="default">false</span><span class="keyword">) <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">//moves the uploaded file into the destination place<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">if (</span><span class="default">move_uploaded_file</span><span class="keyword">(</span><span class="default">$tmp_img</span><span class="keyword">[</span><span class="string">'tmp_name'</span><span class="keyword">], </span><span class="default">$dest_img</span><span class="keyword">)) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">$dest_img</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; }&nbsp; &nbsp; &nbsp; &nbsp; <br />
&nbsp;&nbsp;&nbsp; return </span><span class="default">false</span><span class="keyword">;<br />
}<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="87866""></a>
  <div class="note">
   <strong class="user">MBorg_PL</strong>
   <a href="#87866" class="date">28-Dec-2008 12:39</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Another tiny ammendment to zorroswordsman at gmail dot com's resize class AND matt at rees-jenkins dot co dot uk addition. The class may resize to different width and height not only same ones:<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="comment">// Set maximum image size (pixels)<br />
</span><span class="keyword">public function </span><span class="default">set_size</span><span class="keyword">(</span><span class="default">$max_x </span><span class="keyword">= </span><span class="default">100</span><span class="keyword">,</span><span class="default">$max_y </span><span class="keyword">= </span><span class="default">100</span><span class="keyword">)<br />
{<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">// Resize<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">if(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">x_input </span><span class="keyword">&gt; </span><span class="default">$max_x </span><span class="keyword">|| </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">y_input </span><span class="keyword">&gt; </span><span class="default">$max_y</span><span class="keyword">)<br />
&nbsp;&nbsp;&nbsp; {<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$a</span><span class="keyword">= </span><span class="default">$max_x </span><span class="keyword">/ </span><span class="default">$max_y</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$b</span><span class="keyword">= </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">x_input </span><span class="keyword">/ </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">y_input</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">$a</span><span class="keyword">&lt;</span><span class="default">$b</span><span class="keyword">)<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; {<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">x_output </span><span class="keyword">= </span><span class="default">$max_x</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">y_output </span><span class="keyword">= (</span><span class="default">$max_x </span><span class="keyword">/ </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">x_input</span><span class="keyword">) * </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">y_input</span><span class="keyword">;<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; else<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; {<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">y_output </span><span class="keyword">= </span><span class="default">$max_y</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">x_output </span><span class="keyword">= (</span><span class="default">$max_y </span><span class="keyword">/ </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">y_input</span><span class="keyword">) * </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">x_input</span><span class="keyword">;<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// Ready<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">resize </span><span class="keyword">= </span><span class="default">TRUE</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">// Don't resize&nbsp; &nbsp; &nbsp; &nbsp; <br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">else { </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">resize </span><span class="keyword">= </span><span class="default">FALSE</span><span class="keyword">; }<br />
&nbsp;&nbsp;&nbsp; <br />
}<br />
</span><span class="default">?&gt;<br />
</span><br />
And the use of the class is now:<br />
<br />
<span class="default">&lt;?php<br />
<br />
</span><span class="comment">##### DEMO #####<br />
<br />
// Image<br />
</span><span class="default">$src </span><span class="keyword">= </span><span class="string">"myimage.jpg"</span><span class="keyword">;<br />
<br />
</span><span class="comment">// Begin<br />
</span><span class="default">$img </span><span class="keyword">= new </span><span class="default">imaging</span><span class="keyword">;<br />
</span><span class="default">$img</span><span class="keyword">-&gt;</span><span class="default">set_img</span><span class="keyword">(</span><span class="default">$src</span><span class="keyword">);<br />
</span><span class="default">$img</span><span class="keyword">-&gt;</span><span class="default">set_quality</span><span class="keyword">(</span><span class="default">80</span><span class="keyword">);<br />
<br />
</span><span class="comment">// Small thumbnail<br />
</span><span class="default">$img</span><span class="keyword">-&gt;</span><span class="default">set_size</span><span class="keyword">(</span><span class="default">250</span><span class="keyword">,</span><span class="default">150</span><span class="keyword">);<br />
</span><span class="default">$img</span><span class="keyword">-&gt;</span><span class="default">save_img</span><span class="keyword">(</span><span class="string">"small_250x150_" </span><span class="keyword">. </span><span class="default">$src</span><span class="keyword">);<br />
<br />
</span><span class="comment">// Baby thumbnail<br />
</span><span class="default">$img</span><span class="keyword">-&gt;</span><span class="default">set_size</span><span class="keyword">(</span><span class="default">50</span><span class="keyword">,</span><span class="default">250</span><span class="keyword">);<br />
</span><span class="default">$img</span><span class="keyword">-&gt;</span><span class="default">save_img</span><span class="keyword">(</span><span class="string">"baby_50x250_" </span><span class="keyword">. </span><span class="default">$src</span><span class="keyword">);<br />
<br />
</span><span class="comment">// Finalize<br />
</span><span class="default">$img</span><span class="keyword">-&gt;</span><span class="default">clear_cache</span><span class="keyword">();<br />
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="86344""></a>
  <div class="note">
   <strong class="user">matt at rees-jenkins dot co dot uk</strong>
   <a href="#86344" class="date">14-Oct-2008 12:32</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
A tiny ammendment to zorroswordsman at gmail dot com's resize class. It was only resizing if both the width AND height where greater than the desired size. This should fix it:<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="comment">// Set maximum image size (pixels)<br />
</span><span class="keyword">function </span><span class="default">set_size</span><span class="keyword">(</span><span class="default">$size </span><span class="keyword">= </span><span class="default">100</span><span class="keyword">)<br />
{<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">// Resize<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">if(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">x_input </span><span class="keyword">&gt; </span><span class="default">$size </span><span class="keyword">|| </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">y_input </span><span class="keyword">&gt; </span><span class="default">$size</span><span class="keyword">)<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// Wide<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">if(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">x_input </span><span class="keyword">&gt;= </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">y_input</span><span class="keyword">)<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">x_output </span><span class="keyword">= </span><span class="default">$size</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">y_output </span><span class="keyword">= (</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">x_output </span><span class="keyword">/ </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">x_input</span><span class="keyword">) * </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">y_input</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// Tall<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">else<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">y_output </span><span class="keyword">= </span><span class="default">$size</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">x_output </span><span class="keyword">= (</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">y_output </span><span class="keyword">/ </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">y_input</span><span class="keyword">) * </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">x_input</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// Ready<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">resize </span><span class="keyword">= </span><span class="default">TRUE</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">// Don't resize<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">else { </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">resize </span><span class="keyword">= </span><span class="default">FALSE</span><span class="keyword">; }<br />
}<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="85929""></a>
  <div class="note">
   <strong class="user">zorroswordsman at gmail dot com</strong>
   <a href="#85929" class="date">25-Sep-2008 04:46</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I've created a PHP5 image resize class, using ImageCopyResampled, that someone might find useful, with support for JPEG, PNG, and GIF formats. It retains the original image's aspect ratio when resizing, and doesn't resize or resample if the original width and height is smaller then the desired resize.<br />
<br />
<span class="default">&lt;?php<br />
<br />
</span><span class="comment">// Imaging<br />
</span><span class="keyword">class </span><span class="default">imaging<br />
</span><span class="keyword">{<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">// Variables<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">private </span><span class="default">$img_input</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; private </span><span class="default">$img_output</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; private </span><span class="default">$img_src</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; private </span><span class="default">$format</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; private </span><span class="default">$quality </span><span class="keyword">= </span><span class="default">80</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; private </span><span class="default">$x_input</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; private </span><span class="default">$y_input</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; private </span><span class="default">$x_output</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; private </span><span class="default">$y_output</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; private </span><span class="default">$resize</span><span class="keyword">;<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">// Set image<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">public function </span><span class="default">set_img</span><span class="keyword">(</span><span class="default">$img</span><span class="keyword">)<br />
&nbsp;&nbsp;&nbsp; {<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// Find format<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$ext </span><span class="keyword">= </span><span class="default">strtoupper</span><span class="keyword">(</span><span class="default">pathinfo</span><span class="keyword">(</span><span class="default">$img</span><span class="keyword">, </span><span class="default">PATHINFO_EXTENSION</span><span class="keyword">));<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// JPEG image<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">if(</span><span class="default">is_file</span><span class="keyword">(</span><span class="default">$img</span><span class="keyword">) &amp;&amp; (</span><span class="default">$ext </span><span class="keyword">== </span><span class="string">"JPG" </span><span class="keyword">OR </span><span class="default">$ext </span><span class="keyword">== </span><span class="string">"JPEG"</span><span class="keyword">))<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; {<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">format </span><span class="keyword">= </span><span class="default">$ext</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">img_input </span><span class="keyword">= </span><span class="default">ImageCreateFromJPEG</span><span class="keyword">(</span><span class="default">$img</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">img_src </span><span class="keyword">= </span><span class="default">$img</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// PNG image<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">elseif(</span><span class="default">is_file</span><span class="keyword">(</span><span class="default">$img</span><span class="keyword">) &amp;&amp; </span><span class="default">$ext </span><span class="keyword">== </span><span class="string">"PNG"</span><span class="keyword">)<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; {<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">format </span><span class="keyword">= </span><span class="default">$ext</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">img_input </span><span class="keyword">= </span><span class="default">ImageCreateFromPNG</span><span class="keyword">(</span><span class="default">$img</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">img_src </span><span class="keyword">= </span><span class="default">$img</span><span class="keyword">;<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// GIF image<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">elseif(</span><span class="default">is_file</span><span class="keyword">(</span><span class="default">$img</span><span class="keyword">) &amp;&amp; </span><span class="default">$ext </span><span class="keyword">== </span><span class="string">"GIF"</span><span class="keyword">)<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; {<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">format </span><span class="keyword">= </span><span class="default">$ext</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">img_input </span><span class="keyword">= </span><span class="default">ImageCreateFromGIF</span><span class="keyword">(</span><span class="default">$img</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">img_src </span><span class="keyword">= </span><span class="default">$img</span><span class="keyword">;<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// Get dimensions<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">x_input </span><span class="keyword">= </span><span class="default">imagesx</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">img_input</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">y_input </span><span class="keyword">= </span><span class="default">imagesy</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">img_input</span><span class="keyword">);<br />
<br />
&nbsp;&nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">// Set maximum image size (pixels)<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">public function </span><span class="default">set_size</span><span class="keyword">(</span><span class="default">$size </span><span class="keyword">= </span><span class="default">100</span><span class="keyword">)<br />
&nbsp;&nbsp;&nbsp; {<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// Resize<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">if(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">x_input </span><span class="keyword">&gt; </span><span class="default">$size </span><span class="keyword">&amp;&amp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">y_input </span><span class="keyword">&gt; </span><span class="default">$size</span><span class="keyword">)<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; {<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// Wide<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">if(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">x_input </span><span class="keyword">&gt;= </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">y_input</span><span class="keyword">)<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; {<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">x_output </span><span class="keyword">= </span><span class="default">$size</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">y_output </span><span class="keyword">= (</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">x_output </span><span class="keyword">/ </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">x_input</span><span class="keyword">) * </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">y_input</span><span class="keyword">;<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// Tall<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">else<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; {<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">y_output </span><span class="keyword">= </span><span class="default">$size</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">x_output </span><span class="keyword">= (</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">y_output </span><span class="keyword">/ </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">y_input</span><span class="keyword">) * </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">x_input</span><span class="keyword">;<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// Ready<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">resize </span><span class="keyword">= </span><span class="default">TRUE</span><span class="keyword">;<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// Don't resize<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">else { </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">resize </span><span class="keyword">= </span><span class="default">FALSE</span><span class="keyword">; }<br />
<br />
&nbsp;&nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">// Set image quality (JPEG only)<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">public function </span><span class="default">set_quality</span><span class="keyword">(</span><span class="default">$quality</span><span class="keyword">)<br />
&nbsp;&nbsp;&nbsp; {<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if(</span><span class="default">is_int</span><span class="keyword">(</span><span class="default">$quality</span><span class="keyword">))<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; {<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">quality </span><span class="keyword">= </span><span class="default">$quality</span><span class="keyword">;<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">// Save image<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">public function </span><span class="default">save_img</span><span class="keyword">(</span><span class="default">$path</span><span class="keyword">)<br />
&nbsp;&nbsp;&nbsp; {<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// Resize<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">if(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">resize</span><span class="keyword">)<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; {<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">img_output </span><span class="keyword">= </span><span class="default">ImageCreateTrueColor</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">x_output</span><span class="keyword">, </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">y_output</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">ImageCopyResampled</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">img_output</span><span class="keyword">, </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">img_input</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">x_output</span><span class="keyword">, </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">y_output</span><span class="keyword">, </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">x_input</span><span class="keyword">, </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">y_input</span><span class="keyword">);<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// Save JPEG<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">if(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">format </span><span class="keyword">== </span><span class="string">"JPG" </span><span class="keyword">OR </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">format </span><span class="keyword">== </span><span class="string">"JPEG"</span><span class="keyword">)<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; {<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">resize</span><span class="keyword">) { </span><span class="default">imageJPEG</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">img_output</span><span class="keyword">, </span><span class="default">$path</span><span class="keyword">, </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">quality</span><span class="keyword">); }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; else { </span><span class="default">copy</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">img_src</span><span class="keyword">, </span><span class="default">$path</span><span class="keyword">); }<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// Save PNG<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">elseif(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">format </span><span class="keyword">== </span><span class="string">"PNG"</span><span class="keyword">)<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; {<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">resize</span><span class="keyword">) { </span><span class="default">imagePNG</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">img_output</span><span class="keyword">, </span><span class="default">$path</span><span class="keyword">); }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; else { </span><span class="default">copy</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">img_src</span><span class="keyword">, </span><span class="default">$path</span><span class="keyword">); }<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// Save GIF<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">elseif(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">format </span><span class="keyword">== </span><span class="string">"GIF"</span><span class="keyword">)<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; {<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">resize</span><span class="keyword">) { </span><span class="default">imageGIF</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">img_output</span><span class="keyword">, </span><span class="default">$path</span><span class="keyword">); }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; else { </span><span class="default">copy</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">img_src</span><span class="keyword">, </span><span class="default">$path</span><span class="keyword">); }<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">// Get width<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">public function </span><span class="default">get_width</span><span class="keyword">()<br />
&nbsp;&nbsp;&nbsp; {<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">x_input</span><span class="keyword">;<br />
<br />
&nbsp;&nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">// Get height<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">public function </span><span class="default">get_height</span><span class="keyword">()<br />
&nbsp;&nbsp;&nbsp; {<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">y_input</span><span class="keyword">;<br />
<br />
&nbsp;&nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">// Clear image cache<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">public function </span><span class="default">clear_cache</span><span class="keyword">()<br />
&nbsp;&nbsp;&nbsp; {<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; @</span><span class="default">ImageDestroy</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">img_input</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; @</span><span class="default">ImageDestroy</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">img_output</span><span class="keyword">);<br />
<br />
&nbsp;&nbsp;&nbsp; }<br />
<br />
}<br />
<br />
</span><span class="comment">##### DEMO #####<br />
<br />
// Image<br />
</span><span class="default">$src </span><span class="keyword">= </span><span class="string">"myimage.jpg"</span><span class="keyword">;<br />
<br />
</span><span class="comment">// Begin<br />
</span><span class="default">$img </span><span class="keyword">= new </span><span class="default">imaging</span><span class="keyword">;<br />
</span><span class="default">$img</span><span class="keyword">-&gt;</span><span class="default">set_img</span><span class="keyword">(</span><span class="default">$src</span><span class="keyword">);<br />
</span><span class="default">$img</span><span class="keyword">-&gt;</span><span class="default">set_quality</span><span class="keyword">(</span><span class="default">80</span><span class="keyword">);<br />
<br />
</span><span class="comment">// Small thumbnail<br />
</span><span class="default">$img</span><span class="keyword">-&gt;</span><span class="default">set_size</span><span class="keyword">(</span><span class="default">200</span><span class="keyword">);<br />
</span><span class="default">$img</span><span class="keyword">-&gt;</span><span class="default">save_img</span><span class="keyword">(</span><span class="string">"small_" </span><span class="keyword">. </span><span class="default">$src</span><span class="keyword">);<br />
<br />
</span><span class="comment">// Baby thumbnail<br />
</span><span class="default">$img</span><span class="keyword">-&gt;</span><span class="default">set_size</span><span class="keyword">(</span><span class="default">50</span><span class="keyword">);<br />
</span><span class="default">$img</span><span class="keyword">-&gt;</span><span class="default">save_img</span><span class="keyword">(</span><span class="string">"baby_" </span><span class="keyword">. </span><span class="default">$src</span><span class="keyword">);<br />
<br />
</span><span class="comment">// Finalize<br />
</span><span class="default">$img</span><span class="keyword">-&gt;</span><span class="default">clear_cache</span><span class="keyword">();<br />
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="85038""></a>
  <div class="note">
   <strong class="user">crash</strong>
   <a href="#85038" class="date">12-Aug-2008 03:49</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
The suggestion of converting a gif to a png to retain transparency was useful. However the steps used to maintain the transparency work for a gif as well, so the conversion step is not necessary. Just do everything the same, and save as a gif anyway. i.e.<br />
<br />
<span class="default">&lt;?php<br />
$g_iw is </span><span class="keyword">new </span><span class="default">image width<br />
$g_ih is </span><span class="keyword">new </span><span class="default">image height<br />
<br />
$img_src</span><span class="keyword">=</span><span class="default">imagecreatefromgif</span><span class="keyword">(</span><span class="default">$g_srcfile</span><span class="keyword">);<br />
</span><span class="default">$img_dst</span><span class="keyword">=</span><span class="default">imagecreatetruecolor</span><span class="keyword">(</span><span class="default">$g_iw</span><span class="keyword">,</span><span class="default">$g_ih</span><span class="keyword">);<br />
<br />
</span><span class="comment">//preserve alpha<br />
</span><span class="default">imagecolortransparent</span><span class="keyword">(</span><span class="default">$img_dst</span><span class="keyword">, </span><span class="default">imagecolorallocate</span><span class="keyword">(</span><span class="default">$img_dst</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">));<br />
</span><span class="default">imagealphablending</span><span class="keyword">(</span><span class="default">$img_dst</span><span class="keyword">, </span><span class="default">false</span><span class="keyword">);<br />
</span><span class="default">imagesavealpha</span><span class="keyword">(</span><span class="default">$img_dst</span><span class="keyword">, </span><span class="default">true</span><span class="keyword">);<br />
</span><span class="default">imagecopyresampled</span><span class="keyword">(</span><span class="default">$img_dst</span><span class="keyword">, </span><span class="default">$img_src</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">$g_iw</span><span class="keyword">, </span><span class="default">$g_ih</span><span class="keyword">, </span><span class="default">$g_is</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">], </span><span class="default">$g_is</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">]);<br />
<br />
</span><span class="default">imagegif</span><span class="keyword">(</span><span class="default">$img_dst</span><span class="keyword">, </span><span class="default">$g_dstfile</span><span class="keyword">); <br />
</span><span class="default">imagedestroy</span><span class="keyword">(</span><span class="default">$img_dst</span><span class="keyword">); <br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="84516""></a>
  <div class="note">
   <strong class="user">swizec at swizec dot com</strong>
   <a href="#84516" class="date">17-Jul-2008 11:20</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Wrote a function for sanitising user uploaded images. It saves the native image in size roughly 800x600 so it still fits on most screens when opened, makes a desired size thumbnail and turns all images into high quality jpegs for smaller bandwidth use.<br />
<br />
Thumbnails are made in a similar way a designer would make them in photoshop, first resize the most troublesome dimension to desired size, then crop the rest out so the image retains proportions and most of it ends up in the thumbnail.<br />
<br />
<span class="default">&lt;?php <br />
<br />
</span><span class="comment">// $image is $_FILES[ &lt;image name&gt; ]<br />
// $imageId is the id used in a database or wherever for this image<br />
// $thumbWidth and $thumbHeight are desired dimensions for the thumbnail<br />
</span><span class="keyword">function </span><span class="default">processImage</span><span class="keyword">( </span><span class="default">$image</span><span class="keyword">, </span><span class="default">$imageId</span><span class="keyword">, </span><span class="default">$thumbWidth</span><span class="keyword">, </span><span class="default">$thumbHeight </span><span class="keyword">)<br />
{<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$type </span><span class="keyword">= </span><span class="default">$image</span><span class="keyword">[ </span><span class="string">'type' </span><span class="keyword">];<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$galleryPath </span><span class="keyword">= </span><span class="string">'images/collection/'</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; if ( </span><span class="default">strpos</span><span class="keyword">( </span><span class="default">$type</span><span class="keyword">, </span><span class="string">'image/' </span><span class="keyword">) === </span><span class="default">FALSE </span><span class="keyword">)<br />
&nbsp;&nbsp;&nbsp; { </span><span class="comment">// not an image<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">return </span><span class="default">FALSE</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$type </span><span class="keyword">= </span><span class="default">str_replace</span><span class="keyword">( </span><span class="string">'image/'</span><span class="keyword">, </span><span class="string">''</span><span class="keyword">, </span><span class="default">$type </span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$createFunc </span><span class="keyword">= </span><span class="string">'imagecreatefrom' </span><span class="keyword">. </span><span class="default">$type</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$im </span><span class="keyword">= </span><span class="default">$createFunc</span><span class="keyword">( </span><span class="default">$image</span><span class="keyword">[ </span><span class="string">'tmp_name' </span><span class="keyword">] );<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$size </span><span class="keyword">= </span><span class="default">getimagesize</span><span class="keyword">( </span><span class="default">$image</span><span class="keyword">[ </span><span class="string">'tmp_name' </span><span class="keyword">] );<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$w </span><span class="keyword">= </span><span class="default">$size</span><span class="keyword">[ </span><span class="default">0 </span><span class="keyword">];<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$h </span><span class="keyword">= </span><span class="default">$size</span><span class="keyword">[ </span><span class="default">1 </span><span class="keyword">];<br />
&nbsp;&nbsp;&nbsp; if ( </span><span class="default">$w </span><span class="keyword">&gt; </span><span class="default">800 </span><span class="keyword">|| </span><span class="default">$h </span><span class="keyword">&gt; </span><span class="default">600 </span><span class="keyword">)<br />
&nbsp;&nbsp;&nbsp; { </span><span class="comment">// we make sure the image isn't too huge<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">if ( </span><span class="default">$w </span><span class="keyword">&gt; </span><span class="default">800 </span><span class="keyword">)<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$nw </span><span class="keyword">= </span><span class="default">800</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$nh </span><span class="keyword">= </span><span class="default">ceil</span><span class="keyword">( </span><span class="default">$nw</span><span class="keyword">*(</span><span class="default">$h</span><span class="keyword">/</span><span class="default">$w</span><span class="keyword">) );<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }elseif( </span><span class="default">$h </span><span class="keyword">&gt; </span><span class="default">600 </span><span class="keyword">)<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$nh </span><span class="keyword">= </span><span class="default">600</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$nw </span><span class="keyword">= </span><span class="default">ceil</span><span class="keyword">( </span><span class="default">$nh</span><span class="keyword">*(</span><span class="default">$w</span><span class="keyword">/</span><span class="default">$h</span><span class="keyword">) );<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$im2 </span><span class="keyword">= </span><span class="default">imagecreatetruecolor</span><span class="keyword">( </span><span class="default">$nw</span><span class="keyword">, </span><span class="default">$nh </span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">imagecopyresampled</span><span class="keyword">( </span><span class="default">$im2</span><span class="keyword">, </span><span class="default">$im</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">$nw</span><span class="keyword">, </span><span class="default">$nh</span><span class="keyword">, </span><span class="default">$w</span><span class="keyword">, </span><span class="default">$h </span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">imagedestroy</span><span class="keyword">( </span><span class="default">$im </span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$im </span><span class="keyword">= </span><span class="default">$im2</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$w </span><span class="keyword">= </span><span class="default">$nw</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$h </span><span class="keyword">= </span><span class="default">$nh</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">// create thumbnail<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$tw </span><span class="keyword">= </span><span class="default">$thumbWidth</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$th </span><span class="keyword">= </span><span class="default">$thumbHeight</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$imT </span><span class="keyword">= </span><span class="default">imagecreatetruecolor</span><span class="keyword">( </span><span class="default">$tw</span><span class="keyword">, </span><span class="default">$th </span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; if ( </span><span class="default">$tw</span><span class="keyword">/</span><span class="default">$th </span><span class="keyword">&gt; </span><span class="default">$th</span><span class="keyword">/</span><span class="default">$tw </span><span class="keyword">)<br />
&nbsp;&nbsp;&nbsp; { </span><span class="comment">// wider<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$tmph </span><span class="keyword">= </span><span class="default">$h</span><span class="keyword">*(</span><span class="default">$tw</span><span class="keyword">/</span><span class="default">$w</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$temp </span><span class="keyword">= </span><span class="default">imagecreatetruecolor</span><span class="keyword">( </span><span class="default">$tw</span><span class="keyword">, </span><span class="default">$tmph </span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">imagecopyresampled</span><span class="keyword">( </span><span class="default">$temp</span><span class="keyword">, </span><span class="default">$im</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">$tw</span><span class="keyword">, </span><span class="default">$tmph</span><span class="keyword">, </span><span class="default">$w</span><span class="keyword">, </span><span class="default">$h </span><span class="keyword">); </span><span class="comment">// resize to width<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">imagecopyresampled</span><span class="keyword">( </span><span class="default">$imT</span><span class="keyword">, </span><span class="default">$temp</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">$tmph</span><span class="keyword">/</span><span class="default">2</span><span class="keyword">-</span><span class="default">$th</span><span class="keyword">/</span><span class="default">2</span><span class="keyword">, </span><span class="default">$tw</span><span class="keyword">, </span><span class="default">$th</span><span class="keyword">, </span><span class="default">$tw</span><span class="keyword">, </span><span class="default">$th </span><span class="keyword">); </span><span class="comment">// crop<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">imagedestroy</span><span class="keyword">( </span><span class="default">$temp </span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; }else<br />
&nbsp;&nbsp;&nbsp; { </span><span class="comment">// taller<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$tmpw </span><span class="keyword">= </span><span class="default">$w</span><span class="keyword">*(</span><span class="default">$th</span><span class="keyword">/</span><span class="default">$h </span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$imT </span><span class="keyword">= </span><span class="default">imagecreatetruecolor</span><span class="keyword">( </span><span class="default">$tmpw</span><span class="keyword">, </span><span class="default">$th </span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">imagecopyresampled</span><span class="keyword">( </span><span class="default">$imT</span><span class="keyword">, </span><span class="default">$im</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">$tmpw</span><span class="keyword">, </span><span class="default">$h</span><span class="keyword">, </span><span class="default">$w</span><span class="keyword">, </span><span class="default">$h </span><span class="keyword">); </span><span class="comment">// resize to height<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">imagecopyresampled</span><span class="keyword">( </span><span class="default">$imT</span><span class="keyword">, </span><span class="default">$temp</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">$tmpw</span><span class="keyword">/</span><span class="default">2</span><span class="keyword">-</span><span class="default">$tw</span><span class="keyword">/</span><span class="default">2</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">$tw</span><span class="keyword">, </span><span class="default">$th</span><span class="keyword">, </span><span class="default">$tw</span><span class="keyword">, </span><span class="default">$th </span><span class="keyword">); </span><span class="comment">// crop<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">imagedestroy</span><span class="keyword">( </span><span class="default">$temp </span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">// save the image<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">imagejpeg</span><span class="keyword">( </span><span class="default">$im</span><span class="keyword">, </span><span class="default">$galleryPath </span><span class="keyword">. </span><span class="default">$imgid </span><span class="keyword">. </span><span class="string">'.jpg'</span><span class="keyword">, </span><span class="default">100 </span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">imagejpeg</span><span class="keyword">( </span><span class="default">$imT</span><span class="keyword">, </span><span class="default">$galleryPath </span><span class="keyword">. </span><span class="default">$imgid </span><span class="keyword">. </span><span class="string">'_thumb.jpg'</span><span class="keyword">, </span><span class="default">100 </span><span class="keyword">);<br />
}<br />
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="83292""></a>
  <div class="note">
   <strong class="user">mattura gmail com</strong>
   <a href="#83292" class="date">19-May-2008 07:53</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Here's a little function I wrote to resize images to a maximum dimension - based on what facebook does in the galleries. You put in a source, destination and a maximum dimension in pixels (eg 300), and for example if the image is long and thin, the longest edge will be 300px, yet the image retains proportions. A square image will become 300x300, a 6x4 (landscape) will become 300x200, a 4x6 (portrait) - 200x300 etc.<br />
It works on jpg images, but other formats can easily be added.<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">function </span><span class="default">createThumb</span><span class="keyword">(</span><span class="default">$spath</span><span class="keyword">, </span><span class="default">$dpath</span><span class="keyword">, </span><span class="default">$maxd</span><span class="keyword">) {<br />
&nbsp;</span><span class="default">$src</span><span class="keyword">=@</span><span class="default">imagecreatefromjpeg</span><span class="keyword">(</span><span class="default">$spath</span><span class="keyword">);<br />
&nbsp;if (!</span><span class="default">$src</span><span class="keyword">) {return </span><span class="default">false</span><span class="keyword">;} else {<br />
&nbsp; </span><span class="default">$srcw</span><span class="keyword">=</span><span class="default">imagesx</span><span class="keyword">(</span><span class="default">$src</span><span class="keyword">);<br />
&nbsp; </span><span class="default">$srch</span><span class="keyword">=</span><span class="default">imagesy</span><span class="keyword">(</span><span class="default">$src</span><span class="keyword">);<br />
&nbsp; if (</span><span class="default">$srcw</span><span class="keyword">&lt;</span><span class="default">$srch</span><span class="keyword">) {</span><span class="default">$height</span><span class="keyword">=</span><span class="default">$maxd</span><span class="keyword">;</span><span class="default">$width</span><span class="keyword">=</span><span class="default">floor</span><span class="keyword">(</span><span class="default">$srcw</span><span class="keyword">*</span><span class="default">$height</span><span class="keyword">/</span><span class="default">$srch</span><span class="keyword">);}<br />
&nbsp; else {</span><span class="default">$width</span><span class="keyword">=</span><span class="default">$maxd</span><span class="keyword">;</span><span class="default">$height</span><span class="keyword">=</span><span class="default">floor</span><span class="keyword">(</span><span class="default">$srch</span><span class="keyword">*</span><span class="default">$width</span><span class="keyword">/</span><span class="default">$srcw</span><span class="keyword">);}<br />
&nbsp; if (</span><span class="default">$width</span><span class="keyword">&gt;</span><span class="default">$srcw </span><span class="keyword">&amp;&amp; </span><span class="default">$height</span><span class="keyword">&gt;</span><span class="default">$srch</span><span class="keyword">) {</span><span class="default">$width</span><span class="keyword">=</span><span class="default">$srcw</span><span class="keyword">;</span><span class="default">$height</span><span class="keyword">=</span><span class="default">$srch</span><span class="keyword">;}&nbsp; </span><span class="comment">//if image is actually smaller than you want, leave small (remove this line to resize anyway)<br />
&nbsp; </span><span class="default">$thumb</span><span class="keyword">=</span><span class="default">imagecreatetruecolor</span><span class="keyword">(</span><span class="default">$width</span><span class="keyword">, </span><span class="default">$height</span><span class="keyword">);<br />
&nbsp; if (</span><span class="default">$height</span><span class="keyword">&lt;</span><span class="default">100</span><span class="keyword">) {</span><span class="default">imagecopyresized</span><span class="keyword">(</span><span class="default">$thumb</span><span class="keyword">, </span><span class="default">$src</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">$width</span><span class="keyword">, </span><span class="default">$height</span><span class="keyword">, </span><span class="default">imagesx</span><span class="keyword">(</span><span class="default">$src</span><span class="keyword">), </span><span class="default">imagesy</span><span class="keyword">(</span><span class="default">$src</span><span class="keyword">));}<br />
&nbsp; else {</span><span class="default">imagecopyresampled</span><span class="keyword">(</span><span class="default">$thumb</span><span class="keyword">, </span><span class="default">$src</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">$width</span><span class="keyword">, </span><span class="default">$height</span><span class="keyword">, </span><span class="default">imagesx</span><span class="keyword">(</span><span class="default">$src</span><span class="keyword">), </span><span class="default">imagesy</span><span class="keyword">(</span><span class="default">$src</span><span class="keyword">));}<br />
&nbsp; </span><span class="default">imagejpeg</span><span class="keyword">(</span><span class="default">$thumb</span><span class="keyword">, </span><span class="default">$dpath</span><span class="keyword">);<br />
&nbsp; return </span><span class="default">true</span><span class="keyword">;<br />
&nbsp;}<br />
}<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="81898""></a>
  <div class="note">
   <strong class="user">bobbyboyojones at hotmail dot com</strong>
   <a href="#81898" class="date">18-Mar-2008 08:41</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I hated that enlarging an image resulted in giant pixels rather than a smoother look, so I wrote this function.&nbsp; It takes longer, but gives a much nicer look.<br />
<br />
<span class="default">&lt;?php<br />
<br />
</span><span class="keyword">function </span><span class="default">imagecopyresampledSMOOTH</span><span class="keyword">(&amp;</span><span class="default">$dst_img</span><span class="keyword">, &amp;</span><span class="default">$src_img</span><span class="keyword">, </span><span class="default">$dst_x</span><span class="keyword">, </span><span class="default">$dst_y</span><span class="keyword">, </span><span class="default">$src_x</span><span class="keyword">, </span><span class="default">$src_y</span><span class="keyword">, </span><span class="default">$dst_w</span><span class="keyword">, </span><span class="default">$dst_h</span><span class="keyword">, </span><span class="default">$src_w</span><span class="keyword">, </span><span class="default">$src_h</span><span class="keyword">, </span><span class="default">$mult</span><span class="keyword">=</span><span class="default">1.25</span><span class="keyword">){<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">// don't use a $mult that's too close to an int or this function won't make much of a difference<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$tgt_w </span><span class="keyword">= </span><span class="default">round</span><span class="keyword">(</span><span class="default">$src_w </span><span class="keyword">* </span><span class="default">$mult</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$tgt_h </span><span class="keyword">= </span><span class="default">round</span><span class="keyword">(</span><span class="default">$src_h </span><span class="keyword">* </span><span class="default">$mult</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">// using $mult &lt;= 1 will make the current step w/h smaller (or the same), don't allow this, always resize by at least 1 pixel larger<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">if(</span><span class="default">$tgt_w </span><span class="keyword">&lt;= </span><span class="default">$src_w</span><span class="keyword">){ </span><span class="default">$tgt_w </span><span class="keyword">+= </span><span class="default">1</span><span class="keyword">; }<br />
&nbsp;&nbsp;&nbsp; if(</span><span class="default">$tgt_h </span><span class="keyword">&lt;= </span><span class="default">$src_h</span><span class="keyword">){ </span><span class="default">$tgt_h </span><span class="keyword">+= </span><span class="default">1</span><span class="keyword">; }<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">// if the current step w/h is larger than the final height, adjust it back to the final size<br />
&nbsp;&nbsp;&nbsp; // this check also makes it so that if we are doing a resize to smaller image, it happens in one step (since that's already smooth)<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">if(</span><span class="default">$tgt_w </span><span class="keyword">&gt; </span><span class="default">$dst_w</span><span class="keyword">){ </span><span class="default">$tgt_w </span><span class="keyword">= </span><span class="default">$dst_w</span><span class="keyword">; }<br />
&nbsp;&nbsp;&nbsp; if(</span><span class="default">$tgt_h </span><span class="keyword">&gt; </span><span class="default">$dst_h</span><span class="keyword">){ </span><span class="default">$tgt_h </span><span class="keyword">= </span><span class="default">$dst_h</span><span class="keyword">; }<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$tmpImg </span><span class="keyword">= </span><span class="default">imagecreatetruecolor</span><span class="keyword">(</span><span class="default">$tgt_w</span><span class="keyword">, </span><span class="default">$tgt_h</span><span class="keyword">);<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">imagecopyresampled</span><span class="keyword">(</span><span class="default">$tmpImg</span><span class="keyword">, </span><span class="default">$src_img</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">$src_x</span><span class="keyword">, </span><span class="default">$src_y</span><span class="keyword">, </span><span class="default">$tgt_w</span><span class="keyword">, </span><span class="default">$tgt_h</span><span class="keyword">, </span><span class="default">$src_w</span><span class="keyword">, </span><span class="default">$src_h</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">imagecopy</span><span class="keyword">(</span><span class="default">$dst_img</span><span class="keyword">, </span><span class="default">$tmpImg</span><span class="keyword">, </span><span class="default">$dst_x</span><span class="keyword">, </span><span class="default">$dst_y</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">$tgt_w</span><span class="keyword">, </span><span class="default">$tgt_h</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">imagedestroy</span><span class="keyword">(</span><span class="default">$tmpImg</span><span class="keyword">);<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">// as long as the final w/h has not been reached, reep on resizing<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">if(</span><span class="default">$tgt_w </span><span class="keyword">&lt; </span><span class="default">$dst_w </span><span class="keyword">OR </span><span class="default">$tgt_h </span><span class="keyword">&lt; </span><span class="default">$dst_h</span><span class="keyword">){<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">imagecopyresampledSMOOTH</span><span class="keyword">(</span><span class="default">$dst_img</span><span class="keyword">, </span><span class="default">$dst_img</span><span class="keyword">, </span><span class="default">$dst_x</span><span class="keyword">, </span><span class="default">$dst_y</span><span class="keyword">, </span><span class="default">$dst_x</span><span class="keyword">, </span><span class="default">$dst_y</span><span class="keyword">, </span><span class="default">$dst_w</span><span class="keyword">, </span><span class="default">$dst_h</span><span class="keyword">, </span><span class="default">$tgt_w</span><span class="keyword">, </span><span class="default">$tgt_h</span><span class="keyword">, </span><span class="default">$mult</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; }<br />
}<br />
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="81856""></a>
  <div class="note">
   <strong class="user">arnar at netvistun dot is</strong>
   <a href="#81856" class="date">16-Mar-2008 07:58</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
A small thumb script. Lets you specify max height and width. The thumb will always be of a rectangular shape while the image itself retains it's proportions. Very clean.<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="comment">// The file<br />
</span><span class="default">$filename </span><span class="keyword">= </span><span class="string">'a.jpg'</span><span class="keyword">;<br />
<br />
</span><span class="comment">// Set a maximum height and width<br />
</span><span class="default">$width </span><span class="keyword">= </span><span class="default">80</span><span class="keyword">;<br />
</span><span class="default">$height </span><span class="keyword">= </span><span class="default">80</span><span class="keyword">;<br />
<br />
</span><span class="default">$thumbsize </span><span class="keyword">= </span><span class="default">80</span><span class="keyword">;<br />
<br />
</span><span class="comment">// Content type<br />
</span><span class="default">header</span><span class="keyword">(</span><span class="string">'Content-type: image/jpeg'</span><span class="keyword">);<br />
<br />
</span><span class="comment">// Get new dimensions<br />
</span><span class="keyword">list(</span><span class="default">$width_orig</span><span class="keyword">, </span><span class="default">$height_orig</span><span class="keyword">) = </span><span class="default">getimagesize</span><span class="keyword">(</span><span class="default">$filename</span><span class="keyword">);<br />
<br />
</span><span class="default">$ratio_orig </span><span class="keyword">= </span><span class="default">$width_orig</span><span class="keyword">/</span><span class="default">$height_orig</span><span class="keyword">;<br />
<br />
if (</span><span class="default">$width</span><span class="keyword">/</span><span class="default">$height </span><span class="keyword">&gt; </span><span class="default">$ratio_orig</span><span class="keyword">) {<br />
&nbsp;&nbsp; </span><span class="default">$width </span><span class="keyword">= </span><span class="default">$height</span><span class="keyword">*</span><span class="default">$ratio_orig</span><span class="keyword">;<br />
} else {<br />
&nbsp;&nbsp; </span><span class="default">$height </span><span class="keyword">= </span><span class="default">$width</span><span class="keyword">/</span><span class="default">$ratio_orig</span><span class="keyword">;<br />
}<br />
<br />
</span><span class="comment">// Resample<br />
</span><span class="default">$image_p </span><span class="keyword">= </span><span class="default">imagecreatetruecolor</span><span class="keyword">(</span><span class="default">$thumbsize</span><span class="keyword">, </span><span class="default">$thumbsize</span><span class="keyword">);<br />
</span><span class="default">$image </span><span class="keyword">= </span><span class="default">imagecreatefromjpeg</span><span class="keyword">(</span><span class="default">$filename</span><span class="keyword">);<br />
</span><span class="default">imagecopyresampled</span><span class="keyword">(</span><span class="default">$image_p</span><span class="keyword">, </span><span class="default">$image</span><span class="keyword">, -(</span><span class="default">$width</span><span class="keyword">/</span><span class="default">2</span><span class="keyword">) + (</span><span class="default">$thumbsize</span><span class="keyword">/</span><span class="default">2</span><span class="keyword">), -(</span><span class="default">$height</span><span class="keyword">/</span><span class="default">2</span><span class="keyword">) + (</span><span class="default">$thumbsize</span><span class="keyword">/</span><span class="default">2</span><span class="keyword">), </span><span class="default">0</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">$width</span><span class="keyword">, </span><span class="default">$height</span><span class="keyword">, </span><span class="default">$width_orig</span><span class="keyword">, </span><span class="default">$height_orig</span><span class="keyword">);<br />
<br />
</span><span class="comment">// Output<br />
</span><span class="default">imagejpeg</span><span class="keyword">(</span><span class="default">$image_p</span><span class="keyword">, </span><span class="default">null</span><span class="keyword">, </span><span class="default">100</span><span class="keyword">);<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="81633""></a>
  <div class="note">
   <strong class="user">rayg at daylongraphics dot com</strong>
   <a href="#81633" class="date">07-Mar-2008 11:45</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Here's a simple function to resample one JPEG imagefile to another while keeping aspect ratio of the source within the destination's dimensions. You can also tune the allowable distortion if you end up making too many thumbnails with thin blank areas around them. Should work when enlarging images too. Function returns true if it worked, false if not.<br />
<br />
function resample_picfile($src, $dst, $w, $h)<br />
{<br />
&nbsp;&nbsp;&nbsp; // If distortion stretching is within the range below,<br />
&nbsp;&nbsp;&nbsp; // then let image be distorted.<br />
&nbsp;&nbsp;&nbsp; $lowend = 0.8;<br />
&nbsp;&nbsp;&nbsp; $highend = 1.25;<br />
<br />
&nbsp;&nbsp;&nbsp; $src_img = imagecreatefromjpeg($src);<br />
&nbsp;&nbsp;&nbsp; if($src_img)<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $dst_img = ImageCreateTrueColor($w, $h);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; /* if you don't want aspect-preserved images <br />
to have a black bkgnd, fill $dst_img with the color of your choice here. <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; */<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if($dst_img)<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $src_w = imageSX($src_img);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $src_h = imageSY($src_img);<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $scaleX = (float)$w / $src_w;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $scaleY = (float)$h / $src_h;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $scale = min($scaleX, $scaleY);<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $dstW = $w;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $dstH = $h;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $dstX = $dstY = 0;<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $scaleR = $scaleX / $scaleY;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if($scaleR &lt; $lowend || $scaleR &gt; $highend)<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $dstW = (int)($scale * $src_w + 0.5);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $dstH = (int)($scale * $src_h + 0.5);<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; // Keep pic centered in frame.<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $dstX = (int)(0.5 * ($w - $dstW));<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $dstY = (int)(0.5 * ($h - $dstH));<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; imagecopyresampled(<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $dst_img, $src_img, $dstX, $dstY, 0, 0, <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $dstW, $dstH, $src_w, $src_h); <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; imagejpeg($dst_img, $dst); <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; imagedestroy($dst_img);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; imagedestroy($src_img);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return file_exists($dst);<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; return false;<br />
}</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="81518""></a>
  <div class="note">
   <strong class="user">RandomFeatureRequest</strong>
   <a href="#81518" class="date">02-Mar-2008 04:51</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If anyone felt like implementing Bicubic Sharper and/or Bicubic Smoother, that would seriously rock.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="81273""></a>
  <div class="note">
   <strong class="user">wm at violet dot bg</strong>
   <a href="#81273" class="date">20-Feb-2008 10:16</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
This is a fixed version of ImageCopyResampledBicubic posted by liviu.malaescu<br />
The original version wasn't respecting src_x &amp; src_y args<br />
<br />
<span class="default">&lt;?php<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">function </span><span class="default">ImageCopyResampledBicubic</span><span class="keyword">(&amp;</span><span class="default">$dst_image</span><span class="keyword">, &amp;</span><span class="default">$src_image</span><span class="keyword">, </span><span class="default">$dst_x</span><span class="keyword">, </span><span class="default">$dst_y</span><span class="keyword">, </span><span class="default">$src_x</span><span class="keyword">, </span><span class="default">$src_y</span><span class="keyword">, </span><span class="default">$dst_w</span><span class="keyword">, </span><span class="default">$dst_h</span><span class="keyword">, </span><span class="default">$src_w</span><span class="keyword">, </span><span class="default">$src_h</span><span class="keyword">)&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// we should first cut the piece we are interested in from the source<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$src_img </span><span class="keyword">= </span><span class="default">ImageCreateTrueColor</span><span class="keyword">(</span><span class="default">$src_w</span><span class="keyword">, </span><span class="default">$src_h</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">imagecopy</span><span class="keyword">(</span><span class="default">$src_img</span><span class="keyword">, </span><span class="default">$src_image</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">$src_x</span><span class="keyword">, </span><span class="default">$src_y</span><span class="keyword">, </span><span class="default">$src_w</span><span class="keyword">, </span><span class="default">$src_h</span><span class="keyword">);<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// this one is used as temporary image<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$dst_img </span><span class="keyword">= </span><span class="default">ImageCreateTrueColor</span><span class="keyword">(</span><span class="default">$dst_w</span><span class="keyword">, </span><span class="default">$dst_h</span><span class="keyword">);<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">ImagePaletteCopy</span><span class="keyword">(</span><span class="default">$dst_img</span><span class="keyword">, </span><span class="default">$src_img</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$rX </span><span class="keyword">= </span><span class="default">$src_w </span><span class="keyword">/ </span><span class="default">$dst_w</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$rY </span><span class="keyword">= </span><span class="default">$src_h </span><span class="keyword">/ </span><span class="default">$dst_h</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$w </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; for (</span><span class="default">$y </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">; </span><span class="default">$y </span><span class="keyword">&lt; </span><span class="default">$dst_h</span><span class="keyword">; </span><span class="default">$y</span><span class="keyword">++)&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$ow </span><span class="keyword">= </span><span class="default">$w</span><span class="keyword">; </span><span class="default">$w </span><span class="keyword">= </span><span class="default">round</span><span class="keyword">((</span><span class="default">$y </span><span class="keyword">+ </span><span class="default">1</span><span class="keyword">) * </span><span class="default">$rY</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$t </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; for (</span><span class="default">$x </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">; </span><span class="default">$x </span><span class="keyword">&lt; </span><span class="default">$dst_w</span><span class="keyword">; </span><span class="default">$x</span><span class="keyword">++)&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$r </span><span class="keyword">= </span><span class="default">$g </span><span class="keyword">= </span><span class="default">$b </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">; </span><span class="default">$a </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$ot </span><span class="keyword">= </span><span class="default">$t</span><span class="keyword">; </span><span class="default">$t </span><span class="keyword">= </span><span class="default">round</span><span class="keyword">((</span><span class="default">$x </span><span class="keyword">+ </span><span class="default">1</span><span class="keyword">) * </span><span class="default">$rX</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; for (</span><span class="default">$u </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">; </span><span class="default">$u </span><span class="keyword">&lt; (</span><span class="default">$w </span><span class="keyword">- </span><span class="default">$ow</span><span class="keyword">); </span><span class="default">$u</span><span class="keyword">++)&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; for (</span><span class="default">$p </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">; </span><span class="default">$p </span><span class="keyword">&lt; (</span><span class="default">$t </span><span class="keyword">- </span><span class="default">$ot</span><span class="keyword">); </span><span class="default">$p</span><span class="keyword">++)&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$c </span><span class="keyword">= </span><span class="default">ImageColorsForIndex</span><span class="keyword">(</span><span class="default">$src_img</span><span class="keyword">, </span><span class="default">ImageColorAt</span><span class="keyword">(</span><span class="default">$src_img</span><span class="keyword">, </span><span class="default">$ot </span><span class="keyword">+ </span><span class="default">$p</span><span class="keyword">, </span><span class="default">$ow </span><span class="keyword">+ </span><span class="default">$u</span><span class="keyword">));<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$r </span><span class="keyword">+= </span><span class="default">$c</span><span class="keyword">[</span><span class="string">'red'</span><span class="keyword">];<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$g </span><span class="keyword">+= </span><span class="default">$c</span><span class="keyword">[</span><span class="string">'green'</span><span class="keyword">];<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$b </span><span class="keyword">+= </span><span class="default">$c</span><span class="keyword">[</span><span class="string">'blue'</span><span class="keyword">];<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$a</span><span class="keyword">++;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">ImageSetPixel</span><span class="keyword">(</span><span class="default">$dst_img</span><span class="keyword">, </span><span class="default">$x</span><span class="keyword">, </span><span class="default">$y</span><span class="keyword">, </span><span class="default">ImageColorClosest</span><span class="keyword">(</span><span class="default">$dst_img</span><span class="keyword">, </span><span class="default">$r </span><span class="keyword">/ </span><span class="default">$a</span><span class="keyword">, </span><span class="default">$g </span><span class="keyword">/ </span><span class="default">$a</span><span class="keyword">, </span><span class="default">$b </span><span class="keyword">/ </span><span class="default">$a</span><span class="keyword">));<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// apply the temp image over the returned image and use the destination x,y coordinates<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">imagecopy</span><span class="keyword">(</span><span class="default">$dst_image</span><span class="keyword">, </span><span class="default">$dst_img</span><span class="keyword">, </span><span class="default">$dst_x</span><span class="keyword">, </span><span class="default">$dst_y</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">$dst_w</span><span class="keyword">, </span><span class="default">$dst_h</span><span class="keyword">);<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// we should return true since ImageCopyResampled/ImageCopyResized do it<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">return </span><span class="default">true</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="80417""></a>
  <div class="note">
   <strong class="user">Michael Shepanski</strong>
   <a href="#80417" class="date">15-Jan-2008 07:09</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Here is a function I thought I would share that will resample and copy an image with rounded corners.<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="comment">/** ------------------------------------------------------------<br />
&nbsp;* Copy and resample an image with rounded corners.<br />
&nbsp;* ----------------------------------------------------------- */<br />
</span><span class="keyword">function </span><span class="default">imageRoundedCopyResampled</span><span class="keyword">(&amp;</span><span class="default">$dstimg</span><span class="keyword">, &amp;</span><span class="default">$srcimg</span><span class="keyword">, </span><span class="default">$dstx</span><span class="keyword">, </span><span class="default">$dsty</span><span class="keyword">, </span><span class="default">$srcx</span><span class="keyword">,<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$srcy</span><span class="keyword">, </span><span class="default">$dstw</span><span class="keyword">, </span><span class="default">$dsth</span><span class="keyword">, </span><span class="default">$srcw</span><span class="keyword">, </span><span class="default">$srch</span><span class="keyword">, </span><span class="default">$radius</span><span class="keyword">) {<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment"># Resize the Source Image<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$srcResized </span><span class="keyword">= </span><span class="default">imagecreatetruecolor</span><span class="keyword">(</span><span class="default">$dstw</span><span class="keyword">, </span><span class="default">$dsth</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">imagecopyresampled</span><span class="keyword">(</span><span class="default">$srcResized</span><span class="keyword">, </span><span class="default">$srcimg</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">$srcx</span><span class="keyword">, </span><span class="default">$srcy</span><span class="keyword">,<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$dstw</span><span class="keyword">, </span><span class="default">$dsth</span><span class="keyword">, </span><span class="default">$srcw</span><span class="keyword">, </span><span class="default">$srch</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment"># Copy the Body without corners<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">imagecopy</span><span class="keyword">(</span><span class="default">$dstimg</span><span class="keyword">, </span><span class="default">$srcResized</span><span class="keyword">, </span><span class="default">$dstx</span><span class="keyword">+</span><span class="default">$radius</span><span class="keyword">, </span><span class="default">$dsty</span><span class="keyword">,<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$radius</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">$dstw</span><span class="keyword">-(</span><span class="default">$radius</span><span class="keyword">*</span><span class="default">2</span><span class="keyword">), </span><span class="default">$dsth</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">imagecopy</span><span class="keyword">(</span><span class="default">$dstimg</span><span class="keyword">, </span><span class="default">$srcResized</span><span class="keyword">, </span><span class="default">$dstx</span><span class="keyword">, </span><span class="default">$dsty</span><span class="keyword">+</span><span class="default">$radius</span><span class="keyword">,<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">0</span><span class="keyword">, </span><span class="default">$radius</span><span class="keyword">, </span><span class="default">$dstw</span><span class="keyword">, </span><span class="default">$dsth</span><span class="keyword">-(</span><span class="default">$radius</span><span class="keyword">*</span><span class="default">2</span><span class="keyword">));<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment"># Create a list of iterations; array(array(X1, X2, CenterX, CenterY), ...)<br />
&nbsp;&nbsp;&nbsp; # Iterations in order are: Top-Left, Top-Right, Bottom-Left, Bottom-Right<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$iterations </span><span class="keyword">= array(<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; array(</span><span class="default">0</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">$radius</span><span class="keyword">, </span><span class="default">$radius</span><span class="keyword">),<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; array(</span><span class="default">$dstw</span><span class="keyword">-</span><span class="default">$radius</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">$dstw</span><span class="keyword">-</span><span class="default">$radius</span><span class="keyword">, </span><span class="default">$radius</span><span class="keyword">),<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; array(</span><span class="default">0</span><span class="keyword">, </span><span class="default">$dsth</span><span class="keyword">-</span><span class="default">$radius</span><span class="keyword">, </span><span class="default">$radius</span><span class="keyword">, </span><span class="default">$dsth</span><span class="keyword">-</span><span class="default">$radius</span><span class="keyword">),<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; array(</span><span class="default">$dstw</span><span class="keyword">-</span><span class="default">$radius</span><span class="keyword">, </span><span class="default">$dsth</span><span class="keyword">-</span><span class="default">$radius</span><span class="keyword">, </span><span class="default">$dstw</span><span class="keyword">-</span><span class="default">$radius</span><span class="keyword">, </span><span class="default">$dsth</span><span class="keyword">-</span><span class="default">$radius</span><span class="keyword">)<br />
&nbsp;&nbsp;&nbsp; );<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment"># Loop through each corner 'iteration'<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">foreach(</span><span class="default">$iterations </span><span class="keyword">as </span><span class="default">$iteration</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; list(</span><span class="default">$x1</span><span class="keyword">,</span><span class="default">$y1</span><span class="keyword">,</span><span class="default">$cx</span><span class="keyword">,</span><span class="default">$cy</span><span class="keyword">) = </span><span class="default">$iteration</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; for (</span><span class="default">$y</span><span class="keyword">=</span><span class="default">$y1</span><span class="keyword">; </span><span class="default">$y</span><span class="keyword">&lt;=</span><span class="default">$y1</span><span class="keyword">+</span><span class="default">$radius</span><span class="keyword">; </span><span class="default">$y</span><span class="keyword">++) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; for (</span><span class="default">$x</span><span class="keyword">=</span><span class="default">$x1</span><span class="keyword">; </span><span class="default">$x</span><span class="keyword">&lt;=</span><span class="default">$x1</span><span class="keyword">+</span><span class="default">$radius</span><span class="keyword">; </span><span class="default">$x</span><span class="keyword">++) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment"># If length (X,Y)-&gt;(CX,CY) is less then radius draw the point<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$length </span><span class="keyword">= </span><span class="default">sqrt</span><span class="keyword">(</span><span class="default">pow</span><span class="keyword">((</span><span class="default">$cx </span><span class="keyword">- </span><span class="default">$x</span><span class="keyword">), </span><span class="default">2</span><span class="keyword">) + </span><span class="default">pow</span><span class="keyword">((</span><span class="default">$cy </span><span class="keyword">- </span><span class="default">$y</span><span class="keyword">), </span><span class="default">2</span><span class="keyword">));<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">$length </span><span class="keyword">&lt; </span><span class="default">$radius</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">imagecopy</span><span class="keyword">(</span><span class="default">$dstimg</span><span class="keyword">, </span><span class="default">$srcResized</span><span class="keyword">, </span><span class="default">$x</span><span class="keyword">+</span><span class="default">$dstx</span><span class="keyword">, </span><span class="default">$y</span><span class="keyword">+</span><span class="default">$dsty</span><span class="keyword">,<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$x</span><span class="keyword">, </span><span class="default">$y</span><span class="keyword">, </span><span class="default">1</span><span class="keyword">, </span><span class="default">1</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; }<br />
}<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="79297""></a>
  <div class="note">
   <strong class="user">matt1walsh DESPAMMER gmail dot com</strong>
   <a href="#79297" class="date">20-Nov-2007 04:15</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
None of the stuff I've seen for resizing transparent GIFs works consistently and yields a good image. The hack I thought of is silly, but it works okay -- convert GIF to PNG. This worked for me.<br />
<br />
$g_iw is new image width<br />
$g_ih is new image height<br />
<br />
$img_src=imagecreatefromgif($g_srcfile);<br />
$img_dst=imagecreatetruecolor($g_iw,$g_ih);<br />
<br />
//preserve alpha<br />
imagecolortransparent($img_dst, imagecolorallocate($img_dst, 0, 0, 0));<br />
imagealphablending($img_dst, false);<br />
imagesavealpha($img_dst, true);<br />
imagecopyresampled($img_dst, $img_src, 0, 0, 0, 0, $g_iw, $g_ih, $g_is[0], $g_is[1]);<br />
<br />
imagepng($img_dst, $g_dstfile); <br />
imagedestroy($img_dst);</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="79119""></a>
  <div class="note">
   <strong class="user">Dave McCourt</strong>
   <a href="#79119" class="date">12-Nov-2007 02:32</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
This function is taken from lots of web sources so thanks to all for posting. It creates square or landscape thumbnails from .jpgs&nbsp; from either portait or landscape original images. I decide in advance which way I want the thumbs to display for consistency. I usually sharpen the images as well post-upload, to save on server resources. I can post this code if anyone wants it. I hope this helps someone...<br />
<br />
&nbsp;&nbsp;&nbsp; # create thumbnails from jpgs<br />
&nbsp;&nbsp;&nbsp; # usage:<br />
&nbsp;&nbsp;&nbsp; # create_jpgthumb(uploaded file, final file (with path), thumb height, thumb width, jpg quality, scale thumb (true) or fixed size (false); <br />
&nbsp;&nbsp;&nbsp; function create_jpgthumb($original, $thumbnail, $max_width, $max_height, $quality, $scale = true) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; list ($src_width, $src_height, $type, $w) = getimagesize($original);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if (!$srcImage = @imagecreatefromjpeg($original)) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return false;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; # image resizes to natural height and width<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if ($scale == true) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if ($src_width &gt; $src_height ) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $thumb_width = $max_width;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $thumb_height = floor($src_height * ($max_width / $src_width));<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; } else if ($src_width &lt; $src_height ) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $thumb_height = $max_height;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $thumb_width = floor($src_width * ($max_height / $src_height));<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; } else {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $thumb_width = $max_height;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $thumb_height = $max_height;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if (!@$destImage = imagecreatetruecolor($thumb_width, $thumb_height)) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return false;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if (!@imagecopyresampled($destImage, $srcImage, 0, 0, 0, 0, $thumb_width, $thumb_height, $src_width, $src_height)) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return false;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; # image is fixed to supplied width and height and cropped<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; } else if ($scale == false) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $ratio = $max_width / $max_height;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; # thumbnail is landscape<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if ($ratio &gt; 1) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; # uploaded pic is landscape<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if ($src_width &gt; $src_height) {<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $thumb_width = $max_width;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $thumb_height = ceil($max_width * ($src_height / $src_width));<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if ($thumb_height &gt; $max_width) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $thumb_height = $max_width;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $thumb_width = ceil($max_width * ($src_width / $src_height));<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; # uploaded pic is portrait<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; } else {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $thumb_height = $max_width;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $thumb_width = ceil($max_width * ($src_height / $src_width));<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if ($thumb_width &gt; $max_width) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $thumb_width = $max_width;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $thumb_height = ceil($max_width * ($src_height / $src_width));<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $off_h = ($src_height - $src_width) / 2;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if (!@$destImage = imagecreatetruecolor($max_width, $max_height)) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return false;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if (!@imagecopyresampled($destImage, $srcImage, 0, 0, 0, $off_h, $thumb_width, $thumb_height, $src_width, $src_height)) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return false;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; # thumbnail is square<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; } else {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if ($src_width &gt; $src_height) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $off_w = ($src_width - $src_height) / 2;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $off_h = 0;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $src_width = $src_height;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; } else if ($src_height &gt; $src_width) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $off_w = 0;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $off_h = ($src_height - $src_width) / 2;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $src_height = $src_width;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; } else {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $off_w = 0;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $off_h = 0;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if (!@$destImage = imagecreatetruecolor($max_width, $max_height)) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return false;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if (!@imagecopyresampled($destImage, $srcImage, 0, 0, $off_w, $off_h, $max_width, $max_height, $src_width, $src_height)) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return false;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; @imagedestroy($srcImage);<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if (!@imageantialias($destImage, true)) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return false;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if (!@imagejpeg($destImage, $thumbnail, $quality)) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return false;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; @imagedestroy($destImage);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return true;<br />
&nbsp;&nbsp;&nbsp; }</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="78239""></a>
  <div class="note">
   <strong class="user">tim dot daldini at gmail dot be</strong>
   <a href="#78239" class="date">04-Oct-2007 05:57</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Tim's function is a whole lot faster, however, the quality setting doesnt seem right since resizing very big images doesnt affect quality of the resulting thumbnails that much on quality 1 for example.<br />
<br />
Anyone has figured out how to use a more correct quality setting by comparing image surfaces (for example) basing on Tim's function?<br />
<br />
images with a total of 10Megapixels that contain 5Megapixels when resized should use the same quality setting like images that contain 1Megapixels but only 0.5 when resized.<br />
<br />
Not hard to understand, but the memoryload would be a lot lower if the function could decide to use a setting of quality 1 automatically when resizing big images to small thumbnails. This would be handy especially when using the function for images of various sizes in the same application.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="78049""></a>
  <div class="note">
   <strong class="user">liviu dot malaescu at gmail dot com</strong>
   <a href="#78049" class="date">25-Sep-2007 09:37</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
3800x2500px - 2s<br />
3807x6768 - 4.7s <br />
Tested on a core2duo e4300/1gb ram - only one core used.<br />
It reduces first with nearest-neighbour and then with bicubic on the smaller image. <br />
Thumb quality is fine :)<br />
<br />
<span class="default">&lt;?php<br />
$cale_in </span><span class="keyword">= </span><span class="string">"test.jpg"</span><span class="keyword">; </span><span class="comment">//input-file<br />
</span><span class="default">$cale_out </span><span class="keyword">= </span><span class="string">"test_thumb.jpg"</span><span class="keyword">; </span><span class="comment">//output-file<br />
</span><span class="default">$make_thumbs </span><span class="keyword">= </span><span class="string">"YES"</span><span class="keyword">;<br />
</span><span class="default">$thumbsize</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">] = </span><span class="default">100</span><span class="keyword">;<br />
</span><span class="default">$thumbsize</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">] = </span><span class="default">75</span><span class="keyword">;<br />
</span><span class="default">ini_set</span><span class="keyword">(</span><span class="string">"memory_limit"</span><span class="keyword">, </span><span class="string">"134217728"</span><span class="keyword">); </span><span class="comment">// needed for huge pictures<br />
<br />
// Bicubic resampling, not written by me<br />
</span><span class="keyword">function </span><span class="default">ImageCopyResampleBicubic <br />
</span><span class="keyword">(&amp;</span><span class="default">$dst_img</span><span class="keyword">, &amp;</span><span class="default">$src_img</span><span class="keyword">, </span><span class="default">$dst_x</span><span class="keyword">, </span><span class="default">$dst_y</span><span class="keyword">, </span><span class="default">$src_x</span><span class="keyword">, </span><span class="default">$src_y</span><span class="keyword">, </span><span class="default">$dst_w</span><span class="keyword">, </span><span class="default">$dst_h</span><span class="keyword">, </span><span class="default">$src_w</span><span class="keyword">, </span><span class="default">$src_h</span><span class="keyword">)&nbsp; {<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">ImagePaletteCopy </span><span class="keyword">(</span><span class="default">$dst_img</span><span class="keyword">, </span><span class="default">$src_img</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$rX </span><span class="keyword">= </span><span class="default">$src_w </span><span class="keyword">/ </span><span class="default">$dst_w</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$rY </span><span class="keyword">= </span><span class="default">$src_h </span><span class="keyword">/ </span><span class="default">$dst_h</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$w </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; for (</span><span class="default">$y </span><span class="keyword">= </span><span class="default">$dst_y</span><span class="keyword">; </span><span class="default">$y </span><span class="keyword">&lt; </span><span class="default">$dst_h</span><span class="keyword">; </span><span class="default">$y</span><span class="keyword">++)&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$ow </span><span class="keyword">= </span><span class="default">$w</span><span class="keyword">; </span><span class="default">$w </span><span class="keyword">= </span><span class="default">round</span><span class="keyword">((</span><span class="default">$y </span><span class="keyword">+ </span><span class="default">1</span><span class="keyword">) * </span><span class="default">$rY</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$t </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; for (</span><span class="default">$x </span><span class="keyword">= </span><span class="default">$dst_x</span><span class="keyword">; </span><span class="default">$x </span><span class="keyword">&lt; </span><span class="default">$dst_w</span><span class="keyword">; </span><span class="default">$x</span><span class="keyword">++)&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$r </span><span class="keyword">= </span><span class="default">$g </span><span class="keyword">= </span><span class="default">$b </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">; </span><span class="default">$a </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$ot </span><span class="keyword">= </span><span class="default">$t</span><span class="keyword">; </span><span class="default">$t </span><span class="keyword">= </span><span class="default">round</span><span class="keyword">((</span><span class="default">$x </span><span class="keyword">+ </span><span class="default">1</span><span class="keyword">) * </span><span class="default">$rX</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; for (</span><span class="default">$u </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">; </span><span class="default">$u </span><span class="keyword">&lt; (</span><span class="default">$w </span><span class="keyword">- </span><span class="default">$ow</span><span class="keyword">); </span><span class="default">$u</span><span class="keyword">++)&nbsp; { <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; for (</span><span class="default">$p </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">; </span><span class="default">$p </span><span class="keyword">&lt; (</span><span class="default">$t </span><span class="keyword">- </span><span class="default">$ot</span><span class="keyword">); </span><span class="default">$p</span><span class="keyword">++)&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$c </span><span class="keyword">= </span><span class="default">ImageColorsForIndex </span><span class="keyword">(</span><span class="default">$src_img</span><span class="keyword">, <br />
</span><span class="default">ImageColorAt </span><span class="keyword">(</span><span class="default">$src_img</span><span class="keyword">, </span><span class="default">$ot </span><span class="keyword">+ </span><span class="default">$p</span><span class="keyword">, </span><span class="default">$ow </span><span class="keyword">+ </span><span class="default">$u</span><span class="keyword">));<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$r </span><span class="keyword">+= </span><span class="default">$c</span><span class="keyword">[</span><span class="string">'red'</span><span class="keyword">];<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$g </span><span class="keyword">+= </span><span class="default">$c</span><span class="keyword">[</span><span class="string">'green'</span><span class="keyword">];<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$b </span><span class="keyword">+= </span><span class="default">$c</span><span class="keyword">[</span><span class="string">'blue'</span><span class="keyword">];<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$a</span><span class="keyword">++;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">ImageSetPixel </span><span class="keyword">(</span><span class="default">$dst_img</span><span class="keyword">, </span><span class="default">$x</span><span class="keyword">, </span><span class="default">$y</span><span class="keyword">, <br />
</span><span class="default">ImageColorClosest </span><span class="keyword">(</span><span class="default">$dst_img</span><span class="keyword">, </span><span class="default">$r </span><span class="keyword">/ </span><span class="default">$a</span><span class="keyword">, </span><span class="default">$g </span><span class="keyword">/ </span><span class="default">$a</span><span class="keyword">, </span><span class="default">$b </span><span class="keyword">/ </span><span class="default">$a</span><span class="keyword">)); <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; }<br />
}<br />
<br />
function </span><span class="default">makeThumb</span><span class="keyword">(</span><span class="default">$cale_in</span><span class="keyword">)&nbsp; {<br />
&nbsp;&nbsp;&nbsp; global </span><span class="default">$thumbsize</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$sursa </span><span class="keyword">= </span><span class="default">imagecreatefromjpeg</span><span class="keyword">(</span><span class="default">$cale_in</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$is_jpeg </span><span class="keyword">= </span><span class="default">getimagesize</span><span class="keyword">(</span><span class="default">$cale_in</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$ws </span><span class="keyword">= </span><span class="default">$is_jpeg</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">];<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$hs </span><span class="keyword">= </span><span class="default">$is_jpeg</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">];<br />
&nbsp;&nbsp;&nbsp; if(</span><span class="default">$ws </span><span class="keyword">&gt; </span><span class="default">$thumbsize</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">] &amp;&amp; </span><span class="default">$hs </span><span class="keyword">&gt; </span><span class="default">$thumbsize</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">])<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$aspect </span><span class="keyword">= </span><span class="default">$ws</span><span class="keyword">/</span><span class="default">$hs</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if(</span><span class="default">$aspect </span><span class="keyword">&lt;= </span><span class="default">1.333333</span><span class="keyword">)&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$hd </span><span class="keyword">= </span><span class="default">$thumbsize</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">];<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$wd </span><span class="keyword">= </span><span class="default">floor</span><span class="keyword">(</span><span class="default">$hd</span><span class="keyword">*</span><span class="default">$aspect</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; else&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$wd </span><span class="keyword">= </span><span class="default">$thumbsize</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">];<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$hd </span><span class="keyword">= </span><span class="default">floor</span><span class="keyword">(</span><span class="default">$wd</span><span class="keyword">/</span><span class="default">$aspect</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; } <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$Z </span><span class="keyword">= </span><span class="default">ceil</span><span class="keyword">(</span><span class="default">log</span><span class="keyword">((</span><span class="default">$ws</span><span class="keyword">*</span><span class="default">$hs</span><span class="keyword">)/(</span><span class="default">4</span><span class="keyword">*</span><span class="default">$thumbsize</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">]*</span><span class="default">$thumbsize</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">])))+</span><span class="default">1</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if(</span><span class="default">log</span><span class="keyword">((</span><span class="default">$ws</span><span class="keyword">*</span><span class="default">$hs</span><span class="keyword">)/(</span><span class="default">4</span><span class="keyword">*</span><span class="default">$thumbsize</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">]*</span><span class="default">$thumbsize</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">])) &lt; </span><span class="default">0</span><span class="keyword">) </span><span class="default">$Z</span><span class="keyword">=</span><span class="default">1</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$dx </span><span class="keyword">= </span><span class="default">$dy </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if(</span><span class="default">$Z </span><span class="keyword">&gt; </span><span class="default">1</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$dest </span><span class="keyword">= </span><span class="default">imagecreatetruecolor</span><span class="keyword">(</span><span class="default">round</span><span class="keyword">(</span><span class="default">$ws</span><span class="keyword">/</span><span class="default">$Z</span><span class="keyword">), </span><span class="default">round</span><span class="keyword">(</span><span class="default">$hs</span><span class="keyword">/</span><span class="default">$Z</span><span class="keyword">));<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; for(</span><span class="default">$i</span><span class="keyword">=</span><span class="default">0</span><span class="keyword">; </span><span class="default">$i </span><span class="keyword">&lt; </span><span class="default">$hs</span><span class="keyword">; </span><span class="default">$i</span><span class="keyword">+=</span><span class="default">$Z</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; for(</span><span class="default">$j</span><span class="keyword">=</span><span class="default">0</span><span class="keyword">; </span><span class="default">$j </span><span class="keyword">&lt; </span><span class="default">$ws</span><span class="keyword">; </span><span class="default">$j</span><span class="keyword">+=</span><span class="default">$Z</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$rgb </span><span class="keyword">= </span><span class="default">imagecolorat</span><span class="keyword">(</span><span class="default">$sursa</span><span class="keyword">, </span><span class="default">$j</span><span class="keyword">, </span><span class="default">$i</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$r </span><span class="keyword">= (</span><span class="default">$rgb </span><span class="keyword">&gt;&gt; </span><span class="default">16</span><span class="keyword">) &amp; </span><span class="default">0xFF</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$g </span><span class="keyword">= (</span><span class="default">$rgb </span><span class="keyword">&gt;&gt; </span><span class="default">8</span><span class="keyword">) &amp; </span><span class="default">0xFF</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$b </span><span class="keyword">= </span><span class="default">$rgb </span><span class="keyword">&amp; </span><span class="default">0xFF</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$pcol </span><span class="keyword">= </span><span class="default">imagecolorallocate</span><span class="keyword">(</span><span class="default">$dest</span><span class="keyword">, </span><span class="default">$r</span><span class="keyword">, </span><span class="default">$g</span><span class="keyword">, </span><span class="default">$b</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">imagesetpixel</span><span class="keyword">(</span><span class="default">$dest</span><span class="keyword">, </span><span class="default">$dx</span><span class="keyword">, </span><span class="default">$dy</span><span class="keyword">, </span><span class="default">$pcol</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$dx</span><span class="keyword">++;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$dx</span><span class="keyword">=</span><span class="default">0</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$dy</span><span class="keyword">++;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; else <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$dest </span><span class="keyword">= </span><span class="default">imagecreatetruecolor</span><span class="keyword">(</span><span class="default">$ws</span><span class="keyword">, </span><span class="default">$hs</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">imagecopy</span><span class="keyword">(</span><span class="default">$dest</span><span class="keyword">, </span><span class="default">$sursa</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">$ws</span><span class="keyword">, </span><span class="default">$hs </span><span class="keyword">);&nbsp; &nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">imagedestroy</span><span class="keyword">(</span><span class="default">$sursa</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$destrs </span><span class="keyword">= </span><span class="default">imagecreatetruecolor</span><span class="keyword">(</span><span class="default">$wd</span><span class="keyword">, </span><span class="default">$hd</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">ImageCopyResampleBicubic</span><span class="keyword">(</span><span class="default">$destrs</span><span class="keyword">,</span><span class="default">$dest</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">,<br />
</span><span class="default">$wd</span><span class="keyword">,</span><span class="default">$hd</span><span class="keyword">,</span><span class="default">round</span><span class="keyword">(</span><span class="default">$ws</span><span class="keyword">/</span><span class="default">$Z</span><span class="keyword">),</span><span class="default">round</span><span class="keyword">(</span><span class="default">$hs</span><span class="keyword">/</span><span class="default">$Z</span><span class="keyword">));<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">ImageJpeg</span><span class="keyword">(</span><span class="default">$destrs</span><span class="keyword">, </span><span class="default">$cale_out</span><span class="keyword">, </span><span class="default">100</span><span class="keyword">);&nbsp; &nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; echo </span><span class="string">"Z:</span><span class="default">$Z</span><span class="string"> &lt;b&gt;|&lt;/b&gt; (</span><span class="default">$ws</span><span class="string"> x </span><span class="default">$hs</span><span class="string">) -&gt; (</span><span class="default">$wd</span><span class="string"> x </span><span class="default">$hd</span><span class="string">) @ "</span><span class="keyword">.</span><span class="default">$ws</span><span class="keyword">/</span><span class="default">$hs</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }&nbsp; &nbsp; <br />
}<br />
<br />
function </span><span class="default">mf</span><span class="keyword">() {<br />
&nbsp;&nbsp;&nbsp; list(</span><span class="default">$usec</span><span class="keyword">, </span><span class="default">$sec</span><span class="keyword">) = </span><span class="default">explode</span><span class="keyword">(</span><span class="string">" "</span><span class="keyword">, </span><span class="default">microtime</span><span class="keyword">());<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$x</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">] = </span><span class="default">$sec</span><span class="keyword">;&nbsp; </span><span class="default">$x</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">] = </span><span class="default">$usec</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; return </span><span class="default">$x</span><span class="keyword">;<br />
}<br />
<br />
</span><span class="default">$timp1 </span><span class="keyword">= </span><span class="default">mf</span><span class="keyword">(); </span><span class="comment">//starting to count<br />
</span><span class="default">makeThumb</span><span class="keyword">(</span><span class="default">$cale_in</span><span class="keyword">); </span><span class="comment">//makes the actual thumb<br />
</span><span class="default">$timp2 </span><span class="keyword">= </span><span class="default">mf</span><span class="keyword">(); </span><span class="comment">//timer ends<br />
</span><span class="default">$dsec </span><span class="keyword">= </span><span class="default">$timp2</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">] - </span><span class="default">$timp1</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">];<br />
</span><span class="default">$dusec </span><span class="keyword">= </span><span class="default">$timp2</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">] - </span><span class="default">$timp1</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">];<br />
echo </span><span class="string">"&lt;b&gt;|&lt;/b&gt; Time : &lt;b&gt;"</span><span class="keyword">.</span><span class="default">round</span><span class="keyword">(</span><span class="default">$dusec</span><span class="keyword">+</span><span class="default">$dsec</span><span class="keyword">,</span><span class="default">6</span><span class="keyword">).</span><span class="string">"s&lt;/b&gt; &lt;b&gt;|&lt;/b&gt;&lt;br /&gt;"</span><span class="keyword">;<br />
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="77679""></a>
  <div class="note">
   <strong class="user">tim at leethost dot com</strong>
   <a href="#77679" class="date">08-Sep-2007 06:25</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Here's an improved and corrected version of my fastimagecopyresampled script.&nbsp; Because I typically scale entire images it appears my previous code was not properly tested.&nbsp; In any case, this new script has been thoroughly tested, cleaned up, and enhanced.&nbsp; The code is a little tighter and quality values between 0 and 1 will yield a mosaic effect (basically lowering quality below the pervious lowest value of 1).&nbsp; I would still suggest using a quality of 2 to 4 as that's the primary purpose of this script, which is high quality and fast results.&nbsp; Don't be afraid of using a quality value of 1.5 for extreme cases where you have a bunch of very large images from digital cameras (like those 10M pixel cameras theses days) and creating thumbnails in batch mode.&nbsp; Even a quality of 1.5 is a big improvement over imagecopyresized and is ultra-fast.<br />
<br />
Anyway, enjoy and I hope this is the bug-free last version.<br />
<br />
&lt;?<br />
function fastimagecopyresampled (&amp;$dst_image, $src_image, $dst_x, $dst_y, $src_x, $src_y, $dst_w, $dst_h, $src_w, $src_h, $quality = 3) {<br />
&nbsp; // Plug-and-Play fastimagecopyresampled function replaces much slower imagecopyresampled.<br />
&nbsp; // Just include this function and change all "imagecopyresampled" references to "fastimagecopyresampled".<br />
&nbsp; // Typically from 30 to 60 times faster when reducing high resolution images down to thumbnail size using the default quality setting.<br />
&nbsp; // Author: Tim Eckel - Date: 09/07/07 - Version: 1.1 - Project: FreeRingers.net - Freely distributable - These comments must remain.<br />
&nbsp; //<br />
&nbsp; // Optional "quality" parameter (defaults is 3). Fractional values are allowed, for example 1.5. Must be greater than zero.<br />
&nbsp; // Between 0 and 1 = Fast, but mosaic results, closer to 0 increases the mosaic effect.<br />
&nbsp; // 1 = Up to 350 times faster. Poor results, looks very similar to imagecopyresized.<br />
&nbsp; // 2 = Up to 95 times faster.&nbsp; Images appear a little sharp, some prefer this over a quality of 3.<br />
&nbsp; // 3 = Up to 60 times faster.&nbsp; Will give high quality smooth results very close to imagecopyresampled, just faster.<br />
&nbsp; // 4 = Up to 25 times faster.&nbsp; Almost identical to imagecopyresampled for most images.<br />
&nbsp; // 5 = No speedup. Just uses imagecopyresampled, no advantage over imagecopyresampled.<br />
<br />
&nbsp; if (empty($src_image) || empty($dst_image) || $quality &lt;= 0) { return false; }<br />
&nbsp; if ($quality &lt; 5 &amp;&amp; (($dst_w * $quality) &lt; $src_w || ($dst_h * $quality) &lt; $src_h)) {<br />
&nbsp;&nbsp;&nbsp; $temp = imagecreatetruecolor ($dst_w * $quality + 1, $dst_h * $quality + 1);<br />
&nbsp;&nbsp;&nbsp; imagecopyresized ($temp, $src_image, 0, 0, $src_x, $src_y, $dst_w * $quality + 1, $dst_h * $quality + 1, $src_w, $src_h);<br />
&nbsp;&nbsp;&nbsp; imagecopyresampled ($dst_image, $temp, $dst_x, $dst_y, 0, 0, $dst_w, $dst_h, $dst_w * $quality, $dst_h * $quality);<br />
&nbsp;&nbsp;&nbsp; imagedestroy ($temp);<br />
&nbsp; } else imagecopyresampled ($dst_image, $src_image, $dst_x, $dst_y, $src_x, $src_y, $dst_w, $dst_h, $src_w, $src_h);<br />
&nbsp; return true;<br />
}<br />
?&gt;</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="77612""></a>
  <div class="note">
   <strong class="user">eblejr AT phrebh DOT com</strong>
   <a href="#77612" class="date">05-Sep-2007 08:38</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Tim's code is fast, but if you're trying to put resampled images anywhere but in the top-left corner, it doesn't work.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="76204""></a>
  <div class="note">
   <strong class="user">Blendermf</strong>
   <a href="#76204" class="date">05-Jul-2007 05:48</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
tim, your resampling gives me better results than the gd function. It looks just as good as what my image resizing software does.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="75551""></a>
  <div class="note">
   <strong class="user">kristijan at leftor dot ba</strong>
   <a href="#75551" class="date">05-Jun-2007 11:09</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
There is bug in POST from tim at leethost dot com<br />
25-Jan-2007 02:00.<br />
<br />
Function work correctly when you making thumb from 0,0 to width/height. But if you want copy resized picture to other coordinates then you must change code in this:<br />
<br />
function fastimagecopyresampled (&amp;$dst_image, $src_image, $dst_x, $dst_y, $src_x, $src_y, $dst_w, $dst_h, $src_w, $src_h, $quality = 3) {<br />
&nbsp;if (empty($src_image) || empty($dst_image)) { return false; }<br />
&nbsp;if ($quality &lt;= 1)<br />
&nbsp;{<br />
&nbsp;&nbsp; $temp = imagecreatetruecolor ($dst_w + 1, $dst_h + 1);<br />
&nbsp;&nbsp; imagecopyresized ($temp, $src_image, $dst_x, $dst_y, $src_x, $src_y, $dst_w + 1, $dst_h + 1, $src_w, $src_h);<br />
&nbsp;&nbsp; imagecopyresized ($dst_image, $temp, 0, 0, 0, 0, $dst_w, $dst_h, $dst_w, $dst_h);<br />
&nbsp;&nbsp; imagedestroy ($temp);<br />
&nbsp;}<br />
&nbsp;elseif ($quality &lt; 5 &amp;&amp; (($dst_w * $quality) &lt; $src_w || ($dst_h * $quality) &lt; $src_h))<br />
&nbsp;{<br />
&nbsp;&nbsp; $tmp_w = $dst_w * $quality;<br />
&nbsp;&nbsp; $tmp_h = $dst_h * $quality;<br />
&nbsp;&nbsp; $temp = imagecreatetruecolor ($tmp_w + 1, $tmp_h + 1);<br />
&nbsp;&nbsp; imagecopyresized ($temp, $src_image, 0, 0, $src_x, $src_y, $tmp_w + 1, $tmp_h + 1, $src_w, $src_h);<br />
&nbsp;&nbsp; imagecopyresampled ($dst_image, $temp, $dst_x, $dst_y, 0, 0, $dst_w, $dst_h, $tmp_w, $tmp_h);<br />
&nbsp;&nbsp; imagedestroy ($temp);<br />
&nbsp;} else<br />
&nbsp;{<br />
&nbsp;&nbsp; imagecopyresampled ($dst_image, $src_image, $dst_x, $dst_y, $src_x, $src_y, $dst_w, $dst_h, $src_w, $src_h);<br />
&nbsp;}<br />
&nbsp;return true;<br />
}</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="75258""></a>
  <div class="note">
   <strong class="user">rich at corephp dot co dot uk</strong>
   <a href="#75258" class="date">21-May-2007 12:05</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Be wary of this function when resizing images to make them *larger* than the original due to the memory consumption rate. For example a 200KB JPEG file (1024x768) will take up 4MB of memory when loaded, but when resampled to twice the the size the memory use jumps to 20.1MB. imagecopyresized does the same. Allow approx. 5 bytes per *pixel* for memory allowance when dealing with true colour images.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="72606""></a>
  <div class="note">
   <strong class="user">tim at leethost dot com</strong>
   <a href="#72606" class="date">25-Jan-2007 11:00</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Here's a simple plug-and-play replacement to imagecopyresampled that will deliver results that are almost identical except MUCH faster (very typically 30 times faster).&nbsp; I've been using this function for a few years but figured everyone could benefit from it.<br />
<br />
For example, a 10 megapixel camera image (3872x2592 resolution) converted to thumbnail size using the default quality is 60 times faster than using imagecopyresampled (only 0.15 seconds from 8.9 seconds) and the image quality is almost identical.&nbsp; There's also an optional "quality" parameter that allows you to select the quality you want (1 is lowest quality but fastest, 5 is highest quality but slowest, 3 is default).&nbsp; All existing imagecopyresampled parameters fully work so it's truly plug-and-play.&nbsp; It also automatically decides if it would be better to just use imagecopyresampled depending on source and destination image sizes.<br />
<br />
My image analysis shows imagecopyresized renders on average 2.4% of pixels significantly different than imagecopyresampled.&nbsp; These significantly different pixels give imagecopyresized the jagged, blocky, aliasing look.&nbsp; Using fastimagecopyresampled with a quality of 2, the significantly different pixel rate is reduced to 0.8%.&nbsp; With a quality of 3 (the default) it's reduced to 0.5% and at a quality of 4 it's reduced to only 0.03% but is still very typically 10-15 times faster for thumbnail creation.<br />
<br />
Enjoy!<br />
<br />
&lt;?<br />
function fastimagecopyresampled (&amp;$dst_image, $src_image, $dst_x, $dst_y, $src_x, $src_y, $dst_w, $dst_h, $src_w, $src_h, $quality = 3) {<br />
&nbsp; // Plug-and-Play fastimagecopyresampled function replaces much slower imagecopyresampled.<br />
&nbsp; // Just include this function and change all "imagecopyresampled" references to "fastimagecopyresampled".<br />
&nbsp; // Typically from 30 to 60 times faster when reducing high resolution images down to thumbnail size using the default quality setting.<br />
&nbsp; // Author: Tim Eckel - Date: 12/17/04 - Project: FreeRingers.net - Freely distributable.<br />
&nbsp; //<br />
&nbsp; // Optional "quality" parameter (defaults is 3).&nbsp; Fractional values are allowed, for example 1.5.<br />
&nbsp; // 1 = Up to 600 times faster.&nbsp; Poor results, just uses imagecopyresized but removes black edges.<br />
&nbsp; // 2 = Up to 95 times faster.&nbsp; Images may appear too sharp, some people may prefer it.<br />
&nbsp; // 3 = Up to 60 times faster.&nbsp; Will give high quality smooth results very close to imagecopyresampled.<br />
&nbsp; // 4 = Up to 25 times faster.&nbsp; Almost identical to imagecopyresampled for most images.<br />
&nbsp; // 5 = No speedup.&nbsp; Just uses imagecopyresampled, highest quality but no advantage over imagecopyresampled.<br />
<br />
&nbsp; if (empty($src_image) || empty($dst_image)) { return false; }<br />
&nbsp; if ($quality &lt;= 1) {<br />
&nbsp;&nbsp;&nbsp; $temp = imagecreatetruecolor ($dst_w + 1, $dst_h + 1);<br />
&nbsp;&nbsp;&nbsp; imagecopyresized ($temp, $src_image, $dst_x, $dst_y, $src_x, $src_y, $dst_w + 1, $dst_h + 1, $src_w, $src_h);<br />
&nbsp;&nbsp;&nbsp; imagecopyresized ($dst_image, $temp, 0, 0, 0, 0, $dst_w, $dst_h, $dst_w, $dst_h);<br />
&nbsp;&nbsp;&nbsp; imagedestroy ($temp);<br />
&nbsp; } elseif ($quality &lt; 5 &amp;&amp; (($dst_w * $quality) &lt; $src_w || ($dst_h * $quality) &lt; $src_h)) {<br />
&nbsp;&nbsp;&nbsp; $tmp_w = $dst_w * $quality;<br />
&nbsp;&nbsp;&nbsp; $tmp_h = $dst_h * $quality;<br />
&nbsp;&nbsp;&nbsp; $temp = imagecreatetruecolor ($tmp_w + 1, $tmp_h + 1);<br />
&nbsp;&nbsp;&nbsp; imagecopyresized ($temp, $src_image, $dst_x * $quality, $dst_y * $quality, $src_x, $src_y, $tmp_w + 1, $tmp_h + 1, $src_w, $src_h);<br />
&nbsp;&nbsp;&nbsp; imagecopyresampled ($dst_image, $temp, 0, 0, 0, 0, $dst_w, $dst_h, $tmp_w, $tmp_h);<br />
&nbsp;&nbsp;&nbsp; imagedestroy ($temp);<br />
&nbsp; } else {<br />
&nbsp;&nbsp;&nbsp; imagecopyresampled ($dst_image, $src_image, $dst_x, $dst_y, $src_x, $src_y, $dst_w, $dst_h, $src_w, $src_h);<br />
&nbsp; }<br />
&nbsp; return true;<br />
}<br />
?&gt;</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="71231""></a>
  <div class="note">
   <strong class="user">mr bitmap</strong>
   <a href="#71231" class="date">17-Nov-2006 04:18</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
For all those that are using imagecreatefromwbmp() for.BMP files, I believe you are wrong.<br />
<br />
imagecreatefromwbmp() is for WBMP image files used for WAP devices not windows BMP images.<br />
<br />
I don't think PHP has any built in Windows BMP functions. <br />
<br />
There are many examples here that make this mistake.<br />
<br />
See the documentation for imagecreatefromwbmp()</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="68145""></a>
  <div class="note">
   <strong class="user">caio at daisuki dot com dot br</strong>
   <a href="#68145" class="date">14-Jul-2006 11:51</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Ok guys, the ultimate image merging tool, enjoy:<br />
<br />
&nbsp; function watermark($sourcefile, $watermarkfiles, $destination, $quality=90) {<br />
&nbsp; /*<br />
&nbsp; <br />
&nbsp;&nbsp;&nbsp; $sourcefile = Filename of the picture to be watermarked.<br />
&nbsp;&nbsp;&nbsp; $watermarkfile = files to add. Each is: array ( 'filename' =&gt; filename , 'position' =&gt; position to show(array), 'resample' =&gt; new dimension(array) )<br />
&nbsp;&nbsp; &nbsp; &nbsp; You can omit any except filename<br />
&nbsp;&nbsp;&nbsp; $destination = jpg or png file to output (jpg if source is jpg, png if source is png). Send blank to direct output&nbsp; <br />
&nbsp;&nbsp;&nbsp; Sample:<br />
&nbsp; <br />
&nbsp;&nbsp;&nbsp; $batch = array ( array ( 'filename' =&gt; "watermark.png",<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 'position' =&gt; array(100,0),<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ),<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; array ( 'filename' =&gt; "brilho.png",<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; 'position' =&gt; array(200,200),<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; 'resample' =&gt; array(30,30)<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; )<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; );<br />
&nbsp;&nbsp;&nbsp; watermark("picture.jpg", $batch, "", 90); &lt;--&nbsp; will add both images in bath on top of picture, preserving transparency<br />
&nbsp; <br />
&nbsp; */<br />
&nbsp; <br />
&nbsp; $ih = getimagesize($sourcefile);<br />
&nbsp; $ispng = $ih[2] == 3;<br />
&nbsp; if ($ispng)<br />
&nbsp;&nbsp;&nbsp; $sourcefile_id = imagecreatefrompng($sourcefile);<br />
&nbsp; else<br />
&nbsp;&nbsp;&nbsp; $sourcefile_id = imagecreatefromjpeg($sourcefile);<br />
&nbsp;&nbsp; <br />
&nbsp; $sourcefile_width=imageSX($sourcefile_id);<br />
&nbsp; $sourcefile_height=imageSY($sourcefile_id);&nbsp;&nbsp; <br />
&nbsp; <br />
&nbsp; foreach ($watermarkfiles as $x =&gt; $watermarkfile) {<br />
&nbsp;&nbsp;&nbsp; $watermarkfile_id = imagecreatefrompng($watermarkfile['filename']);<br />
&nbsp;&nbsp;&nbsp; imageAlphaBlending($watermarkfile_id, false);<br />
&nbsp;&nbsp;&nbsp; imageSaveAlpha($watermarkfile_id, true);&nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; $watermarkfile_width=imageSX($watermarkfile_id);<br />
&nbsp;&nbsp;&nbsp; $watermarkfile_height=imageSY($watermarkfile_id);<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; // resample?<br />
&nbsp;&nbsp;&nbsp; if (isset($watermarkfile['resample'])) {<br />
&nbsp;&nbsp; &nbsp;&nbsp; $im_dest = imagecreatetruecolor ($watermarkfile['resample'][0], $watermarkfile['resample'][1]);<br />
&nbsp;&nbsp; &nbsp;&nbsp; imagealphablending($im_dest, false);<br />
&nbsp;&nbsp; &nbsp;&nbsp; imagecopyresampled($im_dest, $watermarkfile_id, 0, 0, 0, 0, $watermarkfile['resample'][0], $watermarkfile['resample'][1], $watermarkfile_width, $watermarkfile_height);<br />
&nbsp;&nbsp; &nbsp;&nbsp; imagesavealpha($im_dest, true);<br />
&nbsp;&nbsp; &nbsp;&nbsp; imagedestroy($watermarkfile_id);<br />
&nbsp;&nbsp; &nbsp;&nbsp; $watermarkfile_id = $im_dest;<br />
&nbsp;&nbsp; &nbsp;&nbsp; $watermarkfile_width = $watermarkfile['resample'][0];<br />
&nbsp;&nbsp; &nbsp;&nbsp; $watermarkfile_height = $watermarkfile['resample'][1];<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; // position ? if none given, centered<br />
&nbsp;&nbsp;&nbsp; if (isset($watermarkfile['position']))<br />
&nbsp;&nbsp; &nbsp;&nbsp; list($dest_x,$dest_y) = $watermarkfile['position'];<br />
&nbsp;&nbsp;&nbsp; else {<br />
&nbsp;&nbsp; &nbsp;&nbsp; $dest_x = ( $sourcefile_width / 2 ) - ( $watermarkfile_width / 2 ); // centered<br />
&nbsp;&nbsp; &nbsp;&nbsp; $dest_y = ( $sourcefile_height / 2 ) - ( $watermarkfile_height / 2 ); // centered<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; imagecopy($sourcefile_id, $watermarkfile_id, $dest_x, $dest_y, 0, 0, $watermarkfile_width, $watermarkfile_height);<br />
&nbsp;&nbsp;&nbsp; imagedestroy($watermarkfile_id);<br />
&nbsp; }<br />
&nbsp; if ($ispng)<br />
&nbsp;&nbsp;&nbsp; imagepng($sourcefile_id,$destination);<br />
&nbsp; else<br />
&nbsp;&nbsp;&nbsp; imagejpeg($sourcefile_id,$destination,$quality); <br />
&nbsp; imagedestroy($sourcefile_id);<br />
}</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="66054""></a>
  <div class="note">
   <strong class="user">spencejames2000 at yahoo dot co dot uk</strong>
   <a href="#66054" class="date">13-May-2006 03:27</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
For anyone suffering from the srcX and srcY bug (some versions of gd ignore them completely - see <a href="http://bugs.php.net/bug.php?id=12780 for details" rel="nofollow" target="_blank">http://bugs.php.net/bug.php?id=12780 for details</a>), a quick solution is to use this code snippet:<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">function </span><span class="default">imgcopyresampled</span><span class="keyword">(&amp;</span><span class="default">$dst_img</span><span class="keyword">, </span><span class="default">$src_img</span><span class="keyword">, </span><span class="default">$dst_x</span><span class="keyword">, </span><span class="default">$dst_y</span><span class="keyword">, </span><span class="default">$src_x</span><span class="keyword">, </span><span class="default">$src_y</span><span class="keyword">, </span><span class="default">$dst_w</span><span class="keyword">, </span><span class="default">$dst_h</span><span class="keyword">, </span><span class="default">$src_w</span><span class="keyword">, </span><span class="default">$src_h</span><span class="keyword">)<br />
{<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$tmp_img </span><span class="keyword">= </span><span class="default">imagecreatetruecolor</span><span class="keyword">(</span><span class="default">$src_w</span><span class="keyword">, </span><span class="default">$src_h</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$rv2 </span><span class="keyword">= </span><span class="default">imagecopy</span><span class="keyword">(</span><span class="default">$tmp_img</span><span class="keyword">, </span><span class="default">$src_img</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">, </span><span class="default">$src_x</span><span class="keyword">, </span><span class="default">$src_y</span><span class="keyword">, </span><span class="default">$src_w</span><span class="keyword">, </span><span class="default">$src_h</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$rv1 </span><span class="keyword">= </span><span class="default">imagecopyresampled</span><span class="keyword">(</span><span class="default">$dst_img</span><span class="keyword">, </span><span class="default">$tmp_img</span><span class="keyword">, </span><span class="default">$dst_x</span><span class="keyword">,</span><span class="default">$dst_y</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">, </span><span class="default">$dst_w</span><span class="keyword">, </span><span class="default">$dst_h</span><span class="keyword">, </span><span class="default">$src_w</span><span class="keyword">, </span><span class="default">$src_h</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">imagedestroy</span><span class="keyword">(</span><span class="default">$tmp_img</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; return(</span><span class="default">$rv1 </span><span class="keyword">and </span><span class="default">$rv2</span><span class="keyword">);<br />
}<br />
</span><span class="default">?&gt;<br />
</span><br />
By using imagecopy to extract the relevant portion of the source image, it works a lot more quickly than pike's solution below, and also without the extra blur.<br />
<br />
It may be useful to use override_function in existing projects, although I have not tested this myself.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="65979""></a>
  <div class="note">
   <strong class="user">Tyron Madlener (tyron.at)</strong>
   <a href="#65979" class="date">11-May-2006 10:43</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Creating a thumbnail (120x90 pixel) of a big image (3000x2000 pixel) took me about 5 seconds with imagecopyresampled()<br />
<br />
Thats pretty much, so I tested a little how I could improve the speed. I found that imagecopyresized is way faster but results in poor quality.<br />
So I combined both - I first reduce the big image via imagecopyresized to 1024x768 pixel and then create the small thumbnail via imagecopyresampled. The resulting quality is almost the same. In my tests, resizing took only about 2.2 seconds now - twice as fast :)<br />
<br />
I also tried using that bicubic image resizing function in some earlier post here, but it was only faster when the thumbnails were smaller than 120x90 and the quality was not very good.<br />
<br />
Here's the code if you wanna (I guess there are still a few possibilites to do some more optimiztions tough):<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">function </span><span class="default">CreateThumb</span><span class="keyword">(</span><span class="default">$file</span><span class="keyword">,</span><span class="default">$maxwdt</span><span class="keyword">,</span><span class="default">$maxhgt</span><span class="keyword">, </span><span class="default">$dest</span><span class="keyword">) {<br />
&nbsp;&nbsp;&nbsp; list(</span><span class="default">$owdt</span><span class="keyword">,</span><span class="default">$ohgt</span><span class="keyword">,</span><span class="default">$otype</span><span class="keyword">)=@</span><span class="default">getimagesize</span><span class="keyword">(</span><span class="default">$file</span><span class="keyword">);<br />
<br />
&nbsp; switch(</span><span class="default">$otype</span><span class="keyword">) {<br />
&nbsp;&nbsp;&nbsp; case </span><span class="default">1</span><span class="keyword">:&nbsp; </span><span class="default">$newimg</span><span class="keyword">=</span><span class="default">imagecreatefromgif</span><span class="keyword">(</span><span class="default">$file</span><span class="keyword">); break;<br />
&nbsp;&nbsp;&nbsp; case </span><span class="default">2</span><span class="keyword">:&nbsp; </span><span class="default">$newimg</span><span class="keyword">=</span><span class="default">imagecreatefromjpeg</span><span class="keyword">(</span><span class="default">$file</span><span class="keyword">); break;<br />
&nbsp;&nbsp;&nbsp; case </span><span class="default">3</span><span class="keyword">:&nbsp; </span><span class="default">$newimg</span><span class="keyword">=</span><span class="default">imagecreatefrompng</span><span class="keyword">(</span><span class="default">$file</span><span class="keyword">); break;<br />
&nbsp;&nbsp;&nbsp; default: echo </span><span class="string">"Unkown filetype (file </span><span class="default">$file</span><span class="string">, typ </span><span class="default">$otype</span><span class="string">)"</span><span class="keyword">; return;<br />
&nbsp; }<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp; if(</span><span class="default">$newimg</span><span class="keyword">) {<br />
&nbsp;&nbsp;&nbsp; if(</span><span class="default">$owdt</span><span class="keyword">&gt;</span><span class="default">1500 </span><span class="keyword">|| </span><span class="default">$ohgt</span><span class="keyword">&gt;</span><span class="default">1200</span><span class="keyword">)<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; list(</span><span class="default">$owdt</span><span class="keyword">, </span><span class="default">$ohgt</span><span class="keyword">) = </span><span class="default">Resample</span><span class="keyword">(</span><span class="default">$newimg</span><span class="keyword">, </span><span class="default">$owdt</span><span class="keyword">, </span><span class="default">$ohgt</span><span class="keyword">, </span><span class="default">1024</span><span class="keyword">,</span><span class="default">768</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; </span><span class="default">Resample</span><span class="keyword">(</span><span class="default">$newimg</span><span class="keyword">, </span><span class="default">$owdt</span><span class="keyword">, </span><span class="default">$ohgt</span><span class="keyword">, </span><span class="default">$maxwdt</span><span class="keyword">, </span><span class="default">$maxhgt</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if(!</span><span class="default">$dest</span><span class="keyword">) return </span><span class="default">$newimg</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if(!</span><span class="default">is_dir</span><span class="keyword">(</span><span class="default">dirname</span><span class="keyword">(</span><span class="default">$dest</span><span class="keyword">)))<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">mkdir</span><span class="keyword">(</span><span class="default">dirname</span><span class="keyword">(</span><span class="default">$dest</span><span class="keyword">));<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; switch(</span><span class="default">$otype</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp;&nbsp; case </span><span class="default">1</span><span class="keyword">: </span><span class="default">imagegif</span><span class="keyword">(</span><span class="default">$newimg</span><span class="keyword">,</span><span class="default">dest</span><span class="keyword">); break;&nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp;&nbsp; case </span><span class="default">2</span><span class="keyword">: </span><span class="default">imagejpeg</span><span class="keyword">(</span><span class="default">$newimg</span><span class="keyword">,</span><span class="default">$dest</span><span class="keyword">,</span><span class="default">90</span><span class="keyword">); break; <br />
&nbsp;&nbsp; &nbsp;&nbsp; case </span><span class="default">3</span><span class="keyword">: </span><span class="default">imagepng</span><span class="keyword">(</span><span class="default">$newimg</span><span class="keyword">,</span><span class="default">$dest</span><span class="keyword">);&nbsp; break; <br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">imagedestroy</span><span class="keyword">(</span><span class="default">$newimg</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; </span><span class="default">chmod</span><span class="keyword">(</span><span class="default">$dest</span><span class="keyword">,</span><span class="default">0644</span><span class="keyword">);<br />
&nbsp; }<br />
}<br />
<br />
function </span><span class="default">Resample</span><span class="keyword">(&amp;</span><span class="default">$img</span><span class="keyword">, </span><span class="default">$owdt</span><span class="keyword">, </span><span class="default">$ohgt</span><span class="keyword">, </span><span class="default">$maxwdt</span><span class="keyword">, </span><span class="default">$maxhgt</span><span class="keyword">, </span><span class="default">$quality</span><span class="keyword">=</span><span class="default">1</span><span class="keyword">) { <br />
&nbsp; if(!</span><span class="default">$maxwdt</span><span class="keyword">) </span><span class="default">$divwdt</span><span class="keyword">=</span><span class="default">0</span><span class="keyword">;<br />
&nbsp;&nbsp; else </span><span class="default">$divwdt</span><span class="keyword">=</span><span class="default">Max</span><span class="keyword">(</span><span class="default">1</span><span class="keyword">,</span><span class="default">$owdt</span><span class="keyword">/</span><span class="default">$maxwdt</span><span class="keyword">);<br />
&nbsp;&nbsp; <br />
&nbsp; if(!</span><span class="default">$maxhgt</span><span class="keyword">) </span><span class="default">$divhgt</span><span class="keyword">=</span><span class="default">0</span><span class="keyword">;<br />
&nbsp;&nbsp; else </span><span class="default">$divhgt</span><span class="keyword">=</span><span class="default">Max</span><span class="keyword">(</span><span class="default">1</span><span class="keyword">,</span><span class="default">$ohgt</span><span class="keyword">/</span><span class="default">$maxhgt</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp; if(</span><span class="default">$divwdt</span><span class="keyword">&gt;=</span><span class="default">$divhgt</span><span class="keyword">) {<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$newwdt</span><span class="keyword">=</span><span class="default">$maxwdt</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$newhgt</span><span class="keyword">=</span><span class="default">round</span><span class="keyword">(</span><span class="default">$ohgt</span><span class="keyword">/</span><span class="default">$divwdt</span><span class="keyword">);<br />
&nbsp; } else {<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$newhgt</span><span class="keyword">=</span><span class="default">$maxhgt</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$newwdt</span><span class="keyword">=</span><span class="default">round</span><span class="keyword">(</span><span class="default">$owdt</span><span class="keyword">/</span><span class="default">$divhgt</span><span class="keyword">);<br />
&nbsp; }<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$tn</span><span class="keyword">=</span><span class="default">imagecreatetruecolor</span><span class="keyword">(</span><span class="default">$newwdt</span><span class="keyword">,</span><span class="default">$newhgt</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; if(</span><span class="default">$quality</span><span class="keyword">)<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">imagecopyresampled</span><span class="keyword">(</span><span class="default">$tn</span><span class="keyword">,</span><span class="default">$img</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">,</span><span class="default">$newwdt</span><span class="keyword">,</span><span class="default">$newhgt</span><span class="keyword">,</span><span class="default">$owdt</span><span class="keyword">,</span><span class="default">$ohgt</span><span class="keyword">);&nbsp; &nbsp; &nbsp; &nbsp; <br />
&nbsp;&nbsp;&nbsp; else <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">imagecopyresized</span><span class="keyword">(</span><span class="default">$tn</span><span class="keyword">,</span><span class="default">$img</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">,</span><span class="default">$newwdt</span><span class="keyword">,</span><span class="default">$newhgt</span><span class="keyword">,</span><span class="default">$owdt</span><span class="keyword">,</span><span class="default">$ohgt</span><span class="keyword">);<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">imagedestroy</span><span class="keyword">(</span><span class="default">$img</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$img </span><span class="keyword">= </span><span class="default">$tn</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; return array(</span><span class="default">$newwdt</span><span class="keyword">, </span><span class="default">$newhgt</span><span class="keyword">);<br />
}<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="62763""></a>
  <div class="note">
   <strong class="user">mracek at xko dot cz</strong>
   <a href="#62763" class="date">09-Mar-2006 09:01</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Here is function which:<br />
- resize and crop (crop format 4:3 or 1:1)<br />
- methode resample/resize<br />
- open jpg, gif, bmp, png<br />
- save jpg (85%), gif, bmp, png<br />
- show images<br />
<br />
$FILE_MIMES = array(<br />
'image/pjpeg'=&gt;"jpg",<br />
'image/jpeg'=&gt;"jpg",<br />
'image/jpg'=&gt;"jpg",<br />
'image/png'=&gt;"png",<br />
'image/x-png'=&gt;"png",<br />
'image/gif'=&gt;"gif",<br />
'image/bmp'=&gt;"bmp");<br />
$FILE_EXTS&nbsp; = array('.jpeg','.jpg','.png','.gif','.bmp');<br />
$MAX_SIZE&nbsp; = 16777216;<br />
<br />
$lng=array(<br />
's_imgDimension'=&gt;array(<br />
&nbsp;&nbsp; &nbsp; &nbsp; "80",<br />
&nbsp;&nbsp; &nbsp; &nbsp; "320"<br />
&nbsp;&nbsp; &nbsp; &nbsp; ),<br />
's_imgCrop'&nbsp; &nbsp; =&gt;array(<br />
&nbsp;&nbsp; &nbsp; &nbsp; "- auto -",<br />
&nbsp;&nbsp; &nbsp; &nbsp; "na sirku",<br />
&nbsp;&nbsp; &nbsp; &nbsp; "na vysku",<br />
&nbsp;&nbsp; &nbsp; &nbsp; "ctverec",<br />
&nbsp;&nbsp; &nbsp; &nbsp; "- zadne -"<br />
&nbsp;&nbsp; &nbsp; &nbsp; ),<br />
's_imgFormat'&nbsp; &nbsp; =&gt;array(<br />
&nbsp;&nbsp; &nbsp; &nbsp; "4/3",<br />
&nbsp;&nbsp; &nbsp; &nbsp; "1/1"<br />
&nbsp;&nbsp; &nbsp; &nbsp; ),<br />
's_imgType'&nbsp; &nbsp; =&gt;array(<br />
&nbsp;&nbsp; &nbsp; &nbsp; "jpg",<br />
&nbsp;&nbsp; &nbsp; &nbsp; "png",<br />
&nbsp;&nbsp; &nbsp; &nbsp; "gif",<br />
&nbsp;&nbsp; &nbsp; &nbsp; "bmp"<br />
&nbsp;&nbsp; &nbsp; &nbsp; ),<br />
's_imgMethode'&nbsp; &nbsp; =&gt;array(<br />
&nbsp;&nbsp; &nbsp; &nbsp; "resample",<br />
&nbsp;&nbsp; &nbsp; &nbsp; "resize"<br />
&nbsp;&nbsp; &nbsp; &nbsp; )<br />
);<br />
<br />
function PPimageTransform($photo1,$type1,$dim,$crop,<br />
$format,$methode,$photo2,$type2)<br />
{<br />
if ($photo1!=="" &amp;&amp; File_Exists($photo1))<br />
{<br />
&nbsp;&nbsp; if (!($crop&gt;0 &amp;&amp; $crop&lt;5)) $crop=0;<br />
&nbsp;&nbsp; width=x"<br />
&nbsp;&nbsp; list($w,$h) = GetImageSize($photo1);<br />
&nbsp;&nbsp; $w=($w&lt;1)?1:$w;<br />
&nbsp;&nbsp; $h=($h&lt;1)?1:$h;<br />
&nbsp;&nbsp; $wh=$w/$h;<br />
<br />
&nbsp;&nbsp; // format<br />
&nbsp;&nbsp; $format=($format=='4/3')?4/3:1;<br />
<br />
&nbsp;&nbsp; // auto crop<br />
&nbsp;&nbsp; if ($crop==0)<br />
&nbsp;&nbsp; &nbsp; &nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; $z1=$format-&nbsp; ($format-1)/2;<br />
&nbsp;&nbsp; &nbsp; &nbsp; $z2=$format+(1-$format-1)/2;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if ($wh&gt;$z1) {$crop=1;}<br />
&nbsp;&nbsp; &nbsp; &nbsp; elseif ($wh&lt;$z2) {$crop=2;}<br />
&nbsp;&nbsp; &nbsp; &nbsp; else&nbsp; &nbsp; &nbsp; &nbsp; {$crop=3;}<br />
&nbsp;&nbsp; &nbsp; &nbsp; }<br />
<br />
&nbsp;&nbsp; // scale<br />
&nbsp;&nbsp; if ($crop==4)<br />
&nbsp;&nbsp; &nbsp; &nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; $a=$w&gt;$h?$w:$h;<br />
&nbsp;&nbsp; &nbsp; &nbsp; $scale=$dim/$a;<br />
&nbsp;&nbsp; &nbsp; &nbsp; $nw=$w*$scale;$nw=($nw&lt;1)?1:$nw;<br />
&nbsp;&nbsp; &nbsp; &nbsp; $nh=$h*$scale;$nh=($nh&lt;1)?1:$nh;<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp; $d=array(0,0,floor($nw),floor($nh));<br />
&nbsp;&nbsp; &nbsp; &nbsp; $s=array(0,0,$w,$h);<br />
&nbsp;&nbsp; &nbsp; &nbsp; }<br />
&nbsp;&nbsp; else<br />
&nbsp;&nbsp; &nbsp; &nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if ($crop==3) {$nw=1;$nh=1;}<br />
&nbsp;&nbsp; &nbsp; &nbsp; elseif ($crop==2) {$nw=1/$format;$nh=1;}<br />
&nbsp;&nbsp; &nbsp; &nbsp; elseif ($crop==1) {$nw=1;$nh=1/$format;}<br />
&nbsp;&nbsp; &nbsp; &nbsp; $nw*=$dim;$nw=($nw&lt;1)?1:$nw;<br />
&nbsp;&nbsp; &nbsp; &nbsp; $nh*=$dim;$nh=($nh&lt;1)?1:$nh;<br />
&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; $s1=$nw/$w;<br />
&nbsp;&nbsp; &nbsp; &nbsp; $s2=$nh/$h;<br />
&nbsp;&nbsp; &nbsp; &nbsp; $h1=$nh*$s1;<br />
&nbsp;&nbsp; &nbsp; &nbsp; $w2=$nw*$s2;<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp; $s1=($h1&lt;=$nh)?$s1:0;<br />
&nbsp;&nbsp; &nbsp; &nbsp; $s2=($w2&lt;=$nw)?$s2:0;<br />
&nbsp;&nbsp; &nbsp; &nbsp; $scale=($s1&gt;$s2)?$s1:$s2;<br />
&nbsp;&nbsp; &nbsp; &nbsp; $scale=($scale&lt;=0)?1:$scale;<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp; $d=array(0,0,floor($nw),floor($nh));<br />
&nbsp;&nbsp; &nbsp; &nbsp; $x1=floor(($w-$d[2]/$scale)/2);$x1=$x1&lt;0?0:$x1;<br />
&nbsp;&nbsp; &nbsp; &nbsp; $y1=floor(($h-$d[3]/$scale)/2);$y1=$y1&lt;0?0:$y1;<br />
&nbsp;&nbsp; &nbsp; &nbsp; $s=array($x1,$y1,floor($w-2*$x1),floor($h-2*$y1));<br />
&nbsp;&nbsp; &nbsp; &nbsp; }<br />
<br />
&nbsp;&nbsp; // input/output<br />
&nbsp;&nbsp; switch($type1)<br />
&nbsp;&nbsp; &nbsp; &nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; case 'jpg': $imgIn = ImageCreateFromJPEG; break;<br />
&nbsp;&nbsp; &nbsp; &nbsp; case 'png': $imgIn = ImageCreateFromPNG;&nbsp; break;<br />
&nbsp;&nbsp; &nbsp; &nbsp; case 'gif': $imgIn = ImageCreateFromGIF;&nbsp; break;<br />
&nbsp;&nbsp; &nbsp; &nbsp; case 'bmp': $imgIn = ImageCreateFromWBMP; break;<br />
&nbsp;&nbsp; &nbsp; &nbsp; default: return FALSE; break;<br />
&nbsp;&nbsp; &nbsp; &nbsp; }<br />
&nbsp;&nbsp; switch($type2)<br />
&nbsp;&nbsp; &nbsp; &nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; case 'jpg': $imgOut = ImageJPEG; break;<br />
&nbsp;&nbsp; &nbsp; &nbsp; case 'png': $imgOut = ImagePNG;&nbsp; break;<br />
&nbsp;&nbsp; &nbsp; &nbsp; case 'gif': $imgOut = ImageGIF;&nbsp; break;<br />
&nbsp;&nbsp; &nbsp; &nbsp; case 'bmp': $imgOut = ImageWBMP; break;<br />
&nbsp;&nbsp; &nbsp; &nbsp; default: return FALSE; break;<br />
&nbsp;&nbsp; &nbsp; &nbsp; }<br />
<br />
&nbsp;&nbsp; // resample (d-destination, s-source)<br />
&nbsp;&nbsp; $image1 = $imgIn($photo1);<br />
&nbsp;&nbsp; if ($methode==0)<br />
&nbsp;&nbsp; &nbsp; &nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; $image2 = ImageCreateTruecolor($d[2],$d[3]);<br />
&nbsp;&nbsp; &nbsp; &nbsp; ImageCopyResampled($image2, $image1,<br />
&nbsp;$d[0],$d[1], $s[0],$s[1], $d[2],$d[3], $s[2],$s[3]);<br />
&nbsp;&nbsp; &nbsp; &nbsp; }<br />
&nbsp;&nbsp; else&nbsp; &nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; $image2 = ImageCreate($d[2],$d[3]);<br />
&nbsp;&nbsp; &nbsp; &nbsp; ImageCopyResized($image2, $image1,<br />
$d[0],$d[1], $s[0],$s[1], $d[2],$d[3], $s[2],$s[3]);<br />
&nbsp;&nbsp; &nbsp; &nbsp; }<br />
<br />
&nbsp;&nbsp; // output<br />
&nbsp;&nbsp; if ($type2=='jpg')<br />
&nbsp;&nbsp; &nbsp; &nbsp; {$imgOut($image2,$photo2,85);}<br />
&nbsp;&nbsp; else&nbsp; &nbsp; {$imgOut($image2,$photo2);}<br />
&nbsp;&nbsp; ImageDestroy($image2);<br />
&nbsp;&nbsp; ImageDestroy($image1);<br />
&nbsp;&nbsp; }<br />
}</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="62692""></a>
  <div class="note">
   <strong class="user">dmitry at dest dot by</strong>
   <a href="#62692" class="date">07-Mar-2006 03:03</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Simple script on change of width and automatic creation of height, and also creation of the signature in the right we string to a corner. (Only for Jpg)<br />
<br />
function easyResize($img_sourse, $save_to, $quality, $width, $str) { <br />
$size = GetImageSize($img_sourse);<br />
&nbsp;&nbsp;&nbsp; $im_in = ImageCreateFromJPEG($img_sourse);<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; $new_height = ($width * $size[1]) / $size[0]; // Generate new height for image<br />
&nbsp;&nbsp;&nbsp; $im_out = imagecreatetruecolor($width, $new_height);<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; ImageCopyResampled($im_out, $im_in, 0, 0, 0, 0, $width, $new_height, $size[0], $size[1]);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; #Find X &amp; Y for note<br />
&nbsp;&nbsp;&nbsp; $X_var = ImageSX($im_out); <br />
&nbsp;&nbsp;&nbsp; $X_var = $X_var - 130;<br />
&nbsp;&nbsp;&nbsp; $Y_var = ImageSY($im_out); <br />
&nbsp;&nbsp;&nbsp; $Y_var = $Y_var - 25;<br />
<br />
&nbsp;&nbsp;&nbsp; #Color<br />
&nbsp;&nbsp;&nbsp; $white = ImageColorAllocate($im_out, 0, 0, 0);<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; #Add note(simple: site address)<br />
&nbsp;&nbsp;&nbsp; ImageString($im_out,2,$X_var,$Y_var,$str,$white);<br />
<br />
&nbsp;&nbsp;&nbsp; ImageJPEG($im_out, $save_to, $quality); // Create image<br />
&nbsp;&nbsp;&nbsp; ImageDestroy($im_in);<br />
&nbsp;&nbsp;&nbsp; ImageDestroy($im_out);<br />
}<br />
<br />
// $str -&nbsp; Inscription on the image;</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="61251""></a>
  <div class="note">
   <strong class="user">areddan at silverarm dot ie</strong>
   <a href="#61251" class="date">29-Jan-2006 03:30</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
$file =$_FILES[userfile];<br />
//name of the input form file upload element is userfile<br />
<br />
//$to_file is a full path including filename <br />
//to where you want the thumnail to be copied to .<br />
//example /usr/www/users/www/images/thumbs/thumb1.jpg<br />
<br />
copy($file[tmp_name],$to_file) or die("The file $file[tmp_name] you are trying to upload couldn't be copied to $to_file");<br />
<br />
//Extra stuff to put into the output to allow for jpeg / png or gif<br />
<br />
//replace line: imagegif($thumb2, $fileout); //write to file with the following<br />
<br />
switch($format)<br />
&nbsp;&nbsp; &nbsp; &nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; case 'image/jpeg':<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; imagejpeg($thumb2, $fileout,90); //write to file<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; break;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; case 'image/gif';<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; imagegif($thumb2, $fileout); //write to file<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; break;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; case 'image/png':<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; imagepng($thumb2, $fileout); //write to file<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; break;<br />
&nbsp;&nbsp; &nbsp; &nbsp; }</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="61169""></a>
  <div class="note">
   <strong class="user">areddan at silverarm dot ie</strong>
   <a href="#61169" class="date">27-Jan-2006 09:40</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
<span class="default">&lt;?php<br />
</span><span class="comment">// The file<br />
</span><span class="default">$filein </span><span class="keyword">= </span><span class="string">''</span><span class="keyword">; </span><span class="comment">// File in<br />
</span><span class="default">$fileout </span><span class="keyword">= </span><span class="string">'ttt.gif'</span><span class="keyword">; </span><span class="comment">// Fileout - optional <br />
<br />
</span><span class="default">$imagethumbsize_w </span><span class="keyword">= </span><span class="default">100</span><span class="keyword">; </span><span class="comment">// thumbnail size (area cropped in middle of image)<br />
</span><span class="default">$imagethumbsize_h </span><span class="keyword">= </span><span class="default">75</span><span class="keyword">; </span><span class="comment">// thumbnail size (area cropped in middle of image)<br />
</span><span class="default">resize_then_crop</span><span class="keyword">( </span><span class="default">$filein</span><span class="keyword">,</span><span class="default">$fileout</span><span class="keyword">,</span><span class="default">$imagethumbsize_w</span><span class="keyword">,<br />
</span><span class="default">$imagethumbsize_h</span><span class="keyword">,</span><span class="comment">/*rgb*/</span><span class="string">"255"</span><span class="keyword">,</span><span class="string">"255"</span><span class="keyword">,</span><span class="string">"255"</span><span class="keyword">);<br />
<br />
</span><span class="comment">//Author Alan Reddan Silverarm Solutions<br />
//Date 27/01/2005<br />
//Function that works well with images.<br />
//It takes the image and reduces its size to best fit. i.e If you have an image<br />
//that is 200 X 100 and you want a thumbnail of 75 X 50,<br />
//it first resizes the image to 100 X 50<br />
//and then takes out a portion 75 X 50 from then center of the input image.<br />
//So loads of image information is retained.<br />
//The corollary also holds if your input image is 100 X 200<br />
//it first resizes image to 75 X 150 and then takes out a<br />
//portion 75 X 75 from the centre<br />
// The advantage here is that function decides on whether<br />
//resize is by width or height itself.<br />
//it also decides whether to use the height or the width as the base start point<br />
//in the case that athumbnail is rectangular<br />
<br />
</span><span class="keyword">function </span><span class="default">resize_then_crop</span><span class="keyword">( </span><span class="default">$filein</span><span class="keyword">,</span><span class="default">$fileout</span><span class="keyword">,<br />
</span><span class="default">$imagethumbsize_w</span><span class="keyword">,</span><span class="default">$imagethumbsize_h</span><span class="keyword">,</span><span class="default">$red</span><span class="keyword">,</span><span class="default">$green</span><span class="keyword">,</span><span class="default">$blue</span><span class="keyword">)<br />
{<br />
<br />
</span><span class="comment">// Get new dimensions<br />
</span><span class="keyword">list(</span><span class="default">$width</span><span class="keyword">, </span><span class="default">$height</span><span class="keyword">) = </span><span class="default">getimagesize</span><span class="keyword">(</span><span class="default">$filein</span><span class="keyword">);<br />
</span><span class="default">$new_width </span><span class="keyword">= </span><span class="default">$width </span><span class="keyword">* </span><span class="default">$percent</span><span class="keyword">;<br />
</span><span class="default">$new_height </span><span class="keyword">= </span><span class="default">$height </span><span class="keyword">* </span><span class="default">$percent</span><span class="keyword">;<br />
<br />
&nbsp;&nbsp; if(</span><span class="default">preg_match</span><span class="keyword">(</span><span class="string">"/.jpg/i"</span><span class="keyword">, </span><span class="string">"</span><span class="default">$filein</span><span class="string">"</span><span class="keyword">))<br />
&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; </span><span class="default">$format </span><span class="keyword">= </span><span class="string">'image/jpeg'</span><span class="keyword">;<br />
&nbsp;&nbsp; }<br />
&nbsp;&nbsp; if (</span><span class="default">preg_match</span><span class="keyword">(</span><span class="string">"/.gif/i"</span><span class="keyword">, </span><span class="string">"</span><span class="default">$filein</span><span class="string">"</span><span class="keyword">))<br />
&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; </span><span class="default">$format </span><span class="keyword">= </span><span class="string">'image/gif'</span><span class="keyword">;<br />
&nbsp;&nbsp; }<br />
&nbsp;&nbsp; if(</span><span class="default">preg_match</span><span class="keyword">(</span><span class="string">"/.png/i"</span><span class="keyword">, </span><span class="string">"</span><span class="default">$filein</span><span class="string">"</span><span class="keyword">))<br />
&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; </span><span class="default">$format </span><span class="keyword">= </span><span class="string">'image/png'</span><span class="keyword">;<br />
&nbsp;&nbsp; }<br />
&nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; switch(</span><span class="default">$format</span><span class="keyword">)<br />
&nbsp;&nbsp; &nbsp; &nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; case </span><span class="string">'image/jpeg'</span><span class="keyword">:<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$image </span><span class="keyword">= </span><span class="default">imagecreatefromjpeg</span><span class="keyword">(</span><span class="default">$filein</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; break;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; case </span><span class="string">'image/gif'</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$image </span><span class="keyword">= </span><span class="default">imagecreatefromgif</span><span class="keyword">(</span><span class="default">$filein</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; break;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; case </span><span class="string">'image/png'</span><span class="keyword">:<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$image </span><span class="keyword">= </span><span class="default">imagecreatefrompng</span><span class="keyword">(</span><span class="default">$filein</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; break;<br />
&nbsp;&nbsp; &nbsp; &nbsp; }<br />
<br />
</span><span class="default">$width </span><span class="keyword">= </span><span class="default">$imagethumbsize_w </span><span class="keyword">;<br />
</span><span class="default">$height </span><span class="keyword">= </span><span class="default">$imagethumbsize_h </span><span class="keyword">;<br />
list(</span><span class="default">$width_orig</span><span class="keyword">, </span><span class="default">$height_orig</span><span class="keyword">) = </span><span class="default">getimagesize</span><span class="keyword">(</span><span class="default">$filein</span><span class="keyword">);<br />
<br />
if (</span><span class="default">$width_orig </span><span class="keyword">&lt; </span><span class="default">$height_orig</span><span class="keyword">) {<br />
&nbsp; </span><span class="default">$height </span><span class="keyword">= (</span><span class="default">$imagethumbsize_w </span><span class="keyword">/ </span><span class="default">$width_orig</span><span class="keyword">) * </span><span class="default">$height_orig</span><span class="keyword">;<br />
} else {<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$width </span><span class="keyword">= (</span><span class="default">$imagethumbsize_h </span><span class="keyword">/ </span><span class="default">$height_orig</span><span class="keyword">) * </span><span class="default">$width_orig</span><span class="keyword">;<br />
}<br />
<br />
if (</span><span class="default">$width </span><span class="keyword">&lt; </span><span class="default">$imagethumbsize_w</span><span class="keyword">)<br />
</span><span class="comment">//if the width is smaller than supplied thumbnail size <br />
</span><span class="keyword">{<br />
</span><span class="default">$width </span><span class="keyword">= </span><span class="default">$imagethumbsize_w</span><span class="keyword">;<br />
</span><span class="default">$height </span><span class="keyword">= (</span><span class="default">$imagethumbsize_w</span><span class="keyword">/ </span><span class="default">$width_orig</span><span class="keyword">) * </span><span class="default">$height_orig</span><span class="keyword">;;<br />
}<br />
<br />
if (</span><span class="default">$height </span><span class="keyword">&lt; </span><span class="default">$imagethumbsize_h</span><span class="keyword">)<br />
</span><span class="comment">//if the height is smaller than supplied thumbnail size <br />
</span><span class="keyword">{<br />
</span><span class="default">$height </span><span class="keyword">= </span><span class="default">$imagethumbsize_h</span><span class="keyword">;<br />
</span><span class="default">$width </span><span class="keyword">= (</span><span class="default">$imagethumbsize_h </span><span class="keyword">/ </span><span class="default">$height_orig</span><span class="keyword">) * </span><span class="default">$width_orig</span><span class="keyword">;<br />
}<br />
<br />
</span><span class="default">$thumb </span><span class="keyword">= </span><span class="default">imagecreatetruecolor</span><span class="keyword">(</span><span class="default">$width </span><span class="keyword">, </span><span class="default">$height</span><span class="keyword">);&nbsp; <br />
</span><span class="default">$bgcolor </span><span class="keyword">= </span><span class="default">imagecolorallocate</span><span class="keyword">(</span><span class="default">$thumb</span><span class="keyword">, </span><span class="default">$red</span><span class="keyword">, </span><span class="default">$green</span><span class="keyword">, </span><span class="default">$blue</span><span class="keyword">);&nbsp;&nbsp; <br />
</span><span class="default">ImageFilledRectangle</span><span class="keyword">(</span><span class="default">$thumb</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">$width</span><span class="keyword">, </span><span class="default">$height</span><span class="keyword">, </span><span class="default">$bgcolor</span><span class="keyword">);<br />
</span><span class="default">imagealphablending</span><span class="keyword">(</span><span class="default">$thumb</span><span class="keyword">, </span><span class="default">true</span><span class="keyword">);<br />
<br />
</span><span class="default">imagecopyresampled</span><span class="keyword">(</span><span class="default">$thumb</span><span class="keyword">, </span><span class="default">$image</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">,<br />
</span><span class="default">$width</span><span class="keyword">, </span><span class="default">$height</span><span class="keyword">, </span><span class="default">$width_orig</span><span class="keyword">, </span><span class="default">$height_orig</span><span class="keyword">);<br />
</span><span class="default">$thumb2 </span><span class="keyword">= </span><span class="default">imagecreatetruecolor</span><span class="keyword">(</span><span class="default">$imagethumbsize_w </span><span class="keyword">, </span><span class="default">$imagethumbsize_h</span><span class="keyword">);<br />
</span><span class="comment">// true color for best quality<br />
</span><span class="default">$bgcolor </span><span class="keyword">= </span><span class="default">imagecolorallocate</span><span class="keyword">(</span><span class="default">$thumb2</span><span class="keyword">, </span><span class="default">$red</span><span class="keyword">, </span><span class="default">$green</span><span class="keyword">, </span><span class="default">$blue</span><span class="keyword">);&nbsp;&nbsp; <br />
</span><span class="default">ImageFilledRectangle</span><span class="keyword">(</span><span class="default">$thumb2</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">,<br />
</span><span class="default">$imagethumbsize_w </span><span class="keyword">, </span><span class="default">$imagethumbsize_h </span><span class="keyword">, </span><span class="default">$white</span><span class="keyword">);<br />
</span><span class="default">imagealphablending</span><span class="keyword">(</span><span class="default">$thumb2</span><span class="keyword">, </span><span class="default">true</span><span class="keyword">);<br />
<br />
</span><span class="default">$w1 </span><span class="keyword">=(</span><span class="default">$width</span><span class="keyword">/</span><span class="default">2</span><span class="keyword">) - (</span><span class="default">$imagethumbsize_w</span><span class="keyword">/</span><span class="default">2</span><span class="keyword">);<br />
</span><span class="default">$h1 </span><span class="keyword">= (</span><span class="default">$height</span><span class="keyword">/</span><span class="default">2</span><span class="keyword">) - (</span><span class="default">$imagethumbsize_h</span><span class="keyword">/</span><span class="default">2</span><span class="keyword">);<br />
<br />
</span><span class="default">imagecopyresampled</span><span class="keyword">(</span><span class="default">$thumb2</span><span class="keyword">, </span><span class="default">$thumb</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">, </span><span class="default">$w1</span><span class="keyword">, </span><span class="default">$h1</span><span class="keyword">,<br />
</span><span class="default">$imagethumbsize_w </span><span class="keyword">, </span><span class="default">$imagethumbsize_h </span><span class="keyword">,</span><span class="default">$imagethumbsize_w</span><span class="keyword">, </span><span class="default">$imagethumbsize_h</span><span class="keyword">);<br />
<br />
</span><span class="comment">// Output<br />
//header('Content-type: image/gif');<br />
//imagegif($thumb); //output to browser first image when testing<br />
<br />
</span><span class="keyword">if (</span><span class="default">$fileout </span><span class="keyword">!=</span><span class="string">""</span><span class="keyword">)</span><span class="default">imagegif</span><span class="keyword">(</span><span class="default">$thumb2</span><span class="keyword">, </span><span class="default">$fileout</span><span class="keyword">); </span><span class="comment">//write to file<br />
</span><span class="default">header</span><span class="keyword">(</span><span class="string">'Content-type: image/gif'</span><span class="keyword">);<br />
</span><span class="default">imagegif</span><span class="keyword">(</span><span class="default">$thumb2</span><span class="keyword">); </span><span class="comment">//output to browser<br />
</span><span class="keyword">}<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="60472""></a>
  <div class="note">
   <strong class="user">com.hotmail@backglancer</strong>
   <a href="#60472" class="date">08-Jan-2006 07:32</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
wrote this for a game I was helping develop:<br />
<br />
Auto Tile Maker -- takes the image and cuts it in several smaller pieces, deleting the original... i mean.. this is just for those of you who are lazy, coz the script is simple..<br />
modify at will.<br />
<br />
&lt;?<br />
// $newfile is the full address of your newly uploaded file<br />
// $floc = is the location of that file ending with /<br />
// $t is the $_FILES['blah'] of your uploaded file.<br />
// whatever... you guys understand enough to modify this code<br />
<br />
$size = getimagesize($newfile);<br />
list($w, $h) = $size;<br />
<br />
if ($h &gt; 20 || $w &gt; 20) {<br />
&nbsp;&nbsp;&nbsp; $type = array_pop($size);<br />
&nbsp;&nbsp;&nbsp; switch ($type) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; case 'image/jpeg' : $src_image = imagecreatefromjpeg($newfile); break;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; // insert more cases here :) i'm lazy too<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; default : echo 'not an image!'; return;<br />
&nbsp;&nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp;&nbsp; $i = 0;<br />
&nbsp;&nbsp;&nbsp; for ($y = 0; $y &lt; $h; $y += 20) {<br />
&nbsp;&nbsp;&nbsp; for ($x = 0; $x &lt; $w; $x += 20) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $i++; // new file names will be like 1monkey.gif 2monkey.gif etc..<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $new_image = imagecreatetruecolor(20, 20);<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; imagecopyresampled ($new_image, $src_image,<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; 0, 0,<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $x, $y,<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; 20, 20,<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; 20, 20<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; );<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; imagegif($new_image, $floc.$i.$t['name']);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; imagedestroy($new_image);<br />
<br />
&nbsp;&nbsp;&nbsp; } // x<br />
&nbsp;&nbsp;&nbsp; } // y<br />
&nbsp;&nbsp;&nbsp; unlink($newfile);<br />
}<br />
?&gt;</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="59426""></a>
  <div class="note">
   <strong class="user">smrtak at 4um dot cz</strong>
   <a href="#59426" class="date">06-Dec-2005 08:48</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
class cobrazek <br />
&nbsp;&nbsp;&nbsp; { <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; function resizeMaxJpeg($file,$mx,$my,$q=85) <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; { <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $dst = cobrazek::resizeMax(imagecreatefromjpeg($file),$mx,$my); <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if(!$dst) <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return false; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if(!imagejpeg($dst,$file,$q)) <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return false; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return true; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; } <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; function resizeMax($src,$mx,$my) <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; { <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; //zjisti velikost <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $sx = imagesx($src); <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $sy = imagesy($src); <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; //spocitej cilovou velikost <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $v = min(min($mx,$sx)/$sx,min($my,$sy)/$sy); <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $dx = $v*$sx; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $dy = $v*$sy; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $dst = imagecreatetruecolor($dx,$dy); <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; //resample <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; imagecopyresampled ($dst,$src,0,0,0,0,$dx,$dy,$sx,$sy); <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; //vystup <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return $dst; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; } <br />
&nbsp;&nbsp;&nbsp; }</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="58745""></a>
  <div class="note">
   <strong class="user">pike-php at kw dot nl</strong>
   <a href="#58745" class="date">14-Nov-2005 11:21</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If you have a bug that imagecopyresampled is completely ignoring srcX and srcY (a known and closed bug - <a href="http://bugs.php.net/bug.php?id=12780" rel="nofollow" target="_blank">http://bugs.php.net/bug.php?id=12780</a>)&nbsp; you can ofcourse apply two operations to do the same. E.g., instead of saying<br />
<br />
ImageCopyResampled($dst_img, $src_img, 0, 0, $srcX, $srcY, $dstW, $dstH, $srcW, $srcH);<br />
<br />
you can say<br />
<br />
ImageCopyResampled($tmp_img, $src_img, -$srcX, -$srcY, "BUG","BUG", $orgW, $orgH, $orgW, $orgH);<br />
ImageCopyResampled($dst_img, $tmp_img, 0, 0, "BUG","BUG", $dstW, $dstH, $srcW, $srcH);<br />
<br />
which has the same effect but is twice as slow and blurry. you may replace "BUG","BUG" with anything you like without sideeffects :)<br />
<br />
$2c,<br />
*pike</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="58545""></a>
  <div class="note">
   <strong class="user">George_A</strong>
   <a href="#58545" class="date">07-Nov-2005 11:49</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
For the best image quality...<br />
How to get new proportional size of the image if the desible size of source image is approximatly equal to needed size. If needed size differs from source size on less than the user factor then transformation isn`t apply.<br />
<br />
/**********************************************/<br />
function imageCopyResize($image, $xSize, $ySize, $needed_user_factor, $new_image_path = "")<br />
{<br />
&nbsp;//example: neded_user_factor = 0.2<br />
&nbsp;if($xSize == 0 || $ySize == 0)<br />
&nbsp;&nbsp;&nbsp; return array("At the leat one pair of size is 0",0,0);<br />
<br />
&nbsp;$size = getImageSize($image);<br />
&nbsp;$width = $size[0];<br />
&nbsp;$height = $size[1];<br />
&nbsp;$x_ratio = $xSize / $size[0]; <br />
&nbsp;$y_ratio = $ySize / $size[1]; <br />
&nbsp;if($x_ratio &gt; $y_ratio)&nbsp; &nbsp; $res_ratio = $y_ratio;<br />
&nbsp;else $res_ratio = $x_ratio;<br />
&nbsp;if(abs($res_ratio - 1) &gt; $needed_user_factor)<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; $width = ceil($width * $res_ratio);<br />
&nbsp;&nbsp; &nbsp; $height = ceil($height * $res_ratio);<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;$fileinfo = pathinfo($image);<br />
&nbsp;$file_type = strtolower($fileinfo["extension"]);<br />
&nbsp;if($file_type == "jpg" || $file_type == "jpeg")<br />
&nbsp;&nbsp;&nbsp; $src = ImageCreateFromJpeg($image);<br />
&nbsp;else if($file_type == "gif")<br />
&nbsp;&nbsp;&nbsp; $src = ImageCreateFromGif($image);<br />
&nbsp;else if($file_type == "png")<br />
&nbsp;&nbsp;&nbsp; $src = ImageCreateFromPNG($image);<br />
&nbsp;else if($file_type == "bmp")&nbsp; &nbsp; <br />
&nbsp;&nbsp;&nbsp; $src = ImageCreateFromBmp($image);&nbsp; &nbsp; //Thanks Previous Coder<br />
&nbsp;else<br />
&nbsp;&nbsp; return array("Unknown image format: ".$file_type, 0, 0);&nbsp;&nbsp; <br />
&nbsp;$output_path = ($new_image_path == "")?$image:$new_image_path;<br />
&nbsp;$dst = ImageCreateTrueColor($width, $height);<br />
&nbsp;ImageCopyResized($dst, $src, 0,0,0,0,$width, $height, $size[0], $size[1]);<br />
&nbsp;if($file_type == "jpg" || $file_type == "jpeg")<br />
&nbsp;&nbsp;&nbsp; ImageJpeg($dst, $output_path, 100);<br />
&nbsp;else if($file_type == "gif" || $file_type == "bmp")<br />
&nbsp;&nbsp; &nbsp; ImageGif($dst, $output_path);<br />
&nbsp;else if($file_type == "png")<br />
&nbsp;&nbsp;&nbsp; ImagePNG($dst, $output_path);<br />
<br />
&nbsp;ImageDestroy($src);<br />
&nbsp;ImageDestroy($dst);<br />
&nbsp;return array("", $width, $height);<br />
}<br />
/**********************************************/</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="58475""></a>
  <div class="note">
   <strong class="user">erik at phpcastle dot com</strong>
   <a href="#58475" class="date">05-Nov-2005 11:21</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I've changed the script from info at lontronics dot nl a little bit so the thumbnail is not cutted off when this is not necessary.<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="comment">// Resize function<br />
<br />
// $pictype is optional. When empty the image will not be cutted off<br />
</span><span class="keyword">function </span><span class="default">resize</span><span class="keyword">(</span><span class="default">$filename</span><span class="keyword">, </span><span class="default">$dest</span><span class="keyword">, </span><span class="default">$width</span><span class="keyword">, </span><span class="default">$height</span><span class="keyword">, </span><span class="default">$pictype </span><span class="keyword">= </span><span class="string">""</span><span class="keyword">)<br />
{<br />
&nbsp; </span><span class="default">$format </span><span class="keyword">= </span><span class="default">strtolower</span><span class="keyword">(</span><span class="default">substr</span><span class="keyword">(</span><span class="default">strrchr</span><span class="keyword">(</span><span class="default">$filename</span><span class="keyword">,</span><span class="string">"."</span><span class="keyword">),</span><span class="default">1</span><span class="keyword">));<br />
&nbsp; switch(</span><span class="default">$format</span><span class="keyword">)<br />
&nbsp; {<br />
&nbsp;&nbsp;&nbsp; case </span><span class="string">'gif' </span><span class="keyword">:<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$type </span><span class="keyword">=</span><span class="string">"gif"</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$img </span><span class="keyword">= </span><span class="default">imagecreatefromgif</span><span class="keyword">(</span><span class="default">$filename</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; break;<br />
&nbsp;&nbsp;&nbsp; case </span><span class="string">'png' </span><span class="keyword">:<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$type </span><span class="keyword">=</span><span class="string">"png"</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$img </span><span class="keyword">= </span><span class="default">imagecreatefrompng</span><span class="keyword">(</span><span class="default">$filename</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; break;<br />
&nbsp;&nbsp;&nbsp; case </span><span class="string">'jpg' </span><span class="keyword">:<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$type </span><span class="keyword">=</span><span class="string">"jpg"</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$img </span><span class="keyword">= </span><span class="default">imagecreatefromjpeg</span><span class="keyword">(</span><span class="default">$filename</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; break;<br />
&nbsp;&nbsp;&nbsp; case </span><span class="string">'jpeg' </span><span class="keyword">:<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$type </span><span class="keyword">=</span><span class="string">"jpg"</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$img </span><span class="keyword">= </span><span class="default">imagecreatefromjpeg</span><span class="keyword">(</span><span class="default">$filename</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; break;<br />
&nbsp;&nbsp;&nbsp; default :<br />
&nbsp;&nbsp;&nbsp; die (</span><span class="string">"ERROR; UNSUPPORTED IMAGE TYPE"</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; break;<br />
&nbsp; }<br />
<br />
&nbsp; list(</span><span class="default">$org_width</span><span class="keyword">, </span><span class="default">$org_height</span><span class="keyword">) = </span><span class="default">getimagesize</span><span class="keyword">(</span><span class="default">$filename</span><span class="keyword">);<br />
&nbsp; </span><span class="default">$xoffset </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">;<br />
&nbsp; </span><span class="default">$yoffset </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">;<br />
&nbsp; if (</span><span class="default">$pictype </span><span class="keyword">== </span><span class="string">"thumb"</span><span class="keyword">) </span><span class="comment">// To minimize destortion<br />
&nbsp; </span><span class="keyword">{<br />
&nbsp;&nbsp;&nbsp; if (</span><span class="default">$org_width </span><span class="keyword">/ </span><span class="default">$width </span><span class="keyword">&gt; </span><span class="default">$org_height</span><span class="keyword">/ </span><span class="default">$height</span><span class="keyword">)<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="default">$xtmp </span><span class="keyword">= </span><span class="default">$org_width</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="default">$xratio </span><span class="keyword">= </span><span class="default">1</span><span class="keyword">-(((</span><span class="default">$org_width</span><span class="keyword">/</span><span class="default">$org_height</span><span class="keyword">)-(</span><span class="default">$width</span><span class="keyword">/</span><span class="default">$height</span><span class="keyword">))/</span><span class="default">2</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="default">$org_width </span><span class="keyword">= </span><span class="default">$org_width </span><span class="keyword">* </span><span class="default">$xratio</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="default">$xoffset </span><span class="keyword">= (</span><span class="default">$xtmp </span><span class="keyword">- </span><span class="default">$org_width</span><span class="keyword">)/</span><span class="default">2</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; elseif (</span><span class="default">$org_height</span><span class="keyword">/ </span><span class="default">$height </span><span class="keyword">&gt; </span><span class="default">$org_width </span><span class="keyword">/ </span><span class="default">$width</span><span class="keyword">)<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="default">$ytmp </span><span class="keyword">= </span><span class="default">$org_height</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="default">$yratio </span><span class="keyword">= </span><span class="default">1</span><span class="keyword">-(((</span><span class="default">$width</span><span class="keyword">/</span><span class="default">$height</span><span class="keyword">)-(</span><span class="default">$org_width</span><span class="keyword">/</span><span class="default">$org_height</span><span class="keyword">))/</span><span class="default">2</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="default">$org_height </span><span class="keyword">= </span><span class="default">$org_height </span><span class="keyword">* </span><span class="default">$yratio</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="default">$yoffset </span><span class="keyword">= (</span><span class="default">$ytmp </span><span class="keyword">- </span><span class="default">$org_height</span><span class="keyword">)/</span><span class="default">2</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp; </span><span class="comment">//Added this else part -------------<br />
&nbsp; </span><span class="keyword">} else {&nbsp; &nbsp; <br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="default">$xtmp </span><span class="keyword">= </span><span class="default">$org_width</span><span class="keyword">/</span><span class="default">$width</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="default">$new_width </span><span class="keyword">= </span><span class="default">$width</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="default">$new_height </span><span class="keyword">= </span><span class="default">$org_height</span><span class="keyword">/</span><span class="default">$xtmp</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp;&nbsp; if (</span><span class="default">$new_height </span><span class="keyword">&gt; </span><span class="default">$height</span><span class="keyword">){<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$ytmp </span><span class="keyword">= </span><span class="default">$org_height</span><span class="keyword">/</span><span class="default">$height</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$new_height </span><span class="keyword">= </span><span class="default">$height</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$new_width </span><span class="keyword">= </span><span class="default">$org_width</span><span class="keyword">/</span><span class="default">$ytmp</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="default">$width </span><span class="keyword">= </span><span class="default">round</span><span class="keyword">(</span><span class="default">$new_width</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="default">$height </span><span class="keyword">= </span><span class="default">round</span><span class="keyword">(</span><span class="default">$new_height</span><span class="keyword">);<br />
&nbsp; }<br />
&nbsp; <br />
<br />
&nbsp; </span><span class="default">$img_n</span><span class="keyword">=</span><span class="default">imagecreatetruecolor </span><span class="keyword">(</span><span class="default">$width</span><span class="keyword">, </span><span class="default">$height</span><span class="keyword">);<br />
&nbsp; </span><span class="default">imagecopyresampled</span><span class="keyword">(</span><span class="default">$img_n</span><span class="keyword">, </span><span class="default">$img</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">$xoffset</span><span class="keyword">, </span><span class="default">$yoffset</span><span class="keyword">, </span><span class="default">$width</span><span class="keyword">, </span><span class="default">$height</span><span class="keyword">, </span><span class="default">$org_width</span><span class="keyword">, </span><span class="default">$org_height</span><span class="keyword">);<br />
<br />
&nbsp; if(</span><span class="default">$type</span><span class="keyword">==</span><span class="string">"gif"</span><span class="keyword">)<br />
&nbsp; {<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">imagegif</span><span class="keyword">(</span><span class="default">$img_n</span><span class="keyword">, </span><span class="default">$dest</span><span class="keyword">);<br />
&nbsp; }<br />
&nbsp; elseif(</span><span class="default">$type</span><span class="keyword">==</span><span class="string">"jpg"</span><span class="keyword">)<br />
&nbsp; {<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">imagejpeg</span><span class="keyword">(</span><span class="default">$img_n</span><span class="keyword">, </span><span class="default">$dest</span><span class="keyword">);<br />
&nbsp; }<br />
&nbsp; elseif(</span><span class="default">$type</span><span class="keyword">==</span><span class="string">"png"</span><span class="keyword">)<br />
&nbsp; {<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">imagepng</span><span class="keyword">(</span><span class="default">$img_n</span><span class="keyword">, </span><span class="default">$dest</span><span class="keyword">);<br />
&nbsp; }<br />
&nbsp; elseif(</span><span class="default">$type</span><span class="keyword">==</span><span class="string">"bmp"</span><span class="keyword">)<br />
&nbsp; {<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">imagewbmp</span><span class="keyword">(</span><span class="default">$img_n</span><span class="keyword">, </span><span class="default">$dest</span><span class="keyword">);<br />
&nbsp; }<br />
&nbsp; Return </span><span class="default">true</span><span class="keyword">;<br />
}<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="58233""></a>
  <div class="note">
   <strong class="user">info at lontronics dot nl</strong>
   <a href="#58233" class="date">28-Oct-2005 12:08</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
For an internet photoalbum I was looking for a script which I could simply drop in a directory with images and which would do the rest.<br />
Therefor I am using the following resize script now. I have made the little thumb-part because I want to have all the same size thumbnails, but with as less as possible distortion. Therefor, images with other dimensions are resized, but also cut off a little.<br />
<br />
Als $pictype = thumb, the extra dimension calculations are used<br />
$width and $height are the new dimensions of $filename, the image<br />
$dest is the directory where the new image must be copied in.<br />
<br />
The script:<br />
<br />
// Resize function<br />
function resize($filename, $dest, $width, $height, $pictype)<br />
{<br />
&nbsp;&nbsp;&nbsp; $format = strtolower(substr(strrchr($filename,"."),1));<br />
&nbsp;&nbsp;&nbsp; switch($format)<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; case 'gif' :<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $type ="gif";<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $img = imagecreatefromgif($filename);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; break;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; case 'png' :<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $type ="png";<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $img = imagecreatefrompng($filename);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; break;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; case 'jpg' :<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $type ="jpg";<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $img = imagecreatefromjpeg($filename);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; break;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; case 'jpeg' :<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $type ="jpg";<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $img = imagecreatefromjpeg($filename);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; break;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; default : <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; die ("ERROR; UNSUPPORTED IMAGE TYPE");<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; break;<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; list($org_width, $org_height) = getimagesize($filename);<br />
&nbsp;&nbsp;&nbsp; $xoffset = 0;<br />
&nbsp;&nbsp;&nbsp; $yoffset = 0;<br />
&nbsp;&nbsp;&nbsp; if ($pictype == "thumb") // To minimize destortion<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if ($org_width / $width &gt; $org_height/ $height)<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $xtmp = $org_width;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $xratio = 1-((($org_width/$org_height)-($width/$height))/2);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $org_width = $org_width * $xratio;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $xoffset = ($xtmp - $org_width)/2;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; elseif ($org_height/ $height &gt; $org_width / $width)<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $ytmp = $org_height;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $yratio = 1-((($width/$height)-($org_width/$org_height))/2);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $org_height = $org_height * $yratio;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $yoffset = ($ytmp - $org_height)/2;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp;&nbsp; $img_n=imagecreatetruecolor ($width, $height);&nbsp; &nbsp; <br />
&nbsp;&nbsp;&nbsp; imagecopyresampled($img_n, $img, 0, 0, $xoffset, $yoffset, $width, $height, $org_width, $org_height);<br />
<br />
&nbsp;&nbsp;&nbsp; if($type=="gif")<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; imagegif($img_n, $dest);<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; elseif($type=="jpg")<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; imagejpeg($img_n, $dest);<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; elseif($type=="png")<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; imagepng($img_n, $dest);<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; elseif($type=="bmp")<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; imagewbmp($img_n, $dest);<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; Return true;<br />
}</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="57990""></a>
  <div class="note">
   <strong class="user">Nicolas dot Grasset at notup2u dot net</strong>
   <a href="#57990" class="date">20-Oct-2005 11:33</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If you are looking for a function that can resample your photos to a given size, no matter its original size and/or ratio, here it is. And to make more fun (beacause life has to be fun), you can even chose a border size for the picture!<br />
<br />
$position can either be topleft, topright, bottomleft, bottomright or center.<br />
<br />
<span class="default">&lt;?php<br />
<br />
</span><span class="keyword">function </span><span class="default">imagecopyresampledselection</span><span class="keyword">(</span><span class="default">$filename</span><span class="keyword">, </span><span class="default">$desired_width</span><span class="keyword">, </span><span class="default">$desired_height</span><span class="keyword">, </span><span class="default">$bordersize</span><span class="keyword">, </span><span class="default">$position</span><span class="keyword">)<br />
{&nbsp; &nbsp; <br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">// Get new dimensions<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">list(</span><span class="default">$width</span><span class="keyword">, </span><span class="default">$height</span><span class="keyword">) = </span><span class="default">getimagesize</span><span class="keyword">(</span><span class="default">$filename</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; if(</span><span class="default">$desired_width</span><span class="keyword">/</span><span class="default">$desired_height </span><span class="keyword">&gt; </span><span class="default">$width</span><span class="keyword">/</span><span class="default">$height</span><span class="keyword">):<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$new_width </span><span class="keyword">= </span><span class="default">$desired_width</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$new_height </span><span class="keyword">= </span><span class="default">$height </span><span class="keyword">* (</span><span class="default">$desired_width </span><span class="keyword">/ </span><span class="default">$width</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; else:<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$new_width </span><span class="keyword">= </span><span class="default">$width </span><span class="keyword">* (</span><span class="default">$desired_height </span><span class="keyword">/ </span><span class="default">$height</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$new_height </span><span class="keyword">= </span><span class="default">$desired_height</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; endif;<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">// Resize<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$image_p </span><span class="keyword">= </span><span class="default">imagecreatetruecolor</span><span class="keyword">(</span><span class="default">$new_width</span><span class="keyword">, </span><span class="default">$new_height</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$image_f </span><span class="keyword">= </span><span class="default">imagecreatetruecolor</span><span class="keyword">(</span><span class="default">$desired_width</span><span class="keyword">, </span><span class="default">$desired_height</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$image </span><span class="keyword">= </span><span class="default">imagecreatefromjpeg</span><span class="keyword">(</span><span class="default">$filename</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">imagecopyresampled</span><span class="keyword">(</span><span class="default">$image_p</span><span class="keyword">, </span><span class="default">$image</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">$new_width</span><span class="keyword">, </span><span class="default">$new_height</span><span class="keyword">, </span><span class="default">$width</span><span class="keyword">, </span><span class="default">$height</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">// Adjust position<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">switch(</span><span class="default">$position</span><span class="keyword">)<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; case(</span><span class="string">"topleft"</span><span class="keyword">):<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$x </span><span class="keyword">= </span><span class="default">$bordersize</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$y </span><span class="keyword">= </span><span class="default">$bordersize</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; break;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; case(</span><span class="string">"topright"</span><span class="keyword">):<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$x </span><span class="keyword">= </span><span class="default">$new_width </span><span class="keyword">- </span><span class="default">$desired_width </span><span class="keyword">+ </span><span class="default">$bordersize</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$y </span><span class="keyword">= </span><span class="default">$bordersize</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; break;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; case(</span><span class="string">"bottomleft"</span><span class="keyword">):<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$x </span><span class="keyword">= </span><span class="default">$bordersize</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$y </span><span class="keyword">= </span><span class="default">$new_height </span><span class="keyword">- </span><span class="default">$desired_height </span><span class="keyword">+ </span><span class="default">$bordersize</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; break;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; case(</span><span class="string">"bottomright"</span><span class="keyword">):<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$x </span><span class="keyword">= </span><span class="default">$new_width </span><span class="keyword">- </span><span class="default">$desired_width </span><span class="keyword">+ </span><span class="default">$bordersize</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$y </span><span class="keyword">= </span><span class="default">$new_height </span><span class="keyword">- </span><span class="default">$desired_height </span><span class="keyword">+ </span><span class="default">$bordersize</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; break;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; case(</span><span class="string">"center"</span><span class="keyword">):<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$x </span><span class="keyword">= (</span><span class="default">$new_width </span><span class="keyword">- </span><span class="default">$desired_width</span><span class="keyword">) / </span><span class="default">2 </span><span class="keyword">+ </span><span class="default">$bordersize</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$y </span><span class="keyword">= (</span><span class="default">$new_height </span><span class="keyword">- </span><span class="default">$desired_height</span><span class="keyword">) / </span><span class="default">2 </span><span class="keyword">+ </span><span class="default">$bordersize</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; break;<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">// Resample with 1px border<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">imagecopyresampled</span><span class="keyword">(</span><span class="default">$image_f</span><span class="keyword">, </span><span class="default">$image_p</span><span class="keyword">, </span><span class="default">$bordersize</span><span class="keyword">, </span><span class="default">$bordersize</span><span class="keyword">, </span><span class="default">$x</span><span class="keyword">, </span><span class="default">$y</span><span class="keyword">,&nbsp; &nbsp;&nbsp; </span><span class="default">$desired_width&nbsp; &nbsp; </span><span class="keyword">- </span><span class="default">2 </span><span class="keyword">* </span><span class="default">$bordersize</span><span class="keyword">, <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$desired_height&nbsp; &nbsp; </span><span class="keyword">- </span><span class="default">2 </span><span class="keyword">* </span><span class="default">$bordersize</span><span class="keyword">, <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$desired_width&nbsp; &nbsp; </span><span class="keyword">- </span><span class="default">2 </span><span class="keyword">* </span><span class="default">$bordersize</span><span class="keyword">, <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$desired_height&nbsp; &nbsp; </span><span class="keyword">- </span><span class="default">2 </span><span class="keyword">* </span><span class="default">$bordersize</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; return </span><span class="default">$image_f</span><span class="keyword">;<br />
}<br />
<br />
</span><span class="default">$image_f </span><span class="keyword">= </span><span class="default">imagecopyresampledselection</span><span class="keyword">(</span><span class="string">'test.jpg'</span><span class="keyword">, </span><span class="default">571</span><span class="keyword">, </span><span class="default">319</span><span class="keyword">, </span><span class="default">1</span><span class="keyword">, </span><span class="string">"center"</span><span class="keyword">);<br />
</span><span class="default">header</span><span class="keyword">(</span><span class="string">'Content-type: image/jpeg'</span><span class="keyword">);<br />
</span><span class="default">imagejpeg</span><span class="keyword">(</span><span class="default">$image_f</span><span class="keyword">, </span><span class="default">null</span><span class="keyword">, </span><span class="default">100</span><span class="keyword">);<br />
<br />
</span><span class="default">?&gt;</span> <br />
<br />
To see a result, just browse <a href="http://www.notup2u.net/v8" rel="nofollow" target="_blank">http://www.notup2u.net/v8</a><br />
<br />
Nicolas Grasset</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="55740""></a>
  <div class="note">
   
   <a href="#55740" class="date">12-Aug-2005 02:19</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Here is my own custom utility which I call "Thumbnailer" (I know it is cheesy).<br />
It's rather short, and it will take JPEG (you can change that easily), and<br />
format it to a specified output width and height as a PNG<br />
(or whatever else you choose):<br />
<span class="default">&lt;?php<br />
</span><span class="comment">//Dimensions<br />
</span><span class="default">$outWidth</span><span class="keyword">=</span><span class="default">100</span><span class="keyword">; </span><span class="default">$outHeight</span><span class="keyword">=</span><span class="default">75</span><span class="keyword">;<br />
</span><span class="comment">//Do it<br />
</span><span class="default">$imgSrc</span><span class="keyword">=</span><span class="default">imagecreatefromjpeg</span><span class="keyword">(</span><span class="string">"[source]"</span><span class="keyword">);<br />
</span><span class="default">$srcWidth</span><span class="keyword">=</span><span class="default">imagesx</span><span class="keyword">(</span><span class="default">$imgSrc</span><span class="keyword">);<br />
</span><span class="default">$srcHeight</span><span class="keyword">=</span><span class="default">imagesy</span><span class="keyword">(</span><span class="default">$imgSrc</span><span class="keyword">);<br />
</span><span class="comment">//Make thumbnails<br />
</span><span class="default">$imgOut</span><span class="keyword">=</span><span class="default">imagecreatetruecolor</span><span class="keyword">(</span><span class="default">$outWidth</span><span class="keyword">,</span><span class="default">$outHeight</span><span class="keyword">);<br />
</span><span class="default">imagerectangle</span><span class="keyword">(</span><span class="default">$imgOut</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">,</span><span class="default">$outWidth</span><span class="keyword">,</span><span class="default">$outHeight</span><span class="keyword">,<br />
&nbsp;</span><span class="default">imagecolorallocate</span><span class="keyword">(</span><span class="default">$imgOut</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">));<br />
</span><span class="comment">//Copy them proportionatly<br />
</span><span class="default">$dx</span><span class="keyword">=</span><span class="default">0</span><span class="keyword">; </span><span class="default">$dy</span><span class="keyword">=</span><span class="default">0</span><span class="keyword">; </span><span class="default">$dw</span><span class="keyword">=</span><span class="default">$outWidth</span><span class="keyword">; </span><span class="default">$dh</span><span class="keyword">=</span><span class="default">$outHeight</span><span class="keyword">;<br />
if (</span><span class="default">$outWidth</span><span class="keyword">*</span><span class="default">$srcHeight</span><span class="keyword">!=</span><span class="default">$outHeight</span><span class="keyword">*</span><span class="default">$srcWidth</span><span class="keyword">) { </span><span class="comment">//Non-proportional, cut-off<br />
&nbsp;//Which dimensions is larger<br />
&nbsp;</span><span class="keyword">if (</span><span class="default">$srcWidth</span><span class="keyword">&gt;</span><span class="default">$srcHeight</span><span class="keyword">) { </span><span class="comment">//Empty space on top and bottom<br />
&nbsp; </span><span class="default">$dw</span><span class="keyword">=</span><span class="default">$outWidth</span><span class="keyword">;<br />
&nbsp; </span><span class="default">$dh</span><span class="keyword">=(</span><span class="default">$dw</span><span class="keyword">*</span><span class="default">$srcHeight</span><span class="keyword">)/</span><span class="default">$srcWidth</span><span class="keyword">;<br />
&nbsp; </span><span class="default">$dy</span><span class="keyword">=(</span><span class="default">$outHeight</span><span class="keyword">-</span><span class="default">$dh</span><span class="keyword">)/</span><span class="default">2</span><span class="keyword">;<br />
&nbsp;}<br />
&nbsp;else { </span><span class="comment">//Empty space on left and right<br />
&nbsp; </span><span class="default">$dh</span><span class="keyword">=</span><span class="default">$outHeight</span><span class="keyword">;<br />
&nbsp; </span><span class="default">$dw</span><span class="keyword">=(</span><span class="default">$dh</span><span class="keyword">*</span><span class="default">$srcWidth</span><span class="keyword">)/</span><span class="default">$srcHeight</span><span class="keyword">;<br />
&nbsp; </span><span class="default">$dx</span><span class="keyword">=(</span><span class="default">$outWidth</span><span class="keyword">-</span><span class="default">$dw</span><span class="keyword">)/</span><span class="default">2</span><span class="keyword">;<br />
&nbsp;}<br />
}<br />
</span><span class="default">imagecopyresampled</span><span class="keyword">(</span><span class="default">$imgOut</span><span class="keyword">,</span><span class="default">$imgSrc</span><span class="keyword">,</span><span class="default">$dx</span><span class="keyword">,</span><span class="default">$dy</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">,<br />
&nbsp;</span><span class="default">$dw</span><span class="keyword">,</span><span class="default">$dh</span><span class="keyword">,</span><span class="default">$srcWidth</span><span class="keyword">,</span><span class="default">$srcHeight</span><span class="keyword">); </span><span class="comment">//imagecopyresized for lower quality<br />
//Create the thumbnail and destroy everything else<br />
</span><span class="default">imagepng</span><span class="keyword">(</span><span class="default">$imgOut</span><span class="keyword">,</span><span class="string">"[out]"</span><span class="keyword">);<br />
echo </span><span class="string">"Image created successfully: </span><span class="default">$outWidth</span><span class="string"> x </span><span class="default">$outHeight</span><span class="string">, "</span><span class="keyword">.</span><span class="default">round</span><span class="keyword">(</span><span class="default">filesize</span><span class="keyword">(</span><span class="string">"[source]"</span><span class="keyword">)/</span><span class="default">1024</span><span class="keyword">).</span><span class="string">" KB&lt;br&gt;"</span><span class="keyword">;<br />
</span><span class="default">imagedestroy</span><span class="keyword">(</span><span class="default">$imgSrc</span><span class="keyword">);<br />
</span><span class="default">imagedestroy</span><span class="keyword">(</span><span class="default">$imgOut</span><span class="keyword">);<br />
</span><span class="default">?&gt;<br />
</span>I just use this as a loop to create thumbnails for a series of ordered images.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="54930""></a>
  <div class="note">
   <strong class="user">phpman at paodj dot net</strong>
   <a href="#54930" class="date">20-Jul-2005 12:27</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
<span class="default">&lt;?php<br />
<br />
</span><span class="keyword">function </span><span class="default">img_resize</span><span class="keyword">(</span><span class="default">$path</span><span class="keyword">,</span><span class="default">$w</span><span class="keyword">=</span><span class="default">0</span><span class="keyword">,</span><span class="default">$h</span><span class="keyword">=</span><span class="default">0</span><span class="keyword">,</span><span class="default">$quality</span><span class="keyword">=</span><span class="default">100</span><span class="keyword">,</span><span class="default">$save</span><span class="keyword">=</span><span class="string">''</span><span class="keyword">){<br />
<br />
&nbsp; </span><span class="default">$image_data</span><span class="keyword">=@</span><span class="default">getimagesize</span><span class="keyword">(</span><span class="default">$path</span><span class="keyword">);<br />
<br />
&nbsp; </span><span class="default">$image_type</span><span class="keyword">=</span><span class="default">$image_data</span><span class="keyword">[</span><span class="default">2</span><span class="keyword">];<br />
&nbsp; </span><span class="default">$gd_ext</span><span class="keyword">=array(</span><span class="string">''</span><span class="keyword">,</span><span class="string">'jpg'</span><span class="keyword">,</span><span class="string">'gif'</span><span class="keyword">);<br />
&nbsp; if(</span><span class="default">$image_type</span><span class="keyword">!=</span><span class="default">1</span><span class="keyword">&amp;&amp;</span><span class="default">$image_type</span><span class="keyword">!=</span><span class="default">2</span><span class="keyword">) return </span><span class="default">false</span><span class="keyword">;<br />
&nbsp; if(</span><span class="default">$save</span><span class="keyword">==</span><span class="string">''</span><span class="keyword">) </span><span class="default">header</span><span class="keyword">(</span><span class="string">'Content-type: '</span><span class="keyword">.</span><span class="default">$image_data</span><span class="keyword">[</span><span class="string">'mime'</span><span class="keyword">]); else </span><span class="default">$save</span><span class="keyword">=</span><span class="default">eregi_replace</span><span class="keyword">(</span><span class="string">'%ext'</span><span class="keyword">,</span><span class="default">$gd_ext</span><span class="keyword">[</span><span class="default">$image_type</span><span class="keyword">],</span><span class="default">$save</span><span class="keyword">);<br />
<br />
&nbsp; if(</span><span class="default">$w</span><span class="keyword">!=</span><span class="default">0</span><span class="keyword">){<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$rapporto</span><span class="keyword">=</span><span class="default">$image_data</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">]/</span><span class="default">$w</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; if(</span><span class="default">$h</span><span class="keyword">!=</span><span class="default">0</span><span class="keyword">){<br />
&nbsp;&nbsp; &nbsp;&nbsp; if(</span><span class="default">$image_data</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">]/</span><span class="default">$rapporto</span><span class="keyword">&gt;</span><span class="default">$h</span><span class="keyword">) </span><span class="default">$rapporto</span><span class="keyword">=</span><span class="default">$image_data</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">]/</span><span class="default">$h</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp; }elseif(</span><span class="default">$h</span><span class="keyword">!=</span><span class="default">0</span><span class="keyword">){<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$tmp_h</span><span class="keyword">=</span><span class="default">$image_data</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">]/</span><span class="default">$h</span><span class="keyword">;<br />
&nbsp; }else{<br />
&nbsp;&nbsp;&nbsp; return </span><span class="default">false</span><span class="keyword">;<br />
&nbsp; }<br />
<br />
&nbsp; </span><span class="default">$thumb_w</span><span class="keyword">=</span><span class="default">$image_data</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">]/</span><span class="default">$rapporto</span><span class="keyword">;<br />
&nbsp; </span><span class="default">$thumb_h</span><span class="keyword">=</span><span class="default">$image_data</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">]/</span><span class="default">$rapporto</span><span class="keyword">;<br />
<br />
&nbsp; if(</span><span class="default">$image_type</span><span class="keyword">==</span><span class="default">1</span><span class="keyword">) </span><span class="default">$img_src</span><span class="keyword">=@</span><span class="default">imagecreatefromgif</span><span class="keyword">(</span><span class="default">$path</span><span class="keyword">);<br />
&nbsp; elseif(</span><span class="default">$image_type</span><span class="keyword">==</span><span class="default">2</span><span class="keyword">) </span><span class="default">$img_src</span><span class="keyword">=@</span><span class="default">imagecreatefromjpeg</span><span class="keyword">(</span><span class="default">$path</span><span class="keyword">);<br />
<br />
&nbsp; </span><span class="default">$img_thumb</span><span class="keyword">=@</span><span class="default">imagecreatetruecolor</span><span class="keyword">(</span><span class="default">$thumb_w</span><span class="keyword">,</span><span class="default">$thumb_h</span><span class="keyword">);<br />
&nbsp; </span><span class="default">$result</span><span class="keyword">=@</span><span class="default">imagecopyresampled</span><span class="keyword">(</span><span class="default">$img_thumb</span><span class="keyword">,</span><span class="default">$img_src</span><span class="keyword">,<br />
</span><span class="default">0</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">,</span><span class="default">$thumb_w</span><span class="keyword">,</span><span class="default">$thumb_h</span><span class="keyword">,</span><span class="default">$image_data</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">],</span><span class="default">$image_data</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">]);<br />
&nbsp; if(!</span><span class="default">$img_src</span><span class="keyword">||!</span><span class="default">$img_thumb</span><span class="keyword">||!</span><span class="default">$result</span><span class="keyword">) return </span><span class="default">false</span><span class="keyword">;<br />
<br />
&nbsp; if(</span><span class="default">$image_type</span><span class="keyword">==</span><span class="default">1</span><span class="keyword">) </span><span class="default">$result</span><span class="keyword">=@</span><span class="default">imagegif</span><span class="keyword">(</span><span class="default">$img_thumb</span><span class="keyword">,</span><span class="default">$save</span><span class="keyword">);<br />
&nbsp; elseif(</span><span class="default">$image_type</span><span class="keyword">==</span><span class="default">2</span><span class="keyword">) </span><span class="default">$result</span><span class="keyword">=@</span><span class="default">imagejpeg</span><span class="keyword">(</span><span class="default">$img_thumb</span><span class="keyword">,</span><span class="default">$save</span><span class="keyword">,</span><span class="default">$quality</span><span class="keyword">);<br />
<br />
&nbsp; return </span><span class="default">$result</span><span class="keyword">;<br />
}<br />
<br />
</span><span class="default">?&gt;<br />
</span><br />
This script resize images. It can also make thumbs. It use the resample of images for hight quality result.<br />
<br />
It can show the result or save it (if $save isn't null).<br />
It respect the width and/or the height of image.<br />
It can replace the destination file extestion dinamically (filename.%ext)<br />
Support gif &amp; jpg.<br />
<br />
Return false if something goes wrong.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="54448""></a>
  <div class="note">
   
   <a href="#54448" class="date">05-Jul-2005 02:46</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
It should be noted that the imagecopyresampled() function is much more blurry than Photoshop CS's default bicubic funtion. And looks similar to a blury version of Photoshop's bilinear function. The documentation fails to note which algorithm is used in resampling.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="53214""></a>
  <div class="note">
   <strong class="user">Pie pie</strong>
   <a href="#53214" class="date">26-May-2005 02:21</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Confirming on what fluffle said, and to say his code will also crop and resize an image what is smaller than 100x100 pixels if you want. This is important because it means your images no matter how you decide to rezise them, will maintain their aspect ratios and with a minimum amount of image loss.<br />
<br />
&nbsp;&nbsp;&nbsp; //Get file type<br />
&nbsp;&nbsp;&nbsp; $mime = $orig_image_mimetype;<br />
&nbsp;&nbsp;&nbsp; $type = substr($mime, strpos($mime,'/')+1);<br />
&nbsp;&nbsp;&nbsp; switch($type) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; case 'jpeg':<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; case 'pjpeg':<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $big = imagecreatefromjpeg($file);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; break;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; case 'png':<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; case 'x-png':<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $big = imagecreatefrompng($file);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; break;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; case 'gif':<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $big = imagecreatefromgif($file);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; break;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; default:<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return FALSE;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; break;<br />
&nbsp;&nbsp;&nbsp; }<br />
<br />
The above code is what I use to support multiple file type resizing. I then use the same thing again when it's time to output the image using $result = imagejpeg($thumb,'',80), imagepng($thumb), and imagegif($thumb).</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="53031""></a>
  <div class="note">
   <strong class="user">fluffle &lt;at&gt; gmail &lt;dot&gt; com</strong>
   <a href="#53031" class="date">21-May-2005 10:35</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Just to clarify that src_w and src_h do not necessarily need to be the source image width and height, as they specify the size of the rectangle cropped from the source picture, with its top left corner situated at (src_x, src_y).<br />
<br />
For example, the code below crops a jpeg image to be square, with the square situated in the centre of the original image, and then resizes it to a 100x100 thumbnail.<br />
<br />
list($ow, $oh) = getimagesize($image_filename);<br />
$big = imagecreatefromjpeg($image_filename);<br />
$thumb = imagecreatetruecolor(100,100);<br />
if ($ow &gt; $oh) {<br />
&nbsp;&nbsp;&nbsp; $off_w = ($ow-$oh)/2;<br />
&nbsp;&nbsp;&nbsp; $off_h = 0;<br />
&nbsp;&nbsp;&nbsp; $ow = $oh;<br />
} elseif ($oh &gt; $ow) {<br />
&nbsp;&nbsp;&nbsp; $off_w = 0;<br />
&nbsp;&nbsp;&nbsp; $off_h = ($oh-$ow)/2;<br />
&nbsp;&nbsp;&nbsp; $oh = $ow;<br />
} else {<br />
&nbsp;&nbsp;&nbsp; $off_w = 0;<br />
&nbsp;&nbsp;&nbsp; $off_h = 0;<br />
}<br />
imagecopyresampled($thumb, $big, 0, 0, $off_w, $off_h, 100, 100, $ow, $oh);</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="52965""></a>
  <div class="note">
   <strong class="user">carnivorous_winds_fr AT yahoo DOT fr</strong>
   <a href="#52965" class="date">19-May-2005 07:47</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I tried this code from a previous post.<br />
<br />
&lt;?<br />
...<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; $t_im = imageCreateTrueColor($t_wd,$t_ht);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; imageAntiAlias($t_im,true);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; imagealphablending($t_im, false);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; imagesavealpha($t_im,true);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; $transparent = imagecolorallocatealpha($t_im, 255, 255, 255, 0);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; for($x=0;$x&lt;$t_wd;$x++) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; for($y=0;$y&lt;$t_ht;$y++) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; imageSetPixel( $t_im, $x, $y, $transparent );<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; imageCopyResampled($t_im, $o_im, 0, 0, 0, 0, $t_wd, $t_ht, $o_wd, $o_ht);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; imagePNG($t_im, $image_name);<br />
...<br />
?&gt;<br />
<br />
It seems that it is not working correctly. In my test the source picture in ImageCopyResampled() is smaller than the destination picture $t_im, the remaining part is white !<br />
<br />
I changed transparent alpha channel to 127, and I tried to replace loops with imagefilledrectangle().<br />
<br />
It works fine and these resource greedy loops are removed.<br />
<br />
Here is the code with my change.<br />
<br />
&lt;?<br />
...<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; $t_im = imageCreateTrueColor($t_wd,$t_ht);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; imageAntiAlias($t_im,true);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; imagealphablending($t_im, false);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; imagesavealpha($t_im,true);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; $transparent = imagecolorallocatealpha($t_im, 255, 255, 255, 127);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; imagefilledrectangle($t_img, 0, 0, $t_wd, $t_ht, $transparent);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; imageCopyResampled($t_im, $o_im, 0, 0, 0, 0, $t_wd, $t_ht, $o_wd, $o_ht);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; imagePNG($t_im, $image_name);<br />
...<br />
?&gt;</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="52542""></a>
  <div class="note">
   <strong class="user">del at kartoon dot net</strong>
   <a href="#52542" class="date">05-May-2005 10:38</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
This snippet allows you to grab a thumbnail from the center of a large image.&nbsp; This was used for a client photo gallery for art to give a teaser of the image to come (only a small portion).&nbsp; You could get dynamic with this value.&nbsp; I also put in a scaling factor in case you want to scale down first before chopping.<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="comment">// The file<br />
</span><span class="default">$filename </span><span class="keyword">= </span><span class="string">'moon.jpg'</span><span class="keyword">;<br />
</span><span class="default">$percent </span><span class="keyword">= </span><span class="default">1.0</span><span class="keyword">; </span><span class="comment">// if you want to scale down first<br />
</span><span class="default">$imagethumbsize </span><span class="keyword">= </span><span class="default">200</span><span class="keyword">; </span><span class="comment">// thumbnail size (area cropped in middle of image)<br />
// Content type<br />
</span><span class="default">header</span><span class="keyword">(</span><span class="string">'Content-type: image/jpeg'</span><span class="keyword">);<br />
<br />
</span><span class="comment">// Get new dimensions<br />
</span><span class="keyword">list(</span><span class="default">$width</span><span class="keyword">, </span><span class="default">$height</span><span class="keyword">) = </span><span class="default">getimagesize</span><span class="keyword">(</span><span class="default">$filename</span><span class="keyword">);<br />
</span><span class="default">$new_width </span><span class="keyword">= </span><span class="default">$width </span><span class="keyword">* </span><span class="default">$percent</span><span class="keyword">;<br />
</span><span class="default">$new_height </span><span class="keyword">= </span><span class="default">$height </span><span class="keyword">* </span><span class="default">$percent</span><span class="keyword">;<br />
<br />
</span><span class="comment">// Resample<br />
</span><span class="default">$image_p </span><span class="keyword">= </span><span class="default">imagecreatetruecolor</span><span class="keyword">(</span><span class="default">$imagethumbsize </span><span class="keyword">, </span><span class="default">$imagethumbsize</span><span class="keyword">);&nbsp; </span><span class="comment">// true color for best quality<br />
</span><span class="default">$image </span><span class="keyword">= </span><span class="default">imagecreatefromjpeg</span><span class="keyword">(</span><span class="default">$filename</span><span class="keyword">);<br />
<br />
</span><span class="comment">// basically take this line and put in your versin the -($new_width/2) + ($imagethumbsize/2) &amp; -($new_height/2) + ($imagethumbsize/2) for<br />
// the 2/3 position in the 3 and 4 place for imagecopyresampled<br />
// -($new_width/2) + ($imagethumbsize/2)<br />
// AND<br />
// -($new_height/2) + ($imagethumbsize/2)<br />
// are the trick<br />
</span><span class="default">imagecopyresampled</span><span class="keyword">(</span><span class="default">$image_p</span><span class="keyword">, </span><span class="default">$image</span><span class="keyword">, -(</span><span class="default">$new_width</span><span class="keyword">/</span><span class="default">2</span><span class="keyword">) + (</span><span class="default">$imagethumbsize</span><span class="keyword">/</span><span class="default">2</span><span class="keyword">), -(</span><span class="default">$new_height</span><span class="keyword">/</span><span class="default">2</span><span class="keyword">) + (</span><span class="default">$imagethumbsize</span><span class="keyword">/</span><span class="default">2</span><span class="keyword">), </span><span class="default">0</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">$new_width </span><span class="keyword">, </span><span class="default">$new_width </span><span class="keyword">, </span><span class="default">$width</span><span class="keyword">, </span><span class="default">$height</span><span class="keyword">);<br />
<br />
</span><span class="comment">// Output<br />
<br />
</span><span class="default">imagejpeg</span><span class="keyword">(</span><span class="default">$image_p</span><span class="keyword">, </span><span class="default">null</span><span class="keyword">, </span><span class="default">100</span><span class="keyword">);<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="50604""></a>
  <div class="note">
   <strong class="user">djneoform at gmail dot com</strong>
   <a href="#50604" class="date">04-Mar-2005 03:21</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Here's a function i made that will force a given set of constraints on an image (usrfull if you want to make thumbnails that are all the same size) while keeping aspect ratio.<br />
<br />
It resizes, then crops the extra off the top or bottom.<br />
<br />
function forceConstraints($srcFile, $srcType, $dstType, $dstWidth, $dstHeight, $dstPath)<br />
{<br />
&nbsp;&nbsp;&nbsp; if ($srcType == "image/jpeg")<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $handle = @imagecreatefromjpeg($srcFile);<br />
&nbsp;&nbsp;&nbsp; else if ($srcType == "image/png")<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $handle = @imagecreatefrompng($srcFile);<br />
&nbsp;&nbsp;&nbsp; else if ($srcType == "image/gif")<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $handle = @imagecreatefromgif($srcFile);<br />
&nbsp;&nbsp;&nbsp; else<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return false;<br />
<br />
&nbsp;&nbsp;&nbsp; if (!$handle)<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return false;<br />
<br />
&nbsp;&nbsp;&nbsp; $srcWidth&nbsp; = @imagesx($handle);<br />
&nbsp;&nbsp;&nbsp; $srcHeight = @imagesy($handle);<br />
<br />
&nbsp;&nbsp;&nbsp; if ($srcWidth &gt;= $dstWidth &amp;&amp; $srcHeight &gt;= $dstHeight)<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $newHandle = @imagecreatetruecolor($dstWidth, $dstHeight);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if (!$newHandle)<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return false;<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if($srcHeight &lt; $srcWidth)<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $ratio = (double)($srcHeight / $dstHeight);<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $cpyWidth = round($dstWidth * $ratio);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if ($cpyWidth &gt; $srcWidth)<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $ratio = (double)($srcWidth / $dstWidth);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $cpyWidth = $srcWidth;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $cpyHeight = round($dstHeight * $ratio);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $xOffset = 0;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $yOffset = round(($srcHeight - $cpyHeight) / 2);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; } else {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $cpyHeight = $srcHeight;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $xOffset = round(($srcWidth - $cpyWidth) / 2);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $yOffset = 0;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; } else {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $ratio = (double)($srcWidth / $dstWidth);<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $cpyHeight = round($dstHeight * $ratio);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if ($cpyHeight &gt; $srcHeight)<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $ratio = (double)($srcHeight / $dstHeight);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $cpyHeight = $srcHeight;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $cpyWidth = round($dstWidth * $ratio);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $xOffset = round(($srcWidth - $cpyWidth) / 2);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $yOffset = 0;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; } else {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $cpyWidth = $srcWidth;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $xOffset = 0;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $yOffset = round(($srcHeight - $cpyHeight) / 2);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if (!@imagecopyresampled($newHandle, $handle, 0, 0, $xOffset, $yOffset, $dstWidth, $dstHeight, $cpyWidth, $cpyHeight))<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return false;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; @imagedestroy($handle);<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if ($dstType == "png")<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; @imagepng($newHandle, $dstPath.".png");<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; else if ($dstType == "jpg")<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; @imagejpeg($newHandle, $dstPath.".jpg", 90);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; else if ($dstType == "gif")<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; @imagegif($newHandle, $dstPath.".gif");<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; else<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return false;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; @imagedestroy($newHandle);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return true;<br />
<br />
&nbsp;&nbsp;&nbsp; } else {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return "Sorry, that image is too small. The image must be at least ".$dstWidth."x".$dstHeight." pixels in size.";<br />
&nbsp;&nbsp;&nbsp; }<br />
}</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="48624""></a>
  <div class="note">
   <strong class="user">afrowuk at tiscali dot co dot uk</strong>
   <a href="#48624" class="date">02-Jan-2005 04:17</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
This simple function resizes a JPG image file giving just a maximum width, and resizes keeping the aspect ratio. This is useful if you have to resize a JPG image that must fit the width of i.e. a div element, but doesn't have to have a maximum height.<br />
&lt;?<br />
function resizeJPG($jpgFile, $width) {<br />
<br />
&nbsp;&nbsp;&nbsp; // Get new dimensions<br />
&nbsp;&nbsp;&nbsp; list($width_orig, $height_orig) = getimagesize($jpgFile);<br />
&nbsp;&nbsp;&nbsp; $height = (int) (($width / $width_orig) * $height_orig);<br />
<br />
&nbsp;&nbsp;&nbsp; // Resample<br />
&nbsp;&nbsp;&nbsp; $image_p = imagecreatetruecolor($width, $height);<br />
&nbsp;&nbsp;&nbsp; $image = imagecreatefromjpeg($jpgFile);<br />
&nbsp;&nbsp;&nbsp; imagecopyresampled($image_p, $image, 0, 0, 0, 0, $width, $height, $width_orig, $height_orig);<br />
<br />
&nbsp;&nbsp;&nbsp; // Output<br />
&nbsp;&nbsp;&nbsp; imagejpeg($image_p, $jpgFile, 100);<br />
<br />
}<br />
?&gt;<br />
<br />
-Stu</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="44653""></a>
  <div class="note">
   <strong class="user">stemplar444 at yahoo dot com</strong>
   <a href="#44653" class="date">12-Aug-2004 07:57</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Two comments regarding imageCopyResampleBicubic() published here. <br />
<br />
Quality:<br />
More grainy than imagecopyresampled(). Not very good for bigger destination images, I think.<br />
<br />
Speed:<br />
In my tests, it was only faster if destination size was smaller than ~200x200 pixel. The function becomes slower and slower the bigger the destination image gets. In contrast, imagecopyresampled() finished at the same speed, no matter how big the destination was. My source image resoloution ~ 1500x2000 pixel.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="44490""></a>
  <div class="note">
   <strong class="user">ron at korving dot demon dot nl</strong>
   <a href="#44490" class="date">07-Aug-2004 11:25</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
This Bicubic resample algorithm is based on the one Scott posted earlier, only this one is about 50% faster for truecolor images and about 10% faster for palette images.<br />
<br />
&lt;?<br />
<br />
function imageCopyResampleBicubic($dst_img, $src_img, $dst_x, $dst_y, $src_x, $src_y, $dst_w, $dst_h, $src_w, $src_h)<br />
{<br />
&nbsp; $scaleX = ($src_w - 1) / $dst_w;<br />
&nbsp; $scaleY = ($src_h - 1) / $dst_h;<br />
<br />
&nbsp; $scaleX2 = $scaleX / 2.0;<br />
&nbsp; $scaleY2 = $scaleY / 2.0;<br />
<br />
&nbsp; $tc = imageistruecolor($src_img);<br />
<br />
&nbsp; for ($y = $src_y; $y &lt; $src_y + $dst_h; $y++)<br />
&nbsp; {<br />
&nbsp;&nbsp;&nbsp; $sY&nbsp;&nbsp; = $y * $scaleY;<br />
&nbsp;&nbsp;&nbsp; $siY&nbsp; = (int) $sY;<br />
&nbsp;&nbsp;&nbsp; $siY2 = (int) $sY + $scaleY2;<br />
<br />
&nbsp;&nbsp;&nbsp; for ($x = $src_x; $x &lt; $src_x + $dst_w; $x++)<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp;&nbsp; $sX&nbsp;&nbsp; = $x * $scaleX;<br />
&nbsp;&nbsp; &nbsp;&nbsp; $siX&nbsp; = (int) $sX;<br />
&nbsp;&nbsp; &nbsp;&nbsp; $siX2 = (int) $sX + $scaleX2;<br />
<br />
&nbsp;&nbsp; &nbsp;&nbsp; if ($tc)<br />
&nbsp;&nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $c1 = imagecolorat($src_img, $siX, $siY2);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $c2 = imagecolorat($src_img, $siX, $siY);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $c3 = imagecolorat($src_img, $siX2, $siY2);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $c4 = imagecolorat($src_img, $siX2, $siY);<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $r = (($c1 + $c2 + $c3 + $c4) &gt;&gt; 2) &amp; 0xFF0000;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $g = ((($c1 &amp; 0xFF00) + ($c2 &amp; 0xFF00) + ($c3 &amp; 0xFF00) + ($c4 &amp; 0xFF00)) &gt;&gt; 2) &amp; 0xFF00;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $b = ((($c1 &amp; 0xFF)&nbsp;&nbsp; + ($c2 &amp; 0xFF)&nbsp;&nbsp; + ($c3 &amp; 0xFF)&nbsp;&nbsp; + ($c4 &amp; 0xFF))&nbsp;&nbsp; &gt;&gt; 2);<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; imagesetpixel($dst_img, $dst_x + $x - $src_x, $dst_y + $y - $src_y, $r+$g+$b);<br />
&nbsp;&nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp;&nbsp; else<br />
&nbsp;&nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $c1 = imagecolorsforindex($src_img, imagecolorat($src_img, $siX, $siY2));<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $c2 = imagecolorsforindex($src_img, imagecolorat($src_img, $siX, $siY));<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $c3 = imagecolorsforindex($src_img, imagecolorat($src_img, $siX2, $siY2));<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $c4 = imagecolorsforindex($src_img, imagecolorat($src_img, $siX2, $siY));<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $r = ($c1['red']&nbsp;&nbsp; + $c2['red']&nbsp;&nbsp; + $c3['red']&nbsp;&nbsp; + $c4['red']&nbsp; ) &lt;&lt; 14;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $g = ($c1['green'] + $c2['green'] + $c3['green'] + $c4['green']) &lt;&lt; 6;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $b = ($c1['blue']&nbsp; + $c2['blue']&nbsp; + $c3['blue']&nbsp; + $c4['blue'] ) &gt;&gt; 2;<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; imagesetpixel($dst_img, $dst_x + $x - $src_x, $dst_y + $y - $src_y, $r+$g+$b);<br />
&nbsp;&nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp; }<br />
}<br />
<br />
?&gt;</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="44134""></a>
  <div class="note">
   
   <a href="#44134" class="date">16-Jul-2004 02:09</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
In add to all the posts that describes how to create thumbnails:<br />
<br />
If you are trying to resample a png image with its transparency you need to do this workaround:<br />
<br />
&lt;?<br />
...<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $t_im = imageCreateTrueColor($t_wd,$t_ht);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; imageAntiAlias($t_im,true);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; imagealphablending($t_im, false);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; imagesavealpha($t_im,true);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $transparent = imagecolorallocatealpha($t_im, 255, 255, 255, 0);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; for($x=0;$x&lt;$t_wd;$x++) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; for($y=0;$y&lt;$t_ht;$y++) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; imageSetPixel( $t_im, $x, $y, $transparent );<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; imageCopyResampled($t_im, $o_im, 0, 0, 0, 0, $t_wd, $t_ht, $o_wd, $o_ht);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; imagePNG($t_im, $image_name);<br />
...<br />
?&gt;<br />
<br />
The alphablending must be off so the imagesavealpha can be true.<br />
<br />
The double FORs is need to fix the problem with imagefill function that not support colors with alpha setted.<br />
<br />
It is TO SLOWLIER than imagefill, but do a nice work with static images.<br />
<br />
Take a look and enjoy the nice result.<br />
<br />
(this workaround needs the gd2 library)<br />
<br />
[s]<br />
Pigmeu</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="15188""></a>
  <div class="note">
   <strong class="user">m.kumar [at] gmx.at</strong>
   <a href="#15188" class="date">31-Aug-2001 06:10</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
For those who think that resampling loads the server too badly, have a look at this fine article over at zend:
<br />

<br />
<a href="http://www.zend.com/zend/art/scriptcaching.php" rel="nofollow" target="_blank">http://www.zend.com/zend/art/scriptcaching.php</a>
<br />

<br />
it describes how to create static html from scripts, however, this technique is pretty easily applicable to images.
<br />

<br />
I've written a short script to outline how to adapt my above mentioned article for caching of thumbnails. see:
<br />
<a href="http://tzu.nme.at/php/cache.phps" rel="nofollow" target="_blank">http://tzu.nme.at/php/cache.phps</a></span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
</div>
</div>
</div></div></body></html>
