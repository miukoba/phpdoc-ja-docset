<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
 <head>
  <meta http-equiv="content-type" content="text/html; CHARSET=shift-jis">
  <title>ファイルの sha1 ハッシュを計算する</title>

  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <link media="all" rel="stylesheet" type="text/css" href="style.css"/>
 </head>
 <body class="docs" class="docs"><div class="navbar navbar-fixed-top">
  <div class="navbar-inner clearfix">
    <ul class="nav" style="width: 100%">
      <li style="float: left;"><a href="function.setlocale.html">≪ setlocale</a></li>
      <li style="float: right;"><a href="function.sha1.html">sha1 ≫</a></li>
    </ul>
  </div>
</div>
<div id="breadcrumbs" class="clearfix">
  <ul class="breadcrumbs-container">
    <li><a href="index.html">PHP Manual</a></li>
    <li><a href="ref.strings.html">String 関数</a></li>
    <li>ファイルの sha1 ハッシュを計算する</li>
  </ul>
</div>
<div id="layout">
  <div id="layout-content"><div id="function.sha1-file" class="refentry">
 <div class="refnamediv">
  <h1 class="refname">sha1_file</h1>
  <p class="verinfo">(PHP 4 &gt;= 4.3.0, PHP 5)</p><p class="refpurpose"><span class="refname">sha1_file</span> &mdash; <span class="dc-title">ファイルの sha1 ハッシュを計算する</span></p>

 </div>
 <div class="refsect1 description" id="refsect1-function.sha1-file-description">
  <h3 class="title">説明</h3>
  <div class="methodsynopsis dc-description">
   <span class="type">string</span> <span class="methodname"><strong>sha1_file</strong></span>
    ( <span class="methodparam"><span class="type">string</span> <code class="parameter">$filename</code></span>
   [, <span class="methodparam"><span class="type">bool</span> <code class="parameter">$raw_output</code><span class="initializer"> = false</span></span>
  ] )</div>

  <p class="simpara">
   <a href="http://www.faqs.org/rfcs/rfc3174" class="link external" title="Link : http://www.faqs.org/rfcs/rfc3174">&raquo;&nbsp;US Secure Hash Algorithm 1</a> を使用して
   <code class="parameter">filename</code> の sha1 ハッシュを計算し、そのハッシュを
   返します。ハッシュは 40 文字の 16 進数となります。
  </p>
 </div>


 <div class="refsect1 parameters" id="refsect1-function.sha1-file-parameters">
  <h3 class="title">パラメータ</h3>
  <p class="para">
   <dl>

    
     <dt>
<code class="parameter">filename</code></dt>

     <dd>

      <p class="para">
       ハッシュしたいファイルのファイル名。
      </p>
     </dd>

    
    
     <dt>
<code class="parameter">raw_output</code></dt>

     <dd>

      <p class="para">
       <strong><code>TRUE</code></strong> を指定すると、長さ 20 のバイナリフォーマットで
       ダイジェストを返します。
      </p>
     </dd>

    
   </dl>

  </p>
 </div>


 <div class="refsect1 returnvalues" id="refsect1-function.sha1-file-returnvalues">
  <h3 class="title">返り値</h3>
  <p class="para">
   成功した場合に文字列、それ以外の場合に <strong><code>FALSE</code></strong> を返します。
  </p>
 </div>


 <div class="refsect1 examples" id="refsect1-function.sha1-file-examples">
  <h3 class="title">例</h3>
  <p class="para">
   <div class="example" id="example-4970">
    <p><strong>例1 <span class="function"><strong>sha1_file()</strong></span> の例</strong></p>
    <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br /></span><span style="color: #007700">foreach(</span><span style="color: #0000BB">glob</span><span style="color: #007700">(</span><span style="color: #DD0000">'/home/Kalle/myproject/*.php'</span><span style="color: #007700">)&nbsp;as&nbsp;</span><span style="color: #0000BB">$ent</span><span style="color: #007700">)<br />{<br />&nbsp;&nbsp;&nbsp;&nbsp;if(</span><span style="color: #0000BB">is_dir</span><span style="color: #007700">(</span><span style="color: #0000BB">$ent</span><span style="color: #007700">))<br />&nbsp;&nbsp;&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;continue;<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;echo&nbsp;</span><span style="color: #0000BB">$ent&nbsp;</span><span style="color: #007700">.&nbsp;</span><span style="color: #DD0000">'&nbsp;(SHA1:&nbsp;'&nbsp;</span><span style="color: #007700">.&nbsp;</span><span style="color: #0000BB">sha1_file</span><span style="color: #007700">(</span><span style="color: #0000BB">$ent</span><span style="color: #007700">)&nbsp;.&nbsp;</span><span style="color: #DD0000">')'</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">PHP_EOL</span><span style="color: #007700">;<br />}<br /></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
    </div>

   </div>
  </p>
 </div>

 <div class="refsect1 changelog" id="refsect1-function.sha1-file-changelog">
  <h3 class="title">変更履歴</h3>
  <p class="para">
   <table class="doctable informaltable">
    
     <thead>
      <tr>
       <th>バージョン</th>
       <th>説明</th>
      </tr>

     </thead>

     <tbody class="tbody">
      <tr>
       <td>5.1.0</td>
       <td>
        ストリーム API を使用するように変更しました。つまり、
        <em>sha1_file(&#039;http://example.com/..&#039;)</em> のように
        ラッパーとともに使用できるということです。
       </td>
      </tr>

     </tbody>
    
   </table>

  </p>
 </div>


 <div class="refsect1 seealso" id="refsect1-function.sha1-file-seealso">
  <h3 class="title">参考</h3>
  <p class="para">
   <ul class="simplelist">
    <li class="member"><span class="function"><a href="function.sha1.html" class="function" rel="rdfs-seeAlso">sha1()</a> - 文字列の sha1 ハッシュを計算する</span></li>
    <li class="member"><span class="function"><a href="function.md5-file.html" class="function" rel="rdfs-seeAlso">md5_file()</a> - 指定したファイルのMD5ハッシュ値を計算する</span></li>
    <li class="member"><span class="function"><a href="function.crc32.html" class="function" rel="rdfs-seeAlso">crc32()</a> - 文字列の crc32 多項式計算を行う</span></li>
   </ul>
  </p>
 </div>

</div><div id="usernotes">
 <div class="head">
  <h3 class="title">User Contributed Notes</h3>
 </div>
<div id="allnotes">  <a name="104748""></a>
  <div class="note">
   <strong class="user">xijque at gmail dot com</strong>
   <a href="#104748" class="date">05-Jul-2011 04:13</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Just for the record - <br />
<br />
As some have pointed out, you have two ways to generate the hash of a file:<br />
Method 1 [this function]: sha1_file($file)<br />
Method 2: sha1(file_get_contents($file))<br />
<br />
It's important to realize that these two methods are NOT the same thing. If they were, I seriously doubt this function would exist.<br />
<br />
The key difference, as far as I can tell, is how the file's contents are loaded. The second method loads the entirety of $file into memory before passing it to sha1($str). Method two, however, loads the contents of $file as they are needed to create the hash.<br />
<br />
If you can guarantee that you'll only ever have to hash relatively small files, this difference means very little. If you have larger ones, though, loading the entirety of file into memory is a bad idea: best case, you slow down your server as it tries to handle the request; worse case, you run out of memory and don't get your hash at all.<br />
<br />
Just try to keep this in mind if you decide to load the file's contents yourself, in lieu of using this function. On my system, I was able to use this function to generate the hash of a 2.6GB file in 22 seconds, whereas I could not with the second method, due to an out-of-memory error (which took 185 seconds).</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="87183""></a>
  <div class="note">
   <strong class="user">vista_ at live dot se</strong>
   <a href="#87183" class="date">23-Nov-2008 01:05</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
<span class="default">&lt;?php<br />
&nbsp;&nbsp; &nbsp; </span><span class="keyword">if(!</span><span class="default">function_exists</span><span class="keyword">(</span><span class="string">'sha1_file'</span><span class="keyword">))<br />
&nbsp;&nbsp; &nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; function </span><span class="default">sha1_file</span><span class="keyword">(</span><span class="default">$file </span><span class="keyword">= </span><span class="default">null</span><span class="keyword">)<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if(</span><span class="default">is_null</span><span class="keyword">(</span><span class="default">$file</span><span class="keyword">) || !</span><span class="default">file_exists</span><span class="keyword">(</span><span class="default">$file</span><span class="keyword">))<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">trigger_error</span><span class="keyword">(</span><span class="string">'File is null or does not exists'</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; return </span><span class="default">sha1</span><span class="keyword">(</span><span class="default">file_get_contents</span><span class="keyword">(</span><span class="default">$file</span><span class="keyword">));<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; }<br />
</span><span class="default">?&gt;<br />
</span><br />
Remember, it's important to write a corret url like this:<br />
/home/snackzon/public_html/php/sha1.php</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="77635""></a>
  <div class="note">
   <strong class="user">schiros at invisihosting dot com</strong>
   <a href="#77635" class="date">06-Sep-2007 04:02</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If you've got a script that allows user file upload, and you want to prevent multiple uploads of the same file:<br />
<br />
&nbsp;&nbsp;&nbsp; &lt;?<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; session_start();<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $isDuplicate = false;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if(isset($_FILES["filename"]["tmp_name"]) &amp;&amp; file_exists($_FILES["filename"]["tmp_name"])) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $fileHash = sha1_file($_FILES["filename"]["tmp_name"]);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if(!isset($_SESSION["check_filelist"])) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $_SESSION["check_filelist"] = array($fileHash);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; elseif(in_array($fileHash,$_SESSION["check_filelist"])) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $isDuplicate = true;&nbsp; &nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; else {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $_SESSION["check_filelist"][] = $fileHash;&nbsp; &nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if($isDuplicate) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; echo "You've already uploaded that file";&nbsp; &nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; else{<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; // do some stuff&nbsp; &nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; ?&gt;</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="68651""></a>
  <div class="note">
   <strong class="user">admin at cmsrevolution dot com</strong>
   <a href="#68651" class="date">05-Aug-2006 05:02</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
checking the sha1 of the file. ideal for download scripts making sure the file the user is downloading is not currupt<br />
by checking the sha1 key<br />
<br />
<span class="default">&lt;?php<br />
$filename </span><span class="keyword">= </span><span class="string">'./Path/To/Your/File.zip'</span><span class="keyword">;<br />
<br />
if (</span><span class="default">file_exists</span><span class="keyword">(</span><span class="default">$filename</span><span class="keyword">)) {<br />
echo</span><span class="string">"i see the file"</span><span class="keyword">;<br />
} else {<br />
echo </span><span class="string">"recheck the link file maybe broken"</span><span class="keyword">;<br />
}<br />
</span><span class="default">$file </span><span class="keyword">= </span><span class="default">sha1_file</span><span class="keyword">(</span><span class="string">'./Path/To/Your/File.zip'</span><span class="keyword">);<br />
<br />
echo</span><span class="string">"&lt;br&gt;is file hash valid?"</span><span class="keyword">;<br />
echo</span><span class="string">"hash = add the hash here&lt;br&gt;"</span><span class="keyword">;<br />
echo</span><span class="string">"hash of file :"</span><span class="keyword">;<br />
print(</span><span class="default">$file</span><span class="keyword">);<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="61741""></a>
  <div class="note">
   <strong class="user">gubatron at gmail dot com</strong>
   <a href="#61741" class="date">10-Feb-2006 04:02</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
P2P programs like LimeWire utilize sha1 to identify files. However they do it in base32. Here's an utility class if you want to write a Gnutella client in PHP5<br />
<br />
/**<br />
Utility base32 SHA1 class for PHP5<br />
Copyright (C) 2006&nbsp; Karl Magdsick (original author for Python)<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; Angel Leon (ported to PHP5)<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; Lime Wire LLC<br />
<br />
This program is free software; you can redistribute it and/or<br />
modify it under the terms of the GNU General Public License<br />
as published by the Free Software Foundation; either version 2<br />
of the License, or (at your option) any later version.<br />
<br />
This program is distributed in the hope that it will be useful,<br />
but WITHOUT ANY WARRANTY; without even the implied warranty of<br />
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.&nbsp; See the<br />
GNU General Public License for more details.<br />
<br />
You should have received a copy of the GNU General Public License<br />
along with this program; if not, write to the Free Software<br />
Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA&nbsp; 02110-1301, USA.<br />
*/<br />
class SHA1 {<br />
&nbsp; static $BASE32_ALPHABET = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ234567';<br />
<br />
&nbsp; /** Given a file it creates a magnetmix */<br />
&nbsp; static function fileSHA1($file) {<br />
&nbsp;&nbsp;&nbsp; $raw = sha1_file($file,true);<br />
&nbsp;&nbsp;&nbsp; return SHA1::base32encode($raw);<br />
&nbsp; } //fileSHA1<br />
<br />
&nbsp; /** Takes raw input and converts it to base32 */<br />
&nbsp; static function base32encode($input) {<br />
&nbsp;&nbsp;&nbsp; $output = '';<br />
&nbsp;&nbsp;&nbsp; $position = 0;<br />
&nbsp;&nbsp;&nbsp; $storedData = 0;<br />
&nbsp;&nbsp;&nbsp; $storedBitCount = 0;<br />
&nbsp;&nbsp;&nbsp; $index = 0;<br />
<br />
&nbsp;&nbsp;&nbsp; while ($index &lt; strlen($input)) {<br />
&nbsp;&nbsp; &nbsp;&nbsp; $storedData &lt;&lt;= 8;<br />
&nbsp;&nbsp; &nbsp;&nbsp; $storedData += ord($input[$index]);<br />
&nbsp;&nbsp; &nbsp;&nbsp; $storedBitCount += 8;<br />
&nbsp;&nbsp; &nbsp;&nbsp; $index += 1;<br />
<br />
&nbsp;&nbsp; &nbsp;&nbsp; //take as much data as possible out of storedData<br />
&nbsp;&nbsp; &nbsp;&nbsp; while ($storedBitCount &gt;= 5) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $storedBitCount -= 5;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $output .= SHA1::$BASE32_ALPHABET[$storedData &gt;&gt; $storedBitCount];<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $storedData &amp;= ((1 &lt;&lt; $storedBitCount) - 1);<br />
&nbsp;&nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; } //while<br />
<br />
&nbsp;&nbsp;&nbsp; //deal with leftover data<br />
&nbsp;&nbsp;&nbsp; if ($storedBitCount &gt; 0) {<br />
&nbsp;&nbsp; &nbsp;&nbsp; $storedData &lt;&lt;= (5-$storedBitCount);<br />
&nbsp;&nbsp; &nbsp;&nbsp; $output .= SHA1::$BASE32_ALPHABET[$storedData];<br />
&nbsp;&nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp;&nbsp; return $output;<br />
&nbsp; } //base32encode<br />
<br />
}</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
</div>
</div>
</div></div></body></html>
