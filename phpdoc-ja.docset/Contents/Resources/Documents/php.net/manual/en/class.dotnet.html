<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
 <head>
  <meta http-equiv="content-type" content="text/html; CHARSET=shift-jis">
  <title>DOTNET 説明</title>

  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <link media="all" rel="stylesheet" type="text/css" href="style.css"/>
 </head>
 <body class="docs" class="docs"><div class="navbar navbar-fixed-top">
  <div class="navbar-inner clearfix">
    <ul class="nav" style="width: 100%">
      <li style="float: left;"><a href="class.com.html">≪ COM</a></li>
      <li style="float: right;"><a href="class.variant.html">VARIANT ≫</a></li>
    </ul>
  </div>
</div>
<div id="breadcrumbs" class="clearfix">
  <ul class="breadcrumbs-container">
    <li><a href="index.html">PHP Manual</a></li>
    <li><a href="book.com.html">COM</a></li>
    <li>DOTNET 説明</li>
  </ul>
</div>
<div id="layout">
  <div id="layout-content"><div id="class.dotnet" class="reference">
 
 <h1 class="title">DOTNET 説明</h1>
 <div class="partintro"><p class="verinfo">(PHP 4 &gt;= 4.1.0, PHP 5)</p>

 <div class="section" id="class.dotnet.class">
  <h2 class="title">説明</h2>
  <p class="simpara">
   DOTNET クラスにより、.Net アセンブリからクラスを生成して
   そのメソッドをコールしたりプロパティにアクセスしたりできるようになります。
  </p>
  <p class="simpara">
   <em>$obj = new DOTNET(&quot;assembly&quot;, &quot;classname&quot;)</em>
  </p>
 </div>
 <div class="section" id="dotnet.dotnet">
  <h2 class="title">メソッド</h2>
  <div class="methodsynopsis dc-description">
   <span class="methodname"><strong>DOTNET::DOTNET</strong></span>
    ( <span class="methodparam"><span class="type">string</span> <code class="parameter">$assembly_name</code></span>
   , <span class="methodparam"><span class="type">string</span> <code class="parameter">$class_name</code></span>
   [, <span class="methodparam"><span class="type">int</span> <code class="parameter">$codepage</code></span>
  ] )</div>

  <p class="para">
   DOTNET クラスのコンストラクタです。
   読み込むアセンブリ名を <code class="parameter">assembly_name</code>
   で指定し、アセンブリから生成するクラスを <code class="parameter">class_name</code>
   で指定します。unicode 文字列の変換に使用するため、オプションの
   パラメータ <code class="parameter">codepage</code> を設定することができます。
   コードページの詳細については <a href="class.com.html" class="xref">COM</a> クラスを
   参照ください。
  </p>
  <p class="para">
   返されるオブジェクトはオーバーロードされています。つまり、通常の
   クラスのような固定されたメソッドは存在しないということです。
   そのかわりに、プロパティやメソッドへのアクセスは COM を通じて
   DOTNET に渡されます。言い換えれば、.Net ランタイムが提供する
   機能によって .Net オブジェクトが COM 連携用にマップされているという
   ことです。
  </p>
  <p class="para">
   DOTNET オブジェクトが作成されると、PHP はそれを他の COM
   オブジェクトと同等のものとして扱い、同様の規則が適用されます。
  </p>
  <p class="para">
   <div class="example" id="example.dotnet">
    <p><strong>例1 DOTNET の例</strong></p>
    <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br />&nbsp;$stack&nbsp;</span><span style="color: #007700">=&nbsp;new&nbsp;</span><span style="color: #0000BB">DOTNET</span><span style="color: #007700">(</span><span style="color: #DD0000">"mscorlib"</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">"System.Collections.Stack"</span><span style="color: #007700">);<br />&nbsp;</span><span style="color: #0000BB">$stack</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">Push</span><span style="color: #007700">(</span><span style="color: #DD0000">".Net"</span><span style="color: #007700">);<br />&nbsp;</span><span style="color: #0000BB">$stack</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">Push</span><span style="color: #007700">(</span><span style="color: #DD0000">"Hello&nbsp;"</span><span style="color: #007700">);<br />&nbsp;echo&nbsp;</span><span style="color: #0000BB">$stack</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">Pop</span><span style="color: #007700">()&nbsp;.&nbsp;</span><span style="color: #0000BB">$stack</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">Pop</span><span style="color: #007700">();<br /></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
    </div>

   </div>
  </p>
  <blockquote class="note"><p><strong class="note">注意</strong>: 
   <p class="para">
    この機能を使用するには、Web サーバーに .Net ランタイムを
    インストールする必要があります。
   </p>
  </p></blockquote>
 </div>

 </div>
</div>
<div id="usernotes">
 <div class="head">
  <h3 class="title">User Contributed Notes</h3>
 </div>
<div id="allnotes">  <a name="114847""></a>
  <div class="note">
   <strong class="user">ricardopsj at gmail dot com</strong>
   <a href="#114847" class="date">14-Apr-2014 10:30</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Create an Excel Workbook using DOTNET.<br />
<br />
<span class="default">&lt;?php<br />
<br />
$full_assembly_string </span><span class="keyword">= </span><span class="string">'Microsoft.Office.Interop.Excel, Version=14.0.0.0, Culture=neutral, PublicKeyToken=71e9bce111e9429c'</span><span class="keyword">;<br />
</span><span class="default">$full_class_name </span><span class="keyword">= </span><span class="string">'Microsoft.Office.Interop.Excel.ApplicationClass'</span><span class="keyword">;<br />
<br />
</span><span class="default">$e </span><span class="keyword">= new </span><span class="default">DOTNET</span><span class="keyword">(</span><span class="default">$full_assembly_string</span><span class="keyword">, </span><span class="default">$full_class_name</span><span class="keyword">);<br />
</span><span class="default">$wb </span><span class="keyword">= </span><span class="default">$e</span><span class="keyword">-&gt;</span><span class="default">workbooks</span><span class="keyword">-&gt;</span><span class="default">add</span><span class="keyword">();<br />
</span><span class="default">$Precios </span><span class="keyword">= </span><span class="default">$wb</span><span class="keyword">-&gt;</span><span class="default">Worksheets</span><span class="keyword">(</span><span class="default">1</span><span class="keyword">);<br />
</span><span class="default">$Precios</span><span class="keyword">-&gt;</span><span class="default">Name </span><span class="keyword">= </span><span class="string">'Precios'</span><span class="keyword">;<br />
</span><span class="default">$Venta </span><span class="keyword">= </span><span class="default">$wb</span><span class="keyword">-&gt;</span><span class="default">Worksheets</span><span class="keyword">(</span><span class="default">2</span><span class="keyword">);<br />
</span><span class="default">$Venta</span><span class="keyword">-&gt;</span><span class="default">Name </span><span class="keyword">= </span><span class="string">'Venta'</span><span class="keyword">;<br />
</span><span class="default">$Tons </span><span class="keyword">= </span><span class="default">$wb</span><span class="keyword">-&gt;</span><span class="default">Worksheets</span><span class="keyword">(</span><span class="default">3</span><span class="keyword">);<br />
</span><span class="default">$Tons</span><span class="keyword">-&gt;</span><span class="default">Name </span><span class="keyword">= </span><span class="string">'Tons'</span><span class="keyword">;<br />
<br />
</span><span class="default">$Meses </span><span class="keyword">= Array(</span><span class="string">'2014-01'</span><span class="keyword">, </span><span class="string">'2014-02'</span><span class="keyword">, </span><span class="string">'2014-03'</span><span class="keyword">, </span><span class="string">'2014-04'</span><span class="keyword">, </span><span class="string">'2014-05'</span><span class="keyword">, </span><span class="string">'2014-06'</span><span class="keyword">, </span><span class="string">'2014-07'</span><span class="keyword">, </span><span class="string">'2014-08'</span><span class="keyword">, </span><span class="string">'2014-09'</span><span class="keyword">, </span><span class="string">'2014-10'</span><span class="keyword">, </span><span class="string">'2014-11'</span><span class="keyword">, </span><span class="string">'2014-12'</span><span class="keyword">);<br />
foreach (</span><span class="default">$Meses </span><span class="keyword">as </span><span class="default">$Numero </span><span class="keyword">=&gt; </span><span class="default">$Mes</span><span class="keyword">) {<br />
&nbsp;&nbsp; </span><span class="default">$Precios</span><span class="keyword">-&gt;</span><span class="default">Range</span><span class="keyword">(</span><span class="string">"A" </span><span class="keyword">. (</span><span class="default">$Numero</span><span class="keyword">+</span><span class="default">1</span><span class="keyword">))-&gt;</span><span class="default">Value </span><span class="keyword">= </span><span class="default">$Mes</span><span class="keyword">;<br />
}<br />
<br />
</span><span class="default">$wb</span><span class="keyword">-&gt;</span><span class="default">SaveAs</span><span class="keyword">(</span><span class="string">'c:\temp\Meta.2014.05.xlsx'</span><span class="keyword">);<br />
</span><span class="default">$wb</span><span class="keyword">-&gt;</span><span class="default">Close</span><span class="keyword">();<br />
<br />
</span><span class="default">?&gt;<br />
</span><br />
Go to c:\windows\assembly to know what value to put in $full_assembly_string.<br />
<br />
If you don't know the assembly, use <a href="http://www.red-gate.com/products/dotnet-development/reflector/ to browse it, use what you learn there to fill $full_class_name." rel="nofollow" target="_blank">http://www.red-gate.com/products/dotnet-development/reflector/ to browse it, use what you learn there to fill $full_class_name.</a><br />
<br />
Enjoy,<br />
<br />
Ricardo.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="114043""></a>
  <div class="note">
   <strong class="user">jan dot zahradnik at data3s dot com</strong>
   <a href="#114043" class="date">06-Jan-2014 06:17</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
PHP searches only GAC for .NET 2.0 runtime, so your DLL has to be targeted 2.0 - 3.5 framework.<br />
<br />
Also it recognize only classes, not stucts, so you can't instantiate DateTime for example.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="104660""></a>
  <div class="note">
   <strong class="user">sandips (yardi)</strong>
   <a href="#104660" class="date">29-Jun-2011 11:57</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
exercise to try different type of method signature and calling them in php.<br />
<br />
VB.net Code<br />
Public Class Class1<br />
&nbsp;&nbsp;&nbsp; Public Function SayHello(ByVal input As String) As String<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; Return "Php input: " &amp; input &amp; "&lt;/BR&gt;Dot net library said- 'Hello'"<br />
&nbsp;&nbsp;&nbsp; End Function<br />
&nbsp;&nbsp;&nbsp; Public Function ConcatArray(ByVal Values As Object()) As String<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; Dim ret As String = String.Empty<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; For Each sval As Object In Values<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; ret = ret &amp; sval.ToString &amp; " "<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; Next<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; Return ret.Substring(1, ret.Length - 1)<br />
&nbsp;&nbsp;&nbsp; End Function<br />
&nbsp;&nbsp;&nbsp; Public Function ReturnObject(ByVal FirstName As String, ByVal LastName As String) As Name<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; Dim obj As New Name<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; obj.FirstName = FirstName<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; obj.LastName = LastName<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; Return obj<br />
&nbsp;&nbsp;&nbsp; End Function<br />
'To explain Byref doesn't work with php<br />
&nbsp;&nbsp;&nbsp; Public Function CallByRef(ByRef value As String) As String<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; value = "Value to ByRef parameter set in dot net."<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; Return "ByRef CallByRef() method called."<br />
&nbsp;&nbsp;&nbsp; End Function<br />
End Class<br />
<br />
Public Class Name<br />
&nbsp;&nbsp;&nbsp; Public FirstName As String = String.Empty<br />
&nbsp;&nbsp;&nbsp; Public LastName As String = String.Empty<br />
End Class<br />
<br />
Php code to test .net library<br />
<span class="default">&lt;?php<br />
&nbsp; $class1 </span><span class="keyword">= new </span><span class="default">DOTNET</span><span class="keyword">(</span><span class="string">"DotNetTest,"<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">.</span><span class="string">"Version=1.0.0.0,"<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">.</span><span class="string">"Culture=neutral,"<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">.</span><span class="string">"PublicKeyToken=6675daefc27eafc4"&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">,</span><span class="string">"DotNetTest.Class1"</span><span class="keyword">);<br />
&nbsp;echo </span><span class="default">$class1</span><span class="keyword">-&gt;</span><span class="default">SayHello</span><span class="keyword">(</span><span class="string">"Hi PHP!!!!"</span><span class="keyword">);<br />
&nbsp;echo </span><span class="string">"&lt;/P&gt;"</span><span class="keyword">;<br />
<br />
&nbsp;</span><span class="default">$parameter</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">] = </span><span class="default">12345</span><span class="keyword">;<br />
&nbsp;</span><span class="default">$parameter</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">] = </span><span class="string">"MyString"</span><span class="keyword">;<br />
&nbsp;</span><span class="default">$parameter</span><span class="keyword">[</span><span class="default">2</span><span class="keyword">] = </span><span class="default">false</span><span class="keyword">;<br />
&nbsp;</span><span class="default">$ret </span><span class="keyword">= </span><span class="default">$class1 </span><span class="keyword">-&gt; </span><span class="default">ConcatArray</span><span class="keyword">(</span><span class="default">$parameter</span><span class="keyword">);<br />
&nbsp;echo </span><span class="default">$ret</span><span class="keyword">;<br />
&nbsp;echo </span><span class="string">"&lt;/P&gt;"</span><span class="keyword">;<br />
<br />
&nbsp;</span><span class="default">$Obj </span><span class="keyword">= </span><span class="default">$class1 </span><span class="keyword">-&gt; </span><span class="default">ReturnObject</span><span class="keyword">(</span><span class="string">"Sandip"</span><span class="keyword">,</span><span class="string">"Shimpi"</span><span class="keyword">);<br />
&nbsp;echo </span><span class="default">$Obj</span><span class="keyword">-&gt;</span><span class="default">FirstName</span><span class="keyword">.</span><span class="string">" "</span><span class="keyword">.</span><span class="default">$Obj</span><span class="keyword">-&gt;</span><span class="default">LastName</span><span class="keyword">;<br />
<br />
&nbsp;echo </span><span class="string">"&lt;/P&gt;"</span><span class="keyword">;<br />
&nbsp;</span><span class="default">$myByRef </span><span class="keyword">= </span><span class="string">""</span><span class="keyword">;<br />
&nbsp;echo </span><span class="string">"Value of ByRef Variable before calling .net CallByRef() method: "</span><span class="keyword">.</span><span class="default">$myByRef</span><span class="keyword">;<br />
&nbsp;echo </span><span class="string">"&lt;/BR&gt;"</span><span class="keyword">;<br />
&nbsp;echo </span><span class="default">$class1 </span><span class="keyword">-&gt; </span><span class="default">CallByRef</span><span class="keyword">(</span><span class="default">$myByRef</span><span class="keyword">);<br />
&nbsp;echo </span><span class="string">"&lt;/BR&gt;"</span><span class="keyword">;<br />
&nbsp;echo </span><span class="string">"Now value of ByRef Variable: "</span><span class="keyword">.</span><span class="default">$myByRef</span><span class="keyword">;<br />
&nbsp;echo </span><span class="default">$myByRef</span><span class="keyword">;<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="98745""></a>
  <div class="note">
   <strong class="user">Anonymous</strong>
   <a href="#98745" class="date">05-Jul-2010 02:17</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
As suggested before, you'll likely have to use a full assembly string including the assembly name, the assembly version (not the dll file version), the culture, and the public key token.&nbsp; Otherwise, you'll get a 'file not found' catchable error.&nbsp; To quickly find this on your own system to get the ball rolling, open C:\Windows\assembly in explorer (not in cmd as that shows a different view), scroll down the list until you find the assembly you want to work with, hover the mouse over it, and the tooltip shows the exact string to use (though processcorArchitecture if shown is optional).&nbsp; You'll have to use .net utilities or other methods to automate collecting this info on other machines.<br />
<br />
You'll also have to use the fully-qualified class name.&nbsp; In other words, if you want to use the 'Form' class within 'System.Windows.Forms', you have to use the full class hierarchy 'System.Windows.Forms.Form'.&nbsp; Otherwise you'll get an unhelpful 'Failed to instantiate .Net object' catchable error.<br />
<br />
The following example shows the correct syntax to use the 'Form' class to pop up a blank form from php-cli, which can be used in leu of many Windows GUI PHP extensions out there.&nbsp; Replace Version with your local version, and PublicKeyToken with your own local key token.<br />
<br />
<span class="default">&lt;?php<br />
<br />
$full_assembly_string </span><span class="keyword">= </span><span class="string">'System.Windows.Forms, Version=2.0.0.0, Culture=neutral, PublicKeyToken=a8425bc35256e463'</span><span class="keyword">;<br />
</span><span class="default">$full_class_name </span><span class="keyword">= </span><span class="string">'System.Windows.Forms.Form'</span><span class="keyword">;<br />
</span><span class="default">$form </span><span class="keyword">= new </span><span class="default">DOTNET</span><span class="keyword">(</span><span class="default">$full_assembly_string</span><span class="keyword">, </span><span class="default">$full_class_name</span><span class="keyword">);<br />
<br />
</span><span class="comment">// code to add buttons, menus, text, etc<br />
<br />
</span><span class="default">$form</span><span class="keyword">-&gt;</span><span class="default">Show</span><span class="keyword">();<br />
<br />
</span><span class="default">$form_event </span><span class="keyword">= </span><span class="string">''</span><span class="keyword">;<br />
while(</span><span class="default">$form_event </span><span class="keyword">!== </span><span class="string">'close'</span><span class="keyword">) {<br />
<br />
&nbsp; </span><span class="comment">// handle form functions and events<br />
<br />
&nbsp; </span><span class="keyword">}<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="96170""></a>
  <div class="note">
   <strong class="user">murat at muratyaman dot co dot uk</strong>
   <a href="#96170" class="date">12-Feb-2010 02:46</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
First, I hit the same mine:<br />
<br />
"... Failed to instantiate .Net object [Unwrapped, QI for IDispatch] [0x80004002] No such interface supported ..."<br />
<br />
In order to load the assembly and class in it successfully, I had to change my AssemblyInfo.cs file regarding the visibility of the types in it.<br />
<br />
// some code above<br />
<br />
// This sets the default COM visibility of types in the assembly to invisible.<br />
// If you need to expose a type to COM, use [ComVisible(true)] on that type.<br />
[assembly: ComVisible(true)]<br />
<br />
// some code below</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="93662""></a>
  <div class="note">
   <strong class="user">m holmes at windowlogic dot com dot au</strong>
   <a href="#93662" class="date">22-Sep-2009 06:31</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
For strongly-named NET assemblies that are registered in the GAC, you can just use the assembly name<br />
e.g: $x = new DOTNET ("myAssembly", "myClass");<br />
<br />
For strongly-named NET assemblies that aren't registered in the GAC, you need to use the full assembly string<br />
e.g. $x = new DOTNET('myAssembly, Version=X.X.X.X, Culture=neutral, PublicKeyToken=ZZZZZZZZZZZZ', 'myClass');<br />
<br />
You can't instantiate assemblies that haven't been strongly named.<br />
<br />
"Strongly named" means that the assembly has a public key. To strongly name your own classes in Visual Studio, go to the Signing tab in the project properties and click the 'sign the assembly' box and choose a key file name.<br />
<br />
To register an assembly in the GAC, there are various tools around to do that, but the easiest method is to drag-and-drop the compiled assembly into c:\windows\assembly using windows explorer (a shell extension is installed by default that handles registering dragged files).</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="90168""></a>
  <div class="note">
   <strong class="user">kschroeder at mirageworks dot com</strong>
   <a href="#90168" class="date">08-Apr-2009 08:55</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
In order to find out what the PublicKeyToken value is, open up Explorer and go to c:\windows\assembly.&nbsp; In that directory you will see all of the registered assemblies along with their PublicKeyToken value.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="82932""></a>
  <div class="note">
   <strong class="user">sam at bitopia dot co dot uk</strong>
   <a href="#82932" class="date">02-May-2008 05:54</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If you want to load any other assembly apart from mscorlib, you'll need to include it like the following<br />
<br />
$x = new DOTNET('The.Assembly.Name, Version=X.X.X.X, Culture=neutral, PublicKeyToken=ZZZZZZZZZZZZ', 'The.Class.Name');<br />
<br />
Replace all relevant details.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
</div>
</div>
</div></div></body></html>
