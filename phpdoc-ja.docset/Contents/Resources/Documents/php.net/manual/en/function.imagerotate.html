<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
 <head>
  <meta http-equiv="content-type" content="text/html; CHARSET=shift-jis">
  <title>指定された角度で画像を回転する</title>

  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <link media="all" rel="stylesheet" type="text/css" href="style.css"/>
 </head>
 <body class="docs" class="docs"><div class="navbar navbar-fixed-top">
  <div class="navbar-inner clearfix">
    <ul class="nav" style="width: 100%">
      <li style="float: left;"><a href="function.imagerectangle.html">≪ imagerectangle</a></li>
      <li style="float: right;"><a href="function.imagesavealpha.html">imagesavealpha ≫</a></li>
    </ul>
  </div>
</div>
<div id="breadcrumbs" class="clearfix">
  <ul class="breadcrumbs-container">
    <li><a href="index.html">PHP Manual</a></li>
    <li><a href="ref.image.html">GD および Image 関数</a></li>
    <li>指定された角度で画像を回転する</li>
  </ul>
</div>
<div id="layout">
  <div id="layout-content"><div id="function.imagerotate" class="refentry">
 <div class="refnamediv">
  <h1 class="refname">imagerotate</h1>
  <p class="verinfo">(PHP 4 &gt;= 4.3.0, PHP 5)</p><p class="refpurpose"><span class="refname">imagerotate</span> &mdash; <span class="dc-title">指定された角度で画像を回転する</span></p>

 </div>
 <div class="refsect1 description" id="refsect1-function.imagerotate-description">
  <h3 class="title">説明</h3>
  <div class="methodsynopsis dc-description">
   <span class="type">resource</span> <span class="methodname"><strong>imagerotate</strong></span>
    ( <span class="methodparam"><span class="type">resource</span> <code class="parameter">$image</code></span>
   , <span class="methodparam"><span class="type">float</span> <code class="parameter">$angle</code></span>
   , <span class="methodparam"><span class="type">int</span> <code class="parameter">$bgd_color</code></span>
   [, <span class="methodparam"><span class="type">int</span> <code class="parameter">$ignore_transparent</code><span class="initializer"> = 0</span></span>
  ] )</div>

  <p class="para rdfs-comment">
   画像 <code class="parameter">image</code> を、
   <code class="parameter">angle</code> で指定された角度だけ回転します。
  </p>
  <p class="para">
   回転の中心は画像の中心です。
   回転後の画像の大きさは、もとの大きさと異なる可能性があります。
  </p>
 </div>

 <div class="refsect1 parameters" id="refsect1-function.imagerotate-parameters">
  <h3 class="title">パラメータ</h3>
  <p class="para">
   <dl>

    <dt>
<code class="parameter">
image</code></dt>
<dd>
<p class="para"><span class="function"><a href="function.imagecreatetruecolor.html" class="function">imagecreatetruecolor()</a></span>
のような画像作成関数が返す画像リソース。</p></dd>

    
     <dt>
<code class="parameter">angle</code></dt>

     <dd>

      <p class="para">
       回転角度。これは、画像を反時計回りに回転させるときの度数を表します。
      </p>
     </dd>

    
    
     <dt>
<code class="parameter">bgd_color</code></dt>

     <dd>

      <p class="para">
       回転後、カバーされない部分の色。
      </p>
     </dd>

    
    
     <dt>
<code class="parameter">ignore_transparent</code></dt>

     <dd>

      <p class="para">
       ゼロ以外を指定すると、透過色は無視されます
       (その他の場合は保持されます)。
      </p>
     </dd>

    
   </dl>

  </p>
 </div>

 <div class="refsect1 returnvalues" id="refsect1-function.imagerotate-returnvalues">
  <h3 class="title">返り値</h3>
  <p class="para">
   回転させた画像のリソースを返します。失敗した場合に <strong><code>FALSE</code></strong> を返します。
  </p>
 </div>

 <div class="refsect1 changelog" id="refsect1-function.imagerotate-changelog">
  <h3 class="title">変更履歴</h3>
  <p class="para">
   <table class="doctable informaltable">
    
     <thead>
      <tr>
       <th>バージョン</th>
       <th>説明</th>
      </tr>

     </thead>

     <tbody class="tbody">
      <tr>
       <td>5.5.0</td>
       <td>
        <span class="function"><a href="function.imagesetinterpolation.html" class="function">imagesetinterpolation()</a></span> 関数で設定した補間方式の影響を受けるようになりました。
       </td>
      </tr>

      <tr>
       <td>5.1.0</td>
       <td>
        <code class="parameter">ignore_transparent</code> が追加されました。
       </td>
      </tr>

     </tbody>
    
   </table>

  </p>
 </div>

 <div class="refsect1 examples" id="refsect1-function.imagerotate-examples">
  <h3 class="title">例</h3>
  <p class="para">
   <div class="example" id="example-3364">
    <p><strong>例1 画像を 180 度回転する</strong></p>
    <div class="example-contents"><p>
     この例は、画像を 180 度 - 上下逆さまに回転します
    </p></div>
    <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br /></span><span style="color: #FF8000">//&nbsp;ファイルと回転角<br /></span><span style="color: #0000BB">$filename&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #DD0000">'test.jpg'</span><span style="color: #007700">;<br /></span><span style="color: #0000BB">$degrees&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">180</span><span style="color: #007700">;<br /><br /></span><span style="color: #FF8000">//&nbsp;コンテントタイプ<br /></span><span style="color: #0000BB">header</span><span style="color: #007700">(</span><span style="color: #DD0000">'Content-type:&nbsp;image/jpeg'</span><span style="color: #007700">);<br /><br /></span><span style="color: #FF8000">//&nbsp;読み込み<br /></span><span style="color: #0000BB">$source&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">imagecreatefromjpeg</span><span style="color: #007700">(</span><span style="color: #0000BB">$filename</span><span style="color: #007700">);<br /><br /></span><span style="color: #FF8000">//&nbsp;回転<br /></span><span style="color: #0000BB">$rotate&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">imagerotate</span><span style="color: #007700">(</span><span style="color: #0000BB">$source</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$degrees</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">0</span><span style="color: #007700">);<br /><br /></span><span style="color: #FF8000">//&nbsp;出力<br /></span><span style="color: #0000BB">imagejpeg</span><span style="color: #007700">(</span><span style="color: #0000BB">$rotate</span><span style="color: #007700">);<br /><br /></span><span style="color: #FF8000">//&nbsp;メモリの解放<br /></span><span style="color: #0000BB">imagedestroy</span><span style="color: #007700">(</span><span style="color: #0000BB">$source</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">imagedestroy</span><span style="color: #007700">(</span><span style="color: #0000BB">$rotate</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
    </div>

    <div class="example-contents"><p>上の例の出力は、
たとえば以下のようになります。</p></div>
    <div class="mediaobject">
     
     <div class="imageobject">
      <img src="images/21009b70229598c6a80eef8b45bf282b-imagerotate.jpg" alt="出力例 : 画像を 180 度回転する" width="95" height="51" />
     </div>
    </div>
   </div>
  </p>
 </div>

 <div class="refsect1 notes" id="refsect1-function.imagerotate-notes">
  <h3 class="title">注意</h3>
  <blockquote class="note"><p><strong class="note">注意</strong>: <p class="para">この関数は、<span class="function"><a href="function.imagesetinterpolation.html" class="function">imagesetinterpolation()</a></span> で設定した補間方式の影響を受けます。</p></p></blockquote>
 </div>

 <div class="refsect1 seealso" id="refsect1-function.imagerotate-seealso">
  <h3 class="title">参考</h3>
  <p class="para">
   <ul class="simplelist">
    <li class="member"><span class="function"><a href="function.imagesetinterpolation.html" class="function" rel="rdfs-seeAlso">imagesetinterpolation()</a> - 補間方法を設定する</span></li>
   </ul>
  </p>
 </div>

</div><div id="usernotes">
 <div class="head">
  <h3 class="title">User Contributed Notes</h3>
 </div>
<div id="allnotes">  <a name="109432""></a>
  <div class="note">
   <strong class="user">meisterix at gmx dot com</strong>
   <a href="#109432" class="date">17-Jul-2012 06:24</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
After some INet searches and personal try-and-failures I succeed to rotate PNG images with preserving alpha channel transparency (semi transparency).<br />
<br />
<span class="default">&lt;?php<br />
&nbsp;&nbsp;&nbsp; $filename </span><span class="keyword">= </span><span class="string">'YourFile.png'</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$rotang </span><span class="keyword">= </span><span class="default">20</span><span class="keyword">; </span><span class="comment">// Rotation angle<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$source </span><span class="keyword">= </span><span class="default">imagecreatefrompng</span><span class="keyword">(</span><span class="default">$filename</span><span class="keyword">) or die(</span><span class="string">'Error opening file '</span><span class="keyword">.</span><span class="default">$filename</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">imagealphablending</span><span class="keyword">(</span><span class="default">$source</span><span class="keyword">, </span><span class="default">false</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">imagesavealpha</span><span class="keyword">(</span><span class="default">$source</span><span class="keyword">, </span><span class="default">true</span><span class="keyword">);<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$rotation </span><span class="keyword">= </span><span class="default">imagerotate</span><span class="keyword">(</span><span class="default">$source</span><span class="keyword">, </span><span class="default">$rotang</span><span class="keyword">, </span><span class="default">imageColorAllocateAlpha</span><span class="keyword">(</span><span class="default">$source</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">127</span><span class="keyword">));<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">imagealphablending</span><span class="keyword">(</span><span class="default">$rotation</span><span class="keyword">, </span><span class="default">false</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">imagesavealpha</span><span class="keyword">(</span><span class="default">$rotation</span><span class="keyword">, </span><span class="default">true</span><span class="keyword">);<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">header</span><span class="keyword">(</span><span class="string">'Content-type: image/png'</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">imagepng</span><span class="keyword">(</span><span class="default">$rotation</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">imagedestroy</span><span class="keyword">(</span><span class="default">$source</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">imagedestroy</span><span class="keyword">(</span><span class="default">$rotation</span><span class="keyword">);<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="107043""></a>
  <div class="note">
   <strong class="user">henzeberkheij at gmail dot com</strong>
   <a href="#107043" class="date">01-Jan-2012 11:27</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Keep in mind this function rotates counterclockwise.&nbsp; if you want to go 90 degrees clockwise, you have to tell imagerotate to go 270 degrees counter-clockwise.<br />
<br />
$angle = 360-$angle;</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="105957""></a>
  <div class="note">
   <strong class="user">Sam Yong - hellclanner at live dot com</strong>
   <a href="#105957" class="date">28-Sep-2011 03:20</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Note that the image resource returned from the imagerotate() function is an entirely different image resource from your original one.<br />
<br />
<span class="default">&lt;?php<br />
<br />
$res </span><span class="keyword">= </span><span class="default">imagecreatetruecolor</span><span class="keyword">(</span><span class="default">100</span><span class="keyword">, </span><span class="default">200</span><span class="keyword">);<br />
</span><span class="default">$res2 </span><span class="keyword">= </span><span class="default">imagerotate</span><span class="keyword">(</span><span class="default">$res</span><span class="keyword">, </span><span class="default">90</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">);<br />
</span><span class="default">var_dump</span><span class="keyword">(</span><span class="default">$res</span><span class="keyword">, </span><span class="default">$res2</span><span class="keyword">);<br />
<br />
</span><span class="default">?&gt;<br />
</span><br />
This will output:<br />
<br />
resource(2, gd)<br />
resource(3, gd)</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="103029""></a>
  <div class="note">
   <strong class="user">kraeh at gmx dot net</strong>
   <a href="#103029" class="date">21-Mar-2011 06:02</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I had a problem with a png image containing transparent colors, but found a solution that works for me.
<br />
So i thought i might share it:
<br />

<br />
<span class="default">&lt;?php
<br />
$angle</span><span class="keyword">=</span><span class="default">45</span><span class="keyword">;
<br />
</span><span class="default">$im</span><span class="keyword">=</span><span class="default">imagerotate</span><span class="keyword">(</span><span class="default">$im</span><span class="keyword">, </span><span class="default">$angle</span><span class="keyword">, -</span><span class="default">1</span><span class="keyword">);
<br />
</span><span class="default">imagealphablending</span><span class="keyword">(</span><span class="default">$im</span><span class="keyword">, </span><span class="default">true</span><span class="keyword">);
<br />
</span><span class="default">imagesavealpha</span><span class="keyword">(</span><span class="default">$im</span><span class="keyword">, </span><span class="default">true</span><span class="keyword">);
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="101251""></a>
  <div class="note">
   <strong class="user">superzouz at hotmail dot com</strong>
   <a href="#101251" class="date">05-Dec-2010 08:30</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If you're having trouble rotating images through this function, please note that you can rotate images through CSS. As imagerotate() seems to remove image transparency, I resorted to CSS rotate. Here is an example of CSS code that should work across most browsers:<br />
<br />
img.rotated90 {<br />
&nbsp;&nbsp;&nbsp; /* CSS3 then proprietary code */<br />
&nbsp;&nbsp;&nbsp; rotation: 90deg;<br />
&nbsp;&nbsp;&nbsp; -webkit-transform: rotate(90deg);<br />
&nbsp;&nbsp;&nbsp; -moz-transform: rotate(90deg);<br />
&nbsp;&nbsp;&nbsp; filter: progid:DXImageTransform.Microsoft.BasicImage(rotation=1);<br />
}</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="99631""></a>
  <div class="note">
   <strong class="user">Leo</strong>
   <a href="#99631" class="date">27-Aug-2010 03:32</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
// angle in degrees, clockwise, allowed values from 0 to 360 degrees<br />
&nbsp;&nbsp;&nbsp; function rotateImage ($image, $angle)<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if ( ($angle &lt; 0) || ($angle &gt; 360) )<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; exit ("Error, angle passed out of range: [0,360]");<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $width&nbsp; &nbsp; = imagesx ($image);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $height&nbsp; &nbsp; = imagesy ($image);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $dstImage = imagecreatetruecolor ($width, $height);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if ( ($angle == 0) || ($angle == 360) )<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; // Just copy image to output:<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; imagecopy ($dstImage, $image, 0, 0, 0, 0, $width, $height);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; else<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $centerX = floor ($width / 2);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $centerY = floor ($height / 2);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; // Run on all pixels of the destination image and fill them:<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; for ($dstImageX = 0; $dstImageX &lt; $width; $dstImageX++)<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; for ($dstImageY = 0; $dstImageY &lt; $height; $dstImageY++)<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; // Calculate pixel coordinate in coordinate system centered at the image center:<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $x = $dstImageX - $centerX;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $y = $centerY - $dstImageY;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if ( ($x == 0) &amp;&amp; ($y == 0) )<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; // We are in the image center, this pixel should be copied as is:<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $srcImageX = $x;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $srcImageY = $y;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; else<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $r = sqrt ($x * $x + $y * $y); // radius - absolute distance of the current point from image center<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $curAngle = asin ($y / $r); // angle of the current point [rad]<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if ($x &lt; 0)<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $curAngle = pi () - $curAngle;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $newAngle = $curAngle + $angle * pi () / 180; // new angle [rad]<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; // Calculate new point coordinates (after rotation) in coordinate system at image center<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $newXRel = floor ($r * cos ($newAngle));<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $newYRel = floor ($r * sin ($newAngle));<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; // Convert to image absolute coordinates<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $srcImageX = $newXRel + $centerX;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $srcImageY = $centerY - $newYRel;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $pixelColor = imagecolorat&nbsp; ($image, $srcImageX, $srcImageY); // get source pixel color<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; imagesetpixel ($dstImage, $dstImageX, $dstImageY, $pixelColor); // write destination pixel<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return $dstImage;<br />
&nbsp;&nbsp;&nbsp; }</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="99591""></a>
  <div class="note">
   <strong class="user">xavtak at gmail dot com</strong>
   <a href="#99591" class="date">25-Aug-2010 05:38</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I've benchmarked three methods described here for rotating an image.<br />
<br />
I used a 1600 x 1200 jpeg picture that was duplicated ten times on the disk. I looped through them to apply a CW rotation using either method.<br />
<br />
First algorithm (the "imagesetpixel" algorithm):<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">function </span><span class="default">CWRotation</span><span class="keyword">(</span><span class="default">$image</span><span class="keyword">)<br />
{<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$w </span><span class="keyword">= </span><span class="default">imagesx</span><span class="keyword">(</span><span class="default">$image</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$h </span><span class="keyword">= </span><span class="default">imagesy</span><span class="keyword">(</span><span class="default">$image</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$result </span><span class="keyword">= @</span><span class="default">imagecreatetruecolor</span><span class="keyword">(</span><span class="default">$h</span><span class="keyword">, </span><span class="default">$w</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; if(</span><span class="default">$result</span><span class="keyword">)<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; for (</span><span class="default">$i </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">; </span><span class="default">$i </span><span class="keyword">&lt; </span><span class="default">$w</span><span class="keyword">; </span><span class="default">$i</span><span class="keyword">++)<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; for (</span><span class="default">$j </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">; </span><span class="default">$j </span><span class="keyword">&lt; </span><span class="default">$h</span><span class="keyword">; </span><span class="default">$j</span><span class="keyword">++)<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$ref </span><span class="keyword">= </span><span class="default">imagecolorat</span><span class="keyword">(</span><span class="default">$image</span><span class="keyword">, </span><span class="default">$i</span><span class="keyword">, </span><span class="default">$j</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">imagesetpixel</span><span class="keyword">(</span><span class="default">$result</span><span class="keyword">, (</span><span class="default">$h </span><span class="keyword">- </span><span class="default">1</span><span class="keyword">) - </span><span class="default">$j</span><span class="keyword">, </span><span class="default">$i</span><span class="keyword">, </span><span class="default">$ref</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; return </span><span class="default">$result</span><span class="keyword">;<br />
}<br />
</span><span class="default">?&gt;<br />
</span><br />
Second algorithm (the "imagecopy" algorithm):<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">function </span><span class="default">CWRotation</span><span class="keyword">(</span><span class="default">$image</span><span class="keyword">)<br />
{<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$w </span><span class="keyword">= </span><span class="default">imagesx</span><span class="keyword">(</span><span class="default">$image</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$h </span><span class="keyword">= </span><span class="default">imagesy</span><span class="keyword">(</span><span class="default">$image</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$result </span><span class="keyword">= @</span><span class="default">imagecreatetruecolor</span><span class="keyword">(</span><span class="default">$h</span><span class="keyword">, </span><span class="default">$w</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; if(</span><span class="default">$result</span><span class="keyword">)<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; for (</span><span class="default">$i </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">; </span><span class="default">$i </span><span class="keyword">&lt; </span><span class="default">$w</span><span class="keyword">; </span><span class="default">$i</span><span class="keyword">++)<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; for (</span><span class="default">$j </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">; </span><span class="default">$j </span><span class="keyword">&lt; </span><span class="default">$h</span><span class="keyword">; </span><span class="default">$j</span><span class="keyword">++)<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">imagecopy</span><span class="keyword">(</span><span class="default">$result</span><span class="keyword">, </span><span class="default">$image</span><span class="keyword">, (</span><span class="default">$h </span><span class="keyword">- </span><span class="default">1</span><span class="keyword">) - </span><span class="default">$j</span><span class="keyword">, </span><span class="default">$i</span><span class="keyword">, </span><span class="default">$i</span><span class="keyword">, </span><span class="default">$j</span><span class="keyword">, </span><span class="default">1</span><span class="keyword">, </span><span class="default">1</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; return </span><span class="default">$result</span><span class="keyword">;<br />
}<br />
</span><span class="default">?&gt;<br />
</span><br />
Third algorithm (the "imagerotate" algorithm):<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">function </span><span class="default">CWRotation</span><span class="keyword">(</span><span class="default">$image</span><span class="keyword">)<br />
{<br />
&nbsp;&nbsp;&nbsp; return </span><span class="default">imagerotate</span><span class="keyword">(</span><span class="default">$image</span><span class="keyword">, </span><span class="default">270</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">);<br />
}<br />
</span><span class="default">?&gt;<br />
</span><br />
In each step of the loop, the image is loaded, rotated then a copy is written on the disk.<br />
<br />
Here are the results:<br />
imagesetpixel algorithm: the 10 pictures were processed in 29 seconds<br />
imagecopy algorithm: the 10 pictures were processed in 26 seconds<br />
imagerotate algorithm: the 10 pictures were processed in 2 seconds (no typo here)<br />
<br />
Writing the pictures on the disk allowed me to control the results. Every resulting picture was the same (tested with winmerge).<br />
<br />
Conclusion: imagerotate is way faster than other "home-made" algorithms.<br />
I ran the tests several times to see if the difference between imagesetpixel and imagecopy was introduced by my computer's independent activity, but I always got that 10% difference.<br />
<br />
Note: the picture I used was taken from a camera, so no transparency was involved.<br />
I ran the tests on Windows XP using PHP Version 5.3.0</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="96563""></a>
  <div class="note">
   <strong class="user">kmrohe at letsco dot de</strong>
   <a href="#96563" class="date">05-Mar-2010 12:00</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
As an alternative to the GD rotateImage() function, this is an easy way to rotate images by 90 degrees ccw *without* loosing transparency:<br />
<br />
<span class="default">&lt;?php<br />
<br />
&nbsp; </span><span class="keyword">function </span><span class="default">rotateImage</span><span class="keyword">(</span><span class="default">$image</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="default">$width </span><span class="keyword">= </span><span class="default">imagesx</span><span class="keyword">(</span><span class="default">$image</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="default">$height </span><span class="keyword">= </span><span class="default">imagesy</span><span class="keyword">(</span><span class="default">$image</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="default">$newImage</span><span class="keyword">= </span><span class="default">imagecreatetruecolor</span><span class="keyword">(</span><span class="default">$height</span><span class="keyword">, </span><span class="default">$width</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="default">imagealphablending</span><span class="keyword">(</span><span class="default">$newImage</span><span class="keyword">, </span><span class="default">false</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="default">imagesavealpha</span><span class="keyword">(</span><span class="default">$newImage</span><span class="keyword">, </span><span class="default">true</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp;&nbsp; for(</span><span class="default">$w</span><span class="keyword">=</span><span class="default">0</span><span class="keyword">; </span><span class="default">$w</span><span class="keyword">&lt;</span><span class="default">$width</span><span class="keyword">; </span><span class="default">$w</span><span class="keyword">++)<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; for(</span><span class="default">$h</span><span class="keyword">=</span><span class="default">0</span><span class="keyword">; </span><span class="default">$h</span><span class="keyword">&lt;</span><span class="default">$height</span><span class="keyword">; </span><span class="default">$h</span><span class="keyword">++) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$ref </span><span class="keyword">= </span><span class="default">imagecolorat</span><span class="keyword">(</span><span class="default">$image</span><span class="keyword">, </span><span class="default">$w</span><span class="keyword">, </span><span class="default">$h</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">imagesetpixel</span><span class="keyword">(</span><span class="default">$newImage</span><span class="keyword">, </span><span class="default">$h</span><span class="keyword">, (</span><span class="default">$width</span><span class="keyword">-</span><span class="default">1</span><span class="keyword">)-</span><span class="default">$w</span><span class="keyword">, </span><span class="default">$ref</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp;&nbsp; return </span><span class="default">$newImage</span><span class="keyword">;<br />
&nbsp; }<br />
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="96333""></a>
  <div class="note">
   <strong class="user">c kelley at ca - cycleworks dot com</strong>
   <a href="#96333" class="date">20-Feb-2010 11:59</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Note, of the rotate functions below, only beau's worked for me. Not sure if it is because of my source image, but upon rotating, the background became blue. <br />
<br />
The code snippet below is what I used to prepare UPS shipping labels. The UPS xml api will return a base64 encoded gif, but it is sideways, so as to print on the top half of a 8.5x11 "letter" page. We are saving it in a database and sending it to a label printer, so needed it rotated...<br />
<br />
The other code further down didn't make the background blue, however it did make the image leave the canvas by about 50%. Additionally, the imagecolorallocate() function has an example describing how to set the background color. That didn't work for me. Even though the blue BG is #0000ff, using that code didn't work, I had to use the transparent trick below. <br />
<br />
The GD image functions may be in their infancy, however are a great reminder to me how powerful php is! Also, ubuntu apache users will need to apt-get install php5-gd to get the gd functions.<br />
<br />
<span class="default">&lt;?php<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $image</span><span class="keyword">=</span><span class="default">imagecreatefromgif</span><span class="keyword">( </span><span class="string">'data://text/plain;base64,'</span><span class="keyword">.</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">shipmentLabelGraphicImage </span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$image</span><span class="keyword">=</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">rotateImage</span><span class="keyword">(</span><span class="default">$image</span><span class="keyword">, </span><span class="default">90</span><span class="keyword">); </span><span class="comment">// Note: rotateImage turns our background to blue!<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$blue </span><span class="keyword">= </span><span class="default">imagecolorallocate</span><span class="keyword">(</span><span class="default">$image</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">255</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">imagecolortransparent</span><span class="keyword">(</span><span class="default">$image</span><span class="keyword">, </span><span class="default">$blue</span><span class="keyword">);&nbsp; &nbsp; </span><span class="comment">// make blue transparent, so image isn't goofy<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">imagepng</span><span class="keyword">(</span><span class="default">$image</span><span class="keyword">,</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">shipmentTrackingNumber</span><span class="keyword">.</span><span class="string">".png"</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; echo </span><span class="string">'&lt;P&gt;&lt;img src="'</span><span class="keyword">.</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">shipmentTrackingNumber</span><span class="keyword">.</span><span class="string">'.png"&gt;&lt;/P&gt;'</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">imagedestroy</span><span class="keyword">(</span><span class="default">$image</span><span class="keyword">);<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="95749""></a>
  <div class="note">
   <strong class="user">edwins at xs4all dot net</strong>
   <a href="#95749" class="date">20-Jan-2010 10:34</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
This function apparently contains a memory leak. Because of this, it was kept out of the GD library that comes with Ubuntu (and I assume other OS'es, too).<br />
<br />
So, If you are running Ubuntu and wonder why you get "Call to undefined function imagerotate()" even though you seemingly have the correct GD lib installed, this is why. Use the alternative supplied by beau at dragonflydevelopment dot com instead. It works flawlessly (for angles in steps of 90 degrees).<br />
<br />
On a side-note, some other GD image functions (unfortunately, the more interesting ones) suffer from the same problem and are kept out of the Ubuntu distribution as well.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="93692""></a>
  <div class="note">
   <strong class="user">beau at dragonflydevelopment dot com</strong>
   <a href="#93692" class="date">23-Sep-2009 11:13</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I believe the rotateImage function below is incorrect. The 180 rotation was actually doing a vertical mirror instead of rotating 180 degrees. The change was $i to $width - $i.<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">function </span><span class="default">rotateImage</span><span class="keyword">(</span><span class="default">$img</span><span class="keyword">, </span><span class="default">$rotation</span><span class="keyword">) {<br />
&nbsp; </span><span class="default">$width </span><span class="keyword">= </span><span class="default">imagesx</span><span class="keyword">(</span><span class="default">$img</span><span class="keyword">);<br />
&nbsp; </span><span class="default">$height </span><span class="keyword">= </span><span class="default">imagesy</span><span class="keyword">(</span><span class="default">$img</span><span class="keyword">);<br />
&nbsp; switch(</span><span class="default">$rotation</span><span class="keyword">) {<br />
&nbsp;&nbsp;&nbsp; case </span><span class="default">90</span><span class="keyword">: </span><span class="default">$newimg</span><span class="keyword">= @</span><span class="default">imagecreatetruecolor</span><span class="keyword">(</span><span class="default">$height </span><span class="keyword">, </span><span class="default">$width </span><span class="keyword">);break;<br />
&nbsp;&nbsp;&nbsp; case </span><span class="default">180</span><span class="keyword">: </span><span class="default">$newimg</span><span class="keyword">= @</span><span class="default">imagecreatetruecolor</span><span class="keyword">(</span><span class="default">$width </span><span class="keyword">, </span><span class="default">$height </span><span class="keyword">);break;<br />
&nbsp;&nbsp;&nbsp; case </span><span class="default">270</span><span class="keyword">: </span><span class="default">$newimg</span><span class="keyword">= @</span><span class="default">imagecreatetruecolor</span><span class="keyword">(</span><span class="default">$height </span><span class="keyword">, </span><span class="default">$width </span><span class="keyword">);break;<br />
&nbsp;&nbsp;&nbsp; case </span><span class="default">0</span><span class="keyword">: return </span><span class="default">$img</span><span class="keyword">;break;<br />
&nbsp;&nbsp;&nbsp; case </span><span class="default">360</span><span class="keyword">: return </span><span class="default">$img</span><span class="keyword">;break;<br />
&nbsp; }<br />
&nbsp; if(</span><span class="default">$newimg</span><span class="keyword">) { <br />
&nbsp;&nbsp;&nbsp; for(</span><span class="default">$i </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">;</span><span class="default">$i </span><span class="keyword">&lt; </span><span class="default">$width </span><span class="keyword">; </span><span class="default">$i</span><span class="keyword">++) { <br />
&nbsp;&nbsp; &nbsp;&nbsp; for(</span><span class="default">$j </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">;</span><span class="default">$j </span><span class="keyword">&lt; </span><span class="default">$height </span><span class="keyword">; </span><span class="default">$j</span><span class="keyword">++) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$reference </span><span class="keyword">= </span><span class="default">imagecolorat</span><span class="keyword">(</span><span class="default">$img</span><span class="keyword">,</span><span class="default">$i</span><span class="keyword">,</span><span class="default">$j</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; switch(</span><span class="default">$rotation</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; case </span><span class="default">90</span><span class="keyword">: if(!@</span><span class="default">imagesetpixel</span><span class="keyword">(</span><span class="default">$newimg</span><span class="keyword">, (</span><span class="default">$height </span><span class="keyword">- </span><span class="default">1</span><span class="keyword">) - </span><span class="default">$j</span><span class="keyword">, </span><span class="default">$i</span><span class="keyword">, </span><span class="default">$reference </span><span class="keyword">)){return </span><span class="default">false</span><span class="keyword">;}break;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; case </span><span class="default">180</span><span class="keyword">: if(!@</span><span class="default">imagesetpixel</span><span class="keyword">(</span><span class="default">$newimg</span><span class="keyword">, </span><span class="default">$width </span><span class="keyword">- </span><span class="default">$i</span><span class="keyword">, (</span><span class="default">$height </span><span class="keyword">- </span><span class="default">1</span><span class="keyword">) - </span><span class="default">$j</span><span class="keyword">, </span><span class="default">$reference </span><span class="keyword">)){return </span><span class="default">false</span><span class="keyword">;}break;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; case </span><span class="default">270</span><span class="keyword">: if(!@</span><span class="default">imagesetpixel</span><span class="keyword">(</span><span class="default">$newimg</span><span class="keyword">, </span><span class="default">$j</span><span class="keyword">, </span><span class="default">$width </span><span class="keyword">- </span><span class="default">$i</span><span class="keyword">, </span><span class="default">$reference </span><span class="keyword">)){return </span><span class="default">false</span><span class="keyword">;}break;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp;&nbsp; } <br />
&nbsp;&nbsp;&nbsp; } return </span><span class="default">$newimg</span><span class="keyword">; <br />
&nbsp; } <br />
&nbsp; return </span><span class="default">false</span><span class="keyword">;<br />
}<br />
</span><span class="default">?&gt;<br />
</span><br />
you can call it this way:<br />
<span class="default">&lt;?php<br />
$img </span><span class="keyword">= </span><span class="default">rotateImage</span><span class="keyword">(</span><span class="default">$imagetorotate</span><span class="keyword">,</span><span class="string">"degrees"</span><span class="keyword">);<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="93636""></a>
  <div class="note">
   <strong class="user">ewald at dutchvisual dot nl</strong>
   <a href="#93636" class="date">20-Sep-2009 01:35</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
This function will rotate the image. The image will be resampled completely.<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">function </span><span class="default">rotateImage</span><span class="keyword">(</span><span class="default">$img</span><span class="keyword">, </span><span class="default">$rotation</span><span class="keyword">) {<br />
&nbsp; </span><span class="default">$width </span><span class="keyword">= </span><span class="default">imagesx</span><span class="keyword">(</span><span class="default">$img</span><span class="keyword">);<br />
&nbsp; </span><span class="default">$height </span><span class="keyword">= </span><span class="default">imagesy</span><span class="keyword">(</span><span class="default">$img</span><span class="keyword">);<br />
&nbsp; switch(</span><span class="default">$rotation</span><span class="keyword">) {<br />
&nbsp;&nbsp;&nbsp; case </span><span class="default">90</span><span class="keyword">: </span><span class="default">$newimg</span><span class="keyword">= @</span><span class="default">imagecreatetruecolor</span><span class="keyword">(</span><span class="default">$height </span><span class="keyword">, </span><span class="default">$width </span><span class="keyword">);break;<br />
&nbsp;&nbsp;&nbsp; case </span><span class="default">180</span><span class="keyword">: </span><span class="default">$newimg</span><span class="keyword">= @</span><span class="default">imagecreatetruecolor</span><span class="keyword">(</span><span class="default">$width </span><span class="keyword">, </span><span class="default">$height </span><span class="keyword">);break;<br />
&nbsp;&nbsp;&nbsp; case </span><span class="default">270</span><span class="keyword">: </span><span class="default">$newimg</span><span class="keyword">= @</span><span class="default">imagecreatetruecolor</span><span class="keyword">(</span><span class="default">$height </span><span class="keyword">, </span><span class="default">$width </span><span class="keyword">);break;<br />
&nbsp;&nbsp;&nbsp; case </span><span class="default">0</span><span class="keyword">: return </span><span class="default">$img</span><span class="keyword">;break;<br />
&nbsp;&nbsp;&nbsp; case </span><span class="default">360</span><span class="keyword">: return </span><span class="default">$img</span><span class="keyword">;break;<br />
&nbsp; }<br />
&nbsp; if(</span><span class="default">$newimg</span><span class="keyword">) { <br />
&nbsp;&nbsp;&nbsp; for(</span><span class="default">$i </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">;</span><span class="default">$i </span><span class="keyword">&lt; </span><span class="default">$width </span><span class="keyword">; </span><span class="default">$i</span><span class="keyword">++) { <br />
&nbsp;&nbsp; &nbsp;&nbsp; for(</span><span class="default">$j </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">;</span><span class="default">$j </span><span class="keyword">&lt; </span><span class="default">$height </span><span class="keyword">; </span><span class="default">$j</span><span class="keyword">++) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$reference </span><span class="keyword">= </span><span class="default">imagecolorat</span><span class="keyword">(</span><span class="default">$img</span><span class="keyword">,</span><span class="default">$i</span><span class="keyword">,</span><span class="default">$j</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; switch(</span><span class="default">$rotation</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; case </span><span class="default">90</span><span class="keyword">: if(!@</span><span class="default">imagesetpixel</span><span class="keyword">(</span><span class="default">$newimg</span><span class="keyword">, (</span><span class="default">$height </span><span class="keyword">- </span><span class="default">1</span><span class="keyword">) - </span><span class="default">$j</span><span class="keyword">, </span><span class="default">$i</span><span class="keyword">, </span><span class="default">$reference </span><span class="keyword">)){return </span><span class="default">false</span><span class="keyword">;}break;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; case </span><span class="default">180</span><span class="keyword">: if(!@</span><span class="default">imagesetpixel</span><span class="keyword">(</span><span class="default">$newimg</span><span class="keyword">, </span><span class="default">$i</span><span class="keyword">, (</span><span class="default">$height </span><span class="keyword">- </span><span class="default">1</span><span class="keyword">) - </span><span class="default">$j</span><span class="keyword">, </span><span class="default">$reference </span><span class="keyword">)){return </span><span class="default">false</span><span class="keyword">;}break;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; case </span><span class="default">270</span><span class="keyword">: if(!@</span><span class="default">imagesetpixel</span><span class="keyword">(</span><span class="default">$newimg</span><span class="keyword">, </span><span class="default">$j</span><span class="keyword">, </span><span class="default">$width </span><span class="keyword">- </span><span class="default">$i</span><span class="keyword">, </span><span class="default">$reference </span><span class="keyword">)){return </span><span class="default">false</span><span class="keyword">;}break;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp;&nbsp; } <br />
&nbsp;&nbsp;&nbsp; } return </span><span class="default">$newimg</span><span class="keyword">; <br />
&nbsp; } <br />
&nbsp; return </span><span class="default">false</span><span class="keyword">;<br />
}<br />
</span><span class="default">?&gt;<br />
</span><br />
you can call it this way:<br />
<span class="default">&lt;?php<br />
$img </span><span class="keyword">= </span><span class="default">rotateImage</span><span class="keyword">(</span><span class="default">$imagetorotate</span><span class="keyword">,</span><span class="string">"degrees"</span><span class="keyword">);<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="93153""></a>
  <div class="note">
   <strong class="user">dev at imglib dot endofinternet dot net</strong>
   <a href="#93153" class="date">26-Aug-2009 12:15</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
And you can add a transparent background to you png image by change the <br />
<span class="default">&lt;?php<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">if (</span><span class="default">$ignore_transparent </span><span class="keyword">== </span><span class="default">0</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">imagefill</span><span class="keyword">(</span><span class="default">$destimg</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">imagecolorallocatealpha</span><span class="keyword">(</span><span class="default">$destimg</span><span class="keyword">, </span><span class="default">255</span><span class="keyword">,</span><span class="default">255</span><span class="keyword">, </span><span class="default">255</span><span class="keyword">, </span><span class="default">127</span><span class="keyword">));<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">imagesavealpha</span><span class="keyword">(</span><span class="default">$destimg</span><span class="keyword">, </span><span class="default">true</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; }<br />
</span><span class="default">?&gt;<br />
</span>to<br />
<span class="default">&lt;?php<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">if (</span><span class="default">$ignore_transparent </span><span class="keyword">== </span><span class="default">0</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$temp </span><span class="keyword">= </span><span class="default">imagecolorallocatealpha</span><span class="keyword">(</span><span class="default">$destimg</span><span class="keyword">, </span><span class="default">255</span><span class="keyword">,</span><span class="default">255</span><span class="keyword">, </span><span class="default">255</span><span class="keyword">, </span><span class="default">127</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">imagefill</span><span class="keyword">(</span><span class="default">$destimg</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">$temp</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">//if set the default color or white or magic pink then use transparent color<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">if ( (</span><span class="default">$bgcolor </span><span class="keyword">== </span><span class="default">0</span><span class="keyword">) || (</span><span class="default">$bgcolor </span><span class="keyword">== </span><span class="default">16777215</span><span class="keyword">) || (</span><span class="default">$bgcolor </span><span class="keyword">== </span><span class="default">16711935</span><span class="keyword">) )&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$bgcolor </span><span class="keyword">= </span><span class="default">$temp</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">imagesavealpha</span><span class="keyword">(</span><span class="default">$destimg</span><span class="keyword">, </span><span class="default">true</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; }<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="92794""></a>
  <div class="note">
   <strong class="user">sjef at bosman dot fr</strong>
   <a href="#92794" class="date">09-Aug-2009 06:28</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I wanted to draw a transparent GIF-image and show it on a page, at an angle specified in the URL:
<br />
&lt;img src="image.php?angle=90" type="image/gif"&gt;
<br />

<br />
I used the native imagerotate() but at angles of 90, 180, etc. the old background colour would become non-transparent. Apparently, there's a bug somewhere in GD, and has been for ages.
<br />

<br />
My solution below:
<br />

<br />
<span class="default">&lt;?php
<br />
$height </span><span class="keyword">= </span><span class="default">100</span><span class="keyword">;
<br />
</span><span class="default">$width </span><span class="keyword">= </span><span class="default">100</span><span class="keyword">;
<br />
</span><span class="default">$lsize</span><span class="keyword">= </span><span class="default">$width</span><span class="keyword">/</span><span class="default">2</span><span class="keyword">;
<br />
</span><span class="default">$angle</span><span class="keyword">= </span><span class="default">$_GET</span><span class="keyword">[</span><span class="string">"angle"</span><span class="keyword">];
<br />

<br />
</span><span class="comment">// avoid the bug:
<br />
</span><span class="keyword">if((</span><span class="default">$angle</span><span class="keyword">%</span><span class="default">90</span><span class="keyword">)==</span><span class="default">0</span><span class="keyword">)
<br />
&nbsp; </span><span class="default">$angle</span><span class="keyword">+= </span><span class="default">0.001</span><span class="keyword">;
<br />

<br />
</span><span class="default">$image_p </span><span class="keyword">= </span><span class="default">imagecreatetruecolor</span><span class="keyword">(</span><span class="default">$width</span><span class="keyword">, </span><span class="default">$height</span><span class="keyword">);
<br />
</span><span class="default">$trans </span><span class="keyword">= </span><span class="default">imagecolorallocate</span><span class="keyword">(</span><span class="default">$image_p</span><span class="keyword">, </span><span class="default">254</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">);
<br />
</span><span class="default">imagefill</span><span class="keyword">(</span><span class="default">$image_p</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">$trans</span><span class="keyword">);
<br />
</span><span class="default">imagecolortransparent</span><span class="keyword">(</span><span class="default">$image_p</span><span class="keyword">, </span><span class="default">$trans</span><span class="keyword">);
<br />

<br />
</span><span class="default">$black </span><span class="keyword">= </span><span class="default">imagecolorallocate</span><span class="keyword">(</span><span class="default">$image_p</span><span class="keyword">, </span><span class="default">1</span><span class="keyword">, </span><span class="default">1</span><span class="keyword">, </span><span class="default">1</span><span class="keyword">);
<br />
</span><span class="default">$red </span><span class="keyword">= </span><span class="default">imagecolorallocate</span><span class="keyword">(</span><span class="default">$image_p</span><span class="keyword">, </span><span class="default">255</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">);
<br />
</span><span class="default">$white </span><span class="keyword">= </span><span class="default">imagecolorallocate</span><span class="keyword">(</span><span class="default">$image_p</span><span class="keyword">, </span><span class="default">255</span><span class="keyword">, </span><span class="default">255</span><span class="keyword">, </span><span class="default">255</span><span class="keyword">);
<br />

<br />
</span><span class="comment">// draw something here
<br />
</span><span class="default">imageline</span><span class="keyword">(</span><span class="default">$image_p</span><span class="keyword">, </span><span class="default">3</span><span class="keyword">, </span><span class="default">$lsize</span><span class="keyword">, </span><span class="default">$lsize</span><span class="keyword">/</span><span class="default">2</span><span class="keyword">, </span><span class="default">$lsize</span><span class="keyword">, </span><span class="default">$black</span><span class="keyword">);
<br />

<br />
</span><span class="default">$image_r</span><span class="keyword">= </span><span class="default">imagerotate</span><span class="keyword">(</span><span class="default">$image_p</span><span class="keyword">, -</span><span class="default">$angle</span><span class="keyword">, </span><span class="default">$trans</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">); 
<br />
</span><span class="default">$w</span><span class="keyword">= </span><span class="default">imagesx</span><span class="keyword">(</span><span class="default">$image_r</span><span class="keyword">);
<br />
</span><span class="default">$h</span><span class="keyword">= </span><span class="default">imagesy</span><span class="keyword">(</span><span class="default">$image_r</span><span class="keyword">);
<br />
</span><span class="default">$image_s </span><span class="keyword">= </span><span class="default">imagecreatetruecolor</span><span class="keyword">(</span><span class="default">$width</span><span class="keyword">, </span><span class="default">$height</span><span class="keyword">);
<br />
</span><span class="default">imagecopyresized</span><span class="keyword">(</span><span class="default">$image_s</span><span class="keyword">, </span><span class="default">$image_r</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, (</span><span class="default">$w</span><span class="keyword">-</span><span class="default">$width</span><span class="keyword">)/</span><span class="default">2</span><span class="keyword">, (</span><span class="default">$h</span><span class="keyword">-</span><span class="default">$height</span><span class="keyword">)/</span><span class="default">2</span><span class="keyword">, </span><span class="default">$width</span><span class="keyword">, </span><span class="default">$height</span><span class="keyword">, </span><span class="default">$width</span><span class="keyword">, </span><span class="default">$height</span><span class="keyword">);
<br />
</span><span class="default">$trans </span><span class="keyword">= </span><span class="default">imagecolorallocate</span><span class="keyword">(</span><span class="default">$image_s</span><span class="keyword">, </span><span class="default">254</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">);
<br />
</span><span class="default">imagecolortransparent</span><span class="keyword">(</span><span class="default">$image_s</span><span class="keyword">, </span><span class="default">$trans</span><span class="keyword">);
<br />
</span><span class="default">imagegif</span><span class="keyword">(</span><span class="default">$image_s</span><span class="keyword">);
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="92430""></a>
  <div class="note">
   <strong class="user">gglockner AT NOSPAMdwaffler DOT com</strong>
   <a href="#92430" class="date">23-Jul-2009 09:36</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If you're going to do a rotation by hand instead of using the imagerotate function, you can use the imagecopy function to copy a single pixel instead of determining the pixel color and setting the pixel.&nbsp; Not only is this shorter and cleaner, but it also works with images that are not truecolor (on my system, imagecolorat fails with an image that is not truecolor).</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="92286""></a>
  <div class="note">
   <strong class="user">jeprubio</strong>
   <a href="#92286" class="date">17-Jul-2009 05:52</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
hi,<br />
if you have a image with transparent color in previous function "function rotateImage($img1, $rec)"<br />
just before "return $img2;" you have to do:<br />
imagecolortransparent($img2, imagecolorallocate($img2, 0, 0, 0));<br />
Best regards</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="91803""></a>
  <div class="note">
   <strong class="user">Anonymous</strong>
   <a href="#91803" class="date">26-Jun-2009 02:32</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Sorry, the previous class contains an error, the original image after the rotation 1px move on and get the unwanted "border".<br />
<br />
After a careful reading of the local debate, I am using the tip from Dave Richards wrote a new function. With its images can be rotated only 90 ° (default), 180 ° and 270 °, but one rarely needs more ...<br />
<br />
The function returns False, or rotated image <br />
<span class="default">&lt;?php<br />
</span><span class="keyword">if(!</span><span class="default">function_exists</span><span class="keyword">(</span><span class="string">"imagerotate"</span><span class="keyword">)) {<br />
&nbsp;&nbsp;&nbsp; function </span><span class="default">imagerotate</span><span class="keyword">(</span><span class="default">$srcImg</span><span class="keyword">, </span><span class="default">$angle</span><span class="keyword">, </span><span class="default">$bgcolor</span><span class="keyword">, </span><span class="default">$ignore_transparent </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">rotateImage</span><span class="keyword">(</span><span class="default">$srcImg</span><span class="keyword">, </span><span class="default">$angle</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; }<br />
}<br />
<br />
function </span><span class="default">rotateImage</span><span class="keyword">(</span><span class="default">$img1</span><span class="keyword">, </span><span class="default">$rec</span><span class="keyword">) {<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$wid </span><span class="keyword">= </span><span class="default">imagesx</span><span class="keyword">(</span><span class="default">$img1</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$hei </span><span class="keyword">= </span><span class="default">imagesy</span><span class="keyword">(</span><span class="default">$img1</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; switch(</span><span class="default">$rec</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; case </span><span class="default">270</span><span class="keyword">:<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$img2 </span><span class="keyword">= @</span><span class="default">imagecreatetruecolor</span><span class="keyword">(</span><span class="default">$hei</span><span class="keyword">, </span><span class="default">$wid</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; break;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; case </span><span class="default">180</span><span class="keyword">:<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$img2 </span><span class="keyword">= @</span><span class="default">imagecreatetruecolor</span><span class="keyword">(</span><span class="default">$wid</span><span class="keyword">, </span><span class="default">$hei</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; break;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; default :<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$img2 </span><span class="keyword">= @</span><span class="default">imagecreatetruecolor</span><span class="keyword">(</span><span class="default">$hei</span><span class="keyword">, </span><span class="default">$wid</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; if(</span><span class="default">$img2</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; for(</span><span class="default">$i </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">;</span><span class="default">$i </span><span class="keyword">&lt; </span><span class="default">$wid</span><span class="keyword">; </span><span class="default">$i</span><span class="keyword">++) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; for(</span><span class="default">$j </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">;</span><span class="default">$j </span><span class="keyword">&lt; </span><span class="default">$hei</span><span class="keyword">; </span><span class="default">$j</span><span class="keyword">++) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$ref </span><span class="keyword">= </span><span class="default">imagecolorat</span><span class="keyword">(</span><span class="default">$img1</span><span class="keyword">,</span><span class="default">$i</span><span class="keyword">,</span><span class="default">$j</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; switch(</span><span class="default">$rec</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; case </span><span class="default">270</span><span class="keyword">:<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if(!@</span><span class="default">imagesetpixel</span><span class="keyword">(</span><span class="default">$img2</span><span class="keyword">, (</span><span class="default">$hei </span><span class="keyword">- </span><span class="default">1</span><span class="keyword">) - </span><span class="default">$j</span><span class="keyword">, </span><span class="default">$i</span><span class="keyword">, </span><span class="default">$ref</span><span class="keyword">)){<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">false</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; break;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; case </span><span class="default">180</span><span class="keyword">:<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if(!@</span><span class="default">imagesetpixel</span><span class="keyword">(</span><span class="default">$img2</span><span class="keyword">, </span><span class="default">$i</span><span class="keyword">, (</span><span class="default">$hei </span><span class="keyword">- </span><span class="default">1</span><span class="keyword">) - </span><span class="default">$j</span><span class="keyword">, </span><span class="default">$ref</span><span class="keyword">)) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">false</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; break;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; default:<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if(!@</span><span class="default">imagesetpixel</span><span class="keyword">(</span><span class="default">$img2</span><span class="keyword">, </span><span class="default">$j</span><span class="keyword">, (</span><span class="default">$wid </span><span class="keyword">- </span><span class="default">1</span><span class="keyword">) - </span><span class="default">$i</span><span class="keyword">, </span><span class="default">$ref</span><span class="keyword">)) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">false</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">$img2</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; return </span><span class="default">false</span><span class="keyword">;<br />
}<br />
</span><span class="default">?&gt;<br />
</span><br />
Petr</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="91761""></a>
  <div class="note">
   <strong class="user">Mike Knoop</strong>
   <a href="#91761" class="date">24-Jun-2009 11:25</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Don't be tricked into thinking this function will rotate the image resource handle in-place. While the documentation currently doesn't specify and return values, I've found the following return values to be true:<br />
<br />
"Returns an image resource identifier on success, FALSE on errors. "<br />
<br />
Simply make sure you're doing something like...<br />
<span class="default">&lt;?php<br />
$rotated_img </span><span class="keyword">= </span><span class="default">imagerotate</span><span class="keyword">(</span><span class="default">$src_img</span><span class="keyword">, </span><span class="default">45</span><span class="keyword">, </span><span class="default">$color</span><span class="keyword">)<br />
</span><span class="default">?&gt;<br />
</span><br />
-Mike</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="91709""></a>
  <div class="note">
   <strong class="user">krteczek01 at gmail dot com</strong>
   <a href="#91709" class="date">24-Jun-2009 12:21</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Hi, I've rewrote function to class with static methods. Advantage of this solution is ability to be called several times during script execution.<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="comment">/*<br />
&nbsp;&nbsp;&nbsp; Unfinished imagerotate replacement. ignore_transparent is, well, ignored. :)<br />
&nbsp;&nbsp;&nbsp; Also, should have some standard functions for 90, 180 and 270 degrees, since they are quite<br />
&nbsp;&nbsp;&nbsp; easy to implement faster.<br />
*/<br />
<br />
</span><span class="keyword">if(!</span><span class="default">function_exists</span><span class="keyword">(</span><span class="string">"imagerotate"</span><span class="keyword">)) {<br />
&nbsp;&nbsp;&nbsp; function </span><span class="default">imagerotate</span><span class="keyword">(&amp;</span><span class="default">$srcImg</span><span class="keyword">, </span><span class="default">$angle</span><span class="keyword">, </span><span class="default">$bgcolor</span><span class="keyword">, </span><span class="default">$ignore_transparent </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">imagerotateEquivalent</span><span class="keyword">::</span><span class="default">rotate</span><span class="keyword">(&amp;</span><span class="default">$srcImg</span><span class="keyword">, </span><span class="default">$angle</span><span class="keyword">, </span><span class="default">$bgcolor</span><span class="keyword">, </span><span class="default">$ignore_transparent</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; }<br />
}<br />
<br />
class </span><span class="default">imagerotateEquivalent </span><span class="keyword">{<br />
<br />
&nbsp;&nbsp;&nbsp; static private function </span><span class="default">rotateX</span><span class="keyword">(</span><span class="default">$x</span><span class="keyword">, </span><span class="default">$y</span><span class="keyword">, </span><span class="default">$theta</span><span class="keyword">){<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">$x </span><span class="keyword">* </span><span class="default">cos</span><span class="keyword">(</span><span class="default">$theta</span><span class="keyword">) - </span><span class="default">$y </span><span class="keyword">* </span><span class="default">sin</span><span class="keyword">(</span><span class="default">$theta</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp;&nbsp; static private function </span><span class="default">rotateY</span><span class="keyword">(</span><span class="default">$x</span><span class="keyword">, </span><span class="default">$y</span><span class="keyword">, </span><span class="default">$theta</span><span class="keyword">){<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">$x </span><span class="keyword">* </span><span class="default">sin</span><span class="keyword">(</span><span class="default">$theta</span><span class="keyword">) + </span><span class="default">$y </span><span class="keyword">* </span><span class="default">cos</span><span class="keyword">(</span><span class="default">$theta</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp;&nbsp; public static function </span><span class="default">rotate</span><span class="keyword">(&amp;</span><span class="default">$srcImg</span><span class="keyword">, </span><span class="default">$angle</span><span class="keyword">, </span><span class="default">$bgcolor</span><span class="keyword">, </span><span class="default">$ignore_transparent </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$srcw </span><span class="keyword">= </span><span class="default">imagesx</span><span class="keyword">(</span><span class="default">$srcImg</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$srch </span><span class="keyword">= </span><span class="default">imagesy</span><span class="keyword">(</span><span class="default">$srcImg</span><span class="keyword">);<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if(</span><span class="default">$angle </span><span class="keyword">== </span><span class="default">0</span><span class="keyword">) return </span><span class="default">$srcImg</span><span class="keyword">;<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// Convert the angle to radians<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$theta </span><span class="keyword">= </span><span class="default">deg2rad </span><span class="keyword">(</span><span class="default">$angle</span><span class="keyword">);<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// Calculate the width of the destination image.<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$temp </span><span class="keyword">= array (&nbsp; &nbsp; </span><span class="default">self</span><span class="keyword">::</span><span class="default">rotateX</span><span class="keyword">(</span><span class="default">0</span><span class="keyword">,&nbsp; &nbsp;&nbsp; </span><span class="default">0</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">-</span><span class="default">$theta</span><span class="keyword">),<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">self</span><span class="keyword">::</span><span class="default">rotateX</span><span class="keyword">(</span><span class="default">$srcw</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">-</span><span class="default">$theta</span><span class="keyword">),<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">self</span><span class="keyword">::</span><span class="default">rotateX</span><span class="keyword">(</span><span class="default">0</span><span class="keyword">,&nbsp; &nbsp;&nbsp; </span><span class="default">$srch</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">-</span><span class="default">$theta</span><span class="keyword">),<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">self</span><span class="keyword">::</span><span class="default">rotateX</span><span class="keyword">(</span><span class="default">$srcw</span><span class="keyword">, </span><span class="default">$srch</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">-</span><span class="default">$theta</span><span class="keyword">)<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; );<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$minX </span><span class="keyword">= </span><span class="default">floor</span><span class="keyword">(</span><span class="default">min</span><span class="keyword">(</span><span class="default">$temp</span><span class="keyword">));<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$maxX </span><span class="keyword">= </span><span class="default">ceil</span><span class="keyword">(</span><span class="default">max</span><span class="keyword">(</span><span class="default">$temp</span><span class="keyword">));<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$width </span><span class="keyword">= </span><span class="default">$maxX </span><span class="keyword">- </span><span class="default">$minX</span><span class="keyword">;<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// Calculate the height of the destination image.<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$temp </span><span class="keyword">= array (&nbsp; &nbsp; </span><span class="default">self</span><span class="keyword">::</span><span class="default">rotateY</span><span class="keyword">(</span><span class="default">0</span><span class="keyword">,&nbsp; &nbsp;&nbsp; </span><span class="default">0</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">-</span><span class="default">$theta</span><span class="keyword">),<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">self</span><span class="keyword">::</span><span class="default">rotateY</span><span class="keyword">(</span><span class="default">$srcw</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">-</span><span class="default">$theta</span><span class="keyword">),<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">self</span><span class="keyword">::</span><span class="default">rotateY</span><span class="keyword">(</span><span class="default">0</span><span class="keyword">,&nbsp; &nbsp;&nbsp; </span><span class="default">$srch</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">-</span><span class="default">$theta</span><span class="keyword">),<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">self</span><span class="keyword">::</span><span class="default">rotateY</span><span class="keyword">(</span><span class="default">$srcw</span><span class="keyword">, </span><span class="default">$srch</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">-</span><span class="default">$theta</span><span class="keyword">)<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; );<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$minY </span><span class="keyword">= </span><span class="default">floor</span><span class="keyword">(</span><span class="default">min</span><span class="keyword">(</span><span class="default">$temp</span><span class="keyword">));<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$maxY </span><span class="keyword">= </span><span class="default">ceil</span><span class="keyword">(</span><span class="default">max</span><span class="keyword">(</span><span class="default">$temp</span><span class="keyword">));<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$height </span><span class="keyword">= </span><span class="default">$maxY </span><span class="keyword">- </span><span class="default">$minY</span><span class="keyword">;<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$destimg </span><span class="keyword">= </span><span class="default">imagecreatetruecolor</span><span class="keyword">(</span><span class="default">$width</span><span class="keyword">, </span><span class="default">$height</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">imagefill</span><span class="keyword">(</span><span class="default">$destimg</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">imagecolorallocate</span><span class="keyword">(</span><span class="default">$destimg</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">,</span><span class="default">255</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">));<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// sets all pixels in the new image<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">for(</span><span class="default">$x</span><span class="keyword">=</span><span class="default">$minX</span><span class="keyword">;</span><span class="default">$x</span><span class="keyword">&lt;</span><span class="default">$maxX</span><span class="keyword">;</span><span class="default">$x</span><span class="keyword">++) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; for(</span><span class="default">$y</span><span class="keyword">=</span><span class="default">$minY</span><span class="keyword">;</span><span class="default">$y</span><span class="keyword">&lt;</span><span class="default">$maxY</span><span class="keyword">;</span><span class="default">$y</span><span class="keyword">++)<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// fetch corresponding pixel from the source image<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$srcX </span><span class="keyword">= </span><span class="default">round</span><span class="keyword">(</span><span class="default">self</span><span class="keyword">::</span><span class="default">rotateX</span><span class="keyword">(</span><span class="default">$x</span><span class="keyword">, </span><span class="default">$y</span><span class="keyword">, </span><span class="default">$theta</span><span class="keyword">));<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$srcY </span><span class="keyword">= </span><span class="default">round</span><span class="keyword">(</span><span class="default">self</span><span class="keyword">::</span><span class="default">rotateY</span><span class="keyword">(</span><span class="default">$x</span><span class="keyword">, </span><span class="default">$y</span><span class="keyword">, </span><span class="default">$theta</span><span class="keyword">));<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if(</span><span class="default">$srcX </span><span class="keyword">&gt;= </span><span class="default">0 </span><span class="keyword">&amp;&amp; </span><span class="default">$srcX </span><span class="keyword">&lt; </span><span class="default">$srcw </span><span class="keyword">&amp;&amp; </span><span class="default">$srcY </span><span class="keyword">&gt;= </span><span class="default">0 </span><span class="keyword">&amp;&amp; </span><span class="default">$srcY </span><span class="keyword">&lt; </span><span class="default">$srch</span><span class="keyword">)<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$color </span><span class="keyword">= </span><span class="default">imagecolorat</span><span class="keyword">(</span><span class="default">$srcImg</span><span class="keyword">, </span><span class="default">$srcX</span><span class="keyword">, </span><span class="default">$srcY </span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; else<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$color </span><span class="keyword">= </span><span class="default">$bgcolor</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">imagesetpixel</span><span class="keyword">(</span><span class="default">$destimg</span><span class="keyword">, </span><span class="default">$x</span><span class="keyword">-</span><span class="default">$minX</span><span class="keyword">, </span><span class="default">$y</span><span class="keyword">-</span><span class="default">$minY</span><span class="keyword">, </span><span class="default">$color</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">$destimg</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }<br />
}<br />
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="91505""></a>
  <div class="note">
   <strong class="user">anon at here dot com</strong>
   <a href="#91505" class="date">13-Jun-2009 10:00</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I was quite surprised to see that no one had done any working rotate function. And since I needed one for my web hotel, I whipped this one up. Someone might want to expand it so that it matches imagerotate.<br />
<br />
Also, does imagerotate really rotate things counter clockwise? Otherwise this should also be changed.<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">if(!</span><span class="default">function_exists</span><span class="keyword">(</span><span class="string">"imagerotate"</span><span class="keyword">)) {<br />
&nbsp;&nbsp;&nbsp; function </span><span class="default">imagerotate</span><span class="keyword">(&amp;</span><span class="default">$srcImg</span><span class="keyword">, </span><span class="default">$angle</span><span class="keyword">, </span><span class="default">$bgcolor</span><span class="keyword">, </span><span class="default">$ignore_transparent </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">imagerotateEquivalent</span><span class="keyword">(&amp;</span><span class="default">$srcImg</span><span class="keyword">, </span><span class="default">$angle</span><span class="keyword">, </span><span class="default">$bgcolor</span><span class="keyword">, </span><span class="default">$ignore_transparent</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; }<br />
}<br />
<br />
</span><span class="comment">/*<br />
&nbsp;&nbsp;&nbsp; Unfinished imagerotate replacement. ignore_transparent is, well, ignored. :)<br />
&nbsp;&nbsp;&nbsp; Also, should have some standard functions for 90, 180 and 270 degrees, since they are quite <br />
&nbsp;&nbsp;&nbsp; easy to implement faster.<br />
*/<br />
</span><span class="keyword">function </span><span class="default">imagerotateEquivalent</span><span class="keyword">(&amp;</span><span class="default">$srcImg</span><span class="keyword">, </span><span class="default">$angle</span><span class="keyword">, </span><span class="default">$bgcolor</span><span class="keyword">, </span><span class="default">$ignore_transparent </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">) <br />
{<br />
&nbsp;&nbsp;&nbsp; function </span><span class="default">rotateX</span><span class="keyword">(</span><span class="default">$x</span><span class="keyword">, </span><span class="default">$y</span><span class="keyword">, </span><span class="default">$theta</span><span class="keyword">){<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">$x </span><span class="keyword">* </span><span class="default">cos</span><span class="keyword">(</span><span class="default">$theta</span><span class="keyword">) - </span><span class="default">$y </span><span class="keyword">* </span><span class="default">sin</span><span class="keyword">(</span><span class="default">$theta</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; function </span><span class="default">rotateY</span><span class="keyword">(</span><span class="default">$x</span><span class="keyword">, </span><span class="default">$y</span><span class="keyword">, </span><span class="default">$theta</span><span class="keyword">){<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">$x </span><span class="keyword">* </span><span class="default">sin</span><span class="keyword">(</span><span class="default">$theta</span><span class="keyword">) + </span><span class="default">$y </span><span class="keyword">* </span><span class="default">cos</span><span class="keyword">(</span><span class="default">$theta</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$srcw </span><span class="keyword">= </span><span class="default">imagesx</span><span class="keyword">(</span><span class="default">$srcImg</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$srch </span><span class="keyword">= </span><span class="default">imagesy</span><span class="keyword">(</span><span class="default">$srcImg</span><span class="keyword">);<br />
&nbsp; <br />
&nbsp;&nbsp;&nbsp; if(</span><span class="default">$angle </span><span class="keyword">== </span><span class="default">0</span><span class="keyword">) return </span><span class="default">$srcImg</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">// Convert the angle to radians<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$theta </span><span class="keyword">= </span><span class="default">deg2rad </span><span class="keyword">(</span><span class="default">$angle</span><span class="keyword">);<br />
<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">// Calculate the width of the destination image.<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$temp </span><span class="keyword">= array (&nbsp; &nbsp; </span><span class="default">rotateX</span><span class="keyword">(</span><span class="default">0</span><span class="keyword">,&nbsp; &nbsp;&nbsp; </span><span class="default">0</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">-</span><span class="default">$theta</span><span class="keyword">),<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">rotateX</span><span class="keyword">(</span><span class="default">$srcw</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">-</span><span class="default">$theta</span><span class="keyword">),<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">rotateX</span><span class="keyword">(</span><span class="default">0</span><span class="keyword">,&nbsp; &nbsp;&nbsp; </span><span class="default">$srch</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">-</span><span class="default">$theta</span><span class="keyword">),<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">rotateX</span><span class="keyword">(</span><span class="default">$srcw</span><span class="keyword">, </span><span class="default">$srch</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">-</span><span class="default">$theta</span><span class="keyword">)<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; );<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$minX </span><span class="keyword">= </span><span class="default">floor</span><span class="keyword">(</span><span class="default">min</span><span class="keyword">(</span><span class="default">$temp</span><span class="keyword">));<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$maxX </span><span class="keyword">= </span><span class="default">ceil</span><span class="keyword">(</span><span class="default">max</span><span class="keyword">(</span><span class="default">$temp</span><span class="keyword">));<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$width </span><span class="keyword">= </span><span class="default">$maxX </span><span class="keyword">- </span><span class="default">$minX</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">// Calculate the height of the destination image.<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$temp </span><span class="keyword">= array (&nbsp; &nbsp; </span><span class="default">rotateY</span><span class="keyword">(</span><span class="default">0</span><span class="keyword">,&nbsp; &nbsp;&nbsp; </span><span class="default">0</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">-</span><span class="default">$theta</span><span class="keyword">),<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">rotateY</span><span class="keyword">(</span><span class="default">$srcw</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">-</span><span class="default">$theta</span><span class="keyword">),<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">rotateY</span><span class="keyword">(</span><span class="default">0</span><span class="keyword">,&nbsp; &nbsp;&nbsp; </span><span class="default">$srch</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">-</span><span class="default">$theta</span><span class="keyword">),<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">rotateY</span><span class="keyword">(</span><span class="default">$srcw</span><span class="keyword">, </span><span class="default">$srch</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">-</span><span class="default">$theta</span><span class="keyword">)<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; );<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$minY </span><span class="keyword">= </span><span class="default">floor</span><span class="keyword">(</span><span class="default">min</span><span class="keyword">(</span><span class="default">$temp</span><span class="keyword">));<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$maxY </span><span class="keyword">= </span><span class="default">ceil</span><span class="keyword">(</span><span class="default">max</span><span class="keyword">(</span><span class="default">$temp</span><span class="keyword">));<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$height </span><span class="keyword">= </span><span class="default">$maxY </span><span class="keyword">- </span><span class="default">$minY</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$destimg </span><span class="keyword">= </span><span class="default">imagecreatetruecolor</span><span class="keyword">(</span><span class="default">$width</span><span class="keyword">, </span><span class="default">$height</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">imagefill</span><span class="keyword">(</span><span class="default">$destimg</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">imagecolorallocate</span><span class="keyword">(</span><span class="default">$destimg</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">,</span><span class="default">255</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">));<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">// sets all pixels in the new image<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">for(</span><span class="default">$x</span><span class="keyword">=</span><span class="default">$minX</span><span class="keyword">;</span><span class="default">$x</span><span class="keyword">&lt;</span><span class="default">$maxX</span><span class="keyword">;</span><span class="default">$x</span><span class="keyword">++) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; for(</span><span class="default">$y</span><span class="keyword">=</span><span class="default">$minY</span><span class="keyword">;</span><span class="default">$y</span><span class="keyword">&lt;</span><span class="default">$maxY</span><span class="keyword">;</span><span class="default">$y</span><span class="keyword">++) <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// fetch corresponding pixel from the source image<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$srcX </span><span class="keyword">= </span><span class="default">round</span><span class="keyword">(</span><span class="default">rotateX</span><span class="keyword">(</span><span class="default">$x</span><span class="keyword">, </span><span class="default">$y</span><span class="keyword">, </span><span class="default">$theta</span><span class="keyword">));<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$srcY </span><span class="keyword">= </span><span class="default">round</span><span class="keyword">(</span><span class="default">rotateY</span><span class="keyword">(</span><span class="default">$x</span><span class="keyword">, </span><span class="default">$y</span><span class="keyword">, </span><span class="default">$theta</span><span class="keyword">));<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if(</span><span class="default">$srcX </span><span class="keyword">&gt;= </span><span class="default">0 </span><span class="keyword">&amp;&amp; </span><span class="default">$srcX </span><span class="keyword">&lt; </span><span class="default">$srcw </span><span class="keyword">&amp;&amp; </span><span class="default">$srcY </span><span class="keyword">&gt;= </span><span class="default">0 </span><span class="keyword">&amp;&amp; </span><span class="default">$srcY </span><span class="keyword">&lt; </span><span class="default">$srch</span><span class="keyword">)<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$color </span><span class="keyword">= </span><span class="default">imagecolorat</span><span class="keyword">(</span><span class="default">$srcImg</span><span class="keyword">, </span><span class="default">$srcX</span><span class="keyword">, </span><span class="default">$srcY </span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; else<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$color </span><span class="keyword">= </span><span class="default">$bgcolor</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">imagesetpixel</span><span class="keyword">(</span><span class="default">$destimg</span><span class="keyword">, </span><span class="default">$x</span><span class="keyword">-</span><span class="default">$minX</span><span class="keyword">, </span><span class="default">$y</span><span class="keyword">-</span><span class="default">$minY</span><span class="keyword">, </span><span class="default">$color</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; return </span><span class="default">$destimg</span><span class="keyword">;<br />
}<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="90350""></a>
  <div class="note">
   <strong class="user">dave dot richards at gmail dot com</strong>
   <a href="#90350" class="date">17-Apr-2009 01:47</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
There is a slight mistake in the previous post by Kae Cyphet.<br />
<br />
When setting the pixels of the new image the co-ordinates have to occasionally use the width ($wid) and height ($hei). These values must be reduced by 1 as the co-ordinates start at 0 (Not 1) so they only go up to $wid - 1 and $hei - 1 (Not $wid and $hei).<br />
<br />
Here's an example of the first function to show this:<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">function </span><span class="default">rotate_right90</span><span class="keyword">(</span><span class="default">$im</span><span class="keyword">)<br />
{<br />
&nbsp;</span><span class="default">$wid </span><span class="keyword">= </span><span class="default">imagesx</span><span class="keyword">(</span><span class="default">$im</span><span class="keyword">);<br />
&nbsp;</span><span class="default">$hei </span><span class="keyword">= </span><span class="default">imagesy</span><span class="keyword">(</span><span class="default">$im</span><span class="keyword">);<br />
&nbsp;</span><span class="default">$im2 </span><span class="keyword">= </span><span class="default">imagecreatetruecolor</span><span class="keyword">(</span><span class="default">$hei</span><span class="keyword">,</span><span class="default">$wid</span><span class="keyword">);<br />
<br />
&nbsp;for(</span><span class="default">$i </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">;</span><span class="default">$i </span><span class="keyword">&lt; </span><span class="default">$wid</span><span class="keyword">; </span><span class="default">$i</span><span class="keyword">++)<br />
&nbsp;{<br />
&nbsp; for(</span><span class="default">$j </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">;</span><span class="default">$j </span><span class="keyword">&lt; </span><span class="default">$hei</span><span class="keyword">; </span><span class="default">$j</span><span class="keyword">++)<br />
&nbsp; {<br />
&nbsp;&nbsp; </span><span class="default">$ref </span><span class="keyword">= </span><span class="default">imagecolorat</span><span class="keyword">(</span><span class="default">$im</span><span class="keyword">,</span><span class="default">$i</span><span class="keyword">,</span><span class="default">$j</span><span class="keyword">);<br />
&nbsp;&nbsp; </span><span class="default">imagesetpixel</span><span class="keyword">(</span><span class="default">$im2</span><span class="keyword">,(</span><span class="default">$hei </span><span class="keyword">- </span><span class="default">1</span><span class="keyword">) - </span><span class="default">$j</span><span class="keyword">,</span><span class="default">$i</span><span class="keyword">,</span><span class="default">$ref</span><span class="keyword">);<br />
&nbsp; }<br />
&nbsp;}<br />
&nbsp;return </span><span class="default">$im2</span><span class="keyword">;<br />
}<br />
</span><span class="default">?&gt;<br />
</span><br />
Other than that very useful functions!</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="88436""></a>
  <div class="note">
   <strong class="user">Kae Cyphet</strong>
   <a href="#88436" class="date">23-Jan-2009 10:50</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
To solve that annoying problem of having to install a pre-compiled version of GD just to get imagerotate working.<br />
<br />
here is an open source solution.<br />
uses the standard stuff included in php when you uncomment 'extension=php_gd2.dll' in the php.ini file and there ya go!<br />
<br />
Useage:<br />
<span class="default">&lt;?php<br />
$im </span><span class="keyword">= </span><span class="default">imagecreatefromjpeg</span><span class="keyword">(</span><span class="string">'test.jpg'</span><span class="keyword">);<br />
<br />
</span><span class="default">header</span><span class="keyword">(</span><span class="string">'Content-type: image/jpg'</span><span class="keyword">);<br />
</span><span class="default">imagejpeg</span><span class="keyword">(</span><span class="default">rotate_right90</span><span class="keyword">(</span><span class="default">$im</span><span class="keyword">));<br />
<br />
</span><span class="default">imagedestroy</span><span class="keyword">(</span><span class="default">$im</span><span class="keyword">);<br />
</span><span class="default">?&gt;<br />
</span><br />
'=================================<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">function </span><span class="default">rotate_right90</span><span class="keyword">(</span><span class="default">$im</span><span class="keyword">)<br />
{<br />
&nbsp;</span><span class="default">$wid </span><span class="keyword">= </span><span class="default">imagesx</span><span class="keyword">(</span><span class="default">$im</span><span class="keyword">);<br />
&nbsp;</span><span class="default">$hei </span><span class="keyword">= </span><span class="default">imagesy</span><span class="keyword">(</span><span class="default">$im</span><span class="keyword">);<br />
&nbsp;</span><span class="default">$im2 </span><span class="keyword">= </span><span class="default">imagecreatetruecolor</span><span class="keyword">(</span><span class="default">$hei</span><span class="keyword">,</span><span class="default">$wid</span><span class="keyword">);<br />
<br />
&nbsp;for(</span><span class="default">$i </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">;</span><span class="default">$i </span><span class="keyword">&lt; </span><span class="default">$wid</span><span class="keyword">; </span><span class="default">$i</span><span class="keyword">++)<br />
&nbsp;{<br />
&nbsp; for(</span><span class="default">$j </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">;</span><span class="default">$j </span><span class="keyword">&lt; </span><span class="default">$hei</span><span class="keyword">; </span><span class="default">$j</span><span class="keyword">++)<br />
&nbsp; {<br />
&nbsp;&nbsp; </span><span class="default">$ref </span><span class="keyword">= </span><span class="default">imagecolorat</span><span class="keyword">(</span><span class="default">$im</span><span class="keyword">,</span><span class="default">$i</span><span class="keyword">,</span><span class="default">$j</span><span class="keyword">);<br />
&nbsp;&nbsp; </span><span class="default">imagesetpixel</span><span class="keyword">(</span><span class="default">$im2</span><span class="keyword">,</span><span class="default">$hei </span><span class="keyword">- </span><span class="default">$j</span><span class="keyword">,</span><span class="default">$i</span><span class="keyword">,</span><span class="default">$ref</span><span class="keyword">);<br />
&nbsp; }<br />
&nbsp;}<br />
&nbsp;return </span><span class="default">$im2</span><span class="keyword">;<br />
}<br />
<br />
function </span><span class="default">rotate_left90</span><span class="keyword">(</span><span class="default">$im</span><span class="keyword">)<br />
{<br />
&nbsp;</span><span class="default">$wid </span><span class="keyword">= </span><span class="default">imagesx</span><span class="keyword">(</span><span class="default">$im</span><span class="keyword">);<br />
&nbsp;</span><span class="default">$hei </span><span class="keyword">= </span><span class="default">imagesy</span><span class="keyword">(</span><span class="default">$im</span><span class="keyword">);<br />
&nbsp;</span><span class="default">$im2 </span><span class="keyword">= </span><span class="default">imagecreatetruecolor</span><span class="keyword">(</span><span class="default">$hei</span><span class="keyword">,</span><span class="default">$wid</span><span class="keyword">);<br />
<br />
&nbsp;for(</span><span class="default">$i </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">;</span><span class="default">$i </span><span class="keyword">&lt; </span><span class="default">$wid</span><span class="keyword">; </span><span class="default">$i</span><span class="keyword">++)<br />
&nbsp;{<br />
&nbsp; for(</span><span class="default">$j </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">;</span><span class="default">$j </span><span class="keyword">&lt; </span><span class="default">$hei</span><span class="keyword">; </span><span class="default">$j</span><span class="keyword">++)<br />
&nbsp; {<br />
&nbsp;&nbsp; </span><span class="default">$ref </span><span class="keyword">= </span><span class="default">imagecolorat</span><span class="keyword">(</span><span class="default">$im</span><span class="keyword">,</span><span class="default">$i</span><span class="keyword">,</span><span class="default">$j</span><span class="keyword">);<br />
&nbsp;&nbsp; </span><span class="default">imagesetpixel</span><span class="keyword">(</span><span class="default">$im2</span><span class="keyword">,</span><span class="default">$j</span><span class="keyword">, </span><span class="default">$wid </span><span class="keyword">- </span><span class="default">$i</span><span class="keyword">,</span><span class="default">$ref</span><span class="keyword">);<br />
&nbsp; }<br />
&nbsp;}<br />
&nbsp;return </span><span class="default">$im2</span><span class="keyword">;<br />
}<br />
<br />
function </span><span class="default">mirror</span><span class="keyword">(</span><span class="default">$im</span><span class="keyword">)<br />
{<br />
&nbsp;</span><span class="default">$wid </span><span class="keyword">= </span><span class="default">imagesx</span><span class="keyword">(</span><span class="default">$im</span><span class="keyword">);<br />
&nbsp;</span><span class="default">$hei </span><span class="keyword">= </span><span class="default">imagesy</span><span class="keyword">(</span><span class="default">$im</span><span class="keyword">);<br />
&nbsp;</span><span class="default">$im2 </span><span class="keyword">= </span><span class="default">imagecreatetruecolor</span><span class="keyword">(</span><span class="default">$wid</span><span class="keyword">,</span><span class="default">$hei</span><span class="keyword">);<br />
<br />
&nbsp;for(</span><span class="default">$i </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">;</span><span class="default">$i </span><span class="keyword">&lt; </span><span class="default">$wid</span><span class="keyword">; </span><span class="default">$i</span><span class="keyword">++)<br />
&nbsp;{<br />
&nbsp; for(</span><span class="default">$j </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">;</span><span class="default">$j </span><span class="keyword">&lt; </span><span class="default">$hei</span><span class="keyword">; </span><span class="default">$j</span><span class="keyword">++)<br />
&nbsp; {<br />
&nbsp;&nbsp; </span><span class="default">$ref </span><span class="keyword">= </span><span class="default">imagecolorat</span><span class="keyword">(</span><span class="default">$im</span><span class="keyword">,</span><span class="default">$i</span><span class="keyword">,</span><span class="default">$j</span><span class="keyword">);<br />
&nbsp;&nbsp; </span><span class="default">imagesetpixel</span><span class="keyword">(</span><span class="default">$im2</span><span class="keyword">,</span><span class="default">$wid </span><span class="keyword">- </span><span class="default">$i</span><span class="keyword">,</span><span class="default">$j</span><span class="keyword">,</span><span class="default">$ref</span><span class="keyword">);<br />
&nbsp; }<br />
&nbsp;}<br />
&nbsp;return </span><span class="default">$im2</span><span class="keyword">;<br />
}<br />
<br />
function </span><span class="default">flip</span><span class="keyword">(</span><span class="default">$im</span><span class="keyword">)<br />
{<br />
&nbsp;</span><span class="default">$wid </span><span class="keyword">= </span><span class="default">imagesx</span><span class="keyword">(</span><span class="default">$im</span><span class="keyword">);<br />
&nbsp;</span><span class="default">$hei </span><span class="keyword">= </span><span class="default">imagesy</span><span class="keyword">(</span><span class="default">$im</span><span class="keyword">);<br />
&nbsp;</span><span class="default">$im2 </span><span class="keyword">= </span><span class="default">imagecreatetruecolor</span><span class="keyword">(</span><span class="default">$wid</span><span class="keyword">,</span><span class="default">$hei</span><span class="keyword">);<br />
<br />
&nbsp;for(</span><span class="default">$i </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">;</span><span class="default">$i </span><span class="keyword">&lt; </span><span class="default">$wid</span><span class="keyword">; </span><span class="default">$i</span><span class="keyword">++)<br />
&nbsp;{<br />
&nbsp; for(</span><span class="default">$j </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">;</span><span class="default">$j </span><span class="keyword">&lt; </span><span class="default">$hei</span><span class="keyword">; </span><span class="default">$j</span><span class="keyword">++)<br />
&nbsp; {<br />
&nbsp;&nbsp; </span><span class="default">$ref </span><span class="keyword">= </span><span class="default">imagecolorat</span><span class="keyword">(</span><span class="default">$im</span><span class="keyword">,</span><span class="default">$i</span><span class="keyword">,</span><span class="default">$j</span><span class="keyword">);<br />
&nbsp;&nbsp; </span><span class="default">imagesetpixel</span><span class="keyword">(</span><span class="default">$im2</span><span class="keyword">,</span><span class="default">$i</span><span class="keyword">,</span><span class="default">$hei </span><span class="keyword">- </span><span class="default">$j</span><span class="keyword">,</span><span class="default">$ref</span><span class="keyword">);<br />
&nbsp; }<br />
&nbsp;}<br />
&nbsp;return </span><span class="default">$im2</span><span class="keyword">;<br />
}<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="87363""></a>
  <div class="note">
   <strong class="user">joseluis at pellicer dot org</strong>
   <a href="#87363" class="date">02-Dec-2008 05:14</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
About that rotating function by david at horizon-nigh not working, I found the bug.<br />
I noticed that the x1 and y1 where not used, so, in the loop through every pixel and transform it, change<br />
<br />
$x2 = $x * cos($theta) - $y * sin($theta);<br />
$y2 = $x * sin($theta) + $y * cos($theta);<br />
<br />
to:<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br />
$x2 = $x1 * cos($theta) - $y1 * sin($theta);<br />
$y2 = $x1 * sin($theta) + $y1 * cos($theta);</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="86986""></a>
  <div class="note">
   <strong class="user">fernando_empresarial at ig dot com dot br</strong>
   <a href="#86986" class="date">13-Nov-2008 01:52</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
<span class="default">&lt;?php
<br />
$urlImage </span><span class="keyword">= </span><span class="string">"images/image.png"</span><span class="keyword">;
<br />
</span><span class="default">$urlNewImage </span><span class="keyword">= </span><span class="string">"images/imageNew.png"</span><span class="keyword">;
<br />
&nbsp;&nbsp;&nbsp; 
<br />
</span><span class="default">$src_img </span><span class="keyword">= </span><span class="default">imagecreatefrompng</span><span class="keyword">(</span><span class="default">$urlImage</span><span class="keyword">);
<br />
</span><span class="default">$originalX </span><span class="keyword">= </span><span class="default">imagesx</span><span class="keyword">(</span><span class="default">$src_img</span><span class="keyword">);
<br />
</span><span class="default">$originalY </span><span class="keyword">= </span><span class="default">imagesy</span><span class="keyword">(</span><span class="default">$src_img</span><span class="keyword">);
<br />
</span><span class="default">$dst_img </span><span class="keyword">= </span><span class="default">imagecreatetruecolor</span><span class="keyword">(</span><span class="default">640</span><span class="keyword">,</span><span class="default">480</span><span class="keyword">);
<br />

<br />
&nbsp;&nbsp;&nbsp; 
<br />
</span><span class="default">$imageRotate </span><span class="keyword">= </span><span class="default">imagerotate</span><span class="keyword">(</span><span class="default">$src_img</span><span class="keyword">,</span><span class="default">20</span><span class="keyword">,-</span><span class="default">1</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; 
<br />
</span><span class="default">imagepng</span><span class="keyword">(</span><span class="default">$imageRotate</span><span class="keyword">,</span><span class="default">$urlNewImage</span><span class="keyword">);
<br />
</span><span class="default">imagedestroy</span><span class="keyword">(</span><span class="default">$dst_img</span><span class="keyword">); 
<br />
</span><span class="default">imagedestroy</span><span class="keyword">(</span><span class="default">$src_img</span><span class="keyword">);
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="86075""></a>
  <div class="note">
   <strong class="user">foi02 at cartefoi dot net</strong>
   <a href="#86075" class="date">02-Oct-2008 04:50</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
For those who are looking for the GD library for Ubuntu, I let a copy on my server:&nbsp; <a href="http://www.cartefoi.net/compl_compl_2.php" rel="nofollow" target="_blank">http://www.cartefoi.net/compl_compl_2.php</a><br />
It was pretty hard to find, somebody gaveme his. Thanks a lot to him (message up).</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="85847""></a>
  <div class="note">
   <strong class="user">Bert Vandeghinste</strong>
   <a href="#85847" class="date">20-Sep-2008 04:17</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I'm now using david's code with these changes to get a transparent effect.
<br />

<br />
I exec convert 2 times:
<br />

<br />
<span class="default">&lt;?php
<br />
exec</span><span class="keyword">( </span><span class="default">$imagick </span><span class="keyword">. </span><span class="string">' -background \'#555555\' -rotate ' </span><span class="keyword">. </span><span class="default">$angle </span><span class="keyword">. </span><span class="string">' ' </span><span class="keyword">. </span><span class="default">$file1 </span><span class="keyword">. </span><span class="string">' ' </span><span class="keyword">. </span><span class="default">$file2 </span><span class="keyword">);
<br />
</span><span class="default">exec</span><span class="keyword">( </span><span class="default">$imagick </span><span class="keyword">. </span><span class="string">' -transparent \'#555555\' -transparent-color \'#555555\' ' </span><span class="keyword">. </span><span class="default">$file2 </span><span class="keyword">. </span><span class="string">' ' </span><span class="keyword">. </span><span class="default">$file3 </span><span class="keyword">);
<br />
</span><span class="default">?&gt;
<br />
</span>
<br />
and then use this after I rotated $output:
<br />
<span class="default">&lt;?php imagecolortransparent</span><span class="keyword">(</span><span class="default">$output</span><span class="keyword">, </span><span class="default">imagecolorallocatealpha</span><span class="keyword">(</span><span class="default">$output</span><span class="keyword">, </span><span class="default">85</span><span class="keyword">, </span><span class="default">85</span><span class="keyword">, </span><span class="default">85</span><span class="keyword">, </span><span class="default">127</span><span class="keyword">)); </span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="85700""></a>
  <div class="note">
   <strong class="user">david at horizon-nigh dot org</strong>
   <a href="#85700" class="date">12-Sep-2008 06:06</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I couldn't get the replacements from 'the dot thawk' or 'pilot' to work for some reason, so here's my own replacement. It uses ImageMagick; binary must be installed, and you may need to modify the search path. (I didn't use PHP's ImageMagick support for my own reasons.)<br />
<br />
<span class="default">&lt;?php<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">/**<br />
&nbsp;&nbsp; &nbsp; * imagerotate()<br />
&nbsp;&nbsp; &nbsp; * Debian php5-gd packages do not include imagerotate() due to some convoluted reason.<br />
&nbsp;&nbsp; &nbsp; *<br />
&nbsp;&nbsp; &nbsp; * @param int $angle - same as PHP builtin function<br />
&nbsp;&nbsp; &nbsp; * @param $bgd_color - not implemented, apparently always #FFFFFF<br />
&nbsp;&nbsp; &nbsp; *<br />
&nbsp;&nbsp; &nbsp; * @return same as PHP builtin function<br />
&nbsp;&nbsp; &nbsp; */<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">if ( !</span><span class="default">function_exists</span><span class="keyword">( </span><span class="string">'imagerotate' </span><span class="keyword">) ) {<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; function </span><span class="default">imagerotate</span><span class="keyword">( </span><span class="default">$source_image</span><span class="keyword">, </span><span class="default">$angle</span><span class="keyword">, </span><span class="default">$bgd_color </span><span class="keyword">) {<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$angle </span><span class="keyword">= </span><span class="default">360</span><span class="keyword">-</span><span class="default">$angle</span><span class="keyword">; </span><span class="comment">// GD rotates CCW, imagick rotates CW<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">foreach ( array( </span><span class="string">'/usr/bin'</span><span class="keyword">, </span><span class="string">'/usr/local/bin'</span><span class="keyword">, </span><span class="string">'/opt/local/bin'</span><span class="keyword">, </span><span class="string">'/sw/bin' </span><span class="keyword">) as </span><span class="default">$path </span><span class="keyword">) {<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if ( </span><span class="default">file_exists</span><span class="keyword">( </span><span class="default">$path </span><span class="keyword">. </span><span class="string">'/convert' </span><span class="keyword">) ) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$imagick </span><span class="keyword">= </span><span class="default">$path </span><span class="keyword">. </span><span class="string">'/convert'</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if ( </span><span class="default">$path </span><span class="keyword">== </span><span class="string">'/opt/local/bin' </span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$imagick </span><span class="keyword">= </span><span class="string">'DYLD_LIBRARY_PATH="" ' </span><span class="keyword">. </span><span class="default">$imagick</span><span class="keyword">; </span><span class="comment">// some kind of conflict with MacPorts and MAMP<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">}<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; break;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if ( !isset( </span><span class="default">$imagick </span><span class="keyword">) ) {<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">//trigger_error( 'imagerotate(): could not find imagemagick binary, original image returned', E_USER_WARNING );<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">return </span><span class="default">$source_image</span><span class="keyword">;<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$file1 </span><span class="keyword">= </span><span class="string">'/tmp/imagick_' </span><span class="keyword">. </span><span class="default">rand</span><span class="keyword">( </span><span class="default">10000</span><span class="keyword">,</span><span class="default">99999 </span><span class="keyword">) . </span><span class="string">'.png'</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$file2 </span><span class="keyword">= </span><span class="string">'/tmp/imagick_' </span><span class="keyword">. </span><span class="default">rand</span><span class="keyword">( </span><span class="default">10000</span><span class="keyword">,</span><span class="default">99999 </span><span class="keyword">) . </span><span class="string">'.png'</span><span class="keyword">;<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if ( @</span><span class="default">imagepng</span><span class="keyword">( </span><span class="default">$source_image</span><span class="keyword">, </span><span class="default">$file1 </span><span class="keyword">) ) {<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">exec</span><span class="keyword">( </span><span class="default">$imagick </span><span class="keyword">. </span><span class="string">' -rotate ' </span><span class="keyword">. </span><span class="default">$angle </span><span class="keyword">. </span><span class="string">' ' </span><span class="keyword">. </span><span class="default">$file1 </span><span class="keyword">. </span><span class="string">' ' </span><span class="keyword">. </span><span class="default">$file2 </span><span class="keyword">);<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if ( </span><span class="default">file_exists</span><span class="keyword">( </span><span class="default">$file2 </span><span class="keyword">) ) {<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$new_image </span><span class="keyword">= </span><span class="default">imagecreatefrompng</span><span class="keyword">( </span><span class="default">$file2 </span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">unlink</span><span class="keyword">( </span><span class="default">$file1 </span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">unlink</span><span class="keyword">( </span><span class="default">$file2 </span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">$new_image</span><span class="keyword">;<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; } else {<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">//trigger_error( 'imagerotate(): imagemagick conversion failed, original image returned', E_USER_WARNING );<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">return </span><span class="default">$source_image</span><span class="keyword">;<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; } else {<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">//trigger_error( 'imagerotate(): could not write to ' . $file1 . ', original image returned', E_USER_WARNING );<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">return </span><span class="default">$source_image</span><span class="keyword">;<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp;&nbsp; }<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="85329""></a>
  <div class="note">
   <strong class="user">AJenbo</strong>
   <a href="#85329" class="date">26-Aug-2008 10:45</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I modified cbl25's function to allow it to rotate an image either clock wise or counter clock wise.<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">function </span><span class="default">rotateImage</span><span class="keyword">(</span><span class="default">$image</span><span class="keyword">, </span><span class="default">$direction</span><span class="keyword">) {<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$direction </span><span class="keyword">= </span><span class="default">strtolower</span><span class="keyword">(</span><span class="default">$direction</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$degrees </span><span class="keyword">= </span><span class="default">$direction </span><span class="keyword">== </span><span class="string">'cw' </span><span class="keyword">? </span><span class="default">270 </span><span class="keyword">: (</span><span class="default">$direction </span><span class="keyword">== </span><span class="string">'ccw' </span><span class="keyword">? </span><span class="default">90 </span><span class="keyword">: </span><span class="default">NULL</span><span class="keyword">); <br />
&nbsp;&nbsp;&nbsp; if(!</span><span class="default">$degrees</span><span class="keyword">)<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">$image</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$width </span><span class="keyword">= </span><span class="default">imagesx</span><span class="keyword">(</span><span class="default">$image</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$height </span><span class="keyword">= </span><span class="default">imagesy</span><span class="keyword">(</span><span class="default">$image</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$side </span><span class="keyword">= </span><span class="default">$width </span><span class="keyword">&gt; </span><span class="default">$height </span><span class="keyword">? </span><span class="default">$width </span><span class="keyword">: </span><span class="default">$height</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$imageSquare </span><span class="keyword">= </span><span class="default">imagecreatetruecolor</span><span class="keyword">(</span><span class="default">$side</span><span class="keyword">, </span><span class="default">$side</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">imagecopy</span><span class="keyword">(</span><span class="default">$imageSquare</span><span class="keyword">, </span><span class="default">$image</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">$width</span><span class="keyword">, </span><span class="default">$height</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">imagedestroy</span><span class="keyword">(</span><span class="default">$image</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$imageSquare </span><span class="keyword">= </span><span class="default">imagerotate</span><span class="keyword">(</span><span class="default">$imageSquare</span><span class="keyword">, </span><span class="default">$degrees</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, -</span><span class="default">1</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$image </span><span class="keyword">= </span><span class="default">imagecreatetruecolor</span><span class="keyword">(</span><span class="default">$height</span><span class="keyword">, </span><span class="default">$width</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$x </span><span class="keyword">= </span><span class="default">$degrees </span><span class="keyword">== </span><span class="default">90 </span><span class="keyword">? </span><span class="default">0 </span><span class="keyword">: (</span><span class="default">$height </span><span class="keyword">&gt; </span><span class="default">$width </span><span class="keyword">? </span><span class="default">0 </span><span class="keyword">: (</span><span class="default">$side </span><span class="keyword">- </span><span class="default">$height</span><span class="keyword">));<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$y </span><span class="keyword">= </span><span class="default">$degrees </span><span class="keyword">== </span><span class="default">270 </span><span class="keyword">? </span><span class="default">0 </span><span class="keyword">: (</span><span class="default">$height </span><span class="keyword">&lt; </span><span class="default">$width </span><span class="keyword">? </span><span class="default">0 </span><span class="keyword">: (</span><span class="default">$side </span><span class="keyword">- </span><span class="default">$width</span><span class="keyword">));<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">imagecopy</span><span class="keyword">(</span><span class="default">$image</span><span class="keyword">, </span><span class="default">$imageSquare</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">$x</span><span class="keyword">, </span><span class="default">$y</span><span class="keyword">, </span><span class="default">$height</span><span class="keyword">, </span><span class="default">$width</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">imagedestroy</span><span class="keyword">(</span><span class="default">$imageSquare</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; return </span><span class="default">$image</span><span class="keyword">;<br />
}<br />
<br />
</span><span class="comment">//Usage<br />
</span><span class="default">$image </span><span class="keyword">= </span><span class="default">rotateImage</span><span class="keyword">(</span><span class="default">$image</span><span class="keyword">, </span><span class="string">'cw'</span><span class="keyword">);<br />
</span><span class="default">$image </span><span class="keyword">= </span><span class="default">rotateImage</span><span class="keyword">(</span><span class="default">$image</span><span class="keyword">, </span><span class="string">'ccw'</span><span class="keyword">);<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="85187""></a>
  <div class="note">
   <strong class="user">cbl25</strong>
   <a href="#85187" class="date">19-Aug-2008 04:29</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Here is a simple function to rotate a non-square image 90 degrees clockwise.
<br />

<br />
<span class="default">&lt;?php
<br />
</span><span class="keyword">function </span><span class="default">rotateImage</span><span class="keyword">(</span><span class="default">$imageResource</span><span class="keyword">)
<br />
{
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$width </span><span class="keyword">= </span><span class="default">imagesx</span><span class="keyword">(</span><span class="default">$imageResource</span><span class="keyword">);
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$height </span><span class="keyword">= </span><span class="default">imagesy</span><span class="keyword">(</span><span class="default">$imageResource</span><span class="keyword">);
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$side </span><span class="keyword">= </span><span class="default">$width </span><span class="keyword">&gt; </span><span class="default">$height </span><span class="keyword">? </span><span class="default">$width </span><span class="keyword">: </span><span class="default">$height</span><span class="keyword">;
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$squareImage </span><span class="keyword">= </span><span class="default">imagecreatetruecolor</span><span class="keyword">(</span><span class="default">$side</span><span class="keyword">, </span><span class="default">$side</span><span class="keyword">);
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">imagecopy</span><span class="keyword">(</span><span class="default">$squareImage</span><span class="keyword">,</span><span class="default">$imageResource</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">,</span><span class="default">$width</span><span class="keyword">,</span><span class="default">$height</span><span class="keyword">);
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$squareImage </span><span class="keyword">= </span><span class="default">imagerotate</span><span class="keyword">(</span><span class="default">$squareImage</span><span class="keyword">,</span><span class="default">270</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">,-</span><span class="default">1</span><span class="keyword">);
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$imageResource </span><span class="keyword">= </span><span class="default">imagecreatetruecolor</span><span class="keyword">(</span><span class="default">$height</span><span class="keyword">, </span><span class="default">$width</span><span class="keyword">);
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$x </span><span class="keyword">= </span><span class="default">$height </span><span class="keyword">&gt; </span><span class="default">$width </span><span class="keyword">? </span><span class="default">0 </span><span class="keyword">: </span><span class="default">$side </span><span class="keyword">- </span><span class="default">$height</span><span class="keyword">;
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">imagecopy</span><span class="keyword">(</span><span class="default">$imageResource</span><span class="keyword">,</span><span class="default">$squareImage</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">,</span><span class="default">$x</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">,</span><span class="default">$height</span><span class="keyword">,</span><span class="default">$width</span><span class="keyword">);
<br />
&nbsp;&nbsp;&nbsp; return </span><span class="default">$imageResource</span><span class="keyword">;
<br />
}
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="84490""></a>
  <div class="note">
   <strong class="user">the dot thawk+phpnet at gmail dot com</strong>
   <a href="#84490" class="date">16-Jul-2008 05:44</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
In response to pilot at myupb dot com on 31-May-2008 02:23<br />
---<br />
<br />
I am not sure why you would be defining your own PI, instead of using the built-in constant, and why you do the degrees to radian conversion manually. There might be a speed issue, however here is the exact same code with that small difference.<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">if(!</span><span class="default">function_exists</span><span class="keyword">(</span><span class="string">"imagerotate"</span><span class="keyword">)) {<br />
&nbsp;&nbsp;&nbsp; function </span><span class="default">imagerotate</span><span class="keyword">(&amp;</span><span class="default">$srcImg</span><span class="keyword">, </span><span class="default">$angle</span><span class="keyword">, </span><span class="default">$transparentColor </span><span class="keyword">= </span><span class="default">null</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$srcw </span><span class="keyword">= </span><span class="default">imagesx</span><span class="keyword">(</span><span class="default">$srcImg</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$srch </span><span class="keyword">= </span><span class="default">imagesy</span><span class="keyword">(</span><span class="default">$srcImg</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if(</span><span class="default">$angle </span><span class="keyword">== </span><span class="default">0</span><span class="keyword">) return </span><span class="default">$srcImg</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// Convert the angle to radians<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$theta </span><span class="keyword">= </span><span class="default">deg2rad </span><span class="keyword">(</span><span class="default">$angle</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// Get the origin (center) of the image<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$originx </span><span class="keyword">= </span><span class="default">$srcw </span><span class="keyword">/ </span><span class="default">2</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$originy </span><span class="keyword">= </span><span class="default">$srch </span><span class="keyword">/ </span><span class="default">2</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// The pixels array for the new image<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$pixels </span><span class="keyword">= array();<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$minx </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$maxx </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$miny </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$maxy </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$dstw </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$dsth </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// Loop through every pixel and transform it<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">for(</span><span class="default">$x</span><span class="keyword">=</span><span class="default">0</span><span class="keyword">;</span><span class="default">$x</span><span class="keyword">&lt;</span><span class="default">$srcw</span><span class="keyword">;</span><span class="default">$x</span><span class="keyword">++) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; for(</span><span class="default">$y</span><span class="keyword">=</span><span class="default">0</span><span class="keyword">;</span><span class="default">$y</span><span class="keyword">&lt;</span><span class="default">$srch</span><span class="keyword">;</span><span class="default">$y</span><span class="keyword">++) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; list(</span><span class="default">$x1</span><span class="keyword">, </span><span class="default">$y1</span><span class="keyword">) = </span><span class="default">translateCoordinate</span><span class="keyword">(</span><span class="default">$originx</span><span class="keyword">, </span><span class="default">$originy</span><span class="keyword">, </span><span class="default">$x</span><span class="keyword">, </span><span class="default">$y</span><span class="keyword">, </span><span class="default">false</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$x2 </span><span class="keyword">= </span><span class="default">$x </span><span class="keyword">* </span><span class="default">cos</span><span class="keyword">(</span><span class="default">$theta</span><span class="keyword">) - </span><span class="default">$y </span><span class="keyword">* </span><span class="default">sin</span><span class="keyword">(</span><span class="default">$theta</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$y2 </span><span class="keyword">= </span><span class="default">$x </span><span class="keyword">* </span><span class="default">sin</span><span class="keyword">(</span><span class="default">$theta</span><span class="keyword">) + </span><span class="default">$y </span><span class="keyword">* </span><span class="default">cos</span><span class="keyword">(</span><span class="default">$theta</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// Store the pixel color<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$pixels</span><span class="keyword">[] = array(</span><span class="default">$x2</span><span class="keyword">, </span><span class="default">$y2</span><span class="keyword">, </span><span class="default">imagecolorat</span><span class="keyword">(</span><span class="default">$srcImg</span><span class="keyword">, </span><span class="default">$x</span><span class="keyword">, </span><span class="default">$y</span><span class="keyword">));<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// Check our boundaries<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">if(</span><span class="default">$x2 </span><span class="keyword">&gt; </span><span class="default">$maxx</span><span class="keyword">) </span><span class="default">$maxx </span><span class="keyword">= </span><span class="default">$x2</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if(</span><span class="default">$x2 </span><span class="keyword">&lt; </span><span class="default">$minx</span><span class="keyword">) </span><span class="default">$minx </span><span class="keyword">= </span><span class="default">$x2</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if(</span><span class="default">$y2 </span><span class="keyword">&gt; </span><span class="default">$maxy</span><span class="keyword">) </span><span class="default">$maxy </span><span class="keyword">= </span><span class="default">$y2</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if(</span><span class="default">$y2 </span><span class="keyword">&lt; </span><span class="default">$miny</span><span class="keyword">) </span><span class="default">$miny </span><span class="keyword">= </span><span class="default">$y2</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// Determine the new image size<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$dstw </span><span class="keyword">= </span><span class="default">$maxx </span><span class="keyword">- </span><span class="default">$minx </span><span class="keyword">+ </span><span class="default">1</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$dsth </span><span class="keyword">= </span><span class="default">$maxy </span><span class="keyword">- </span><span class="default">$miny </span><span class="keyword">+ </span><span class="default">1</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// Create our new image<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$dstImg </span><span class="keyword">= </span><span class="default">imagecreatetruecolor</span><span class="keyword">(</span><span class="default">$dstw</span><span class="keyword">, </span><span class="default">$dsth</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// Fill the background with our transparent color<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">if(</span><span class="default">$transparentColor </span><span class="keyword">== </span><span class="default">null</span><span class="keyword">) </span><span class="default">$transparentColor </span><span class="keyword">= </span><span class="default">imagecolorallocate</span><span class="keyword">(</span><span class="default">$dstImg</span><span class="keyword">, </span><span class="default">1</span><span class="keyword">, </span><span class="default">2</span><span class="keyword">, </span><span class="default">3</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">imagecolortransparent</span><span class="keyword">(</span><span class="default">$dstImg</span><span class="keyword">, </span><span class="default">$transparentColor</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">imagefilledrectangle</span><span class="keyword">(</span><span class="default">$dstImg</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">$dstw </span><span class="keyword">+ </span><span class="default">1</span><span class="keyword">, </span><span class="default">$dsth </span><span class="keyword">+ </span><span class="default">1</span><span class="keyword">, </span><span class="default">$transparentColor</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// Get the new origin<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$neworiginx </span><span class="keyword">= -</span><span class="default">$minx</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$neworiginy </span><span class="keyword">= -</span><span class="default">$miny</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// Fill in the pixels<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">foreach(</span><span class="default">$pixels </span><span class="keyword">as </span><span class="default">$data</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; list(</span><span class="default">$x</span><span class="keyword">, </span><span class="default">$y</span><span class="keyword">, </span><span class="default">$color</span><span class="keyword">) = </span><span class="default">$data</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; list(</span><span class="default">$newx</span><span class="keyword">, </span><span class="default">$newy</span><span class="keyword">) = </span><span class="default">translateCoordinate</span><span class="keyword">(</span><span class="default">$neworiginx</span><span class="keyword">, </span><span class="default">$neworiginy</span><span class="keyword">, </span><span class="default">$x</span><span class="keyword">, </span><span class="default">$y</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">imagesetpixel</span><span class="keyword">(</span><span class="default">$dstImg</span><span class="keyword">, </span><span class="default">$newx</span><span class="keyword">, </span><span class="default">$newy</span><span class="keyword">, </span><span class="default">$color</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">$dstImg</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">/**<br />
&nbsp;&nbsp; &nbsp; * Translates from mathematical coordinate system to computer coordinate system using<br />
&nbsp;&nbsp; &nbsp; * origin coordinates from the computer system or visa versa<br />
&nbsp;&nbsp; &nbsp; *<br />
&nbsp;&nbsp; &nbsp; * @param int $originx<br />
&nbsp;&nbsp; &nbsp; * @param int $originy<br />
&nbsp;&nbsp; &nbsp; * @param int $x<br />
&nbsp;&nbsp; &nbsp; * @param int $y<br />
&nbsp;&nbsp; &nbsp; * @param bool $toComp<br />
&nbsp;&nbsp; &nbsp; * @return array(int $x, int $y)<br />
&nbsp;&nbsp; &nbsp; */<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">function </span><span class="default">translateCoordinate</span><span class="keyword">(</span><span class="default">$originx</span><span class="keyword">, </span><span class="default">$originy</span><span class="keyword">, </span><span class="default">$x</span><span class="keyword">, </span><span class="default">$y</span><span class="keyword">, </span><span class="default">$toComp</span><span class="keyword">=</span><span class="default">true</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if(</span><span class="default">$toComp</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$newx </span><span class="keyword">= </span><span class="default">$originx </span><span class="keyword">+ </span><span class="default">$x</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$newy </span><span class="keyword">= </span><span class="default">$originy </span><span class="keyword">- </span><span class="default">$y</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; } else {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$newx </span><span class="keyword">= </span><span class="default">$x </span><span class="keyword">- </span><span class="default">$originx</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$newy </span><span class="keyword">= </span><span class="default">$originy </span><span class="keyword">- </span><span class="default">$y</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return array(</span><span class="default">$newx</span><span class="keyword">, </span><span class="default">$newy</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; }<br />
}<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="83547""></a>
  <div class="note">
   <strong class="user">pilot at myupb dot com</strong>
   <a href="#83547" class="date">31-May-2008 02:23</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Shortly after posting I was informed about a very nice algorithm for calculating the new pixel position for a rotation and thought it would be a nice improvement. Hopes this helps anyone needing a full implementation.<br />
<br />
Note: I tested the function on a 3Mb photo and it seemed to work perfectly with no quality loss.<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">if(!</span><span class="default">function_exists</span><span class="keyword">(</span><span class="string">"imagerotate"</span><span class="keyword">)) {<br />
&nbsp;&nbsp;&nbsp; function </span><span class="default">imagerotate</span><span class="keyword">(&amp;</span><span class="default">$srcImg</span><span class="keyword">, </span><span class="default">$angle</span><span class="keyword">, </span><span class="default">$transparentColor </span><span class="keyword">= </span><span class="default">null</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$srcw </span><span class="keyword">= </span><span class="default">imagesx</span><span class="keyword">(</span><span class="default">$srcImg</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$srch </span><span class="keyword">= </span><span class="default">imagesy</span><span class="keyword">(</span><span class="default">$srcImg</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if(</span><span class="default">$angle </span><span class="keyword">== </span><span class="default">0</span><span class="keyword">) return </span><span class="default">$srcImg</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// Convert the angle to radians<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$pi </span><span class="keyword">= </span><span class="default">3.141592654</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$theta </span><span class="keyword">= </span><span class="default">$angle </span><span class="keyword">* </span><span class="default">$pi </span><span class="keyword">/ </span><span class="default">180</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// Get the origin (center) of the image<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$originx </span><span class="keyword">= </span><span class="default">$srcw </span><span class="keyword">/ </span><span class="default">2</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$originy </span><span class="keyword">= </span><span class="default">$srch </span><span class="keyword">/ </span><span class="default">2</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// The pixels array for the new image<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$pixels </span><span class="keyword">= array();<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$minx </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$maxx </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$miny </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$maxy </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$dstw </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$dsth </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// Loop through every pixel and transform it<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">for(</span><span class="default">$x</span><span class="keyword">=</span><span class="default">0</span><span class="keyword">;</span><span class="default">$x</span><span class="keyword">&lt;</span><span class="default">$srcw</span><span class="keyword">;</span><span class="default">$x</span><span class="keyword">++) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; for(</span><span class="default">$y</span><span class="keyword">=</span><span class="default">0</span><span class="keyword">;</span><span class="default">$y</span><span class="keyword">&lt;</span><span class="default">$srch</span><span class="keyword">;</span><span class="default">$y</span><span class="keyword">++) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; list(</span><span class="default">$x1</span><span class="keyword">, </span><span class="default">$y1</span><span class="keyword">) = </span><span class="default">translateCoordinate</span><span class="keyword">(</span><span class="default">$originx</span><span class="keyword">, </span><span class="default">$originy</span><span class="keyword">, </span><span class="default">$x</span><span class="keyword">, </span><span class="default">$y</span><span class="keyword">, </span><span class="default">false</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$x2 </span><span class="keyword">= </span><span class="default">$x </span><span class="keyword">* </span><span class="default">cos</span><span class="keyword">(</span><span class="default">$theta</span><span class="keyword">) - </span><span class="default">$y </span><span class="keyword">* </span><span class="default">sin</span><span class="keyword">(</span><span class="default">$theta</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$y2 </span><span class="keyword">= </span><span class="default">$x </span><span class="keyword">* </span><span class="default">sin</span><span class="keyword">(</span><span class="default">$theta</span><span class="keyword">) + </span><span class="default">$y </span><span class="keyword">* </span><span class="default">cos</span><span class="keyword">(</span><span class="default">$theta</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// Store the pixel color<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$pixels</span><span class="keyword">[] = array(</span><span class="default">$x2</span><span class="keyword">, </span><span class="default">$y2</span><span class="keyword">, </span><span class="default">imagecolorat</span><span class="keyword">(</span><span class="default">$srcImg</span><span class="keyword">, </span><span class="default">$x</span><span class="keyword">, </span><span class="default">$y</span><span class="keyword">));<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// Check our boundaries<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">if(</span><span class="default">$x2 </span><span class="keyword">&gt; </span><span class="default">$maxx</span><span class="keyword">) </span><span class="default">$maxx </span><span class="keyword">= </span><span class="default">$x2</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if(</span><span class="default">$x2 </span><span class="keyword">&lt; </span><span class="default">$minx</span><span class="keyword">) </span><span class="default">$minx </span><span class="keyword">= </span><span class="default">$x2</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if(</span><span class="default">$y2 </span><span class="keyword">&gt; </span><span class="default">$maxy</span><span class="keyword">) </span><span class="default">$maxy </span><span class="keyword">= </span><span class="default">$y2</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if(</span><span class="default">$y2 </span><span class="keyword">&lt; </span><span class="default">$miny</span><span class="keyword">) </span><span class="default">$miny </span><span class="keyword">= </span><span class="default">$y2</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// Determine the new image size<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$dstw </span><span class="keyword">= </span><span class="default">$maxx </span><span class="keyword">- </span><span class="default">$minx </span><span class="keyword">+ </span><span class="default">1</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$dsth </span><span class="keyword">= </span><span class="default">$maxy </span><span class="keyword">- </span><span class="default">$miny </span><span class="keyword">+ </span><span class="default">1</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// Create our new image<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$dstImg </span><span class="keyword">= </span><span class="default">imagecreatetruecolor</span><span class="keyword">(</span><span class="default">$dstw</span><span class="keyword">, </span><span class="default">$dsth</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// Fill the background with our transparent color<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">if(</span><span class="default">$transparentColor </span><span class="keyword">== </span><span class="default">null</span><span class="keyword">) </span><span class="default">$transparentColor </span><span class="keyword">= </span><span class="default">imagecolorallocate</span><span class="keyword">(</span><span class="default">$dstImg</span><span class="keyword">, </span><span class="default">1</span><span class="keyword">, </span><span class="default">2</span><span class="keyword">, </span><span class="default">3</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">imagecolortransparent</span><span class="keyword">(</span><span class="default">$dstImg</span><span class="keyword">, </span><span class="default">$transparentColor</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">imagefilledrectangle</span><span class="keyword">(</span><span class="default">$dstImg</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">$dstw </span><span class="keyword">+ </span><span class="default">1</span><span class="keyword">, </span><span class="default">$dsth </span><span class="keyword">+ </span><span class="default">1</span><span class="keyword">, </span><span class="default">$transparentColor</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// Get the new origin<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$neworiginx </span><span class="keyword">= -</span><span class="default">$minx</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$neworiginy </span><span class="keyword">= -</span><span class="default">$miny</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// Fill in the pixels<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">foreach(</span><span class="default">$pixels </span><span class="keyword">as </span><span class="default">$data</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; list(</span><span class="default">$x</span><span class="keyword">, </span><span class="default">$y</span><span class="keyword">, </span><span class="default">$color</span><span class="keyword">) = </span><span class="default">$data</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; list(</span><span class="default">$newx</span><span class="keyword">, </span><span class="default">$newy</span><span class="keyword">) = </span><span class="default">translateCoordinate</span><span class="keyword">(</span><span class="default">$neworiginx</span><span class="keyword">, </span><span class="default">$neworiginy</span><span class="keyword">, </span><span class="default">$x</span><span class="keyword">, </span><span class="default">$y</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">imagesetpixel</span><span class="keyword">(</span><span class="default">$dstImg</span><span class="keyword">, </span><span class="default">$newx</span><span class="keyword">, </span><span class="default">$newy</span><span class="keyword">, </span><span class="default">$color</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">$dstImg</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">/**<br />
&nbsp;&nbsp; &nbsp; * Translates from mathematical coordinate system to computer coordinate system using<br />
&nbsp;&nbsp; &nbsp; * origin coordinates from the computer system or visa versa<br />
&nbsp;&nbsp; &nbsp; *<br />
&nbsp;&nbsp; &nbsp; * @param int $originx<br />
&nbsp;&nbsp; &nbsp; * @param int $originy<br />
&nbsp;&nbsp; &nbsp; * @param int $x<br />
&nbsp;&nbsp; &nbsp; * @param int $y<br />
&nbsp;&nbsp; &nbsp; * @param bool $toComp<br />
&nbsp;&nbsp; &nbsp; * @return array(int $x, int $y)<br />
&nbsp;&nbsp; &nbsp; */<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">function </span><span class="default">translateCoordinate</span><span class="keyword">(</span><span class="default">$originx</span><span class="keyword">, </span><span class="default">$originy</span><span class="keyword">, </span><span class="default">$x</span><span class="keyword">, </span><span class="default">$y</span><span class="keyword">, </span><span class="default">$toComp</span><span class="keyword">=</span><span class="default">true</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if(</span><span class="default">$toComp</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$newx </span><span class="keyword">= </span><span class="default">$originx </span><span class="keyword">+ </span><span class="default">$x</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$newy </span><span class="keyword">= </span><span class="default">$originy </span><span class="keyword">- </span><span class="default">$y</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; } else {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$newx </span><span class="keyword">= </span><span class="default">$x </span><span class="keyword">- </span><span class="default">$originx</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$newy </span><span class="keyword">= </span><span class="default">$originy </span><span class="keyword">- </span><span class="default">$y</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return array(</span><span class="default">$newx</span><span class="keyword">, </span><span class="default">$newy</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; }<br />
}<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="83530""></a>
  <div class="note">
   <strong class="user">pilot at myupb dot com</strong>
   <a href="#83530" class="date">30-May-2008 04:33</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Thanks to the people who contributed the code for the 90 180 and 270 rotations. I needed a full implementation however so I wrote one. By no mean do I think this is the best way of doing it, I just whipped this together for myself. Seems to work good for me.
<br />

<br />
Note: I didn't want the image to be shrunk when rotating so this implementation will keep the size of the original image but just rotate it.
<br />

<br />
<span class="default">&lt;?php
<br />
</span><span class="keyword">if(!</span><span class="default">function_exists</span><span class="keyword">(</span><span class="string">"imagerotate"</span><span class="keyword">)) {
<br />
&nbsp;&nbsp;&nbsp; function </span><span class="default">imagerotate</span><span class="keyword">(&amp;</span><span class="default">$srcImg</span><span class="keyword">, </span><span class="default">$angle</span><span class="keyword">, </span><span class="default">$transparentColor </span><span class="keyword">= </span><span class="default">null</span><span class="keyword">) {
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$srcw </span><span class="keyword">= </span><span class="default">imagesx</span><span class="keyword">(</span><span class="default">$srcImg</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$srch </span><span class="keyword">= </span><span class="default">imagesy</span><span class="keyword">(</span><span class="default">$srcImg</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; 
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if(</span><span class="default">$angle </span><span class="keyword">== </span><span class="default">0</span><span class="keyword">) return </span><span class="default">$srcImg</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; 
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// Convert the angle to radians
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$pi </span><span class="keyword">= </span><span class="default">3.141592654</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$theta </span><span class="keyword">= </span><span class="default">$angle </span><span class="keyword">* </span><span class="default">$pi </span><span class="keyword">/ </span><span class="default">180</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; 
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// Get the origin (center) of the image
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$originx </span><span class="keyword">= </span><span class="default">$srcw </span><span class="keyword">/ </span><span class="default">2</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$originy </span><span class="keyword">= </span><span class="default">$srch </span><span class="keyword">/ </span><span class="default">2</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; 
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// The pixels array for the new image
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$pixels </span><span class="keyword">= array();
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$minx </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$maxx </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$miny </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$maxy </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$dstw </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$dsth </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; 
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// Loop through every pixel and transform it
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">for(</span><span class="default">$x</span><span class="keyword">=</span><span class="default">0</span><span class="keyword">;</span><span class="default">$x</span><span class="keyword">&lt;</span><span class="default">$srcw</span><span class="keyword">;</span><span class="default">$x</span><span class="keyword">++) {
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; for(</span><span class="default">$y</span><span class="keyword">=</span><span class="default">0</span><span class="keyword">;</span><span class="default">$y</span><span class="keyword">&lt;</span><span class="default">$srch</span><span class="keyword">;</span><span class="default">$y</span><span class="keyword">++) {
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; list(</span><span class="default">$x1</span><span class="keyword">, </span><span class="default">$y1</span><span class="keyword">) = </span><span class="default">translateCoordinate</span><span class="keyword">(</span><span class="default">$originx</span><span class="keyword">, </span><span class="default">$originy</span><span class="keyword">, </span><span class="default">$x</span><span class="keyword">, </span><span class="default">$y</span><span class="keyword">, </span><span class="default">false</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; 
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$theta1 </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$noTranslate </span><span class="keyword">= </span><span class="default">false</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; 
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// Determine the angle of original point
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">if(</span><span class="default">$x1 </span><span class="keyword">&gt; </span><span class="default">0 </span><span class="keyword">&amp;&amp; </span><span class="default">$y1 </span><span class="keyword">&gt; </span><span class="default">0</span><span class="keyword">) {
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// Quadrant 1
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$theta1 </span><span class="keyword">= </span><span class="default">atan</span><span class="keyword">(</span><span class="default">$y1</span><span class="keyword">/</span><span class="default">$x1</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; } elseif(</span><span class="default">$x1 </span><span class="keyword">&lt; </span><span class="default">0 </span><span class="keyword">&amp;&amp; </span><span class="default">$y1 </span><span class="keyword">&gt; </span><span class="default">0</span><span class="keyword">) {
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// Quadrant 2
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$theta1 </span><span class="keyword">= </span><span class="default">$pi </span><span class="keyword">- </span><span class="default">atan</span><span class="keyword">(</span><span class="default">$y1</span><span class="keyword">/</span><span class="default">abs</span><span class="keyword">(</span><span class="default">$x1</span><span class="keyword">));
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; } elseif(</span><span class="default">$x1 </span><span class="keyword">&lt; </span><span class="default">0 </span><span class="keyword">&amp;&amp; </span><span class="default">$y1 </span><span class="keyword">&lt; </span><span class="default">0</span><span class="keyword">) {
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// Quadrant 3
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$theta1 </span><span class="keyword">= </span><span class="default">$pi </span><span class="keyword">+ </span><span class="default">atan</span><span class="keyword">(</span><span class="default">$y1</span><span class="keyword">/</span><span class="default">$x1</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; } elseif(</span><span class="default">$x1 </span><span class="keyword">&gt; </span><span class="default">0 </span><span class="keyword">&amp;&amp; </span><span class="default">$y1 </span><span class="keyword">&lt; </span><span class="default">0</span><span class="keyword">) {
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// Quadrant 4
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$theta1 </span><span class="keyword">= </span><span class="default">2 </span><span class="keyword">* </span><span class="default">$pi </span><span class="keyword">- </span><span class="default">atan</span><span class="keyword">(</span><span class="default">abs</span><span class="keyword">(</span><span class="default">$y1</span><span class="keyword">)/</span><span class="default">$x1</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; } elseif(</span><span class="default">$x1 </span><span class="keyword">== </span><span class="default">0 </span><span class="keyword">&amp;&amp; </span><span class="default">$y1 </span><span class="keyword">&gt; </span><span class="default">0</span><span class="keyword">) {
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$theta1 </span><span class="keyword">= </span><span class="default">$pi </span><span class="keyword">/ </span><span class="default">2</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; } elseif(</span><span class="default">$x1 </span><span class="keyword">== </span><span class="default">0 </span><span class="keyword">&amp;&amp; </span><span class="default">$y1 </span><span class="keyword">&lt; </span><span class="default">0</span><span class="keyword">) {
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$theta1 </span><span class="keyword">= </span><span class="default">3 </span><span class="keyword">* </span><span class="default">$pi </span><span class="keyword">/ </span><span class="default">2</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; } elseif(</span><span class="default">$x1 </span><span class="keyword">&gt; </span><span class="default">0 </span><span class="keyword">&amp;&amp; </span><span class="default">$y1 </span><span class="keyword">== </span><span class="default">0</span><span class="keyword">) {
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$theta1 </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; } elseif(</span><span class="default">$x1 </span><span class="keyword">&lt; </span><span class="default">0 </span><span class="keyword">&amp;&amp; </span><span class="default">$y1 </span><span class="keyword">== </span><span class="default">0</span><span class="keyword">) {
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$theta1 </span><span class="keyword">= </span><span class="default">$pi</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; } else {
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// Only case left should be $x1 == 0 &amp;&amp; $y1 == 0
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$noTranslate </span><span class="keyword">= </span><span class="default">true</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; 
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// Translate the position
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">if(!</span><span class="default">$noTranslate</span><span class="keyword">) {
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// Calculate the new angle
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$theta2 </span><span class="keyword">= </span><span class="default">$theta1 </span><span class="keyword">+ </span><span class="default">$theta</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; 
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// Make sure theta2 is in between 0 - 2pi
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">while(</span><span class="default">$theta2 </span><span class="keyword">&lt; </span><span class="default">0</span><span class="keyword">) </span><span class="default">$theta2 </span><span class="keyword">+= </span><span class="default">2 </span><span class="keyword">* </span><span class="default">$pi</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; while(</span><span class="default">$theta2 </span><span class="keyword">&gt; (</span><span class="default">2 </span><span class="keyword">* </span><span class="default">$pi</span><span class="keyword">)) </span><span class="default">$theta2 </span><span class="keyword">-= </span><span class="default">2 </span><span class="keyword">* </span><span class="default">$pi</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; 
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$radius </span><span class="keyword">= </span><span class="default">sqrt</span><span class="keyword">(</span><span class="default">$x1</span><span class="keyword">*</span><span class="default">$x1 </span><span class="keyword">+ </span><span class="default">$y1</span><span class="keyword">*</span><span class="default">$y1</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; 
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$x2 </span><span class="keyword">= (</span><span class="default">$radius </span><span class="keyword">* </span><span class="default">cos</span><span class="keyword">(</span><span class="default">$theta2</span><span class="keyword">));
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$y2 </span><span class="keyword">= (</span><span class="default">$radius </span><span class="keyword">* </span><span class="default">sin</span><span class="keyword">(</span><span class="default">$theta2</span><span class="keyword">));
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; } else {
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$x2 </span><span class="keyword">= </span><span class="default">$x1</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$y2 </span><span class="keyword">= </span><span class="default">$y1</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; 
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// Store the pixel color
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$pixels</span><span class="keyword">[] = array(</span><span class="default">$x2</span><span class="keyword">, </span><span class="default">$y2</span><span class="keyword">, </span><span class="default">imagecolorat</span><span class="keyword">(</span><span class="default">$srcImg</span><span class="keyword">, </span><span class="default">$x</span><span class="keyword">, </span><span class="default">$y</span><span class="keyword">));
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; 
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// Check our boundaries
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">if(</span><span class="default">$x2 </span><span class="keyword">&gt; </span><span class="default">$maxx</span><span class="keyword">) </span><span class="default">$maxx </span><span class="keyword">= </span><span class="default">$x2</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if(</span><span class="default">$x2 </span><span class="keyword">&lt; </span><span class="default">$minx</span><span class="keyword">) </span><span class="default">$minx </span><span class="keyword">= </span><span class="default">$x2</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if(</span><span class="default">$y2 </span><span class="keyword">&gt; </span><span class="default">$maxy</span><span class="keyword">) </span><span class="default">$maxy </span><span class="keyword">= </span><span class="default">$y2</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if(</span><span class="default">$y2 </span><span class="keyword">&lt; </span><span class="default">$miny</span><span class="keyword">) </span><span class="default">$miny </span><span class="keyword">= </span><span class="default">$y2</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; 
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// Determine the new image size
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$dstw </span><span class="keyword">= </span><span class="default">$maxx </span><span class="keyword">- </span><span class="default">$minx </span><span class="keyword">+ </span><span class="default">1</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$dsth </span><span class="keyword">= </span><span class="default">$maxy </span><span class="keyword">- </span><span class="default">$miny </span><span class="keyword">+ </span><span class="default">1</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; 
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// Create our new image
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$dstImg </span><span class="keyword">= </span><span class="default">imagecreatetruecolor</span><span class="keyword">(</span><span class="default">$dstw</span><span class="keyword">, </span><span class="default">$dsth</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; 
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// Fill the background with our transparent color
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">if(</span><span class="default">$transparentColor </span><span class="keyword">== </span><span class="default">null</span><span class="keyword">) </span><span class="default">$transparentColor </span><span class="keyword">= </span><span class="default">imagecolorallocate</span><span class="keyword">(</span><span class="default">$dstImg</span><span class="keyword">, </span><span class="default">1</span><span class="keyword">, </span><span class="default">2</span><span class="keyword">, </span><span class="default">3</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">imagecolortransparent</span><span class="keyword">(</span><span class="default">$dstImg</span><span class="keyword">, </span><span class="default">$transparentColor</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">imagefilledrectangle</span><span class="keyword">(</span><span class="default">$dstImg</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">$dstw </span><span class="keyword">+ </span><span class="default">1</span><span class="keyword">, </span><span class="default">$dsth </span><span class="keyword">+ </span><span class="default">1</span><span class="keyword">, </span><span class="default">$transparentColor</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; 
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// Get the new origin
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$neworiginx </span><span class="keyword">= -</span><span class="default">$minx</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$neworiginy </span><span class="keyword">= -</span><span class="default">$miny</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; 
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// Fill in the pixels
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">foreach(</span><span class="default">$pixels </span><span class="keyword">as </span><span class="default">$data</span><span class="keyword">) {
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; list(</span><span class="default">$x</span><span class="keyword">, </span><span class="default">$y</span><span class="keyword">, </span><span class="default">$color</span><span class="keyword">) = </span><span class="default">$data</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; list(</span><span class="default">$newx</span><span class="keyword">, </span><span class="default">$newy</span><span class="keyword">) = </span><span class="default">translateCoordinate</span><span class="keyword">(</span><span class="default">$neworiginx</span><span class="keyword">, </span><span class="default">$neworiginy</span><span class="keyword">, </span><span class="default">$x</span><span class="keyword">, </span><span class="default">$y</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">imagesetpixel</span><span class="keyword">(</span><span class="default">$dstImg</span><span class="keyword">, </span><span class="default">$newx</span><span class="keyword">, </span><span class="default">$newy</span><span class="keyword">, </span><span class="default">$color</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; 
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">$dstImg</span><span class="keyword">;
<br />
&nbsp;&nbsp;&nbsp; }
<br />
&nbsp;&nbsp;&nbsp; 
<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">/**
<br />
&nbsp;&nbsp; &nbsp; * Translates from mathematical coordinate system to computer coordinate system using
<br />
&nbsp;&nbsp; &nbsp; * origin coordinates from the computer system or visa versa
<br />
&nbsp;&nbsp; &nbsp; *
<br />
&nbsp;&nbsp; &nbsp; * @param int $originx
<br />
&nbsp;&nbsp; &nbsp; * @param int $originy
<br />
&nbsp;&nbsp; &nbsp; * @param int $x
<br />
&nbsp;&nbsp; &nbsp; * @param int $y
<br />
&nbsp;&nbsp; &nbsp; * @param bool $toComp
<br />
&nbsp;&nbsp; &nbsp; * @return array(int $x, int $y)
<br />
&nbsp;&nbsp; &nbsp; */
<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">function </span><span class="default">translateCoordinate</span><span class="keyword">(</span><span class="default">$originx</span><span class="keyword">, </span><span class="default">$originy</span><span class="keyword">, </span><span class="default">$x</span><span class="keyword">, </span><span class="default">$y</span><span class="keyword">, </span><span class="default">$toComp</span><span class="keyword">=</span><span class="default">true</span><span class="keyword">) {
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if(</span><span class="default">$toComp</span><span class="keyword">) {
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$newx </span><span class="keyword">= </span><span class="default">$originx </span><span class="keyword">+ </span><span class="default">$x</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$newy </span><span class="keyword">= </span><span class="default">$originy </span><span class="keyword">- </span><span class="default">$y</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; } else {
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$newx </span><span class="keyword">= </span><span class="default">$x </span><span class="keyword">- </span><span class="default">$originx</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$newy </span><span class="keyword">= </span><span class="default">$originy </span><span class="keyword">- </span><span class="default">$y</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; 
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return array(</span><span class="default">$newx</span><span class="keyword">, </span><span class="default">$newy</span><span class="keyword">);
<br />
&nbsp;&nbsp;&nbsp; }
<br />
}
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="82201""></a>
  <div class="note">
   <strong class="user">achilles</strong>
   <a href="#82201" class="date">31-Mar-2008 11:02</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
otimized integration from 23-Feb-2007 04:21<br />
just put it anywhere you like to use imagerotate with 90, 180, 270 degrees.<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">if(!</span><span class="default">function_exists</span><span class="keyword">(</span><span class="string">"imagerotate"</span><span class="keyword">)) {<br />
&nbsp;&nbsp;&nbsp; function </span><span class="default">imagerotate</span><span class="keyword">(</span><span class="default">$src_img</span><span class="keyword">, </span><span class="default">$angle</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$src_x </span><span class="keyword">= </span><span class="default">imagesx</span><span class="keyword">(</span><span class="default">$src_img</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$src_y </span><span class="keyword">= </span><span class="default">imagesy</span><span class="keyword">(</span><span class="default">$src_img</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">$angle </span><span class="keyword">== </span><span class="default">180</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$dest_x </span><span class="keyword">= </span><span class="default">$src_x</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$dest_y </span><span class="keyword">= </span><span class="default">$src_y</span><span class="keyword">; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; elseif (</span><span class="default">$src_x </span><span class="keyword">&lt;= </span><span class="default">$src_y</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$dest_x </span><span class="keyword">= </span><span class="default">$src_y</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$dest_y </span><span class="keyword">= </span><span class="default">$src_x</span><span class="keyword">; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; elseif (</span><span class="default">$src_x </span><span class="keyword">&gt;= </span><span class="default">$src_y</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$dest_x </span><span class="keyword">= </span><span class="default">$src_y</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$dest_y </span><span class="keyword">= </span><span class="default">$src_x</span><span class="keyword">; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$rotate</span><span class="keyword">=</span><span class="default">imagecreatetruecolor</span><span class="keyword">(</span><span class="default">$dest_x</span><span class="keyword">,</span><span class="default">$dest_y</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">imagealphablending</span><span class="keyword">(</span><span class="default">$rotate</span><span class="keyword">, </span><span class="default">false</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; switch (</span><span class="default">$angle</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; case </span><span class="default">270</span><span class="keyword">:<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; for (</span><span class="default">$y </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">; </span><span class="default">$y </span><span class="keyword">&lt; (</span><span class="default">$src_y</span><span class="keyword">); </span><span class="default">$y</span><span class="keyword">++) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; for (</span><span class="default">$x </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">; </span><span class="default">$x </span><span class="keyword">&lt; (</span><span class="default">$src_x</span><span class="keyword">); </span><span class="default">$x</span><span class="keyword">++) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$color </span><span class="keyword">= </span><span class="default">imagecolorat</span><span class="keyword">(</span><span class="default">$src_img</span><span class="keyword">, </span><span class="default">$x</span><span class="keyword">, </span><span class="default">$y</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">imagesetpixel</span><span class="keyword">(</span><span class="default">$rotate</span><span class="keyword">, </span><span class="default">$dest_x </span><span class="keyword">- </span><span class="default">$y </span><span class="keyword">- </span><span class="default">1</span><span class="keyword">, </span><span class="default">$x</span><span class="keyword">, </span><span class="default">$color</span><span class="keyword">); }}<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; break;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; case </span><span class="default">90</span><span class="keyword">:<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; for (</span><span class="default">$y </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">; </span><span class="default">$y </span><span class="keyword">&lt; (</span><span class="default">$src_y</span><span class="keyword">); </span><span class="default">$y</span><span class="keyword">++) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; for (</span><span class="default">$x </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">; </span><span class="default">$x </span><span class="keyword">&lt; (</span><span class="default">$src_x</span><span class="keyword">); </span><span class="default">$x</span><span class="keyword">++) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$color </span><span class="keyword">= </span><span class="default">imagecolorat</span><span class="keyword">(</span><span class="default">$src_img</span><span class="keyword">, </span><span class="default">$x</span><span class="keyword">, </span><span class="default">$y</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">imagesetpixel</span><span class="keyword">(</span><span class="default">$rotate</span><span class="keyword">, </span><span class="default">$y</span><span class="keyword">, </span><span class="default">$dest_y </span><span class="keyword">- </span><span class="default">$x </span><span class="keyword">- </span><span class="default">1</span><span class="keyword">, </span><span class="default">$color</span><span class="keyword">); }}<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; break;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; case </span><span class="default">180</span><span class="keyword">:<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; for (</span><span class="default">$y </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">; </span><span class="default">$y </span><span class="keyword">&lt; (</span><span class="default">$src_y</span><span class="keyword">); </span><span class="default">$y</span><span class="keyword">++) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; for (</span><span class="default">$x </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">; </span><span class="default">$x </span><span class="keyword">&lt; (</span><span class="default">$src_x</span><span class="keyword">); </span><span class="default">$x</span><span class="keyword">++) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$color </span><span class="keyword">= </span><span class="default">imagecolorat</span><span class="keyword">(</span><span class="default">$src_img</span><span class="keyword">, </span><span class="default">$x</span><span class="keyword">, </span><span class="default">$y</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">imagesetpixel</span><span class="keyword">(</span><span class="default">$rotate</span><span class="keyword">, </span><span class="default">$dest_x </span><span class="keyword">- </span><span class="default">$x </span><span class="keyword">- </span><span class="default">1</span><span class="keyword">, </span><span class="default">$dest_y </span><span class="keyword">- </span><span class="default">$y </span><span class="keyword">- </span><span class="default">1</span><span class="keyword">, </span><span class="default">$color</span><span class="keyword">); }}<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; break;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; default: </span><span class="default">$rotate </span><span class="keyword">= </span><span class="default">$src_img</span><span class="keyword">; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">$rotate</span><span class="keyword">; }}<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="77033""></a>
  <div class="note">
   <strong class="user">qrgames at NOSPAMTYrushyo dot com</strong>
   <a href="#77033" class="date">12-Aug-2007 01:06</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
imagerotate seems to be very fussy about handling transparency when copymerging onto another image. You can use the GD library's other transparency features to cover up the fact imagerotate gets it wrong HOWEVER it will only work if the top-left corner of the image is transparent at all rotations, so make the image a little bigger than it needs to be. This has been tested with png32 but does not work entirely for png8, as a phenomena creates noise around the rotated image.<br />
<br />
<span class="default">&lt;?php<br />
<br />
$imgImage </span><span class="keyword">= </span><span class="default">imagecreatefrompng</span><span class="keyword">(</span><span class="string">"image.png"</span><span class="keyword">);<br />
</span><span class="default">$colBlack </span><span class="keyword">= </span><span class="default">imagecolorallocate</span><span class="keyword">(</span><span class="default">$imgImage</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">);<br />
</span><span class="default">$imgImage </span><span class="keyword">= </span><span class="default">imagerotate</span><span class="keyword">(</span><span class="default">$imgImage</span><span class="keyword">, </span><span class="default">360 </span><span class="keyword">- </span><span class="default">$intHeading</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">);<br />
</span><span class="default">imagefill</span><span class="keyword">(</span><span class="default">$imgImage</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">$colBlack</span><span class="keyword">);<br />
</span><span class="default">imagecolortransparent</span><span class="keyword">(</span><span class="default">$imgImage</span><span class="keyword">, </span><span class="default">$colBlack</span><span class="keyword">);<br />
</span><span class="default">imagecopymerge</span><span class="keyword">(</span><span class="default">$imgOriginalImage </span><span class="keyword">, </span><span class="default">$imgImage</span><span class="keyword">, </span><span class="default">$intX</span><span class="keyword">, </span><span class="default">$intY</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">$intHeight</span><span class="keyword">, </span><span class="default">$intWidth</span><span class="keyword">, </span><span class="default">100</span><span class="keyword">);<br />
</span><span class="default">imagedestroy</span><span class="keyword">(</span><span class="default">$imgImage</span><span class="keyword">);<br />
<br />
</span><span class="default">?&gt;<br />
</span><br />
Note. $intHeading is in degrees clockwise :)</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="73446""></a>
  <div class="note">
   <strong class="user">Thomaschaaf</strong>
   <a href="#73446" class="date">23-Feb-2007 04:21</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
<span class="default">&lt;?php
<br />
</span><span class="keyword">function </span><span class="default">rotate</span><span class="keyword">(</span><span class="default">$degrees</span><span class="keyword">)
<br />
&nbsp;&nbsp;&nbsp; {
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if(</span><span class="default">function_exists</span><span class="keyword">(</span><span class="string">"imagerotate"</span><span class="keyword">))
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">image </span><span class="keyword">= </span><span class="default">imagerotate</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">image</span><span class="keyword">, </span><span class="default">$degrees</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; else
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; {
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; function </span><span class="default">imagerotate</span><span class="keyword">(</span><span class="default">$src_img</span><span class="keyword">, </span><span class="default">$angle</span><span class="keyword">) 
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; {
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$src_x </span><span class="keyword">= </span><span class="default">imagesx</span><span class="keyword">(</span><span class="default">$src_img</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$src_y </span><span class="keyword">= </span><span class="default">imagesy</span><span class="keyword">(</span><span class="default">$src_img</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">$angle </span><span class="keyword">== </span><span class="default">180</span><span class="keyword">)
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; {
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$dest_x </span><span class="keyword">= </span><span class="default">$src_x</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$dest_y </span><span class="keyword">= </span><span class="default">$src_y</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; } 
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; elseif (</span><span class="default">$src_x </span><span class="keyword">&lt;= </span><span class="default">$src_y</span><span class="keyword">) 
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; {
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$dest_x </span><span class="keyword">= </span><span class="default">$src_y</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$dest_y </span><span class="keyword">= </span><span class="default">$src_x</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; } 
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; elseif (</span><span class="default">$src_x </span><span class="keyword">&gt;= </span><span class="default">$src_y</span><span class="keyword">)&nbsp; 
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; {
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$dest_x </span><span class="keyword">= </span><span class="default">$src_y</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$dest_y </span><span class="keyword">= </span><span class="default">$src_x</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; 
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$rotate</span><span class="keyword">=</span><span class="default">imagecreatetruecolor</span><span class="keyword">(</span><span class="default">$dest_x</span><span class="keyword">,</span><span class="default">$dest_y</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">imagealphablending</span><span class="keyword">(</span><span class="default">$rotate</span><span class="keyword">, </span><span class="default">false</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; 
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; switch (</span><span class="default">$angle</span><span class="keyword">) 
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; {
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; case </span><span class="default">270</span><span class="keyword">:
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; for (</span><span class="default">$y </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">; </span><span class="default">$y </span><span class="keyword">&lt; (</span><span class="default">$src_y</span><span class="keyword">); </span><span class="default">$y</span><span class="keyword">++) 
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; {
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; for (</span><span class="default">$x </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">; </span><span class="default">$x </span><span class="keyword">&lt; (</span><span class="default">$src_x</span><span class="keyword">); </span><span class="default">$x</span><span class="keyword">++) 
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; {
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$color </span><span class="keyword">= </span><span class="default">imagecolorat</span><span class="keyword">(</span><span class="default">$src_img</span><span class="keyword">, </span><span class="default">$x</span><span class="keyword">, </span><span class="default">$y</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">imagesetpixel</span><span class="keyword">(</span><span class="default">$rotate</span><span class="keyword">, </span><span class="default">$dest_x </span><span class="keyword">- </span><span class="default">$y </span><span class="keyword">- </span><span class="default">1</span><span class="keyword">, </span><span class="default">$x</span><span class="keyword">, </span><span class="default">$color</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; break;
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; case </span><span class="default">90</span><span class="keyword">:
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; for (</span><span class="default">$y </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">; </span><span class="default">$y </span><span class="keyword">&lt; (</span><span class="default">$src_y</span><span class="keyword">); </span><span class="default">$y</span><span class="keyword">++) 
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; {
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; for (</span><span class="default">$x </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">; </span><span class="default">$x </span><span class="keyword">&lt; (</span><span class="default">$src_x</span><span class="keyword">); </span><span class="default">$x</span><span class="keyword">++) 
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; {
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$color </span><span class="keyword">= </span><span class="default">imagecolorat</span><span class="keyword">(</span><span class="default">$src_img</span><span class="keyword">, </span><span class="default">$x</span><span class="keyword">, </span><span class="default">$y</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">imagesetpixel</span><span class="keyword">(</span><span class="default">$rotate</span><span class="keyword">, </span><span class="default">$y</span><span class="keyword">, </span><span class="default">$dest_y </span><span class="keyword">- </span><span class="default">$x </span><span class="keyword">- </span><span class="default">1</span><span class="keyword">, </span><span class="default">$color</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; break;
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; case </span><span class="default">180</span><span class="keyword">:
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; for (</span><span class="default">$y </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">; </span><span class="default">$y </span><span class="keyword">&lt; (</span><span class="default">$src_y</span><span class="keyword">); </span><span class="default">$y</span><span class="keyword">++) 
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; {
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; for (</span><span class="default">$x </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">; </span><span class="default">$x </span><span class="keyword">&lt; (</span><span class="default">$src_x</span><span class="keyword">); </span><span class="default">$x</span><span class="keyword">++) 
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; {
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$color </span><span class="keyword">= </span><span class="default">imagecolorat</span><span class="keyword">(</span><span class="default">$src_img</span><span class="keyword">, </span><span class="default">$x</span><span class="keyword">, </span><span class="default">$y</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">imagesetpixel</span><span class="keyword">(</span><span class="default">$rotate</span><span class="keyword">, </span><span class="default">$dest_x </span><span class="keyword">- </span><span class="default">$x </span><span class="keyword">- </span><span class="default">1</span><span class="keyword">, </span><span class="default">$dest_y </span><span class="keyword">- </span><span class="default">$y </span><span class="keyword">- </span><span class="default">1</span><span class="keyword">, </span><span class="default">$color</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; break;
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; default: </span><span class="default">$rotate </span><span class="keyword">= </span><span class="default">$src_img</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; };
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">$rotate</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">image </span><span class="keyword">= </span><span class="default">imagerotate</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">image</span><span class="keyword">, </span><span class="default">$degrees</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }
<br />
&nbsp;&nbsp;&nbsp; }
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="69668""></a>
  <div class="note">
   <strong class="user">m dot quinton at gmail dot com</strong>
   <a href="#69668" class="date">14-Sep-2006 06:30</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
with large file, where imagerotate is missing, you can use, when possible "convert" command from ImageMagick. Here is a sample script.<br />
<br />
<span class="default">&lt;?php<br />
<br />
error_reporting</span><span class="keyword">(</span><span class="default">E_ALL</span><span class="keyword">);<br />
<br />
</span><span class="default">header</span><span class="keyword">(</span><span class="string">"Content-type: image/png"</span><span class="keyword">);<br />
<br />
</span><span class="default">$file </span><span class="keyword">= </span><span class="string">'images/test/imgp2498.jpg'</span><span class="keyword">;<br />
<br />
</span><span class="default">image_rotate_with_convert</span><span class="keyword">(</span><span class="default">$file</span><span class="keyword">, </span><span class="default">90</span><span class="keyword">);<br />
<br />
function </span><span class="default">image_rotate_with_convert</span><span class="keyword">(</span><span class="default">$file</span><span class="keyword">, </span><span class="default">$angle</span><span class="keyword">){<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">passthru</span><span class="keyword">(</span><span class="string">"convert -rotate </span><span class="default">$angle</span><span class="string"> </span><span class="default">$file</span><span class="string"> -"</span><span class="keyword">);<br />
}<br />
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="57226""></a>
  <div class="note">
   <strong class="user">simon_nuttall at hotmail dot com</strong>
   <a href="#57226" class="date">27-Sep-2005 07:06</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
The following is potentially useful. It extracts the central largest circle of an image into a square of specified size, and optionally rotates it. The rest of the square is made transparent, so useful for drawing over other images. I've named it after binocular effect because on some old TV shows whenever they show someone looking through binoculars the screen shows a big circular image with black edges.<br />
<br />
<span class="default">&lt;?php<br />
<br />
</span><span class="keyword">function </span><span class="default">image_binocular_effect</span><span class="keyword">(</span><span class="default">$src</span><span class="keyword">, </span><span class="default">$bearing</span><span class="keyword">, </span><span class="default">$out_square</span><span class="keyword">) {<br />
&nbsp;</span><span class="comment">// the source image is resampled to fit within the specified square, and rotated clockwise by bearing.<br />
&nbsp;// the largest circle within the image is retained, the rest made transparent.<br />
&nbsp;</span><span class="default">$out </span><span class="keyword">= </span><span class="default">imagecreatetruecolor</span><span class="keyword">(</span><span class="default">$out_square</span><span class="keyword">, </span><span class="default">$out_square</span><span class="keyword">);<br />
&nbsp;</span><span class="default">$width</span><span class="keyword">=</span><span class="default">imagesx</span><span class="keyword">(</span><span class="default">$src</span><span class="keyword">);<br />
&nbsp;</span><span class="default">$height</span><span class="keyword">=</span><span class="default">imagesy</span><span class="keyword">(</span><span class="default">$src</span><span class="keyword">);<br />
&nbsp;</span><span class="default">$square</span><span class="keyword">=</span><span class="default">min</span><span class="keyword">(</span><span class="default">$width</span><span class="keyword">, </span><span class="default">$height</span><span class="keyword">);<br />
&nbsp;</span><span class="default">imagecopyresampled</span><span class="keyword">(</span><span class="default">$out</span><span class="keyword">, </span><span class="default">$src</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, (</span><span class="default">$width </span><span class="keyword">- </span><span class="default">$square</span><span class="keyword">)/</span><span class="default">2 </span><span class="keyword">, (</span><span class="default">$height </span><span class="keyword">- </span><span class="default">$square</span><span class="keyword">)/</span><span class="default">2</span><span class="keyword">, </span><span class="default">$out_square</span><span class="keyword">, </span><span class="default">$out_square</span><span class="keyword">, </span><span class="default">$square</span><span class="keyword">, </span><span class="default">$square</span><span class="keyword">);<br />
<br />
&nbsp;</span><span class="default">$mask </span><span class="keyword">= </span><span class="default">imagecreatetruecolor</span><span class="keyword">(</span><span class="default">$out_square</span><span class="keyword">, </span><span class="default">$out_square</span><span class="keyword">);<br />
&nbsp;</span><span class="default">$black </span><span class="keyword">= </span><span class="default">ImageColorAllocate </span><span class="keyword">(</span><span class="default">$mask</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">);<br />
&nbsp;</span><span class="default">$white </span><span class="keyword">= </span><span class="default">ImageColorAllocate </span><span class="keyword">(</span><span class="default">$mask</span><span class="keyword">, </span><span class="default">255</span><span class="keyword">, </span><span class="default">255</span><span class="keyword">, </span><span class="default">255</span><span class="keyword">);<br />
&nbsp;</span><span class="default">imagefilledrectangle</span><span class="keyword">(</span><span class="default">$mask </span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">$out_square</span><span class="keyword">, </span><span class="default">$out_square</span><span class="keyword">, </span><span class="default">$white</span><span class="keyword">);<br />
&nbsp;</span><span class="default">$centrexy</span><span class="keyword">=</span><span class="default">$out_square </span><span class="keyword">/ </span><span class="default">2</span><span class="keyword">;<br />
&nbsp;</span><span class="default">imagefilledellipse</span><span class="keyword">(</span><span class="default">$mask</span><span class="keyword">, </span><span class="default">$centrexy</span><span class="keyword">, </span><span class="default">$centrexy</span><span class="keyword">, </span><span class="default">$out_square</span><span class="keyword">, </span><span class="default">$out_square</span><span class="keyword">, </span><span class="default">$black</span><span class="keyword">);<br />
&nbsp;</span><span class="default">ImageColorTransparent</span><span class="keyword">(</span><span class="default">$mask</span><span class="keyword">, </span><span class="default">$black</span><span class="keyword">);<br />
&nbsp;</span><span class="default">imagecopymerge</span><span class="keyword">(</span><span class="default">$out</span><span class="keyword">, </span><span class="default">$mask</span><span class="keyword">,&nbsp; </span><span class="default">0</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">$out_square</span><span class="keyword">, </span><span class="default">$out_square</span><span class="keyword">, </span><span class="default">100</span><span class="keyword">);<br />
&nbsp;if (</span><span class="default">$bearing </span><span class="keyword">!= </span><span class="default">0</span><span class="keyword">) {<br />
&nbsp; </span><span class="default">$rotated_img</span><span class="keyword">=</span><span class="default">imagerotate</span><span class="keyword">(</span><span class="default">$out </span><span class="keyword">, </span><span class="default">360</span><span class="keyword">-</span><span class="default">$bearing</span><span class="keyword">, </span><span class="default">$white</span><span class="keyword">);<br />
&nbsp; </span><span class="comment">// take off only the rotated width<br />
&nbsp; </span><span class="default">$rotated_map_width </span><span class="keyword">= </span><span class="default">imagesx</span><span class="keyword">(</span><span class="default">$rotated_img</span><span class="keyword">);<br />
&nbsp; </span><span class="default">$rotated_map_height </span><span class="keyword">= </span><span class="default">imagesy</span><span class="keyword">(</span><span class="default">$rotated_img</span><span class="keyword">);<br />
&nbsp; </span><span class="default">imagecopy</span><span class="keyword">(</span><span class="default">$out</span><span class="keyword">, </span><span class="default">$rotated_img</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, (</span><span class="default">$rotated_map_width </span><span class="keyword">- </span><span class="default">$out_square</span><span class="keyword">) / </span><span class="default">2</span><span class="keyword">, (</span><span class="default">$rotated_map_height </span><span class="keyword">- </span><span class="default">$out_square</span><span class="keyword">) / </span><span class="default">2</span><span class="keyword">, </span><span class="default">$out_square</span><span class="keyword">, </span><span class="default">$out_square</span><span class="keyword">);<br />
&nbsp; }<br />
&nbsp;</span><span class="default">ImageColorTransparent</span><span class="keyword">(</span><span class="default">$out</span><span class="keyword">, </span><span class="default">$white</span><span class="keyword">);<br />
&nbsp;return </span><span class="default">$out</span><span class="keyword">;<br />
}<br />
<br />
</span><span class="comment">// Create a sample image to demonstrate the effect, but looks much better on real photos.<br />
<br />
</span><span class="default">$src </span><span class="keyword">= </span><span class="default">imagecreatetruecolor</span><span class="keyword">(</span><span class="default">200</span><span class="keyword">, </span><span class="default">50</span><span class="keyword">);<br />
</span><span class="default">imagefilledrectangle</span><span class="keyword">(</span><span class="default">$src</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">200</span><span class="keyword">, </span><span class="default">50</span><span class="keyword">, </span><span class="default">imagecolorallocate</span><span class="keyword">(</span><span class="default">$src</span><span class="keyword">, </span><span class="default">255</span><span class="keyword">, </span><span class="default">255</span><span class="keyword">, </span><span class="default">255</span><span class="keyword">));<br />
</span><span class="default">ImageString</span><span class="keyword">(</span><span class="default">$src</span><span class="keyword">, </span><span class="default">3</span><span class="keyword">, </span><span class="default">10</span><span class="keyword">, </span><span class="default">10</span><span class="keyword">, </span><span class="string">"This is a sample image to illustrate the binocular effect"</span><span class="keyword">, </span><span class="default">imagecolorallocate</span><span class="keyword">(</span><span class="default">$im</span><span class="keyword">, </span><span class="default">192</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">));<br />
</span><span class="default">$img</span><span class="keyword">=</span><span class="default">image_binocular_effect</span><span class="keyword">(</span><span class="default">$src</span><span class="keyword">, </span><span class="default">72</span><span class="keyword">, </span><span class="default">50</span><span class="keyword">);<br />
</span><span class="default">ImagePNG</span><span class="keyword">(</span><span class="default">$img</span><span class="keyword">,</span><span class="string">"test.png"</span><span class="keyword">);<br />
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="50487""></a>
  <div class="note">
   <strong class="user">wulff at fyens dot dk</strong>
   <a href="#50487" class="date">01-Mar-2005 10:22</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I liked the rotateImageBicubic function implemented by darren at lucidtone dot com. But it just snipped off the parts of the image that were outside the original image.<br />
<br />
I fixed this, even though I admit that my solution is a bit naive. But it might come in handy for somebody.<br />
<br />
Also his bicubic implementation was broken on my machine so I left it out, if you need it just copy and paste it from above.<br />
<br />
<span class="default">&lt;?php<br />
<br />
</span><span class="comment">// $src_img - a GD image resource<br />
// $angle - degrees to rotate clockwise, in degrees<br />
// returns a GD image resource<br />
// USAGE:<br />
// $im = imagecreatefrompng('test.png');<br />
// $im = imagerotate($im, 15);<br />
// header('Content-type: image/png');<br />
// imagepng($im);<br />
</span><span class="keyword">function </span><span class="default">imageRotate</span><span class="keyword">(</span><span class="default">$src_img</span><span class="keyword">, </span><span class="default">$angle</span><span class="keyword">, </span><span class="default">$bicubic</span><span class="keyword">=</span><span class="default">false</span><span class="keyword">) {<br />
&nbsp; <br />
&nbsp;&nbsp; </span><span class="comment">// convert degrees to radians<br />
&nbsp;&nbsp; </span><span class="default">$angle </span><span class="keyword">= </span><span class="default">$angle </span><span class="keyword">+ </span><span class="default">180</span><span class="keyword">;<br />
&nbsp;&nbsp; </span><span class="default">$angle </span><span class="keyword">= </span><span class="default">deg2rad</span><span class="keyword">(</span><span class="default">$angle</span><span class="keyword">);<br />
&nbsp; <br />
&nbsp;&nbsp; </span><span class="default">$src_x </span><span class="keyword">= </span><span class="default">imagesx</span><span class="keyword">(</span><span class="default">$src_img</span><span class="keyword">);<br />
&nbsp;&nbsp; </span><span class="default">$src_y </span><span class="keyword">= </span><span class="default">imagesy</span><span class="keyword">(</span><span class="default">$src_img</span><span class="keyword">);<br />
&nbsp; <br />
&nbsp;&nbsp; </span><span class="default">$center_x </span><span class="keyword">= </span><span class="default">floor</span><span class="keyword">(</span><span class="default">$src_x</span><span class="keyword">/</span><span class="default">2</span><span class="keyword">);<br />
&nbsp;&nbsp; </span><span class="default">$center_y </span><span class="keyword">= </span><span class="default">floor</span><span class="keyword">(</span><span class="default">$src_y</span><span class="keyword">/</span><span class="default">2</span><span class="keyword">);<br />
<br />
&nbsp;&nbsp; </span><span class="default">$cosangle </span><span class="keyword">= </span><span class="default">cos</span><span class="keyword">(</span><span class="default">$angle</span><span class="keyword">);<br />
&nbsp;&nbsp; </span><span class="default">$sinangle </span><span class="keyword">= </span><span class="default">sin</span><span class="keyword">(</span><span class="default">$angle</span><span class="keyword">);<br />
<br />
&nbsp;&nbsp; </span><span class="default">$corners</span><span class="keyword">=array(array(</span><span class="default">0</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">), array(</span><span class="default">$src_x</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">), array(</span><span class="default">$src_x</span><span class="keyword">,</span><span class="default">$src_y</span><span class="keyword">), array(</span><span class="default">0</span><span class="keyword">,</span><span class="default">$src_y</span><span class="keyword">));<br />
<br />
&nbsp;&nbsp; foreach(</span><span class="default">$corners </span><span class="keyword">as </span><span class="default">$key</span><span class="keyword">=&gt;</span><span class="default">$value</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; </span><span class="default">$value</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">]-=</span><span class="default">$center_x</span><span class="keyword">;&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="comment">//Translate coords to center for rotation<br />
&nbsp;&nbsp; &nbsp; </span><span class="default">$value</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">]-=</span><span class="default">$center_y</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; </span><span class="default">$temp</span><span class="keyword">=array();<br />
&nbsp;&nbsp; &nbsp; </span><span class="default">$temp</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">]=</span><span class="default">$value</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">]*</span><span class="default">$cosangle</span><span class="keyword">+</span><span class="default">$value</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">]*</span><span class="default">$sinangle</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; </span><span class="default">$temp</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">]=</span><span class="default">$value</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">]*</span><span class="default">$cosangle</span><span class="keyword">-</span><span class="default">$value</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">]*</span><span class="default">$sinangle</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; </span><span class="default">$corners</span><span class="keyword">[</span><span class="default">$key</span><span class="keyword">]=</span><span class="default">$temp</span><span class="keyword">;&nbsp; &nbsp; <br />
&nbsp;&nbsp; }<br />
&nbsp;&nbsp; <br />
&nbsp;&nbsp; </span><span class="default">$min_x</span><span class="keyword">=</span><span class="default">1000000000000000</span><span class="keyword">;<br />
&nbsp;&nbsp; </span><span class="default">$max_x</span><span class="keyword">=-</span><span class="default">1000000000000000</span><span class="keyword">;<br />
&nbsp;&nbsp; </span><span class="default">$min_y</span><span class="keyword">=</span><span class="default">1000000000000000</span><span class="keyword">;<br />
&nbsp;&nbsp; </span><span class="default">$max_y</span><span class="keyword">=-</span><span class="default">1000000000000000</span><span class="keyword">;<br />
&nbsp;&nbsp; <br />
&nbsp;&nbsp; foreach(</span><span class="default">$corners </span><span class="keyword">as </span><span class="default">$key </span><span class="keyword">=&gt; </span><span class="default">$value</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; if(</span><span class="default">$value</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">]&lt;</span><span class="default">$min_x</span><span class="keyword">)<br />
&nbsp;&nbsp; &nbsp; &nbsp; </span><span class="default">$min_x</span><span class="keyword">=</span><span class="default">$value</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">];<br />
&nbsp;&nbsp; &nbsp; if(</span><span class="default">$value</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">]&gt;</span><span class="default">$max_x</span><span class="keyword">)<br />
&nbsp;&nbsp; &nbsp; &nbsp; </span><span class="default">$max_x</span><span class="keyword">=</span><span class="default">$value</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">];<br />
&nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; if(</span><span class="default">$value</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">]&lt;</span><span class="default">$min_y</span><span class="keyword">)<br />
&nbsp;&nbsp; &nbsp; &nbsp; </span><span class="default">$min_y</span><span class="keyword">=</span><span class="default">$value</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">];<br />
&nbsp;&nbsp; &nbsp; if(</span><span class="default">$value</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">]&gt;</span><span class="default">$max_y</span><span class="keyword">)<br />
&nbsp;&nbsp; &nbsp; &nbsp; </span><span class="default">$max_y</span><span class="keyword">=</span><span class="default">$value</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">];<br />
&nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp; </span><span class="default">$rotate_width</span><span class="keyword">=</span><span class="default">round</span><span class="keyword">(</span><span class="default">$max_x</span><span class="keyword">-</span><span class="default">$min_x</span><span class="keyword">);<br />
&nbsp;&nbsp; </span><span class="default">$rotate_height</span><span class="keyword">=</span><span class="default">round</span><span class="keyword">(</span><span class="default">$max_y</span><span class="keyword">-</span><span class="default">$min_y</span><span class="keyword">);<br />
<br />
&nbsp;&nbsp; </span><span class="default">$rotate</span><span class="keyword">=</span><span class="default">imagecreatetruecolor</span><span class="keyword">(</span><span class="default">$rotate_width</span><span class="keyword">,</span><span class="default">$rotate_height</span><span class="keyword">);<br />
&nbsp;&nbsp; </span><span class="default">imagealphablending</span><span class="keyword">(</span><span class="default">$rotate</span><span class="keyword">, </span><span class="default">false</span><span class="keyword">);<br />
&nbsp;&nbsp; </span><span class="default">imagesavealpha</span><span class="keyword">(</span><span class="default">$rotate</span><span class="keyword">, </span><span class="default">true</span><span class="keyword">);<br />
<br />
&nbsp;&nbsp; </span><span class="comment">//Reset center to center of our image<br />
&nbsp;&nbsp; </span><span class="default">$newcenter_x </span><span class="keyword">= (</span><span class="default">$rotate_width</span><span class="keyword">)/</span><span class="default">2</span><span class="keyword">;<br />
&nbsp;&nbsp; </span><span class="default">$newcenter_y </span><span class="keyword">= (</span><span class="default">$rotate_height</span><span class="keyword">)/</span><span class="default">2</span><span class="keyword">;<br />
<br />
&nbsp;&nbsp; for (</span><span class="default">$y </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">; </span><span class="default">$y </span><span class="keyword">&lt; (</span><span class="default">$rotate_height</span><span class="keyword">); </span><span class="default">$y</span><span class="keyword">++) {<br />
&nbsp;&nbsp; &nbsp; for (</span><span class="default">$x </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">; </span><span class="default">$x </span><span class="keyword">&lt; (</span><span class="default">$rotate_width</span><span class="keyword">); </span><span class="default">$x</span><span class="keyword">++) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; </span><span class="comment">// rotate...<br />
&nbsp;&nbsp; &nbsp; &nbsp; </span><span class="default">$old_x </span><span class="keyword">= </span><span class="default">round</span><span class="keyword">(((</span><span class="default">$newcenter_x</span><span class="keyword">-</span><span class="default">$x</span><span class="keyword">) * </span><span class="default">$cosangle </span><span class="keyword">+ (</span><span class="default">$newcenter_y</span><span class="keyword">-</span><span class="default">$y</span><span class="keyword">) * </span><span class="default">$sinangle</span><span class="keyword">))<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; + </span><span class="default">$center_x</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; </span><span class="default">$old_y </span><span class="keyword">= </span><span class="default">round</span><span class="keyword">(((</span><span class="default">$newcenter_y</span><span class="keyword">-</span><span class="default">$y</span><span class="keyword">) * </span><span class="default">$cosangle </span><span class="keyword">- (</span><span class="default">$newcenter_x</span><span class="keyword">-</span><span class="default">$x</span><span class="keyword">) * </span><span class="default">$sinangle</span><span class="keyword">))<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; + </span><span class="default">$center_y</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; if ( </span><span class="default">$old_x </span><span class="keyword">&gt;= </span><span class="default">0 </span><span class="keyword">&amp;&amp; </span><span class="default">$old_x </span><span class="keyword">&lt; </span><span class="default">$src_x<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="keyword">&amp;&amp; </span><span class="default">$old_y </span><span class="keyword">&gt;= </span><span class="default">0 </span><span class="keyword">&amp;&amp; </span><span class="default">$old_y </span><span class="keyword">&lt; </span><span class="default">$src_y </span><span class="keyword">) {<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$color </span><span class="keyword">= </span><span class="default">imagecolorat</span><span class="keyword">(</span><span class="default">$src_img</span><span class="keyword">, </span><span class="default">$old_x</span><span class="keyword">, </span><span class="default">$old_y</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; } else {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="comment">// this line sets the background colour<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$color </span><span class="keyword">= </span><span class="default">imagecolorallocatealpha</span><span class="keyword">(</span><span class="default">$src_img</span><span class="keyword">, </span><span class="default">255</span><span class="keyword">, </span><span class="default">255</span><span class="keyword">, </span><span class="default">255</span><span class="keyword">, </span><span class="default">127</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; </span><span class="default">imagesetpixel</span><span class="keyword">(</span><span class="default">$rotate</span><span class="keyword">, </span><span class="default">$x</span><span class="keyword">, </span><span class="default">$y</span><span class="keyword">, </span><span class="default">$color</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; }<br />
&nbsp;&nbsp; }<br />
&nbsp;&nbsp; <br />
&nbsp; return(</span><span class="default">$rotate</span><span class="keyword">);<br />
}<br />
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="48725""></a>
  <div class="note">
   <strong class="user">Borszczuk</strong>
   <a href="#48725" class="date">05-Jan-2005 02:21</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Here's a function that implements right angle (multiplicity of 90 degs - 90, 180, 270) rotation if you need one but lacks native imagerotate() or you don't want non-square images to be scaled down as with imagerotate(). As you probably noticed it's not self contained function, as 180 rotation is handled by ImageFlip() function to gain the performance. The ImageFlip() function used is published here: <a href="http://php.net/imagecopy in the comment of mine placed on&nbsp; 05-Jan-2005 04:30" rel="nofollow" target="_blank">http://php.net/imagecopy in the comment of mine placed on&nbsp; 05-Jan-2005 04:30</a>
<br />

<br />
Please note: that in case of 0 degrees rotation handle to imgSrc is returned which may lead to problems if you imagedestroy() it undonditionaly. To solve that you shall add imagecopy($imgDest, $imgSrc, 0,0, 0,0,$srcX, $srcY)&nbsp; in proper place which I have intentionally ommited to save memory resources
<br />

<br />
<span class="default">&lt;?php
<br />

<br />
</span><span class="comment">// $imgSrc - GD image handle of source image
<br />
// $angle - angle of rotation. Needs to be positive integer
<br />
// angle shall be 0,90,180,270, but if you give other it
<br />
// will be rouned to nearest right angle (i.e. 52-&gt;90 degs,
<br />
// 96-&gt;90 degs)
<br />
// returns GD image handle of rotated image.
<br />
</span><span class="keyword">function </span><span class="default">ImageRotateRightAngle</span><span class="keyword">( </span><span class="default">$imgSrc</span><span class="keyword">, </span><span class="default">$angle </span><span class="keyword">)
<br />
{
<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">// ensuring we got really RightAngle (if not we choose the closest one)
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$angle </span><span class="keyword">= </span><span class="default">min</span><span class="keyword">( ( (int)((</span><span class="default">$angle</span><span class="keyword">+</span><span class="default">45</span><span class="keyword">) / </span><span class="default">90</span><span class="keyword">) * </span><span class="default">90</span><span class="keyword">), </span><span class="default">270 </span><span class="keyword">);
<br />

<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">// no need to fight
<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">if( </span><span class="default">$angle </span><span class="keyword">== </span><span class="default">0 </span><span class="keyword">)
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return( </span><span class="default">$imgSrc </span><span class="keyword">);
<br />

<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">// dimenstion of source image
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$srcX </span><span class="keyword">= </span><span class="default">imagesx</span><span class="keyword">( </span><span class="default">$imgSrc </span><span class="keyword">);
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$srcY </span><span class="keyword">= </span><span class="default">imagesy</span><span class="keyword">( </span><span class="default">$imgSrc </span><span class="keyword">);
<br />

<br />
&nbsp;&nbsp;&nbsp; switch( </span><span class="default">$angle </span><span class="keyword">)
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; {
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; case </span><span class="default">90</span><span class="keyword">:
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$imgDest </span><span class="keyword">= </span><span class="default">imagecreatetruecolor</span><span class="keyword">( </span><span class="default">$srcY</span><span class="keyword">, </span><span class="default">$srcX </span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; for( </span><span class="default">$x</span><span class="keyword">=</span><span class="default">0</span><span class="keyword">; </span><span class="default">$x</span><span class="keyword">&lt;</span><span class="default">$srcX</span><span class="keyword">; </span><span class="default">$x</span><span class="keyword">++ )
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; for( </span><span class="default">$y</span><span class="keyword">=</span><span class="default">0</span><span class="keyword">; </span><span class="default">$y</span><span class="keyword">&lt;</span><span class="default">$srcY</span><span class="keyword">; </span><span class="default">$y</span><span class="keyword">++ )
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">imagecopy</span><span class="keyword">(</span><span class="default">$imgDest</span><span class="keyword">, </span><span class="default">$imgSrc</span><span class="keyword">, </span><span class="default">$srcY</span><span class="keyword">-</span><span class="default">$y</span><span class="keyword">-</span><span class="default">1</span><span class="keyword">, </span><span class="default">$x</span><span class="keyword">, </span><span class="default">$x</span><span class="keyword">, </span><span class="default">$y</span><span class="keyword">, </span><span class="default">1</span><span class="keyword">, </span><span class="default">1</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; break;
<br />

<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; case </span><span class="default">180</span><span class="keyword">:
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$imgDest </span><span class="keyword">= </span><span class="default">ImageFlip</span><span class="keyword">( </span><span class="default">$imgSrc</span><span class="keyword">, </span><span class="default">IMAGE_FLIP_BOTH </span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; break;
<br />

<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; case </span><span class="default">270</span><span class="keyword">:
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$imgDest </span><span class="keyword">= </span><span class="default">imagecreatetruecolor</span><span class="keyword">( </span><span class="default">$srcY</span><span class="keyword">, </span><span class="default">$srcX </span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; for( </span><span class="default">$x</span><span class="keyword">=</span><span class="default">0</span><span class="keyword">; </span><span class="default">$x</span><span class="keyword">&lt;</span><span class="default">$srcX</span><span class="keyword">; </span><span class="default">$x</span><span class="keyword">++ )
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; for( </span><span class="default">$y</span><span class="keyword">=</span><span class="default">0</span><span class="keyword">; </span><span class="default">$y</span><span class="keyword">&lt;</span><span class="default">$srcY</span><span class="keyword">; </span><span class="default">$y</span><span class="keyword">++ )
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">imagecopy</span><span class="keyword">(</span><span class="default">$imgDest</span><span class="keyword">, </span><span class="default">$imgSrc</span><span class="keyword">, </span><span class="default">$y</span><span class="keyword">, </span><span class="default">$srcX</span><span class="keyword">-</span><span class="default">$x</span><span class="keyword">-</span><span class="default">1</span><span class="keyword">, </span><span class="default">$x</span><span class="keyword">, </span><span class="default">$y</span><span class="keyword">, </span><span class="default">1</span><span class="keyword">, </span><span class="default">1</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; break;
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }
<br />

<br />
&nbsp;&nbsp;&nbsp; return( </span><span class="default">$imgDest </span><span class="keyword">);
<br />
}
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="47985""></a>
  <div class="note">
   <strong class="user">darren at lucidtone dot com</strong>
   <a href="#47985" class="date">08-Dec-2004 05:43</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Here's a neat function for those of us who don't have imagerotate() on our servers.&nbsp; It's based on a comment from ron at korving dot demon dot nl on the manual page for imagecopyresampled.
<br />

<br />
I'm still not 100% on coping with transparency, but this function seems to cope okay.&nbsp; It doesn't resize to fit within bounds, it just rotates and you lose anything outside the image box.&nbsp; 
<br />

<br />
The bicubic mode is slooow.
<br />

<br />
If you want to be able to change the background colour, pass in a colour and use it where indicated.&nbsp; The line I used just sets it transparent.
<br />

<br />
<span class="default">&lt;?php
<br />
</span><span class="comment">// $src_img - a GD image resource
<br />
// $angle - degrees to rotate clockwise, in degrees
<br />
// returns a GD image resource
<br />
// USAGE:
<br />
// $im = imagecreatefrompng('test.png');
<br />
// $im = imagerotate($im, 15);
<br />
// header('Content-type: image/png');
<br />
// imagepng($im);
<br />
</span><span class="keyword">function </span><span class="default">imageRotateBicubic</span><span class="keyword">(</span><span class="default">$src_img</span><span class="keyword">, </span><span class="default">$angle</span><span class="keyword">, </span><span class="default">$bicubic</span><span class="keyword">=</span><span class="default">false</span><span class="keyword">) {
<br />
&nbsp;&nbsp;&nbsp; 
<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">// convert degrees to radians
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$angle </span><span class="keyword">= </span><span class="default">$angle </span><span class="keyword">+ </span><span class="default">180</span><span class="keyword">;
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$angle </span><span class="keyword">= </span><span class="default">deg2rad</span><span class="keyword">(</span><span class="default">$angle</span><span class="keyword">);
<br />
&nbsp;&nbsp;&nbsp; 
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$src_x </span><span class="keyword">= </span><span class="default">imagesx</span><span class="keyword">(</span><span class="default">$src_img</span><span class="keyword">);
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$src_y </span><span class="keyword">= </span><span class="default">imagesy</span><span class="keyword">(</span><span class="default">$src_img</span><span class="keyword">);
<br />
&nbsp;&nbsp;&nbsp; 
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$center_x </span><span class="keyword">= </span><span class="default">floor</span><span class="keyword">(</span><span class="default">$src_x</span><span class="keyword">/</span><span class="default">2</span><span class="keyword">);
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$center_y </span><span class="keyword">= </span><span class="default">floor</span><span class="keyword">(</span><span class="default">$src_y</span><span class="keyword">/</span><span class="default">2</span><span class="keyword">);
<br />
&nbsp;&nbsp;&nbsp; 
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$rotate </span><span class="keyword">= </span><span class="default">imagecreatetruecolor</span><span class="keyword">(</span><span class="default">$src_x</span><span class="keyword">, </span><span class="default">$src_y</span><span class="keyword">);
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">imagealphablending</span><span class="keyword">(</span><span class="default">$rotate</span><span class="keyword">, </span><span class="default">false</span><span class="keyword">);
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">imagesavealpha</span><span class="keyword">(</span><span class="default">$rotate</span><span class="keyword">, </span><span class="default">true</span><span class="keyword">);
<br />

<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$cosangle </span><span class="keyword">= </span><span class="default">cos</span><span class="keyword">(</span><span class="default">$angle</span><span class="keyword">);
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$sinangle </span><span class="keyword">= </span><span class="default">sin</span><span class="keyword">(</span><span class="default">$angle</span><span class="keyword">);
<br />
&nbsp;&nbsp;&nbsp; 
<br />
&nbsp;&nbsp;&nbsp; for (</span><span class="default">$y </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">; </span><span class="default">$y </span><span class="keyword">&lt; </span><span class="default">$src_y</span><span class="keyword">; </span><span class="default">$y</span><span class="keyword">++) {
<br />
&nbsp;&nbsp; &nbsp;&nbsp; for (</span><span class="default">$x </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">; </span><span class="default">$x </span><span class="keyword">&lt; </span><span class="default">$src_x</span><span class="keyword">; </span><span class="default">$x</span><span class="keyword">++) {
<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">// rotate...
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$old_x </span><span class="keyword">= ((</span><span class="default">$center_x</span><span class="keyword">-</span><span class="default">$x</span><span class="keyword">) * </span><span class="default">$cosangle </span><span class="keyword">+ (</span><span class="default">$center_y</span><span class="keyword">-</span><span class="default">$y</span><span class="keyword">) * </span><span class="default">$sinangle</span><span class="keyword">)
<br />
&nbsp;&nbsp; &nbsp;&nbsp; + </span><span class="default">$center_x</span><span class="keyword">;
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$old_y </span><span class="keyword">= ((</span><span class="default">$center_y</span><span class="keyword">-</span><span class="default">$y</span><span class="keyword">) * </span><span class="default">$cosangle </span><span class="keyword">- (</span><span class="default">$center_x</span><span class="keyword">-</span><span class="default">$x</span><span class="keyword">) * </span><span class="default">$sinangle</span><span class="keyword">)
<br />
&nbsp;&nbsp; &nbsp;&nbsp; + </span><span class="default">$center_y</span><span class="keyword">;
<br />
&nbsp;&nbsp;&nbsp; 
<br />
&nbsp;&nbsp;&nbsp; if ( </span><span class="default">$old_x </span><span class="keyword">&gt;= </span><span class="default">0 </span><span class="keyword">&amp;&amp; </span><span class="default">$old_x </span><span class="keyword">&lt; </span><span class="default">$src_x
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="keyword">&amp;&amp; </span><span class="default">$old_y </span><span class="keyword">&gt;= </span><span class="default">0 </span><span class="keyword">&amp;&amp; </span><span class="default">$old_y </span><span class="keyword">&lt; </span><span class="default">$src_y </span><span class="keyword">) {
<br />
&nbsp;&nbsp; &nbsp;&nbsp; if (</span><span class="default">$bicubic </span><span class="keyword">== </span><span class="default">true</span><span class="keyword">) {
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$sY&nbsp; </span><span class="keyword">= </span><span class="default">$old_y </span><span class="keyword">+ </span><span class="default">1</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$siY&nbsp; </span><span class="keyword">= </span><span class="default">$old_y</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$siY2 </span><span class="keyword">= </span><span class="default">$old_y </span><span class="keyword">- </span><span class="default">1</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$sX&nbsp; </span><span class="keyword">= </span><span class="default">$old_x </span><span class="keyword">+ </span><span class="default">1</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$siX&nbsp; </span><span class="keyword">= </span><span class="default">$old_x</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$siX2 </span><span class="keyword">= </span><span class="default">$old_x </span><span class="keyword">- </span><span class="default">1</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; 
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$c1 </span><span class="keyword">= </span><span class="default">imagecolorsforindex</span><span class="keyword">(</span><span class="default">$src_img</span><span class="keyword">, </span><span class="default">imagecolorat</span><span class="keyword">(</span><span class="default">$src_img</span><span class="keyword">, </span><span class="default">$siX</span><span class="keyword">, </span><span class="default">$siY2</span><span class="keyword">));
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$c2 </span><span class="keyword">= </span><span class="default">imagecolorsforindex</span><span class="keyword">(</span><span class="default">$src_img</span><span class="keyword">, </span><span class="default">imagecolorat</span><span class="keyword">(</span><span class="default">$src_img</span><span class="keyword">, </span><span class="default">$siX</span><span class="keyword">, </span><span class="default">$siY</span><span class="keyword">));
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$c3 </span><span class="keyword">= </span><span class="default">imagecolorsforindex</span><span class="keyword">(</span><span class="default">$src_img</span><span class="keyword">, </span><span class="default">imagecolorat</span><span class="keyword">(</span><span class="default">$src_img</span><span class="keyword">, </span><span class="default">$siX2</span><span class="keyword">, </span><span class="default">$siY2</span><span class="keyword">));
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$c4 </span><span class="keyword">= </span><span class="default">imagecolorsforindex</span><span class="keyword">(</span><span class="default">$src_img</span><span class="keyword">, </span><span class="default">imagecolorat</span><span class="keyword">(</span><span class="default">$src_img</span><span class="keyword">, </span><span class="default">$siX2</span><span class="keyword">, </span><span class="default">$siY</span><span class="keyword">));
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; 
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$r </span><span class="keyword">= (</span><span class="default">$c1</span><span class="keyword">[</span><span class="string">'red'</span><span class="keyword">]&nbsp; + </span><span class="default">$c2</span><span class="keyword">[</span><span class="string">'red'</span><span class="keyword">]&nbsp; + </span><span class="default">$c3</span><span class="keyword">[</span><span class="string">'red'</span><span class="keyword">]&nbsp; + </span><span class="default">$c4</span><span class="keyword">[</span><span class="string">'red'</span><span class="keyword">]&nbsp; ) &lt;&lt; </span><span class="default">14</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$g </span><span class="keyword">= (</span><span class="default">$c1</span><span class="keyword">[</span><span class="string">'green'</span><span class="keyword">] + </span><span class="default">$c2</span><span class="keyword">[</span><span class="string">'green'</span><span class="keyword">] + </span><span class="default">$c3</span><span class="keyword">[</span><span class="string">'green'</span><span class="keyword">] + </span><span class="default">$c4</span><span class="keyword">[</span><span class="string">'green'</span><span class="keyword">]) &lt;&lt; </span><span class="default">6</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$b </span><span class="keyword">= (</span><span class="default">$c1</span><span class="keyword">[</span><span class="string">'blue'</span><span class="keyword">]&nbsp; + </span><span class="default">$c2</span><span class="keyword">[</span><span class="string">'blue'</span><span class="keyword">]&nbsp; + </span><span class="default">$c3</span><span class="keyword">[</span><span class="string">'blue'</span><span class="keyword">]&nbsp; + </span><span class="default">$c4</span><span class="keyword">[</span><span class="string">'blue'</span><span class="keyword">] ) &gt;&gt; </span><span class="default">2</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$a </span><span class="keyword">= (</span><span class="default">$c1</span><span class="keyword">[</span><span class="string">'alpha'</span><span class="keyword">]&nbsp; + </span><span class="default">$c2</span><span class="keyword">[</span><span class="string">'alpha'</span><span class="keyword">]&nbsp; + </span><span class="default">$c3</span><span class="keyword">[</span><span class="string">'alpha'</span><span class="keyword">]&nbsp; + </span><span class="default">$c4</span><span class="keyword">[</span><span class="string">'alpha'</span><span class="keyword">] ) &gt;&gt; </span><span class="default">2</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$color </span><span class="keyword">= </span><span class="default">imagecolorallocatealpha</span><span class="keyword">(</span><span class="default">$src_img</span><span class="keyword">, </span><span class="default">$r</span><span class="keyword">,</span><span class="default">$g</span><span class="keyword">,</span><span class="default">$b</span><span class="keyword">,</span><span class="default">$a</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp;&nbsp; } else {
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$color </span><span class="keyword">= </span><span class="default">imagecolorat</span><span class="keyword">(</span><span class="default">$src_img</span><span class="keyword">, </span><span class="default">$old_x</span><span class="keyword">, </span><span class="default">$old_y</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp;&nbsp; }
<br />
&nbsp;&nbsp;&nbsp; } else {
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// this line sets the background colour
<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="default">$color </span><span class="keyword">= </span><span class="default">imagecolorallocatealpha</span><span class="keyword">(</span><span class="default">$src_img</span><span class="keyword">, </span><span class="default">255</span><span class="keyword">, </span><span class="default">255</span><span class="keyword">, </span><span class="default">255</span><span class="keyword">, </span><span class="default">127</span><span class="keyword">);
<br />
&nbsp;&nbsp;&nbsp; }
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">imagesetpixel</span><span class="keyword">(</span><span class="default">$rotate</span><span class="keyword">, </span><span class="default">$x</span><span class="keyword">, </span><span class="default">$y</span><span class="keyword">, </span><span class="default">$color</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp;&nbsp; }
<br />
&nbsp;&nbsp;&nbsp; }
<br />
&nbsp;&nbsp;&nbsp; return </span><span class="default">$rotate</span><span class="keyword">;
<br />
}
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="46338""></a>
  <div class="note">
   <strong class="user">jon at driestone dot com</strong>
   <a href="#46338" class="date">07-Oct-2004 05:42</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
imagerotate does not preserve the alpha channel, so if you want to rotate a PNG you need to get 
<br />
creative. I don't see any command to retrieve the alpha information from an image (as far as 
<br />
I could see,) so you'll have to do a bit of manual labor before hand. In my case I created a 
<br />
second PNG file with the alpha saved as RGB data and manually "copied" the data from source 
<br />
to destination:
<br />

<br />
<span class="default">&lt;?php
<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">function </span><span class="default">alpha_rotate</span><span class="keyword">(</span><span class="default">$dst</span><span class="keyword">,</span><span class="default">$src</span><span class="keyword">,</span><span class="default">$rotate</span><span class="keyword">,</span><span class="default">$offsetX</span><span class="keyword">,</span><span class="default">$offsetY</span><span class="keyword">){
<br />

<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$top </span><span class="keyword">= </span><span class="default">imagecreatefrompng</span><span class="keyword">(</span><span class="string">"image_processing/shadow.png"</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$top_alpha </span><span class="keyword">= </span><span class="default">imagecreatefrompng</span><span class="keyword">(</span><span class="string">"image_processing/shadow_alpha.png"</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; 
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">imagecopyresampled</span><span class="keyword">(</span><span class="default">$top</span><span class="keyword">,</span><span class="default">$src</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">,</span><span class="default">100</span><span class="keyword">,</span><span class="default">100</span><span class="keyword">,</span><span class="default">100</span><span class="keyword">,</span><span class="default">100</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; 
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$top </span><span class="keyword">= </span><span class="default">imagerotate</span><span class="keyword">(</span><span class="default">$top</span><span class="keyword">,</span><span class="default">$rotate</span><span class="keyword">,</span><span class="default">0x000000</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$top_alpha </span><span class="keyword">= </span><span class="default">imagerotate</span><span class="keyword">(</span><span class="default">$top_alpha</span><span class="keyword">,</span><span class="default">$rotate</span><span class="keyword">,</span><span class="default">0x000000</span><span class="keyword">);
<br />
&nbsp;&nbsp;&nbsp; 
<br />
&nbsp;&nbsp;&nbsp; 
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; for (</span><span class="default">$theX</span><span class="keyword">=</span><span class="default">0</span><span class="keyword">;</span><span class="default">$theX</span><span class="keyword">&lt;</span><span class="default">imagesx</span><span class="keyword">(</span><span class="default">$top</span><span class="keyword">);</span><span class="default">$theX</span><span class="keyword">++){
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; for (</span><span class="default">$theY</span><span class="keyword">=</span><span class="default">0</span><span class="keyword">;</span><span class="default">$theY</span><span class="keyword">&lt;</span><span class="default">imagesy</span><span class="keyword">(</span><span class="default">$top</span><span class="keyword">);</span><span class="default">$theY</span><span class="keyword">++){
<br />
&nbsp;&nbsp;&nbsp; 
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$rgb </span><span class="keyword">= </span><span class="default">imagecolorat</span><span class="keyword">(</span><span class="default">$top</span><span class="keyword">,</span><span class="default">$theX</span><span class="keyword">,</span><span class="default">$theY</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$r </span><span class="keyword">= (</span><span class="default">$rgb </span><span class="keyword">&gt;&gt; </span><span class="default">16</span><span class="keyword">) &amp; </span><span class="default">0xFF</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$g </span><span class="keyword">= (</span><span class="default">$rgb </span><span class="keyword">&gt;&gt; </span><span class="default">8</span><span class="keyword">) &amp; </span><span class="default">0xFF</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$b </span><span class="keyword">= </span><span class="default">$rgb </span><span class="keyword">&amp; </span><span class="default">0xFF</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; 
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$rgb </span><span class="keyword">= </span><span class="default">imagecolorat</span><span class="keyword">(</span><span class="default">$top_alpha</span><span class="keyword">,</span><span class="default">$theX</span><span class="keyword">,</span><span class="default">$theY</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$a </span><span class="keyword">= </span><span class="default">$rgb </span><span class="keyword">&amp; </span><span class="default">0xFF</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$a </span><span class="keyword">= </span><span class="default">127</span><span class="keyword">-</span><span class="default">floor</span><span class="keyword">(</span><span class="default">$a</span><span class="keyword">/</span><span class="default">2</span><span class="keyword">);
<br />

<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$myColor </span><span class="keyword">= </span><span class="default">imagecolorallocatealpha</span><span class="keyword">(</span><span class="default">$top</span><span class="keyword">,</span><span class="default">$r</span><span class="keyword">,</span><span class="default">$g</span><span class="keyword">,</span><span class="default">$b</span><span class="keyword">,</span><span class="default">$a</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">imagesetpixel</span><span class="keyword">(</span><span class="default">$dst</span><span class="keyword">,(</span><span class="default">$theX</span><span class="keyword">+</span><span class="default">$offsetX</span><span class="keyword">),(</span><span class="default">$theY</span><span class="keyword">+</span><span class="default">$offsetY</span><span class="keyword">),</span><span class="default">$myColor</span><span class="keyword">);&nbsp; &nbsp; 
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }
<br />
&nbsp;&nbsp;&nbsp; }
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="46244""></a>
  <div class="note">
   <strong class="user">christoph (at) raketenbasis (dot) de</strong>
   <a href="#46244" class="date">04-Oct-2004 09:41</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
The default direction of imageRotate() is counter clockwise. Heres a little function which solves the problem.<br />
<br />
<span class="default">&lt;?php<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">function </span><span class="default">rotate</span><span class="keyword">(&amp;</span><span class="default">$image_source</span><span class="keyword">, </span><span class="default">$rotate_value</span><span class="keyword">, </span><span class="default">$rotate_clockwise </span><span class="keyword">= </span><span class="default">true</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if(</span><span class="default">$rotate_clockwise </span><span class="keyword">== </span><span class="default">true</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$rotate_value </span><span class="keyword">= </span><span class="default">360 </span><span class="keyword">- </span><span class="default">$rotate_value</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$image_source </span><span class="keyword">= </span><span class="default">imageRotate</span><span class="keyword">(</span><span class="default">$image_source</span><span class="keyword">, </span><span class="default">$rotate_value</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; <br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
</div>
</div>
</div></div></body></html>
