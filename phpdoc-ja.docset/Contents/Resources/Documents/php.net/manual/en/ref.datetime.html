<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
 <head>
  <meta http-equiv="content-type" content="text/html; CHARSET=shift-jis">
  <title>日付・時刻 関数</title>

  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <link media="all" rel="stylesheet" type="text/css" href="style.css"/>
 </head>
 <body class="docs" class="docs"><div class="navbar navbar-fixed-top">
  <div class="navbar-inner clearfix">
    <ul class="nav" style="width: 100%">
      <li style="float: left;"><a href="dateperiod.construct.html">≪ DatePeriod::__construct</a></li>
      <li style="float: right;"><a href="function.checkdate.html">checkdate ≫</a></li>
    </ul>
  </div>
</div>
<div id="breadcrumbs" class="clearfix">
  <ul class="breadcrumbs-container">
    <li><a href="index.html">PHP Manual</a></li>
    <li><a href="book.datetime.html">Date/Time</a></li>
    <li>日付・時刻 関数</li>
  </ul>
</div>
<div id="layout">
  <div id="layout-content"><div id="ref.datetime" class="reference">
 <h1 class="title">日付・時刻 関数</h1>

 








































































































































































































































































































  





















































































<h2>目次</h2><ul class="chunklist chunklist_reference"><li><a href="function.checkdate.html">checkdate</a> &mdash; グレゴリオ暦の日付/時刻の妥当性を確認します</li><li><a href="function.date-add.html">date_add</a> &mdash; DateTime::add のエイリアス</li><li><a href="function.date-create-from-format.html">date_create_from_format</a> &mdash; DateTime::createFromFormat のエイリアス</li><li><a href="function.date-create-immutable-from-format.html">date_create_immutable_from_format</a> &mdash; DateTimeImmutable::createFromFormat のエイリアス</li><li><a href="function.date-create-immutable.html">date_create_immutable</a> &mdash; DateTimeImmutable::__construct のエイリアス</li><li><a href="function.date-create.html">date_create</a> &mdash; DateTime::__construct のエイリアス</li><li><a href="function.date-date-set.html">date_date_set</a> &mdash; DateTime::setDate のエイリアス</li><li><a href="function.date-default-timezone-get.html">date_default_timezone_get</a> &mdash; スクリプト中の日付/時刻関数で使用されるデフォルトタイムゾーンを取得する</li><li><a href="function.date-default-timezone-set.html">date_default_timezone_set</a> &mdash; スクリプト中の日付/時刻関数で使用されるデフォルトタイムゾーンを設定する</li><li><a href="function.date-diff.html">date_diff</a> &mdash; DateTime::diff のエイリアス</li><li><a href="function.date-format.html">date_format</a> &mdash; DateTime::format のエイリアス</li><li><a href="function.date-get-last-errors.html">date_get_last_errors</a> &mdash; DateTime::getLastErrors のエイリアス</li><li><a href="function.date-interval-create-from-date-string.html">date_interval_create_from_date_string</a> &mdash; DateInterval::createFromDateString のエイリアス</li><li><a href="function.date-interval-format.html">date_interval_format</a> &mdash; DateInterval::format のエイリアス</li><li><a href="function.date-isodate-set.html">date_isodate_set</a> &mdash; DateTime::setISODate のエイリアス</li><li><a href="function.date-modify.html">date_modify</a> &mdash; DateTime::modify のエイリアス</li><li><a href="function.date-offset-get.html">date_offset_get</a> &mdash; DateTime::getOffset のエイリアス</li><li><a href="function.date-parse-from-format.html">date_parse_from_format</a> &mdash; 指定した書式でフォーマットされた日付についての情報を取得する</li><li><a href="function.date-parse.html">date_parse</a> &mdash; 指定した日付に関する詳細な情報を連想配列で返す</li><li><a href="function.date-sub.html">date_sub</a> &mdash; DateTime::sub のエイリアス</li><li><a href="function.date-sun-info.html">date_sun_info</a> &mdash; 日の出/日の入り時刻と薄明かり (twilight) の開始/終了時刻の情報を含む配列を返す</li><li><a href="function.date-sunrise.html">date_sunrise</a> &mdash; 指定した日付と場所についての日の出時刻を返す</li><li><a href="function.date-sunset.html">date_sunset</a> &mdash; 指定した日付と場所についての日の入り時刻を返す</li><li><a href="function.date-time-set.html">date_time_set</a> &mdash; DateTime::setTime のエイリアス</li><li><a href="function.date-timestamp-get.html">date_timestamp_get</a> &mdash; DateTime::getTimestamp のエイリアス</li><li><a href="function.date-timestamp-set.html">date_timestamp_set</a> &mdash; DateTime::setTimestamp のエイリアス</li><li><a href="function.date-timezone-get.html">date_timezone_get</a> &mdash; DateTime::getTimezone のエイリアス</li><li><a href="function.date-timezone-set.html">date_timezone_set</a> &mdash; DateTime::setTimezone のエイリアス</li><li><a href="function.date.html">date</a> &mdash; ローカルの日付/時刻を書式化する</li><li><a href="function.getdate.html">getdate</a> &mdash; 日付/時刻情報を取得する</li><li><a href="function.gettimeofday.html">gettimeofday</a> &mdash; 現在の時間を得る</li><li><a href="function.gmdate.html">gmdate</a> &mdash; GMT/UTC の日付/時刻を書式化する</li><li><a href="function.gmmktime.html">gmmktime</a> &mdash; GMT 日付から Unix タイムスタンプを取得する</li><li><a href="function.gmstrftime.html">gmstrftime</a> &mdash; ロケールの設定に基づいて GMT/UTC 時刻/日付をフォーマットする</li><li><a href="function.idate.html">idate</a> &mdash; ローカルな時刻/日付を整数として整形する</li><li><a href="function.localtime.html">localtime</a> &mdash; ローカルタイムを得る</li><li><a href="function.microtime.html">microtime</a> &mdash; 現在の Unix タイムスタンプをマイクロ秒まで返す</li><li><a href="function.mktime.html">mktime</a> &mdash; 日付を Unix のタイムスタンプとして取得する</li><li><a href="function.strftime.html">strftime</a> &mdash; ロケールの設定に基づいてローカルな日付・時間をフォーマットする</li><li><a href="function.strptime.html">strptime</a> &mdash; strftime が生成した日付/時刻をパースする</li><li><a href="function.strtotime.html">strtotime</a> &mdash; 英文形式の日付を Unix タイムスタンプに変換する</li><li><a href="function.time.html">time</a> &mdash; 現在の Unix タイムスタンプを返す</li><li><a href="function.timezone-abbreviations-list.html">timezone_abbreviations_list</a> &mdash; DateTimeZone::listAbbreviations のエイリアス</li><li><a href="function.timezone-identifiers-list.html">timezone_identifiers_list</a> &mdash; DateTimeZone::listIdentifiers のエイリアス</li><li><a href="function.timezone-location-get.html">timezone_location_get</a> &mdash; DateTimeZone::getLocation のエイリアス</li><li><a href="function.timezone-name-from-abbr.html">timezone_name_from_abbr</a> &mdash; 略称からタイムゾーン名を返す</li><li><a href="function.timezone-name-get.html">timezone_name_get</a> &mdash; DateTimeZone::getName のエイリアス</li><li><a href="function.timezone-offset-get.html">timezone_offset_get</a> &mdash; DateTimeZone::getOffset のエイリアス</li><li><a href="function.timezone-open.html">timezone_open</a> &mdash; DateTimeZone::__construct のエイリアス</li><li><a href="function.timezone-transitions-get.html">timezone_transitions_get</a> &mdash; DateTimeZone::getTransitions のエイリアス</li><li><a href="function.timezone-version-get.html">timezone_version_get</a> &mdash; timezonedb のバージョンを取得する</li></ul>
</div>
<div id="usernotes">
 <div class="head">
  <h3 class="title">User Contributed Notes</h3>
 </div>
<div id="allnotes">  <a name="105397""></a>
  <div class="note">
   <strong class="user">Hans</strong>
   <a href="#105397" class="date">15-Aug-2011 09:19</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I needed a way to display an announcement on a shopping site, that would warn users that orders placed between a certain date range, would not be shipped until after a certain date.<br />
<br />
I created this simple date detection code to display the notice on certain pages. You can just copy the code and save it to a file on the site and include it anywhere you need to perform a function, or display a notice.<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="comment">/*<br />
&nbsp;&nbsp;&nbsp; Code to show a message only for a certain time frame.<br />
&nbsp;&nbsp;&nbsp; This is a simple include file that can be used to display a message<br />
&nbsp;&nbsp;&nbsp; on any pages that use it.<br />
&nbsp;&nbsp;&nbsp; Simply us a standard include instruction to this file on the page/s where <br />
&nbsp;&nbsp;&nbsp; you want the notice to appear.<br />
&nbsp;&nbsp;&nbsp; Written by Hans Kiesouw - hans at wotworx dot com<br />
*/<br />
<br />
</span><span class="default">$start </span><span class="keyword">= new </span><span class="default">DateTime</span><span class="keyword">(</span><span class="string">'30-07-2011'</span><span class="keyword">); </span><span class="comment">// DD-MM-YYYY<br />
</span><span class="default">$endDate</span><span class="keyword">= new </span><span class="default">DateTime</span><span class="keyword">(</span><span class="string">'07-08-2011'</span><span class="keyword">); </span><span class="comment">// DD-MM-YYYY<br />
</span><span class="default">$curdate </span><span class="keyword">= new </span><span class="default">DateTime</span><span class="keyword">(</span><span class="default">date</span><span class="keyword">(</span><span class="string">'d-m-Y'</span><span class="keyword">));<br />
<br />
if (</span><span class="default">$start </span><span class="keyword">&lt;= </span><span class="default">$curdate </span><span class="keyword">&amp;&amp; </span><span class="default">$curdate </span><span class="keyword">&lt;= </span><span class="default">$endDate</span><span class="keyword">) {<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">/*<br />
&nbsp;&nbsp;&nbsp; The message below will appear if the current date is between the start and <br />
&nbsp;&nbsp;&nbsp; endDate - used standards HTML to ensure that any code will not be <br />
&nbsp;&nbsp;&nbsp; escaped by PHP. You can use any code here to wish to execute for the <br />
&nbsp;&nbsp;&nbsp; date range.<br />
&nbsp;&nbsp;&nbsp; */<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">?&gt;<br />
</span>&nbsp; &nbsp; <br />
&nbsp;&nbsp;&nbsp; &lt;p&gt;&lt;strong&gt;&lt;font color="#FF0000"&gt;Please Note: Any orders placed between July 30th and August 7th will only be shipped on August 8th. We apologize for any inconvenience and thank you for your order.&lt;/font&gt;&lt;/strong&gt;&lt;/p&gt;<br />
&nbsp;<span class="default">&lt;?php&nbsp; <br />
&nbsp;</span><span class="comment">// don't forget this last bit, it ends the if statement!<br />
</span><span class="keyword">} <br />
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="90989""></a>
  <div class="note">
   <strong class="user">luck dot lil dot leprechaun at gmail dot com</strong>
   <a href="#90989" class="date">20-May-2009 12:53</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
This is an easily extendable and pretty way to output human-readable date differences such as "1 day 2 hours ago", "6 months ago", "3 years 7 months 14 days 1 hour 4 minutes 16 seconds" etc etc.
<br />
Change "$levels = 2;" to whatever you want. A value of 1 will limit to only one number in the result ("3 days ago"). A value of 3 would result in up to three ("3 days 1 hour 2 minutes ago")
<br />

<br />
It can be used in the following ways:
<br />
echo compare_dates($start_date,$end_date);
<br />
echo compare_dates($end_date,$start_date);
<br />
echo compare_dates($start_date); //end date will be assumed as time();
<br />

<br />
<span class="default">&lt;?php
<br />
</span><span class="keyword">function </span><span class="default">compare_dates</span><span class="keyword">(</span><span class="default">$date1</span><span class="keyword">, </span><span class="default">$date2 </span><span class="keyword">= </span><span class="default">time</span><span class="keyword">())
<br />
&nbsp;&nbsp;&nbsp; {
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$blocks </span><span class="keyword">= array(
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; array(</span><span class="string">'name'</span><span class="keyword">=&gt;</span><span class="string">'year'</span><span class="keyword">,</span><span class="string">'amount'&nbsp; &nbsp; </span><span class="keyword">=&gt;&nbsp; &nbsp; </span><span class="default">60</span><span class="keyword">*</span><span class="default">60</span><span class="keyword">*</span><span class="default">24</span><span class="keyword">*</span><span class="default">365&nbsp; &nbsp; </span><span class="keyword">),
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; array(</span><span class="string">'name'</span><span class="keyword">=&gt;</span><span class="string">'month'</span><span class="keyword">,</span><span class="string">'amount'&nbsp; &nbsp; </span><span class="keyword">=&gt;&nbsp; &nbsp; </span><span class="default">60</span><span class="keyword">*</span><span class="default">60</span><span class="keyword">*</span><span class="default">24</span><span class="keyword">*</span><span class="default">31&nbsp; &nbsp; </span><span class="keyword">),
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; array(</span><span class="string">'name'</span><span class="keyword">=&gt;</span><span class="string">'week'</span><span class="keyword">,</span><span class="string">'amount'&nbsp; &nbsp; </span><span class="keyword">=&gt;&nbsp; &nbsp; </span><span class="default">60</span><span class="keyword">*</span><span class="default">60</span><span class="keyword">*</span><span class="default">24</span><span class="keyword">*</span><span class="default">7&nbsp; &nbsp; </span><span class="keyword">),
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; array(</span><span class="string">'name'</span><span class="keyword">=&gt;</span><span class="string">'day'</span><span class="keyword">,</span><span class="string">'amount'&nbsp; &nbsp; </span><span class="keyword">=&gt;&nbsp; &nbsp; </span><span class="default">60</span><span class="keyword">*</span><span class="default">60</span><span class="keyword">*</span><span class="default">24&nbsp; &nbsp; </span><span class="keyword">),
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; array(</span><span class="string">'name'</span><span class="keyword">=&gt;</span><span class="string">'hour'</span><span class="keyword">,</span><span class="string">'amount'&nbsp; &nbsp; </span><span class="keyword">=&gt;&nbsp; &nbsp; </span><span class="default">60</span><span class="keyword">*</span><span class="default">60&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="keyword">),
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; array(</span><span class="string">'name'</span><span class="keyword">=&gt;</span><span class="string">'minute'</span><span class="keyword">,</span><span class="string">'amount'&nbsp; &nbsp; </span><span class="keyword">=&gt;&nbsp; &nbsp; </span><span class="default">60&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="keyword">),
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; array(</span><span class="string">'name'</span><span class="keyword">=&gt;</span><span class="string">'second'</span><span class="keyword">,</span><span class="string">'amount'&nbsp; &nbsp; </span><span class="keyword">=&gt;&nbsp; &nbsp; </span><span class="default">1&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="keyword">)
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; );
<br />
&nbsp;&nbsp;&nbsp; 
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$diff </span><span class="keyword">= </span><span class="default">abs</span><span class="keyword">(</span><span class="default">$date1</span><span class="keyword">-</span><span class="default">$date2</span><span class="keyword">);
<br />
&nbsp;&nbsp;&nbsp; 
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$levels </span><span class="keyword">= </span><span class="default">2</span><span class="keyword">;
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$current_level </span><span class="keyword">= </span><span class="default">1</span><span class="keyword">;
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$result </span><span class="keyword">= array();
<br />
&nbsp;&nbsp;&nbsp; foreach(</span><span class="default">$blocks </span><span class="keyword">as </span><span class="default">$block</span><span class="keyword">)
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; {
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">$current_level </span><span class="keyword">&gt; </span><span class="default">$levels</span><span class="keyword">) {break;}
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">$diff</span><span class="keyword">/</span><span class="default">$block</span><span class="keyword">[</span><span class="string">'amount'</span><span class="keyword">] &gt;= </span><span class="default">1</span><span class="keyword">)
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; {
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$amount </span><span class="keyword">= </span><span class="default">floor</span><span class="keyword">(</span><span class="default">$diff</span><span class="keyword">/</span><span class="default">$block</span><span class="keyword">[</span><span class="string">'amount'</span><span class="keyword">]);
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">$amount</span><span class="keyword">&gt;</span><span class="default">1</span><span class="keyword">) {</span><span class="default">$plural</span><span class="keyword">=</span><span class="string">'s'</span><span class="keyword">;} else {</span><span class="default">$plural</span><span class="keyword">=</span><span class="string">''</span><span class="keyword">;}
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$result</span><span class="keyword">[] = </span><span class="default">$amount</span><span class="keyword">.</span><span class="string">' '</span><span class="keyword">.</span><span class="default">$block</span><span class="keyword">[</span><span class="string">'name'</span><span class="keyword">].</span><span class="default">$plural</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$diff </span><span class="keyword">-= </span><span class="default">$amount</span><span class="keyword">*</span><span class="default">$block</span><span class="keyword">[</span><span class="string">'amount'</span><span class="keyword">];
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$current_level</span><span class="keyword">++;
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }
<br />
&nbsp;&nbsp;&nbsp; return </span><span class="default">implode</span><span class="keyword">(</span><span class="string">' '</span><span class="keyword">,</span><span class="default">$result</span><span class="keyword">).</span><span class="string">' ago'</span><span class="keyword">;
<br />
&nbsp;&nbsp;&nbsp; }
<br />
</span><span class="default">?&gt;
<br />
</span>
<br />
[EDIT BY danbrown AT php DOT net: Contains a bugfix supplied by (jorge AT dontspam DOT com) on 22-OCT-2009.]</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="81908""></a>
  <div class="note">
   <strong class="user">Robb_Bean at gmx dot nospam dot net</strong>
   <a href="#81908" class="date">19-Mar-2008 12:47</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
With PHP 5.1 and 5.2 the languages datetime support has changed. Although these functions should guess your local timezone settings, they may fail if using a default configuration in a "pre-5.1 way", which means setting no timezone for PHP. In the case PHP could not get a timezone it emits a E_STRICT warning. Note that this affects _all_ datetime functions and keep it in mind when porting software from previous versions to 5.1 or later! It may also confuse your error handling (this is the way I noticed that things have changed, since these changes are not documentated _here_).<br />
<br />
References:<br />
<br />
<a href="http://www.php.net/manual/de/migration51.datetime.php" rel="nofollow" target="_blank">http://www.php.net/manual/de/migration51.datetime.php</a><br />
<a href="http://www.php.net/manual/de/migration52.datetime.php" rel="nofollow" target="_blank">http://www.php.net/manual/de/migration52.datetime.php</a></span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="81452""></a>
  <div class="note">
   <strong class="user">sagar</strong>
   <a href="#81452" class="date">28-Feb-2008 05:53</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
<span class="default">&lt;?php
<br />
</span><span class="comment">####################################
<br />
# Provide week number and get start_timestamp and end_timestamp
<br />
#####################################
<br />

<br />
// this week number will come from the timeshare form
<br />
&nbsp;</span><span class="default">$week </span><span class="keyword">= </span><span class="default">51</span><span class="keyword">;
<br />

<br />
</span><span class="default">$times </span><span class="keyword">= </span><span class="default">get_start_and_end_date_from_week</span><span class="keyword">(</span><span class="default">$week</span><span class="keyword">);
<br />
</span><span class="default">$start_time </span><span class="keyword">= </span><span class="default">$times</span><span class="keyword">[</span><span class="string">'start_timestamp'</span><span class="keyword">];
<br />
</span><span class="default">$end_time </span><span class="keyword">= </span><span class="default">$times</span><span class="keyword">[</span><span class="string">'end_timestamp'</span><span class="keyword">];
<br />

<br />
function </span><span class="default">get_start_and_end_date_from_week </span><span class="keyword">(</span><span class="default">$w</span><span class="keyword">) 
<br />
{
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$y </span><span class="keyword">= </span><span class="default">date</span><span class="keyword">(</span><span class="string">"Y"</span><span class="keyword">, </span><span class="default">time</span><span class="keyword">());
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$o </span><span class="keyword">= </span><span class="default">6</span><span class="keyword">; </span><span class="comment">// week starts from sunday by default
<br />

<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$days </span><span class="keyword">= (</span><span class="default">$w </span><span class="keyword">- </span><span class="default">1</span><span class="keyword">) * </span><span class="default">7 </span><span class="keyword">+ </span><span class="default">$o</span><span class="keyword">;
<br />

<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$firstdayofyear </span><span class="keyword">= </span><span class="default">getdate</span><span class="keyword">(</span><span class="default">mktime</span><span class="keyword">(</span><span class="default">0</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">,</span><span class="default">1</span><span class="keyword">,</span><span class="default">1</span><span class="keyword">,</span><span class="default">$y</span><span class="keyword">));
<br />
&nbsp;&nbsp;&nbsp; if (</span><span class="default">$firstdayofyear</span><span class="keyword">[</span><span class="string">"wday"</span><span class="keyword">] == </span><span class="default">0</span><span class="keyword">) </span><span class="default">$firstdayofyear</span><span class="keyword">[</span><span class="string">"wday"</span><span class="keyword">] += </span><span class="default">7</span><span class="keyword">;
<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment"># in getdate, Sunday is 0 instead of 7
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$firstmonday </span><span class="keyword">= </span><span class="default">getdate</span><span class="keyword">(</span><span class="default">mktime</span><span class="keyword">(</span><span class="default">0</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">,</span><span class="default">1</span><span class="keyword">,</span><span class="default">1</span><span class="keyword">-</span><span class="default">$firstdayofyear</span><span class="keyword">[</span><span class="string">"wday"</span><span class="keyword">]+</span><span class="default">1</span><span class="keyword">,</span><span class="default">$y</span><span class="keyword">));
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$calcdate </span><span class="keyword">= </span><span class="default">getdate</span><span class="keyword">(</span><span class="default">mktime</span><span class="keyword">(</span><span class="default">0</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">,</span><span class="default">$firstmonday</span><span class="keyword">[</span><span class="string">"mon"</span><span class="keyword">], </span><span class="default">$firstmonday</span><span class="keyword">[</span><span class="string">"mday"</span><span class="keyword">]+</span><span class="default">$days</span><span class="keyword">,</span><span class="default">$firstmonday</span><span class="keyword">[</span><span class="string">"year"</span><span class="keyword">]));
<br />

<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$sday </span><span class="keyword">= </span><span class="default">$calcdate</span><span class="keyword">[</span><span class="string">"mday"</span><span class="keyword">];
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$smonth </span><span class="keyword">= </span><span class="default">$calcdate</span><span class="keyword">[</span><span class="string">"mon"</span><span class="keyword">];
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$syear </span><span class="keyword">= </span><span class="default">$calcdate</span><span class="keyword">[</span><span class="string">"year"</span><span class="keyword">];
<br />
&nbsp;&nbsp;&nbsp; 
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; 
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$timestamp</span><span class="keyword">[</span><span class="string">'start_timestamp'</span><span class="keyword">] =&nbsp; </span><span class="default">mktime</span><span class="keyword">(</span><span class="default">0</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">$smonth</span><span class="keyword">, </span><span class="default">$sday</span><span class="keyword">, </span><span class="default">$syear</span><span class="keyword">);
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$timestamp</span><span class="keyword">[</span><span class="string">'end_timestamp'</span><span class="keyword">] =&nbsp; </span><span class="default">$timestamp</span><span class="keyword">[</span><span class="string">'start_timestamp'</span><span class="keyword">] + (</span><span class="default">60</span><span class="keyword">*</span><span class="default">60</span><span class="keyword">*</span><span class="default">24</span><span class="keyword">*</span><span class="default">7</span><span class="keyword">);
<br />

<br />
&nbsp;&nbsp;&nbsp; return </span><span class="default">$timestamp</span><span class="keyword">;
<br />

<br />
}&nbsp; &nbsp; </span><span class="comment"># function datefromweek
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="78981""></a>
  <div class="note">
   <strong class="user">stoicnluv at gmail dot com</strong>
   <a href="#78981" class="date">06-Nov-2007 12:14</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
A better and accurate function to calculate the difference between 2 dates. Takes leap years and DST into consideration. Accepts string date or timestamp as arguments.<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">function </span><span class="default">date_diff</span><span class="keyword">(</span><span class="default">$d1</span><span class="keyword">, </span><span class="default">$d2</span><span class="keyword">){<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$d1 </span><span class="keyword">= (</span><span class="default">is_string</span><span class="keyword">(</span><span class="default">$d1</span><span class="keyword">) ? </span><span class="default">strtotime</span><span class="keyword">(</span><span class="default">$d1</span><span class="keyword">) : </span><span class="default">$d1</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$d2 </span><span class="keyword">= (</span><span class="default">is_string</span><span class="keyword">(</span><span class="default">$d2</span><span class="keyword">) ? </span><span class="default">strtotime</span><span class="keyword">(</span><span class="default">$d2</span><span class="keyword">) : </span><span class="default">$d2</span><span class="keyword">);<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$diff_secs </span><span class="keyword">= </span><span class="default">abs</span><span class="keyword">(</span><span class="default">$d1 </span><span class="keyword">- </span><span class="default">$d2</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$base_year </span><span class="keyword">= </span><span class="default">min</span><span class="keyword">(</span><span class="default">date</span><span class="keyword">(</span><span class="string">"Y"</span><span class="keyword">, </span><span class="default">$d1</span><span class="keyword">), </span><span class="default">date</span><span class="keyword">(</span><span class="string">"Y"</span><span class="keyword">, </span><span class="default">$d2</span><span class="keyword">));<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$diff </span><span class="keyword">= </span><span class="default">mktime</span><span class="keyword">(</span><span class="default">0</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">$diff_secs</span><span class="keyword">, </span><span class="default">1</span><span class="keyword">, </span><span class="default">1</span><span class="keyword">, </span><span class="default">$base_year</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; return array(<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="string">"years" </span><span class="keyword">=&gt; </span><span class="default">date</span><span class="keyword">(</span><span class="string">"Y"</span><span class="keyword">, </span><span class="default">$diff</span><span class="keyword">) - </span><span class="default">$base_year</span><span class="keyword">,<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="string">"months_total" </span><span class="keyword">=&gt; (</span><span class="default">date</span><span class="keyword">(</span><span class="string">"Y"</span><span class="keyword">, </span><span class="default">$diff</span><span class="keyword">) - </span><span class="default">$base_year</span><span class="keyword">) * </span><span class="default">12 </span><span class="keyword">+ </span><span class="default">date</span><span class="keyword">(</span><span class="string">"n"</span><span class="keyword">, </span><span class="default">$diff</span><span class="keyword">) - </span><span class="default">1</span><span class="keyword">,<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="string">"months" </span><span class="keyword">=&gt; </span><span class="default">date</span><span class="keyword">(</span><span class="string">"n"</span><span class="keyword">, </span><span class="default">$diff</span><span class="keyword">) - </span><span class="default">1</span><span class="keyword">,<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="string">"days_total" </span><span class="keyword">=&gt; </span><span class="default">floor</span><span class="keyword">(</span><span class="default">$diff_secs </span><span class="keyword">/ (</span><span class="default">3600 </span><span class="keyword">* </span><span class="default">24</span><span class="keyword">)),<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="string">"days" </span><span class="keyword">=&gt; </span><span class="default">date</span><span class="keyword">(</span><span class="string">"j"</span><span class="keyword">, </span><span class="default">$diff</span><span class="keyword">) - </span><span class="default">1</span><span class="keyword">,<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="string">"hours_total" </span><span class="keyword">=&gt; </span><span class="default">floor</span><span class="keyword">(</span><span class="default">$diff_secs </span><span class="keyword">/ </span><span class="default">3600</span><span class="keyword">),<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="string">"hours" </span><span class="keyword">=&gt; </span><span class="default">date</span><span class="keyword">(</span><span class="string">"G"</span><span class="keyword">, </span><span class="default">$diff</span><span class="keyword">),<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="string">"minutes_total" </span><span class="keyword">=&gt; </span><span class="default">floor</span><span class="keyword">(</span><span class="default">$diff_secs </span><span class="keyword">/ </span><span class="default">60</span><span class="keyword">),<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="string">"minutes" </span><span class="keyword">=&gt; (int) </span><span class="default">date</span><span class="keyword">(</span><span class="string">"i"</span><span class="keyword">, </span><span class="default">$diff</span><span class="keyword">),<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="string">"seconds_total" </span><span class="keyword">=&gt; </span><span class="default">$diff_secs</span><span class="keyword">,<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="string">"seconds" </span><span class="keyword">=&gt; (int) </span><span class="default">date</span><span class="keyword">(</span><span class="string">"s"</span><span class="keyword">, </span><span class="default">$diff</span><span class="keyword">)<br />
&nbsp;&nbsp;&nbsp; );<br />
}<br />
<br />
</span><span class="default">$a </span><span class="keyword">= </span><span class="default">date_diff</span><span class="keyword">(</span><span class="string">"2006-11-01"</span><span class="keyword">, </span><span class="string">"2007-11-01"</span><span class="keyword">);<br />
<br />
echo </span><span class="string">"&lt;pre&gt;"</span><span class="keyword">;<br />
</span><span class="default">print_r</span><span class="keyword">(</span><span class="default">$a</span><span class="keyword">);<br />
echo </span><span class="string">"&lt;/pre&gt;"</span><span class="keyword">;<br />
</span><span class="default">?&gt;<br />
</span><br />
This example will output (if your timezone uses US DST):<br />
<br />
Array<br />
(<br />
&nbsp;&nbsp;&nbsp; [years] =&gt; 0<br />
&nbsp;&nbsp;&nbsp; [months_total] =&gt; 11<br />
&nbsp;&nbsp;&nbsp; [months] =&gt; 11<br />
&nbsp;&nbsp;&nbsp; [days_total] =&gt; 364<br />
&nbsp;&nbsp;&nbsp; [days] =&gt; 30<br />
&nbsp;&nbsp;&nbsp; [hours_total] =&gt; 8759<br />
&nbsp;&nbsp;&nbsp; [hours] =&gt; 23<br />
&nbsp;&nbsp;&nbsp; [minutes_total] =&gt; 525540<br />
&nbsp;&nbsp;&nbsp; [minutes] =&gt; 0<br />
&nbsp;&nbsp;&nbsp; [seconds_total] =&gt; 31532400<br />
&nbsp;&nbsp;&nbsp; [seconds] =&gt; 0<br />
)<br />
<br />
As you can see, the result is not exactly 1 year (less 1 hour) since Nov 1, 2006 is not DST while Nov 1, 2007 is DST.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="78761""></a>
  <div class="note">
   <strong class="user">venoel at rin dot ru</strong>
   <a href="#78761" class="date">26-Oct-2007 12:33</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
May be useful for somebody. This function takes on daylight saving time
<br />

<br />
<span class="default">&lt;?php
<br />
</span><span class="keyword">Function </span><span class="default">DateDiff</span><span class="keyword">(</span><span class="default">$date1</span><span class="keyword">,</span><span class="default">$date2</span><span class="keyword">) {
<br />
&nbsp; </span><span class="default">$timedifference</span><span class="keyword">=</span><span class="default">$date2</span><span class="keyword">-</span><span class="default">$date1</span><span class="keyword">;
<br />
&nbsp; </span><span class="default">$corr</span><span class="keyword">=</span><span class="default">date</span><span class="keyword">(</span><span class="string">"I"</span><span class="keyword">,</span><span class="default">$date2</span><span class="keyword">)-</span><span class="default">date</span><span class="keyword">(</span><span class="string">"I"</span><span class="keyword">,</span><span class="default">$date1</span><span class="keyword">);
<br />
&nbsp; </span><span class="default">$timedifference</span><span class="keyword">+=</span><span class="default">$corr</span><span class="keyword">;
<br />
&nbsp; return </span><span class="default">$timedifference</span><span class="keyword">;
<br />
}
<br />
</span><span class="default">?&gt;
<br />
</span>
<br />
Example:
<br />

<br />
<span class="default">&lt;?php
<br />
$d1</span><span class="keyword">=</span><span class="default">mktime</span><span class="keyword">(</span><span class="default">2</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">,</span><span class="default">10</span><span class="keyword">,</span><span class="default">28</span><span class="keyword">,</span><span class="default">2007</span><span class="keyword">);
<br />
</span><span class="default">$d2</span><span class="keyword">=</span><span class="default">mktime</span><span class="keyword">(</span><span class="default">4</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">,</span><span class="default">10</span><span class="keyword">,</span><span class="default">28</span><span class="keyword">,</span><span class="default">2007</span><span class="keyword">);
<br />
</span><span class="default">$period</span><span class="keyword">=</span><span class="default">DateDiff</span><span class="keyword">(</span><span class="default">$d1</span><span class="keyword">,</span><span class="default">$d2</span><span class="keyword">);
<br />
</span><span class="default">printf</span><span class="keyword">(</span><span class="string">"&lt;br&gt;%s"</span><span class="keyword">,</span><span class="default">date</span><span class="keyword">(</span><span class="string">"I d.m.Y H:i"</span><span class="keyword">,</span><span class="default">$d1</span><span class="keyword">));
<br />
</span><span class="default">printf</span><span class="keyword">(</span><span class="string">"&lt;br&gt;%u hour"</span><span class="keyword">,</span><span class="default">$period</span><span class="keyword">/</span><span class="default">3600</span><span class="keyword">);
<br />
</span><span class="default">printf</span><span class="keyword">(</span><span class="string">"&lt;br&gt;%s"</span><span class="keyword">,</span><span class="default">date</span><span class="keyword">(</span><span class="string">"I d.m.Y H:i"</span><span class="keyword">,</span><span class="default">$d2</span><span class="keyword">));
<br />
</span><span class="default">?&gt;
<br />
</span>
<br />
Getting 2 hour instead 3.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="78570""></a>
  <div class="note">
   <strong class="user">koch.ro</strong>
   <a href="#78570" class="date">17-Oct-2007 09:42</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Not really elegant, but tells you, if your installed timezonedb is the most recent:
<br />

<br />
<span class="default">&lt;?php
<br />
</span><span class="keyword">class </span><span class="default">TestDateTimeTimezonedbVersion </span><span class="keyword">extends </span><span class="default">PHPUnit_Framework_TestCase
<br />
</span><span class="keyword">{
<br />
&nbsp;&nbsp;&nbsp; public function </span><span class="default">testTimezonedbIsMostRecent</span><span class="keyword">()
<br />
&nbsp;&nbsp;&nbsp; {
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">ini_set</span><span class="keyword">( </span><span class="string">'date.timezone'</span><span class="keyword">, </span><span class="string">'Europe/Berlin' </span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">ob_start</span><span class="keyword">();&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">phpinfo</span><span class="keyword">(</span><span class="default">INFO_MODULES</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$info </span><span class="keyword">= </span><span class="default">ob_get_contents</span><span class="keyword">();&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; 
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">ob_end_clean</span><span class="keyword">(); 
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$start </span><span class="keyword">= </span><span class="default">strpos</span><span class="keyword">( </span><span class="default">$info</span><span class="keyword">, </span><span class="string">'Timezone Database Version' </span><span class="keyword">) + </span><span class="default">29</span><span class="keyword">;
<br />

<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">assertTrue</span><span class="keyword">( </span><span class="default">FALSE </span><span class="keyword">!== </span><span class="default">$start</span><span class="keyword">, </span><span class="string">'Seems there is no timezone DB installed' </span><span class="keyword">);
<br />

<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$end&nbsp;&nbsp; </span><span class="keyword">= </span><span class="default">strpos</span><span class="keyword">( </span><span class="default">$info</span><span class="keyword">, </span><span class="string">"\n"</span><span class="keyword">, </span><span class="default">$start </span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$installedVersion </span><span class="keyword">= </span><span class="default">substr</span><span class="keyword">( </span><span class="default">$info</span><span class="keyword">, </span><span class="default">$start</span><span class="keyword">, </span><span class="default">$end </span><span class="keyword">- </span><span class="default">$start </span><span class="keyword">);
<br />

<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">exec</span><span class="keyword">( </span><span class="string">'pecl remote-info timezonedb'</span><span class="keyword">, &amp;</span><span class="default">$output </span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$availableVersion </span><span class="keyword">= </span><span class="default">substr</span><span class="keyword">( </span><span class="default">$output</span><span class="keyword">[</span><span class="default">2</span><span class="keyword">], </span><span class="default">12 </span><span class="keyword">);
<br />

<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">assertEquals</span><span class="keyword">( </span><span class="default">$availableVersion</span><span class="keyword">, </span><span class="default">$installedVersion</span><span class="keyword">, 
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="string">'The installed timezonedb is not actual. Installed: '</span><span class="keyword">.</span><span class="default">$installedVersion
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">.</span><span class="string">' available: '</span><span class="keyword">.</span><span class="default">$availableVersion
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">);
<br />
&nbsp;&nbsp;&nbsp; }
<br />
}
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="78025""></a>
  <div class="note">
   <strong class="user">aquatakat at telus dot net</strong>
   <a href="#78025" class="date">24-Sep-2007 10:25</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I wrote a simple script to format a duration in seconds. Give the function some value in seconds and it will return an array.<br />
<br />
<span class="default">&lt;?php<br />
<br />
</span><span class="keyword">function </span><span class="default">format_duration</span><span class="keyword">(</span><span class="default">$seconds</span><span class="keyword">) {<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$periods </span><span class="keyword">= array(<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="string">'centuries' </span><span class="keyword">=&gt; </span><span class="default">3155692600</span><span class="keyword">,<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="string">'decades' </span><span class="keyword">=&gt; </span><span class="default">315569260</span><span class="keyword">,<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="string">'years' </span><span class="keyword">=&gt; </span><span class="default">31556926</span><span class="keyword">,<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="string">'months' </span><span class="keyword">=&gt; </span><span class="default">2629743</span><span class="keyword">,<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="string">'weeks' </span><span class="keyword">=&gt; </span><span class="default">604800</span><span class="keyword">,<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="string">'days' </span><span class="keyword">=&gt; </span><span class="default">86400</span><span class="keyword">,<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="string">'hours' </span><span class="keyword">=&gt; </span><span class="default">3600</span><span class="keyword">,<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="string">'minutes' </span><span class="keyword">=&gt; </span><span class="default">60</span><span class="keyword">,<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="string">'seconds' </span><span class="keyword">=&gt; </span><span class="default">1<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">);<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$durations </span><span class="keyword">= array();<br />
<br />
&nbsp;&nbsp;&nbsp; foreach (</span><span class="default">$periods </span><span class="keyword">as </span><span class="default">$period </span><span class="keyword">=&gt; </span><span class="default">$seconds_in_period</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">$seconds </span><span class="keyword">&gt;= </span><span class="default">$seconds_in_period</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$durations</span><span class="keyword">[</span><span class="default">$period</span><span class="keyword">] = </span><span class="default">floor</span><span class="keyword">(</span><span class="default">$seconds </span><span class="keyword">/ </span><span class="default">$seconds_in_period</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$seconds </span><span class="keyword">-= </span><span class="default">$durations</span><span class="keyword">[</span><span class="default">$period</span><span class="keyword">] * </span><span class="default">$seconds_in_period</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; return </span><span class="default">$durations</span><span class="keyword">;<br />
<br />
}<br />
<br />
echo </span><span class="default">format_duration</span><span class="keyword">(</span><span class="default">864</span><span class="keyword">);<br />
<br />
</span><span class="comment">/*<br />
[minutes] =&gt; 14<br />
[seconds] =&gt; 24<br />
*/<br />
<br />
</span><span class="keyword">echo </span><span class="default">format_duration</span><span class="keyword">(</span><span class="default">3600</span><span class="keyword">);<br />
<br />
</span><span class="comment">/*<br />
[hours] =&gt; 1<br />
*/<br />
<br />
</span><span class="keyword">echo </span><span class="default">format_duration</span><span class="keyword">(</span><span class="default">11111111</span><span class="keyword">);<br />
<br />
</span><span class="comment">/*<br />
[months] =&gt; 4<br />
[days] =&gt; 6<br />
[hours] =&gt; 20<br />
[minutes] =&gt; 28<br />
[seconds] =&gt; 59<br />
*/<br />
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="77638""></a>
  <div class="note">
   <strong class="user">Darren Edwards</strong>
   <a href="#77638" class="date">06-Sep-2007 05:54</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I was looking for a solution where I could return the number of days, hours, Minutes and seconds between two entries in a table.<br />
DATE_DIFF is not running on my mysql server as my provider uses mysql version 4.0.25<br />
Solution was to use to days and std time functions to calculate the difference in one call.<br />
The fields stored in the table(report_table) are <br />
time(00:00:00),<br />
date(0000-00-00) and record(enum) which tells the app the type of log stored. EG start or end of a report.<br />
<br />
SELECT <br />
(TO_DAYS( `end`.`date` ) - TO_DAYS( `start`.`date` )) <br />
- <br />
( second( `end`.`time` ) + (minute( `end`.`time` )*60) + (hour( `end`.`time` )*3600) <br />
&lt;<br />
&nbsp;second( `start`.`time` ) + (minute( `start`.`time` )*60) + (hour( `start`.`time` )*3600)) <br />
AS `days` , <br />
SEC_TO_TIME( <br />
(second( `end`.`time` ) + (minute( `end`.`time` )*60) + (hour( `end`.`time` )*3600) )<br />
-<br />
(second( `start`.`time` ) + (minute( `start`.`time` )*60) + (hour( `start`.`time` )*3600) )<br />
&nbsp;) AS `hms`,<br />
`start`.`time` as `start`,<br />
`end`.`time`&nbsp; as `end`<br />
<br />
FROM `report_table` AS `start` , `report_table` AS `end` <br />
AND `start`.`record` = 'Report Begin'<br />
AND `end`.`record` = 'Report End'<br />
LIMIT 1 <br />
<br />
If there is no end of report then it will not return a result, as you would expect.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="73285""></a>
  <div class="note">
   <strong class="user">Leopoldo A dot  Oducado (poducado at comfsm dot fm)</strong>
   <a href="#73285" class="date">16-Feb-2007 04:50</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Here is my function to count the number days, weeks, months, and year. I tried it below 1970 and it works.<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">function </span><span class="default">datecal</span><span class="keyword">(</span><span class="default">$date</span><span class="keyword">,</span><span class="default">$return_value</span><span class="keyword">)<br />
{<br />
</span><span class="default">$date </span><span class="keyword">= </span><span class="default">explode</span><span class="keyword">(</span><span class="string">"/"</span><span class="keyword">, </span><span class="default">$date</span><span class="keyword">);<br />
</span><span class="default">$month_begin </span><span class="keyword">= </span><span class="default">$date</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">];<br />
</span><span class="default">$month_begin_date </span><span class="keyword">= </span><span class="default">$date</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">];<br />
</span><span class="default">$year1 </span><span class="keyword">= </span><span class="default">$date</span><span class="keyword">[</span><span class="default">2</span><span class="keyword">];<br />
</span><span class="default">$month_end </span><span class="keyword">= </span><span class="default">date</span><span class="keyword">(</span><span class="string">"n"</span><span class="keyword">);<br />
</span><span class="default">$month_end_date </span><span class="keyword">= </span><span class="default">date</span><span class="keyword">(</span><span class="string">"j"</span><span class="keyword">);<br />
</span><span class="default">$year2 </span><span class="keyword">= </span><span class="default">date</span><span class="keyword">(</span><span class="string">"Y"</span><span class="keyword">);<br />
</span><span class="default">$days_old </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">;<br />
</span><span class="default">$years_old </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">;<br />
</span><span class="default">$months_old </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">;<br />
if(</span><span class="default">$month_begin</span><span class="keyword">==</span><span class="default">12</span><span class="keyword">)<br />
{<br />
&nbsp; </span><span class="default">$month </span><span class="keyword">= </span><span class="default">1</span><span class="keyword">;<br />
&nbsp; </span><span class="default">$year </span><span class="keyword">= </span><span class="default">$year1</span><span class="keyword">+</span><span class="default">1</span><span class="keyword">;<br />
}<br />
else<br />
{<br />
&nbsp; </span><span class="default">$month </span><span class="keyword">= </span><span class="default">$month_begin</span><span class="keyword">+</span><span class="default">1</span><span class="keyword">;<br />
&nbsp; </span><span class="default">$year </span><span class="keyword">= </span><span class="default">$year1</span><span class="keyword">;<br />
}<br />
</span><span class="default">$begin_plus_days </span><span class="keyword">= </span><span class="default">cal_days_in_month</span><span class="keyword">(</span><span class="default">CAL_GREGORIAN</span><span class="keyword">, </span><span class="default">$month_begin</span><span class="keyword">, </span><span class="default">$year1</span><span class="keyword">) - </span><span class="default">$month_begin_date</span><span class="keyword">;<br />
</span><span class="default">$end_minus_days </span><span class="keyword">= </span><span class="default">cal_days_in_month</span><span class="keyword">(</span><span class="default">CAL_GREGORIAN</span><span class="keyword">, </span><span class="default">$month_end</span><span class="keyword">, </span><span class="default">$year2</span><span class="keyword">) - </span><span class="default">$month_end_date</span><span class="keyword">;<br />
while (</span><span class="default">$year </span><span class="keyword">&lt;= </span><span class="default">$year2</span><span class="keyword">) <br />
{&nbsp; &nbsp; <br />
&nbsp;&nbsp; &nbsp; if(</span><span class="default">$year </span><span class="keyword">== </span><span class="default">$year2</span><span class="keyword">)<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="default">$days_old </span><span class="keyword">= </span><span class="default">$days_old </span><span class="keyword">+ </span><span class="default">cal_days_in_month</span><span class="keyword">(</span><span class="default">CAL_GREGORIAN</span><span class="keyword">, </span><span class="default">$month</span><span class="keyword">, </span><span class="default">$year</span><span class="keyword">);&nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp;&nbsp; if(</span><span class="default">$month </span><span class="keyword">&lt; </span><span class="default">$month_end</span><span class="keyword">)<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; { <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$months_old </span><span class="keyword">= </span><span class="default">$months_old </span><span class="keyword">+ </span><span class="default">1</span><span class="keyword">;&nbsp; &nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$month </span><span class="keyword">= </span><span class="default">$month </span><span class="keyword">+ </span><span class="default">1</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; elseif (</span><span class="default">$month</span><span class="keyword">==</span><span class="default">$month_end </span><span class="keyword">and </span><span class="default">$month_end_date </span><span class="keyword">&gt;= </span><span class="default">$month_begin_date</span><span class="keyword">)<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; { <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$year </span><span class="keyword">= </span><span class="default">$year2</span><span class="keyword">+</span><span class="default">1</span><span class="keyword">;&nbsp; &nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp;&nbsp; else<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; {&nbsp; &nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$year </span><span class="keyword">= </span><span class="default">$year2</span><span class="keyword">+</span><span class="default">1</span><span class="keyword">;&nbsp; &nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; else<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; </span><span class="default">$days_old </span><span class="keyword">= </span><span class="default">$days_old </span><span class="keyword">+ </span><span class="default">cal_days_in_month</span><span class="keyword">(</span><span class="default">CAL_GREGORIAN</span><span class="keyword">, </span><span class="default">$month</span><span class="keyword">, </span><span class="default">$year</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; if (</span><span class="default">$month </span><span class="keyword">&lt;= </span><span class="default">11</span><span class="keyword">) <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$month </span><span class="keyword">= </span><span class="default">$month </span><span class="keyword">+ </span><span class="default">1</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$months_old </span><span class="keyword">= </span><span class="default">$months_old </span><span class="keyword">+ </span><span class="default">1</span><span class="keyword">;&nbsp; &nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; else<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$month </span><span class="keyword">= </span><span class="default">1</span><span class="keyword">; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$year </span><span class="keyword">= </span><span class="default">$year </span><span class="keyword">+ </span><span class="default">1</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$months_old </span><span class="keyword">= </span><span class="default">$months_old </span><span class="keyword">+ </span><span class="default">1</span><span class="keyword">;&nbsp; &nbsp; &nbsp; &nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }&nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; }<br />
}<br />
</span><span class="default">$days_old </span><span class="keyword">= (</span><span class="default">$days_old </span><span class="keyword">+ </span><span class="default">$begin_plus_days</span><span class="keyword">) - </span><span class="default">$end_minus_days</span><span class="keyword">;<br />
if(</span><span class="default">$return_value </span><span class="keyword">== </span><span class="string">"d"</span><span class="keyword">)<br />
&nbsp; { return </span><span class="default">$days_old</span><span class="keyword">; }<br />
elseif (</span><span class="default">$return_value </span><span class="keyword">== </span><span class="string">"w"</span><span class="keyword">)<br />
&nbsp; { return </span><span class="default">intval</span><span class="keyword">(</span><span class="default">$days_old</span><span class="keyword">/</span><span class="default">7</span><span class="keyword">); }<br />
elseif (</span><span class="default">$return_value </span><span class="keyword">== </span><span class="string">"m"</span><span class="keyword">)<br />
&nbsp; { return </span><span class="default">$months_old</span><span class="keyword">; }<br />
elseif (</span><span class="default">$return_value </span><span class="keyword">== </span><span class="string">"y"</span><span class="keyword">)<br />
&nbsp; { return </span><span class="default">intval</span><span class="keyword">(</span><span class="default">$months_old</span><span class="keyword">/</span><span class="default">12</span><span class="keyword">); }<br />
}<br />
<br />
echo </span><span class="default">datecal</span><span class="keyword">(</span><span class="string">"08/13/1975"</span><span class="keyword">,</span><span class="string">"m"</span><span class="keyword">);<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="72384""></a>
  <div class="note">
   <strong class="user">bgold at matrix-consultants dot com</strong>
   <a href="#72384" class="date">17-Jan-2007 02:08</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
When debugging code that stores date/time values in a database, you may find yourself wanting to know the date/time that corresponds to a given unix timestamp, or the timestamp for a given date &amp; time.
<br />

<br />
The following script will do the conversion either way.&nbsp; If you give it a numeric timestamp, it will display the corresponding date and time.&nbsp; If you give it a date and time (in almost any standard format), it will display the timestamp.
<br />

<br />
All conversions are done for your locale/time zone.
<br />

<br />
<span class="default">&lt;?php
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">while (</span><span class="default">true</span><span class="keyword">)
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; {
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// Read a line from standard in.
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">echo </span><span class="string">"enter time to convert: "</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$inline </span><span class="keyword">= </span><span class="default">fgets</span><span class="keyword">(</span><span class="default">STDIN</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$inline </span><span class="keyword">= </span><span class="default">trim</span><span class="keyword">(</span><span class="default">$inline</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">$inline </span><span class="keyword">== </span><span class="string">"" </span><span class="keyword">|| </span><span class="default">$inline </span><span class="keyword">== </span><span class="string">"."</span><span class="keyword">)
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; break;
<br />

<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// See if the line is a date.
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$pos </span><span class="keyword">= </span><span class="default">strpos</span><span class="keyword">(</span><span class="default">$inline</span><span class="keyword">, </span><span class="string">"/"</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">$pos </span><span class="keyword">=== </span><span class="default">false</span><span class="keyword">) {
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// not a date, should be an integer.
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$date </span><span class="keyword">= </span><span class="default">date</span><span class="keyword">(</span><span class="string">"m/d/Y G:i:s"</span><span class="keyword">, </span><span class="default">$inline</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; echo </span><span class="string">"int2date: </span><span class="default">$inline</span><span class="string"> -&gt; </span><span class="default">$date</span><span class="string">\n"</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; } else {
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$itime </span><span class="keyword">= </span><span class="default">strtotime</span><span class="keyword">(</span><span class="default">$inline</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; echo </span><span class="string">"date2int: </span><span class="default">$inline</span><span class="string"> -&gt; </span><span class="default">$itime</span><span class="string">\n"</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="57251""></a>
  <div class="note">
   <strong class="user">andreencinas at yahoo dot com dot br</strong>
   <a href="#57251" class="date">28-Sep-2005 02:08</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
<span class="default">&lt;?php
<br />
&nbsp;&nbsp; &nbsp; &nbsp; </span><span class="comment">//function like dateDiff Microsoft
<br />
&nbsp;&nbsp; &nbsp; &nbsp; //not error in year Bissesto
<br />

<br />
&nbsp;&nbsp; &nbsp; &nbsp; </span><span class="keyword">function </span><span class="default">dateDiff</span><span class="keyword">(</span><span class="default">$interval</span><span class="keyword">,</span><span class="default">$dateTimeBegin</span><span class="keyword">,</span><span class="default">$dateTimeEnd</span><span class="keyword">) {
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="comment">//Parse about any English textual datetime
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; //$dateTimeBegin, $dateTimeEnd
<br />

<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$dateTimeBegin</span><span class="keyword">=</span><span class="default">strtotime</span><span class="keyword">(</span><span class="default">$dateTimeBegin</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; if(</span><span class="default">$dateTimeBegin </span><span class="keyword">=== -</span><span class="default">1</span><span class="keyword">) {
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; return(</span><span class="string">"..begin date Invalid"</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; }
<br />

<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$dateTimeEnd</span><span class="keyword">=</span><span class="default">strtotime</span><span class="keyword">(</span><span class="default">$dateTimeEnd</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; if(</span><span class="default">$dateTimeEnd </span><span class="keyword">=== -</span><span class="default">1</span><span class="keyword">) {
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; return(</span><span class="string">"..end date Invalid"</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; }
<br />

<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$dif</span><span class="keyword">=</span><span class="default">$dateTimeEnd </span><span class="keyword">- </span><span class="default">$dateTimeBegin</span><span class="keyword">;
<br />

<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; switch(</span><span class="default">$interval</span><span class="keyword">) {
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; case </span><span class="string">"s"</span><span class="keyword">:</span><span class="comment">//seconds
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="keyword">return(</span><span class="default">$dif</span><span class="keyword">);
<br />

<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; case </span><span class="string">"n"</span><span class="keyword">:</span><span class="comment">//minutes
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="keyword">return(</span><span class="default">floor</span><span class="keyword">(</span><span class="default">$dif</span><span class="keyword">/</span><span class="default">60</span><span class="keyword">)); </span><span class="comment">//60s=1m
<br />

<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="keyword">case </span><span class="string">"h"</span><span class="keyword">:</span><span class="comment">//hours
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="keyword">return(</span><span class="default">floor</span><span class="keyword">(</span><span class="default">$dif</span><span class="keyword">/</span><span class="default">3600</span><span class="keyword">)); </span><span class="comment">//3600s=1h
<br />

<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="keyword">case </span><span class="string">"d"</span><span class="keyword">:</span><span class="comment">//days
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="keyword">return(</span><span class="default">floor</span><span class="keyword">(</span><span class="default">$dif</span><span class="keyword">/</span><span class="default">86400</span><span class="keyword">)); </span><span class="comment">//86400s=1d
<br />

<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="keyword">case </span><span class="string">"ww"</span><span class="keyword">:</span><span class="comment">//Week
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="keyword">return(</span><span class="default">floor</span><span class="keyword">(</span><span class="default">$dif</span><span class="keyword">/</span><span class="default">604800</span><span class="keyword">)); </span><span class="comment">//604800s=1week=1semana
<br />

<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="keyword">case </span><span class="string">"m"</span><span class="keyword">: </span><span class="comment">//similar result "m" dateDiff Microsoft
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$monthBegin</span><span class="keyword">=(</span><span class="default">date</span><span class="keyword">(</span><span class="string">"Y"</span><span class="keyword">,</span><span class="default">$dateTimeBegin</span><span class="keyword">)*</span><span class="default">12</span><span class="keyword">)+
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">date</span><span class="keyword">(</span><span class="string">"n"</span><span class="keyword">,</span><span class="default">$dateTimeBegin</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$monthEnd</span><span class="keyword">=(</span><span class="default">date</span><span class="keyword">(</span><span class="string">"Y"</span><span class="keyword">,</span><span class="default">$dateTimeEnd</span><span class="keyword">)*</span><span class="default">12</span><span class="keyword">)+
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">date</span><span class="keyword">(</span><span class="string">"n"</span><span class="keyword">,</span><span class="default">$dateTimeEnd</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$monthDiff</span><span class="keyword">=</span><span class="default">$monthEnd</span><span class="keyword">-</span><span class="default">$monthBegin</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; return(</span><span class="default">$monthDiff</span><span class="keyword">);
<br />

<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; case </span><span class="string">"yyyy"</span><span class="keyword">: </span><span class="comment">//similar result "yyyy" dateDiff Microsoft
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="keyword">return(</span><span class="default">date</span><span class="keyword">(</span><span class="string">"Y"</span><span class="keyword">,</span><span class="default">$dateTimeEnd</span><span class="keyword">) - </span><span class="default">date</span><span class="keyword">(</span><span class="string">"Y"</span><span class="keyword">,</span><span class="default">$dateTimeBegin</span><span class="keyword">));
<br />

<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; default:
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; return(</span><span class="default">floor</span><span class="keyword">(</span><span class="default">$dif</span><span class="keyword">/</span><span class="default">86400</span><span class="keyword">)); </span><span class="comment">//86400s=1d
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="keyword">}
<br />

<br />
&nbsp;&nbsp; &nbsp; &nbsp; }
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="57207""></a>
  <div class="note">
   <strong class="user">glashio at xs4all dot nl</strong>
   <a href="#57207" class="date">27-Sep-2005 09:46</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Calculate Sum BusinessDays (Mon till Fri) between two date's :<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">function </span><span class="default">businessdays</span><span class="keyword">(</span><span class="default">$begin</span><span class="keyword">, </span><span class="default">$end</span><span class="keyword">) {<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$rbegin </span><span class="keyword">= </span><span class="default">is_string</span><span class="keyword">(</span><span class="default">$begin</span><span class="keyword">) ? </span><span class="default">strtotime</span><span class="keyword">(</span><span class="default">strval</span><span class="keyword">(</span><span class="default">$begin</span><span class="keyword">)) : </span><span class="default">$begin</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$rend </span><span class="keyword">= </span><span class="default">is_string</span><span class="keyword">(</span><span class="default">$end</span><span class="keyword">) ? </span><span class="default">strtotime</span><span class="keyword">(</span><span class="default">strval</span><span class="keyword">(</span><span class="default">$end</span><span class="keyword">)) : </span><span class="default">$end</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; if (</span><span class="default">$rbegin </span><span class="keyword">&lt; </span><span class="default">0 </span><span class="keyword">|| </span><span class="default">$rend </span><span class="keyword">&lt; </span><span class="default">0</span><span class="keyword">)<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">0</span><span class="keyword">;<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$begin </span><span class="keyword">= </span><span class="default">workday</span><span class="keyword">(</span><span class="default">$rbegin</span><span class="keyword">, </span><span class="default">TRUE</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$end </span><span class="keyword">= </span><span class="default">workday</span><span class="keyword">(</span><span class="default">$rend</span><span class="keyword">, </span><span class="default">FALSE</span><span class="keyword">);<br />
<br />
&nbsp;&nbsp;&nbsp; if (</span><span class="default">$end </span><span class="keyword">&lt; </span><span class="default">$begin</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$end </span><span class="keyword">= </span><span class="default">$begin</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$begin </span><span class="keyword">= </span><span class="default">$end</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$difftime </span><span class="keyword">= </span><span class="default">$end </span><span class="keyword">- </span><span class="default">$begin</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$diffdays </span><span class="keyword">= </span><span class="default">floor</span><span class="keyword">(</span><span class="default">$difftime </span><span class="keyword">/ (</span><span class="default">24 </span><span class="keyword">* </span><span class="default">60 </span><span class="keyword">* </span><span class="default">60</span><span class="keyword">)) + </span><span class="default">1</span><span class="keyword">;<br />
<br />
&nbsp;&nbsp;&nbsp; if (</span><span class="default">$diffdays </span><span class="keyword">&lt; </span><span class="default">7</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$abegin </span><span class="keyword">= </span><span class="default">getdate</span><span class="keyword">(</span><span class="default">$rbegin</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$aend </span><span class="keyword">= </span><span class="default">getdate</span><span class="keyword">(</span><span class="default">$rend</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">$diffdays </span><span class="keyword">== </span><span class="default">1 </span><span class="keyword">&amp;&amp; (</span><span class="default">$astart</span><span class="keyword">[</span><span class="string">'wday'</span><span class="keyword">] == </span><span class="default">0 </span><span class="keyword">|| </span><span class="default">$astart</span><span class="keyword">[</span><span class="string">'wday'</span><span class="keyword">] == </span><span class="default">6</span><span class="keyword">) &amp;&amp; (</span><span class="default">$aend</span><span class="keyword">[</span><span class="string">'wday'</span><span class="keyword">] == </span><span class="default">0 </span><span class="keyword">|| </span><span class="default">$aend</span><span class="keyword">[</span><span class="string">'wday'</span><span class="keyword">] == </span><span class="default">6</span><span class="keyword">))<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">0</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$abegin </span><span class="keyword">= </span><span class="default">getdate</span><span class="keyword">(</span><span class="default">$begin</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$aend </span><span class="keyword">= </span><span class="default">getdate</span><span class="keyword">(</span><span class="default">$end</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$weekends </span><span class="keyword">= (</span><span class="default">$aend</span><span class="keyword">[</span><span class="string">'wday'</span><span class="keyword">] &lt; </span><span class="default">$abegin</span><span class="keyword">[</span><span class="string">'wday'</span><span class="keyword">]) ? </span><span class="default">1 </span><span class="keyword">: </span><span class="default">0</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; } else<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$weekends </span><span class="keyword">= </span><span class="default">floor</span><span class="keyword">(</span><span class="default">$diffdays </span><span class="keyword">/ </span><span class="default">7</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; return </span><span class="default">$diffdays </span><span class="keyword">- (</span><span class="default">$weekends </span><span class="keyword">* </span><span class="default">2</span><span class="keyword">);<br />
}<br />
<br />
function </span><span class="default">workday</span><span class="keyword">(</span><span class="default">$date</span><span class="keyword">, </span><span class="default">$begindate </span><span class="keyword">= </span><span class="default">TRUE</span><span class="keyword">) {<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$adate </span><span class="keyword">= </span><span class="default">getdate</span><span class="keyword">(</span><span class="default">$date</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$day </span><span class="keyword">= </span><span class="default">24 </span><span class="keyword">* </span><span class="default">60 </span><span class="keyword">* </span><span class="default">60</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; if (</span><span class="default">$adate</span><span class="keyword">[</span><span class="string">'wday'</span><span class="keyword">] == </span><span class="default">0</span><span class="keyword">) </span><span class="comment">// Sunday<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$date </span><span class="keyword">+= </span><span class="default">$begindate </span><span class="keyword">? </span><span class="default">$day </span><span class="keyword">: -(</span><span class="default">$day </span><span class="keyword">* </span><span class="default">2</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; elseif (</span><span class="default">$adate</span><span class="keyword">[</span><span class="string">'wday'</span><span class="keyword">] == </span><span class="default">6</span><span class="keyword">) </span><span class="comment">// Saterday<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$date </span><span class="keyword">+= </span><span class="default">$begindate </span><span class="keyword">? </span><span class="default">$day </span><span class="keyword">* </span><span class="default">2 </span><span class="keyword">: -</span><span class="default">$day</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; return </span><span class="default">$date</span><span class="keyword">;<br />
}<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="53670""></a>
  <div class="note">
   <strong class="user">daniel at globalnetstudios dot com</strong>
   <a href="#53670" class="date">08-Jun-2005 08:49</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
This dateDiff() function can take in just about any timestamp, including UNIX timestamps and anything that is accepted by strtotime(). It returns an array with the ability to split the result a couple different ways. I built this function to suffice any datediff needs I had. Hope it helps others too.<br />
<br />
<span class="default">&lt;?php<br />
&nbsp; </span><span class="comment">/********* dateDiff() function **********<br />
&nbsp;&nbsp; * returns Array of Int values for difference between two dates<br />
&nbsp;&nbsp; * $date1 &gt; $date2 --&gt; positive integers are returned<br />
&nbsp;&nbsp; * $date1 &lt; $date2 --&gt; negative integers are returned<br />
&nbsp;&nbsp; *<br />
&nbsp;&nbsp; * $split recognizes the following:<br />
&nbsp;&nbsp; *&nbsp;&nbsp; 'yw' = splits up years, weeks and days (default)<br />
&nbsp;&nbsp; *&nbsp;&nbsp; 'y'&nbsp; = splits up years and days<br />
&nbsp;&nbsp; *&nbsp;&nbsp; 'w'&nbsp; = splits up weeks and days<br />
&nbsp;&nbsp; *&nbsp;&nbsp; 'd'&nbsp; = total days<br />
&nbsp;&nbsp; *<br />
&nbsp;&nbsp; * examples:<br />
&nbsp;&nbsp; *&nbsp;&nbsp; $dif1 = dateDiff() or dateDiff('yw')<br />
&nbsp;&nbsp; *&nbsp;&nbsp; $dif2 = dateDiff('y')<br />
&nbsp;&nbsp; *&nbsp;&nbsp; $dif3 = dateDiff('w')<br />
&nbsp;&nbsp; *&nbsp;&nbsp; $dif4 = dateDiff('d')<br />
&nbsp;&nbsp; *<br />
&nbsp;&nbsp; * assuming dateDiff returned 853 days, the above<br />
&nbsp;&nbsp; * examples would have a print_r output of:<br />
&nbsp;&nbsp; *&nbsp;&nbsp; $dif1 == Array( [y] =&gt; 2 [w] =&gt; 17 [d] =&gt; 4 )<br />
&nbsp;&nbsp; *&nbsp;&nbsp; $dif2 == Array( [y] =&gt; 2 [d] =&gt; 123 )<br />
&nbsp;&nbsp; *&nbsp;&nbsp; $dif3 == Array( [w] =&gt; 121 [d] =&gt; 6 )<br />
&nbsp;&nbsp; *&nbsp;&nbsp; $dif4 == Array( [d] =&gt; 847 )<br />
&nbsp;&nbsp; *<br />
&nbsp;&nbsp; * note: [h] (hours), [m] (minutes), [s] (seconds) are always returned as elements of the Array<br />
&nbsp;&nbsp; */<br />
&nbsp; </span><span class="keyword">function </span><span class="default">dateDiff</span><span class="keyword">(</span><span class="default">$dt1</span><span class="keyword">, </span><span class="default">$dt2</span><span class="keyword">, </span><span class="default">$split</span><span class="keyword">=</span><span class="string">'yw'</span><span class="keyword">) {<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$date1 </span><span class="keyword">= (</span><span class="default">strtotime</span><span class="keyword">(</span><span class="default">$dt1</span><span class="keyword">) != -</span><span class="default">1</span><span class="keyword">) ? </span><span class="default">strtotime</span><span class="keyword">(</span><span class="default">$dt1</span><span class="keyword">) : </span><span class="default">$dt1</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$date2 </span><span class="keyword">= (</span><span class="default">strtotime</span><span class="keyword">(</span><span class="default">$dt2</span><span class="keyword">) != -</span><span class="default">1</span><span class="keyword">) ? </span><span class="default">strtotime</span><span class="keyword">(</span><span class="default">$dt2</span><span class="keyword">) : </span><span class="default">$dt2</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$dtDiff </span><span class="keyword">= </span><span class="default">$date1 </span><span class="keyword">- </span><span class="default">$date2</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$totalDays </span><span class="keyword">= </span><span class="default">intval</span><span class="keyword">(</span><span class="default">$dtDiff</span><span class="keyword">/(</span><span class="default">24</span><span class="keyword">*</span><span class="default">60</span><span class="keyword">*</span><span class="default">60</span><span class="keyword">));<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$totalSecs </span><span class="keyword">= </span><span class="default">$dtDiff</span><span class="keyword">-(</span><span class="default">$totalDays</span><span class="keyword">*</span><span class="default">24</span><span class="keyword">*</span><span class="default">60</span><span class="keyword">*</span><span class="default">60</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$dif</span><span class="keyword">[</span><span class="string">'h'</span><span class="keyword">] = </span><span class="default">$h </span><span class="keyword">= </span><span class="default">intval</span><span class="keyword">(</span><span class="default">$totalSecs</span><span class="keyword">/(</span><span class="default">60</span><span class="keyword">*</span><span class="default">60</span><span class="keyword">));<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$dif</span><span class="keyword">[</span><span class="string">'m'</span><span class="keyword">] = </span><span class="default">$m </span><span class="keyword">= </span><span class="default">intval</span><span class="keyword">((</span><span class="default">$totalSecs</span><span class="keyword">-(</span><span class="default">$h</span><span class="keyword">*</span><span class="default">60</span><span class="keyword">*</span><span class="default">60</span><span class="keyword">))/</span><span class="default">60</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$dif</span><span class="keyword">[</span><span class="string">'s'</span><span class="keyword">] = </span><span class="default">$totalSecs</span><span class="keyword">-(</span><span class="default">$h</span><span class="keyword">*</span><span class="default">60</span><span class="keyword">*</span><span class="default">60</span><span class="keyword">)-(</span><span class="default">$m</span><span class="keyword">*</span><span class="default">60</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">// set up array as necessary<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">switch(</span><span class="default">$split</span><span class="keyword">) {<br />
&nbsp;&nbsp;&nbsp; case </span><span class="string">'yw'</span><span class="keyword">: </span><span class="comment"># split years-weeks-days<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="default">$dif</span><span class="keyword">[</span><span class="string">'y'</span><span class="keyword">] = </span><span class="default">$y </span><span class="keyword">= </span><span class="default">intval</span><span class="keyword">(</span><span class="default">$totalDays</span><span class="keyword">/</span><span class="default">365</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="default">$dif</span><span class="keyword">[</span><span class="string">'w'</span><span class="keyword">] = </span><span class="default">$w </span><span class="keyword">= </span><span class="default">intval</span><span class="keyword">((</span><span class="default">$totalDays</span><span class="keyword">-(</span><span class="default">$y</span><span class="keyword">*</span><span class="default">365</span><span class="keyword">))/</span><span class="default">7</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="default">$dif</span><span class="keyword">[</span><span class="string">'d'</span><span class="keyword">] = </span><span class="default">$totalDays</span><span class="keyword">-(</span><span class="default">$y</span><span class="keyword">*</span><span class="default">365</span><span class="keyword">)-(</span><span class="default">$w</span><span class="keyword">*</span><span class="default">7</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp;&nbsp; break;<br />
&nbsp;&nbsp;&nbsp; case </span><span class="string">'y'</span><span class="keyword">: </span><span class="comment"># split years-days<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="default">$dif</span><span class="keyword">[</span><span class="string">'y'</span><span class="keyword">] = </span><span class="default">$y </span><span class="keyword">= </span><span class="default">intval</span><span class="keyword">(</span><span class="default">$totalDays</span><span class="keyword">/</span><span class="default">365</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="default">$dif</span><span class="keyword">[</span><span class="string">'d'</span><span class="keyword">] = </span><span class="default">$totalDays</span><span class="keyword">-(</span><span class="default">$y</span><span class="keyword">*</span><span class="default">365</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp;&nbsp; break;<br />
&nbsp;&nbsp;&nbsp; case </span><span class="string">'w'</span><span class="keyword">: </span><span class="comment"># split weeks-days<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="default">$dif</span><span class="keyword">[</span><span class="string">'w'</span><span class="keyword">] = </span><span class="default">$w </span><span class="keyword">= </span><span class="default">intval</span><span class="keyword">(</span><span class="default">$totalDays</span><span class="keyword">/</span><span class="default">7</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="default">$dif</span><span class="keyword">[</span><span class="string">'d'</span><span class="keyword">] = </span><span class="default">$totalDays</span><span class="keyword">-(</span><span class="default">$w</span><span class="keyword">*</span><span class="default">7</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp;&nbsp; break;<br />
&nbsp;&nbsp;&nbsp; case </span><span class="string">'d'</span><span class="keyword">: </span><span class="comment"># don't split -- total days<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="default">$dif</span><span class="keyword">[</span><span class="string">'d'</span><span class="keyword">] = </span><span class="default">$totalDays</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp;&nbsp; break;<br />
&nbsp;&nbsp;&nbsp; default:<br />
&nbsp;&nbsp; &nbsp;&nbsp; die(</span><span class="string">"Error in dateDiff(). Unrecognized \$split parameter. Valid values are 'yw', 'y', 'w', 'd'. Default is 'yw'."</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; return </span><span class="default">$dif</span><span class="keyword">;<br />
&nbsp; }<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="53587""></a>
  <div class="note">
   <strong class="user">mail at completeideas dot com</strong>
   <a href="#53587" class="date">06-Jun-2005 10:55</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
For those who are using pre MYSQL 4.1.1, you can use:<br />
<br />
TO_DAYS([Date Value 1])-TO_DAYS([Date Value 2])<br />
<br />
For the same result as:<br />
<br />
DATEDIFF([Date Value 1],[Date Value 2])</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="46427""></a>
  <div class="note">
   <strong class="user">mincklerstraat at softhome dot net</strong>
   <a href="#46427" class="date">11-Oct-2004 10:43</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Before you get too advanced using date functions, be sure also to see the calendar functions at <a href="http://www.php.net/manual/en/ref.calendar.php ." rel="nofollow" target="_blank">http://www.php.net/manual/en/ref.calendar.php .</a></span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="41495""></a>
  <div class="note">
   <strong class="user">nickaubert at america's biggest isp dot com</strong>
   <a href="#41495" class="date">12-Apr-2004 10:13</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I ran into an issue using a function that loops through an array of dates where the keys to the array are the Unix timestamp for midnight for each date.&nbsp; The loop starts at the first timestamp, then incremented by adding 86400 seconds (ie. 60 x 60 x 24).&nbsp; However, Daylight Saving Time threw off the accuracy of this loop, since certain days have a duration other than 86400 seconds.&nbsp; I worked around it by adding a couple of lines to force the timestamp to midnight at each interval.<br />
<br />
<span class="default">&lt;?php<br />
&nbsp; $ONE_DAY </span><span class="keyword">= </span><span class="default">90000</span><span class="keyword">;&nbsp;&nbsp; </span><span class="comment">// can't use 86400 because some days have one hour more or less<br />
&nbsp; </span><span class="keyword">for ( </span><span class="default">$each_timestamp </span><span class="keyword">= </span><span class="default">$start_time </span><span class="keyword">; </span><span class="default">$each_timestamp </span><span class="keyword">&lt;= </span><span class="default">$end_time </span><span class="keyword">; </span><span class="default">$each_timestamp </span><span class="keyword">+=&nbsp; </span><span class="default">$ONE_DAY</span><span class="keyword">) {<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">/*&nbsp; force midnight to compensate for daylight saving time&nbsp; */<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$this_timestamp_array </span><span class="keyword">= </span><span class="default">getdate</span><span class="keyword">( </span><span class="default">$each_timestamp </span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$each_timestamp </span><span class="keyword">= </span><span class="default">mktime </span><span class="keyword">( </span><span class="default">0 </span><span class="keyword">, </span><span class="default">0 </span><span class="keyword">, </span><span class="default">0 </span><span class="keyword">, </span><span class="default">$this_timestamp_array</span><span class="keyword">[</span><span class="default">mon</span><span class="keyword">] , </span><span class="default">$this_timestamp_array</span><span class="keyword">[</span><span class="default">mday</span><span class="keyword">] , </span><span class="default">$this_timestamp_array</span><span class="keyword">[</span><span class="default">year</span><span class="keyword">] );<br />
<br />
&nbsp;&nbsp; &nbsp; </span><span class="comment">// do some stuff...<br />
&nbsp; </span><span class="keyword">}<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="39424""></a>
  <div class="note">
   <strong class="user">php at sarge dot ch</strong>
   <a href="#39424" class="date">28-Jan-2004 01:58</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Additional thisone here (didn't test it yet but should work :D):<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="comment">/**<br />
&nbsp;* Calculates the Difference between two timestamps<br />
&nbsp;*<br />
&nbsp;* @param integer $start_timestamp<br />
&nbsp;* @param integer $end_timestamp<br />
&nbsp;* @param integer $unit (default 0)<br />
&nbsp;* @return string<br />
&nbsp;* @access public<br />
&nbsp;*/<br />
</span><span class="keyword">function </span><span class="default">dateDifference</span><span class="keyword">(</span><span class="default">$start_timestamp</span><span class="keyword">,</span><span class="default">$end_timestamp</span><span class="keyword">,</span><span class="default">$unit</span><span class="keyword">= </span><span class="default">0</span><span class="keyword">){<br />
&nbsp; </span><span class="default">$days_seconds_star</span><span class="keyword">= (</span><span class="default">23 </span><span class="keyword">* </span><span class="default">56 </span><span class="keyword">* </span><span class="default">60</span><span class="keyword">) + </span><span class="default">4.091</span><span class="keyword">; </span><span class="comment">// Star Day<br />
&nbsp; </span><span class="default">$days_seconds_sun</span><span class="keyword">= </span><span class="default">24 </span><span class="keyword">* </span><span class="default">60 </span><span class="keyword">* </span><span class="default">60</span><span class="keyword">; </span><span class="comment">// Sun Day<br />
&nbsp; </span><span class="default">$difference_seconds</span><span class="keyword">= </span><span class="default">$end_timestamp </span><span class="keyword">- </span><span class="default">$start_timestamp</span><span class="keyword">;<br />
&nbsp; switch(</span><span class="default">$unit</span><span class="keyword">){<br />
&nbsp;&nbsp;&nbsp; case </span><span class="default">3</span><span class="keyword">: </span><span class="comment">// Days<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="default">$difference_days</span><span class="keyword">= </span><span class="default">round</span><span class="keyword">((</span><span class="default">$difference_seconds </span><span class="keyword">/ </span><span class="default">$days_seconds_sun</span><span class="keyword">),</span><span class="default">2</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp;&nbsp; return </span><span class="string">'approx. '</span><span class="keyword">.</span><span class="default">$difference_hours</span><span class="keyword">.</span><span class="string">' Days'</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; case </span><span class="default">2</span><span class="keyword">: </span><span class="comment">// Hours<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="default">$difference_hours</span><span class="keyword">= </span><span class="default">round</span><span class="keyword">((</span><span class="default">$difference_seconds </span><span class="keyword">/ </span><span class="default">3600</span><span class="keyword">),</span><span class="default">2</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp;&nbsp; return </span><span class="string">'approx. '</span><span class="keyword">.</span><span class="default">$difference_hours</span><span class="keyword">.</span><span class="string">' Hours'</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; break;<br />
&nbsp;&nbsp;&nbsp; case </span><span class="default">1</span><span class="keyword">: </span><span class="comment">// Minutes<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="default">$difference_minutes</span><span class="keyword">= </span><span class="default">round</span><span class="keyword">((</span><span class="default">$difference_seconds </span><span class="keyword">/ </span><span class="default">60</span><span class="keyword">),</span><span class="default">2</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp;&nbsp; return </span><span class="string">'approx. '</span><span class="keyword">.</span><span class="default">$difference_minutes</span><span class="keyword">.</span><span class="string">' Minutes'</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; break;<br />
&nbsp;&nbsp;&nbsp; default: </span><span class="comment">// Seconds<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="keyword">if(</span><span class="default">$difference_seconds </span><span class="keyword">&gt; </span><span class="default">1</span><span class="keyword">){<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">$difference_seconds</span><span class="keyword">.</span><span class="string">' Seconds'</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp;&nbsp; else{<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">$difference_seconds</span><span class="keyword">.</span><span class="string">' Second'</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp;&nbsp; }<br />
&nbsp; }<br />
}<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="38427""></a>
  <div class="note">
   <strong class="user">php at elmegil dot net</strong>
   <a href="#38427" class="date">20-Dec-2003 07:40</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
A much easier way to do days diff is to use Julian Days from the Calendar functions:<br />
<br />
$start = gregoriantojd($smon, $sday, $syear);<br />
$end = gregoriantojd($emon, $eday, $eyear);<br />
$daysdiff = $end - $start;<br />
<br />
You can see the obvious ways to wrap a function around that.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="30468""></a>
  <div class="note">
   <strong class="user">garyc at earthling dot net</strong>
   <a href="#30468" class="date">19-Mar-2003 05:08</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I needed to calculate the week number from a given date and vice versa, where the week starts with a Monday and the first week of a year may begin the year before, if the year begins in the middle of the week (Tue-Sun). This is the way weekly magazines calculate their issue numbers.
<br />

<br />
Here are two functions that do exactly that:
<br />

<br />
Hope somebody finds this useful.
<br />

<br />
Gary
<br />

<br />
<span class="default">&lt;?php
<br />
</span><span class="comment">/*&nbsp; w e e k n u m b e r&nbsp; -------------------------------------- //
<br />
weeknumber returns a week number from a given date (&gt;1970, &lt;2030)
<br />
Wed, 2003-01-01 is in week 1
<br />
Mon, 2003-01-06 is in week 2
<br />
Wed, 2003-12-31 is in week 53, next years first week
<br />
Be careful, there are years with 53 weeks.
<br />
// ------------------------------------------------------------ */ 
<br />

<br />
</span><span class="keyword">function </span><span class="default">weeknumber </span><span class="keyword">(</span><span class="default">$y</span><span class="keyword">, </span><span class="default">$m</span><span class="keyword">, </span><span class="default">$d</span><span class="keyword">) {
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$wn </span><span class="keyword">= </span><span class="default">strftime</span><span class="keyword">(</span><span class="string">"%W"</span><span class="keyword">,</span><span class="default">mktime</span><span class="keyword">(</span><span class="default">0</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">,</span><span class="default">$m</span><span class="keyword">,</span><span class="default">$d</span><span class="keyword">,</span><span class="default">$y</span><span class="keyword">));
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$wn </span><span class="keyword">+= </span><span class="default">0</span><span class="keyword">; </span><span class="comment"># wn might be a string value
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$firstdayofyear </span><span class="keyword">= </span><span class="default">getdate</span><span class="keyword">(</span><span class="default">mktime</span><span class="keyword">(</span><span class="default">0</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">,</span><span class="default">1</span><span class="keyword">,</span><span class="default">1</span><span class="keyword">,</span><span class="default">$y</span><span class="keyword">));
<br />
&nbsp;&nbsp;&nbsp; if (</span><span class="default">$firstdayofyear</span><span class="keyword">[</span><span class="string">"wday"</span><span class="keyword">] != </span><span class="default">1</span><span class="keyword">)&nbsp; &nbsp; </span><span class="comment"># if 1/1 is not a Monday, add 1
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$wn </span><span class="keyword">+= </span><span class="default">1</span><span class="keyword">;
<br />
&nbsp;&nbsp;&nbsp; return (</span><span class="default">$wn</span><span class="keyword">);
<br />
}&nbsp; &nbsp; </span><span class="comment"># function weeknumber
<br />

<br />
/*&nbsp; d a t e f r o m w e e k&nbsp; ---------------------------------- //
<br />
From a weeknumber, calculates the corresponding date
<br />
Input: Year, weeknumber and day offset
<br />
Output: Exact date in an associative (named) array
<br />
2003, 12, 0: 2003-03-17 (a Monday)
<br />
1995,&nbsp; 53, 2: 1995-12-xx
<br />
...
<br />
// ------------------------------------------------------------ */ 
<br />

<br />
</span><span class="keyword">function </span><span class="default">datefromweek </span><span class="keyword">(</span><span class="default">$y</span><span class="keyword">, </span><span class="default">$w</span><span class="keyword">, </span><span class="default">$o</span><span class="keyword">) {
<br />

<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$days </span><span class="keyword">= (</span><span class="default">$w </span><span class="keyword">- </span><span class="default">1</span><span class="keyword">) * </span><span class="default">7 </span><span class="keyword">+ </span><span class="default">$o</span><span class="keyword">;
<br />

<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$firstdayofyear </span><span class="keyword">= </span><span class="default">getdate</span><span class="keyword">(</span><span class="default">mktime</span><span class="keyword">(</span><span class="default">0</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">,</span><span class="default">1</span><span class="keyword">,</span><span class="default">1</span><span class="keyword">,</span><span class="default">$y</span><span class="keyword">));
<br />
&nbsp;&nbsp;&nbsp; if (</span><span class="default">$firstdayofyear</span><span class="keyword">[</span><span class="string">"wday"</span><span class="keyword">] == </span><span class="default">0</span><span class="keyword">) </span><span class="default">$firstdayofyear</span><span class="keyword">[</span><span class="string">"wday"</span><span class="keyword">] += </span><span class="default">7</span><span class="keyword">; 
<br />
</span><span class="comment"># in getdate, Sunday is 0 instead of 7
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$firstmonday </span><span class="keyword">= </span><span class="default">getdate</span><span class="keyword">(</span><span class="default">mktime</span><span class="keyword">(</span><span class="default">0</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">,</span><span class="default">1</span><span class="keyword">,</span><span class="default">1</span><span class="keyword">-</span><span class="default">$firstdayofyear</span><span class="keyword">[</span><span class="string">"wday"</span><span class="keyword">]+</span><span class="default">1</span><span class="keyword">,</span><span class="default">$y</span><span class="keyword">));
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$calcdate </span><span class="keyword">= </span><span class="default">getdate</span><span class="keyword">(</span><span class="default">mktime</span><span class="keyword">(</span><span class="default">0</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">,</span><span class="default">$firstmonday</span><span class="keyword">[</span><span class="string">"mon"</span><span class="keyword">], </span><span class="default">$firstmonday</span><span class="keyword">[</span><span class="string">"mday"</span><span class="keyword">]+</span><span class="default">$days</span><span class="keyword">,</span><span class="default">$firstmonday</span><span class="keyword">[</span><span class="string">"year"</span><span class="keyword">]));
<br />

<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$date</span><span class="keyword">[</span><span class="string">"year"</span><span class="keyword">] = </span><span class="default">$calcdate</span><span class="keyword">[</span><span class="string">"year"</span><span class="keyword">];
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$date</span><span class="keyword">[</span><span class="string">"month"</span><span class="keyword">] = </span><span class="default">$calcdate</span><span class="keyword">[</span><span class="string">"mon"</span><span class="keyword">];
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$date</span><span class="keyword">[</span><span class="string">"day"</span><span class="keyword">] = </span><span class="default">$calcdate</span><span class="keyword">[</span><span class="string">"mday"</span><span class="keyword">];
<br />

<br />
&nbsp;&nbsp;&nbsp; return (</span><span class="default">$date</span><span class="keyword">);
<br />

<br />
}&nbsp; &nbsp; </span><span class="comment"># function datefromweek
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="28121""></a>
  <div class="note">
   <strong class="user">brighn (a) yahoo (.) com</strong>
   <a href="#28121" class="date">03-Jan-2003 06:46</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I needed a function that determined the last Sunday of the month. Since it's made for the website's "next meeting" announcement, it goes based on the system clock; also, if today is between Sunday and the end of the month, it figures out the last Sunday of *next* month. lastsunday() takes no arguments and returns the date as a string in the form "January 26, 2003". I could probably have streamlined this quite a bit, but at least it's transparent code. =)
<br />

<br />
<span class="default">&lt;?php
<br />
&nbsp; </span><span class="comment">/* The two functions calculate when the next meeting will
<br />
&nbsp;&nbsp; &nbsp; be, based on the assumption that the meeting will be on
<br />
&nbsp;&nbsp; &nbsp; the last Sunday of the month. */&nbsp; 
<br />

<br />
&nbsp; </span><span class="keyword">function </span><span class="default">getlast</span><span class="keyword">(</span><span class="default">$mon</span><span class="keyword">, </span><span class="default">$year</span><span class="keyword">) {
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$daysinmonth </span><span class="keyword">= array(</span><span class="default">31</span><span class="keyword">, </span><span class="default">28</span><span class="keyword">, </span><span class="default">31</span><span class="keyword">, </span><span class="default">30</span><span class="keyword">, </span><span class="default">31</span><span class="keyword">, </span><span class="default">30</span><span class="keyword">, </span><span class="default">31</span><span class="keyword">, </span><span class="default">31</span><span class="keyword">, </span><span class="default">30</span><span class="keyword">, </span><span class="default">31</span><span class="keyword">, </span><span class="default">30</span><span class="keyword">, </span><span class="default">31</span><span class="keyword">);
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$days </span><span class="keyword">= </span><span class="default">$daysinmonth</span><span class="keyword">[</span><span class="default">$mon</span><span class="keyword">-</span><span class="default">1</span><span class="keyword">];
<br />
&nbsp;&nbsp;&nbsp; if (</span><span class="default">$mon </span><span class="keyword">== </span><span class="default">2 </span><span class="keyword">&amp;&amp; (</span><span class="default">$year </span><span class="keyword">% </span><span class="default">4</span><span class="keyword">) == </span><span class="default">0 </span><span class="keyword">&amp;&amp; ((</span><span class="default">$year </span><span class="keyword">% </span><span class="default">100</span><span class="keyword">) != </span><span class="default">0 </span><span class="keyword">||
<br />
&nbsp;&nbsp;&nbsp; (</span><span class="default">$year </span><span class="keyword">% </span><span class="default">400</span><span class="keyword">) == </span><span class="default">0</span><span class="keyword">)) </span><span class="default">$days</span><span class="keyword">++;
<br />
&nbsp;&nbsp;&nbsp; if (</span><span class="default">$mon </span><span class="keyword">== </span><span class="default">2 </span><span class="keyword">&amp;&amp; (</span><span class="default">$year </span><span class="keyword">% </span><span class="default">4</span><span class="keyword">) == </span><span class="default">0 </span><span class="keyword">&amp;&amp; (</span><span class="default">$year </span><span class="keyword">% </span><span class="default">1000</span><span class="keyword">) != </span><span class="default">0</span><span class="keyword">) </span><span class="default">$days</span><span class="keyword">++;
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$lastday </span><span class="keyword">= </span><span class="default">getdate</span><span class="keyword">(</span><span class="default">mktime</span><span class="keyword">(</span><span class="default">0</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">,</span><span class="default">$mon</span><span class="keyword">,</span><span class="default">$days</span><span class="keyword">,</span><span class="default">$year</span><span class="keyword">));
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$wday </span><span class="keyword">= </span><span class="default">$lastday</span><span class="keyword">[</span><span class="string">'wday'</span><span class="keyword">];
<br />
&nbsp;&nbsp;&nbsp; return </span><span class="default">getdate</span><span class="keyword">(</span><span class="default">mktime</span><span class="keyword">(</span><span class="default">0</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">,</span><span class="default">$mon</span><span class="keyword">,</span><span class="default">$days</span><span class="keyword">-</span><span class="default">$wday</span><span class="keyword">,</span><span class="default">$year</span><span class="keyword">));
<br />
&nbsp; }
<br />

<br />
&nbsp; function </span><span class="default">lastsunday</span><span class="keyword">() {
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$today </span><span class="keyword">= </span><span class="default">getdate</span><span class="keyword">();
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$mon </span><span class="keyword">= </span><span class="default">$today</span><span class="keyword">[</span><span class="string">'mon'</span><span class="keyword">];
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$year </span><span class="keyword">= </span><span class="default">$today</span><span class="keyword">[</span><span class="string">'year'</span><span class="keyword">];
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$mday </span><span class="keyword">= </span><span class="default">$today</span><span class="keyword">[</span><span class="string">'mday'</span><span class="keyword">];
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$lastsun </span><span class="keyword">= </span><span class="default">getlast</span><span class="keyword">(</span><span class="default">$mon</span><span class="keyword">, </span><span class="default">$year</span><span class="keyword">);
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$sunday </span><span class="keyword">= </span><span class="default">$lastsun</span><span class="keyword">[</span><span class="string">'mday'</span><span class="keyword">];
<br />
&nbsp;&nbsp;&nbsp; if (</span><span class="default">$sunday </span><span class="keyword">&lt; </span><span class="default">$mday</span><span class="keyword">) {
<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="default">$mon</span><span class="keyword">++;
<br />
&nbsp;&nbsp; &nbsp;&nbsp; if (</span><span class="default">$mon </span><span class="keyword">= </span><span class="default">13</span><span class="keyword">) {
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$mon </span><span class="keyword">= </span><span class="default">1</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$year</span><span class="keyword">++;
<br />
&nbsp;&nbsp; &nbsp;&nbsp; }
<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="default">$lastsun </span><span class="keyword">= </span><span class="default">getlast</span><span class="keyword">(</span><span class="default">$mon</span><span class="keyword">, </span><span class="default">$year</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="default">$sunday </span><span class="keyword">= </span><span class="default">$lastsun</span><span class="keyword">[</span><span class="string">'mday'</span><span class="keyword">];
<br />
&nbsp;&nbsp;&nbsp; }
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$nextmeeting </span><span class="keyword">= </span><span class="default">getdate</span><span class="keyword">(</span><span class="default">mktime</span><span class="keyword">(</span><span class="default">0</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">,</span><span class="default">$mon</span><span class="keyword">,</span><span class="default">$sunday</span><span class="keyword">,</span><span class="default">$year</span><span class="keyword">));
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$month </span><span class="keyword">= </span><span class="default">$nextmeeting</span><span class="keyword">[</span><span class="string">'month'</span><span class="keyword">];
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$mday </span><span class="keyword">= </span><span class="default">$nextmeeting</span><span class="keyword">[</span><span class="string">'mday'</span><span class="keyword">];
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$year </span><span class="keyword">= </span><span class="default">$nextmeeting</span><span class="keyword">[</span><span class="string">'year'</span><span class="keyword">];
<br />
&nbsp;&nbsp;&nbsp; return </span><span class="string">"</span><span class="default">$month</span><span class="string"> </span><span class="default">$mday</span><span class="string">, </span><span class="default">$year</span><span class="string">"</span><span class="keyword">;
<br />
&nbsp; }
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="23866""></a>
  <div class="note">
   <strong class="user">nightowl at NOS-PA-M dot uk2 dot net</strong>
   <a href="#23866" class="date">30-Jul-2002 07:59</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I wanted to find all records in my database which match the current week (for a call-back function). I made up this function to find the start and end of the current week : 
<br />

<br />
<span class="default">&lt;?php
<br />
</span><span class="keyword">function </span><span class="default">week</span><span class="keyword">(</span><span class="default">$curtime</span><span class="keyword">) {
<br />
&nbsp;&nbsp;&nbsp; 
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$date_array </span><span class="keyword">= </span><span class="default">getdate </span><span class="keyword">(</span><span class="default">time</span><span class="keyword">());
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$numdays </span><span class="keyword">= </span><span class="default">$date_array</span><span class="keyword">[</span><span class="string">"wday"</span><span class="keyword">];
<br />
&nbsp;&nbsp;&nbsp; 
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$startdate </span><span class="keyword">= </span><span class="default">date</span><span class="keyword">(</span><span class="string">"Y-m-d"</span><span class="keyword">, </span><span class="default">time</span><span class="keyword">() - (</span><span class="default">$numdays </span><span class="keyword">* </span><span class="default">24</span><span class="keyword">*</span><span class="default">60</span><span class="keyword">*</span><span class="default">60</span><span class="keyword">));
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$enddate </span><span class="keyword">= </span><span class="default">date</span><span class="keyword">(</span><span class="string">"Y-m-d"</span><span class="keyword">, </span><span class="default">time</span><span class="keyword">() + ((</span><span class="default">7 </span><span class="keyword">- </span><span class="default">$numdays</span><span class="keyword">) * </span><span class="default">24</span><span class="keyword">*</span><span class="default">60</span><span class="keyword">*</span><span class="default">60</span><span class="keyword">));
<br />

<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$week</span><span class="keyword">[</span><span class="string">'start'</span><span class="keyword">] = </span><span class="default">$startdate</span><span class="keyword">;
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$week</span><span class="keyword">[</span><span class="string">'end'</span><span class="keyword">] = </span><span class="default">$enddate</span><span class="keyword">;
<br />
&nbsp;&nbsp;&nbsp; 
<br />
&nbsp;&nbsp;&nbsp; return </span><span class="default">$week</span><span class="keyword">;
<br />
&nbsp;&nbsp;&nbsp; 
<br />
}
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="18643""></a>
  <div class="note">
   <strong class="user">php-contrib at i-ps dot nospam dot net</strong>
   <a href="#18643" class="date">30-Jan-2002 03:07</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Someone may find this info of some use:<br />
<br />
Rules for calculating a leap year:<br />
<br />
1) If the year divides by 4, it is a leap year (1988, 1992, 1996 are leap years)<br />
2) Unless it divides by 100, in which case it isn't (1900 divides by 4, but was not a leap year)<br />
3) Unless it divides by 400, in which case it is actually a leap year afterall (So 2000 was a leap year).<br />
<br />
In practical terms, to work out the number of days in X years, multiply X by 365.2425, rounding DOWN to the last whole number, should give you the number of days.<br />
<br />
The result will never be more than one whole day inaccurate, as opposed to multiplying by 365, which, over more years, will create a larger and larger deficit.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="10582""></a>
  <div class="note">
   <strong class="user">th at definitynet dot com</strong>
   <a href="#10582" class="date">11-Jan-2001 08:00</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I had some problems with dates between mySQL and PHP.&nbsp; PHP had all these great date functions but I wanted to store a usable value in my database tables. In this case I was using TIMESTAMP(14)&nbsp; &lt;or 'YYYYMMDDHHMMSS'&gt;. 
<br />
This is perhaps the easiest way I have found to pull the PHP usable UNIX Datestamp from my mySQL datestamp stored in the tables:
<br />

<br />
Use the mySQL UNIX_TIMESTAMP() function in your SQL definition string. i.e.
<br />

<br />
$sql= "SELECT field1, field2, UNIX_TIMESTAMP(field3) as your_date
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; FROM your_table
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; WHERE field1 = '$value'";
<br />

<br />
The query will return a temp table with coulms "field1" "Field2" "your_date"
<br />

<br />
The "your_date" will be formatted in a UNIX TIMESTAMP!&nbsp; Now you can use the PHP date() function to spew out nice date formats.
<br />

<br />
Sample using above $sql:
<br />
20010111002747&nbsp; = Date Stored on mySQL table (TIMESTAMP(14))
<br />
979172867&nbsp; = value returned as your_date in sql stmt (UNIX_TIMESTAMP)
<br />

<br />
if we use $newdate = date("F jS, Y -- g:ia", $row["your_date"]);
<br />
&nbsp;&nbsp; --(after fetching our array from the sql results of course)--
<br />

<br />
echo "$newdate";&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; --Will produce:
<br />
January 11th, 2001 -- 12:27am
<br />

<br />
Hope this helps someone out there!</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
</div>
</div>
</div></div></body></html>
