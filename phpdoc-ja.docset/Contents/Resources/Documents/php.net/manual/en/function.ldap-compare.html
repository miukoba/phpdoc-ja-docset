<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
 <head>
  <meta http-equiv="content-type" content="text/html; CHARSET=shift-jis">
  <title>指定した DN のエントリで見付かった属性の値を比較する</title>

  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <link media="all" rel="stylesheet" type="text/css" href="style.css"/>
 </head>
 <body class="docs" class="docs"><div class="navbar navbar-fixed-top">
  <div class="navbar-inner clearfix">
    <ul class="nav" style="width: 100%">
      <li style="float: left;"><a href="function.ldap-close.html">≪ ldap_close</a></li>
      <li style="float: right;"><a href="function.ldap-connect.html">ldap_connect ≫</a></li>
    </ul>
  </div>
</div>
<div id="breadcrumbs" class="clearfix">
  <ul class="breadcrumbs-container">
    <li><a href="index.html">PHP Manual</a></li>
    <li><a href="ref.ldap.html">LDAP 関数</a></li>
    <li>指定した DN のエントリで見付かった属性の値を比較する</li>
  </ul>
</div>
<div id="layout">
  <div id="layout-content"><div id="function.ldap-compare" class="refentry">
 <div class="refnamediv">
  <h1 class="refname">ldap_compare</h1>
  <p class="verinfo">(PHP 4 &gt;= 4.0.2, PHP 5)</p><p class="refpurpose"><span class="refname">ldap_compare</span> &mdash; <span class="dc-title">指定した DN のエントリで見付かった属性の値を比較する</span></p>

 </div>
 
 <div class="refsect1 description" id="refsect1-function.ldap-compare-description">
  <h3 class="title">説明</h3>
  <div class="methodsynopsis dc-description">
   <span class="type"><a href="language.pseudo-types.html#language.types.mixed" class="type mixed">mixed</a></span> <span class="methodname"><strong>ldap_compare</strong></span>
    ( <span class="methodparam"><span class="type">resource</span> <code class="parameter">$link_identifier</code></span>
   , <span class="methodparam"><span class="type">string</span> <code class="parameter">$dn</code></span>
   , <span class="methodparam"><span class="type">string</span> <code class="parameter">$attribute</code></span>
   , <span class="methodparam"><span class="type">string</span> <code class="parameter">$value</code></span>
   )</div>

  <p class="para rdfs-comment">
   属性 <code class="parameter">attribute</code> の値 <code class="parameter">value</code>
   を、指定した LDAP ディレクトリエントリの同じ属性の値と比較します。
  </p>
 </div>


 <div class="refsect1 parameters" id="refsect1-function.ldap-compare-parameters">
  <h3 class="title">パラメータ</h3>
  <p class="para">
   <dl>

    
     <dt>
<code class="parameter">link_identifier</code></dt>

     <dd>

      <p class="para">
       <span class="function"><a href="function.ldap-connect.html" class="function">ldap_connect()</a></span> が返す LDAP リンク ID。
      </p>
     </dd>

    
    
     <dt>
<code class="parameter">dn</code></dt>

     <dd>

      <p class="para">
       LDAP エンティティの識別名。
      </p>
     </dd>

    
    
     <dt>
<code class="parameter">attribute</code></dt>

     <dd>

      <p class="para">
       属性の名前。
      </p>
     </dd>

    
    
     <dt>
<code class="parameter">value</code></dt>

     <dd>

      <p class="para">
       比較する値。
      </p>
     </dd>

    
   </dl>

  </p>
 </div>


 <div class="refsect1 returnvalues" id="refsect1-function.ldap-compare-returnvalues">
  <h3 class="title">返り値</h3>
  <p class="para">
   <code class="parameter">value</code> がマッチする場合に <strong><code>TRUE</code></strong>、その他の場合に
   <strong><code>FALSE</code></strong>、エラーの場合に -1 を返します。
  </p>
 </div>


 <div class="refsect1 examples" id="refsect1-function.ldap-compare-examples">
  <h3 class="title">例</h3>
  <p class="para">
   次の例は、指定したパスワードが DN の指定したエントリで定義された
   ものと一致するかどうかをチェックする方法を示しています。
  </p>
  <p class="para">
   <div class="example" id="example-4495">
    <p><strong>例1 パスワード確認の例</strong></p>
    <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br /><br />$ds</span><span style="color: #007700">=</span><span style="color: #0000BB">ldap_connect</span><span style="color: #007700">(</span><span style="color: #DD0000">"localhost"</span><span style="color: #007700">);&nbsp;&nbsp;</span><span style="color: #FF8000">//&nbsp;LDAP&nbsp;サーバーが同一ホストであると仮定<br /><br /></span><span style="color: #007700">if&nbsp;(</span><span style="color: #0000BB">$ds</span><span style="color: #007700">)&nbsp;{<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">//&nbsp;バインド<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">if&nbsp;(</span><span style="color: #0000BB">ldap_bind</span><span style="color: #007700">(</span><span style="color: #0000BB">$ds</span><span style="color: #007700">))&nbsp;{<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">//&nbsp;データを準備<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$dn&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #DD0000">"cn=Matti&nbsp;Meikku,&nbsp;ou=My&nbsp;Unit,&nbsp;o=My&nbsp;Company,&nbsp;c=FI"</span><span style="color: #007700">;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$value&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #DD0000">"secretpassword"</span><span style="color: #007700">;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$attr&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #DD0000">"password"</span><span style="color: #007700">;<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">//&nbsp;値を比較<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$r</span><span style="color: #007700">=</span><span style="color: #0000BB">ldap_compare</span><span style="color: #007700">(</span><span style="color: #0000BB">$ds</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$dn</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$attr</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$value</span><span style="color: #007700">);<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(</span><span style="color: #0000BB">$r&nbsp;</span><span style="color: #007700">===&nbsp;-</span><span style="color: #0000BB">1</span><span style="color: #007700">)&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;echo&nbsp;</span><span style="color: #DD0000">"Error:&nbsp;"&nbsp;</span><span style="color: #007700">.&nbsp;</span><span style="color: #0000BB">ldap_error</span><span style="color: #007700">(</span><span style="color: #0000BB">$ds</span><span style="color: #007700">);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;elseif&nbsp;(</span><span style="color: #0000BB">$r&nbsp;</span><span style="color: #007700">===&nbsp;</span><span style="color: #0000BB">true</span><span style="color: #007700">)&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;echo&nbsp;</span><span style="color: #DD0000">"Password&nbsp;correct."</span><span style="color: #007700">;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;elseif&nbsp;(</span><span style="color: #0000BB">$r&nbsp;</span><span style="color: #007700">===&nbsp;</span><span style="color: #0000BB">false</span><span style="color: #007700">)&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;echo&nbsp;</span><span style="color: #DD0000">"Wrong&nbsp;guess!&nbsp;Password&nbsp;incorrect."</span><span style="color: #007700">;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;else&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;echo&nbsp;</span><span style="color: #DD0000">"Unable&nbsp;to&nbsp;bind&nbsp;to&nbsp;LDAP&nbsp;server."</span><span style="color: #007700">;<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">ldap_close</span><span style="color: #007700">(</span><span style="color: #0000BB">$ds</span><span style="color: #007700">);<br /><br />}&nbsp;else&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;echo&nbsp;</span><span style="color: #DD0000">"Unable&nbsp;to&nbsp;connect&nbsp;to&nbsp;LDAP&nbsp;server."</span><span style="color: #007700">;<br />}<br /></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
    </div>

   </div>
  </p>
 </div>


 <div class="refsect1 notes" id="refsect1-function.ldap-compare-notes">
  <h3 class="title">注意</h3>
  <div class="warning"><strong class="warning">警告</strong>
   <p class="para">
    <span class="function"><strong>ldap_compare()</strong></span> では BINARY 値を比較することはできません!
   </p>
  </div>
 </div>


</div><div id="usernotes">
 <div class="head">
  <h3 class="title">User Contributed Notes</h3>
 </div>
<div id="allnotes">  <a name="51788""></a>
  <div class="note">
   <strong class="user">oudejans at zeelandnet dot nl</strong>
   <a href="#51788" class="date">11-Apr-2005 02:10</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
With PHP 4.3.* is Password no longer a valid attribute.. try to use userPassword</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="44453""></a>
  <div class="note">
   <strong class="user">chuck+ldap at 2006 dot snew dot com</strong>
   <a href="#44453" class="date">06-Aug-2004 07:08</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Just a side note that this is not how you'd ever AUTHENTICATE someone, just an example code.<br />
<br />
The common way to authenticate is to get the users name, use search and perhaps selection to the user to get her DN (single value) then attempt to BIND to the ldapserver using that dn and the offered password.&nbsp; If it works, then it's the right password.<br />
<br />
Note that the password offered MUST NOT BE EMPTY or many LDAPs will presume you meant to authenticate anonymously and it will succeed, leaving you thinking it's the right password.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="11009""></a>
  <div class="note">
   <strong class="user">Brian Kerhin &amp;lt;kerhin at bigfoot dot com&amp;gt;</strong>
   <a href="#11009" class="date">31-Jan-2001 03:13</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Not probably, will.&nbsp; With PHP 4.0.4 and openldap 1.2.9 this little script, even with the correct attributes for the password does not do the job.&nbsp; Would superb if it did!</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="9280""></a>
  <div class="note">
   <strong class="user">334647 at swin dot edu dot au</strong>
   <a href="#9280" class="date">26-Oct-2000 04:06</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Interesting example. Apart from the fact that very few people would allow comaprisions of the password attribute for security reasons. The attribute name of "password" does not match the usual schemas.
<br />

<br />
The usual method of user id + password verification is to attempt to bind using the supplied credentials.
<br />

<br />
Ldap compare on password values will probably fail with ns directroy server and openldap v2+ becuase of server support for password hashing.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
</div>
</div>
</div></div></body></html>
