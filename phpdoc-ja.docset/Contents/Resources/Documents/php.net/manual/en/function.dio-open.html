<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
 <head>
  <meta http-equiv="content-type" content="text/html; CHARSET=shift-jis">
  <title>C ライブラリの入出力ストリーム関数が許すよりも低レベルでファイルをオープンする
   (必要ならファイルを作成する)</title>

  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <link media="all" rel="stylesheet" type="text/css" href="style.css"/>
 </head>
 <body class="docs" class="docs"><div class="navbar navbar-fixed-top">
  <div class="navbar-inner clearfix">
    <ul class="nav" style="width: 100%">
      <li style="float: left;"><a href="function.dio-fcntl.html">≪ dio_fcntl</a></li>
      <li style="float: right;"><a href="function.dio-read.html">dio_read ≫</a></li>
    </ul>
  </div>
</div>
<div id="breadcrumbs" class="clearfix">
  <ul class="breadcrumbs-container">
    <li><a href="index.html">PHP Manual</a></li>
    <li><a href="ref.dio.html">ダイレクト IO 関数</a></li>
    <li>C ライブラリの入出力ストリーム関数が許すよりも低レベルでファイルをオープンする
   (必要ならファイルを作成する)</li>
  </ul>
</div>
<div id="layout">
  <div id="layout-content"><div id="function.dio-open" class="refentry">
 <div class="refnamediv">
  <h1 class="refname">dio_open</h1>
  <p class="verinfo">(PHP 4 &gt;= 4.2.0, PHP 5 &lt;= 5.0.5)</p><p class="refpurpose"><span class="refname">dio_open</span> &mdash; <span class="dc-title">
   C ライブラリの入出力ストリーム関数が許すよりも低レベルでファイルをオープンする
   (必要ならファイルを作成する)
  </span></p>

 </div>
 <div class="refsect1 description" id="refsect1-function.dio-open-description">
  <h3 class="title">説明</h3>
  <div class="methodsynopsis dc-description">
   <span class="type">resource</span> <span class="methodname"><strong>dio_open</strong></span>
    ( <span class="methodparam"><span class="type">string</span> <code class="parameter">$filename</code></span>
   , <span class="methodparam"><span class="type">int</span> <code class="parameter">$flags</code></span>
   [, <span class="methodparam"><span class="type">int</span> <code class="parameter">$mode</code><span class="initializer"> = 0</span></span>
   ] )</div>

  <p class="para rdfs-comment">
   <span class="function"><strong>dio_open()</strong></span> は、ファイルをオープンして
   そのファイル記述子を返します。
  </p>
 </div>

 <div class="refsect1 parameters" id="refsect1-function.dio-open-parameters">
  <h3 class="title">パラメータ</h3>
  <p class="para">
   <dl>

    
     <dt>
<code class="parameter">filename</code></dt>

     <dd>

      <p class="para">
       オープンするファイルのパス。
      </p>
     </dd>

    
    
     <dt>
<code class="parameter">flags</code></dt>

     <dd>

      <p class="para">
       <code class="parameter">flags</code> パラメータには、
       以下のフラグの組み合わせを指定します。
       この値は、<strong><code>O_RDONLY</code></strong>、<strong><code>O_WRONLY</code></strong>、
       あるいは <strong><code>O_RDWR</code></strong> のいずれかでなければなりません。
       さらに、このリストからその他の値を組み合わせることもできます。
       <ul class="itemizedlist">
        <li class="listitem">
         <p class="para">
          <strong><code>O_RDONLY</code></strong> - 読み込み専用でファイルをオープンします。
         </p>
        </li>
        <li class="listitem">
         <p class="para">
          <strong><code>O_WRONLY</code></strong> - 書き込み専用でファイルをオープンします。
         </p>
        </li>
        <li class="listitem">
         <p class="para">
          <strong><code>O_RDWR</code></strong> - 読み書き両用でファイルをオープンします。
         </p>
        </li>
        <li class="listitem">
         <p class="para">
          <strong><code>O_CREAT</code></strong> - ファイルが存在しなければ
          新しいファイルを作成します。
         </p>
        </li> 
        <li class="listitem">
         <p class="para">
          <strong><code>O_EXCL</code></strong> - <strong><code>O_CREAT</code></strong>
          および <strong><code>O_EXCL</code></strong> をともに指定すると、
          すでにファイルが存在する場合に <span class="function"><strong>dio_open()</strong></span>
          が失敗します。
         </p>
        </li> 
        <li class="listitem">
         <p class="para">
          <strong><code>O_TRUNC</code></strong> - すでにファイルが存在し、書き込み
          アクセス用にオープンされている場合、ファイルの長さをゼロに切り詰めます。
         </p>
        </li>
        <li class="listitem">
         <p class="para">
          <strong><code>O_APPEND</code></strong> - 書き込み時は、ファイルの終端に
          追記します。
         </p>
        </li>
        <li class="listitem">
         <p class="para">
          <strong><code>O_NONBLOCK</code></strong> - 非ブロッキングモードを指定します。
         </p>
        </li>
        <li class="listitem">
         <p class="para">
          <strong><code>O_NOCTTY</code></strong> - TTY デバイスファイルをオープンするときに、
          オープンしたファイルをプロセスが自動的に制御端末としないようにします。
         </p>
        </li>
       </ul>
      </p>
     </dd>

    
    
     <dt>
<code class="parameter">mode</code></dt>

     <dd>

      <p class="para">
       <code class="parameter">flags</code> が <strong><code>O_CREAT</code></strong>
       を含む場合に、<code class="parameter">mode</code> でファイルのモード
       (作成許可) を指定します。<strong><code>O_CREAT</code></strong>
       が指定されている場合には <code class="parameter">Mode</code>
       が必須となり、それ以外の場合は無視されます。
      </p>
      <p class="para">
       ファイルを作成したときに実際に設定されるモードは、プロセスの
       <em class="emphasis">umask</em> 設定によって変わります。
      </p>
     </dd>

    
   </dl>

  </p>
 </div>

 <div class="refsect1 returnvalues" id="refsect1-function.dio-open-returnvalues">
  <h3 class="title">返り値</h3>
  <p class="para">
   ファイル記述子を返します。エラー時には <strong><code>FALSE</code></strong> を返します。
  </p>
 </div>

 <div class="refsect1 examples" id="refsect1-function.dio-open-examples">
  <h3 class="title">例</h3>
  <div class="example" id="example-2422">
   <p><strong>例1 ファイル記述子をオープンする</strong></p>
   <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br /><br />$fd&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">dio_open</span><span style="color: #007700">(</span><span style="color: #DD0000">'/dev/ttyS0'</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">O_RDWR&nbsp;</span><span style="color: #007700">|&nbsp;</span><span style="color: #0000BB">O_NOCTTY&nbsp;</span><span style="color: #007700">|&nbsp;</span><span style="color: #0000BB">O_NONBLOCK</span><span style="color: #007700">);<br /><br /></span><span style="color: #0000BB">dio_close</span><span style="color: #007700">(</span><span style="color: #0000BB">$fd</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
   </div>

  </div>    
 </div>

 <div class="refsect1 seealso" id="refsect1-function.dio-open-seealso">
  <h3 class="title">参考</h3>
  <p class="para">
   <ul class="simplelist">
    <li class="member"><span class="function"><a href="function.dio-close.html" class="function" rel="rdfs-seeAlso">dio_close()</a> - fd で指定したファイル記述子を閉じる</span></li>
   </ul>
  </p>
 </div>

</div><div id="usernotes">
 <div class="head">
  <h3 class="title">User Contributed Notes</h3>
 </div>
<div id="allnotes">  <a name="108210""></a>
  <div class="note">
   <strong class="user">Anonymous</strong>
   <a href="#108210" class="date">08-Apr-2012 11:12</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
"The prominent reason" to use direct I/O is when your application provides its own cache feature, so you won't do double caching</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="96534""></a>
  <div class="note">
   <strong class="user">Marius Karthaus</strong>
   <a href="#96534" class="date">03-Mar-2010 09:02</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
One of the prominent reasons to use direct IO, is for it's ability to do actual direct IO, bypassing the operating system cache and getting the data from the disk directly.&nbsp; <br />
The flag to do that (O_DIRECT) is missing from the documentation above. Maybe for good reasons, because this type of IO only works on blockdevices, not on files, and should only be used if you are **really** sure what you are doing.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="49317""></a>
  <div class="note">
   <strong class="user">j at pureftpd dot org</strong>
   <a href="#49317" class="date">24-Jan-2005 01:13</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Please note that dio_open()/dio_write()/dio_close() is *faster* than fopen()/fwrite()/fclose() for files.<br />
<br />
fwrite() has to manage a 8k buffer, while dio_write() just issue a single write(). The end result is less system calls and less memory access.<br />
<br />
Also, giving the full size to write() as with dio_write() let filesystems properly use preallocation in order to avoid fragmentation.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="30570""></a>
  <div class="note">
   <strong class="user">alla at cyber dot com dot au</strong>
   <a href="#30570" class="date">22-Mar-2003 04:16</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
To specify a combination of flags you OR them together.
<br />
This was the only way I could get it to append:
<br />

<br />
$fd = dio_open($file, O_WRONLY | O_APPEND);</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
</div>
</div>
</div></div></body></html>
