<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
 <head>
  <meta http-equiv="content-type" content="text/html; CHARSET=shift-jis">
  <title>無名関数</title>

  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <link media="all" rel="stylesheet" type="text/css" href="style.css"/>
 </head>
 <body class="docs" class="docs"><div class="navbar navbar-fixed-top">
  <div class="navbar-inner clearfix">
    <ul class="nav" style="width: 100%">
      <li style="float: left;"><a href="functions.internal.html">≪ 内部（ビルトイン）関数</a></li>
      <li style="float: right;"><a href="language.oop5.html">クラスとオブジェクト ≫</a></li>
    </ul>
  </div>
</div>
<div id="breadcrumbs" class="clearfix">
  <ul class="breadcrumbs-container">
    <li><a href="index.html">PHP Manual</a></li>
    <li><a href="language.functions.html">関数</a></li>
    <li>無名関数</li>
  </ul>
</div>
<div id="layout">
  <div id="layout-content"><div id="functions.anonymous" class="sect1">
   <h2 class="title">無名関数</h2>

   <p class="simpara">
    無名関数は<em>クロージャ</em>とも呼ばれ、
    関数名を指定せずに関数を作成できるようにするものです。
    <a href="language.pseudo-types.html#language.types.callback" class="link">コールバック</a>
    パラメータとして使う際に便利ですが、用途はそれにとどまりません。
   </p>

   <div class="example" id="example-184">
    <p><strong>例1 無名関数の例</strong></p>
    <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br /></span><span style="color: #007700">echo&nbsp;</span><span style="color: #0000BB">preg_replace_callback</span><span style="color: #007700">(</span><span style="color: #DD0000">'~-([a-z])~'</span><span style="color: #007700">,&nbsp;function&nbsp;(</span><span style="color: #0000BB">$match</span><span style="color: #007700">)&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;</span><span style="color: #0000BB">strtoupper</span><span style="color: #007700">(</span><span style="color: #0000BB">$match</span><span style="color: #007700">[</span><span style="color: #0000BB">1</span><span style="color: #007700">]);<br />},&nbsp;</span><span style="color: #DD0000">'hello-world'</span><span style="color: #007700">);<br /></span><span style="color: #FF8000">//&nbsp;helloWorld&nbsp;と出力します<br /></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
    </div>

   </div>

   <p class="simpara">
    クロージャは、変数の値として使用することもできます。
    PHP は、そのような記述があると自動的に内部クラス
    <a href="class.closure.html" class="classname">Closure</a> のインスタンスに変換します。
    変数へのクロージャの代入は、他の代入と同じように記述し、
    同じく最後にセミコロンをつけます。
   </p>

   <div class="example" id="example-185">
    <p><strong>例2 変数への無名関数の代入</strong></p>
    <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br />$greet&nbsp;</span><span style="color: #007700">=&nbsp;function(</span><span style="color: #0000BB">$name</span><span style="color: #007700">)<br />{<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">printf</span><span style="color: #007700">(</span><span style="color: #DD0000">"Hello&nbsp;%s\r\n"</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$name</span><span style="color: #007700">);<br />};<br /><br /></span><span style="color: #0000BB">$greet</span><span style="color: #007700">(</span><span style="color: #DD0000">'World'</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">$greet</span><span style="color: #007700">(</span><span style="color: #DD0000">'PHP'</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
    </div>

   </div>
   
   <p class="simpara">
    クロージャは、変数を親のスコープから引き継ぐことができます。
    引き継ぐ変数は、<em>use</em> で渡さなければなりません。
    親のスコープからの変数の引き継ぎは、グローバル変数を使うのとは
    <em class="emphasis">異なります</em>。グローバル変数は、
    関数が実行されるかどうかにかかわらずグローバルスコープに存在します。
    クロージャの親スコープは、クロージャが宣言されている関数です
    (関数の呼び出し元のスコープである必要はありません)。
    次の例を参照ください。
   </p>

   <div class="example" id="example-186">
    <p><strong>例3 クロージャのスコープ</strong></p>
    <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br /></span><span style="color: #FF8000">//&nbsp;基本的なショッピングカートで、追加した商品の一覧や各商品の<br />//&nbsp;数量を表示します。カート内の商品の合計金額を計算するメソッド<br />//&nbsp;では、クロージャをコールバックとして使用します。<br /></span><span style="color: #007700">class&nbsp;</span><span style="color: #0000BB">Cart<br /></span><span style="color: #007700">{<br />&nbsp;&nbsp;&nbsp;&nbsp;const&nbsp;</span><span style="color: #0000BB">PRICE_BUTTER&nbsp;&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">1.00</span><span style="color: #007700">;<br />&nbsp;&nbsp;&nbsp;&nbsp;const&nbsp;</span><span style="color: #0000BB">PRICE_MILK&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">3.00</span><span style="color: #007700">;<br />&nbsp;&nbsp;&nbsp;&nbsp;const&nbsp;</span><span style="color: #0000BB">PRICE_EGGS&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">6.95</span><span style="color: #007700">;<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;protected&nbsp;</span><span style="color: #0000BB">$products&nbsp;</span><span style="color: #007700">=&nbsp;array();<br />&nbsp;&nbsp;&nbsp;&nbsp;<br />&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;function&nbsp;</span><span style="color: #0000BB">add</span><span style="color: #007700">(</span><span style="color: #0000BB">$product</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$quantity</span><span style="color: #007700">)<br />&nbsp;&nbsp;&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">products</span><span style="color: #007700">[</span><span style="color: #0000BB">$product</span><span style="color: #007700">]&nbsp;=&nbsp;</span><span style="color: #0000BB">$quantity</span><span style="color: #007700">;<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br />&nbsp;&nbsp;&nbsp;&nbsp;<br />&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;function&nbsp;</span><span style="color: #0000BB">getQuantity</span><span style="color: #007700">(</span><span style="color: #0000BB">$product</span><span style="color: #007700">)<br />&nbsp;&nbsp;&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;isset(</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">products</span><span style="color: #007700">[</span><span style="color: #0000BB">$product</span><span style="color: #007700">])&nbsp;?&nbsp;</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">products</span><span style="color: #007700">[</span><span style="color: #0000BB">$product</span><span style="color: #007700">]&nbsp;:<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">FALSE</span><span style="color: #007700">;<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br />&nbsp;&nbsp;&nbsp;&nbsp;<br />&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;function&nbsp;</span><span style="color: #0000BB">getTotal</span><span style="color: #007700">(</span><span style="color: #0000BB">$tax</span><span style="color: #007700">)<br />&nbsp;&nbsp;&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$total&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">0.00</span><span style="color: #007700">;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$callback&nbsp;</span><span style="color: #007700">=<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;function&nbsp;(</span><span style="color: #0000BB">$quantity</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$product</span><span style="color: #007700">)&nbsp;use&nbsp;(</span><span style="color: #0000BB">$tax</span><span style="color: #007700">,&nbsp;&amp;</span><span style="color: #0000BB">$total</span><span style="color: #007700">)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$pricePerItem&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">constant</span><span style="color: #007700">(</span><span style="color: #0000BB">__CLASS__&nbsp;</span><span style="color: #007700">.&nbsp;</span><span style="color: #DD0000">"::PRICE_"&nbsp;</span><span style="color: #007700">.<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">strtoupper</span><span style="color: #007700">(</span><span style="color: #0000BB">$product</span><span style="color: #007700">));<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$total&nbsp;</span><span style="color: #007700">+=&nbsp;(</span><span style="color: #0000BB">$pricePerItem&nbsp;</span><span style="color: #007700">*&nbsp;</span><span style="color: #0000BB">$quantity</span><span style="color: #007700">)&nbsp;*&nbsp;(</span><span style="color: #0000BB">$tax&nbsp;</span><span style="color: #007700">+&nbsp;</span><span style="color: #0000BB">1.0</span><span style="color: #007700">);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;};<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">array_walk</span><span style="color: #007700">(</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">products</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$callback</span><span style="color: #007700">);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;</span><span style="color: #0000BB">round</span><span style="color: #007700">(</span><span style="color: #0000BB">$total</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">2</span><span style="color: #007700">);<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br />}<br /><br /></span><span style="color: #0000BB">$my_cart&nbsp;</span><span style="color: #007700">=&nbsp;new&nbsp;</span><span style="color: #0000BB">Cart</span><span style="color: #007700">;<br /><br /></span><span style="color: #FF8000">//&nbsp;カートに商品を追加します<br /></span><span style="color: #0000BB">$my_cart</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">add</span><span style="color: #007700">(</span><span style="color: #DD0000">'butter'</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">1</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">$my_cart</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">add</span><span style="color: #007700">(</span><span style="color: #DD0000">'milk'</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">3</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">$my_cart</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">add</span><span style="color: #007700">(</span><span style="color: #DD0000">'eggs'</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">6</span><span style="color: #007700">);<br /><br /></span><span style="color: #FF8000">//&nbsp;合計に消費税&nbsp;5%&nbsp;を付加した金額を表示します<br /></span><span style="color: #007700">print&nbsp;</span><span style="color: #0000BB">$my_cart</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">getTotal</span><span style="color: #007700">(</span><span style="color: #0000BB">0.05</span><span style="color: #007700">)&nbsp;.&nbsp;</span><span style="color: #DD0000">"\n"</span><span style="color: #007700">;<br /></span><span style="color: #FF8000">//&nbsp;結果は&nbsp;54.29&nbsp;です<br /></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
    </div>

   </div>
   
   <p class="simpara">
    無名関数の実装には <a href="class.closure.html" class="link">
    <a href="class.closure.html" class="classname">Closure</a></a> クラスを使っています。
   </p>
   
   <div class="sect2">
    <h3 class="title">変更履歴</h3>
    <p class="para">
     <table class="doctable informaltable">
      
       <thead>
        <tr>
         <th>バージョン</th>
         <th>説明</th>
        </tr>

       </thead>

       <tbody class="tbody">
        <tr>
         <td>5.4.0</td>
         <td>
          無名関数で
          <var class="varname"><var class="varname">$this</var></var> を使えるようになりました。
         </td>
        </tr>

        <tr>
         <td>5.3.0</td>
         <td>
          無名関数が使えるようになりました。
         </td>
        </tr>

       </tbody>
      
     </table>

    </p>
   </div>

   <div class="sect2">
    <h3 class="title">注意</h3>
    <blockquote class="note"><p><strong class="note">注意</strong>: 
     <span class="simpara">
      クロージャ内から <span class="function"><a href="function.func-num-args.html" class="function">func_num_args()</a></span>、
      <span class="function"><a href="function.func-get-arg.html" class="function">func_get_arg()</a></span> および <span class="function"><a href="function.func-get-args.html" class="function">func_get_args()</a></span>
      を使用することができます。
     </span>
    </p></blockquote>
   </div>

  </div><div id="usernotes">
 <div class="head">
  <h3 class="title">User Contributed Notes</h3>
 </div>
<div id="allnotes">  <a name="114546""></a>
  <div class="note">
   <strong class="user">andris at codeaid dot net</strong>
   <a href="#114546" class="date">05-Mar-2014 09:33</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Haven't seen it documented anywhere but PHP 5.4 now allows accessing private and protected members of an object if it's passed into a lambda function:<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">class </span><span class="default">Scope<br />
</span><span class="keyword">{<br />
&nbsp;&nbsp;&nbsp; protected </span><span class="default">$property </span><span class="keyword">= </span><span class="string">'default'</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">// or even<br />
&nbsp;&nbsp;&nbsp; // private $property = 'default';<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">public function </span><span class="default">run</span><span class="keyword">()<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$self </span><span class="keyword">= </span><span class="default">$this</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$func </span><span class="keyword">= function() use (</span><span class="default">$self</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$self</span><span class="keyword">-&gt;</span><span class="default">property </span><span class="keyword">= </span><span class="string">'changed'</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; };<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$func</span><span class="keyword">();<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">var_dump</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">property</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; }<br />
}<br />
<br />
</span><span class="default">$scope </span><span class="keyword">= new </span><span class="default">Scope</span><span class="keyword">();<br />
</span><span class="default">$scope</span><span class="keyword">-&gt;</span><span class="default">run</span><span class="keyword">();<br />
</span><span class="default">?&gt;<br />
</span><br />
When running the file under PHP 5.3 you get the following error message:<br />
&nbsp;* Fatal error: Cannot access protected property Scope::$property in ./file.php on line 11<br />
<br />
PHP 5.4, however, does not complain and outputs "changed" as expected. <br />
<br />
Not sure why it's like that but I suspect it has something to do with 5.4 supporting passing $this into lambda functions.<br />
<br />
Speaking of which, something to remember is that the following won't work:<br />
<span class="default">&lt;?php<br />
$func </span><span class="keyword">= function() use (</span><span class="default">$this</span><span class="keyword">) {<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">property </span><span class="keyword">= </span><span class="string">'changed'</span><span class="keyword">;<br />
};<br />
</span><span class="default">?&gt;<br />
</span>The error you'll get is:<br />
&nbsp;* PHP Fatal error:&nbsp; Cannot use $this as lexical variable in ./file.php on line 9<br />
<br />
You have to totally omit the use statement for it to work:<br />
<span class="default">&lt;?php<br />
$func </span><span class="keyword">= function() {<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">property </span><span class="keyword">= </span><span class="string">'changed'</span><span class="keyword">;<br />
};<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="114480""></a>
  <div class="note">
   <strong class="user">Victor</strong>
   <a href="#114480" class="date">25-Feb-2014 05:26</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Please note that while You can assign a closure to an array key with the method<br />
<br />
$array['key'] = function() { return $whatever; };<br />
<br />
You cannot do the same with the array assignment operator.<br />
<br />
So<br />
<br />
$array = Array(<br />
&nbsp; 'key' =&gt; function() { return $whatever; }<br />
);<br />
<br />
will NOT work.<br />
(This is indeed awkward.)</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="114433""></a>
  <div class="note">
   <strong class="user">mail at mkharitonov dot net</strong>
   <a href="#114433" class="date">20-Feb-2014 08:20</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Some comparisons of PHP and JavaScript closures.<br />
<br />
=== Example 1 (passing by value) ===<br />
PHP code:<br />
<span class="default">&lt;?php<br />
$aaa </span><span class="keyword">= </span><span class="default">111</span><span class="keyword">;<br />
</span><span class="default">$func </span><span class="keyword">= function() use(</span><span class="default">$aaa</span><span class="keyword">){ print </span><span class="default">$aaa</span><span class="keyword">; };<br />
</span><span class="default">$aaa </span><span class="keyword">= </span><span class="default">222</span><span class="keyword">;<br />
</span><span class="default">$func</span><span class="keyword">(); </span><span class="comment">// Outputs "111"<br />
</span><span class="default">?&gt;<br />
</span><br />
Similar JavaScript code:<br />
&lt;script type="text/javascript"&gt;<br />
var aaa = 111;<br />
var func = (function(aaa){ return function(){ alert(aaa); } })(aaa);<br />
aaa = 222;<br />
func(); // Outputs "111"<br />
&lt;/script&gt;<br />
<br />
Be careful, following code is not similar to previous code:<br />
&lt;script type="text/javascript"&gt;<br />
var aaa = 111;<br />
var bbb = aaa;<br />
var func = function(){ alert(bbb); };<br />
aaa = 222;<br />
func(); // Outputs "111", but only while "bbb" is not changed after function declaration<br />
<br />
// And this technique is not working in loops:<br />
var functions = [];<br />
for (var i = 0; i &lt; 2; i++)<br />
{<br />
&nbsp;&nbsp;&nbsp; var i2 = i;<br />
&nbsp;&nbsp;&nbsp; functions.push(function(){ alert(i2); });<br />
}<br />
functions[0](); // Outputs "1", wrong!<br />
functions[1](); // Outputs "1", ok<br />
&lt;/script&gt;<br />
<br />
=== Example 2 (passing by reference) ===<br />
PHP code:<br />
<span class="default">&lt;?php<br />
$aaa </span><span class="keyword">= </span><span class="default">111</span><span class="keyword">;<br />
</span><span class="default">$func </span><span class="keyword">= function() use(&amp;</span><span class="default">$aaa</span><span class="keyword">){ print </span><span class="default">$aaa</span><span class="keyword">; };<br />
</span><span class="default">$aaa </span><span class="keyword">= </span><span class="default">222</span><span class="keyword">;<br />
</span><span class="default">$func</span><span class="keyword">(); </span><span class="comment">// Outputs "222"<br />
</span><span class="default">?&gt;<br />
</span><br />
Similar JavaScript code:<br />
&lt;script type="text/javascript"&gt;<br />
var aaa = 111;<br />
var func = function(){ alert(aaa); };<br />
aaa = 222; // Outputs "222"<br />
func();<br />
&lt;/script&gt;</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="114178""></a>
  <div class="note">
   <strong class="user">jc at jmccc dot com</strong>
   <a href="#114178" class="date">21-Jan-2014 02:48</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
In 5.3, $this cannot be used in an anonymous function, though you can simply assign $this to another variable and pass that into the function in the use section, This quick and dirty hack works for at least calling public functions and accessing public variables of the parent class.<br />
<br />
<span class="default">&lt;?php<br />
<br />
</span><span class="keyword">class </span><span class="default">Example </span><span class="keyword">{<br />
&nbsp;&nbsp;&nbsp; public </span><span class="default">$blah</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; function </span><span class="default">foo</span><span class="keyword">() {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$that </span><span class="keyword">= </span><span class="default">$this</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$tmp </span><span class="keyword">= function() use (</span><span class="default">$that</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; return </span><span class="default">$that</span><span class="keyword">-&gt;</span><span class="default">blah</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">$tmp</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }<br />
}<br />
<br />
</span><span class="default">$test </span><span class="keyword">= new </span><span class="default">Example</span><span class="keyword">();<br />
</span><span class="default">$example</span><span class="keyword">-&gt;</span><span class="default">blah </span><span class="keyword">= </span><span class="string">"whatever"</span><span class="keyword">;<br />
echo </span><span class="default">$example</span><span class="keyword">-&gt;</span><span class="default">foo</span><span class="keyword">(); </span><span class="comment">// prints "whatever"</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="114079""></a>
  <div class="note">
   <strong class="user">derkontrollfreak+9hy5l at gmail dot com</strong>
   <a href="#114079" class="date">10-Jan-2014 01:41</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Beware that since PHP 5.4 registering a Closure as an object property that has been instantiated in the same object scope will create a circular reference which prevents immediate object destruction:<br />
<span class="default">&lt;?php<br />
<br />
</span><span class="keyword">class </span><span class="default">Test<br />
</span><span class="keyword">{<br />
&nbsp;&nbsp;&nbsp; private </span><span class="default">$closure</span><span class="keyword">;<br />
<br />
&nbsp;&nbsp;&nbsp; public function </span><span class="default">__construct</span><span class="keyword">()<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">closure </span><span class="keyword">= function () {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; };<br />
&nbsp;&nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp;&nbsp; public function </span><span class="default">__destruct</span><span class="keyword">()<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; echo </span><span class="string">"destructed\n"</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }<br />
}<br />
<br />
new </span><span class="default">Test</span><span class="keyword">;<br />
echo </span><span class="string">"finished\n"</span><span class="keyword">;<br />
<br />
</span><span class="comment">/*<br />
&nbsp;* Result in PHP 5.3:<br />
&nbsp;* ------------------<br />
&nbsp;* destructed<br />
&nbsp;* finished<br />
&nbsp;*<br />
&nbsp;* Result since PHP 5.4:<br />
&nbsp;* ---------------------<br />
&nbsp;* finished<br />
&nbsp;* destructed<br />
&nbsp;*/<br />
<br />
</span><span class="default">?&gt;<br />
</span><br />
To circumvent this, you can instantiate the Closure in a static method:<br />
<span class="default">&lt;?php<br />
<br />
</span><span class="keyword">public function </span><span class="default">__construct</span><span class="keyword">()<br />
{<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">closure </span><span class="keyword">= </span><span class="default">self</span><span class="keyword">::</span><span class="default">createClosure</span><span class="keyword">();<br />
}<br />
<br />
public static function </span><span class="default">createClosure</span><span class="keyword">()<br />
{<br />
&nbsp;&nbsp;&nbsp; return function () {<br />
&nbsp;&nbsp;&nbsp; };<br />
}<br />
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="113896""></a>
  <div class="note">
   <strong class="user">cHao</strong>
   <a href="#113896" class="date">14-Dec-2013 08:42</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
In case you were wondering (cause i was), anonymous functions can return references just like named functions can.&nbsp; Simply use the &amp; the same way you would for a named function...right after the `function` keyword (and right before the nonexistent name).<br />
<br />
<span class="default">&lt;?php<br />
&nbsp;&nbsp;&nbsp; $value </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$fn </span><span class="keyword">= function &amp;() use (&amp;</span><span class="default">$value</span><span class="keyword">) { return </span><span class="default">$value</span><span class="keyword">; };<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$x </span><span class="keyword">=&amp; </span><span class="default">$fn</span><span class="keyword">();<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">var_dump</span><span class="keyword">(</span><span class="default">$x</span><span class="keyword">, </span><span class="default">$value</span><span class="keyword">);&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="comment">// 'int(0)', 'int(0)'<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">++</span><span class="default">$x</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">var_dump</span><span class="keyword">(</span><span class="default">$x</span><span class="keyword">, </span><span class="default">$value</span><span class="keyword">);&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="comment">// 'int(1)', 'int(1)'</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="113753""></a>
  <div class="note">
   <strong class="user">alexander at cheprasov dot com</strong>
   <a href="#113753" class="date">26-Nov-2013 10:06</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Example: <br />
<br />
<span class="default">&lt;?php<br />
$a </span><span class="keyword">= </span><span class="default">213</span><span class="keyword">;<br />
<br />
</span><span class="default">$f </span><span class="keyword">= function() use (</span><span class="default">$a</span><span class="keyword">){<br />
&nbsp;&nbsp;&nbsp; echo </span><span class="default">$a</span><span class="keyword">;<br />
};<br />
<br />
</span><span class="default">$a </span><span class="keyword">= </span><span class="default">144</span><span class="keyword">;<br />
echo </span><span class="default">$a</span><span class="keyword">;<br />
<br />
</span><span class="default">$f</span><span class="keyword">();<br />
</span><span class="default">?&gt;<br />
</span><br />
Result: <br />
144<br />
213</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="113637""></a>
  <div class="note">
   <strong class="user">assarte dot draven at gmail dot com</strong>
   <a href="#113637" class="date">08-Nov-2013 05:51</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
You cannot use closures as a class variable member in its declaration like this:<br />
<br />
<span class="default">&lt;?php<br />
<br />
</span><span class="keyword">class </span><span class="default">foo<br />
</span><span class="keyword">{<br />
&nbsp;&nbsp;&nbsp; public </span><span class="default">$bar </span><span class="keyword">= function() {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; echo </span><span class="string">"baz"</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; };<br />
}<br />
<br />
</span><span class="default">?&gt;<br />
</span><br />
I don't know why but this will raise a<br />
Parse error: syntax error, unexpected 'function' (T_FUNCTION)<br />
<br />
(used PHP 5.4)</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="113422""></a>
  <div class="note">
   <strong class="user">rmckay at webaware dot com dot au</strong>
   <a href="#113422" class="date">09-Oct-2013 08:10</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Some hosts are installing the eAccelerator opcode cache with PHP 5.4, and current production versions of this opcode cache break closures. If you find that your nice, working closures break when you load your code to a hosted website, check for eAccelerator (e.g. by calling phpinfo() and checking the output).<br />
<br />
Simple fixes include:<br />
<br />
* disabling eAccelerator and opcode caching<br />
* replacing eAccelerator with Zend's opcache<br />
* reverting to PHP 5.3<br />
<br />
Apparently, the eAccelerator project has solved this issue, but hosts move slowly so I recommend removing eAccelerator from the equation for now.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="112335""></a>
  <div class="note">
   <strong class="user">mrdaniel619 at gmail dot com</strong>
   <a href="#112335" class="date">03-Jun-2013 03:54</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
just in case you ever want to change a member function run time<br />
<br />
<span class="default">&lt;?php <br />
<br />
</span><span class="keyword">class </span><span class="default">t<br />
</span><span class="keyword">{<br />
&nbsp;&nbsp;&nbsp; var </span><span class="default">$num</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; var </span><span class="default">$dynamic_function</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; public function </span><span class="default">dynamic_function</span><span class="keyword">()<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$func </span><span class="keyword">= </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">dynamic_function</span><span class="keyword">; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$func</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">); <br />
&nbsp;&nbsp;&nbsp; }<br />
}<br />
<br />
</span><span class="default">$p </span><span class="keyword">= new </span><span class="default">t</span><span class="keyword">();<br />
<br />
</span><span class="default">$p</span><span class="keyword">-&gt;</span><span class="default">num </span><span class="keyword">= </span><span class="default">5</span><span class="keyword">;<br />
<br />
</span><span class="default">$p</span><span class="keyword">-&gt;</span><span class="default">dynamic_function </span><span class="keyword">= function(</span><span class="default">$this_ref</span><span class="keyword">) </span><span class="comment">// param cannot be named $this<br />
</span><span class="keyword">{<br />
&nbsp;&nbsp;&nbsp; echo </span><span class="default">$this_ref</span><span class="keyword">-&gt;</span><span class="default">num</span><span class="keyword">++.</span><span class="string">'&lt;br /&gt;'</span><span class="keyword">;<br />
};<br />
<br />
</span><span class="default">$p</span><span class="keyword">-&gt;</span><span class="default">dynamic_function</span><span class="keyword">(); </span><span class="comment">// CALL YOUR DYNAMIC FUNCTION<br />
<br />
</span><span class="default">$p</span><span class="keyword">-&gt;</span><span class="default">dynamic_function </span><span class="keyword">= function(</span><span class="default">$this_ref</span><span class="keyword">) </span><span class="comment">// NEW DYNAMIC fUNCRION<br />
</span><span class="keyword">{<br />
&nbsp;&nbsp;&nbsp; echo </span><span class="default">$this_ref</span><span class="keyword">-&gt;</span><span class="default">num</span><span class="keyword">.</span><span class="string">'&lt;br /&gt;'</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$this_ref</span><span class="keyword">-&gt;</span><span class="default">num </span><span class="keyword">*= </span><span class="default">3</span><span class="keyword">;<br />
};<br />
<br />
</span><span class="default">$p</span><span class="keyword">-&gt;</span><span class="default">dynamic_function</span><span class="keyword">(); </span><span class="comment">// CALL DYNAMIC FUNCTION<br />
<br />
</span><span class="keyword">echo </span><span class="default">$p</span><span class="keyword">-&gt;</span><span class="default">num</span><span class="keyword">; </span><span class="comment">// display number<br />
<br />
</span><span class="keyword">exit;<br />
<br />
</span><span class="default">?&gt;<br />
</span><br />
output:<br />
5<br />
6<br />
18</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="112322""></a>
  <div class="note">
   <strong class="user">nbjayme at yahoo dot com</strong>
   <a href="#112322" class="date">01-Jun-2013 05:57</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
as of PHP version 5.3<br />
<br />
self::mycollection is an anonymous function array<br />
<br />
self::mycollection["funcId"]();&nbsp;&nbsp; // error unknown <br />
<br />
To fix:<br />
<br />
$theFunc = &amp; self::mycollection["funcId"];<br />
$theFunc();</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="112192""></a>
  <div class="note">
   <strong class="user">nathan at crause dot name</strong>
   <a href="#112192" class="date">16-May-2013 07:35</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
One item not mentioned anywhere is how to invoke an anonymous function "in-line".<br />
<br />
To explain what I mean, let me use an actual example. Instead of creating code like this:<br />
<span class="default">&lt;?php<br />
$wording </span><span class="keyword">= (</span><span class="default">$from </span><span class="keyword">== </span><span class="default">0 </span><span class="keyword">&amp;&amp; </span><span class="default">$to </span><span class="keyword">== </span><span class="default">0<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">? </span><span class="string">'&lt; 1 Year'<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">: (</span><span class="default">$to </span><span class="keyword">== </span><span class="default">9999<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">? (</span><span class="default">$from </span><span class="keyword">- </span><span class="default">1</span><span class="keyword">) . </span><span class="string">'+ Years'<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">: </span><span class="string">"</span><span class="default">$from</span><span class="string"> - </span><span class="default">$to</span><span class="string"> Years"</span><span class="keyword">));<br />
</span><span class="default">?&gt;<br />
</span><br />
You might, instead, want to use an anonymous function right in the assignment line. However, doing:<br />
<span class="default">&lt;?php<br />
$wording </span><span class="keyword">= function() use (</span><span class="default">$from</span><span class="keyword">, </span><span class="default">$to</span><span class="keyword">) { ... }<br />
</span><span class="default">?&gt;<br />
</span>would actually assign $wording to the Closure instance, not actually execute the function.<br />
<br />
The best way to do this that I've found is:<br />
<span class="default">&lt;?php<br />
$wording </span><span class="keyword">= </span><span class="default">call_user_func</span><span class="keyword">(function() use (</span><span class="default">$from</span><span class="keyword">, </span><span class="default">$to</span><span class="keyword">) {<br />
&nbsp;&nbsp;&nbsp; if (</span><span class="default">$from </span><span class="keyword">== </span><span class="default">0 </span><span class="keyword">&amp;&amp; </span><span class="default">$to </span><span class="keyword">== </span><span class="default">0</span><span class="keyword">) return </span><span class="string">'&lt; 1 Year'</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; if (</span><span class="default">$to </span><span class="keyword">== </span><span class="default">9999</span><span class="keyword">) return (</span><span class="default">$from </span><span class="keyword">- </span><span class="default">1</span><span class="keyword">) . </span><span class="string">'+ Years'</span><span class="keyword">;<br />
<br />
&nbsp;&nbsp;&nbsp; return </span><span class="string">"</span><span class="default">$from</span><span class="string"> - </span><span class="default">$to</span><span class="string"> Years"</span><span class="keyword">;<br />
});<br />
</span><span class="default">?&gt;<br />
</span><br />
It's a little longer than the first code sample, but I think it's more readable, and using this methodology opens up the ability to use more complex means of calculating a value without filling the variable scope with a bunch of temporary variables.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="111265""></a>
  <div class="note">
   <strong class="user">benkuhl at gmail dot com</strong>
   <a href="#111265" class="date">01-Feb-2013 01:34</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Beware of scope!&nbsp; $this refers to the class that the function was defined within.<br />
<br />
&nbsp;----------- Example #1 - Doesn't work (Notice: Undefined variable: this) ----------- <br />
<span class="default">&lt;?php<br />
<br />
$callableFunc </span><span class="keyword">= function () {<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">var_dump</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">);<br />
};<br />
<br />
</span><span class="default">call_user_func</span><span class="keyword">(</span><span class="default">$callableFunc</span><span class="keyword">);<br />
<br />
</span><span class="default">?&gt;<br />
</span><br />
&nbsp;----------- Example #2 - Doesn't work (Notice: Undefined variable: this) ----------- <br />
<span class="default">&lt;?php<br />
</span><span class="keyword">class </span><span class="default">myClass </span><span class="keyword">{<br />
&nbsp;&nbsp;&nbsp; public function </span><span class="default">execute</span><span class="keyword">(</span><span class="default">$func</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">is_callable</span><span class="keyword">(</span><span class="default">$func</span><span class="keyword">)) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">call_user_func</span><span class="keyword">(</span><span class="default">$func</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; }<br />
}<br />
<br />
</span><span class="default">$class </span><span class="keyword">= new </span><span class="default">myClass</span><span class="keyword">();<br />
</span><span class="default">$class</span><span class="keyword">-&gt;</span><span class="default">execute</span><span class="keyword">(function () {<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">var_dump</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">);<br />
});<br />
</span><span class="default">?&gt;<br />
</span><br />
&nbsp;----------- Example #3 - Works! ----------- <br />
<span class="default">&lt;?php<br />
</span><span class="keyword">class </span><span class="default">myClass </span><span class="keyword">{<br />
&nbsp;&nbsp;&nbsp; public function </span><span class="default">getMyExecutableFunction</span><span class="keyword">() {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return function () {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">var_dump</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; };<br />
&nbsp;&nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp;&nbsp; public function </span><span class="default">execute</span><span class="keyword">(</span><span class="default">$func</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">is_callable</span><span class="keyword">(</span><span class="default">$func</span><span class="keyword">)) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">call_user_func</span><span class="keyword">(</span><span class="default">$func</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; }<br />
}<br />
<br />
</span><span class="default">$class </span><span class="keyword">= new </span><span class="default">myClass</span><span class="keyword">();<br />
</span><span class="default">$class</span><span class="keyword">-&gt;</span><span class="default">execute</span><span class="keyword">(</span><span class="default">$class</span><span class="keyword">-&gt;</span><span class="default">getMyExecutableFunction</span><span class="keyword">()); </span><span class="comment">//object(myClass)[1]<br />
</span><span class="default">?&gt;<br />
</span><br />
$this is not available in a static method!</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="110962""></a>
  <div class="note">
   <strong class="user">marcellorvalle at gmail dot com</strong>
   <a href="#110962" class="date">30-Dec-2012 07:05</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I fell uncomfortable with php's way to pass callbacks ahead. It's just a personal opinion but i think the structure array($object, 'method') a little bit ugly. In some special cases i would like to do something more verbose, like that:<br />
<br />
<span class="default">&lt;?php<br />
&nbsp;&nbsp;&nbsp; $sortedArray </span><span class="keyword">= </span><span class="default">ArrayServices</span><span class="keyword">::</span><span class="default">sort</span><span class="keyword">(</span><span class="default">$arrayOfPerson</span><span class="keyword">, </span><span class="default">$sortPerson</span><span class="keyword">-&gt;</span><span class="default">byName</span><span class="keyword">);<br />
</span><span class="default">?&gt;<br />
</span><br />
Here, "$sortPerson-&gt;byName" is a pointer to a function that receives 2 instances of Person and return true if the name of the first is "bigger" than the second. "ArrayServices::sort" is a function that can sort any kind of array using different criterias, it uses the function passed on the second parameter to compare two items on the array<br />
<br />
I am able do that defining a simple abstract class which gives the ability to it's children to expose their methods as closures using __get() magic funtion.<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">abstract class </span><span class="default">ClosureExposerObject<br />
</span><span class="keyword">{<br />
&nbsp;&nbsp;&nbsp; public function </span><span class="default">__get</span><span class="keyword">(</span><span class="default">$methodName</span><span class="keyword">)<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">is_callable</span><span class="keyword">(<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; array(</span><span class="default">$this</span><span class="keyword">, </span><span class="default">$methodName</span><span class="keyword">)))<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return function() use (</span><span class="default">$methodName</span><span class="keyword">)<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$args </span><span class="keyword">= </span><span class="default">func_get_args</span><span class="keyword">(); <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">call_user_func_array</span><span class="keyword">(array(</span><span class="default">$this</span><span class="keyword">, </span><span class="default">$methodName</span><span class="keyword">), </span><span class="default">$args</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; };<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; else<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$className </span><span class="keyword">= </span><span class="default">get_class</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; throw new \</span><span class="default">BadMethodCallException</span><span class="keyword">(</span><span class="string">"</span><span class="default">$method</span><span class="string"> is not a callable at </span><span class="default">$className</span><span class="string"> class."</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; }<br />
}<br />
</span><span class="default">?&gt;<br />
</span><br />
Now it is possible to define a class SortPerson so that i could use it like in the first code snippet.<br />
<br />
<span class="default">&lt;?php<br />
<br />
</span><span class="keyword">class </span><span class="default">SortPerson </span><span class="keyword">extends </span><span class="default">ClosureExposerObject<br />
</span><span class="keyword">{<br />
&nbsp;&nbsp;&nbsp; public function </span><span class="default">byName</span><span class="keyword">(</span><span class="default">Person p1</span><span class="keyword">, </span><span class="default">Person p2</span><span class="keyword">)<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">p1</span><span class="keyword">-&gt;</span><span class="default">getName</span><span class="keyword">() &gt; </span><span class="default">p2</span><span class="keyword">-&gt;</span><span class="default">getName</span><span class="keyword">();<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; public function </span><span class="default">byAge</span><span class="keyword">(</span><span class="default">Person p1</span><span class="keyword">, </span><span class="default">Person p2</span><span class="keyword">)<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">p1</span><span class="keyword">-&gt;</span><span class="default">getAge</span><span class="keyword">() &gt; </span><span class="default">p2</span><span class="keyword">-&gt;</span><span class="default">getAge</span><span class="keyword">();<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; public function </span><span class="default">bySurName</span><span class="keyword">(</span><span class="default">Person p1</span><span class="keyword">, </span><span class="default">Person p2</span><span class="keyword">)<br />
&nbsp;&nbsp;&nbsp; (...)<br />
}<br />
<br />
</span><span class="default">?&gt;<br />
</span><br />
I just needed to extend ClosureExposerObject and do nothing more. <br />
<br />
Some observations: SortPerson is a service class but i decided not to implement it with static methods. It is a personal matter but i really dont like to implement such small classes with statics. Also i have inverted some naming conventions (class names as substantives and methods as verbs) but in some very special cases i thing that it actually helps readability.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="107949""></a>
  <div class="note">
   <strong class="user">orwellophile at phpblue dot net</strong>
   <a href="#107949" class="date">16-Mar-2012 01:42</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
You can create a dynamic method with a class, with access to member variables, with a little bit of trickery:<br />
<br />
&lt;?<br />
&nbsp;&nbsp;&nbsp; class DynamicFunction {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; var $functionPointer;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; var $mv = "The Member Variable";<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; function __construct() {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $this-&gt;functionPointer = function($arg) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return sprintf("I am the default closure, argument is %s\n", $arg);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; };<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; function changeFunction($functionSource) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $functionSource = str_replace('$this', '$_this', $functionSource);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $_this = clone $this;<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $f = '$this-&gt;functionPointer = function($arg) use ($_this) {' . PHP_EOL;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $f.= $functionSource . PHP_EOL . "};";<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; eval($f);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; function __call($method, $args) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if ( $this-&gt;{$method} instanceof Closure ) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return call_user_func_array($this-&gt;{$method},$args);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; } else {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; throw new Exception("Invalid Function");<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp;&nbsp; if (!empty($argc) &amp;&amp; !strcmp(basename($argv[0]), basename(__FILE__))) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $dfstring1 = 'return sprintf("I am dynamic function 1, argument is %s, member variables is %s\n", $arg, $this-&gt;mv);';<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $dfstring2 = 'return sprintf("I am dynamic function 2, argument is %s, member variables is %s\n", $arg, $this-&gt;mv);';<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $df = new DynamicFunction();<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $df-&gt;changeFunction($dfstring1);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; echo $df-&gt;functionPointer("Rabbit");<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $df-&gt;changeFunction($dfstring2);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $df-&gt;mv = "A different var";<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; echo $df-&gt;functionPointer("Cow");<br />
&nbsp;&nbsp;&nbsp; };<br />
?&gt;</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="107245""></a>
  <div class="note">
   <strong class="user">mike at borft dot student dot utwente dot nl</strong>
   <a href="#107245" class="date">24-Jan-2012 11:46</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Since it is possible to assign closures to class variables, it is a shame it is not possible to call them directly. ie. the following does not work:<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">class </span><span class="default">foo </span><span class="keyword">{<br />
<br />
&nbsp; public </span><span class="default">test</span><span class="keyword">;<br />
<br />
&nbsp; public function </span><span class="default">__construct</span><span class="keyword">(){<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">test </span><span class="keyword">= function(</span><span class="default">$a</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp;&nbsp; print </span><span class="string">"</span><span class="default">$a</span><span class="string">\n"</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; };<br />
&nbsp; }<br />
}<br />
<br />
</span><span class="default">$f </span><span class="keyword">= new </span><span class="default">foo</span><span class="keyword">();<br />
<br />
</span><span class="default">$f</span><span class="keyword">-&gt;</span><span class="default">test</span><span class="keyword">();<br />
</span><span class="default">?&gt;<br />
</span><br />
However, it is possible using the magic __call function:<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">class </span><span class="default">foo </span><span class="keyword">{<br />
<br />
&nbsp; public </span><span class="default">test</span><span class="keyword">;<br />
<br />
&nbsp; public function </span><span class="default">__construct</span><span class="keyword">(){<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">test </span><span class="keyword">= function(</span><span class="default">$a</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp;&nbsp; print </span><span class="string">"</span><span class="default">$a</span><span class="string">\n"</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; };<br />
&nbsp; }<br />
<br />
&nbsp; public function </span><span class="default">__call</span><span class="keyword">(</span><span class="default">$method</span><span class="keyword">, </span><span class="default">$args</span><span class="keyword">){<br />
&nbsp;&nbsp;&nbsp; if ( </span><span class="default">$this</span><span class="keyword">-&gt;{</span><span class="default">$method</span><span class="keyword">} instanceof </span><span class="default">Closure </span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp;&nbsp; return </span><span class="default">call_user_func_array</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;{</span><span class="default">$method</span><span class="keyword">},</span><span class="default">$args</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; } else {<br />
&nbsp;&nbsp; &nbsp;&nbsp; return </span><span class="default">parent</span><span class="keyword">::</span><span class="default">__call</span><span class="keyword">(</span><span class="default">$method</span><span class="keyword">, </span><span class="default">$args</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp; }<br />
}<br />
</span><span class="default">$f </span><span class="keyword">= new </span><span class="default">foo</span><span class="keyword">();<br />
</span><span class="default">$f</span><span class="keyword">-&gt;</span><span class="default">test</span><span class="keyword">();<br />
</span><span class="default">?&gt;<br />
</span>it <br />
Hope it helps someone ;)</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="105564""></a>
  <div class="note">
   <strong class="user">reinaldorock at yahoo dot com dot br</strong>
   <a href="#105564" class="date">28-Aug-2011 05:15</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Using closure to encapsulate environment<br />
<span class="default">&lt;?php<br />
&nbsp;&nbsp;&nbsp; $fib </span><span class="keyword">= function(</span><span class="default">$n</span><span class="keyword">) use(&amp;</span><span class="default">$fib</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if(</span><span class="default">$n </span><span class="keyword">== </span><span class="default">0 </span><span class="keyword">|| </span><span class="default">$n </span><span class="keyword">== </span><span class="default">1</span><span class="keyword">) return </span><span class="default">1</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">$fib</span><span class="keyword">(</span><span class="default">$n </span><span class="keyword">- </span><span class="default">1</span><span class="keyword">) + </span><span class="default">$fib</span><span class="keyword">(</span><span class="default">$n </span><span class="keyword">- </span><span class="default">2</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; };<br />
<br />
&nbsp;&nbsp; echo </span><span class="default">$fib</span><span class="keyword">(</span><span class="default">2</span><span class="keyword">) . </span><span class="string">"\n"</span><span class="keyword">; </span><span class="comment">// 2<br />
&nbsp;&nbsp; </span><span class="default">$lie </span><span class="keyword">= </span><span class="default">$fib</span><span class="keyword">;<br />
&nbsp;&nbsp; </span><span class="default">$fib </span><span class="keyword">= function(){die(</span><span class="string">'error'</span><span class="keyword">);};</span><span class="comment">//rewrite $fib variable <br />
&nbsp;&nbsp; </span><span class="keyword">echo </span><span class="default">$lie</span><span class="keyword">(</span><span class="default">5</span><span class="keyword">); </span><span class="comment">// error&nbsp;&nbsp; because $fib is referenced by closure<br />
<br />
</span><span class="default">?&gt;<br />
</span><br />
Alternative Fibonacci implementation using a self called function like javascript to encapsulate references variables.<br />
<br />
<span class="default">&lt;?php<br />
$fib </span><span class="keyword">= </span><span class="default">call_user_func</span><span class="keyword">(function(){<br />
&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$fib </span><span class="keyword">= function(</span><span class="default">$n</span><span class="keyword">) use(&amp;</span><span class="default">$fib</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if(</span><span class="default">$n </span><span class="keyword">== </span><span class="default">0 </span><span class="keyword">|| </span><span class="default">$n </span><span class="keyword">== </span><span class="default">1</span><span class="keyword">) return </span><span class="default">1</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">$fib</span><span class="keyword">(</span><span class="default">$n </span><span class="keyword">- </span><span class="default">1</span><span class="keyword">) + </span><span class="default">$fib</span><span class="keyword">(</span><span class="default">$n </span><span class="keyword">- </span><span class="default">2</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; };<br />
<br />
&nbsp;&nbsp;&nbsp; return </span><span class="default">$fib</span><span class="keyword">;<br />
});<br />
<br />
echo </span><span class="default">$fib</span><span class="keyword">(</span><span class="default">2</span><span class="keyword">) . </span><span class="string">"\n"</span><span class="keyword">;</span><span class="comment">//2<br />
</span><span class="default">$ok </span><span class="keyword">= </span><span class="default">$fib</span><span class="keyword">;<br />
<br />
</span><span class="default">$fib </span><span class="keyword">= function(){die(</span><span class="string">'error'</span><span class="keyword">)};</span><span class="comment">//rewrite $fib variable but don't referenced $fib used by closure<br />
</span><span class="keyword">echo </span><span class="default">$ok</span><span class="keyword">(</span><span class="default">5</span><span class="keyword">);</span><span class="comment">//result ok <br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="105385""></a>
  <div class="note">
   <strong class="user">ldrut</strong>
   <a href="#105385" class="date">13-Aug-2011 10:24</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
A common way to avoid contaminating Javascript global space with unneeded variables is to move the code into an immediately called anonymous closure.<br />
<br />
(function(){ ... })()<br />
<br />
The equivalent way to do that in PHP 5.3+ is<br />
<br />
call_user_func(function() use(closure-vars){ ... });</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="105261""></a>
  <div class="note">
   <strong class="user">simon at generalflows dot com</strong>
   <a href="#105261" class="date">05-Aug-2011 05:23</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
<span class="default">&lt;?php<br />
<br />
</span><span class="comment">/* <br />
&nbsp;* An example showing how to use closures to implement a Python-like decorator <br />
&nbsp;* pattern.<br />
&nbsp;*<br />
&nbsp;* My goal was that you should be able to decorate a function with any<br />
&nbsp;* other function, then call the decorated function directly: <br />
&nbsp;*<br />
&nbsp;* Define function:&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $foo = function($a, $b, $c, ...) {...}<br />
&nbsp;* Define decorator:&nbsp; &nbsp; &nbsp; &nbsp; $decorator = function($func) {...}<br />
&nbsp;* Decorate it:&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $foo = $decorator($foo)<br />
&nbsp;* Call it:&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $foo($a, $b, $c, ...)<br />
&nbsp;*<br />
&nbsp;* This example show an authentication decorator for a service, using a simple<br />
&nbsp;* mock session and mock service. <br />
&nbsp;*/<br />
&nbsp;<br />
</span><span class="default">session_start</span><span class="keyword">();<br />
<br />
</span><span class="comment">/* <br />
&nbsp;* Define an example decorator. A decorator function should take the form:<br />
&nbsp;* $decorator = function($func) {<br />
&nbsp;*&nbsp; &nbsp;&nbsp; return function() use $func) {<br />
&nbsp;*&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; // Do something, then call the decorated function when needed:<br />
&nbsp;*&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $args = func_get_args($func);<br />
&nbsp;*&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; call_user_func_array($func, $args);<br />
&nbsp;*&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; // Do something else.<br />
&nbsp;*&nbsp; &nbsp;&nbsp; };<br />
&nbsp;* };<br />
&nbsp;*/<br />
</span><span class="default">$authorise </span><span class="keyword">= function(</span><span class="default">$func</span><span class="keyword">) {<br />
&nbsp;&nbsp;&nbsp; return function() use (</span><span class="default">$func</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">$_SESSION</span><span class="keyword">[</span><span class="string">'is_authorised'</span><span class="keyword">] == </span><span class="default">true</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$args </span><span class="keyword">= </span><span class="default">func_get_args</span><span class="keyword">(</span><span class="default">$func</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">call_user_func_array</span><span class="keyword">(</span><span class="default">$func</span><span class="keyword">, </span><span class="default">$args</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; else {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; echo </span><span class="string">"Access Denied"</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; };<br />
};<br />
<br />
</span><span class="comment">/* <br />
&nbsp;* Define a function to be decorated, in this example a mock service that<br />
&nbsp;* need to be authorised. <br />
&nbsp;*/ <br />
</span><span class="default">$service </span><span class="keyword">= function(</span><span class="default">$foo</span><span class="keyword">) {<br />
&nbsp;&nbsp;&nbsp; echo </span><span class="string">"Service returns: </span><span class="default">$foo</span><span class="string">"</span><span class="keyword">;<br />
};<br />
<br />
</span><span class="comment">/* <br />
&nbsp;* Decorate it. Ensure you replace the origin function reference with the<br />
&nbsp;* decorated function; ie just $authorise($service) won't work, so do<br />
&nbsp;* $service = $authorise($service)<br />
&nbsp;*/<br />
</span><span class="default">$service </span><span class="keyword">= </span><span class="default">$authorise</span><span class="keyword">(</span><span class="default">$service</span><span class="keyword">);<br />
<br />
</span><span class="comment">/* <br />
&nbsp;* Establish mock authorisation, call the service; should get <br />
&nbsp;* 'Service returns: test 1'. <br />
&nbsp;*/<br />
</span><span class="default">$_SESSION</span><span class="keyword">[</span><span class="string">'is_authorised'</span><span class="keyword">] = </span><span class="default">true</span><span class="keyword">;<br />
</span><span class="default">$service</span><span class="keyword">(</span><span class="string">'test 1'</span><span class="keyword">);<br />
<br />
</span><span class="comment">/* <br />
&nbsp;* Remove mock authorisation, call the service; should get 'Access Denied'. <br />
&nbsp;*/<br />
</span><span class="default">$_SESSION</span><span class="keyword">[</span><span class="string">'is_authorised'</span><span class="keyword">] = </span><span class="default">false</span><span class="keyword">;<br />
</span><span class="default">$service</span><span class="keyword">(</span><span class="string">'test 2'</span><span class="keyword">);<br />
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="102785""></a>
  <div class="note">
   <strong class="user">paul at somewhere dot com</strong>
   <a href="#102785" class="date">06-Mar-2011 11:36</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I benched instantiating a function and lambda function.<br />
<br />
Functions used:<br />
<span class="default">&lt;?php<br />
<br />
</span><span class="keyword">function </span><span class="default">data</span><span class="keyword">() {<br />
&nbsp;</span><span class="default">$var </span><span class="keyword">= </span><span class="string">'hi'</span><span class="keyword">;<br />
}<br />
</span><span class="default">$lambda </span><span class="keyword">= function() {<br />
&nbsp;</span><span class="default">$var </span><span class="keyword">= </span><span class="string">'hi'</span><span class="keyword">;<br />
}<br />
<br />
</span><span class="default">?&gt;<br />
</span><br />
Bench for instantiating a function:<br />
1.692800000000000082422957 μs<br />
Bench for instantiating Lambda Function:<br />
0.906000000000000027533531 μs<br />
Bench for calling function:<br />
0.7153000000000000468958206 μs<br />
Bench for calling lambda function:<br />
0.6914000000000000145661261 μs<br />
<br />
Calling the lambda function and regular function fluctuates between .81 and .65 so they seem to be the same.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="102615""></a>
  <div class="note">
   <strong class="user">fabiolimasouto at gmail dot com</strong>
   <a href="#102615" class="date">24-Feb-2011 04:51</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
You may have been disapointed if you tried to call a closure stored in an instance variable as you would regularly do with methods:<br />
<br />
<span class="default">&lt;?php<br />
<br />
$obj </span><span class="keyword">= new </span><span class="default">StdClass</span><span class="keyword">();<br />
<br />
</span><span class="default">$obj</span><span class="keyword">-&gt;</span><span class="default">func </span><span class="keyword">= function(){<br />
&nbsp;echo </span><span class="string">"hello"</span><span class="keyword">;<br />
};<br />
<br />
</span><span class="comment">//$obj-&gt;func(); // doesn't work! php tries to match an instance method called "func" that is not defined in the original class' signature<br />
<br />
// you have to do this instead:<br />
</span><span class="default">$func </span><span class="keyword">= </span><span class="default">$obj</span><span class="keyword">-&gt;</span><span class="default">func</span><span class="keyword">;<br />
</span><span class="default">$func</span><span class="keyword">();<br />
<br />
</span><span class="comment">// or:<br />
</span><span class="default">call_user_func</span><span class="keyword">(</span><span class="default">$obj</span><span class="keyword">-&gt;</span><span class="default">func</span><span class="keyword">);<br />
<br />
</span><span class="comment">// however, you might wanna check this out:<br />
</span><span class="default">$array</span><span class="keyword">[</span><span class="string">'func'</span><span class="keyword">] = function(){<br />
&nbsp;echo </span><span class="string">"hello"</span><span class="keyword">;<br />
};<br />
<br />
</span><span class="default">$array</span><span class="keyword">[</span><span class="string">'func'</span><span class="keyword">](); </span><span class="comment">// it works! i discovered that just recently ;)<br />
</span><span class="default">?&gt;<br />
</span><br />
Now, coming back to the problem of assigning functions/methods "on the fly" to an object and being able to call them as if they were regular methods, you could trick php with this lawbreaker-code:<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">class </span><span class="default">test</span><span class="keyword">{<br />
&nbsp;private </span><span class="default">$functions </span><span class="keyword">= array();<br />
&nbsp;private </span><span class="default">$vars </span><span class="keyword">= array();<br />
&nbsp;<br />
&nbsp;function </span><span class="default">__set</span><span class="keyword">(</span><span class="default">$name</span><span class="keyword">,</span><span class="default">$data</span><span class="keyword">)<br />
&nbsp;{<br />
&nbsp; if(</span><span class="default">is_callable</span><span class="keyword">(</span><span class="default">$data</span><span class="keyword">))<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">functions</span><span class="keyword">[</span><span class="default">$name</span><span class="keyword">] = </span><span class="default">$data</span><span class="keyword">;<br />
&nbsp; else<br />
&nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">vars</span><span class="keyword">[</span><span class="default">$name</span><span class="keyword">] = </span><span class="default">$data</span><span class="keyword">;<br />
&nbsp;}<br />
&nbsp;<br />
&nbsp;function </span><span class="default">__get</span><span class="keyword">(</span><span class="default">$name</span><span class="keyword">)<br />
&nbsp;{<br />
&nbsp; if(isset(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">vars</span><span class="keyword">[</span><span class="default">$name</span><span class="keyword">]))<br />
&nbsp;&nbsp; return </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">vars</span><span class="keyword">[</span><span class="default">$name</span><span class="keyword">];<br />
&nbsp;}<br />
&nbsp;<br />
&nbsp;function </span><span class="default">__call</span><span class="keyword">(</span><span class="default">$method</span><span class="keyword">,</span><span class="default">$args</span><span class="keyword">)<br />
&nbsp;{<br />
&nbsp; if(isset(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">functions</span><span class="keyword">[</span><span class="default">$method</span><span class="keyword">]))<br />
&nbsp; {<br />
&nbsp;&nbsp; </span><span class="default">call_user_func_array</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">functions</span><span class="keyword">[</span><span class="default">$method</span><span class="keyword">],</span><span class="default">$args</span><span class="keyword">);<br />
&nbsp; } else {<br />
&nbsp;&nbsp; </span><span class="comment">// error out<br />
&nbsp; </span><span class="keyword">}<br />
&nbsp;}<br />
}<br />
<br />
</span><span class="comment">// LET'S BREAK SOME LAW NOW!<br />
</span><span class="default">$obj </span><span class="keyword">= new </span><span class="default">test</span><span class="keyword">;<br />
<br />
</span><span class="default">$obj</span><span class="keyword">-&gt;</span><span class="default">sayHelloWithMyName </span><span class="keyword">= function(</span><span class="default">$name</span><span class="keyword">){<br />
&nbsp;echo </span><span class="string">"Hello </span><span class="default">$name</span><span class="string">!"</span><span class="keyword">;<br />
};<br />
<br />
</span><span class="default">$obj</span><span class="keyword">-&gt;</span><span class="default">sayHelloWithMyName</span><span class="keyword">(</span><span class="string">'Fabio'</span><span class="keyword">); </span><span class="comment">// Hello Fabio!<br />
<br />
// THE OLD WAY (NON-CLOSURE) ALSO WORKS:<br />
<br />
</span><span class="keyword">function </span><span class="default">sayHello</span><span class="keyword">()<br />
{<br />
&nbsp;echo </span><span class="string">"Hello!"</span><span class="keyword">;<br />
}<br />
<br />
</span><span class="default">$obj</span><span class="keyword">-&gt;</span><span class="default">justSayHello </span><span class="keyword">= </span><span class="string">'sayHello'</span><span class="keyword">;<br />
</span><span class="default">$obj</span><span class="keyword">-&gt;</span><span class="default">justSayHello</span><span class="keyword">(); </span><span class="comment">// Hello!<br />
</span><span class="default">?&gt;<br />
</span><br />
NOTICE: of course this is very bad practice since you cannot refere to protected or private fields/methods inside these pseudo "methods" as they are not instance methods at all but rather ordinary functions/closures assigned to the object's instance variables "on the fly". But I hope you've enjoyed the jurney ;)</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="102445""></a>
  <div class="note">
   <strong class="user">Suman Madavapeddi.</strong>
   <a href="#102445" class="date">15-Feb-2011 02:31</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
These&nbsp; Closures are really interesting to me .This would be helpful.
<br />
<span class="default">&lt;?php
<br />
</span><span class="keyword">Class </span><span class="default">Operations</span><span class="keyword">{
<br />
&nbsp;&nbsp;&nbsp; public function </span><span class="default">ops</span><span class="keyword">(</span><span class="default">$x</span><span class="keyword">,</span><span class="default">$y</span><span class="keyword">,</span><span class="default">$op</span><span class="keyword">){
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; switch (</span><span class="default">$op</span><span class="keyword">){
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; case </span><span class="string">'ADD'</span><span class="keyword">:return function() use(</span><span class="default">$x</span><span class="keyword">,</span><span class="default">$y</span><span class="keyword">){
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">$x</span><span class="keyword">+</span><span class="default">$y</span><span class="keyword">.</span><span class="string">"&lt;br&gt;"</span><span class="keyword">;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; };
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; break;
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; case </span><span class="string">'SUB'</span><span class="keyword">: return function() use (</span><span class="default">$x</span><span class="keyword">,</span><span class="default">$y</span><span class="keyword">){
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">$x</span><span class="keyword">-</span><span class="default">$y</span><span class="keyword">.</span><span class="string">"&lt;br&gt;"</span><span class="keyword">;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; };
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; break;
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; default:&nbsp; &nbsp; return function(){
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="string">"Operation is not supported by class"</span><span class="keyword">.</span><span class="string">"&lt;br&gt;"</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; };
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
<br />
&nbsp;&nbsp;&nbsp; }
<br />
}
<br />

<br />
</span><span class="default">$op </span><span class="keyword">=&nbsp; new </span><span class="default">Operations</span><span class="keyword">();
<br />
</span><span class="default">$fn1 </span><span class="keyword">= </span><span class="default">$op</span><span class="keyword">-&gt;</span><span class="default">ops</span><span class="keyword">(</span><span class="default">6</span><span class="keyword">,</span><span class="default">7</span><span class="keyword">,</span><span class="string">'ADD'</span><span class="keyword">);
<br />
echo </span><span class="default">$fn1</span><span class="keyword">();
<br />

<br />
</span><span class="default">$fn2 </span><span class="keyword">= </span><span class="default">$op</span><span class="keyword">-&gt;</span><span class="default">ops</span><span class="keyword">(</span><span class="default">6</span><span class="keyword">,</span><span class="default">2</span><span class="keyword">,</span><span class="string">'SUB'</span><span class="keyword">);
<br />
echo </span><span class="default">$fn2</span><span class="keyword">();
<br />

<br />
</span><span class="default">$fn2 </span><span class="keyword">= </span><span class="default">$op</span><span class="keyword">-&gt;</span><span class="default">ops</span><span class="keyword">(</span><span class="default">6</span><span class="keyword">,</span><span class="default">7</span><span class="keyword">,</span><span class="string">'MUL'</span><span class="keyword">);
<br />
echo </span><span class="default">$fn2</span><span class="keyword">();
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="100649""></a>
  <div class="note">
   <strong class="user">Anonymous</strong>
   <a href="#100649" class="date">28-Oct-2010 09:54</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
use() parameters are early binding - they use the variable's value at the point where the lambda function is declared, rather than the point where the lambda function is called (late binding).<br />
<br />
If you want late binding put &amp; before the variable inside use()<br />
<span class="default">&lt;?php<br />
$fn </span><span class="keyword">= function () use (&amp;</span><span class="default">$var</span><span class="keyword">) { echo </span><span class="default">$var</span><span class="keyword">; };<br />
</span><span class="default">?&gt;<br />
</span>Examples:<br />
<span class="default">&lt;?php<br />
</span><span class="comment">// problem 1: this should echo "Canada", not a php notice<br />
</span><span class="default">$fn </span><span class="keyword">= function () use (</span><span class="default">$country</span><span class="keyword">) { echo </span><span class="default">$country </span><span class="keyword">. </span><span class="string">"\n"</span><span class="keyword">; };<br />
</span><span class="default">$country </span><span class="keyword">= </span><span class="string">'Canada'</span><span class="keyword">;<br />
</span><span class="default">$fn</span><span class="keyword">();<br />
<br />
</span><span class="comment">// problem 2: this should echo "Canada", not "UnitedStates"<br />
</span><span class="default">$country </span><span class="keyword">= </span><span class="string">'UnitedStates'</span><span class="keyword">;<br />
</span><span class="default">$fn </span><span class="keyword">= function () use (</span><span class="default">$country</span><span class="keyword">) { echo </span><span class="default">$country </span><span class="keyword">. </span><span class="string">"\n"</span><span class="keyword">; };<br />
</span><span class="default">$country </span><span class="keyword">= </span><span class="string">'Canada'</span><span class="keyword">;<br />
</span><span class="default">$fn</span><span class="keyword">();<br />
<br />
</span><span class="comment">// problem 3: this should echo "Canada", not "UnitedStates"<br />
</span><span class="default">$country </span><span class="keyword">= (object)array(</span><span class="string">'name' </span><span class="keyword">=&gt; </span><span class="string">'UnitedStates'</span><span class="keyword">);<br />
</span><span class="default">$fn </span><span class="keyword">= function () use (</span><span class="default">$country</span><span class="keyword">) { echo </span><span class="default">$country</span><span class="keyword">-&gt;</span><span class="default">name </span><span class="keyword">. </span><span class="string">"\n"</span><span class="keyword">; };<br />
</span><span class="default">$country </span><span class="keyword">= (object)array(</span><span class="string">'name' </span><span class="keyword">=&gt; </span><span class="string">'Canada'</span><span class="keyword">);<br />
</span><span class="default">$fn</span><span class="keyword">();<br />
<br />
</span><span class="comment">// problem 4: this outputs "Canada". if this outputs "Canada",<br />
// then so should problem 2 above. otherwise this should be<br />
// just as broken as problem 2 and be outputting "UnitedStates"<br />
</span><span class="default">$country </span><span class="keyword">= (object)array(</span><span class="string">'name' </span><span class="keyword">=&gt; </span><span class="string">'UnitedStates'</span><span class="keyword">);<br />
</span><span class="default">$fn </span><span class="keyword">= function () use (</span><span class="default">$country</span><span class="keyword">) { echo </span><span class="default">$country</span><span class="keyword">-&gt;</span><span class="default">name </span><span class="keyword">. </span><span class="string">"\n"</span><span class="keyword">; };<br />
</span><span class="default">$country</span><span class="keyword">-&gt;</span><span class="default">name </span><span class="keyword">= </span><span class="string">'Canada'</span><span class="keyword">;<br />
</span><span class="default">$fn</span><span class="keyword">();<br />
</span><span class="default">?&gt;<br />
</span>see <a href="http://bugs.php.net/bug.php?id=50980" rel="nofollow" target="_blank">http://bugs.php.net/bug.php?id=50980</a><br />
(I've just quoted from there, but if you want you can read there the whole feature request)</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="100545""></a>
  <div class="note">
   <strong class="user">Hayley Watson</strong>
   <a href="#100545" class="date">22-Oct-2010 04:00</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
As an alternative to gabriel's recursive construction, you may instead assign the recursive function to a variable, and use it by reference, thus:<br />
<br />
<span class="default">&lt;?php<br />
$fib </span><span class="keyword">= function(</span><span class="default">$n</span><span class="keyword">)use(&amp;</span><span class="default">$fib</span><span class="keyword">)<br />
{<br />
&nbsp;&nbsp;&nbsp; if(</span><span class="default">$n </span><span class="keyword">== </span><span class="default">0 </span><span class="keyword">|| </span><span class="default">$n </span><span class="keyword">== </span><span class="default">1</span><span class="keyword">) return </span><span class="default">1</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; return </span><span class="default">$fib</span><span class="keyword">(</span><span class="default">$n </span><span class="keyword">- </span><span class="default">1</span><span class="keyword">) + </span><span class="default">$fib</span><span class="keyword">(</span><span class="default">$n </span><span class="keyword">- </span><span class="default">2</span><span class="keyword">);<br />
};<br />
<br />
echo </span><span class="default">$fib</span><span class="keyword">(</span><span class="default">10</span><span class="keyword">);<br />
</span><span class="default">?&gt;<br />
</span>Hardly a sensible implementation of the Fibonacci sequence, but that's not the point! The point is that the variable needs to be used by reference, not value.<br />
<br />
Without the '&amp;', the anonymous function gets the value of $fib at the time the function is being created. But until the function has been created, $fib can't have it as a value! It's not until AFTER the function has been assigned to $fib that $fib can be used to call the function - but by then it's too late to pass its value to the function being created!<br />
<br />
Using a reference resolves the dilemma: when called, the anonymous function will use $fib's current value, which will be the anonymous function itself.<br />
<br />
At least, it will be if you don't reassign $fib to anything else between creating the function and calling it:<br />
<br />
<span class="default">&lt;?php<br />
$fib </span><span class="keyword">= function(</span><span class="default">$n</span><span class="keyword">)use(&amp;</span><span class="default">$fib</span><span class="keyword">)<br />
{<br />
&nbsp;&nbsp;&nbsp; if(</span><span class="default">$n </span><span class="keyword">== </span><span class="default">0 </span><span class="keyword">|| </span><span class="default">$n </span><span class="keyword">== </span><span class="default">1</span><span class="keyword">) return </span><span class="default">1</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; return </span><span class="default">$fib</span><span class="keyword">(</span><span class="default">$n </span><span class="keyword">- </span><span class="default">1</span><span class="keyword">) + </span><span class="default">$fib</span><span class="keyword">(</span><span class="default">$n </span><span class="keyword">- </span><span class="default">2</span><span class="keyword">);<br />
};<br />
<br />
</span><span class="default">$lie </span><span class="keyword">= </span><span class="default">$fib</span><span class="keyword">;<br />
<br />
</span><span class="default">$fib </span><span class="keyword">= function(</span><span class="default">$n</span><span class="keyword">)<br />
{<br />
&nbsp;&nbsp;&nbsp; return </span><span class="default">100</span><span class="keyword">;<br />
};<br />
<br />
echo </span><span class="default">$lie</span><span class="keyword">(</span><span class="default">10</span><span class="keyword">); </span><span class="comment">// 200, because $fib(10 - 1) and $fib(10 - 2) both return 100.<br />
</span><span class="default">?&gt;<br />
</span><br />
Of course, that's true of any variable: if you don't want its value to change, don't change its value.<br />
<br />
All the usual scoping rules for variables still apply: a local variable in a function is a different variable from another one with the same name in another function:<br />
<br />
<span class="default">&lt;?php<br />
$fib </span><span class="keyword">= function(</span><span class="default">$n</span><span class="keyword">)use(&amp;</span><span class="default">$fib</span><span class="keyword">)<br />
{<br />
&nbsp;&nbsp;&nbsp; if(</span><span class="default">$n </span><span class="keyword">== </span><span class="default">0 </span><span class="keyword">|| </span><span class="default">$n </span><span class="keyword">== </span><span class="default">1</span><span class="keyword">) return </span><span class="default">1</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; return </span><span class="default">$fib</span><span class="keyword">(</span><span class="default">$n </span><span class="keyword">- </span><span class="default">1</span><span class="keyword">) + </span><span class="default">$fib</span><span class="keyword">(</span><span class="default">$n </span><span class="keyword">- </span><span class="default">2</span><span class="keyword">);<br />
};<br />
<br />
</span><span class="default">$bark </span><span class="keyword">= function(</span><span class="default">$f</span><span class="keyword">)<br />
{<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$fib </span><span class="keyword">= </span><span class="string">'cake'</span><span class="keyword">;&nbsp; &nbsp; </span><span class="comment">// A totally different variable from the $fib above.<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">return </span><span class="default">2 </span><span class="keyword">* </span><span class="default">$f</span><span class="keyword">(</span><span class="default">5</span><span class="keyword">);<br />
};<br />
<br />
echo </span><span class="default">$bark</span><span class="keyword">(</span><span class="default">$fib</span><span class="keyword">); </span><span class="comment">// 16, twice the fifth Fibonacci number<br />
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="99477""></a>
  <div class="note">
   <strong class="user">anonymous</strong>
   <a href="#99477" class="date">19-Aug-2010 12:21</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Base dao class illustrating the usefulness of closures.<br />
* Handles opening and closing of connections.<br />
* Adds slashes sql<br />
* Type checking of sql parameters and casts as appropriate<br />
* Provides hook for processing of result set and emitting one or more objects.<br />
* Provides hook for accessing underlying link and result objects.<br />
<br />
<span class="default">&lt;?php<br />
<br />
define</span><span class="keyword">(</span><span class="string">"userName"</span><span class="keyword">,</span><span class="string">"root"</span><span class="keyword">);<br />
</span><span class="default">define</span><span class="keyword">(</span><span class="string">"password"</span><span class="keyword">,</span><span class="string">"root"</span><span class="keyword">);<br />
</span><span class="default">define</span><span class="keyword">(</span><span class="string">"dbName"</span><span class="keyword">,</span><span class="string">"ahcdb"</span><span class="keyword">);<br />
</span><span class="default">define</span><span class="keyword">(</span><span class="string">"hostName"</span><span class="keyword">,</span><span class="string">"localhost"</span><span class="keyword">);<br />
<br />
class </span><span class="default">BaseDao </span><span class="keyword">{<br />
<br />
&nbsp;&nbsp;&nbsp; function </span><span class="default">getConnection</span><span class="keyword">()&nbsp; &nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$link </span><span class="keyword">= </span><span class="default">mysql_connect</span><span class="keyword">(</span><span class="default">hostName</span><span class="keyword">, </span><span class="default">userName</span><span class="keyword">, </span><span class="default">password</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if (!</span><span class="default">$link</span><span class="keyword">) <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; die(</span><span class="string">"Could not connect: " </span><span class="keyword">. </span><span class="default">mysql_error</span><span class="keyword">());<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if (!</span><span class="default">mysql_select_db</span><span class="keyword">(</span><span class="default">dbName</span><span class="keyword">))<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; die(</span><span class="string">"Could not select database: " </span><span class="keyword">. </span><span class="default">mysql_error</span><span class="keyword">());<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">$link</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; function </span><span class="default">setParams</span><span class="keyword">(&amp; </span><span class="default">$sql</span><span class="keyword">, </span><span class="default">$params</span><span class="keyword">)&nbsp; &nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if(</span><span class="default">$params </span><span class="keyword">!= </span><span class="default">null</span><span class="keyword">)<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$sql </span><span class="keyword">= </span><span class="default">vsprintf</span><span class="keyword">(</span><span class="default">$sql</span><span class="keyword">, </span><span class="default">array_map</span><span class="keyword">(function(</span><span class="default">$n</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if(</span><span class="default">is_int</span><span class="keyword">(</span><span class="default">$n</span><span class="keyword">))<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return (int)</span><span class="default">$n</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if(</span><span class="default">is_float</span><span class="keyword">(</span><span class="default">$n</span><span class="keyword">))<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return (float)</span><span class="default">$n</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if(</span><span class="default">is_string</span><span class="keyword">(</span><span class="default">$n</span><span class="keyword">))<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="string">"'"</span><span class="keyword">.</span><span class="default">mysql_real_escape_string</span><span class="keyword">(</span><span class="default">$n</span><span class="keyword">).</span><span class="string">"'"</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">mysql_real_escape_string</span><span class="keyword">(</span><span class="default">$n</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }, </span><span class="default">$params</span><span class="keyword">));<br />
&nbsp;&nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp;&nbsp; function </span><span class="default">executeQuery</span><span class="keyword">(</span><span class="default">$sql</span><span class="keyword">, </span><span class="default">$params</span><span class="keyword">, </span><span class="default">$callback </span><span class="keyword">= </span><span class="default">null</span><span class="keyword">)&nbsp; &nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$link&nbsp; </span><span class="keyword">= </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">getConnection</span><span class="keyword">();<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">setParams</span><span class="keyword">(</span><span class="default">$sql</span><span class="keyword">, </span><span class="default">$params</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$return </span><span class="keyword">= </span><span class="default">null</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if((</span><span class="default">$result </span><span class="keyword">= </span><span class="default">mysql_query</span><span class="keyword">(</span><span class="default">$sql</span><span class="keyword">, </span><span class="default">$link</span><span class="keyword">)) != </span><span class="default">null</span><span class="keyword">)<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if(</span><span class="default">$callback </span><span class="keyword">!= </span><span class="default">null</span><span class="keyword">)<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$return </span><span class="keyword">= </span><span class="default">$callback</span><span class="keyword">(</span><span class="default">$result</span><span class="keyword">, </span><span class="default">$link</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if(</span><span class="default">$link </span><span class="keyword">!= </span><span class="default">null</span><span class="keyword">)<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">mysql_close</span><span class="keyword">(</span><span class="default">$link</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if(!</span><span class="default">$result</span><span class="keyword">)<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; die(</span><span class="string">"Fatal Error: Invalid query '</span><span class="default">$sql</span><span class="string">' : " </span><span class="keyword">. </span><span class="default">mysql_error</span><span class="keyword">());<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">$return</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;<br />
&nbsp;&nbsp;&nbsp; function </span><span class="default">getList</span><span class="keyword">(</span><span class="default">$sql</span><span class="keyword">, </span><span class="default">$params</span><span class="keyword">, </span><span class="default">$callback</span><span class="keyword">)&nbsp; &nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">executeQuery</span><span class="keyword">(</span><span class="default">$sql</span><span class="keyword">, </span><span class="default">$params</span><span class="keyword">, function(</span><span class="default">$result</span><span class="keyword">, </span><span class="default">$link</span><span class="keyword">) use (</span><span class="default">$callback</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$idx </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$list </span><span class="keyword">= array();<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; while (</span><span class="default">$row </span><span class="keyword">= </span><span class="default">mysql_fetch_assoc</span><span class="keyword">(</span><span class="default">$result</span><span class="keyword">))<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if(</span><span class="default">$callback </span><span class="keyword">!= </span><span class="default">null</span><span class="keyword">)<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$list</span><span class="keyword">[</span><span class="default">$idx</span><span class="keyword">] = </span><span class="default">$callback</span><span class="keyword">(</span><span class="default">$idx</span><span class="keyword">++, </span><span class="default">$row</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">$list</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; });<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; function </span><span class="default">getSingle</span><span class="keyword">(</span><span class="default">$sql</span><span class="keyword">, </span><span class="default">$params</span><span class="keyword">, </span><span class="default">$callback</span><span class="keyword">)&nbsp; &nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">executeQuery</span><span class="keyword">(</span><span class="default">$sql</span><span class="keyword">, </span><span class="default">$params</span><span class="keyword">, function(</span><span class="default">$result</span><span class="keyword">, </span><span class="default">$link</span><span class="keyword">) use (</span><span class="default">$callback</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">$row </span><span class="keyword">= </span><span class="default">mysql_fetch_assoc</span><span class="keyword">(</span><span class="default">$result</span><span class="keyword">))<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$obj </span><span class="keyword">= </span><span class="default">$callback</span><span class="keyword">(</span><span class="default">$row</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">$obj</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; });<br />
&nbsp;&nbsp;&nbsp; }<br />
}<br />
<br />
class </span><span class="default">Example&nbsp; &nbsp; </span><span class="keyword">{<br />
&nbsp;&nbsp;&nbsp; var </span><span class="default">$id</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; var </span><span class="default">$name</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; function </span><span class="default">Example</span><span class="keyword">(</span><span class="default">$id</span><span class="keyword">, </span><span class="default">$name</span><span class="keyword">){<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">id </span><span class="keyword">= </span><span class="default">$id</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">name </span><span class="keyword">= </span><span class="default">$name</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; function </span><span class="default">setId</span><span class="keyword">(</span><span class="default">$id</span><span class="keyword">){<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">id </span><span class="keyword">= </span><span class="default">$id</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }<br />
}<br />
<br />
class </span><span class="default">ExampleDao </span><span class="keyword">extends </span><span class="default">BaseDao&nbsp; &nbsp; </span><span class="keyword">{<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; function </span><span class="default">getAll</span><span class="keyword">(){<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">parent</span><span class="keyword">::</span><span class="default">getList</span><span class="keyword">(</span><span class="string">"select * from nodes"</span><span class="keyword">, </span><span class="default">null</span><span class="keyword">, function(</span><span class="default">$idx</span><span class="keyword">, </span><span class="default">$row</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return new </span><span class="default">Example</span><span class="keyword">(</span><span class="default">$row</span><span class="keyword">[</span><span class="string">"id"</span><span class="keyword">], </span><span class="default">$row</span><span class="keyword">[</span><span class="string">"name"</span><span class="keyword">]);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; });<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; function </span><span class="default">load</span><span class="keyword">(</span><span class="default">$id</span><span class="keyword">){<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">parent</span><span class="keyword">::</span><span class="default">getSingle</span><span class="keyword">(</span><span class="string">"select * from nodes where id = %1\$s"</span><span class="keyword">, array(</span><span class="default">$id</span><span class="keyword">), function(</span><span class="default">$row</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return new </span><span class="default">Example</span><span class="keyword">(</span><span class="default">$row</span><span class="keyword">[</span><span class="string">"id"</span><span class="keyword">], </span><span class="default">$row</span><span class="keyword">[</span><span class="string">"name"</span><span class="keyword">]);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; });<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; function </span><span class="default">update</span><span class="keyword">(</span><span class="default">$example</span><span class="keyword">){<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">parent</span><span class="keyword">::</span><span class="default">executeQuery</span><span class="keyword">(</span><span class="string">"update nodes set name = '' where&nbsp; id = -1"</span><span class="keyword">, </span><span class="default">null</span><span class="keyword">, function(</span><span class="default">$result</span><span class="keyword">, </span><span class="default">$link</span><span class="keyword">){<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">$result</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; });<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; function </span><span class="default">insert</span><span class="keyword">(&amp; </span><span class="default">$example</span><span class="keyword">){<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">parent</span><span class="keyword">::</span><span class="default">executeQuery</span><span class="keyword">(</span><span class="string">"insert into nodes"</span><span class="keyword">, </span><span class="default">null</span><span class="keyword">, function(</span><span class="default">$result</span><span class="keyword">, </span><span class="default">$link</span><span class="keyword">) use (</span><span class="default">$example</span><span class="keyword">){<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$id </span><span class="keyword">= </span><span class="default">mysql_insert_id</span><span class="keyword">(</span><span class="default">$link</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$example</span><span class="keyword">-&gt;</span><span class="default">setId</span><span class="keyword">(</span><span class="default">$id</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">$result</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; });<br />
&nbsp;&nbsp;&nbsp; }&nbsp; &nbsp; <br />
}<br />
<br />
</span><span class="default">$exampleDao </span><span class="keyword">= new </span><span class="default">ExampleDao</span><span class="keyword">();<br />
<br />
</span><span class="default">$list </span><span class="keyword">= </span><span class="default">$exampleDao</span><span class="keyword">-&gt;</span><span class="default">getAll</span><span class="keyword">());<br />
<br />
</span><span class="default">$exampleObject </span><span class="keyword">= </span><span class="default">$exampleDao</span><span class="keyword">-&gt;</span><span class="default">load</span><span class="keyword">(</span><span class="default">1</span><span class="keyword">));<br />
<br />
</span><span class="default">$exampleDao</span><span class="keyword">-&gt;</span><span class="default">update</span><span class="keyword">(</span><span class="default">$exampleObject</span><span class="keyword">);<br />
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="99287""></a>
  <div class="note">
   <strong class="user">orls</strong>
   <a href="#99287" class="date">09-Aug-2010 03:53</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Watch out when 'importing' variables to a closure's scope&nbsp; -- it's easy to miss / forget that they are actually being *copied* into the closure's scope, rather than just being made available.<br />
<br />
So you will need to explicitly pass them in by reference if your closure cares about their contents over time:<br />
<br />
<span class="default">&lt;?php<br />
$result </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">;<br />
<br />
</span><span class="default">$one </span><span class="keyword">= function()<br />
{ </span><span class="default">var_dump</span><span class="keyword">(</span><span class="default">$result</span><span class="keyword">); };<br />
<br />
</span><span class="default">$two </span><span class="keyword">= function() use (</span><span class="default">$result</span><span class="keyword">)<br />
{ </span><span class="default">var_dump</span><span class="keyword">(</span><span class="default">$result</span><span class="keyword">); };<br />
<br />
</span><span class="default">$three </span><span class="keyword">= function() use (&amp;</span><span class="default">$result</span><span class="keyword">)<br />
{ </span><span class="default">var_dump</span><span class="keyword">(</span><span class="default">$result</span><span class="keyword">); };<br />
<br />
</span><span class="default">$result</span><span class="keyword">++;<br />
<br />
</span><span class="default">$one</span><span class="keyword">();&nbsp; &nbsp; </span><span class="comment">// outputs NULL: $result is not in scope<br />
</span><span class="default">$two</span><span class="keyword">();&nbsp; &nbsp; </span><span class="comment">// outputs int(0): $result was copied<br />
</span><span class="default">$three</span><span class="keyword">();&nbsp; &nbsp; </span><span class="comment">// outputs int(1)<br />
</span><span class="default">?&gt;<br />
</span><br />
Another less trivial example with objects (what I actually tripped up on):<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="comment">//set up variable in advance<br />
</span><span class="default">$myInstance </span><span class="keyword">= </span><span class="default">null</span><span class="keyword">;<br />
<br />
</span><span class="default">$broken </span><span class="keyword">= function() </span><span class="default">uses </span><span class="keyword">(</span><span class="default">$myInstance</span><span class="keyword">)<br />
{<br />
&nbsp;&nbsp;&nbsp; if(!empty(</span><span class="default">$myInstance</span><span class="keyword">)) </span><span class="default">$myInstance</span><span class="keyword">-&gt;</span><span class="default">doSomething</span><span class="keyword">();<br />
};<br />
<br />
</span><span class="default">$working </span><span class="keyword">= function() </span><span class="default">uses </span><span class="keyword">(&amp;</span><span class="default">$myInstance</span><span class="keyword">)<br />
{<br />
&nbsp;&nbsp;&nbsp; if(!empty(</span><span class="default">$myInstance</span><span class="keyword">)) </span><span class="default">$myInstance</span><span class="keyword">-&gt;</span><span class="default">doSomething</span><span class="keyword">();<br />
}<br />
<br />
</span><span class="comment">//$myInstance might be instantiated, might not be<br />
</span><span class="keyword">if(</span><span class="default">SomeBusinessLogic</span><span class="keyword">::</span><span class="default">worked</span><span class="keyword">() == </span><span class="default">true</span><span class="keyword">)<br />
{<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$myInstance </span><span class="keyword">= new </span><span class="default">myClass</span><span class="keyword">();<br />
}<br />
<br />
</span><span class="default">$broken</span><span class="keyword">();&nbsp; &nbsp; </span><span class="comment">// will never do anything: $myInstance will ALWAYS be null inside this closure.<br />
</span><span class="default">$working</span><span class="keyword">();&nbsp; &nbsp; </span><span class="comment">// will call doSomething if $myInstance is instantiated<br />
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="98978""></a>
  <div class="note">
   <strong class="user">gabriel dot totoliciu at ddsec dot net</strong>
   <a href="#98978" class="date">20-Jul-2010 07:56</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If you want to make a recursive closure, you will need to write this:<br />
<br />
$some_var1="1";<br />
$some_var2="2";<br />
<br />
function($param1, $param2) use ($some_var1, $some_var2)<br />
{<br />
<br />
//some code here<br />
<br />
call_user_func(__FUNCTION__, $other_param1, $other_param2);<br />
<br />
//some code here<br />
<br />
}<br />
<br />
If you need to pass values by reference you should check out<br />
<br />
<a href="http://www.php.net/manual/en/function.call-user-func.php" rel="nofollow" target="_blank">http://www.php.net/manual/en/function.call-user-func.php</a><br />
<a href="http://www.php.net/manual/en/function.call-user-func-array.php" rel="nofollow" target="_blank">http://www.php.net/manual/en/function.call-user-func-array.php</a><br />
<br />
If you're wondering if $some_var1 and $some_var2 are still visible by using the call_user_func, yes, they are available.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="98384""></a>
  <div class="note">
   <strong class="user">martin dot partel at gmail dot com</strong>
   <a href="#98384" class="date">11-Jun-2010 07:50</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
$this is currently (PHP 5.3.2) not usable directly with closures.
<br />

<br />
One can write:
<br />
<span class="default">&lt;?php
<br />
$self </span><span class="keyword">= </span><span class="default">$this</span><span class="keyword">;
<br />
function () use (</span><span class="default">$self</span><span class="keyword">) { ... }
<br />
</span><span class="default">?&gt;
<br />
</span>but then the private/protected members of $this cannot be used inside the closure. This makes closures much less useful in OO code.
<br />

<br />
Until this is fixed, one can cheat using reflection:
<br />
<span class="default">&lt;?php
<br />
</span><span class="keyword">class </span><span class="default">FullAccessWrapper
<br />
</span><span class="keyword">{
<br />
&nbsp;&nbsp;&nbsp; protected </span><span class="default">$_self</span><span class="keyword">;
<br />
&nbsp;&nbsp;&nbsp; protected </span><span class="default">$_refl</span><span class="keyword">;
<br />
&nbsp;&nbsp;&nbsp; 
<br />
&nbsp;&nbsp;&nbsp; public function </span><span class="default">__construct</span><span class="keyword">(</span><span class="default">$self</span><span class="keyword">)
<br />
&nbsp;&nbsp;&nbsp; {
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">_self </span><span class="keyword">= </span><span class="default">$self</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">_refl </span><span class="keyword">= new </span><span class="default">ReflectionObject</span><span class="keyword">(</span><span class="default">$self</span><span class="keyword">);
<br />
&nbsp;&nbsp;&nbsp; }
<br />
&nbsp;&nbsp;&nbsp; 
<br />
&nbsp;&nbsp;&nbsp; public function </span><span class="default">__call</span><span class="keyword">(</span><span class="default">$method</span><span class="keyword">, </span><span class="default">$args</span><span class="keyword">)
<br />
&nbsp;&nbsp;&nbsp; {
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$mrefl </span><span class="keyword">= </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">_refl</span><span class="keyword">-&gt;</span><span class="default">getMethod</span><span class="keyword">(</span><span class="default">$method</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$mrefl</span><span class="keyword">-&gt;</span><span class="default">setAccessible</span><span class="keyword">(</span><span class="default">true</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">$mrefl</span><span class="keyword">-&gt;</span><span class="default">invokeArgs</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">_self</span><span class="keyword">, </span><span class="default">$args</span><span class="keyword">);
<br />
&nbsp;&nbsp;&nbsp; }
<br />
&nbsp;&nbsp;&nbsp; 
<br />
&nbsp;&nbsp;&nbsp; public function </span><span class="default">__set</span><span class="keyword">(</span><span class="default">$name</span><span class="keyword">, </span><span class="default">$value</span><span class="keyword">)
<br />
&nbsp;&nbsp;&nbsp; {
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$prefl </span><span class="keyword">= </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">_refl</span><span class="keyword">-&gt;</span><span class="default">getProperty</span><span class="keyword">(</span><span class="default">$name</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$prefl</span><span class="keyword">-&gt;</span><span class="default">setAccessible</span><span class="keyword">(</span><span class="default">true</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$prefl</span><span class="keyword">-&gt;</span><span class="default">setValue</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">_self</span><span class="keyword">, </span><span class="default">$value</span><span class="keyword">);
<br />
&nbsp;&nbsp;&nbsp; }
<br />
&nbsp;&nbsp;&nbsp; 
<br />
&nbsp;&nbsp;&nbsp; public function </span><span class="default">__get</span><span class="keyword">(</span><span class="default">$name</span><span class="keyword">)
<br />
&nbsp;&nbsp;&nbsp; {
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$prefl </span><span class="keyword">= </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">_refl</span><span class="keyword">-&gt;</span><span class="default">getProperty</span><span class="keyword">(</span><span class="default">$name</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$prefl</span><span class="keyword">-&gt;</span><span class="default">setAccessible</span><span class="keyword">(</span><span class="default">true</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">$prefl</span><span class="keyword">-&gt;</span><span class="default">getValue</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">_self</span><span class="keyword">);
<br />
&nbsp;&nbsp;&nbsp; }
<br />
&nbsp;&nbsp;&nbsp; 
<br />
&nbsp;&nbsp;&nbsp; public function </span><span class="default">__isset</span><span class="keyword">(</span><span class="default">$name</span><span class="keyword">)
<br />
&nbsp;&nbsp;&nbsp; {
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$value </span><span class="keyword">= </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">__get</span><span class="keyword">(</span><span class="default">$name</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return isset(</span><span class="default">$value</span><span class="keyword">);
<br />
&nbsp;&nbsp;&nbsp; }
<br />
}
<br />

<br />
</span><span class="comment">/**
<br />
&nbsp;* Usage:
<br />
&nbsp;* $self = giveAccess($this);
<br />
&nbsp;* function() use ($self) { $self-&gt;privateMember... }
<br />
&nbsp;*/
<br />
</span><span class="keyword">function </span><span class="default">giveAccess</span><span class="keyword">(</span><span class="default">$obj</span><span class="keyword">)
<br />
{
<br />
&nbsp;&nbsp;&nbsp; return new </span><span class="default">FullAccessWrapper</span><span class="keyword">(</span><span class="default">$obj</span><span class="keyword">);
<br />
}
<br />

<br />
</span><span class="comment">// Example:
<br />

<br />
</span><span class="keyword">class </span><span class="default">Foo
<br />
</span><span class="keyword">{
<br />
&nbsp;&nbsp;&nbsp; private </span><span class="default">$x </span><span class="keyword">= </span><span class="default">3</span><span class="keyword">;
<br />
&nbsp;&nbsp;&nbsp; private function </span><span class="default">f</span><span class="keyword">()
<br />
&nbsp;&nbsp;&nbsp; {
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">15</span><span class="keyword">;
<br />
&nbsp;&nbsp;&nbsp; }
<br />
&nbsp;&nbsp;&nbsp; 
<br />
&nbsp;&nbsp;&nbsp; public function </span><span class="default">getClosureUsingPrivates</span><span class="keyword">()
<br />
&nbsp;&nbsp;&nbsp; {
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$self </span><span class="keyword">= </span><span class="default">giveAccess</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return function () use (</span><span class="default">$self</span><span class="keyword">) {
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">$self</span><span class="keyword">-&gt;</span><span class="default">x </span><span class="keyword">* </span><span class="default">$self</span><span class="keyword">-&gt;</span><span class="default">f</span><span class="keyword">();
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; };
<br />
&nbsp;&nbsp;&nbsp; }
<br />
}
<br />

<br />
</span><span class="default">$foo </span><span class="keyword">= new </span><span class="default">Foo</span><span class="keyword">();
<br />
</span><span class="default">$closure </span><span class="keyword">= </span><span class="default">$foo</span><span class="keyword">-&gt;</span><span class="default">getClosureUsingPrivates</span><span class="keyword">();
<br />
echo </span><span class="default">$closure</span><span class="keyword">() . </span><span class="string">"\n"</span><span class="keyword">; </span><span class="comment">// Prints 45 as expected
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="97906""></a>
  <div class="note">
   <strong class="user">kdelux at gmail dot com</strong>
   <a href="#97906" class="date">15-May-2010 05:55</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Here is an example of one way to define, then use the variable ( $this ) in Closure functions.&nbsp; The code below explores all uses, and shows restrictions.<br />
<br />
The most useful tool in this snippet is the requesting_class() function that will tell you which class is responsible for executing the current Closure().&nbsp; <br />
<br />
Overview:<br />
-----------------------<br />
Successfully find calling object reference.<br />
Successfully call $this(__invoke);<br />
Successfully reference $$this-&gt;name;<br />
Successfully call call_user_func(array($this, 'method'))<br />
<br />
Failure: reference anything through $this-&gt;<br />
Failure: $this-&gt;name = ''; <br />
Failure: $this-&gt;delfect(); <br />
<br />
<span class="default">&lt;?php<br />
&nbsp;<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">function </span><span class="default">requesting_class</span><span class="keyword">()<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; foreach(</span><span class="default">debug_backtrace</span><span class="keyword">(</span><span class="default">true</span><span class="keyword">) as </span><span class="default">$stack</span><span class="keyword">){<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if(isset(</span><span class="default">$stack</span><span class="keyword">[</span><span class="string">'object'</span><span class="keyword">])){<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">$stack</span><span class="keyword">[</span><span class="string">'object'</span><span class="keyword">];<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; class </span><span class="default">Person<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">{<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; public </span><span class="default">$name </span><span class="keyword">= </span><span class="string">''</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; public </span><span class="default">$head </span><span class="keyword">= </span><span class="default">true</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; public </span><span class="default">$feet </span><span class="keyword">= </span><span class="default">true</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; public </span><span class="default">$deflected </span><span class="keyword">= </span><span class="default">false</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; function </span><span class="default">__invoke</span><span class="keyword">(</span><span class="default">$p</span><span class="keyword">){ return </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">$p</span><span class="keyword">; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; function </span><span class="default">__toString</span><span class="keyword">(){ return </span><span class="string">'this'</span><span class="keyword">; } </span><span class="comment">// test for reference<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">function </span><span class="default">__construct</span><span class="keyword">(</span><span class="default">$name</span><span class="keyword">){ </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">name </span><span class="keyword">= </span><span class="default">$name</span><span class="keyword">; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; function </span><span class="default">deflect</span><span class="keyword">(){ </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">deflected </span><span class="keyword">= </span><span class="default">true</span><span class="keyword">; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; public function </span><span class="default">shoot</span><span class="keyword">()<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; { </span><span class="comment">// If customAttack is defined, use that as the shoot resut.&nbsp; Otherwise shoot feet<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">if(</span><span class="default">is_callable</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">customAttack</span><span class="keyword">)){<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">call_user_func</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">customAttack</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">feet </span><span class="keyword">= </span><span class="default">false</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$p </span><span class="keyword">= new </span><span class="default">Person</span><span class="keyword">(</span><span class="string">'Bob'</span><span class="keyword">);<br />
<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$p</span><span class="keyword">-&gt;</span><span class="default">customAttack </span><span class="keyword">= <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; function(){<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; echo </span><span class="default">$this</span><span class="keyword">; </span><span class="comment">// Notice: Undefined variable: this<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; #$this = new Class() // FATAL ERROR<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; // Trick to assign the variable '$this'<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">extract</span><span class="keyword">(array(</span><span class="string">'this' </span><span class="keyword">=&gt; </span><span class="default">requesting_class</span><span class="keyword">())); </span><span class="comment">// Determine what class is responsible for making the call to Closure<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">var_dump</span><span class="keyword">( </span><span class="default">$this&nbsp; </span><span class="keyword">);&nbsp; </span><span class="comment">// Passive reference works<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">var_dump</span><span class="keyword">( $</span><span class="default">$this </span><span class="keyword">); </span><span class="comment">// Added to class:&nbsp; function __toString(){ return 'this'; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$name </span><span class="keyword">= </span><span class="default">$this</span><span class="keyword">(</span><span class="string">'name'</span><span class="keyword">); </span><span class="comment">// Success<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">echo </span><span class="default">$name</span><span class="keyword">;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="comment">// Outputs: Bob<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">echo </span><span class="string">'&lt;br /&gt;'</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; echo $</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">name</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">call_user_func_array</span><span class="keyword">(array(</span><span class="default">$this</span><span class="keyword">, </span><span class="string">'deflect'</span><span class="keyword">), array()); </span><span class="comment">// SUCCESSFULLY CALLED<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; #$this-&gt;head = 0; //** FATAL ERROR: Using $this when not in object context<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">$</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">head </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">;&nbsp; </span><span class="comment">// Successfully sets value<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">};<br />
&nbsp;<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">print_r</span><span class="keyword">(</span><span class="default">$p</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$p</span><span class="keyword">-&gt;</span><span class="default">shoot</span><span class="keyword">();<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; </span><span class="default">print_r</span><span class="keyword">(</span><span class="default">$p</span><span class="keyword">);<br />
<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; die();<br />
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="97296""></a>
  <div class="note">
   <strong class="user">Hayley Watson</strong>
   <a href="#97296" class="date">13-Apr-2010 03:53</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
In the code
<br />

<br />
<span class="default">&lt;?php
<br />
</span><span class="keyword">function </span><span class="default">new_counter</span><span class="keyword">()
<br />
{
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$counter </span><span class="keyword">= </span><span class="default">mt_rand</span><span class="keyword">();
<br />
&nbsp;&nbsp;&nbsp; return function()use(&amp;</span><span class="default">$counter</span><span class="keyword">)
<br />
&nbsp;&nbsp;&nbsp; {
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return ++</span><span class="default">$counter</span><span class="keyword">;
<br />
&nbsp;&nbsp;&nbsp; };
<br />
}
<br />

<br />
</span><span class="default">$t1 </span><span class="keyword">= </span><span class="default">new_counter</span><span class="keyword">();
<br />
</span><span class="default">$t2 </span><span class="keyword">= </span><span class="default">new_counter</span><span class="keyword">();
<br />

<br />
echo </span><span class="default">$t1</span><span class="keyword">(),</span><span class="string">"\n"</span><span class="keyword">;
<br />
echo </span><span class="default">$t1</span><span class="keyword">(),</span><span class="string">"\n"</span><span class="keyword">;
<br />
echo </span><span class="default">$t2</span><span class="keyword">(),</span><span class="string">"\n"</span><span class="keyword">;
<br />
echo </span><span class="default">$t2</span><span class="keyword">(),</span><span class="string">"\n"</span><span class="keyword">;
<br />
echo </span><span class="default">$t1</span><span class="keyword">(),</span><span class="string">"\n"</span><span class="keyword">;
<br />
echo </span><span class="default">$t1</span><span class="keyword">(),</span><span class="string">"\n"</span><span class="keyword">;
<br />
</span><span class="default">?&gt;
<br />
</span>
<br />
The variable $counter is local to new_counter() and is used by reference by the returned lambda function.
<br />

<br />
Because $counter is not static, a new variable is created each time new_counter() is called.
<br />

<br />
But because the lambda function uses a REFERENCE to the $counter variable - and not a new local variable with a copy of the value $counter had when the lambda function was constructed - the $counter variable created when new_counter() ran still exists (because a reference to it still exists).
<br />

<br />
Every lambda function has a variable reference "hardwired" into it. That variable therefore persists across calls to the lambda function - rather like a static variable.
<br />

<br />
But that variable is only LOCAL to the new_counter() function that created it. As soon as new_counter() returns, it gives up its reference to $counter. When new_counter() is called again, it gets allocated a NEW $counter variable and gives a reference to THAT variable to the lambda function it constructs.
<br />

<br />
So the lambda functions in $t1 and $t2 each have their OWN $counter variable - separate from the other's, which persists from one call to the next.
<br />

<br />
The effect is very similar to declaring and initialising $counter as static within the lambda function - and then it doesn't need to use anything from new_counter() - but you can't initialise a static variable with a function call like mt_rand()!
<br />

<br />
Pending a decision on what it should mean, $this is not currently (as of 5.3.2) usable within anonymous functions.
<br />

<br />
There are roughly two positions (plus attempts at compromise), that can be called "early" and "late".
<br />

<br />
Early: $this refers to the object in whose scope the anonymous function is constructed.
<br />
<span class="default">&lt;?php
<br />
</span><span class="keyword">class </span><span class="default">Creator
<br />
</span><span class="keyword">{
<br />
&nbsp;&nbsp; public function </span><span class="default">make_anonymous</span><span class="keyword">()
<br />
&nbsp;&nbsp; {
<br />
&nbsp;&nbsp; &nbsp; &nbsp; return function()
<br />
&nbsp;&nbsp; &nbsp; &nbsp; {
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; return </span><span class="default">$this</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp; };
<br />
&nbsp;&nbsp; }
<br />
}
<br />

<br />
class </span><span class="default">Caller
<br />
</span><span class="keyword">{
<br />
&nbsp;&nbsp; public </span><span class="default">$p</span><span class="keyword">;
<br />
&nbsp;&nbsp; public function </span><span class="default">call_anonymous</span><span class="keyword">(</span><span class="default">$f</span><span class="keyword">)
<br />
&nbsp;&nbsp; {
<br />
&nbsp;&nbsp; &nbsp; &nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">p </span><span class="keyword">= </span><span class="default">$f</span><span class="keyword">();
<br />
&nbsp;&nbsp; }
<br />
}
<br />

<br />
</span><span class="default">$alpha </span><span class="keyword">= new </span><span class="default">Creator</span><span class="keyword">;
<br />
</span><span class="default">$omega </span><span class="keyword">= new </span><span class="default">Caller</span><span class="keyword">;
<br />
</span><span class="default">$omega</span><span class="keyword">-&gt;</span><span class="default">call_anonymous</span><span class="keyword">(</span><span class="default">$alpha</span><span class="keyword">-&gt;</span><span class="default">create_anonymous</span><span class="keyword">());
<br />
</span><span class="comment">// $omega-&gt;p === $alpha
<br />
</span><span class="default">?&gt;
<br />
</span>
<br />
Late: $this refers to the object in whose scope the anonymous function is called.
<br />

<br />
<span class="default">&lt;?php
<br />
</span><span class="keyword">class </span><span class="default">Creator
<br />
</span><span class="keyword">{
<br />
&nbsp;&nbsp; public function </span><span class="default">make_anonymous</span><span class="keyword">()
<br />
&nbsp;&nbsp; {
<br />
&nbsp;&nbsp; &nbsp; &nbsp; return function()
<br />
&nbsp;&nbsp; &nbsp; &nbsp; {
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; return </span><span class="default">$this</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp; };
<br />
&nbsp;&nbsp; }
<br />
}
<br />

<br />
class </span><span class="default">Caller
<br />
</span><span class="keyword">{
<br />
&nbsp;&nbsp; public </span><span class="default">$p</span><span class="keyword">;
<br />
&nbsp;&nbsp; public function </span><span class="default">call_anonymous</span><span class="keyword">(</span><span class="default">$f</span><span class="keyword">)
<br />
&nbsp;&nbsp; {
<br />
&nbsp;&nbsp; &nbsp; &nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">p </span><span class="keyword">= </span><span class="default">$f</span><span class="keyword">();
<br />
&nbsp;&nbsp; }
<br />
}
<br />

<br />
</span><span class="default">$alpha </span><span class="keyword">= new </span><span class="default">Creator</span><span class="keyword">;
<br />
</span><span class="default">$omega </span><span class="keyword">= new </span><span class="default">Caller</span><span class="keyword">;
<br />
</span><span class="default">$omega</span><span class="keyword">-&gt;</span><span class="default">call_anonymous</span><span class="keyword">(</span><span class="default">$alpha</span><span class="keyword">-&gt;</span><span class="default">create_anonymous</span><span class="keyword">());
<br />
</span><span class="comment">// $omega-&gt;p === $omega
<br />
</span><span class="default">?&gt;
<br />
</span>
<br />
So until this is cleared up, $this won't work in an anonymous function. (Personally, I favour the early method; otherwise the anonymous function - and therefore its Creator - has access to all of the Caller's private properties.)</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="96755""></a>
  <div class="note">
   <strong class="user">housni dot yakoob at gmail dot com</strong>
   <a href="#96755" class="date">14-Mar-2010 06:22</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If you want to make sure that one of the parameters of your function is a Closure, you can use Type Hinting.<br />
see: <a href="http://php.net/manual/en/language.oop5.typehinting.php" rel="nofollow" target="_blank">http://php.net/manual/en/language.oop5.typehinting.php</a><br />
<br />
Example:<br />
<span class="default">&lt;?php<br />
<br />
</span><span class="keyword">class </span><span class="default">TheRoot<br />
</span><span class="keyword">{<br />
&nbsp;&nbsp;&nbsp; public function </span><span class="default">poidh</span><span class="keyword">(</span><span class="default">$param</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; echo </span><span class="string">"TheRoot </span><span class="default">$param</span><span class="string">!"</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }&nbsp;&nbsp; <br />
<br />
}<br />
<br />
class </span><span class="default">Internet<br />
</span><span class="keyword">{<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment"># here, $my_closure must be of type object Closure<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">public function </span><span class="default">run_my_closure</span><span class="keyword">(</span><span class="default">$bar</span><span class="keyword">, </span><span class="default">Closure $my_closure</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$my_closure</span><span class="keyword">(</span><span class="default">$bar</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; }&nbsp;&nbsp; <br />
}<br />
<br />
</span><span class="default">$Internet </span><span class="keyword">= new </span><span class="default">Internet</span><span class="keyword">();<br />
</span><span class="default">$Root </span><span class="keyword">= new </span><span class="default">TheRoot</span><span class="keyword">();<br />
<br />
</span><span class="default">$Internet</span><span class="keyword">-&gt;</span><span class="default">run_my_closure</span><span class="keyword">(</span><span class="default">$Root</span><span class="keyword">, function(</span><span class="default">$Object</span><span class="keyword">) {<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$Object</span><span class="keyword">-&gt;</span><span class="default">poidh</span><span class="keyword">(</span><span class="default">42</span><span class="keyword">);<br />
});<br />
<br />
</span><span class="default">?&gt;<br />
</span>The above code simply yields:<br />
"TheRoot 42!"<br />
<br />
NOTE: If you are using namespaces, make sure you give a fully qualified namespace.<br />
<br />
print_r() of Internet::run_my_closure's $my_closure<br />
<span class="default">&lt;?php<br />
Closure Object<br />
</span><span class="keyword">(<br />
&nbsp;&nbsp;&nbsp; [</span><span class="default">parameter</span><span class="keyword">] =&gt; Array<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; (<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [</span><span class="default">$Object</span><span class="keyword">] =&gt; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; )<br />
<br />
)<br />
</span><span class="default">?&gt;<br />
</span><br />
var_dump() of Internet::run_my_closure's $my_closure<br />
<span class="default">&lt;?php<br />
object</span><span class="keyword">(</span><span class="default">Closure</span><span class="keyword">)</span><span class="comment">#3 (1) {<br />
&nbsp; </span><span class="keyword">[</span><span class="string">"parameter"</span><span class="keyword">]=&gt;<br />
&nbsp; array(</span><span class="default">1</span><span class="keyword">) {<br />
&nbsp;&nbsp;&nbsp; [</span><span class="string">"</span><span class="default">$Object</span><span class="string">"</span><span class="keyword">]=&gt;<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">string</span><span class="keyword">(</span><span class="default">10</span><span class="keyword">) </span><span class="string">""<br />
&nbsp; </span><span class="keyword">}<br />
}<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="96579""></a>
  <div class="note">
   <strong class="user">aaron at afloorabove dot com</strong>
   <a href="#96579" class="date">05-Mar-2010 11:42</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Anonymous functions are great for events!<br />
<br />
<span class="default">&lt;?php<br />
<br />
</span><span class="keyword">class </span><span class="default">Event </span><span class="keyword">{<br />
<br />
&nbsp; public static </span><span class="default">$events </span><span class="keyword">= array();<br />
&nbsp; <br />
&nbsp; public static function </span><span class="default">bind</span><span class="keyword">(</span><span class="default">$event</span><span class="keyword">, </span><span class="default">$callback</span><span class="keyword">, </span><span class="default">$obj </span><span class="keyword">= </span><span class="default">null</span><span class="keyword">) {<br />
&nbsp;&nbsp;&nbsp; if (!</span><span class="default">self</span><span class="keyword">::</span><span class="default">$events</span><span class="keyword">[</span><span class="default">$event</span><span class="keyword">]) {<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="default">self</span><span class="keyword">::</span><span class="default">$events</span><span class="keyword">[</span><span class="default">$event</span><span class="keyword">] = array();<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; </span><span class="default">self</span><span class="keyword">::</span><span class="default">$events</span><span class="keyword">[</span><span class="default">$event</span><span class="keyword">][] = (</span><span class="default">$obj </span><span class="keyword">=== </span><span class="default">null</span><span class="keyword">)&nbsp; ? </span><span class="default">$callback </span><span class="keyword">: array(</span><span class="default">$obj</span><span class="keyword">, </span><span class="default">$callback</span><span class="keyword">);<br />
&nbsp; }<br />
&nbsp; <br />
&nbsp; public static function </span><span class="default">run</span><span class="keyword">(</span><span class="default">$event</span><span class="keyword">) {<br />
&nbsp;&nbsp;&nbsp; if (!</span><span class="default">self</span><span class="keyword">::</span><span class="default">$events</span><span class="keyword">[</span><span class="default">$event</span><span class="keyword">]) return;<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; foreach (</span><span class="default">self</span><span class="keyword">::</span><span class="default">$events</span><span class="keyword">[</span><span class="default">$event</span><span class="keyword">] as </span><span class="default">$callback</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp;&nbsp; if (</span><span class="default">call_user_func</span><span class="keyword">(</span><span class="default">$callback</span><span class="keyword">) === </span><span class="default">false</span><span class="keyword">) break;<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp; }<br />
<br />
}<br />
<br />
function </span><span class="default">hello</span><span class="keyword">() {<br />
&nbsp; echo </span><span class="string">"Hello from function hello()\n"</span><span class="keyword">;<br />
}<br />
<br />
class </span><span class="default">Foo </span><span class="keyword">{<br />
&nbsp; function </span><span class="default">hello</span><span class="keyword">() {<br />
&nbsp;&nbsp;&nbsp; echo </span><span class="string">"Hello from foo-&gt;hello()\n"</span><span class="keyword">;<br />
&nbsp; }<br />
}<br />
<br />
class </span><span class="default">Bar </span><span class="keyword">{<br />
&nbsp; function </span><span class="default">hello</span><span class="keyword">() {<br />
&nbsp;&nbsp;&nbsp; echo </span><span class="string">"Hello from Bar::hello()\n"</span><span class="keyword">;<br />
&nbsp; }<br />
}<br />
<br />
</span><span class="default">$foo </span><span class="keyword">= new </span><span class="default">Foo</span><span class="keyword">();<br />
<br />
</span><span class="comment">// bind a global function to the 'test' event<br />
</span><span class="default">Event</span><span class="keyword">::</span><span class="default">bind</span><span class="keyword">(</span><span class="string">"test"</span><span class="keyword">, </span><span class="string">"hello"</span><span class="keyword">);<br />
<br />
</span><span class="comment">// bind an anonymous function<br />
</span><span class="default">Event</span><span class="keyword">::</span><span class="default">bind</span><span class="keyword">(</span><span class="string">"test"</span><span class="keyword">, function() { echo </span><span class="string">"Hello from anonymous function\n"</span><span class="keyword">; });<br />
<br />
</span><span class="comment">// bind an class function on an instance<br />
</span><span class="default">Event</span><span class="keyword">::</span><span class="default">bind</span><span class="keyword">(</span><span class="string">"test"</span><span class="keyword">, </span><span class="string">"hello"</span><span class="keyword">, </span><span class="default">$foo</span><span class="keyword">);<br />
<br />
</span><span class="comment">// bind a static class function<br />
</span><span class="default">Event</span><span class="keyword">::</span><span class="default">bind</span><span class="keyword">(</span><span class="string">"test"</span><span class="keyword">, </span><span class="string">"Bar::hello"</span><span class="keyword">);<br />
<br />
</span><span class="default">Event</span><span class="keyword">::</span><span class="default">run</span><span class="keyword">(</span><span class="string">"test"</span><span class="keyword">);<br />
<br />
</span><span class="comment">/* Output<br />
Hello from function hello()<br />
Hello from anonymous function<br />
Hello from foo-&gt;hello()<br />
Hello from Bar::hello()<br />
*/<br />
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="96341""></a>
  <div class="note">
   <strong class="user">ljackson at jjcons dot com</strong>
   <a href="#96341" class="date">22-Feb-2010 07:46</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
appears kwilson at shuttlebox dot net that you may have just made unintended side effect. Note that adding the global $variable to your test function make the closure function echo second rather than first So the anonymous function works as expected with respect to globals.<br />
<br />
<span class="default">&lt;?php<br />
&nbsp;&nbsp;&nbsp; $variable </span><span class="keyword">= </span><span class="string">"first"</span><span class="keyword">;<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$closure </span><span class="keyword">= function() {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; global </span><span class="default">$variable</span><span class="keyword">;<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; echo </span><span class="default">$variable </span><span class="keyword">. </span><span class="string">"\n"</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; };<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$closure</span><span class="keyword">();<br />
<br />
&nbsp;&nbsp;&nbsp; function </span><span class="default">test</span><span class="keyword">(</span><span class="default">$closure</span><span class="keyword">)<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; global </span><span class="default">$variable</span><span class="keyword">; </span><span class="comment">//Note the scope added here <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$variable </span><span class="keyword">= </span><span class="string">"second"</span><span class="keyword">;<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$closure</span><span class="keyword">();<br />
&nbsp;&nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">test</span><span class="keyword">(</span><span class="default">$closure</span><span class="keyword">);<br />
</span><span class="default">?&gt;<br />
</span><br />
prints:<br />
first<br />
second<br />
<br />
tested with php 5.3.1</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="95778""></a>
  <div class="note">
   <strong class="user">kwilson at shuttlebox dot net</strong>
   <a href="#95778" class="date">21-Jan-2010 04:24</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Using the global keyword apparently pulls variables from the scope where the function was created, not where it is executed. <br />
<br />
Example:<br />
<br />
<span class="default">&lt;?php<br />
&nbsp;&nbsp;&nbsp; $variable </span><span class="keyword">= </span><span class="string">"first"</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$closure </span><span class="keyword">= function() {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; global </span><span class="default">$variable</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; echo </span><span class="default">$variable </span><span class="keyword">. </span><span class="string">"\n"</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; };<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$closure</span><span class="keyword">();<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; function </span><span class="default">test</span><span class="keyword">(</span><span class="default">$closure</span><span class="keyword">)<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$variable </span><span class="keyword">= </span><span class="string">"second"</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$closure</span><span class="keyword">();<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; </span><span class="default">test</span><span class="keyword">(</span><span class="default">$closure</span><span class="keyword">);<br />
</span><span class="default">?&gt;<br />
</span><br />
Will print:<br />
<br />
first<br />
first</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="95124""></a>
  <div class="note">
   <strong class="user">puskulcu at gmail dot com</strong>
   <a href="#95124" class="date">14-Dec-2009 09:46</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
hello there!<br />
here is a little code which shows use of the closures as event handlers:<br />
<br />
<span class="default">&lt;?php<br />
<br />
&nbsp; </span><span class="keyword">class </span><span class="default">Button<br />
&nbsp; </span><span class="keyword">{<br />
&nbsp;&nbsp;&nbsp; public </span><span class="default">$OnBeforeClick</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; public </span><span class="default">$OnAfterClick</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; public </span><span class="default">$Name</span><span class="keyword">;<br />
<br />
&nbsp;&nbsp;&nbsp; function </span><span class="default">Button</span><span class="keyword">()<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">Name </span><span class="keyword">= </span><span class="string">'MyButton'</span><span class="keyword">;&nbsp; &nbsp; <br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; public function </span><span class="default">Click</span><span class="keyword">()<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">DoBeforeClick</span><span class="keyword">();<br />
&nbsp;&nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp;&nbsp; echo </span><span class="string">'Click!'</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">DoAfterClick</span><span class="keyword">();<br />
&nbsp;&nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp;&nbsp; private function </span><span class="default">DoBeforeClick</span><span class="keyword">()<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp;&nbsp; if (isset(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">OnBeforeClick</span><span class="keyword">))<br />
&nbsp;&nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$Event </span><span class="keyword">= </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">OnBeforeClick</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$Event</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp;&nbsp; private function </span><span class="default">DoAfterClick</span><span class="keyword">()<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp;&nbsp; if (isset(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">OnAfterClick</span><span class="keyword">))<br />
&nbsp;&nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$Event </span><span class="keyword">= </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">OnAfterClick</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$Event</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp; }<br />
&nbsp; <br />
&nbsp; </span><span class="comment">//eclipse may warn here about syntax error but no problem, it runs well.<br />
&nbsp; </span><span class="default">$BeforeClickEventHandler </span><span class="keyword">= function(</span><span class="default">$Sender</span><span class="keyword">) { echo </span><span class="default">$Sender</span><span class="keyword">-&gt;</span><span class="default">Name </span><span class="keyword">. </span><span class="string">' (Before Click)'</span><span class="keyword">; };&nbsp; <br />
&nbsp; </span><span class="default">$AfterClickEventHandler </span><span class="keyword">= function(</span><span class="default">$Sender</span><span class="keyword">) { echo </span><span class="default">$Sender</span><span class="keyword">-&gt;</span><span class="default">Name </span><span class="keyword">. </span><span class="string">' (After Click)'</span><span class="keyword">; };&nbsp; <br />
&nbsp; <br />
&nbsp; </span><span class="default">$MyWidget </span><span class="keyword">= new </span><span class="default">Button</span><span class="keyword">();<br />
&nbsp; </span><span class="default">$MyWidget</span><span class="keyword">-&gt;</span><span class="default">OnBeforeClick </span><span class="keyword">= </span><span class="default">$BeforeClickEventHandler</span><span class="keyword">;<br />
&nbsp; </span><span class="default">$MyWidget</span><span class="keyword">-&gt;</span><span class="default">OnAfterClick </span><span class="keyword">= </span><span class="default">$AfterClickEventHandler</span><span class="keyword">;<br />
&nbsp; </span><span class="default">$MyWidget</span><span class="keyword">-&gt;</span><span class="default">Click</span><span class="keyword">();<br />
<br />
</span><span class="default">?&gt;<br />
</span><br />
output:<br />
MyButton (Before Click)<br />
Click!<br />
MyButton (After Click)<br />
<br />
i hope you find this useful.<br />
regards.<br />
emre</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="94804""></a>
  <div class="note">
   <strong class="user">rob at ubrio dot us</strong>
   <a href="#94804" class="date">25-Nov-2009 07:20</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
You can always call protected members using the __call() method - similar to how you hack around this in Ruby using send.
<br />

<br />
<span class="default">&lt;?php
<br />

<br />
</span><span class="keyword">class </span><span class="default">Fun
<br />
</span><span class="keyword">{
<br />
&nbsp;protected function </span><span class="default">debug</span><span class="keyword">(</span><span class="default">$message</span><span class="keyword">)
<br />
&nbsp;{
<br />
&nbsp;&nbsp; echo </span><span class="string">"DEBUG: </span><span class="default">$message</span><span class="string">\n"</span><span class="keyword">;
<br />
&nbsp;}
<br />

<br />
&nbsp;public function </span><span class="default">yield_something</span><span class="keyword">(</span><span class="default">$callback</span><span class="keyword">)
<br />
&nbsp;{
<br />
&nbsp;&nbsp; return </span><span class="default">$callback</span><span class="keyword">(</span><span class="string">"Soemthing!!"</span><span class="keyword">);
<br />
&nbsp;}
<br />

<br />
&nbsp;public function </span><span class="default">having_fun</span><span class="keyword">()
<br />
&nbsp;{
<br />
&nbsp;&nbsp; </span><span class="default">$self </span><span class="keyword">=&amp; </span><span class="default">$this</span><span class="keyword">;
<br />
&nbsp;&nbsp; return </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">yield_something</span><span class="keyword">(function(</span><span class="default">$data</span><span class="keyword">) use (&amp;</span><span class="default">$self</span><span class="keyword">)
<br />
&nbsp;&nbsp; {
<br />
&nbsp;&nbsp; &nbsp; </span><span class="default">$self</span><span class="keyword">-&gt;</span><span class="default">debug</span><span class="keyword">(</span><span class="string">"Doing stuff to the data"</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; </span><span class="comment">// do something with $data
<br />
&nbsp;&nbsp; &nbsp; </span><span class="default">$self</span><span class="keyword">-&gt;</span><span class="default">debug</span><span class="keyword">(</span><span class="string">"Finished doing stuff with the data."</span><span class="keyword">);
<br />
&nbsp;&nbsp; });
<br />
&nbsp;}
<br />

<br />
&nbsp;</span><span class="comment">// Ah-Ha!
<br />
&nbsp;</span><span class="keyword">public function </span><span class="default">__call</span><span class="keyword">(</span><span class="default">$method</span><span class="keyword">, </span><span class="default">$args </span><span class="keyword">= array())
<br />
&nbsp;{
<br />
&nbsp;&nbsp; if(</span><span class="default">is_callable</span><span class="keyword">(array(</span><span class="default">$this</span><span class="keyword">, </span><span class="default">$method</span><span class="keyword">)))
<br />
&nbsp;&nbsp; &nbsp; return </span><span class="default">call_user_func_array</span><span class="keyword">(array(</span><span class="default">$this</span><span class="keyword">, </span><span class="default">$method</span><span class="keyword">), </span><span class="default">$args</span><span class="keyword">);
<br />
&nbsp;}
<br />
}
<br />

<br />
</span><span class="default">$fun </span><span class="keyword">= new </span><span class="default">Fun</span><span class="keyword">();
<br />
echo </span><span class="default">$fun</span><span class="keyword">-&gt;</span><span class="default">having_fun</span><span class="keyword">();
<br />

<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="94313""></a>
  <div class="note">
   <strong class="user">mike at blueroot dot co dot uk</strong>
   <a href="#94313" class="date">28-Oct-2009 05:40</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
To recursively call a closure, use this code.
<br />

<br />
<span class="default">&lt;?php
<br />
$recursive </span><span class="keyword">= function () use (&amp;</span><span class="default">$recursive</span><span class="keyword">){
<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">// The function is now available as $recursive
<br />
</span><span class="keyword">}
<br />
</span><span class="default">?&gt;
<br />
</span>
<br />
This DOES NOT WORK
<br />

<br />
<span class="default">&lt;?php
<br />
$recursive </span><span class="keyword">= function () use (</span><span class="default">$recursive</span><span class="keyword">){
<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">// The function is now available as $recursive
<br />
</span><span class="keyword">}
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="94037""></a>
  <div class="note">
   <strong class="user">kukoman at pobox dot sk</strong>
   <a href="#94037" class="date">13-Oct-2009 02:22</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
be aware of&nbsp; Fatal error: Using $this when not in object context when using in closures<br />
<br />
<a href="http://wiki.php.net/rfc/closures/removal-of-this" rel="nofollow" target="_blank">http://wiki.php.net/rfc/closures/removal-of-this</a></span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="93935""></a>
  <div class="note">
   <strong class="user">gerard at visei dot nl</strong>
   <a href="#93935" class="date">07-Oct-2009 04:41</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
The text above the third example tries to explain that anonymous functions can inherit variables from the parent scope, but fails to properly explain how this is done: namely using the "use" keyword in the function definition.<br />
<br />
The following page has a much more detailed explanation of closures in PHP 5.3:<br />
<a href="http://wiki.php.net/rfc/closures" rel="nofollow" target="_blank">http://wiki.php.net/rfc/closures</a></span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="92818""></a>
  <div class="note">
   <strong class="user">dave at mausner dot us</strong>
   <a href="#92818" class="date">10-Aug-2009 11:34</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Ulderico had it almost right.&nbsp; To avoid confusing the interpreter, when using a simple closure stored in a $variable, you must invoke the nameless function using the function syntax.<br />
<br />
<span class="default">&lt;?php <br />
$helloworld </span><span class="keyword">= function(){ <br />
&nbsp;&nbsp;&nbsp; return </span><span class="string">"each hello world is different... "</span><span class="keyword">.</span><span class="default">date</span><span class="keyword">(</span><span class="string">"His"</span><span class="keyword">); <br />
}; <br />
<br />
echo </span><span class="default">$helloworld</span><span class="keyword">( ); <br />
</span><span class="default">?&gt;</span> <br />
<br />
Note the empty actual-parameter list in the "echo".&nbsp; NOW IT WORKS.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="92664""></a>
  <div class="note">
   <strong class="user">Anonymous</strong>
   <a href="#92664" class="date">03-Aug-2009 11:50</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If you want to check whether you're dealing with a closure specifically and not a string or array callback you can do this:<br />
<br />
<span class="default">&lt;?php<br />
$isAClosure </span><span class="keyword">= </span><span class="default">is_callable</span><span class="keyword">(</span><span class="default">$thing</span><span class="keyword">) &amp;&amp; </span><span class="default">is_object</span><span class="keyword">(</span><span class="default">$thing</span><span class="keyword">);<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="91871""></a>
  <div class="note">
   <strong class="user">mcm dot matt at gmail dot com</strong>
   <a href="#91871" class="date">30-Jun-2009 02:49</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Example using uasort.<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="comment">// Usual method.<br />
</span><span class="keyword">function </span><span class="default">cmp</span><span class="keyword">(</span><span class="default">$a</span><span class="keyword">, </span><span class="default">$b</span><span class="keyword">) {<br />
&nbsp;&nbsp;&nbsp; return(</span><span class="default">$a </span><span class="keyword">&gt; </span><span class="default">$b</span><span class="keyword">);<br />
}<br />
</span><span class="default">uasort</span><span class="keyword">(</span><span class="default">$array</span><span class="keyword">, </span><span class="string">'cmp'</span><span class="keyword">);<br />
<br />
</span><span class="comment">// New<br />
</span><span class="default">uasort</span><span class="keyword">(</span><span class="default">$array</span><span class="keyword">, function(</span><span class="default">$a</span><span class="keyword">, </span><span class="default">$b</span><span class="keyword">) {<br />
&nbsp;&nbsp;&nbsp; return(</span><span class="default">$a </span><span class="keyword">&gt; </span><span class="default">$b</span><span class="keyword">);<br />
});<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="91610""></a>
  <div class="note">
   <strong class="user">a dot schaffhirt at sedna-soft dot de</strong>
   <a href="#91610" class="date">19-Jun-2009 11:55</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
When using anonymous functions as properties in Classes, note that there are three name scopes: one for constants, one for properties and one for methods. That means, you can use the same name for a constant, for a property and for a method at a time.<br />
<br />
Since a property can be also an anonymous function as of PHP 5.3.0, an oddity arises when they share the same name, not meaning that there would be any conflict.<br />
<br />
Consider the following example:<br />
<br />
<span class="default">&lt;?php<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">class </span><span class="default">MyClass </span><span class="keyword">{<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; const </span><span class="default">member </span><span class="keyword">= </span><span class="default">1</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; public </span><span class="default">$member</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; public function </span><span class="default">member </span><span class="keyword">() {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="string">"method 'member'"</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; public function </span><span class="default">__construct </span><span class="keyword">() {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">member </span><span class="keyword">= function () {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="string">"anonymous function 'member'"</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; };<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; </span><span class="default">header</span><span class="keyword">(</span><span class="string">"Content-Type: text/plain"</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$myObj </span><span class="keyword">= new </span><span class="default">MyClass</span><span class="keyword">();<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">var_dump</span><span class="keyword">(</span><span class="default">MyClass</span><span class="keyword">::</span><span class="default">member</span><span class="keyword">);&nbsp; </span><span class="comment">// int(1)<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">var_dump</span><span class="keyword">(</span><span class="default">$myObj</span><span class="keyword">-&gt;</span><span class="default">member</span><span class="keyword">);&nbsp;&nbsp; </span><span class="comment">// object(Closure)#2 (0) {}<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">var_dump</span><span class="keyword">(</span><span class="default">$myObj</span><span class="keyword">-&gt;</span><span class="default">member</span><span class="keyword">()); </span><span class="comment">// string(15) "method 'member'"<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$myMember </span><span class="keyword">= </span><span class="default">$myObj</span><span class="keyword">-&gt;</span><span class="default">member</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">var_dump</span><span class="keyword">(</span><span class="default">$myMember</span><span class="keyword">());&nbsp; &nbsp; &nbsp; </span><span class="comment">// string(27) "anonymous function 'member'"<br />
</span><span class="default">?&gt;<br />
</span><br />
That means, regular method invocations work like expected and like before. The anonymous function instead, must be retrieved into a variable first (just like a property) and can only then be invoked.<br />
<br />
Best regards,</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
</div>
</div>
</div></div></body></html>
