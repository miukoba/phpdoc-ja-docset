<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
 <head>
  <meta http-equiv="content-type" content="text/html; CHARSET=shift-jis">
  <title>内部のドキュメントを HTML 形式の文字列として出力する</title>

  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <link media="all" rel="stylesheet" type="text/css" href="style.css"/>
 </head>
 <body class="docs" class="docs"><div class="navbar navbar-fixed-top">
  <div class="navbar-inner clearfix">
    <ul class="nav" style="width: 100%">
      <li style="float: left;"><a href="domdocument.save.html">≪ DOMDocument::save</a></li>
      <li style="float: right;"><a href="domdocument.savehtmlfile.html">DOMDocument::saveHTMLFile ≫</a></li>
    </ul>
  </div>
</div>
<div id="breadcrumbs" class="clearfix">
  <ul class="breadcrumbs-container">
    <li><a href="index.html">PHP Manual</a></li>
    <li><a href="class.domdocument.html">DOMDocument</a></li>
    <li>内部のドキュメントを HTML 形式の文字列として出力する</li>
  </ul>
</div>
<div id="layout">
  <div id="layout-content"><div id="domdocument.savehtml" class="refentry">
 <div class="refnamediv">
  <h1 class="refname">DOMDocument::saveHTML</h1>
  <p class="verinfo">(PHP 5)</p><p class="refpurpose"><span class="refname">DOMDocument::saveHTML</span> &mdash; <span class="dc-title">
   内部のドキュメントを HTML 形式の文字列として出力する
  </span></p>

 </div>
 <div class="refsect1 description" id="refsect1-domdocument.savehtml-description">
  <h3 class="title">説明</h3>
  <div class="methodsynopsis dc-description">
   <span class="modifier">public</span> <span class="type">string</span> <span class="methodname"><strong>DOMDocument::saveHTML</strong></span>
    ([ <span class="methodparam"><span class="type"><a href="class.domnode.html" class="type DOMNode">DOMNode</a></span> <code class="parameter">$node</code><span class="initializer"> = NULL</span></span>
  ] )</div>

  <p class="para rdfs-comment">
   DOM 表現から HTML ドキュメントを作成します。この関数は、通常は以下の例のように
   DOM ドキュメントを新しく作成した後にコールされます。
  </p>
 </div>


 <div class="refsect1 parameters" id="refsect1-domdocument.savehtml-parameters">
  <h3 class="title">パラメータ</h3>
  <p class="para">
   <dl>

    
     <dt>
<code class="parameter">node</code></dt>

     <dd>

      <p class="para">
       ドキュメントのサブセットを出力するオプションのパラメータ。
      </p>
     </dd>

    
   </dl>

  </p>
 </div>

 
 <div class="refsect1 returnvalues" id="refsect1-domdocument.savehtml-returnvalues">
  <h3 class="title">返り値</h3>
  <p class="para">
   HTML、あるいはエラーが発生した場合は <strong><code>FALSE</code></strong> を返します。
  </p>
 </div>

 
 <div class="refsect1 changelog" id="refsect1-domdocument.savehtml-changelog">
  <h3 class="title">変更履歴</h3>
  <p class="para">
   <table class="doctable informaltable">
    
     <thead>
      <tr>
       <th>バージョン</th>
       <th>説明</th>
      </tr>

     </thead>

     <tbody class="tbody">
      <tr>
       <td>5.3.6</td>
       <td>
        <code class="parameter">node</code> パラメータが追加されました。
       </td>
      </tr>

     </tbody>
    
   </table>

  </p>
 </div>

 
 <div class="refsect1 examples" id="refsect1-domdocument.savehtml-examples">
  <h3 class="title">例</h3>
  <p class="para">
   <div class="example" id="example-5499">
    <p><strong>例1 HTML ツリーを文字列に保存する</strong></p>
    <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br /><br />$doc&nbsp;</span><span style="color: #007700">=&nbsp;new&nbsp;</span><span style="color: #0000BB">DOMDocument</span><span style="color: #007700">(</span><span style="color: #DD0000">'1.0'</span><span style="color: #007700">);<br /><br /></span><span style="color: #0000BB">$root&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$doc</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">createElement</span><span style="color: #007700">(</span><span style="color: #DD0000">'html'</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">$root&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$doc</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">appendChild</span><span style="color: #007700">(</span><span style="color: #0000BB">$root</span><span style="color: #007700">);<br /><br /></span><span style="color: #0000BB">$head&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$doc</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">createElement</span><span style="color: #007700">(</span><span style="color: #DD0000">'head'</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">$head&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$root</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">appendChild</span><span style="color: #007700">(</span><span style="color: #0000BB">$head</span><span style="color: #007700">);<br /><br /></span><span style="color: #0000BB">$title&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$doc</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">createElement</span><span style="color: #007700">(</span><span style="color: #DD0000">'title'</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">$title&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$head</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">appendChild</span><span style="color: #007700">(</span><span style="color: #0000BB">$title</span><span style="color: #007700">);<br /><br /></span><span style="color: #0000BB">$text&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$doc</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">createTextNode</span><span style="color: #007700">(</span><span style="color: #DD0000">'This&nbsp;is&nbsp;the&nbsp;title'</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">$text&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$title</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">appendChild</span><span style="color: #007700">(</span><span style="color: #0000BB">$text</span><span style="color: #007700">);<br /><br />echo&nbsp;</span><span style="color: #0000BB">$doc</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">saveHTML</span><span style="color: #007700">();<br /><br /></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
    </div>

   </div>
  </p>
 </div>

 <div class="refsect1 seealso" id="refsect1-domdocument.savehtml-seealso">
  <h3 class="title">参考</h3>
  <p class="para">
   <ul class="simplelist">
    <li class="member"><span class="methodname"><a href="domdocument.savehtmlfile.html" class="methodname" rel="rdfs-seeAlso">DOMDocument::saveHTMLFile()</a> - 内部のドキュメントを HTML 形式でファイルに出力する</span></li>
    <li class="member"><span class="methodname"><a href="domdocument.loadhtml.html" class="methodname" rel="rdfs-seeAlso">DOMDocument::loadHTML()</a> - 文字列から HTML を読み込む</span></li>
    <li class="member"><span class="methodname"><a href="domdocument.loadhtmlfile.html" class="methodname" rel="rdfs-seeAlso">DOMDocument::loadHTMLFile()</a> - ファイルから HTML を読み込む</span></li>
   </ul>
  </p>
 </div>

</div><div id="usernotes">
 <div class="head">
  <h3 class="title">User Contributed Notes</h3>
 </div>
<div id="allnotes">  <a name="103164""></a>
  <div class="note">
   <strong class="user">alvaro at demogracia dot com</strong>
   <a href="#103164" class="date">29-Mar-2011 08:04</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Since PHP/5.3.6, DOMDocument-&gt;saveHTML() accepts an optional DOMNode parameter similarly to DOMDocument-&gt;saveXML():<br />
<br />
<a href="http://bugs.php.net/bug.php?id=39771" rel="nofollow" target="_blank">http://bugs.php.net/bug.php?id=39771</a></span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="101074""></a>
  <div class="note">
   <strong class="user">Yajo</strong>
   <a href="#101074" class="date">24-Nov-2010 04:21</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Another way to workaround the &lt;script/&gt; problem is putting a semicolon (;) inside the script element.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="96116""></a>
  <div class="note">
   <strong class="user">Anonymous</strong>
   <a href="#96116" class="date">09-Feb-2010 04:52</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If you want a simpler way to get around the &lt;script&gt; tag problem try:<br />
<br />
<span class="default">&lt;?php<br />
<br />
&nbsp; $script </span><span class="keyword">= </span><span class="default">$doc</span><span class="keyword">-&gt;</span><span class="default">createElement </span><span class="keyword">(</span><span class="string">'script'</span><span class="keyword">);\<br />
&nbsp; </span><span class="comment">// Creating an empty text node forces &lt;script&gt;&lt;/script&gt;<br />
&nbsp; </span><span class="default">$script</span><span class="keyword">-&gt;</span><span class="default">appendChild </span><span class="keyword">(</span><span class="default">$doc</span><span class="keyword">-&gt;</span><span class="default">createTextNode </span><span class="keyword">(</span><span class="string">''</span><span class="keyword">));<br />
&nbsp; </span><span class="default">$head</span><span class="keyword">-&gt;</span><span class="default">appendChild </span><span class="keyword">(</span><span class="default">$script</span><span class="keyword">);<br />
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="90853""></a>
  <div class="note">
   <strong class="user">Anonymous</strong>
   <a href="#90853" class="date">13-May-2009 04:35</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
To avoid script tags from being output as &lt;script /&gt;, you can use the DOMDocumentFragment class:<br />
<br />
<span class="default">&lt;?php<br />
<br />
$doc </span><span class="keyword">= new </span><span class="default">DOMDocument</span><span class="keyword">();<br />
</span><span class="default">$doc </span><span class="keyword">-&gt; </span><span class="default">loadXML</span><span class="keyword">(</span><span class="default">$xmlstring</span><span class="keyword">);<br />
</span><span class="default">$fragment </span><span class="keyword">= </span><span class="default">$doc</span><span class="keyword">-&gt;</span><span class="default">createDocumentFragment</span><span class="keyword">();<br />
</span><span class="comment">/* Append the script element to the fragment using raw XML strings (will be preserved in their raw form) and if succesful proceed to insert it in the DOM tree */ <br />
</span><span class="keyword">if(</span><span class="default">$fragment</span><span class="keyword">-&gt;</span><span class="default">appendXML</span><span class="keyword">(</span><span class="string">"&lt;script type='text/javascript' src='</span><span class="default">$source</span><span class="string">'&gt;&lt;/script&gt;"</span><span class="keyword">) { <br />
&nbsp; </span><span class="default">$xpath </span><span class="keyword">= new </span><span class="default">DOMXpath</span><span class="keyword">(</span><span class="default">$doc</span><span class="keyword">);<br />
&nbsp; </span><span class="default">$resultlist </span><span class="keyword">= </span><span class="default">$xpath</span><span class="keyword">-&gt;</span><span class="default">query</span><span class="keyword">(</span><span class="string">"//*[local-name() = 'html']/*[local-name() = 'head']"</span><span class="keyword">); </span><span class="comment">/* namespace-safe method to find all head elements which are childs of the html element, should only return 1 match */<br />
&nbsp; </span><span class="keyword">foreach(</span><span class="default">$resultlist </span><span class="keyword">as </span><span class="default">$headnode</span><span class="keyword">)&nbsp; </span><span class="comment">// insert the script tag<br />
&nbsp;&nbsp; &nbsp; </span><span class="default">$headnode</span><span class="keyword">-&gt;</span><span class="default">appendChild</span><span class="keyword">(</span><span class="default">$fragment</span><span class="keyword">);<br />
}<br />
</span><span class="default">$doc</span><span class="keyword">-&gt;</span><span class="default">saveXML</span><span class="keyword">(); </span><span class="comment">/* and our script tags will still be &lt;script&gt;&lt;/script&gt; */<br />
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="88273""></a>
  <div class="note">
   <strong class="user">Bart Feenstra</strong>
   <a href="#88273" class="date">18-Jan-2009 07:17</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I am using this solution to prevent tags and the doctype from being added to the HTML string automatically:<br />
<br />
<span class="default">&lt;?php<br />
$html </span><span class="keyword">= </span><span class="string">'&lt;h1&gt;Hello world!&lt;/h1&gt;'</span><span class="keyword">;<br />
</span><span class="default">$html </span><span class="keyword">= </span><span class="string">'&lt;div&gt;' </span><span class="keyword">. </span><span class="default">$html </span><span class="keyword">. </span><span class="string">'&lt;/div&gt;'</span><span class="keyword">;<br />
</span><span class="default">$doc </span><span class="keyword">= new </span><span class="default">DOMDocument</span><span class="keyword">;<br />
</span><span class="default">$doc</span><span class="keyword">-&gt;</span><span class="default">loadHTML</span><span class="keyword">(</span><span class="default">$html</span><span class="keyword">);<br />
echo </span><span class="default">substr</span><span class="keyword">(</span><span class="default">$doc</span><span class="keyword">-&gt;</span><span class="default">saveXML</span><span class="keyword">(</span><span class="default">$doc</span><span class="keyword">-&gt;</span><span class="default">getElementsByTagName</span><span class="keyword">(</span><span class="string">'div'</span><span class="keyword">)-&gt;</span><span class="default">item</span><span class="keyword">(</span><span class="default">0</span><span class="keyword">)), </span><span class="default">5</span><span class="keyword">, -</span><span class="default">6</span><span class="keyword">)<br />
<br />
</span><span class="comment">// Outputs: "&lt;h1&gt;Hello world!&lt;/h1&gt;"<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="85165""></a>
  <div class="note">
   <strong class="user">m at hbblogs daught calm</strong>
   <a href="#85165" class="date">18-Aug-2008 05:41</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
This method, as of 5.2.6, will automatically add &lt;html&gt;&lt;body&gt; and &lt;!DOCTYPE&gt; tags to the document if they are missing, without asking whether you want them. In my application, I needed to use the DOM methods to manipulate just a fragment of html, so these tags were rather unhelpful.<br />
<br />
Here's a simple hack to remove them in case, like me, all you wanted to do was perform a few operations on an HTML fragment.<br />
<br />
$html_fragment = preg_replace('/^&lt;!DOCTYPE.+?&gt;/', '', str_replace( array('&lt;html&gt;', '&lt;/html&gt;', '&lt;body&gt;', '&lt;/body&gt;'), array('', '', '', ''), $dom-&gt;saveHTML()));</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="82800""></a>
  <div class="note">
   <strong class="user">Anonymous</strong>
   <a href="#82800" class="date">26-Apr-2008 05:15</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
<span class="default">&lt;?php
<br />
</span><span class="keyword">function </span><span class="default">getDOMString</span><span class="keyword">(</span><span class="default">$retNode</span><span class="keyword">) {
<br />
&nbsp; if (!</span><span class="default">$retNode</span><span class="keyword">) return </span><span class="default">null</span><span class="keyword">;
<br />
&nbsp; </span><span class="default">$retval </span><span class="keyword">= </span><span class="default">strtr</span><span class="keyword">(</span><span class="default">$retNode</span><span class="keyword">--&gt;</span><span class="default">ownerDocument</span><span class="keyword">-&gt;</span><span class="default">saveXML</span><span class="keyword">(</span><span class="default">$retNode</span><span class="keyword">),
<br />
&nbsp; array(
<br />
&nbsp;&nbsp;&nbsp; </span><span class="string">'&gt;&lt;/area&gt;' </span><span class="keyword">=&gt; </span><span class="string">' /&gt;'</span><span class="keyword">,
<br />
&nbsp;&nbsp;&nbsp; </span><span class="string">'&gt;&lt;/base&gt;' </span><span class="keyword">=&gt; </span><span class="string">' /&gt;'</span><span class="keyword">,
<br />
&nbsp;&nbsp;&nbsp; </span><span class="string">'&gt;&lt;/basefont&gt;' </span><span class="keyword">=&gt; </span><span class="string">' /&gt;'</span><span class="keyword">,
<br />
&nbsp;&nbsp;&nbsp; </span><span class="string">'&gt;&lt;/br&gt;' </span><span class="keyword">=&gt; </span><span class="string">' /&gt;'</span><span class="keyword">,
<br />
&nbsp;&nbsp;&nbsp; </span><span class="string">'&gt;&lt;/col&gt;' </span><span class="keyword">=&gt; </span><span class="string">' /&gt;'</span><span class="keyword">,
<br />
&nbsp;&nbsp;&nbsp; </span><span class="string">'&gt;&lt;/frame&gt;' </span><span class="keyword">=&gt; </span><span class="string">' /&gt;'</span><span class="keyword">,
<br />
&nbsp;&nbsp;&nbsp; </span><span class="string">'&gt;&lt;/hr&gt;' </span><span class="keyword">=&gt; </span><span class="string">' /&gt;'</span><span class="keyword">,
<br />
&nbsp;&nbsp;&nbsp; </span><span class="string">'&gt;&lt;/img&gt;' </span><span class="keyword">=&gt; </span><span class="string">' /&gt;'</span><span class="keyword">,
<br />
&nbsp;&nbsp;&nbsp; </span><span class="string">'&gt;&lt;/input&gt;' </span><span class="keyword">=&gt; </span><span class="string">' /&gt;'</span><span class="keyword">,
<br />
&nbsp;&nbsp;&nbsp; </span><span class="string">'&gt;&lt;/isindex&gt;' </span><span class="keyword">=&gt; </span><span class="string">' /&gt;'</span><span class="keyword">,
<br />
&nbsp;&nbsp;&nbsp; </span><span class="string">'&gt;&lt;/link&gt;' </span><span class="keyword">=&gt; </span><span class="string">' /&gt;'</span><span class="keyword">,
<br />
&nbsp;&nbsp;&nbsp; </span><span class="string">'&gt;&lt;/meta&gt;' </span><span class="keyword">=&gt; </span><span class="string">' /&gt;'</span><span class="keyword">,
<br />
&nbsp;&nbsp;&nbsp; </span><span class="string">'&gt;&lt;/param&gt;' </span><span class="keyword">=&gt; </span><span class="string">' /&gt;'</span><span class="keyword">,
<br />
&nbsp;&nbsp;&nbsp; </span><span class="string">'default:' </span><span class="keyword">=&gt; </span><span class="string">''</span><span class="keyword">, 
<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">// sometimes, you have to decode entities too...
<br />
&nbsp;&nbsp;&nbsp; </span><span class="string">'&amp;quot;' </span><span class="keyword">=&gt; </span><span class="string">'&amp;#34;'</span><span class="keyword">,
<br />
&nbsp;&nbsp;&nbsp; </span><span class="string">'&amp;amp;' </span><span class="keyword">=&gt;&nbsp; </span><span class="string">'&amp;#38;'</span><span class="keyword">,
<br />
&nbsp;&nbsp;&nbsp; </span><span class="string">'&amp;apos;' </span><span class="keyword">=&gt; </span><span class="string">'&amp;#39;'</span><span class="keyword">,
<br />
&nbsp;&nbsp;&nbsp; </span><span class="string">'&amp;lt;' </span><span class="keyword">=&gt;&nbsp;&nbsp; </span><span class="string">'&amp;#60;'</span><span class="keyword">,
<br />
&nbsp;&nbsp;&nbsp; </span><span class="string">'&amp;gt;' </span><span class="keyword">=&gt;&nbsp;&nbsp; </span><span class="string">'&amp;#62;'</span><span class="keyword">,
<br />
&nbsp;&nbsp;&nbsp; </span><span class="string">'&amp;nbsp;' </span><span class="keyword">=&gt; </span><span class="string">'&amp;#160;'</span><span class="keyword">,
<br />
&nbsp;&nbsp;&nbsp; </span><span class="string">'&amp;copy;' </span><span class="keyword">=&gt; </span><span class="string">'&amp;#169;'</span><span class="keyword">,
<br />
&nbsp;&nbsp;&nbsp; </span><span class="string">'&amp;laquo;' </span><span class="keyword">=&gt; </span><span class="string">'&amp;#171;'</span><span class="keyword">,
<br />
&nbsp;&nbsp;&nbsp; </span><span class="string">'&amp;reg;' </span><span class="keyword">=&gt;&nbsp;&nbsp; </span><span class="string">'&amp;#174;'</span><span class="keyword">,
<br />
&nbsp;&nbsp;&nbsp; </span><span class="string">'&amp;raquo;' </span><span class="keyword">=&gt; </span><span class="string">'&amp;#187;'</span><span class="keyword">,
<br />
&nbsp;&nbsp;&nbsp; </span><span class="string">'&amp;trade;' </span><span class="keyword">=&gt; </span><span class="string">'&amp;#8482;'
<br />
&nbsp; </span><span class="keyword">));
<br />
&nbsp; return </span><span class="default">$retval</span><span class="keyword">;
<br />
}
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="81235""></a>
  <div class="note">
   <strong class="user">mjaque at ilkebenson dot com</strong>
   <a href="#81235" class="date">19-Feb-2008 08:34</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
DOMDocument-&gt;saveXML() doesn't generate a proper XHTML format either.
<br />

<br />
There is a problem with "script" empty elements. For example:
<br />

<br />
This will be the code generated by saveXML, with an empty script tag.
<br />

<br />
&lt;html&gt;
<br />
&nbsp; &lt;head&gt;
<br />
&nbsp;&nbsp;&nbsp; &lt;script type="text/JavaScript" src="myScript.js"/&gt;
<br />
&nbsp; &lt;/head&gt;
<br />
&nbsp; &lt;body&gt;
<br />
&nbsp;&nbsp;&nbsp; &lt;p&gt;I will not appear&lt;/p&gt;
<br />
&nbsp;&nbsp;&nbsp; &lt;script type="text/JavaScript"&gt;
<br />
&nbsp;&nbsp;&nbsp; alert("Not working");
<br />
&nbsp;&nbsp;&nbsp; &lt;/script&gt;
<br />
&nbsp; &lt;/body&gt;
<br />
&lt;/html&gt;
<br />

<br />
I don't know if this is valid XHTML (W3C Validator doesn't complain), but both FF 2.0 and IE 6 will not render it properly. Both will use &lt;/script&gt; as the closing tag for the first script causing js errors and ignoring in between elements.
<br />

<br />
You can post-process saveXML string in order to close empty tags with the following function:
<br />

<br />
<span class="default">&lt;?php
<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">function </span><span class="default">cerrarTag</span><span class="keyword">(</span><span class="default">$tag</span><span class="keyword">, </span><span class="default">$xml</span><span class="keyword">){
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$indice </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; while (</span><span class="default">$indice</span><span class="keyword">&lt; </span><span class="default">strlen</span><span class="keyword">(</span><span class="default">$xml</span><span class="keyword">)){
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$pos </span><span class="keyword">= </span><span class="default">strpos</span><span class="keyword">(</span><span class="default">$xml</span><span class="keyword">, </span><span class="string">"&lt;</span><span class="default">$tag</span><span class="string"> "</span><span class="keyword">, </span><span class="default">$indice</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">$pos</span><span class="keyword">){
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$posCierre </span><span class="keyword">= </span><span class="default">strpos</span><span class="keyword">(</span><span class="default">$xml</span><span class="keyword">, </span><span class="string">"&gt;"</span><span class="keyword">, </span><span class="default">$pos</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">$xml</span><span class="keyword">[</span><span class="default">$posCierre</span><span class="keyword">-</span><span class="default">1</span><span class="keyword">] == </span><span class="string">"/"</span><span class="keyword">){
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$xml </span><span class="keyword">= </span><span class="default">substr_replace</span><span class="keyword">(</span><span class="default">$xml</span><span class="keyword">, </span><span class="string">"&gt;&lt;/</span><span class="default">$tag</span><span class="string">&gt;"</span><span class="keyword">, </span><span class="default">$posCierre</span><span class="keyword">-</span><span class="default">1</span><span class="keyword">, </span><span class="default">2</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$indice </span><span class="keyword">= </span><span class="default">$posCierre</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; else break;
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">$xml</span><span class="keyword">;
<br />
&nbsp;&nbsp;&nbsp; }
<br />
</span><span class="default">?&gt;
<br />
</span>
<br />
At least script and select empty elements should be closed. This example shows how it can be used:
<br />

<br />
<span class="default">&lt;?php
<br />
&nbsp;&nbsp;&nbsp; define</span><span class="keyword">(</span><span class="string">"CABECERA_XHTML"</span><span class="keyword">, </span><span class="string">'&lt;!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "<a href="http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd" rel="nofollow" target="_blank">http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd</a>"&gt;'</span><span class="keyword">);
<br />

<br />
&nbsp; </span><span class="default">$xhtml </span><span class="keyword">= </span><span class="default">$docXML</span><span class="keyword">-&gt;</span><span class="default">saveXML</span><span class="keyword">(</span><span class="default">$docXML</span><span class="keyword">-&gt;</span><span class="default">documentElement</span><span class="keyword">);
<br />
&nbsp; </span><span class="default">$xhtml </span><span class="keyword">= </span><span class="default">cerrarTag</span><span class="keyword">(</span><span class="string">"script"</span><span class="keyword">, </span><span class="default">$xhtml</span><span class="keyword">);
<br />
&nbsp; </span><span class="default">$xhtml </span><span class="keyword">= </span><span class="default">cerrarTag</span><span class="keyword">(</span><span class="string">"select"</span><span class="keyword">, </span><span class="default">$xhtml</span><span class="keyword">);
<br />
&nbsp; </span><span class="default">$xhtml </span><span class="keyword">= </span><span class="default">CABECERA_XHTML</span><span class="keyword">.</span><span class="string">"\n"</span><span class="keyword">.</span><span class="default">$xhtml</span><span class="keyword">;
<br />
&nbsp; echo </span><span class="default">$xhtml</span><span class="keyword">;
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="79444""></a>
  <div class="note">
   <strong class="user">archanglmr at yahoo dot com</strong>
   <a href="#79444" class="date">28-Nov-2007 12:28</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If created your DOMDocument object using loadHTML() (where the source is from another site) and want to pass your changes back to the browser you should make sure the HTTP Content-Type header matches your meta content-type tags value because modern browsers seem to ignore the meta tag and trust just the HTTP header. For example if you're reading an ISO-8859-1 document and your web server is claiming UTF-8 you need to correct it using the header() function.<br />
<br />
<span class="default">&lt;?php<br />
header</span><span class="keyword">(</span><span class="string">'Content-Type: text/html; charset=iso-8859-1'</span><span class="keyword">);<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="79319""></a>
  <div class="note">
   <strong class="user">xoplqox</strong>
   <a href="#79319" class="date">20-Nov-2007 08:07</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
XHTML:<br />
<br />
If the output is XHTML use the function saveXML().<br />
<br />
Output example for saveHTML:<br />
<br />
&lt;select name="pet" size="3" multiple&gt;<br />
&nbsp;&nbsp;&nbsp; &lt;option selected&gt;mouse&lt;/option&gt;<br />
&nbsp;&nbsp;&nbsp; &lt;option&gt;bird&lt;/option&gt;<br />
&nbsp;&nbsp;&nbsp; &lt;option&gt;cat&lt;/option&gt;<br />
&lt;/select&gt;<br />
<br />
XHTML conform output using saveXML:<br />
<br />
&lt;select name="pet" size="3" multiple="multiple"&gt;<br />
&nbsp;&nbsp;&nbsp; &lt;option selected="selected"&gt;mouse&lt;/option&gt;<br />
&nbsp;&nbsp;&nbsp; &lt;option&gt;bird&lt;/option&gt;<br />
&nbsp;&nbsp;&nbsp; &lt;option&gt;cat&lt;/option&gt;<br />
&lt;/select&gt;</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="52139""></a>
  <div class="note">
   <strong class="user">tyson at clugg dot net</strong>
   <a href="#52139" class="date">22-Apr-2005 02:44</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
<span class="default">&lt;?php<br />
</span><span class="comment">// Using DOM to fix sloppy HTML.<br />
// An example by Tyson Clugg &lt;tyson@clugg.net&gt;<br />
//<br />
// vim: syntax=php expandtab tabstop=2<br />
<br />
</span><span class="keyword">function </span><span class="default">tidyHTML</span><span class="keyword">(</span><span class="default">$buffer</span><span class="keyword">)<br />
{<br />
&nbsp; </span><span class="comment">// load our document into a DOM object<br />
&nbsp; </span><span class="default">$dom </span><span class="keyword">= @</span><span class="default">DOMDocument</span><span class="keyword">::</span><span class="default">loadHTML</span><span class="keyword">(</span><span class="default">$buffer</span><span class="keyword">);<br />
&nbsp; </span><span class="comment">// we want nice output<br />
&nbsp; </span><span class="default">$dom</span><span class="keyword">-&gt;</span><span class="default">formatOutput </span><span class="keyword">= </span><span class="default">true</span><span class="keyword">;<br />
&nbsp; return(</span><span class="default">$dom</span><span class="keyword">-&gt;</span><span class="default">saveHTML</span><span class="keyword">());<br />
}<br />
<br />
</span><span class="comment">// start output buffering, using our nice<br />
// callback funtion to format the output.<br />
</span><span class="default">ob_start</span><span class="keyword">(</span><span class="string">"tidyHTML"</span><span class="keyword">);<br />
<br />
</span><span class="default">?&gt;<br />
</span>&lt;html&gt;<br />
&lt;p&gt;It's like comparing apples to oranges.<br />
&lt;/html&gt;<br />
<span class="default">&lt;?php<br />
<br />
</span><span class="comment">// this will be called implicitly, but we'll<br />
// call it manually to illustrate the point.<br />
</span><span class="default">ob_end_flush</span><span class="keyword">();<br />
<br />
</span><span class="default">?&gt;<br />
</span><br />
The above code takes out sloppy HTML:<br />
&nbsp;&lt;html&gt;<br />
&nbsp;&lt;p&gt;It's like comparing apples to oranges.<br />
&nbsp;&lt;/html&gt;<br />
<br />
And cleans it up to the following:<br />
&nbsp;&lt;!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN" "<a href="http://www.w3.org/TR/REC-html40/loose.dtd" rel="nofollow" target="_blank">http://www.w3.org/TR/REC-html40/loose.dtd</a>"&gt;<br />
&nbsp;&lt;html&gt;&lt;body&gt;&lt;p&gt;It's like comparing apples to oranges.<br />
&nbsp;&lt;/p&gt;&lt;/body&gt;&lt;/html&gt;</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
</div>
</div>
</div></div></body></html>
