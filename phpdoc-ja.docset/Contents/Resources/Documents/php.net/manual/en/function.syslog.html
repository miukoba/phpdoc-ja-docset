<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
 <head>
  <meta http-equiv="content-type" content="text/html; CHARSET=shift-jis">
  <title>システムログのメッセージを生成する</title>

  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <link media="all" rel="stylesheet" type="text/css" href="style.css"/>
 </head>
 <body class="docs" class="docs"><div class="navbar navbar-fixed-top">
  <div class="navbar-inner clearfix">
    <ul class="nav" style="width: 100%">
      <li style="float: left;"><a href="function.socket-set-timeout.html">≪ socket_set_timeout</a></li>
      <li style="float: right;"><a href="book.rrd.html">RRD ≫</a></li>
    </ul>
  </div>
</div>
<div id="breadcrumbs" class="clearfix">
  <ul class="breadcrumbs-container">
    <li><a href="index.html">PHP Manual</a></li>
    <li><a href="ref.network.html">ネットワーク 関数</a></li>
    <li>システムログのメッセージを生成する</li>
  </ul>
</div>
<div id="layout">
  <div id="layout-content"><div id="function.syslog" class="refentry">
 <div class="refnamediv">
  <h1 class="refname">syslog</h1>
  <p class="verinfo">(PHP 4, PHP 5)</p><p class="refpurpose"><span class="refname">syslog</span> &mdash; <span class="dc-title">システムログのメッセージを生成する</span></p>

 </div>
 
 <div class="refsect1 description" id="refsect1-function.syslog-description">
  <h3 class="title">説明</h3>
  <div class="methodsynopsis dc-description">
   <span class="type">bool</span> <span class="methodname"><strong>syslog</strong></span>
    ( <span class="methodparam"><span class="type">int</span> <code class="parameter">$priority</code></span>
   , <span class="methodparam"><span class="type">string</span> <code class="parameter">$message</code></span>
   )</div>

  <p class="para rdfs-comment">
   <span class="function"><strong>syslog()</strong></span> はシステムログが出力するログメッセージを生成します。
  </p>
  <p class="para">
   ユーザー定義のログハンドラの設定に関する情報については、Unix マニュアルの
   <span class="citerefentry"><span class="refentrytitle">syslog.conf</span>
   <span class="manvolnum">(5)</span></span> を参照ください。 
   syslog の facility と option に関するより詳細な情報は、
   Unix マシンの <span class="citerefentry"><span class="refentrytitle">syslog</span>
   <span class="manvolnum">(3)</span></span> にあります。
  </p>
 </div>


 <div class="refsect1 parameters" id="refsect1-function.syslog-parameters">
  <h3 class="title">パラメータ</h3>
  <p class="para">
   <dl>

    
     <dt>
<code class="parameter">priority</code></dt>

     <dd>

      <p class="para">
       <code class="parameter">priority</code> は、容易さ (facility)
       とレベル (level) の組み合わせです。以下の値が使用できます。
       <table class="doctable table">
        <caption><strong><span class="function"><strong>syslog()</strong></span> の優先順位 (降順)</strong></caption>
        
         <thead>
          <tr>
           <th>定数</th>
           <th>説明</th>
          </tr>

         </thead>

         <tbody class="tbody">
          <tr>
           <td><strong><code>LOG_EMERG</code></strong></td>
           <td>システムは使用不可</td>
          </tr>

          <tr>
           <td><strong><code>LOG_ALERT</code></strong></td>
           <td>アクションを直ちにおこす必要がある</td>
          </tr>

          <tr>
           <td><strong><code>LOG_CRIT</code></strong></td>
           <td>致命的な条件</td>
          </tr>

          <tr>
           <td><strong><code>LOG_ERR</code></strong></td>
           <td>エラーを発生する条件</td>
          </tr>

          <tr>
           <td><strong><code>LOG_WARNING</code></strong></td>
           <td>警告を発生する条件</td>
          </tr>

          <tr>
           <td><strong><code>LOG_NOTICE</code></strong></td>
           <td>通常の動作だが、特徴的な条件</td>
          </tr>

          <tr>
           <td><strong><code>LOG_INFO</code></strong></td>
           <td>情報を与えるメッセージ</td>
          </tr>

          <tr>
           <td><strong><code>LOG_DEBUG</code></strong></td>
           <td>デバッグ用のメッセージ</td>
          </tr>

         </tbody>
        
       </table>

      </p>
     </dd>

    
    
     <dt>
<code class="parameter">message</code></dt>

     <dd>

      <p class="para">
       残りの引数は送信するメッセージです。ただし、文字 <em>%m</em>
       は、<span class="errortype">errno</span>
       の値に対応するエラーメッセージ文字列 (strerror) に置換されます。
      </p>
     </dd>

    
   </dl>

  </p>
 </div>


 <div class="refsect1 returnvalues" id="refsect1-function.syslog-returnvalues">
  <h3 class="title">返り値</h3>
  <p class="para">
   成功した場合に <strong><code>TRUE</code></strong> を、失敗した場合に <strong><code>FALSE</code></strong> を返します。
  </p>
 </div>


 <div class="refsect1 examples" id="refsect1-function.syslog-examples">
  <h3 class="title">例</h3>
  <p class="para">
   <div class="example" id="example-4602">
    <p><strong>例1 <span class="function"><strong>syslog()</strong></span> の使用例</strong></p>
    <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br /></span><span style="color: #FF8000">//&nbsp;syslogをオープンし、プロセスIDをインクルードし、標準エラー出力にも<br />//&nbsp;ログを出力します。そして、ユーザー定義のログ記録機構を使用します。<br /></span><span style="color: #0000BB">openlog</span><span style="color: #007700">(</span><span style="color: #DD0000">"myScriptLog"</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">LOG_PID&nbsp;</span><span style="color: #007700">|&nbsp;</span><span style="color: #0000BB">LOG_PERROR</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">LOG_LOCAL0</span><span style="color: #007700">);<br /><br /></span><span style="color: #FF8000">//&nbsp;何らかのコード<br /><br /></span><span style="color: #007700">if&nbsp;(</span><span style="color: #0000BB">authorized_client</span><span style="color: #007700">())&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">//&nbsp;何かをする<br /></span><span style="color: #007700">}&nbsp;else&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">//&nbsp;クライアントは未認証!<br />&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;ログを記録する<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$access&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">date</span><span style="color: #007700">(</span><span style="color: #DD0000">"Y/m/d&nbsp;H:i:s"</span><span style="color: #007700">);<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">syslog</span><span style="color: #007700">(</span><span style="color: #0000BB">LOG_WARNING</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">"Unauthorized&nbsp;client:&nbsp;</span><span style="color: #0000BB">$access</span><span style="color: #DD0000">&nbsp;</span><span style="color: #007700">{</span><span style="color: #0000BB">$_SERVER</span><span style="color: #007700">[</span><span style="color: #DD0000">'REMOTE_ADDR'</span><span style="color: #007700">]}</span><span style="color: #DD0000">&nbsp;(</span><span style="color: #007700">{</span><span style="color: #0000BB">$_SERVER</span><span style="color: #007700">[</span><span style="color: #DD0000">'HTTP_USER_AGENT'</span><span style="color: #007700">]}</span><span style="color: #DD0000">)"</span><span style="color: #007700">);<br />}<br /><br /></span><span style="color: #0000BB">closelog</span><span style="color: #007700">();<br /></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
    </div>

   </div>
  </p>
 </div>


 <div class="refsect1 notes" id="refsect1-function.syslog-notes">
  <h3 class="title">注意</h3>
  <p class="para">
   Windows NT では、syslog サービスはイベントログを使用してエミュレートされます。
  </p>
  <blockquote class="note"><p><strong class="note">注意</strong>: 
   <p class="para">
    Windows 環境では、<span class="function"><a href="function.openlog.html" class="function">openlog()</a></span> の
    <code class="parameter">facility</code> パラメータに
    <em>LOG_LOCAL0</em> から <em>LOG_LOCAL7</em>
    までを使用することはできません。
   </p>
  </p></blockquote>
 </div>


 <div class="refsect1 seealso" id="refsect1-function.syslog-seealso">
  <h3 class="title">参考</h3>
  <p class="para">
   <ul class="simplelist">
    <li class="member"><span class="function"><a href="function.openlog.html" class="function" rel="rdfs-seeAlso">openlog()</a> - システムのロガーへの接続をオープンする</span></li>
    <li class="member"><span class="function"><a href="function.closelog.html" class="function" rel="rdfs-seeAlso">closelog()</a> - システムログへの接続を閉じる</span></li>
   </ul>
  </p>
 </div>


</div><div id="usernotes">
 <div class="head">
  <h3 class="title">User Contributed Notes</h3>
 </div>
<div id="allnotes">  <a name="97843""></a>
  <div class="note">
   <strong class="user">Antonio Lobato</strong>
   <a href="#97843" class="date">11-May-2010 10:57</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
A word of warning; if you use openlog() to ready syslog() and your Apache threads accept multiple requests, you *must* call closelog() if Apache's error log is configured to write to syslog.&nbsp; Failure to do so will cause Apache's error log to write to whatever facility/ident was used in openlog.<br />
<br />
Example, in httpd.conf you have:<br />
<br />
ErrorLog syslog:local7<br />
<br />
and in php you do:<br />
<br />
<span class="default">&lt;?php<br />
openlog</span><span class="keyword">(</span><span class="string">"myprogram"</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">LOG_LOCAL0</span><span class="keyword">);<br />
</span><span class="default">syslog</span><span class="keyword">(</span><span class="string">"My syslog message"</span><span class="keyword">);<br />
</span><span class="default">?&gt;<br />
</span><br />
From here on out, this Apache thread will write ErrorLog to local0 and under the process name "myprogram" and not httpd!&nbsp; Calling closelog() will fix this.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="79554""></a>
  <div class="note">
   <strong class="user">james dot ellis at gmail dot com</strong>
   <a href="#79554" class="date">03-Dec-2007 05:26</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If anyone is wondering why their log messages are appearing in multiple log files, here is one answer applying to *nix systems:<br />
<br />
If your syslog.conf looks like this (assuming you use LOG_LOCAL0 for web app logging) :<br />
<br />
local0.info&nbsp; &nbsp; /var/log/web/info.log<br />
<br />
This will collect *all* messages of LOG_INFO level and higher, i.e everything except debug messages<br />
<br />
Try this instead to ensure that only messages of the named log level go into the relevant log file:<br />
<br />
local0.=info&nbsp; &nbsp; /var/log/web/info.log<br />
<br />
Additionally, you may like to add this to ensure your messages don't end up in generic log files like "messages"&nbsp; "all" "syslog" and "debug":<br />
<br />
local0.none&nbsp; &nbsp; /var/log/messages<br />
local0.none&nbsp; &nbsp; /var/log/debug<br />
etc<br />
<br />
saves disk space among other things - more at "man syslog.conf"</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="74486""></a>
  <div class="note">
   <strong class="user">helly at php dot net</strong>
   <a href="#74486" class="date">13-Apr-2007 02:49</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If you are using syslog-ng and want errors send to syslog then use ini setting "error_log = syslog" and add something like the following to your syslog-ng.conf:<br />
<br />
destination php { file("/var/log/php.log" owner(root) group(devel) perm(0620)); };<br />
log { source(src); filter(f_php); destination(php); };</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="74420""></a>
  <div class="note">
   <strong class="user">adam _at_ lockdownnetworks _dot_ com</strong>
   <a href="#74420" class="date">11-Apr-2007 03:32</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Be aware when using syslog() that if you set the timezone of environment to be something other than the standard, syslog() may log the time to the log(s) with the wrong time zone information. For example:<br />
<br />
<span class="default">&lt;?php<br />
<br />
openlog</span><span class="keyword">(</span><span class="string">'mylog'</span><span class="keyword">, </span><span class="default">LOG_PID </span><span class="keyword">| </span><span class="default">LOG_ODELAY</span><span class="keyword">,</span><span class="default">LOG_LOCAL4</span><span class="keyword">);<br />
<br />
</span><span class="default">putenv</span><span class="keyword">(</span><span class="string">'TZ=UTC'</span><span class="keyword">);<br />
</span><span class="default">syslog</span><span class="keyword">(</span><span class="default">LOG_INFO</span><span class="keyword">, </span><span class="string">'UTC Log line'</span><span class="keyword">);<br />
<br />
</span><span class="default">putenv</span><span class="keyword">(</span><span class="string">'TZ=US/Pacific'</span><span class="keyword">);<br />
</span><span class="default">syslog</span><span class="keyword">(</span><span class="default">LOG_INFO</span><span class="keyword">, </span><span class="string">'US/Pacific Log line'</span><span class="keyword">);<br />
<br />
</span><span class="default">closelog</span><span class="keyword">();<br />
<br />
</span><span class="default">?&gt;<br />
</span><br />
Viewing the /usr/log/messages log will display these two lines:<br />
<br />
Apr 11 01:25:39 hostname mylog[1400]: UTC Log line<br />
Apr 10 18:25:39 hostname mylog[1400]: US/Pacific Log line<br />
<br />
Adam.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="41832""></a>
  <div class="note">
   <strong class="user">Torsten</strong>
   <a href="#41832" class="date">23-Apr-2004 03:27</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I had a problem trying to issue a syslog message with IIS 5.1 under Windows XP. The function call seemed to succeed, but the event viewer showed that no entry was made.<br />
Finally I found out that the user account used for the webserver (IUSR_&lt;Computername&gt;) did not have enough permissions to issue syslog alerts. I changed this by adding this user to the Users group instead of only Guest.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="37201""></a>
  <div class="note">
   <strong class="user">daniele dot patoner at biblio dot unitn dot it</strong>
   <a href="#37201" class="date">06-Nov-2003 08:00</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
This work for me, to redirect&nbsp; logs to a separate syslog file<br />
<br />
put this line in your /etc/syslog.conf :<br />
<br />
local0.debug&nbsp;&nbsp; /var/log/php.log<br />
<br />
Then restart syslogd:<br />
<br />
/etc/init.d/syslog restart<br />
<br />
php example:<br />
<br />
<span class="default">&lt;?php<br />
define_syslog_variables</span><span class="keyword">();<br />
</span><span class="default">openlog</span><span class="keyword">(</span><span class="string">"TextLog"</span><span class="keyword">, </span><span class="default">LOG_PID</span><span class="keyword">, </span><span class="default">LOG_LOCAL0</span><span class="keyword">);<br />
<br />
</span><span class="default">$data </span><span class="keyword">= </span><span class="default">date</span><span class="keyword">(</span><span class="string">"Y/m/d H:i:s"</span><span class="keyword">);<br />
</span><span class="default">syslog</span><span class="keyword">(</span><span class="default">LOG_DEBUG</span><span class="keyword">,</span><span class="string">"Messagge: </span><span class="default">$data</span><span class="string">"</span><span class="keyword">);<br />
<br />
</span><span class="default">closelog</span><span class="keyword">();<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="34483""></a>
  <div class="note">
   <strong class="user">gregj at pdxperts dot com</strong>
   <a href="#34483" class="date">29-Jul-2003 02:05</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
The message string sent to the log file is limited to 500 characters.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="20346""></a>
  <div class="note">
   <strong class="user">nospam \100 jraxis com (that's right!)</strong>
   <a href="#20346" class="date">31-Mar-2002 05:32</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
This *does* actually goto the system log as configured in /etc/syslog.conf (such as /var/log/messages), it doesn't goto Apache's ErrorLog (such as /var/log/httpd/error_log). At least under my Debian Potato with Apache 1.3.23.<br />
<br />
Use error_log() to be sure it gets into Apache's ErrorLog.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="18624""></a>
  <div class="note">
   <strong class="user">dpreece at paradise dot net dot nz</strong>
   <a href="#18624" class="date">30-Jan-2002 01:08</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
To set up a custom log file via the syslog daemon (FreeBSD in this case)...<br />
<br />
Add to /etc/syslog.conf a line that says all errors from the httpd process are to go to a file called (for example) /var/log/httpd-php.log<br />
<br />
!httpd<br />
*.*&nbsp;&nbsp; {tab}&nbsp;&nbsp; /var/log/httpd-php.log<br />
<br />
Note the tab, being a tab character! Next create a blank file to be written to. I'm sure there are 1e+6 ways to do this, but I choose<br />
<br />
# cat &gt; httpd-php.log &lt;&lt; EOF<br />
? EOF<br />
<br />
Finally find your syslog daemon and send it a sighup to inform it of the change:<br />
<br />
# ps ax | grep syslogd<br />
&nbsp; 133&nbsp; ??&nbsp; Ss&nbsp; &nbsp;&nbsp; 0:07.23 syslogd -s<br />
# kill -1 133<br />
<br />
Et voila! Php syslog calls will now arrive in /var/log/httpd-php.log</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="10788""></a>
  <div class="note">
   <strong class="user">mavetju at chello dot nl</strong>
   <a href="#10788" class="date">22-Jan-2001 03:11</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
With FreeBSD I can use: syslog(LOG_INFO,"test");
<br />

<br />
BSD/OS does not support this, I had to use the literal values for the priority (158: local3.info):
<br />
syslog(158,"test");</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="10251""></a>
  <div class="note">
   <strong class="user">gherson at snet dot net</strong>
   <a href="#10251" class="date">20-Dec-2000 10:09</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Example of where to look for syslog's output:&nbsp;&nbsp; /var/log/httpd/access_log
<br />
(on Red Hat Linux Secure Server v6.2).</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="3813""></a>
  <div class="note">
   <strong class="user">rcgraves+php at brandeis dot edu</strong>
   <a href="#3813" class="date">17-Feb-2000 09:51</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
For the-header-file-enabled:
<br />

<br />
man 3 syslog defines the priorities, but not the integer values. For that you'll need to read your system header file.
<br />

<br />
Let's suppose I want to log an informational message in the mail log (which happens to be true). The man page tells me I want LOG_MAIL|LOG_INFO. So I look in /usr/include/sys/syslog.h and find (this happens to be Linux, your system could be different):
<br />

<br />
#define LOG_INFO&nbsp; &nbsp; &nbsp; &nbsp; 6&nbsp; &nbsp; &nbsp;&nbsp; /* informational */
<br />
#define LOG_MAIL&nbsp; &nbsp; &nbsp; &nbsp; (2&lt;&lt;3)&nbsp; /* mail system */
<br />

<br />
2&lt;&lt;3 means shift 3 bits left, which means multiply by 8. So I want 2*8 + 6 = 22. syslog(22,"this message will appear in the mail log"); And indeed it does.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="1563""></a>
  <div class="note">
   <strong class="user">bb at lb-data dot co dot at</strong>
   <a href="#1563" class="date">08-Sep-1999 12:54</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
In Windows NT, use the following values of priority:
<br />
1 = error,
<br />
6 = info</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
</div>
</div>
</div></div></body></html>
