<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
 <head>
  <meta http-equiv="content-type" content="text/html; CHARSET=shift-jis">
  <title>FreeType 2 によるフォントを用いてイメージにテキストを描画する</title>

  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <link media="all" rel="stylesheet" type="text/css" href="style.css"/>
 </head>
 <body class="docs" class="docs"><div class="navbar navbar-fixed-top">
  <div class="navbar-inner clearfix">
    <ul class="nav" style="width: 100%">
      <li style="float: left;"><a href="function.imageftbbox.html">≪ imageftbbox</a></li>
      <li style="float: right;"><a href="function.imagegammacorrect.html">imagegammacorrect ≫</a></li>
    </ul>
  </div>
</div>
<div id="breadcrumbs" class="clearfix">
  <ul class="breadcrumbs-container">
    <li><a href="index.html">PHP Manual</a></li>
    <li><a href="ref.image.html">GD および Image 関数</a></li>
    <li>FreeType 2 によるフォントを用いてイメージにテキストを描画する</li>
  </ul>
</div>
<div id="layout">
  <div id="layout-content"><div id="function.imagefttext" class="refentry">
 <div class="refnamediv">
  <h1 class="refname">imagefttext</h1>
  <p class="verinfo">(PHP 4 &gt;= 4.0.7, PHP 5)</p><p class="refpurpose"><span class="refname">imagefttext</span> &mdash; <span class="dc-title">FreeType 2 によるフォントを用いてイメージにテキストを描画する</span></p>

 </div>
 <div class="refsect1 description" id="refsect1-function.imagefttext-description">
  <h3 class="title">説明</h3>
  <div class="methodsynopsis dc-description">
   <span class="type">array</span> <span class="methodname"><strong>imagefttext</strong></span>
    ( <span class="methodparam"><span class="type">resource</span> <code class="parameter">$image</code></span>
   , <span class="methodparam"><span class="type">float</span> <code class="parameter">$size</code></span>
   , <span class="methodparam"><span class="type">float</span> <code class="parameter">$angle</code></span>
   , <span class="methodparam"><span class="type">int</span> <code class="parameter">$x</code></span>
   , <span class="methodparam"><span class="type">int</span> <code class="parameter">$y</code></span>
   , <span class="methodparam"><span class="type">int</span> <code class="parameter">$color</code></span>
   , <span class="methodparam"><span class="type">string</span> <code class="parameter">$fontfile</code></span>
   , <span class="methodparam"><span class="type">string</span> <code class="parameter">$text</code></span>
   [, <span class="methodparam"><span class="type">array</span> <code class="parameter">$extrainfo</code></span>
  ] )</div>

  <div class="warning"><strong class="warning">警告</strong><p class="simpara">この関数は、
現在のところ詳細な情報はありません。引数のリストのみが
記述されています。</p></div>
 </div>

 <div class="refsect1 parameters" id="refsect1-function.imagefttext-parameters">
  <h3 class="title">パラメータ</h3>
  <p class="para">
   <dl>

    <dt>
<code class="parameter">
image</code></dt>
<dd>
<p class="para"><span class="function"><a href="function.imagecreatetruecolor.html" class="function">imagecreatetruecolor()</a></span>
のような画像作成関数が返す画像リソース。</p></dd>

    
     <dt>
<code class="parameter">size</code></dt>

     <dd>

      <p class="para">
       使用するフォントのサイズ (ポイント数)。
      </p>
     </dd>

    
    
     <dt>
<code class="parameter">angle</code></dt>

     <dd>

      <p class="para"> 
       角度 (度数)。0 度は、左から右に読むテキストを表します。
       度数を上げていくと、反時計回りに回転します。たとえば、
       90 度の場合は下から上に読むテキストとなります。
      </p>
     </dd>

    
    
     <dt>
<code class="parameter">x</code></dt>

     <dd>

      <p class="para">
       <code class="parameter">x</code> と
       <code class="parameter">y</code> で表す座標が、最初の文字のベースポイント
       (その文字の左下の角とほぼ等しい点) となります。
       <span class="function"><a href="function.imagestring.html" class="function">imagestring()</a></span> の場合は
       <code class="parameter">x</code> と <code class="parameter">y</code>
       で最初の文字の左上の角を指定しており、
       たとえば &quot;左上&quot; は 0, 0 となりますが、この関数では異なります。
      </p>
     </dd>

    
    
     <dt>
<code class="parameter">y</code></dt>

     <dd>

      <p class="para">
       y 座標。これはフォントのベースラインを指定するものであり、
       文字の最下端を指定するものではありません。
      </p>
     </dd>

    
    
     <dt>
<code class="parameter">color</code></dt>

     <dd>

      <p class="para">
       テキストに使用する色のインデックス。
       <span class="function"><a href="function.imagecolorexact.html" class="function">imagecolorexact()</a></span> を参照ください。
      </p>
     </dd>

    
    
     <dt>
<code class="parameter">fontfile</code></dt>

     <dd>

      <p class="para">
       使用する TrueType フォントへのパス。
      </p>
      <p class="para">
       PHP が使用している GD ライブラリのバージョンにも依存しますが、
       <em class="emphasis"><code class="parameter">fontfile</code> の先頭に <em>/</em>
       がついていない場合はファイル名の末尾に
       <em>.ttf</em> を追加</em>して GD
       のフォントパスからファイルを探そうとすることもあります。
      </p>
      <p class="para">
       GD ライブラリのバージョンが 2.0.18 より古い場合は、複数のフォントファイルを指定するときの
       &#039;パス区切り文字&#039; がセミコロンではなく <em>スペース</em> となります。
       この機能を意図せずに使ってしまい、
       <em>Warning: Could not find/open font</em>
       といった警告が発生してしまうことがあります。
       この問題が発生するバージョンの場合は、
       スペースを含まないパスにフォントを格納しなければなりません。
      </p>
      <p class="para">
       たいていの場合は、スクリプト内で使うフォントの場所は同じディレクトリになるでしょう。
       そんな場合は、次のようにすれば読み込み時の問題を回避できます。
       <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br /></span><span style="color: #FF8000">//&nbsp;GD&nbsp;用の環境変数を設定します<br /></span><span style="color: #0000BB">putenv</span><span style="color: #007700">(</span><span style="color: #DD0000">'GDFONTPATH='&nbsp;</span><span style="color: #007700">.&nbsp;</span><span style="color: #0000BB">realpath</span><span style="color: #007700">(</span><span style="color: #DD0000">'.'</span><span style="color: #007700">));<br /><br /></span><span style="color: #FF8000">//&nbsp;使用するフォント名を指定します&nbsp;(拡張子&nbsp;.ttf&nbsp;がないことに注目しましょう)<br /></span><span style="color: #0000BB">$font&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #DD0000">'SomeFont'</span><span style="color: #007700">;<br /></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
       </div>

      </p>
     </dd>

    
    
     <dt>
<code class="parameter">text</code></dt>

     <dd>

      <p class="para">
       画像に挿入するテキスト。
      </p>
     </dd>

    
    
     <dt>
<code class="parameter">extrainfo</code></dt>

     <dd>

      <p class="para">
       <table class="doctable table">
       <caption><strong><code class="parameter">extrainfo</code> の配列のインデックス</strong></caption>
        
         <thead>
          <tr>
           <th>キー</th>
           <th>型</th>
           <th>意味</th>
          </tr>

         </thead>

         <tbody class="tbody">
          <tr>
           <td><em>linespacing</em></td>
           <td><span class="type"><a href="language.types.float.html" class="type float">float</a></span></td>
           <td>描画時の行間を定義します</td>
          </tr>

         </tbody>
        
       </table>

      </p>
     </dd>

    
   </dl>

  </p>
 </div>

 <div class="refsect1 returnvalues" id="refsect1-function.imagefttext-returnvalues">
  <h3 class="title">返り値</h3>
  <p class="para">
   この関数は、長方形の 4 つの角を表す点の配列を返します。
   最初が左下の位置で、そこから反時計回りに回ります。
   <table class="doctable informaltable">
    
     <tbody class="tbody">
      <tr>
       <td>0</td>
       <td>左下の x 座標</td>
      </tr>

      <tr>
       <td>1</td>
       <td>左下の y 座標</td>
      </tr>

      <tr>
       <td>2</td>
       <td>右下の x 座標</td>
      </tr>

      <tr>
       <td>3</td>
       <td>右下の y 座標</td>
      </tr>

      <tr>
       <td>4</td>
       <td>右上の x 座標</td>
      </tr>

      <tr>
       <td>5</td>
       <td>右上の y 座標</td>
      </tr>

      <tr>
       <td>6</td>
       <td>左上の x 座標</td>
      </tr>

      <tr>
       <td>7</td>
       <td>左上の y 座標</td>
      </tr>

     </tbody>
    
   </table>

  </p>
 </div>

 <div class="refsect1 examples" id="refsect1-function.imagefttext-examples">
  <h3 class="title">例</h3>
  <p class="para">
   <div class="example" id="example-3335">
    <p><strong>例1 <span class="function"><strong>imagefttext()</strong></span> の例</strong></p>
    <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br /></span><span style="color: #FF8000">//&nbsp;300x100&nbsp;の画像を作成します<br /></span><span style="color: #0000BB">$im&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">imagecreatetruecolor</span><span style="color: #007700">(</span><span style="color: #0000BB">300</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">100</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">$red&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">imagecolorallocate</span><span style="color: #007700">(</span><span style="color: #0000BB">$im</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">0xFF</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">0x00</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">0x00</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">$black&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">imagecolorallocate</span><span style="color: #007700">(</span><span style="color: #0000BB">$im</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">0x00</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">0x00</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">0x00</span><span style="color: #007700">);<br /><br /></span><span style="color: #FF8000">//&nbsp;背景を赤にします<br /></span><span style="color: #0000BB">imagefilledrectangle</span><span style="color: #007700">(</span><span style="color: #0000BB">$im</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">0</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">0</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">299</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">99</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$red</span><span style="color: #007700">);<br /><br /></span><span style="color: #FF8000">//&nbsp;ttf&nbsp;フォントファイルへのパスを設定します<br /></span><span style="color: #0000BB">$font_file&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #DD0000">'./arial.ttf'</span><span style="color: #007700">;<br /><br /></span><span style="color: #FF8000">//&nbsp;フォントサイズ&nbsp;13&nbsp;で&nbsp;'PHP&nbsp;Manual'&nbsp;というテキストを描画します<br /></span><span style="color: #0000BB">imagefttext</span><span style="color: #007700">(</span><span style="color: #0000BB">$im</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">13</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">0</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">105</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">55</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$black</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$font_file</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">'PHP&nbsp;Manual'</span><span style="color: #007700">);<br /><br /></span><span style="color: #FF8000">//&nbsp;画像をブラウザに出力します<br /></span><span style="color: #0000BB">header</span><span style="color: #007700">(</span><span style="color: #DD0000">'Content-Type:&nbsp;image/png'</span><span style="color: #007700">);<br /><br /></span><span style="color: #0000BB">imagepng</span><span style="color: #007700">(</span><span style="color: #0000BB">$im</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">imagedestroy</span><span style="color: #007700">(</span><span style="color: #0000BB">$im</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
    </div>

   </div>
  </p>
 </div>

 <div class="refsect1 notes" id="refsect1-function.imagefttext-notes">
  <h3 class="title">注意</h3>
  <blockquote class="note"><p><strong class="note">注意</strong>: <span class="simpara">この関数は、GD 2.0.1 以降を必要とします (2.0.28 以降を推奨します)。</span></p></blockquote>
  <blockquote class="note"><p><strong class="note">注意</strong>: <span class="simpara">この関数は、PHP が FreeType サポート
(<strong class="option configure">--with-freetype-dir=DIR</strong>
)
を有効にしてコンパイルされている場合のみ使用可能です。
</span></p></blockquote>
 </div>

</div><div id="usernotes">
 <div class="head">
  <h3 class="title">User Contributed Notes</h3>
 </div>
<div id="allnotes">  <a name="98295""></a>
  <div class="note">
   <strong class="user">php@davehirschD0TK0MM</strong>
   <a href="#98295" class="date">07-Jun-2010 09:47</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I'm not sure if this is a PHP issue or an GD issue, but after upgrading to PHP 5.3.2, text written at an angle has become top-justified (so "N" and "n" have the same top, but the bottom of the "N" is lower than the bottom of the "n".&nbsp; I've written a kludgy work-around, which writes the text to a non-rotated temporary image, then copies the temporary image, rotated onto the main image.&nbsp; The kludginess is to get around the fact that I can't seem to extract the font info, particularly the distance between the baseline and the very bottom (I've hard-coded it as 30% of the font size)<br />
I hope the bug can be fixed (if it is indeed a bug) or that others can improve this code:<br />
<br />
<span class="default">&lt;?php<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">// Function that draws rotated text by creating a temporary image and rotating it, since rotated text appears to be busted<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">function </span><span class="default">imageTextRotated</span><span class="keyword">(</span><span class="default">$image</span><span class="keyword">, </span><span class="default">$size</span><span class="keyword">, </span><span class="default">$angle</span><span class="keyword">, </span><span class="default">$x</span><span class="keyword">, </span><span class="default">$y</span><span class="keyword">, </span><span class="default">$inColor</span><span class="keyword">, </span><span class="default">$fontfile</span><span class="keyword">, </span><span class="default">$text</span><span class="keyword">, </span><span class="default">$info</span><span class="keyword">=array()) {<br />
</span><span class="comment">//&nbsp; &nbsp; &nbsp; &nbsp; Force some demo text that contains risers and descenders:<br />
//&nbsp; &nbsp; &nbsp; &nbsp; $text = "Nlfbacejygq!";<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$bbox </span><span class="keyword">= </span><span class="default">imageftbbox</span><span class="keyword">(</span><span class="default">$size</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">$fontfile</span><span class="keyword">, </span><span class="default">$text</span><span class="keyword">, </span><span class="default">$info</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$dropdown </span><span class="keyword">= </span><span class="default">$size</span><span class="keyword">*</span><span class="default">0.3</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$xsize </span><span class="keyword">= </span><span class="default">abs</span><span class="keyword">(</span><span class="default">$bbox</span><span class="keyword">[</span><span class="default">2</span><span class="keyword">] - </span><span class="default">$bbox</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">]);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$ysize </span><span class="keyword">= </span><span class="default">abs</span><span class="keyword">(</span><span class="default">$bbox</span><span class="keyword">[</span><span class="default">5</span><span class="keyword">] - </span><span class="default">$bbox</span><span class="keyword">[</span><span class="default">3</span><span class="keyword">]);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$tmpImage </span><span class="keyword">= </span><span class="default">imagecreatetruecolor</span><span class="keyword">(</span><span class="default">$xsize</span><span class="keyword">*</span><span class="default">1.25</span><span class="keyword">, </span><span class="default">$ysize</span><span class="keyword">*</span><span class="default">1.25</span><span class="keyword">);&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="comment">// need the extra space to accommodate risers and descenders<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$transparent </span><span class="keyword">= </span><span class="default">imagecolorallocate</span><span class="keyword">(</span><span class="default">$tmpImage</span><span class="keyword">, </span><span class="default">255</span><span class="keyword">, </span><span class="default">255</span><span class="keyword">, </span><span class="default">154</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if (!</span><span class="default">$transparent</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">error_log</span><span class="keyword">(</span><span class="string">"Color allocate failed"</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">imagecolortransparent</span><span class="keyword">(</span><span class="default">$tmpImage</span><span class="keyword">, </span><span class="default">$transparent</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if (!</span><span class="default">imagefill</span><span class="keyword">(</span><span class="default">$tmpImage</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">$ysize</span><span class="keyword">, </span><span class="default">$transparent</span><span class="keyword">)) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">error_log</span><span class="keyword">(</span><span class="string">"Fill failed"</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$rgb </span><span class="keyword">= </span><span class="default">imagecolorsforindex</span><span class="keyword">(</span><span class="default">$image</span><span class="keyword">, </span><span class="default">$inColor</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$color </span><span class="keyword">= </span><span class="default">imagecolorexact</span><span class="keyword">(</span><span class="default">$tmpImage</span><span class="keyword">, </span><span class="default">$rgb</span><span class="keyword">[</span><span class="string">'red'</span><span class="keyword">], </span><span class="default">$rgb</span><span class="keyword">[</span><span class="string">'green'</span><span class="keyword">], </span><span class="default">$rgb</span><span class="keyword">[</span><span class="string">'blue'</span><span class="keyword">]);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">$color </span><span class="keyword">== -</span><span class="default">1</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$color </span><span class="keyword">= </span><span class="default">imagecolorallocate</span><span class="keyword">(</span><span class="default">$tmpImage</span><span class="keyword">, </span><span class="default">$rgb</span><span class="keyword">[</span><span class="string">'red'</span><span class="keyword">], </span><span class="default">$rgb</span><span class="keyword">[</span><span class="string">'green'</span><span class="keyword">], </span><span class="default">$rgb</span><span class="keyword">[</span><span class="string">'blue'</span><span class="keyword">]); <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if (!</span><span class="default">$color</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">error_log</span><span class="keyword">(</span><span class="string">"Color allocate 2 failed"</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$newbbox </span><span class="keyword">= </span><span class="default">imagefttext</span><span class="keyword">(</span><span class="default">$tmpImage</span><span class="keyword">, </span><span class="default">$size</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">$ysize</span><span class="keyword">*</span><span class="default">1.0</span><span class="keyword">, </span><span class="default">$color</span><span class="keyword">, </span><span class="default">$fontfile</span><span class="keyword">, </span><span class="default">$text</span><span class="keyword">, </span><span class="default">$info</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$tmpImage </span><span class="keyword">= </span><span class="default">imagerotate</span><span class="keyword">(</span><span class="default">$tmpImage</span><span class="keyword">, </span><span class="default">$angle</span><span class="keyword">, </span><span class="default">$transparent</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$newWidth </span><span class="keyword">= </span><span class="default">imagesx</span><span class="keyword">(</span><span class="default">$tmpImage</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$newHt </span><span class="keyword">= </span><span class="default">imagesy</span><span class="keyword">(</span><span class="default">$tmpImage</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">imagecopymerge</span><span class="keyword">(</span><span class="default">$image</span><span class="keyword">, </span><span class="default">$tmpImage</span><span class="keyword">, </span><span class="default">$x</span><span class="keyword">-</span><span class="default">$newWidth</span><span class="keyword">+</span><span class="default">$dropdown</span><span class="keyword">, </span><span class="default">$y</span><span class="keyword">-</span><span class="default">$newHt</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">$newWidth</span><span class="keyword">, </span><span class="default">$newHt</span><span class="keyword">, </span><span class="default">100</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <br />
</span><span class="comment">//&nbsp; &nbsp; &nbsp; &nbsp; Highlight the desired starting point (baseline) with a green dot:<br />
//&nbsp; &nbsp; &nbsp; &nbsp; $green = imagecolorallocate($image, 0, 251, 0);<br />
//&nbsp; &nbsp; &nbsp; &nbsp; imagefilledellipse($image, $x, $y, 10, 10, $green);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">imagedestroy</span><span class="keyword">(</span><span class="default">$tmpImage</span><span class="keyword">);<br />
</span><span class="default">?&gt;<br />
</span><br />
-Dave</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="93593""></a>
  <div class="note">
   <strong class="user">KeepSake at crimebloc dot com</strong>
   <a href="#93593" class="date">17-Sep-2009 06:05</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
For a design project I am required to have spacing between characters; since imagefttext does not support this feature I have created a function which does support this. <br />
<br />
The arguments are identical to imagefttext, accept that (array)$extrainfo now accepts the 'character_spacing' spacing parameter. The return values are as expected, and include the image boundaries of the entire string including the character spacing.<br />
<br />
The downside is that $angle rotates each letter instead of rotating the entire word (could be seen as a feature on its own).<br />
<br />
I hope this is of some use to someone.<br />
- KeepSake<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="comment">// Required header (assuming we use png images)<br />
</span><span class="default">header</span><span class="keyword">(</span><span class="string">"Content-type: image/png"</span><span class="keyword">);<br />
<br />
</span><span class="comment">// Create a basic image with a dark background.<br />
</span><span class="default">$image </span><span class="keyword">= </span><span class="default">imagecreatetruecolor</span><span class="keyword">(</span><span class="default">300</span><span class="keyword">, </span><span class="default">20</span><span class="keyword">);<br />
</span><span class="default">imagefill</span><span class="keyword">(</span><span class="default">$image</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">imagecolorallocate</span><span class="keyword">(</span><span class="default">$image</span><span class="keyword">, </span><span class="default">21</span><span class="keyword">, </span><span class="default">21</span><span class="keyword">, </span><span class="default">21</span><span class="keyword">));<br />
<br />
</span><span class="comment">// Function call, arguments are the same as imagefttext, expect that (array)$extrainfo takes a new paramenter called character_spacing.<br />
</span><span class="default">$imageBox </span><span class="keyword">= </span><span class="default">imagefttext2</span><span class="keyword">(</span><span class="default">$image</span><span class="keyword">, </span><span class="default">9</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">2</span><span class="keyword">, </span><span class="default">15</span><span class="keyword">, </span><span class="default">imagecolorallocate</span><span class="keyword">(</span><span class="default">$image</span><span class="keyword">, </span><span class="default">255</span><span class="keyword">, </span><span class="default">255</span><span class="keyword">, </span><span class="default">255</span><span class="keyword">), </span><span class="string">'tahomabold.ttf'</span><span class="keyword">, </span><span class="string">'The quick brown fox...'</span><span class="keyword">, array(</span><span class="string">'character_spacing' </span><span class="keyword">=&gt; </span><span class="default">5</span><span class="keyword">));<br />
<br />
</span><span class="comment">// Output the file, and clear the resources<br />
</span><span class="default">imagepng</span><span class="keyword">(</span><span class="default">$image</span><span class="keyword">);<br />
</span><span class="default">imagedestroy</span><span class="keyword">(</span><span class="default">$image</span><span class="keyword">);<br />
<br />
function </span><span class="default">imagefttext2</span><span class="keyword">(</span><span class="default">$imageResource</span><span class="keyword">, </span><span class="default">$font_size</span><span class="keyword">, </span><span class="default">$text_angle</span><span class="keyword">, </span><span class="default">$start_x</span><span class="keyword">, </span><span class="default">$start_y</span><span class="keyword">, </span><span class="default">$color</span><span class="keyword">, </span><span class="default">$font_file</span><span class="keyword">, </span><span class="default">$text</span><span class="keyword">, </span><span class="default">$extra_info </span><span class="keyword">= array()) {<br />
&nbsp;&nbsp;&nbsp; if(</span><span class="default">$extra_info</span><span class="keyword">[</span><span class="string">'character_spacing'</span><span class="keyword">] == </span><span class="default">NULL </span><span class="keyword">|| !</span><span class="default">is_numeric</span><span class="keyword">(</span><span class="default">$extra_info</span><span class="keyword">[</span><span class="string">'character_spacing'</span><span class="keyword">])) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$extra_info</span><span class="keyword">[</span><span class="string">'character_spacing'</span><span class="keyword">] = </span><span class="default">0</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$lastX </span><span class="keyword">= </span><span class="default">$start_x </span><span class="keyword">- </span><span class="default">$extra_info</span><span class="keyword">[</span><span class="string">'character_spacing'</span><span class="keyword">];<br />
&nbsp;&nbsp;&nbsp; foreach(</span><span class="default">str_split</span><span class="keyword">(</span><span class="default">$text</span><span class="keyword">) as </span><span class="default">$v</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$coordinates </span><span class="keyword">= </span><span class="default">imagefttext</span><span class="keyword">(</span><span class="default">$imageResource</span><span class="keyword">, </span><span class="default">$font_size</span><span class="keyword">, </span><span class="default">$text_angle</span><span class="keyword">, </span><span class="default">$lastX </span><span class="keyword">+ </span><span class="default">$extra_info</span><span class="keyword">[</span><span class="string">'character_spacing'</span><span class="keyword">], </span><span class="default">$start_y</span><span class="keyword">, </span><span class="default">$color</span><span class="keyword">, </span><span class="default">$font_file</span><span class="keyword">, </span><span class="default">$v</span><span class="keyword">, </span><span class="default">$extra_info</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$lastX </span><span class="keyword">= </span><span class="default">max</span><span class="keyword">(</span><span class="default">$coordinates</span><span class="keyword">[</span><span class="default">2</span><span class="keyword">], </span><span class="default">$coordinates</span><span class="keyword">[</span><span class="default">4</span><span class="keyword">]);<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">// Return the newly generated image box coordinates:<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">return array(</span><span class="default">$start_x</span><span class="keyword">, </span><span class="default">$start_y</span><span class="keyword">, </span><span class="default">$coordinates</span><span class="keyword">[</span><span class="default">2</span><span class="keyword">], </span><span class="default">$coordinates</span><span class="keyword">[</span><span class="default">3</span><span class="keyword">], </span><span class="default">$coordinates</span><span class="keyword">[</span><span class="default">4</span><span class="keyword">], </span><span class="default">$coordinates</span><span class="keyword">[</span><span class="default">5</span><span class="keyword">], </span><span class="default">$start_x</span><span class="keyword">, </span><span class="default">$coordinates</span><span class="keyword">[</span><span class="default">7</span><span class="keyword">]);<br />
}<br />
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="79389""></a>
  <div class="note">
   <strong class="user">d underscore brown x at hotmail dot</strong>
   <a href="#79389" class="date">24-Nov-2007 07:26</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
realpath(".")<br />
realpath(getenv("SCRIPT_FILENAME"));<br />
<br />
could be different.&nbsp; This helped when setting GDFONTPATH.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="74207""></a>
  <div class="note">
   <strong class="user">darren at badpun dot co dot uk</strong>
   <a href="#74207" class="date">29-Mar-2007 10:58</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I had trouble working out how to accurately represent fonts in point sizes when constructing charts that had a user-customisable output DPI (basically, the user could specify the size of the chart in mm - or any other physical measure - and the DPI to create arbitrarily-sized charts to work properly in real printed documents).<br />
<br />
GD1 was OK as it used pixels for font rendering, but GD2 uses points, which only makes any sense if you know the DPI that it assumes when rendering text on the image surface. I have not been able to find this anywhere in this documentation but have examined the GD2 source code and it appears to assume a DPI of 96 internally. However, this can easily be customised in the GD2 source so it cannot be assumed that all PHP interpreters out there have a GD2 compiled using 96dpi internally.<br />
<br />
If it does, and you are using it to construct images whose target DPI is not 96, you can calculate the point size to supply to imageftbox() and imagefttext() like this:<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="comment">/* 100mm x 100mm image */<br />
</span><span class="default">$imageWidth </span><span class="keyword">= </span><span class="default">100</span><span class="keyword">;<br />
</span><span class="default">$imageHeight </span><span class="keyword">= </span><span class="default">100</span><span class="keyword">;<br />
<br />
</span><span class="comment">/* 300 dpi image, therefore image is 1181 x 1181 pixels */<br />
</span><span class="default">$imageDPI </span><span class="keyword">= </span><span class="default">300</span><span class="keyword">;<br />
<br />
</span><span class="comment">/* unless we do this, text will be about 3 times too small */<br />
</span><span class="default">$realFontSize </span><span class="keyword">= (</span><span class="default">$fontPt </span><span class="keyword">* </span><span class="default">$targetDPI</span><span class="keyword">) / </span><span class="default">96</span><span class="keyword">;<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="71035""></a>
  <div class="note">
   <strong class="user">cory at lavacube dot com</strong>
   <a href="#71035" class="date">09-Nov-2006 10:53</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Since this function is not documented, I felt it was best that I shed some light on the extrainfo parameter.<br />
<br />
You can see the full documentation at the GD reference manual:<br />
<a href="http://www.boutell.com/gd/manual2.0.33.html#gdImageStringFTEx" rel="nofollow" target="_blank">http://www.boutell.com/gd/manual2.0.33.html#gdImageStringFTEx</a><br />
<br />
Basically it accepts an array containing the following options as keys and an associated value:<br />
(int) flags [more info in the GD reference manual]<br />
(double/float) linespacing<br />
(int) charmap<br />
(int) hdpi<br />
(int) vdpi<br />
(string) xshow<br />
(string) fontpath<br />
<br />
My C/C++ is not very good but this is the best I can explain. Read the documentation for more information. :-)<br />
<br />
A very simple example of usage would be:<br />
<br />
<span class="default">&lt;?php<br />
<br />
imagefttext</span><span class="keyword">( </span><span class="default">$img_pointer</span><span class="keyword">, </span><span class="default">12</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">10</span><span class="keyword">, </span><span class="default">10</span><span class="keyword">, [-</span><span class="default">insertsomecolour</span><span class="keyword">-], </span><span class="string">'/path/to/font.ttf'</span><span class="keyword">, </span><span class="string">"THIS IS A TEST\nTHIS IS LINE 2\nTHIS IS LINE3"</span><span class="keyword">, array(</span><span class="string">'lineheight'</span><span class="keyword">=&gt;</span><span class="default">2.0</span><span class="keyword">) );<br />
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="62106""></a>
  <div class="note">
   
   <a href="#62106" class="date">20-Feb-2006 11:19</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I am using php 5.1.2 on a winxp machine. I was&nbsp; getting into the TrueType fonts and wanted to see which ones would look best incorporated into web images. So I created the following script that prints out samples of all the TrueType fonts found in my C:\Windows\Fonts directory. The script takes only one request parameter - 'fsize'. It stands for font-size and lets you see each font in any size you wish -- I limited it to values between 5 and 48. Hope this helps someone other than me :)<br />
<br />
I apologize in advance if any of my code is not the prettiest-written php code even seen -- I have only been coding in php for the past week (I'm a perl-guy usually).<br />
<br />
<span class="default">&lt;?php<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">list(</span><span class="default">$x</span><span class="keyword">, </span><span class="default">$y</span><span class="keyword">, </span><span class="default">$maxwidth</span><span class="keyword">) = array(</span><span class="default">0</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">);<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$fsize </span><span class="keyword">= (int)</span><span class="default">$_REQUEST</span><span class="keyword">[</span><span class="string">'fsize'</span><span class="keyword">];<br />
&nbsp;&nbsp;&nbsp; if (</span><span class="default">$fsize </span><span class="keyword">&lt; </span><span class="default">5 </span><span class="keyword">or </span><span class="default">$fsize </span><span class="keyword">&gt; </span><span class="default">48</span><span class="keyword">) </span><span class="default">$fsize </span><span class="keyword">= </span><span class="default">8</span><span class="keyword">;<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">header</span><span class="keyword">(</span><span class="string">"Content-type: image/jpeg"</span><span class="keyword">);<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">// don't know how wide or tall the font samples will be.<br />
&nbsp;&nbsp;&nbsp; // create a huge image for now, we'll copy it smaller<br />
&nbsp;&nbsp;&nbsp; // later when we know how large the image needs to be.<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$im </span><span class="keyword">= </span><span class="default">imagecreate</span><span class="keyword">(</span><span class="default">1000</span><span class="keyword">, </span><span class="default">20000</span><span class="keyword">) or die(</span><span class="string">'could not create!'</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$clr_white </span><span class="keyword">= </span><span class="default">imagecolorallocate</span><span class="keyword">(</span><span class="default">$im</span><span class="keyword">, </span><span class="default">255</span><span class="keyword">, </span><span class="default">255</span><span class="keyword">, </span><span class="default">255</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$clr_black </span><span class="keyword">= </span><span class="default">imagecolorallocate</span><span class="keyword">(</span><span class="default">$im</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">);<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$font_path </span><span class="keyword">= </span><span class="string">"C:/Windows/Fonts/"</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$dh </span><span class="keyword">= </span><span class="default">opendir</span><span class="keyword">(</span><span class="default">$font_path</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; while ((</span><span class="default">$file </span><span class="keyword">= </span><span class="default">readdir</span><span class="keyword">(</span><span class="default">$dh</span><span class="keyword">)) !== </span><span class="default">FALSE</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// we're only dealing with TTY fonts here.<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">if (</span><span class="default">substr</span><span class="keyword">(</span><span class="default">strtolower</span><span class="keyword">(</span><span class="default">$file</span><span class="keyword">), -</span><span class="default">4</span><span class="keyword">) != </span><span class="string">'.ttf'</span><span class="keyword">) continue;<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$str </span><span class="keyword">= </span><span class="string">"Sample text for '</span><span class="default">$file</span><span class="string">'"</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$bbox </span><span class="keyword">= </span><span class="default">imagettfbbox</span><span class="keyword">(<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$fsize</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="string">"</span><span class="keyword">{</span><span class="default">$font_path</span><span class="keyword">}{</span><span class="default">$file</span><span class="keyword">}</span><span class="string">"</span><span class="keyword">, </span><span class="default">$str<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$ww </span><span class="keyword">= </span><span class="default">$bbox</span><span class="keyword">[</span><span class="default">4</span><span class="keyword">] - </span><span class="default">$bbox</span><span class="keyword">[</span><span class="default">6</span><span class="keyword">];<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$hh </span><span class="keyword">= </span><span class="default">$bbox</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">] - </span><span class="default">$bbox</span><span class="keyword">[</span><span class="default">7</span><span class="keyword">];<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">imagettftext</span><span class="keyword">(<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$im</span><span class="keyword">, </span><span class="default">$fsize</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">$x</span><span class="keyword">, </span><span class="default">$y</span><span class="keyword">,<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$clr_black</span><span class="keyword">, </span><span class="string">"</span><span class="keyword">{</span><span class="default">$font_path</span><span class="keyword">}{</span><span class="default">$file</span><span class="keyword">}</span><span class="string">"</span><span class="keyword">, </span><span class="default">$str<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">);<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$y </span><span class="keyword">+= </span><span class="default">$hh </span><span class="keyword">+ </span><span class="default">20</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">$ww </span><span class="keyword">&gt; </span><span class="default">$maxwidth</span><span class="keyword">) </span><span class="default">$maxwidth </span><span class="keyword">= </span><span class="default">$ww</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">closedir</span><span class="keyword">(</span><span class="default">$dh</span><span class="keyword">);<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">// ok, now we can chop off the extra space from the<br />
&nbsp;&nbsp;&nbsp; // 1000 x 20000 image.<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$im2 </span><span class="keyword">= </span><span class="default">imagecreate</span><span class="keyword">(</span><span class="default">$maxwidth </span><span class="keyword">+ </span><span class="default">20</span><span class="keyword">, </span><span class="default">$y</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">imagecopyresized</span><span class="keyword">(<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$im2</span><span class="keyword">, </span><span class="default">$im</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">$maxwidth </span><span class="keyword">+ </span><span class="default">20</span><span class="keyword">,<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$y</span><span class="keyword">, </span><span class="default">$maxwidth </span><span class="keyword">+ </span><span class="default">20</span><span class="keyword">, </span><span class="default">$y<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">imagejpeg</span><span class="keyword">(</span><span class="default">$im2</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">imagedestroy</span><span class="keyword">(</span><span class="default">$im</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">imagedestroy</span><span class="keyword">(</span><span class="default">$im2</span><span class="keyword">);<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="59001""></a>
  <div class="note">
   <strong class="user">vsazel at atlas dot cz</strong>
   <a href="#59001" class="date">23-Nov-2005 06:16</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If you want to get the best result in monochrome font rendering, change render_mode to FT_LOAD_RENDER. It's the last parameter of FT_Load_Glyph() function (in gdft.c).</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="54080""></a>
  <div class="note">
   <strong class="user">dnf at seznam dot cz</strong>
   <a href="#54080" class="date">23-Jun-2005 11:25</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
For negative image you must add one line after the $grayColor computation:<br />
<br />
$grayColor =&nbsp; ~ $grayColor &amp; 0x7FFFFFF;</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="53333""></a>
  <div class="note">
   <strong class="user">aidan at php dot net</strong>
   <a href="#53333" class="date">29-May-2005 12:11</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
This function is very simular to imageffttext(), you may find the information provided on its manual page helpful:<br />
<br />
<a href="http://php.net/imagettftext" rel="nofollow" target="_blank">http://php.net/imagettftext</a></span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="49420""></a>
  <div class="note">
   <strong class="user">MagicalTux at FF dot st</strong>
   <a href="#49420" class="date">27-Jan-2005 11:20</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
When compiling PHP with FreeType 2 support, you'll probably have some problems if - for example - you use debian and didn't compile freetype2 yourself...<br />
If configure fails after saying "If configure fails, try --with-xpm-dir..." you most likely have FreeType1 installed, but not freetype2 ...<br />
<br />
Do this as root :<br />
apt-get install libfreetype6-dev<br />
<br />
It took me some time to find out that apt-get install freetype2 is actually installing freetype1 ...</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="47984""></a>
  <div class="note">
   <strong class="user">kagaku at gmail dot com</strong>
   <a href="#47984" class="date">08-Dec-2004 05:27</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I found myself in need of an align right function and found one on the imagepstext manual page. I can't imagine I'm the only person who's needed to use this, so here's a slightly modified version that works with imagefttext:<br />
<br />
&lt;?<br />
&nbsp; function align_right($string, $fontfile, $imgwidth, $fontsize){<br />
&nbsp;&nbsp;&nbsp; $spacing = 0;<br />
&nbsp;&nbsp;&nbsp; $line = array("linespacing" =&gt; $spacing);<br />
&nbsp;&nbsp;&nbsp; list($lx,$ly,$rx,$ry) = imageftbbox($fontsize,0,$fontfile,$string,$line);<br />
&nbsp;&nbsp;&nbsp; $textwidth = $rx - $lx;<br />
&nbsp;&nbsp;&nbsp; $imw = ($imgwidth-10-$textwidth);<br />
&nbsp;&nbsp;&nbsp; return $imw;<br />
&nbsp; }<br />
?&gt;</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="39329""></a>
  <div class="note">
   <strong class="user">eshenk at comcast dot net</strong>
   <a href="#39329" class="date">24-Jan-2004 11:05</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I wrote a bit of code to gather all the .ttf files in the directory with this script, and randomize them to write text on a header image for my site. The only catch is the font files have to be named 1.ttf, 2.ttf etc etc.<br />
<br />
<span class="default">&lt;?php<br />
<br />
srand</span><span class="keyword">((double)</span><span class="default">microtime</span><span class="keyword">()*</span><span class="default">1234567</span><span class="keyword">); </span><span class="comment">// Start the random gizmo<br />
</span><span class="default">$image </span><span class="keyword">= </span><span class="default">imagecreatefromjpeg</span><span class="keyword">(</span><span class="default">rand</span><span class="keyword">(</span><span class="default">1</span><span class="keyword">,</span><span class="default">exec</span><span class="keyword">(</span><span class="string">'ls *.jpg | wc -l'</span><span class="keyword">)) . </span><span class="string">".jpg"</span><span class="keyword">); </span><span class="comment">// Get a background<br />
</span><span class="default">$font </span><span class="keyword">= </span><span class="default">rand</span><span class="keyword">(</span><span class="default">1</span><span class="keyword">,</span><span class="default">exec</span><span class="keyword">(</span><span class="string">'ls *.ttf | wc -l'</span><span class="keyword">)) . </span><span class="string">".ttf"</span><span class="keyword">; </span><span class="comment">// Get a font<br />
</span><span class="default">$textcolor </span><span class="keyword">= </span><span class="default">imagecolorallocate</span><span class="keyword">(</span><span class="default">$image</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">); </span><span class="comment">// Set text color<br />
<br />
</span><span class="default">$text1 </span><span class="keyword">= </span><span class="string">"shenko.homedns.org"</span><span class="keyword">; </span><span class="comment">// Here is our text<br />
<br />
</span><span class="default">imagettftext</span><span class="keyword">(</span><span class="default">$image</span><span class="keyword">, </span><span class="default">50</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">20</span><span class="keyword">, </span><span class="default">50</span><span class="keyword">, </span><span class="default">$textcolor</span><span class="keyword">, </span><span class="default">$font</span><span class="keyword">, </span><span class="default">$text1</span><span class="keyword">); </span><span class="comment">// Write the text with a font<br />
<br />
</span><span class="default">header</span><span class="keyword">(</span><span class="string">"Content-type: image/jpeg"</span><span class="keyword">); </span><span class="comment">// Its a JPEG<br />
</span><span class="default">imagejpeg</span><span class="keyword">(</span><span class="default">$image</span><span class="keyword">,</span><span class="string">''</span><span class="keyword">,</span><span class="default">90</span><span class="keyword">); </span><span class="comment">// Zap it to the browser<br />
</span><span class="default">imagedestroy</span><span class="keyword">(</span><span class="default">$image</span><span class="keyword">); </span><span class="comment">// Memory Freeupage<br />
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="35868""></a>
  <div class="note">
   <strong class="user">sebastiand at gmx dot de</strong>
   <a href="#35868" class="date">17-Sep-2003 11:07</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
After spending the evening with some work on automatically generated images, I had the idea to switch of anti-aliasing (looking, if some font would look better that way), which turned out not to be quite so easy.<br />
<br />
Actually you have to use the negative of the desired color to switch of antialising. I include the corresponding line from my code (line split up):<br />
<br />
// USE NEGATIVE OF DESIRED COLOR TO SWITCH OF ANTI-ALIASING<br />
ImageFTText ($neuesBild,$fontsize,$fontangle,$TextPosX,$TextPosY,<br />
-$custom_fg,$fonttype,$text,array());</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="27068""></a>
  <div class="note">
   <strong class="user">jwilliam at kcr dot uky dot edu</strong>
   <a href="#27068" class="date">21-Nov-2002 09:22</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Thanks for the script!&nbsp; I modified it to show several fonts that I was wanting to use.&nbsp; I am using GD-2.0.7, FreeType-2.1.3(text rotation fix,among others), and PHP-4.2.3 and had to include the array information to get it to work.<br />
<br />
Code change follows:<br />
$fontfile="/usr/local/fonts/ttf/bookantbd.ttf";<br />
// Waterfall of point sizes to see what Freetype 2's autohinting looks like:<br />
//<br />
for($i=4;$i&lt;=12;$i++){<br />
&nbsp; ImageFtText($image,$i,0,10,(280+$i*14),$forecolor,$fontfile, bookantbd . $i . ". " . $string, array("linespacing" =&gt; 1.0));<br />
}<br />
<br />
John</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="24149""></a>
  <div class="note">
   <strong class="user">ben at tNOSPAManjNOSPAMo dot cnospamordots dot om</strong>
   <a href="#24149" class="date">08-Aug-2002 09:59</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If you're interested in turning off FreeType hinting, search for the following line in the gd source (gdft.c):<br />
&nbsp;&nbsp; &nbsp;&nbsp; err = FT_Load_Glyph (face, glyph_index, FT_LOAD_DEFAULT);<br />
and replace it with<br />
&nbsp;&nbsp; &nbsp;&nbsp; err = FT_Load_Glyph (face, glyph_index, FT_LOAD_NO_HINTING);<br />
<br />
Recompile GD, and vo?la: beauteous antialiasing.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
</div>
</div>
</div></div></body></html>
