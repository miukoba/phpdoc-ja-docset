<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
 <head>
  <meta http-equiv="content-type" content="text/html; CHARSET=shift-jis">
  <title>メッセージヘッダを読み込む</title>

  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <link media="all" rel="stylesheet" type="text/css" href="style.css"/>
 </head>
 <body class="docs" class="docs"><div class="navbar navbar-fixed-top">
  <div class="navbar-inner clearfix">
    <ul class="nav" style="width: 100%">
      <li style="float: left;"><a href="function.imap-header.html">≪ imap_header</a></li>
      <li style="float: right;"><a href="function.imap-headers.html">imap_headers ≫</a></li>
    </ul>
  </div>
</div>
<div id="breadcrumbs" class="clearfix">
  <ul class="breadcrumbs-container">
    <li><a href="index.html">PHP Manual</a></li>
    <li><a href="ref.imap.html">IMAP 関数</a></li>
    <li>メッセージヘッダを読み込む</li>
  </ul>
</div>
<div id="layout">
  <div id="layout-content"><div id="function.imap-headerinfo" class="refentry">
 <div class="refnamediv">
  <h1 class="refname">imap_headerinfo</h1>
  <p class="verinfo">(PHP 4, PHP 5)</p><p class="refpurpose"><span class="refname">imap_headerinfo</span> &mdash; <span class="dc-title">メッセージヘッダを読み込む</span></p>

 </div>
 <div class="refsect1 description" id="refsect1-function.imap-headerinfo-description">
  <h3 class="title">説明</h3>
  <div class="methodsynopsis dc-description">
   <span class="type">object</span> <span class="methodname"><strong>imap_headerinfo</strong></span>
    ( <span class="methodparam"><span class="type">resource</span> <code class="parameter">$imap_stream</code></span>
   , <span class="methodparam"><span class="type">int</span> <code class="parameter">$msg_number</code></span>
   [, <span class="methodparam"><span class="type">int</span> <code class="parameter">$fromlength</code><span class="initializer"> = 0</span></span>
   [, <span class="methodparam"><span class="type">int</span> <code class="parameter">$subjectlength</code><span class="initializer"> = 0</span></span>
   [, <span class="methodparam"><span class="type">string</span> <code class="parameter">$defaulthost</code><span class="initializer"> = <strong><code>NULL</code></strong></span></span>
  ]]] )</div>

  <p class="para rdfs-comment">
   指定したメッセージ番号についての情報を、そのヘッダを読み込んで取得します。
  </p>
 </div>

 <div class="refsect1 parameters" id="refsect1-function.imap-headerinfo-parameters">
  <h3 class="title">パラメータ</h3>
  <p class="para">
   <dl>

    <dt>
<code class="parameter">
imap_stream</code></dt>
<dd>
<p class="para"><span class="function"><a href="function.imap-open.html" class="function">imap_open()</a></span>
が返す IMAP ストリーム。</p></dd>

    
     <dt>
<code class="parameter">msg_number</code></dt>

     <dd>

      <p class="para">
       メッセージ番号。
      </p>
     </dd>

    
    
     <dt>
<code class="parameter">fromlength</code></dt>

     <dd>

      <p class="para">
       <em>fetchfrom</em> プロパティの文字数。
       ゼロ以上でなければなりません。
      </p>
     </dd>

    
    
     <dt>
<code class="parameter">subjectlength</code></dt>

     <dd>

      <p class="para">
       <em>fetchsubject</em> プロパティの文字数。
       ゼロ以上でなければなりません。
      </p>
     </dd>

    
    
     <dt>
<code class="parameter">defaulthost</code></dt>

     <dd>

      <p class="para">
      </p>
     </dd>

    
   </dl>

  </p>
 </div>

 <div class="refsect1 returnvalues" id="refsect1-function.imap-headerinfo-returnvalues">
  <h3 class="title">返り値</h3>
  <p class="para">
   以下のプロパティをもつオブジェクトを返します。
   <ul class="itemizedlist">
    <li class="listitem">
     <span class="simpara">
      toaddress - 完全な to: 行。最大 1024 文字。
     </span>
    </li>
    <li class="listitem">
     <span class="simpara">
      to - To: 行から、次のプロパティを含むオブジェクトの配列を返します。
      <em>personal</em>、<em>adl</em>、
      <em>mailbox</em> および <em>host</em>
     </span>
    </li>
    <li class="listitem">
     <span class="simpara">
      fromaddress - 完全な from: 行。最大 1024 文字。
     </span>
    </li>
    <li class="listitem">
     <span class="simpara">
      from - From: 行から、次のプロパティを含むオブジェクトの配列を返します。
      <em>personal</em>、<em>adl</em>、
      <em>mailbox</em> および <em>host</em>
     </span>
    </li>
    <li class="listitem">
     <span class="simpara">
      ccaddress - 完全な cc: 行。最大 1024 文字。
     </span>
    </li>
    <li class="listitem">
     <span class="simpara">
      cc - Cc: 行から、次のプロパティを含むオブジェクトの配列を返します。
      <em>personal</em>、<em>adl</em>、
      <em>mailbox</em> および <em>host</em>
     </span>
    </li>
    <li class="listitem">
     <span class="simpara">
      bccaddress - 完全な bcc: 行。最大 1024 文字。
     </span>
    </li>
    <li class="listitem">
     <span class="simpara">
      bcc - Bcc: 行から、次のプロパティを含むオブジェクトの配列を返します。
      <em>personal</em>、<em>adl</em>、
      <em>mailbox</em> および <em>host</em>
     </span>
    </li>
    <li class="listitem">
     <span class="simpara">
      reply_toaddress - 完全な Reply-To: 行。最大 1024 文字。
     </span>
    </li>
    <li class="listitem">
     <span class="simpara">
      reply_to - Reply-To: 行から、次のプロパティを含むオブジェクトの配列を返します。
      <em>personal</em>、<em>adl</em>、
      <em>mailbox</em> および <em>host</em>
     </span>
    </li>
    <li class="listitem">
     <span class="simpara">
      senderaddress - 完全な sender: 行。最大 1024 文字。
     </span>
    </li>
    <li class="listitem">
     <span class="simpara">
      sender - Sender: 行から、次のプロパティを含むオブジェクトの配列を返します。
      <em>personal</em>、<em>adl</em>、
      <em>mailbox</em> および <em>host</em>
     </span>
    </li>
    <li class="listitem">
     <span class="simpara">
      return_pathaddress - 完全な Return-Path: 行。最大 1024 文字。
     </span>
    </li>
    <li class="listitem">
     <span class="simpara">
      return_path - Return-Path: 行から、次のプロパティを含むオブジェクトの配列を返します。
      <em>personal</em>、
      <em>adl</em>、<em>mailbox</em> および
      <em>host</em>
     </span>
    </li>
    <li class="listitem">
     <span class="simpara">
      remail - 
     </span>
    </li>
    <li class="listitem">
     <span class="simpara">
      date - ヘッダにあるメッセージの日付。
     </span>
    </li>
    <li class="listitem">
     <span class="simpara">
      Date - date と同じ。
     </span>
    </li>
    <li class="listitem">
     <span class="simpara">
      subject - メッセージの件名。
     </span>
    </li>
    <li class="listitem">
     <span class="simpara">
      Subject - subject と同じ。
     </span>
    </li>
    <li class="listitem">
     <span class="simpara">
      in_reply_to - 
     </span>
    </li>
    <li class="listitem">
     <span class="simpara">
      message_id - 
     </span>
    </li>
    <li class="listitem">
     <span class="simpara">
      newsgroups - 
     </span>
    </li>
    <li class="listitem">
     <span class="simpara">
      followup_to - 
     </span>
    </li>
    <li class="listitem">
     <span class="simpara">
      references - 
     </span>
    </li>
    <li class="listitem">
     <span class="simpara">
      Recent - 最近の既読メッセージは <em>R</em>、
      最新の未読メッセージは <em>N</em>、
      最新でないメッセージは &#039; &#039;。
     </span>
    </li>
    <li class="listitem">
     <span class="simpara">
      Unseen - 最新でない未読メッセージは <em>U</em>、
      既読、あるいは最新の未読メッセージは &#039; &#039;。
     </span>
    </li>
    <li class="listitem">
     <span class="simpara">
      Flagged - フラグがたっている場合は <em>F</em>、
      そうでない場合は &#039; &#039;。
     </span>
    </li>
    <li class="listitem">
     <span class="simpara">
      Answered - 返信した場合は <em>A</em>、
      していない場合は &#039; &#039;。
     </span>
    </li>
    <li class="listitem">
     <span class="simpara">
      Deleted - 削除された場合は <em>D</em>、
      されていない場合は &#039; &#039;。
     </span>
    </li>
    <li class="listitem">
     <span class="simpara">
      Draft - 草稿である場合は <em>X</em>、
      そうでない場合は &#039; &#039;。
     </span>
    </li>
    <li class="listitem">
     <span class="simpara">
      Msgno - メッセージ番号。
     </span>
    </li>
    <li class="listitem">
     <span class="simpara">
      MailDate - 
     </span>
    </li>
    <li class="listitem">
     <span class="simpara">
      Size - メッセージのサイズ。
     </span>
    </li>
    <li class="listitem">
     <span class="simpara">
      udate - メールメッセージの日付を Unix time で表したもの。
     </span>
    </li>
    <li class="listitem">
     <span class="simpara">
      fetchfrom - from 行を <code class="parameter">fromlength</code> 文字に適合させたもの。
     </span>
    </li>
    <li class="listitem">
     <span class="simpara">
      fetchsubject - subject 行を
      <code class="parameter">subjectlength</code> 文字に適合させたもの。
     </span>
    </li>
   </ul>
  </p>
 </div>

 <div class="refsect1 seealso" id="refsect1-function.imap-headerinfo-seealso">
  <h3 class="title">参考</h3>
  <p class="para">
   <ul class="simplelist">
    <li class="member"><span class="function"><a href="function.imap-fetch-overview.html" class="function" rel="rdfs-seeAlso">imap_fetch_overview()</a> - 指定したメッセージのヘッダ情報の概要を読む</span></li>
   </ul>
  </p>
 </div>

</div><div id="usernotes">
 <div class="head">
  <h3 class="title">User Contributed Notes</h3>
 </div>
<div id="allnotes">  <a name="115491""></a>
  <div class="note">
   <strong class="user">milosh</strong>
   <a href="#115491" class="date">04-Aug-2014 07:14</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I did some testing on using imap_headerinfo() function and I am very confused with the results.<br />
<br />
On small mailboxes, getting data for 30 messages takes about 0.5 secs. On mailboxes with approximately 500 messages it takes about 7 secs to retrieve data for the same number of messages.<br />
<br />
Why would the size of mailbox had anything to do with the time needed to retrieve the header of the single email message? Mailboxes are on the same account.<br />
<br />
Next, If you measure every call to imap_headerinfo() function the result are even stranger! First and then every 22th call to the imap_headerinfo() function takes 10000 times more that the others. Example: the first call takes about 0.39 secs, then other 20 calls take about 0.0001 secs, then 22th call takes about 0.47 secs, then other 20 calls about 0.00004, and so on.<br />
<br />
After some more research there is something else that came up.<br />
<br />
If you use:<br />
<br />
$message_header[$i] = imap_headerinfo($mbox, $i + 1);<br />
<br />
it takes about 0.4 secs for every 22th call and about 0.0001 sec for other calls.<br />
<br />
However, you would expect the same results with:<br />
<br />
$message_header[$i] = imap_headerinfo($mbox, 30 - $i);<br />
<br />
But, in this case it takes about 0.2 secs for every call!<br />
<br />
The only difference here is that in the second example headers are retrieved in the reversed message order (from the 30th to the 1st) and for some reason it greatly affects the time needed for the operation. Strange, or is it just me?</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="98809""></a>
  <div class="note">
   <strong class="user">andyltm</strong>
   <a href="#98809" class="date">09-Jul-2010 12:17</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
When I was testing imap_headerinfo() with an e-mail that had multiple recipients (multiple e-mails in to to: and/or cc: field), I noticed that imap_headerinfo() was failing hard for me on PHP 5.2.10-2ubuntu6.4 with Suhosin-Patch 0.9.7 (cli).<br />
<br />
Rather than providing me an array with each and every e-mail address listed in the to and/or cc fields, it was only providing me the first listed.&nbsp; This was disappointing.<br />
<br />
&nbsp;&nbsp; [to] =&gt; Array<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; (&nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [0] =&gt; stdClass Object<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; (&nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [mailbox] =&gt; game<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [host] =&gt; blunts.com<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; )<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; )<br />
<br />
Luckily, there was a cool workaround to this problem:<br />
<br />
imap_rfc822_parse_headers(imap_fetchheader( string ); which subsequentally worked like a nice little pet would:<br />
<br />
&nbsp;&nbsp; [to] =&gt; Array<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; (&nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [0] =&gt; stdClass Object<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; (&nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [mailbox] =&gt; game<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [host] =&gt; blunts.com<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; )<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [1] =&gt; stdClass Object<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; (&nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [mailbox] =&gt; dutch<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [host] =&gt; masters.com<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; )<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; )<br />
<br />
TL;DR: <br />
So in other words, instead of imap_headerinfo() use imap_rfc822_parse_headers(imap_fetchheader()).<br />
<br />
Hope this helps anyone else that runs into this issue from now into the future.&nbsp; This post was suggested by people in #PHP on FreeNode IRC.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="95953""></a>
  <div class="note">
   <strong class="user">trinkaus at ttNetz dot de</strong>
   <a href="#95953" class="date">31-Jan-2010 11:32</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
When i try to access the same mailbox through pop3 and through imap i get different update infomations.<br />
<br />
1. Using imap <br />
header-&gt;udate is not the same as strtotime($header-&gt;date)<br />
<span class="default">&lt;?php<br />
$mBox </span><span class="keyword">= </span><span class="default">imap_open</span><span class="keyword">(</span><span class="string">"{host:143/imap/novalidate-cert}INBOX}"</span><span class="keyword">, </span><span class="default">$username</span><span class="keyword">, </span><span class="default">$password</span><span class="keyword">); </span><span class="comment">// open as imap<br />
</span><span class="default">$header </span><span class="keyword">= </span><span class="default">imap_header</span><span class="keyword">(</span><span class="default">$mBox</span><span class="keyword">, </span><span class="default">1</span><span class="keyword">); </span><span class="comment">// get first mails header<br />
</span><span class="keyword">echo </span><span class="default">$header</span><span class="keyword">-&gt;</span><span class="default">udate</span><span class="keyword">;<br />
echo </span><span class="default">strtotime</span><span class="keyword">(</span><span class="default">$header</span><span class="keyword">-&gt;</span><span class="default">date</span><span class="keyword">);<br />
</span><span class="default">?&gt;<br />
</span><br />
1. Using pop3<br />
header-&gt;udate is the same as strtotime($header-&gt;date)<br />
<span class="default">&lt;?php<br />
$mBox </span><span class="keyword">= </span><span class="default">imap_open</span><span class="keyword">(</span><span class="string">"{host:110/pop3/novalidate-cert}INBOX}"</span><span class="keyword">, </span><span class="default">$username</span><span class="keyword">, </span><span class="default">$password</span><span class="keyword">); </span><span class="comment">// open as pop3<br />
</span><span class="default">$header </span><span class="keyword">= </span><span class="default">imap_header</span><span class="keyword">(</span><span class="default">$mBox</span><span class="keyword">, </span><span class="default">1</span><span class="keyword">); </span><span class="comment">// get first mails header<br />
</span><span class="keyword">echo </span><span class="default">$header</span><span class="keyword">-&gt;</span><span class="default">udate</span><span class="keyword">;<br />
echo </span><span class="default">strtotime</span><span class="keyword">(</span><span class="default">$header</span><span class="keyword">-&gt;</span><span class="default">date</span><span class="keyword">);<br />
</span><span class="default">?&gt;<br />
</span><br />
I do not know why this is so, but for this reason, i use strtotime($header-&gt;date) together with other values to create my own message-UID because this seems to work independent from the protocol.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="95012""></a>
  <div class="note">
   <strong class="user">jahservant 13 at gmail dot com</strong>
   <a href="#95012" class="date">09-Dec-2009 12:56</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I'm not entirely sure why this is, but if you loop through all of the messages in a mailbox, calling imap_header() each time, you can significantly increase performance by calling imap_headers() first.<br />
<br />
Compare this:<br />
<span class="default">&lt;?php<br />
&nbsp;&nbsp; &nbsp; $imap </span><span class="keyword">= </span><span class="default">imap_open</span><span class="keyword">(</span><span class="string">"{my.server.com:143}INBOX"</span><span class="keyword">, </span><span class="string">"user"</span><span class="keyword">, </span><span class="string">"pass"</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; </span><span class="default">$n_msgs </span><span class="keyword">= </span><span class="default">imap_num_msg</span><span class="keyword">(</span><span class="default">$imap</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; </span><span class="default">$s </span><span class="keyword">= </span><span class="default">microtime</span><span class="keyword">(</span><span class="default">true</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; for (</span><span class="default">$i</span><span class="keyword">=</span><span class="default">0</span><span class="keyword">; </span><span class="default">$i</span><span class="keyword">&lt;</span><span class="default">$n_msgs</span><span class="keyword">; </span><span class="default">$i</span><span class="keyword">++) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$header </span><span class="keyword">= </span><span class="default">imap_header</span><span class="keyword">(</span><span class="default">$imap</span><span class="keyword">, </span><span class="default">$i</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; }<br />
&nbsp;&nbsp; &nbsp; </span><span class="default">$e </span><span class="keyword">= </span><span class="default">microtime</span><span class="keyword">(</span><span class="default">true</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; echo (</span><span class="default">$e </span><span class="keyword">- </span><span class="default">$s</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; </span><span class="default">imap_close</span><span class="keyword">(</span><span class="default">$imap</span><span class="keyword">);<br />
</span><span class="default">?&gt;<br />
</span><br />
With this:<br />
<span class="default">&lt;?php<br />
&nbsp;&nbsp; &nbsp; $imap </span><span class="keyword">= </span><span class="default">imap_open</span><span class="keyword">(</span><span class="string">"{my.server.com:143}INBOX"</span><span class="keyword">, </span><span class="string">"user"</span><span class="keyword">, </span><span class="string">"pass"</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; </span><span class="default">$n_msgs </span><span class="keyword">= </span><span class="default">imap_num_msg</span><span class="keyword">(</span><span class="default">$imap</span><span class="keyword">);<br />
&nbsp; </span><span class="comment">/****** adding this line: ******/<br />
&nbsp;&nbsp; &nbsp; </span><span class="default">imap_headers</span><span class="keyword">(</span><span class="default">$imap</span><span class="keyword">)<br />
&nbsp; </span><span class="comment">/***************************/<br />
&nbsp;&nbsp; &nbsp; </span><span class="default">$s </span><span class="keyword">= </span><span class="default">microtime</span><span class="keyword">(</span><span class="default">true</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; for (</span><span class="default">$i</span><span class="keyword">=</span><span class="default">0</span><span class="keyword">; </span><span class="default">$i</span><span class="keyword">&lt;</span><span class="default">$n_msgs</span><span class="keyword">; </span><span class="default">$i</span><span class="keyword">++) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$header </span><span class="keyword">= </span><span class="default">imap_header</span><span class="keyword">(</span><span class="default">$imap</span><span class="keyword">, </span><span class="default">$i</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; }<br />
&nbsp;&nbsp; &nbsp; </span><span class="default">$e </span><span class="keyword">= </span><span class="default">microtime</span><span class="keyword">(</span><span class="default">true</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; echo (</span><span class="default">$e </span><span class="keyword">- </span><span class="default">$s</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; </span><span class="default">imap_close</span><span class="keyword">(</span><span class="default">$imap</span><span class="keyword">);<br />
</span><span class="default">?&gt;<br />
</span><br />
The performance difference, as I have tested on several boxes, connecting to several different servers, is that the second code snippet ALWAYS takes 1/2 the time, if not less.<br />
<br />
Perhaps it is because imap_headers() retrieves all of the messages on one connection, whereas imap_header() has to make a new fetch request for each message??&nbsp; I'm not sure WHY it is faster if imap_headers() is called first, but I do know that it is, so I thought I'd pass on the knowledge.&nbsp; If anyone knows why this is, please let me know....</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="90943""></a>
  <div class="note">
   <strong class="user">aeolianmeson at exoyiga dot blitzeclipse dot com</strong>
   <a href="#90943" class="date">17-May-2009 07:56</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I typically use UID's to identify messages, and recently discovered that the headers I had been pulling using this function and a message-number didn't match the UID's. Instead of worrying about it, I just began using imap_fetchheader() and imap_ rfc822_ parse_ headers() on its output. The only significant difference I immediately noticed was that there is no "udate" property, so I assigned one with the result of strtotime() on the 'date' property.<br />
<br />
Dustin</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="88515""></a>
  <div class="note">
   <strong class="user">php at spacefish dot biz</strong>
   <a href="#88515" class="date">27-Jan-2009 07:57</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I had to pass the msgid as array($msgid) instead of an integer. the error "Invalid messageID" is generated if i pass an integer.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="86837""></a>
  <div class="note">
   <strong class="user">ron at NOSPAM dot clicks2hits dot com</strong>
   <a href="#86837" class="date">06-Nov-2008 02:51</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Simple little code for checking gmail using headerinfo<br />
<br />
<span class="default">&lt;?php </span><span class="comment">/* Created on: 11/3/2008 By Ron Hickey 6tx.net/gmail_mod <br />
Gmail mod for admin panels or you can edit it and convert html results to XML for personal RSS reader */ <br />
<br />
// enter gmail username below e.g.--&gt; $m_username = "yourusername";<br />
</span><span class="default">$m_username </span><span class="keyword">= </span><span class="string">""</span><span class="keyword">;<br />
<br />
</span><span class="comment">// enter gmail password below e.g.--&gt; $m_password = "yourpword";<br />
</span><span class="default">$m_password </span><span class="keyword">= </span><span class="string">""</span><span class="keyword">;<br />
<br />
</span><span class="comment">// enter the number of unread messages you want to display from mailbox or <br />
//enter 0 to display all unread messages e.g.--&gt; $m_acs = 0; <br />
</span><span class="default">$m_acs </span><span class="keyword">= </span><span class="default">15</span><span class="keyword">; <br />
<br />
</span><span class="comment">// How far back in time do you want to search for unread messages - one month = 0 , two weeks = 1, one week = 2, three days = 3,<br />
// one day = 4, six hours = 5 or one hour = 6 e.g.--&gt; $m_t = 6;<br />
</span><span class="default">$m_t </span><span class="keyword">= </span><span class="default">2</span><span class="keyword">;<br />
<br />
</span><span class="comment">//-----------&gt;Nothing More to edit below<br />
//open mailbox..........please<br />
</span><span class="default">$m_mail </span><span class="keyword">= </span><span class="default">imap_open </span><span class="keyword">(</span><span class="string">"{imap.gmail.com:993/imap/ssl}INBOX"</span><span class="keyword">, </span><span class="default">$m_username </span><span class="keyword">. </span><span class="string">"@gmail.com"</span><span class="keyword">, </span><span class="default">$m_password</span><span class="keyword">)<br />
<br />
</span><span class="comment">// or throw a freakin error............you pig<br />
</span><span class="keyword">or die(</span><span class="string">"ERROR: " </span><span class="keyword">. </span><span class="default">imap_last_error</span><span class="keyword">());<br />
<br />
</span><span class="comment">// unix time gone by or is it bye.....its certanly not bi.......or is it? ......I dunno fooker <br />
</span><span class="default">$m_gunixtp </span><span class="keyword">= array(</span><span class="default">2592000</span><span class="keyword">, </span><span class="default">1209600</span><span class="keyword">, </span><span class="default">604800</span><span class="keyword">, </span><span class="default">259200</span><span class="keyword">, </span><span class="default">86400</span><span class="keyword">, </span><span class="default">21600</span><span class="keyword">, </span><span class="default">3600</span><span class="keyword">);<br />
<br />
</span><span class="comment">// Date to start search<br />
</span><span class="default">$m_gdmy </span><span class="keyword">= </span><span class="default">date</span><span class="keyword">(</span><span class="string">'d-M-Y'</span><span class="keyword">, </span><span class="default">time</span><span class="keyword">() - </span><span class="default">$m_gunixtp</span><span class="keyword">[</span><span class="default">$m_t</span><span class="keyword">]); <br />
<br />
</span><span class="comment">//search mailbox for unread messages since $m_t date <br />
</span><span class="default">$m_search</span><span class="keyword">=</span><span class="default">imap_search </span><span class="keyword">(</span><span class="default">$m_mail</span><span class="keyword">, </span><span class="string">'UNSEEN SINCE ' </span><span class="keyword">. </span><span class="default">$m_gdmy </span><span class="keyword">. </span><span class="string">''</span><span class="keyword">);<br />
<br />
</span><span class="comment">//If mailbox is empty......Display "No New Messages", else........ You got mail....oh joy<br />
</span><span class="keyword">if(</span><span class="default">$m_search </span><span class="keyword">&lt; </span><span class="default">1</span><span class="keyword">){ <br />
</span><span class="default">$m_empty </span><span class="keyword">= </span><span class="string">"No New Messages"</span><span class="keyword">;} <br />
else {<br />
<br />
</span><span class="comment">// Order results starting from newest message<br />
</span><span class="default">rsort</span><span class="keyword">(</span><span class="default">$m_search</span><span class="keyword">);<br />
<br />
</span><span class="comment">//if m_acs &gt; 0 then limit results<br />
</span><span class="keyword">if(</span><span class="default">$m_acs </span><span class="keyword">&gt; </span><span class="default">0</span><span class="keyword">){ <br />
</span><span class="default">array_splice</span><span class="keyword">(</span><span class="default">$m_search</span><span class="keyword">, </span><span class="default">$m_acs</span><span class="keyword">);<br />
} <br />
<br />
</span><span class="comment">//loop it <br />
</span><span class="keyword">foreach (</span><span class="default">$m_search </span><span class="keyword">as </span><span class="default">$what_ever</span><span class="keyword">) { <br />
<br />
</span><span class="comment">//get imap header info for obj thang <br />
</span><span class="default">$obj_thang </span><span class="keyword">= </span><span class="default">imap_headerinfo</span><span class="keyword">(</span><span class="default">$m_mail</span><span class="keyword">, </span><span class="default">$what_ever</span><span class="keyword">);<br />
<br />
</span><span class="comment">//Then spit it out below.........if you dont swallow <br />
</span><span class="keyword">echo </span><span class="string">"&lt;body bgcolor=D3D3D3&gt;&lt;div align=center&gt;&lt;br /&gt;&lt;font face=Arial size=2 color=#800000&gt;Message ID# " </span><span class="keyword">. </span><span class="default">$what_ever </span><span class="keyword">. </span><span class="string">"&lt;/font&gt;<br />
<br />
&lt;table bgcolor=#D3D3D3 width=700 border=1 bordercolor=#000000 cellpadding=0 cellspacing=0&gt;<br />
&lt;tr&gt;<br />
&lt;td&gt;&lt;table width=100% border=0&gt;<br />
&lt;tr&gt;<br />
&lt;td&gt;&lt;table width=100% border=0&gt;<br />
&lt;tr&gt;<br />
&lt;td bgcolor=#F8F8FF&gt;&lt;font face=Arial size=2 color=#800000&gt;Date:&lt;/font&gt; &lt;font face=Arial size=2 color=#000000&gt;" </span><span class="keyword">. </span><span class="default">date</span><span class="keyword">(</span><span class="string">"F j, Y, g:i a"</span><span class="keyword">, </span><span class="default">$obj_thang</span><span class="keyword">-&gt;</span><span class="default">udate</span><span class="keyword">) . </span><span class="string">"&lt;/font&gt;&lt;/td&gt;<br />
&lt;td bgcolor=#F8F8FF&gt;&lt;font face=Arial size=2 color=#800000&gt;From:&lt;/font&gt; &lt;font face=Arial size=2 color=#000000&gt;" </span><span class="keyword">. </span><span class="default">$obj_thang</span><span class="keyword">-&gt;</span><span class="default">fromaddress </span><span class="keyword">. </span><span class="string">"&lt;/font&gt;&lt;/td&gt;<br />
&lt;td bgcolor=#F8F8FF&gt;&lt;font face=Arial size=2 color=#800000&gt;To:&lt;/font&gt; &lt;font face=Arial size=2 color=#000000&gt;" </span><span class="keyword">. </span><span class="default">$obj_thang</span><span class="keyword">-&gt;</span><span class="default">toaddress </span><span class="keyword">. </span><span class="string">" &lt;/font&gt;&lt;/td&gt;<br />
&lt;/tr&gt;<br />
&lt;tr&gt;<br />
&lt;/table&gt;<br />
&lt;/td&gt;<br />
&lt;/tr&gt;&lt;tr&gt;&lt;td bgcolor=#F8F8FF&gt;&lt;font face=Arial size=2 color=#800000&gt;Subject:&lt;/font&gt; &lt;font face=Arial size=2 color=#000000&gt;" </span><span class="keyword">. </span><span class="default">$obj_thang</span><span class="keyword">-&gt;</span><span class="default">Subject </span><span class="keyword">. </span><span class="string">"&lt;/font&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;<br />
&lt;/tr&gt;<br />
&lt;/table&gt;&lt;/td&gt;<br />
&lt;/tr&gt;<br />
&lt;/table&gt;&lt;a href=<a href="http://gmail.com target=_blank&gt;&lt;font face=Arial size=2 color=#800000&gt;Login to read message&lt;/a&gt;&lt;/font&gt;&lt;br /&gt;&lt;/div&gt;&lt;/body&gt;" rel="nofollow" target="_blank">http://gmail.com target=_blank&gt;&lt;font face=Arial size=2 color=#800000&gt;Login to read message&lt;/a&gt;&lt;/font&gt;&lt;br /&gt;&lt;/div&gt;&lt;/body&gt;</a>"</span><span class="keyword">;<br />
<br />
}} echo </span><span class="string">"&lt;div align=center&gt;&lt;font face=Arial size=4 color=#800000&gt;&lt;b&gt;" </span><span class="keyword">. </span><span class="default">$m_empty </span><span class="keyword">. </span><span class="string">"&lt;/b&gt;&lt;/font&gt;&lt;/div&gt;"</span><span class="keyword">;<br />
</span><span class="comment">//close mailbox bi by bye<br />
</span><span class="default">imap_close</span><span class="keyword">(</span><span class="default">$m_mail</span><span class="keyword">);<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="26741""></a>
  <div class="note">
   <strong class="user">scott at fuzzygroup dot com</strong>
   <a href="#26741" class="date">11-Nov-2002 06:13</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If you want to extract values from to, from, or other header elements, they are an object and you need to loop over them i.e.<br />
<br />
$header = imap_header($mbox, $message_id);<br />
$from = $header-&gt;from;<br />
foreach ($from as $id =&gt; $object) {<br />
&nbsp;&nbsp;&nbsp; $fromname = $object-&gt;personal;<br />
&nbsp;&nbsp;&nbsp; $fromaddress = $object-&gt;mailbox . "@" . $object-&gt;host;<br />
}<br />
<br />
Would give you two variables for the friendly from and the smtp from address<br />
<br />
Thanks to www.natrak.net for help with this</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
</div>
</div>
</div></div></body></html>
