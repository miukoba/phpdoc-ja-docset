<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
 <head>
  <meta http-equiv="content-type" content="text/html; CHARSET=shift-jis">
  <title>エンコードされる前のデータを使用して POST リクエストを実行する</title>

  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <link media="all" rel="stylesheet" type="text/css" href="style.css"/>
 </head>
 <body class="docs" class="docs"><div class="navbar navbar-fixed-top">
  <div class="navbar-inner clearfix">
    <ul class="nav" style="width: 100%">
      <li style="float: left;"><a href="function.http-post-data.html">≪ http_post_data</a></li>
      <li style="float: right;"><a href="function.http-put-data.html">http_put_data ≫</a></li>
    </ul>
  </div>
</div>
<div id="breadcrumbs" class="clearfix">
  <ul class="breadcrumbs-container">
    <li><a href="index.html">PHP Manual</a></li>
    <li><a href="ref.http.html">HTTP 関数</a></li>
    <li>エンコードされる前のデータを使用して POST リクエストを実行する</li>
  </ul>
</div>
<div id="layout">
  <div id="layout-content"><div id="function.http-post-fields" class="refentry">
 <div class="refnamediv">
  <h1 class="refname">http_post_fields</h1>
  <p class="verinfo">(PECL pecl_http &gt;= 0.10.0)</p><p class="refpurpose"><span class="refname">http_post_fields</span> &mdash; <span class="dc-title">エンコードされる前のデータを使用して POST リクエストを実行する</span></p>

 </div>
 <div class="refsect1 description" id="refsect1-function.http-post-fields-description">
  <h3 class="title">説明</h3>
  <div class="methodsynopsis dc-description">
   <span class="type">string</span> <span class="methodname"><strong>http_post_fields</strong></span>
    ( <span class="methodparam"><span class="type">string</span> <code class="parameter">$url</code></span>
   , <span class="methodparam"><span class="type">array</span> <code class="parameter">$data</code></span>
   [, <span class="methodparam"><span class="type">array</span> <code class="parameter">$files</code></span>
   [, <span class="methodparam"><span class="type">array</span> <code class="parameter">$options</code></span>
   [, <span class="methodparam"><span class="type">array</span> <code class="parameter reference">&$info</code></span>
  ]]] )</div>

  <p class="para rdfs-comment">
   指定した url に対して HTTP POST リクエストを実行します。
  </p>
  <p class="para"><a href="http.request.options.html" class="link">リクエストのオプション</a> を参照ください。</p>
 </div>

 <div class="refsect1 parameters" id="refsect1-function.http-post-fields-parameters">
  <h3 class="title">パラメータ</h3>
  <p class="para">
   <dl>

    
     <dt>
<code class="parameter">url</code></dt>

     <dd>

      <p class="para">
       URL。
      </p>
     </dd>

    
    
     <dt>
<code class="parameter">data</code></dt>

     <dd>

      <p class="para">
       POST する値の連想配列。
      </p>
     </dd>

    
    
     <dt>
<code class="parameter">files</code></dt>

     <dd>

      <p class="para">
       POST するファイルの配列。
      </p>
     </dd>

    
    
     <dt>
<code class="parameter">options</code></dt>

     <dd>

      <p class="para">
       <a href="http.request.options.html" class="link">リクエストのオプション</a>
      </p>
     </dd>

    
    
     <dt>
<code class="parameter">info</code></dt>

     <dd>

      <p class="para">
       <a href="function.http-get.html#http.request.info" class="link">リクエスト/レスポンス の情報</a>
      </p>
     </dd>

    
   </dl>

  </p>
 </div>

 <div class="refsect1 returnvalues" id="refsect1-function.http-post-fields-returnvalues">
  <h3 class="title">返り値</h3>
  <p class="para">
   成功した場合は HTTP レスポンスを文字列で、失敗した場合は <strong><code>FALSE</code></strong> を返します。
  </p>
 </div>


 


 


 <div class="refsect1 examples" id="refsect1-function.http-post-fields-examples">
  <h3 class="title">例</h3>
  <p class="para">
   <div class="example" id="example-4485">
    <p><strong>例1 <span class="function"><strong>http_post_fields()</strong></span> の例</strong></p>
    <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br />$fields&nbsp;</span><span style="color: #007700">=&nbsp;array(<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #DD0000">'name'&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #DD0000">'mike'</span><span style="color: #007700">,<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #DD0000">'pass'&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #DD0000">'se_ret'<br /></span><span style="color: #007700">);<br /></span><span style="color: #0000BB">$files&nbsp;</span><span style="color: #007700">=&nbsp;array(<br />&nbsp;&nbsp;&nbsp;&nbsp;array(<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #DD0000">'name'&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #DD0000">'uimg'</span><span style="color: #007700">,<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #DD0000">'type'&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #DD0000">'image/jpeg'</span><span style="color: #007700">,<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #DD0000">'file'&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #DD0000">'./profile.jpg'</span><span style="color: #007700">,<br />&nbsp;&nbsp;&nbsp;&nbsp;)<br />);<br /><br /></span><span style="color: #0000BB">$response&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">http_post_fields</span><span style="color: #007700">(</span><span style="color: #DD0000">"http://www.example.com/"</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$fields</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$files</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
    </div>

   </div>
  </p>
 </div>



 


</div><div id="usernotes">
 <div class="head">
  <h3 class="title">User Contributed Notes</h3>
 </div>
<div id="allnotes">  <a name="96301""></a>
  <div class="note">
   <strong class="user">dionmagnus at yandex dot ru</strong>
   <a href="#96301" class="date">19-Feb-2010 01:11</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Hear is an axmaple how to arrays as POST varibles:<br />
<span class="default">&lt;?php<br />
&nbsp; <br />
&nbsp; $response </span><span class="keyword">= </span><span class="default">http_post_fields</span><span class="keyword">(</span><span class="string">'<a href="http://example.com/page.php" rel="nofollow" target="_blank">http://example.com/page.php</a>'</span><span class="keyword">,<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; array(</span><span class="string">'val[0]'</span><span class="keyword">=&gt;</span><span class="string">'val1'</span><span class="keyword">, </span><span class="string">'val[1]'</span><span class="keyword">=&gt;</span><span class="string">'val2'</span><span class="keyword">));<br />
&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp; echo </span><span class="string">"\$response: </span><span class="default">$response</span><span class="string">\n"</span><span class="keyword">;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="81519""></a>
  <div class="note">
   <strong class="user">ya at kirilloid dot ru</strong>
   <a href="#81519" class="date">02-Mar-2008 04:59</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
comment to wormholio's answer:<br />
if you use regular expression, then use it fully:<br />
"/HTTP\/\d\.\d 302 Found/"<br />
Some servers still can use HTTP 1.0</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="80683""></a>
  <div class="note">
   <strong class="user">wormholio at gmail dot com</strong>
   <a href="#80683" class="date">29-Jan-2008 04:32</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
To use POST to submit a form to a site which requires a cookie for authentication you put the cookie in the $options array.&nbsp; Example:<br />
<br />
<span class="default">&lt;?php<br />
<br />
$auth</span><span class="keyword">=</span><span class="string">"xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx"</span><span class="keyword">;<br />
<br />
</span><span class="default">$form_url</span><span class="keyword">=</span><span class="string">"<a href="http://pirates.spy-hill.net/forum_reply.php?thread=663" rel="nofollow" target="_blank">http://pirates.spy-hill.net/forum_reply.php?thread=663</a>"</span><span class="keyword">;<br />
<br />
</span><span class="default">$message&nbsp; </span><span class="keyword">= </span><span class="string">"RoboCodeDwarf now has the gold. \n\n"</span><span class="keyword">;<br />
</span><span class="default">$message </span><span class="keyword">.= </span><span class="string">"RoboCodeDwarf sez: [quote] " </span><span class="keyword">. `</span><span class="string">fortune -s</span><span class="keyword">` . </span><span class="string">"[/quote]\n"</span><span class="keyword">;<br />
<br />
</span><span class="default">$form_fields </span><span class="keyword">= array(<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="string">'content' </span><span class="keyword">=&gt; </span><span class="default">$message</span><span class="keyword">,<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="string">'add_signature' </span><span class="keyword">=&gt; </span><span class="string">'add_it'</span><span class="keyword">,<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="string">'submit' </span><span class="keyword">=&gt; </span><span class="string">'Post reply'&nbsp; </span><span class="keyword">);<br />
</span><span class="default">$form_files</span><span class="keyword">=array();<br />
</span><span class="default">$form_options</span><span class="keyword">=array( </span><span class="string">'cookies' </span><span class="keyword">=&gt; array( </span><span class="string">'auth' </span><span class="keyword">=&gt; </span><span class="default">$auth </span><span class="keyword">) );<br />
<br />
</span><span class="default">$response </span><span class="keyword">= </span><span class="default">http_post_fields</span><span class="keyword">(</span><span class="default">$form_url</span><span class="keyword">, </span><span class="default">$form_fields</span><span class="keyword">, </span><span class="default">$form_files</span><span class="keyword">, </span><span class="default">$form_options </span><span class="keyword">);<br />
<br />
</span><span class="default">$n </span><span class="keyword">= </span><span class="default">preg_match</span><span class="keyword">(</span><span class="string">"/HTTP\/1.1 302 Found/"</span><span class="keyword">, </span><span class="default">$response</span><span class="keyword">, </span><span class="default">$matches</span><span class="keyword">);<br />
if(</span><span class="default">$n</span><span class="keyword">&lt;</span><span class="default">1</span><span class="keyword">) echo </span><span class="string">"FAILED\n"</span><span class="keyword">;<br />
&nbsp;else&nbsp; &nbsp; echo </span><span class="string">"POSTED\n"</span><span class="keyword">;<br />
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="72196""></a>
  <div class="note">
   <strong class="user">thomasxholder at compuserve dot de</strong>
   <a href="#72196" class="date">07-Jan-2007 12:21</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
It was hard to figure out how to actually post files with this function. The "Array of files to post" is an array of associative arrays, each need the keys "name", "type" and "file". Consider this example code:<br />
<br />
<span class="default">&lt;?php<br />
$files </span><span class="keyword">= array(<br />
&nbsp;&nbsp;&nbsp; array(<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="string">'name' </span><span class="keyword">=&gt; </span><span class="string">'somename'</span><span class="keyword">,<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="string">'type' </span><span class="keyword">=&gt; </span><span class="string">'text/plain'</span><span class="keyword">,<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="string">'file' </span><span class="keyword">=&gt; </span><span class="default">$filename<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">)<br />
);<br />
</span><span class="default">$http_response </span><span class="keyword">= </span><span class="default">http_post_fields</span><span class="keyword">(</span><span class="default">$url</span><span class="keyword">, </span><span class="default">$data</span><span class="keyword">, </span><span class="default">$files</span><span class="keyword">);<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
</div>
</div>
</div></div></body></html>
