<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
 <head>
  <meta http-equiv="content-type" content="text/html; CHARSET=shift-jis">
  <title>メールを送信する</title>

  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <link media="all" rel="stylesheet" type="text/css" href="style.css"/>
 </head>
 <body class="docs" class="docs"><div class="navbar navbar-fixed-top">
  <div class="navbar-inner clearfix">
    <ul class="nav" style="width: 100%">
      <li style="float: left;"><a href="function.ezmlm-hash.html">≪ ezmlm_hash</a></li>
      <li style="float: right;"><a href="book.mailparse.html">Mailparse ≫</a></li>
    </ul>
  </div>
</div>
<div id="breadcrumbs" class="clearfix">
  <ul class="breadcrumbs-container">
    <li><a href="index.html">PHP Manual</a></li>
    <li><a href="ref.mail.html">メール 関数</a></li>
    <li>メールを送信する</li>
  </ul>
</div>
<div id="layout">
  <div id="layout-content"><div id="function.mail" class="refentry">
 <div class="refnamediv">
  <h1 class="refname">mail</h1>
  <p class="verinfo">(PHP 4, PHP 5)</p><p class="refpurpose"><span class="refname">mail</span> &mdash; <span class="dc-title">メールを送信する</span></p>

 </div>

 <div class="refsect1 description" id="refsect1-function.mail-description">
  <h3 class="title">説明</h3>
  <div class="methodsynopsis dc-description">
   <span class="type">bool</span> <span class="methodname"><strong>mail</strong></span>
    ( <span class="methodparam"><span class="type">string</span> <code class="parameter">$to</code></span>
   , <span class="methodparam"><span class="type">string</span> <code class="parameter">$subject</code></span>
   , <span class="methodparam"><span class="type">string</span> <code class="parameter">$message</code></span>
   [, <span class="methodparam"><span class="type">string</span> <code class="parameter">$additional_headers</code></span>
   [, <span class="methodparam"><span class="type">string</span> <code class="parameter">$additional_parameters</code></span>
  ]] )</div>

  <p class="para rdfs-comment">
   メールを送信します。
  </p>
 </div>


 <div class="refsect1 parameters" id="refsect1-function.mail-parameters">
  <h3 class="title">パラメータ</h3>
  <p class="para">
   <dl>

    
     <dt>
<code class="parameter">to</code></dt>

     <dd>

      <p class="para">
       メールの受信者。
      </p>
      <p class="para">
       <a href="http://www.faqs.org/rfcs/rfc2822" class="link external" title="Link : http://www.faqs.org/rfcs/rfc2822">&raquo;&nbsp;RFC 2822</a> を満たす書式でなければ
       なりません。例えば以下のようなものです。
       <ul class="simplelist">
        <li class="member">user@example.com</li>
        <li class="member">user@example.com, anotheruser@example.com</li>
        <li class="member">User &lt;user@example.com&gt;</li>
        <li class="member">User &lt;user@example.com&gt;, Another User &lt;anotheruser@example.com&gt;</li>
       </ul>
      </p>
     </dd>

    
    
     <dt>
<code class="parameter">subject</code></dt>

     <dd>

      <p class="para">
       送信するメールの表題。
      </p>
      <div class="caution"><strong class="caution">警告</strong>
       <p class="para">
        表題は <a href="http://www.faqs.org/rfcs/rfc2047" class="link external" title="Link : http://www.faqs.org/rfcs/rfc2047">&raquo;&nbsp;RFC 2047</a>
        を満たすものでなければなりません。
       </p>
      </div>
     </dd>

    
    
     <dt>
<code class="parameter">message</code></dt>

     <dd>

      <p class="para">
       送信するメッセージ。
      </p>
      <p class="para">
       改行コードは CRLF (\r\n) となります。各行の長さは 70 文字を超えては
       いけません。
      </p>
      <div class="caution"><strong class="caution">警告</strong>
       <p class="para">
        （Windows のみ）PHP が SMTP サーバーと直接通信をする際、ピリオドから
        始まる行は無視されます。これを防ぐには、行頭のピリオドを
        ピリオド 2 つに置き換えてください。
        <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br />$text&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">str_replace</span><span style="color: #007700">(</span><span style="color: #DD0000">"\n."</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">"\n.."</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$text</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
        </div>

       </p>
      </div>
     </dd>

    
    
     <dt>
<code class="parameter">additional_headers</code>（オプション）</dt>

     <dd>

      <p class="para">
       メールヘッダの最後に挿入される文字列。
      </p>
      <p class="para">
       通常、これは追加のヘッダ（From、Cc、Bcc）のために用いられます。
       複数のヘッダを追加する場合は CRLF（\r\n）で区切ります。
       If outside data are used to compose this header, the data should be sanitized
       so that no unwanted headers could be injected. 
      </p>
      <blockquote class="note"><p><strong class="note">注意</strong>: 
       <p class="para">
        メールを送信する際には、<em class="emphasis">必ず</em> 
        <em>From</em> ヘッダが含まれていなければなりません。
        <code class="parameter">additional_headers</code> パラメータで指定するか、
        あるいは <var class="filename">php.ini</var> にデフォルト値を指定します。
       </p>
       <p class="para">
        指定しなかった場合は、以下のようなエラーメッセージが返ります
        <em>Warning: mail(): &quot;sendmail_from&quot; not
        set in php.ini or custom &quot;From:&quot; header missing</em> 。
        Windows では、<em>From</em> ヘッダを設定すると
        <em>Return-Path</em> も設定されます。
       </p>
      </p></blockquote>
      <blockquote class="note"><p><strong class="note">注意</strong>: 
       <p class="para">
        メッセージが受信されなかった場合には、LF（\n）のみを使ってみてください。
        Unix の MTA の中には、自動的に LF を CRLF に変換してしまう
        もの (有名なところでは、<a href="http://www.qmail.org/" class="link external" title="Link : http://www.qmail.org/">&raquo;&nbsp;qmail</a> など)
        があります（もし CRLF を利用していた場合、CR が重複してしまいます）。
        ただし、これは最後の手段です。というのも、これは
        <a href="http://www.faqs.org/rfcs/rfc2822" class="link external" title="Link : http://www.faqs.org/rfcs/rfc2822">&raquo;&nbsp;RFC 2822</a> に違反しているからです。
       </p>
      </p></blockquote>
     </dd>

    
    
     <dt>
<code class="parameter">additional_parameters</code>（オプション）</dt>

     <dd>

      <p class="para">
       パラメータ <code class="parameter">additional_parameters</code> は、
       追加のフラグをコマンドラインオプションとしてメール送信プログラムに渡す際に使用可能です。
       メール送信プログラムは、設定オプション
       <em>sendmail_path</em> により設定されます。例えば、
       sendmail を使用する際に <em>-f</em> オプションを使って
       エンベロープの sender アドレスを設定する際に使用できます。
      </p>
      <p class="para">
       This parameter is escaped by <span class="function"><a href="function.escapeshellcmd.html" class="function">escapeshellcmd()</a></span> internally
       to prevent command execution. <span class="function"><a href="function.escapeshellcmd.html" class="function">escapeshellcmd()</a></span> prevents
       command execution, but allows to add addtional parameters. For security reasons,
       it is recommended for the user to sanitize this parameter to avoid adding unwanted
       parameters to the shell command.
      </p>
      <p class="para">
       Since <span class="function"><a href="function.escapeshellcmd.html" class="function">escapeshellcmd()</a></span> is applied automatically, some characters
       that are allowed as email addresses by internet RFCs cannot be used. 
       <span class="function"><strong>mail()</strong></span> can not allow such characters, so in programs where the use of
       such characters is required, alternative means of sending emails (such as using a framework
       or a library) is recommended. 
      </p>
      <p class="para">
       この方法でエンベロープの sender ヘッダ（-f）を設定する際は、
       &#039;X-Warning&#039; ヘッダが付加されないように Web サーバーの実行ユーザーを
       sendmail 設定に追加しておく必要があるかもしれません。
       sendmail を利用している場合、これは <var class="filename">/etc/mail/trusted-users</var>
       で設定します。
      </p>
     </dd>

    
   </dl>

  </p>
 </div>


 <div class="refsect1 returnvalues" id="refsect1-function.mail-returnvalues">
  <h3 class="title">返り値</h3>
  <p class="para">
   メール送信が受け入れられた場合に <strong><code>TRUE</code></strong> 、それ以外の場合に <strong><code>FALSE</code></strong>
   を返します。
  </p>
  <p class="para">
   メールの配送が受け入れられたかどうかが基準であることに注意しましょう。
   メールが実際にあて先に届いたかどうかでは「ありません」。
  </p>
 </div>


 <div class="refsect1 changelog" id="refsect1-function.mail-changelog">
  <h3 class="title">変更履歴</h3>
  <p class="para">
   <table class="doctable informaltable">
    
     <thead>
      <tr>
       <th>バージョン</th>
       <th>説明</th>
      </tr>

     </thead>

     <tbody class="tbody">
      <tr>
       <td>4.2.3</td>
       <td>
        <a href="ini.sect.safe-mode.html#ini.safe-mode" class="link">safe_mode</a> 時には
        <code class="parameter">additional_parameters</code> パラメータを無効に
        しました。もし用いられた場合には <span class="function"><strong>mail()</strong></span> 関数は
        警告メッセージを出して <strong><code>FALSE</code></strong> を返します。
       </td>
      </tr>

     </tbody>
    
   </table>

  </p>
 </div>


 <div class="refsect1 examples" id="refsect1-function.mail-examples">
  <h3 class="title">例</h3>
  <p class="para">
   <div class="example" id="example-3476">
    <p><strong>例1 メールを送信する</strong></p>
    <div class="example-contents"><p>
     <span class="function"><strong>mail()</strong></span> を用いて単純なメールを送信する。
    </p></div>
    <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br /></span><span style="color: #FF8000">//&nbsp;本文<br /></span><span style="color: #0000BB">$message&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #DD0000">"Line&nbsp;1\r\nLine&nbsp;2\r\nLine&nbsp;3"</span><span style="color: #007700">;<br /><br /></span><span style="color: #FF8000">//&nbsp;1&nbsp;行が&nbsp;70&nbsp;文字を超える場合のため、wordwrap()&nbsp;を用いる<br /></span><span style="color: #0000BB">$message&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">wordwrap</span><span style="color: #007700">(</span><span style="color: #0000BB">$message</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">70</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">"\r\n"</span><span style="color: #007700">);<br /><br /></span><span style="color: #FF8000">//&nbsp;送信する<br /></span><span style="color: #0000BB">mail</span><span style="color: #007700">(</span><span style="color: #DD0000">'caffeinated@example.com'</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">'My&nbsp;Subject'</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$message</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
    </div>

   </div>
   <div class="example" id="example-3477">
    <p><strong>例2 追加ヘッダを付加してメールを送信する</strong></p>
    <div class="example-contents"><p>
     基本ヘッダに加え、MUA に From および Reply-To アドレスを通知する。
    </p></div>
    <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br />$to&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #DD0000">'nobody@example.com'</span><span style="color: #007700">;<br /></span><span style="color: #0000BB">$subject&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #DD0000">'the&nbsp;subject'</span><span style="color: #007700">;<br /></span><span style="color: #0000BB">$message&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #DD0000">'hello'</span><span style="color: #007700">;<br /></span><span style="color: #0000BB">$headers&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #DD0000">'From:&nbsp;webmaster@example.com'&nbsp;</span><span style="color: #007700">.&nbsp;</span><span style="color: #DD0000">"\r\n"&nbsp;</span><span style="color: #007700">.<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #DD0000">'Reply-To:&nbsp;webmaster@example.com'&nbsp;</span><span style="color: #007700">.&nbsp;</span><span style="color: #DD0000">"\r\n"&nbsp;</span><span style="color: #007700">.<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #DD0000">'X-Mailer:&nbsp;PHP/'&nbsp;</span><span style="color: #007700">.&nbsp;</span><span style="color: #0000BB">phpversion</span><span style="color: #007700">();<br /><br /></span><span style="color: #0000BB">mail</span><span style="color: #007700">(</span><span style="color: #0000BB">$to</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$subject</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$message</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$headers</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
    </div>

   </div>
   <div class="example" id="example-3478">
    <p><strong>例3 追加ヘッダ及び追加コマンドラインパラメータを指定してメールを送信する</strong></p>
    <div class="example-contents"><p>
     <em>sendmail_path</em> を用いてメールを送信する際に利用する
     追加パラメータとして、<code class="parameter">additional_parameters</code>
     が用いられます。
    </p></div>
    <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br />mail</span><span style="color: #007700">(</span><span style="color: #DD0000">'nobody@example.com'</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">'the&nbsp;subject'</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">'the&nbsp;message'</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">null</span><span style="color: #007700">,<br />&nbsp;&nbsp;&nbsp;</span><span style="color: #DD0000">'-fwebmaster@example.com'</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
    </div>

   </div>
   <div class="example" id="example-3479">
    <p><strong>例4 HTML メールを送信する</strong></p>
    <div class="example-contents"><p>
     <span class="function"><strong>mail()</strong></span> を用いて HTML メールを送信することも可能です。
    </p></div>
    <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br /></span><span style="color: #FF8000">//&nbsp;複数の受信者を指定<br /></span><span style="color: #0000BB">$to&nbsp;&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #DD0000">'aidan@example.com'&nbsp;</span><span style="color: #007700">.&nbsp;</span><span style="color: #DD0000">',&nbsp;'</span><span style="color: #007700">;&nbsp;</span><span style="color: #FF8000">//&nbsp;カンマに注意<br /></span><span style="color: #0000BB">$to&nbsp;</span><span style="color: #007700">.=&nbsp;</span><span style="color: #DD0000">'wez@example.com'</span><span style="color: #007700">;<br /><br /></span><span style="color: #FF8000">//&nbsp;表題<br /></span><span style="color: #0000BB">$subject&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #DD0000">'Birthday&nbsp;Reminders&nbsp;for&nbsp;August'</span><span style="color: #007700">;<br /><br /></span><span style="color: #FF8000">//&nbsp;本文<br /></span><span style="color: #0000BB">$message&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #DD0000">'<br />&lt;html&gt;<br />&lt;head&gt;<br />&nbsp;&nbsp;&lt;title&gt;Birthday&nbsp;Reminders&nbsp;for&nbsp;August&lt;/title&gt;<br />&lt;/head&gt;<br />&lt;body&gt;<br />&nbsp;&nbsp;&lt;p&gt;Here&nbsp;are&nbsp;the&nbsp;birthdays&nbsp;upcoming&nbsp;in&nbsp;August!&lt;/p&gt;<br />&nbsp;&nbsp;&lt;table&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&lt;tr&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;th&gt;Person&lt;/th&gt;&lt;th&gt;Day&lt;/th&gt;&lt;th&gt;Month&lt;/th&gt;&lt;th&gt;Year&lt;/th&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&lt;/tr&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&lt;tr&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;td&gt;Joe&lt;/td&gt;&lt;td&gt;3rd&lt;/td&gt;&lt;td&gt;August&lt;/td&gt;&lt;td&gt;1970&lt;/td&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&lt;/tr&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&lt;tr&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;td&gt;Sally&lt;/td&gt;&lt;td&gt;17th&lt;/td&gt;&lt;td&gt;August&lt;/td&gt;&lt;td&gt;1973&lt;/td&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&lt;/tr&gt;<br />&nbsp;&nbsp;&lt;/table&gt;<br />&lt;/body&gt;<br />&lt;/html&gt;<br />'</span><span style="color: #007700">;<br /><br /></span><span style="color: #FF8000">//&nbsp;HTML&nbsp;メールを送信するには&nbsp;Content-type&nbsp;ヘッダが必須<br /></span><span style="color: #0000BB">$headers&nbsp;&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #DD0000">'MIME-Version:&nbsp;1.0'&nbsp;</span><span style="color: #007700">.&nbsp;</span><span style="color: #DD0000">"\r\n"</span><span style="color: #007700">;<br /></span><span style="color: #0000BB">$headers&nbsp;</span><span style="color: #007700">.=&nbsp;</span><span style="color: #DD0000">'Content-type:&nbsp;text/html;&nbsp;charset=iso-8859-1'&nbsp;</span><span style="color: #007700">.&nbsp;</span><span style="color: #DD0000">"\r\n"</span><span style="color: #007700">;<br /><br /></span><span style="color: #FF8000">//&nbsp;追加のヘッダ<br /></span><span style="color: #0000BB">$headers&nbsp;</span><span style="color: #007700">.=&nbsp;</span><span style="color: #DD0000">'To:&nbsp;Mary&nbsp;&lt;mary@example.com&gt;,&nbsp;Kelly&nbsp;&lt;kelly@example.com&gt;'&nbsp;</span><span style="color: #007700">.&nbsp;</span><span style="color: #DD0000">"\r\n"</span><span style="color: #007700">;<br /></span><span style="color: #0000BB">$headers&nbsp;</span><span style="color: #007700">.=&nbsp;</span><span style="color: #DD0000">'From:&nbsp;Birthday&nbsp;Reminder&nbsp;&lt;birthday@example.com&gt;'&nbsp;</span><span style="color: #007700">.&nbsp;</span><span style="color: #DD0000">"\r\n"</span><span style="color: #007700">;<br /></span><span style="color: #0000BB">$headers&nbsp;</span><span style="color: #007700">.=&nbsp;</span><span style="color: #DD0000">'Cc:&nbsp;birthdayarchive@example.com'&nbsp;</span><span style="color: #007700">.&nbsp;</span><span style="color: #DD0000">"\r\n"</span><span style="color: #007700">;<br /></span><span style="color: #0000BB">$headers&nbsp;</span><span style="color: #007700">.=&nbsp;</span><span style="color: #DD0000">'Bcc:&nbsp;birthdaycheck@example.com'&nbsp;</span><span style="color: #007700">.&nbsp;</span><span style="color: #DD0000">"\r\n"</span><span style="color: #007700">;<br /><br /></span><span style="color: #FF8000">//&nbsp;送信する<br /></span><span style="color: #0000BB">mail</span><span style="color: #007700">(</span><span style="color: #0000BB">$to</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$subject</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$message</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$headers</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
    </div>

   </div>
  </p>
  <p class="para">
   <blockquote class="note"><p><strong class="note">注意</strong>: 
    <p class="para">
     HTML などの複雑な形式のメールを送信する場合は、PEAR パッケージ
     <a href="http://pear.php.net/package/Mail_Mime" class="link external" title="Link : http://pear.php.net/package/Mail_Mime">&raquo;&nbsp;PEAR::Mail_Mime</a>
     を利用することを推奨します。
    </p>
   </p></blockquote>
  </p>
 </div>


 <div class="refsect1 notes" id="refsect1-function.mail-notes">    
  <h3 class="title">注意</h3>
  <blockquote class="note"><p><strong class="note">注意</strong>: 
   <p class="para">
    <span class="function"><strong>mail()</strong></span> の Windows 版実装は、Unix 版実装とは
    多くの点で違います。
    第一に、メッセージの生成にローカルのバイナリは使用せず、
    ソケットを通じて直接操作するだけです。
    これは <em>MTA</em> がネットワークソケットを listen している
    必要があるということを意味します（ローカルホスト、リモートマシン
    どちらでもかまいません）。
   </p>
   <p class="para">
    第二に、
    <em>From:</em> や
    <em>Cc:</em>・
    <em>Bcc:</em>・
    <em>Date:</em> のようなカスタムヘッダは
    <em>MTA</em> では<em class="emphasis">なく</em>
    PHP によってパースされます。
   </p>
   <p class="para">
    そのため、<code class="parameter">to</code> 引数には
    &quot;Something &lt;someone@example.com&gt;&quot; 形式の
    メールアドレスを与えることはできません。
    MTA と通信する際に mail コマンドはこれを適切にパースできません。
   </p>
  </p></blockquote>
  
  <blockquote class="note"><p><strong class="note">注意</strong>: 
   <p class="para">
    <span class="function"><strong>mail()</strong></span> 関数は、大量のメールをループ内で送信するには
    向いていないことに注意しましょう。この関数は 1 通のメールを送信するたびに
    SMTP ソケットをいったん閉じて開きなおします。これは非効率的です。
   </p>
   <p class="para">
    大量のメールを送信する場合は、
    <a href="http://pear.php.net/package/Mail" class="link external" title="Link : http://pear.php.net/package/Mail">&raquo;&nbsp;PEAR::Mail</a> および
    <a href="http://pear.php.net/package/Mail_Queue" class="link external" title="Link : http://pear.php.net/package/Mail_Queue">&raquo;&nbsp;PEAR::Mail_Queue</a>
    パッケージを参照ください。
   </p>
  </p></blockquote>

  <blockquote class="note"><p><strong class="note">注意</strong>: 
   <p class="para">
    以下の RFC も有用です。
    <a href="http://www.faqs.org/rfcs/rfc1896" class="link external" title="Link : http://www.faqs.org/rfcs/rfc1896">&raquo;&nbsp;RFC 1896</a>、
    <a href="http://www.faqs.org/rfcs/rfc2045" class="link external" title="Link : http://www.faqs.org/rfcs/rfc2045">&raquo;&nbsp;RFC 2045</a>、
    <a href="http://www.faqs.org/rfcs/rfc2046" class="link external" title="Link : http://www.faqs.org/rfcs/rfc2046">&raquo;&nbsp;RFC 2046</a>、
    <a href="http://www.faqs.org/rfcs/rfc2047" class="link external" title="Link : http://www.faqs.org/rfcs/rfc2047">&raquo;&nbsp;RFC 2047</a>、
    <a href="http://www.faqs.org/rfcs/rfc2048" class="link external" title="Link : http://www.faqs.org/rfcs/rfc2048">&raquo;&nbsp;RFC 2048</a>、
    <a href="http://www.faqs.org/rfcs/rfc2049" class="link external" title="Link : http://www.faqs.org/rfcs/rfc2049">&raquo;&nbsp;RFC 2049</a> および
    <a href="http://www.faqs.org/rfcs/rfc2822" class="link external" title="Link : http://www.faqs.org/rfcs/rfc2822">&raquo;&nbsp;RFC 2822</a>
   </p>
  </p></blockquote>
 </div>


 <div class="refsect1 seealso" id="refsect1-function.mail-seealso">
  <h3 class="title">参考</h3>
  <p class="para">
   <ul class="simplelist">
    <li class="member"><span class="function"><a href="function.imap-mail.html" class="function" rel="rdfs-seeAlso">imap_mail()</a> - e-mail メッセージを送信する</span></li>
    <li class="member"><a href="http://pear.php.net/package/Mail" class="link external" title="Link : http://pear.php.net/package/Mail">&raquo;&nbsp;PEAR::Mail</a></li>
    <li class="member"><a href="http://pear.php.net/package/Mail_Mime" class="link external" title="Link : http://pear.php.net/package/Mail_Mime">&raquo;&nbsp;PEAR::Mail_Mime</a></li>
   </ul>
  </p>
 </div>

</div><div id="usernotes">
 <div class="head">
  <h3 class="title">User Contributed Notes</h3>
 </div>
<div id="allnotes">  <a name="114659""></a>
  <div class="note">
   <strong class="user">pierreantoine dot covet at gmail dot com</strong>
   <a href="#114659" class="date">19-Mar-2014 05:50</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Hi,<br />
<br />
I had lots of problems using the code in the exemple. HTML was not rightly formated in my email.<br />
Problem solved by replacing "\r\n" by "\n" as header end line.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="113733""></a>
  <div class="note">
   <strong class="user">Tobias Christensen</strong>
   <a href="#113733" class="date">22-Nov-2013 11:29</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
It might be good to know, that you might get some Header error using the boundary, if it's not done correctly.<br />
<br />
I got the header error about wrong close of the boundary, which in my case wasn't what was really wrong.<br />
<br />
The thing to fix this might be to give the header before this a "\n\r", which might fix it.<br />
<br />
For my case I needed to this twice, as I am doing this as strings, but as arrays and implodes them at the end with the "\n\r". I did it also in the specific header array, where the boundary is generated.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="113161""></a>
  <div class="note">
   <strong class="user">antoine dot php dot net at bonnefoy dot eu</strong>
   <a href="#113161" class="date">07-Sep-2013 12:01</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Hello,<br />
<br />
it's sometime hard to include multiple attachment, or to include pictures inside body.<br />
<br />
Please find these 2 functions allowing sending email with attachment.<br />
usage : <br />
<span class="default">&lt;?php<br />
</span><span class="keyword">echo </span><span class="default">date</span><span class="keyword">(</span><span class="string">"H:i:s"</span><span class="keyword">);<br />
echo </span><span class="default">mail</span><span class="keyword">::</span><span class="default">sendMail</span><span class="keyword">(</span><span class="string">"to@domain.com"</span><span class="keyword">, </span><span class="string">"Test Attach "</span><span class="keyword">.&nbsp; </span><span class="default">date</span><span class="keyword">(</span><span class="string">"H:i:s"</span><span class="keyword">), </span><span class="string">"Contenu du mail &lt;a href=3D'domain.com'&gt;domain.com&lt;/a&gt;"</span><span class="keyword">, </span><span class="default">__FILE__</span><span class="keyword">, </span><span class="string">"xx@domain.com"</span><span class="keyword">,</span><span class="string">'' </span><span class="keyword">, </span><span class="default">true</span><span class="keyword">);<br />
</span><span class="default">?&gt;<br />
</span><br />
source :<br />
<br />
<span class="default">&lt;?php<br />
<br />
</span><span class="keyword">class </span><span class="default">mail </span><span class="keyword">{<br />
<br />
&nbsp;&nbsp;&nbsp; public static function </span><span class="default">prepareAttachment</span><span class="keyword">(</span><span class="default">$path</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$rn </span><span class="keyword">= </span><span class="string">"\r\n"</span><span class="keyword">;<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">file_exists</span><span class="keyword">(</span><span class="default">$path</span><span class="keyword">)) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$finfo </span><span class="keyword">= </span><span class="default">finfo_open</span><span class="keyword">(</span><span class="default">FILEINFO_MIME_TYPE</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$ftype </span><span class="keyword">= </span><span class="default">finfo_file</span><span class="keyword">(</span><span class="default">$finfo</span><span class="keyword">, </span><span class="default">$path</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$file </span><span class="keyword">= </span><span class="default">fopen</span><span class="keyword">(</span><span class="default">$path</span><span class="keyword">, </span><span class="string">"r"</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$attachment </span><span class="keyword">= </span><span class="default">fread</span><span class="keyword">(</span><span class="default">$file</span><span class="keyword">, </span><span class="default">filesize</span><span class="keyword">(</span><span class="default">$path</span><span class="keyword">));<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$attachment </span><span class="keyword">= </span><span class="default">chunk_split</span><span class="keyword">(</span><span class="default">base64_encode</span><span class="keyword">(</span><span class="default">$attachment</span><span class="keyword">));<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">fclose</span><span class="keyword">(</span><span class="default">$file</span><span class="keyword">);<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$msg </span><span class="keyword">= </span><span class="string">'Content-Type: \'' </span><span class="keyword">. </span><span class="default">$ftype </span><span class="keyword">. </span><span class="string">'\'; name="' </span><span class="keyword">. </span><span class="default">basename</span><span class="keyword">(</span><span class="default">$path</span><span class="keyword">) . </span><span class="string">'"' </span><span class="keyword">. </span><span class="default">$rn</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$msg </span><span class="keyword">.= </span><span class="string">"Content-Transfer-Encoding: base64" </span><span class="keyword">. </span><span class="default">$rn</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$msg </span><span class="keyword">.= </span><span class="string">'Content-ID: &lt;' </span><span class="keyword">. </span><span class="default">basename</span><span class="keyword">(</span><span class="default">$path</span><span class="keyword">) . </span><span class="string">'&gt;' </span><span class="keyword">. </span><span class="default">$rn</span><span class="keyword">;<br />
</span><span class="comment">//&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $msg .= 'X-Attachment-Id: ebf7a33f5a2ffca7_0.1' . $rn;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$msg </span><span class="keyword">.= </span><span class="default">$rn </span><span class="keyword">. </span><span class="default">$attachment </span><span class="keyword">. </span><span class="default">$rn </span><span class="keyword">. </span><span class="default">$rn</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">$msg</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; } else {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">false</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp;&nbsp; public static function </span><span class="default">sendMail</span><span class="keyword">(</span><span class="default">$to</span><span class="keyword">, </span><span class="default">$subject</span><span class="keyword">, </span><span class="default">$content</span><span class="keyword">, </span><span class="default">$path </span><span class="keyword">= </span><span class="string">''</span><span class="keyword">, </span><span class="default">$cc </span><span class="keyword">= </span><span class="string">''</span><span class="keyword">, </span><span class="default">$bcc </span><span class="keyword">= </span><span class="string">''</span><span class="keyword">, </span><span class="default">$_headers </span><span class="keyword">= </span><span class="default">false</span><span class="keyword">) {<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$rn </span><span class="keyword">= </span><span class="string">"\r\n"</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$boundary </span><span class="keyword">= </span><span class="default">md5</span><span class="keyword">(</span><span class="default">rand</span><span class="keyword">());<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$boundary_content </span><span class="keyword">= </span><span class="default">md5</span><span class="keyword">(</span><span class="default">rand</span><span class="keyword">());<br />
<br />
</span><span class="comment">// Headers<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$headers </span><span class="keyword">= </span><span class="string">'From: Mail System PHP &lt;no-reply@domain.com&gt;' </span><span class="keyword">. </span><span class="default">$rn</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$headers </span><span class="keyword">.= </span><span class="string">'Mime-Version: 1.0' </span><span class="keyword">. </span><span class="default">$rn</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$headers </span><span class="keyword">.= </span><span class="string">'Content-Type: multipart/related;boundary=' </span><span class="keyword">. </span><span class="default">$boundary </span><span class="keyword">. </span><span class="default">$rn</span><span class="keyword">;<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">//adresses cc and ci<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">if (</span><span class="default">$cc </span><span class="keyword">!= </span><span class="string">''</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$headers </span><span class="keyword">.= </span><span class="string">'Cc: ' </span><span class="keyword">. </span><span class="default">$cc </span><span class="keyword">. </span><span class="default">$rn</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">$bcc </span><span class="keyword">!= </span><span class="string">''</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$headers </span><span class="keyword">.= </span><span class="string">'Bcc: ' </span><span class="keyword">. </span><span class="default">$cc </span><span class="keyword">. </span><span class="default">$rn</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$headers </span><span class="keyword">.= </span><span class="default">$rn</span><span class="keyword">;<br />
<br />
</span><span class="comment">// Message Body<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$msg </span><span class="keyword">= </span><span class="default">$rn </span><span class="keyword">. </span><span class="string">'--' </span><span class="keyword">. </span><span class="default">$boundary </span><span class="keyword">. </span><span class="default">$rn</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$msg</span><span class="keyword">.= </span><span class="string">"Content-Type: multipart/alternative;" </span><span class="keyword">. </span><span class="default">$rn</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$msg</span><span class="keyword">.= </span><span class="string">" boundary=\"</span><span class="default">$boundary_content</span><span class="string">\"" </span><span class="keyword">. </span><span class="default">$rn</span><span class="keyword">;<br />
<br />
</span><span class="comment">//Body Mode text<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$msg</span><span class="keyword">.= </span><span class="default">$rn </span><span class="keyword">. </span><span class="string">"--" </span><span class="keyword">. </span><span class="default">$boundary_content </span><span class="keyword">. </span><span class="default">$rn</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$msg </span><span class="keyword">.= </span><span class="string">'Content-Type: text/plain; charset=ISO-8859-1' </span><span class="keyword">. </span><span class="default">$rn</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$msg </span><span class="keyword">.= </span><span class="default">strip_tags</span><span class="keyword">(</span><span class="default">$content</span><span class="keyword">) . </span><span class="default">$rn</span><span class="keyword">;<br />
<br />
</span><span class="comment">//Body Mode Html&nbsp; &nbsp; &nbsp; &nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$msg</span><span class="keyword">.= </span><span class="default">$rn </span><span class="keyword">. </span><span class="string">"--" </span><span class="keyword">. </span><span class="default">$boundary_content </span><span class="keyword">. </span><span class="default">$rn</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$msg </span><span class="keyword">.= </span><span class="string">'Content-Type: text/html; charset=ISO-8859-1' </span><span class="keyword">. </span><span class="default">$rn</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$msg </span><span class="keyword">.= </span><span class="string">'Content-Transfer-Encoding: quoted-printable' </span><span class="keyword">. </span><span class="default">$rn</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">$_headers</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$msg </span><span class="keyword">.= </span><span class="default">$rn </span><span class="keyword">. </span><span class="string">'&lt;img src=3D"cid:template-H.PNG" /&gt;' </span><span class="keyword">. </span><span class="default">$rn</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">//equal sign are email special characters. =3D is the = sign<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$msg </span><span class="keyword">.= </span><span class="default">$rn </span><span class="keyword">. </span><span class="string">'&lt;div&gt;' </span><span class="keyword">. </span><span class="default">nl2br</span><span class="keyword">(</span><span class="default">str_replace</span><span class="keyword">(</span><span class="string">"="</span><span class="keyword">, </span><span class="string">"=3D"</span><span class="keyword">, </span><span class="default">$content</span><span class="keyword">)) . </span><span class="string">'&lt;/div&gt;' </span><span class="keyword">. </span><span class="default">$rn</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">$_headers</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$msg </span><span class="keyword">.= </span><span class="default">$rn </span><span class="keyword">. </span><span class="string">'&lt;img src=3D"cid:template-F.PNG" /&gt;' </span><span class="keyword">. </span><span class="default">$rn</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$msg </span><span class="keyword">.= </span><span class="default">$rn </span><span class="keyword">. </span><span class="string">'--' </span><span class="keyword">. </span><span class="default">$boundary_content </span><span class="keyword">. </span><span class="string">'--' </span><span class="keyword">. </span><span class="default">$rn</span><span class="keyword">;<br />
<br />
</span><span class="comment">//if attachement<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">if (</span><span class="default">$path </span><span class="keyword">!= </span><span class="string">'' </span><span class="keyword">&amp;&amp; </span><span class="default">file_exists</span><span class="keyword">(</span><span class="default">$path</span><span class="keyword">)) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$conAttached </span><span class="keyword">= </span><span class="default">self</span><span class="keyword">::</span><span class="default">prepareAttachment</span><span class="keyword">(</span><span class="default">$path</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">$conAttached </span><span class="keyword">!== </span><span class="default">false</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$msg </span><span class="keyword">.= </span><span class="default">$rn </span><span class="keyword">. </span><span class="string">'--' </span><span class="keyword">. </span><span class="default">$boundary </span><span class="keyword">. </span><span class="default">$rn</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$msg </span><span class="keyword">.= </span><span class="default">$conAttached</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <br />
</span><span class="comment">//other attachement : here used on HTML body for picture headers/footers<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">if (</span><span class="default">$_headers</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$imgHead </span><span class="keyword">= </span><span class="default">dirname</span><span class="keyword">(</span><span class="default">__FILE__</span><span class="keyword">) . </span><span class="string">'/../../../../modules/notification/ressources/img/template-H.PNG'</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$conAttached </span><span class="keyword">= </span><span class="default">self</span><span class="keyword">::</span><span class="default">prepareAttachment</span><span class="keyword">(</span><span class="default">$imgHead</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">$conAttached </span><span class="keyword">!== </span><span class="default">false</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$msg </span><span class="keyword">.= </span><span class="default">$rn </span><span class="keyword">. </span><span class="string">'--' </span><span class="keyword">. </span><span class="default">$boundary </span><span class="keyword">. </span><span class="default">$rn</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$msg </span><span class="keyword">.= </span><span class="default">$conAttached</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$imgFoot </span><span class="keyword">= </span><span class="default">dirname</span><span class="keyword">(</span><span class="default">__FILE__</span><span class="keyword">) . </span><span class="string">'/../../../../modules/notification/ressources/img/template-F.PNG'</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$conAttached </span><span class="keyword">= </span><span class="default">self</span><span class="keyword">::</span><span class="default">prepareAttachment</span><span class="keyword">(</span><span class="default">$imgFoot</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">$conAttached </span><span class="keyword">!== </span><span class="default">false</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$msg </span><span class="keyword">.= </span><span class="default">$rn </span><span class="keyword">. </span><span class="string">'--' </span><span class="keyword">. </span><span class="default">$boundary </span><span class="keyword">. </span><span class="default">$rn</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$msg </span><span class="keyword">.= </span><span class="default">$conAttached</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
<br />
</span><span class="comment">// Fin<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$msg </span><span class="keyword">.= </span><span class="default">$rn </span><span class="keyword">. </span><span class="string">'--' </span><span class="keyword">. </span><span class="default">$boundary </span><span class="keyword">. </span><span class="string">'--' </span><span class="keyword">. </span><span class="default">$rn</span><span class="keyword">;<br />
<br />
</span><span class="comment">// Function mail()<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">mail</span><span class="keyword">(</span><span class="default">$to</span><span class="keyword">, </span><span class="default">$subject</span><span class="keyword">, </span><span class="default">$msg</span><span class="keyword">, </span><span class="default">$headers</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; }<br />
<br />
}<br />
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="111797""></a>
  <div class="note">
   <strong class="user">ittasks at gmail dot com</strong>
   <a href="#111797" class="date">29-Mar-2013 05:55</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
When dealing with mail headers "\n" and "\r\n" *sometimes* makes a big difference.<br />
<br />
Once our CentOs servers got re-installed, all headers like:<br />
<br />
&nbsp; $headers = "MIME-Version: 1.0\r\n";<br />
&nbsp; $headers.= "Content-type: text/html; charset=iso-8859-1\r\n";<br />
&nbsp;...<br />
<br />
became part of message body instead of headers<br />
<br />
I was able to fixed this by replacing "\r\n" with just "\n"</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="111124""></a>
  <div class="note">
   <strong class="user">g dot kuizinas at anuary dot com</strong>
   <a href="#111124" class="date">18-Jan-2013 03:46</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
<span class="default">&lt;?php<br />
</span><span class="keyword">**<br />
&nbsp;* Function </span><span class="default">responsible </span><span class="keyword">for </span><span class="default">sending unicode emails</span><span class="keyword">.<br />
&nbsp;*<br />
&nbsp;* @</span><span class="default">author Gajus Kuizinas </span><span class="keyword">&lt;</span><span class="default">g</span><span class="keyword">.</span><span class="default">kuizinas</span><span class="keyword">@</span><span class="default">anuary</span><span class="keyword">.</span><span class="default">com</span><span class="keyword">&gt;<br />
&nbsp;* @</span><span class="default">version 1.0.1 </span><span class="keyword">(</span><span class="default">2012 01 11</span><span class="keyword">)<br />
&nbsp;*/<br />
function </span><span class="default">mail_send</span><span class="keyword">(</span><span class="default">$arr</span><span class="keyword">)<br />
{<br />
&nbsp;&nbsp;&nbsp; if (!isset(</span><span class="default">$arr</span><span class="keyword">[</span><span class="string">'to_email'</span><span class="keyword">], </span><span class="default">$arr</span><span class="keyword">[</span><span class="string">'from_email'</span><span class="keyword">], </span><span class="default">$arr</span><span class="keyword">[</span><span class="string">'subject'</span><span class="keyword">], </span><span class="default">$arr</span><span class="keyword">[</span><span class="string">'message'</span><span class="keyword">])) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; throw new </span><span class="default">HelperException</span><span class="keyword">(</span><span class="string">'mail(); not all parameters provided.'</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$to&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="keyword">= empty(</span><span class="default">$arr</span><span class="keyword">[</span><span class="string">'to_name'</span><span class="keyword">]) ? </span><span class="default">$arr</span><span class="keyword">[</span><span class="string">'to_email'</span><span class="keyword">] : </span><span class="string">'"' </span><span class="keyword">. </span><span class="default">mb_encode_mimeheader</span><span class="keyword">(</span><span class="default">$arr</span><span class="keyword">[</span><span class="string">'to_name'</span><span class="keyword">]) . </span><span class="string">'" &lt;' </span><span class="keyword">. </span><span class="default">$arr</span><span class="keyword">[</span><span class="string">'to_email'</span><span class="keyword">] . </span><span class="string">'&gt;'</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$from&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="keyword">= empty(</span><span class="default">$arr</span><span class="keyword">[</span><span class="string">'from_name'</span><span class="keyword">]) ? </span><span class="default">$arr</span><span class="keyword">[</span><span class="string">'from_email'</span><span class="keyword">] : </span><span class="string">'"' </span><span class="keyword">. </span><span class="default">mb_encode_mimeheader</span><span class="keyword">(</span><span class="default">$arr</span><span class="keyword">[</span><span class="string">'from_name'</span><span class="keyword">]) . </span><span class="string">'" &lt;' </span><span class="keyword">. </span><span class="default">$arr</span><span class="keyword">[</span><span class="string">'from_email'</span><span class="keyword">] . </span><span class="string">'&gt;'</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$headers&nbsp; &nbsp; </span><span class="keyword">= array<br />
&nbsp;&nbsp;&nbsp; (<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="string">'MIME-Version: 1.0'</span><span class="keyword">,<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="string">'Content-Type: text/html; charset="UTF-8";'</span><span class="keyword">,<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="string">'Content-Transfer-Encoding: 7bit'</span><span class="keyword">,<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="string">'Date: ' </span><span class="keyword">. </span><span class="default">date</span><span class="keyword">(</span><span class="string">'r'</span><span class="keyword">, </span><span class="default">$_SERVER</span><span class="keyword">[</span><span class="string">'REQUEST_TIME'</span><span class="keyword">]),<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="string">'Message-ID: &lt;' </span><span class="keyword">. </span><span class="default">$_SERVER</span><span class="keyword">[</span><span class="string">'REQUEST_TIME'</span><span class="keyword">] . </span><span class="default">md5</span><span class="keyword">(</span><span class="default">$_SERVER</span><span class="keyword">[</span><span class="string">'REQUEST_TIME'</span><span class="keyword">]) . </span><span class="string">'@' </span><span class="keyword">. </span><span class="default">$_SERVER</span><span class="keyword">[</span><span class="string">'SERVER_NAME'</span><span class="keyword">] . </span><span class="string">'&gt;'</span><span class="keyword">,<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="string">'From: ' </span><span class="keyword">. </span><span class="default">$from</span><span class="keyword">,<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="string">'Reply-To: ' </span><span class="keyword">. </span><span class="default">$from</span><span class="keyword">,<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="string">'Return-Path: ' </span><span class="keyword">. </span><span class="default">$from</span><span class="keyword">,<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="string">'X-Mailer: PHP v' </span><span class="keyword">. </span><span class="default">phpversion</span><span class="keyword">(),<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="string">'X-Originating-IP: ' </span><span class="keyword">. </span><span class="default">$_SERVER</span><span class="keyword">[</span><span class="string">'SERVER_ADDR'</span><span class="keyword">],<br />
&nbsp;&nbsp;&nbsp; );<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; </span><span class="default">mail</span><span class="keyword">(</span><span class="default">$to</span><span class="keyword">, </span><span class="string">'=?UTF-8?B?' </span><span class="keyword">. </span><span class="default">base64_encode</span><span class="keyword">(</span><span class="default">$arr</span><span class="keyword">[</span><span class="string">'subject'</span><span class="keyword">]) . </span><span class="string">'?='</span><span class="keyword">, </span><span class="default">$arr</span><span class="keyword">[</span><span class="string">'message'</span><span class="keyword">], </span><span class="default">implode</span><span class="keyword">(</span><span class="string">"\n"</span><span class="keyword">, </span><span class="default">$headers</span><span class="keyword">));<br />
}<br />
</span><span class="default">?&gt;<br />
</span><br />
Here is my helper function for those who are having problems properly handling UTF-8, subject, HTML, or even the headers data. I've been using it for over a year. It works fine with simple emails.<br />
<br />
For anything more advanced (specifically, handling attachments and multiple email versions), you should be using an existing library like <a href="http://swiftmailer.org/." rel="nofollow" target="_blank">http://swiftmailer.org/.</a></span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="110606""></a>
  <div class="note">
   <strong class="user">shenyqwilliam</strong>
   <a href="#110606" class="date">12-Nov-2012 11:32</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If you're sending a large attachment, you may encounter overflow problem.<br />
AFAIK, two common limits could be responsible.<br />
<br />
1. Postfix message size limit.<br />
Edit /etc/postfix/main.cf . Change the value of "message_size_limit".<br />
<br />
2. Apache memory size limit for scripts.<br />
Edit /etc/php.ini . Change the value of "memory_limit".<br />
<br />
//Then reload (or restart) Postfix and Apache.<br />
//Empirically, sending 200MB attachment requires 500MB memory.<br />
<br />
Be careful! Raising memory limits may cause unexpected consequences, and is hence deprecated.<br />
Recommended alternatives include:<br />
* Pack and split attachment into several emails.<br />
* Only include a link to the file. The receiver can download it later.<br />
* Use IMAP/POP3 server (e.g. Dovecot).</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="110329""></a>
  <div class="note">
   <strong class="user">bburch at bouncingpixel dot com</strong>
   <a href="#110329" class="date">11-Oct-2012 09:13</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
When using the PHP mail() function with IIS 6 on Windows Server 2003, check your "Relay" settings on the SMTP Virtual Server in IIS.&nbsp; If you grant access to 127.0.0.1 and set then set your php.ini SMTP to the same IP address (along with setting the same port 25), you should have success in sending mail.&nbsp; <br />
<br />
I'm using PHP 5.3 and have had success with this configuration and did not have to define the "sendmail_from" setting in our php.ini file.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="109872""></a>
  <div class="note">
   <strong class="user">Joost Brugman</strong>
   <a href="#109872" class="date">30-Aug-2012 06:49</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
When using mail() under a windows installation (tested under Xampp 1.7.7) any line in $headers that is (between the first and last properly formatted mail header and not a properly formatted mail headers itself) or (that is empty) is removed. As a result MIME formatted messages get scrambled. I am not sure if this behaviour is by design, but this is what it seems to do.<br />
<br />
Example $headers:<br />
01 From: "me" &lt;me@domain.com&gt;<br />
02 MIME-Version: 1.0<br />
03 Content-Type: multipart/mixed;<br />
04&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; boundary=streamline503e8a5d00efdMessage<br />
05 <br />
06 --streamline503e8a5d00efdMessage<br />
07 Content-Type: multipart/alternative;<br />
08&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; boundary=streamline503e8a5d00efdBody<br />
09 <br />
10 --streamline503e8a5d00efdBody<br />
11 Content-Type: text/plain;<br />
12&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; CHARSET=shift-jis<br />
13 Content-Transfer-Encoding: quoted-printable<br />
14 <br />
15 This message is written in HTML only.<br />
16 <br />
17 --streamline503e8a5d00efdBody<br />
18 Content-Type: text/html;<br />
19&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; CHARSET=shift-jis<br />
20 Content-Transfer-Encoding: quoted-printable<br />
21 <br />
22 This is an email with &lt;b&gt;html&lt;/b&gt;content<br />
23 --streamline503e8a5d00efdBody--<br />
24 <br />
25 --streamline503e8a5d00efdMessage--<br />
26 <br />
27 .<br />
<br />
Here, lines 05, 09, 10, 14, 15, 16, 17 are removed. The first properly formatted mail header is on line 01. The last properly formatted mail header is on line 20. The before mentioned entries are between 01 and 20, not properly formatted mail headers themselves and are therefore removed.<br />
Also, lines 21, 24, 26 are removed because they are empty.<br />
<br />
As a result this message will be delivered, but the mime structure is broken, since relevant lines are left out.<br />
<br />
The solution is to pass lines 01 through 04 in $headers and to pass 06 through 26 to $message. $message will passed unchanged and the mime structure will remain intact.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="109655""></a>
  <div class="note">
   <strong class="user">martin dot farrow at versacloud dot com</strong>
   <a href="#109655" class="date">06-Aug-2012 06:07</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I've noticed that on some versions of PHP occasionally mail() returns the empty string for success, rather than true or false. The empty string evaluates to false.<br />
<br />
if you use constructs like<br />
<br />
if ( mail( ... ) ){<br />
&nbsp; # do something here on success<br />
}<br />
<br />
this wont work consistently.<br />
<br />
so you need code like<br />
<br />
$ret=mail(....)<br />
<br />
if ( $ret == '' || $ret ){<br />
&nbsp; # do something here<br />
}<br />
<br />
to get consistent results.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="108669""></a>
  <div class="note">
   <strong class="user">pavel.lint at vk.com</strong>
   <a href="#108669" class="date">16-May-2012 08:22</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Here's a small handy function I use to send email in UTF-8.<br />
<br />
&nbsp;<span class="default">&lt;?php<br />
</span><span class="keyword">function </span><span class="default">mail_utf8</span><span class="keyword">(</span><span class="default">$to</span><span class="keyword">, </span><span class="default">$from_user</span><span class="keyword">, </span><span class="default">$from_email</span><span class="keyword">, <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$subject </span><span class="keyword">= </span><span class="string">'(No subject)'</span><span class="keyword">, </span><span class="default">$message </span><span class="keyword">= </span><span class="string">''</span><span class="keyword">)<br />
&nbsp;&nbsp; { <br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="default">$from_user </span><span class="keyword">= </span><span class="string">"=?UTF-8?B?"</span><span class="keyword">.</span><span class="default">base64_encode</span><span class="keyword">(</span><span class="default">$from_user</span><span class="keyword">).</span><span class="string">"?="</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="default">$subject </span><span class="keyword">= </span><span class="string">"=?UTF-8?B?"</span><span class="keyword">.</span><span class="default">base64_encode</span><span class="keyword">(</span><span class="default">$subject</span><span class="keyword">).</span><span class="string">"?="</span><span class="keyword">;<br />
<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="default">$headers </span><span class="keyword">= </span><span class="string">"From: </span><span class="default">$from_user</span><span class="string"> &lt;</span><span class="default">$from_email</span><span class="string">&gt;\r\n"</span><span class="keyword">. <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="string">"MIME-Version: 1.0" </span><span class="keyword">. </span><span class="string">"\r\n" </span><span class="keyword">. <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="string">"Content-type: text/html; CHARSET=shift-jis" </span><span class="keyword">. </span><span class="string">"\r\n"</span><span class="keyword">; <br />
<br />
&nbsp;&nbsp; &nbsp; return </span><span class="default">mail</span><span class="keyword">(</span><span class="default">$to</span><span class="keyword">, </span><span class="default">$subject</span><span class="keyword">, </span><span class="default">$message</span><span class="keyword">, </span><span class="default">$headers</span><span class="keyword">); <br />
&nbsp;&nbsp; }<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="108498""></a>
  <div class="note">
   <strong class="user">rexlorenzo at gmail dot com</strong>
   <a href="#108498" class="date">02-May-2012 10:24</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Be careful to not put extra spaces for the $headers variable.<br />
<br />
For example, this didn't work on our servers:<br />
<br />
$headers = "From: $from \r\n Bcc: $bcc \r\n";<br />
<br />
But this did:<br />
<br />
$headers = "From: $from\r\nBcc: $bcc\r\n";<br />
<br />
Notice the removal of the spaces around the first \r\n.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="108368""></a>
  <div class="note">
   <strong class="user">bimal at sanjaal dot com</strong>
   <a href="#108368" class="date">20-Apr-2012 02:05</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
You can write clean PHP code while creating the headers correctly. First, build a list of all headers in an array. Then, glue them with "\r\n" character.<br />
<br />
The code now looks clean and straight forward.<br />
(Just compare it with the manual's example ;-) )<br />
<br />
<span class="default">&lt;?php<br />
$headers&nbsp;&nbsp; </span><span class="keyword">= array();<br />
</span><span class="default">$headers</span><span class="keyword">[] = </span><span class="string">"MIME-Version: 1.0"</span><span class="keyword">;<br />
</span><span class="default">$headers</span><span class="keyword">[] = </span><span class="string">"Content-type: text/plain; charset=iso-8859-1"</span><span class="keyword">;<br />
</span><span class="default">$headers</span><span class="keyword">[] = </span><span class="string">"From: Sender Name &lt;sender@domain.com&gt;"</span><span class="keyword">;<br />
</span><span class="default">$headers</span><span class="keyword">[] = </span><span class="string">"Bcc: JJ Chong &lt;bcc@domain2.com&gt;"</span><span class="keyword">;<br />
</span><span class="default">$headers</span><span class="keyword">[] = </span><span class="string">"Reply-To: Recipient Name &lt;receiver@domain3.com&gt;"</span><span class="keyword">;<br />
</span><span class="default">$headers</span><span class="keyword">[] = </span><span class="string">"Subject: </span><span class="keyword">{</span><span class="default">$subject</span><span class="keyword">}</span><span class="string">"</span><span class="keyword">;<br />
</span><span class="default">$headers</span><span class="keyword">[] = </span><span class="string">"X-Mailer: PHP/"</span><span class="keyword">.</span><span class="default">phpversion</span><span class="keyword">();<br />
<br />
</span><span class="default">mail</span><span class="keyword">(</span><span class="default">$to</span><span class="keyword">, </span><span class="default">$subject</span><span class="keyword">, </span><span class="default">$email</span><span class="keyword">, </span><span class="default">implode</span><span class="keyword">(</span><span class="string">"\r\n"</span><span class="keyword">, </span><span class="default">$headers</span><span class="keyword">));<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="108340""></a>
  <div class="note">
   <strong class="user">Marc Parillo</strong>
   <a href="#108340" class="date">18-Apr-2012 10:27</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If you follow the suggested format for the $to field, you can list multiple addresses in a comma-delimited string with spaces.<br />
<br />
The spaces could be an issue if you're experiencing a similar problem.&nbsp; I was unable to send an e-mail to multiple addresses using that format.&nbsp; It started working for me when I removed all of the spaces in the $to string.<br />
<br />
Example:<br />
<span class="default">&lt;?php<br />
$to </span><span class="keyword">= </span><span class="string">'nobody@example.com,anotheruser@example.com,yetanotheruser@example.com'</span><span class="keyword">; </span><span class="comment">// no spaces<br />
</span><span class="default">mail</span><span class="keyword">(</span><span class="default">$to</span><span class="keyword">, </span><span class="string">'the subject'</span><span class="keyword">, </span><span class="string">'the message'</span><span class="keyword">);<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="108328""></a>
  <div class="note">
   <strong class="user">yarik dot bohatsky at gmail dot com</strong>
   <a href="#108328" class="date">18-Apr-2012 12:02</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If you want to send UTF-8 HTML letter you need to mention charset twice:<br />
<br />
1) In message header:<br />
<span class="default">&lt;?php<br />
$headers </span><span class="keyword">.= </span><span class="string">'Content-type: text/html; CHARSET=shift-jis' </span><span class="keyword">. </span><span class="string">"\r\n"</span><span class="keyword">;<br />
</span><span class="default">?&gt;<br />
</span><br />
2) In HTML header:<br />
<span class="default">&lt;?php<br />
$message </span><span class="keyword">= </span><span class="string">'<br />
&lt;html&gt;<br />
&lt;head&gt;<br />
&nbsp;&nbsp; &lt;meta http-equiv="Content-Type" content="text/html; CHARSET=shift-jis" /&gt;<br />
&nbsp;&nbsp; &lt;title&gt;Fillon soutient a fond le retour d\'un Grand Prix de France&lt;/title&gt;<br />
&lt;/head&gt;<br />
&lt;body&gt;<br />
&nbsp;&nbsp; &lt;p&gt;Le Premier ministre Francois Fillon, passionne d\'automobile et pilote a ses heures, a apporte un soutien appuye au retour d\'un Grand Prix de France au calendrier 2013 de la Formule 1, en faisant un passage-eclair vendredi sur le circuit Paul Ricard dans le Var.&lt;/p&gt;<br />
&lt;/body&gt;<br />
&lt;/html&gt;<br />
'</span><span class="keyword">;<br />
<br />
</span><span class="default">In this </span><span class="keyword">case </span><span class="default">Outlook will also </span><span class="string">"understand" </span><span class="default">that message is encoded using UTF</span><span class="keyword">-</span><span class="default">8.</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="107998""></a>
  <div class="note">
   <strong class="user">geeralo at gmx dot de</strong>
   <a href="#107998" class="date">21-Mar-2012 08:08</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Hello programmers!<br />
<br />
There is something important I want to notice about charsets here:<br />
<br />
"Content-Type: text/plain; charset = \"UTF-8\";\n"<br />
<br />
is right and not only<br />
<br />
"Content-Type: text/plain; CHARSET=shift-jis\n"<br />
<br />
Hope I could help other people who frustrate while searching the same mistake like me.<br />
<br />
Remember also to write only \r for windows and not for Linux-Servers.<br />
And at the end of the header should be an extra blank line:<br />
<br />
$headers .= "Content-Type: text/plain; charset = \"UTF-8\";\n";<br />
$headers .= "Content-Transfer-Encoding: 8bit\n";<br />
$headers .= "\n";<br />
<br />
Greetings</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="107561""></a>
  <div class="note">
   <strong class="user">akger1379 at gmail dot com</strong>
   <a href="#107561" class="date">17-Feb-2012 10:14</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Use sendmail in queue mode to prevent long pauses everytime php is calling the mail() function.
<br />

<br />
<span class="default">&lt;?php
<br />
$additionalParameters </span><span class="keyword">= </span><span class="string">'-ODeliveryMode=d'</span><span class="keyword">;
<br />
</span><span class="default">mail</span><span class="keyword">(</span><span class="default">$to</span><span class="keyword">, </span><span class="default">$subject</span><span class="keyword">, </span><span class="default">$message</span><span class="keyword">, </span><span class="default">$headers</span><span class="keyword">, </span><span class="default">$additionalParameters</span><span class="keyword">);
<br />
</span><span class="default">?&gt;
<br />
</span>
<br />
Your mails will be delivered everytime the sendmail daemon is processing the queue. To see what the interval may be see the "QUEUE_INTERVAL" variable in /etc/mail/sendmail.conf</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="107524""></a>
  <div class="note">
   <strong class="user">Max AT</strong>
   <a href="#107524" class="date">15-Feb-2012 06:26</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
To define a mail sensitivity you have to put this line in the headers:<br />
<br />
<span class="default">&lt;?php<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $headers </span><span class="keyword">= </span><span class="string">"MIME-Version: 1.0\n" </span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$headers </span><span class="keyword">.= </span><span class="string">"Content-Type: text/html; charset=\"iso-8859-1\"\n"</span><span class="keyword">;<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$headers </span><span class="keyword">.= </span><span class="string">"Sensitivity: Personal\n"</span><span class="keyword">;<br />
<br />
&nbsp;</span><span class="default">$status&nbsp;&nbsp; </span><span class="keyword">= </span><span class="default">mail</span><span class="keyword">(</span><span class="default">$to</span><span class="keyword">, </span><span class="default">$subject</span><span class="keyword">, </span><span class="default">$message</span><span class="keyword">,</span><span class="default">$headers</span><span class="keyword">);<br />
</span><span class="default">?&gt;</span> <br />
<br />
Possible Options:<br />
Sensitivity: Normal, Personal, Private and Company-Confidential<br />
<br />
These will be recognised and handled in Outlook, Thunderbird and others.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="107321""></a>
  <div class="note">
   <strong class="user">ABOMB</strong>
   <a href="#107321" class="date">31-Jan-2012 07:16</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I was having delivery issues from this function to Gmail, Yahoo, AOL, etc.&nbsp; I used the notes here to figure that you need to be setting your Return-Path to a valid email to catch bounces.&nbsp; There are two extra delivery gotchas on top of that:<br />
<br />
1) The domain in the email used in the -f option in the php.ini sendmail parameter or in the mail() extra parameters field, needs to have a valid SPF record for the domain (in DNS as a "TXT" record type for sure and add an additional&nbsp; "SPF" type record if possible).&nbsp; Why? That's header field being used for spam checks.<br />
<br />
2) You should also use a domain key or DKIM.&nbsp; The trick here is that the domain key/DKIM is case sensitive!&nbsp; I used Cpanel to create my domain key which automatically used all lowercase domain names in the key creation.&nbsp; I found when&nbsp; sending email and using a camel case "-f account@MyDomainHere.Com" option, my key was not accepted.&nbsp; However it was accepted when I used "-f account@mydomainhere.com".<br />
<br />
There are many other factors that can contribute to mail not getting to inboxes, including your own multiple failed testing attempts, so I suggest you consult each site's guidelines and don't ask me for help.&nbsp; These are just the couple technical issues that helped my case.<br />
<br />
I hope this saves someone some time and headaches...</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="106877""></a>
  <div class="note">
   <strong class="user">debis at woh dot rr dot com</strong>
   <a href="#106877" class="date">15-Dec-2011 12:09</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
This is for Windows Server 2003, IIS 6.0 with SMTP virtual server. <br />
<br />
The problem I had was not including init_set for the SMTP server, I thought the SMTP definition in the IIS SMTP virtual server configuration would work.&nbsp; When I sent mail manually this was not an issue.&nbsp; <br />
<br />
Also, $mail_sent = @mail( $to, $subject, $message, $headers ); wouldn't work but $mail_sent = mail($to, $subject, $message, $headers); did.<br />
Lack of date_default_timezone_set() only caused a warning because php guessed what it should be.<br />
<br />
This worked:<br />
<span class="default">&lt;?php<br />
$to&nbsp; &nbsp; &nbsp; </span><span class="keyword">= </span><span class="string">'nobody@example.com'</span><span class="keyword">;<br />
</span><span class="default">$subject </span><span class="keyword">= </span><span class="string">'the subject'</span><span class="keyword">;<br />
</span><span class="default">$message </span><span class="keyword">= </span><span class="string">'hello'</span><span class="keyword">;<br />
</span><span class="default">$headers </span><span class="keyword">= </span><span class="string">'From: webmaster@example.com' </span><span class="keyword">. </span><span class="string">"\r\n" </span><span class="keyword">.<br />
&nbsp;&nbsp;&nbsp; </span><span class="string">'Reply-To: webmaster@example.com' </span><span class="keyword">. </span><span class="string">"\r\n" </span><span class="keyword">.<br />
&nbsp;&nbsp;&nbsp; </span><span class="string">'X-Mailer: PHP/' </span><span class="keyword">. </span><span class="default">phpversion</span><span class="keyword">();<br />
</span><span class="default">ini_set </span><span class="keyword">( </span><span class="string">"SMTP"</span><span class="keyword">, </span><span class="string">"smtp-server.example.com" </span><span class="keyword">); <br />
</span><span class="default">date_default_timezone_set</span><span class="keyword">(</span><span class="string">'America/New_York'</span><span class="keyword">);<br />
<br />
</span><span class="default">mail</span><span class="keyword">(</span><span class="default">$to</span><span class="keyword">, </span><span class="default">$subject</span><span class="keyword">, </span><span class="default">$message</span><span class="keyword">, </span><span class="default">$headers</span><span class="keyword">);<br />
</span><span class="default">?&gt;</span> <br />
<br />
And just so you can troubleshoot, this worked when sending mail from the command line/manually. CLI worked even though the php code without the init_set function wouldn't work. <br />
<br />
You will notice that the "rcpt to" and "to" fields appear redundant, but if both are not used, the delivered mail's "to" field will be blank/empty.<br />
<br />
-------------------------------<br />
telnet www.example.com 25<br />
helo<br />
mail from: webmaster@example.com<br />
rcpt to: someone@example.com<br />
data<br />
to: someone@example.com<br />
subject: test again to make sure<br />
<br />
this is my message <br />
.<br />
quit<br />
-----------------------------------</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="106157""></a>
  <div class="note">
   <strong class="user">saganwebdesign</strong>
   <a href="#106157" class="date">14-Oct-2011 04:01</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If you are getting frustrated that your email is being sent as plain text instead of HTML, typically one of your headers showing up in the email (even if other scripts on the same server seem to work fine!!!) then structure your headers like this:
<br />

<br />
<span class="default">&lt;?php
<br />
$headers </span><span class="keyword">= </span><span class="string">'From: You &lt;you@example.com&gt;' </span><span class="keyword">. </span><span class="string">"\n"</span><span class="keyword">;
<br />
</span><span class="default">$headers </span><span class="keyword">.= </span><span class="string">'MIME-Version: 1.0' </span><span class="keyword">. </span><span class="string">"\n"</span><span class="keyword">;
<br />
</span><span class="default">$headers </span><span class="keyword">.= </span><span class="string">'Content-type: text/html; charset=iso-8859-1' </span><span class="keyword">. </span><span class="string">"\r\n"</span><span class="keyword">;
<br />
</span><span class="default">?&gt;
<br />
</span>
<br />
Notice that the From is before the MIME and Content and only Content ends with "\r\n", the other are just "\n"
<br />

<br />
Not sure how it is possible for other scripts on the same server, same domain to work fine as shown in the very top instructions, and others need this crap... I spent a very frustrating couple hours figuring this out, hope you can avoid doing the same.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="105780""></a>
  <div class="note">
   <strong class="user">arunm</strong>
   <a href="#105780" class="date">14-Sep-2011 02:24</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
It is also advisable to set the return path in the headers; hence it will avoid the email to land in the spam folder!
<br />
eg:
<br />

<br />
$headers.="Return-Path:&lt;name@example.com&gt;\r\n";</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="105661""></a>
  <div class="note">
   <strong class="user">Anda</strong>
   <a href="#105661" class="date">05-Sep-2011 08:57</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Send Multi attachment email <br />
<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">function </span><span class="default">multi_attach_mail</span><span class="keyword">(</span><span class="default">$to</span><span class="keyword">, </span><span class="default">$files</span><span class="keyword">, </span><span class="default">$sendermail</span><span class="keyword">){<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">// email fields: to, from, subject, and so on<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$from </span><span class="keyword">= </span><span class="string">"Files attach &lt;"</span><span class="keyword">.</span><span class="default">$sendermail</span><span class="keyword">.</span><span class="string">"&gt;"</span><span class="keyword">; <br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$subject </span><span class="keyword">= </span><span class="default">date</span><span class="keyword">(</span><span class="string">"d.M H:i"</span><span class="keyword">).</span><span class="string">" F="</span><span class="keyword">.</span><span class="default">count</span><span class="keyword">(</span><span class="default">$files</span><span class="keyword">); <br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$message </span><span class="keyword">= </span><span class="default">date</span><span class="keyword">(</span><span class="string">"Y.m.d H:i:s"</span><span class="keyword">).</span><span class="string">"\n"</span><span class="keyword">.</span><span class="default">count</span><span class="keyword">(</span><span class="default">$files</span><span class="keyword">).</span><span class="string">" attachments"</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$headers </span><span class="keyword">= </span><span class="string">"From: </span><span class="default">$from</span><span class="string">"</span><span class="keyword">;<br />
&nbsp;<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">// boundary <br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$semi_rand </span><span class="keyword">= </span><span class="default">md5</span><span class="keyword">(</span><span class="default">time</span><span class="keyword">()); <br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$mime_boundary </span><span class="keyword">= </span><span class="string">"==Multipart_Boundary_x</span><span class="keyword">{</span><span class="default">$semi_rand</span><span class="keyword">}</span><span class="string">x"</span><span class="keyword">; <br />
&nbsp;<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">// headers for attachment <br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$headers </span><span class="keyword">.= </span><span class="string">"\nMIME-Version: 1.0\n" </span><span class="keyword">. </span><span class="string">"Content-Type: multipart/mixed;\n" </span><span class="keyword">. </span><span class="string">" boundary=\"</span><span class="keyword">{</span><span class="default">$mime_boundary</span><span class="keyword">}</span><span class="string">\""</span><span class="keyword">; <br />
&nbsp;<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">// multipart boundary <br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$message </span><span class="keyword">= </span><span class="string">"--</span><span class="keyword">{</span><span class="default">$mime_boundary</span><span class="keyword">}</span><span class="string">\n" </span><span class="keyword">. </span><span class="string">"Content-Type: text/plain; charset=\"iso-8859-1\"\n" </span><span class="keyword">.<br />
&nbsp;&nbsp;&nbsp; </span><span class="string">"Content-Transfer-Encoding: 7bit\n\n" </span><span class="keyword">. </span><span class="default">$message </span><span class="keyword">. </span><span class="string">"\n\n"</span><span class="keyword">; <br />
&nbsp;<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">// preparing attachments<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">for(</span><span class="default">$i</span><span class="keyword">=</span><span class="default">0</span><span class="keyword">;</span><span class="default">$i</span><span class="keyword">&lt;</span><span class="default">count</span><span class="keyword">(</span><span class="default">$files</span><span class="keyword">);</span><span class="default">$i</span><span class="keyword">++){<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if(</span><span class="default">is_file</span><span class="keyword">(</span><span class="default">$files</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">])){<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$message </span><span class="keyword">.= </span><span class="string">"--</span><span class="keyword">{</span><span class="default">$mime_boundary</span><span class="keyword">}</span><span class="string">\n"</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$fp </span><span class="keyword">=&nbsp; &nbsp; @</span><span class="default">fopen</span><span class="keyword">(</span><span class="default">$files</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">],</span><span class="string">"rb"</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$data </span><span class="keyword">=&nbsp; &nbsp; @</span><span class="default">fread</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">,</span><span class="default">filesize</span><span class="keyword">(</span><span class="default">$files</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">]));<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; @</span><span class="default">fclose</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$data </span><span class="keyword">= </span><span class="default">chunk_split</span><span class="keyword">(</span><span class="default">base64_encode</span><span class="keyword">(</span><span class="default">$data</span><span class="keyword">));<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$message </span><span class="keyword">.= </span><span class="string">"Content-Type: application/octet-stream; name=\""</span><span class="keyword">.</span><span class="default">basename</span><span class="keyword">(</span><span class="default">$files</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">]).</span><span class="string">"\"\n" </span><span class="keyword">. <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="string">"Content-Description: "</span><span class="keyword">.</span><span class="default">basename</span><span class="keyword">(</span><span class="default">$files</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">]).</span><span class="string">"\n" </span><span class="keyword">.<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="string">"Content-Disposition: attachment;\n" </span><span class="keyword">. </span><span class="string">" filename=\""</span><span class="keyword">.</span><span class="default">basename</span><span class="keyword">(</span><span class="default">$files</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">]).</span><span class="string">"\"; size="</span><span class="keyword">.</span><span class="default">filesize</span><span class="keyword">(</span><span class="default">$files</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">]).</span><span class="string">";\n" </span><span class="keyword">. <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="string">"Content-Transfer-Encoding: base64\n\n" </span><span class="keyword">. </span><span class="default">$data </span><span class="keyword">. </span><span class="string">"\n\n"</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$message </span><span class="keyword">.= </span><span class="string">"--</span><span class="keyword">{</span><span class="default">$mime_boundary</span><span class="keyword">}</span><span class="string">--"</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$returnpath </span><span class="keyword">= </span><span class="string">"-f" </span><span class="keyword">. </span><span class="default">$sendermail</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$ok </span><span class="keyword">= @</span><span class="default">mail</span><span class="keyword">(</span><span class="default">$to</span><span class="keyword">, </span><span class="default">$subject</span><span class="keyword">, </span><span class="default">$message</span><span class="keyword">, </span><span class="default">$headers</span><span class="keyword">, </span><span class="default">$returnpath</span><span class="keyword">); <br />
&nbsp;&nbsp;&nbsp; if(</span><span class="default">$ok</span><span class="keyword">){ return </span><span class="default">$i</span><span class="keyword">; } else { return </span><span class="default">0</span><span class="keyword">; }<br />
&nbsp;&nbsp;&nbsp; }<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="105423""></a>
  <div class="note">
   <strong class="user">epheterson at gmail dot com</strong>
   <a href="#105423" class="date">16-Aug-2011 07:48</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
After banging my head against the wall, I realized after my host updated PHP that the From line in the header requires quotes around the name where before it worked regardless. Otherwise it will report success, and not sent. <br />
<br />
$headers .= 'From: "'. $Name . '" &lt;' . $Email . '&gt;' . "\r\n";</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="105211""></a>
  <div class="note">
   <strong class="user">krzysiek dot 333 at gmail dot com</strong>
   <a href="#105211" class="date">03-Aug-2011 08:24</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Sending messages with polish special characters:<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">function </span><span class="default">plmail</span><span class="keyword">(</span><span class="default">$mail</span><span class="keyword">, </span><span class="default">$sub</span><span class="keyword">, </span><span class="default">$mes</span><span class="keyword">){<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$headers </span><span class="keyword">= </span><span class="string">"From: ExRobot &lt;robot@example.com&gt;\r\n"</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$headers </span><span class="keyword">.= </span><span class="string">"MIME-Version: 1.0\r\n"</span><span class="keyword">; <br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$headers </span><span class="keyword">.= </span><span class="string">"Content-type: text/plain; CHARSET=shift-jis\r\n"</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$headers </span><span class="keyword">.=</span><span class="string">"Content-Transfer-Encoding: 8bit"</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$mes</span><span class="keyword">=</span><span class="default">htmlspecialchars_decode</span><span class="keyword">(</span><span class="default">$mes</span><span class="keyword">,</span><span class="default">ENT_QUOTES</span><span class="keyword">);</span><span class="comment">//optional - I use encoding to POST data<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">mail</span><span class="keyword">(</span><span class="default">$mail</span><span class="keyword">, </span><span class="string">"=?utf-8?B?"</span><span class="keyword">.</span><span class="default">base64_encode</span><span class="keyword">(</span><span class="default">$sub</span><span class="keyword">).</span><span class="string">"?="</span><span class="keyword">, </span><span class="default">$mes</span><span class="keyword">, </span><span class="default">$headers</span><span class="keyword">);<br />
}<br />
</span><span class="default">?&gt;<br />
</span>Page must be in utf-8 encoding.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="104945""></a>
  <div class="note">
   <strong class="user">mulllhausen</strong>
   <a href="#104945" class="date">18-Jul-2011 07:14</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
i found that emails were not getting sent when i specified multiple recipients separated by commas in the $to variable. <br />
<br />
however i did find that i could specify multiple recipients using the the 'To: ' header. i am using php cli on ubuntu 10.04.1 lts.<br />
<br />
hopefully this is useful to someone</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="104594""></a>
  <div class="note">
   <strong class="user">me at arronwoods dot com</strong>
   <a href="#104594" class="date">24-Jun-2011 04:42</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I've had all sorts of problems with scripts that don't set the "-f user@example.org" parameter when using mail() if postfix is the sendmail agent.
<br />

<br />
In postfix I had SMTP relay authentication based on the sender address, but it was always the PHP user as the sender until I adapted the code from:
<br />

<br />
<span class="default">&lt;?php mail</span><span class="keyword">(</span><span class="string">'test@example.org'</span><span class="keyword">, </span><span class="string">'Subject'</span><span class="keyword">, </span><span class="string">'Body'</span><span class="keyword">, </span><span class="string">'From: user@example.org'</span><span class="keyword">); </span><span class="default">?&gt;
<br />
</span>
<br />
to:
<br />

<br />
<span class="default">&lt;?php mail</span><span class="keyword">(</span><span class="string">'test@example.org'</span><span class="keyword">, </span><span class="string">'Subject'</span><span class="keyword">, </span><span class="string">'Body'</span><span class="keyword">, </span><span class="string">'From: user@example.org'</span><span class="keyword">, </span><span class="string">'-f user@example.org'</span><span class="keyword">); </span><span class="default">?&gt;
<br />
</span>
<br />
I couldn't find a way to adjust PHP or Postfix to do this for me, so I had to edit the application. I was actually using Zend_Mail_Transport_Smtp, which made it that little bit trickier. I ended up with this:
<br />

<br />
<span class="default">&lt;?php
<br />

<br />
</span><span class="keyword">class </span><span class="default">My_Mail_Transport_Sendmail </span><span class="keyword">extends </span><span class="default">Zend_Mail_Transport_Sendmail </span><span class="keyword">{
<br />

<br />
&nbsp;&nbsp;&nbsp; public function </span><span class="default">_sendMail</span><span class="keyword">() {
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">parameters </span><span class="keyword">=== </span><span class="default">null</span><span class="keyword">) {
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">parameters </span><span class="keyword">= </span><span class="string">'-f ' </span><span class="keyword">. </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">_mail</span><span class="keyword">-&gt;</span><span class="default">getFrom</span><span class="keyword">();
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }
<br />

<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">parent</span><span class="keyword">::</span><span class="default">_sendMail</span><span class="keyword">();
<br />
&nbsp;&nbsp;&nbsp; }
<br />

<br />
}
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="104054""></a>
  <div class="note">
   <strong class="user">vigo dot von dot harrach at gmx dot de</strong>
   <a href="#104054" class="date">19-May-2011 11:49</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If using sendmail as transport agent, setting the "DeliveryMode" to "background" (asynchronous) instead of the default "interactive" (synchronous) makes mail() a lot faster, while still sending immediately.<br />
You can either use the "additional parameters", e.g. mail($to, $subject, $message, $headers, 'O DeliveryMode=b'), or make this mode default by changing php.ini's "sendmail_path" to 'sendmail -t -i -O DeliveryMode=b'.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="103873""></a>
  <div class="note">
   <strong class="user">buraks78 at gmail dot com</strong>
   <a href="#103873" class="date">08-May-2011 04:02</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If you are having problems changing the Sender and Return-Path headers, make sure that you are editing the right configuration file. On my CentOS 5.6:
<br />

<br />
[root@server mail]# ll /usr/sbin/sendmail
<br />
lrwxrwxrwx 1 root root 21 Oct 26&nbsp; 2009 /usr/sbin/sendmail -&gt; /etc/alternatives/mta
<br />
[root@server mail]# ll /etc/alternatives/mta
<br />
lrwxrwxrwx 1 root root 23 Apr&nbsp; 9 07:48 /etc/alternatives/mta -&gt; /usr/sbin/sendmail.exim
<br />
[root@server mail]# ll /usr/sbin/sendmail.exim 
<br />
lrwxrwxrwx 1 root root 4 Apr&nbsp; 9 07:45 /usr/sbin/sendmail.exim -&gt; exim
<br />

<br />
I spent some time trying to figure out why my changes to the sendmail.mc file were being ignored. Naturally, Exim configuration is different than Sendmail. You need to edit the /etc/exim/exim.conf file instead:
<br />

<br />
remote_smtp:
<br />
&nbsp; driver = smtp
<br />
&nbsp; return_path = bounce@example.com
<br />
&nbsp; headers_rewrite = apache@* info@example.com s
<br />

<br />
^ Don't forget the "s" at the end. See this page for more information: <a href="http://www.exim.org/exim-html-2.00/doc/html/spec_32.html#SEC669" rel="nofollow" target="_blank">http://www.exim.org/exim-html-2.00/doc/html/spec_32.html#SEC669</a>
<br />

<br />
If you are OK with displaying the apache user name (ie "Sender: apache@subdomain.example.com") in the email header, then just update the qualify_domain configuration option in the same file. 
<br />

<br />
qualify_domain = example.com
<br />

<br />
This will fix the domain only (ie "Sender: apache@example.com").</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="100727""></a>
  <div class="note">
   <strong class="user">shuitest at gmail dot com</strong>
   <a href="#100727" class="date">03-Nov-2010 06:50</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If you use mutt, do as below, <br />
<br />
/usr/bin/mutt -s '$subject' -f /dev/null -e 'set copy=no' -e 'set from = "{$GLOBALS[cfg][email_from]}"' -a '$attach_file_full_path' '{$GLOBALS[cfg][email_to]}' &lt;/dev/null 2&gt;&amp;1;</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="100193""></a>
  <div class="note">
   <strong class="user">Michiel Uitdehaag</strong>
   <a href="#100193" class="date">30-Sep-2010 10:07</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
We had a LAMP setting with postfix as mail system. Our additional headers were not interpreted correctly by a receiving mailserver (Exchange/ENOD32) and a newline was inserted after the first additional header.<br />
<br />
It turns out that a internet/dos style newline (\r\n) in the headers were converted to \r\r\n (ie: something mindlessly replaced all \n with \r\n without seeing if \n was already preceded by \r)<br />
<br />
I don't know if this is something in PHP or postfix, but seeing the comments below I suspect it is something of PHP on *NIX in combination with non-sendmail mailers.<br />
<br />
So, use your 'local' newline style for additional headers, as opposed to the examples above.<br />
<br />
I don't know if this is a bug anywhere. I don't know which element exactly does the unix2dos translation. If it is PHP, it should only replace ([^\r])\n&nbsp; with \1\r\n</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="99356""></a>
  <div class="note">
   <strong class="user">phadley at reliableid dot com</strong>
   <a href="#99356" class="date">12-Aug-2010 03:20</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
The mail function will stop including headers if you misspell one of them.&nbsp; It doesn't report an error, it just puts the offending header and all that follow it in the body of the message.&nbsp; My great transgression was using MIME Version instead of MIME-Version, a lapse which cost me several hours.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="98775""></a>
  <div class="note">
   <strong class="user">Porjo</strong>
   <a href="#98775" class="date">07-Jul-2010 08:19</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Make sure you enclose \r\n in double quotes (not single quotes!) so that PHP can translate that into the correct linefeed code</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="97680""></a>
  <div class="note">
   <strong class="user">umangberi at gmail dot com</strong>
   <a href="#97680" class="date">02-May-2010 10:41</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Outlook 2007 seemed to be a little finicky with me to have carriage returns in the headers. So any \r\n resulted in messages that had default apache messages sent over to me.<br />
<br />
As soon as I removed \r from all of the headers, the script started working fine. Hope that helped.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="96267""></a>
  <div class="note">
   <strong class="user">matthew dot mckay at uwrf dot edu</strong>
   <a href="#96267" class="date">17-Feb-2010 10:57</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Note: On some windows platforms this is NOT thread safe.<br />
We are having email message bodies being sent out to the wrong headers multiple times, some failing to send, and other bizarre stuff. If you google search for "php mail thread safe" you can find a ton of relevant information.<br />
This is not a bug in php, there have been multiple bugs closed with this issue being dismissed as not an issue with PHP.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="95422""></a>
  <div class="note">
   <strong class="user">rch+php at online dot lt</strong>
   <a href="#95422" class="date">02-Jan-2010 10:46</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
RFC-2822 is quite explicit, that "Though some message&nbsp;&nbsp; systems locally store messages in this format (which eliminates the need for translation between formats) and others use formats that differ from the one specified in this standard, local storage is outside of the scope of this standard."<br />
<br />
And it is not just "some", but most Unix mailers choke when you try pipe CRLF instead of Unix line endings to "sendmail" command.&nbsp; PHP is using line endings as is, so you have better chances for success if you use Unix file format or line endings.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="94752""></a>
  <div class="note">
   <strong class="user">Alex M.</strong>
   <a href="#94752" class="date">23-Nov-2009 08:49</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
It is important to filter the form input to prevent header injection. Here is a simple way:
<br />

<br />
<span class="default">&lt;?php
<br />
</span><span class="comment"># Anti-header-injection - Use before mail()
<br />
# By Victor Benincasa &lt;vbenincasa(AT)gmail.com&gt;
<br />

<br />
</span><span class="keyword">foreach(</span><span class="default">$_REQUEST </span><span class="keyword">as </span><span class="default">$fields </span><span class="keyword">=&gt; </span><span class="default">$value</span><span class="keyword">) if(</span><span class="default">eregi</span><span class="keyword">(</span><span class="string">"TO:"</span><span class="keyword">, </span><span class="default">$value</span><span class="keyword">) || </span><span class="default">eregi</span><span class="keyword">(</span><span class="string">"CC:"</span><span class="keyword">, </span><span class="default">$value</span><span class="keyword">) || </span><span class="default">eregi</span><span class="keyword">(</span><span class="string">"CCO:"</span><span class="keyword">, </span><span class="default">$value</span><span class="keyword">) || </span><span class="default">eregi</span><span class="keyword">(</span><span class="string">"Content-Type"</span><span class="keyword">, </span><span class="default">$value</span><span class="keyword">)) exit(</span><span class="string">"ERROR: Code injection attempt denied! Please don't use the following sequences in your message: 'TO:', 'CC:', 'CCO:' or 'Content-Type'."</span><span class="keyword">);
<br />
</span><span class="default">?&gt;
<br />
</span>
<br />
--
<br />
Alex M.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="94428""></a>
  <div class="note">
   <strong class="user">Systemx</strong>
   <a href="#94428" class="date">04-Nov-2009 11:29</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Bare LFs in SMTP
<br />

<br />
Use This
<br />

<br />
<span class="default">&lt;?php
<br />
</span><span class="comment">// Fix any bare linefeeds in the message to make it RFC821 Compliant.
<br />
</span><span class="default">$message </span><span class="keyword">= </span><span class="default">preg_replace</span><span class="keyword">(</span><span class="string">"#(?&lt;!\r)\n#si"</span><span class="keyword">, </span><span class="string">"\r\n"</span><span class="keyword">, </span><span class="default">$message</span><span class="keyword">); 
<br />
&nbsp;&nbsp;&nbsp; 
<br />
</span><span class="comment">// Make sure there are no bare linefeeds in the headers
<br />
</span><span class="default">$headers </span><span class="keyword">= </span><span class="default">preg_replace</span><span class="keyword">(</span><span class="string">'#(?&lt;!\r)\n#si'</span><span class="keyword">, </span><span class="string">"\r\n"</span><span class="keyword">, </span><span class="default">$headers</span><span class="keyword">);
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="94170""></a>
  <div class="note">
   <strong class="user">John</strong>
   <a href="#94170" class="date">20-Oct-2009 08:38</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
A quick note about the optional flags that can be passed to sendmail. -f will set the From address, -r will override the default Return-path that sendmail generates (typically the From address gets used). If you want your bouncebacks to go to a different address than the from address, try using both flags at once: "-f myfromemail@example.com -r mybounceemail@example.com"</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="94000""></a>
  <div class="note">
   <strong class="user">dtbaker.com.au</strong>
   <a href="#94000" class="date">11-Oct-2009 05:59</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
An observation about safe_mode and mail()<br />
<br />
It looks like multiple \r\n's are replaced by a single \r\n inside the string passed to "additional_headers". I can only re-produce this on a box running with safe_mode enabled.<br />
<br />
If (for some reason) your script crafts the entire email message in the headers, this will most likely produce a blank email on safe_mode boxes (like this script I've been trying to get working).</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="93980""></a>
  <div class="note">
   <strong class="user">Maven1 at example dot com</strong>
   <a href="#93980" class="date">09-Oct-2009 10:28</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I was having trouble with the newline and carriage return characters when using the mail function in a custom script within Joomla since the stupid input validations kept stripping them (changed "/r/n" to "rn").<br />
<br />
To get around this, I used chr(13) and chr(10) to insert them.<br />
<br />
<span class="default">&lt;?php<br />
<br />
$headers </span><span class="keyword">.= </span><span class="string">'To: Mary &lt;mary@example.com&gt;, Kelly &lt;kelly@example.com&gt;' </span><span class="keyword">. </span><span class="default">chr</span><span class="keyword">(</span><span class="default">13</span><span class="keyword">) . </span><span class="default">chr</span><span class="keyword">(</span><span class="default">10</span><span class="keyword">);<br />
</span><span class="default">$headers </span><span class="keyword">.= </span><span class="string">'From: Birthday Reminder &lt;birthday@example.com&gt;' </span><span class="keyword">. </span><span class="default">chr</span><span class="keyword">(</span><span class="default">13</span><span class="keyword">) . </span><span class="default">chr</span><span class="keyword">(</span><span class="default">10</span><span class="keyword">);<br />
<br />
</span><span class="default">?&gt;<br />
</span><br />
Hope that helps someone.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="92993""></a>
  <div class="note">
   <strong class="user">Clayton Ginsburg</strong>
   <a href="#92993" class="date">18-Aug-2009 09:38</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I recently had an issue where the mail() function would work fine from the php cli but not from apache.<br />
<br />
I eventually traced this down to the fact that I was using apparmor<br />
<br />
Specifically, I configured apparmor to deny the apache user the ability to use /bin/dash<br />
<br />
After changing apparmor to /bin/dash rix <br />
and reloading the apparmor profile, mail worked<br />
<br />
In other words, mail requires the account/program executing the script to be able to use /bin/dash<br />
<br />
I hope this helps someone</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="92662""></a>
  <div class="note">
   <strong class="user">Tomer</strong>
   <a href="#92662" class="date">03-Aug-2009 08:31</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I was trying to create a script that would send large forms without having to get/post each value first and came up with this... should help someone to save valuable time.<br />
<br />
<span class="default">&lt;?php<br />
$emailSentTo </span><span class="keyword">= </span><span class="string">""</span><span class="keyword">;<br />
</span><span class="default">$subjectOfEmail </span><span class="keyword">= </span><span class="string">""</span><span class="keyword">;<br />
<br />
</span><span class="comment">//========= no need to edit bellow<br />
<br />
// Set HTML Mail Header<br />
</span><span class="default">$headers&nbsp; </span><span class="keyword">= </span><span class="string">'MIME-Version: 1.0' </span><span class="keyword">. </span><span class="string">"\r\n"</span><span class="keyword">;<br />
</span><span class="default">$headers </span><span class="keyword">.= </span><span class="string">'Content-type: text/html; charset=iso-8859-1' </span><span class="keyword">. </span><span class="string">"\r\n"</span><span class="keyword">;<br />
<br />
</span><span class="comment">// The Message<br />
</span><span class="default">$message </span><span class="keyword">= </span><span class="default">$GLOBALS</span><span class="keyword">[</span><span class="string">"HTTP_SERVER_VARS"</span><span class="keyword">][</span><span class="string">"REQUEST_URI"</span><span class="keyword">];<br />
<br />
</span><span class="comment">//Cleaning Message<br />
</span><span class="default">$message </span><span class="keyword">= </span><span class="default">str_replace</span><span class="keyword">(</span><span class="string">'?'</span><span class="keyword">,</span><span class="string">'&lt;br&gt;&lt;hr&gt;'</span><span class="keyword">,</span><span class="default">str_replace</span><span class="keyword">(</span><span class="string">'/'</span><span class="keyword">,</span><span class="string">'File used for submittimg this form: '</span><span class="keyword">,</span><span class="default">str_replace</span><span class="keyword">(</span><span class="string">'='</span><span class="keyword">,</span><span class="string">': '</span><span class="keyword">,</span><span class="default">str_replace</span><span class="keyword">(</span><span class="string">'&amp;'</span><span class="keyword">,</span><span class="string">'&lt;br&gt;'</span><span class="keyword">,</span><span class="default">$message</span><span class="keyword">))));<br />
<br />
</span><span class="comment">// Sending<br />
</span><span class="default">mail</span><span class="keyword">(</span><span class="default">$emailSentTo</span><span class="keyword">, </span><span class="default">$subjectOfEmail</span><span class="keyword">, </span><span class="default">$message</span><span class="keyword">, </span><span class="default">$headers</span><span class="keyword">);<br />
<br />
</span><span class="comment">//Thanking<br />
</span><span class="keyword">echo </span><span class="string">"&lt;script language=\"javascript\" type=\"text/javascript\"&gt;<br />
alert('Thank You, We will contact you shortly.');<br />
window.location = \"<a href="http://" rel="nofollow" target="_blank">http://</a></span><span class="default">$_SERVER</span><span class="keyword">[</span><span class="default">HTTP_HOST</span><span class="keyword">]</span><span class="string">\";<br />
&lt;/script&gt;<br />
"</span><span class="keyword">;<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="92639""></a>
  <div class="note">
   <strong class="user">Edward</strong>
   <a href="#92639" class="date">01-Aug-2009 11:08</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Currently my hosting service is on Godaddy. When attempting to use the mail function without the fifth parameter containing "-f", my message headers would not work.
<br />

<br />
Whenever your message headers do not work, simply try using the fifth parameter:
<br />

<br />
<span class="default">&lt;?php
<br />
mail</span><span class="keyword">(</span><span class="default">$to</span><span class="keyword">, </span><span class="default">$subject</span><span class="keyword">, </span><span class="default">$message</span><span class="keyword">, </span><span class="default">$headers</span><span class="keyword">, </span><span class="string">"-femail.address@example.com"</span><span class="keyword">);
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="92528""></a>
  <div class="note">
   <strong class="user">php at caves dot org dot uk</strong>
   <a href="#92528" class="date">28-Jul-2009 04:32</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Setting an envelope-sender address avoids mail bounces annoying your system administrator.<br />
<br />
If your mail cannot be delivered, it will be rejected to the address specified as the "SMTP-envelope-from" (or the "envelope sender" or "return path", depending on the terminology you like to use )<br />
<br />
If you do not explicitly set an envelope-from address then PHP will default to the php.ini setting which - if you have not set this yourself - could be nobody@[your-ISP-domain] or anonymous@[your-ISP-domain], for example.<br />
<br />
To avoid bothering the person at that address - or indeed, if you are wondering why you are not receiving mail rejections yourself - you should use the "-f" option in the &lt;$additional_parameters&gt; argument to set a valid address.<br />
<br />
(and, by the way: If you do this, but you do not set a From: address in the &lt;$additional_headers&gt; argument then PHP will set a default From: address of "From: Nobody &lt;your-envelope-sender-setting&gt;". ).</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="91969""></a>
  <div class="note">
   <strong class="user">Anonymous</strong>
   <a href="#91969" class="date">03-Jul-2009 06:22</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I was (finally) able to get multipart HTML mail working.<br />
The 'boundary' must be defined with double quotes, not apostrophes.<br />
<br />
$headers .= "Content-Type: multipart/alternative;boundary=\"$boundary\";\n\n";</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="91320""></a>
  <div class="note">
   <strong class="user">d dot r at usask dot ca</strong>
   <a href="#91320" class="date">05-Jun-2009 06:44</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
The example indicates \r\n at the end of each line in the headers but this was causing me problems as emails showed some of the headers as part of the body.&nbsp; I simply used only \n as in some of the other examples and the problem went away.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="91058""></a>
  <div class="note">
   <strong class="user">marcel dot portela at gmail dot com</strong>
   <a href="#91058" class="date">22-May-2009 07:32</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
To define a mail priority you have to put this lines in the headers:
<br />

<br />
<span class="default">&lt;?php
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $headers </span><span class="keyword">= </span><span class="string">"MIME-Version: 1.0\n" </span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$headers </span><span class="keyword">.= </span><span class="string">"Content-Type: text/html; charset=\"iso-8859-1\"\n"</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$headers </span><span class="keyword">.= </span><span class="string">"X-Priority: 1 (Higuest)\n"</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$headers </span><span class="keyword">.= </span><span class="string">"X-MSMail-Priority: High\n"</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$headers </span><span class="keyword">.= </span><span class="string">"Importance: High\n"</span><span class="keyword">;
<br />

<br />
&nbsp;</span><span class="default">$status&nbsp;&nbsp; </span><span class="keyword">= </span><span class="default">mail</span><span class="keyword">(</span><span class="default">$to</span><span class="keyword">, </span><span class="default">$subject</span><span class="keyword">, </span><span class="default">$message</span><span class="keyword">,</span><span class="default">$headers</span><span class="keyword">);
<br />
</span><span class="default">?&gt;
<br />
</span>
<br />
Here i've added many headers information including the Priority...</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="89794""></a>
  <div class="note">
   <strong class="user">aldertb at XS4ALL dot nl</strong>
   <a href="#89794" class="date">23-Mar-2009 10:30</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I experienced problems with removed euro signs and some other accented letters. The text came from a DB but contained the euro sign etcetera inside the mail function, just as when you would define it as a string. (Did die($newsletter['message']). It was lost in the mail I received though! When I defined the message as a string inside the sending function (overriding text from DB), including euro sign as a single character, I DID receive the email including euro sign!<br />
<br />
This was experienced on 2 different email accounts. With one I received no text after the euro sign.<br />
<br />
But only when text came from mySQL DB from a longtext Latin1-field...<br />
<br />
I installed the pear mail class and this solved the strange problem and could just send text from the DB...</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="89238""></a>
  <div class="note">
   <strong class="user">alex_ramos at sourceforge dot net</strong>
   <a href="#89238" class="date">27-Feb-2009 04:37</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Beware if you're trying to use "-f" or "-r" with the 5th parameter of the PHP mail() function, and you're relying on a plain vanilla install of sendmail on Linux, it won't work. You'll have to either change the sendmail config and add your script's userid to "trusted-users" (easier said than done... good luck with that!), or, remove sendmail and install postfix (much easier).</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="89043""></a>
  <div class="note">
   <strong class="user">Erich at gasboysnospam dot net</strong>
   <a href="#89043" class="date">19-Feb-2009 04:43</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
if your mail is failing (returns false) be aware that many servers are configured to kill mail going out with a bcc or cc header.<br />
<br />
The ideal workaround is to use the smtp functions which servers allow because of its better audit trail. Alternatively call the mail function several times.<br />
<br />
I've just spent about four hours trying to work out what I was doing wrong!!</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="88302""></a>
  <div class="note">
   <strong class="user">orjtor</strong>
   <a href="#88302" class="date">19-Jan-2009 09:17</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
This is my solution of problems with Windows Mail on Vista. I got some of the headers in the mail body as plain text. When I removed '\r' and left just '\n' at the end of the two last lines of header it worked. This error didn't show up in my yahoo mail.
<br />
<span class="default">&lt;?php
<br />
&nbsp;&nbsp;&nbsp; $body </span><span class="keyword">= </span><span class="string">"&lt;html&gt;\n"</span><span class="keyword">;
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$body </span><span class="keyword">.= </span><span class="string">"&lt;body style=\"font-family:Verdana, Verdana, Geneva, sans-serif; font-size:12px; color:#666666;\"&gt;\n"</span><span class="keyword">;
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$body </span><span class="keyword">= </span><span class="default">$message</span><span class="keyword">;
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$body </span><span class="keyword">.= </span><span class="string">"&lt;/body&gt;\n"</span><span class="keyword">;
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$body </span><span class="keyword">.= </span><span class="string">"&lt;/html&gt;\n"</span><span class="keyword">;
<br />
&nbsp;&nbsp;&nbsp; 
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$headers&nbsp; </span><span class="keyword">= </span><span class="string">"From: My site&lt;noreply@example.com&gt;\r\n"</span><span class="keyword">;
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$headers </span><span class="keyword">.= </span><span class="string">"Reply-To: info@example.com\r\n"</span><span class="keyword">;
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$headers </span><span class="keyword">.= </span><span class="string">"Return-Path: info@example.com\r\n"</span><span class="keyword">;
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$headers </span><span class="keyword">.= </span><span class="string">"X-Mailer: Drupal\n"</span><span class="keyword">;
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$headers </span><span class="keyword">.= </span><span class="string">'MIME-Version: 1.0' </span><span class="keyword">. </span><span class="string">"\n"</span><span class="keyword">;
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$headers </span><span class="keyword">.= </span><span class="string">'Content-type: text/html; charset=iso-8859-1' </span><span class="keyword">. </span><span class="string">"\r\n"</span><span class="keyword">;
<br />
&nbsp;&nbsp;&nbsp; 
<br />
&nbsp;&nbsp;&nbsp; return </span><span class="default">mail</span><span class="keyword">(</span><span class="default">$recipient</span><span class="keyword">, </span><span class="default">$subject</span><span class="keyword">, </span><span class="default">$message</span><span class="keyword">, </span><span class="default">$headers</span><span class="keyword">);
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="86790""></a>
  <div class="note">
   <strong class="user">php at ontheroad dot net dot nz</strong>
   <a href="#86790" class="date">04-Nov-2008 06:00</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Another possible cause for the "501 5.5.4 Invalid Address" type errors when sending mail from Windows is specifying BCC or CC parameters with no value.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="86321""></a>
  <div class="note">
   <strong class="user">molotster on google mail com</strong>
   <a href="#86321" class="date">13-Oct-2008 10:03</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Note, that single line should not contain more than 78 character, but is not allowed to contain more than 998 characters.<br />
<br />
The possible consequences are:<br />
Over 78 - clients are allowed to display the message in a "harder to read" way.<br />
Over 998 - clients and servers are allowed to drop the message or cause any buffer-limit error.<br />
<br />
See:<br />
<a href="http://www.faqs.org/rfcs/rfc2822 part 2.1.1." rel="nofollow" target="_blank">http://www.faqs.org/rfcs/rfc2822 part 2.1.1.</a></span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="85476""></a>
  <div class="note">
   <strong class="user">webmaster at plumage dot nl</strong>
   <a href="#85476" class="date">01-Sep-2008 11:53</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
The work-around for a large quantity of recipients is putting the adresses in the header-section as Bcc adresses.
<br />
In this way the mail()-function opens and closes the SMTP connection only once:
<br />

<br />
<span class="default">&lt;?php
<br />
$count_recip</span><span class="keyword">= </span><span class="default">count</span><span class="keyword">(</span><span class="default">$recip</span><span class="keyword">);</span><span class="comment">//where $recip represents an array of mail-adresses, from MySql-query or otherwise
<br />
</span><span class="default">$count</span><span class="keyword">=</span><span class="string">'0'</span><span class="keyword">;
<br />
</span><span class="default">$headers</span><span class="keyword">.=</span><span class="string">"Bcc: "</span><span class="keyword">;
<br />
while(</span><span class="default">$count </span><span class="keyword">&lt; </span><span class="default">$count_recip</span><span class="keyword">){
<br />
</span><span class="default">$headers</span><span class="keyword">.=</span><span class="default">$recip</span><span class="keyword">[</span><span class="default">$count</span><span class="keyword">].</span><span class="string">", "</span><span class="keyword">;
<br />
</span><span class="default">$count </span><span class="keyword">++;
<br />
}
<br />
</span><span class="default">$headers</span><span class="keyword">.=</span><span class="string">"admin@example.com\r\n"</span><span class="keyword">;
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="84467""></a>
  <div class="note">
   <strong class="user">bob</strong>
   <a href="#84467" class="date">15-Jul-2008 10:51</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If the Cc or Bcc lines appear in the message body, make sure you're separating header lines with a new line (\n) rather than a carriage return-new line (\r\n). That should come at the very end of the headers.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="83491""></a>
  <div class="note">
   <strong class="user">akam</strong>
   <a href="#83491" class="date">28-May-2008 03:55</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
There differenece in body, headers of email (with attachment, without attachment), see this complete example below:<br />
work great for me (LINUX , WIN) and (Yahoo Mail, Hotmail, Gmail, ...)<br />
<span class="default">&lt;?php<br />
$to&nbsp; &nbsp; &nbsp; </span><span class="keyword">= </span><span class="default">$_POST</span><span class="keyword">[</span><span class="string">'to'</span><span class="keyword">]; <br />
</span><span class="default">$email&nbsp;&nbsp; </span><span class="keyword">= </span><span class="default">$_POST</span><span class="keyword">[</span><span class="string">'email'</span><span class="keyword">]; <br />
</span><span class="default">$name&nbsp; &nbsp; </span><span class="keyword">= </span><span class="default">$_POST</span><span class="keyword">[</span><span class="string">'name'</span><span class="keyword">];<br />
</span><span class="default">$subject </span><span class="keyword">= </span><span class="default">$_POST</span><span class="keyword">[</span><span class="string">'subject'</span><span class="keyword">]; <br />
</span><span class="default">$comment </span><span class="keyword">= </span><span class="default">$_POST</span><span class="keyword">[</span><span class="string">'message'</span><span class="keyword">];<br />
<br />
</span><span class="default">$To&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="keyword">= </span><span class="default">strip_tags</span><span class="keyword">(</span><span class="default">$to</span><span class="keyword">);<br />
</span><span class="default">$TextMessage </span><span class="keyword">=</span><span class="default">strip_tags</span><span class="keyword">(</span><span class="default">nl2br</span><span class="keyword">(</span><span class="default">$comment</span><span class="keyword">),</span><span class="string">"&lt;br&gt;"</span><span class="keyword">);<br />
</span><span class="default">$HTMLMessage </span><span class="keyword">=</span><span class="default">nl2br</span><span class="keyword">(</span><span class="default">$comment</span><span class="keyword">);<br />
</span><span class="default">$FromName&nbsp; &nbsp; </span><span class="keyword">=</span><span class="default">strip_tags</span><span class="keyword">(</span><span class="default">$name</span><span class="keyword">);<br />
</span><span class="default">$FromEmail&nbsp;&nbsp; </span><span class="keyword">=</span><span class="default">strip_tags</span><span class="keyword">(</span><span class="default">$email</span><span class="keyword">);<br />
</span><span class="default">$Subject&nbsp; &nbsp;&nbsp; </span><span class="keyword">=</span><span class="default">strip_tags</span><span class="keyword">(</span><span class="default">$subject</span><span class="keyword">);<br />
<br />
</span><span class="default">$boundary1&nbsp;&nbsp; </span><span class="keyword">=</span><span class="default">rand</span><span class="keyword">(</span><span class="default">0</span><span class="keyword">,</span><span class="default">9</span><span class="keyword">).</span><span class="string">"-"<br />
</span><span class="keyword">.</span><span class="default">rand</span><span class="keyword">(</span><span class="default">10000000000</span><span class="keyword">,</span><span class="default">9999999999</span><span class="keyword">).</span><span class="string">"-"<br />
</span><span class="keyword">.</span><span class="default">rand</span><span class="keyword">(</span><span class="default">10000000000</span><span class="keyword">,</span><span class="default">9999999999</span><span class="keyword">).</span><span class="string">"=:"<br />
</span><span class="keyword">.</span><span class="default">rand</span><span class="keyword">(</span><span class="default">10000</span><span class="keyword">,</span><span class="default">99999</span><span class="keyword">);<br />
</span><span class="default">$boundary2&nbsp;&nbsp; </span><span class="keyword">=</span><span class="default">rand</span><span class="keyword">(</span><span class="default">0</span><span class="keyword">,</span><span class="default">9</span><span class="keyword">).</span><span class="string">"-"</span><span class="keyword">.</span><span class="default">rand</span><span class="keyword">(</span><span class="default">10000000000</span><span class="keyword">,</span><span class="default">9999999999</span><span class="keyword">).</span><span class="string">"-"<br />
</span><span class="keyword">.</span><span class="default">rand</span><span class="keyword">(</span><span class="default">10000000000</span><span class="keyword">,</span><span class="default">9999999999</span><span class="keyword">).</span><span class="string">"=:"<br />
</span><span class="keyword">.</span><span class="default">rand</span><span class="keyword">(</span><span class="default">10000</span><span class="keyword">,</span><span class="default">99999</span><span class="keyword">);<br />
<br />
&nbsp;<br />
for(</span><span class="default">$i</span><span class="keyword">=</span><span class="default">0</span><span class="keyword">; </span><span class="default">$i </span><span class="keyword">&lt; </span><span class="default">count</span><span class="keyword">(</span><span class="default">$_FILES</span><span class="keyword">[</span><span class="string">'youfile'</span><span class="keyword">][</span><span class="string">'name'</span><span class="keyword">]); </span><span class="default">$i</span><span class="keyword">++){<br />
if(</span><span class="default">is_uploaded_file</span><span class="keyword">(</span><span class="default">$_FILES</span><span class="keyword">[</span><span class="string">'fileatt'</span><span class="keyword">][</span><span class="string">'tmp_name'</span><span class="keyword">][</span><span class="default">$i</span><span class="keyword">]) &amp;&amp; <br />
&nbsp;&nbsp; !empty(</span><span class="default">$_FILES</span><span class="keyword">[</span><span class="string">'fileatt'</span><span class="keyword">][</span><span class="string">'size'</span><span class="keyword">][</span><span class="default">$i</span><span class="keyword">]) &amp;&amp; <br />
&nbsp;&nbsp; !empty(</span><span class="default">$_FILES</span><span class="keyword">[</span><span class="string">'fileatt'</span><span class="keyword">][</span><span class="string">'name'</span><span class="keyword">][</span><span class="default">$i</span><span class="keyword">])){<br />
&nbsp;&nbsp; &nbsp; <br />
</span><span class="default">$attach&nbsp; &nbsp; &nbsp; </span><span class="keyword">=</span><span class="string">'yes'</span><span class="keyword">;<br />
</span><span class="default">$end&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">=</span><span class="string">''</span><span class="keyword">;<br />
<br />
&nbsp;&nbsp; </span><span class="default">$handle&nbsp; &nbsp; &nbsp; </span><span class="keyword">=</span><span class="default">fopen</span><span class="keyword">(</span><span class="default">$_FILES</span><span class="keyword">[</span><span class="string">'fileatt'</span><span class="keyword">][</span><span class="string">'tmp_name'</span><span class="keyword">][</span><span class="default">$i</span><span class="keyword">], </span><span class="string">'rb'</span><span class="keyword">); <br />
&nbsp;&nbsp; </span><span class="default">$f_contents&nbsp; </span><span class="keyword">=</span><span class="default">fread</span><span class="keyword">(</span><span class="default">$handle</span><span class="keyword">, </span><span class="default">$_FILES</span><span class="keyword">[</span><span class="string">'fileatt'</span><span class="keyword">][</span><span class="string">'size'</span><span class="keyword">][</span><span class="default">$i</span><span class="keyword">]); <br />
&nbsp;&nbsp; </span><span class="default">$attachment</span><span class="keyword">[]=</span><span class="default">chunk_split</span><span class="keyword">(</span><span class="default">base64_encode</span><span class="keyword">(</span><span class="default">$f_contents</span><span class="keyword">));<br />
&nbsp;&nbsp; </span><span class="default">fclose</span><span class="keyword">(</span><span class="default">$handle</span><span class="keyword">); <br />
<br />
</span><span class="default">$ftype</span><span class="keyword">[]&nbsp; &nbsp; &nbsp;&nbsp; =</span><span class="default">$_FILES</span><span class="keyword">[</span><span class="string">'fileatt'</span><span class="keyword">][</span><span class="string">'type'</span><span class="keyword">][</span><span class="default">$i</span><span class="keyword">];<br />
</span><span class="default">$fname</span><span class="keyword">[]&nbsp; &nbsp; &nbsp;&nbsp; =</span><span class="default">$_FILES</span><span class="keyword">[</span><span class="string">'fileatt'</span><span class="keyword">][</span><span class="string">'name'</span><span class="keyword">][</span><span class="default">$i</span><span class="keyword">];<br />
}<br />
}<br />
<br />
</span><span class="comment">/***************************************************************<br />
&nbsp;Creating Email: Headers, BODY<br />
&nbsp;1- HTML Email WIthout Attachment!! &lt;&lt;-------- H T M L ---------<br />
&nbsp;***************************************************************/<br />
#----&gt;Headers Part<br />
</span><span class="default">$Headers&nbsp; &nbsp;&nbsp; </span><span class="keyword">=&lt;&lt;&lt;AKAM<br />
</span><span class="string">From: </span><span class="default">$FromName</span><span class="string"> &lt;</span><span class="default">$FromEmail</span><span class="string">&gt;<br />
Reply-To: </span><span class="default">$FromEmail</span><span class="string"><br />
MIME-Version: 1.0<br />
Content-Type: multipart/alternative;<br />
&nbsp;&nbsp;&nbsp; boundary="</span><span class="default">$boundary1</span><span class="string">"<br />
</span><span class="keyword">AKAM;<br />
<br />
</span><span class="comment">#----&gt;BODY Part<br />
</span><span class="default">$Body&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="keyword">=&lt;&lt;&lt;AKAM<br />
</span><span class="string">MIME-Version: 1.0<br />
Content-Type: multipart/alternative;<br />
&nbsp;&nbsp;&nbsp; boundary="</span><span class="default">$boundary1</span><span class="string">"<br />
<br />
This is a multi-part message in MIME format.<br />
<br />
--</span><span class="default">$boundary1</span><span class="string"><br />
Content-Type: text/plain;<br />
&nbsp;&nbsp;&nbsp; charset="windows-1256"<br />
Content-Transfer-Encoding: quoted-printable<br />
<br />
</span><span class="default">$TextMessage</span><span class="string"><br />
--</span><span class="default">$boundary1</span><span class="string"><br />
Content-Type: text/html;<br />
&nbsp;&nbsp;&nbsp; charset="windows-1256"<br />
Content-Transfer-Encoding: quoted-printable<br />
<br />
</span><span class="default">$HTMLMessage</span><span class="string"><br />
<br />
--</span><span class="default">$boundary1</span><span class="string">--<br />
</span><span class="keyword">AKAM;<br />
<br />
</span><span class="comment">/***************************************************************<br />
&nbsp;2- HTML Email WIth Multiple Attachment &lt;&lt;----- Attachment ------<br />
&nbsp;***************************************************************/<br />
&nbsp;<br />
</span><span class="keyword">if(</span><span class="default">$attach</span><span class="keyword">==</span><span class="string">'yes'</span><span class="keyword">) {<br />
<br />
</span><span class="default">$attachments</span><span class="keyword">=</span><span class="string">''</span><span class="keyword">;<br />
</span><span class="default">$Headers&nbsp; &nbsp;&nbsp; </span><span class="keyword">=&lt;&lt;&lt;AKAM<br />
</span><span class="string">From: </span><span class="default">$FromName</span><span class="string"> &lt;</span><span class="default">$FromEmail</span><span class="string">&gt;<br />
Reply-To: </span><span class="default">$FromEmail</span><span class="string"><br />
MIME-Version: 1.0<br />
Content-Type: multipart/mixed;<br />
&nbsp;&nbsp;&nbsp; boundary="</span><span class="default">$boundary1</span><span class="string">"<br />
</span><span class="keyword">AKAM;<br />
<br />
for(</span><span class="default">$j</span><span class="keyword">=</span><span class="default">0</span><span class="keyword">;</span><span class="default">$j</span><span class="keyword">&lt;</span><span class="default">count</span><span class="keyword">(</span><span class="default">$ftype</span><span class="keyword">); </span><span class="default">$j</span><span class="keyword">++){<br />
</span><span class="default">$attachments</span><span class="keyword">.=&lt;&lt;&lt;ATTA<br />
</span><span class="string">--</span><span class="default">$boundary1</span><span class="string"><br />
Content-Type: </span><span class="default">$ftype</span><span class="keyword">[</span><span class="default">$j</span><span class="keyword">]</span><span class="string">;<br />
&nbsp;&nbsp;&nbsp; name="</span><span class="default">$fname</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">]</span><span class="string">"<br />
Content-Transfer-Encoding: base64<br />
Content-Disposition: attachment;<br />
&nbsp;&nbsp;&nbsp; filename="</span><span class="default">$fname</span><span class="keyword">[</span><span class="default">$j</span><span class="keyword">]</span><span class="string">"<br />
<br />
</span><span class="default">$attachment</span><span class="keyword">[</span><span class="default">$j</span><span class="keyword">]</span><span class="string"><br />
<br />
</span><span class="keyword">ATTA;<br />
}<br />
<br />
</span><span class="default">$Body&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="keyword">=&lt;&lt;&lt;AKAM<br />
</span><span class="string">This is a multi-part message in MIME format.<br />
<br />
--</span><span class="default">$boundary1</span><span class="string"><br />
Content-Type: multipart/alternative;<br />
&nbsp;&nbsp;&nbsp; boundary="</span><span class="default">$boundary2</span><span class="string">"<br />
<br />
--</span><span class="default">$boundary2</span><span class="string"><br />
Content-Type: text/plain;<br />
&nbsp;&nbsp;&nbsp; charset="windows-1256"<br />
Content-Transfer-Encoding: quoted-printable<br />
<br />
</span><span class="default">$TextMessage</span><span class="string"><br />
--</span><span class="default">$boundary2</span><span class="string"><br />
Content-Type: text/html;<br />
&nbsp;&nbsp;&nbsp; charset="windows-1256"<br />
Content-Transfer-Encoding: quoted-printable<br />
<br />
</span><span class="default">$HTMLMessage</span><span class="string"><br />
<br />
--</span><span class="default">$boundary2</span><span class="string">--<br />
<br />
</span><span class="default">$attachments</span><span class="string"><br />
--</span><span class="default">$boundary1</span><span class="string">--<br />
</span><span class="keyword">AKAM;<br />
}<br />
<br />
</span><span class="comment">/***************************************************************<br />
&nbsp;Sending Email<br />
&nbsp;***************************************************************/<br />
</span><span class="default">$ok</span><span class="keyword">=</span><span class="default">mail</span><span class="keyword">(</span><span class="default">$To</span><span class="keyword">, </span><span class="default">$Subject</span><span class="keyword">, </span><span class="default">$Body</span><span class="keyword">, </span><span class="default">$Headers</span><span class="keyword">);<br />
echo </span><span class="default">$ok</span><span class="keyword">?</span><span class="string">"&lt;h1&gt; Mail Sent&lt;/h1&gt;"</span><span class="keyword">:</span><span class="string">"&lt;h1&gt; Mail not SEND&lt;/h1&gt;"</span><span class="keyword">;<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="81979""></a>
  <div class="note">
   <strong class="user">richard at richard-sumilang dot com</strong>
   <a href="#81979" class="date">22-Mar-2008 09:12</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If you are using the sendmail app from an exim package or something you don't really need to change the normal parameters PHP gives it (-t -i) as other posts described.
<br />

<br />
I just added "-f myemail@example.com" and it worked.
<br />

<br />
One thing that got me stuck for a few hours was trying to figure out why the return-path was set as the user (user running php) and not what I was setting it with the -f option then I later found at that in order to forcefully set the return-path the user account running the command must be in exim's trusted users configuration! It helps to add trusted_groups as well then everything works fine :)
<br />
- Richard Sumilang</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="80332""></a>
  <div class="note">
   <strong class="user">mortoray at ecircle-ag dot com</strong>
   <a href="#80332" class="date">10-Jan-2008 04:35</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Apparently if using the mbstring library, and using overriden functions, the "mail" command appears to use "Content-Transfer-Encoding: BASE64" by default.&nbsp; Which if you combine it with PEAR Mail_Mime you'll get mails that, although they appear RFC compliant, not mailer can read correctly.
<br />

<br />
To fix this it appears you should add a fixed header in the mail command (this one assumes the pear mime module is 7bit clean, perhaps 8bit would also be fine)
<br />

<br />
<span class="default">&lt;?php $headers</span><span class="keyword">[</span><span class="string">'Content-Transfer-Encoding'</span><span class="keyword">] = </span><span class="string">'7bit'</span><span class="keyword">; </span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="78098""></a>
  <div class="note">
   <strong class="user">phpcoder at cyberpimp dot ig3 dot net</strong>
   <a href="#78098" class="date">27-Sep-2007 05:51</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
In addition to the $to parameter restrictions on Windows (ie. address can not be in "name &lt;user@example.com&gt;" format), the same restrictions apply to the parsed Cc and Bcc headers of the $additional_headers parameter.<br />
<br />
However, you can include a To header in $additional_parameters which lists the addresses in any RFC-2822 format.&nbsp; (For display purposes only.&nbsp; You still need to list the bare addresses in the $to parameter.)</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="77012""></a>
  <div class="note">
   <strong class="user">Gianluigi_Zanettini-MegaLab.it</strong>
   <a href="#77012" class="date">10-Aug-2007 08:57</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Please note that using an address in this format "Zane, CEO - MegaLab.it" &lt;myaddrr@mydomain&gt; (" are needed due to comma) works as expected under *nix, but WON'T WORK under Windows.<br />
<br />
This is an example<br />
<br />
<span class="default">&lt;?php<br />
mail</span><span class="keyword">(</span><span class="string">"\"Zane, CEO - MegaLab.it\" &lt;myaddrr@mydomain&gt;"</span><span class="keyword">, </span><span class="string">"prova da test_zane"</span><span class="keyword">, </span><span class="string">"dai funziona..."</span><span class="keyword">);<br />
</span><span class="default">?&gt;<br />
</span><br />
It works under *unix, but it doensn't under Win: different error are reported:<br />
<br />
Warning: mail() [function.mail]: SMTP server response: 553 5.0.0 &lt;"Zane&gt;... Unbalanced '"'<br />
<br />
Warning: mail() [function.mail]: SMTP server response: 501 5.5.4 Invalid Address</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="75460""></a>
  <div class="note">
   <strong class="user">Alex Jaspersen</strong>
   <a href="#75460" class="date">31-May-2007 08:03</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
For qmail users, I have written a function that talks directly to qmail-queue, rather than going through the sendmail wrapper used by mail(). Thus it allows more direct control over the message (for example, you can adapt the function to display "undisclosed recipients" in to the To: header). It also performs careful validation of the e-mail addresses passed to it, making it more difficult for spammers to exploit your scripts.<br />
<br />
Please note that this function differs from the mail() function in that the from address must be passed as a _separate_ argument. It is automatically put into the message headers and _does not_ need to be included in $additional_headers.<br />
<br />
$to can either be an array or a single address contained in a string.<br />
$message should not contain any carriage return characters - only linefeeds.<br />
<br />
No validation is performed on $additional_headers. This is mostly unnecessary because qmail will ignore any additional To: headers injected by a malicious user. However if you have some strange mail setup it might be a problem.<br />
<br />
The function returns false if the message fails validation or is rejected by qmail-queue, and returns true on success.<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">function </span><span class="default">qmail_queue</span><span class="keyword">(</span><span class="default">$to</span><span class="keyword">, </span><span class="default">$from</span><span class="keyword">, </span><span class="default">$subject</span><span class="keyword">, </span><span class="default">$message</span><span class="keyword">, </span><span class="default">$additional_headers </span><span class="keyword">= </span><span class="string">""</span><span class="keyword">)<br />
{<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">// qmail-queue location and hostname used for Message-Id<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$cmd </span><span class="keyword">= </span><span class="string">"/var/qmail/bin/qmail-queue"</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$hostname </span><span class="keyword">= </span><span class="default">trim</span><span class="keyword">(</span><span class="default">file_get_contents</span><span class="keyword">(</span><span class="string">"/var/qmail/control/me"</span><span class="keyword">));<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">// convert $to into an array<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">if(</span><span class="default">is_scalar</span><span class="keyword">(</span><span class="default">$to</span><span class="keyword">))<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$to </span><span class="keyword">= array(</span><span class="default">$to</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">// BEGIN VALIDATION<br />
&nbsp;&nbsp;&nbsp; // e-mail address validation<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$e </span><span class="keyword">= </span><span class="string">"/^[-+\\.0-9=a-z_]+@([-0-9a-z]+\\.)+([0-9a-z]){2,4}$/i"</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">// from address<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">if(!</span><span class="default">preg_match</span><span class="keyword">(</span><span class="default">$e</span><span class="keyword">, </span><span class="default">$from</span><span class="keyword">)) return </span><span class="default">false</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">// to address(es)<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">foreach(</span><span class="default">$to </span><span class="keyword">as </span><span class="default">$rcpt</span><span class="keyword">)<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if(!</span><span class="default">preg_match</span><span class="keyword">(</span><span class="default">$e</span><span class="keyword">, </span><span class="default">$rcpt</span><span class="keyword">)) return </span><span class="default">false</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">// subject validation (only printable 7-bit ascii characters allowed)<br />
&nbsp;&nbsp;&nbsp; // needs to be adapted to allow for foreign languages with 8-bit characters<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">if(!</span><span class="default">preg_match</span><span class="keyword">(</span><span class="string">"/^[\\040-\\176]+$/"</span><span class="keyword">, </span><span class="default">$subject</span><span class="keyword">)) return </span><span class="default">false</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">// END VALIDATION<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; // open qmail-queue process<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$dspec </span><span class="keyword">= array<br />
&nbsp;&nbsp;&nbsp; (<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; array(</span><span class="string">"pipe"</span><span class="keyword">, </span><span class="string">"r"</span><span class="keyword">), </span><span class="comment">// message descriptor<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">array(</span><span class="string">"pipe"</span><span class="keyword">, </span><span class="string">"r"</span><span class="keyword">) </span><span class="comment">// envelope descriptor<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$pipes </span><span class="keyword">= array();<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$proc </span><span class="keyword">= </span><span class="default">proc_open</span><span class="keyword">(</span><span class="default">$cmd</span><span class="keyword">, </span><span class="default">$dspec</span><span class="keyword">, </span><span class="default">$pipes</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; if(!</span><span class="default">is_resource</span><span class="keyword">(</span><span class="default">$proc</span><span class="keyword">)) return </span><span class="default">false</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">// write additional headers<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">if(!empty(</span><span class="default">$additional_headers</span><span class="keyword">))<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">fwrite</span><span class="keyword">(</span><span class="default">$pipes</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">], </span><span class="default">$additional_headers </span><span class="keyword">. </span><span class="string">"\n"</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">// write to/from/subject/date/message-ID headers<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">fwrite</span><span class="keyword">(</span><span class="default">$pipes</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">], </span><span class="string">"To: " </span><span class="keyword">. </span><span class="default">$to</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">]); </span><span class="comment">// first recipient<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">for(</span><span class="default">$i </span><span class="keyword">= </span><span class="default">1</span><span class="keyword">; </span><span class="default">$i </span><span class="keyword">&lt; </span><span class="default">sizeof</span><span class="keyword">(</span><span class="default">$to</span><span class="keyword">); </span><span class="default">$i</span><span class="keyword">++) </span><span class="comment">// additional recipients<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">{<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">fwrite</span><span class="keyword">(</span><span class="default">$pipes</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">], </span><span class="string">", " </span><span class="keyword">. </span><span class="default">$to</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">]);<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">fwrite</span><span class="keyword">(</span><span class="default">$pipes</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">], </span><span class="string">"\nSubject: " </span><span class="keyword">. </span><span class="default">$subject </span><span class="keyword">. </span><span class="string">"\n"</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">fwrite</span><span class="keyword">(</span><span class="default">$pipes</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">], </span><span class="string">"From: " </span><span class="keyword">. </span><span class="default">$from </span><span class="keyword">. </span><span class="string">"\n"</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">fwrite</span><span class="keyword">(</span><span class="default">$pipes</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">], </span><span class="string">"Message-Id: &lt;" </span><span class="keyword">. </span><span class="default">md5</span><span class="keyword">(</span><span class="default">uniqid</span><span class="keyword">(</span><span class="default">microtime</span><span class="keyword">())) . </span><span class="string">"@" </span><span class="keyword">. </span><span class="default">$hostname </span><span class="keyword">. </span><span class="string">"&gt;\n"</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">fwrite</span><span class="keyword">(</span><span class="default">$pipes</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">], </span><span class="string">"Date: " </span><span class="keyword">. </span><span class="default">date</span><span class="keyword">(</span><span class="string">"r"</span><span class="keyword">) . </span><span class="string">"\n\n"</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">fwrite</span><span class="keyword">(</span><span class="default">$pipes</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">], </span><span class="default">$message</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">fwrite</span><span class="keyword">(</span><span class="default">$pipes</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">], </span><span class="string">"\n"</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">fclose</span><span class="keyword">(</span><span class="default">$pipes</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">]);<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">// write from address and recipients<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">fwrite</span><span class="keyword">(</span><span class="default">$pipes</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">], </span><span class="string">"F" </span><span class="keyword">. </span><span class="default">$from </span><span class="keyword">. </span><span class="string">"\0"</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; foreach(</span><span class="default">$to </span><span class="keyword">as </span><span class="default">$rcpt</span><span class="keyword">)<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">fwrite</span><span class="keyword">(</span><span class="default">$pipes</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">], </span><span class="string">"T" </span><span class="keyword">. </span><span class="default">$rcpt </span><span class="keyword">. </span><span class="string">"\0"</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">fwrite</span><span class="keyword">(</span><span class="default">$pipes</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">], </span><span class="string">"\0"</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">fclose</span><span class="keyword">(</span><span class="default">$pipes</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">]);<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">// return true on success.<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">return </span><span class="default">proc_close</span><span class="keyword">(</span><span class="default">$proc</span><span class="keyword">) == </span><span class="default">0</span><span class="keyword">;<br />
}<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="73774""></a>
  <div class="note">
   <strong class="user">Josh</strong>
   <a href="#73774" class="date">09-Mar-2007 07:05</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
While trying to send attachments I ran into the problem of having the beginning part of my encoded data being cut off.<br />
<br />
A fact that I didn't see mentioned anywhere explicitly (except maybe in the RFC, which admittedly I didn't read fully) was that two newlines are required before you start the encoded data:<br />
<br />
Content-Transfer-Encoding: base64\n<br />
Content-Type: application/zip; name="test_file.zip"\n<br />
\n&nbsp; //&lt;--- if this newline isn't here your data will get cut off<br />
DATA GOES HERE</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="73535""></a>
  <div class="note">
   <strong class="user">bigtree at dontspam dot 29a dot nl</strong>
   <a href="#73535" class="date">28-Feb-2007 01:46</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Since lines in $additional_headers must be separated by \n on Unix and \r\n on Windows, it might be useful to use the PHP_EOL constant which contains the correct value on either platform.<br />
<br />
Note that this variable was introduced in PHP 5.0.2 so to write portable code that also works in PHP versions before that, use the following code to make sure it exists:<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">if (!</span><span class="default">defined</span><span class="keyword">(</span><span class="string">'PHP_EOL'</span><span class="keyword">)) </span><span class="default">define </span><span class="keyword">(</span><span class="string">'PHP_EOL'</span><span class="keyword">, </span><span class="default">strtoupper</span><span class="keyword">(</span><span class="default">substr</span><span class="keyword">(</span><span class="default">PHP_OS</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">,</span><span class="default">3</span><span class="keyword">) == </span><span class="string">'WIN'</span><span class="keyword">) ? </span><span class="string">"\r\n" </span><span class="keyword">: </span><span class="string">"\n"</span><span class="keyword">);<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="72715""></a>
  <div class="note">
   <strong class="user">admin at chatfamy dot com</strong>
   <a href="#72715" class="date">30-Jan-2007 09:37</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
One thing it can be difficult to control with this function is the envelope "from" address. The envelope "from" address is distinct from the address that appears in the "From:" header of the email. It is what sendmail uses in its "MAIL FROM/RCPT TO" exchange with the receiving mail server. It also typically shows up in the "Return-Path:" header, but this need not be the case. The whole reason it is called an "envelope" address is that appears _outside_ of the message header and body, in the raw SMTP exchange between mail servers.
<br />

<br />
The default envelope "from" address on unix depends on what sendmail implementation you are using. But typically it will be set to the username of the running process followed by "@" and the hostname of the machine. In a typical configuration this will look something like apache@box17.example.net.
<br />

<br />
If your emails are being rejected by receiving mail servers, or if you need to change what address bounce emails are sent to, you can change the envelope "from" address to solve your problems.
<br />

<br />
To change the envelope "from" address on unix, you specify an "-r" option to your sendmail binary. You can do this globally in php.ini by adding the "-r" option to the "sendmail_path" command line. You can also do it programmatically from within PHP by passing "-r address@example.com" as the "additional_parameters" argument to the mail() function (the 5th argument). If you specify an address both places, the sendmail binary will be called with two "-r" options, which may have undefined behavior depending on your sendmail implementation. With the Postfix MTA, later "-r" options silently override earlier options, making it possible to set a global default and still get sensible behavior when you try to override it locally. 
<br />

<br />
On Windows, the the situation is a lot simpler. The envelope "from" address there is just the value of "sendmail_from" in the php.ini file. You can override it locally with ini_set().</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="70749""></a>
  <div class="note">
   <strong class="user">tdaniel at univ dot haifa dot ac dot il</strong>
   <a href="#70749" class="date">26-Oct-2006 01:17</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I had trouble getting multiple emails sent for Outlook accounts (a single PHP page performed 2 mail() calls). <br />
<br />
The PHP mail() function works correctly, but the same mails that were recieved on a private POP3 server were randomly missing by our intranet Outlook exchange server.<br />
<br />
If you have the same problem, try to verify that the "Message-ID: " is unique at the $headers string. i.e.<br />
<br />
<span class="default">&lt;?php<br />
$headers </span><span class="keyword">= [...] . <br />
</span><span class="string">"Message-ID: &lt;"</span><span class="keyword">. </span><span class="default">time</span><span class="keyword">() .</span><span class="default">rand</span><span class="keyword">(</span><span class="default">1</span><span class="keyword">,</span><span class="default">1000</span><span class="keyword">). </span><span class="string">"@"</span><span class="keyword">.</span><span class="default">$_SERVER</span><span class="keyword">[</span><span class="string">'SERVER_NAME'</span><span class="keyword">].</span><span class="string">"&gt;"</span><span class="keyword">. </span><span class="string">"\r\n" </span><span class="keyword">[...];<br />
</span><span class="default">?&gt;<br />
</span><br />
(rand() is used only for demonstration purposes. a better way is to use an index variable that increments (i++) after each mail)<br />
<br />
I noticed that when multiple messeges were sent simultaneously, the message-id was the same (probably there was no miliseconds differential). My guess is that Outlook is collating messages with the same message-ID; a thing that causes only one email to pass to the Outlook inbox instead of a few.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="69754""></a>
  <div class="note">
   <strong class="user">johniskew2</strong>
   <a href="#69754" class="date">19-Sep-2006 06:28</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
An important rule of thumb, because it seems few really follow it and it can alleviate so many headaches: When filtering your email headers for injection characters use a regular expression to judge whether the user's input is valid.&nbsp; For example to see if the user entered a valid e-mail address use something like&nbsp; [a-zA-Z0-9._%-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,4}.&nbsp; Dont try to filter out bad characters (like searching for LF or CR), because you will ALWAYS miss something.&nbsp; You can be sure your application is more secure going this route....provided the regular expression is valid!&nbsp; This same point goes for any sort of form input not just for sending out emails.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="69129""></a>
  <div class="note">
   <strong class="user">thomas at p-devion dot de</strong>
   <a href="#69129" class="date">24-Aug-2006 07:46</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Change the function addattachment for multipartmail to auto detect the mime_content_type ... 
<br />

<br />
<span class="default">&lt;?php
<br />
&nbsp;&nbsp; &nbsp; </span><span class="keyword">function </span><span class="default">addattachment</span><span class="keyword">(</span><span class="default">$file</span><span class="keyword">){
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$fname </span><span class="keyword">= </span><span class="default">substr</span><span class="keyword">(</span><span class="default">strrchr</span><span class="keyword">(</span><span class="default">$file</span><span class="keyword">, </span><span class="string">"/"</span><span class="keyword">), </span><span class="default">1</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$data </span><span class="keyword">= </span><span class="default">file_get_contents</span><span class="keyword">(</span><span class="default">$file</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$i </span><span class="keyword">= </span><span class="default">count</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">parts</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$content_id </span><span class="keyword">= </span><span class="string">"part</span><span class="default">$i</span><span class="string">." </span><span class="keyword">. </span><span class="default">sprintf</span><span class="keyword">(</span><span class="string">"%09d"</span><span class="keyword">, </span><span class="default">crc32</span><span class="keyword">(</span><span class="default">$fname</span><span class="keyword">)) . </span><span class="default">strrchr</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">to_address</span><span class="keyword">, </span><span class="string">"@"</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">parts</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">] = </span><span class="string">"Content-Type: "</span><span class="keyword">.</span><span class="default">mime_content_type</span><span class="keyword">(</span><span class="default">$file</span><span class="keyword">).</span><span class="string">"; name=\"</span><span class="default">$fname</span><span class="string">\"\r\n" </span><span class="keyword">.
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="string">"Content-Transfer-Encoding: base64\r\n" </span><span class="keyword">.
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="string">"Content-ID: &lt;</span><span class="default">$content_id</span><span class="string">&gt;\r\n" </span><span class="keyword">.
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="string">"Content-Disposition: inline;\n" </span><span class="keyword">.
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="string">" filename=\"</span><span class="default">$fname</span><span class="string">\"\r\n" </span><span class="keyword">.
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="string">"\n" </span><span class="keyword">.
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">chunk_split</span><span class="keyword">( </span><span class="default">base64_encode</span><span class="keyword">(</span><span class="default">$data</span><span class="keyword">), </span><span class="default">68</span><span class="keyword">, </span><span class="string">"\n"</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; return </span><span class="default">$content_id</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; }
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="68471""></a>
  <div class="note">
   <strong class="user">panoramical at gmail dot com</strong>
   <a href="#68471" class="date">28-Jul-2006 01:19</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Searched for ages on the internet trying to find something that parses EML files and then sends them...for all of you who want to send an EML files you first have to upload it, read it, then delete it. Here's my function...it's specialised for a single form where the user uploads the EML file. <br />
<br />
<span class="default">&lt;?php<br />
<br />
</span><span class="keyword">if(isset(</span><span class="default">$_POST</span><span class="keyword">[</span><span class="string">'submit'</span><span class="keyword">]))<br />
{<br />
<br />
</span><span class="comment">// Reads in a file (eml) a user has inputted<br />
</span><span class="keyword">function </span><span class="default">eml_read_in</span><span class="keyword">()<br />
{<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$file_ext </span><span class="keyword">= </span><span class="default">stristr</span><span class="keyword">(</span><span class="default">$_FILES</span><span class="keyword">[</span><span class="string">'upload'</span><span class="keyword">][</span><span class="string">'name'</span><span class="keyword">], </span><span class="string">'.'</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">// If it is an eml file<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">if(</span><span class="default">$file_ext </span><span class="keyword">== </span><span class="string">'.eml'</span><span class="keyword">)<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// Define vars<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$dir </span><span class="keyword">= </span><span class="string">'eml/'</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$file </span><span class="keyword">= </span><span class="default">$dir</span><span class="keyword">.</span><span class="default">basename</span><span class="keyword">(</span><span class="default">$_FILES</span><span class="keyword">[</span><span class="string">'upload'</span><span class="keyword">][</span><span class="string">'name'</span><span class="keyword">]);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$carry </span><span class="keyword">= </span><span class="string">'yes'</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// Try and upload the file<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">if(</span><span class="default">move_uploaded_file</span><span class="keyword">(</span><span class="default">$_FILES</span><span class="keyword">[</span><span class="string">'upload'</span><span class="keyword">][</span><span class="string">'tmp_name'</span><span class="keyword">], </span><span class="default">$file</span><span class="keyword">))<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// Now attempt to read the file<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">if(</span><span class="default">$eml_file </span><span class="keyword">= </span><span class="default">file</span><span class="keyword">(</span><span class="default">$file</span><span class="keyword">))<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// Create the array to store preliminary headers<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$headers </span><span class="keyword">= array();<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$body </span><span class="keyword">= </span><span class="string">''</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$ii </span><span class="keyword">= -</span><span class="default">1</span><span class="keyword">;<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// For every line, carry out this loop<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">foreach(</span><span class="default">$eml_file </span><span class="keyword">as </span><span class="default">$key </span><span class="keyword">=&gt; </span><span class="default">$value</span><span class="keyword">)<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$pattern </span><span class="keyword">= </span><span class="string">'^&lt;html&gt;'</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if(((</span><span class="default">eregi</span><span class="keyword">(</span><span class="default">$pattern</span><span class="keyword">, </span><span class="default">$value</span><span class="keyword">)))||(</span><span class="default">$carry </span><span class="keyword">== </span><span class="string">'no'</span><span class="keyword">))<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// Stop putting data into the $headers array<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$carry </span><span class="keyword">= </span><span class="string">'no'</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$i</span><span class="keyword">++;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$body </span><span class="keyword">.= </span><span class="default">$value</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; else<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; {&nbsp; &nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// Separate each one with a colon<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">if((</span><span class="default">$eml_file_expl </span><span class="keyword">= </span><span class="default">explode</span><span class="keyword">(</span><span class="string">':'</span><span class="keyword">, </span><span class="default">$value</span><span class="keyword">))&amp;&amp;(</span><span class="default">$carry </span><span class="keyword">== </span><span class="string">'yes'</span><span class="keyword">))<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; {<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// The row has been split in half at least...<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">if(isset(</span><span class="default">$eml_file_expl</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">]))<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// Put it into the preliminary headers<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$headers</span><span class="keyword">[</span><span class="default">$eml_file_expl</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">]] = </span><span class="default">$eml_file_expl</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">];<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// There might be more semicolons in it...<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">for(</span><span class="default">$i</span><span class="keyword">=</span><span class="default">2</span><span class="keyword">;</span><span class="default">$i</span><span class="keyword">&lt;=</span><span class="default">$count</span><span class="keyword">;</span><span class="default">$i</span><span class="keyword">++)<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// Add the other values to the header<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$headers</span><span class="keyword">[</span><span class="default">$eml_file_expl</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">]] .= </span><span class="string">':'</span><span class="keyword">.</span><span class="default">$eml_file_expl</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">];<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }&nbsp; &nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }&nbsp; &nbsp; &nbsp; &nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// Clear up the headers array<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$eml_values </span><span class="keyword">= array();<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$eml_values</span><span class="keyword">[</span><span class="default">to</span><span class="keyword">] = </span><span class="default">$headers</span><span class="keyword">[</span><span class="default">To</span><span class="keyword">];<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$eml_values</span><span class="keyword">[</span><span class="default">from</span><span class="keyword">] = </span><span class="default">$headers</span><span class="keyword">[</span><span class="default">From</span><span class="keyword">];<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$eml_values</span><span class="keyword">[</span><span class="default">subject</span><span class="keyword">] = </span><span class="default">$headers</span><span class="keyword">[</span><span class="default">Subject</span><span class="keyword">];<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$eml_values</span><span class="keyword">[</span><span class="string">'reply-to'</span><span class="keyword">] = </span><span class="default">$headers</span><span class="keyword">[</span><span class="string">'Reply-To'</span><span class="keyword">];<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$eml_values</span><span class="keyword">[</span><span class="string">'content-type'</span><span class="keyword">] = </span><span class="default">$headers</span><span class="keyword">[</span><span class="string">'Content-Type'</span><span class="keyword">];<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$eml_values</span><span class="keyword">[</span><span class="default">body</span><span class="keyword">] = </span><span class="default">$body</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">unlink</span><span class="keyword">(</span><span class="default">$file</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">$eml_values</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; else<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="string">'&lt;p&gt;File not uploaded - there was an error&lt;/p&gt;'</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; <br />
}&nbsp; &nbsp; <br />
<br />
</span><span class="comment">// Takes information automatically from the $_FILES array...<br />
</span><span class="default">$eml_pattern </span><span class="keyword">= </span><span class="default">eml_read_in</span><span class="keyword">()<br />
<br />
</span><span class="comment">// Headers definable...through eml_read_in() again, but I'm guessing they'll be the same for each doc...<br />
<br />
</span><span class="keyword">if(</span><span class="default">mail</span><span class="keyword">(</span><span class="default">$eml_pattern</span><span class="keyword">[</span><span class="default">to</span><span class="keyword">], </span><span class="default">$eml_pattern</span><span class="keyword">[</span><span class="default">subject</span><span class="keyword">], </span><span class="default">$eml_pattern</span><span class="keyword">[</span><span class="default">content</span><span class="keyword">], </span><span class="default">$headers</span><span class="keyword">)) echo </span><span class="string">'Mail Sent'</span><span class="keyword">;<br />
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="68359""></a>
  <div class="note">
   
   <a href="#68359" class="date">24-Jul-2006 05:55</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
correction for class multipartmail<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">function </span><span class="default">addmessage</span><span class="keyword">(</span><span class="default">$msg </span><span class="keyword">= </span><span class="string">""</span><span class="keyword">, </span><span class="default">$ctype </span><span class="keyword">= </span><span class="string">"text/plain"</span><span class="keyword">){<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">parts</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">] ....<br />
</span><span class="default">?&gt;<br />
</span><br />
if you are adding attachment first and then addmessage you can easy overwrite added attachment - better use <br />
<br />
<span class="default">&lt;?php<br />
<br />
</span><span class="keyword">function </span><span class="default">addmessage</span><span class="keyword">(</span><span class="default">$msg </span><span class="keyword">= </span><span class="string">""</span><span class="keyword">, </span><span class="default">$ctype </span><span class="keyword">= </span><span class="string">"text/plain"</span><span class="keyword">){<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">parts</span><span class="keyword">[</span><span class="default">count</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">parts</span><span class="keyword">)] ....<br />
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="68271""></a>
  <div class="note">
   <strong class="user">sander at cartel dot nl</strong>
   <a href="#68271" class="date">20-Jul-2006 12:26</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I found out that a ms server (ESMTP MAIL Service, Version: 5.0.2195.6713) also had the problem using CRLF in the headers:<br />
<br />
If messages are not received, try using a LF (\n) only. Some poor quality Unix mail transfer agents replace LF by CRLF automatically (which leads to doubling CR if CRLF is used). This should be a last resort, as it does not comply with RFC 2822.<br />
<br />
The suggested fix works. <br />
<br />
Sander</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="62875""></a>
  <div class="note">
   <strong class="user">Nimlhug</strong>
   <a href="#62875" class="date">11-Mar-2006 07:41</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
As noted in other, well, notes; the "additional headers" parameter can be easily exploited, when doing things like:<br />
<br />
<span class="default">&lt;?php<br />
&nbsp; mail</span><span class="keyword">( </span><span class="default">$_POST</span><span class="keyword">[</span><span class="string">'to'</span><span class="keyword">], </span><span class="default">$_POST</span><span class="keyword">[</span><span class="string">'subject'</span><span class="keyword">], </span><span class="default">$_POST</span><span class="keyword">[</span><span class="string">'message'</span><span class="keyword">], </span><span class="string">'Reply-to: '</span><span class="keyword">.</span><span class="default">$_POST</span><span class="keyword">[</span><span class="string">'from'</span><span class="keyword">].</span><span class="string">"\r\n" </span><span class="keyword">);<br />
</span><span class="default">?&gt;<br />
</span><br />
An easy way of fixing this, is removing CRLFs from the header-strings, like so:<br />
<br />
<span class="default">&lt;?php<br />
&nbsp; $_POST</span><span class="keyword">[</span><span class="string">'from'</span><span class="keyword">] = </span><span class="default">str_replace</span><span class="keyword">( </span><span class="string">"\r\n"</span><span class="keyword">, </span><span class="string">''</span><span class="keyword">, </span><span class="default">$_POST</span><span class="keyword">[</span><span class="string">'from'</span><span class="keyword">] );<br />
</span><span class="default">?&gt;<br />
</span><br />
This way, the extra data will be part of the previous header.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="62701""></a>
  <div class="note">
   <strong class="user">junaid at techni-serve dot com</strong>
   <a href="#62701" class="date">07-Mar-2006 06:49</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Note: on class "multipartmail".&nbsp; Modify the function buildmessage with the following and it will work great.<br />
<br />
function buildmessage(){<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; $this-&gt;message = "This is a multipart message in mime format.\n";<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; $cnt = count($this-&gt;parts);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; for($i=0; $i&lt;$cnt; $i++){<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $this-&gt;message .= "--" . $this-&gt;boundary . "\n" .$this-&gt;parts[$i];<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $this-&gt;message .= "--" . $this-&gt;boundary . "-- \n";<br />
&nbsp;&nbsp; &nbsp; }<br />
<br />
Thank for all the help.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="59773""></a>
  <div class="note">
   <strong class="user">Ben Cooke</strong>
   <a href="#59773" class="date">15-Dec-2005 02:34</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Note that there is a big difference between the behavior of this function on Windows systems vs. UNIX systems. On Windows it delivers directly to an SMTP server, while on a UNIX system it uses a local command to hand off to the system's own MTA.
<br />

<br />
The upshot of all this is that on a Windows system your&nbsp; message and headers must use the standard line endings \r\n as prescribed by the email specs. On a UNIX system the MTA's "sendmail" interface assumes that recieved data will use UNIX line endings and will turn any \n to \r\n, so you must supply only \n to mail() on a UNIX system to avoid the MTA hypercorrecting to \r\r\n.
<br />

<br />
If you use plain old \n on a Windows system, some MTAs will get a little upset. qmail in particular will refuse outright to accept any message that has a lonely \n without an accompanying \r.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="57473""></a>
  <div class="note">
   <strong class="user">fnjordy at gmail dot com</strong>
   <a href="#57473" class="date">05-Oct-2005 11:54</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Another example of sending a utf-8 HTML mail:
<br />

<br />
<span class="default">&lt;?php
<br />
$to </span><span class="keyword">= </span><span class="string">'bob@example.com'</span><span class="keyword">;
<br />
</span><span class="default">$subject </span><span class="keyword">= </span><span class="string">'Wakeup bob!'</span><span class="keyword">;
<br />
</span><span class="default">$message </span><span class="keyword">= </span><span class="string">'&lt;b&gt;yo&lt;/b&gt;, whassup?'</span><span class="keyword">;
<br />
</span><span class="default">$headers </span><span class="keyword">= </span><span class="string">"From: server@example.com\r\n" </span><span class="keyword">.
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="string">'X-Mailer: PHP/' </span><span class="keyword">. </span><span class="default">phpversion</span><span class="keyword">() . </span><span class="string">"\r\n" </span><span class="keyword">.
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="string">"MIME-Version: 1.0\r\n" </span><span class="keyword">.
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="string">"Content-Type: text/html; CHARSET=shift-jis\r\n" </span><span class="keyword">.
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="string">"Content-Transfer-Encoding: 8bit\r\n\r\n"</span><span class="keyword">;
<br />

<br />
</span><span class="comment">// Send
<br />
</span><span class="default">mail</span><span class="keyword">(</span><span class="default">$to</span><span class="keyword">, </span><span class="default">$subject</span><span class="keyword">, </span><span class="default">$message</span><span class="keyword">, </span><span class="default">$headers</span><span class="keyword">);
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="57009""></a>
  <div class="note">
   <strong class="user">fontajos at phpeppershop dot com</strong>
   <a href="#57009" class="date">21-Sep-2005 05:24</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Problems with Microsoft Exchange and PHP as ISAPI-module
<br />

<br />
We found out, that if you want to send multipart mime emails using the PHP mail-function on a Windows box using a Microsoft Exchange server, you have to use separate containers for the mail body and the mail header.
<br />

<br />
In many examples like in <a href="http://www.zend.com/zend/trick/html-email.php or in the book PHP developers cookbook you find html multipart/alternative mailing solutions that build the mime header and the mail body into one PHP variable and send this as fourth argument (header" rel="nofollow" target="_blank">http://www.zend.com/zend/trick/html-email.php or in the book PHP developers cookbook you find html multipart/alternative mailing solutions that build the mime header and the mail body into one PHP variable and send this as fourth argument (header</a>) to the PHP mail-function. This works fine on most systems but not on the above mentioned combination.
<br />

<br />
We found a rather trivial solution: Simply split the mime mail header and the mail body into two separate variables and give them separately to the PHP mail function, example:
<br />

<br />
<span class="default">&lt;?php
<br />
</span><span class="comment">//add From: header
<br />
</span><span class="default">$headers </span><span class="keyword">= </span><span class="string">"From: webserver@localhost\r\n"</span><span class="keyword">;
<br />

<br />
</span><span class="comment">//specify MIME version 1.0
<br />
</span><span class="default">$headers </span><span class="keyword">.= </span><span class="string">"MIME-Version: 1.0\r\n"</span><span class="keyword">;
<br />

<br />
</span><span class="comment">//unique boundary
<br />
</span><span class="default">$boundary </span><span class="keyword">= </span><span class="default">uniqid</span><span class="keyword">(</span><span class="string">"HTMLDEMO"</span><span class="keyword">);
<br />

<br />
</span><span class="comment">//tell e-mail client this e-mail contains//alternate versions
<br />
</span><span class="default">$headers </span><span class="keyword">.= </span><span class="string">"Content-Type: multipart/mixed; boundary = </span><span class="default">$boundary</span><span class="string">\r\n\r\n"</span><span class="keyword">;
<br />

<br />
</span><span class="comment">//plain text version of message
<br />
</span><span class="default">$body </span><span class="keyword">= </span><span class="string">"--</span><span class="default">$boundary</span><span class="string">\r\n" </span><span class="keyword">.
<br />
&nbsp;&nbsp; </span><span class="string">"Content-Type: text/plain; charset=ISO-8859-1\r\n" </span><span class="keyword">.
<br />
&nbsp;&nbsp; </span><span class="string">"Content-Transfer-Encoding: base64\r\n\r\n"</span><span class="keyword">;
<br />
</span><span class="default">$body </span><span class="keyword">.= </span><span class="default">chunk_split</span><span class="keyword">(</span><span class="default">base64_encode</span><span class="keyword">(</span><span class="string">"This is the plain text version!"</span><span class="keyword">));
<br />

<br />
</span><span class="comment">//HTML version of message
<br />
</span><span class="default">$body </span><span class="keyword">.= </span><span class="string">"--</span><span class="default">$boundary</span><span class="string">\r\n" </span><span class="keyword">.
<br />
&nbsp;&nbsp; </span><span class="string">"Content-Type: text/html; charset=ISO-8859-1\r\n" </span><span class="keyword">.
<br />
&nbsp;&nbsp; </span><span class="string">"Content-Transfer-Encoding: base64\r\n\r\n"</span><span class="keyword">;
<br />
</span><span class="default">$body </span><span class="keyword">.= </span><span class="default">chunk_split</span><span class="keyword">(</span><span class="default">base64_encode</span><span class="keyword">(</span><span class="string">"This the &lt;b&gt;HTML&lt;/b&gt; version!"</span><span class="keyword">));
<br />

<br />
</span><span class="comment">//send message
<br />
</span><span class="default">mail</span><span class="keyword">(</span><span class="string">"root@localhost"</span><span class="keyword">, </span><span class="string">"An HTML Message"</span><span class="keyword">, </span><span class="default">$body</span><span class="keyword">, </span><span class="default">$headers</span><span class="keyword">);
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="56788""></a>
  <div class="note">
   <strong class="user">GwarDrazul</strong>
   <a href="#56788" class="date">15-Sep-2005 01:01</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
The article mentioned below is quite good to understand the problem of header injection. However, it suggests the following as a solution: look for "\n" and "\r" inside your user input fields (especially in those used for the $header param) and, if found reject the mail. <br />
<br />
Allthough this will probably work I still believe it is better to have a "white list" of allowed characters instead of a "black list" with forbidden characters.<br />
<br />
Example:<br />
If you want a user to enter his name, then allow characters only!<br />
If you want a user to enter his email adress, then check if the entry is a valid email adress.<br />
<br />
Doing so might automatically solve problems which you didn't think of when you created the "black list". For SMTP headers colons are needed. If you check for a valid email adress the hacker won't be able to enter colons inside that form field.<br />
<br />
I suggest using regular expressions for those checks.<br />
<br />
For more information about regular expressions see:<br />
<a href="http://www.regular-expressions.info/" rel="nofollow" target="_blank">http://www.regular-expressions.info/</a></span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="52856""></a>
  <div class="note">
   <strong class="user">msheldon at desertraven dot com</strong>
   <a href="#52856" class="date">15-May-2005 09:09</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Just a comment on some of the examples, and as a note for those who may be unaware. The SMTP RFC 822 is VERY explicit in stating that \r\n is the ONLY acceptable line break format in the headers, though is a little vague about the message body. While many MTAs will deal with just \n, I've run accross plenty of them that will exhibit "interesting" behaviours when this happens. Those MTAs that are strict in compliance will definitely break when header lines are terminated with only \n. They will also most likely break if the body of the message contains more than 1000 consecutive characters without a \r\n.*<br />
<br />
Note that RFC 821 is a little more clear in defining:<br />
"line<br />
&nbsp;&nbsp; &nbsp;&nbsp; A a sequence of ASCII characters ending with a &lt;CRLF&gt;."<br />
<br />
RFC 821 makes no distinction between header lines and message body lines, since both are actually transmitted during the DATA phase.<br />
<br />
Bottom line, best practice is to be sure to convert any bare \n characters in the message to \r\n.<br />
<br />
* "The maximum total length of a text line including the &lt;CRLF&gt; is 1000 characters" (RFC 821)</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="52220""></a>
  <div class="note">
   <strong class="user">jonte at macnytt dot com</strong>
   <a href="#52220" class="date">25-Apr-2005 01:16</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Users of Mac OS X Server need to activate SMTP part of the Mailserver before this is working.<br />
<br />
Also note that if the ISP has blocked port 25 outgoing, you run into problems. You can find more info about this in the SMTP server log in Server Admin application if you run OSX Server.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="52011""></a>
  <div class="note">
   
   <a href="#52011" class="date">18-Apr-2005 09:20</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
A co-worker of mine had a problem where she needed to have a backslash in the header. Basically, the name of the company has a couple of backslashes in it. However, when the recipient was receiving the email, the "From:" part had the backslashes removed. We got it to work but placing three backslashes whenever we wanted one to show up. I'd assume that the mail server was modifying the headers and this is not really an issue with php. Anyway, thought this might help someone.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="51130""></a>
  <div class="note">
   <strong class="user">benles at bldigital dot com</strong>
   <a href="#51130" class="date">21-Mar-2005 06:47</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I get a 550 error when using mail() with this To format:<br />
<br />
User &lt;user@example.com&gt;<br />
<br />
When it's changed to just the bare email, it works fine. Just FYI that some mail servers may behave this way.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="50544""></a>
  <div class="note">
   <strong class="user">php dot net at schrecktech dot com</strong>
   <a href="#50544" class="date">03-Mar-2005 01:07</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
When sending MIME email make sure you follow the documentation with the "70" characters per line...you may end up with missing characters...and that is really hard to track down...</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="50128""></a>
  <div class="note">
   <strong class="user">grey at greywyvern dot moc</strong>
   <a href="#50128" class="date">18-Feb-2005 09:47</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
When including your own custom headers try not to include a trailing \r\n at the end of the last header.&nbsp; Leaving the \r\n causes an extra line-feed at the beginning of the message body, so your message will start on the second line.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="43967""></a>
  <div class="note">
   <strong class="user">Sven Riedel</strong>
   <a href="#43967" class="date">10-Jul-2004 03:22</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
mail() requires /bin/sh to exist in Unix environments, next to a mail delivery program. This is very relevant when setting up apache in a chroot environment. Unfortunately this isn't anywhere in the documentation and took me several months to figure out.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="42241""></a>
  <div class="note">
   <strong class="user">nospam at mingo dot ath dot cx</strong>
   <a href="#42241" class="date">09-May-2004 03:55</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If you're using a linux server using Postfix, and your server hasn't the host name set to a valid name (because it's behind a firewall in an intranet), it's possible that when sending mails using the mail function, some mail servers reject them. This is because they can't check the return path header. If you want to change the Return-Path used by sendmail init the php.ini and edit the sendmail_path variable to this:
<br />

<br />
sendmail_path = "sendmail -t -i -F webmaster@example.com -f webmaster@example.com"</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="40204""></a>
  <div class="note">
   <strong class="user">Paul</strong>
   <a href="#40204" class="date">25-Feb-2004 11:51</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
My mime multipart/alternative messages were going ok, until I switched to qmail with php .. after years of painfull searching, I came across this on the Life With Qmail 'Gotchas' section:<br />
<br />
G.11. Carriage Return/Linefeed (CRLF) line breaks don't work<br />
<br />
qmail-inject and other local injection mechanisms like sendmail don't work right when messages are injected with DOS-style carriage return/linefeed (CRLF) line breaks. Unlike Sendmail, qmail requires locally-injected messages to use Unix newlines (LF only). This is a common problem with PHP scripts.<br />
<br />
So now, I can go back to sending emails with text AND html components :)</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="39305""></a>
  <div class="note">
   <strong class="user">roberto dot silva at mexicoshipping dot net</strong>
   <a href="#39305" class="date">24-Jan-2004 01:16</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If you can't use or don't understand how to use the sendmail program from linux, you can use a PEAR object to send mail.
<br />

<br />
<span class="default">&lt;?php
<br />
</span><span class="keyword">include(</span><span class="string">"Mail.php"</span><span class="keyword">);
<br />

<br />
</span><span class="default">$recipients </span><span class="keyword">= </span><span class="string">"mailto@example.com"</span><span class="keyword">;
<br />

<br />
</span><span class="default">$headers</span><span class="keyword">[</span><span class="string">"From"</span><span class="keyword">]&nbsp; &nbsp; = </span><span class="string">"mailfrom@example.com"</span><span class="keyword">;
<br />
</span><span class="default">$headers</span><span class="keyword">[</span><span class="string">"To"</span><span class="keyword">]&nbsp; &nbsp; &nbsp; = </span><span class="string">"mailto@example.com"</span><span class="keyword">;
<br />
</span><span class="default">$headers</span><span class="keyword">[</span><span class="string">"Subject"</span><span class="keyword">] = </span><span class="string">"Test message"</span><span class="keyword">;
<br />

<br />
</span><span class="default">$body </span><span class="keyword">= </span><span class="string">"TEST MESSAGE!!!"</span><span class="keyword">;
<br />

<br />
</span><span class="default">$params</span><span class="keyword">[</span><span class="string">"host"</span><span class="keyword">] = </span><span class="string">"example.com"</span><span class="keyword">;
<br />
</span><span class="default">$params</span><span class="keyword">[</span><span class="string">"port"</span><span class="keyword">] = </span><span class="string">"25"</span><span class="keyword">;
<br />
</span><span class="default">$params</span><span class="keyword">[</span><span class="string">"auth"</span><span class="keyword">] = </span><span class="default">true</span><span class="keyword">;
<br />
</span><span class="default">$params</span><span class="keyword">[</span><span class="string">"username"</span><span class="keyword">] = </span><span class="string">"user"</span><span class="keyword">;
<br />
</span><span class="default">$params</span><span class="keyword">[</span><span class="string">"password"</span><span class="keyword">] = </span><span class="string">"password"</span><span class="keyword">;
<br />

<br />
</span><span class="comment">// Create the mail object using the Mail::factory method
<br />
</span><span class="default">$mail_object </span><span class="keyword">=&amp; </span><span class="default">Mail</span><span class="keyword">::</span><span class="default">factory</span><span class="keyword">(</span><span class="string">"smtp"</span><span class="keyword">, </span><span class="default">$params</span><span class="keyword">);
<br />

<br />
</span><span class="default">$mail_object</span><span class="keyword">-&gt;</span><span class="default">send</span><span class="keyword">(</span><span class="default">$recipients</span><span class="keyword">, </span><span class="default">$headers</span><span class="keyword">, </span><span class="default">$body</span><span class="keyword">);
<br />
</span><span class="default">?&gt;
<br />
</span>
<br />
In my case, i use a smtp server that require authentication, and sendmail configuration is almost cryptic to me.
<br />

<br />
PEAR is already installed in PHP 4.0.3 , if not, you must go to <a href="http://pear.php.net/ and install it, in my case, I needed to add the Socket.php to the PEAR library." rel="nofollow" target="_blank">http://pear.php.net/ and install it, in my case, I needed to add the Socket.php to the PEAR library.</a></span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="29038""></a>
  <div class="note">
   <strong class="user">f dot touchard at laposte dot net</strong>
   <a href="#29038" class="date">31-Jan-2003 04:46</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
***Encoding plain text as quoted-printable in MIME email***
<br />

<br />
If you don't want to install IMAP and use imap_8bit() to encode plain text or html message as quoted-printable
<br />
(friendly french special characters encoding :-) in MIME email, try this function.
<br />
I haven't fully tested it ( like with microtime with long mails). I send html message as 7-bit, so I didn't try yet with html.
<br />
If you have good html practise, you don't really need to encode html as quote-printable as it only uses 7-bit chars.
<br />
F.Touchard
<br />

<br />
<span class="default">&lt;?php
<br />
</span><span class="keyword">function </span><span class="default">qp_encoding</span><span class="keyword">(</span><span class="default">$Message</span><span class="keyword">) {
<br />
&nbsp;&nbsp;&nbsp; 
<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">/* Build (most polpular) Extended ASCII Char/Hex MAP (characters &gt;127 &amp; &lt;255) */
<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">for (</span><span class="default">$i</span><span class="keyword">=</span><span class="default">0</span><span class="keyword">; </span><span class="default">$i</span><span class="keyword">&lt;</span><span class="default">127</span><span class="keyword">; </span><span class="default">$i</span><span class="keyword">++) {
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$CharList</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">] = </span><span class="string">"/"</span><span class="keyword">.</span><span class="default">chr</span><span class="keyword">(</span><span class="default">$i</span><span class="keyword">+</span><span class="default">128</span><span class="keyword">).</span><span class="string">"/"</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$HexList</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">] = </span><span class="string">"="</span><span class="keyword">.</span><span class="default">strtoupper</span><span class="keyword">(</span><span class="default">bin2hex</span><span class="keyword">(</span><span class="default">chr</span><span class="keyword">(</span><span class="default">$i</span><span class="keyword">+</span><span class="default">128</span><span class="keyword">)));
<br />
&nbsp;&nbsp;&nbsp; }
<br />

<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">/* Encode equal sign &amp; 8-bit characters as equal signs followed by their hexadecimal values */
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$Message </span><span class="keyword">= </span><span class="default">str_replace</span><span class="keyword">(</span><span class="string">"="</span><span class="keyword">, </span><span class="string">"=3D"</span><span class="keyword">, </span><span class="default">$Message</span><span class="keyword">);
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$Message </span><span class="keyword">= </span><span class="default">preg_replace</span><span class="keyword">(</span><span class="default">$CharList</span><span class="keyword">, </span><span class="default">$HexList</span><span class="keyword">, </span><span class="default">$Message</span><span class="keyword">);
<br />

<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">/* Lines longer than 76 characters (size limit for quoted-printable Content-Transfer-Encoding)
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; will be cut after character 75 and an equals sign is appended to these lines. */ 
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$MessageLines </span><span class="keyword">= </span><span class="default">split</span><span class="keyword">(</span><span class="string">"\n"</span><span class="keyword">, </span><span class="default">$Message</span><span class="keyword">);
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$Message_qp </span><span class="keyword">= </span><span class="string">""</span><span class="keyword">;
<br />
&nbsp;&nbsp;&nbsp; while(list(, </span><span class="default">$Line</span><span class="keyword">) = </span><span class="default">each</span><span class="keyword">(</span><span class="default">$MessageLines</span><span class="keyword">)) {
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">strlen</span><span class="keyword">(</span><span class="default">$Line</span><span class="keyword">) &gt; </span><span class="default">75</span><span class="keyword">) {
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$Pointer </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">;&nbsp; &nbsp; &nbsp; &nbsp; 
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; while (</span><span class="default">$Pointer </span><span class="keyword">&lt;= </span><span class="default">strlen</span><span class="keyword">(</span><span class="default">$Line</span><span class="keyword">)) {
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$Offset </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">preg_match</span><span class="keyword">(</span><span class="string">"/^=(3D|([8-9A-F]{1}[0-9A-F]{1}))$/"</span><span class="keyword">, </span><span class="default">substr</span><span class="keyword">(</span><span class="default">$Line</span><span class="keyword">, (</span><span class="default">$Pointer</span><span class="keyword">+</span><span class="default">73</span><span class="keyword">), </span><span class="default">3</span><span class="keyword">))) </span><span class="default">$Offset</span><span class="keyword">=-</span><span class="default">2</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">preg_match</span><span class="keyword">(</span><span class="string">"/^=(3D|([8-9A-F]{1}[0-9A-F]{1}))$/"</span><span class="keyword">, </span><span class="default">substr</span><span class="keyword">(</span><span class="default">$Line</span><span class="keyword">, (</span><span class="default">$Pointer</span><span class="keyword">+</span><span class="default">74</span><span class="keyword">), </span><span class="default">3</span><span class="keyword">))) </span><span class="default">$Offset</span><span class="keyword">=-</span><span class="default">1</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$Message_qp</span><span class="keyword">.= </span><span class="default">substr</span><span class="keyword">(</span><span class="default">$Line</span><span class="keyword">, </span><span class="default">$Pointer</span><span class="keyword">, (</span><span class="default">75</span><span class="keyword">+</span><span class="default">$Offset</span><span class="keyword">)).</span><span class="string">"=\n"</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if ((</span><span class="default">strlen</span><span class="keyword">(</span><span class="default">$Line</span><span class="keyword">) - (</span><span class="default">$Pointer</span><span class="keyword">+</span><span class="default">75</span><span class="keyword">)) &lt;= </span><span class="default">75</span><span class="keyword">) {&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$Message_qp</span><span class="keyword">.= </span><span class="default">substr</span><span class="keyword">(</span><span class="default">$Line</span><span class="keyword">, (</span><span class="default">$Pointer</span><span class="keyword">+</span><span class="default">75</span><span class="keyword">+</span><span class="default">$Offset</span><span class="keyword">)).</span><span class="string">"\n"</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; break </span><span class="default">1</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$Pointer</span><span class="keyword">+= </span><span class="default">75</span><span class="keyword">+</span><span class="default">$Offset</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; } else {
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$Message_qp</span><span class="keyword">.= </span><span class="default">$Line</span><span class="keyword">.</span><span class="string">"\n"</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }
<br />
&nbsp;&nbsp;&nbsp; }&nbsp; &nbsp; &nbsp; &nbsp; 
<br />
&nbsp;&nbsp;&nbsp; return </span><span class="default">$Message_qp</span><span class="keyword">;
<br />
}
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="24963""></a>
  <div class="note">
   <strong class="user">stevenlim at Edinburgh-Consulting dot com</strong>
   <a href="#24963" class="date">06-Sep-2002 09:53</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
How to detect a bounce email 
<br />

<br />
1. make sure the email you send out have the header 
<br />
"Return-Path: detect-bounce@example.com\r\n",
<br />
&amp;
<br />
"Return-Receipt-To: bounce@example.com\r\n"
<br />

<br />
2. setup this detect-bounce mail account at your mail server
<br />

<br />
3. redirect the incoming mail from this email account to your php script (check your mail server doc on how do this)
<br />

<br />
4. your php script will then be able to process the incoming email in whatever way you like, including to detect bounce mail message (use regexp search).
<br />

<br />
Note that the mail will be not be store after the mail server has redirect to your script.&nbsp; If you want to store it, you need additional code in your script
<br />

<br />
Hope the above help
<br />

<br />
Steven Lim
<br />
IT Consultant</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
</div>
</div>
</div></div></body></html>
